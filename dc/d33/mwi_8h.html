<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Asterisk - The Open Source Telephony Project: mwi.h File Reference</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Asterisk - The Open Source Telephony Project
   &#160;<span id="projectnumber">18.5.0</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "../../search",false,'Search');
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('../../',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="../../dir_d44c64559bbebec7f509842c48db8b23.html">include</a></li><li class="navelem"><a class="el" href="../../dir_6d4b1cdb59e2db6ad82005b337288fef.html">asterisk</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#nested-classes">Data Structures</a> &#124;
<a href="#define-members">Macros</a> &#124;
<a href="#typedef-members">Typedefs</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">mwi.h File Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>Asterisk MWI API.  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &quot;<a class="el" href="../../d5/d60/utils_8h_source.html">asterisk/utils.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="../../d1/d96/stasis__state_8h_source.html">asterisk/stasis_state.h</a>&quot;</code><br />
</div><div class="textblock"><div class="dynheader">
Include dependency graph for mwi.h:</div>
<div class="dyncontent">
<div class="center"><img src="../../d0/d98/mwi_8h__incl.png" border="0" usemap="#mwi_8h" alt=""/></div>
<map name="mwi_8h" id="mwi_8h">
<area shape="rect" id="node2" href="../../d5/d60/utils_8h.html" title="Utility functions. " alt="" coords="1369,229,1483,256"/>
<area shape="rect" id="node36" href="../../d1/d96/stasis__state_8h.html" title="Stasis State API. " alt="" coords="1135,80,1301,107"/>
<area shape="rect" id="node3" href="../../d9/d94/network_8h.html" title="Wrapper for network related headers, masking differences between various operating systems..." alt="" coords="633,304,771,331"/>
<area shape="rect" id="node13" href="../../de/df7/time_8h.html" title="Time&#45;related functions and macros. " alt="" coords="1943,528,2005,555"/>
<area shape="rect" id="node19" href="../../dd/d42/lock_8h.html" title="Asterisk locking&#45;related definitions: " alt="" coords="1045,453,1159,480"/>
<area shape="rect" id="node24" href="../../d1/d8c/logger_8h.html" title="Support for logging to various files, console and syslog Configuration in file logger.conf. " alt="" coords="1424,528,1551,555"/>
<area shape="rect" id="node27" href="../../d5/deb/localtime_8h.html" title="Custom localtime functions for multiple timezones. " alt="" coords="1867,304,2014,331"/>
<area shape="rect" id="node29" href="../../d1/d0f/stringfields_8h.html" title="asterisk/stringfields.h" alt="" coords="1686,304,1843,331"/>
<area shape="rect" id="node31" href="../../d6/d90/strings_8h.html" title="String manipulation functions. " alt="" coords="1235,304,1366,331"/>
<area shape="rect" id="node14" href="../../d8/d20/autoconfig_8h.html" title="asterisk/autoconfig.h" alt="" coords="1894,603,2049,629"/>
<area shape="rect" id="node17" href="../../d5/d9d/inline__api_8h.html" title="Inlinable API function macro. " alt="" coords="1566,603,1713,629"/>
<area shape="rect" id="node23" href="../../d3/dda/backtrace_8h.html" title="Asterisk backtrace generation. " alt="" coords="1249,528,1400,555"/>
<area shape="rect" id="node25" href="../../d4/dd1/compiler_8h.html" title="Compiler&#45;specific macros and other items. " alt="" coords="645,528,788,555"/>
<area shape="rect" id="node30" href="../../d6/d68/vector_8h.html" title="Vector container support. " alt="" coords="1740,379,1867,405"/>
<area shape="rect" id="node34" href="../../dc/d7d/threadstorage_8h.html" title="Definitions to aid in the use of thread local storage. " alt="" coords="1537,379,1715,405"/>
<area shape="rect" id="node35" href="../../d5/da5/astobj2_8h.html" title="asterisk/astobj2.h" alt="" coords="1327,379,1461,405"/>
<area shape="rect" id="node37" href="../../dd/d79/stasis_8h.html" title="Stasis Message Bus API. See Stasis Message Bus API for detailed documentation. " alt="" coords="1038,155,1163,181"/>
<area shape="rect" id="node38" href="../../d4/d05/json_8h.html" title="Asterisk JSON abstraction layer. " alt="" coords="1043,229,1158,256"/>
<area shape="rect" id="node39" href="../../db/d45/manager_8h.html" title="The AMI &#45; Asterisk Manager Interface &#45; is a TCP protocol created to manage Asterisk with third&#45;party ..." alt="" coords="659,229,804,256"/>
<area shape="rect" id="node40" href="../../dd/d20/event_8h.html" title="asterisk/event.h" alt="" coords="511,229,635,256"/>
</map>
</div>
</div><div class="textblock"><div class="dynheader">
This graph shows which files directly or indirectly include this file:</div>
<div class="dyncontent">
<div class="center"><img src="../../d6/d20/mwi_8h__dep__incl.png" border="0" usemap="#mwi_8hdep" alt=""/></div>
<map name="mwi_8hdep" id="mwi_8hdep">
<area shape="rect" id="node2" href="../../de/dfe/app__minivm_8c.html" title="MiniVoiceMail &#45; A Minimal Voicemail System for Asterisk. " alt="" coords="5,80,116,107"/>
<area shape="rect" id="node3" href="../../dc/df4/app__voicemail_8c.html" title="Comedian Mail &#45; Voicemail System. " alt="" coords="140,80,264,107"/>
<area shape="rect" id="node4" href="../../d1/d97/chan__dahdi_8c.html" title="DAHDI for Pseudo TDM. " alt="" coords="249,155,355,181"/>
<area shape="rect" id="node5" href="../../d5/db3/chan__dahdi_8h.html" title="DAHDI internal API definitions. " alt="" coords="339,80,446,107"/>
<area shape="rect" id="node7" href="../../d5/dff/chan__iax2_8c.html" title="Implementation of Inter&#45;Asterisk eXchange Version 2 as specified in RFC 5456. " alt="" coords="471,80,568,107"/>
<area shape="rect" id="node8" href="../../d0/dd6/chan__mgcp_8c.html" title="Implementation of Media Gateway Control Protocol. " alt="" coords="593,80,699,107"/>
<area shape="rect" id="node9" href="../../d5/dfe/chan__sip_8c.html" title="Implementation of Session Initiation Protocol. " alt="" coords="724,80,813,107"/>
<area shape="rect" id="node10" href="../../d0/d80/chan__skinny_8c.html" title="Implementation of the Skinny protocol. " alt="" coords="838,80,947,107"/>
<area shape="rect" id="node11" href="../../d1/d6d/chan__unistim_8c.html" title="chan_unistim channel driver for Asterisk " alt="" coords="972,80,1091,107"/>
<area shape="rect" id="node12" href="../../d5/d03/asterisk_8c.html" title="Top level source file for Asterisk &#45; the Open Source PBX. Implementation of PBX core functions and CL..." alt="" coords="1114,80,1197,107"/>
<area shape="rect" id="node13" href="../../d4/d10/manager_8c.html" title="The Asterisk Management Interface &#45; AMI. " alt="" coords="1221,80,1311,107"/>
<area shape="rect" id="node14" href="../../d4/d00/manager__mwi_8c.html" title="The Asterisk Management Interface &#45; AMI (MWI event handling) " alt="" coords="1335,80,1458,107"/>
<area shape="rect" id="node15" href="../../d6/db4/mwi_8c.html" title="mwi.c" alt="" coords="1482,80,1541,107"/>
<area shape="rect" id="node16" href="../../d1/da4/res__corosync_8c.html" title="res_corosync.c" alt="" coords="1565,80,1682,107"/>
<area shape="rect" id="node17" href="../../d2/dd0/res__mwi__devstate_8c.html" title="res_mwi_devstate.c" alt="" coords="1705,80,1853,107"/>
<area shape="rect" id="node18" href="../../d2/d94/res__mwi__external_8c.html" title="Core external MWI support. " alt="" coords="1878,80,2022,107"/>
<area shape="rect" id="node19" href="../../d8/d25/res__pjsip__mwi_8c.html" title="res_pjsip_mwi.c" alt="" coords="2047,80,2168,107"/>
<area shape="rect" id="node20" href="../../dc/d7a/res__pjsip__publish__asterisk_8c.html" title="res_pjsip_publish_asterisk.c" alt="" coords="2192,80,2391,107"/>
<area shape="rect" id="node21" href="../../d8/dca/res__pjsip__pubsub_8c.html" title="res_pjsip_pubsub.c" alt="" coords="2415,80,2557,107"/>
<area shape="rect" id="node22" href="../../d8/d96/res__smdi_8c.html" title="SMDI support for Asterisk. " alt="" coords="2582,80,2673,107"/>
<area shape="rect" id="node23" href="../../dc/d6b/res__xmpp_8c.html" title="XMPP client and component module. " alt="" coords="2697,80,2793,107"/>
<area shape="rect" id="node24" href="../../dd/de5/test__mwi_8c.html" title="test_mwi.c" alt="" coords="2817,80,2907,107"/>
<area shape="rect" id="node6" href="../../d9/da5/bridge__native__dahdi_8c.html" title="Native DAHDI bridging support. " alt="" coords="380,155,541,181"/>
</map>
</div>
</div>
<p><a href="../../dc/d33/mwi_8h_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="nested-classes"></a>
Data Structures</h2></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/dce/structast__mwi__blob.html">ast_mwi_blob</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">Object that represents an MWI update with some additional application defined data.  <a href="../../dd/dce/structast__mwi__blob.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/dbb/structast__mwi__observer.html">ast_mwi_observer</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">MWI state event interface.  <a href="../../d1/dbb/structast__mwi__observer.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d6/d45/structast__mwi__state.html">ast_mwi_state</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">The structure that contains MWI state.  <a href="../../d6/d45/structast__mwi__state.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="define-members"></a>
Macros</h2></td></tr>
<tr class="memitem:ac552a206e0fc8eb86b4bf8d2d4427aec"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dc/d33/mwi_8h.html#ac552a206e0fc8eb86b4bf8d2d4427aec">ast_delete_mwi_state</a>(<a class="el" href="../../d0/dd6/chan__mgcp_8c.html#a6b49cafa2a3d359a2e865992f551874a">mailbox</a>,  <a class="el" href="../../da/dde/chan__phone_8c.html#a579ca8125bbf48d9ce8691d522f99933">context</a>)&#160;&#160;&#160;<a class="el" href="../../d6/db4/mwi_8c.html#ab6397dc158885461fdc0a21138dda6f9">ast_delete_mwi_state_full</a>(<a class="el" href="../../d0/dd6/chan__mgcp_8c.html#a6b49cafa2a3d359a2e865992f551874a">mailbox</a>, <a class="el" href="../../da/dde/chan__phone_8c.html#a579ca8125bbf48d9ce8691d522f99933">context</a>, <a class="el" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)</td></tr>
<tr class="memdesc:ac552a206e0fc8eb86b4bf8d2d4427aec"><td class="mdescLeft">&#160;</td><td class="mdescRight">Delete MWI state cached by stasis.  <a href="#ac552a206e0fc8eb86b4bf8d2d4427aec">More...</a><br /></td></tr>
<tr class="separator:ac552a206e0fc8eb86b4bf8d2d4427aec"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gad739ea26c060ff7a2195107b53f9715c"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../df/deb/group__StasisTopicsAndMessages.html#gad739ea26c060ff7a2195107b53f9715c">AST_MAX_MAILBOX_UNIQUEID</a>&#160;&#160;&#160;(<a class="el" href="../../d4/dc5/extconf_8c.html#af4e59494f74ad9e0c50170d9e276ad31">AST_MAX_EXTENSION</a> + <a class="el" href="../../d5/d7b/channel_8h.html#abcf1aea85b924e9cd605040b86241e2a">AST_MAX_CONTEXT</a> + 2)</td></tr>
<tr class="separator:gad739ea26c060ff7a2195107b53f9715c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae7328cd8d8b2120de46b1d2afac99f18"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dc/d33/mwi_8h.html#ae7328cd8d8b2120de46b1d2afac99f18">ast_publish_mwi_state</a>(<a class="el" href="../../d0/dd6/chan__mgcp_8c.html#a6b49cafa2a3d359a2e865992f551874a">mailbox</a>,  <a class="el" href="../../da/dde/chan__phone_8c.html#a579ca8125bbf48d9ce8691d522f99933">context</a>,  new_msgs,  old_msgs)&#160;&#160;&#160;<a class="el" href="../../d6/db4/mwi_8c.html#a889083170a9d78ccdbfbcb75406ed98d">ast_publish_mwi_state_full</a>(<a class="el" href="../../d0/dd6/chan__mgcp_8c.html#a6b49cafa2a3d359a2e865992f551874a">mailbox</a>, <a class="el" href="../../da/dde/chan__phone_8c.html#a579ca8125bbf48d9ce8691d522f99933">context</a>, new_msgs, old_msgs, <a class="el" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="el" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)</td></tr>
<tr class="memdesc:ae7328cd8d8b2120de46b1d2afac99f18"><td class="mdescLeft">&#160;</td><td class="mdescRight">Publish a MWI state update via stasis.  <a href="#ae7328cd8d8b2120de46b1d2afac99f18">More...</a><br /></td></tr>
<tr class="separator:ae7328cd8d8b2120de46b1d2afac99f18"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3cbb94b9d65cd0a9beb2276292946a61"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dc/d33/mwi_8h.html#a3cbb94b9d65cd0a9beb2276292946a61">ast_publish_mwi_state_channel</a>(<a class="el" href="../../d0/dd6/chan__mgcp_8c.html#a6b49cafa2a3d359a2e865992f551874a">mailbox</a>,  <a class="el" href="../../da/dde/chan__phone_8c.html#a579ca8125bbf48d9ce8691d522f99933">context</a>,  new_msgs,  old_msgs,  channel_id)&#160;&#160;&#160;<a class="el" href="../../d6/db4/mwi_8c.html#a889083170a9d78ccdbfbcb75406ed98d">ast_publish_mwi_state_full</a>(<a class="el" href="../../d0/dd6/chan__mgcp_8c.html#a6b49cafa2a3d359a2e865992f551874a">mailbox</a>, <a class="el" href="../../da/dde/chan__phone_8c.html#a579ca8125bbf48d9ce8691d522f99933">context</a>, new_msgs, old_msgs, channel_id, <a class="el" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)</td></tr>
<tr class="memdesc:a3cbb94b9d65cd0a9beb2276292946a61"><td class="mdescLeft">&#160;</td><td class="mdescRight">Publish a MWI state update associated with some channel.  <a href="#a3cbb94b9d65cd0a9beb2276292946a61">More...</a><br /></td></tr>
<tr class="separator:a3cbb94b9d65cd0a9beb2276292946a61"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="typedef-members"></a>
Typedefs</h2></td></tr>
<tr class="memitem:a8a65dacf53b3d4cbbe3f5bdfa413f9fe"><td class="memItemLeft" align="right" valign="top">typedef int(*&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dc/d33/mwi_8h.html#a8a65dacf53b3d4cbbe3f5bdfa413f9fe">on_mwi_state</a>) (struct <a class="el" href="../../d6/d45/structast__mwi__state.html">ast_mwi_state</a> *mwi_state, void *data)</td></tr>
<tr class="memdesc:a8a65dacf53b3d4cbbe3f5bdfa413f9fe"><td class="mdescLeft">&#160;</td><td class="mdescRight">The delegate called for each managed mailbox state.  <a href="#a8a65dacf53b3d4cbbe3f5bdfa413f9fe">More...</a><br /></td></tr>
<tr class="separator:a8a65dacf53b3d4cbbe3f5bdfa413f9fe"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:ab6397dc158885461fdc0a21138dda6f9"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dc/d33/mwi_8h.html#ab6397dc158885461fdc0a21138dda6f9">ast_delete_mwi_state_full</a> (const char *<a class="el" href="../../d0/dd6/chan__mgcp_8c.html#a6b49cafa2a3d359a2e865992f551874a">mailbox</a>, const char *<a class="el" href="../../da/dde/chan__phone_8c.html#a579ca8125bbf48d9ce8691d522f99933">context</a>, struct <a class="el" href="../../d0/d86/structast__eid.html">ast_eid</a> *eid)</td></tr>
<tr class="memdesc:ab6397dc158885461fdc0a21138dda6f9"><td class="mdescLeft">&#160;</td><td class="mdescRight">Delete MWI state cached by stasis with all parameters.  <a href="#ab6397dc158885461fdc0a21138dda6f9">More...</a><br /></td></tr>
<tr class="separator:ab6397dc158885461fdc0a21138dda6f9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab2d839cf1f63bd9a19f5d6dff8484bcf"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dc/d33/mwi_8h.html#ab2d839cf1f63bd9a19f5d6dff8484bcf">ast_mwi_add_observer</a> (struct <a class="el" href="../../d1/dbb/structast__mwi__observer.html">ast_mwi_observer</a> *<a class="el" href="../../d6/d12/test__sorcery_8c.html#ac7df966a74e4dedc4011a0b8e50f4a42">observer</a>)</td></tr>
<tr class="memdesc:ab2d839cf1f63bd9a19f5d6dff8484bcf"><td class="mdescLeft">&#160;</td><td class="mdescRight">Add an observer to receive MWI state related events.  <a href="#ab2d839cf1f63bd9a19f5d6dff8484bcf">More...</a><br /></td></tr>
<tr class="separator:ab2d839cf1f63bd9a19f5d6dff8484bcf"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7ad873aa4dc1386af34a37a177f31af1"><td class="memItemLeft" align="right" valign="top">struct <a class="el" href="../../da/df3/structast__mwi__publisher.html">ast_mwi_publisher</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dc/d33/mwi_8h.html#a7ad873aa4dc1386af34a37a177f31af1">ast_mwi_add_publisher</a> (const char *<a class="el" href="../../d0/dd6/chan__mgcp_8c.html#a6b49cafa2a3d359a2e865992f551874a">mailbox</a>)</td></tr>
<tr class="memdesc:a7ad873aa4dc1386af34a37a177f31af1"><td class="mdescLeft">&#160;</td><td class="mdescRight">Add an MWI state publisher to the mailbox.  <a href="#a7ad873aa4dc1386af34a37a177f31af1">More...</a><br /></td></tr>
<tr class="separator:a7ad873aa4dc1386af34a37a177f31af1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:abf1568897d6642cdaa55e304b579512d"><td class="memItemLeft" align="right" valign="top">struct <a class="el" href="../../de/d41/structast__mwi__subscriber.html">ast_mwi_subscriber</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dc/d33/mwi_8h.html#abf1568897d6642cdaa55e304b579512d">ast_mwi_add_subscriber</a> (const char *<a class="el" href="../../d0/dd6/chan__mgcp_8c.html#a6b49cafa2a3d359a2e865992f551874a">mailbox</a>)</td></tr>
<tr class="memdesc:abf1568897d6642cdaa55e304b579512d"><td class="mdescLeft">&#160;</td><td class="mdescRight">Add an MWI state subscriber to the mailbox.  <a href="#abf1568897d6642cdaa55e304b579512d">More...</a><br /></td></tr>
<tr class="separator:abf1568897d6642cdaa55e304b579512d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga728789c28cb77fc6cbf3254aefc7c67a"><td class="memItemLeft" align="right" valign="top">struct <a class="el" href="../../d7/d55/structstasis__message.html">stasis_message</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../df/deb/group__StasisTopicsAndMessages.html#ga728789c28cb77fc6cbf3254aefc7c67a">ast_mwi_blob_create</a> (struct <a class="el" href="../../d6/d45/structast__mwi__state.html">ast_mwi_state</a> *mwi_state, struct <a class="el" href="../../d4/d8f/structstasis__message__type.html">stasis_message_type</a> *message_type, struct <a class="el" href="../../d1/da1/structast__json.html">ast_json</a> *blob)</td></tr>
<tr class="memdesc:ga728789c28cb77fc6cbf3254aefc7c67a"><td class="mdescLeft">&#160;</td><td class="mdescRight">Creates a <a class="el" href="../../dd/dce/structast__mwi__blob.html">ast_mwi_blob</a> message.  <a href="../../df/deb/group__StasisTopicsAndMessages.html#ga728789c28cb77fc6cbf3254aefc7c67a">More...</a><br /></td></tr>
<tr class="separator:ga728789c28cb77fc6cbf3254aefc7c67a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga2f9639be7fcd922d0609b4ba82fc79c8"><td class="memItemLeft" align="right" valign="top">struct <a class="el" href="../../d6/d45/structast__mwi__state.html">ast_mwi_state</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../df/deb/group__StasisTopicsAndMessages.html#ga2f9639be7fcd922d0609b4ba82fc79c8">ast_mwi_create</a> (const char *<a class="el" href="../../d0/dd6/chan__mgcp_8c.html#a6b49cafa2a3d359a2e865992f551874a">mailbox</a>, const char *<a class="el" href="../../da/dde/chan__phone_8c.html#a579ca8125bbf48d9ce8691d522f99933">context</a>)</td></tr>
<tr class="memdesc:ga2f9639be7fcd922d0609b4ba82fc79c8"><td class="mdescLeft">&#160;</td><td class="mdescRight">Create a <a class="el" href="../../d6/d45/structast__mwi__state.html">ast_mwi_state</a> object.  <a href="../../df/deb/group__StasisTopicsAndMessages.html#ga2f9639be7fcd922d0609b4ba82fc79c8">More...</a><br /></td></tr>
<tr class="separator:ga2f9639be7fcd922d0609b4ba82fc79c8"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac129563a9c5477eb5b2071257e5d5873"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dc/d33/mwi_8h.html#ac129563a9c5477eb5b2071257e5d5873">ast_mwi_publish</a> (struct <a class="el" href="../../da/df3/structast__mwi__publisher.html">ast_mwi_publisher</a> *publisher, int urgent_msgs, int new_msgs, int old_msgs, const char *channel_id, struct <a class="el" href="../../d0/d86/structast__eid.html">ast_eid</a> *eid)</td></tr>
<tr class="memdesc:ac129563a9c5477eb5b2071257e5d5873"><td class="mdescLeft">&#160;</td><td class="mdescRight">Publish MWI for the given mailbox.  <a href="#ac129563a9c5477eb5b2071257e5d5873">More...</a><br /></td></tr>
<tr class="separator:ac129563a9c5477eb5b2071257e5d5873"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:afc860a1db2f223052313491d47116302"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dc/d33/mwi_8h.html#afc860a1db2f223052313491d47116302">ast_mwi_publish_by_mailbox</a> (const char *<a class="el" href="../../d0/dd6/chan__mgcp_8c.html#a6b49cafa2a3d359a2e865992f551874a">mailbox</a>, const char *<a class="el" href="../../da/dde/chan__phone_8c.html#a579ca8125bbf48d9ce8691d522f99933">context</a>, int urgent_msgs, int new_msgs, int old_msgs, const char *channel_id, struct <a class="el" href="../../d0/d86/structast__eid.html">ast_eid</a> *eid)</td></tr>
<tr class="memdesc:afc860a1db2f223052313491d47116302"><td class="mdescLeft">&#160;</td><td class="mdescRight">Publish MWI for the given mailbox.  <a href="#afc860a1db2f223052313491d47116302">More...</a><br /></td></tr>
<tr class="separator:afc860a1db2f223052313491d47116302"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad200df5870ce5a601381c4e37f8a2197"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dc/d33/mwi_8h.html#ad200df5870ce5a601381c4e37f8a2197">ast_mwi_remove_observer</a> (struct <a class="el" href="../../d1/dbb/structast__mwi__observer.html">ast_mwi_observer</a> *<a class="el" href="../../d6/d12/test__sorcery_8c.html#ac7df966a74e4dedc4011a0b8e50f4a42">observer</a>)</td></tr>
<tr class="memdesc:ad200df5870ce5a601381c4e37f8a2197"><td class="mdescLeft">&#160;</td><td class="mdescRight">Remove an MWI state observer.  <a href="#ad200df5870ce5a601381c4e37f8a2197">More...</a><br /></td></tr>
<tr class="separator:ad200df5870ce5a601381c4e37f8a2197"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga7fc6473ab80d2117f1bcb1359721fdce"><td class="memItemLeft" align="right" valign="top">struct <a class="el" href="../../dd/d25/structstasis__cache.html">stasis_cache</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../df/deb/group__StasisTopicsAndMessages.html#ga7fc6473ab80d2117f1bcb1359721fdce">ast_mwi_state_cache</a> (void)</td></tr>
<tr class="memdesc:ga7fc6473ab80d2117f1bcb1359721fdce"><td class="mdescLeft">&#160;</td><td class="mdescRight">Backend cache for <a class="el" href="../../df/deb/group__StasisTopicsAndMessages.html#ga986e1047f0c61d683fb0773453363fd7" title="Get the Stasis Message Bus API caching topic for MWI messages. ">ast_mwi_topic_cached()</a>.  <a href="../../df/deb/group__StasisTopicsAndMessages.html#ga7fc6473ab80d2117f1bcb1359721fdce">More...</a><br /></td></tr>
<tr class="separator:ga7fc6473ab80d2117f1bcb1359721fdce"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa7789090f6f6177b5033d240bba65b93"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dc/d33/mwi_8h.html#aa7789090f6f6177b5033d240bba65b93">ast_mwi_state_callback_all</a> (<a class="el" href="../../dc/d33/mwi_8h.html#a8a65dacf53b3d4cbbe3f5bdfa413f9fe">on_mwi_state</a> <a class="el" href="../../da/d03/test__ari_8c.html#a695cc202c7a2869aa8202bb20726ea3c">handler</a>, void *data)</td></tr>
<tr class="memdesc:aa7789090f6f6177b5033d240bba65b93"><td class="mdescLeft">&#160;</td><td class="mdescRight">For each managed mailbox call the given handler.  <a href="#aa7789090f6f6177b5033d240bba65b93">More...</a><br /></td></tr>
<tr class="separator:aa7789090f6f6177b5033d240bba65b93"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa878bb71532040c72e88ffa2f107d7b4"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dc/d33/mwi_8h.html#aa878bb71532040c72e88ffa2f107d7b4">ast_mwi_state_callback_subscribed</a> (<a class="el" href="../../dc/d33/mwi_8h.html#a8a65dacf53b3d4cbbe3f5bdfa413f9fe">on_mwi_state</a> <a class="el" href="../../da/d03/test__ari_8c.html#a695cc202c7a2869aa8202bb20726ea3c">handler</a>, void *data)</td></tr>
<tr class="memdesc:aa878bb71532040c72e88ffa2f107d7b4"><td class="mdescLeft">&#160;</td><td class="mdescRight">For each managed mailbox that has a subscriber call the given handler.  <a href="#aa878bb71532040c72e88ffa2f107d7b4">More...</a><br /></td></tr>
<tr class="separator:aa878bb71532040c72e88ffa2f107d7b4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gaf226cf2d1a4dbbbf220521d58c05ac0f"><td class="memItemLeft" align="right" valign="top">struct <a class="el" href="../../d4/d8f/structstasis__message__type.html">stasis_message_type</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../df/deb/group__StasisTopicsAndMessages.html#gaf226cf2d1a4dbbbf220521d58c05ac0f">ast_mwi_state_type</a> (void)</td></tr>
<tr class="memdesc:gaf226cf2d1a4dbbbf220521d58c05ac0f"><td class="mdescLeft">&#160;</td><td class="mdescRight">Get the <a class="el" href="../../dd/dfd/stasis.html">Stasis Message Bus API</a> message type for MWI messages.  <a href="../../df/deb/group__StasisTopicsAndMessages.html#gaf226cf2d1a4dbbbf220521d58c05ac0f">More...</a><br /></td></tr>
<tr class="separator:gaf226cf2d1a4dbbbf220521d58c05ac0f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad83d6c9c09755c8b274a8f07fb2c64f7"><td class="memItemLeft" align="right" valign="top">struct <a class="el" href="../../de/d41/structast__mwi__subscriber.html">ast_mwi_subscriber</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dc/d33/mwi_8h.html#ad83d6c9c09755c8b274a8f07fb2c64f7">ast_mwi_subscribe_pool</a> (const char *<a class="el" href="../../d0/dd6/chan__mgcp_8c.html#a6b49cafa2a3d359a2e865992f551874a">mailbox</a>, <a class="el" href="../../dd/d79/stasis_8h.html#a2b7854b4fb538be6f885943a24d60c8f">stasis_subscription_cb</a> callback, void *data)</td></tr>
<tr class="memdesc:ad83d6c9c09755c8b274a8f07fb2c64f7"><td class="mdescLeft">&#160;</td><td class="mdescRight">Add an MWI state subscriber, and stasis subscription to the mailbox.  <a href="#ad83d6c9c09755c8b274a8f07fb2c64f7">More...</a><br /></td></tr>
<tr class="separator:ad83d6c9c09755c8b274a8f07fb2c64f7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae56e2e8831cc3919b5d92bad99786572"><td class="memItemLeft" align="right" valign="top">struct <a class="el" href="../../d6/d45/structast__mwi__state.html">ast_mwi_state</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dc/d33/mwi_8h.html#ae56e2e8831cc3919b5d92bad99786572">ast_mwi_subscriber_data</a> (struct <a class="el" href="../../de/d41/structast__mwi__subscriber.html">ast_mwi_subscriber</a> *<a class="el" href="../../d1/da4/res__corosync_8c.html#a8e51289dd0fc7415cee40e7a57b49fdf">sub</a>)</td></tr>
<tr class="memdesc:ae56e2e8831cc3919b5d92bad99786572"><td class="mdescLeft">&#160;</td><td class="mdescRight">Retrieves the state data object associated with the MWI subscriber.  <a href="#ae56e2e8831cc3919b5d92bad99786572">More...</a><br /></td></tr>
<tr class="separator:ae56e2e8831cc3919b5d92bad99786572"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4209f1d79f28e693bddcc0b918425c91"><td class="memItemLeft" align="right" valign="top">struct <a class="el" href="../../d9/de4/structstasis__subscription.html">stasis_subscription</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dc/d33/mwi_8h.html#a4209f1d79f28e693bddcc0b918425c91">ast_mwi_subscriber_subscription</a> (struct <a class="el" href="../../de/d41/structast__mwi__subscriber.html">ast_mwi_subscriber</a> *<a class="el" href="../../d1/da4/res__corosync_8c.html#a8e51289dd0fc7415cee40e7a57b49fdf">sub</a>)</td></tr>
<tr class="memdesc:a4209f1d79f28e693bddcc0b918425c91"><td class="mdescLeft">&#160;</td><td class="mdescRight">Retrieve the stasis MWI topic subscription if available.  <a href="#a4209f1d79f28e693bddcc0b918425c91">More...</a><br /></td></tr>
<tr class="separator:a4209f1d79f28e693bddcc0b918425c91"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6e6d83f3d424c985a15ff60cbdb0be32"><td class="memItemLeft" align="right" valign="top">struct <a class="el" href="../../d9/d1d/structstasis__topic.html">stasis_topic</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dc/d33/mwi_8h.html#a6e6d83f3d424c985a15ff60cbdb0be32">ast_mwi_subscriber_topic</a> (struct <a class="el" href="../../de/d41/structast__mwi__subscriber.html">ast_mwi_subscriber</a> *<a class="el" href="../../d1/da4/res__corosync_8c.html#a8e51289dd0fc7415cee40e7a57b49fdf">sub</a>)</td></tr>
<tr class="memdesc:a6e6d83f3d424c985a15ff60cbdb0be32"><td class="mdescLeft">&#160;</td><td class="mdescRight">Retrieves the MWI subscriber's topic.  <a href="#a6e6d83f3d424c985a15ff60cbdb0be32">More...</a><br /></td></tr>
<tr class="separator:a6e6d83f3d424c985a15ff60cbdb0be32"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gae43ba258ce7f2b5838edbed6bf7dbd8c"><td class="memItemLeft" align="right" valign="top">struct <a class="el" href="../../d9/d1d/structstasis__topic.html">stasis_topic</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../df/deb/group__StasisTopicsAndMessages.html#gae43ba258ce7f2b5838edbed6bf7dbd8c">ast_mwi_topic</a> (const char *uniqueid)</td></tr>
<tr class="memdesc:gae43ba258ce7f2b5838edbed6bf7dbd8c"><td class="mdescLeft">&#160;</td><td class="mdescRight">Get the <a class="el" href="../../dd/dfd/stasis.html">Stasis Message Bus API</a> topic for MWI messages on a unique ID.  <a href="../../df/deb/group__StasisTopicsAndMessages.html#gae43ba258ce7f2b5838edbed6bf7dbd8c">More...</a><br /></td></tr>
<tr class="separator:gae43ba258ce7f2b5838edbed6bf7dbd8c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga547ae87810e6cd121cea7b3149343366"><td class="memItemLeft" align="right" valign="top">struct <a class="el" href="../../d9/d1d/structstasis__topic.html">stasis_topic</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../df/deb/group__StasisTopicsAndMessages.html#ga547ae87810e6cd121cea7b3149343366">ast_mwi_topic_all</a> (void)</td></tr>
<tr class="memdesc:ga547ae87810e6cd121cea7b3149343366"><td class="mdescLeft">&#160;</td><td class="mdescRight">Get the <a class="el" href="../../dd/dfd/stasis.html">Stasis Message Bus API</a> topic for MWI messages.  <a href="../../df/deb/group__StasisTopicsAndMessages.html#ga547ae87810e6cd121cea7b3149343366">More...</a><br /></td></tr>
<tr class="separator:ga547ae87810e6cd121cea7b3149343366"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga986e1047f0c61d683fb0773453363fd7"><td class="memItemLeft" align="right" valign="top">struct <a class="el" href="../../d9/d1d/structstasis__topic.html">stasis_topic</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../df/deb/group__StasisTopicsAndMessages.html#ga986e1047f0c61d683fb0773453363fd7">ast_mwi_topic_cached</a> (void)</td></tr>
<tr class="memdesc:ga986e1047f0c61d683fb0773453363fd7"><td class="mdescLeft">&#160;</td><td class="mdescRight">Get the <a class="el" href="../../dd/dfd/stasis.html">Stasis Message Bus API</a> caching topic for MWI messages.  <a href="../../df/deb/group__StasisTopicsAndMessages.html#ga986e1047f0c61d683fb0773453363fd7">More...</a><br /></td></tr>
<tr class="separator:ga986e1047f0c61d683fb0773453363fd7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a82c6cbb5215eec5348715e4824f5f575"><td class="memItemLeft" align="right" valign="top">void *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dc/d33/mwi_8h.html#a82c6cbb5215eec5348715e4824f5f575">ast_mwi_unsubscribe</a> (struct <a class="el" href="../../de/d41/structast__mwi__subscriber.html">ast_mwi_subscriber</a> *<a class="el" href="../../d1/da4/res__corosync_8c.html#a8e51289dd0fc7415cee40e7a57b49fdf">sub</a>)</td></tr>
<tr class="memdesc:a82c6cbb5215eec5348715e4824f5f575"><td class="mdescLeft">&#160;</td><td class="mdescRight">Unsubscribe from the stasis topic and MWI.  <a href="#a82c6cbb5215eec5348715e4824f5f575">More...</a><br /></td></tr>
<tr class="separator:a82c6cbb5215eec5348715e4824f5f575"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:acf8d474c4029156d9c49a4ddea50d01b"><td class="memItemLeft" align="right" valign="top">void *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dc/d33/mwi_8h.html#acf8d474c4029156d9c49a4ddea50d01b">ast_mwi_unsubscribe_and_join</a> (struct <a class="el" href="../../de/d41/structast__mwi__subscriber.html">ast_mwi_subscriber</a> *<a class="el" href="../../d1/da4/res__corosync_8c.html#a8e51289dd0fc7415cee40e7a57b49fdf">sub</a>)</td></tr>
<tr class="memdesc:acf8d474c4029156d9c49a4ddea50d01b"><td class="mdescLeft">&#160;</td><td class="mdescRight">Unsubscribe from the stasis topic, block until the final message is received, and then unsubscribe from MWI.  <a href="#acf8d474c4029156d9c49a4ddea50d01b">More...</a><br /></td></tr>
<tr class="separator:acf8d474c4029156d9c49a4ddea50d01b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga03bf52a37253e9ecdc4fadf9747a3497"><td class="memItemLeft" align="right" valign="top">struct <a class="el" href="../../d4/d8f/structstasis__message__type.html">stasis_message_type</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../df/deb/group__StasisTopicsAndMessages.html#ga03bf52a37253e9ecdc4fadf9747a3497">ast_mwi_vm_app_type</a> (void)</td></tr>
<tr class="memdesc:ga03bf52a37253e9ecdc4fadf9747a3497"><td class="mdescLeft">&#160;</td><td class="mdescRight">Get the <a class="el" href="../../dd/dfd/stasis.html">Stasis Message Bus API</a> message type for voicemail application specific messages.  <a href="../../df/deb/group__StasisTopicsAndMessages.html#ga03bf52a37253e9ecdc4fadf9747a3497">More...</a><br /></td></tr>
<tr class="separator:ga03bf52a37253e9ecdc4fadf9747a3497"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a889083170a9d78ccdbfbcb75406ed98d"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dc/d33/mwi_8h.html#a889083170a9d78ccdbfbcb75406ed98d">ast_publish_mwi_state_full</a> (const char *<a class="el" href="../../d0/dd6/chan__mgcp_8c.html#a6b49cafa2a3d359a2e865992f551874a">mailbox</a>, const char *<a class="el" href="../../da/dde/chan__phone_8c.html#a579ca8125bbf48d9ce8691d522f99933">context</a>, int new_msgs, int old_msgs, const char *channel_id, struct <a class="el" href="../../d0/d86/structast__eid.html">ast_eid</a> *eid)</td></tr>
<tr class="memdesc:a889083170a9d78ccdbfbcb75406ed98d"><td class="mdescLeft">&#160;</td><td class="mdescRight">Publish a MWI state update via stasis with all parameters.  <a href="#a889083170a9d78ccdbfbcb75406ed98d">More...</a><br /></td></tr>
<tr class="separator:a889083170a9d78ccdbfbcb75406ed98d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga60caa723cc6cdb79618bc030ecfeba70"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../df/deb/group__StasisTopicsAndMessages.html#ga60caa723cc6cdb79618bc030ecfeba70">mwi_init</a> (void)</td></tr>
<tr class="memdesc:ga60caa723cc6cdb79618bc030ecfeba70"><td class="mdescLeft">&#160;</td><td class="mdescRight">Initialize the mwi core.  <a href="../../df/deb/group__StasisTopicsAndMessages.html#ga60caa723cc6cdb79618bc030ecfeba70">More...</a><br /></td></tr>
<tr class="separator:ga60caa723cc6cdb79618bc030ecfeba70"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Asterisk MWI API. </p>
<dl class="section user"><dt>Intro</dt><dd></dd></dl>
<p>This module manages, and processes all things MWI. Defined are mechanisms for subscribing and publishing to MWI topics. User modules wishing to receive MWI updates for a particular mailbox should do so by adding an MWI subscriber to that mailbox, followed by subscribing to the mailbox's topic. Likewise, user modules that want to publish MWI updates about a particular mailbox should first add a publisher for that mailbox prior to publishing.</p>
<p>MWI state is managed via an underlying <a class="el" href="../../d8/d25/structstasis__state__manager.html">stasis_state_manager</a> (if interested see the stasis_state.c module for the gory details). As such all last known mailbox state can be retrieve and iterated over by using the ast_mwi_callback function.</p>
<dl class="section user"><dt>ast_mwi_subscriber</dt><dd></dd></dl>
<p>Created via <a class="el" href="../../d6/db4/mwi_8c.html#abf1568897d6642cdaa55e304b579512d">ast_mwi_add_subscriber</a>, a subscriber subscribes to a given mailbox in order to receive updates about the given mailbox. Adding a subscriber will create the underlying topic, and associated state data if those do not already exist for it. The topic, and last known state data is guaranteed to exist for the lifetime of the subscriber. State data can be NULL if nothing has been published to the mailbox's topic yet.</p>
<p>NOTE, currently adding a subscriber here will either create, or add a reference to the underlying stasis state (and associated topic). However, it does not actually subscribe to the stasis topic itself. You still need to explicitly call <a class="el" href="../../dd/d79/stasis_8h.html#ae3fe7fe099389094244002113814ec23">stasis_subscribe</a>, or similar on the topic if you wish to receive published event updates.</p>
<p>So given that when subscribing to an MWI topic the following order should be adhered to:</p>
<ol type="1">
<li>Add an MWI state subscriber using <a class="el" href="../../d6/db4/mwi_8c.html#abf1568897d6642cdaa55e304b579512d">ast_mwi_add_subscriber</a></li>
<li>Retrieve the topic from the subscriber using <a class="el" href="../../d6/db4/mwi_8c.html#a6e6d83f3d424c985a15ff60cbdb0be32">ast_mwi_subscriber_topic</a></li>
<li>Subscribe to the topic itself using <a class="el" href="../../dd/d79/stasis_8h.html#ae3fe7fe099389094244002113814ec23">stasis_subscribe</a> or <a class="el" href="../../dd/d79/stasis_8h.html#a597f7a30fe616c9f083a93ed168955ed">stasis_subscribe_pool</a></li>
</ol>
<p>Or simply call <a class="el" href="../../d6/db4/mwi_8c.html#ad83d6c9c09755c8b274a8f07fb2c64f7">ast_mwi_subscribe_pool</a>, which combines those steps into a single call and returns the subscriber that is now subscribed to both the stasis topic and state.</p>
<p>Similarly, releasing the subscriber's reference removes a reference to the underlying state, but does not unsubscribe from the MWI topic. This should be done separately and prior to removing the subscriber's state reference:</p>
<ol type="1">
<li>Unsubscribe from the stasis topic subscription using <a class="el" href="../../d0/df4/stasis_8c.html#ab9864d12ae0d2cca19740b90ee3109e9">stasis_unsubscribe</a> or <a class="el" href="../../d0/df4/stasis_8c.html#a221d05010106dcde0cc2e2b43c1a8b67">stasis_unsubscribe_and_join</a></li>
<li>Remove the MWI subscriber reference</li>
</ol>
<p>Or call <a class="el" href="../../d6/db4/mwi_8c.html#a82c6cbb5215eec5348715e4824f5f575">ast_mwi_unsubscribe</a> (or _and_join), which combines those two steps into a single call.</p>
<dl class="section user"><dt>ast_mwi_publisher</dt><dd></dd></dl>
<p>Before publishing to a particular topic a publisher should be created. This can be achieved by using <a class="el" href="../../d6/db4/mwi_8c.html#a7ad873aa4dc1386af34a37a177f31af1">ast_mwi_add_publisher</a>. Publishing to a mailbox should then be done using the <a class="el" href="../../d6/db4/mwi_8c.html#a90b1ed28257b37b1c065616997a7753e">ast_mwi_publish</a> function. This ensures the message is published to the appropriate topic, and the last known state is maintained.</p>
<p>Publishing by mailbox id alone is also allowed. However, it is not recommended to do so, and exists mainly for backwards compatibility, and legacy subsystems. If, and when this method of publishing is employed a call to one of the <a class="el" href="../../dc/d33/mwi_8h.html#ac552a206e0fc8eb86b4bf8d2d4427aec">ast_delete_mwi_state</a> functions should also be called for a given mailbox id after no more publishing will be done for that id. Otherwise a memory leak on the underlying <a class="el" href="../../d6/d75/structstasis__state.html">stasis_state</a> object will occur.</p>
<dl class="section user"><dt>ast_mwi_observer</dt><dd></dd></dl>
<p>Add an observer in order to watch for particular MWI module related events. For instance if a submodule needs to know when a subscription is added to any mailbox an observer can be added to watch for that. </p>

<p class="definition">Definition in file <a class="el" href="../../dc/d33/mwi_8h_source.html">mwi.h</a>.</p>
</div><h2 class="groupheader">Macro Definition Documentation</h2>
<a id="ac552a206e0fc8eb86b4bf8d2d4427aec"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac552a206e0fc8eb86b4bf8d2d4427aec">&#9670;&nbsp;</a></span>ast_delete_mwi_state</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define ast_delete_mwi_state</td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><a class="el" href="../../d0/dd6/chan__mgcp_8c.html#a6b49cafa2a3d359a2e865992f551874a">mailbox</a>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><a class="el" href="../../da/dde/chan__phone_8c.html#a579ca8125bbf48d9ce8691d522f99933">context</a>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td>&#160;&#160;&#160;<a class="el" href="../../d6/db4/mwi_8c.html#ab6397dc158885461fdc0a21138dda6f9">ast_delete_mwi_state_full</a>(<a class="el" href="../../d0/dd6/chan__mgcp_8c.html#a6b49cafa2a3d359a2e865992f551874a">mailbox</a>, <a class="el" href="../../da/dde/chan__phone_8c.html#a579ca8125bbf48d9ce8691d522f99933">context</a>, <a class="el" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Delete MWI state cached by stasis. </p>
<dl class="section since"><dt>Since</dt><dd>12.2.0 </dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">mailbox</td><td>The mailbox identifier string. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">context</td><td>The context this mailbox resides in (NULL or "" if only using mailbox)</td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">0</td><td>Success </td></tr>
    <tr><td class="paramname">-1</td><td>Failure </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="../../dc/d33/mwi_8h_source.html#l00433">433</a> of file <a class="el" href="../../dc/d33/mwi_8h_source.html">mwi.h</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../d2/d94/res__mwi__external_8c_source.html#l00110">mwi_observe_delete()</a>, and <a class="el" href="../../dd/de5/test__mwi_8c_source.html#l00188">publishers_destroy()</a>.</p>

</div>
</div>
<a id="ae7328cd8d8b2120de46b1d2afac99f18"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae7328cd8d8b2120de46b1d2afac99f18">&#9670;&nbsp;</a></span>ast_publish_mwi_state</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define ast_publish_mwi_state</td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><a class="el" href="../../d0/dd6/chan__mgcp_8c.html#a6b49cafa2a3d359a2e865992f551874a">mailbox</a>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><a class="el" href="../../da/dde/chan__phone_8c.html#a579ca8125bbf48d9ce8691d522f99933">context</a>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">new_msgs, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">old_msgs&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td>&#160;&#160;&#160;<a class="el" href="../../d6/db4/mwi_8c.html#a889083170a9d78ccdbfbcb75406ed98d">ast_publish_mwi_state_full</a>(<a class="el" href="../../d0/dd6/chan__mgcp_8c.html#a6b49cafa2a3d359a2e865992f551874a">mailbox</a>, <a class="el" href="../../da/dde/chan__phone_8c.html#a579ca8125bbf48d9ce8691d522f99933">context</a>, new_msgs, old_msgs, <a class="el" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="el" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Publish a MWI state update via stasis. </p>
<dl class="section since"><dt>Since</dt><dd>12 </dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">mailbox</td><td>The mailbox identifier string. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">context</td><td>The context this mailbox resides in (NULL or "" if only using mailbox) </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">new_msgs</td><td>The number of new messages in this mailbox </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">old_msgs</td><td>The number of old messages in this mailbox</td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">0</td><td>Success </td></tr>
    <tr><td class="paramname">-1</td><td>Failure </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="../../dc/d33/mwi_8h_source.html#l00380">380</a> of file <a class="el" href="../../dc/d33/mwi_8h_source.html">mwi.h</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../d5/dfe/chan__sip_8c_source.html#l25732">handle_request_notify()</a>, <a class="el" href="../../d2/d94/res__mwi__external_8c_source.html#l00110">mwi_observe_delete()</a>, <a class="el" href="../../d2/d94/res__mwi__external_8c_source.html#l00092">mwi_post_event()</a>, <a class="el" href="../../d1/d97/chan__dahdi_8c_source.html#l03292">notify_message()</a>, and <a class="el" href="../../d8/dca/res__pjsip__pubsub_8c_source.html#l03614">pubsub_on_rx_mwi_notify_request()</a>.</p>

</div>
</div>
<a id="a3cbb94b9d65cd0a9beb2276292946a61"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3cbb94b9d65cd0a9beb2276292946a61">&#9670;&nbsp;</a></span>ast_publish_mwi_state_channel</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define ast_publish_mwi_state_channel</td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><a class="el" href="../../d0/dd6/chan__mgcp_8c.html#a6b49cafa2a3d359a2e865992f551874a">mailbox</a>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><a class="el" href="../../da/dde/chan__phone_8c.html#a579ca8125bbf48d9ce8691d522f99933">context</a>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">new_msgs, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">old_msgs, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">channel_id&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td>&#160;&#160;&#160;<a class="el" href="../../d6/db4/mwi_8c.html#a889083170a9d78ccdbfbcb75406ed98d">ast_publish_mwi_state_full</a>(<a class="el" href="../../d0/dd6/chan__mgcp_8c.html#a6b49cafa2a3d359a2e865992f551874a">mailbox</a>, <a class="el" href="../../da/dde/chan__phone_8c.html#a579ca8125bbf48d9ce8691d522f99933">context</a>, new_msgs, old_msgs, channel_id, <a class="el" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Publish a MWI state update associated with some channel. </p>
<dl class="section since"><dt>Since</dt><dd>12 </dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">mailbox</td><td>The mailbox identifier string. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">context</td><td>The context this mailbox resides in (NULL or "" if only using mailbox) </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">new_msgs</td><td>The number of new messages in this mailbox </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">old_msgs</td><td>The number of old messages in this mailbox </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">channel_id</td><td>A unique identifier for a channel associated with this change in mailbox state</td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">0</td><td>Success </td></tr>
    <tr><td class="paramname">-1</td><td>Failure </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="../../dc/d33/mwi_8h_source.html#l00397">397</a> of file <a class="el" href="../../dc/d33/mwi_8h_source.html">mwi.h</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../de/dfe/app__minivm_8c_source.html#l02084">queue_mwi_event()</a>.</p>

</div>
</div>
<h2 class="groupheader">Typedef Documentation</h2>
<a id="a8a65dacf53b3d4cbbe3f5bdfa413f9fe"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8a65dacf53b3d4cbbe3f5bdfa413f9fe">&#9670;&nbsp;</a></span>on_mwi_state</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef int(* on_mwi_state) (struct <a class="el" href="../../d6/d45/structast__mwi__state.html">ast_mwi_state</a> *mwi_state, void *data)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>The delegate called for each managed mailbox state. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">mwi_state</td><td>The mwi state object </td></tr>
    <tr><td class="paramname">data</td><td>User data passed in by the initiator</td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">0</td><td>to continue traversing, or CMP_STOP (2) to stop traversing</td></tr>
  </table>
  </dd>
</dl>
<dl class="section since"><dt>Since</dt><dd>13.28.0 </dd>
<dd>
16.5.0 </dd></dl>

<p class="definition">Definition at line <a class="el" href="../../dc/d33/mwi_8h_source.html#l00303">303</a> of file <a class="el" href="../../dc/d33/mwi_8h_source.html">mwi.h</a>.</p>

</div>
</div>
<h2 class="groupheader">Function Documentation</h2>
<a id="ab6397dc158885461fdc0a21138dda6f9"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab6397dc158885461fdc0a21138dda6f9">&#9670;&nbsp;</a></span>ast_delete_mwi_state_full()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ast_delete_mwi_state_full </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>mailbox</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>context</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="../../d0/d86/structast__eid.html">ast_eid</a> *&#160;</td>
          <td class="paramname"><em>eid</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Delete MWI state cached by stasis with all parameters. </p>
<dl class="section since"><dt>Since</dt><dd>12.2.0 </dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">mailbox</td><td>The mailbox identifier string. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">context</td><td>The context this mailbox resides in (NULL or "" if only using mailbox) </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">eid</td><td>The EID of the server that originally published the message</td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">0</td><td>Success </td></tr>
    <tr><td class="paramname">-1</td><td>Failure </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="../../d6/db4/mwi_8c_source.html#l00399">399</a> of file <a class="el" href="../../d6/db4/mwi_8c_source.html">mwi.c</a>.</p>

<p class="reference">References <a class="el" href="../../d5/da5/astobj2_8h_source.html#l01958">ao2_cleanup</a>, <a class="el" href="../../de/dc5/options_8c_source.html#l00093">ast_eid_default</a>, <a class="el" href="../../d6/db4/mwi_8c_source.html#l00090">ast_mwi_state_cache()</a>, <a class="el" href="../../df/deb/group__StasisTopicsAndMessages.html#gaf226cf2d1a4dbbbf220521d58c05ac0f">ast_mwi_state_type()</a>, <a class="el" href="../../d6/db4/mwi_8c_source.html#l00169">mwi_state_create_message()</a>, <a class="el" href="../../dc/d7f/resample_8c_source.html#l00096">NULL</a>, <a class="el" href="../../d5/d60/utils_8h_source.html#l00911">RAII_VAR</a>, <a class="el" href="../../d0/da9/stasis__cache_8c_source.html#l00778">stasis_cache_clear_create()</a>, <a class="el" href="../../d0/da9/stasis__cache_8c_source.html#l00659">stasis_cache_get_by_eid()</a>, <a class="el" href="../../d2/db9/stasis__message_8c_source.html#l00195">stasis_message_data()</a>, <a class="el" href="../../dc/d1d/stasis__state_8c_source.html#l00658">stasis_state_remove_publish_by_id()</a>, and <a class="el" href="../../dc/d33/mwi_8h_source.html#l00460">ast_mwi_state::uniqueid</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../dc/df4/app__voicemail_8c_source.html#l02008">free_user_final()</a>, and <a class="el" href="../../dc/df4/app__voicemail_8c_source.html#l13144">mwi_handle_unsubscribe2()</a>.</p>
<div class="fragment"><div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;{</div><div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;   <a class="code" href="../../d5/d60/utils_8h.html#a1604b4d72144dd3d9f7da668e90337e9">RAII_VAR</a>(<span class="keyword">struct</span> <a class="code" href="../../d7/d55/structstasis__message.html">stasis_message</a> *, msg, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../d5/da5/astobj2_8h.html#a6321ee982370c55ab3c24c72c562cbdd">ao2_cleanup</a>);</div><div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d7/d55/structstasis__message.html">stasis_message</a> *cached_msg;</div><div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d7/d55/structstasis__message.html">stasis_message</a> *clear_msg;</div><div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d6/d45/structast__mwi__state.html">ast_mwi_state</a> *mwi_state;</div><div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;</div><div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;   msg = <a class="code" href="../../d6/db4/mwi_8c.html#afa50d915beae3259db5d1bd31b174c81">mwi_state_create_message</a>(<a class="code" href="../../d0/dd6/chan__mgcp_8c.html#a6b49cafa2a3d359a2e865992f551874a">mailbox</a>, <a class="code" href="../../da/d45/chan__alsa_8c.html#ac25ea00ee3f082df06e0cf468cbde240">context</a>, 0, 0, 0, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, eid);</div><div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;   <span class="keywordflow">if</span> (!msg) {</div><div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;   }</div><div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;</div><div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;   mwi_state = <a class="code" href="../../dd/d79/stasis_8h.html#af6081f17431b81bc1a010b680517491d">stasis_message_data</a>(msg);</div><div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;</div><div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;   <span class="comment">/*</span></div><div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;<span class="comment">    * XXX As far as stasis is concerned, all MWI events are local.</span></div><div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;<span class="comment">    *</span></div><div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;<span class="comment">    * For now, it is assumed that there is only one entity</span></div><div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;<span class="comment">    * maintaining the state of a particular mailbox.</span></div><div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;<span class="comment">    *</span></div><div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;<span class="comment">    * If we ever have multiple MWI event entities maintaining</span></div><div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;<span class="comment">    * the same mailbox that wish to delete their cached entry</span></div><div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;<span class="comment">    * we will need to do something about the race condition</span></div><div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;<span class="comment">    * potential between checking the cache and removing the</span></div><div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;<span class="comment">    * cache entry.</span></div><div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;<span class="comment">    */</span></div><div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;   cached_msg = <a class="code" href="../../dd/d79/stasis_8h.html#a1d22721748b1bfd63ab13d92f19dfd02">stasis_cache_get_by_eid</a>(<a class="code" href="../../df/deb/group__StasisTopicsAndMessages.html#ga7fc6473ab80d2117f1bcb1359721fdce">ast_mwi_state_cache</a>(),</div><div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;      <a class="code" href="../../df/deb/group__StasisTopicsAndMessages.html#gaf226cf2d1a4dbbbf220521d58c05ac0f">ast_mwi_state_type</a>(), mwi_state-&gt;<a class="code" href="../../df/deb/group__StasisTopicsAndMessages.html#ga753c7b39e3284d771f13f513b003d033">uniqueid</a>, &amp;<a class="code" href="../../d5/d60/utils_8h.html#ad5db11fa27352e2b9a3c669adc76955f">ast_eid_default</a>);</div><div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;   <span class="keywordflow">if</span> (!cached_msg) {</div><div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;      <span class="comment">/* Nothing to clear from the cache, but still need to remove state */</span></div><div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;      <a class="code" href="../../d1/d96/stasis__state_8h.html#acd6a2d9bb8e46b049966355cda567a37">stasis_state_remove_publish_by_id</a>(<a class="code" href="../../d6/db4/mwi_8c.html#a527bd68e0bbd91f85683a01f37ca9e31">mwi_state_manager</a>, mwi_state-&gt;<a class="code" href="../../df/deb/group__StasisTopicsAndMessages.html#ga753c7b39e3284d771f13f513b003d033">uniqueid</a>, eid, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div><div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;   }</div><div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#a6321ee982370c55ab3c24c72c562cbdd">ao2_cleanup</a>(cached_msg);</div><div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;</div><div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;   clear_msg = <a class="code" href="../../dd/d79/stasis_8h.html#a169e12055004ecf0ecc355b3e3e1f218">stasis_cache_clear_create</a>(msg);</div><div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;   <a class="code" href="../../d1/d96/stasis__state_8h.html#acd6a2d9bb8e46b049966355cda567a37">stasis_state_remove_publish_by_id</a>(<a class="code" href="../../d6/db4/mwi_8c.html#a527bd68e0bbd91f85683a01f37ca9e31">mwi_state_manager</a>, mwi_state-&gt;<a class="code" href="../../df/deb/group__StasisTopicsAndMessages.html#ga753c7b39e3284d771f13f513b003d033">uniqueid</a>, eid, clear_msg);</div><div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#a6321ee982370c55ab3c24c72c562cbdd">ao2_cleanup</a>(clear_msg);</div><div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;</div><div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;   <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;}</div><div class="ttc" id="stasis__state_8h_html_acd6a2d9bb8e46b049966355cda567a37"><div class="ttname"><a href="../../d1/d96/stasis__state_8h.html#acd6a2d9bb8e46b049966355cda567a37">stasis_state_remove_publish_by_id</a></div><div class="ttdeci">void stasis_state_remove_publish_by_id(struct stasis_state_manager *manager, const char *id, const struct ast_eid *eid, struct stasis_message *msg)</div><div class="ttdoc">Publish to a managed named by id topic, and remove an implicit publisher. </div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d1d/stasis__state_8c_source.html#l00658">stasis_state.c:658</a></div></div>
<div class="ttc" id="group__StasisTopicsAndMessages_html_ga7fc6473ab80d2117f1bcb1359721fdce"><div class="ttname"><a href="../../df/deb/group__StasisTopicsAndMessages.html#ga7fc6473ab80d2117f1bcb1359721fdce">ast_mwi_state_cache</a></div><div class="ttdeci">struct stasis_cache * ast_mwi_state_cache(void)</div><div class="ttdoc">Backend cache for ast_mwi_topic_cached(). </div><div class="ttdef"><b>Definition:</b> <a href="../../d6/db4/mwi_8c_source.html#l00090">mwi.c:90</a></div></div>
<div class="ttc" id="structstasis__message_html"><div class="ttname"><a href="../../d7/d55/structstasis__message.html">stasis_message</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d2/db9/stasis__message_8c_source.html#l00121">stasis_message.c:121</a></div></div>
<div class="ttc" id="stasis_8h_html_a169e12055004ecf0ecc355b3e3e1f218"><div class="ttname"><a href="../../dd/d79/stasis_8h.html#a169e12055004ecf0ecc355b3e3e1f218">stasis_cache_clear_create</a></div><div class="ttdeci">struct stasis_message * stasis_cache_clear_create(struct stasis_message *message)</div><div class="ttdoc">A message which instructs the caching topic to remove an entry from its cache. </div><div class="ttdef"><b>Definition:</b> <a href="../../d0/da9/stasis__cache_8c_source.html#l00778">stasis_cache.c:778</a></div></div>
<div class="ttc" id="stasis_8h_html_a1d22721748b1bfd63ab13d92f19dfd02"><div class="ttname"><a href="../../dd/d79/stasis_8h.html#a1d22721748b1bfd63ab13d92f19dfd02">stasis_cache_get_by_eid</a></div><div class="ttdeci">struct stasis_message * stasis_cache_get_by_eid(struct stasis_cache *cache, struct stasis_message_type *type, const char *id, const struct ast_eid *eid)</div><div class="ttdoc">Retrieve an item from the cache for a specific entity. </div><div class="ttdef"><b>Definition:</b> <a href="../../d0/da9/stasis__cache_8c_source.html#l00659">stasis_cache.c:659</a></div></div>
<div class="ttc" id="resample_8c_html_a070d2ce7b6bb7e5c05602aa8c308d0c4"><div class="ttname"><a href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a></div><div class="ttdeci">#define NULL</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d7f/resample_8c_source.html#l00096">resample.c:96</a></div></div>
<div class="ttc" id="mwi_8c_html_a527bd68e0bbd91f85683a01f37ca9e31"><div class="ttname"><a href="../../d6/db4/mwi_8c.html#a527bd68e0bbd91f85683a01f37ca9e31">mwi_state_manager</a></div><div class="ttdeci">static struct stasis_state_manager * mwi_state_manager</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/db4/mwi_8c_source.html#l00032">mwi.c:32</a></div></div>
<div class="ttc" id="chan__mgcp_8c_html_a6b49cafa2a3d359a2e865992f551874a"><div class="ttname"><a href="../../d0/dd6/chan__mgcp_8c.html#a6b49cafa2a3d359a2e865992f551874a">mailbox</a></div><div class="ttdeci">static char mailbox[AST_MAX_MAILBOX_UNIQUEID]</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/dd6/chan__mgcp_8c_source.html#l00204">chan_mgcp.c:204</a></div></div>
<div class="ttc" id="utils_8h_html_a1604b4d72144dd3d9f7da668e90337e9"><div class="ttname"><a href="../../d5/d60/utils_8h.html#a1604b4d72144dd3d9f7da668e90337e9">RAII_VAR</a></div><div class="ttdeci">#define RAII_VAR(vartype, varname, initval, dtor)</div><div class="ttdoc">Declare a variable that will call a destructor function when it goes out of scope. </div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d60/utils_8h_source.html#l00911">utils.h:911</a></div></div>
<div class="ttc" id="stasis_8h_html_af6081f17431b81bc1a010b680517491d"><div class="ttname"><a href="../../dd/d79/stasis_8h.html#af6081f17431b81bc1a010b680517491d">stasis_message_data</a></div><div class="ttdeci">void * stasis_message_data(const struct stasis_message *msg)</div><div class="ttdoc">Get the data contained in a message. </div><div class="ttdef"><b>Definition:</b> <a href="../../d2/db9/stasis__message_8c_source.html#l00195">stasis_message.c:195</a></div></div>
<div class="ttc" id="group__StasisTopicsAndMessages_html_gaf226cf2d1a4dbbbf220521d58c05ac0f"><div class="ttname"><a href="../../df/deb/group__StasisTopicsAndMessages.html#gaf226cf2d1a4dbbbf220521d58c05ac0f">ast_mwi_state_type</a></div><div class="ttdeci">struct stasis_message_type * ast_mwi_state_type(void)</div><div class="ttdoc">Get the Stasis Message Bus API message type for MWI messages. </div></div>
<div class="ttc" id="utils_8h_html_ad5db11fa27352e2b9a3c669adc76955f"><div class="ttname"><a href="../../d5/d60/utils_8h.html#ad5db11fa27352e2b9a3c669adc76955f">ast_eid_default</a></div><div class="ttdeci">struct ast_eid ast_eid_default</div><div class="ttdoc">Global EID. </div><div class="ttdef"><b>Definition:</b> <a href="../../de/dc5/options_8c_source.html#l00093">options.c:93</a></div></div>
<div class="ttc" id="astobj2_8h_html_a6321ee982370c55ab3c24c72c562cbdd"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#a6321ee982370c55ab3c24c72c562cbdd">ao2_cleanup</a></div><div class="ttdeci">#define ao2_cleanup(obj)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l01958">astobj2.h:1958</a></div></div>
<div class="ttc" id="group__StasisTopicsAndMessages_html_ga753c7b39e3284d771f13f513b003d033"><div class="ttname"><a href="../../df/deb/group__StasisTopicsAndMessages.html#ga753c7b39e3284d771f13f513b003d033">ast_mwi_state::uniqueid</a></div><div class="ttdeci">const ast_string_field uniqueid</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d33/mwi_8h_source.html#l00460">mwi.h:460</a></div></div>
<div class="ttc" id="chan__alsa_8c_html_ac25ea00ee3f082df06e0cf468cbde240"><div class="ttname"><a href="../../da/d45/chan__alsa_8c.html#ac25ea00ee3f082df06e0cf468cbde240">context</a></div><div class="ttdeci">static char context[AST_MAX_CONTEXT]</div><div class="ttdef"><b>Definition:</b> <a href="../../da/d45/chan__alsa_8c_source.html#l00116">chan_alsa.c:116</a></div></div>
<div class="ttc" id="structast__mwi__state_html"><div class="ttname"><a href="../../d6/d45/structast__mwi__state.html">ast_mwi_state</a></div><div class="ttdoc">The structure that contains MWI state. </div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d33/mwi_8h_source.html#l00457">mwi.h:457</a></div></div>
<div class="ttc" id="mwi_8c_html_afa50d915beae3259db5d1bd31b174c81"><div class="ttname"><a href="../../d6/db4/mwi_8c.html#afa50d915beae3259db5d1bd31b174c81">mwi_state_create_message</a></div><div class="ttdeci">static struct stasis_message * mwi_state_create_message(const char *mailbox, const char *context, int urgent_msgs, int new_msgs, int old_msgs, const char *channel_id, struct ast_eid *eid)</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/db4/mwi_8c_source.html#l00169">mwi.c:169</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="ab2d839cf1f63bd9a19f5d6dff8484bcf"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab2d839cf1f63bd9a19f5d6dff8484bcf">&#9670;&nbsp;</a></span>ast_mwi_add_observer()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ast_mwi_add_observer </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="../../d1/dbb/structast__mwi__observer.html">ast_mwi_observer</a> *&#160;</td>
          <td class="paramname"><em>observer</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Add an observer to receive MWI state related events. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">observer</td><td>The observer handling events</td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">0</td><td>if successfully registered, -1 otherwise</td></tr>
  </table>
  </dd>
</dl>
<dl class="section since"><dt>Since</dt><dd>13.28.0 </dd>
<dd>
16.5.0 </dd></dl>

<p class="definition">Definition at line <a class="el" href="../../d6/db4/mwi_8c_source.html#l00296">296</a> of file <a class="el" href="../../d6/db4/mwi_8c_source.html">mwi.c</a>.</p>

<p class="reference">References <a class="el" href="../../dc/d1d/stasis__state_8c_source.html#l00688">stasis_state_add_observer()</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../dc/df4/app__voicemail_8c_source.html#l13197">start_poll_thread()</a>, and <a class="el" href="../../dd/de5/test__mwi_8c_source.html#l00143">subscriptions_create()</a>.</p>
<div class="fragment"><div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;{</div><div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;   <span class="keywordflow">return</span> <a class="code" href="../../d1/d96/stasis__state_8h.html#a7228670846162446fdf5bd2500c1f64d">stasis_state_add_observer</a>(<a class="code" href="../../d6/db4/mwi_8c.html#a527bd68e0bbd91f85683a01f37ca9e31">mwi_state_manager</a>,</div><div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;      (<span class="keyword">struct</span> <a class="code" href="../../d5/d92/structstasis__state__observer.html">stasis_state_observer</a> *)observer);</div><div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;}</div><div class="ttc" id="structstasis__state__observer_html"><div class="ttname"><a href="../../d5/d92/structstasis__state__observer.html">stasis_state_observer</a></div><div class="ttdoc">Managed stasis state event interface. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d96/stasis__state_8h_source.html#l00463">stasis_state.h:463</a></div></div>
<div class="ttc" id="stasis__state_8h_html_a7228670846162446fdf5bd2500c1f64d"><div class="ttname"><a href="../../d1/d96/stasis__state_8h.html#a7228670846162446fdf5bd2500c1f64d">stasis_state_add_observer</a></div><div class="ttdeci">int stasis_state_add_observer(struct stasis_state_manager *manager, struct stasis_state_observer *observer)</div><div class="ttdoc">Add an observer to receive managed state related events. </div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d1d/stasis__state_8c_source.html#l00688">stasis_state.c:688</a></div></div>
<div class="ttc" id="mwi_8c_html_a527bd68e0bbd91f85683a01f37ca9e31"><div class="ttname"><a href="../../d6/db4/mwi_8c.html#a527bd68e0bbd91f85683a01f37ca9e31">mwi_state_manager</a></div><div class="ttdeci">static struct stasis_state_manager * mwi_state_manager</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/db4/mwi_8c_source.html#l00032">mwi.c:32</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a7ad873aa4dc1386af34a37a177f31af1"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a7ad873aa4dc1386af34a37a177f31af1">&#9670;&nbsp;</a></span>ast_mwi_add_publisher()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="../../da/df3/structast__mwi__publisher.html">ast_mwi_publisher</a>* ast_mwi_add_publisher </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>mailbox</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Add an MWI state publisher to the mailbox. </p>
<p>Adding a publisher to a mailbox will create a stasis topic for the mailbox if one does not already exist. A publisher can be removed by releasing its reference. Doing so releases its underlying reference to the MWI state.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">mailbox</td><td>The mailbox id to publish to</td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">An</td><td>MWI publisher object </td></tr>
    <tr><td class="paramname">NULl</td><td>on error</td></tr>
  </table>
  </dd>
</dl>
<dl class="section since"><dt>Since</dt><dd>13.28.0 </dd>
<dd>
16.5.0 </dd></dl>

<p class="definition">Definition at line <a class="el" href="../../d6/db4/mwi_8c_source.html#l00290">290</a> of file <a class="el" href="../../d6/db4/mwi_8c_source.html">mwi.c</a>.</p>

<p class="reference">References <a class="el" href="../../dc/d1d/stasis__state_8c_source.html#l00531">stasis_state_add_publisher()</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../dd/de5/test__mwi_8c_source.html#l00213">publishers_create()</a>.</p>
<div class="fragment"><div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;{</div><div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;   <span class="keywordflow">return</span> (<span class="keyword">struct</span> <a class="code" href="../../da/df3/structast__mwi__publisher.html">ast_mwi_publisher</a> *)<a class="code" href="../../d1/d96/stasis__state_8h.html#aef7869676ec68c22cc1ac42cadaa36c9">stasis_state_add_publisher</a>(</div><div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;      <a class="code" href="../../d6/db4/mwi_8c.html#a527bd68e0bbd91f85683a01f37ca9e31">mwi_state_manager</a>, <a class="code" href="../../d0/dd6/chan__mgcp_8c.html#a6b49cafa2a3d359a2e865992f551874a">mailbox</a>);</div><div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;}</div><div class="ttc" id="mwi_8c_html_a527bd68e0bbd91f85683a01f37ca9e31"><div class="ttname"><a href="../../d6/db4/mwi_8c.html#a527bd68e0bbd91f85683a01f37ca9e31">mwi_state_manager</a></div><div class="ttdeci">static struct stasis_state_manager * mwi_state_manager</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/db4/mwi_8c_source.html#l00032">mwi.c:32</a></div></div>
<div class="ttc" id="chan__mgcp_8c_html_a6b49cafa2a3d359a2e865992f551874a"><div class="ttname"><a href="../../d0/dd6/chan__mgcp_8c.html#a6b49cafa2a3d359a2e865992f551874a">mailbox</a></div><div class="ttdeci">static char mailbox[AST_MAX_MAILBOX_UNIQUEID]</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/dd6/chan__mgcp_8c_source.html#l00204">chan_mgcp.c:204</a></div></div>
<div class="ttc" id="stasis__state_8h_html_aef7869676ec68c22cc1ac42cadaa36c9"><div class="ttname"><a href="../../d1/d96/stasis__state_8h.html#aef7869676ec68c22cc1ac42cadaa36c9">stasis_state_add_publisher</a></div><div class="ttdeci">struct stasis_state_publisher * stasis_state_add_publisher(struct stasis_state_manager *manager, const char *id)</div><div class="ttdoc">Add a publisher to the managed state for the given id. </div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d1d/stasis__state_8c_source.html#l00531">stasis_state.c:531</a></div></div>
<div class="ttc" id="structast__mwi__publisher_html"><div class="ttname"><a href="../../da/df3/structast__mwi__publisher.html">ast_mwi_publisher</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d6/db4/mwi_8c_source.html#l00285">mwi.c:285</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="abf1568897d6642cdaa55e304b579512d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#abf1568897d6642cdaa55e304b579512d">&#9670;&nbsp;</a></span>ast_mwi_add_subscriber()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="../../de/d41/structast__mwi__subscriber.html">ast_mwi_subscriber</a>* ast_mwi_add_subscriber </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>mailbox</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Add an MWI state subscriber to the mailbox. </p>
<p>Adding a subscriber to a mailbox will create a stasis topic for the mailbox if one does not already exist. It does not however subscribe to the topic itself. This is done separately using a call to <a class="el" href="../../dd/d79/stasis_8h.html#ae3fe7fe099389094244002113814ec23">stasis_subscribe</a> or <a class="el" href="../../dd/d79/stasis_8h.html#a597f7a30fe616c9f083a93ed168955ed">stasis_subscribe_pool</a>.</p>
<p>A subscriber can be removed by releasing its reference. Doing so releases its underlying reference to the MWI state. It does not unsubscribe from the topic. Unsubscribing from a topic should be done prior to unsubscribing the state.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">mailbox</td><td>The subscription state mailbox id</td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">An</td><td>MWI subscriber object </td></tr>
    <tr><td class="paramname">NULL</td><td>on error</td></tr>
  </table>
  </dd>
</dl>
<dl class="section since"><dt>Since</dt><dd>13.28.0 </dd>
<dd>
16.5.0 </dd></dl>

<p class="definition">Definition at line <a class="el" href="../../d6/db4/mwi_8c_source.html#l00224">224</a> of file <a class="el" href="../../d6/db4/mwi_8c_source.html">mwi.c</a>.</p>

<p class="reference">References <a class="el" href="../../dc/d1d/stasis__state_8c_source.html#l00412">stasis_state_add_subscriber()</a>.</p>
<div class="fragment"><div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;{</div><div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;   <span class="keywordflow">return</span> (<span class="keyword">struct</span> <a class="code" href="../../de/d41/structast__mwi__subscriber.html">ast_mwi_subscriber</a> *)<a class="code" href="../../d1/d96/stasis__state_8h.html#a0826641b8fbe326ff48602f0406be308">stasis_state_add_subscriber</a>(</div><div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;      <a class="code" href="../../d6/db4/mwi_8c.html#a527bd68e0bbd91f85683a01f37ca9e31">mwi_state_manager</a>, <a class="code" href="../../d0/dd6/chan__mgcp_8c.html#a6b49cafa2a3d359a2e865992f551874a">mailbox</a>);</div><div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;}</div><div class="ttc" id="stasis__state_8h_html_a0826641b8fbe326ff48602f0406be308"><div class="ttname"><a href="../../d1/d96/stasis__state_8h.html#a0826641b8fbe326ff48602f0406be308">stasis_state_add_subscriber</a></div><div class="ttdeci">struct stasis_state_subscriber * stasis_state_add_subscriber(struct stasis_state_manager *manager, const char *id)</div><div class="ttdoc">Add a subscriber to the managed stasis state for the given id. </div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d1d/stasis__state_8c_source.html#l00412">stasis_state.c:412</a></div></div>
<div class="ttc" id="structast__mwi__subscriber_html"><div class="ttname"><a href="../../de/d41/structast__mwi__subscriber.html">ast_mwi_subscriber</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d6/db4/mwi_8c_source.html#l00219">mwi.c:219</a></div></div>
<div class="ttc" id="mwi_8c_html_a527bd68e0bbd91f85683a01f37ca9e31"><div class="ttname"><a href="../../d6/db4/mwi_8c.html#a527bd68e0bbd91f85683a01f37ca9e31">mwi_state_manager</a></div><div class="ttdeci">static struct stasis_state_manager * mwi_state_manager</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/db4/mwi_8c_source.html#l00032">mwi.c:32</a></div></div>
<div class="ttc" id="chan__mgcp_8c_html_a6b49cafa2a3d359a2e865992f551874a"><div class="ttname"><a href="../../d0/dd6/chan__mgcp_8c.html#a6b49cafa2a3d359a2e865992f551874a">mailbox</a></div><div class="ttdeci">static char mailbox[AST_MAX_MAILBOX_UNIQUEID]</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/dd6/chan__mgcp_8c_source.html#l00204">chan_mgcp.c:204</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="ac129563a9c5477eb5b2071257e5d5873"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac129563a9c5477eb5b2071257e5d5873">&#9670;&nbsp;</a></span>ast_mwi_publish()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ast_mwi_publish </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="../../da/df3/structast__mwi__publisher.html">ast_mwi_publisher</a> *&#160;</td>
          <td class="paramname"><em>publisher</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>urgent_msgs</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>new_msgs</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>old_msgs</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>channel_id</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="../../d0/d86/structast__eid.html">ast_eid</a> *&#160;</td>
          <td class="paramname"><em>eid</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Publish MWI for the given mailbox. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">publisher</td><td>The publisher to publish a mailbox update on </td></tr>
    <tr><td class="paramname">urgent_msgs</td><td>The number of urgent messages in this mailbox </td></tr>
    <tr><td class="paramname">new_msgs</td><td>The number of new messages in this mailbox </td></tr>
    <tr><td class="paramname">old_msgs</td><td>The number of old messages in this mailbox </td></tr>
    <tr><td class="paramname">channel_id</td><td>A unique identifier for a channel associated with this change in mailbox state </td></tr>
    <tr><td class="paramname">eid</td><td>The EID of the server that originally published the message</td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">0</td><td>on success </td></tr>
    <tr><td class="paramname">-1</td><td>on failure</td></tr>
  </table>
  </dd>
</dl>
<dl class="section since"><dt>Since</dt><dd>13.28.0 </dd>
<dd>
16.5.0 </dd></dl>

<p class="definition">Definition at line <a class="el" href="../../d6/db4/mwi_8c_source.html#l00353">353</a> of file <a class="el" href="../../d6/db4/mwi_8c_source.html">mwi.c</a>.</p>

<p class="reference">References <a class="el" href="../../d5/da5/astobj2_8h_source.html#l00464">ao2_ref</a>, <a class="el" href="../../d6/db4/mwi_8c_source.html#l00169">mwi_state_create_message()</a>, <a class="el" href="../../dc/d7f/resample_8c_source.html#l00096">NULL</a>, <a class="el" href="../../dc/d1d/stasis__state_8c_source.html#l00562">stasis_state_publish()</a>, and <a class="el" href="../../dc/d1d/stasis__state_8c_source.html#l00552">stasis_state_publisher_id()</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../dd/de5/test__mwi_8c_source.html#l00271">explicit_publish_cb()</a>.</p>
<div class="fragment"><div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;{</div><div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../df/dcc/structstasis__state__publisher.html">stasis_state_publisher</a> *p = (<span class="keyword">struct </span><a class="code" href="../../df/dcc/structstasis__state__publisher.html">stasis_state_publisher</a> *)pub;</div><div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d7/d55/structstasis__message.html">stasis_message</a> *msg = <a class="code" href="../../d6/db4/mwi_8c.html#afa50d915beae3259db5d1bd31b174c81">mwi_state_create_message</a>(<a class="code" href="../../d1/d96/stasis__state_8h.html#acb3e1eb79879c114539587a240b455ab">stasis_state_publisher_id</a>(p),</div><div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;      <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, urgent_msgs, new_msgs, old_msgs, channel_id, eid);</div><div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;</div><div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;   <span class="keywordflow">if</span> (!msg) {</div><div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;   }</div><div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;</div><div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;   <a class="code" href="../../d1/d96/stasis__state_8h.html#ae22f3fe7bbecf70b943d4b72ec9ffcea">stasis_state_publish</a>(p, msg);</div><div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(msg, -1);</div><div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;</div><div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;   <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;}</div><div class="ttc" id="structstasis__state__publisher_html"><div class="ttname"><a href="../../df/dcc/structstasis__state__publisher.html">stasis_state_publisher</a></div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d1d/stasis__state_8c_source.html#l00519">stasis_state.c:519</a></div></div>
<div class="ttc" id="stasis__state_8h_html_acb3e1eb79879c114539587a240b455ab"><div class="ttname"><a href="../../d1/d96/stasis__state_8h.html#acb3e1eb79879c114539587a240b455ab">stasis_state_publisher_id</a></div><div class="ttdeci">const char * stasis_state_publisher_id(const struct stasis_state_publisher *pub)</div><div class="ttdoc">Retrieve the publisher&amp;#39;s underlying state&amp;#39;s unique id. </div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d1d/stasis__state_8c_source.html#l00552">stasis_state.c:552</a></div></div>
<div class="ttc" id="structstasis__message_html"><div class="ttname"><a href="../../d7/d55/structstasis__message.html">stasis_message</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d2/db9/stasis__message_8c_source.html#l00121">stasis_message.c:121</a></div></div>
<div class="ttc" id="resample_8c_html_a070d2ce7b6bb7e5c05602aa8c308d0c4"><div class="ttname"><a href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a></div><div class="ttdeci">#define NULL</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d7f/resample_8c_source.html#l00096">resample.c:96</a></div></div>
<div class="ttc" id="astobj2_8h_html_aaca5e8eac39a22f9da1c36fc6c922270"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a></div><div class="ttdeci">#define ao2_ref(o, delta)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l00464">astobj2.h:464</a></div></div>
<div class="ttc" id="stasis__state_8h_html_ae22f3fe7bbecf70b943d4b72ec9ffcea"><div class="ttname"><a href="../../d1/d96/stasis__state_8h.html#ae22f3fe7bbecf70b943d4b72ec9ffcea">stasis_state_publish</a></div><div class="ttdeci">void stasis_state_publish(struct stasis_state_publisher *pub, struct stasis_message *msg)</div><div class="ttdoc">Publish to a managed state (topic) using a publisher. </div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d1d/stasis__state_8c_source.html#l00562">stasis_state.c:562</a></div></div>
<div class="ttc" id="mwi_8c_html_afa50d915beae3259db5d1bd31b174c81"><div class="ttname"><a href="../../d6/db4/mwi_8c.html#afa50d915beae3259db5d1bd31b174c81">mwi_state_create_message</a></div><div class="ttdeci">static struct stasis_message * mwi_state_create_message(const char *mailbox, const char *context, int urgent_msgs, int new_msgs, int old_msgs, const char *channel_id, struct ast_eid *eid)</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/db4/mwi_8c_source.html#l00169">mwi.c:169</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="afc860a1db2f223052313491d47116302"></a>
<h2 class="memtitle"><span class="permalink"><a href="#afc860a1db2f223052313491d47116302">&#9670;&nbsp;</a></span>ast_mwi_publish_by_mailbox()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ast_mwi_publish_by_mailbox </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>mailbox</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>context</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>urgent_msgs</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>new_msgs</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>old_msgs</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>channel_id</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="../../d0/d86/structast__eid.html">ast_eid</a> *&#160;</td>
          <td class="paramname"><em>eid</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Publish MWI for the given mailbox. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">mailbox</td><td>The mailbox identifier string. </td></tr>
    <tr><td class="paramname">context</td><td>The context this mailbox resides in (NULL or "" if only using mailbox) </td></tr>
    <tr><td class="paramname">urgent_msgs</td><td>The number of urgent messages in this mailbox </td></tr>
    <tr><td class="paramname">new_msgs</td><td>The number of new messages in this mailbox </td></tr>
    <tr><td class="paramname">old_msgs</td><td>The number of old messages in this mailbox </td></tr>
    <tr><td class="paramname">channel_id</td><td>A unique identifier for a channel associated with this change in mailbox state </td></tr>
    <tr><td class="paramname">eid</td><td>The EID of the server that originally published the message</td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">0</td><td>on success </td></tr>
    <tr><td class="paramname">-1</td><td>on failure</td></tr>
  </table>
  </dd>
</dl>
<dl class="section since"><dt>Since</dt><dd>13.28.0 </dd>
<dd>
16.5.0 </dd></dl>

<p class="definition">Definition at line <a class="el" href="../../d6/db4/mwi_8c_source.html#l00370">370</a> of file <a class="el" href="../../d6/db4/mwi_8c_source.html">mwi.c</a>.</p>

<p class="reference">References <a class="el" href="../../d5/da5/astobj2_8h_source.html#l00464">ao2_ref</a>, <a class="el" href="../../d6/db4/mwi_8c_source.html#l00169">mwi_state_create_message()</a>, <a class="el" href="../../dc/d7f/resample_8c_source.html#l00096">NULL</a>, <a class="el" href="../../d2/db9/stasis__message_8c_source.html#l00195">stasis_message_data()</a>, <a class="el" href="../../dc/d1d/stasis__state_8c_source.html#l00638">stasis_state_publish_by_id()</a>, and <a class="el" href="../../dc/d33/mwi_8h_source.html#l00460">ast_mwi_state::uniqueid</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../d6/db4/mwi_8c_source.html#l00388">ast_publish_mwi_state_full()</a>, and <a class="el" href="../../dd/de5/test__mwi_8c_source.html#l00252">implicit_publish_cb()</a>.</p>
<div class="fragment"><div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;{</div><div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d6/d45/structast__mwi__state.html">ast_mwi_state</a> *mwi_state;</div><div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d7/d55/structstasis__message.html">stasis_message</a> *msg = <a class="code" href="../../d6/db4/mwi_8c.html#afa50d915beae3259db5d1bd31b174c81">mwi_state_create_message</a>(</div><div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;      <a class="code" href="../../d0/dd6/chan__mgcp_8c.html#a6b49cafa2a3d359a2e865992f551874a">mailbox</a>, <a class="code" href="../../da/d45/chan__alsa_8c.html#ac25ea00ee3f082df06e0cf468cbde240">context</a>, urgent_msgs, new_msgs, old_msgs, channel_id, eid);</div><div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;</div><div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;   <span class="keywordflow">if</span> (!msg) {</div><div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;   }</div><div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;</div><div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;   mwi_state = <a class="code" href="../../dd/d79/stasis_8h.html#af6081f17431b81bc1a010b680517491d">stasis_message_data</a>(msg);</div><div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;   <a class="code" href="../../d1/d96/stasis__state_8h.html#a2dbc6c2a3b37e5ab135e410681a23142">stasis_state_publish_by_id</a>(<a class="code" href="../../d6/db4/mwi_8c.html#a527bd68e0bbd91f85683a01f37ca9e31">mwi_state_manager</a>, mwi_state-&gt;<a class="code" href="../../df/deb/group__StasisTopicsAndMessages.html#ga753c7b39e3284d771f13f513b003d033">uniqueid</a>, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, msg);</div><div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(msg, -1);</div><div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;</div><div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;   <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;}</div><div class="ttc" id="structstasis__message_html"><div class="ttname"><a href="../../d7/d55/structstasis__message.html">stasis_message</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d2/db9/stasis__message_8c_source.html#l00121">stasis_message.c:121</a></div></div>
<div class="ttc" id="resample_8c_html_a070d2ce7b6bb7e5c05602aa8c308d0c4"><div class="ttname"><a href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a></div><div class="ttdeci">#define NULL</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d7f/resample_8c_source.html#l00096">resample.c:96</a></div></div>
<div class="ttc" id="mwi_8c_html_a527bd68e0bbd91f85683a01f37ca9e31"><div class="ttname"><a href="../../d6/db4/mwi_8c.html#a527bd68e0bbd91f85683a01f37ca9e31">mwi_state_manager</a></div><div class="ttdeci">static struct stasis_state_manager * mwi_state_manager</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/db4/mwi_8c_source.html#l00032">mwi.c:32</a></div></div>
<div class="ttc" id="chan__mgcp_8c_html_a6b49cafa2a3d359a2e865992f551874a"><div class="ttname"><a href="../../d0/dd6/chan__mgcp_8c.html#a6b49cafa2a3d359a2e865992f551874a">mailbox</a></div><div class="ttdeci">static char mailbox[AST_MAX_MAILBOX_UNIQUEID]</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/dd6/chan__mgcp_8c_source.html#l00204">chan_mgcp.c:204</a></div></div>
<div class="ttc" id="astobj2_8h_html_aaca5e8eac39a22f9da1c36fc6c922270"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a></div><div class="ttdeci">#define ao2_ref(o, delta)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l00464">astobj2.h:464</a></div></div>
<div class="ttc" id="stasis_8h_html_af6081f17431b81bc1a010b680517491d"><div class="ttname"><a href="../../dd/d79/stasis_8h.html#af6081f17431b81bc1a010b680517491d">stasis_message_data</a></div><div class="ttdeci">void * stasis_message_data(const struct stasis_message *msg)</div><div class="ttdoc">Get the data contained in a message. </div><div class="ttdef"><b>Definition:</b> <a href="../../d2/db9/stasis__message_8c_source.html#l00195">stasis_message.c:195</a></div></div>
<div class="ttc" id="stasis__state_8h_html_a2dbc6c2a3b37e5ab135e410681a23142"><div class="ttname"><a href="../../d1/d96/stasis__state_8h.html#a2dbc6c2a3b37e5ab135e410681a23142">stasis_state_publish_by_id</a></div><div class="ttdeci">void stasis_state_publish_by_id(struct stasis_state_manager *manager, const char *id, const struct ast_eid *eid, struct stasis_message *msg)</div><div class="ttdoc">Publish to a managed named by id topic, and add an implicit subscriber. </div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d1d/stasis__state_8c_source.html#l00638">stasis_state.c:638</a></div></div>
<div class="ttc" id="group__StasisTopicsAndMessages_html_ga753c7b39e3284d771f13f513b003d033"><div class="ttname"><a href="../../df/deb/group__StasisTopicsAndMessages.html#ga753c7b39e3284d771f13f513b003d033">ast_mwi_state::uniqueid</a></div><div class="ttdeci">const ast_string_field uniqueid</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d33/mwi_8h_source.html#l00460">mwi.h:460</a></div></div>
<div class="ttc" id="chan__alsa_8c_html_ac25ea00ee3f082df06e0cf468cbde240"><div class="ttname"><a href="../../da/d45/chan__alsa_8c.html#ac25ea00ee3f082df06e0cf468cbde240">context</a></div><div class="ttdeci">static char context[AST_MAX_CONTEXT]</div><div class="ttdef"><b>Definition:</b> <a href="../../da/d45/chan__alsa_8c_source.html#l00116">chan_alsa.c:116</a></div></div>
<div class="ttc" id="structast__mwi__state_html"><div class="ttname"><a href="../../d6/d45/structast__mwi__state.html">ast_mwi_state</a></div><div class="ttdoc">The structure that contains MWI state. </div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d33/mwi_8h_source.html#l00457">mwi.h:457</a></div></div>
<div class="ttc" id="mwi_8c_html_afa50d915beae3259db5d1bd31b174c81"><div class="ttname"><a href="../../d6/db4/mwi_8c.html#afa50d915beae3259db5d1bd31b174c81">mwi_state_create_message</a></div><div class="ttdeci">static struct stasis_message * mwi_state_create_message(const char *mailbox, const char *context, int urgent_msgs, int new_msgs, int old_msgs, const char *channel_id, struct ast_eid *eid)</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/db4/mwi_8c_source.html#l00169">mwi.c:169</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="ad200df5870ce5a601381c4e37f8a2197"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad200df5870ce5a601381c4e37f8a2197">&#9670;&nbsp;</a></span>ast_mwi_remove_observer()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ast_mwi_remove_observer </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="../../d1/dbb/structast__mwi__observer.html">ast_mwi_observer</a> *&#160;</td>
          <td class="paramname"><em>observer</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Remove an MWI state observer. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">observer</td><td>The observer being removed</td></tr>
  </table>
  </dd>
</dl>
<dl class="section since"><dt>Since</dt><dd>13.28.0 </dd>
<dd>
16.5.0 </dd></dl>

<p class="definition">Definition at line <a class="el" href="../../d6/db4/mwi_8c_source.html#l00302">302</a> of file <a class="el" href="../../d6/db4/mwi_8c_source.html">mwi.c</a>.</p>

<p class="reference">References <a class="el" href="../../dc/d1d/stasis__state_8c_source.html#l00700">stasis_state_remove_observer()</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../dc/df4/app__voicemail_8c_source.html#l13209">stop_poll_thread()</a>, and <a class="el" href="../../dd/de5/test__mwi_8c_source.html#l00125">subscriptions_destroy()</a>.</p>
<div class="fragment"><div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;{</div><div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;   <a class="code" href="../../d1/d96/stasis__state_8h.html#a48ab5b2a6061ca20c816a9ccdf85aeeb">stasis_state_remove_observer</a>(<a class="code" href="../../d6/db4/mwi_8c.html#a527bd68e0bbd91f85683a01f37ca9e31">mwi_state_manager</a>,</div><div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;      (<span class="keyword">struct</span> <a class="code" href="../../d5/d92/structstasis__state__observer.html">stasis_state_observer</a> *)observer);</div><div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;}</div><div class="ttc" id="structstasis__state__observer_html"><div class="ttname"><a href="../../d5/d92/structstasis__state__observer.html">stasis_state_observer</a></div><div class="ttdoc">Managed stasis state event interface. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d96/stasis__state_8h_source.html#l00463">stasis_state.h:463</a></div></div>
<div class="ttc" id="stasis__state_8h_html_a48ab5b2a6061ca20c816a9ccdf85aeeb"><div class="ttname"><a href="../../d1/d96/stasis__state_8h.html#a48ab5b2a6061ca20c816a9ccdf85aeeb">stasis_state_remove_observer</a></div><div class="ttdeci">void stasis_state_remove_observer(struct stasis_state_manager *manager, struct stasis_state_observer *observer)</div><div class="ttdoc">Remove an observer (will no longer receive managed state related events). </div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d1d/stasis__state_8c_source.html#l00700">stasis_state.c:700</a></div></div>
<div class="ttc" id="mwi_8c_html_a527bd68e0bbd91f85683a01f37ca9e31"><div class="ttname"><a href="../../d6/db4/mwi_8c.html#a527bd68e0bbd91f85683a01f37ca9e31">mwi_state_manager</a></div><div class="ttdeci">static struct stasis_state_manager * mwi_state_manager</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/db4/mwi_8c_source.html#l00032">mwi.c:32</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="aa7789090f6f6177b5033d240bba65b93"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa7789090f6f6177b5033d240bba65b93">&#9670;&nbsp;</a></span>ast_mwi_state_callback_all()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ast_mwi_state_callback_all </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="../../dc/d33/mwi_8h.html#a8a65dacf53b3d4cbbe3f5bdfa413f9fe">on_mwi_state</a>&#160;</td>
          <td class="paramname"><em>handler</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>data</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>For each managed mailbox call the given handler. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">handler</td><td>The mwi state handler to call for each managed mailbox </td></tr>
    <tr><td class="paramname">data</td><td>User to data to pass on to the handler</td></tr>
  </table>
  </dd>
</dl>
<dl class="section since"><dt>Since</dt><dd>13.28.0 </dd>
<dd>
16.5.0 </dd></dl>

<p class="definition">Definition at line <a class="el" href="../../d6/db4/mwi_8c_source.html#l00333">333</a> of file <a class="el" href="../../d6/db4/mwi_8c_source.html">mwi.c</a>.</p>

<p class="reference">References <a class="el" href="../../d6/db4/mwi_8c_source.html#l00313">handle_mwi_state()</a>, <a class="el" href="../../da/d03/test__ari_8c_source.html#l00059">handler()</a>, <a class="el" href="../../d6/db4/mwi_8c_source.html#l00309">mwi_handler_data::handler</a>, and <a class="el" href="../../dc/d1d/stasis__state_8c_source.html#l00740">stasis_state_callback_all()</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../dc/df4/app__voicemail_8c_source.html#l13680">actual_load_config()</a>, <a class="el" href="../../dc/df4/app__voicemail_8c_source.html#l13375">manager_voicemail_refresh()</a>, <a class="el" href="../../dd/de5/test__mwi_8c_source.html#l00304">publish()</a>, and <a class="el" href="../../dc/df4/app__voicemail_8c_source.html#l15050">unload_module()</a>.</p>
<div class="fragment"><div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;{</div><div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d1/d74/structmwi__handler__data.html">mwi_handler_data</a> <a class="code" href="../../d7/d6f/test__linkedlists_8c.html#a156f09c32102fa036620ad75c3ee4fbf">d</a> = {</div><div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;      .handler = <a class="code" href="../../da/d03/test__ari_8c.html#a695cc202c7a2869aa8202bb20726ea3c">handler</a>,</div><div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;      .data = <a class="code" href="../../d1/d74/structmwi__handler__data.html#a735984d41155bc1032e09bece8f8d66d">data</a></div><div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;   };</div><div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;</div><div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;   <a class="code" href="../../d1/d96/stasis__state_8h.html#a248667e66debb56942035089d06a5421">stasis_state_callback_all</a>(<a class="code" href="../../d6/db4/mwi_8c.html#a527bd68e0bbd91f85683a01f37ca9e31">mwi_state_manager</a>, <a class="code" href="../../d6/db4/mwi_8c.html#ac7b4628aa9a7162675d6186fec6fb042">handle_mwi_state</a>, &amp;d);</div><div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;}</div><div class="ttc" id="test__linkedlists_8c_html_a156f09c32102fa036620ad75c3ee4fbf"><div class="ttname"><a href="../../d7/d6f/test__linkedlists_8c.html#a156f09c32102fa036620ad75c3ee4fbf">d</a></div><div class="ttdeci">static struct test_val d</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d6f/test__linkedlists_8c_source.html#l00049">test_linkedlists.c:49</a></div></div>
<div class="ttc" id="mwi_8c_html_ac7b4628aa9a7162675d6186fec6fb042"><div class="ttname"><a href="../../d6/db4/mwi_8c.html#ac7b4628aa9a7162675d6186fec6fb042">handle_mwi_state</a></div><div class="ttdeci">static int handle_mwi_state(const char *id, struct stasis_message *msg, void *user_data)</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/db4/mwi_8c_source.html#l00313">mwi.c:313</a></div></div>
<div class="ttc" id="mwi_8c_html_a527bd68e0bbd91f85683a01f37ca9e31"><div class="ttname"><a href="../../d6/db4/mwi_8c.html#a527bd68e0bbd91f85683a01f37ca9e31">mwi_state_manager</a></div><div class="ttdeci">static struct stasis_state_manager * mwi_state_manager</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/db4/mwi_8c_source.html#l00032">mwi.c:32</a></div></div>
<div class="ttc" id="stasis__state_8h_html_a248667e66debb56942035089d06a5421"><div class="ttname"><a href="../../d1/d96/stasis__state_8h.html#a248667e66debb56942035089d06a5421">stasis_state_callback_all</a></div><div class="ttdeci">void stasis_state_callback_all(struct stasis_state_manager *manager, on_stasis_state handler, void *data)</div><div class="ttdoc">For each managed state call the given handler. </div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d1d/stasis__state_8c_source.html#l00740">stasis_state.c:740</a></div></div>
<div class="ttc" id="structmwi__handler__data_html"><div class="ttname"><a href="../../d1/d74/structmwi__handler__data.html">mwi_handler_data</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d6/db4/mwi_8c_source.html#l00308">mwi.c:308</a></div></div>
<div class="ttc" id="test__ari_8c_html_a695cc202c7a2869aa8202bb20726ea3c"><div class="ttname"><a href="../../da/d03/test__ari_8c.html#a695cc202c7a2869aa8202bb20726ea3c">handler</a></div><div class="ttdeci">static void handler(const char *name, int response_code, struct ast_variable *get_params, struct ast_variable *path_vars, struct ast_variable *headers, struct ast_json *body, struct ast_ari_response *response)</div><div class="ttdef"><b>Definition:</b> <a href="../../da/d03/test__ari_8c_source.html#l00059">test_ari.c:59</a></div></div>
<div class="ttc" id="structmwi__handler__data_html_a735984d41155bc1032e09bece8f8d66d"><div class="ttname"><a href="../../d1/d74/structmwi__handler__data.html#a735984d41155bc1032e09bece8f8d66d">mwi_handler_data::data</a></div><div class="ttdeci">void * data</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/db4/mwi_8c_source.html#l00310">mwi.c:310</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="aa878bb71532040c72e88ffa2f107d7b4"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa878bb71532040c72e88ffa2f107d7b4">&#9670;&nbsp;</a></span>ast_mwi_state_callback_subscribed()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ast_mwi_state_callback_subscribed </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="../../dc/d33/mwi_8h.html#a8a65dacf53b3d4cbbe3f5bdfa413f9fe">on_mwi_state</a>&#160;</td>
          <td class="paramname"><em>handler</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>data</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>For each managed mailbox that has a subscriber call the given handler. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">handler</td><td>The mwi state handler to call for each managed mailbox </td></tr>
    <tr><td class="paramname">data</td><td>User to data to pass on to the handler</td></tr>
  </table>
  </dd>
</dl>
<dl class="section since"><dt>Since</dt><dd>13.28.0 </dd>
<dd>
16.5.0 </dd></dl>

<p class="definition">Definition at line <a class="el" href="../../d6/db4/mwi_8c_source.html#l00343">343</a> of file <a class="el" href="../../d6/db4/mwi_8c_source.html">mwi.c</a>.</p>

<p class="reference">References <a class="el" href="../../d6/db4/mwi_8c_source.html#l00313">handle_mwi_state()</a>, <a class="el" href="../../da/d03/test__ari_8c_source.html#l00059">handler()</a>, <a class="el" href="../../d6/db4/mwi_8c_source.html#l00309">mwi_handler_data::handler</a>, and <a class="el" href="../../dc/d1d/stasis__state_8c_source.html#l00763">stasis_state_callback_subscribed()</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../dc/df4/app__voicemail_8c_source.html#l13074">mb_poll_thread()</a>.</p>
<div class="fragment"><div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;{</div><div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d1/d74/structmwi__handler__data.html">mwi_handler_data</a> <a class="code" href="../../d7/d6f/test__linkedlists_8c.html#a156f09c32102fa036620ad75c3ee4fbf">d</a> = {</div><div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;      .handler = <a class="code" href="../../da/d03/test__ari_8c.html#a695cc202c7a2869aa8202bb20726ea3c">handler</a>,</div><div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;      .data = <a class="code" href="../../d1/d74/structmwi__handler__data.html#a735984d41155bc1032e09bece8f8d66d">data</a></div><div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;   };</div><div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;</div><div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;   <a class="code" href="../../d1/d96/stasis__state_8h.html#ac0ac58c28d8742426b40f0c5c7404e76">stasis_state_callback_subscribed</a>(<a class="code" href="../../d6/db4/mwi_8c.html#a527bd68e0bbd91f85683a01f37ca9e31">mwi_state_manager</a>, <a class="code" href="../../d6/db4/mwi_8c.html#ac7b4628aa9a7162675d6186fec6fb042">handle_mwi_state</a>, &amp;d);</div><div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;}</div><div class="ttc" id="test__linkedlists_8c_html_a156f09c32102fa036620ad75c3ee4fbf"><div class="ttname"><a href="../../d7/d6f/test__linkedlists_8c.html#a156f09c32102fa036620ad75c3ee4fbf">d</a></div><div class="ttdeci">static struct test_val d</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d6f/test__linkedlists_8c_source.html#l00049">test_linkedlists.c:49</a></div></div>
<div class="ttc" id="mwi_8c_html_ac7b4628aa9a7162675d6186fec6fb042"><div class="ttname"><a href="../../d6/db4/mwi_8c.html#ac7b4628aa9a7162675d6186fec6fb042">handle_mwi_state</a></div><div class="ttdeci">static int handle_mwi_state(const char *id, struct stasis_message *msg, void *user_data)</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/db4/mwi_8c_source.html#l00313">mwi.c:313</a></div></div>
<div class="ttc" id="mwi_8c_html_a527bd68e0bbd91f85683a01f37ca9e31"><div class="ttname"><a href="../../d6/db4/mwi_8c.html#a527bd68e0bbd91f85683a01f37ca9e31">mwi_state_manager</a></div><div class="ttdeci">static struct stasis_state_manager * mwi_state_manager</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/db4/mwi_8c_source.html#l00032">mwi.c:32</a></div></div>
<div class="ttc" id="stasis__state_8h_html_ac0ac58c28d8742426b40f0c5c7404e76"><div class="ttname"><a href="../../d1/d96/stasis__state_8h.html#ac0ac58c28d8742426b40f0c5c7404e76">stasis_state_callback_subscribed</a></div><div class="ttdeci">void stasis_state_callback_subscribed(struct stasis_state_manager *manager, on_stasis_state handler, void *data)</div><div class="ttdoc">For each managed, and explicitly subscribed state call the given handler. </div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d1d/stasis__state_8c_source.html#l00763">stasis_state.c:763</a></div></div>
<div class="ttc" id="structmwi__handler__data_html"><div class="ttname"><a href="../../d1/d74/structmwi__handler__data.html">mwi_handler_data</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d6/db4/mwi_8c_source.html#l00308">mwi.c:308</a></div></div>
<div class="ttc" id="test__ari_8c_html_a695cc202c7a2869aa8202bb20726ea3c"><div class="ttname"><a href="../../da/d03/test__ari_8c.html#a695cc202c7a2869aa8202bb20726ea3c">handler</a></div><div class="ttdeci">static void handler(const char *name, int response_code, struct ast_variable *get_params, struct ast_variable *path_vars, struct ast_variable *headers, struct ast_json *body, struct ast_ari_response *response)</div><div class="ttdef"><b>Definition:</b> <a href="../../da/d03/test__ari_8c_source.html#l00059">test_ari.c:59</a></div></div>
<div class="ttc" id="structmwi__handler__data_html_a735984d41155bc1032e09bece8f8d66d"><div class="ttname"><a href="../../d1/d74/structmwi__handler__data.html#a735984d41155bc1032e09bece8f8d66d">mwi_handler_data::data</a></div><div class="ttdeci">void * data</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/db4/mwi_8c_source.html#l00310">mwi.c:310</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="ad83d6c9c09755c8b274a8f07fb2c64f7"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad83d6c9c09755c8b274a8f07fb2c64f7">&#9670;&nbsp;</a></span>ast_mwi_subscribe_pool()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="../../de/d41/structast__mwi__subscriber.html">ast_mwi_subscriber</a>* ast_mwi_subscribe_pool </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>mailbox</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../dd/d79/stasis_8h.html#a2b7854b4fb538be6f885943a24d60c8f">stasis_subscription_cb</a>&#160;</td>
          <td class="paramname"><em>callback</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>data</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Add an MWI state subscriber, and stasis subscription to the mailbox. </p>
<p>Adding a subscriber to a mailbox will create a stasis topic for the mailbox if one does not already exist. Once successfully create the underlying stasis topic is then subscribed to as well.</p>
<p>A subscriber can be removed by releasing its reference. Doing so releases its underlying reference to the MWI state. It does not unsubscribe from the topic. Unsubscribing from a topic should be done prior to unsubscribing the state.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">mailbox</td><td>The subscription state mailbox id </td></tr>
    <tr><td class="paramname">callback</td><td>The stasis subscription callback </td></tr>
    <tr><td class="paramname">data</td><td>A user data object passed to the stasis subscription</td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">An</td><td>MWI subscriber object </td></tr>
    <tr><td class="paramname">NULL</td><td>on error</td></tr>
  </table>
  </dd>
</dl>
<dl class="section since"><dt>Since</dt><dd>13.28.0 </dd>
<dd>
16.5.0 </dd></dl>

<p class="definition">Definition at line <a class="el" href="../../d6/db4/mwi_8c_source.html#l00230">230</a> of file <a class="el" href="../../d6/db4/mwi_8c_source.html">mwi.c</a>.</p>

<p class="reference">References <a class="el" href="../../df/deb/group__StasisTopicsAndMessages.html#gaf226cf2d1a4dbbbf220521d58c05ac0f">ast_mwi_state_type()</a>, <a class="el" href="../../d6/db4/mwi_8c_source.html#l00272">ast_mwi_subscriber_subscription()</a>, <a class="el" href="../../dc/d7f/resample_8c_source.html#l00096">NULL</a>, <a class="el" href="../../dc/d1d/stasis__state_8c_source.html#l00446">stasis_state_subscribe_pool()</a>, <a class="el" href="../../d0/df4/stasis_8c_source.html#l01025">stasis_subscription_accept_message_type()</a>, <a class="el" href="../../dd/d79/stasis_8h_source.html#l00300">STASIS_SUBSCRIPTION_FILTER_SELECTIVE</a>, <a class="el" href="../../d0/df4/stasis_8c_source.html#l01079">stasis_subscription_set_filter()</a>, and <a class="el" href="../../d1/da4/res__corosync_8c_source.html#l00240">sub</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../d5/dfe/chan__sip_8c_source.html#l28499">add_peer_mwi_subs()</a>, <a class="el" href="../../d0/dd6/chan__mgcp_8c_source.html#l04016">build_gateway()</a>, <a class="el" href="../../d5/dff/chan__iax2_8c_source.html#l12794">build_peer()</a>, <a class="el" href="../../d0/d80/chan__skinny_8c_source.html#l08285">config_line()</a>, <a class="el" href="../../d1/d97/chan__dahdi_8c_source.html#l12095">mkintf()</a>, <a class="el" href="../../d8/d25/res__pjsip__mwi_8c_source.html#l00140">mwi_stasis_subscription_alloc()</a>, and <a class="el" href="../../dd/de5/test__mwi_8c_source.html#l00143">subscriptions_create()</a>.</p>
<div class="fragment"><div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;{</div><div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d9/de4/structstasis__subscription.html">stasis_subscription</a> *stasis_sub;</div><div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../de/d41/structast__mwi__subscriber.html">ast_mwi_subscriber</a> *<a class="code" href="../../d1/da4/res__corosync_8c.html#a8e51289dd0fc7415cee40e7a57b49fdf">sub</a> = (<span class="keyword">struct </span><a class="code" href="../../de/d41/structast__mwi__subscriber.html">ast_mwi_subscriber</a> *)<a class="code" href="../../d1/d96/stasis__state_8h.html#af61eaf43040b329d68b476e647f6a7d6">stasis_state_subscribe_pool</a>(</div><div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;      <a class="code" href="../../d6/db4/mwi_8c.html#a527bd68e0bbd91f85683a01f37ca9e31">mwi_state_manager</a>, <a class="code" href="../../d0/dd6/chan__mgcp_8c.html#a6b49cafa2a3d359a2e865992f551874a">mailbox</a>, callback, data);</div><div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;</div><div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;   <span class="keywordflow">if</span> (!sub) {</div><div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;   }</div><div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;</div><div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;   stasis_sub = <a class="code" href="../../d6/db4/mwi_8c.html#a4209f1d79f28e693bddcc0b918425c91">ast_mwi_subscriber_subscription</a>(sub);</div><div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;</div><div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;   <a class="code" href="../../dd/d79/stasis_8h.html#a4f248ee5f4791f05d0af8768aaab282b">stasis_subscription_accept_message_type</a>(stasis_sub, <a class="code" href="../../df/deb/group__StasisTopicsAndMessages.html#gaf226cf2d1a4dbbbf220521d58c05ac0f">ast_mwi_state_type</a>());</div><div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;   <a class="code" href="../../dd/d79/stasis_8h.html#a52b5393bef89d7781c0d039d6489de23">stasis_subscription_set_filter</a>(stasis_sub, <a class="code" href="../../dd/d79/stasis_8h.html#a3804fa8ec76d77090d5cda80fc4ac891a0e40588366edb9a53e453d47ef26d567">STASIS_SUBSCRIPTION_FILTER_SELECTIVE</a>);</div><div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;</div><div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;   <span class="keywordflow">return</span> <a class="code" href="../../d1/da4/res__corosync_8c.html#a8e51289dd0fc7415cee40e7a57b49fdf">sub</a>;</div><div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;}</div><div class="ttc" id="stasis__state_8h_html_af61eaf43040b329d68b476e647f6a7d6"><div class="ttname"><a href="../../d1/d96/stasis__state_8h.html#af61eaf43040b329d68b476e647f6a7d6">stasis_state_subscribe_pool</a></div><div class="ttdeci">struct stasis_state_subscriber * stasis_state_subscribe_pool(struct stasis_state_manager *manager, const char *id, stasis_subscription_cb callback, void *data)</div><div class="ttdoc">Add a subscriber, and subscribe to its underlying stasis topic. </div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d1d/stasis__state_8c_source.html#l00446">stasis_state.c:446</a></div></div>
<div class="ttc" id="structstasis__subscription_html"><div class="ttname"><a href="../../d9/de4/structstasis__subscription.html">stasis_subscription</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d0/df4/stasis_8c_source.html#l00681">stasis.c:681</a></div></div>
<div class="ttc" id="stasis_8h_html_a52b5393bef89d7781c0d039d6489de23"><div class="ttname"><a href="../../dd/d79/stasis_8h.html#a52b5393bef89d7781c0d039d6489de23">stasis_subscription_set_filter</a></div><div class="ttdeci">int stasis_subscription_set_filter(struct stasis_subscription *subscription, enum stasis_subscription_message_filter filter)</div><div class="ttdoc">Set the message type filtering level on a subscription. </div><div class="ttdef"><b>Definition:</b> <a href="../../d0/df4/stasis_8c_source.html#l01079">stasis.c:1079</a></div></div>
<div class="ttc" id="resample_8c_html_a070d2ce7b6bb7e5c05602aa8c308d0c4"><div class="ttname"><a href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a></div><div class="ttdeci">#define NULL</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d7f/resample_8c_source.html#l00096">resample.c:96</a></div></div>
<div class="ttc" id="structast__mwi__subscriber_html"><div class="ttname"><a href="../../de/d41/structast__mwi__subscriber.html">ast_mwi_subscriber</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d6/db4/mwi_8c_source.html#l00219">mwi.c:219</a></div></div>
<div class="ttc" id="mwi_8c_html_a527bd68e0bbd91f85683a01f37ca9e31"><div class="ttname"><a href="../../d6/db4/mwi_8c.html#a527bd68e0bbd91f85683a01f37ca9e31">mwi_state_manager</a></div><div class="ttdeci">static struct stasis_state_manager * mwi_state_manager</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/db4/mwi_8c_source.html#l00032">mwi.c:32</a></div></div>
<div class="ttc" id="chan__mgcp_8c_html_a6b49cafa2a3d359a2e865992f551874a"><div class="ttname"><a href="../../d0/dd6/chan__mgcp_8c.html#a6b49cafa2a3d359a2e865992f551874a">mailbox</a></div><div class="ttdeci">static char mailbox[AST_MAX_MAILBOX_UNIQUEID]</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/dd6/chan__mgcp_8c_source.html#l00204">chan_mgcp.c:204</a></div></div>
<div class="ttc" id="mwi_8c_html_a4209f1d79f28e693bddcc0b918425c91"><div class="ttname"><a href="../../d6/db4/mwi_8c.html#a4209f1d79f28e693bddcc0b918425c91">ast_mwi_subscriber_subscription</a></div><div class="ttdeci">struct stasis_subscription * ast_mwi_subscriber_subscription(struct ast_mwi_subscriber *sub)</div><div class="ttdoc">Retrieve the stasis MWI topic subscription if available. </div><div class="ttdef"><b>Definition:</b> <a href="../../d6/db4/mwi_8c_source.html#l00272">mwi.c:272</a></div></div>
<div class="ttc" id="group__StasisTopicsAndMessages_html_gaf226cf2d1a4dbbbf220521d58c05ac0f"><div class="ttname"><a href="../../df/deb/group__StasisTopicsAndMessages.html#gaf226cf2d1a4dbbbf220521d58c05ac0f">ast_mwi_state_type</a></div><div class="ttdeci">struct stasis_message_type * ast_mwi_state_type(void)</div><div class="ttdoc">Get the Stasis Message Bus API message type for MWI messages. </div></div>
<div class="ttc" id="stasis_8h_html_a4f248ee5f4791f05d0af8768aaab282b"><div class="ttname"><a href="../../dd/d79/stasis_8h.html#a4f248ee5f4791f05d0af8768aaab282b">stasis_subscription_accept_message_type</a></div><div class="ttdeci">int stasis_subscription_accept_message_type(struct stasis_subscription *subscription, const struct stasis_message_type *type)</div><div class="ttdoc">Indicate to a subscription that we are interested in a message type. </div><div class="ttdef"><b>Definition:</b> <a href="../../d0/df4/stasis_8c_source.html#l01025">stasis.c:1025</a></div></div>
<div class="ttc" id="res__corosync_8c_html_a8e51289dd0fc7415cee40e7a57b49fdf"><div class="ttname"><a href="../../d1/da4/res__corosync_8c.html#a8e51289dd0fc7415cee40e7a57b49fdf">sub</a></div><div class="ttdeci">struct stasis_forward * sub</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/da4/res__corosync_8c_source.html#l00240">res_corosync.c:240</a></div></div>
<div class="ttc" id="stasis_8h_html_a3804fa8ec76d77090d5cda80fc4ac891a0e40588366edb9a53e453d47ef26d567"><div class="ttname"><a href="../../dd/d79/stasis_8h.html#a3804fa8ec76d77090d5cda80fc4ac891a0e40588366edb9a53e453d47ef26d567">STASIS_SUBSCRIPTION_FILTER_SELECTIVE</a></div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d79/stasis_8h_source.html#l00300">stasis.h:300</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="ae56e2e8831cc3919b5d92bad99786572"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae56e2e8831cc3919b5d92bad99786572">&#9670;&nbsp;</a></span>ast_mwi_subscriber_data()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="../../d6/d45/structast__mwi__state.html">ast_mwi_state</a>* ast_mwi_subscriber_data </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="../../de/d41/structast__mwi__subscriber.html">ast_mwi_subscriber</a> *&#160;</td>
          <td class="paramname"><em>sub</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Retrieves the state data object associated with the MWI subscriber. </p>
<dl class="section note"><dt>Note</dt><dd>Returned data's reference count is incremented</dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">sub</td><td>An MWI subscriber</td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">The</td><td>state data object</td></tr>
  </table>
  </dd>
</dl>
<dl class="section since"><dt>Since</dt><dd>13.28.0 </dd>
<dd>
16.5.0 </dd></dl>

<p class="definition">Definition at line <a class="el" href="../../d6/db4/mwi_8c_source.html#l00264">264</a> of file <a class="el" href="../../d6/db4/mwi_8c_source.html">mwi.c</a>.</p>

<p class="reference">References <a class="el" href="../../d6/db4/mwi_8c_source.html#l00138">mwi_retrieve_then_create_state()</a>, <a class="el" href="../../dc/d1d/stasis__state_8c_source.html#l00497">stasis_state_subscriber_data()</a>, and <a class="el" href="../../dc/d1d/stasis__state_8c_source.html#l00487">stasis_state_subscriber_id()</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../d8/d25/res__pjsip__mwi_8c_source.html#l00326">get_message_count()</a>, <a class="el" href="../../dd/de5/test__mwi_8c_source.html#l00104">handle_validate()</a>, <a class="el" href="../../dc/df4/app__voicemail_8c_source.html#l13181">mwi_handle_subscribe()</a>, and <a class="el" href="../../dc/df4/app__voicemail_8c_source.html#l13163">mwi_handle_unsubscribe()</a>.</p>
<div class="fragment"><div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;{</div><div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d7/d67/structstasis__state__subscriber.html">stasis_state_subscriber</a> *s = (<span class="keyword">struct </span><a class="code" href="../../d7/d67/structstasis__state__subscriber.html">stasis_state_subscriber</a> *)sub;</div><div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d6/d45/structast__mwi__state.html">ast_mwi_state</a> *mwi_state = <a class="code" href="../../d1/d96/stasis__state_8h.html#a3effc7b9731f157205bb2b65c3a2f1b8">stasis_state_subscriber_data</a>(s);</div><div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;</div><div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;   <span class="keywordflow">return</span> mwi_state ?: <a class="code" href="../../d6/db4/mwi_8c.html#a720263c8a0df5a6e37decc294ff01b39">mwi_retrieve_then_create_state</a>(<a class="code" href="../../d1/d96/stasis__state_8h.html#a5eeb2acddec8b7683035b25e8a4cf886">stasis_state_subscriber_id</a>(s));</div><div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;}</div><div class="ttc" id="mwi_8c_html_a720263c8a0df5a6e37decc294ff01b39"><div class="ttname"><a href="../../d6/db4/mwi_8c.html#a720263c8a0df5a6e37decc294ff01b39">mwi_retrieve_then_create_state</a></div><div class="ttdeci">static struct ast_mwi_state * mwi_retrieve_then_create_state(const char *mailbox)</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/db4/mwi_8c_source.html#l00138">mwi.c:138</a></div></div>
<div class="ttc" id="stasis__state_8h_html_a3effc7b9731f157205bb2b65c3a2f1b8"><div class="ttname"><a href="../../d1/d96/stasis__state_8h.html#a3effc7b9731f157205bb2b65c3a2f1b8">stasis_state_subscriber_data</a></div><div class="ttdeci">void * stasis_state_subscriber_data(struct stasis_state_subscriber *sub)</div><div class="ttdoc">Retrieve the last known state stasis message payload for the subscriber. </div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d1d/stasis__state_8c_source.html#l00497">stasis_state.c:497</a></div></div>
<div class="ttc" id="stasis__state_8h_html_a5eeb2acddec8b7683035b25e8a4cf886"><div class="ttname"><a href="../../d1/d96/stasis__state_8h.html#a5eeb2acddec8b7683035b25e8a4cf886">stasis_state_subscriber_id</a></div><div class="ttdeci">const char * stasis_state_subscriber_id(const struct stasis_state_subscriber *sub)</div><div class="ttdoc">Retrieve the underlying subscribed to state&amp;#39;s unique id. </div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d1d/stasis__state_8c_source.html#l00487">stasis_state.c:487</a></div></div>
<div class="ttc" id="structstasis__state__subscriber_html"><div class="ttname"><a href="../../d7/d67/structstasis__state__subscriber.html">stasis_state_subscriber</a></div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d1d/stasis__state_8c_source.html#l00384">stasis_state.c:384</a></div></div>
<div class="ttc" id="structast__mwi__state_html"><div class="ttname"><a href="../../d6/d45/structast__mwi__state.html">ast_mwi_state</a></div><div class="ttdoc">The structure that contains MWI state. </div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d33/mwi_8h_source.html#l00457">mwi.h:457</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a4209f1d79f28e693bddcc0b918425c91"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4209f1d79f28e693bddcc0b918425c91">&#9670;&nbsp;</a></span>ast_mwi_subscriber_subscription()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="../../d9/de4/structstasis__subscription.html">stasis_subscription</a>* ast_mwi_subscriber_subscription </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="../../de/d41/structast__mwi__subscriber.html">ast_mwi_subscriber</a> *&#160;</td>
          <td class="paramname"><em>sub</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Retrieve the stasis MWI topic subscription if available. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">sub</td><td>An MWI subscriber</td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">The</td><td>subscriber's stasis subscription </td></tr>
    <tr><td class="paramname">NULL</td><td>if no subscription available</td></tr>
  </table>
  </dd>
</dl>
<dl class="section since"><dt>Since</dt><dd>13.28.0 </dd>
<dd>
16.5.0 </dd></dl>

<p class="definition">Definition at line <a class="el" href="../../d6/db4/mwi_8c_source.html#l00272">272</a> of file <a class="el" href="../../d6/db4/mwi_8c_source.html">mwi.c</a>.</p>

<p class="reference">References <a class="el" href="../../dc/d1d/stasis__state_8c_source.html#l00513">stasis_state_subscriber_subscription()</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../d5/dfe/chan__sip_8c_source.html#l28499">add_peer_mwi_subs()</a>, <a class="el" href="../../d6/db4/mwi_8c_source.html#l00230">ast_mwi_subscribe_pool()</a>, and <a class="el" href="../../d8/d25/res__pjsip__mwi_8c_source.html#l00140">mwi_stasis_subscription_alloc()</a>.</p>
<div class="fragment"><div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;{</div><div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;   <span class="keywordflow">return</span> <a class="code" href="../../d1/d96/stasis__state_8h.html#aaf6aa9b3aba2f94825472d43f81ad284">stasis_state_subscriber_subscription</a>((<span class="keyword">struct</span> <a class="code" href="../../d7/d67/structstasis__state__subscriber.html">stasis_state_subscriber</a> *)sub);</div><div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;}</div><div class="ttc" id="stasis__state_8h_html_aaf6aa9b3aba2f94825472d43f81ad284"><div class="ttname"><a href="../../d1/d96/stasis__state_8h.html#aaf6aa9b3aba2f94825472d43f81ad284">stasis_state_subscriber_subscription</a></div><div class="ttdeci">struct stasis_subscription * stasis_state_subscriber_subscription(struct stasis_state_subscriber *sub)</div><div class="ttdoc">Retrieve the stasis topic subscription if available. </div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d1d/stasis__state_8c_source.html#l00513">stasis_state.c:513</a></div></div>
<div class="ttc" id="structstasis__state__subscriber_html"><div class="ttname"><a href="../../d7/d67/structstasis__state__subscriber.html">stasis_state_subscriber</a></div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d1d/stasis__state_8c_source.html#l00384">stasis_state.c:384</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a6e6d83f3d424c985a15ff60cbdb0be32"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6e6d83f3d424c985a15ff60cbdb0be32">&#9670;&nbsp;</a></span>ast_mwi_subscriber_topic()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="../../d9/d1d/structstasis__topic.html">stasis_topic</a>* ast_mwi_subscriber_topic </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="../../de/d41/structast__mwi__subscriber.html">ast_mwi_subscriber</a> *&#160;</td>
          <td class="paramname"><em>sub</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Retrieves the MWI subscriber's topic. </p>
<dl class="section note"><dt>Note</dt><dd>Returned topic's reference count is NOT incremented. However, the topic is guaranteed to live for the lifetime of the subscriber.</dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">sub</td><td>An MWI subscriber</td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">A</td><td>stasis topic subscribed to by the subscriber</td></tr>
  </table>
  </dd>
</dl>
<dl class="section since"><dt>Since</dt><dd>13.28.0 </dd>
<dd>
16.5.0 </dd></dl>

<p class="definition">Definition at line <a class="el" href="../../d6/db4/mwi_8c_source.html#l00259">259</a> of file <a class="el" href="../../d6/db4/mwi_8c_source.html">mwi.c</a>.</p>

<p class="reference">References <a class="el" href="../../dc/d1d/stasis__state_8c_source.html#l00492">stasis_state_subscriber_topic()</a>.</p>
<div class="fragment"><div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;{</div><div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;   <span class="keywordflow">return</span> <a class="code" href="../../d1/d96/stasis__state_8h.html#a904a0f91e443cb185f82e39512381974">stasis_state_subscriber_topic</a>((<span class="keyword">struct</span> <a class="code" href="../../d7/d67/structstasis__state__subscriber.html">stasis_state_subscriber</a> *)sub);</div><div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;}</div><div class="ttc" id="stasis__state_8h_html_a904a0f91e443cb185f82e39512381974"><div class="ttname"><a href="../../d1/d96/stasis__state_8h.html#a904a0f91e443cb185f82e39512381974">stasis_state_subscriber_topic</a></div><div class="ttdeci">struct stasis_topic * stasis_state_subscriber_topic(struct stasis_state_subscriber *sub)</div><div class="ttdoc">Retrieve the subscriber&amp;#39;s topic. </div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d1d/stasis__state_8c_source.html#l00492">stasis_state.c:492</a></div></div>
<div class="ttc" id="structstasis__state__subscriber_html"><div class="ttname"><a href="../../d7/d67/structstasis__state__subscriber.html">stasis_state_subscriber</a></div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d1d/stasis__state_8c_source.html#l00384">stasis_state.c:384</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a82c6cbb5215eec5348715e4824f5f575"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a82c6cbb5215eec5348715e4824f5f575">&#9670;&nbsp;</a></span>ast_mwi_unsubscribe()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void* ast_mwi_unsubscribe </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="../../de/d41/structast__mwi__subscriber.html">ast_mwi_subscriber</a> *&#160;</td>
          <td class="paramname"><em>sub</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Unsubscribe from the stasis topic and MWI. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">sub</td><td>An MWI subscriber</td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">NULL</td><td></td></tr>
  </table>
  </dd>
</dl>
<dl class="section since"><dt>Since</dt><dd>13.28.0 </dd>
<dd>
16.5.0 </dd></dl>

<p class="definition">Definition at line <a class="el" href="../../d6/db4/mwi_8c_source.html#l00249">249</a> of file <a class="el" href="../../d6/db4/mwi_8c_source.html">mwi.c</a>.</p>

<p class="reference">References <a class="el" href="../../dc/d1d/stasis__state_8c_source.html#l00470">stasis_state_unsubscribe()</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../d1/d97/chan__dahdi_8c_source.html#l05569">destroy_dahdi_pvt()</a>, <a class="el" href="../../d0/dd6/chan__mgcp_8c_source.html#l04539">destroy_endpoint()</a>, <a class="el" href="../../d5/dff/chan__iax2_8c_source.html#l12766">peer_destructor()</a>, and <a class="el" href="../../d0/d80/chan__skinny_8c_source.html#l08594">skinny_reload()</a>.</p>
<div class="fragment"><div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;{</div><div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;   <span class="keywordflow">return</span> <a class="code" href="../../d1/d96/stasis__state_8h.html#a479b995c5d232c9296809bff7216e37a">stasis_state_unsubscribe</a>((<span class="keyword">struct</span> <a class="code" href="../../d7/d67/structstasis__state__subscriber.html">stasis_state_subscriber</a> *)sub);</div><div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;}</div><div class="ttc" id="stasis__state_8h_html_a479b995c5d232c9296809bff7216e37a"><div class="ttname"><a href="../../d1/d96/stasis__state_8h.html#a479b995c5d232c9296809bff7216e37a">stasis_state_unsubscribe</a></div><div class="ttdeci">void * stasis_state_unsubscribe(struct stasis_state_subscriber *sub)</div><div class="ttdoc">Unsubscribe from the stasis topic and stasis state. </div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d1d/stasis__state_8c_source.html#l00470">stasis_state.c:470</a></div></div>
<div class="ttc" id="structstasis__state__subscriber_html"><div class="ttname"><a href="../../d7/d67/structstasis__state__subscriber.html">stasis_state_subscriber</a></div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d1d/stasis__state_8c_source.html#l00384">stasis_state.c:384</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="acf8d474c4029156d9c49a4ddea50d01b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#acf8d474c4029156d9c49a4ddea50d01b">&#9670;&nbsp;</a></span>ast_mwi_unsubscribe_and_join()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void* ast_mwi_unsubscribe_and_join </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="../../de/d41/structast__mwi__subscriber.html">ast_mwi_subscriber</a> *&#160;</td>
          <td class="paramname"><em>sub</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Unsubscribe from the stasis topic, block until the final message is received, and then unsubscribe from MWI. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">sub</td><td>An MWI subscriber</td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">NULL</td><td></td></tr>
  </table>
  </dd>
</dl>
<dl class="section since"><dt>Since</dt><dd>13.28.0 </dd>
<dd>
16.5.0 </dd></dl>

<p class="definition">Definition at line <a class="el" href="../../d6/db4/mwi_8c_source.html#l00254">254</a> of file <a class="el" href="../../d6/db4/mwi_8c_source.html">mwi.c</a>.</p>

<p class="reference">References <a class="el" href="../../dc/d1d/stasis__state_8c_source.html#l00477">stasis_state_unsubscribe_and_join()</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../d5/dfe/chan__sip_8c_source.html#l05275">destroy_mailbox()</a>, <a class="el" href="../../dd/de5/test__mwi_8c_source.html#l00125">subscriptions_destroy()</a>, <a class="el" href="../../d0/d80/chan__skinny_8c_source.html#l08748">unload_module()</a>, and <a class="el" href="../../d8/d25/res__pjsip__mwi_8c_source.html#l00573">unsubscribe_stasis()</a>.</p>
<div class="fragment"><div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;{</div><div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;   <span class="keywordflow">return</span> <a class="code" href="../../d1/d96/stasis__state_8h.html#a858f0158644f3bb53e1298c98a93f300">stasis_state_unsubscribe_and_join</a>((<span class="keyword">struct</span> <a class="code" href="../../d7/d67/structstasis__state__subscriber.html">stasis_state_subscriber</a> *)sub);</div><div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;}</div><div class="ttc" id="stasis__state_8h_html_a858f0158644f3bb53e1298c98a93f300"><div class="ttname"><a href="../../d1/d96/stasis__state_8h.html#a858f0158644f3bb53e1298c98a93f300">stasis_state_unsubscribe_and_join</a></div><div class="ttdeci">void * stasis_state_unsubscribe_and_join(struct stasis_state_subscriber *sub)</div><div class="ttdoc">Unsubscribe from the stasis topic, block until the final message is received, and then unsubscribe fr...</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d1d/stasis__state_8c_source.html#l00477">stasis_state.c:477</a></div></div>
<div class="ttc" id="structstasis__state__subscriber_html"><div class="ttname"><a href="../../d7/d67/structstasis__state__subscriber.html">stasis_state_subscriber</a></div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d1d/stasis__state_8c_source.html#l00384">stasis_state.c:384</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a889083170a9d78ccdbfbcb75406ed98d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a889083170a9d78ccdbfbcb75406ed98d">&#9670;&nbsp;</a></span>ast_publish_mwi_state_full()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ast_publish_mwi_state_full </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>mailbox</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>context</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>new_msgs</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>old_msgs</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>channel_id</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="../../d0/d86/structast__eid.html">ast_eid</a> *&#160;</td>
          <td class="paramname"><em>eid</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Publish a MWI state update via stasis with all parameters. </p>
<dl class="section since"><dt>Since</dt><dd>12 </dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">mailbox</td><td>The mailbox identifier string. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">context</td><td>The context this mailbox resides in (NULL or "" if only using mailbox) </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">new_msgs</td><td>The number of new messages in this mailbox </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">old_msgs</td><td>The number of old messages in this mailbox </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">channel_id</td><td>A unique identifier for a channel associated with this change in mailbox state </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">eid</td><td>The EID of the server that originally published the message</td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">0</td><td>Success </td></tr>
    <tr><td class="paramname">-1</td><td>Failure </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="../../d6/db4/mwi_8c_source.html#l00388">388</a> of file <a class="el" href="../../d6/db4/mwi_8c_source.html">mwi.c</a>.</p>

<p class="reference">References <a class="el" href="../../d6/db4/mwi_8c_source.html#l00370">ast_mwi_publish_by_mailbox()</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../dc/d7a/res__pjsip__publish__asterisk_8c_source.html#l00524">asterisk_publication_mailboxstate()</a>, <a class="el" href="../../d1/da4/res__corosync_8c_source.html#l00394">publish_mwi_to_stasis()</a>, and <a class="el" href="../../dc/d6b/res__xmpp_8c_source.html#l01461">xmpp_pubsub_handle_event()</a>.</p>
<div class="fragment"><div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;{</div><div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;   <span class="keywordflow">return</span> <a class="code" href="../../d6/db4/mwi_8c.html#afc860a1db2f223052313491d47116302">ast_mwi_publish_by_mailbox</a>(<a class="code" href="../../d0/dd6/chan__mgcp_8c.html#a6b49cafa2a3d359a2e865992f551874a">mailbox</a>, <a class="code" href="../../da/d45/chan__alsa_8c.html#ac25ea00ee3f082df06e0cf468cbde240">context</a>, 0, <a class="code" href="../../df/deb/group__StasisTopicsAndMessages.html#ga70de9f16a229e2c5bf1a973372949d3e">new_msgs</a>, <a class="code" href="../../df/deb/group__StasisTopicsAndMessages.html#ga4369ae7c984aba22ce6d0e92718f2b29">old_msgs</a>, channel_id, eid);</div><div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;}</div><div class="ttc" id="chan__mgcp_8c_html_a6b49cafa2a3d359a2e865992f551874a"><div class="ttname"><a href="../../d0/dd6/chan__mgcp_8c.html#a6b49cafa2a3d359a2e865992f551874a">mailbox</a></div><div class="ttdeci">static char mailbox[AST_MAX_MAILBOX_UNIQUEID]</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/dd6/chan__mgcp_8c_source.html#l00204">chan_mgcp.c:204</a></div></div>
<div class="ttc" id="group__StasisTopicsAndMessages_html_ga4369ae7c984aba22ce6d0e92718f2b29"><div class="ttname"><a href="../../df/deb/group__StasisTopicsAndMessages.html#ga4369ae7c984aba22ce6d0e92718f2b29">ast_mwi_state::old_msgs</a></div><div class="ttdeci">int old_msgs</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d33/mwi_8h_source.html#l00462">mwi.h:462</a></div></div>
<div class="ttc" id="mwi_8c_html_afc860a1db2f223052313491d47116302"><div class="ttname"><a href="../../d6/db4/mwi_8c.html#afc860a1db2f223052313491d47116302">ast_mwi_publish_by_mailbox</a></div><div class="ttdeci">int ast_mwi_publish_by_mailbox(const char *mailbox, const char *context, int urgent_msgs, int new_msgs, int old_msgs, const char *channel_id, struct ast_eid *eid)</div><div class="ttdoc">Publish MWI for the given mailbox. </div><div class="ttdef"><b>Definition:</b> <a href="../../d6/db4/mwi_8c_source.html#l00370">mwi.c:370</a></div></div>
<div class="ttc" id="group__StasisTopicsAndMessages_html_ga70de9f16a229e2c5bf1a973372949d3e"><div class="ttname"><a href="../../df/deb/group__StasisTopicsAndMessages.html#ga70de9f16a229e2c5bf1a973372949d3e">ast_mwi_state::new_msgs</a></div><div class="ttdeci">int new_msgs</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d33/mwi_8h_source.html#l00461">mwi.h:461</a></div></div>
<div class="ttc" id="chan__alsa_8c_html_ac25ea00ee3f082df06e0cf468cbde240"><div class="ttname"><a href="../../da/d45/chan__alsa_8c.html#ac25ea00ee3f082df06e0cf468cbde240">context</a></div><div class="ttdeci">static char context[AST_MAX_CONTEXT]</div><div class="ttdef"><b>Definition:</b> <a href="../../da/d45/chan__alsa_8c_source.html#l00116">chan_alsa.c:116</a></div></div>
</div><!-- fragment -->
</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Sun Aug 8 2021 19:46:08 for Asterisk - The Open Source Telephony Project by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="../../doxygen.png" alt="doxygen"/>
</a> 1.8.13
</small></address>
</body>
</html>
