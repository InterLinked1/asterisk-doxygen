<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Asterisk - The Open Source Telephony Project: res_xmpp.c Source File</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Asterisk - The Open Source Telephony Project
   &#160;<span id="projectnumber">18.5.0</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "../../search",false,'Search');
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('../../',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="../../dir_7b47cca4d318623bb4270ab1fb592ef5.html">res</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">res_xmpp.c</div>  </div>
</div><!--header-->
<div class="contents">
<a href="../../dc/d6b/res__xmpp_8c.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="comment">/*</span></div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="comment"> * Asterisk -- An open source telephony toolkit.</span></div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="comment"> * Copyright (C) 2012, Digium, Inc.</span></div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="comment"> * Joshua Colp &lt;jcolp@digium.com&gt;</span></div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="comment"> * See http://www.asterisk.org for more information about</span></div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="comment"> * the Asterisk project. Please do not directly contact</span></div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;<span class="comment"> * any of the maintainers of this project for assistance;</span></div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;<span class="comment"> * the project provides a web site, mailing lists and IRC</span></div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;<span class="comment"> * channels for your use.</span></div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;<span class="comment"> * This program is free software, distributed under the terms of</span></div><div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;<span class="comment"> * the GNU General Public License Version 2. See the LICENSE file</span></div><div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;<span class="comment"> * at the top of the source tree.</span></div><div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;<span class="comment">/*! \file</span></div><div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;<span class="comment"> * \brief XMPP client and component module.</span></div><div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;<span class="comment"> * \author Joshua Colp &lt;jcolp@digium.com&gt;</span></div><div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;<span class="comment"> * Iksemel http://code.google.com/p/iksemel/</span></div><div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;<span class="comment"> * A reference module for interfacting Asterisk directly as a client or component with</span></div><div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;<span class="comment"> * an XMPP/Jabber compliant server.</span></div><div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;<span class="comment"> * This module is based upon the original res_jabber as done by Matt O&#39;Gorman.</span></div><div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;<span class="comment">/*! \li \ref res_xmpp.c uses the configuration file \ref xmpp.conf and \ref jabber.conf</span></div><div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;<span class="comment"> * \addtogroup configuration_file Configuration Files</span></div><div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;<span class="comment">/*!</span></div><div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;<span class="comment"> * \page xmpp.conf xmpp.conf</span></div><div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;<span class="comment"> * \verbinclude xmpp.conf.sample</span></div><div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;</div><div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;<span class="comment">/*** MODULEINFO</span></div><div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;<span class="comment">   &lt;depend&gt;iksemel&lt;/depend&gt;</span></div><div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;<span class="comment">   &lt;use type=&quot;external&quot;&gt;openssl&lt;/use&gt;</span></div><div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;<span class="comment">   &lt;support_level&gt;core&lt;/support_level&gt;</span></div><div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;<span class="comment"> ***/</span></div><div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;</div><div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../db/db2/asterisk_8h.html">asterisk.h</a>&quot;</span></div><div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;</div><div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;<span class="preprocessor">#include &lt;ctype.h&gt;</span></div><div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;<span class="preprocessor">#include &lt;iksemel.h&gt;</span></div><div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;</div><div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../da/da0/xmpp_8h.html">asterisk/xmpp.h</a>&quot;</span></div><div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../d5/d16/module_8h.html">asterisk/module.h</a>&quot;</span></div><div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../db/d45/manager_8h.html">asterisk/manager.h</a>&quot;</span></div><div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../d3/d93/include_2asterisk_2app_8h.html">asterisk/app.h</a>&quot;</span></div><div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../dc/d33/mwi_8h.html">asterisk/mwi.h</a>&quot;</span></div><div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../d2/d0d/message_8h.html">asterisk/message.h</a>&quot;</span></div><div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../db/d45/manager_8h.html">asterisk/manager.h</a>&quot;</span></div><div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../dc/db0/cli_8h.html">asterisk/cli.h</a>&quot;</span></div><div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../db/dfe/config__options_8h.html">asterisk/config_options.h</a>&quot;</span></div><div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../d4/d05/json_8h.html">asterisk/json.h</a>&quot;</span></div><div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;</div><div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;<span class="comment">/*** DOCUMENTATION</span></div><div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;<span class="comment">   &lt;application name=&quot;JabberSend&quot; language=&quot;en_US&quot; module=&quot;res_xmpp&quot;&gt;</span></div><div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;<span class="comment">      &lt;synopsis&gt;</span></div><div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;<span class="comment">         Sends an XMPP message to a buddy.</span></div><div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;<span class="comment">      &lt;/synopsis&gt;</span></div><div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;<span class="comment">      &lt;syntax&gt;</span></div><div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;<span class="comment">         &lt;parameter name=&quot;account&quot; required=&quot;true&quot;&gt;</span></div><div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;<span class="comment">            &lt;para&gt;The local named account to listen on (specified in</span></div><div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;<span class="comment">            xmpp.conf)&lt;/para&gt;</span></div><div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;<span class="comment">         &lt;/parameter&gt;</span></div><div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;<span class="comment">         &lt;parameter name=&quot;jid&quot; required=&quot;true&quot;&gt;</span></div><div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;<span class="comment">            &lt;para&gt;Jabber ID of the buddy to send the message to. It can be a</span></div><div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;<span class="comment">            bare JID (username@domain) or a full JID (username@domain/resource).&lt;/para&gt;</span></div><div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;<span class="comment">         &lt;/parameter&gt;</span></div><div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;<span class="comment">         &lt;parameter name=&quot;message&quot; required=&quot;true&quot;&gt;</span></div><div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;<span class="comment">            &lt;para&gt;The message to send.&lt;/para&gt;</span></div><div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;<span class="comment">         &lt;/parameter&gt;</span></div><div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;<span class="comment">      &lt;/syntax&gt;</span></div><div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;<span class="comment">      &lt;description&gt;</span></div><div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;<span class="comment">         &lt;para&gt;Sends the content of &lt;replaceable&gt;message&lt;/replaceable&gt; as text message</span></div><div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;<span class="comment">         from the given &lt;replaceable&gt;account&lt;/replaceable&gt; to the buddy identified by</span></div><div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;<span class="comment">         &lt;replaceable&gt;jid&lt;/replaceable&gt;&lt;/para&gt;</span></div><div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;<span class="comment">         &lt;para&gt;Example: JabberSend(asterisk,bob@domain.com,Hello world) sends &quot;Hello world&quot;</span></div><div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;<span class="comment">         to &lt;replaceable&gt;bob@domain.com&lt;/replaceable&gt; as an XMPP message from the account</span></div><div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;<span class="comment">         &lt;replaceable&gt;asterisk&lt;/replaceable&gt;, configured in xmpp.conf.&lt;/para&gt;</span></div><div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;<span class="comment">      &lt;/description&gt;</span></div><div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;<span class="comment">      &lt;see-also&gt;</span></div><div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;<span class="comment">         &lt;ref type=&quot;function&quot; module=&quot;res_xmpp&quot;&gt;JABBER_STATUS&lt;/ref&gt;</span></div><div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;<span class="comment">         &lt;ref type=&quot;function&quot; module=&quot;res_xmpp&quot;&gt;JABBER_RECEIVE&lt;/ref&gt;</span></div><div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;<span class="comment">      &lt;/see-also&gt;</span></div><div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;<span class="comment">   &lt;/application&gt;</span></div><div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;<span class="comment">   &lt;function name=&quot;JABBER_RECEIVE&quot; language=&quot;en_US&quot; module=&quot;res_xmpp&quot;&gt;</span></div><div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;<span class="comment">      &lt;synopsis&gt;</span></div><div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;<span class="comment">         Reads XMPP messages.</span></div><div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;<span class="comment">      &lt;/synopsis&gt;</span></div><div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;<span class="comment">      &lt;syntax&gt;</span></div><div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;<span class="comment">         &lt;parameter name=&quot;account&quot; required=&quot;true&quot;&gt;</span></div><div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;<span class="comment">            &lt;para&gt;The local named account to listen on (specified in</span></div><div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;<span class="comment">            xmpp.conf)&lt;/para&gt;</span></div><div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;<span class="comment">         &lt;/parameter&gt;</span></div><div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;<span class="comment">         &lt;parameter name=&quot;jid&quot; required=&quot;true&quot;&gt;</span></div><div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;<span class="comment">            &lt;para&gt;Jabber ID of the buddy to receive message from. It can be a</span></div><div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;<span class="comment">            bare JID (username@domain) or a full JID (username@domain/resource).&lt;/para&gt;</span></div><div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;<span class="comment">         &lt;/parameter&gt;</span></div><div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;<span class="comment">         &lt;parameter name=&quot;timeout&quot;&gt;</span></div><div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;<span class="comment">            &lt;para&gt;In seconds, defaults to &lt;literal&gt;20&lt;/literal&gt;.&lt;/para&gt;</span></div><div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;<span class="comment">         &lt;/parameter&gt;</span></div><div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;<span class="comment">      &lt;/syntax&gt;</span></div><div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;<span class="comment">      &lt;description&gt;</span></div><div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;<span class="comment">         &lt;para&gt;Receives a text message on the given &lt;replaceable&gt;account&lt;/replaceable&gt;</span></div><div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;<span class="comment">         from the buddy identified by &lt;replaceable&gt;jid&lt;/replaceable&gt; and returns the contents.&lt;/para&gt;</span></div><div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;<span class="comment">         &lt;para&gt;Example: ${JABBER_RECEIVE(asterisk,bob@domain.com)} returns an XMPP message</span></div><div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;<span class="comment">         sent from &lt;replaceable&gt;bob@domain.com&lt;/replaceable&gt; (or nothing in case of a time out), to</span></div><div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;<span class="comment">         the &lt;replaceable&gt;asterisk&lt;/replaceable&gt; XMPP account configured in xmpp.conf.&lt;/para&gt;</span></div><div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;<span class="comment">      &lt;/description&gt;</span></div><div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;<span class="comment">      &lt;see-also&gt;</span></div><div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;<span class="comment">         &lt;ref type=&quot;function&quot; module=&quot;res_xmpp&quot;&gt;JABBER_STATUS&lt;/ref&gt;</span></div><div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;<span class="comment">         &lt;ref type=&quot;application&quot; module=&quot;res_xmpp&quot;&gt;JabberSend&lt;/ref&gt;</span></div><div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;<span class="comment">      &lt;/see-also&gt;</span></div><div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;<span class="comment">   &lt;/function&gt;</span></div><div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;<span class="comment">   &lt;function name=&quot;JABBER_STATUS&quot; language=&quot;en_US&quot; module=&quot;res_xmpp&quot;&gt;</span></div><div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;<span class="comment">      &lt;synopsis&gt;</span></div><div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;<span class="comment">         Retrieves a buddy&#39;s status.</span></div><div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;<span class="comment">      &lt;/synopsis&gt;</span></div><div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;<span class="comment">      &lt;syntax&gt;</span></div><div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;<span class="comment">         &lt;parameter name=&quot;account&quot; required=&quot;true&quot;&gt;</span></div><div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;<span class="comment">            &lt;para&gt;The local named account to listen on (specified in</span></div><div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;<span class="comment">            xmpp.conf)&lt;/para&gt;</span></div><div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;<span class="comment">         &lt;/parameter&gt;</span></div><div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;<span class="comment">         &lt;parameter name=&quot;jid&quot; required=&quot;true&quot;&gt;</span></div><div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;<span class="comment">            &lt;para&gt;Jabber ID of the buddy to receive message from. It can be a</span></div><div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;<span class="comment">            bare JID (username@domain) or a full JID (username@domain/resource).&lt;/para&gt;</span></div><div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;<span class="comment">         &lt;/parameter&gt;</span></div><div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;<span class="comment">      &lt;/syntax&gt;</span></div><div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;<span class="comment">      &lt;description&gt;</span></div><div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;<span class="comment">         &lt;para&gt;Retrieves the numeric status associated with the buddy identified</span></div><div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;<span class="comment">         by &lt;replaceable&gt;jid&lt;/replaceable&gt;. The return value will be one of the</span></div><div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;<span class="comment">         following.&lt;/para&gt;</span></div><div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;<span class="comment">         &lt;enumlist&gt;</span></div><div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;<span class="comment">            &lt;enum name=&quot;1&quot;&gt;</span></div><div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;<span class="comment">               &lt;para&gt;Online&lt;/para&gt;</span></div><div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;<span class="comment">            &lt;/enum&gt;</span></div><div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;<span class="comment">            &lt;enum name=&quot;2&quot;&gt;</span></div><div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;<span class="comment">               &lt;para&gt;Chatty&lt;/para&gt;</span></div><div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;<span class="comment">            &lt;/enum&gt;</span></div><div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;<span class="comment">            &lt;enum name=&quot;3&quot;&gt;</span></div><div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;<span class="comment">               &lt;para&gt;Away&lt;/para&gt;</span></div><div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;<span class="comment">            &lt;/enum&gt;</span></div><div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;<span class="comment">            &lt;enum name=&quot;4&quot;&gt;</span></div><div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;<span class="comment">               &lt;para&gt;Extended Away&lt;/para&gt;</span></div><div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;<span class="comment">            &lt;/enum&gt;</span></div><div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;<span class="comment">            &lt;enum name=&quot;5&quot;&gt;</span></div><div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;<span class="comment">               &lt;para&gt;Do Not Disturb&lt;/para&gt;</span></div><div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;<span class="comment">            &lt;/enum&gt;</span></div><div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;<span class="comment">            &lt;enum name=&quot;6&quot;&gt;</span></div><div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;<span class="comment">               &lt;para&gt;Offline&lt;/para&gt;</span></div><div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;<span class="comment">            &lt;/enum&gt;</span></div><div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;<span class="comment">            &lt;enum name=&quot;7&quot;&gt;</span></div><div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;<span class="comment">               &lt;para&gt;Not In Roster&lt;/para&gt;</span></div><div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;<span class="comment">            &lt;/enum&gt;</span></div><div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;<span class="comment">         &lt;/enumlist&gt;</span></div><div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;<span class="comment">      &lt;/description&gt;</span></div><div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;<span class="comment">      &lt;see-also&gt;</span></div><div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;<span class="comment">         &lt;ref type=&quot;function&quot; module=&quot;res_xmpp&quot;&gt;JABBER_RECEIVE&lt;/ref&gt;</span></div><div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;<span class="comment">         &lt;ref type=&quot;application&quot; module=&quot;res_xmpp&quot;&gt;JabberSend&lt;/ref&gt;</span></div><div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;<span class="comment">      &lt;/see-also&gt;</span></div><div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;<span class="comment">   &lt;/function&gt;</span></div><div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;<span class="comment">   &lt;application name=&quot;JabberSendGroup&quot; language=&quot;en_US&quot; module=&quot;res_xmpp&quot;&gt;</span></div><div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;<span class="comment">      &lt;synopsis&gt;</span></div><div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;<span class="comment">         Send a Jabber Message to a specified chat room</span></div><div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;<span class="comment">      &lt;/synopsis&gt;</span></div><div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;<span class="comment">      &lt;syntax&gt;</span></div><div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;<span class="comment">         &lt;parameter name=&quot;Jabber&quot; required=&quot;true&quot;&gt;</span></div><div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;<span class="comment">            &lt;para&gt;Client or transport Asterisk uses to connect to Jabber.&lt;/para&gt;</span></div><div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;<span class="comment">         &lt;/parameter&gt;</span></div><div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;<span class="comment">         &lt;parameter name=&quot;RoomJID&quot; required=&quot;true&quot;&gt;</span></div><div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;<span class="comment">            &lt;para&gt;XMPP/Jabber JID (Name) of chat room.&lt;/para&gt;</span></div><div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;<span class="comment">         &lt;/parameter&gt;</span></div><div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;<span class="comment">         &lt;parameter name=&quot;Message&quot; required=&quot;true&quot;&gt;</span></div><div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;<span class="comment">            &lt;para&gt;Message to be sent to the chat room.&lt;/para&gt;</span></div><div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;<span class="comment">         &lt;/parameter&gt;</span></div><div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;<span class="comment">         &lt;parameter name=&quot;Nickname&quot; required=&quot;false&quot;&gt;</span></div><div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;<span class="comment">            &lt;para&gt;The nickname Asterisk uses in the chat room.&lt;/para&gt;</span></div><div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;<span class="comment">         &lt;/parameter&gt;</span></div><div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;<span class="comment">      &lt;/syntax&gt;</span></div><div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;<span class="comment">      &lt;description&gt;</span></div><div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;<span class="comment">         &lt;para&gt;Allows user to send a message to a chat room via XMPP.&lt;/para&gt;</span></div><div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;<span class="comment">         &lt;note&gt;&lt;para&gt;To be able to send messages to a chat room, a user must have previously joined it. Use the &lt;replaceable&gt;JabberJoin&lt;/replaceable&gt; function to do so.&lt;/para&gt;&lt;/note&gt;</span></div><div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;<span class="comment">      &lt;/description&gt;</span></div><div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;<span class="comment">   &lt;/application&gt;</span></div><div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;<span class="comment">   &lt;application name=&quot;JabberJoin&quot; language=&quot;en_US&quot; module=&quot;res_xmpp&quot;&gt;</span></div><div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;<span class="comment">      &lt;synopsis&gt;</span></div><div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;<span class="comment">         Join a chat room</span></div><div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;<span class="comment">      &lt;/synopsis&gt;</span></div><div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;<span class="comment">      &lt;syntax&gt;</span></div><div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;<span class="comment">         &lt;parameter name=&quot;Jabber&quot; required=&quot;true&quot;&gt;</span></div><div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;<span class="comment">            &lt;para&gt;Client or transport Asterisk uses to connect to Jabber.&lt;/para&gt;</span></div><div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;<span class="comment">         &lt;/parameter&gt;</span></div><div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;<span class="comment">         &lt;parameter name=&quot;RoomJID&quot; required=&quot;true&quot;&gt;</span></div><div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;<span class="comment">            &lt;para&gt;XMPP/Jabber JID (Name) of chat room.&lt;/para&gt;</span></div><div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;<span class="comment">         &lt;/parameter&gt;</span></div><div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;<span class="comment">         &lt;parameter name=&quot;Nickname&quot; required=&quot;false&quot;&gt;</span></div><div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;<span class="comment">            &lt;para&gt;The nickname Asterisk will use in the chat room.&lt;/para&gt;</span></div><div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;<span class="comment">            &lt;note&gt;&lt;para&gt;If a different nickname is supplied to an already joined room, the old nick will be changed to the new one.&lt;/para&gt;&lt;/note&gt;</span></div><div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;<span class="comment">         &lt;/parameter&gt;</span></div><div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;<span class="comment">      &lt;/syntax&gt;</span></div><div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;<span class="comment">      &lt;description&gt;</span></div><div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;<span class="comment">         &lt;para&gt;Allows Asterisk to join a chat room.&lt;/para&gt;</span></div><div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;<span class="comment">      &lt;/description&gt;</span></div><div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;<span class="comment">   &lt;/application&gt;</span></div><div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;<span class="comment">   &lt;application name=&quot;JabberLeave&quot; language=&quot;en_US&quot; module=&quot;res_xmpp&quot;&gt;</span></div><div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;<span class="comment">      &lt;synopsis&gt;</span></div><div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;<span class="comment">         Leave a chat room</span></div><div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;<span class="comment">      &lt;/synopsis&gt;</span></div><div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;<span class="comment">      &lt;syntax&gt;</span></div><div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;<span class="comment">         &lt;parameter name=&quot;Jabber&quot; required=&quot;true&quot;&gt;</span></div><div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;<span class="comment">            &lt;para&gt;Client or transport Asterisk uses to connect to Jabber.&lt;/para&gt;</span></div><div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;<span class="comment">         &lt;/parameter&gt;</span></div><div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;<span class="comment">         &lt;parameter name=&quot;RoomJID&quot; required=&quot;true&quot;&gt;</span></div><div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;<span class="comment">            &lt;para&gt;XMPP/Jabber JID (Name) of chat room.&lt;/para&gt;</span></div><div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;<span class="comment">         &lt;/parameter&gt;</span></div><div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;<span class="comment">         &lt;parameter name=&quot;Nickname&quot; required=&quot;false&quot;&gt;</span></div><div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;<span class="comment">            &lt;para&gt;The nickname Asterisk uses in the chat room.&lt;/para&gt;</span></div><div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;<span class="comment">         &lt;/parameter&gt;</span></div><div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;<span class="comment">      &lt;/syntax&gt;</span></div><div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;<span class="comment">      &lt;description&gt;</span></div><div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;<span class="comment">         &lt;para&gt;Allows Asterisk to leave a chat room.&lt;/para&gt;</span></div><div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;<span class="comment">      &lt;/description&gt;</span></div><div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;<span class="comment">   &lt;/application&gt;</span></div><div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;<span class="comment">   &lt;manager name=&quot;JabberSend&quot; language=&quot;en_US&quot; module=&quot;res_xmpp&quot;&gt;</span></div><div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;<span class="comment">      &lt;synopsis&gt;</span></div><div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;<span class="comment">         Sends a message to a Jabber Client.</span></div><div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;<span class="comment">      &lt;/synopsis&gt;</span></div><div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;<span class="comment">      &lt;syntax&gt;</span></div><div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;<span class="comment">         &lt;xi:include xpointer=&quot;xpointer(/docs/manager[@name=&#39;Login&#39;]/syntax/parameter[@name=&#39;ActionID&#39;])&quot; /&gt;</span></div><div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;<span class="comment">         &lt;parameter name=&quot;Jabber&quot; required=&quot;true&quot;&gt;</span></div><div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;<span class="comment">            &lt;para&gt;Client or transport Asterisk uses to connect to JABBER.&lt;/para&gt;</span></div><div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;<span class="comment">         &lt;/parameter&gt;</span></div><div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;<span class="comment">         &lt;parameter name=&quot;JID&quot; required=&quot;true&quot;&gt;</span></div><div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;<span class="comment">            &lt;para&gt;XMPP/Jabber JID (Name) of recipient.&lt;/para&gt;</span></div><div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;<span class="comment">         &lt;/parameter&gt;</span></div><div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;<span class="comment">         &lt;parameter name=&quot;Message&quot; required=&quot;true&quot;&gt;</span></div><div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;<span class="comment">            &lt;para&gt;Message to be sent to the buddy.&lt;/para&gt;</span></div><div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;<span class="comment">         &lt;/parameter&gt;</span></div><div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;<span class="comment">      &lt;/syntax&gt;</span></div><div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;<span class="comment">      &lt;description&gt;</span></div><div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;<span class="comment">         &lt;para&gt;Sends a message to a Jabber Client.&lt;/para&gt;</span></div><div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;<span class="comment">      &lt;/description&gt;</span></div><div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;<span class="comment">   &lt;/manager&gt;</span></div><div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;<span class="comment">   &lt;info name=&quot;MessageDestinationInfo&quot; language=&quot;en_US&quot; tech=&quot;XMPP&quot;&gt;</span></div><div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;<span class="comment">      &lt;para&gt;Specifying a prefix of &lt;literal&gt;xmpp:&lt;/literal&gt; will send the</span></div><div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;<span class="comment">      message as an XMPP chat message.&lt;/para&gt;</span></div><div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;<span class="comment">   &lt;/info&gt;</span></div><div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;<span class="comment">   &lt;info name=&quot;MessageFromInfo&quot; language=&quot;en_US&quot; tech=&quot;XMPP&quot;&gt;</span></div><div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;<span class="comment">      &lt;para&gt;Specifying a prefix of &lt;literal&gt;xmpp:&lt;/literal&gt; will specify the</span></div><div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;<span class="comment">      account defined in &lt;literal&gt;xmpp.conf&lt;/literal&gt; to send the message from.</span></div><div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;<span class="comment">      Note that this field is required for XMPP messages.&lt;/para&gt;</span></div><div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;<span class="comment">   &lt;/info&gt;</span></div><div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;<span class="comment">   &lt;info name=&quot;MessageToInfo&quot; language=&quot;en_US&quot; tech=&quot;XMPP&quot;&gt;</span></div><div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;<span class="comment">      &lt;para&gt;Ignored&lt;/para&gt;</span></div><div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;<span class="comment">   &lt;/info&gt;</span></div><div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;<span class="comment">   &lt;configInfo name=&quot;res_xmpp&quot; language=&quot;en_US&quot;&gt;</span></div><div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;<span class="comment">      &lt;synopsis&gt;XMPP Messaging&lt;/synopsis&gt;</span></div><div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;<span class="comment">      &lt;configFile name=&quot;xmpp.conf&quot;&gt;</span></div><div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;<span class="comment">         &lt;configObject name=&quot;global&quot;&gt;</span></div><div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;<span class="comment">            &lt;synopsis&gt;Global configuration settings&lt;/synopsis&gt;</span></div><div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;<span class="comment">            &lt;configOption name=&quot;debug&quot;&gt;</span></div><div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;<span class="comment">               &lt;synopsis&gt;Enable/disable XMPP message debugging&lt;/synopsis&gt;</span></div><div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;<span class="comment">            &lt;/configOption&gt;</span></div><div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;<span class="comment">            &lt;configOption name=&quot;autoprune&quot;&gt;</span></div><div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;<span class="comment">               &lt;synopsis&gt;Auto-remove users from buddy list.&lt;/synopsis&gt;</span></div><div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;<span class="comment">               &lt;description&gt;&lt;para&gt;Auto-remove users from buddy list. Depending on the setup</span></div><div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;<span class="comment">               (e.g., using your personal Gtalk account for a test) this could cause loss of</span></div><div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;<span class="comment">               the contact list.</span></div><div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;<span class="comment">               &lt;/para&gt;&lt;/description&gt;</span></div><div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;<span class="comment">            &lt;/configOption&gt;</span></div><div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;<span class="comment">            &lt;configOption name=&quot;autoregister&quot;&gt;</span></div><div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;<span class="comment">               &lt;synopsis&gt;Auto-register users from buddy list&lt;/synopsis&gt;</span></div><div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;<span class="comment">            &lt;/configOption&gt;</span></div><div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;<span class="comment">            &lt;configOption name=&quot;collection_nodes&quot;&gt;</span></div><div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;<span class="comment">               &lt;synopsis&gt;Enable support for XEP-0248 for use with distributed device state&lt;/synopsis&gt;</span></div><div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;<span class="comment">            &lt;/configOption&gt;</span></div><div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;<span class="comment">            &lt;configOption name=&quot;pubsub_autocreate&quot;&gt;</span></div><div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;<span class="comment">               &lt;synopsis&gt;Whether or not the PubSub server supports/is using auto-create for nodes&lt;/synopsis&gt;</span></div><div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;<span class="comment">            &lt;/configOption&gt;</span></div><div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;<span class="comment">            &lt;configOption name=&quot;auth_policy&quot;&gt;</span></div><div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;<span class="comment">               &lt;synopsis&gt;Whether to automatically accept or deny users&#39; subscription requests&lt;/synopsis&gt;</span></div><div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;<span class="comment">            &lt;/configOption&gt;</span></div><div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;<span class="comment">         &lt;/configObject&gt;</span></div><div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;<span class="comment">         &lt;configObject name=&quot;client&quot;&gt;</span></div><div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;<span class="comment">            &lt;synopsis&gt;Configuration options for an XMPP client&lt;/synopsis&gt;</span></div><div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;<span class="comment">            &lt;configOption name=&quot;username&quot;&gt;</span></div><div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;<span class="comment">               &lt;synopsis&gt;XMPP username with optional resource&lt;/synopsis&gt;</span></div><div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;<span class="comment">            &lt;/configOption&gt;</span></div><div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;<span class="comment">            &lt;configOption name=&quot;secret&quot;&gt;</span></div><div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;<span class="comment">               &lt;synopsis&gt;XMPP password&lt;/synopsis&gt;</span></div><div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;<span class="comment">            &lt;/configOption&gt;</span></div><div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;<span class="comment">            &lt;configOption name=&quot;refresh_token&quot;&gt;</span></div><div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;<span class="comment">               &lt;synopsis&gt;Google OAuth 2.0 refresh token&lt;/synopsis&gt;</span></div><div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;<span class="comment">            &lt;/configOption&gt;</span></div><div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;<span class="comment">            &lt;configOption name=&quot;oauth_clientid&quot;&gt;</span></div><div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;<span class="comment">               &lt;synopsis&gt;Google OAuth 2.0 application&#39;s client id&lt;/synopsis&gt;</span></div><div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;<span class="comment">            &lt;/configOption&gt;</span></div><div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;<span class="comment">            &lt;configOption name=&quot;oauth_secret&quot;&gt;</span></div><div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;<span class="comment">               &lt;synopsis&gt;Google OAuth 2.0 application&#39;s secret&lt;/synopsis&gt;</span></div><div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;<span class="comment">            &lt;/configOption&gt;</span></div><div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;<span class="comment">            &lt;configOption name=&quot;serverhost&quot;&gt;</span></div><div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;<span class="comment">               &lt;synopsis&gt;Route to server, e.g. talk.google.com&lt;/synopsis&gt;</span></div><div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;<span class="comment">            &lt;/configOption&gt;</span></div><div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;<span class="comment">            &lt;configOption name=&quot;statusmessage&quot;&gt;</span></div><div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;<span class="comment">               &lt;synopsis&gt;Custom status message&lt;/synopsis&gt;</span></div><div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;<span class="comment">            &lt;/configOption&gt;</span></div><div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;<span class="comment">            &lt;configOption name=&quot;pubsub_node&quot;&gt;</span></div><div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;<span class="comment">               &lt;synopsis&gt;Node for publishing events via PubSub&lt;/synopsis&gt;</span></div><div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;<span class="comment">            &lt;/configOption&gt;</span></div><div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;<span class="comment">            &lt;configOption name=&quot;context&quot;&gt;</span></div><div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;<span class="comment">               &lt;synopsis&gt;Dialplan context to send incoming messages to&lt;/synopsis&gt;</span></div><div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;<span class="comment">            &lt;/configOption&gt;</span></div><div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;<span class="comment">            &lt;configOption name=&quot;priority&quot;&gt;</span></div><div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;<span class="comment">               &lt;synopsis&gt;XMPP resource priority&lt;/synopsis&gt;</span></div><div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;<span class="comment">            &lt;/configOption&gt;</span></div><div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;<span class="comment">            &lt;configOption name=&quot;port&quot;&gt;</span></div><div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;<span class="comment">               &lt;synopsis&gt;XMPP server port&lt;/synopsis&gt;</span></div><div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;<span class="comment">            &lt;/configOption&gt;</span></div><div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;<span class="comment">            &lt;configOption name=&quot;timeout&quot;&gt;</span></div><div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;<span class="comment">               &lt;synopsis&gt;Timeout in seconds to hold incoming messages&lt;/synopsis&gt;</span></div><div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;<span class="comment">               &lt;description&gt;&lt;para&gt;Timeout (in seconds) on the message stack. Messages stored longer</span></div><div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;<span class="comment">               than this value will be deleted by Asterisk. This option applies to incoming messages only</span></div><div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;<span class="comment">               which are intended to be processed by the &lt;literal&gt;JABBER_RECEIVE&lt;/literal&gt; dialplan function.</span></div><div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;<span class="comment">               &lt;/para&gt;&lt;/description&gt;</span></div><div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;<span class="comment">            &lt;/configOption&gt;</span></div><div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;<span class="comment">            &lt;configOption name=&quot;debug&quot;&gt;</span></div><div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;<span class="comment">               &lt;synopsis&gt;Enable debugging&lt;/synopsis&gt;</span></div><div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;<span class="comment">            &lt;/configOption&gt;</span></div><div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;<span class="comment">            &lt;configOption name=&quot;type&quot;&gt;</span></div><div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;<span class="comment">               &lt;synopsis&gt;Connection is either a client or a component&lt;/synopsis&gt;</span></div><div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;<span class="comment">            &lt;/configOption&gt;</span></div><div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;<span class="comment">            &lt;configOption name=&quot;distribute_events&quot;&gt;</span></div><div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;<span class="comment">               &lt;synopsis&gt;Whether or not to distribute events using this connection&lt;/synopsis&gt;</span></div><div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;<span class="comment">            &lt;/configOption&gt;</span></div><div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;<span class="comment">            &lt;configOption name=&quot;usetls&quot;&gt;</span></div><div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;<span class="comment">               &lt;synopsis&gt;Whether to use TLS for the connection or not&lt;/synopsis&gt;</span></div><div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;<span class="comment">            &lt;/configOption&gt;</span></div><div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;<span class="comment">            &lt;configOption name=&quot;usesasl&quot;&gt;</span></div><div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;<span class="comment">               &lt;synopsis&gt;Whether to use SASL for the connection or not&lt;/synopsis&gt;</span></div><div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;<span class="comment">            &lt;/configOption&gt;</span></div><div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;<span class="comment">            &lt;configOption name=&quot;forceoldssl&quot;&gt;</span></div><div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;<span class="comment">               &lt;synopsis&gt;Force the use of old-style SSL for the connection&lt;/synopsis&gt;</span></div><div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;<span class="comment">            &lt;/configOption&gt;</span></div><div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;<span class="comment">            &lt;configOption name=&quot;keepalive&quot;&gt;</span></div><div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;<span class="comment">               &lt;synopsis&gt;If enabled, periodically send an XMPP message from this client with an empty message&lt;/synopsis&gt;</span></div><div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;<span class="comment">            &lt;/configOption&gt;</span></div><div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;<span class="comment">            &lt;configOption name=&quot;autoprune&quot;&gt;</span></div><div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;<span class="comment">               &lt;synopsis&gt;Auto-remove users from buddy list.&lt;/synopsis&gt;</span></div><div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;<span class="comment">               &lt;description&gt;&lt;para&gt;Auto-remove users from buddy list. Depending on the setup</span></div><div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;<span class="comment">               (e.g., using your personal Gtalk account for a test) this could cause loss of</span></div><div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;<span class="comment">               the contact list.</span></div><div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;<span class="comment">               &lt;/para&gt;&lt;/description&gt;</span></div><div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;<span class="comment">            &lt;/configOption&gt;</span></div><div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;<span class="comment">            &lt;configOption name=&quot;autoregister&quot;&gt;</span></div><div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;<span class="comment">               &lt;synopsis&gt;Auto-register users bfrom buddy list&lt;/synopsis&gt;</span></div><div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;<span class="comment">            &lt;/configOption&gt;</span></div><div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;<span class="comment">            &lt;configOption name=&quot;auth_policy&quot;&gt;</span></div><div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;<span class="comment">               &lt;synopsis&gt;Whether to automatically accept or deny users&#39; subscription requests&lt;/synopsis&gt;</span></div><div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;<span class="comment">            &lt;/configOption&gt;</span></div><div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;<span class="comment">            &lt;configOption name=&quot;sendtodialplan&quot;&gt;</span></div><div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;<span class="comment">               &lt;synopsis&gt;Send incoming messages into the dialplan&lt;/synopsis&gt;</span></div><div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;<span class="comment">            &lt;/configOption&gt;</span></div><div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;<span class="comment">            &lt;configOption name=&quot;status&quot;&gt;</span></div><div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;<span class="comment">               &lt;synopsis&gt;Default XMPP status for the client&lt;/synopsis&gt;</span></div><div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;<span class="comment">               &lt;description&gt;&lt;para&gt;Can be one of the following XMPP statuses:&lt;/para&gt;</span></div><div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;<span class="comment">                  &lt;enumlist&gt;</span></div><div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;<span class="comment">                     &lt;enum name=&quot;chat&quot;/&gt;</span></div><div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;<span class="comment">                     &lt;enum name=&quot;available&quot;/&gt;</span></div><div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;<span class="comment">                     &lt;enum name=&quot;away&quot;/&gt;</span></div><div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;<span class="comment">                     &lt;enum name=&quot;xaway&quot;/&gt;</span></div><div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;<span class="comment">                     &lt;enum name=&quot;dnd&quot;/&gt;</span></div><div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;<span class="comment">                  &lt;/enumlist&gt;</span></div><div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;<span class="comment">               &lt;/description&gt;</span></div><div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;<span class="comment">            &lt;/configOption&gt;</span></div><div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;<span class="comment">            &lt;configOption name=&quot;buddy&quot;&gt;</span></div><div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;<span class="comment">               &lt;synopsis&gt;Manual addition of buddy to list&lt;/synopsis&gt;</span></div><div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;<span class="comment">               &lt;description&gt;&lt;para&gt;</span></div><div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;<span class="comment">               Manual addition of buddy to the buddy list. For distributed events, these budies are</span></div><div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;<span class="comment">               automatically added in the whitelist as &#39;owners&#39; of the node(s).</span></div><div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;<span class="comment">               &lt;/para&gt;&lt;/description&gt;</span></div><div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;<span class="comment">            &lt;/configOption&gt;</span></div><div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;<span class="comment">         &lt;/configObject&gt;</span></div><div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;<span class="comment">      &lt;/configFile&gt;</span></div><div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;<span class="comment">   &lt;/configInfo&gt;</span></div><div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;<span class="comment">***/</span></div><div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;<span class="comment">/*! \brief Supported general configuration flags */</span></div><div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;<span class="keyword">enum</span> {</div><div class="line"><a name="l00399"></a><span class="lineno"><a class="line" href="../../dc/d6b/res__xmpp_8c.html#aa3759d2ddcc12f3f5ef5a8a3ffa4a4dfa56b0aacbe6240e563e08310d1b6c8ce2">  399</a></span>&#160;   <a class="code" href="../../dc/d6b/res__xmpp_8c.html#aa3759d2ddcc12f3f5ef5a8a3ffa4a4dfa56b0aacbe6240e563e08310d1b6c8ce2">XMPP_AUTOPRUNE</a> = (1 &lt;&lt; 0),</div><div class="line"><a name="l00400"></a><span class="lineno"><a class="line" href="../../dc/d6b/res__xmpp_8c.html#aa3759d2ddcc12f3f5ef5a8a3ffa4a4dfa18ce12342ffe1b2f00bb53be6a87665d">  400</a></span>&#160;   <a class="code" href="../../dc/d6b/res__xmpp_8c.html#aa3759d2ddcc12f3f5ef5a8a3ffa4a4dfa18ce12342ffe1b2f00bb53be6a87665d">XMPP_AUTOREGISTER</a> = (1 &lt;&lt; 1),</div><div class="line"><a name="l00401"></a><span class="lineno"><a class="line" href="../../dc/d6b/res__xmpp_8c.html#aa3759d2ddcc12f3f5ef5a8a3ffa4a4dfa8c4cc198db356150269f85b0339f00bf">  401</a></span>&#160;   <a class="code" href="../../dc/d6b/res__xmpp_8c.html#aa3759d2ddcc12f3f5ef5a8a3ffa4a4dfa8c4cc198db356150269f85b0339f00bf">XMPP_AUTOACCEPT</a> = (1 &lt;&lt; 2),</div><div class="line"><a name="l00402"></a><span class="lineno"><a class="line" href="../../dc/d6b/res__xmpp_8c.html#aa3759d2ddcc12f3f5ef5a8a3ffa4a4dfa94811fda886cb2affbcb7a810dff8eb7">  402</a></span>&#160;   <a class="code" href="../../dc/d6b/res__xmpp_8c.html#aa3759d2ddcc12f3f5ef5a8a3ffa4a4dfa94811fda886cb2affbcb7a810dff8eb7">XMPP_DEBUG</a> = (1 &lt;&lt; 3),</div><div class="line"><a name="l00403"></a><span class="lineno"><a class="line" href="../../dc/d6b/res__xmpp_8c.html#aa3759d2ddcc12f3f5ef5a8a3ffa4a4dfa2ee5bcbb4cbb964175aaddb7bf70c0cb">  403</a></span>&#160;   <a class="code" href="../../dc/d6b/res__xmpp_8c.html#aa3759d2ddcc12f3f5ef5a8a3ffa4a4dfa2ee5bcbb4cbb964175aaddb7bf70c0cb">XMPP_USETLS</a> = (1 &lt;&lt; 4),</div><div class="line"><a name="l00404"></a><span class="lineno"><a class="line" href="../../dc/d6b/res__xmpp_8c.html#aa3759d2ddcc12f3f5ef5a8a3ffa4a4dfa7f963ec64d83b0ef771bb7d34a49dc34">  404</a></span>&#160;   <a class="code" href="../../dc/d6b/res__xmpp_8c.html#aa3759d2ddcc12f3f5ef5a8a3ffa4a4dfa7f963ec64d83b0ef771bb7d34a49dc34">XMPP_USESASL</a> = (1 &lt;&lt; 5),</div><div class="line"><a name="l00405"></a><span class="lineno"><a class="line" href="../../dc/d6b/res__xmpp_8c.html#aa3759d2ddcc12f3f5ef5a8a3ffa4a4dfa74ecf707a853e6e98644728f19c98b3f">  405</a></span>&#160;   <a class="code" href="../../dc/d6b/res__xmpp_8c.html#aa3759d2ddcc12f3f5ef5a8a3ffa4a4dfa74ecf707a853e6e98644728f19c98b3f">XMPP_FORCESSL</a> = (1 &lt;&lt; 6),</div><div class="line"><a name="l00406"></a><span class="lineno"><a class="line" href="../../dc/d6b/res__xmpp_8c.html#aa3759d2ddcc12f3f5ef5a8a3ffa4a4dfac4a9cd4f07050cadcb19c07c6d3bf30f">  406</a></span>&#160;   <a class="code" href="../../dc/d6b/res__xmpp_8c.html#aa3759d2ddcc12f3f5ef5a8a3ffa4a4dfac4a9cd4f07050cadcb19c07c6d3bf30f">XMPP_KEEPALIVE</a> = (1 &lt;&lt; 7),</div><div class="line"><a name="l00407"></a><span class="lineno"><a class="line" href="../../dc/d6b/res__xmpp_8c.html#aa3759d2ddcc12f3f5ef5a8a3ffa4a4dfadc3efad94dcc216c29d42b23edcb2d00">  407</a></span>&#160;   <a class="code" href="../../dc/d6b/res__xmpp_8c.html#aa3759d2ddcc12f3f5ef5a8a3ffa4a4dfadc3efad94dcc216c29d42b23edcb2d00">XMPP_COMPONENT</a> = (1 &lt;&lt; 8),</div><div class="line"><a name="l00408"></a><span class="lineno"><a class="line" href="../../dc/d6b/res__xmpp_8c.html#aa3759d2ddcc12f3f5ef5a8a3ffa4a4dfae6af6fd94e006a677047e6caa56c9651">  408</a></span>&#160;   <a class="code" href="../../dc/d6b/res__xmpp_8c.html#aa3759d2ddcc12f3f5ef5a8a3ffa4a4dfae6af6fd94e006a677047e6caa56c9651">XMPP_SEND_TO_DIALPLAN</a> = (1 &lt;&lt; 9),</div><div class="line"><a name="l00409"></a><span class="lineno"><a class="line" href="../../dc/d6b/res__xmpp_8c.html#aa3759d2ddcc12f3f5ef5a8a3ffa4a4dfa29cbc9cdcca6e5b12165e01cab18438a">  409</a></span>&#160;   <a class="code" href="../../dc/d6b/res__xmpp_8c.html#aa3759d2ddcc12f3f5ef5a8a3ffa4a4dfa29cbc9cdcca6e5b12165e01cab18438a">XMPP_DISTRIBUTE_EVENTS</a> = (1 &lt;&lt; 10),</div><div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;};</div><div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;<span class="comment">/*! \brief Supported pubsub configuration flags */</span></div><div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;<span class="keyword">enum</span> {</div><div class="line"><a name="l00414"></a><span class="lineno"><a class="line" href="../../dc/d6b/res__xmpp_8c.html#ac5b95f02723021833cc47477b06a962ca045d4dbda72ca97ef5ef8c383279d7dc">  414</a></span>&#160;   <a class="code" href="../../dc/d6b/res__xmpp_8c.html#ac5b95f02723021833cc47477b06a962ca045d4dbda72ca97ef5ef8c383279d7dc">XMPP_XEP0248</a> = (1 &lt;&lt; 0),</div><div class="line"><a name="l00415"></a><span class="lineno"><a class="line" href="../../dc/d6b/res__xmpp_8c.html#ac5b95f02723021833cc47477b06a962ca2dbcf8f03775f69e9fd4b9dbab076ce9">  415</a></span>&#160;   <a class="code" href="../../dc/d6b/res__xmpp_8c.html#ac5b95f02723021833cc47477b06a962ca2dbcf8f03775f69e9fd4b9dbab076ce9">XMPP_PUBSUB</a> = (1 &lt;&lt; 1),</div><div class="line"><a name="l00416"></a><span class="lineno"><a class="line" href="../../dc/d6b/res__xmpp_8c.html#ac5b95f02723021833cc47477b06a962ca78acf22c4ab1b2450bf154c89e82d065">  416</a></span>&#160;   <a class="code" href="../../dc/d6b/res__xmpp_8c.html#ac5b95f02723021833cc47477b06a962ca78acf22c4ab1b2450bf154c89e82d065">XMPP_PUBSUB_AUTOCREATE</a> = (1 &lt;&lt; 2),</div><div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;};</div><div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;<span class="comment">/*! \brief Number of buckets for client connections */</span></div><div class="line"><a name="l00420"></a><span class="lineno"><a class="line" href="../../dc/d6b/res__xmpp_8c.html#a4cfa0e72bbddef0f8812a84404e3b727">  420</a></span>&#160;<span class="preprocessor">#define CLIENT_BUCKETS 53</span></div><div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;<span class="comment">/*! \brief Number of buckets for buddies (per client) */</span></div><div class="line"><a name="l00423"></a><span class="lineno"><a class="line" href="../../dc/d6b/res__xmpp_8c.html#aa62316b52aedcca330fd1113c1f3c97e">  423</a></span>&#160;<span class="preprocessor">#define BUDDY_BUCKETS 53</span></div><div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;<span class="comment">/*! \brief Number of buckets for resources (per buddy) */</span></div><div class="line"><a name="l00426"></a><span class="lineno"><a class="line" href="../../dc/d6b/res__xmpp_8c.html#a23646819bacdf301428458ef3815cdd2">  426</a></span>&#160;<span class="preprocessor">#define RESOURCE_BUCKETS 53</span></div><div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;<span class="comment">/*! \brief Namespace for TLS support */</span></div><div class="line"><a name="l00429"></a><span class="lineno"><a class="line" href="../../dc/d6b/res__xmpp_8c.html#aaef49848a26b25380dab5ce120bb14e9">  429</a></span>&#160;<span class="preprocessor">#define XMPP_TLS_NS &quot;urn:ietf:params:xml:ns:xmpp-tls&quot;</span></div><div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;<span class="comment">/*! \brief Status for a disappearing buddy */</span></div><div class="line"><a name="l00432"></a><span class="lineno"><a class="line" href="../../dc/d6b/res__xmpp_8c.html#ab99da9edf20009f484cbf3799f4b8638">  432</a></span>&#160;<span class="preprocessor">#define STATUS_DISAPPEAR 6</span></div><div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;<span class="comment">/*! \brief Global debug status */</span></div><div class="line"><a name="l00435"></a><span class="lineno"><a class="line" href="../../dc/d6b/res__xmpp_8c.html#ac3e1795766a80ec63b157951b4b9a7d4">  435</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../dc/d6b/res__xmpp_8c.html#ac3e1795766a80ec63b157951b4b9a7d4">debug</a>;</div><div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;<span class="comment">/*! \brief XMPP Global Configuration */</span></div><div class="line"><a name="l00438"></a><span class="lineno"><a class="line" href="../../da/d70/structast__xmpp__global__config.html">  438</a></span>&#160;<span class="keyword">struct </span><a class="code" href="../../da/d70/structast__xmpp__global__config.html">ast_xmpp_global_config</a> {</div><div class="line"><a name="l00439"></a><span class="lineno"><a class="line" href="../../da/d70/structast__xmpp__global__config.html#a4dded5c7628fc70e772d321ee6bd5748">  439</a></span>&#160;   <span class="keyword">struct </span><a class="code" href="../../dc/dac/structast__flags.html">ast_flags</a> <a class="code" href="../../da/d70/structast__xmpp__global__config.html#a4dded5c7628fc70e772d321ee6bd5748">general</a>; <span class="comment">/*!&lt; General configuration options */</span></div><div class="line"><a name="l00440"></a><span class="lineno"><a class="line" href="../../da/d70/structast__xmpp__global__config.html#ab40b53f823544fcdeff79c7fc6beb69b">  440</a></span>&#160;   <span class="keyword">struct </span><a class="code" href="../../dc/dac/structast__flags.html">ast_flags</a> <a class="code" href="../../da/d70/structast__xmpp__global__config.html#ab40b53f823544fcdeff79c7fc6beb69b">pubsub</a>;  <span class="comment">/*!&lt; Pubsub related configuration options */</span></div><div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;};</div><div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;<span class="comment">/*! \brief XMPP Client Configuration */</span></div><div class="line"><a name="l00444"></a><span class="lineno"><a class="line" href="../../da/d00/structast__xmpp__client__config.html">  444</a></span>&#160;<span class="keyword">struct </span><a class="code" href="../../da/d00/structast__xmpp__client__config.html">ast_xmpp_client_config</a> {</div><div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;   <a class="code" href="../../d1/d0f/stringfields_8h.html#a061580e89c55282a7140fa3fdfd52b6d">AST_DECLARE_STRING_FIELDS</a>(</div><div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;      <a class="code" href="../../d1/d0f/stringfields_8h.html#a51b5729220efb7cda4393ed35ecdfea2">AST_STRING_FIELD</a>(<a class="code" href="../../d0/d29/cdr__mysql_8c.html#a0980a105ccb863d8008eb6201a51da52">name</a>);        <span class="comment">/*!&lt; Name of the client connection */</span></div><div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;      <a class="code" href="../../d1/d0f/stringfields_8h.html#a51b5729220efb7cda4393ed35ecdfea2">AST_STRING_FIELD</a>(<a class="code" href="../../d8/dbc/structuser.html">user</a>);        <span class="comment">/*!&lt; Username to use for authentication */</span></div><div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;      <a class="code" href="../../d1/d0f/stringfields_8h.html#a51b5729220efb7cda4393ed35ecdfea2">AST_STRING_FIELD</a>(<a class="code" href="../../d0/d29/cdr__mysql_8c.html#ab4fdb206838f2974bd15fc2ca1e9d366">password</a>);    <span class="comment">/*!&lt; Password to use for authentication */</span></div><div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;      <a class="code" href="../../d1/d0f/stringfields_8h.html#a51b5729220efb7cda4393ed35ecdfea2">AST_STRING_FIELD</a>(refresh_token);   <span class="comment">/*!&lt; Refresh token to use for OAuth authentication */</span></div><div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;      <a class="code" href="../../d1/d0f/stringfields_8h.html#a51b5729220efb7cda4393ed35ecdfea2">AST_STRING_FIELD</a>(oauth_clientid);  <span class="comment">/*!&lt; Client ID to use for OAuth authentication */</span></div><div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;      <a class="code" href="../../d1/d0f/stringfields_8h.html#a51b5729220efb7cda4393ed35ecdfea2">AST_STRING_FIELD</a>(oauth_secret);    <span class="comment">/*!&lt; Secret to use for OAuth authentication */</span></div><div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;      <a class="code" href="../../d1/d0f/stringfields_8h.html#a51b5729220efb7cda4393ed35ecdfea2">AST_STRING_FIELD</a>(server);      <span class="comment">/*!&lt; Server hostname */</span></div><div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;      <a class="code" href="../../d1/d0f/stringfields_8h.html#a51b5729220efb7cda4393ed35ecdfea2">AST_STRING_FIELD</a>(statusmsg);   <span class="comment">/*!&lt; Status message for presence */</span></div><div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;      <a class="code" href="../../d1/d0f/stringfields_8h.html#a51b5729220efb7cda4393ed35ecdfea2">AST_STRING_FIELD</a>(pubsubnode);  <span class="comment">/*!&lt; Pubsub node */</span></div><div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;      <a class="code" href="../../d1/d0f/stringfields_8h.html#a51b5729220efb7cda4393ed35ecdfea2">AST_STRING_FIELD</a>(<a class="code" href="../../da/d45/chan__alsa_8c.html#ac25ea00ee3f082df06e0cf468cbde240">context</a>);     <span class="comment">/*!&lt; Context for incoming messages */</span></div><div class="line"><a name="l00456"></a><span class="lineno"><a class="line" href="../../da/d00/structast__xmpp__client__config.html#a661785436d89cdd720f15478d92c984b">  456</a></span>&#160;      );</div><div class="line"><a name="l00457"></a><span class="lineno"><a class="line" href="../../da/d00/structast__xmpp__client__config.html#a63c89c04d1feae07ca35558055155ffb">  457</a></span>&#160;   <span class="keywordtype">int</span> <a class="code" href="../../da/d00/structast__xmpp__client__config.html#a63c89c04d1feae07ca35558055155ffb">port</a>;                       <span class="comment">/*!&lt; Port to use when connecting to server */</span></div><div class="line"><a name="l00458"></a><span class="lineno"><a class="line" href="../../da/d00/structast__xmpp__client__config.html#afcb76ae4daf94120b9c6e8e3a8926e36">  458</a></span>&#160;   <span class="keywordtype">int</span> <a class="code" href="../../da/d00/structast__xmpp__client__config.html#afcb76ae4daf94120b9c6e8e3a8926e36">message_timeout</a>;            <span class="comment">/*!&lt; Timeout for messages */</span></div><div class="line"><a name="l00459"></a><span class="lineno"><a class="line" href="../../da/d00/structast__xmpp__client__config.html#acec9ce2df15222151ad66fcb1d74eb9f">  459</a></span>&#160;   <span class="keywordtype">int</span> <a class="code" href="../../da/d00/structast__xmpp__client__config.html#acec9ce2df15222151ad66fcb1d74eb9f">priority</a>;                   <span class="comment">/*!&lt; Resource priority */</span></div><div class="line"><a name="l00460"></a><span class="lineno"><a class="line" href="../../da/d00/structast__xmpp__client__config.html#aec78000b2897c094f68ed72559e18acd">  460</a></span>&#160;   <span class="keyword">struct </span><a class="code" href="../../dc/dac/structast__flags.html">ast_flags</a> <a class="code" href="../../dc/dac/structast__flags.html#ac92588540e8c1d014a08cd8a45462b19">flags</a>;         <span class="comment">/*!&lt; Various options that have been set */</span></div><div class="line"><a name="l00461"></a><span class="lineno"><a class="line" href="../../da/d00/structast__xmpp__client__config.html#afd35dbdf461b0fbd44e300eee66edebf">  461</a></span>&#160;   <span class="keyword">struct </span><a class="code" href="../../dc/dac/structast__flags.html">ast_flags</a> mod_flags;     <span class="comment">/*!&lt; Global options that have been modified */</span></div><div class="line"><a name="l00462"></a><span class="lineno"><a class="line" href="../../da/d00/structast__xmpp__client__config.html#a522b409a211fd313b8a02f071aea6751">  462</a></span>&#160;   <span class="keyword">enum</span> ikshowtype <a class="code" href="../../de/dcd/app__jack_8c.html#ac191e5810fa65e63095409471eb5648f">status</a>;         <span class="comment">/*!&lt; Presence status */</span></div><div class="line"><a name="l00463"></a><span class="lineno"><a class="line" href="../../da/d00/structast__xmpp__client__config.html#a83bf6907a1184b56931bf86ff744279e">  463</a></span>&#160;   <span class="keyword">struct </span><a class="code" href="../../df/d42/structast__xmpp__client.html">ast_xmpp_client</a> *<a class="code" href="../../da/d00/structast__xmpp__client__config.html#a83bf6907a1184b56931bf86ff744279e">client</a>; <span class="comment">/*!&lt; Pointer to the client */</span></div><div class="line"><a name="l00464"></a><span class="lineno"><a class="line" href="../../da/d00/structast__xmpp__client__config.html#a5082987d3e1eac5f625574800bb72c2c">  464</a></span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d2/da9/structao2__container.html">ao2_container</a> *<a class="code" href="../../da/d00/structast__xmpp__client__config.html#a5082987d3e1eac5f625574800bb72c2c">buddies</a>;  <span class="comment">/*!&lt; Configured buddies */</span></div><div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;};</div><div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;</div><div class="line"><a name="l00467"></a><span class="lineno"><a class="line" href="../../de/d1c/structxmpp__config.html">  467</a></span>&#160;<span class="keyword">struct </span><a class="code" href="../../de/d1c/structxmpp__config.html">xmpp_config</a> {</div><div class="line"><a name="l00468"></a><span class="lineno"><a class="line" href="../../de/d1c/structxmpp__config.html#ad69ce1bbfeca1aac1f78e32a4a240a58">  468</a></span>&#160;   <span class="keyword">struct </span><a class="code" href="../../da/d70/structast__xmpp__global__config.html">ast_xmpp_global_config</a> *<a class="code" href="../../de/d1c/structxmpp__config.html#ad69ce1bbfeca1aac1f78e32a4a240a58">global</a>; <span class="comment">/*!&lt; Global configuration options */</span></div><div class="line"><a name="l00469"></a><span class="lineno"><a class="line" href="../../de/d1c/structxmpp__config.html#a6de943884a1b221ba681176782c49393">  469</a></span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d2/da9/structao2__container.html">ao2_container</a> *<a class="code" href="../../de/d1c/structxmpp__config.html#a6de943884a1b221ba681176782c49393">clients</a>;         <span class="comment">/*!&lt; Configured clients */</span></div><div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;};</div><div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;</div><div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;<span class="keyword">static</span> <a class="code" href="../../dc/d6b/res__xmpp_8c.html#a6b8f4ce31d30e5a3e2c3894e6224f952">AO2_GLOBAL_OBJ_STATIC</a>(<a class="code" href="../../d3/d4e/chan__console_8c.html#aa36e3e2c486b920b166c2d17c5242221">globals</a>);</div><div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;</div><div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../dc/d6b/res__xmpp_8c.html#adfb6a3e1f6870b3fcfe56d1303db59b7">xmpp_client_request_tls</a>(<span class="keyword">struct</span> <a class="code" href="../../df/d42/structast__xmpp__client.html">ast_xmpp_client</a> *client, <span class="keyword">struct</span> <a class="code" href="../../da/d00/structast__xmpp__client__config.html">ast_xmpp_client_config</a> *cfg, <span class="keywordtype">int</span> <a class="code" href="../../d7/d49/chan__ooh323_8c.html#a4d63fdfe5451ec2248c16a2739190c56">type</a>, iks *<a class="code" href="../../d5/da1/structnode.html">node</a>);</div><div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../dc/d6b/res__xmpp_8c.html#a061c4cbf39cf2ba5a8d8175f2a6716ee">xmpp_client_requested_tls</a>(<span class="keyword">struct</span> <a class="code" href="../../df/d42/structast__xmpp__client.html">ast_xmpp_client</a> *client, <span class="keyword">struct</span> <a class="code" href="../../da/d00/structast__xmpp__client__config.html">ast_xmpp_client_config</a> *cfg, <span class="keywordtype">int</span> <a class="code" href="../../d7/d49/chan__ooh323_8c.html#a4d63fdfe5451ec2248c16a2739190c56">type</a>, iks *<a class="code" href="../../d5/da1/structnode.html">node</a>);</div><div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../dc/d6b/res__xmpp_8c.html#aead926c74102aaf5443a74bb5d3e2a68">xmpp_client_authenticate</a>(<span class="keyword">struct</span> <a class="code" href="../../df/d42/structast__xmpp__client.html">ast_xmpp_client</a> *client, <span class="keyword">struct</span> <a class="code" href="../../da/d00/structast__xmpp__client__config.html">ast_xmpp_client_config</a> *cfg, <span class="keywordtype">int</span> <a class="code" href="../../d7/d49/chan__ooh323_8c.html#a4d63fdfe5451ec2248c16a2739190c56">type</a>, iks *<a class="code" href="../../d5/da1/structnode.html">node</a>);</div><div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../dc/d6b/res__xmpp_8c.html#ae3571a1477967e051aed72a91c32bc86">xmpp_client_authenticating</a>(<span class="keyword">struct</span> <a class="code" href="../../df/d42/structast__xmpp__client.html">ast_xmpp_client</a> *client, <span class="keyword">struct</span> <a class="code" href="../../da/d00/structast__xmpp__client__config.html">ast_xmpp_client_config</a> *cfg, <span class="keywordtype">int</span> <a class="code" href="../../d7/d49/chan__ooh323_8c.html#a4d63fdfe5451ec2248c16a2739190c56">type</a>, iks *<a class="code" href="../../d5/da1/structnode.html">node</a>);</div><div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;</div><div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../dc/d6b/res__xmpp_8c.html#a35b7847735c4ada0637abea6bb40f0fc">xmpp_component_authenticate</a>(<span class="keyword">struct</span> <a class="code" href="../../df/d42/structast__xmpp__client.html">ast_xmpp_client</a> *client, <span class="keyword">struct</span> <a class="code" href="../../da/d00/structast__xmpp__client__config.html">ast_xmpp_client_config</a> *cfg, <span class="keywordtype">int</span> <a class="code" href="../../d7/d49/chan__ooh323_8c.html#a4d63fdfe5451ec2248c16a2739190c56">type</a>, iks *<a class="code" href="../../d5/da1/structnode.html">node</a>);</div><div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../dc/d6b/res__xmpp_8c.html#a673106a2f8e9dfe9770923e9457d1483">xmpp_component_authenticating</a>(<span class="keyword">struct</span> <a class="code" href="../../df/d42/structast__xmpp__client.html">ast_xmpp_client</a> *client, <span class="keyword">struct</span> <a class="code" href="../../da/d00/structast__xmpp__client__config.html">ast_xmpp_client_config</a> *cfg, <span class="keywordtype">int</span> <a class="code" href="../../d7/d49/chan__ooh323_8c.html#a4d63fdfe5451ec2248c16a2739190c56">type</a>, iks *<a class="code" href="../../d5/da1/structnode.html">node</a>);</div><div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;<span class="comment">/*! \brief Defined handlers for XMPP client states */</span></div><div class="line"><a name="l00483"></a><span class="lineno"><a class="line" href="../../dc/d18/structxmpp__state__handler.html">  483</a></span>&#160;<span class="keyword">static</span> <span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="../../dc/d18/structxmpp__state__handler.html">xmpp_state_handler</a> {</div><div class="line"><a name="l00484"></a><span class="lineno"><a class="line" href="../../dc/d18/structxmpp__state__handler.html#a89f234133d3efe315836311cbf21c64b">  484</a></span>&#160;   <span class="keywordtype">int</span> <a class="code" href="../../dc/d18/structxmpp__state__handler.html#a89f234133d3efe315836311cbf21c64b">state</a>;</div><div class="line"><a name="l00485"></a><span class="lineno"><a class="line" href="../../dc/d18/structxmpp__state__handler.html#a3c56304946202b57877d2c12f3ad491a">  485</a></span>&#160;   <span class="keywordtype">int</span> <a class="code" href="../../dc/d18/structxmpp__state__handler.html#a3c56304946202b57877d2c12f3ad491a">component</a>;</div><div class="line"><a name="l00486"></a><span class="lineno"><a class="line" href="../../dc/d18/structxmpp__state__handler.html#ae7b1357784014b021c7beaa11bd077ac">  486</a></span>&#160;   int (*<a class="code" href="../../da/d03/test__ari_8c.html#a695cc202c7a2869aa8202bb20726ea3c">handler</a>)(<span class="keyword">struct </span><a class="code" href="../../df/d42/structast__xmpp__client.html">ast_xmpp_client</a> *client, <span class="keyword">struct </span><a class="code" href="../../da/d00/structast__xmpp__client__config.html">ast_xmpp_client_config</a> *cfg, <span class="keywordtype">int</span> <a class="code" href="../../d7/d49/chan__ooh323_8c.html#a4d63fdfe5451ec2248c16a2739190c56">type</a>, iks *<a class="code" href="../../d5/da1/structnode.html">node</a>);</div><div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;} <a class="code" href="../../dc/d6b/res__xmpp_8c.html#a15a090fb684bb844a1808b5531dedfac">xmpp_state_handlers</a>[] = {</div><div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;   { <a class="code" href="../../da/da0/xmpp_8h.html#ae37d560c438576bdcb47347088225ee6a9ae50cb46cd7faba7bdde6259d1e7e11">XMPP_STATE_REQUEST_TLS</a>, 0, <a class="code" href="../../dc/d6b/res__xmpp_8c.html#adfb6a3e1f6870b3fcfe56d1303db59b7">xmpp_client_request_tls</a>, },</div><div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;   { <a class="code" href="../../da/da0/xmpp_8h.html#ae37d560c438576bdcb47347088225ee6aa3c76e3189d07fe1b59825869e4703e3">XMPP_STATE_REQUESTED_TLS</a>, 0, <a class="code" href="../../dc/d6b/res__xmpp_8c.html#a061c4cbf39cf2ba5a8d8175f2a6716ee">xmpp_client_requested_tls</a>, },</div><div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;   { <a class="code" href="../../da/da0/xmpp_8h.html#ae37d560c438576bdcb47347088225ee6a1f316843c055717ccde5ccb266e1eee6">XMPP_STATE_AUTHENTICATE</a>, 0, <a class="code" href="../../dc/d6b/res__xmpp_8c.html#aead926c74102aaf5443a74bb5d3e2a68">xmpp_client_authenticate</a>, },</div><div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;   { <a class="code" href="../../da/da0/xmpp_8h.html#ae37d560c438576bdcb47347088225ee6aeddf64cd40acf9ce3a91bacc33c3368c">XMPP_STATE_AUTHENTICATING</a>, 0, <a class="code" href="../../dc/d6b/res__xmpp_8c.html#ae3571a1477967e051aed72a91c32bc86">xmpp_client_authenticating</a>, },</div><div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;   { <a class="code" href="../../da/da0/xmpp_8h.html#ae37d560c438576bdcb47347088225ee6a1f316843c055717ccde5ccb266e1eee6">XMPP_STATE_AUTHENTICATE</a>, 1, <a class="code" href="../../dc/d6b/res__xmpp_8c.html#a35b7847735c4ada0637abea6bb40f0fc">xmpp_component_authenticate</a>, },</div><div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;   { <a class="code" href="../../da/da0/xmpp_8h.html#ae37d560c438576bdcb47347088225ee6aeddf64cd40acf9ce3a91bacc33c3368c">XMPP_STATE_AUTHENTICATING</a>, 1, <a class="code" href="../../dc/d6b/res__xmpp_8c.html#a673106a2f8e9dfe9770923e9457d1483">xmpp_component_authenticating</a>, },</div><div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;};</div><div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;</div><div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../dc/d6b/res__xmpp_8c.html#a306d2764c3a511ce4bb062987aee310c">xmpp_pak_message</a>(<span class="keyword">struct</span> <a class="code" href="../../df/d42/structast__xmpp__client.html">ast_xmpp_client</a> *<a class="code" href="../../da/d00/structast__xmpp__client__config.html#a83bf6907a1184b56931bf86ff744279e">client</a>, <span class="keyword">struct</span> <a class="code" href="../../da/d00/structast__xmpp__client__config.html">ast_xmpp_client_config</a> *cfg, iks *<a class="code" href="../../d5/da1/structnode.html">node</a>, ikspak *pak);</div><div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../dc/d6b/res__xmpp_8c.html#a563e7271ebe6156d3db9f21bfac02db1">xmpp_pak_presence</a>(<span class="keyword">struct</span> <a class="code" href="../../df/d42/structast__xmpp__client.html">ast_xmpp_client</a> *client, <span class="keyword">struct</span> <a class="code" href="../../da/d00/structast__xmpp__client__config.html">ast_xmpp_client_config</a> *cfg, iks *node, ikspak *pak);</div><div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../dc/d6b/res__xmpp_8c.html#a24812e0efb23effa2797b3d7848f2bb3">xmpp_pak_s10n</a>(<span class="keyword">struct</span> <a class="code" href="../../df/d42/structast__xmpp__client.html">ast_xmpp_client</a> *client, <span class="keyword">struct</span> <a class="code" href="../../da/d00/structast__xmpp__client__config.html">ast_xmpp_client_config</a> *cfg, iks *node, ikspak *pak);</div><div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;<span class="comment">/*! \brief Defined handlers for different PAK types */</span></div><div class="line"><a name="l00501"></a><span class="lineno"><a class="line" href="../../d9/da1/structxmpp__pak__handler.html">  501</a></span>&#160;<span class="keyword">static</span> <span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="../../d9/da1/structxmpp__pak__handler.html">xmpp_pak_handler</a> {</div><div class="line"><a name="l00502"></a><span class="lineno"><a class="line" href="../../d9/da1/structxmpp__pak__handler.html#ac765329451135abec74c45e1897abf26">  502</a></span>&#160;   <span class="keywordtype">int</span> <a class="code" href="../../d9/da1/structxmpp__pak__handler.html#ac765329451135abec74c45e1897abf26">type</a>;</div><div class="line"><a name="l00503"></a><span class="lineno"><a class="line" href="../../d9/da1/structxmpp__pak__handler.html#a6d14152a31bd99d46c2dc65085985a68">  503</a></span>&#160;   int (*<a class="code" href="../../da/d03/test__ari_8c.html#a695cc202c7a2869aa8202bb20726ea3c">handler</a>)(<span class="keyword">struct </span><a class="code" href="../../df/d42/structast__xmpp__client.html">ast_xmpp_client</a> *client, <span class="keyword">struct </span><a class="code" href="../../da/d00/structast__xmpp__client__config.html">ast_xmpp_client_config</a> *cfg, iks *node, ikspak *pak);</div><div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;} <a class="code" href="../../dc/d6b/res__xmpp_8c.html#ae417655500bd50e80fc52f68c18accc9">xmpp_pak_handlers</a>[] = {</div><div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;   { IKS_PAK_MESSAGE, <a class="code" href="../../dc/d6b/res__xmpp_8c.html#a306d2764c3a511ce4bb062987aee310c">xmpp_pak_message</a>, },</div><div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;   { IKS_PAK_PRESENCE, <a class="code" href="../../dc/d6b/res__xmpp_8c.html#a563e7271ebe6156d3db9f21bfac02db1">xmpp_pak_presence</a>, },</div><div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;   { IKS_PAK_S10N, <a class="code" href="../../dc/d6b/res__xmpp_8c.html#a24812e0efb23effa2797b3d7848f2bb3">xmpp_pak_s10n</a>, },</div><div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;};</div><div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;</div><div class="line"><a name="l00510"></a><span class="lineno"><a class="line" href="../../dc/d6b/res__xmpp_8c.html#a75acdd980d5df2f98aa014607e773167">  510</a></span>&#160;<span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="../../dc/d6b/res__xmpp_8c.html#a75acdd980d5df2f98aa014607e773167">app_ajisend</a> = <span class="stringliteral">&quot;JabberSend&quot;</span>;</div><div class="line"><a name="l00511"></a><span class="lineno"><a class="line" href="../../dc/d6b/res__xmpp_8c.html#a14d1e59aa727645c2d87c794f4d00b8e">  511</a></span>&#160;<span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="../../dc/d6b/res__xmpp_8c.html#a14d1e59aa727645c2d87c794f4d00b8e">app_ajisendgroup</a> = <span class="stringliteral">&quot;JabberSendGroup&quot;</span>;</div><div class="line"><a name="l00512"></a><span class="lineno"><a class="line" href="../../dc/d6b/res__xmpp_8c.html#a957dd973b2f620b41c4e6e87c407297d">  512</a></span>&#160;<span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="../../dc/d6b/res__xmpp_8c.html#a957dd973b2f620b41c4e6e87c407297d">app_ajistatus</a> = <span class="stringliteral">&quot;JabberStatus&quot;</span>;</div><div class="line"><a name="l00513"></a><span class="lineno"><a class="line" href="../../dc/d6b/res__xmpp_8c.html#a122bb577b8da348b111a9e75c0d66e07">  513</a></span>&#160;<span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="../../dc/d6b/res__xmpp_8c.html#a122bb577b8da348b111a9e75c0d66e07">app_ajijoin</a> = <span class="stringliteral">&quot;JabberJoin&quot;</span>;</div><div class="line"><a name="l00514"></a><span class="lineno"><a class="line" href="../../dc/d6b/res__xmpp_8c.html#a58ab8a642d8aeb224c46ff80298855ae">  514</a></span>&#160;<span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="../../dc/d6b/res__xmpp_8c.html#a58ab8a642d8aeb224c46ff80298855ae">app_ajileave</a> = <span class="stringliteral">&quot;JabberLeave&quot;</span>;</div><div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;</div><div class="line"><a name="l00516"></a><span class="lineno"><a class="line" href="../../dc/d6b/res__xmpp_8c.html#af93c6d3d569b1db56ee10a4b9615a50d">  516</a></span>&#160;<span class="keyword">static</span> <a class="code" href="../../dd/d42/lock_8h.html#ab134d98cdfe7de0f7a72b377c0765dc7">ast_cond_t</a> <a class="code" href="../../dc/d6b/res__xmpp_8c.html#af93c6d3d569b1db56ee10a4b9615a50d">message_received_condition</a>;</div><div class="line"><a name="l00517"></a><span class="lineno"><a class="line" href="../../dc/d6b/res__xmpp_8c.html#a482fd1cd3b669c1aa7986835733f8f47">  517</a></span>&#160;<span class="keyword">static</span> <a class="code" href="../../d8/dc5/structast__mutex__info.html">ast_mutex_t</a> <a class="code" href="../../dc/d6b/res__xmpp_8c.html#a482fd1cd3b669c1aa7986835733f8f47">messagelock</a>;</div><div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;</div><div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../dc/d6b/res__xmpp_8c.html#a3ff94d7d97bc1497542220144f60afbf">xmpp_client_config_post_apply</a>(<span class="keywordtype">void</span> *obj, <span class="keywordtype">void</span> *arg, <span class="keywordtype">int</span> <a class="code" href="../../da/d00/structast__xmpp__client__config.html#aec78000b2897c094f68ed72559e18acd">flags</a>);</div><div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../dc/d6b/res__xmpp_8c.html#a651fdf11709558c6200662ad0e18fb28">fetch_access_token</a>(<span class="keyword">struct</span> <a class="code" href="../../da/d00/structast__xmpp__client__config.html">ast_xmpp_client_config</a> *cfg);</div><div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;<span class="comment">/*! \brief Destructor function for configuration */</span></div><div class="line"><a name="l00523"></a><span class="lineno"><a class="line" href="../../dc/d6b/res__xmpp_8c.html#af60b543d7d09cb11f2f9d7d070208ca0">  523</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../dc/d6b/res__xmpp_8c.html#af60b543d7d09cb11f2f9d7d070208ca0">ast_xmpp_client_config_destructor</a>(<span class="keywordtype">void</span> *obj)</div><div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;{</div><div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../da/d00/structast__xmpp__client__config.html">ast_xmpp_client_config</a> *cfg = obj;</div><div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;   <a class="code" href="../../d1/d0f/stringfields_8h.html#abf60f862ae6a141d2f86a0f5e82792de">ast_string_field_free_memory</a>(cfg);</div><div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#a6321ee982370c55ab3c24c72c562cbdd">ao2_cleanup</a>(cfg-&gt;<a class="code" href="../../da/d00/structast__xmpp__client__config.html#a83bf6907a1184b56931bf86ff744279e">client</a>);</div><div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#a6321ee982370c55ab3c24c72c562cbdd">ao2_cleanup</a>(cfg-&gt;<a class="code" href="../../da/d00/structast__xmpp__client__config.html#a5082987d3e1eac5f625574800bb72c2c">buddies</a>);</div><div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;}</div><div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;<span class="comment">/*! \brief Destroy function for XMPP messages */</span></div><div class="line"><a name="l00532"></a><span class="lineno"><a class="line" href="../../dc/d6b/res__xmpp_8c.html#abe0bf7c227d40c258b694eef9b7f7333">  532</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../dc/d6b/res__xmpp_8c.html#abe0bf7c227d40c258b694eef9b7f7333">xmpp_message_destroy</a>(<span class="keyword">struct</span> <a class="code" href="../../d6/d73/structast__xmpp__message.html">ast_xmpp_message</a> *<a class="code" href="../../d8/d9e/structmessage.html">message</a>)</div><div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;{</div><div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;   <span class="keywordflow">if</span> (message-&gt;<a class="code" href="../../d6/d73/structast__xmpp__message.html#a765533dfc643627999c751f7e1514664">from</a>) {</div><div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;      <a class="code" href="../../d8/d8a/astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(message-&gt;<a class="code" href="../../d6/d73/structast__xmpp__message.html#a765533dfc643627999c751f7e1514664">from</a>);</div><div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;   }</div><div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;   <span class="keywordflow">if</span> (message-&gt;<a class="code" href="../../d6/d73/structast__xmpp__message.html#a0b2e8c7f76df48129f994ecc46d5c66c">message</a>) {</div><div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;      <a class="code" href="../../d8/d8a/astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(message-&gt;<a class="code" href="../../d6/d73/structast__xmpp__message.html#a0b2e8c7f76df48129f994ecc46d5c66c">message</a>);</div><div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;   }</div><div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;</div><div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;   <a class="code" href="../../d8/d8a/astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(message);</div><div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;}</div><div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;<span class="comment">/*! \brief Destructor callback function for XMPP client */</span></div><div class="line"><a name="l00545"></a><span class="lineno"><a class="line" href="../../dc/d6b/res__xmpp_8c.html#a71f51aa05e7a0aab01106f57cd93affa">  545</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../dc/d6b/res__xmpp_8c.html#a71f51aa05e7a0aab01106f57cd93affa">xmpp_client_destructor</a>(<span class="keywordtype">void</span> *obj)</div><div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;{</div><div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../df/d42/structast__xmpp__client.html">ast_xmpp_client</a> *client = obj;</div><div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d6/d73/structast__xmpp__message.html">ast_xmpp_message</a> *<a class="code" href="../../d6/d73/structast__xmpp__message.html#a0b2e8c7f76df48129f994ecc46d5c66c">message</a>;</div><div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;</div><div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;   <a class="code" href="../../dc/d6b/res__xmpp_8c.html#abd1cce3d4d067a7306e5e17dee2876dd">ast_xmpp_client_disconnect</a>(client);</div><div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;</div><div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;   <a class="code" href="../../d4/d61/endpoints_8h.html#a6a92006e96890f26789df16ae8a4994d">ast_endpoint_shutdown</a>(client-&gt;<a class="code" href="../../df/d42/structast__xmpp__client.html#aad78dcd53e5bd3e0d6a9098a462e98f6">endpoint</a>);</div><div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;   client-&gt;<a class="code" href="../../df/d42/structast__xmpp__client.html#aad78dcd53e5bd3e0d6a9098a462e98f6">endpoint</a> = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;</div><div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;   <span class="keywordflow">if</span> (client-&gt;<a class="code" href="../../df/d42/structast__xmpp__client.html#a242fce88f9c9954695b13f7af1d415a9">filter</a>) {</div><div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;      iks_filter_delete(client-&gt;<a class="code" href="../../df/d42/structast__xmpp__client.html#a242fce88f9c9954695b13f7af1d415a9">filter</a>);</div><div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;   }</div><div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;</div><div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;   <span class="keywordflow">if</span> (client-&gt;<a class="code" href="../../df/d42/structast__xmpp__client.html#ae0c738f7612f5fd8ef0f227f8033324f">stack</a>) {</div><div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;      iks_stack_delete(client-&gt;<a class="code" href="../../df/d42/structast__xmpp__client.html#ae0c738f7612f5fd8ef0f227f8033324f">stack</a>);</div><div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;   }</div><div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;</div><div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#a6321ee982370c55ab3c24c72c562cbdd">ao2_cleanup</a>(client-&gt;<a class="code" href="../../df/d42/structast__xmpp__client.html#a5082987d3e1eac5f625574800bb72c2c">buddies</a>);</div><div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;</div><div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;   <span class="keywordflow">while</span> ((message = <a class="code" href="../../df/d90/linkedlists_8h.html#aadfe2a69fbba4f27c201266a2ca5f989">AST_LIST_REMOVE_HEAD</a>(&amp;client-&gt;<a class="code" href="../../df/d42/structast__xmpp__client.html#a17d0e5a7ebe404ac9471b8e403708c66">messages</a>, <a class="code" href="../../d6/d73/structast__xmpp__message.html#a819f07fb76703e722d125863b8763d14">list</a>))) {</div><div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;      <a class="code" href="../../dc/d6b/res__xmpp_8c.html#abe0bf7c227d40c258b694eef9b7f7333">xmpp_message_destroy</a>(message);</div><div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;   }</div><div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;   <a class="code" href="../../df/d90/linkedlists_8h.html#a47bafe663a14b91827082787d7654d7c">AST_LIST_HEAD_DESTROY</a>(&amp;client-&gt;<a class="code" href="../../df/d42/structast__xmpp__client.html#a17d0e5a7ebe404ac9471b8e403708c66">messages</a>);</div><div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;}</div><div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;<span class="comment">/*! \brief Hashing function for XMPP buddy */</span></div><div class="line"><a name="l00572"></a><span class="lineno"><a class="line" href="../../dc/d6b/res__xmpp_8c.html#af8aef0634532b054dc2369c7dfe185e2">  572</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../dc/d6b/res__xmpp_8c.html#af8aef0634532b054dc2369c7dfe185e2">xmpp_buddy_hash</a>(<span class="keyword">const</span> <span class="keywordtype">void</span> *obj, <span class="keyword">const</span> <span class="keywordtype">int</span> flags)</div><div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;{</div><div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;   <span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="../../d5/d25/structast__xmpp__buddy.html">ast_xmpp_buddy</a> *buddy = obj;</div><div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;   <span class="keyword">const</span> <span class="keywordtype">char</span> *<span class="keywordtype">id</span> = obj;</div><div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;</div><div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;   <span class="keywordflow">return</span> <a class="code" href="../../d6/d90/strings_8h.html#a33ab7fa091d5513d8507d3bd33ef5b55">ast_str_hash</a>(flags &amp; <a class="code" href="../../d5/da5/astobj2_8h.html#a22f40c733a085f259af94e864ebaa09a">OBJ_KEY</a> ? <span class="keywordtype">id</span> : buddy-&gt;<a class="code" href="../../d5/d25/structast__xmpp__buddy.html#aaf2ca63234b10470cfbba573d4c0ed01">id</a>);</div><div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;}</div><div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;<span class="comment">/*! \brief Comparator function for XMPP buddy */</span></div><div class="line"><a name="l00581"></a><span class="lineno"><a class="line" href="../../dc/d6b/res__xmpp_8c.html#a00680af12351f02dbeee7a2b4893917c">  581</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../dc/d6b/res__xmpp_8c.html#a00680af12351f02dbeee7a2b4893917c">xmpp_buddy_cmp</a>(<span class="keywordtype">void</span> *obj, <span class="keywordtype">void</span> *arg, <span class="keywordtype">int</span> flags)</div><div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;{</div><div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d5/d25/structast__xmpp__buddy.html">ast_xmpp_buddy</a> *buddy1 = obj, *buddy2 = arg;</div><div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;   <span class="keyword">const</span> <span class="keywordtype">char</span> *<span class="keywordtype">id</span> = arg;</div><div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;</div><div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;   <span class="keywordflow">return</span> !strcmp(buddy1-&gt;<a class="code" href="../../d5/d25/structast__xmpp__buddy.html#aaf2ca63234b10470cfbba573d4c0ed01">id</a>, flags &amp; <a class="code" href="../../d5/da5/astobj2_8h.html#a22f40c733a085f259af94e864ebaa09a">OBJ_KEY</a> ? <span class="keywordtype">id</span> : buddy2-&gt;id) ? <a class="code" href="../../d5/da5/astobj2_8h.html#a1f8b41308be4c47de8ff89a3b9c7e7d1a1959468a3c5d6aecd2fa1272d8e30fbf">CMP_MATCH</a> | <a class="code" href="../../d5/da5/astobj2_8h.html#a1f8b41308be4c47de8ff89a3b9c7e7d1a75382dc9117cc118719edf6c3d2b71df">CMP_STOP</a> : 0;</div><div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;}</div><div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;<span class="comment">/*! \brief Internal function which changes the XMPP client state */</span></div><div class="line"><a name="l00590"></a><span class="lineno"><a class="line" href="../../dc/d6b/res__xmpp_8c.html#ac515389ec6c63a8b3bbd094ede0d7c4d">  590</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../dc/d6b/res__xmpp_8c.html#ac515389ec6c63a8b3bbd094ede0d7c4d">xmpp_client_change_state</a>(<span class="keyword">struct</span> <a class="code" href="../../df/d42/structast__xmpp__client.html">ast_xmpp_client</a> *client, <span class="keywordtype">int</span> <a class="code" href="../../d4/d88/structstate.html">state</a>)</div><div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;{</div><div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;   <span class="keywordflow">if</span> (state == client-&gt;<a class="code" href="../../df/d42/structast__xmpp__client.html#a0e1ad9bdec3a82e1fec4aed829cfa2a6">state</a>) {</div><div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;      <span class="keywordflow">return</span>;</div><div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;   }</div><div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;   client-&gt;<a class="code" href="../../df/d42/structast__xmpp__client.html#a0e1ad9bdec3a82e1fec4aed829cfa2a6">state</a> = <a class="code" href="../../d5/dfe/chan__sip_8c.html#a14a9662e09deed264497073732fb014a">state</a>;</div><div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;   <span class="keywordflow">if</span> (client-&gt;<a class="code" href="../../df/d42/structast__xmpp__client.html#a0e1ad9bdec3a82e1fec4aed829cfa2a6">state</a> == <a class="code" href="../../da/da0/xmpp_8h.html#ae37d560c438576bdcb47347088225ee6a83544d57990f3fc1311d173a44928042">XMPP_STATE_DISCONNECTED</a>) {</div><div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;      <a class="code" href="../../d4/d61/endpoints_8h.html#a04bfc77dacce061c28fa31e2b86827e8">ast_endpoint_set_state</a>(client-&gt;<a class="code" href="../../df/d42/structast__xmpp__client.html#aad78dcd53e5bd3e0d6a9098a462e98f6">endpoint</a>, <a class="code" href="../../d4/d61/endpoints_8h.html#a00db6879caf0ce423b5a35b57d01448ea0c201502490a90f732b9946dc7545114">AST_ENDPOINT_OFFLINE</a>);</div><div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;   } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (client-&gt;<a class="code" href="../../df/d42/structast__xmpp__client.html#a0e1ad9bdec3a82e1fec4aed829cfa2a6">state</a> == <a class="code" href="../../da/da0/xmpp_8h.html#ae37d560c438576bdcb47347088225ee6af75b0231e0c9888c9a6c5374abf7527f">XMPP_STATE_CONNECTED</a>) {</div><div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;      <a class="code" href="../../d4/d61/endpoints_8h.html#a04bfc77dacce061c28fa31e2b86827e8">ast_endpoint_set_state</a>(client-&gt;<a class="code" href="../../df/d42/structast__xmpp__client.html#aad78dcd53e5bd3e0d6a9098a462e98f6">endpoint</a>, <a class="code" href="../../d4/d61/endpoints_8h.html#a00db6879caf0ce423b5a35b57d01448ea18800ee482eac39e9d235ddd357b9de3">AST_ENDPOINT_ONLINE</a>);</div><div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;   }</div><div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;}</div><div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;<span class="comment">/*! \brief Allocator function for ast_xmpp_client */</span></div><div class="line"><a name="l00604"></a><span class="lineno"><a class="line" href="../../dc/d6b/res__xmpp_8c.html#adef938b4fb0bcfdcec3572e373fb1333">  604</a></span>&#160;<span class="keyword">static</span> <span class="keyword">struct </span><a class="code" href="../../df/d42/structast__xmpp__client.html">ast_xmpp_client</a> *<a class="code" href="../../dc/d6b/res__xmpp_8c.html#adef938b4fb0bcfdcec3572e373fb1333">xmpp_client_alloc</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="../../d0/d29/cdr__mysql_8c.html#a0980a105ccb863d8008eb6201a51da52">name</a>)</div><div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;{</div><div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../df/d42/structast__xmpp__client.html">ast_xmpp_client</a> *client;</div><div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;</div><div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;   <span class="keywordflow">if</span> (!(client = <a class="code" href="../../d5/da5/astobj2_8h.html#ae0422b60d8e25b6962b2d61ae4ddf724">ao2_alloc</a>(<span class="keyword">sizeof</span>(*client), <a class="code" href="../../dc/d6b/res__xmpp_8c.html#a71f51aa05e7a0aab01106f57cd93affa">xmpp_client_destructor</a>))) {</div><div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;   }</div><div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;</div><div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;   <a class="code" href="../../df/d90/linkedlists_8h.html#a6f42d3bf45cc9af6f794d9d1cf8c45ca">AST_LIST_HEAD_INIT</a>(&amp;client-&gt;<a class="code" href="../../df/d42/structast__xmpp__client.html#a17d0e5a7ebe404ac9471b8e403708c66">messages</a>);</div><div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160;   client-&gt;<a class="code" href="../../df/d42/structast__xmpp__client.html#a01f75a9ad916f63a94e06a27635ba278">thread</a> = <a class="code" href="../../dd/d42/lock_8h.html#a6009440c7a72f8e2e3b1ec97641ad160">AST_PTHREADT_NULL</a>;</div><div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;</div><div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;   client-&gt;<a class="code" href="../../df/d42/structast__xmpp__client.html#aad78dcd53e5bd3e0d6a9098a462e98f6">endpoint</a> = <a class="code" href="../../d4/d61/endpoints_8h.html#a6d7a27b4849c075f31991c8ca796ccf2">ast_endpoint_create</a>(<span class="stringliteral">&quot;XMPP&quot;</span>, name);</div><div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;   <span class="keywordflow">if</span> (!client-&gt;<a class="code" href="../../df/d42/structast__xmpp__client.html#aad78dcd53e5bd3e0d6a9098a462e98f6">endpoint</a>) {</div><div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160;      <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(client, -1);</div><div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160;   }</div><div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160;</div><div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;   client-&gt;<a class="code" href="../../df/d42/structast__xmpp__client.html#a5082987d3e1eac5f625574800bb72c2c">buddies</a> = <a class="code" href="../../d5/da5/astobj2_8h.html#aefc16f8aa9087cbc5c55c70cf1dd41b2">ao2_container_alloc_hash</a>(<a class="code" href="../../d5/da5/astobj2_8h.html#a2cf7e3433f08351aafe3b0cd31edf7f8a8ccf751bd6749d062999469f0694e7ad">AO2_ALLOC_OPT_LOCK_MUTEX</a>, 0, <a class="code" href="../../dc/d6b/res__xmpp_8c.html#aa62316b52aedcca330fd1113c1f3c97e">BUDDY_BUCKETS</a>,</div><div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;      <a class="code" href="../../dc/d6b/res__xmpp_8c.html#af8aef0634532b054dc2369c7dfe185e2">xmpp_buddy_hash</a>, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../dc/d6b/res__xmpp_8c.html#a00680af12351f02dbeee7a2b4893917c">xmpp_buddy_cmp</a>);</div><div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;   <span class="keywordflow">if</span> (!client-&gt;<a class="code" href="../../df/d42/structast__xmpp__client.html#a5082987d3e1eac5f625574800bb72c2c">buddies</a>) {</div><div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Could not initialize buddy container for &#39;%s&#39;\n&quot;</span>, name);</div><div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160;      <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(client, -1);</div><div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160;   }</div><div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;</div><div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d1/d0f/stringfields_8h.html#a871274fa4fd2687c7a44849a84df3665">ast_string_field_init</a>(client, 512)) {</div><div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Could not initialize stringfields for &#39;%s&#39;\n&quot;</span>, name);</div><div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160;      <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(client, -1);</div><div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160;   }</div><div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160;</div><div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160;   <span class="keywordflow">if</span> (!(client-&gt;<a class="code" href="../../df/d42/structast__xmpp__client.html#ae0c738f7612f5fd8ef0f227f8033324f">stack</a> = iks_stack_new(8192, 8192))) {</div><div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Could not create an Iksemel stack for &#39;%s&#39;\n&quot;</span>, name);</div><div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160;      <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(client, -1);</div><div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160;   }</div><div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160;</div><div class="line"><a name="l00641"></a><span class="lineno">  641</span>&#160;   <a class="code" href="../../d1/d0f/stringfields_8h.html#a653461abd6e0d16e4e3326ab90e0501d">ast_string_field_set</a>(client, name, name);</div><div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160;</div><div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160;   client-&gt;<a class="code" href="../../df/d42/structast__xmpp__client.html#a493b57f443cc38b3d3df9c1e584d9d82">timeout</a> = 50;</div><div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160;   <a class="code" href="../../dc/d6b/res__xmpp_8c.html#ac515389ec6c63a8b3bbd094ede0d7c4d">xmpp_client_change_state</a>(client, <a class="code" href="../../da/da0/xmpp_8h.html#ae37d560c438576bdcb47347088225ee6a83544d57990f3fc1311d173a44928042">XMPP_STATE_DISCONNECTED</a>);</div><div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160;   <a class="code" href="../../d6/d90/strings_8h.html#ac4040268f7b6ed77dfc49c7767626369">ast_copy_string</a>(client-&gt;<a class="code" href="../../df/d42/structast__xmpp__client.html#abee5661fa88af477fe47bbbd21136301">mid</a>, <span class="stringliteral">&quot;aaaaa&quot;</span>, <span class="keyword">sizeof</span>(client-&gt;<a class="code" href="../../df/d42/structast__xmpp__client.html#abee5661fa88af477fe47bbbd21136301">mid</a>));</div><div class="line"><a name="l00646"></a><span class="lineno">  646</span>&#160;</div><div class="line"><a name="l00647"></a><span class="lineno">  647</span>&#160;   <span class="keywordflow">return</span> client;</div><div class="line"><a name="l00648"></a><span class="lineno">  648</span>&#160;}</div><div class="line"><a name="l00649"></a><span class="lineno">  649</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00650"></a><span class="lineno">  650</span>&#160;<span class="comment">/*! \brief Find function for configuration */</span></div><div class="line"><a name="l00651"></a><span class="lineno"><a class="line" href="../../dc/d6b/res__xmpp_8c.html#a14d10033fb3b97f06238940259f45266">  651</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> *<a class="code" href="../../dc/d6b/res__xmpp_8c.html#a14d10033fb3b97f06238940259f45266">xmpp_config_find</a>(<span class="keyword">struct</span> <a class="code" href="../../d2/da9/structao2__container.html">ao2_container</a> *tmp_container, <span class="keyword">const</span> <span class="keywordtype">char</span> *category)</div><div class="line"><a name="l00652"></a><span class="lineno">  652</span>&#160;{</div><div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160;   <span class="keywordflow">return</span> <a class="code" href="../../d5/da5/astobj2_8h.html#a911e0703891a9a7aaf73978152092586">ao2_find</a>(tmp_container, category, <a class="code" href="../../d5/da5/astobj2_8h.html#a22f40c733a085f259af94e864ebaa09a">OBJ_KEY</a>);</div><div class="line"><a name="l00654"></a><span class="lineno">  654</span>&#160;}</div><div class="line"><a name="l00655"></a><span class="lineno">  655</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00656"></a><span class="lineno">  656</span>&#160;<span class="comment">/*! \brief Look up existing client or create a new one */</span></div><div class="line"><a name="l00657"></a><span class="lineno"><a class="line" href="../../dc/d6b/res__xmpp_8c.html#a277607fa8955c1eb2c954d17d3d0ebaa">  657</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> *<a class="code" href="../../dc/d6b/res__xmpp_8c.html#a277607fa8955c1eb2c954d17d3d0ebaa">xmpp_client_find_or_create</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *category)</div><div class="line"><a name="l00658"></a><span class="lineno">  658</span>&#160;{</div><div class="line"><a name="l00659"></a><span class="lineno">  659</span>&#160;   <a class="code" href="../../d5/d60/utils_8h.html#a1604b4d72144dd3d9f7da668e90337e9">RAII_VAR</a>(<span class="keyword">struct</span> <a class="code" href="../../de/d1c/structxmpp__config.html">xmpp_config</a> *, cfg, <a class="code" href="../../d5/da5/astobj2_8h.html#a86d8d6c3c8866ed0a60121da055cd225">ao2_global_obj_ref</a>(<a class="code" href="../../d3/d4e/chan__console_8c.html#aa36e3e2c486b920b166c2d17c5242221">globals</a>), <a class="code" href="../../d5/da5/astobj2_8h.html#a6321ee982370c55ab3c24c72c562cbdd">ao2_cleanup</a>);</div><div class="line"><a name="l00660"></a><span class="lineno">  660</span>&#160;   <a class="code" href="../../d5/d60/utils_8h.html#a1604b4d72144dd3d9f7da668e90337e9">RAII_VAR</a>(<span class="keyword">struct</span> <a class="code" href="../../da/d00/structast__xmpp__client__config.html">ast_xmpp_client_config</a> *, clientcfg, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../d5/da5/astobj2_8h.html#a6321ee982370c55ab3c24c72c562cbdd">ao2_cleanup</a>);</div><div class="line"><a name="l00661"></a><span class="lineno">  661</span>&#160;</div><div class="line"><a name="l00662"></a><span class="lineno">  662</span>&#160;   <span class="keywordflow">if</span> (!cfg || !cfg-&gt;clients || !(clientcfg = <a class="code" href="../../dc/d6b/res__xmpp_8c.html#a14d10033fb3b97f06238940259f45266">xmpp_config_find</a>(cfg-&gt;clients, category))) {</div><div class="line"><a name="l00663"></a><span class="lineno">  663</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/d6b/res__xmpp_8c.html#adef938b4fb0bcfdcec3572e373fb1333">xmpp_client_alloc</a>(category);</div><div class="line"><a name="l00664"></a><span class="lineno">  664</span>&#160;   }</div><div class="line"><a name="l00665"></a><span class="lineno">  665</span>&#160;</div><div class="line"><a name="l00666"></a><span class="lineno">  666</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(clientcfg-&gt;client, +1);</div><div class="line"><a name="l00667"></a><span class="lineno">  667</span>&#160;   <span class="keywordflow">return</span> clientcfg-&gt;client;</div><div class="line"><a name="l00668"></a><span class="lineno">  668</span>&#160;}</div><div class="line"><a name="l00669"></a><span class="lineno">  669</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00670"></a><span class="lineno">  670</span>&#160;<span class="comment">/*! \brief Allocator function for configuration */</span></div><div class="line"><a name="l00671"></a><span class="lineno"><a class="line" href="../../dc/d6b/res__xmpp_8c.html#a290fc293cd6e9547fc434b6bb23b0ede">  671</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> *<a class="code" href="../../dc/d6b/res__xmpp_8c.html#a290fc293cd6e9547fc434b6bb23b0ede">ast_xmpp_client_config_alloc</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *cat)</div><div class="line"><a name="l00672"></a><span class="lineno">  672</span>&#160;{</div><div class="line"><a name="l00673"></a><span class="lineno">  673</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../da/d00/structast__xmpp__client__config.html">ast_xmpp_client_config</a> *cfg;</div><div class="line"><a name="l00674"></a><span class="lineno">  674</span>&#160;</div><div class="line"><a name="l00675"></a><span class="lineno">  675</span>&#160;   <span class="keywordflow">if</span> (!(cfg = <a class="code" href="../../d5/da5/astobj2_8h.html#ae0422b60d8e25b6962b2d61ae4ddf724">ao2_alloc</a>(<span class="keyword">sizeof</span>(*cfg), <a class="code" href="../../dc/d6b/res__xmpp_8c.html#af60b543d7d09cb11f2f9d7d070208ca0">ast_xmpp_client_config_destructor</a>))) {</div><div class="line"><a name="l00676"></a><span class="lineno">  676</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l00677"></a><span class="lineno">  677</span>&#160;   }</div><div class="line"><a name="l00678"></a><span class="lineno">  678</span>&#160;</div><div class="line"><a name="l00679"></a><span class="lineno">  679</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d1/d0f/stringfields_8h.html#a871274fa4fd2687c7a44849a84df3665">ast_string_field_init</a>(cfg, 512)) {</div><div class="line"><a name="l00680"></a><span class="lineno">  680</span>&#160;      <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(cfg, -1);</div><div class="line"><a name="l00681"></a><span class="lineno">  681</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l00682"></a><span class="lineno">  682</span>&#160;   }</div><div class="line"><a name="l00683"></a><span class="lineno">  683</span>&#160;</div><div class="line"><a name="l00684"></a><span class="lineno">  684</span>&#160;   <span class="keywordflow">if</span> (!(cfg-&gt;<a class="code" href="../../da/d00/structast__xmpp__client__config.html#a83bf6907a1184b56931bf86ff744279e">client</a> = <a class="code" href="../../dc/d6b/res__xmpp_8c.html#a277607fa8955c1eb2c954d17d3d0ebaa">xmpp_client_find_or_create</a>(cat))) {</div><div class="line"><a name="l00685"></a><span class="lineno">  685</span>&#160;      <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(cfg, -1);</div><div class="line"><a name="l00686"></a><span class="lineno">  686</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l00687"></a><span class="lineno">  687</span>&#160;   }</div><div class="line"><a name="l00688"></a><span class="lineno">  688</span>&#160;</div><div class="line"><a name="l00689"></a><span class="lineno">  689</span>&#160;   cfg-&gt;<a class="code" href="../../da/d00/structast__xmpp__client__config.html#a5082987d3e1eac5f625574800bb72c2c">buddies</a> = <a class="code" href="../../d5/da5/astobj2_8h.html#aefc16f8aa9087cbc5c55c70cf1dd41b2">ao2_container_alloc_hash</a>(<a class="code" href="../../d5/da5/astobj2_8h.html#a2cf7e3433f08351aafe3b0cd31edf7f8a8ccf751bd6749d062999469f0694e7ad">AO2_ALLOC_OPT_LOCK_MUTEX</a>, 0, <a class="code" href="../../dc/d6b/res__xmpp_8c.html#aa62316b52aedcca330fd1113c1f3c97e">BUDDY_BUCKETS</a>,</div><div class="line"><a name="l00690"></a><span class="lineno">  690</span>&#160;      <a class="code" href="../../dc/d6b/res__xmpp_8c.html#af8aef0634532b054dc2369c7dfe185e2">xmpp_buddy_hash</a>, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../dc/d6b/res__xmpp_8c.html#a00680af12351f02dbeee7a2b4893917c">xmpp_buddy_cmp</a>);</div><div class="line"><a name="l00691"></a><span class="lineno">  691</span>&#160;   <span class="keywordflow">if</span> (!cfg-&gt;<a class="code" href="../../da/d00/structast__xmpp__client__config.html#a5082987d3e1eac5f625574800bb72c2c">buddies</a>) {</div><div class="line"><a name="l00692"></a><span class="lineno">  692</span>&#160;      <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(cfg, -1);</div><div class="line"><a name="l00693"></a><span class="lineno">  693</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l00694"></a><span class="lineno">  694</span>&#160;   }</div><div class="line"><a name="l00695"></a><span class="lineno">  695</span>&#160;</div><div class="line"><a name="l00696"></a><span class="lineno">  696</span>&#160;   <a class="code" href="../../d1/d0f/stringfields_8h.html#a653461abd6e0d16e4e3326ab90e0501d">ast_string_field_set</a>(cfg, <a class="code" href="../../d0/d29/cdr__mysql_8c.html#a0980a105ccb863d8008eb6201a51da52">name</a>, cat);</div><div class="line"><a name="l00697"></a><span class="lineno">  697</span>&#160;</div><div class="line"><a name="l00698"></a><span class="lineno">  698</span>&#160;   <span class="keywordflow">return</span> cfg;</div><div class="line"><a name="l00699"></a><span class="lineno">  699</span>&#160;}</div><div class="line"><a name="l00700"></a><span class="lineno">  700</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00701"></a><span class="lineno">  701</span>&#160;<span class="comment">/*! \brief Destructor for XMPP configuration */</span></div><div class="line"><a name="l00702"></a><span class="lineno"><a class="line" href="../../dc/d6b/res__xmpp_8c.html#acfeca2f192278988482711d67605556c">  702</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../dc/d6b/res__xmpp_8c.html#acfeca2f192278988482711d67605556c">xmpp_config_destructor</a>(<span class="keywordtype">void</span> *obj)</div><div class="line"><a name="l00703"></a><span class="lineno">  703</span>&#160;{</div><div class="line"><a name="l00704"></a><span class="lineno">  704</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../de/d1c/structxmpp__config.html">xmpp_config</a> *cfg = obj;</div><div class="line"><a name="l00705"></a><span class="lineno">  705</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#a6321ee982370c55ab3c24c72c562cbdd">ao2_cleanup</a>(cfg-&gt;<a class="code" href="../../de/d1c/structxmpp__config.html#ad69ce1bbfeca1aac1f78e32a4a240a58">global</a>);</div><div class="line"><a name="l00706"></a><span class="lineno">  706</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#a6321ee982370c55ab3c24c72c562cbdd">ao2_cleanup</a>(cfg-&gt;<a class="code" href="../../de/d1c/structxmpp__config.html#a6de943884a1b221ba681176782c49393">clients</a>);</div><div class="line"><a name="l00707"></a><span class="lineno">  707</span>&#160;}</div><div class="line"><a name="l00708"></a><span class="lineno">  708</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00709"></a><span class="lineno">  709</span>&#160;<span class="comment">/*! \brief Comparator function for configuration */</span></div><div class="line"><a name="l00710"></a><span class="lineno"><a class="line" href="../../dc/d6b/res__xmpp_8c.html#aead014b9851763645f1f68598fee3623">  710</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../dc/d6b/res__xmpp_8c.html#aead014b9851763645f1f68598fee3623">xmpp_config_cmp</a>(<span class="keywordtype">void</span> *obj, <span class="keywordtype">void</span> *arg, <span class="keywordtype">int</span> flags)</div><div class="line"><a name="l00711"></a><span class="lineno">  711</span>&#160;{</div><div class="line"><a name="l00712"></a><span class="lineno">  712</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../da/d00/structast__xmpp__client__config.html">ast_xmpp_client_config</a> *one = obj, *two = arg;</div><div class="line"><a name="l00713"></a><span class="lineno">  713</span>&#160;   <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="../../d5/dff/chan__iax2_8c.html#a7dd0190efe1c61151a9dbab078bdb263">match</a> = (flags &amp; <a class="code" href="../../d5/da5/astobj2_8h.html#a22f40c733a085f259af94e864ebaa09a">OBJ_KEY</a>) ? arg : two-&gt;name;</div><div class="line"><a name="l00714"></a><span class="lineno">  714</span>&#160;   <span class="keywordflow">return</span> strcasecmp(one-&gt;<a class="code" href="../../da/d00/structast__xmpp__client__config.html#ace9168767fc3707cf5f0a7d049682ba3">name</a>, match) ? 0 : (<a class="code" href="../../d5/da5/astobj2_8h.html#a1f8b41308be4c47de8ff89a3b9c7e7d1a1959468a3c5d6aecd2fa1272d8e30fbf">CMP_MATCH</a> | <a class="code" href="../../d5/da5/astobj2_8h.html#a1f8b41308be4c47de8ff89a3b9c7e7d1a75382dc9117cc118719edf6c3d2b71df">CMP_STOP</a>);</div><div class="line"><a name="l00715"></a><span class="lineno">  715</span>&#160;}</div><div class="line"><a name="l00716"></a><span class="lineno">  716</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00717"></a><span class="lineno">  717</span>&#160;<span class="comment">/*! \brief Allocator for XMPP configuration */</span></div><div class="line"><a name="l00718"></a><span class="lineno"><a class="line" href="../../dc/d6b/res__xmpp_8c.html#a411ba34b877bce9bddd1b289c486aabc">  718</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> *<a class="code" href="../../dc/d6b/res__xmpp_8c.html#a411ba34b877bce9bddd1b289c486aabc">xmpp_config_alloc</a>(<span class="keywordtype">void</span>)</div><div class="line"><a name="l00719"></a><span class="lineno">  719</span>&#160;{</div><div class="line"><a name="l00720"></a><span class="lineno">  720</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../de/d1c/structxmpp__config.html">xmpp_config</a> *cfg;</div><div class="line"><a name="l00721"></a><span class="lineno">  721</span>&#160;</div><div class="line"><a name="l00722"></a><span class="lineno">  722</span>&#160;   <span class="keywordflow">if</span> (!(cfg = <a class="code" href="../../d5/da5/astobj2_8h.html#ae0422b60d8e25b6962b2d61ae4ddf724">ao2_alloc</a>(<span class="keyword">sizeof</span>(*cfg), <a class="code" href="../../dc/d6b/res__xmpp_8c.html#acfeca2f192278988482711d67605556c">xmpp_config_destructor</a>))) {</div><div class="line"><a name="l00723"></a><span class="lineno">  723</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l00724"></a><span class="lineno">  724</span>&#160;   }</div><div class="line"><a name="l00725"></a><span class="lineno">  725</span>&#160;</div><div class="line"><a name="l00726"></a><span class="lineno">  726</span>&#160;   <span class="keywordflow">if</span> (!(cfg-&gt;<a class="code" href="../../de/d1c/structxmpp__config.html#ad69ce1bbfeca1aac1f78e32a4a240a58">global</a> = <a class="code" href="../../d5/da5/astobj2_8h.html#ae0422b60d8e25b6962b2d61ae4ddf724">ao2_alloc</a>(<span class="keyword">sizeof</span>(*cfg-&gt;<a class="code" href="../../de/d1c/structxmpp__config.html#ad69ce1bbfeca1aac1f78e32a4a240a58">global</a>), <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>))) {</div><div class="line"><a name="l00727"></a><span class="lineno">  727</span>&#160;      <span class="keywordflow">goto</span> <a class="code" href="../../d6/d47/utils_2frame_8c.html#a4a9391ee88e57361b613c4c2fd2bf4aa">error</a>;</div><div class="line"><a name="l00728"></a><span class="lineno">  728</span>&#160;   }</div><div class="line"><a name="l00729"></a><span class="lineno">  729</span>&#160;</div><div class="line"><a name="l00730"></a><span class="lineno">  730</span>&#160;   cfg-&gt;<a class="code" href="../../de/d1c/structxmpp__config.html#a6de943884a1b221ba681176782c49393">clients</a> = <a class="code" href="../../d5/da5/astobj2_8h.html#add41bd9979cb8642f81dd38aa2dfcd6d">ao2_container_alloc_list</a>(<a class="code" href="../../d5/da5/astobj2_8h.html#a2cf7e3433f08351aafe3b0cd31edf7f8a8ccf751bd6749d062999469f0694e7ad">AO2_ALLOC_OPT_LOCK_MUTEX</a>, 0,</div><div class="line"><a name="l00731"></a><span class="lineno">  731</span>&#160;      <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../dc/d6b/res__xmpp_8c.html#aead014b9851763645f1f68598fee3623">xmpp_config_cmp</a>);</div><div class="line"><a name="l00732"></a><span class="lineno">  732</span>&#160;   <span class="keywordflow">if</span> (!cfg-&gt;<a class="code" href="../../de/d1c/structxmpp__config.html#a6de943884a1b221ba681176782c49393">clients</a>) {</div><div class="line"><a name="l00733"></a><span class="lineno">  733</span>&#160;      <span class="keywordflow">goto</span> <a class="code" href="../../d6/d47/utils_2frame_8c.html#a4a9391ee88e57361b613c4c2fd2bf4aa">error</a>;</div><div class="line"><a name="l00734"></a><span class="lineno">  734</span>&#160;   }</div><div class="line"><a name="l00735"></a><span class="lineno">  735</span>&#160;</div><div class="line"><a name="l00736"></a><span class="lineno">  736</span>&#160;   <span class="keywordflow">return</span> cfg;</div><div class="line"><a name="l00737"></a><span class="lineno">  737</span>&#160;<a class="code" href="../../d6/d47/utils_2frame_8c.html#a4a9391ee88e57361b613c4c2fd2bf4aa">error</a>:</div><div class="line"><a name="l00738"></a><span class="lineno">  738</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(cfg, -1);</div><div class="line"><a name="l00739"></a><span class="lineno">  739</span>&#160;   <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l00740"></a><span class="lineno">  740</span>&#160;}</div><div class="line"><a name="l00741"></a><span class="lineno">  741</span>&#160;</div><div class="line"><a name="l00742"></a><span class="lineno"><a class="line" href="../../dc/d6b/res__xmpp_8c.html#a824abffc29ae94875ca0f3c3526ebbbe">  742</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../dc/d6b/res__xmpp_8c.html#a824abffc29ae94875ca0f3c3526ebbbe">xmpp_config_prelink</a>(<span class="keywordtype">void</span> *newitem)</div><div class="line"><a name="l00743"></a><span class="lineno">  743</span>&#160;{</div><div class="line"><a name="l00744"></a><span class="lineno">  744</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../da/d00/structast__xmpp__client__config.html">ast_xmpp_client_config</a> *clientcfg = newitem;</div><div class="line"><a name="l00745"></a><span class="lineno">  745</span>&#160;   <a class="code" href="../../d5/d60/utils_8h.html#a1604b4d72144dd3d9f7da668e90337e9">RAII_VAR</a>(<span class="keyword">struct</span> <a class="code" href="../../de/d1c/structxmpp__config.html">xmpp_config</a> *, cfg, <a class="code" href="../../d5/da5/astobj2_8h.html#a86d8d6c3c8866ed0a60121da055cd225">ao2_global_obj_ref</a>(<a class="code" href="../../d3/d4e/chan__console_8c.html#aa36e3e2c486b920b166c2d17c5242221">globals</a>), <a class="code" href="../../d5/da5/astobj2_8h.html#a6321ee982370c55ab3c24c72c562cbdd">ao2_cleanup</a>);</div><div class="line"><a name="l00746"></a><span class="lineno">  746</span>&#160;   <a class="code" href="../../d5/d60/utils_8h.html#a1604b4d72144dd3d9f7da668e90337e9">RAII_VAR</a>(<span class="keyword">struct</span> <a class="code" href="../../da/d00/structast__xmpp__client__config.html">ast_xmpp_client_config</a> *, oldclientcfg, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../d5/da5/astobj2_8h.html#a6321ee982370c55ab3c24c72c562cbdd">ao2_cleanup</a>);</div><div class="line"><a name="l00747"></a><span class="lineno">  747</span>&#160;</div><div class="line"><a name="l00748"></a><span class="lineno">  748</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a>(clientcfg-&gt;<a class="code" href="../../da/d00/structast__xmpp__client__config.html#a661785436d89cdd720f15478d92c984b">user</a>)) {</div><div class="line"><a name="l00749"></a><span class="lineno">  749</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;No user specified on client &#39;%s&#39;\n&quot;</span>, clientcfg-&gt;<a class="code" href="../../da/d00/structast__xmpp__client__config.html#ace9168767fc3707cf5f0a7d049682ba3">name</a>);</div><div class="line"><a name="l00750"></a><span class="lineno">  750</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l00751"></a><span class="lineno">  751</span>&#160;   } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a>(clientcfg-&gt;<a class="code" href="../../da/d00/structast__xmpp__client__config.html#a54125aa1f0e661889f7a44db13a2b4b8">password</a>) &amp;&amp; <a class="code" href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a>(clientcfg-&gt;<a class="code" href="../../da/d00/structast__xmpp__client__config.html#ad300470818476484645b03f3c0c66591">refresh_token</a>)) {</div><div class="line"><a name="l00752"></a><span class="lineno">  752</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;No password or refresh_token specified on client &#39;%s&#39;\n&quot;</span>, clientcfg-&gt;<a class="code" href="../../da/d00/structast__xmpp__client__config.html#ace9168767fc3707cf5f0a7d049682ba3">name</a>);</div><div class="line"><a name="l00753"></a><span class="lineno">  753</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l00754"></a><span class="lineno">  754</span>&#160;   } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a>(clientcfg-&gt;<a class="code" href="../../da/d00/structast__xmpp__client__config.html#a0246557045a820161e6e736a1b16f31f">server</a>)) {</div><div class="line"><a name="l00755"></a><span class="lineno">  755</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;No server specified on client &#39;%s&#39;\n&quot;</span>, clientcfg-&gt;<a class="code" href="../../da/d00/structast__xmpp__client__config.html#ace9168767fc3707cf5f0a7d049682ba3">name</a>);</div><div class="line"><a name="l00756"></a><span class="lineno">  756</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l00757"></a><span class="lineno">  757</span>&#160;   } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!<a class="code" href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a>(clientcfg-&gt;<a class="code" href="../../da/d00/structast__xmpp__client__config.html#ad300470818476484645b03f3c0c66591">refresh_token</a>) &amp;&amp;</div><div class="line"><a name="l00758"></a><span class="lineno">  758</span>&#160;         (<a class="code" href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a>(clientcfg-&gt;<a class="code" href="../../da/d00/structast__xmpp__client__config.html#a4b8582884dc99ca78481aaf09d2a8aaa">oauth_clientid</a>) || <a class="code" href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a>(clientcfg-&gt;<a class="code" href="../../da/d00/structast__xmpp__client__config.html#a4e8ff91b48d6fcdfb7f0265d59bdd979">oauth_secret</a>))) {</div><div class="line"><a name="l00759"></a><span class="lineno">  759</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;No oauth_clientid or oauth_secret specified, so client &#39;%s&#39; can&#39;t be used\n&quot;</span>, clientcfg-&gt;<a class="code" href="../../da/d00/structast__xmpp__client__config.html#ace9168767fc3707cf5f0a7d049682ba3">name</a>);</div><div class="line"><a name="l00760"></a><span class="lineno">  760</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l00761"></a><span class="lineno">  761</span>&#160;   }</div><div class="line"><a name="l00762"></a><span class="lineno">  762</span>&#160;</div><div class="line"><a name="l00763"></a><span class="lineno">  763</span>&#160;   <span class="comment">/* If this is a new connection force a reconnect */</span></div><div class="line"><a name="l00764"></a><span class="lineno">  764</span>&#160;   <span class="keywordflow">if</span> (!cfg || !cfg-&gt;clients || !(oldclientcfg = <a class="code" href="../../dc/d6b/res__xmpp_8c.html#a14d10033fb3b97f06238940259f45266">xmpp_config_find</a>(cfg-&gt;clients, clientcfg-&gt;<a class="code" href="../../da/d00/structast__xmpp__client__config.html#ace9168767fc3707cf5f0a7d049682ba3">name</a>))) {</div><div class="line"><a name="l00765"></a><span class="lineno">  765</span>&#160;      clientcfg-&gt;<a class="code" href="../../da/d00/structast__xmpp__client__config.html#a83bf6907a1184b56931bf86ff744279e">client</a>-&gt;<a class="code" href="../../df/d42/structast__xmpp__client.html#a6588648b50745df0a20957b8d09fd919">reconnect</a> = 1;</div><div class="line"><a name="l00766"></a><span class="lineno">  766</span>&#160;      <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00767"></a><span class="lineno">  767</span>&#160;   }</div><div class="line"><a name="l00768"></a><span class="lineno">  768</span>&#160;</div><div class="line"><a name="l00769"></a><span class="lineno">  769</span>&#160;   <span class="comment">/* If any configuration options are changing that would require reconnecting set the bit so we will do so if possible */</span></div><div class="line"><a name="l00770"></a><span class="lineno">  770</span>&#160;   <span class="keywordflow">if</span> (strcmp(clientcfg-&gt;<a class="code" href="../../da/d00/structast__xmpp__client__config.html#a661785436d89cdd720f15478d92c984b">user</a>, oldclientcfg-&gt;user) ||</div><div class="line"><a name="l00771"></a><span class="lineno">  771</span>&#160;       strcmp(clientcfg-&gt;<a class="code" href="../../da/d00/structast__xmpp__client__config.html#a54125aa1f0e661889f7a44db13a2b4b8">password</a>, oldclientcfg-&gt;password) ||</div><div class="line"><a name="l00772"></a><span class="lineno">  772</span>&#160;       strcmp(clientcfg-&gt;<a class="code" href="../../da/d00/structast__xmpp__client__config.html#ad300470818476484645b03f3c0c66591">refresh_token</a>, oldclientcfg-&gt;refresh_token) ||</div><div class="line"><a name="l00773"></a><span class="lineno">  773</span>&#160;       strcmp(clientcfg-&gt;<a class="code" href="../../da/d00/structast__xmpp__client__config.html#a4b8582884dc99ca78481aaf09d2a8aaa">oauth_clientid</a>, oldclientcfg-&gt;oauth_clientid) ||</div><div class="line"><a name="l00774"></a><span class="lineno">  774</span>&#160;       strcmp(clientcfg-&gt;<a class="code" href="../../da/d00/structast__xmpp__client__config.html#a4e8ff91b48d6fcdfb7f0265d59bdd979">oauth_secret</a>, oldclientcfg-&gt;oauth_secret) ||</div><div class="line"><a name="l00775"></a><span class="lineno">  775</span>&#160;       strcmp(clientcfg-&gt;<a class="code" href="../../da/d00/structast__xmpp__client__config.html#a0246557045a820161e6e736a1b16f31f">server</a>, oldclientcfg-&gt;server) ||</div><div class="line"><a name="l00776"></a><span class="lineno">  776</span>&#160;       (clientcfg-&gt;<a class="code" href="../../da/d00/structast__xmpp__client__config.html#a63c89c04d1feae07ca35558055155ffb">port</a> != oldclientcfg-&gt;port) ||</div><div class="line"><a name="l00777"></a><span class="lineno">  777</span>&#160;       (<a class="code" href="../../d5/d60/utils_8h.html#a00d4c9254c9827d6fa44f17a326744a5">ast_test_flag</a>(&amp;clientcfg-&gt;<a class="code" href="../../da/d00/structast__xmpp__client__config.html#aec78000b2897c094f68ed72559e18acd">flags</a>, <a class="code" href="../../dc/d6b/res__xmpp_8c.html#aa3759d2ddcc12f3f5ef5a8a3ffa4a4dfadc3efad94dcc216c29d42b23edcb2d00">XMPP_COMPONENT</a>) != <a class="code" href="../../d5/d60/utils_8h.html#a00d4c9254c9827d6fa44f17a326744a5">ast_test_flag</a>(&amp;oldclientcfg-&gt;flags, <a class="code" href="../../dc/d6b/res__xmpp_8c.html#aa3759d2ddcc12f3f5ef5a8a3ffa4a4dfadc3efad94dcc216c29d42b23edcb2d00">XMPP_COMPONENT</a>)) ||</div><div class="line"><a name="l00778"></a><span class="lineno">  778</span>&#160;       (clientcfg-&gt;<a class="code" href="../../da/d00/structast__xmpp__client__config.html#acec9ce2df15222151ad66fcb1d74eb9f">priority</a> != oldclientcfg-&gt;priority)) {</div><div class="line"><a name="l00779"></a><span class="lineno">  779</span>&#160;      clientcfg-&gt;<a class="code" href="../../da/d00/structast__xmpp__client__config.html#a83bf6907a1184b56931bf86ff744279e">client</a>-&gt;<a class="code" href="../../df/d42/structast__xmpp__client.html#a6588648b50745df0a20957b8d09fd919">reconnect</a> = 1;</div><div class="line"><a name="l00780"></a><span class="lineno">  780</span>&#160;   } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00781"></a><span class="lineno">  781</span>&#160;      clientcfg-&gt;<a class="code" href="../../da/d00/structast__xmpp__client__config.html#a83bf6907a1184b56931bf86ff744279e">client</a>-&gt;<a class="code" href="../../df/d42/structast__xmpp__client.html#a6588648b50745df0a20957b8d09fd919">reconnect</a> = 0;</div><div class="line"><a name="l00782"></a><span class="lineno">  782</span>&#160;   }</div><div class="line"><a name="l00783"></a><span class="lineno">  783</span>&#160;</div><div class="line"><a name="l00784"></a><span class="lineno">  784</span>&#160;   <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00785"></a><span class="lineno">  785</span>&#160;}</div><div class="line"><a name="l00786"></a><span class="lineno">  786</span>&#160;</div><div class="line"><a name="l00787"></a><span class="lineno"><a class="line" href="../../dc/d6b/res__xmpp_8c.html#a21e2c653d707e26b4e8cbbcfa76e7037">  787</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../dc/d6b/res__xmpp_8c.html#a21e2c653d707e26b4e8cbbcfa76e7037">xmpp_config_post_apply</a>(<span class="keywordtype">void</span>)</div><div class="line"><a name="l00788"></a><span class="lineno">  788</span>&#160;{</div><div class="line"><a name="l00789"></a><span class="lineno">  789</span>&#160;   <a class="code" href="../../d5/d60/utils_8h.html#a1604b4d72144dd3d9f7da668e90337e9">RAII_VAR</a>(<span class="keyword">struct</span> <a class="code" href="../../de/d1c/structxmpp__config.html">xmpp_config</a> *, cfg, <a class="code" href="../../d5/da5/astobj2_8h.html#a86d8d6c3c8866ed0a60121da055cd225">ao2_global_obj_ref</a>(<a class="code" href="../../d3/d4e/chan__console_8c.html#aa36e3e2c486b920b166c2d17c5242221">globals</a>), <a class="code" href="../../d5/da5/astobj2_8h.html#a6321ee982370c55ab3c24c72c562cbdd">ao2_cleanup</a>);</div><div class="line"><a name="l00790"></a><span class="lineno">  790</span>&#160;</div><div class="line"><a name="l00791"></a><span class="lineno">  791</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#a47857055118a703ae87ea5ebaf4842ed">ao2_callback</a>(cfg-&gt;clients, <a class="code" href="../../d5/da5/astobj2_8h.html#ad9d009e87e737af900825b36db55a35ca5fc59b193d86a0a8ddfe866304be829d">OBJ_NODATA</a> | <a class="code" href="../../d5/da5/astobj2_8h.html#ad9d009e87e737af900825b36db55a35ca614744a4d36b3189d4ab5b02c8645d47">OBJ_MULTIPLE</a>, <a class="code" href="../../dc/d6b/res__xmpp_8c.html#a3ff94d7d97bc1497542220144f60afbf">xmpp_client_config_post_apply</a>, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div><div class="line"><a name="l00792"></a><span class="lineno">  792</span>&#160;}</div><div class="line"><a name="l00793"></a><span class="lineno">  793</span>&#160;</div><div class="line"><a name="l00794"></a><span class="lineno"><a class="line" href="../../dc/d6b/res__xmpp_8c.html#aeab1543f7ac14f52ba5148960429e849">  794</a></span>&#160;<span class="keyword">static</span> <span class="keyword">struct </span><a class="code" href="../../de/d71/structaco__type.html">aco_type</a> <a class="code" href="../../dc/d6b/res__xmpp_8c.html#aeab1543f7ac14f52ba5148960429e849">global_option</a> = {</div><div class="line"><a name="l00795"></a><span class="lineno">  795</span>&#160;   .<a class="code" href="../../de/d71/structaco__type.html#a41ea490a42392545d2f6e2c6888cd94e">type</a> = <a class="code" href="../../db/dfe/config__options_8h.html#a840871f014617f5415dacb9a7d32a59bab3719e39fd87c376c6f143e337f73e12">ACO_GLOBAL</a>,</div><div class="line"><a name="l00796"></a><span class="lineno">  796</span>&#160;   .name = <span class="stringliteral">&quot;global&quot;</span>,</div><div class="line"><a name="l00797"></a><span class="lineno">  797</span>&#160;   .item_offset = offsetof(<span class="keyword">struct</span> <a class="code" href="../../de/d1c/structxmpp__config.html">xmpp_config</a>, <a class="code" href="../../d8/d4f/test__config_8c.html#ab8aa28659d870c360b8afb1662c1b302">global</a>),</div><div class="line"><a name="l00798"></a><span class="lineno">  798</span>&#160;   .category_match = <a class="code" href="../../db/dfe/config__options_8h.html#ab29e0267f5b05969bcd1d16e97100ebba3e6bada4dbda566888d4317e3bf6343b">ACO_WHITELIST_EXACT</a>,</div><div class="line"><a name="l00799"></a><span class="lineno">  799</span>&#160;   .category = <span class="stringliteral">&quot;general&quot;</span>,</div><div class="line"><a name="l00800"></a><span class="lineno">  800</span>&#160;};</div><div class="line"><a name="l00801"></a><span class="lineno">  801</span>&#160;</div><div class="line"><a name="l00802"></a><span class="lineno"><a class="line" href="../../dc/d6b/res__xmpp_8c.html#a05b71d76cff3ccd9fe2a0c4a16d21271">  802</a></span>&#160;<span class="keyword">struct </span><a class="code" href="../../de/d71/structaco__type.html">aco_type</a> *<a class="code" href="../../dc/d6b/res__xmpp_8c.html#a05b71d76cff3ccd9fe2a0c4a16d21271">global_options</a>[] = <a class="code" href="../../db/dfe/config__options_8h.html#af773eedd7f94d718752798605c687c4b">ACO_TYPES</a>(&amp;global_option);</div><div class="line"><a name="l00803"></a><span class="lineno">  803</span>&#160;</div><div class="line"><a name="l00804"></a><span class="lineno"><a class="line" href="../../dc/d6b/res__xmpp_8c.html#aaff8533a174033f88941d1e57aea183d">  804</a></span>&#160;<span class="keyword">static</span> <span class="keyword">struct </span><a class="code" href="../../de/d71/structaco__type.html">aco_type</a> <a class="code" href="../../dc/d6b/res__xmpp_8c.html#aaff8533a174033f88941d1e57aea183d">client_option</a> = {</div><div class="line"><a name="l00805"></a><span class="lineno">  805</span>&#160;   .<a class="code" href="../../de/d71/structaco__type.html#a41ea490a42392545d2f6e2c6888cd94e">type</a> = <a class="code" href="../../db/dfe/config__options_8h.html#a840871f014617f5415dacb9a7d32a59ba423543a2da4422bd5c7664a0b8ca84d8">ACO_ITEM</a>,</div><div class="line"><a name="l00806"></a><span class="lineno">  806</span>&#160;   .name = <span class="stringliteral">&quot;client&quot;</span>,</div><div class="line"><a name="l00807"></a><span class="lineno">  807</span>&#160;   .category_match = <a class="code" href="../../db/dfe/config__options_8h.html#ab29e0267f5b05969bcd1d16e97100ebbaaac7fc23ff5841dd793b5d145c420eee">ACO_BLACKLIST_EXACT</a>,</div><div class="line"><a name="l00808"></a><span class="lineno">  808</span>&#160;   .category = <span class="stringliteral">&quot;general&quot;</span>,</div><div class="line"><a name="l00809"></a><span class="lineno">  809</span>&#160;   .item_alloc = <a class="code" href="../../dc/d6b/res__xmpp_8c.html#a290fc293cd6e9547fc434b6bb23b0ede">ast_xmpp_client_config_alloc</a>,</div><div class="line"><a name="l00810"></a><span class="lineno">  810</span>&#160;   .item_find = <a class="code" href="../../dc/d6b/res__xmpp_8c.html#a14d10033fb3b97f06238940259f45266">xmpp_config_find</a>,</div><div class="line"><a name="l00811"></a><span class="lineno">  811</span>&#160;   .item_prelink = <a class="code" href="../../dc/d6b/res__xmpp_8c.html#a824abffc29ae94875ca0f3c3526ebbbe">xmpp_config_prelink</a>,</div><div class="line"><a name="l00812"></a><span class="lineno">  812</span>&#160;   .item_offset = offsetof(<span class="keyword">struct</span> <a class="code" href="../../de/d1c/structxmpp__config.html">xmpp_config</a>, clients),</div><div class="line"><a name="l00813"></a><span class="lineno">  813</span>&#160;};</div><div class="line"><a name="l00814"></a><span class="lineno">  814</span>&#160;</div><div class="line"><a name="l00815"></a><span class="lineno"><a class="line" href="../../dc/d6b/res__xmpp_8c.html#a40875f6b772224b7ea66bd2a3bcdf680">  815</a></span>&#160;<span class="keyword">struct </span><a class="code" href="../../de/d71/structaco__type.html">aco_type</a> *<a class="code" href="../../dc/d6b/res__xmpp_8c.html#a40875f6b772224b7ea66bd2a3bcdf680">client_options</a>[] = <a class="code" href="../../db/dfe/config__options_8h.html#af773eedd7f94d718752798605c687c4b">ACO_TYPES</a>(&amp;client_option);</div><div class="line"><a name="l00816"></a><span class="lineno">  816</span>&#160;</div><div class="line"><a name="l00817"></a><span class="lineno"><a class="line" href="../../dc/d6b/res__xmpp_8c.html#aa12ed649e4948ec6111d956215c63913">  817</a></span>&#160;<span class="keyword">struct </span><a class="code" href="../../d9/d9c/structaco__file.html">aco_file</a> <a class="code" href="../../dc/d6b/res__xmpp_8c.html#aa12ed649e4948ec6111d956215c63913">res_xmpp_conf</a> = {</div><div class="line"><a name="l00818"></a><span class="lineno">  818</span>&#160;   .<a class="code" href="../../d9/d9c/structaco__file.html#a7efa5e9c7494c7d4586359300221aa5d">filename</a> = <span class="stringliteral">&quot;xmpp.conf&quot;</span>,</div><div class="line"><a name="l00819"></a><span class="lineno">  819</span>&#160;   .alias = <span class="stringliteral">&quot;jabber.conf&quot;</span>,</div><div class="line"><a name="l00820"></a><span class="lineno">  820</span>&#160;   .types = <a class="code" href="../../db/dfe/config__options_8h.html#af773eedd7f94d718752798605c687c4b">ACO_TYPES</a>(&amp;global_option, &amp;client_option),</div><div class="line"><a name="l00821"></a><span class="lineno">  821</span>&#160;};</div><div class="line"><a name="l00822"></a><span class="lineno">  822</span>&#160;</div><div class="line"><a name="l00823"></a><span class="lineno">  823</span>&#160;<a class="code" href="../../dc/d6b/res__xmpp_8c.html#a0010de435ba84b865dc08a3a0e78fcca">CONFIG_INFO_STANDARD</a>(cfg_info, <a class="code" href="../../d3/d4e/chan__console_8c.html#aa36e3e2c486b920b166c2d17c5242221">globals</a>, <a class="code" href="../../dc/d6b/res__xmpp_8c.html#a411ba34b877bce9bddd1b289c486aabc">xmpp_config_alloc</a>,</div><div class="line"><a name="l00824"></a><span class="lineno">  824</span>&#160;           .files = <a class="code" href="../../db/dfe/config__options_8h.html#a60d2944aab4537720434ab9c90e12418">ACO_FILES</a>(&amp;res_xmpp_conf),</div><div class="line"><a name="l00825"></a><span class="lineno">  825</span>&#160;           .post_apply_config = <a class="code" href="../../dc/d6b/res__xmpp_8c.html#a21e2c653d707e26b4e8cbbcfa76e7037">xmpp_config_post_apply</a>,</div><div class="line"><a name="l00826"></a><span class="lineno">  826</span>&#160;   );</div><div class="line"><a name="l00827"></a><span class="lineno">  827</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00828"></a><span class="lineno">  828</span>&#160;<span class="comment">/*! \brief Destructor callback function for XMPP resource */</span></div><div class="line"><a name="l00829"></a><span class="lineno"><a class="line" href="../../dc/d6b/res__xmpp_8c.html#af278a5f2035bacdf8351da59953f7605">  829</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../dc/d6b/res__xmpp_8c.html#af278a5f2035bacdf8351da59953f7605">xmpp_resource_destructor</a>(<span class="keywordtype">void</span> *obj)</div><div class="line"><a name="l00830"></a><span class="lineno">  830</span>&#160;{</div><div class="line"><a name="l00831"></a><span class="lineno">  831</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d6/d90/structast__xmpp__resource.html">ast_xmpp_resource</a> *<a class="code" href="../../d6/d90/structast__xmpp__resource.html#a12856b954fce601a0303b0bcdf83c513">resource</a> = obj;</div><div class="line"><a name="l00832"></a><span class="lineno">  832</span>&#160;</div><div class="line"><a name="l00833"></a><span class="lineno">  833</span>&#160;   <span class="keywordflow">if</span> (resource-&gt;<a class="code" href="../../d6/d90/structast__xmpp__resource.html#a8444d6e0dfe2bbab0b5e7b24308f1559">description</a>) {</div><div class="line"><a name="l00834"></a><span class="lineno">  834</span>&#160;      <a class="code" href="../../d8/d8a/astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(resource-&gt;<a class="code" href="../../d6/d90/structast__xmpp__resource.html#a8444d6e0dfe2bbab0b5e7b24308f1559">description</a>);</div><div class="line"><a name="l00835"></a><span class="lineno">  835</span>&#160;   }</div><div class="line"><a name="l00836"></a><span class="lineno">  836</span>&#160;}</div><div class="line"><a name="l00837"></a><span class="lineno">  837</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00838"></a><span class="lineno">  838</span>&#160;<span class="comment">/*! \brief Hashing function for XMPP resource */</span></div><div class="line"><a name="l00839"></a><span class="lineno"><a class="line" href="../../dc/d6b/res__xmpp_8c.html#a82a61968c7b48011f5e9317d4e1a53a9">  839</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../dc/d6b/res__xmpp_8c.html#a82a61968c7b48011f5e9317d4e1a53a9">xmpp_resource_hash</a>(<span class="keyword">const</span> <span class="keywordtype">void</span> *obj, <span class="keyword">const</span> <span class="keywordtype">int</span> flags)</div><div class="line"><a name="l00840"></a><span class="lineno">  840</span>&#160;{</div><div class="line"><a name="l00841"></a><span class="lineno">  841</span>&#160;   <span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="../../d6/d90/structast__xmpp__resource.html">ast_xmpp_resource</a> *<a class="code" href="../../d6/d90/structast__xmpp__resource.html#a12856b954fce601a0303b0bcdf83c513">resource</a> = obj;</div><div class="line"><a name="l00842"></a><span class="lineno">  842</span>&#160;</div><div class="line"><a name="l00843"></a><span class="lineno">  843</span>&#160;   <span class="keywordflow">return</span> flags &amp; <a class="code" href="../../d5/da5/astobj2_8h.html#a22f40c733a085f259af94e864ebaa09a">OBJ_KEY</a> ? -1 : resource-&gt;<a class="code" href="../../d6/d90/structast__xmpp__resource.html#acec9ce2df15222151ad66fcb1d74eb9f">priority</a>;</div><div class="line"><a name="l00844"></a><span class="lineno">  844</span>&#160;}</div><div class="line"><a name="l00845"></a><span class="lineno">  845</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00846"></a><span class="lineno">  846</span>&#160;<span class="comment">/*! \brief Comparator function for XMPP resource */</span></div><div class="line"><a name="l00847"></a><span class="lineno"><a class="line" href="../../dc/d6b/res__xmpp_8c.html#a32325f89202eb73b55ba2c0402cc1bf1">  847</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../dc/d6b/res__xmpp_8c.html#a32325f89202eb73b55ba2c0402cc1bf1">xmpp_resource_cmp</a>(<span class="keywordtype">void</span> *obj, <span class="keywordtype">void</span> *arg, <span class="keywordtype">int</span> flags)</div><div class="line"><a name="l00848"></a><span class="lineno">  848</span>&#160;{</div><div class="line"><a name="l00849"></a><span class="lineno">  849</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d6/d90/structast__xmpp__resource.html">ast_xmpp_resource</a> *resource1 = obj;</div><div class="line"><a name="l00850"></a><span class="lineno">  850</span>&#160;   <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="../../d6/d90/structast__xmpp__resource.html#a12856b954fce601a0303b0bcdf83c513">resource</a> = arg;</div><div class="line"><a name="l00851"></a><span class="lineno">  851</span>&#160;</div><div class="line"><a name="l00852"></a><span class="lineno">  852</span>&#160;   <span class="keywordflow">return</span> !strcmp(resource1-&gt;<a class="code" href="../../d6/d90/structast__xmpp__resource.html#a12856b954fce601a0303b0bcdf83c513">resource</a>, resource) ? <a class="code" href="../../d5/da5/astobj2_8h.html#a1f8b41308be4c47de8ff89a3b9c7e7d1a1959468a3c5d6aecd2fa1272d8e30fbf">CMP_MATCH</a> | <a class="code" href="../../d5/da5/astobj2_8h.html#a1f8b41308be4c47de8ff89a3b9c7e7d1a75382dc9117cc118719edf6c3d2b71df">CMP_STOP</a> : 0;</div><div class="line"><a name="l00853"></a><span class="lineno">  853</span>&#160;}</div><div class="line"><a name="l00854"></a><span class="lineno">  854</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00855"></a><span class="lineno">  855</span>&#160;<span class="comment">/*! \brief Destructor callback function for XMPP buddy */</span></div><div class="line"><a name="l00856"></a><span class="lineno"><a class="line" href="../../dc/d6b/res__xmpp_8c.html#aa8360dfe4cb230e7c33bc302e2667111">  856</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../dc/d6b/res__xmpp_8c.html#aa8360dfe4cb230e7c33bc302e2667111">xmpp_buddy_destructor</a>(<span class="keywordtype">void</span> *obj)</div><div class="line"><a name="l00857"></a><span class="lineno">  857</span>&#160;{</div><div class="line"><a name="l00858"></a><span class="lineno">  858</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d5/d25/structast__xmpp__buddy.html">ast_xmpp_buddy</a> *buddy = obj;</div><div class="line"><a name="l00859"></a><span class="lineno">  859</span>&#160;</div><div class="line"><a name="l00860"></a><span class="lineno">  860</span>&#160;   <span class="keywordflow">if</span> (buddy-&gt;<a class="code" href="../../d5/d25/structast__xmpp__buddy.html#ae3222a7c2c3040d71427c9a8b33ac38c">resources</a>) {</div><div class="line"><a name="l00861"></a><span class="lineno">  861</span>&#160;      <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(buddy-&gt;<a class="code" href="../../d5/d25/structast__xmpp__buddy.html#ae3222a7c2c3040d71427c9a8b33ac38c">resources</a>, -1);</div><div class="line"><a name="l00862"></a><span class="lineno">  862</span>&#160;   }</div><div class="line"><a name="l00863"></a><span class="lineno">  863</span>&#160;}</div><div class="line"><a name="l00864"></a><span class="lineno">  864</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00865"></a><span class="lineno">  865</span>&#160;<span class="comment">/*! \brief Helper function which returns whether an XMPP client connection is secure or not */</span></div><div class="line"><a name="l00866"></a><span class="lineno"><a class="line" href="../../dc/d6b/res__xmpp_8c.html#ae13d4153b0221e790967206a41a9e253">  866</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../dc/d6b/res__xmpp_8c.html#ae13d4153b0221e790967206a41a9e253">xmpp_is_secure</a>(<span class="keyword">struct</span> <a class="code" href="../../df/d42/structast__xmpp__client.html">ast_xmpp_client</a> *client)</div><div class="line"><a name="l00867"></a><span class="lineno">  867</span>&#160;{</div><div class="line"><a name="l00868"></a><span class="lineno">  868</span>&#160;<span class="preprocessor">#ifdef HAVE_OPENSSL</span></div><div class="line"><a name="l00869"></a><span class="lineno">  869</span>&#160;   <span class="keywordflow">return</span> client-&gt;<a class="code" href="../../df/d42/structast__xmpp__client.html#aa663ff5d560561c647a50b58adce4e7a">stream_flags</a> &amp; SECURE;</div><div class="line"><a name="l00870"></a><span class="lineno">  870</span>&#160;<span class="preprocessor">#else</span></div><div class="line"><a name="l00871"></a><span class="lineno">  871</span>&#160;   <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00872"></a><span class="lineno">  872</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00873"></a><span class="lineno">  873</span>&#160;}</div><div class="line"><a name="l00874"></a><span class="lineno">  874</span>&#160;</div><div class="line"><a name="l00875"></a><span class="lineno"><a class="line" href="../../dc/d6b/res__xmpp_8c.html#afdce9cb2efa5b4eff4cd68976402e8b1">  875</a></span>&#160;<span class="keyword">struct </span><a class="code" href="../../df/d42/structast__xmpp__client.html">ast_xmpp_client</a> *<a class="code" href="../../dc/d6b/res__xmpp_8c.html#afdce9cb2efa5b4eff4cd68976402e8b1">ast_xmpp_client_find</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="../../d0/d29/cdr__mysql_8c.html#a0980a105ccb863d8008eb6201a51da52">name</a>)</div><div class="line"><a name="l00876"></a><span class="lineno">  876</span>&#160;{</div><div class="line"><a name="l00877"></a><span class="lineno">  877</span>&#160;   <a class="code" href="../../d5/d60/utils_8h.html#a1604b4d72144dd3d9f7da668e90337e9">RAII_VAR</a>(<span class="keyword">struct</span> <a class="code" href="../../de/d1c/structxmpp__config.html">xmpp_config</a> *, cfg, <a class="code" href="../../d5/da5/astobj2_8h.html#a86d8d6c3c8866ed0a60121da055cd225">ao2_global_obj_ref</a>(<a class="code" href="../../d3/d4e/chan__console_8c.html#aa36e3e2c486b920b166c2d17c5242221">globals</a>), <a class="code" href="../../d5/da5/astobj2_8h.html#a6321ee982370c55ab3c24c72c562cbdd">ao2_cleanup</a>);</div><div class="line"><a name="l00878"></a><span class="lineno">  878</span>&#160;   <a class="code" href="../../d5/d60/utils_8h.html#a1604b4d72144dd3d9f7da668e90337e9">RAII_VAR</a>(<span class="keyword">struct</span> <a class="code" href="../../da/d00/structast__xmpp__client__config.html">ast_xmpp_client_config</a> *, clientcfg, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../d5/da5/astobj2_8h.html#a6321ee982370c55ab3c24c72c562cbdd">ao2_cleanup</a>);</div><div class="line"><a name="l00879"></a><span class="lineno">  879</span>&#160;</div><div class="line"><a name="l00880"></a><span class="lineno">  880</span>&#160;   <span class="keywordflow">if</span> (!cfg || !cfg-&gt;clients || !(clientcfg = <a class="code" href="../../dc/d6b/res__xmpp_8c.html#a14d10033fb3b97f06238940259f45266">xmpp_config_find</a>(cfg-&gt;clients, name))) {</div><div class="line"><a name="l00881"></a><span class="lineno">  881</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l00882"></a><span class="lineno">  882</span>&#160;   }</div><div class="line"><a name="l00883"></a><span class="lineno">  883</span>&#160;</div><div class="line"><a name="l00884"></a><span class="lineno">  884</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(clientcfg-&gt;client, +1);</div><div class="line"><a name="l00885"></a><span class="lineno">  885</span>&#160;   <span class="keywordflow">return</span> clientcfg-&gt;client;</div><div class="line"><a name="l00886"></a><span class="lineno">  886</span>&#160;}</div><div class="line"><a name="l00887"></a><span class="lineno">  887</span>&#160;</div><div class="line"><a name="l00888"></a><span class="lineno"><a class="line" href="../../dc/d6b/res__xmpp_8c.html#a169296c840b246f178488ab5fdc8b498">  888</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../dc/d6b/res__xmpp_8c.html#a169296c840b246f178488ab5fdc8b498">ast_xmpp_client_unref</a>(<span class="keyword">struct</span> <a class="code" href="../../df/d42/structast__xmpp__client.html">ast_xmpp_client</a> *client)</div><div class="line"><a name="l00889"></a><span class="lineno">  889</span>&#160;{</div><div class="line"><a name="l00890"></a><span class="lineno">  890</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(client, -1);</div><div class="line"><a name="l00891"></a><span class="lineno">  891</span>&#160;}</div><div class="line"><a name="l00892"></a><span class="lineno">  892</span>&#160;</div><div class="line"><a name="l00893"></a><span class="lineno"><a class="line" href="../../dc/d6b/res__xmpp_8c.html#a8ca3a53044fbd45f15aabf626faac619">  893</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../dc/d6b/res__xmpp_8c.html#a8ca3a53044fbd45f15aabf626faac619">ast_xmpp_client_lock</a>(<span class="keyword">struct</span> <a class="code" href="../../df/d42/structast__xmpp__client.html">ast_xmpp_client</a> *client)</div><div class="line"><a name="l00894"></a><span class="lineno">  894</span>&#160;{</div><div class="line"><a name="l00895"></a><span class="lineno">  895</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#aa9fdb5d0a6157a56060d9f7279fe6c49">ao2_lock</a>(client);</div><div class="line"><a name="l00896"></a><span class="lineno">  896</span>&#160;}</div><div class="line"><a name="l00897"></a><span class="lineno">  897</span>&#160;</div><div class="line"><a name="l00898"></a><span class="lineno"><a class="line" href="../../dc/d6b/res__xmpp_8c.html#a28e4ab2757e6f989d4300ecbbe5acf36">  898</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../dc/d6b/res__xmpp_8c.html#a28e4ab2757e6f989d4300ecbbe5acf36">ast_xmpp_client_unlock</a>(<span class="keyword">struct</span> <a class="code" href="../../df/d42/structast__xmpp__client.html">ast_xmpp_client</a> *client)</div><div class="line"><a name="l00899"></a><span class="lineno">  899</span>&#160;{</div><div class="line"><a name="l00900"></a><span class="lineno">  900</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#a9998bd156b936636a8780385e9a910b2">ao2_unlock</a>(client);</div><div class="line"><a name="l00901"></a><span class="lineno">  901</span>&#160;}</div><div class="line"><a name="l00902"></a><span class="lineno">  902</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00903"></a><span class="lineno">  903</span>&#160;<span class="comment">/*! \brief Internal function used to send a message to a user or chatroom */</span></div><div class="line"><a name="l00904"></a><span class="lineno"><a class="line" href="../../dc/d6b/res__xmpp_8c.html#a65f7b336543acb8fb68f3f2b814d6b30">  904</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../dc/d6b/res__xmpp_8c.html#a65f7b336543acb8fb68f3f2b814d6b30">xmpp_client_send_message</a>(<span class="keyword">struct</span> <a class="code" href="../../df/d42/structast__xmpp__client.html">ast_xmpp_client</a> *client, <span class="keywordtype">int</span> <a class="code" href="../../d3/d08/structgroup.html">group</a>, <span class="keyword">const</span> <span class="keywordtype">char</span> *nick, <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="../../dc/dc2/f2c_8h.html#a27c1bdb0cba23a9db2a51eed7b3b2ac1">address</a>, <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="../../d8/d9e/structmessage.html">message</a>)</div><div class="line"><a name="l00905"></a><span class="lineno">  905</span>&#160;{</div><div class="line"><a name="l00906"></a><span class="lineno">  906</span>&#160;   <a class="code" href="../../d5/d60/utils_8h.html#a1604b4d72144dd3d9f7da668e90337e9">RAII_VAR</a>(<span class="keyword">struct</span> <a class="code" href="../../de/d1c/structxmpp__config.html">xmpp_config</a> *, cfg, <a class="code" href="../../d5/da5/astobj2_8h.html#a86d8d6c3c8866ed0a60121da055cd225">ao2_global_obj_ref</a>(<a class="code" href="../../d3/d4e/chan__console_8c.html#aa36e3e2c486b920b166c2d17c5242221">globals</a>), <a class="code" href="../../d5/da5/astobj2_8h.html#a6321ee982370c55ab3c24c72c562cbdd">ao2_cleanup</a>);</div><div class="line"><a name="l00907"></a><span class="lineno">  907</span>&#160;   <a class="code" href="../../d5/d60/utils_8h.html#a1604b4d72144dd3d9f7da668e90337e9">RAII_VAR</a>(<span class="keyword">struct</span> <a class="code" href="../../da/d00/structast__xmpp__client__config.html">ast_xmpp_client_config</a> *, clientcfg, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../d5/da5/astobj2_8h.html#a6321ee982370c55ab3c24c72c562cbdd">ao2_cleanup</a>);</div><div class="line"><a name="l00908"></a><span class="lineno">  908</span>&#160;   <span class="keywordtype">int</span> res = 0;</div><div class="line"><a name="l00909"></a><span class="lineno">  909</span>&#160;   <span class="keywordtype">char</span> from[<a class="code" href="../../da/da0/xmpp_8h.html#a88ace060762475a37823dd4bc7b3076f">XMPP_MAX_JIDLEN</a>];</div><div class="line"><a name="l00910"></a><span class="lineno">  910</span>&#160;   iks *message_packet;</div><div class="line"><a name="l00911"></a><span class="lineno">  911</span>&#160;</div><div class="line"><a name="l00912"></a><span class="lineno">  912</span>&#160;   <span class="keywordflow">if</span> (!cfg || !cfg-&gt;clients || !(clientcfg = <a class="code" href="../../dc/d6b/res__xmpp_8c.html#a14d10033fb3b97f06238940259f45266">xmpp_config_find</a>(cfg-&gt;clients, client-&gt;<a class="code" href="../../df/d42/structast__xmpp__client.html#ace9168767fc3707cf5f0a7d049682ba3">name</a>)) ||</div><div class="line"><a name="l00913"></a><span class="lineno">  913</span>&#160;       !(message_packet = iks_make_msg(group ? IKS_TYPE_GROUPCHAT : IKS_TYPE_CHAT, address, message))) {</div><div class="line"><a name="l00914"></a><span class="lineno">  914</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l00915"></a><span class="lineno">  915</span>&#160;   }</div><div class="line"><a name="l00916"></a><span class="lineno">  916</span>&#160;</div><div class="line"><a name="l00917"></a><span class="lineno">  917</span>&#160;   <span class="keywordflow">if</span> (!<a class="code" href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a>(nick) &amp;&amp; <a class="code" href="../../d5/d60/utils_8h.html#a00d4c9254c9827d6fa44f17a326744a5">ast_test_flag</a>(&amp;clientcfg-&gt;flags, <a class="code" href="../../dc/d6b/res__xmpp_8c.html#aa3759d2ddcc12f3f5ef5a8a3ffa4a4dfadc3efad94dcc216c29d42b23edcb2d00">XMPP_COMPONENT</a>)) {</div><div class="line"><a name="l00918"></a><span class="lineno">  918</span>&#160;      snprintf(from, <span class="keyword">sizeof</span>(from), <span class="stringliteral">&quot;%s@%s/%s&quot;</span>, nick, client-&gt;<a class="code" href="../../df/d42/structast__xmpp__client.html#af738439b96e613a471505eb1222ac406">jid</a>-&gt;full, nick);</div><div class="line"><a name="l00919"></a><span class="lineno">  919</span>&#160;   } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00920"></a><span class="lineno">  920</span>&#160;      snprintf(from, <span class="keyword">sizeof</span>(from), <span class="stringliteral">&quot;%s&quot;</span>, client-&gt;<a class="code" href="../../df/d42/structast__xmpp__client.html#af738439b96e613a471505eb1222ac406">jid</a>-&gt;full);</div><div class="line"><a name="l00921"></a><span class="lineno">  921</span>&#160;   }</div><div class="line"><a name="l00922"></a><span class="lineno">  922</span>&#160;</div><div class="line"><a name="l00923"></a><span class="lineno">  923</span>&#160;   iks_insert_attrib(message_packet, <span class="stringliteral">&quot;from&quot;</span>, from);</div><div class="line"><a name="l00924"></a><span class="lineno">  924</span>&#160;</div><div class="line"><a name="l00925"></a><span class="lineno">  925</span>&#160;   res = <a class="code" href="../../dc/d6b/res__xmpp_8c.html#a01f156e90984166f2bbcbcc5a4a6e582">ast_xmpp_client_send</a>(client, message_packet);</div><div class="line"><a name="l00926"></a><span class="lineno">  926</span>&#160;</div><div class="line"><a name="l00927"></a><span class="lineno">  927</span>&#160;   iks_delete(message_packet);</div><div class="line"><a name="l00928"></a><span class="lineno">  928</span>&#160;</div><div class="line"><a name="l00929"></a><span class="lineno">  929</span>&#160;   <span class="keywordflow">return</span> res;</div><div class="line"><a name="l00930"></a><span class="lineno">  930</span>&#160;}</div><div class="line"><a name="l00931"></a><span class="lineno">  931</span>&#160;</div><div class="line"><a name="l00932"></a><span class="lineno"><a class="line" href="../../dc/d6b/res__xmpp_8c.html#a21d05f7d76693ba1145973de7d3f0a03">  932</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="../../dc/d6b/res__xmpp_8c.html#a21d05f7d76693ba1145973de7d3f0a03">ast_xmpp_client_send_message</a>(<span class="keyword">struct</span> <a class="code" href="../../df/d42/structast__xmpp__client.html">ast_xmpp_client</a> *client, <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="../../d8/dbc/structuser.html">user</a>, <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="../../d8/d9e/structmessage.html">message</a>)</div><div class="line"><a name="l00933"></a><span class="lineno">  933</span>&#160;{</div><div class="line"><a name="l00934"></a><span class="lineno">  934</span>&#160;   <span class="keywordflow">return</span> <a class="code" href="../../dc/d6b/res__xmpp_8c.html#a65f7b336543acb8fb68f3f2b814d6b30">xmpp_client_send_message</a>(client, 0, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, user, message);</div><div class="line"><a name="l00935"></a><span class="lineno">  935</span>&#160;}</div><div class="line"><a name="l00936"></a><span class="lineno">  936</span>&#160;</div><div class="line"><a name="l00937"></a><span class="lineno"><a class="line" href="../../dc/d6b/res__xmpp_8c.html#a5ea6322164aec70dc95255761f184036">  937</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="../../dc/d6b/res__xmpp_8c.html#a5ea6322164aec70dc95255761f184036">ast_xmpp_chatroom_invite</a>(<span class="keyword">struct</span> <a class="code" href="../../df/d42/structast__xmpp__client.html">ast_xmpp_client</a> *client, <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="../../d8/dbc/structuser.html">user</a>, <span class="keyword">const</span> <span class="keywordtype">char</span> *room, <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="../../d8/d9e/structmessage.html">message</a>)</div><div class="line"><a name="l00938"></a><span class="lineno">  938</span>&#160;{</div><div class="line"><a name="l00939"></a><span class="lineno">  939</span>&#160;   <span class="keywordtype">int</span> res = 0;</div><div class="line"><a name="l00940"></a><span class="lineno">  940</span>&#160;   iks *invite, *body = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, *<span class="keyword">namespace </span>= <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l00941"></a><span class="lineno">  941</span>&#160;</div><div class="line"><a name="l00942"></a><span class="lineno">  942</span>&#160;   <span class="keywordflow">if</span> (!(invite = iks_new(<span class="stringliteral">&quot;message&quot;</span>)) || !(body = iks_new(<span class="stringliteral">&quot;body&quot;</span>)) || !(<span class="keyword">namespace</span> = iks_new(<span class="stringliteral">&quot;x&quot;</span>))) {</div><div class="line"><a name="l00943"></a><span class="lineno">  943</span>&#160;      res = -1;</div><div class="line"><a name="l00944"></a><span class="lineno">  944</span>&#160;      <span class="keywordflow">goto</span> <a class="code" href="../../dc/dbf/test__amihooks_8c.html#a5992b274cfdcacdbc1fa8347fd01ebde">done</a>;</div><div class="line"><a name="l00945"></a><span class="lineno">  945</span>&#160;   }</div><div class="line"><a name="l00946"></a><span class="lineno">  946</span>&#160;</div><div class="line"><a name="l00947"></a><span class="lineno">  947</span>&#160;   iks_insert_attrib(invite, <span class="stringliteral">&quot;to&quot;</span>, user);</div><div class="line"><a name="l00948"></a><span class="lineno">  948</span>&#160;   <a class="code" href="../../dc/d6b/res__xmpp_8c.html#a8ca3a53044fbd45f15aabf626faac619">ast_xmpp_client_lock</a>(client);</div><div class="line"><a name="l00949"></a><span class="lineno">  949</span>&#160;   iks_insert_attrib(invite, <span class="stringliteral">&quot;id&quot;</span>, client-&gt;<a class="code" href="../../df/d42/structast__xmpp__client.html#abee5661fa88af477fe47bbbd21136301">mid</a>);</div><div class="line"><a name="l00950"></a><span class="lineno">  950</span>&#160;   <a class="code" href="../../dc/d6b/res__xmpp_8c.html#a5eb8d77affaba7e2fe254f7e7fbca789">ast_xmpp_increment_mid</a>(client-&gt;<a class="code" href="../../df/d42/structast__xmpp__client.html#abee5661fa88af477fe47bbbd21136301">mid</a>);</div><div class="line"><a name="l00951"></a><span class="lineno">  951</span>&#160;   <a class="code" href="../../dc/d6b/res__xmpp_8c.html#a28e4ab2757e6f989d4300ecbbe5acf36">ast_xmpp_client_unlock</a>(client);</div><div class="line"><a name="l00952"></a><span class="lineno">  952</span>&#160;   iks_insert_cdata(body, message, 0);</div><div class="line"><a name="l00953"></a><span class="lineno">  953</span>&#160;   iks_insert_node(invite, body);</div><div class="line"><a name="l00954"></a><span class="lineno">  954</span>&#160;   iks_insert_attrib(<span class="keyword">namespace</span>, <span class="stringliteral">&quot;xmlns&quot;</span>, <span class="stringliteral">&quot;jabber:x:conference&quot;</span>);</div><div class="line"><a name="l00955"></a><span class="lineno">  955</span>&#160;   iks_insert_attrib(<span class="keyword">namespace</span>, <span class="stringliteral">&quot;jid&quot;</span>, room);</div><div class="line"><a name="l00956"></a><span class="lineno">  956</span>&#160;   iks_insert_node(invite, <span class="keyword">namespace</span>);</div><div class="line"><a name="l00957"></a><span class="lineno">  957</span>&#160;</div><div class="line"><a name="l00958"></a><span class="lineno">  958</span>&#160;   res = <a class="code" href="../../dc/d6b/res__xmpp_8c.html#a01f156e90984166f2bbcbcc5a4a6e582">ast_xmpp_client_send</a>(client, invite);</div><div class="line"><a name="l00959"></a><span class="lineno">  959</span>&#160;</div><div class="line"><a name="l00960"></a><span class="lineno">  960</span>&#160;<a class="code" href="../../dc/dbf/test__amihooks_8c.html#a5992b274cfdcacdbc1fa8347fd01ebde">done</a>:</div><div class="line"><a name="l00961"></a><span class="lineno">  961</span>&#160;   iks_delete(<span class="keyword">namespace</span>);</div><div class="line"><a name="l00962"></a><span class="lineno">  962</span>&#160;   iks_delete(body);</div><div class="line"><a name="l00963"></a><span class="lineno">  963</span>&#160;   iks_delete(invite);</div><div class="line"><a name="l00964"></a><span class="lineno">  964</span>&#160;</div><div class="line"><a name="l00965"></a><span class="lineno">  965</span>&#160;   <span class="keywordflow">return</span> res;</div><div class="line"><a name="l00966"></a><span class="lineno">  966</span>&#160;}</div><div class="line"><a name="l00967"></a><span class="lineno">  967</span>&#160;</div><div class="line"><a name="l00968"></a><span class="lineno"><a class="line" href="../../dc/d6b/res__xmpp_8c.html#adf0e01ed33114f9da5be8607ab81c741">  968</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../dc/d6b/res__xmpp_8c.html#adf0e01ed33114f9da5be8607ab81c741">xmpp_client_set_group_presence</a>(<span class="keyword">struct</span> <a class="code" href="../../df/d42/structast__xmpp__client.html">ast_xmpp_client</a> *client, <span class="keyword">const</span> <span class="keywordtype">char</span> *room, <span class="keywordtype">int</span> level, <span class="keyword">const</span> <span class="keywordtype">char</span> *nick)</div><div class="line"><a name="l00969"></a><span class="lineno">  969</span>&#160;{</div><div class="line"><a name="l00970"></a><span class="lineno">  970</span>&#160;   <a class="code" href="../../d5/d60/utils_8h.html#a1604b4d72144dd3d9f7da668e90337e9">RAII_VAR</a>(<span class="keyword">struct</span> <a class="code" href="../../de/d1c/structxmpp__config.html">xmpp_config</a> *, cfg, <a class="code" href="../../d5/da5/astobj2_8h.html#a86d8d6c3c8866ed0a60121da055cd225">ao2_global_obj_ref</a>(<a class="code" href="../../d3/d4e/chan__console_8c.html#aa36e3e2c486b920b166c2d17c5242221">globals</a>), <a class="code" href="../../d5/da5/astobj2_8h.html#a6321ee982370c55ab3c24c72c562cbdd">ao2_cleanup</a>);</div><div class="line"><a name="l00971"></a><span class="lineno">  971</span>&#160;   <a class="code" href="../../d5/d60/utils_8h.html#a1604b4d72144dd3d9f7da668e90337e9">RAII_VAR</a>(<span class="keyword">struct</span> <a class="code" href="../../da/d00/structast__xmpp__client__config.html">ast_xmpp_client_config</a> *, clientcfg, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../d5/da5/astobj2_8h.html#a6321ee982370c55ab3c24c72c562cbdd">ao2_cleanup</a>);</div><div class="line"><a name="l00972"></a><span class="lineno">  972</span>&#160;   <span class="keywordtype">int</span> res = 0;</div><div class="line"><a name="l00973"></a><span class="lineno">  973</span>&#160;   iks *presence = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, *x = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l00974"></a><span class="lineno">  974</span>&#160;   <span class="keywordtype">char</span> from[<a class="code" href="../../da/da0/xmpp_8h.html#a88ace060762475a37823dd4bc7b3076f">XMPP_MAX_JIDLEN</a>], roomid[<a class="code" href="../../da/da0/xmpp_8h.html#a88ace060762475a37823dd4bc7b3076f">XMPP_MAX_JIDLEN</a>];</div><div class="line"><a name="l00975"></a><span class="lineno">  975</span>&#160;</div><div class="line"><a name="l00976"></a><span class="lineno">  976</span>&#160;   <span class="keywordflow">if</span> (!cfg || !cfg-&gt;clients || !(clientcfg = <a class="code" href="../../dc/d6b/res__xmpp_8c.html#a14d10033fb3b97f06238940259f45266">xmpp_config_find</a>(cfg-&gt;clients, client-&gt;<a class="code" href="../../df/d42/structast__xmpp__client.html#ace9168767fc3707cf5f0a7d049682ba3">name</a>)) ||</div><div class="line"><a name="l00977"></a><span class="lineno">  977</span>&#160;       !(presence = iks_make_pres(level, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)) || !(x = iks_new(<span class="stringliteral">&quot;x&quot;</span>))) {</div><div class="line"><a name="l00978"></a><span class="lineno">  978</span>&#160;      res = -1;</div><div class="line"><a name="l00979"></a><span class="lineno">  979</span>&#160;      <span class="keywordflow">goto</span> <a class="code" href="../../dc/dbf/test__amihooks_8c.html#a5992b274cfdcacdbc1fa8347fd01ebde">done</a>;</div><div class="line"><a name="l00980"></a><span class="lineno">  980</span>&#160;   }</div><div class="line"><a name="l00981"></a><span class="lineno">  981</span>&#160;</div><div class="line"><a name="l00982"></a><span class="lineno">  982</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d5/d60/utils_8h.html#a00d4c9254c9827d6fa44f17a326744a5">ast_test_flag</a>(&amp;clientcfg-&gt;flags, <a class="code" href="../../dc/d6b/res__xmpp_8c.html#aa3759d2ddcc12f3f5ef5a8a3ffa4a4dfadc3efad94dcc216c29d42b23edcb2d00">XMPP_COMPONENT</a>)) {</div><div class="line"><a name="l00983"></a><span class="lineno">  983</span>&#160;      snprintf(from, <span class="keyword">sizeof</span>(from), <span class="stringliteral">&quot;%s@%s/%s&quot;</span>, nick, client-&gt;<a class="code" href="../../df/d42/structast__xmpp__client.html#af738439b96e613a471505eb1222ac406">jid</a>-&gt;full, nick);</div><div class="line"><a name="l00984"></a><span class="lineno">  984</span>&#160;      snprintf(roomid, <span class="keyword">sizeof</span>(roomid), <span class="stringliteral">&quot;%s/%s&quot;</span>, room, nick);</div><div class="line"><a name="l00985"></a><span class="lineno">  985</span>&#160;   } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00986"></a><span class="lineno">  986</span>&#160;      snprintf(from, <span class="keyword">sizeof</span>(from), <span class="stringliteral">&quot;%s&quot;</span>, client-&gt;<a class="code" href="../../df/d42/structast__xmpp__client.html#af738439b96e613a471505eb1222ac406">jid</a>-&gt;full);</div><div class="line"><a name="l00987"></a><span class="lineno">  987</span>&#160;      snprintf(roomid, <span class="keyword">sizeof</span>(roomid), <span class="stringliteral">&quot;%s/%s&quot;</span>, room, <a class="code" href="../../d6/d90/strings_8h.html#a2faaa16929951bfd2802b7829a100ba2">S_OR</a>(nick, client-&gt;<a class="code" href="../../df/d42/structast__xmpp__client.html#af738439b96e613a471505eb1222ac406">jid</a>-&gt;user));</div><div class="line"><a name="l00988"></a><span class="lineno">  988</span>&#160;   }</div><div class="line"><a name="l00989"></a><span class="lineno">  989</span>&#160;</div><div class="line"><a name="l00990"></a><span class="lineno">  990</span>&#160;   iks_insert_attrib(presence, <span class="stringliteral">&quot;to&quot;</span>, roomid);</div><div class="line"><a name="l00991"></a><span class="lineno">  991</span>&#160;   iks_insert_attrib(presence, <span class="stringliteral">&quot;from&quot;</span>, from);</div><div class="line"><a name="l00992"></a><span class="lineno">  992</span>&#160;   iks_insert_attrib(x, <span class="stringliteral">&quot;xmlns&quot;</span>, <span class="stringliteral">&quot;http://jabber.org/protocol/muc&quot;</span>);</div><div class="line"><a name="l00993"></a><span class="lineno">  993</span>&#160;   iks_insert_node(presence, x);</div><div class="line"><a name="l00994"></a><span class="lineno">  994</span>&#160;</div><div class="line"><a name="l00995"></a><span class="lineno">  995</span>&#160;   res = <a class="code" href="../../dc/d6b/res__xmpp_8c.html#a01f156e90984166f2bbcbcc5a4a6e582">ast_xmpp_client_send</a>(client, presence);</div><div class="line"><a name="l00996"></a><span class="lineno">  996</span>&#160;</div><div class="line"><a name="l00997"></a><span class="lineno">  997</span>&#160;<a class="code" href="../../dc/dbf/test__amihooks_8c.html#a5992b274cfdcacdbc1fa8347fd01ebde">done</a>:</div><div class="line"><a name="l00998"></a><span class="lineno">  998</span>&#160;   iks_delete(x);</div><div class="line"><a name="l00999"></a><span class="lineno">  999</span>&#160;   iks_delete(presence);</div><div class="line"><a name="l01000"></a><span class="lineno"> 1000</span>&#160;</div><div class="line"><a name="l01001"></a><span class="lineno"> 1001</span>&#160;   <span class="keywordflow">return</span> res;</div><div class="line"><a name="l01002"></a><span class="lineno"> 1002</span>&#160;}</div><div class="line"><a name="l01003"></a><span class="lineno"> 1003</span>&#160;</div><div class="line"><a name="l01004"></a><span class="lineno"><a class="line" href="../../dc/d6b/res__xmpp_8c.html#adc271ee017945747c052865b5b6d94a8"> 1004</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="../../dc/d6b/res__xmpp_8c.html#adc271ee017945747c052865b5b6d94a8">ast_xmpp_chatroom_join</a>(<span class="keyword">struct</span> <a class="code" href="../../df/d42/structast__xmpp__client.html">ast_xmpp_client</a> *client, <span class="keyword">const</span> <span class="keywordtype">char</span> *room, <span class="keyword">const</span> <span class="keywordtype">char</span> *nickname)</div><div class="line"><a name="l01005"></a><span class="lineno"> 1005</span>&#160;{</div><div class="line"><a name="l01006"></a><span class="lineno"> 1006</span>&#160;   <span class="keywordflow">return</span> <a class="code" href="../../dc/d6b/res__xmpp_8c.html#adf0e01ed33114f9da5be8607ab81c741">xmpp_client_set_group_presence</a>(client, room, IKS_SHOW_AVAILABLE, nickname);</div><div class="line"><a name="l01007"></a><span class="lineno"> 1007</span>&#160;}</div><div class="line"><a name="l01008"></a><span class="lineno"> 1008</span>&#160;</div><div class="line"><a name="l01009"></a><span class="lineno"><a class="line" href="../../dc/d6b/res__xmpp_8c.html#a1adde8184c850e2d9150c59b5ffcff24"> 1009</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="../../dc/d6b/res__xmpp_8c.html#a1adde8184c850e2d9150c59b5ffcff24">ast_xmpp_chatroom_send</a>(<span class="keyword">struct</span> <a class="code" href="../../df/d42/structast__xmpp__client.html">ast_xmpp_client</a> *client, <span class="keyword">const</span> <span class="keywordtype">char</span> *nickname, <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="../../dc/dc2/f2c_8h.html#a27c1bdb0cba23a9db2a51eed7b3b2ac1">address</a>, <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="../../d8/d9e/structmessage.html">message</a>)</div><div class="line"><a name="l01010"></a><span class="lineno"> 1010</span>&#160;{</div><div class="line"><a name="l01011"></a><span class="lineno"> 1011</span>&#160;   <span class="keywordflow">return</span> <a class="code" href="../../dc/d6b/res__xmpp_8c.html#a65f7b336543acb8fb68f3f2b814d6b30">xmpp_client_send_message</a>(client, 1, nickname, address, message);</div><div class="line"><a name="l01012"></a><span class="lineno"> 1012</span>&#160;}</div><div class="line"><a name="l01013"></a><span class="lineno"> 1013</span>&#160;</div><div class="line"><a name="l01014"></a><span class="lineno"><a class="line" href="../../dc/d6b/res__xmpp_8c.html#a5c2497ea229bcf66b0c800d5d0e69680"> 1014</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="../../dc/d6b/res__xmpp_8c.html#a5c2497ea229bcf66b0c800d5d0e69680">ast_xmpp_chatroom_leave</a>(<span class="keyword">struct</span> <a class="code" href="../../df/d42/structast__xmpp__client.html">ast_xmpp_client</a> *client, <span class="keyword">const</span> <span class="keywordtype">char</span> *room, <span class="keyword">const</span> <span class="keywordtype">char</span> *nickname)</div><div class="line"><a name="l01015"></a><span class="lineno"> 1015</span>&#160;{</div><div class="line"><a name="l01016"></a><span class="lineno"> 1016</span>&#160;   <span class="keywordflow">return</span> <a class="code" href="../../dc/d6b/res__xmpp_8c.html#adf0e01ed33114f9da5be8607ab81c741">xmpp_client_set_group_presence</a>(client, room, IKS_SHOW_UNAVAILABLE, nickname);</div><div class="line"><a name="l01017"></a><span class="lineno"> 1017</span>&#160;}</div><div class="line"><a name="l01018"></a><span class="lineno"> 1018</span>&#160;</div><div class="line"><a name="l01019"></a><span class="lineno"><a class="line" href="../../dc/d6b/res__xmpp_8c.html#a5eb8d77affaba7e2fe254f7e7fbca789"> 1019</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../dc/d6b/res__xmpp_8c.html#a5eb8d77affaba7e2fe254f7e7fbca789">ast_xmpp_increment_mid</a>(<span class="keywordtype">char</span> *mid)</div><div class="line"><a name="l01020"></a><span class="lineno"> 1020</span>&#160;{</div><div class="line"><a name="l01021"></a><span class="lineno"> 1021</span>&#160;   <span class="keywordtype">int</span> i = 0;</div><div class="line"><a name="l01022"></a><span class="lineno"> 1022</span>&#160;</div><div class="line"><a name="l01023"></a><span class="lineno"> 1023</span>&#160;   <span class="keywordflow">for</span> (i = strlen(mid) - 1; i &gt;= 0; i--) {</div><div class="line"><a name="l01024"></a><span class="lineno"> 1024</span>&#160;      <span class="keywordflow">if</span> (mid[i] != <span class="charliteral">&#39;z&#39;</span>) {</div><div class="line"><a name="l01025"></a><span class="lineno"> 1025</span>&#160;         mid[i] = mid[i] + 1;</div><div class="line"><a name="l01026"></a><span class="lineno"> 1026</span>&#160;         i = 0;</div><div class="line"><a name="l01027"></a><span class="lineno"> 1027</span>&#160;      } <span class="keywordflow">else</span> {</div><div class="line"><a name="l01028"></a><span class="lineno"> 1028</span>&#160;         mid[i] = <span class="charliteral">&#39;a&#39;</span>;</div><div class="line"><a name="l01029"></a><span class="lineno"> 1029</span>&#160;      }</div><div class="line"><a name="l01030"></a><span class="lineno"> 1030</span>&#160;   }</div><div class="line"><a name="l01031"></a><span class="lineno"> 1031</span>&#160;}</div><div class="line"><a name="l01032"></a><span class="lineno"> 1032</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01033"></a><span class="lineno"> 1033</span>&#160;<span class="comment">/*!</span></div><div class="line"><a name="l01034"></a><span class="lineno"> 1034</span>&#160;<span class="comment"> * \brief Create an IQ packet</span></div><div class="line"><a name="l01035"></a><span class="lineno"> 1035</span>&#160;<span class="comment"> * \param client the configured XMPP client we use to connect to a XMPP server</span></div><div class="line"><a name="l01036"></a><span class="lineno"> 1036</span>&#160;<span class="comment"> * \param type the type of IQ packet to create</span></div><div class="line"><a name="l01037"></a><span class="lineno"> 1037</span>&#160;<span class="comment"> * \return iks*</span></div><div class="line"><a name="l01038"></a><span class="lineno"> 1038</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l01039"></a><span class="lineno"><a class="line" href="../../dc/d6b/res__xmpp_8c.html#a6b65b4b3c50fb1a3560fbafd70cf21bd"> 1039</a></span>&#160;<span class="keyword">static</span> iks* <a class="code" href="../../dc/d6b/res__xmpp_8c.html#a6b65b4b3c50fb1a3560fbafd70cf21bd">xmpp_pubsub_iq_create</a>(<span class="keyword">struct</span> <a class="code" href="../../df/d42/structast__xmpp__client.html">ast_xmpp_client</a> *client, <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="../../d7/d49/chan__ooh323_8c.html#a4d63fdfe5451ec2248c16a2739190c56">type</a>)</div><div class="line"><a name="l01040"></a><span class="lineno"> 1040</span>&#160;{</div><div class="line"><a name="l01041"></a><span class="lineno"> 1041</span>&#160;   <a class="code" href="../../d5/d60/utils_8h.html#a1604b4d72144dd3d9f7da668e90337e9">RAII_VAR</a>(<span class="keyword">struct</span> <a class="code" href="../../de/d1c/structxmpp__config.html">xmpp_config</a> *, cfg, <a class="code" href="../../d5/da5/astobj2_8h.html#a86d8d6c3c8866ed0a60121da055cd225">ao2_global_obj_ref</a>(<a class="code" href="../../d3/d4e/chan__console_8c.html#aa36e3e2c486b920b166c2d17c5242221">globals</a>), <a class="code" href="../../d5/da5/astobj2_8h.html#a6321ee982370c55ab3c24c72c562cbdd">ao2_cleanup</a>);</div><div class="line"><a name="l01042"></a><span class="lineno"> 1042</span>&#160;   <a class="code" href="../../d5/d60/utils_8h.html#a1604b4d72144dd3d9f7da668e90337e9">RAII_VAR</a>(<span class="keyword">struct</span> <a class="code" href="../../da/d00/structast__xmpp__client__config.html">ast_xmpp_client_config</a> *, clientcfg, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../d5/da5/astobj2_8h.html#a6321ee982370c55ab3c24c72c562cbdd">ao2_cleanup</a>);</div><div class="line"><a name="l01043"></a><span class="lineno"> 1043</span>&#160;   iks *<a class="code" href="../../d0/d29/chan__pjsip_8c.html#a4e2e6fb7d874f0d2deddd2ecfc8afb32">request</a>;</div><div class="line"><a name="l01044"></a><span class="lineno"> 1044</span>&#160;</div><div class="line"><a name="l01045"></a><span class="lineno"> 1045</span>&#160;   <span class="keywordflow">if</span> (!cfg || !cfg-&gt;clients || !(clientcfg = <a class="code" href="../../dc/d6b/res__xmpp_8c.html#a14d10033fb3b97f06238940259f45266">xmpp_config_find</a>(cfg-&gt;clients, client-&gt;<a class="code" href="../../df/d42/structast__xmpp__client.html#ace9168767fc3707cf5f0a7d049682ba3">name</a>)) ||</div><div class="line"><a name="l01046"></a><span class="lineno"> 1046</span>&#160;       !(request = iks_new(<span class="stringliteral">&quot;iq&quot;</span>))) {</div><div class="line"><a name="l01047"></a><span class="lineno"> 1047</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l01048"></a><span class="lineno"> 1048</span>&#160;   }</div><div class="line"><a name="l01049"></a><span class="lineno"> 1049</span>&#160;</div><div class="line"><a name="l01050"></a><span class="lineno"> 1050</span>&#160;   <span class="keywordflow">if</span> (!<a class="code" href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a>(clientcfg-&gt;pubsubnode)) {</div><div class="line"><a name="l01051"></a><span class="lineno"> 1051</span>&#160;      iks_insert_attrib(request, <span class="stringliteral">&quot;to&quot;</span>, clientcfg-&gt;pubsubnode);</div><div class="line"><a name="l01052"></a><span class="lineno"> 1052</span>&#160;   }</div><div class="line"><a name="l01053"></a><span class="lineno"> 1053</span>&#160;</div><div class="line"><a name="l01054"></a><span class="lineno"> 1054</span>&#160;   iks_insert_attrib(request, <span class="stringliteral">&quot;from&quot;</span>, client-&gt;<a class="code" href="../../df/d42/structast__xmpp__client.html#af738439b96e613a471505eb1222ac406">jid</a>-&gt;full);</div><div class="line"><a name="l01055"></a><span class="lineno"> 1055</span>&#160;   iks_insert_attrib(request, <span class="stringliteral">&quot;type&quot;</span>, type);</div><div class="line"><a name="l01056"></a><span class="lineno"> 1056</span>&#160;   <a class="code" href="../../dc/d6b/res__xmpp_8c.html#a8ca3a53044fbd45f15aabf626faac619">ast_xmpp_client_lock</a>(client);</div><div class="line"><a name="l01057"></a><span class="lineno"> 1057</span>&#160;   <a class="code" href="../../dc/d6b/res__xmpp_8c.html#a5eb8d77affaba7e2fe254f7e7fbca789">ast_xmpp_increment_mid</a>(client-&gt;<a class="code" href="../../df/d42/structast__xmpp__client.html#abee5661fa88af477fe47bbbd21136301">mid</a>);</div><div class="line"><a name="l01058"></a><span class="lineno"> 1058</span>&#160;   iks_insert_attrib(request, <span class="stringliteral">&quot;id&quot;</span>, client-&gt;<a class="code" href="../../df/d42/structast__xmpp__client.html#abee5661fa88af477fe47bbbd21136301">mid</a>);</div><div class="line"><a name="l01059"></a><span class="lineno"> 1059</span>&#160;   <a class="code" href="../../dc/d6b/res__xmpp_8c.html#a28e4ab2757e6f989d4300ecbbe5acf36">ast_xmpp_client_unlock</a>(client);</div><div class="line"><a name="l01060"></a><span class="lineno"> 1060</span>&#160;</div><div class="line"><a name="l01061"></a><span class="lineno"> 1061</span>&#160;   <span class="keywordflow">return</span> <a class="code" href="../../d0/d29/chan__pjsip_8c.html#a4e2e6fb7d874f0d2deddd2ecfc8afb32">request</a>;</div><div class="line"><a name="l01062"></a><span class="lineno"> 1062</span>&#160;}</div><div class="line"><a name="l01063"></a><span class="lineno"> 1063</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01064"></a><span class="lineno"> 1064</span>&#160;<span class="comment">/*!</span></div><div class="line"><a name="l01065"></a><span class="lineno"> 1065</span>&#160;<span class="comment"> * \brief Build the skeleton of a publish</span></div><div class="line"><a name="l01066"></a><span class="lineno"> 1066</span>&#160;<span class="comment"> * \param client the configured XMPP client we use to connect to a XMPP server</span></div><div class="line"><a name="l01067"></a><span class="lineno"> 1067</span>&#160;<span class="comment"> * \param node Name of the node that will be published to</span></div><div class="line"><a name="l01068"></a><span class="lineno"> 1068</span>&#160;<span class="comment"> * \param event_type</span></div><div class="line"><a name="l01069"></a><span class="lineno"> 1069</span>&#160;<span class="comment"> * \return iks *</span></div><div class="line"><a name="l01070"></a><span class="lineno"> 1070</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l01071"></a><span class="lineno"><a class="line" href="../../dc/d6b/res__xmpp_8c.html#a244b9b274ea2f4f90ff95a60fc7935f5"> 1071</a></span>&#160;<span class="keyword">static</span> iks* <a class="code" href="../../dc/d6b/res__xmpp_8c.html#a244b9b274ea2f4f90ff95a60fc7935f5">xmpp_pubsub_build_publish_skeleton</a>(<span class="keyword">struct</span> <a class="code" href="../../df/d42/structast__xmpp__client.html">ast_xmpp_client</a> *client, <span class="keyword">const</span> <span class="keywordtype">char</span> *node,</div><div class="line"><a name="l01072"></a><span class="lineno"> 1072</span>&#160;                      <span class="keyword">const</span> <span class="keywordtype">char</span> *event_type, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> cachable)</div><div class="line"><a name="l01073"></a><span class="lineno"> 1073</span>&#160;{</div><div class="line"><a name="l01074"></a><span class="lineno"> 1074</span>&#160;   <a class="code" href="../../d5/d60/utils_8h.html#a1604b4d72144dd3d9f7da668e90337e9">RAII_VAR</a>(<span class="keyword">struct</span> <a class="code" href="../../de/d1c/structxmpp__config.html">xmpp_config</a> *, cfg, <a class="code" href="../../d5/da5/astobj2_8h.html#a86d8d6c3c8866ed0a60121da055cd225">ao2_global_obj_ref</a>(<a class="code" href="../../d3/d4e/chan__console_8c.html#aa36e3e2c486b920b166c2d17c5242221">globals</a>), <a class="code" href="../../d5/da5/astobj2_8h.html#a6321ee982370c55ab3c24c72c562cbdd">ao2_cleanup</a>);</div><div class="line"><a name="l01075"></a><span class="lineno"> 1075</span>&#160;   iks *<a class="code" href="../../d0/d29/chan__pjsip_8c.html#a4e2e6fb7d874f0d2deddd2ecfc8afb32">request</a>, *<a class="code" href="../../da/d70/structast__xmpp__global__config.html#ab40b53f823544fcdeff79c7fc6beb69b">pubsub</a>, *<a class="code" href="../../d1/da4/res__corosync_8c.html#aa4002959b64099e84d20e09e38c2e51e">publish</a>, *<a class="code" href="../../d8/d4f/test__config_8c.html#aecdc7cbd5dfa76493c0212caa55d706c">item</a>;</div><div class="line"><a name="l01076"></a><span class="lineno"> 1076</span>&#160;</div><div class="line"><a name="l01077"></a><span class="lineno"> 1077</span>&#160;   <span class="keywordflow">if</span> (!cfg || !cfg-&gt;global || !(request = <a class="code" href="../../dc/d6b/res__xmpp_8c.html#a6b65b4b3c50fb1a3560fbafd70cf21bd">xmpp_pubsub_iq_create</a>(client, <span class="stringliteral">&quot;set&quot;</span>))) {</div><div class="line"><a name="l01078"></a><span class="lineno"> 1078</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l01079"></a><span class="lineno"> 1079</span>&#160;   }</div><div class="line"><a name="l01080"></a><span class="lineno"> 1080</span>&#160;</div><div class="line"><a name="l01081"></a><span class="lineno"> 1081</span>&#160;   pubsub = iks_insert(request, <span class="stringliteral">&quot;pubsub&quot;</span>);</div><div class="line"><a name="l01082"></a><span class="lineno"> 1082</span>&#160;   iks_insert_attrib(pubsub, <span class="stringliteral">&quot;xmlns&quot;</span>, <span class="stringliteral">&quot;http://jabber.org/protocol/pubsub&quot;</span>);</div><div class="line"><a name="l01083"></a><span class="lineno"> 1083</span>&#160;   publish = iks_insert(pubsub, <span class="stringliteral">&quot;publish&quot;</span>);</div><div class="line"><a name="l01084"></a><span class="lineno"> 1084</span>&#160;   iks_insert_attrib(publish, <span class="stringliteral">&quot;node&quot;</span>, <a class="code" href="../../d5/d60/utils_8h.html#a00d4c9254c9827d6fa44f17a326744a5">ast_test_flag</a>(&amp;cfg-&gt;global-&gt;pubsub, <a class="code" href="../../dc/d6b/res__xmpp_8c.html#ac5b95f02723021833cc47477b06a962ca045d4dbda72ca97ef5ef8c383279d7dc">XMPP_XEP0248</a>) ? node : event_type);</div><div class="line"><a name="l01085"></a><span class="lineno"> 1085</span>&#160;   item = iks_insert(publish, <span class="stringliteral">&quot;item&quot;</span>);</div><div class="line"><a name="l01086"></a><span class="lineno"> 1086</span>&#160;   iks_insert_attrib(item, <span class="stringliteral">&quot;id&quot;</span>, node);</div><div class="line"><a name="l01087"></a><span class="lineno"> 1087</span>&#160;</div><div class="line"><a name="l01088"></a><span class="lineno"> 1088</span>&#160;   <span class="keywordflow">if</span> (cachable == <a class="code" href="../../da/da2/devicestate_8h.html#a26cbac580d3e86b529f90058f6e91ac7a4dbd4bd0c7bf0b9d8c3c2c800d39cfc1">AST_DEVSTATE_NOT_CACHABLE</a>) {</div><div class="line"><a name="l01089"></a><span class="lineno"> 1089</span>&#160;      iks *<a class="code" href="../../d4/d45/test__http__media__cache_8c.html#a80c8e3ae5087d90d422675d034eeebc7">options</a>, *x, *field_form_type, *field_persist;</div><div class="line"><a name="l01090"></a><span class="lineno"> 1090</span>&#160;</div><div class="line"><a name="l01091"></a><span class="lineno"> 1091</span>&#160;      options = iks_insert(pubsub, <span class="stringliteral">&quot;publish-options&quot;</span>);</div><div class="line"><a name="l01092"></a><span class="lineno"> 1092</span>&#160;      x = iks_insert(options, <span class="stringliteral">&quot;x&quot;</span>);</div><div class="line"><a name="l01093"></a><span class="lineno"> 1093</span>&#160;      iks_insert_attrib(x, <span class="stringliteral">&quot;xmlns&quot;</span>, <span class="stringliteral">&quot;jabber:x:data&quot;</span>);</div><div class="line"><a name="l01094"></a><span class="lineno"> 1094</span>&#160;      iks_insert_attrib(x, <span class="stringliteral">&quot;type&quot;</span>, <span class="stringliteral">&quot;submit&quot;</span>);</div><div class="line"><a name="l01095"></a><span class="lineno"> 1095</span>&#160;      field_form_type = iks_insert(x, <span class="stringliteral">&quot;field&quot;</span>);</div><div class="line"><a name="l01096"></a><span class="lineno"> 1096</span>&#160;      iks_insert_attrib(field_form_type, <span class="stringliteral">&quot;var&quot;</span>, <span class="stringliteral">&quot;FORM_TYPE&quot;</span>);</div><div class="line"><a name="l01097"></a><span class="lineno"> 1097</span>&#160;      iks_insert_attrib(field_form_type, <span class="stringliteral">&quot;type&quot;</span>, <span class="stringliteral">&quot;hidden&quot;</span>);</div><div class="line"><a name="l01098"></a><span class="lineno"> 1098</span>&#160;      iks_insert_cdata(iks_insert(field_form_type, <span class="stringliteral">&quot;value&quot;</span>), <span class="stringliteral">&quot;http://jabber.org/protocol/pubsub#publish-options&quot;</span>, 0);</div><div class="line"><a name="l01099"></a><span class="lineno"> 1099</span>&#160;      field_persist = iks_insert(x, <span class="stringliteral">&quot;field&quot;</span>);</div><div class="line"><a name="l01100"></a><span class="lineno"> 1100</span>&#160;      iks_insert_attrib(field_persist, <span class="stringliteral">&quot;var&quot;</span>, <span class="stringliteral">&quot;pubsub#persist_items&quot;</span>);</div><div class="line"><a name="l01101"></a><span class="lineno"> 1101</span>&#160;      iks_insert_cdata(iks_insert(field_persist, <span class="stringliteral">&quot;value&quot;</span>), <span class="stringliteral">&quot;0&quot;</span>, 1);</div><div class="line"><a name="l01102"></a><span class="lineno"> 1102</span>&#160;   }</div><div class="line"><a name="l01103"></a><span class="lineno"> 1103</span>&#160;</div><div class="line"><a name="l01104"></a><span class="lineno"> 1104</span>&#160;   <span class="keywordflow">return</span> <a class="code" href="../../d8/d4f/test__config_8c.html#aecdc7cbd5dfa76493c0212caa55d706c">item</a>;</div><div class="line"><a name="l01105"></a><span class="lineno"> 1105</span>&#160;</div><div class="line"><a name="l01106"></a><span class="lineno"> 1106</span>&#160;}</div><div class="line"><a name="l01107"></a><span class="lineno"> 1107</span>&#160;</div><div class="line"><a name="l01108"></a><span class="lineno"><a class="line" href="../../dc/d6b/res__xmpp_8c.html#acfb92986809bdc3d6dac95527cd8f9bb"> 1108</a></span>&#160;<span class="keyword">static</span> iks* <a class="code" href="../../dc/d6b/res__xmpp_8c.html#acfb92986809bdc3d6dac95527cd8f9bb">xmpp_pubsub_build_node_config</a>(iks *pubsub, <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="../../d3/dd1/ast__expr2_8c.html#a6a276b85e2da28c5f9c3dbce61c55682">node_type</a>, <span class="keyword">const</span> <span class="keywordtype">char</span> *collection_name)</div><div class="line"><a name="l01109"></a><span class="lineno"> 1109</span>&#160;{</div><div class="line"><a name="l01110"></a><span class="lineno"> 1110</span>&#160;   iks *configure, *x, *field_owner, *field_node_type, *field_node_config,</div><div class="line"><a name="l01111"></a><span class="lineno"> 1111</span>&#160;      *field_deliver_payload, *field_persist_items, *field_access_model,</div><div class="line"><a name="l01112"></a><span class="lineno"> 1112</span>&#160;      *field_pubsub_collection;</div><div class="line"><a name="l01113"></a><span class="lineno"> 1113</span>&#160;   configure = iks_insert(pubsub, <span class="stringliteral">&quot;configure&quot;</span>);</div><div class="line"><a name="l01114"></a><span class="lineno"> 1114</span>&#160;   x = iks_insert(configure, <span class="stringliteral">&quot;x&quot;</span>);</div><div class="line"><a name="l01115"></a><span class="lineno"> 1115</span>&#160;   iks_insert_attrib(x, <span class="stringliteral">&quot;xmlns&quot;</span>, <span class="stringliteral">&quot;jabber:x:data&quot;</span>);</div><div class="line"><a name="l01116"></a><span class="lineno"> 1116</span>&#160;   iks_insert_attrib(x, <span class="stringliteral">&quot;type&quot;</span>, <span class="stringliteral">&quot;submit&quot;</span>);</div><div class="line"><a name="l01117"></a><span class="lineno"> 1117</span>&#160;   field_owner = iks_insert(x, <span class="stringliteral">&quot;field&quot;</span>);</div><div class="line"><a name="l01118"></a><span class="lineno"> 1118</span>&#160;   iks_insert_attrib(field_owner, <span class="stringliteral">&quot;var&quot;</span>, <span class="stringliteral">&quot;FORM_TYPE&quot;</span>);</div><div class="line"><a name="l01119"></a><span class="lineno"> 1119</span>&#160;   iks_insert_attrib(field_owner, <span class="stringliteral">&quot;type&quot;</span>, <span class="stringliteral">&quot;hidden&quot;</span>);</div><div class="line"><a name="l01120"></a><span class="lineno"> 1120</span>&#160;   iks_insert_cdata(iks_insert(field_owner, <span class="stringliteral">&quot;value&quot;</span>),</div><div class="line"><a name="l01121"></a><span class="lineno"> 1121</span>&#160;          <span class="stringliteral">&quot;http://jabber.org/protocol/pubsub#owner&quot;</span>, 39);</div><div class="line"><a name="l01122"></a><span class="lineno"> 1122</span>&#160;   <span class="keywordflow">if</span> (node_type) {</div><div class="line"><a name="l01123"></a><span class="lineno"> 1123</span>&#160;      field_node_type = iks_insert(x, <span class="stringliteral">&quot;field&quot;</span>);</div><div class="line"><a name="l01124"></a><span class="lineno"> 1124</span>&#160;      iks_insert_attrib(field_node_type, <span class="stringliteral">&quot;var&quot;</span>, <span class="stringliteral">&quot;pubsub#node_type&quot;</span>);</div><div class="line"><a name="l01125"></a><span class="lineno"> 1125</span>&#160;      iks_insert_cdata(iks_insert(field_node_type, <span class="stringliteral">&quot;value&quot;</span>), node_type, strlen(node_type));</div><div class="line"><a name="l01126"></a><span class="lineno"> 1126</span>&#160;   }</div><div class="line"><a name="l01127"></a><span class="lineno"> 1127</span>&#160;   field_node_config = iks_insert(x, <span class="stringliteral">&quot;field&quot;</span>);</div><div class="line"><a name="l01128"></a><span class="lineno"> 1128</span>&#160;   iks_insert_attrib(field_node_config, <span class="stringliteral">&quot;var&quot;</span>, <span class="stringliteral">&quot;FORM_TYPE&quot;</span>);</div><div class="line"><a name="l01129"></a><span class="lineno"> 1129</span>&#160;   iks_insert_attrib(field_node_config, <span class="stringliteral">&quot;type&quot;</span>, <span class="stringliteral">&quot;hidden&quot;</span>);</div><div class="line"><a name="l01130"></a><span class="lineno"> 1130</span>&#160;   iks_insert_cdata(iks_insert(field_node_config, <span class="stringliteral">&quot;value&quot;</span>),</div><div class="line"><a name="l01131"></a><span class="lineno"> 1131</span>&#160;          <span class="stringliteral">&quot;http://jabber.org/protocol/pubsub#node_config&quot;</span>, 45);</div><div class="line"><a name="l01132"></a><span class="lineno"> 1132</span>&#160;   field_deliver_payload = iks_insert(x, <span class="stringliteral">&quot;field&quot;</span>);</div><div class="line"><a name="l01133"></a><span class="lineno"> 1133</span>&#160;   iks_insert_attrib(field_deliver_payload, <span class="stringliteral">&quot;var&quot;</span>, <span class="stringliteral">&quot;pubsub#deliver_payloads&quot;</span>);</div><div class="line"><a name="l01134"></a><span class="lineno"> 1134</span>&#160;   iks_insert_cdata(iks_insert(field_deliver_payload, <span class="stringliteral">&quot;value&quot;</span>), <span class="stringliteral">&quot;1&quot;</span>, 1);</div><div class="line"><a name="l01135"></a><span class="lineno"> 1135</span>&#160;   field_persist_items = iks_insert(x, <span class="stringliteral">&quot;field&quot;</span>);</div><div class="line"><a name="l01136"></a><span class="lineno"> 1136</span>&#160;   iks_insert_attrib(field_persist_items, <span class="stringliteral">&quot;var&quot;</span>, <span class="stringliteral">&quot;pubsub#persist_items&quot;</span>);</div><div class="line"><a name="l01137"></a><span class="lineno"> 1137</span>&#160;   iks_insert_cdata(iks_insert(field_persist_items, <span class="stringliteral">&quot;value&quot;</span>), <span class="stringliteral">&quot;1&quot;</span>, 1);</div><div class="line"><a name="l01138"></a><span class="lineno"> 1138</span>&#160;   field_access_model = iks_insert(x, <span class="stringliteral">&quot;field&quot;</span>);</div><div class="line"><a name="l01139"></a><span class="lineno"> 1139</span>&#160;   iks_insert_attrib(field_access_model, <span class="stringliteral">&quot;var&quot;</span>, <span class="stringliteral">&quot;pubsub#access_model&quot;</span>);</div><div class="line"><a name="l01140"></a><span class="lineno"> 1140</span>&#160;   iks_insert_cdata(iks_insert(field_access_model, <span class="stringliteral">&quot;value&quot;</span>), <span class="stringliteral">&quot;whitelist&quot;</span>, 9);</div><div class="line"><a name="l01141"></a><span class="lineno"> 1141</span>&#160;   <span class="keywordflow">if</span> (node_type &amp;&amp; !strcasecmp(node_type, <span class="stringliteral">&quot;leaf&quot;</span>)) {</div><div class="line"><a name="l01142"></a><span class="lineno"> 1142</span>&#160;      field_pubsub_collection = iks_insert(x, <span class="stringliteral">&quot;field&quot;</span>);</div><div class="line"><a name="l01143"></a><span class="lineno"> 1143</span>&#160;      iks_insert_attrib(field_pubsub_collection, <span class="stringliteral">&quot;var&quot;</span>, <span class="stringliteral">&quot;pubsub#collection&quot;</span>);</div><div class="line"><a name="l01144"></a><span class="lineno"> 1144</span>&#160;      iks_insert_cdata(iks_insert(field_pubsub_collection, <span class="stringliteral">&quot;value&quot;</span>), collection_name,</div><div class="line"><a name="l01145"></a><span class="lineno"> 1145</span>&#160;             strlen(collection_name));</div><div class="line"><a name="l01146"></a><span class="lineno"> 1146</span>&#160;   }</div><div class="line"><a name="l01147"></a><span class="lineno"> 1147</span>&#160;   <span class="keywordflow">return</span> configure;</div><div class="line"><a name="l01148"></a><span class="lineno"> 1148</span>&#160;}</div><div class="line"><a name="l01149"></a><span class="lineno"> 1149</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01150"></a><span class="lineno"> 1150</span>&#160;<span class="comment">/*!</span></div><div class="line"><a name="l01151"></a><span class="lineno"> 1151</span>&#160;<span class="comment"> * \brief Add Owner affiliations for pubsub node</span></div><div class="line"><a name="l01152"></a><span class="lineno"> 1152</span>&#160;<span class="comment"> * \param client the configured XMPP client we use to connect to a XMPP server</span></div><div class="line"><a name="l01153"></a><span class="lineno"> 1153</span>&#160;<span class="comment"> * \param node the name of the node to which to add affiliations</span></div><div class="line"><a name="l01154"></a><span class="lineno"> 1154</span>&#160;<span class="comment"> * \return void</span></div><div class="line"><a name="l01155"></a><span class="lineno"> 1155</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l01156"></a><span class="lineno"><a class="line" href="../../dc/d6b/res__xmpp_8c.html#ada34a179b875baddf7e8be5f31f09666"> 1156</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../dc/d6b/res__xmpp_8c.html#ada34a179b875baddf7e8be5f31f09666">xmpp_pubsub_create_affiliations</a>(<span class="keyword">struct</span> <a class="code" href="../../df/d42/structast__xmpp__client.html">ast_xmpp_client</a> *client, <span class="keyword">const</span> <span class="keywordtype">char</span> *node)</div><div class="line"><a name="l01157"></a><span class="lineno"> 1157</span>&#160;{</div><div class="line"><a name="l01158"></a><span class="lineno"> 1158</span>&#160;   iks *modify_affiliates = <a class="code" href="../../dc/d6b/res__xmpp_8c.html#a6b65b4b3c50fb1a3560fbafd70cf21bd">xmpp_pubsub_iq_create</a>(client, <span class="stringliteral">&quot;set&quot;</span>);</div><div class="line"><a name="l01159"></a><span class="lineno"> 1159</span>&#160;   iks *<a class="code" href="../../da/d70/structast__xmpp__global__config.html#ab40b53f823544fcdeff79c7fc6beb69b">pubsub</a>, *affiliations, *affiliate;</div><div class="line"><a name="l01160"></a><span class="lineno"> 1160</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d9/d97/structao2__iterator.html">ao2_iterator</a> i;</div><div class="line"><a name="l01161"></a><span class="lineno"> 1161</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d5/d25/structast__xmpp__buddy.html">ast_xmpp_buddy</a> *buddy;</div><div class="line"><a name="l01162"></a><span class="lineno"> 1162</span>&#160;</div><div class="line"><a name="l01163"></a><span class="lineno"> 1163</span>&#160;   <span class="keywordflow">if</span> (!modify_affiliates) {</div><div class="line"><a name="l01164"></a><span class="lineno"> 1164</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Could not create IQ for creating affiliations on client &#39;%s&#39;\n&quot;</span>, client-&gt;<a class="code" href="../../df/d42/structast__xmpp__client.html#ace9168767fc3707cf5f0a7d049682ba3">name</a>);</div><div class="line"><a name="l01165"></a><span class="lineno"> 1165</span>&#160;      <span class="keywordflow">return</span>;</div><div class="line"><a name="l01166"></a><span class="lineno"> 1166</span>&#160;   }</div><div class="line"><a name="l01167"></a><span class="lineno"> 1167</span>&#160;</div><div class="line"><a name="l01168"></a><span class="lineno"> 1168</span>&#160;   pubsub = iks_insert(modify_affiliates, <span class="stringliteral">&quot;pubsub&quot;</span>);</div><div class="line"><a name="l01169"></a><span class="lineno"> 1169</span>&#160;   iks_insert_attrib(pubsub, <span class="stringliteral">&quot;xmlns&quot;</span>, <span class="stringliteral">&quot;http://jabber.org/protocol/pubsub#owner&quot;</span>);</div><div class="line"><a name="l01170"></a><span class="lineno"> 1170</span>&#160;   affiliations = iks_insert(pubsub, <span class="stringliteral">&quot;affiliations&quot;</span>);</div><div class="line"><a name="l01171"></a><span class="lineno"> 1171</span>&#160;   iks_insert_attrib(affiliations, <span class="stringliteral">&quot;node&quot;</span>, node);</div><div class="line"><a name="l01172"></a><span class="lineno"> 1172</span>&#160;</div><div class="line"><a name="l01173"></a><span class="lineno"> 1173</span>&#160;   i = <a class="code" href="../../d5/da5/astobj2_8h.html#a91d5d37d00874ae7a92d1a15c0a3b3a6">ao2_iterator_init</a>(client-&gt;<a class="code" href="../../df/d42/structast__xmpp__client.html#a5082987d3e1eac5f625574800bb72c2c">buddies</a>, 0);</div><div class="line"><a name="l01174"></a><span class="lineno"> 1174</span>&#160;   <span class="keywordflow">while</span> ((buddy = <a class="code" href="../../d5/da5/astobj2_8h.html#a17990ea630db7dbd1252ef0132133a2b">ao2_iterator_next</a>(&amp;i))) {</div><div class="line"><a name="l01175"></a><span class="lineno"> 1175</span>&#160;      affiliate = iks_insert(affiliations, <span class="stringliteral">&quot;affiliation&quot;</span>);</div><div class="line"><a name="l01176"></a><span class="lineno"> 1176</span>&#160;      iks_insert_attrib(affiliate, <span class="stringliteral">&quot;jid&quot;</span>, buddy-&gt;<a class="code" href="../../d5/d25/structast__xmpp__buddy.html#aaf2ca63234b10470cfbba573d4c0ed01">id</a>);</div><div class="line"><a name="l01177"></a><span class="lineno"> 1177</span>&#160;      iks_insert_attrib(affiliate, <span class="stringliteral">&quot;affiliation&quot;</span>, <span class="stringliteral">&quot;owner&quot;</span>);</div><div class="line"><a name="l01178"></a><span class="lineno"> 1178</span>&#160;      <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(buddy, -1);</div><div class="line"><a name="l01179"></a><span class="lineno"> 1179</span>&#160;   }</div><div class="line"><a name="l01180"></a><span class="lineno"> 1180</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#ad36841ab6daa3997f7ca7047ad2d033a">ao2_iterator_destroy</a>(&amp;i);</div><div class="line"><a name="l01181"></a><span class="lineno"> 1181</span>&#160;</div><div class="line"><a name="l01182"></a><span class="lineno"> 1182</span>&#160;   <a class="code" href="../../dc/d6b/res__xmpp_8c.html#a01f156e90984166f2bbcbcc5a4a6e582">ast_xmpp_client_send</a>(client, modify_affiliates);</div><div class="line"><a name="l01183"></a><span class="lineno"> 1183</span>&#160;   iks_delete(modify_affiliates);</div><div class="line"><a name="l01184"></a><span class="lineno"> 1184</span>&#160;}</div><div class="line"><a name="l01185"></a><span class="lineno"> 1185</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01186"></a><span class="lineno"> 1186</span>&#160;<span class="comment">/*!</span></div><div class="line"><a name="l01187"></a><span class="lineno"> 1187</span>&#160;<span class="comment"> * \brief Create a pubsub node</span></div><div class="line"><a name="l01188"></a><span class="lineno"> 1188</span>&#160;<span class="comment"> * \param client the configured XMPP client we use to connect to a XMPP server</span></div><div class="line"><a name="l01189"></a><span class="lineno"> 1189</span>&#160;<span class="comment"> * \param node_type the type of node to create</span></div><div class="line"><a name="l01190"></a><span class="lineno"> 1190</span>&#160;<span class="comment"> * \param name the name of the node to create</span></div><div class="line"><a name="l01191"></a><span class="lineno"> 1191</span>&#160;<span class="comment"> * \param collection_name</span></div><div class="line"><a name="l01192"></a><span class="lineno"> 1192</span>&#160;<span class="comment"> * \return void</span></div><div class="line"><a name="l01193"></a><span class="lineno"> 1193</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l01194"></a><span class="lineno"><a class="line" href="../../dc/d6b/res__xmpp_8c.html#aca3aa26e115851782ebae0ba598728e0"> 1194</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../dc/d6b/res__xmpp_8c.html#aca3aa26e115851782ebae0ba598728e0">xmpp_pubsub_create_node</a>(<span class="keyword">struct</span> <a class="code" href="../../df/d42/structast__xmpp__client.html">ast_xmpp_client</a> *client, <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="../../d3/dd1/ast__expr2_8c.html#a6a276b85e2da28c5f9c3dbce61c55682">node_type</a>, <span class="keyword">const</span></div><div class="line"><a name="l01195"></a><span class="lineno"> 1195</span>&#160;                <span class="keywordtype">char</span> *<a class="code" href="../../d0/d29/cdr__mysql_8c.html#a0980a105ccb863d8008eb6201a51da52">name</a>, <span class="keyword">const</span> <span class="keywordtype">char</span> *collection_name)</div><div class="line"><a name="l01196"></a><span class="lineno"> 1196</span>&#160;{</div><div class="line"><a name="l01197"></a><span class="lineno"> 1197</span>&#160;   iks *node, *<a class="code" href="../../da/d70/structast__xmpp__global__config.html#ab40b53f823544fcdeff79c7fc6beb69b">pubsub</a>, *create;</div><div class="line"><a name="l01198"></a><span class="lineno"> 1198</span>&#160;</div><div class="line"><a name="l01199"></a><span class="lineno"> 1199</span>&#160;   <span class="keywordflow">if</span> (!(node = <a class="code" href="../../dc/d6b/res__xmpp_8c.html#a6b65b4b3c50fb1a3560fbafd70cf21bd">xmpp_pubsub_iq_create</a>(client, <span class="stringliteral">&quot;set&quot;</span>))) {</div><div class="line"><a name="l01200"></a><span class="lineno"> 1200</span>&#160;      <span class="keywordflow">return</span>;</div><div class="line"><a name="l01201"></a><span class="lineno"> 1201</span>&#160;   }</div><div class="line"><a name="l01202"></a><span class="lineno"> 1202</span>&#160;</div><div class="line"><a name="l01203"></a><span class="lineno"> 1203</span>&#160;   pubsub = iks_insert(node, <span class="stringliteral">&quot;pubsub&quot;</span>);</div><div class="line"><a name="l01204"></a><span class="lineno"> 1204</span>&#160;   iks_insert_attrib(pubsub, <span class="stringliteral">&quot;xmlns&quot;</span>, <span class="stringliteral">&quot;http://jabber.org/protocol/pubsub&quot;</span>);</div><div class="line"><a name="l01205"></a><span class="lineno"> 1205</span>&#160;   create = iks_insert(pubsub, <span class="stringliteral">&quot;create&quot;</span>);</div><div class="line"><a name="l01206"></a><span class="lineno"> 1206</span>&#160;   iks_insert_attrib(create, <span class="stringliteral">&quot;node&quot;</span>, name);</div><div class="line"><a name="l01207"></a><span class="lineno"> 1207</span>&#160;   <a class="code" href="../../dc/d6b/res__xmpp_8c.html#acfb92986809bdc3d6dac95527cd8f9bb">xmpp_pubsub_build_node_config</a>(pubsub, node_type, collection_name);</div><div class="line"><a name="l01208"></a><span class="lineno"> 1208</span>&#160;   <a class="code" href="../../dc/d6b/res__xmpp_8c.html#a01f156e90984166f2bbcbcc5a4a6e582">ast_xmpp_client_send</a>(client, node);</div><div class="line"><a name="l01209"></a><span class="lineno"> 1209</span>&#160;   <a class="code" href="../../dc/d6b/res__xmpp_8c.html#ada34a179b875baddf7e8be5f31f09666">xmpp_pubsub_create_affiliations</a>(client, name);</div><div class="line"><a name="l01210"></a><span class="lineno"> 1210</span>&#160;   iks_delete(node);</div><div class="line"><a name="l01211"></a><span class="lineno"> 1211</span>&#160;}</div><div class="line"><a name="l01212"></a><span class="lineno"> 1212</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01213"></a><span class="lineno"> 1213</span>&#160;<span class="comment">/*!</span></div><div class="line"><a name="l01214"></a><span class="lineno"> 1214</span>&#160;<span class="comment"> * \brief Delete a PubSub node</span></div><div class="line"><a name="l01215"></a><span class="lineno"> 1215</span>&#160;<span class="comment"> * \param client the configured XMPP client we use to connect to a XMPP server</span></div><div class="line"><a name="l01216"></a><span class="lineno"> 1216</span>&#160;<span class="comment"> * \param node_name the name of the node to delete</span></div><div class="line"><a name="l01217"></a><span class="lineno"> 1217</span>&#160;<span class="comment"> * return void</span></div><div class="line"><a name="l01218"></a><span class="lineno"> 1218</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l01219"></a><span class="lineno"><a class="line" href="../../dc/d6b/res__xmpp_8c.html#a7aa063e7e023aac98e55edc4d9faea55"> 1219</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../dc/d6b/res__xmpp_8c.html#a7aa063e7e023aac98e55edc4d9faea55">xmpp_pubsub_delete_node</a>(<span class="keyword">struct</span> <a class="code" href="../../df/d42/structast__xmpp__client.html">ast_xmpp_client</a> *client, <span class="keyword">const</span> <span class="keywordtype">char</span> *node_name)</div><div class="line"><a name="l01220"></a><span class="lineno"> 1220</span>&#160;{</div><div class="line"><a name="l01221"></a><span class="lineno"> 1221</span>&#160;   iks *<a class="code" href="../../d0/d29/chan__pjsip_8c.html#a4e2e6fb7d874f0d2deddd2ecfc8afb32">request</a>, *<a class="code" href="../../da/d70/structast__xmpp__global__config.html#ab40b53f823544fcdeff79c7fc6beb69b">pubsub</a>, *<span class="keyword">delete</span>;</div><div class="line"><a name="l01222"></a><span class="lineno"> 1222</span>&#160;</div><div class="line"><a name="l01223"></a><span class="lineno"> 1223</span>&#160;   <span class="keywordflow">if</span> (!(request = <a class="code" href="../../dc/d6b/res__xmpp_8c.html#a6b65b4b3c50fb1a3560fbafd70cf21bd">xmpp_pubsub_iq_create</a>(client, <span class="stringliteral">&quot;set&quot;</span>))) {</div><div class="line"><a name="l01224"></a><span class="lineno"> 1224</span>&#160;      <span class="keywordflow">return</span>;</div><div class="line"><a name="l01225"></a><span class="lineno"> 1225</span>&#160;   }</div><div class="line"><a name="l01226"></a><span class="lineno"> 1226</span>&#160;</div><div class="line"><a name="l01227"></a><span class="lineno"> 1227</span>&#160;   pubsub = iks_insert(request, <span class="stringliteral">&quot;pubsub&quot;</span>);</div><div class="line"><a name="l01228"></a><span class="lineno"> 1228</span>&#160;   iks_insert_attrib(pubsub, <span class="stringliteral">&quot;xmlns&quot;</span>, <span class="stringliteral">&quot;http://jabber.org/protocol/pubsub#owner&quot;</span>);</div><div class="line"><a name="l01229"></a><span class="lineno"> 1229</span>&#160;   <span class="keyword">delete</span> = iks_insert(pubsub, <span class="stringliteral">&quot;delete&quot;</span>);</div><div class="line"><a name="l01230"></a><span class="lineno"> 1230</span>&#160;   iks_insert_attrib(<span class="keyword">delete</span>, <span class="stringliteral">&quot;node&quot;</span>, node_name);</div><div class="line"><a name="l01231"></a><span class="lineno"> 1231</span>&#160;   <a class="code" href="../../dc/d6b/res__xmpp_8c.html#a01f156e90984166f2bbcbcc5a4a6e582">ast_xmpp_client_send</a>(client, request);</div><div class="line"><a name="l01232"></a><span class="lineno"> 1232</span>&#160;</div><div class="line"><a name="l01233"></a><span class="lineno"> 1233</span>&#160;   iks_delete(request);</div><div class="line"><a name="l01234"></a><span class="lineno"> 1234</span>&#160;}</div><div class="line"><a name="l01235"></a><span class="lineno"> 1235</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01236"></a><span class="lineno"> 1236</span>&#160;<span class="comment">/*!</span></div><div class="line"><a name="l01237"></a><span class="lineno"> 1237</span>&#160;<span class="comment"> * \brief Create a PubSub collection node.</span></div><div class="line"><a name="l01238"></a><span class="lineno"> 1238</span>&#160;<span class="comment"> * \param client the configured XMPP client we use to connect to a XMPP server</span></div><div class="line"><a name="l01239"></a><span class="lineno"> 1239</span>&#160;<span class="comment"> * \param collection_name The name to use for this collection</span></div><div class="line"><a name="l01240"></a><span class="lineno"> 1240</span>&#160;<span class="comment"> * \return void.</span></div><div class="line"><a name="l01241"></a><span class="lineno"> 1241</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l01242"></a><span class="lineno"><a class="line" href="../../dc/d6b/res__xmpp_8c.html#a64804aabc6379d1e89d71ac9ae686654"> 1242</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../dc/d6b/res__xmpp_8c.html#a64804aabc6379d1e89d71ac9ae686654">xmpp_pubsub_create_collection</a>(<span class="keyword">struct</span> <a class="code" href="../../df/d42/structast__xmpp__client.html">ast_xmpp_client</a> *client, <span class="keyword">const</span> <span class="keywordtype">char</span> *collection_name)</div><div class="line"><a name="l01243"></a><span class="lineno"> 1243</span>&#160;{</div><div class="line"><a name="l01244"></a><span class="lineno"> 1244</span>&#160;   <a class="code" href="../../dc/d6b/res__xmpp_8c.html#aca3aa26e115851782ebae0ba598728e0">xmpp_pubsub_create_node</a>(client, <span class="stringliteral">&quot;collection&quot;</span>, collection_name, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div><div class="line"><a name="l01245"></a><span class="lineno"> 1245</span>&#160;}</div><div class="line"><a name="l01246"></a><span class="lineno"> 1246</span>&#160;</div><div class="line"><a name="l01247"></a><span class="lineno"> 1247</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01248"></a><span class="lineno"> 1248</span>&#160;<span class="comment">/*!</span></div><div class="line"><a name="l01249"></a><span class="lineno"> 1249</span>&#160;<span class="comment"> * \brief Create a PubSub leaf node.</span></div><div class="line"><a name="l01250"></a><span class="lineno"> 1250</span>&#160;<span class="comment"> * \param client the configured XMPP client we use to connect to a XMPP server</span></div><div class="line"><a name="l01251"></a><span class="lineno"> 1251</span>&#160;<span class="comment"> * \param collection_name</span></div><div class="line"><a name="l01252"></a><span class="lineno"> 1252</span>&#160;<span class="comment"> * \param leaf_name The name to use for this collection</span></div><div class="line"><a name="l01253"></a><span class="lineno"> 1253</span>&#160;<span class="comment"> * \return void.</span></div><div class="line"><a name="l01254"></a><span class="lineno"> 1254</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l01255"></a><span class="lineno"><a class="line" href="../../dc/d6b/res__xmpp_8c.html#a8e8150ade4edbd105394640480f6cd2c"> 1255</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../dc/d6b/res__xmpp_8c.html#a8e8150ade4edbd105394640480f6cd2c">xmpp_pubsub_create_leaf</a>(<span class="keyword">struct</span> <a class="code" href="../../df/d42/structast__xmpp__client.html">ast_xmpp_client</a> *client, <span class="keyword">const</span> <span class="keywordtype">char</span> *collection_name,</div><div class="line"><a name="l01256"></a><span class="lineno"> 1256</span>&#160;                <span class="keyword">const</span> <span class="keywordtype">char</span> *leaf_name)</div><div class="line"><a name="l01257"></a><span class="lineno"> 1257</span>&#160;{</div><div class="line"><a name="l01258"></a><span class="lineno"> 1258</span>&#160;   <a class="code" href="../../dc/d6b/res__xmpp_8c.html#aca3aa26e115851782ebae0ba598728e0">xmpp_pubsub_create_node</a>(client, <span class="stringliteral">&quot;leaf&quot;</span>, leaf_name, collection_name);</div><div class="line"><a name="l01259"></a><span class="lineno"> 1259</span>&#160;}</div><div class="line"><a name="l01260"></a><span class="lineno"> 1260</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01261"></a><span class="lineno"> 1261</span>&#160;<span class="comment">/*!</span></div><div class="line"><a name="l01262"></a><span class="lineno"> 1262</span>&#160;<span class="comment"> * \brief Publish MWI to a PubSub node</span></div><div class="line"><a name="l01263"></a><span class="lineno"> 1263</span>&#160;<span class="comment"> * \param client the configured XMPP client we use to connect to a XMPP server</span></div><div class="line"><a name="l01264"></a><span class="lineno"> 1264</span>&#160;<span class="comment"> * \param mailbox The mailbox identifier</span></div><div class="line"><a name="l01265"></a><span class="lineno"> 1265</span>&#160;<span class="comment"> * \param oldmsgs Old messages</span></div><div class="line"><a name="l01266"></a><span class="lineno"> 1266</span>&#160;<span class="comment"> * \param newmsgs New Messages</span></div><div class="line"><a name="l01267"></a><span class="lineno"> 1267</span>&#160;<span class="comment"> * \return void</span></div><div class="line"><a name="l01268"></a><span class="lineno"> 1268</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l01269"></a><span class="lineno"><a class="line" href="../../dc/d6b/res__xmpp_8c.html#aff0f221b95d8bd4a8f211c5afa3e312f"> 1269</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../dc/d6b/res__xmpp_8c.html#aff0f221b95d8bd4a8f211c5afa3e312f">xmpp_pubsub_publish_mwi</a>(<span class="keyword">struct</span> <a class="code" href="../../df/d42/structast__xmpp__client.html">ast_xmpp_client</a> *client, <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="../../d0/dd6/chan__mgcp_8c.html#a6b49cafa2a3d359a2e865992f551874a">mailbox</a>,</div><div class="line"><a name="l01270"></a><span class="lineno"> 1270</span>&#160;   <span class="keyword">const</span> <span class="keywordtype">char</span> *oldmsgs, <span class="keyword">const</span> <span class="keywordtype">char</span> *newmsgs)</div><div class="line"><a name="l01271"></a><span class="lineno"> 1271</span>&#160;{</div><div class="line"><a name="l01272"></a><span class="lineno"> 1272</span>&#160;   <span class="keywordtype">char</span> eid_str[20];</div><div class="line"><a name="l01273"></a><span class="lineno"> 1273</span>&#160;   iks *mailbox_node, *<a class="code" href="../../d0/d29/chan__pjsip_8c.html#a4e2e6fb7d874f0d2deddd2ecfc8afb32">request</a>;</div><div class="line"><a name="l01274"></a><span class="lineno"> 1274</span>&#160;</div><div class="line"><a name="l01275"></a><span class="lineno"> 1275</span>&#160;   request = <a class="code" href="../../dc/d6b/res__xmpp_8c.html#a244b9b274ea2f4f90ff95a60fc7935f5">xmpp_pubsub_build_publish_skeleton</a>(client, mailbox, <span class="stringliteral">&quot;message_waiting&quot;</span>,</div><div class="line"><a name="l01276"></a><span class="lineno"> 1276</span>&#160;      <a class="code" href="../../da/da2/devicestate_8h.html#a26cbac580d3e86b529f90058f6e91ac7a3683b746ab070a6455934b5d24dbd779">AST_DEVSTATE_CACHABLE</a>);</div><div class="line"><a name="l01277"></a><span class="lineno"> 1277</span>&#160;   <span class="keywordflow">if</span> (!request) {</div><div class="line"><a name="l01278"></a><span class="lineno"> 1278</span>&#160;      <span class="keywordflow">return</span>;</div><div class="line"><a name="l01279"></a><span class="lineno"> 1279</span>&#160;   }</div><div class="line"><a name="l01280"></a><span class="lineno"> 1280</span>&#160;</div><div class="line"><a name="l01281"></a><span class="lineno"> 1281</span>&#160;   <a class="code" href="../../d5/d60/utils_8h.html#a8ebf6841073ea2a063a0c86a5092a85b">ast_eid_to_str</a>(eid_str, <span class="keyword">sizeof</span>(eid_str), &amp;<a class="code" href="../../d5/d60/utils_8h.html#ad5db11fa27352e2b9a3c669adc76955f">ast_eid_default</a>);</div><div class="line"><a name="l01282"></a><span class="lineno"> 1282</span>&#160;   mailbox_node = iks_insert(request, <span class="stringliteral">&quot;mailbox&quot;</span>);</div><div class="line"><a name="l01283"></a><span class="lineno"> 1283</span>&#160;   iks_insert_attrib(mailbox_node, <span class="stringliteral">&quot;xmlns&quot;</span>, <span class="stringliteral">&quot;http://asterisk.org&quot;</span>);</div><div class="line"><a name="l01284"></a><span class="lineno"> 1284</span>&#160;   iks_insert_attrib(mailbox_node, <span class="stringliteral">&quot;eid&quot;</span>, eid_str);</div><div class="line"><a name="l01285"></a><span class="lineno"> 1285</span>&#160;   iks_insert_cdata(iks_insert(mailbox_node, <span class="stringliteral">&quot;NEWMSGS&quot;</span>), newmsgs, strlen(newmsgs));</div><div class="line"><a name="l01286"></a><span class="lineno"> 1286</span>&#160;   iks_insert_cdata(iks_insert(mailbox_node, <span class="stringliteral">&quot;OLDMSGS&quot;</span>), oldmsgs, strlen(oldmsgs));</div><div class="line"><a name="l01287"></a><span class="lineno"> 1287</span>&#160;</div><div class="line"><a name="l01288"></a><span class="lineno"> 1288</span>&#160;   <a class="code" href="../../dc/d6b/res__xmpp_8c.html#a01f156e90984166f2bbcbcc5a4a6e582">ast_xmpp_client_send</a>(client, iks_root(request));</div><div class="line"><a name="l01289"></a><span class="lineno"> 1289</span>&#160;</div><div class="line"><a name="l01290"></a><span class="lineno"> 1290</span>&#160;   iks_delete(request);</div><div class="line"><a name="l01291"></a><span class="lineno"> 1291</span>&#160;}</div><div class="line"><a name="l01292"></a><span class="lineno"> 1292</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01293"></a><span class="lineno"> 1293</span>&#160;<span class="comment">/*!</span></div><div class="line"><a name="l01294"></a><span class="lineno"> 1294</span>&#160;<span class="comment"> * \brief Publish device state to a PubSub node</span></div><div class="line"><a name="l01295"></a><span class="lineno"> 1295</span>&#160;<span class="comment"> * \param client the configured XMPP client we use to connect to a XMPP server</span></div><div class="line"><a name="l01296"></a><span class="lineno"> 1296</span>&#160;<span class="comment"> * \param device the name of the device whose state to publish</span></div><div class="line"><a name="l01297"></a><span class="lineno"> 1297</span>&#160;<span class="comment"> * \param device_state the state to publish</span></div><div class="line"><a name="l01298"></a><span class="lineno"> 1298</span>&#160;<span class="comment"> * \return void</span></div><div class="line"><a name="l01299"></a><span class="lineno"> 1299</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l01300"></a><span class="lineno"><a class="line" href="../../dc/d6b/res__xmpp_8c.html#a5d78f1d69258138fd512b397eb27f393"> 1300</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../dc/d6b/res__xmpp_8c.html#a5d78f1d69258138fd512b397eb27f393">xmpp_pubsub_publish_device_state</a>(<span class="keyword">struct</span> <a class="code" href="../../df/d42/structast__xmpp__client.html">ast_xmpp_client</a> *client, <span class="keyword">const</span> <span class="keywordtype">char</span> *device,</div><div class="line"><a name="l01301"></a><span class="lineno"> 1301</span>&#160;                    <span class="keyword">const</span> <span class="keywordtype">char</span> *device_state, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> cachable)</div><div class="line"><a name="l01302"></a><span class="lineno"> 1302</span>&#160;{</div><div class="line"><a name="l01303"></a><span class="lineno"> 1303</span>&#160;   <a class="code" href="../../d5/d60/utils_8h.html#a1604b4d72144dd3d9f7da668e90337e9">RAII_VAR</a>(<span class="keyword">struct</span> <a class="code" href="../../de/d1c/structxmpp__config.html">xmpp_config</a> *, cfg, <a class="code" href="../../d5/da5/astobj2_8h.html#a86d8d6c3c8866ed0a60121da055cd225">ao2_global_obj_ref</a>(<a class="code" href="../../d3/d4e/chan__console_8c.html#aa36e3e2c486b920b166c2d17c5242221">globals</a>), <a class="code" href="../../d5/da5/astobj2_8h.html#a6321ee982370c55ab3c24c72c562cbdd">ao2_cleanup</a>);</div><div class="line"><a name="l01304"></a><span class="lineno"> 1304</span>&#160;   iks *<a class="code" href="../../d0/d29/chan__pjsip_8c.html#a4e2e6fb7d874f0d2deddd2ecfc8afb32">request</a>, *<a class="code" href="../../d5/dfe/chan__sip_8c.html#a14a9662e09deed264497073732fb014a">state</a>;</div><div class="line"><a name="l01305"></a><span class="lineno"> 1305</span>&#160;   <span class="keywordtype">char</span> eid_str[20], cachable_str[2];</div><div class="line"><a name="l01306"></a><span class="lineno"> 1306</span>&#160;</div><div class="line"><a name="l01307"></a><span class="lineno"> 1307</span>&#160;   <span class="keywordflow">if</span> (!cfg || !cfg-&gt;global || !(request = <a class="code" href="../../dc/d6b/res__xmpp_8c.html#a244b9b274ea2f4f90ff95a60fc7935f5">xmpp_pubsub_build_publish_skeleton</a>(client, device, <span class="stringliteral">&quot;device_state&quot;</span>, cachable))) {</div><div class="line"><a name="l01308"></a><span class="lineno"> 1308</span>&#160;      <span class="keywordflow">return</span>;</div><div class="line"><a name="l01309"></a><span class="lineno"> 1309</span>&#160;   }</div><div class="line"><a name="l01310"></a><span class="lineno"> 1310</span>&#160;</div><div class="line"><a name="l01311"></a><span class="lineno"> 1311</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d5/d60/utils_8h.html#a00d4c9254c9827d6fa44f17a326744a5">ast_test_flag</a>(&amp;cfg-&gt;global-&gt;pubsub, <a class="code" href="../../dc/d6b/res__xmpp_8c.html#ac5b95f02723021833cc47477b06a962ca78acf22c4ab1b2450bf154c89e82d065">XMPP_PUBSUB_AUTOCREATE</a>)) {</div><div class="line"><a name="l01312"></a><span class="lineno"> 1312</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="../../d5/d60/utils_8h.html#a00d4c9254c9827d6fa44f17a326744a5">ast_test_flag</a>(&amp;cfg-&gt;global-&gt;pubsub, <a class="code" href="../../dc/d6b/res__xmpp_8c.html#ac5b95f02723021833cc47477b06a962ca045d4dbda72ca97ef5ef8c383279d7dc">XMPP_XEP0248</a>)) {</div><div class="line"><a name="l01313"></a><span class="lineno"> 1313</span>&#160;         <a class="code" href="../../dc/d6b/res__xmpp_8c.html#aca3aa26e115851782ebae0ba598728e0">xmpp_pubsub_create_node</a>(client, <span class="stringliteral">&quot;leaf&quot;</span>, device, <span class="stringliteral">&quot;device_state&quot;</span>);</div><div class="line"><a name="l01314"></a><span class="lineno"> 1314</span>&#160;      } <span class="keywordflow">else</span> {</div><div class="line"><a name="l01315"></a><span class="lineno"> 1315</span>&#160;         <a class="code" href="../../dc/d6b/res__xmpp_8c.html#aca3aa26e115851782ebae0ba598728e0">xmpp_pubsub_create_node</a>(client, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, device, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div><div class="line"><a name="l01316"></a><span class="lineno"> 1316</span>&#160;      }</div><div class="line"><a name="l01317"></a><span class="lineno"> 1317</span>&#160;   }</div><div class="line"><a name="l01318"></a><span class="lineno"> 1318</span>&#160;</div><div class="line"><a name="l01319"></a><span class="lineno"> 1319</span>&#160;   <a class="code" href="../../d5/d60/utils_8h.html#a8ebf6841073ea2a063a0c86a5092a85b">ast_eid_to_str</a>(eid_str, <span class="keyword">sizeof</span>(eid_str), &amp;<a class="code" href="../../d5/d60/utils_8h.html#ad5db11fa27352e2b9a3c669adc76955f">ast_eid_default</a>);</div><div class="line"><a name="l01320"></a><span class="lineno"> 1320</span>&#160;   state = iks_insert(request, <span class="stringliteral">&quot;state&quot;</span>);</div><div class="line"><a name="l01321"></a><span class="lineno"> 1321</span>&#160;   iks_insert_attrib(state, <span class="stringliteral">&quot;xmlns&quot;</span>, <span class="stringliteral">&quot;http://asterisk.org&quot;</span>);</div><div class="line"><a name="l01322"></a><span class="lineno"> 1322</span>&#160;   iks_insert_attrib(state, <span class="stringliteral">&quot;eid&quot;</span>, eid_str);</div><div class="line"><a name="l01323"></a><span class="lineno"> 1323</span>&#160;   snprintf(cachable_str, <span class="keyword">sizeof</span>(cachable_str), <span class="stringliteral">&quot;%u&quot;</span>, cachable);</div><div class="line"><a name="l01324"></a><span class="lineno"> 1324</span>&#160;   iks_insert_attrib(state, <span class="stringliteral">&quot;cachable&quot;</span>, cachable_str);</div><div class="line"><a name="l01325"></a><span class="lineno"> 1325</span>&#160;   iks_insert_cdata(state, device_state, strlen(device_state));</div><div class="line"><a name="l01326"></a><span class="lineno"> 1326</span>&#160;   <a class="code" href="../../dc/d6b/res__xmpp_8c.html#a01f156e90984166f2bbcbcc5a4a6e582">ast_xmpp_client_send</a>(client, iks_root(request));</div><div class="line"><a name="l01327"></a><span class="lineno"> 1327</span>&#160;   iks_delete(request);</div><div class="line"><a name="l01328"></a><span class="lineno"> 1328</span>&#160;}</div><div class="line"><a name="l01329"></a><span class="lineno"> 1329</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01330"></a><span class="lineno"> 1330</span>&#160;<span class="comment">/*!</span></div><div class="line"><a name="l01331"></a><span class="lineno"> 1331</span>&#160;<span class="comment"> * \brief Callback function for MWI events</span></div><div class="line"><a name="l01332"></a><span class="lineno"> 1332</span>&#160;<span class="comment"> * \param ast_event</span></div><div class="line"><a name="l01333"></a><span class="lineno"> 1333</span>&#160;<span class="comment"> * \param data void pointer to ast_client structure</span></div><div class="line"><a name="l01334"></a><span class="lineno"> 1334</span>&#160;<span class="comment"> * \return void</span></div><div class="line"><a name="l01335"></a><span class="lineno"> 1335</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l01336"></a><span class="lineno"><a class="line" href="../../dc/d6b/res__xmpp_8c.html#a8816b23744b8848485aaefb051b97f69"> 1336</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../dc/d6b/res__xmpp_8c.html#a8816b23744b8848485aaefb051b97f69">xmpp_pubsub_mwi_cb</a>(<span class="keywordtype">void</span> *data, <span class="keyword">struct</span> <a class="code" href="../../d9/de4/structstasis__subscription.html">stasis_subscription</a> *<a class="code" href="../../d1/da4/res__corosync_8c.html#a8e51289dd0fc7415cee40e7a57b49fdf">sub</a>, <span class="keyword">struct</span> <a class="code" href="../../d7/d55/structstasis__message.html">stasis_message</a> *msg)</div><div class="line"><a name="l01337"></a><span class="lineno"> 1337</span>&#160;{</div><div class="line"><a name="l01338"></a><span class="lineno"> 1338</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../df/d42/structast__xmpp__client.html">ast_xmpp_client</a> *client = data;</div><div class="line"><a name="l01339"></a><span class="lineno"> 1339</span>&#160;   <span class="keywordtype">char</span> oldmsgs[10], newmsgs[10];</div><div class="line"><a name="l01340"></a><span class="lineno"> 1340</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d6/d45/structast__mwi__state.html">ast_mwi_state</a> *mwi_state;</div><div class="line"><a name="l01341"></a><span class="lineno"> 1341</span>&#160;</div><div class="line"><a name="l01342"></a><span class="lineno"> 1342</span>&#160;   <span class="keywordflow">if</span> (!<a class="code" href="../../dd/d79/stasis_8h.html#acd5bedbb2212956dac77be47dceef510">stasis_subscription_is_subscribed</a>(sub) || <a class="code" href="../../df/deb/group__StasisTopicsAndMessages.html#gaf226cf2d1a4dbbbf220521d58c05ac0f">ast_mwi_state_type</a>() != <a class="code" href="../../dd/d79/stasis_8h.html#a9356e8a29344ca4eac93088198ccff89">stasis_message_type</a>(msg)) {</div><div class="line"><a name="l01343"></a><span class="lineno"> 1343</span>&#160;      <span class="keywordflow">return</span>;</div><div class="line"><a name="l01344"></a><span class="lineno"> 1344</span>&#160;   }</div><div class="line"><a name="l01345"></a><span class="lineno"> 1345</span>&#160;</div><div class="line"><a name="l01346"></a><span class="lineno"> 1346</span>&#160;   mwi_state = <a class="code" href="../../dd/d79/stasis_8h.html#af6081f17431b81bc1a010b680517491d">stasis_message_data</a>(msg);</div><div class="line"><a name="l01347"></a><span class="lineno"> 1347</span>&#160;</div><div class="line"><a name="l01348"></a><span class="lineno"> 1348</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d5/d60/utils_8h.html#a4e9f7c7ca75b0ff48b60b136e3961b61">ast_eid_cmp</a>(&amp;<a class="code" href="../../d5/d60/utils_8h.html#ad5db11fa27352e2b9a3c669adc76955f">ast_eid_default</a>, &amp;mwi_state-&gt;<a class="code" href="../../df/deb/group__StasisTopicsAndMessages.html#gaa1d7e6e6eb6d297e62f2d79dbdfaafb4">eid</a>)) {</div><div class="line"><a name="l01349"></a><span class="lineno"> 1349</span>&#160;      <span class="comment">/* If the event didn&#39;t originate from this server, don&#39;t send it back out. */</span></div><div class="line"><a name="l01350"></a><span class="lineno"> 1350</span>&#160;      <span class="keywordflow">return</span>;</div><div class="line"><a name="l01351"></a><span class="lineno"> 1351</span>&#160;   }</div><div class="line"><a name="l01352"></a><span class="lineno"> 1352</span>&#160;</div><div class="line"><a name="l01353"></a><span class="lineno"> 1353</span>&#160;   snprintf(oldmsgs, <span class="keyword">sizeof</span>(oldmsgs), <span class="stringliteral">&quot;%d&quot;</span>, mwi_state-&gt;<a class="code" href="../../df/deb/group__StasisTopicsAndMessages.html#ga4369ae7c984aba22ce6d0e92718f2b29">old_msgs</a>);</div><div class="line"><a name="l01354"></a><span class="lineno"> 1354</span>&#160;   snprintf(newmsgs, <span class="keyword">sizeof</span>(newmsgs), <span class="stringliteral">&quot;%d&quot;</span>, mwi_state-&gt;<a class="code" href="../../df/deb/group__StasisTopicsAndMessages.html#ga70de9f16a229e2c5bf1a973372949d3e">new_msgs</a>);</div><div class="line"><a name="l01355"></a><span class="lineno"> 1355</span>&#160;   <a class="code" href="../../dc/d6b/res__xmpp_8c.html#aff0f221b95d8bd4a8f211c5afa3e312f">xmpp_pubsub_publish_mwi</a>(client, mwi_state-&gt;<a class="code" href="../../df/deb/group__StasisTopicsAndMessages.html#ga753c7b39e3284d771f13f513b003d033">uniqueid</a>, oldmsgs, newmsgs);</div><div class="line"><a name="l01356"></a><span class="lineno"> 1356</span>&#160;}</div><div class="line"><a name="l01357"></a><span class="lineno"> 1357</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01358"></a><span class="lineno"> 1358</span>&#160;<span class="comment">/*!</span></div><div class="line"><a name="l01359"></a><span class="lineno"> 1359</span>&#160;<span class="comment"> * \brief Callback function for device state events</span></div><div class="line"><a name="l01360"></a><span class="lineno"> 1360</span>&#160;<span class="comment"> * \param ast_event</span></div><div class="line"><a name="l01361"></a><span class="lineno"> 1361</span>&#160;<span class="comment"> * \param data void pointer to ast_client structure</span></div><div class="line"><a name="l01362"></a><span class="lineno"> 1362</span>&#160;<span class="comment"> * \return void</span></div><div class="line"><a name="l01363"></a><span class="lineno"> 1363</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l01364"></a><span class="lineno"><a class="line" href="../../dc/d6b/res__xmpp_8c.html#a65b4aeae7d602f7aa68d217f0576c033"> 1364</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../dc/d6b/res__xmpp_8c.html#a65b4aeae7d602f7aa68d217f0576c033">xmpp_pubsub_devstate_cb</a>(<span class="keywordtype">void</span> *data, <span class="keyword">struct</span> <a class="code" href="../../d9/de4/structstasis__subscription.html">stasis_subscription</a> *<a class="code" href="../../d1/da4/res__corosync_8c.html#a8e51289dd0fc7415cee40e7a57b49fdf">sub</a>, <span class="keyword">struct</span> <a class="code" href="../../d7/d55/structstasis__message.html">stasis_message</a> *msg)</div><div class="line"><a name="l01365"></a><span class="lineno"> 1365</span>&#160;{</div><div class="line"><a name="l01366"></a><span class="lineno"> 1366</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../df/d42/structast__xmpp__client.html">ast_xmpp_client</a> *client = data;</div><div class="line"><a name="l01367"></a><span class="lineno"> 1367</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../db/d92/structast__device__state__message.html">ast_device_state_message</a> *dev_state;</div><div class="line"><a name="l01368"></a><span class="lineno"> 1368</span>&#160;</div><div class="line"><a name="l01369"></a><span class="lineno"> 1369</span>&#160;   <span class="keywordflow">if</span> (!<a class="code" href="../../dd/d79/stasis_8h.html#acd5bedbb2212956dac77be47dceef510">stasis_subscription_is_subscribed</a>(sub) || <a class="code" href="../../da/da2/devicestate_8h.html#a9459272db1c8c968ed1aff1387f0f9fd">ast_device_state_message_type</a>() != <a class="code" href="../../dd/d79/stasis_8h.html#a9356e8a29344ca4eac93088198ccff89">stasis_message_type</a>(msg)) {</div><div class="line"><a name="l01370"></a><span class="lineno"> 1370</span>&#160;      <span class="keywordflow">return</span>;</div><div class="line"><a name="l01371"></a><span class="lineno"> 1371</span>&#160;   }</div><div class="line"><a name="l01372"></a><span class="lineno"> 1372</span>&#160;</div><div class="line"><a name="l01373"></a><span class="lineno"> 1373</span>&#160;   dev_state = <a class="code" href="../../dd/d79/stasis_8h.html#af6081f17431b81bc1a010b680517491d">stasis_message_data</a>(msg);</div><div class="line"><a name="l01374"></a><span class="lineno"> 1374</span>&#160;   <span class="keywordflow">if</span> (!dev_state-&gt;<a class="code" href="../../db/d92/structast__device__state__message.html#a39d1b63955a48c72508fa9f884d05762">eid</a> || <a class="code" href="../../d5/d60/utils_8h.html#a4e9f7c7ca75b0ff48b60b136e3961b61">ast_eid_cmp</a>(&amp;<a class="code" href="../../d5/d60/utils_8h.html#ad5db11fa27352e2b9a3c669adc76955f">ast_eid_default</a>, dev_state-&gt;<a class="code" href="../../db/d92/structast__device__state__message.html#a39d1b63955a48c72508fa9f884d05762">eid</a>)) {</div><div class="line"><a name="l01375"></a><span class="lineno"> 1375</span>&#160;      <span class="comment">/* If the event is aggregate or didn&#39;t originate from this server, don&#39;t send it out. */</span></div><div class="line"><a name="l01376"></a><span class="lineno"> 1376</span>&#160;      <span class="keywordflow">return</span>;</div><div class="line"><a name="l01377"></a><span class="lineno"> 1377</span>&#160;   }</div><div class="line"><a name="l01378"></a><span class="lineno"> 1378</span>&#160;</div><div class="line"><a name="l01379"></a><span class="lineno"> 1379</span>&#160;   <a class="code" href="../../dc/d6b/res__xmpp_8c.html#a5d78f1d69258138fd512b397eb27f393">xmpp_pubsub_publish_device_state</a>(client, dev_state-&gt;<a class="code" href="../../db/d92/structast__device__state__message.html#a8059c3b19eb356cf729e5d25b139647e">device</a>, <a class="code" href="../../da/da2/devicestate_8h.html#a6190de57ac370315e51f2c46724d5b10">ast_devstate_str</a>(dev_state-&gt;<a class="code" href="../../db/d92/structast__device__state__message.html#a1acd064aff48cf4d5eafec1030f8429d">state</a>), dev_state-&gt;<a class="code" href="../../db/d92/structast__device__state__message.html#ac2f672c1450e8212e5462a749d393b0b">cachable</a>);</div><div class="line"><a name="l01380"></a><span class="lineno"> 1380</span>&#160;}</div><div class="line"><a name="l01381"></a><span class="lineno"> 1381</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01382"></a><span class="lineno"> 1382</span>&#160;<span class="comment">/*!</span></div><div class="line"><a name="l01383"></a><span class="lineno"> 1383</span>&#160;<span class="comment"> * \brief Unsubscribe from a PubSub node</span></div><div class="line"><a name="l01384"></a><span class="lineno"> 1384</span>&#160;<span class="comment"> * \param client the configured XMPP client we use to connect to a XMPP server</span></div><div class="line"><a name="l01385"></a><span class="lineno"> 1385</span>&#160;<span class="comment"> * \param node the name of the node to which to unsubscribe from</span></div><div class="line"><a name="l01386"></a><span class="lineno"> 1386</span>&#160;<span class="comment"> * \return void</span></div><div class="line"><a name="l01387"></a><span class="lineno"> 1387</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l01388"></a><span class="lineno"><a class="line" href="../../dc/d6b/res__xmpp_8c.html#a6884e3f2670be5350b11f3f6c98f5f91"> 1388</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../dc/d6b/res__xmpp_8c.html#a6884e3f2670be5350b11f3f6c98f5f91">xmpp_pubsub_unsubscribe</a>(<span class="keyword">struct</span> <a class="code" href="../../df/d42/structast__xmpp__client.html">ast_xmpp_client</a> *client, <span class="keyword">const</span> <span class="keywordtype">char</span> *node)</div><div class="line"><a name="l01389"></a><span class="lineno"> 1389</span>&#160;{</div><div class="line"><a name="l01390"></a><span class="lineno"> 1390</span>&#160;   iks *<a class="code" href="../../d0/d29/chan__pjsip_8c.html#a4e2e6fb7d874f0d2deddd2ecfc8afb32">request</a> = <a class="code" href="../../dc/d6b/res__xmpp_8c.html#a6b65b4b3c50fb1a3560fbafd70cf21bd">xmpp_pubsub_iq_create</a>(client, <span class="stringliteral">&quot;set&quot;</span>);</div><div class="line"><a name="l01391"></a><span class="lineno"> 1391</span>&#160;   iks *<a class="code" href="../../da/d70/structast__xmpp__global__config.html#ab40b53f823544fcdeff79c7fc6beb69b">pubsub</a>, *<a class="code" href="../../d8/d25/res__pjsip__mwi_8c.html#a30833678d2fe25c6b56dfe159b3d281b">unsubscribe</a>;</div><div class="line"><a name="l01392"></a><span class="lineno"> 1392</span>&#160;</div><div class="line"><a name="l01393"></a><span class="lineno"> 1393</span>&#160;   <span class="keywordflow">if</span> (!request) {</div><div class="line"><a name="l01394"></a><span class="lineno"> 1394</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Could not create IQ when creating pubsub unsubscription on client &#39;%s&#39;\n&quot;</span>, client-&gt;<a class="code" href="../../df/d42/structast__xmpp__client.html#ace9168767fc3707cf5f0a7d049682ba3">name</a>);</div><div class="line"><a name="l01395"></a><span class="lineno"> 1395</span>&#160;      <span class="keywordflow">return</span>;</div><div class="line"><a name="l01396"></a><span class="lineno"> 1396</span>&#160;   }</div><div class="line"><a name="l01397"></a><span class="lineno"> 1397</span>&#160;</div><div class="line"><a name="l01398"></a><span class="lineno"> 1398</span>&#160;   pubsub = iks_insert(request, <span class="stringliteral">&quot;pubsub&quot;</span>);</div><div class="line"><a name="l01399"></a><span class="lineno"> 1399</span>&#160;   iks_insert_attrib(pubsub, <span class="stringliteral">&quot;xmlns&quot;</span>, <span class="stringliteral">&quot;http://jabber.org/protocol/pubsub&quot;</span>);</div><div class="line"><a name="l01400"></a><span class="lineno"> 1400</span>&#160;   unsubscribe = iks_insert(pubsub, <span class="stringliteral">&quot;unsubscribe&quot;</span>);</div><div class="line"><a name="l01401"></a><span class="lineno"> 1401</span>&#160;   iks_insert_attrib(unsubscribe, <span class="stringliteral">&quot;jid&quot;</span>, client-&gt;<a class="code" href="../../df/d42/structast__xmpp__client.html#af738439b96e613a471505eb1222ac406">jid</a>-&gt;partial);</div><div class="line"><a name="l01402"></a><span class="lineno"> 1402</span>&#160;   iks_insert_attrib(unsubscribe, <span class="stringliteral">&quot;node&quot;</span>, node);</div><div class="line"><a name="l01403"></a><span class="lineno"> 1403</span>&#160;</div><div class="line"><a name="l01404"></a><span class="lineno"> 1404</span>&#160;   <a class="code" href="../../dc/d6b/res__xmpp_8c.html#a01f156e90984166f2bbcbcc5a4a6e582">ast_xmpp_client_send</a>(client, request);</div><div class="line"><a name="l01405"></a><span class="lineno"> 1405</span>&#160;   iks_delete(request);</div><div class="line"><a name="l01406"></a><span class="lineno"> 1406</span>&#160;}</div><div class="line"><a name="l01407"></a><span class="lineno"> 1407</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01408"></a><span class="lineno"> 1408</span>&#160;<span class="comment">/*!</span></div><div class="line"><a name="l01409"></a><span class="lineno"> 1409</span>&#160;<span class="comment"> * \brief Subscribe to a PubSub node</span></div><div class="line"><a name="l01410"></a><span class="lineno"> 1410</span>&#160;<span class="comment"> * \param client the configured XMPP client we use to connect to a XMPP server</span></div><div class="line"><a name="l01411"></a><span class="lineno"> 1411</span>&#160;<span class="comment"> * \param node the name of the node to which to subscribe</span></div><div class="line"><a name="l01412"></a><span class="lineno"> 1412</span>&#160;<span class="comment"> * \return void</span></div><div class="line"><a name="l01413"></a><span class="lineno"> 1413</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l01414"></a><span class="lineno"><a class="line" href="../../dc/d6b/res__xmpp_8c.html#a5aea6229c4245877b1461ef047e4208e"> 1414</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../dc/d6b/res__xmpp_8c.html#a5aea6229c4245877b1461ef047e4208e">xmpp_pubsub_subscribe</a>(<span class="keyword">struct</span> <a class="code" href="../../df/d42/structast__xmpp__client.html">ast_xmpp_client</a> *client, <span class="keyword">const</span> <span class="keywordtype">char</span> *node)</div><div class="line"><a name="l01415"></a><span class="lineno"> 1415</span>&#160;{</div><div class="line"><a name="l01416"></a><span class="lineno"> 1416</span>&#160;   <a class="code" href="../../d5/d60/utils_8h.html#a1604b4d72144dd3d9f7da668e90337e9">RAII_VAR</a>(<span class="keyword">struct</span> <a class="code" href="../../de/d1c/structxmpp__config.html">xmpp_config</a> *, cfg, <a class="code" href="../../d5/da5/astobj2_8h.html#a86d8d6c3c8866ed0a60121da055cd225">ao2_global_obj_ref</a>(<a class="code" href="../../d3/d4e/chan__console_8c.html#aa36e3e2c486b920b166c2d17c5242221">globals</a>), <a class="code" href="../../d5/da5/astobj2_8h.html#a6321ee982370c55ab3c24c72c562cbdd">ao2_cleanup</a>);</div><div class="line"><a name="l01417"></a><span class="lineno"> 1417</span>&#160;   iks *<a class="code" href="../../d0/d29/chan__pjsip_8c.html#a4e2e6fb7d874f0d2deddd2ecfc8afb32">request</a> = <a class="code" href="../../dc/d6b/res__xmpp_8c.html#a6b65b4b3c50fb1a3560fbafd70cf21bd">xmpp_pubsub_iq_create</a>(client, <span class="stringliteral">&quot;set&quot;</span>);</div><div class="line"><a name="l01418"></a><span class="lineno"> 1418</span>&#160;   iks *<a class="code" href="../../da/d70/structast__xmpp__global__config.html#ab40b53f823544fcdeff79c7fc6beb69b">pubsub</a>, *<a class="code" href="../../d1/da4/res__corosync_8c.html#a84fa7112345dca92d94860c1dcef8ba6">subscribe</a>;</div><div class="line"><a name="l01419"></a><span class="lineno"> 1419</span>&#160;</div><div class="line"><a name="l01420"></a><span class="lineno"> 1420</span>&#160;   <span class="keywordflow">if</span> (!cfg || !cfg-&gt;global || !request) {</div><div class="line"><a name="l01421"></a><span class="lineno"> 1421</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Could not create IQ when creating pubsub subscription on client &#39;%s&#39;\n&quot;</span>, client-&gt;<a class="code" href="../../df/d42/structast__xmpp__client.html#ace9168767fc3707cf5f0a7d049682ba3">name</a>);</div><div class="line"><a name="l01422"></a><span class="lineno"> 1422</span>&#160;      <span class="keywordflow">return</span>;</div><div class="line"><a name="l01423"></a><span class="lineno"> 1423</span>&#160;   }</div><div class="line"><a name="l01424"></a><span class="lineno"> 1424</span>&#160;</div><div class="line"><a name="l01425"></a><span class="lineno"> 1425</span>&#160;   pubsub = iks_insert(request, <span class="stringliteral">&quot;pubsub&quot;</span>);</div><div class="line"><a name="l01426"></a><span class="lineno"> 1426</span>&#160;   iks_insert_attrib(pubsub, <span class="stringliteral">&quot;xmlns&quot;</span>, <span class="stringliteral">&quot;http://jabber.org/protocol/pubsub&quot;</span>);</div><div class="line"><a name="l01427"></a><span class="lineno"> 1427</span>&#160;   subscribe = iks_insert(pubsub, <span class="stringliteral">&quot;subscribe&quot;</span>);</div><div class="line"><a name="l01428"></a><span class="lineno"> 1428</span>&#160;   iks_insert_attrib(subscribe, <span class="stringliteral">&quot;jid&quot;</span>, client-&gt;<a class="code" href="../../df/d42/structast__xmpp__client.html#af738439b96e613a471505eb1222ac406">jid</a>-&gt;partial);</div><div class="line"><a name="l01429"></a><span class="lineno"> 1429</span>&#160;   iks_insert_attrib(subscribe, <span class="stringliteral">&quot;node&quot;</span>, node);</div><div class="line"><a name="l01430"></a><span class="lineno"> 1430</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d5/d60/utils_8h.html#a00d4c9254c9827d6fa44f17a326744a5">ast_test_flag</a>(&amp;cfg-&gt;global-&gt;pubsub, <a class="code" href="../../dc/d6b/res__xmpp_8c.html#ac5b95f02723021833cc47477b06a962ca045d4dbda72ca97ef5ef8c383279d7dc">XMPP_XEP0248</a>)) {</div><div class="line"><a name="l01431"></a><span class="lineno"> 1431</span>&#160;      iks *<a class="code" href="../../d4/d45/test__http__media__cache_8c.html#a80c8e3ae5087d90d422675d034eeebc7">options</a>, *x, *sub_options, *sub_type, *sub_depth, *sub_expire;</div><div class="line"><a name="l01432"></a><span class="lineno"> 1432</span>&#160;      options = iks_insert(pubsub, <span class="stringliteral">&quot;options&quot;</span>);</div><div class="line"><a name="l01433"></a><span class="lineno"> 1433</span>&#160;      x = iks_insert(options, <span class="stringliteral">&quot;x&quot;</span>);</div><div class="line"><a name="l01434"></a><span class="lineno"> 1434</span>&#160;      iks_insert_attrib(x, <span class="stringliteral">&quot;xmlns&quot;</span>, <span class="stringliteral">&quot;jabber:x:data&quot;</span>);</div><div class="line"><a name="l01435"></a><span class="lineno"> 1435</span>&#160;      iks_insert_attrib(x, <span class="stringliteral">&quot;type&quot;</span>, <span class="stringliteral">&quot;submit&quot;</span>);</div><div class="line"><a name="l01436"></a><span class="lineno"> 1436</span>&#160;      sub_options = iks_insert(x, <span class="stringliteral">&quot;field&quot;</span>);</div><div class="line"><a name="l01437"></a><span class="lineno"> 1437</span>&#160;      iks_insert_attrib(sub_options, <span class="stringliteral">&quot;var&quot;</span>, <span class="stringliteral">&quot;FORM_TYPE&quot;</span>);</div><div class="line"><a name="l01438"></a><span class="lineno"> 1438</span>&#160;      iks_insert_attrib(sub_options, <span class="stringliteral">&quot;type&quot;</span>, <span class="stringliteral">&quot;hidden&quot;</span>);</div><div class="line"><a name="l01439"></a><span class="lineno"> 1439</span>&#160;      iks_insert_cdata(iks_insert(sub_options, <span class="stringliteral">&quot;value&quot;</span>),</div><div class="line"><a name="l01440"></a><span class="lineno"> 1440</span>&#160;             <span class="stringliteral">&quot;http://jabber.org/protocol/pubsub#subscribe_options&quot;</span>, 51);</div><div class="line"><a name="l01441"></a><span class="lineno"> 1441</span>&#160;      sub_type = iks_insert(x, <span class="stringliteral">&quot;field&quot;</span>);</div><div class="line"><a name="l01442"></a><span class="lineno"> 1442</span>&#160;      iks_insert_attrib(sub_type, <span class="stringliteral">&quot;var&quot;</span>, <span class="stringliteral">&quot;pubsub#subscription_type&quot;</span>);</div><div class="line"><a name="l01443"></a><span class="lineno"> 1443</span>&#160;      iks_insert_cdata(iks_insert(sub_type, <span class="stringliteral">&quot;value&quot;</span>), <span class="stringliteral">&quot;items&quot;</span>, 5);</div><div class="line"><a name="l01444"></a><span class="lineno"> 1444</span>&#160;      sub_depth = iks_insert(x, <span class="stringliteral">&quot;field&quot;</span>);</div><div class="line"><a name="l01445"></a><span class="lineno"> 1445</span>&#160;      iks_insert_attrib(sub_depth, <span class="stringliteral">&quot;var&quot;</span>, <span class="stringliteral">&quot;pubsub#subscription_depth&quot;</span>);</div><div class="line"><a name="l01446"></a><span class="lineno"> 1446</span>&#160;      iks_insert_cdata(iks_insert(sub_depth, <span class="stringliteral">&quot;value&quot;</span>), <span class="stringliteral">&quot;all&quot;</span>, 3);</div><div class="line"><a name="l01447"></a><span class="lineno"> 1447</span>&#160;      sub_expire = iks_insert(x, <span class="stringliteral">&quot;field&quot;</span>);</div><div class="line"><a name="l01448"></a><span class="lineno"> 1448</span>&#160;      iks_insert_attrib(sub_expire, <span class="stringliteral">&quot;var&quot;</span>, <span class="stringliteral">&quot;pubsub#expire&quot;</span>);</div><div class="line"><a name="l01449"></a><span class="lineno"> 1449</span>&#160;      iks_insert_cdata(iks_insert(sub_expire, <span class="stringliteral">&quot;value&quot;</span>), <span class="stringliteral">&quot;presence&quot;</span>, 8);</div><div class="line"><a name="l01450"></a><span class="lineno"> 1450</span>&#160;   }</div><div class="line"><a name="l01451"></a><span class="lineno"> 1451</span>&#160;   <a class="code" href="../../dc/d6b/res__xmpp_8c.html#a01f156e90984166f2bbcbcc5a4a6e582">ast_xmpp_client_send</a>(client, request);</div><div class="line"><a name="l01452"></a><span class="lineno"> 1452</span>&#160;   iks_delete(request);</div><div class="line"><a name="l01453"></a><span class="lineno"> 1453</span>&#160;}</div><div class="line"><a name="l01454"></a><span class="lineno"> 1454</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01455"></a><span class="lineno"> 1455</span>&#160;<span class="comment">/*!</span></div><div class="line"><a name="l01456"></a><span class="lineno"> 1456</span>&#160;<span class="comment"> * \brief Callback for handling PubSub events</span></div><div class="line"><a name="l01457"></a><span class="lineno"> 1457</span>&#160;<span class="comment"> * \param data void pointer to ast_xmpp_client structure</span></div><div class="line"><a name="l01458"></a><span class="lineno"> 1458</span>&#160;<span class="comment"> * \param pak A pak</span></div><div class="line"><a name="l01459"></a><span class="lineno"> 1459</span>&#160;<span class="comment"> * \return IKS_FILTER_EAT</span></div><div class="line"><a name="l01460"></a><span class="lineno"> 1460</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l01461"></a><span class="lineno"><a class="line" href="../../dc/d6b/res__xmpp_8c.html#af3eb7b696a9437a0b6ffba5a79f696bd"> 1461</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../dc/d6b/res__xmpp_8c.html#af3eb7b696a9437a0b6ffba5a79f696bd">xmpp_pubsub_handle_event</a>(<span class="keywordtype">void</span> *data, ikspak *pak)</div><div class="line"><a name="l01462"></a><span class="lineno"> 1462</span>&#160;{</div><div class="line"><a name="l01463"></a><span class="lineno"> 1463</span>&#160;   <span class="keywordtype">char</span> *item_id, *device_state, *<a class="code" href="../../d0/dd6/chan__mgcp_8c.html#a6b49cafa2a3d359a2e865992f551874a">mailbox</a>, *cachable_str;</div><div class="line"><a name="l01464"></a><span class="lineno"> 1464</span>&#160;   <span class="keywordtype">int</span> oldmsgs, newmsgs;</div><div class="line"><a name="l01465"></a><span class="lineno"> 1465</span>&#160;   iks *<a class="code" href="../../d8/d4f/test__config_8c.html#aecdc7cbd5dfa76493c0212caa55d706c">item</a>, *item_content;</div><div class="line"><a name="l01466"></a><span class="lineno"> 1466</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d0/d86/structast__eid.html">ast_eid</a> pubsub_eid;</div><div class="line"><a name="l01467"></a><span class="lineno"> 1467</span>&#160;   <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> cachable = <a class="code" href="../../da/da2/devicestate_8h.html#a26cbac580d3e86b529f90058f6e91ac7a3683b746ab070a6455934b5d24dbd779">AST_DEVSTATE_CACHABLE</a>;</div><div class="line"><a name="l01468"></a><span class="lineno"> 1468</span>&#160;   item = iks_find(iks_find(iks_find(pak-&gt;x, <span class="stringliteral">&quot;event&quot;</span>), <span class="stringliteral">&quot;items&quot;</span>), <span class="stringliteral">&quot;item&quot;</span>);</div><div class="line"><a name="l01469"></a><span class="lineno"> 1469</span>&#160;   <span class="keywordflow">if</span> (!item) {</div><div class="line"><a name="l01470"></a><span class="lineno"> 1470</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Could not parse incoming PubSub event\n&quot;</span>);</div><div class="line"><a name="l01471"></a><span class="lineno"> 1471</span>&#160;      <span class="keywordflow">return</span> IKS_FILTER_EAT;</div><div class="line"><a name="l01472"></a><span class="lineno"> 1472</span>&#160;   }</div><div class="line"><a name="l01473"></a><span class="lineno"> 1473</span>&#160;   item_id = iks_find_attrib(item, <span class="stringliteral">&quot;id&quot;</span>);</div><div class="line"><a name="l01474"></a><span class="lineno"> 1474</span>&#160;   item_content = iks_child(item);</div><div class="line"><a name="l01475"></a><span class="lineno"> 1475</span>&#160;   <a class="code" href="../../d5/d60/utils_8h.html#ad60a8c795e1f64b7beeed705425c555f">ast_str_to_eid</a>(&amp;pubsub_eid, iks_find_attrib(item_content, <span class="stringliteral">&quot;eid&quot;</span>));</div><div class="line"><a name="l01476"></a><span class="lineno"> 1476</span>&#160;   <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d60/utils_8h.html#a4e9f7c7ca75b0ff48b60b136e3961b61">ast_eid_cmp</a>(&amp;<a class="code" href="../../d5/d60/utils_8h.html#ad5db11fa27352e2b9a3c669adc76955f">ast_eid_default</a>, &amp;pubsub_eid)) {</div><div class="line"><a name="l01477"></a><span class="lineno"> 1477</span>&#160;      <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(1, <span class="stringliteral">&quot;Returning here, eid of incoming event matches ours!\n&quot;</span>);</div><div class="line"><a name="l01478"></a><span class="lineno"> 1478</span>&#160;      <span class="keywordflow">return</span> IKS_FILTER_EAT;</div><div class="line"><a name="l01479"></a><span class="lineno"> 1479</span>&#160;   }</div><div class="line"><a name="l01480"></a><span class="lineno"> 1480</span>&#160;   <span class="keywordflow">if</span> (!strcasecmp(iks_name(item_content), <span class="stringliteral">&quot;state&quot;</span>)) {</div><div class="line"><a name="l01481"></a><span class="lineno"> 1481</span>&#160;      <span class="keywordflow">if</span> ((cachable_str = iks_find_attrib(item_content, <span class="stringliteral">&quot;cachable&quot;</span>))) {</div><div class="line"><a name="l01482"></a><span class="lineno"> 1482</span>&#160;         sscanf(cachable_str, <span class="stringliteral">&quot;%30u&quot;</span>, &amp;cachable);</div><div class="line"><a name="l01483"></a><span class="lineno"> 1483</span>&#160;      }</div><div class="line"><a name="l01484"></a><span class="lineno"> 1484</span>&#160;      device_state = iks_find_cdata(item, <span class="stringliteral">&quot;state&quot;</span>);</div><div class="line"><a name="l01485"></a><span class="lineno"> 1485</span>&#160;      <a class="code" href="../../da/da2/devicestate_8h.html#afe9dc809c9ea4d32dfb4abd5fd92dfb2">ast_publish_device_state_full</a>(item_id,</div><div class="line"><a name="l01486"></a><span class="lineno"> 1486</span>&#160;                  <a class="code" href="../../da/da2/devicestate_8h.html#ae148e0b95218b57b0348ab53f2f82657">ast_devstate_val</a>(device_state),</div><div class="line"><a name="l01487"></a><span class="lineno"> 1487</span>&#160;                  cachable == <a class="code" href="../../da/da2/devicestate_8h.html#a26cbac580d3e86b529f90058f6e91ac7a3683b746ab070a6455934b5d24dbd779">AST_DEVSTATE_CACHABLE</a> ? <a class="code" href="../../da/da2/devicestate_8h.html#a26cbac580d3e86b529f90058f6e91ac7a3683b746ab070a6455934b5d24dbd779">AST_DEVSTATE_CACHABLE</a> : <a class="code" href="../../da/da2/devicestate_8h.html#a26cbac580d3e86b529f90058f6e91ac7a4dbd4bd0c7bf0b9d8c3c2c800d39cfc1">AST_DEVSTATE_NOT_CACHABLE</a>,</div><div class="line"><a name="l01488"></a><span class="lineno"> 1488</span>&#160;                  &amp;pubsub_eid);</div><div class="line"><a name="l01489"></a><span class="lineno"> 1489</span>&#160;      <span class="keywordflow">return</span> IKS_FILTER_EAT;</div><div class="line"><a name="l01490"></a><span class="lineno"> 1490</span>&#160;   } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(iks_name(item_content), <span class="stringliteral">&quot;mailbox&quot;</span>)) {</div><div class="line"><a name="l01491"></a><span class="lineno"> 1491</span>&#160;      mailbox = <a class="code" href="../../de/da3/include_2asterisk_2compat_8h.html#a40eca58273c74a20a17f137d18ba826c">strsep</a>(&amp;item_id, <span class="stringliteral">&quot;@&quot;</span>);</div><div class="line"><a name="l01492"></a><span class="lineno"> 1492</span>&#160;      sscanf(iks_find_cdata(item_content, <span class="stringliteral">&quot;OLDMSGS&quot;</span>), <span class="stringliteral">&quot;%10d&quot;</span>, &amp;oldmsgs);</div><div class="line"><a name="l01493"></a><span class="lineno"> 1493</span>&#160;      sscanf(iks_find_cdata(item_content, <span class="stringliteral">&quot;NEWMSGS&quot;</span>), <span class="stringliteral">&quot;%10d&quot;</span>, &amp;newmsgs);</div><div class="line"><a name="l01494"></a><span class="lineno"> 1494</span>&#160;</div><div class="line"><a name="l01495"></a><span class="lineno"> 1495</span>&#160;      <a class="code" href="../../dc/d33/mwi_8h.html#a889083170a9d78ccdbfbcb75406ed98d">ast_publish_mwi_state_full</a>(mailbox, item_id, newmsgs, oldmsgs, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, &amp;pubsub_eid);</div><div class="line"><a name="l01496"></a><span class="lineno"> 1496</span>&#160;</div><div class="line"><a name="l01497"></a><span class="lineno"> 1497</span>&#160;      <span class="keywordflow">return</span> IKS_FILTER_EAT;</div><div class="line"><a name="l01498"></a><span class="lineno"> 1498</span>&#160;   } <span class="keywordflow">else</span> {</div><div class="line"><a name="l01499"></a><span class="lineno"> 1499</span>&#160;      <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(1, <span class="stringliteral">&quot;Don&#39;t know how to handle PubSub event of type %s\n&quot;</span>,</div><div class="line"><a name="l01500"></a><span class="lineno"> 1500</span>&#160;           iks_name(item_content));</div><div class="line"><a name="l01501"></a><span class="lineno"> 1501</span>&#160;      <span class="keywordflow">return</span> IKS_FILTER_EAT;</div><div class="line"><a name="l01502"></a><span class="lineno"> 1502</span>&#160;   }</div><div class="line"><a name="l01503"></a><span class="lineno"> 1503</span>&#160;</div><div class="line"><a name="l01504"></a><span class="lineno"> 1504</span>&#160;   <span class="keywordflow">return</span> IKS_FILTER_EAT;</div><div class="line"><a name="l01505"></a><span class="lineno"> 1505</span>&#160;}</div><div class="line"><a name="l01506"></a><span class="lineno"> 1506</span>&#160;</div><div class="line"><a name="l01507"></a><span class="lineno"><a class="line" href="../../dc/d6b/res__xmpp_8c.html#aa6cfea569255dcae7c7f6b900dab4876"> 1507</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../dc/d6b/res__xmpp_8c.html#aa6cfea569255dcae7c7f6b900dab4876">xmpp_pubsub_handle_error</a>(<span class="keywordtype">void</span> *data, ikspak *pak)</div><div class="line"><a name="l01508"></a><span class="lineno"> 1508</span>&#160;{</div><div class="line"><a name="l01509"></a><span class="lineno"> 1509</span>&#160;   <a class="code" href="../../d5/d60/utils_8h.html#a1604b4d72144dd3d9f7da668e90337e9">RAII_VAR</a>(<span class="keyword">struct</span> <a class="code" href="../../de/d1c/structxmpp__config.html">xmpp_config</a> *, cfg, <a class="code" href="../../d5/da5/astobj2_8h.html#a86d8d6c3c8866ed0a60121da055cd225">ao2_global_obj_ref</a>(<a class="code" href="../../d3/d4e/chan__console_8c.html#aa36e3e2c486b920b166c2d17c5242221">globals</a>), <a class="code" href="../../d5/da5/astobj2_8h.html#a6321ee982370c55ab3c24c72c562cbdd">ao2_cleanup</a>);</div><div class="line"><a name="l01510"></a><span class="lineno"> 1510</span>&#160;   <span class="keywordtype">char</span> *node_name, *<a class="code" href="../../d6/d47/utils_2frame_8c.html#a4a9391ee88e57361b613c4c2fd2bf4aa">error</a>;</div><div class="line"><a name="l01511"></a><span class="lineno"> 1511</span>&#160;   <span class="keywordtype">int</span> error_num;</div><div class="line"><a name="l01512"></a><span class="lineno"> 1512</span>&#160;   iks *orig_request, *orig_pubsub = iks_find(pak-&gt;x, <span class="stringliteral">&quot;pubsub&quot;</span>);</div><div class="line"><a name="l01513"></a><span class="lineno"> 1513</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../df/d42/structast__xmpp__client.html">ast_xmpp_client</a> *client = data;</div><div class="line"><a name="l01514"></a><span class="lineno"> 1514</span>&#160;</div><div class="line"><a name="l01515"></a><span class="lineno"> 1515</span>&#160;   <span class="keywordflow">if</span> (!cfg || !cfg-&gt;global) {</div><div class="line"><a name="l01516"></a><span class="lineno"> 1516</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;No global configuration available\n&quot;</span>);</div><div class="line"><a name="l01517"></a><span class="lineno"> 1517</span>&#160;      <span class="keywordflow">return</span> IKS_FILTER_EAT;</div><div class="line"><a name="l01518"></a><span class="lineno"> 1518</span>&#160;   }</div><div class="line"><a name="l01519"></a><span class="lineno"> 1519</span>&#160;</div><div class="line"><a name="l01520"></a><span class="lineno"> 1520</span>&#160;   <span class="keywordflow">if</span> (!orig_pubsub) {</div><div class="line"><a name="l01521"></a><span class="lineno"> 1521</span>&#160;      <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(1, <span class="stringliteral">&quot;Error isn&#39;t a PubSub error, why are we here?\n&quot;</span>);</div><div class="line"><a name="l01522"></a><span class="lineno"> 1522</span>&#160;      <span class="keywordflow">return</span> IKS_FILTER_EAT;</div><div class="line"><a name="l01523"></a><span class="lineno"> 1523</span>&#160;   }</div><div class="line"><a name="l01524"></a><span class="lineno"> 1524</span>&#160;</div><div class="line"><a name="l01525"></a><span class="lineno"> 1525</span>&#160;   orig_request = iks_child(orig_pubsub);</div><div class="line"><a name="l01526"></a><span class="lineno"> 1526</span>&#160;   error = iks_find_attrib(iks_find(pak-&gt;x, <span class="stringliteral">&quot;error&quot;</span>), <span class="stringliteral">&quot;code&quot;</span>);</div><div class="line"><a name="l01527"></a><span class="lineno"> 1527</span>&#160;   node_name = iks_find_attrib(orig_request, <span class="stringliteral">&quot;node&quot;</span>);</div><div class="line"><a name="l01528"></a><span class="lineno"> 1528</span>&#160;</div><div class="line"><a name="l01529"></a><span class="lineno"> 1529</span>&#160;   <span class="keywordflow">if</span> (!sscanf(error, <span class="stringliteral">&quot;%30d&quot;</span>, &amp;error_num)) {</div><div class="line"><a name="l01530"></a><span class="lineno"> 1530</span>&#160;      <span class="keywordflow">return</span> IKS_FILTER_EAT;</div><div class="line"><a name="l01531"></a><span class="lineno"> 1531</span>&#160;   }</div><div class="line"><a name="l01532"></a><span class="lineno"> 1532</span>&#160;</div><div class="line"><a name="l01533"></a><span class="lineno"> 1533</span>&#160;   <span class="keywordflow">if</span> (error_num &gt; 399 &amp;&amp; error_num &lt; 500 &amp;&amp; error_num != 404) {</div><div class="line"><a name="l01534"></a><span class="lineno"> 1534</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>,</div><div class="line"><a name="l01535"></a><span class="lineno"> 1535</span>&#160;         <span class="stringliteral">&quot;Error performing operation on PubSub node %s, %s.\n&quot;</span>, node_name, error);</div><div class="line"><a name="l01536"></a><span class="lineno"> 1536</span>&#160;      <span class="keywordflow">return</span> IKS_FILTER_EAT;</div><div class="line"><a name="l01537"></a><span class="lineno"> 1537</span>&#160;   } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (error_num &gt; 499 &amp;&amp; error_num &lt; 600) {</div><div class="line"><a name="l01538"></a><span class="lineno"> 1538</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;PubSub Server error, %s\n&quot;</span>, error);</div><div class="line"><a name="l01539"></a><span class="lineno"> 1539</span>&#160;      <span class="keywordflow">return</span> IKS_FILTER_EAT;</div><div class="line"><a name="l01540"></a><span class="lineno"> 1540</span>&#160;   }</div><div class="line"><a name="l01541"></a><span class="lineno"> 1541</span>&#160;</div><div class="line"><a name="l01542"></a><span class="lineno"> 1542</span>&#160;   <span class="keywordflow">if</span> (!strcasecmp(iks_name(orig_request), <span class="stringliteral">&quot;publish&quot;</span>)) {</div><div class="line"><a name="l01543"></a><span class="lineno"> 1543</span>&#160;      iks *<a class="code" href="../../d0/d29/chan__pjsip_8c.html#a4e2e6fb7d874f0d2deddd2ecfc8afb32">request</a>;</div><div class="line"><a name="l01544"></a><span class="lineno"> 1544</span>&#160;</div><div class="line"><a name="l01545"></a><span class="lineno"> 1545</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="../../d5/d60/utils_8h.html#a00d4c9254c9827d6fa44f17a326744a5">ast_test_flag</a>(&amp;cfg-&gt;global-&gt;pubsub, <a class="code" href="../../dc/d6b/res__xmpp_8c.html#ac5b95f02723021833cc47477b06a962ca045d4dbda72ca97ef5ef8c383279d7dc">XMPP_XEP0248</a>)) {</div><div class="line"><a name="l01546"></a><span class="lineno"> 1546</span>&#160;         <span class="keywordflow">if</span> (iks_find(iks_find(orig_request, <span class="stringliteral">&quot;item&quot;</span>), <span class="stringliteral">&quot;state&quot;</span>)) {</div><div class="line"><a name="l01547"></a><span class="lineno"> 1547</span>&#160;            <a class="code" href="../../dc/d6b/res__xmpp_8c.html#a8e8150ade4edbd105394640480f6cd2c">xmpp_pubsub_create_leaf</a>(client, <span class="stringliteral">&quot;device_state&quot;</span>, node_name);</div><div class="line"><a name="l01548"></a><span class="lineno"> 1548</span>&#160;         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (iks_find(iks_find(orig_request, <span class="stringliteral">&quot;item&quot;</span>), <span class="stringliteral">&quot;mailbox&quot;</span>)) {</div><div class="line"><a name="l01549"></a><span class="lineno"> 1549</span>&#160;            <a class="code" href="../../dc/d6b/res__xmpp_8c.html#a8e8150ade4edbd105394640480f6cd2c">xmpp_pubsub_create_leaf</a>(client, <span class="stringliteral">&quot;message_waiting&quot;</span>, node_name);</div><div class="line"><a name="l01550"></a><span class="lineno"> 1550</span>&#160;         }</div><div class="line"><a name="l01551"></a><span class="lineno"> 1551</span>&#160;      } <span class="keywordflow">else</span> {</div><div class="line"><a name="l01552"></a><span class="lineno"> 1552</span>&#160;         <a class="code" href="../../dc/d6b/res__xmpp_8c.html#aca3aa26e115851782ebae0ba598728e0">xmpp_pubsub_create_node</a>(client, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, node_name, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div><div class="line"><a name="l01553"></a><span class="lineno"> 1553</span>&#160;      }</div><div class="line"><a name="l01554"></a><span class="lineno"> 1554</span>&#160;</div><div class="line"><a name="l01555"></a><span class="lineno"> 1555</span>&#160;      <span class="keywordflow">if</span> ((request = <a class="code" href="../../dc/d6b/res__xmpp_8c.html#a6b65b4b3c50fb1a3560fbafd70cf21bd">xmpp_pubsub_iq_create</a>(client, <span class="stringliteral">&quot;set&quot;</span>))) {</div><div class="line"><a name="l01556"></a><span class="lineno"> 1556</span>&#160;         iks_insert_node(request, orig_pubsub);</div><div class="line"><a name="l01557"></a><span class="lineno"> 1557</span>&#160;         <a class="code" href="../../dc/d6b/res__xmpp_8c.html#a01f156e90984166f2bbcbcc5a4a6e582">ast_xmpp_client_send</a>(client, request);</div><div class="line"><a name="l01558"></a><span class="lineno"> 1558</span>&#160;         iks_delete(request);</div><div class="line"><a name="l01559"></a><span class="lineno"> 1559</span>&#160;      } <span class="keywordflow">else</span> {</div><div class="line"><a name="l01560"></a><span class="lineno"> 1560</span>&#160;         <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;PubSub publish could not create IQ\n&quot;</span>);</div><div class="line"><a name="l01561"></a><span class="lineno"> 1561</span>&#160;      }</div><div class="line"><a name="l01562"></a><span class="lineno"> 1562</span>&#160;</div><div class="line"><a name="l01563"></a><span class="lineno"> 1563</span>&#160;      <span class="keywordflow">return</span> IKS_FILTER_EAT;</div><div class="line"><a name="l01564"></a><span class="lineno"> 1564</span>&#160;   } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(iks_name(orig_request), <span class="stringliteral">&quot;subscribe&quot;</span>)) {</div><div class="line"><a name="l01565"></a><span class="lineno"> 1565</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="../../d5/d60/utils_8h.html#a00d4c9254c9827d6fa44f17a326744a5">ast_test_flag</a>(&amp;cfg-&gt;global-&gt;pubsub, <a class="code" href="../../dc/d6b/res__xmpp_8c.html#ac5b95f02723021833cc47477b06a962ca045d4dbda72ca97ef5ef8c383279d7dc">XMPP_XEP0248</a>)) {</div><div class="line"><a name="l01566"></a><span class="lineno"> 1566</span>&#160;         <a class="code" href="../../dc/d6b/res__xmpp_8c.html#a64804aabc6379d1e89d71ac9ae686654">xmpp_pubsub_create_collection</a>(client, node_name);</div><div class="line"><a name="l01567"></a><span class="lineno"> 1567</span>&#160;      } <span class="keywordflow">else</span> {</div><div class="line"><a name="l01568"></a><span class="lineno"> 1568</span>&#160;         <a class="code" href="../../dc/d6b/res__xmpp_8c.html#aca3aa26e115851782ebae0ba598728e0">xmpp_pubsub_create_node</a>(client, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, node_name, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div><div class="line"><a name="l01569"></a><span class="lineno"> 1569</span>&#160;      }</div><div class="line"><a name="l01570"></a><span class="lineno"> 1570</span>&#160;   }</div><div class="line"><a name="l01571"></a><span class="lineno"> 1571</span>&#160;</div><div class="line"><a name="l01572"></a><span class="lineno"> 1572</span>&#160;   <span class="keywordflow">return</span> IKS_FILTER_EAT;</div><div class="line"><a name="l01573"></a><span class="lineno"> 1573</span>&#160;}</div><div class="line"><a name="l01574"></a><span class="lineno"> 1574</span>&#160;</div><div class="line"><a name="l01575"></a><span class="lineno"><a class="line" href="../../dc/d6b/res__xmpp_8c.html#aa073dd3fd02ac2d0b962a7b040b0b706"> 1575</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../dc/d6b/res__xmpp_8c.html#aa073dd3fd02ac2d0b962a7b040b0b706">cached_devstate_cb</a>(<span class="keywordtype">void</span> *obj, <span class="keywordtype">void</span> *arg, <span class="keywordtype">int</span> flags)</div><div class="line"><a name="l01576"></a><span class="lineno"> 1576</span>&#160;{</div><div class="line"><a name="l01577"></a><span class="lineno"> 1577</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d7/d55/structstasis__message.html">stasis_message</a> *msg = obj;</div><div class="line"><a name="l01578"></a><span class="lineno"> 1578</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../df/d42/structast__xmpp__client.html">ast_xmpp_client</a> *client = arg;</div><div class="line"><a name="l01579"></a><span class="lineno"> 1579</span>&#160;   <a class="code" href="../../dc/d6b/res__xmpp_8c.html#a65b4aeae7d602f7aa68d217f0576c033">xmpp_pubsub_devstate_cb</a>(client, client-&gt;<a class="code" href="../../df/d42/structast__xmpp__client.html#ace475b3c63f137d8ff9af0e10d4f5e97">device_state_sub</a>, msg);</div><div class="line"><a name="l01580"></a><span class="lineno"> 1580</span>&#160;   <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l01581"></a><span class="lineno"> 1581</span>&#160;}</div><div class="line"><a name="l01582"></a><span class="lineno"> 1582</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01583"></a><span class="lineno"> 1583</span>&#160;<span class="comment">/*!</span></div><div class="line"><a name="l01584"></a><span class="lineno"> 1584</span>&#160;<span class="comment"> * \brief Initialize collections for event distribution</span></div><div class="line"><a name="l01585"></a><span class="lineno"> 1585</span>&#160;<span class="comment"> * \param client the configured XMPP client we use to connect to a XMPP server</span></div><div class="line"><a name="l01586"></a><span class="lineno"> 1586</span>&#160;<span class="comment"> * \return void</span></div><div class="line"><a name="l01587"></a><span class="lineno"> 1587</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l01588"></a><span class="lineno"><a class="line" href="../../dc/d6b/res__xmpp_8c.html#a92d502301cd0604b3db58299d86a7fe9"> 1588</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../dc/d6b/res__xmpp_8c.html#a92d502301cd0604b3db58299d86a7fe9">xmpp_init_event_distribution</a>(<span class="keyword">struct</span> <a class="code" href="../../df/d42/structast__xmpp__client.html">ast_xmpp_client</a> *client)</div><div class="line"><a name="l01589"></a><span class="lineno"> 1589</span>&#160;{</div><div class="line"><a name="l01590"></a><span class="lineno"> 1590</span>&#160;   <a class="code" href="../../d5/d60/utils_8h.html#a1604b4d72144dd3d9f7da668e90337e9">RAII_VAR</a>(<span class="keyword">struct</span> <a class="code" href="../../de/d1c/structxmpp__config.html">xmpp_config</a> *, cfg, <a class="code" href="../../d5/da5/astobj2_8h.html#a86d8d6c3c8866ed0a60121da055cd225">ao2_global_obj_ref</a>(<a class="code" href="../../d3/d4e/chan__console_8c.html#aa36e3e2c486b920b166c2d17c5242221">globals</a>), <a class="code" href="../../d5/da5/astobj2_8h.html#a6321ee982370c55ab3c24c72c562cbdd">ao2_cleanup</a>);</div><div class="line"><a name="l01591"></a><span class="lineno"> 1591</span>&#160;   <a class="code" href="../../d5/d60/utils_8h.html#a1604b4d72144dd3d9f7da668e90337e9">RAII_VAR</a>(<span class="keyword">struct</span> <a class="code" href="../../da/d00/structast__xmpp__client__config.html">ast_xmpp_client_config</a> *, clientcfg, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../d5/da5/astobj2_8h.html#a6321ee982370c55ab3c24c72c562cbdd">ao2_cleanup</a>);</div><div class="line"><a name="l01592"></a><span class="lineno"> 1592</span>&#160;   <a class="code" href="../../d5/d60/utils_8h.html#a1604b4d72144dd3d9f7da668e90337e9">RAII_VAR</a>(<span class="keyword">struct</span> <a class="code" href="../../d2/da9/structao2__container.html">ao2_container</a> *, cached, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../d5/da5/astobj2_8h.html#a6321ee982370c55ab3c24c72c562cbdd">ao2_cleanup</a>);</div><div class="line"><a name="l01593"></a><span class="lineno"> 1593</span>&#160;</div><div class="line"><a name="l01594"></a><span class="lineno"> 1594</span>&#160;   <span class="keywordflow">if</span> (!cfg || !cfg-&gt;clients || !(clientcfg = <a class="code" href="../../dc/d6b/res__xmpp_8c.html#a14d10033fb3b97f06238940259f45266">xmpp_config_find</a>(cfg-&gt;clients, client-&gt;<a class="code" href="../../df/d42/structast__xmpp__client.html#ace9168767fc3707cf5f0a7d049682ba3">name</a>))) {</div><div class="line"><a name="l01595"></a><span class="lineno"> 1595</span>&#160;      <span class="keywordflow">return</span>;</div><div class="line"><a name="l01596"></a><span class="lineno"> 1596</span>&#160;   }</div><div class="line"><a name="l01597"></a><span class="lineno"> 1597</span>&#160;</div><div class="line"><a name="l01598"></a><span class="lineno"> 1598</span>&#160;   <a class="code" href="../../dc/d6b/res__xmpp_8c.html#a6884e3f2670be5350b11f3f6c98f5f91">xmpp_pubsub_unsubscribe</a>(client, <span class="stringliteral">&quot;device_state&quot;</span>);</div><div class="line"><a name="l01599"></a><span class="lineno"> 1599</span>&#160;   <a class="code" href="../../dc/d6b/res__xmpp_8c.html#a6884e3f2670be5350b11f3f6c98f5f91">xmpp_pubsub_unsubscribe</a>(client, <span class="stringliteral">&quot;message_waiting&quot;</span>);</div><div class="line"><a name="l01600"></a><span class="lineno"> 1600</span>&#160;</div><div class="line"><a name="l01601"></a><span class="lineno"> 1601</span>&#160;   <span class="keywordflow">if</span> (!(client-&gt;<a class="code" href="../../df/d42/structast__xmpp__client.html#a422af54ca3d288f34246a66114879f27">mwi_sub</a> = <a class="code" href="../../dd/d79/stasis_8h.html#a597f7a30fe616c9f083a93ed168955ed">stasis_subscribe_pool</a>(<a class="code" href="../../df/deb/group__StasisTopicsAndMessages.html#ga547ae87810e6cd121cea7b3149343366">ast_mwi_topic_all</a>(), <a class="code" href="../../dc/d6b/res__xmpp_8c.html#a8816b23744b8848485aaefb051b97f69">xmpp_pubsub_mwi_cb</a>, client))) {</div><div class="line"><a name="l01602"></a><span class="lineno"> 1602</span>&#160;      <span class="keywordflow">return</span>;</div><div class="line"><a name="l01603"></a><span class="lineno"> 1603</span>&#160;   }</div><div class="line"><a name="l01604"></a><span class="lineno"> 1604</span>&#160;   <a class="code" href="../../dd/d79/stasis_8h.html#a4f248ee5f4791f05d0af8768aaab282b">stasis_subscription_accept_message_type</a>(client-&gt;<a class="code" href="../../df/d42/structast__xmpp__client.html#a422af54ca3d288f34246a66114879f27">mwi_sub</a>, <a class="code" href="../../df/deb/group__StasisTopicsAndMessages.html#gaf226cf2d1a4dbbbf220521d58c05ac0f">ast_mwi_state_type</a>());</div><div class="line"><a name="l01605"></a><span class="lineno"> 1605</span>&#160;   <a class="code" href="../../dd/d79/stasis_8h.html#a52b5393bef89d7781c0d039d6489de23">stasis_subscription_set_filter</a>(client-&gt;<a class="code" href="../../df/d42/structast__xmpp__client.html#a422af54ca3d288f34246a66114879f27">mwi_sub</a>, <a class="code" href="../../dd/d79/stasis_8h.html#a3804fa8ec76d77090d5cda80fc4ac891a0e40588366edb9a53e453d47ef26d567">STASIS_SUBSCRIPTION_FILTER_SELECTIVE</a>);</div><div class="line"><a name="l01606"></a><span class="lineno"> 1606</span>&#160;</div><div class="line"><a name="l01607"></a><span class="lineno"> 1607</span>&#160;   <span class="keywordflow">if</span> (!(client-&gt;<a class="code" href="../../df/d42/structast__xmpp__client.html#ace475b3c63f137d8ff9af0e10d4f5e97">device_state_sub</a> = <a class="code" href="../../dd/d79/stasis_8h.html#ae3fe7fe099389094244002113814ec23">stasis_subscribe</a>(<a class="code" href="../../da/da2/devicestate_8h.html#a9fa7376e8e627cf5a512209005692013">ast_device_state_topic_all</a>(), <a class="code" href="../../dc/d6b/res__xmpp_8c.html#a65b4aeae7d602f7aa68d217f0576c033">xmpp_pubsub_devstate_cb</a>, client))) {</div><div class="line"><a name="l01608"></a><span class="lineno"> 1608</span>&#160;      client-&gt;<a class="code" href="../../df/d42/structast__xmpp__client.html#a422af54ca3d288f34246a66114879f27">mwi_sub</a> = <a class="code" href="../../dd/d79/stasis_8h.html#a3498301077e2005383f0d261c471388b">stasis_unsubscribe</a>(client-&gt;<a class="code" href="../../df/d42/structast__xmpp__client.html#a422af54ca3d288f34246a66114879f27">mwi_sub</a>);</div><div class="line"><a name="l01609"></a><span class="lineno"> 1609</span>&#160;      <span class="keywordflow">return</span>;</div><div class="line"><a name="l01610"></a><span class="lineno"> 1610</span>&#160;   }</div><div class="line"><a name="l01611"></a><span class="lineno"> 1611</span>&#160;   <a class="code" href="../../dd/d79/stasis_8h.html#a4f248ee5f4791f05d0af8768aaab282b">stasis_subscription_accept_message_type</a>(client-&gt;<a class="code" href="../../df/d42/structast__xmpp__client.html#ace475b3c63f137d8ff9af0e10d4f5e97">device_state_sub</a>, <a class="code" href="../../da/da2/devicestate_8h.html#a9459272db1c8c968ed1aff1387f0f9fd">ast_device_state_message_type</a>());</div><div class="line"><a name="l01612"></a><span class="lineno"> 1612</span>&#160;   <a class="code" href="../../dd/d79/stasis_8h.html#a52b5393bef89d7781c0d039d6489de23">stasis_subscription_set_filter</a>(client-&gt;<a class="code" href="../../df/d42/structast__xmpp__client.html#ace475b3c63f137d8ff9af0e10d4f5e97">device_state_sub</a>, <a class="code" href="../../dd/d79/stasis_8h.html#a3804fa8ec76d77090d5cda80fc4ac891a0e40588366edb9a53e453d47ef26d567">STASIS_SUBSCRIPTION_FILTER_SELECTIVE</a>);</div><div class="line"><a name="l01613"></a><span class="lineno"> 1613</span>&#160;</div><div class="line"><a name="l01614"></a><span class="lineno"> 1614</span>&#160;   cached = <a class="code" href="../../dd/d79/stasis_8h.html#a8c5612920b22beb93b5e8acbdae40078">stasis_cache_dump</a>(<a class="code" href="../../da/da2/devicestate_8h.html#a52892d3b3fec63dbcf67954d8c3589d5">ast_device_state_cache</a>(), <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div><div class="line"><a name="l01615"></a><span class="lineno"> 1615</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#a47857055118a703ae87ea5ebaf4842ed">ao2_callback</a>(cached, <a class="code" href="../../d5/da5/astobj2_8h.html#ad9d009e87e737af900825b36db55a35ca5fc59b193d86a0a8ddfe866304be829d">OBJ_NODATA</a>, <a class="code" href="../../dc/d6b/res__xmpp_8c.html#aa073dd3fd02ac2d0b962a7b040b0b706">cached_devstate_cb</a>, client);</div><div class="line"><a name="l01616"></a><span class="lineno"> 1616</span>&#160;</div><div class="line"><a name="l01617"></a><span class="lineno"> 1617</span>&#160;   <a class="code" href="../../dc/d6b/res__xmpp_8c.html#a5aea6229c4245877b1461ef047e4208e">xmpp_pubsub_subscribe</a>(client, <span class="stringliteral">&quot;device_state&quot;</span>);</div><div class="line"><a name="l01618"></a><span class="lineno"> 1618</span>&#160;   <a class="code" href="../../dc/d6b/res__xmpp_8c.html#a5aea6229c4245877b1461ef047e4208e">xmpp_pubsub_subscribe</a>(client, <span class="stringliteral">&quot;message_waiting&quot;</span>);</div><div class="line"><a name="l01619"></a><span class="lineno"> 1619</span>&#160;   iks_filter_add_rule(client-&gt;<a class="code" href="../../df/d42/structast__xmpp__client.html#a242fce88f9c9954695b13f7af1d415a9">filter</a>, <a class="code" href="../../dc/d6b/res__xmpp_8c.html#af3eb7b696a9437a0b6ffba5a79f696bd">xmpp_pubsub_handle_event</a>, client, IKS_RULE_TYPE,</div><div class="line"><a name="l01620"></a><span class="lineno"> 1620</span>&#160;             IKS_PAK_MESSAGE, IKS_RULE_FROM, clientcfg-&gt;pubsubnode, IKS_RULE_DONE);</div><div class="line"><a name="l01621"></a><span class="lineno"> 1621</span>&#160;   iks_filter_add_rule(client-&gt;<a class="code" href="../../df/d42/structast__xmpp__client.html#a242fce88f9c9954695b13f7af1d415a9">filter</a>, <a class="code" href="../../dc/d6b/res__xmpp_8c.html#aa6cfea569255dcae7c7f6b900dab4876">xmpp_pubsub_handle_error</a>, client, IKS_RULE_TYPE,</div><div class="line"><a name="l01622"></a><span class="lineno"> 1622</span>&#160;             IKS_PAK_IQ, IKS_RULE_SUBTYPE, IKS_TYPE_ERROR, IKS_RULE_DONE);</div><div class="line"><a name="l01623"></a><span class="lineno"> 1623</span>&#160;</div><div class="line"><a name="l01624"></a><span class="lineno"> 1624</span>&#160;}</div><div class="line"><a name="l01625"></a><span class="lineno"> 1625</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01626"></a><span class="lineno"> 1626</span>&#160;<span class="comment">/*! \brief Internal astobj2 callback function which returns the first resource, which is the highest priority one */</span></div><div class="line"><a name="l01627"></a><span class="lineno"><a class="line" href="../../dc/d6b/res__xmpp_8c.html#a0da763b62c39978974a34ec56044a9db"> 1627</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../dc/d6b/res__xmpp_8c.html#a0da763b62c39978974a34ec56044a9db">xmpp_resource_immediate</a>(<span class="keywordtype">void</span> *obj, <span class="keywordtype">void</span> *arg, <span class="keywordtype">int</span> flags)</div><div class="line"><a name="l01628"></a><span class="lineno"> 1628</span>&#160;{</div><div class="line"><a name="l01629"></a><span class="lineno"> 1629</span>&#160;   <span class="keywordflow">return</span> <a class="code" href="../../d5/da5/astobj2_8h.html#a1f8b41308be4c47de8ff89a3b9c7e7d1a1959468a3c5d6aecd2fa1272d8e30fbf">CMP_MATCH</a> | <a class="code" href="../../d5/da5/astobj2_8h.html#a1f8b41308be4c47de8ff89a3b9c7e7d1a75382dc9117cc118719edf6c3d2b71df">CMP_STOP</a>;</div><div class="line"><a name="l01630"></a><span class="lineno"> 1630</span>&#160;}</div><div class="line"><a name="l01631"></a><span class="lineno"> 1631</span>&#160;</div><div class="line"><a name="l01632"></a><span class="lineno"><a class="line" href="../../dc/d6b/res__xmpp_8c.html#aa622f42343ccc4a9d2e1135019da9905"> 1632</a></span>&#160;<span class="preprocessor">#define BUDDY_OFFLINE 6</span></div><div class="line"><a name="l01633"></a><span class="lineno"><a class="line" href="../../dc/d6b/res__xmpp_8c.html#a45bbfe12870c0702404b51a94b7175ee"> 1633</a></span>&#160;<span class="preprocessor">#define BUDDY_NOT_IN_ROSTER 7</span></div><div class="line"><a name="l01634"></a><span class="lineno"> 1634</span>&#160;</div><div class="line"><a name="l01635"></a><span class="lineno"><a class="line" href="../../dc/d6b/res__xmpp_8c.html#a49915a5613cc77c903e5f8ee0630351b"> 1635</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../dc/d6b/res__xmpp_8c.html#a49915a5613cc77c903e5f8ee0630351b">get_buddy_status</a>(<span class="keyword">struct</span> <a class="code" href="../../da/d00/structast__xmpp__client__config.html">ast_xmpp_client_config</a> *clientcfg, <span class="keywordtype">char</span> *screenname, <span class="keywordtype">char</span> *resource)</div><div class="line"><a name="l01636"></a><span class="lineno"> 1636</span>&#160;{</div><div class="line"><a name="l01637"></a><span class="lineno"> 1637</span>&#160;   <span class="keywordtype">int</span> <a class="code" href="../../de/dcd/app__jack_8c.html#ac191e5810fa65e63095409471eb5648f">status</a> = <a class="code" href="../../dc/d6b/res__xmpp_8c.html#aa622f42343ccc4a9d2e1135019da9905">BUDDY_OFFLINE</a>;</div><div class="line"><a name="l01638"></a><span class="lineno"> 1638</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d6/d90/structast__xmpp__resource.html">ast_xmpp_resource</a> *res;</div><div class="line"><a name="l01639"></a><span class="lineno"> 1639</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d5/d25/structast__xmpp__buddy.html">ast_xmpp_buddy</a> *buddy = <a class="code" href="../../d5/da5/astobj2_8h.html#a911e0703891a9a7aaf73978152092586">ao2_find</a>(clientcfg-&gt;<a class="code" href="../../da/d00/structast__xmpp__client__config.html#a83bf6907a1184b56931bf86ff744279e">client</a>-&gt;<a class="code" href="../../df/d42/structast__xmpp__client.html#a5082987d3e1eac5f625574800bb72c2c">buddies</a>, screenname, <a class="code" href="../../d5/da5/astobj2_8h.html#a22f40c733a085f259af94e864ebaa09a">OBJ_KEY</a>);</div><div class="line"><a name="l01640"></a><span class="lineno"> 1640</span>&#160;</div><div class="line"><a name="l01641"></a><span class="lineno"> 1641</span>&#160;   <span class="keywordflow">if</span> (!buddy) {</div><div class="line"><a name="l01642"></a><span class="lineno"> 1642</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/d6b/res__xmpp_8c.html#a45bbfe12870c0702404b51a94b7175ee">BUDDY_NOT_IN_ROSTER</a>;</div><div class="line"><a name="l01643"></a><span class="lineno"> 1643</span>&#160;   }</div><div class="line"><a name="l01644"></a><span class="lineno"> 1644</span>&#160;</div><div class="line"><a name="l01645"></a><span class="lineno"> 1645</span>&#160;   res = <a class="code" href="../../d5/da5/astobj2_8h.html#a47857055118a703ae87ea5ebaf4842ed">ao2_callback</a>(</div><div class="line"><a name="l01646"></a><span class="lineno"> 1646</span>&#160;      buddy-&gt;<a class="code" href="../../d5/d25/structast__xmpp__buddy.html#ae3222a7c2c3040d71427c9a8b33ac38c">resources</a>,</div><div class="line"><a name="l01647"></a><span class="lineno"> 1647</span>&#160;      0,</div><div class="line"><a name="l01648"></a><span class="lineno"> 1648</span>&#160;      <a class="code" href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a>(resource) ? <a class="code" href="../../dc/d6b/res__xmpp_8c.html#a0da763b62c39978974a34ec56044a9db">xmpp_resource_immediate</a> : <a class="code" href="../../dc/d6b/res__xmpp_8c.html#a32325f89202eb73b55ba2c0402cc1bf1">xmpp_resource_cmp</a>,</div><div class="line"><a name="l01649"></a><span class="lineno"> 1649</span>&#160;      resource);</div><div class="line"><a name="l01650"></a><span class="lineno"> 1650</span>&#160;</div><div class="line"><a name="l01651"></a><span class="lineno"> 1651</span>&#160;   <span class="keywordflow">if</span> (res) {</div><div class="line"><a name="l01652"></a><span class="lineno"> 1652</span>&#160;      status = res-&gt;<a class="code" href="../../d6/d90/structast__xmpp__resource.html#a6e27f49150e9a14580fb313cc2777e00">status</a>;</div><div class="line"><a name="l01653"></a><span class="lineno"> 1653</span>&#160;   }</div><div class="line"><a name="l01654"></a><span class="lineno"> 1654</span>&#160;</div><div class="line"><a name="l01655"></a><span class="lineno"> 1655</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#a6321ee982370c55ab3c24c72c562cbdd">ao2_cleanup</a>(res);</div><div class="line"><a name="l01656"></a><span class="lineno"> 1656</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#a6321ee982370c55ab3c24c72c562cbdd">ao2_cleanup</a>(buddy);</div><div class="line"><a name="l01657"></a><span class="lineno"> 1657</span>&#160;</div><div class="line"><a name="l01658"></a><span class="lineno"> 1658</span>&#160;   <span class="keywordflow">return</span> <a class="code" href="../../de/dcd/app__jack_8c.html#ac191e5810fa65e63095409471eb5648f">status</a>;</div><div class="line"><a name="l01659"></a><span class="lineno"> 1659</span>&#160;}</div><div class="line"><a name="l01660"></a><span class="lineno"> 1660</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01661"></a><span class="lineno"> 1661</span>&#160;<span class="comment">/*!</span></div><div class="line"><a name="l01662"></a><span class="lineno"> 1662</span>&#160;<span class="comment"> * \internal</span></div><div class="line"><a name="l01663"></a><span class="lineno"> 1663</span>&#160;<span class="comment"> * \brief Dial plan funtcion to retrieve the status of a buddy.</span></div><div class="line"><a name="l01664"></a><span class="lineno"> 1664</span>&#160;<span class="comment"> * \param channel The associated ast_channel, if there is one</span></div><div class="line"><a name="l01665"></a><span class="lineno"> 1665</span>&#160;<span class="comment"> * \param data The account, buddy JID, and optional timeout</span></div><div class="line"><a name="l01666"></a><span class="lineno"> 1666</span>&#160;<span class="comment"> * timeout.</span></div><div class="line"><a name="l01667"></a><span class="lineno"> 1667</span>&#160;<span class="comment"> * \retval 0 success</span></div><div class="line"><a name="l01668"></a><span class="lineno"> 1668</span>&#160;<span class="comment"> * \retval -1 failure</span></div><div class="line"><a name="l01669"></a><span class="lineno"> 1669</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l01670"></a><span class="lineno"><a class="line" href="../../dc/d6b/res__xmpp_8c.html#ac5044645216f6146c0bed265a2f8367c"> 1670</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../dc/d6b/res__xmpp_8c.html#ac5044645216f6146c0bed265a2f8367c">acf_jabberstatus_read</a>(<span class="keyword">struct</span> <a class="code" href="../../df/d3c/structast__channel.html">ast_channel</a> *chan, <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="../../d0/d29/cdr__mysql_8c.html#a0980a105ccb863d8008eb6201a51da52">name</a>, <span class="keywordtype">char</span> *data, <span class="keywordtype">char</span> *<a class="code" href="../../dd/d7c/eagi__proxy_8c.html#ac95651d79c608a3148973b5b1fc9e525">buf</a>, <span class="keywordtype">size_t</span> buflen)</div><div class="line"><a name="l01671"></a><span class="lineno"> 1671</span>&#160;{</div><div class="line"><a name="l01672"></a><span class="lineno"> 1672</span>&#160;   <a class="code" href="../../d5/d60/utils_8h.html#a1604b4d72144dd3d9f7da668e90337e9">RAII_VAR</a>(<span class="keyword">struct</span> <a class="code" href="../../de/d1c/structxmpp__config.html">xmpp_config</a> *, cfg, <a class="code" href="../../d5/da5/astobj2_8h.html#a86d8d6c3c8866ed0a60121da055cd225">ao2_global_obj_ref</a>(<a class="code" href="../../d3/d4e/chan__console_8c.html#aa36e3e2c486b920b166c2d17c5242221">globals</a>), <a class="code" href="../../d5/da5/astobj2_8h.html#a6321ee982370c55ab3c24c72c562cbdd">ao2_cleanup</a>);</div><div class="line"><a name="l01673"></a><span class="lineno"> 1673</span>&#160;   <a class="code" href="../../d5/d60/utils_8h.html#a1604b4d72144dd3d9f7da668e90337e9">RAII_VAR</a>(<span class="keyword">struct</span> <a class="code" href="../../da/d00/structast__xmpp__client__config.html">ast_xmpp_client_config</a> *, clientcfg, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../d5/da5/astobj2_8h.html#a6321ee982370c55ab3c24c72c562cbdd">ao2_cleanup</a>);</div><div class="line"><a name="l01674"></a><span class="lineno"> 1674</span>&#160;   <a class="code" href="../../d3/d93/include_2asterisk_2app_8h.html#a80cd3f6f786b59b742bcecfc0b3be7c2">AST_DECLARE_APP_ARGS</a>(<a class="code" href="../../d5/dde/test__func__file_8c.html#a7df83d295429a2562396f1ec127a46c0">args</a>,</div><div class="line"><a name="l01675"></a><span class="lineno"> 1675</span>&#160;              <a class="code" href="../../d3/d93/include_2asterisk_2app_8h.html#a037e9a5b28477b17e7c9acbe7ecb21d5">AST_APP_ARG</a>(sender);</div><div class="line"><a name="l01676"></a><span class="lineno"> 1676</span>&#160;              <a class="code" href="../../d3/d93/include_2asterisk_2app_8h.html#a037e9a5b28477b17e7c9acbe7ecb21d5">AST_APP_ARG</a>(jid);</div><div class="line"><a name="l01677"></a><span class="lineno"> 1677</span>&#160;      );</div><div class="line"><a name="l01678"></a><span class="lineno"> 1678</span>&#160;   <a class="code" href="../../d3/d93/include_2asterisk_2app_8h.html#a80cd3f6f786b59b742bcecfc0b3be7c2">AST_DECLARE_APP_ARGS</a>(jid,</div><div class="line"><a name="l01679"></a><span class="lineno"> 1679</span>&#160;              <a class="code" href="../../d3/d93/include_2asterisk_2app_8h.html#a037e9a5b28477b17e7c9acbe7ecb21d5">AST_APP_ARG</a>(screenname);</div><div class="line"><a name="l01680"></a><span class="lineno"> 1680</span>&#160;              <a class="code" href="../../d3/d93/include_2asterisk_2app_8h.html#a037e9a5b28477b17e7c9acbe7ecb21d5">AST_APP_ARG</a>(resource);</div><div class="line"><a name="l01681"></a><span class="lineno"> 1681</span>&#160;      );</div><div class="line"><a name="l01682"></a><span class="lineno"> 1682</span>&#160;</div><div class="line"><a name="l01683"></a><span class="lineno"> 1683</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a>(data)) {</div><div class="line"><a name="l01684"></a><span class="lineno"> 1684</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Usage: JABBER_STATUS(&lt;sender&gt;,&lt;jid&gt;[/&lt;resource&gt;])\n&quot;</span>);</div><div class="line"><a name="l01685"></a><span class="lineno"> 1685</span>&#160;      <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l01686"></a><span class="lineno"> 1686</span>&#160;   }</div><div class="line"><a name="l01687"></a><span class="lineno"> 1687</span>&#160;   <a class="code" href="../../d3/d93/include_2asterisk_2app_8h.html#ac08f7eb1eb9476b30987c73e1052ada8">AST_STANDARD_APP_ARGS</a>(<a class="code" href="../../d5/dde/test__func__file_8c.html#a7df83d295429a2562396f1ec127a46c0">args</a>, data);</div><div class="line"><a name="l01688"></a><span class="lineno"> 1688</span>&#160;</div><div class="line"><a name="l01689"></a><span class="lineno"> 1689</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d5/dde/test__func__file_8c.html#a7df83d295429a2562396f1ec127a46c0">args</a>.argc != 2) {</div><div class="line"><a name="l01690"></a><span class="lineno"> 1690</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;JABBER_STATUS requires 2 arguments: sender and jid.\n&quot;</span>);</div><div class="line"><a name="l01691"></a><span class="lineno"> 1691</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l01692"></a><span class="lineno"> 1692</span>&#160;   }</div><div class="line"><a name="l01693"></a><span class="lineno"> 1693</span>&#160;</div><div class="line"><a name="l01694"></a><span class="lineno"> 1694</span>&#160;   <a class="code" href="../../d3/d93/include_2asterisk_2app_8h.html#accfcb380df76a64251d88ef49c2dd4e3">AST_NONSTANDARD_APP_ARGS</a>(jid, <a class="code" href="../../d5/dde/test__func__file_8c.html#a7df83d295429a2562396f1ec127a46c0">args</a>.jid, <span class="charliteral">&#39;/&#39;</span>);</div><div class="line"><a name="l01695"></a><span class="lineno"> 1695</span>&#160;   <span class="keywordflow">if</span> (jid.argc &lt; 1 || jid.argc &gt; 2) {</div><div class="line"><a name="l01696"></a><span class="lineno"> 1696</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Wrong JID %s, exiting\n&quot;</span>, <a class="code" href="../../d5/dde/test__func__file_8c.html#a7df83d295429a2562396f1ec127a46c0">args</a>.jid);</div><div class="line"><a name="l01697"></a><span class="lineno"> 1697</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l01698"></a><span class="lineno"> 1698</span>&#160;   }</div><div class="line"><a name="l01699"></a><span class="lineno"> 1699</span>&#160;</div><div class="line"><a name="l01700"></a><span class="lineno"> 1700</span>&#160;   <span class="keywordflow">if</span> (!cfg || !cfg-&gt;clients || !(clientcfg = <a class="code" href="../../dc/d6b/res__xmpp_8c.html#a14d10033fb3b97f06238940259f45266">xmpp_config_find</a>(cfg-&gt;clients, <a class="code" href="../../d5/dde/test__func__file_8c.html#a7df83d295429a2562396f1ec127a46c0">args</a>.sender))) {</div><div class="line"><a name="l01701"></a><span class="lineno"> 1701</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Could not find sender connection: &#39;%s&#39;\n&quot;</span>, <a class="code" href="../../d5/dde/test__func__file_8c.html#a7df83d295429a2562396f1ec127a46c0">args</a>.sender);</div><div class="line"><a name="l01702"></a><span class="lineno"> 1702</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l01703"></a><span class="lineno"> 1703</span>&#160;   }</div><div class="line"><a name="l01704"></a><span class="lineno"> 1704</span>&#160;</div><div class="line"><a name="l01705"></a><span class="lineno"> 1705</span>&#160;   snprintf(buf, buflen, <span class="stringliteral">&quot;%d&quot;</span>, <a class="code" href="../../dc/d6b/res__xmpp_8c.html#a49915a5613cc77c903e5f8ee0630351b">get_buddy_status</a>(clientcfg, jid.screenname, jid.resource));</div><div class="line"><a name="l01706"></a><span class="lineno"> 1706</span>&#160;</div><div class="line"><a name="l01707"></a><span class="lineno"> 1707</span>&#160;   <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l01708"></a><span class="lineno"> 1708</span>&#160;}</div><div class="line"><a name="l01709"></a><span class="lineno"> 1709</span>&#160;</div><div class="line"><a name="l01710"></a><span class="lineno"><a class="line" href="../../dc/d6b/res__xmpp_8c.html#a12ea81a7f47eca38c7c4ac9a07bddd40"> 1710</a></span>&#160;<span class="keyword">static</span> <span class="keyword">struct </span><a class="code" href="../../db/dc0/structast__custom__function.html">ast_custom_function</a> <a class="code" href="../../dc/d6b/res__xmpp_8c.html#a12ea81a7f47eca38c7c4ac9a07bddd40">jabberstatus_function</a> = {</div><div class="line"><a name="l01711"></a><span class="lineno"> 1711</span>&#160;   .<a class="code" href="../../db/dc0/structast__custom__function.html#afcd1706c9144e6d6eee6127661ae3be2">name</a> = <span class="stringliteral">&quot;JABBER_STATUS&quot;</span>,</div><div class="line"><a name="l01712"></a><span class="lineno"> 1712</span>&#160;   .read = <a class="code" href="../../dc/d6b/res__xmpp_8c.html#ac5044645216f6146c0bed265a2f8367c">acf_jabberstatus_read</a>,</div><div class="line"><a name="l01713"></a><span class="lineno"> 1713</span>&#160;};</div><div class="line"><a name="l01714"></a><span class="lineno"> 1714</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01715"></a><span class="lineno"> 1715</span>&#160;<span class="comment">/*!</span></div><div class="line"><a name="l01716"></a><span class="lineno"> 1716</span>&#160;<span class="comment"> * \brief Application to join a chat room</span></div><div class="line"><a name="l01717"></a><span class="lineno"> 1717</span>&#160;<span class="comment"> * \param chan ast_channel</span></div><div class="line"><a name="l01718"></a><span class="lineno"> 1718</span>&#160;<span class="comment"> * \param data  Data is sender|jid|nickname.</span></div><div class="line"><a name="l01719"></a><span class="lineno"> 1719</span>&#160;<span class="comment"> * \retval 0 success</span></div><div class="line"><a name="l01720"></a><span class="lineno"> 1720</span>&#160;<span class="comment"> * \retval -1 error</span></div><div class="line"><a name="l01721"></a><span class="lineno"> 1721</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l01722"></a><span class="lineno"><a class="line" href="../../dc/d6b/res__xmpp_8c.html#a4d9c4b11143ef37e2b1608c75680b1a7"> 1722</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../dc/d6b/res__xmpp_8c.html#a4d9c4b11143ef37e2b1608c75680b1a7">xmpp_join_exec</a>(<span class="keyword">struct</span> <a class="code" href="../../df/d3c/structast__channel.html">ast_channel</a> *chan, <span class="keyword">const</span> <span class="keywordtype">char</span> *data)</div><div class="line"><a name="l01723"></a><span class="lineno"> 1723</span>&#160;{</div><div class="line"><a name="l01724"></a><span class="lineno"> 1724</span>&#160;   <a class="code" href="../../d5/d60/utils_8h.html#a1604b4d72144dd3d9f7da668e90337e9">RAII_VAR</a>(<span class="keyword">struct</span> <a class="code" href="../../de/d1c/structxmpp__config.html">xmpp_config</a> *, cfg, <a class="code" href="../../d5/da5/astobj2_8h.html#a86d8d6c3c8866ed0a60121da055cd225">ao2_global_obj_ref</a>(<a class="code" href="../../d3/d4e/chan__console_8c.html#aa36e3e2c486b920b166c2d17c5242221">globals</a>), <a class="code" href="../../d5/da5/astobj2_8h.html#a6321ee982370c55ab3c24c72c562cbdd">ao2_cleanup</a>);</div><div class="line"><a name="l01725"></a><span class="lineno"> 1725</span>&#160;   <a class="code" href="../../d5/d60/utils_8h.html#a1604b4d72144dd3d9f7da668e90337e9">RAII_VAR</a>(<span class="keyword">struct</span> <a class="code" href="../../da/d00/structast__xmpp__client__config.html">ast_xmpp_client_config</a> *, clientcfg, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../d5/da5/astobj2_8h.html#a6321ee982370c55ab3c24c72c562cbdd">ao2_cleanup</a>);</div><div class="line"><a name="l01726"></a><span class="lineno"> 1726</span>&#160;   <span class="keywordtype">char</span> *s, nick[<a class="code" href="../../da/da0/xmpp_8h.html#a4ac42d40c03218246d548fbb3fc06e59">XMPP_MAX_RESJIDLEN</a>];</div><div class="line"><a name="l01727"></a><span class="lineno"> 1727</span>&#160;   <a class="code" href="../../d3/d93/include_2asterisk_2app_8h.html#a80cd3f6f786b59b742bcecfc0b3be7c2">AST_DECLARE_APP_ARGS</a>(<a class="code" href="../../d5/dde/test__func__file_8c.html#a7df83d295429a2562396f1ec127a46c0">args</a>,</div><div class="line"><a name="l01728"></a><span class="lineno"> 1728</span>&#160;              <a class="code" href="../../d3/d93/include_2asterisk_2app_8h.html#a037e9a5b28477b17e7c9acbe7ecb21d5">AST_APP_ARG</a>(sender);</div><div class="line"><a name="l01729"></a><span class="lineno"> 1729</span>&#160;              <a class="code" href="../../d3/d93/include_2asterisk_2app_8h.html#a037e9a5b28477b17e7c9acbe7ecb21d5">AST_APP_ARG</a>(jid);</div><div class="line"><a name="l01730"></a><span class="lineno"> 1730</span>&#160;              <a class="code" href="../../d3/d93/include_2asterisk_2app_8h.html#a037e9a5b28477b17e7c9acbe7ecb21d5">AST_APP_ARG</a>(nick);</div><div class="line"><a name="l01731"></a><span class="lineno"> 1731</span>&#160;      );</div><div class="line"><a name="l01732"></a><span class="lineno"> 1732</span>&#160;</div><div class="line"><a name="l01733"></a><span class="lineno"> 1733</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a>(data)) {</div><div class="line"><a name="l01734"></a><span class="lineno"> 1734</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;%s requires arguments (sender,jid[,nickname])\n&quot;</span>, app_ajijoin);</div><div class="line"><a name="l01735"></a><span class="lineno"> 1735</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l01736"></a><span class="lineno"> 1736</span>&#160;   }</div><div class="line"><a name="l01737"></a><span class="lineno"> 1737</span>&#160;   s = <a class="code" href="../../d8/d8a/astmm_8h.html#ab5f0750cc80ba337fdcbddea2d3a1ee6">ast_strdupa</a>(data);</div><div class="line"><a name="l01738"></a><span class="lineno"> 1738</span>&#160;</div><div class="line"><a name="l01739"></a><span class="lineno"> 1739</span>&#160;   <a class="code" href="../../d3/d93/include_2asterisk_2app_8h.html#ac08f7eb1eb9476b30987c73e1052ada8">AST_STANDARD_APP_ARGS</a>(<a class="code" href="../../d5/dde/test__func__file_8c.html#a7df83d295429a2562396f1ec127a46c0">args</a>, s);</div><div class="line"><a name="l01740"></a><span class="lineno"> 1740</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d5/dde/test__func__file_8c.html#a7df83d295429a2562396f1ec127a46c0">args</a>.argc &lt; 2 || <a class="code" href="../../d5/dde/test__func__file_8c.html#a7df83d295429a2562396f1ec127a46c0">args</a>.argc &gt; 3) {</div><div class="line"><a name="l01741"></a><span class="lineno"> 1741</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;%s requires arguments (sender,jid[,nickname])\n&quot;</span>, app_ajijoin);</div><div class="line"><a name="l01742"></a><span class="lineno"> 1742</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l01743"></a><span class="lineno"> 1743</span>&#160;   }</div><div class="line"><a name="l01744"></a><span class="lineno"> 1744</span>&#160;</div><div class="line"><a name="l01745"></a><span class="lineno"> 1745</span>&#160;   <span class="keywordflow">if</span> (strchr(<a class="code" href="../../d5/dde/test__func__file_8c.html#a7df83d295429a2562396f1ec127a46c0">args</a>.jid, <span class="charliteral">&#39;/&#39;</span>)) {</div><div class="line"><a name="l01746"></a><span class="lineno"> 1746</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Invalid room name : resource must not be appended\n&quot;</span>);</div><div class="line"><a name="l01747"></a><span class="lineno"> 1747</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l01748"></a><span class="lineno"> 1748</span>&#160;   }</div><div class="line"><a name="l01749"></a><span class="lineno"> 1749</span>&#160;</div><div class="line"><a name="l01750"></a><span class="lineno"> 1750</span>&#160;   <span class="keywordflow">if</span> (!cfg || !cfg-&gt;clients || !(clientcfg = <a class="code" href="../../dc/d6b/res__xmpp_8c.html#a14d10033fb3b97f06238940259f45266">xmpp_config_find</a>(cfg-&gt;clients, <a class="code" href="../../d5/dde/test__func__file_8c.html#a7df83d295429a2562396f1ec127a46c0">args</a>.sender))) {</div><div class="line"><a name="l01751"></a><span class="lineno"> 1751</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Could not find sender connection: &#39;%s&#39;\n&quot;</span>, <a class="code" href="../../d5/dde/test__func__file_8c.html#a7df83d295429a2562396f1ec127a46c0">args</a>.sender);</div><div class="line"><a name="l01752"></a><span class="lineno"> 1752</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l01753"></a><span class="lineno"> 1753</span>&#160;   }</div><div class="line"><a name="l01754"></a><span class="lineno"> 1754</span>&#160;</div><div class="line"><a name="l01755"></a><span class="lineno"> 1755</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a>(<a class="code" href="../../d5/dde/test__func__file_8c.html#a7df83d295429a2562396f1ec127a46c0">args</a>.nick)) {</div><div class="line"><a name="l01756"></a><span class="lineno"> 1756</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="../../d5/d60/utils_8h.html#a00d4c9254c9827d6fa44f17a326744a5">ast_test_flag</a>(&amp;clientcfg-&gt;flags, <a class="code" href="../../dc/d6b/res__xmpp_8c.html#aa3759d2ddcc12f3f5ef5a8a3ffa4a4dfadc3efad94dcc216c29d42b23edcb2d00">XMPP_COMPONENT</a>)) {</div><div class="line"><a name="l01757"></a><span class="lineno"> 1757</span>&#160;         snprintf(nick, <span class="keyword">sizeof</span>(nick), <span class="stringliteral">&quot;asterisk&quot;</span>);</div><div class="line"><a name="l01758"></a><span class="lineno"> 1758</span>&#160;      } <span class="keywordflow">else</span> {</div><div class="line"><a name="l01759"></a><span class="lineno"> 1759</span>&#160;         snprintf(nick, <span class="keyword">sizeof</span>(nick), <span class="stringliteral">&quot;%s&quot;</span>, clientcfg-&gt;client-&gt;jid-&gt;user);</div><div class="line"><a name="l01760"></a><span class="lineno"> 1760</span>&#160;      }</div><div class="line"><a name="l01761"></a><span class="lineno"> 1761</span>&#160;   } <span class="keywordflow">else</span> {</div><div class="line"><a name="l01762"></a><span class="lineno"> 1762</span>&#160;      snprintf(nick, <span class="keyword">sizeof</span>(nick), <span class="stringliteral">&quot;%s&quot;</span>, <a class="code" href="../../d5/dde/test__func__file_8c.html#a7df83d295429a2562396f1ec127a46c0">args</a>.nick);</div><div class="line"><a name="l01763"></a><span class="lineno"> 1763</span>&#160;   }</div><div class="line"><a name="l01764"></a><span class="lineno"> 1764</span>&#160;</div><div class="line"><a name="l01765"></a><span class="lineno"> 1765</span>&#160;   <span class="keywordflow">if</span> (!<a class="code" href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a>(<a class="code" href="../../d5/dde/test__func__file_8c.html#a7df83d295429a2562396f1ec127a46c0">args</a>.jid) &amp;&amp; strchr(<a class="code" href="../../d5/dde/test__func__file_8c.html#a7df83d295429a2562396f1ec127a46c0">args</a>.jid, <span class="charliteral">&#39;@&#39;</span>)) {</div><div class="line"><a name="l01766"></a><span class="lineno"> 1766</span>&#160;      <a class="code" href="../../dc/d6b/res__xmpp_8c.html#adc271ee017945747c052865b5b6d94a8">ast_xmpp_chatroom_join</a>(clientcfg-&gt;client, <a class="code" href="../../d5/dde/test__func__file_8c.html#a7df83d295429a2562396f1ec127a46c0">args</a>.jid, nick);</div><div class="line"><a name="l01767"></a><span class="lineno"> 1767</span>&#160;   } <span class="keywordflow">else</span> {</div><div class="line"><a name="l01768"></a><span class="lineno"> 1768</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Problem with specified jid of &#39;%s&#39;\n&quot;</span>, <a class="code" href="../../d5/dde/test__func__file_8c.html#a7df83d295429a2562396f1ec127a46c0">args</a>.jid);</div><div class="line"><a name="l01769"></a><span class="lineno"> 1769</span>&#160;   }</div><div class="line"><a name="l01770"></a><span class="lineno"> 1770</span>&#160;</div><div class="line"><a name="l01771"></a><span class="lineno"> 1771</span>&#160;   <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l01772"></a><span class="lineno"> 1772</span>&#160;}</div><div class="line"><a name="l01773"></a><span class="lineno"> 1773</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01774"></a><span class="lineno"> 1774</span>&#160;<span class="comment">/*!</span></div><div class="line"><a name="l01775"></a><span class="lineno"> 1775</span>&#160;<span class="comment"> * \brief Application to leave a chat room</span></div><div class="line"><a name="l01776"></a><span class="lineno"> 1776</span>&#160;<span class="comment"> * \param chan ast_channel</span></div><div class="line"><a name="l01777"></a><span class="lineno"> 1777</span>&#160;<span class="comment"> * \param data  Data is sender|jid|nickname.</span></div><div class="line"><a name="l01778"></a><span class="lineno"> 1778</span>&#160;<span class="comment"> * \retval 0 success</span></div><div class="line"><a name="l01779"></a><span class="lineno"> 1779</span>&#160;<span class="comment"> * \retval -1 error</span></div><div class="line"><a name="l01780"></a><span class="lineno"> 1780</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l01781"></a><span class="lineno"><a class="line" href="../../dc/d6b/res__xmpp_8c.html#aec97d98f13445cd1a95c1deed32489be"> 1781</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../dc/d6b/res__xmpp_8c.html#aec97d98f13445cd1a95c1deed32489be">xmpp_leave_exec</a>(<span class="keyword">struct</span> <a class="code" href="../../df/d3c/structast__channel.html">ast_channel</a> *chan, <span class="keyword">const</span> <span class="keywordtype">char</span> *data)</div><div class="line"><a name="l01782"></a><span class="lineno"> 1782</span>&#160;{</div><div class="line"><a name="l01783"></a><span class="lineno"> 1783</span>&#160;   <a class="code" href="../../d5/d60/utils_8h.html#a1604b4d72144dd3d9f7da668e90337e9">RAII_VAR</a>(<span class="keyword">struct</span> <a class="code" href="../../de/d1c/structxmpp__config.html">xmpp_config</a> *, cfg, <a class="code" href="../../d5/da5/astobj2_8h.html#a86d8d6c3c8866ed0a60121da055cd225">ao2_global_obj_ref</a>(<a class="code" href="../../d3/d4e/chan__console_8c.html#aa36e3e2c486b920b166c2d17c5242221">globals</a>), <a class="code" href="../../d5/da5/astobj2_8h.html#a6321ee982370c55ab3c24c72c562cbdd">ao2_cleanup</a>);</div><div class="line"><a name="l01784"></a><span class="lineno"> 1784</span>&#160;   <a class="code" href="../../d5/d60/utils_8h.html#a1604b4d72144dd3d9f7da668e90337e9">RAII_VAR</a>(<span class="keyword">struct</span> <a class="code" href="../../da/d00/structast__xmpp__client__config.html">ast_xmpp_client_config</a> *, clientcfg, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../d5/da5/astobj2_8h.html#a6321ee982370c55ab3c24c72c562cbdd">ao2_cleanup</a>);</div><div class="line"><a name="l01785"></a><span class="lineno"> 1785</span>&#160;   <span class="keywordtype">char</span> *s, nick[<a class="code" href="../../da/da0/xmpp_8h.html#a4ac42d40c03218246d548fbb3fc06e59">XMPP_MAX_RESJIDLEN</a>];</div><div class="line"><a name="l01786"></a><span class="lineno"> 1786</span>&#160;   <a class="code" href="../../d3/d93/include_2asterisk_2app_8h.html#a80cd3f6f786b59b742bcecfc0b3be7c2">AST_DECLARE_APP_ARGS</a>(<a class="code" href="../../d5/dde/test__func__file_8c.html#a7df83d295429a2562396f1ec127a46c0">args</a>,</div><div class="line"><a name="l01787"></a><span class="lineno"> 1787</span>&#160;              <a class="code" href="../../d3/d93/include_2asterisk_2app_8h.html#a037e9a5b28477b17e7c9acbe7ecb21d5">AST_APP_ARG</a>(sender);</div><div class="line"><a name="l01788"></a><span class="lineno"> 1788</span>&#160;              <a class="code" href="../../d3/d93/include_2asterisk_2app_8h.html#a037e9a5b28477b17e7c9acbe7ecb21d5">AST_APP_ARG</a>(jid);</div><div class="line"><a name="l01789"></a><span class="lineno"> 1789</span>&#160;              <a class="code" href="../../d3/d93/include_2asterisk_2app_8h.html#a037e9a5b28477b17e7c9acbe7ecb21d5">AST_APP_ARG</a>(nick);</div><div class="line"><a name="l01790"></a><span class="lineno"> 1790</span>&#160;      );</div><div class="line"><a name="l01791"></a><span class="lineno"> 1791</span>&#160;</div><div class="line"><a name="l01792"></a><span class="lineno"> 1792</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a>(data)) {</div><div class="line"><a name="l01793"></a><span class="lineno"> 1793</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;%s requires arguments (sender,jid[,nickname])\n&quot;</span>, app_ajileave);</div><div class="line"><a name="l01794"></a><span class="lineno"> 1794</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l01795"></a><span class="lineno"> 1795</span>&#160;   }</div><div class="line"><a name="l01796"></a><span class="lineno"> 1796</span>&#160;   s = <a class="code" href="../../d8/d8a/astmm_8h.html#ab5f0750cc80ba337fdcbddea2d3a1ee6">ast_strdupa</a>(data);</div><div class="line"><a name="l01797"></a><span class="lineno"> 1797</span>&#160;</div><div class="line"><a name="l01798"></a><span class="lineno"> 1798</span>&#160;   <a class="code" href="../../d3/d93/include_2asterisk_2app_8h.html#ac08f7eb1eb9476b30987c73e1052ada8">AST_STANDARD_APP_ARGS</a>(<a class="code" href="../../d5/dde/test__func__file_8c.html#a7df83d295429a2562396f1ec127a46c0">args</a>, s);</div><div class="line"><a name="l01799"></a><span class="lineno"> 1799</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d5/dde/test__func__file_8c.html#a7df83d295429a2562396f1ec127a46c0">args</a>.argc &lt; 2 || <a class="code" href="../../d5/dde/test__func__file_8c.html#a7df83d295429a2562396f1ec127a46c0">args</a>.argc &gt; 3) {</div><div class="line"><a name="l01800"></a><span class="lineno"> 1800</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;%s requires arguments (sender,jid[,nickname])\n&quot;</span>, app_ajileave);</div><div class="line"><a name="l01801"></a><span class="lineno"> 1801</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l01802"></a><span class="lineno"> 1802</span>&#160;   }</div><div class="line"><a name="l01803"></a><span class="lineno"> 1803</span>&#160;</div><div class="line"><a name="l01804"></a><span class="lineno"> 1804</span>&#160;   <span class="keywordflow">if</span> (strchr(<a class="code" href="../../d5/dde/test__func__file_8c.html#a7df83d295429a2562396f1ec127a46c0">args</a>.jid, <span class="charliteral">&#39;/&#39;</span>)) {</div><div class="line"><a name="l01805"></a><span class="lineno"> 1805</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Invalid room name, resource must not be appended\n&quot;</span>);</div><div class="line"><a name="l01806"></a><span class="lineno"> 1806</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l01807"></a><span class="lineno"> 1807</span>&#160;   }</div><div class="line"><a name="l01808"></a><span class="lineno"> 1808</span>&#160;</div><div class="line"><a name="l01809"></a><span class="lineno"> 1809</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a>(<a class="code" href="../../d5/dde/test__func__file_8c.html#a7df83d295429a2562396f1ec127a46c0">args</a>.jid) || !strchr(<a class="code" href="../../d5/dde/test__func__file_8c.html#a7df83d295429a2562396f1ec127a46c0">args</a>.jid, <span class="charliteral">&#39;@&#39;</span>)) {</div><div class="line"><a name="l01810"></a><span class="lineno"> 1810</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;No jabber ID specified\n&quot;</span>);</div><div class="line"><a name="l01811"></a><span class="lineno"> 1811</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l01812"></a><span class="lineno"> 1812</span>&#160;   }</div><div class="line"><a name="l01813"></a><span class="lineno"> 1813</span>&#160;</div><div class="line"><a name="l01814"></a><span class="lineno"> 1814</span>&#160;   <span class="keywordflow">if</span> (!cfg || !cfg-&gt;clients || !(clientcfg = <a class="code" href="../../dc/d6b/res__xmpp_8c.html#a14d10033fb3b97f06238940259f45266">xmpp_config_find</a>(cfg-&gt;clients, <a class="code" href="../../d5/dde/test__func__file_8c.html#a7df83d295429a2562396f1ec127a46c0">args</a>.sender))) {</div><div class="line"><a name="l01815"></a><span class="lineno"> 1815</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Could not find sender connection: &#39;%s&#39;\n&quot;</span>, <a class="code" href="../../d5/dde/test__func__file_8c.html#a7df83d295429a2562396f1ec127a46c0">args</a>.sender);</div><div class="line"><a name="l01816"></a><span class="lineno"> 1816</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l01817"></a><span class="lineno"> 1817</span>&#160;   }</div><div class="line"><a name="l01818"></a><span class="lineno"> 1818</span>&#160;</div><div class="line"><a name="l01819"></a><span class="lineno"> 1819</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a>(<a class="code" href="../../d5/dde/test__func__file_8c.html#a7df83d295429a2562396f1ec127a46c0">args</a>.nick)) {</div><div class="line"><a name="l01820"></a><span class="lineno"> 1820</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="../../d5/d60/utils_8h.html#a00d4c9254c9827d6fa44f17a326744a5">ast_test_flag</a>(&amp;clientcfg-&gt;flags, <a class="code" href="../../dc/d6b/res__xmpp_8c.html#aa3759d2ddcc12f3f5ef5a8a3ffa4a4dfadc3efad94dcc216c29d42b23edcb2d00">XMPP_COMPONENT</a>)) {</div><div class="line"><a name="l01821"></a><span class="lineno"> 1821</span>&#160;         snprintf(nick, <span class="keyword">sizeof</span>(nick), <span class="stringliteral">&quot;asterisk&quot;</span>);</div><div class="line"><a name="l01822"></a><span class="lineno"> 1822</span>&#160;      } <span class="keywordflow">else</span> {</div><div class="line"><a name="l01823"></a><span class="lineno"> 1823</span>&#160;         snprintf(nick, <span class="keyword">sizeof</span>(nick), <span class="stringliteral">&quot;%s&quot;</span>, clientcfg-&gt;client-&gt;jid-&gt;user);</div><div class="line"><a name="l01824"></a><span class="lineno"> 1824</span>&#160;      }</div><div class="line"><a name="l01825"></a><span class="lineno"> 1825</span>&#160;   } <span class="keywordflow">else</span> {</div><div class="line"><a name="l01826"></a><span class="lineno"> 1826</span>&#160;      snprintf(nick, <span class="keyword">sizeof</span>(nick), <span class="stringliteral">&quot;%s&quot;</span>, <a class="code" href="../../d5/dde/test__func__file_8c.html#a7df83d295429a2562396f1ec127a46c0">args</a>.nick);</div><div class="line"><a name="l01827"></a><span class="lineno"> 1827</span>&#160;   }</div><div class="line"><a name="l01828"></a><span class="lineno"> 1828</span>&#160;</div><div class="line"><a name="l01829"></a><span class="lineno"> 1829</span>&#160;   <a class="code" href="../../dc/d6b/res__xmpp_8c.html#a5c2497ea229bcf66b0c800d5d0e69680">ast_xmpp_chatroom_leave</a>(clientcfg-&gt;client, <a class="code" href="../../d5/dde/test__func__file_8c.html#a7df83d295429a2562396f1ec127a46c0">args</a>.jid, nick);</div><div class="line"><a name="l01830"></a><span class="lineno"> 1830</span>&#160;</div><div class="line"><a name="l01831"></a><span class="lineno"> 1831</span>&#160;   <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l01832"></a><span class="lineno"> 1832</span>&#160;}</div><div class="line"><a name="l01833"></a><span class="lineno"> 1833</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01834"></a><span class="lineno"> 1834</span>&#160;<span class="comment">/*!</span></div><div class="line"><a name="l01835"></a><span class="lineno"> 1835</span>&#160;<span class="comment"> * \internal</span></div><div class="line"><a name="l01836"></a><span class="lineno"> 1836</span>&#160;<span class="comment"> * \brief Dial plan function to send a message.</span></div><div class="line"><a name="l01837"></a><span class="lineno"> 1837</span>&#160;<span class="comment"> * \param chan ast_channel</span></div><div class="line"><a name="l01838"></a><span class="lineno"> 1838</span>&#160;<span class="comment"> * \param data  Data is account,jid,message.</span></div><div class="line"><a name="l01839"></a><span class="lineno"> 1839</span>&#160;<span class="comment"> * \retval 0 success</span></div><div class="line"><a name="l01840"></a><span class="lineno"> 1840</span>&#160;<span class="comment"> * \retval -1 failure</span></div><div class="line"><a name="l01841"></a><span class="lineno"> 1841</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l01842"></a><span class="lineno"><a class="line" href="../../dc/d6b/res__xmpp_8c.html#a0e0cd41a2d8096259189d003db0238d7"> 1842</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../dc/d6b/res__xmpp_8c.html#a0e0cd41a2d8096259189d003db0238d7">xmpp_send_exec</a>(<span class="keyword">struct</span> <a class="code" href="../../df/d3c/structast__channel.html">ast_channel</a> *chan, <span class="keyword">const</span> <span class="keywordtype">char</span> *data)</div><div class="line"><a name="l01843"></a><span class="lineno"> 1843</span>&#160;{</div><div class="line"><a name="l01844"></a><span class="lineno"> 1844</span>&#160;   <a class="code" href="../../d5/d60/utils_8h.html#a1604b4d72144dd3d9f7da668e90337e9">RAII_VAR</a>(<span class="keyword">struct</span> <a class="code" href="../../de/d1c/structxmpp__config.html">xmpp_config</a> *, cfg, <a class="code" href="../../d5/da5/astobj2_8h.html#a86d8d6c3c8866ed0a60121da055cd225">ao2_global_obj_ref</a>(<a class="code" href="../../d3/d4e/chan__console_8c.html#aa36e3e2c486b920b166c2d17c5242221">globals</a>), <a class="code" href="../../d5/da5/astobj2_8h.html#a6321ee982370c55ab3c24c72c562cbdd">ao2_cleanup</a>);</div><div class="line"><a name="l01845"></a><span class="lineno"> 1845</span>&#160;   <a class="code" href="../../d5/d60/utils_8h.html#a1604b4d72144dd3d9f7da668e90337e9">RAII_VAR</a>(<span class="keyword">struct</span> <a class="code" href="../../da/d00/structast__xmpp__client__config.html">ast_xmpp_client_config</a> *, clientcfg, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../d5/da5/astobj2_8h.html#a6321ee982370c55ab3c24c72c562cbdd">ao2_cleanup</a>);</div><div class="line"><a name="l01846"></a><span class="lineno"> 1846</span>&#160;   <span class="keywordtype">char</span> *s;</div><div class="line"><a name="l01847"></a><span class="lineno"> 1847</span>&#160;   <a class="code" href="../../d3/d93/include_2asterisk_2app_8h.html#a80cd3f6f786b59b742bcecfc0b3be7c2">AST_DECLARE_APP_ARGS</a>(<a class="code" href="../../d5/dde/test__func__file_8c.html#a7df83d295429a2562396f1ec127a46c0">args</a>,</div><div class="line"><a name="l01848"></a><span class="lineno"> 1848</span>&#160;              <a class="code" href="../../d3/d93/include_2asterisk_2app_8h.html#a037e9a5b28477b17e7c9acbe7ecb21d5">AST_APP_ARG</a>(sender);</div><div class="line"><a name="l01849"></a><span class="lineno"> 1849</span>&#160;              <a class="code" href="../../d3/d93/include_2asterisk_2app_8h.html#a037e9a5b28477b17e7c9acbe7ecb21d5">AST_APP_ARG</a>(recipient);</div><div class="line"><a name="l01850"></a><span class="lineno"> 1850</span>&#160;              <a class="code" href="../../d3/d93/include_2asterisk_2app_8h.html#a037e9a5b28477b17e7c9acbe7ecb21d5">AST_APP_ARG</a>(<a class="code" href="../../d8/d9e/structmessage.html">message</a>);</div><div class="line"><a name="l01851"></a><span class="lineno"> 1851</span>&#160;      );</div><div class="line"><a name="l01852"></a><span class="lineno"> 1852</span>&#160;</div><div class="line"><a name="l01853"></a><span class="lineno"> 1853</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a>(data)) {</div><div class="line"><a name="l01854"></a><span class="lineno"> 1854</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;%s requires arguments (account,jid,message)\n&quot;</span>, app_ajisend);</div><div class="line"><a name="l01855"></a><span class="lineno"> 1855</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l01856"></a><span class="lineno"> 1856</span>&#160;   }</div><div class="line"><a name="l01857"></a><span class="lineno"> 1857</span>&#160;   s = <a class="code" href="../../d8/d8a/astmm_8h.html#ab5f0750cc80ba337fdcbddea2d3a1ee6">ast_strdupa</a>(data);</div><div class="line"><a name="l01858"></a><span class="lineno"> 1858</span>&#160;</div><div class="line"><a name="l01859"></a><span class="lineno"> 1859</span>&#160;   <a class="code" href="../../d3/d93/include_2asterisk_2app_8h.html#ac08f7eb1eb9476b30987c73e1052ada8">AST_STANDARD_APP_ARGS</a>(<a class="code" href="../../d5/dde/test__func__file_8c.html#a7df83d295429a2562396f1ec127a46c0">args</a>, s);</div><div class="line"><a name="l01860"></a><span class="lineno"> 1860</span>&#160;</div><div class="line"><a name="l01861"></a><span class="lineno"> 1861</span>&#160;   <span class="keywordflow">if</span> ((<a class="code" href="../../d5/dde/test__func__file_8c.html#a7df83d295429a2562396f1ec127a46c0">args</a>.argc &lt; 3) || <a class="code" href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a>(<a class="code" href="../../d5/dde/test__func__file_8c.html#a7df83d295429a2562396f1ec127a46c0">args</a>.message) || !strchr(<a class="code" href="../../d5/dde/test__func__file_8c.html#a7df83d295429a2562396f1ec127a46c0">args</a>.recipient, <span class="charliteral">&#39;@&#39;</span>)) {</div><div class="line"><a name="l01862"></a><span class="lineno"> 1862</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;%s requires arguments (account,jid,message)\n&quot;</span>, app_ajisend);</div><div class="line"><a name="l01863"></a><span class="lineno"> 1863</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l01864"></a><span class="lineno"> 1864</span>&#160;   }</div><div class="line"><a name="l01865"></a><span class="lineno"> 1865</span>&#160;</div><div class="line"><a name="l01866"></a><span class="lineno"> 1866</span>&#160;   <span class="keywordflow">if</span> (!cfg || !cfg-&gt;clients || !(clientcfg = <a class="code" href="../../dc/d6b/res__xmpp_8c.html#a14d10033fb3b97f06238940259f45266">xmpp_config_find</a>(cfg-&gt;clients, <a class="code" href="../../d5/dde/test__func__file_8c.html#a7df83d295429a2562396f1ec127a46c0">args</a>.sender))) {</div><div class="line"><a name="l01867"></a><span class="lineno"> 1867</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Could not find sender connection: &#39;%s&#39;\n&quot;</span>, <a class="code" href="../../d5/dde/test__func__file_8c.html#a7df83d295429a2562396f1ec127a46c0">args</a>.sender);</div><div class="line"><a name="l01868"></a><span class="lineno"> 1868</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l01869"></a><span class="lineno"> 1869</span>&#160;   }</div><div class="line"><a name="l01870"></a><span class="lineno"> 1870</span>&#160;</div><div class="line"><a name="l01871"></a><span class="lineno"> 1871</span>&#160;   <a class="code" href="../../dc/d6b/res__xmpp_8c.html#a21d05f7d76693ba1145973de7d3f0a03">ast_xmpp_client_send_message</a>(clientcfg-&gt;client, <a class="code" href="../../d5/dde/test__func__file_8c.html#a7df83d295429a2562396f1ec127a46c0">args</a>.recipient, <a class="code" href="../../d5/dde/test__func__file_8c.html#a7df83d295429a2562396f1ec127a46c0">args</a>.message);</div><div class="line"><a name="l01872"></a><span class="lineno"> 1872</span>&#160;</div><div class="line"><a name="l01873"></a><span class="lineno"> 1873</span>&#160;   <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l01874"></a><span class="lineno"> 1874</span>&#160;}</div><div class="line"><a name="l01875"></a><span class="lineno"> 1875</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01876"></a><span class="lineno"> 1876</span>&#160;<span class="comment">/*!</span></div><div class="line"><a name="l01877"></a><span class="lineno"> 1877</span>&#160;<span class="comment"> * \brief Application to send a message to a groupchat.</span></div><div class="line"><a name="l01878"></a><span class="lineno"> 1878</span>&#160;<span class="comment"> * \param chan ast_channel</span></div><div class="line"><a name="l01879"></a><span class="lineno"> 1879</span>&#160;<span class="comment"> * \param data  Data is sender|groupchat|message.</span></div><div class="line"><a name="l01880"></a><span class="lineno"> 1880</span>&#160;<span class="comment"> * \retval 0 success</span></div><div class="line"><a name="l01881"></a><span class="lineno"> 1881</span>&#160;<span class="comment"> * \retval -1 error</span></div><div class="line"><a name="l01882"></a><span class="lineno"> 1882</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l01883"></a><span class="lineno"><a class="line" href="../../dc/d6b/res__xmpp_8c.html#aef2ad31249e4f24084ed1e9c478147ca"> 1883</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../dc/d6b/res__xmpp_8c.html#aef2ad31249e4f24084ed1e9c478147ca">xmpp_sendgroup_exec</a>(<span class="keyword">struct</span> <a class="code" href="../../df/d3c/structast__channel.html">ast_channel</a> *chan, <span class="keyword">const</span> <span class="keywordtype">char</span> *data)</div><div class="line"><a name="l01884"></a><span class="lineno"> 1884</span>&#160;{</div><div class="line"><a name="l01885"></a><span class="lineno"> 1885</span>&#160;   <a class="code" href="../../d5/d60/utils_8h.html#a1604b4d72144dd3d9f7da668e90337e9">RAII_VAR</a>(<span class="keyword">struct</span> <a class="code" href="../../de/d1c/structxmpp__config.html">xmpp_config</a> *, cfg, <a class="code" href="../../d5/da5/astobj2_8h.html#a86d8d6c3c8866ed0a60121da055cd225">ao2_global_obj_ref</a>(<a class="code" href="../../d3/d4e/chan__console_8c.html#aa36e3e2c486b920b166c2d17c5242221">globals</a>), <a class="code" href="../../d5/da5/astobj2_8h.html#a6321ee982370c55ab3c24c72c562cbdd">ao2_cleanup</a>);</div><div class="line"><a name="l01886"></a><span class="lineno"> 1886</span>&#160;   <a class="code" href="../../d5/d60/utils_8h.html#a1604b4d72144dd3d9f7da668e90337e9">RAII_VAR</a>(<span class="keyword">struct</span> <a class="code" href="../../da/d00/structast__xmpp__client__config.html">ast_xmpp_client_config</a> *, clientcfg, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../d5/da5/astobj2_8h.html#a6321ee982370c55ab3c24c72c562cbdd">ao2_cleanup</a>);</div><div class="line"><a name="l01887"></a><span class="lineno"> 1887</span>&#160;   <span class="keywordtype">char</span> *s, nick[<a class="code" href="../../da/da0/xmpp_8h.html#a4ac42d40c03218246d548fbb3fc06e59">XMPP_MAX_RESJIDLEN</a>];</div><div class="line"><a name="l01888"></a><span class="lineno"> 1888</span>&#160;   <a class="code" href="../../d3/d93/include_2asterisk_2app_8h.html#a80cd3f6f786b59b742bcecfc0b3be7c2">AST_DECLARE_APP_ARGS</a>(<a class="code" href="../../d5/dde/test__func__file_8c.html#a7df83d295429a2562396f1ec127a46c0">args</a>,</div><div class="line"><a name="l01889"></a><span class="lineno"> 1889</span>&#160;              <a class="code" href="../../d3/d93/include_2asterisk_2app_8h.html#a037e9a5b28477b17e7c9acbe7ecb21d5">AST_APP_ARG</a>(sender);</div><div class="line"><a name="l01890"></a><span class="lineno"> 1890</span>&#160;              <a class="code" href="../../d3/d93/include_2asterisk_2app_8h.html#a037e9a5b28477b17e7c9acbe7ecb21d5">AST_APP_ARG</a>(groupchat);</div><div class="line"><a name="l01891"></a><span class="lineno"> 1891</span>&#160;              <a class="code" href="../../d3/d93/include_2asterisk_2app_8h.html#a037e9a5b28477b17e7c9acbe7ecb21d5">AST_APP_ARG</a>(<a class="code" href="../../d8/d9e/structmessage.html">message</a>);</div><div class="line"><a name="l01892"></a><span class="lineno"> 1892</span>&#160;              <a class="code" href="../../d3/d93/include_2asterisk_2app_8h.html#a037e9a5b28477b17e7c9acbe7ecb21d5">AST_APP_ARG</a>(nick);</div><div class="line"><a name="l01893"></a><span class="lineno"> 1893</span>&#160;      );</div><div class="line"><a name="l01894"></a><span class="lineno"> 1894</span>&#160;</div><div class="line"><a name="l01895"></a><span class="lineno"> 1895</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a>(data)) {</div><div class="line"><a name="l01896"></a><span class="lineno"> 1896</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;%s requires arguments (sender,groupchatid,message[,nickname])\n&quot;</span>, app_ajisendgroup);</div><div class="line"><a name="l01897"></a><span class="lineno"> 1897</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l01898"></a><span class="lineno"> 1898</span>&#160;   }</div><div class="line"><a name="l01899"></a><span class="lineno"> 1899</span>&#160;   s = <a class="code" href="../../d8/d8a/astmm_8h.html#ab5f0750cc80ba337fdcbddea2d3a1ee6">ast_strdupa</a>(data);</div><div class="line"><a name="l01900"></a><span class="lineno"> 1900</span>&#160;</div><div class="line"><a name="l01901"></a><span class="lineno"> 1901</span>&#160;   <a class="code" href="../../d3/d93/include_2asterisk_2app_8h.html#ac08f7eb1eb9476b30987c73e1052ada8">AST_STANDARD_APP_ARGS</a>(<a class="code" href="../../d5/dde/test__func__file_8c.html#a7df83d295429a2562396f1ec127a46c0">args</a>, s);</div><div class="line"><a name="l01902"></a><span class="lineno"> 1902</span>&#160;   <span class="keywordflow">if</span> ((<a class="code" href="../../d5/dde/test__func__file_8c.html#a7df83d295429a2562396f1ec127a46c0">args</a>.argc &lt; 3) || (<a class="code" href="../../d5/dde/test__func__file_8c.html#a7df83d295429a2562396f1ec127a46c0">args</a>.argc &gt; 4) || <a class="code" href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a>(<a class="code" href="../../d5/dde/test__func__file_8c.html#a7df83d295429a2562396f1ec127a46c0">args</a>.message) || !strchr(<a class="code" href="../../d5/dde/test__func__file_8c.html#a7df83d295429a2562396f1ec127a46c0">args</a>.groupchat, <span class="charliteral">&#39;@&#39;</span>)) {</div><div class="line"><a name="l01903"></a><span class="lineno"> 1903</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;%s requires arguments (sender,groupchatid,message[,nickname])\n&quot;</span>, app_ajisendgroup);</div><div class="line"><a name="l01904"></a><span class="lineno"> 1904</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l01905"></a><span class="lineno"> 1905</span>&#160;   }</div><div class="line"><a name="l01906"></a><span class="lineno"> 1906</span>&#160;</div><div class="line"><a name="l01907"></a><span class="lineno"> 1907</span>&#160;   <span class="keywordflow">if</span> (!cfg || !cfg-&gt;clients || !(clientcfg = <a class="code" href="../../dc/d6b/res__xmpp_8c.html#a14d10033fb3b97f06238940259f45266">xmpp_config_find</a>(cfg-&gt;clients, <a class="code" href="../../d5/dde/test__func__file_8c.html#a7df83d295429a2562396f1ec127a46c0">args</a>.sender))) {</div><div class="line"><a name="l01908"></a><span class="lineno"> 1908</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Could not find sender connection: &#39;%s&#39;\n&quot;</span>, <a class="code" href="../../d5/dde/test__func__file_8c.html#a7df83d295429a2562396f1ec127a46c0">args</a>.sender);</div><div class="line"><a name="l01909"></a><span class="lineno"> 1909</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l01910"></a><span class="lineno"> 1910</span>&#160;   }</div><div class="line"><a name="l01911"></a><span class="lineno"> 1911</span>&#160;</div><div class="line"><a name="l01912"></a><span class="lineno"> 1912</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a>(<a class="code" href="../../d5/dde/test__func__file_8c.html#a7df83d295429a2562396f1ec127a46c0">args</a>.nick) || <a class="code" href="../../d5/dde/test__func__file_8c.html#a7df83d295429a2562396f1ec127a46c0">args</a>.argc == 3) {</div><div class="line"><a name="l01913"></a><span class="lineno"> 1913</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="../../d5/d60/utils_8h.html#a00d4c9254c9827d6fa44f17a326744a5">ast_test_flag</a>(&amp;clientcfg-&gt;flags, <a class="code" href="../../dc/d6b/res__xmpp_8c.html#aa3759d2ddcc12f3f5ef5a8a3ffa4a4dfadc3efad94dcc216c29d42b23edcb2d00">XMPP_COMPONENT</a>)) {</div><div class="line"><a name="l01914"></a><span class="lineno"> 1914</span>&#160;         snprintf(nick, <span class="keyword">sizeof</span>(nick), <span class="stringliteral">&quot;asterisk&quot;</span>);</div><div class="line"><a name="l01915"></a><span class="lineno"> 1915</span>&#160;      } <span class="keywordflow">else</span> {</div><div class="line"><a name="l01916"></a><span class="lineno"> 1916</span>&#160;         snprintf(nick, <span class="keyword">sizeof</span>(nick), <span class="stringliteral">&quot;%s&quot;</span>, clientcfg-&gt;client-&gt;jid-&gt;user);</div><div class="line"><a name="l01917"></a><span class="lineno"> 1917</span>&#160;      }</div><div class="line"><a name="l01918"></a><span class="lineno"> 1918</span>&#160;   } <span class="keywordflow">else</span> {</div><div class="line"><a name="l01919"></a><span class="lineno"> 1919</span>&#160;      snprintf(nick, <span class="keyword">sizeof</span>(nick), <span class="stringliteral">&quot;%s&quot;</span>, <a class="code" href="../../d5/dde/test__func__file_8c.html#a7df83d295429a2562396f1ec127a46c0">args</a>.nick);</div><div class="line"><a name="l01920"></a><span class="lineno"> 1920</span>&#160;   }</div><div class="line"><a name="l01921"></a><span class="lineno"> 1921</span>&#160;</div><div class="line"><a name="l01922"></a><span class="lineno"> 1922</span>&#160;   <a class="code" href="../../dc/d6b/res__xmpp_8c.html#a1adde8184c850e2d9150c59b5ffcff24">ast_xmpp_chatroom_send</a>(clientcfg-&gt;client, nick, <a class="code" href="../../d5/dde/test__func__file_8c.html#a7df83d295429a2562396f1ec127a46c0">args</a>.groupchat, <a class="code" href="../../d5/dde/test__func__file_8c.html#a7df83d295429a2562396f1ec127a46c0">args</a>.message);</div><div class="line"><a name="l01923"></a><span class="lineno"> 1923</span>&#160;</div><div class="line"><a name="l01924"></a><span class="lineno"> 1924</span>&#160;   <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l01925"></a><span class="lineno"> 1925</span>&#160;}</div><div class="line"><a name="l01926"></a><span class="lineno"> 1926</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01927"></a><span class="lineno"> 1927</span>&#160;<span class="comment">/*!</span></div><div class="line"><a name="l01928"></a><span class="lineno"> 1928</span>&#160;<span class="comment"> * \internal</span></div><div class="line"><a name="l01929"></a><span class="lineno"> 1929</span>&#160;<span class="comment"> * \brief Dial plan function to receive a message.</span></div><div class="line"><a name="l01930"></a><span class="lineno"> 1930</span>&#160;<span class="comment"> * \param channel The associated ast_channel, if there is one</span></div><div class="line"><a name="l01931"></a><span class="lineno"> 1931</span>&#160;<span class="comment"> * \param data The account, JID, and optional timeout</span></div><div class="line"><a name="l01932"></a><span class="lineno"> 1932</span>&#160;<span class="comment"> * timeout.</span></div><div class="line"><a name="l01933"></a><span class="lineno"> 1933</span>&#160;<span class="comment"> * \retval 0 success</span></div><div class="line"><a name="l01934"></a><span class="lineno"> 1934</span>&#160;<span class="comment"> * \retval -1 failure</span></div><div class="line"><a name="l01935"></a><span class="lineno"> 1935</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l01936"></a><span class="lineno"><a class="line" href="../../dc/d6b/res__xmpp_8c.html#af0a9d049fc6d63f0491bb5e5ef5f040b"> 1936</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../dc/d6b/res__xmpp_8c.html#af0a9d049fc6d63f0491bb5e5ef5f040b">acf_jabberreceive_read</a>(<span class="keyword">struct</span> <a class="code" href="../../df/d3c/structast__channel.html">ast_channel</a> *chan, <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="../../d0/d29/cdr__mysql_8c.html#a0980a105ccb863d8008eb6201a51da52">name</a>, <span class="keywordtype">char</span> *data, <span class="keywordtype">char</span> *<a class="code" href="../../dd/d7c/eagi__proxy_8c.html#ac95651d79c608a3148973b5b1fc9e525">buf</a>, <span class="keywordtype">size_t</span> buflen)</div><div class="line"><a name="l01937"></a><span class="lineno"> 1937</span>&#160;{</div><div class="line"><a name="l01938"></a><span class="lineno"> 1938</span>&#160;   <a class="code" href="../../d5/d60/utils_8h.html#a1604b4d72144dd3d9f7da668e90337e9">RAII_VAR</a>(<span class="keyword">struct</span> <a class="code" href="../../de/d1c/structxmpp__config.html">xmpp_config</a> *, cfg, <a class="code" href="../../d5/da5/astobj2_8h.html#a86d8d6c3c8866ed0a60121da055cd225">ao2_global_obj_ref</a>(<a class="code" href="../../d3/d4e/chan__console_8c.html#aa36e3e2c486b920b166c2d17c5242221">globals</a>), <a class="code" href="../../d5/da5/astobj2_8h.html#a6321ee982370c55ab3c24c72c562cbdd">ao2_cleanup</a>);</div><div class="line"><a name="l01939"></a><span class="lineno"> 1939</span>&#160;   <a class="code" href="../../d5/d60/utils_8h.html#a1604b4d72144dd3d9f7da668e90337e9">RAII_VAR</a>(<span class="keyword">struct</span> <a class="code" href="../../da/d00/structast__xmpp__client__config.html">ast_xmpp_client_config</a> *, clientcfg, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../d5/da5/astobj2_8h.html#a6321ee982370c55ab3c24c72c562cbdd">ao2_cleanup</a>);</div><div class="line"><a name="l01940"></a><span class="lineno"> 1940</span>&#160;   <span class="keywordtype">char</span> *<a class="code" href="../../d0/dd6/chan__mgcp_8c.html#a2e006acff60d9b3d65d7d60f975d6747">parse</a> = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l01941"></a><span class="lineno"> 1941</span>&#160;   <span class="keywordtype">int</span> <a class="code" href="../../d0/d29/cdr__mysql_8c.html#a493b57f443cc38b3d3df9c1e584d9d82">timeout</a>, jidlen, resourcelen, found = 0;</div><div class="line"><a name="l01942"></a><span class="lineno"> 1942</span>&#160;   <span class="keyword">struct </span>timeval start;</div><div class="line"><a name="l01943"></a><span class="lineno"> 1943</span>&#160;   <span class="keywordtype">long</span> diff = 0;</div><div class="line"><a name="l01944"></a><span class="lineno"> 1944</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d6/d73/structast__xmpp__message.html">ast_xmpp_message</a> *<a class="code" href="../../d6/d73/structast__xmpp__message.html#a0b2e8c7f76df48129f994ecc46d5c66c">message</a>;</div><div class="line"><a name="l01945"></a><span class="lineno"> 1945</span>&#160;   <a class="code" href="../../d3/d93/include_2asterisk_2app_8h.html#a80cd3f6f786b59b742bcecfc0b3be7c2">AST_DECLARE_APP_ARGS</a>(<a class="code" href="../../d5/dde/test__func__file_8c.html#a7df83d295429a2562396f1ec127a46c0">args</a>,</div><div class="line"><a name="l01946"></a><span class="lineno"> 1946</span>&#160;              <a class="code" href="../../d3/d93/include_2asterisk_2app_8h.html#a037e9a5b28477b17e7c9acbe7ecb21d5">AST_APP_ARG</a>(account);</div><div class="line"><a name="l01947"></a><span class="lineno"> 1947</span>&#160;              <a class="code" href="../../d3/d93/include_2asterisk_2app_8h.html#a037e9a5b28477b17e7c9acbe7ecb21d5">AST_APP_ARG</a>(jid);</div><div class="line"><a name="l01948"></a><span class="lineno"> 1948</span>&#160;              <a class="code" href="../../d3/d93/include_2asterisk_2app_8h.html#a037e9a5b28477b17e7c9acbe7ecb21d5">AST_APP_ARG</a>(timeout);</div><div class="line"><a name="l01949"></a><span class="lineno"> 1949</span>&#160;      );</div><div class="line"><a name="l01950"></a><span class="lineno"> 1950</span>&#160;   <a class="code" href="../../d3/d93/include_2asterisk_2app_8h.html#a80cd3f6f786b59b742bcecfc0b3be7c2">AST_DECLARE_APP_ARGS</a>(jid,</div><div class="line"><a name="l01951"></a><span class="lineno"> 1951</span>&#160;              <a class="code" href="../../d3/d93/include_2asterisk_2app_8h.html#a037e9a5b28477b17e7c9acbe7ecb21d5">AST_APP_ARG</a>(screenname);</div><div class="line"><a name="l01952"></a><span class="lineno"> 1952</span>&#160;              <a class="code" href="../../d3/d93/include_2asterisk_2app_8h.html#a037e9a5b28477b17e7c9acbe7ecb21d5">AST_APP_ARG</a>(resource);</div><div class="line"><a name="l01953"></a><span class="lineno"> 1953</span>&#160;      );</div><div class="line"><a name="l01954"></a><span class="lineno"> 1954</span>&#160;</div><div class="line"><a name="l01955"></a><span class="lineno"> 1955</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a>(data)) {</div><div class="line"><a name="l01956"></a><span class="lineno"> 1956</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;%s requires arguments (account,jid[,timeout])\n&quot;</span>, name);</div><div class="line"><a name="l01957"></a><span class="lineno"> 1957</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l01958"></a><span class="lineno"> 1958</span>&#160;   }</div><div class="line"><a name="l01959"></a><span class="lineno"> 1959</span>&#160;</div><div class="line"><a name="l01960"></a><span class="lineno"> 1960</span>&#160;   parse = <a class="code" href="../../d8/d8a/astmm_8h.html#ab5f0750cc80ba337fdcbddea2d3a1ee6">ast_strdupa</a>(data);</div><div class="line"><a name="l01961"></a><span class="lineno"> 1961</span>&#160;   <a class="code" href="../../d3/d93/include_2asterisk_2app_8h.html#ac08f7eb1eb9476b30987c73e1052ada8">AST_STANDARD_APP_ARGS</a>(<a class="code" href="../../d5/dde/test__func__file_8c.html#a7df83d295429a2562396f1ec127a46c0">args</a>, parse);</div><div class="line"><a name="l01962"></a><span class="lineno"> 1962</span>&#160;</div><div class="line"><a name="l01963"></a><span class="lineno"> 1963</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d5/dde/test__func__file_8c.html#a7df83d295429a2562396f1ec127a46c0">args</a>.argc &lt; 2 || <a class="code" href="../../d5/dde/test__func__file_8c.html#a7df83d295429a2562396f1ec127a46c0">args</a>.argc &gt; 3) {</div><div class="line"><a name="l01964"></a><span class="lineno"> 1964</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;%s requires arguments (account,jid[,timeout])\n&quot;</span>, name);</div><div class="line"><a name="l01965"></a><span class="lineno"> 1965</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l01966"></a><span class="lineno"> 1966</span>&#160;   }</div><div class="line"><a name="l01967"></a><span class="lineno"> 1967</span>&#160;</div><div class="line"><a name="l01968"></a><span class="lineno"> 1968</span>&#160;   parse = <a class="code" href="../../d8/d8a/astmm_8h.html#ab5f0750cc80ba337fdcbddea2d3a1ee6">ast_strdupa</a>(<a class="code" href="../../d5/dde/test__func__file_8c.html#a7df83d295429a2562396f1ec127a46c0">args</a>.jid);</div><div class="line"><a name="l01969"></a><span class="lineno"> 1969</span>&#160;   <a class="code" href="../../d3/d93/include_2asterisk_2app_8h.html#accfcb380df76a64251d88ef49c2dd4e3">AST_NONSTANDARD_APP_ARGS</a>(jid, parse, <span class="charliteral">&#39;/&#39;</span>);</div><div class="line"><a name="l01970"></a><span class="lineno"> 1970</span>&#160;   <span class="keywordflow">if</span> (jid.argc &lt; 1 || jid.argc &gt; 2 || strlen(<a class="code" href="../../d5/dde/test__func__file_8c.html#a7df83d295429a2562396f1ec127a46c0">args</a>.jid) &gt; <a class="code" href="../../da/da0/xmpp_8h.html#a88ace060762475a37823dd4bc7b3076f">XMPP_MAX_JIDLEN</a>) {</div><div class="line"><a name="l01971"></a><span class="lineno"> 1971</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Invalid JID : %s\n&quot;</span>, parse);</div><div class="line"><a name="l01972"></a><span class="lineno"> 1972</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l01973"></a><span class="lineno"> 1973</span>&#160;   }</div><div class="line"><a name="l01974"></a><span class="lineno"> 1974</span>&#160;</div><div class="line"><a name="l01975"></a><span class="lineno"> 1975</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a>(<a class="code" href="../../d5/dde/test__func__file_8c.html#a7df83d295429a2562396f1ec127a46c0">args</a>.timeout)) {</div><div class="line"><a name="l01976"></a><span class="lineno"> 1976</span>&#160;      timeout = 20;</div><div class="line"><a name="l01977"></a><span class="lineno"> 1977</span>&#160;   } <span class="keywordflow">else</span> {</div><div class="line"><a name="l01978"></a><span class="lineno"> 1978</span>&#160;      sscanf(<a class="code" href="../../d5/dde/test__func__file_8c.html#a7df83d295429a2562396f1ec127a46c0">args</a>.timeout, <span class="stringliteral">&quot;%d&quot;</span>, &amp;timeout);</div><div class="line"><a name="l01979"></a><span class="lineno"> 1979</span>&#160;      <span class="keywordflow">if</span> (timeout &lt;= 0) {</div><div class="line"><a name="l01980"></a><span class="lineno"> 1980</span>&#160;         <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Invalid timeout specified: &#39;%s&#39;\n&quot;</span>, <a class="code" href="../../d5/dde/test__func__file_8c.html#a7df83d295429a2562396f1ec127a46c0">args</a>.timeout);</div><div class="line"><a name="l01981"></a><span class="lineno"> 1981</span>&#160;         <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l01982"></a><span class="lineno"> 1982</span>&#160;      }</div><div class="line"><a name="l01983"></a><span class="lineno"> 1983</span>&#160;   }</div><div class="line"><a name="l01984"></a><span class="lineno"> 1984</span>&#160;</div><div class="line"><a name="l01985"></a><span class="lineno"> 1985</span>&#160;   jidlen = strlen(jid.screenname);</div><div class="line"><a name="l01986"></a><span class="lineno"> 1986</span>&#160;   resourcelen = <a class="code" href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a>(jid.resource) ? 0 : strlen(jid.resource);</div><div class="line"><a name="l01987"></a><span class="lineno"> 1987</span>&#160;</div><div class="line"><a name="l01988"></a><span class="lineno"> 1988</span>&#160;   <span class="keywordflow">if</span> (!cfg || !cfg-&gt;clients || !(clientcfg = <a class="code" href="../../dc/d6b/res__xmpp_8c.html#a14d10033fb3b97f06238940259f45266">xmpp_config_find</a>(cfg-&gt;clients, <a class="code" href="../../d5/dde/test__func__file_8c.html#a7df83d295429a2562396f1ec127a46c0">args</a>.account))) {</div><div class="line"><a name="l01989"></a><span class="lineno"> 1989</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Could not find client %s, exiting\n&quot;</span>, <a class="code" href="../../d5/dde/test__func__file_8c.html#a7df83d295429a2562396f1ec127a46c0">args</a>.account);</div><div class="line"><a name="l01990"></a><span class="lineno"> 1990</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l01991"></a><span class="lineno"> 1991</span>&#160;   }</div><div class="line"><a name="l01992"></a><span class="lineno"> 1992</span>&#160;</div><div class="line"><a name="l01993"></a><span class="lineno"> 1993</span>&#160;   <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(3, <span class="stringliteral">&quot;Waiting for an XMPP message from %s\n&quot;</span>, <a class="code" href="../../d5/dde/test__func__file_8c.html#a7df83d295429a2562396f1ec127a46c0">args</a>.jid);</div><div class="line"><a name="l01994"></a><span class="lineno"> 1994</span>&#160;</div><div class="line"><a name="l01995"></a><span class="lineno"> 1995</span>&#160;   start = <a class="code" href="../../de/df7/time_8h.html#ad3899efb6f0e348556ef69f5b16aa7f7">ast_tvnow</a>();</div><div class="line"><a name="l01996"></a><span class="lineno"> 1996</span>&#160;</div><div class="line"><a name="l01997"></a><span class="lineno"> 1997</span>&#160;   <span class="keywordflow">if</span> (chan &amp;&amp; <a class="code" href="../../d5/d7b/channel_8h.html#a7a8f6a50f3db42cb40cad7cfbd1d54f9">ast_autoservice_start</a>(chan) &lt; 0) {</div><div class="line"><a name="l01998"></a><span class="lineno"> 1998</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Cannot start autoservice for channel %s\n&quot;</span>, <a class="code" href="../../d5/d7b/channel_8h.html#a7ca2fda13b129a55c251b56729de285b">ast_channel_name</a>(chan));</div><div class="line"><a name="l01999"></a><span class="lineno"> 1999</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l02000"></a><span class="lineno"> 2000</span>&#160;   }</div><div class="line"><a name="l02001"></a><span class="lineno"> 2001</span>&#160;</div><div class="line"><a name="l02002"></a><span class="lineno"> 2002</span>&#160;   <span class="comment">/* search the messages list, grab the first message that matches with</span></div><div class="line"><a name="l02003"></a><span class="lineno"> 2003</span>&#160;<span class="comment">    * the from JID we&#39;re expecting, and remove it from the messages list */</span></div><div class="line"><a name="l02004"></a><span class="lineno"> 2004</span>&#160;   <span class="keywordflow">while</span> (diff &lt; timeout) {</div><div class="line"><a name="l02005"></a><span class="lineno"> 2005</span>&#160;      <span class="keyword">struct </span>timespec ts = { 0, };</div><div class="line"><a name="l02006"></a><span class="lineno"> 2006</span>&#160;      <span class="keyword">struct </span>timeval wait;</div><div class="line"><a name="l02007"></a><span class="lineno"> 2007</span>&#160;      <span class="keywordtype">int</span> res = 0;</div><div class="line"><a name="l02008"></a><span class="lineno"> 2008</span>&#160;</div><div class="line"><a name="l02009"></a><span class="lineno"> 2009</span>&#160;      wait = <a class="code" href="../../de/df7/time_8h.html#a97e1bb8fbd7a103212789e87e7ed6073">ast_tvadd</a>(start, <a class="code" href="../../de/df7/time_8h.html#aebf04439f206cc509472ce4b6da48a5a">ast_tv</a>(timeout, 0));</div><div class="line"><a name="l02010"></a><span class="lineno"> 2010</span>&#160;      ts.tv_sec = wait.tv_sec;</div><div class="line"><a name="l02011"></a><span class="lineno"> 2011</span>&#160;      ts.tv_nsec = wait.tv_usec * 1000;</div><div class="line"><a name="l02012"></a><span class="lineno"> 2012</span>&#160;</div><div class="line"><a name="l02013"></a><span class="lineno"> 2013</span>&#160;      <span class="comment">/* wait up to timeout seconds for an incoming message */</span></div><div class="line"><a name="l02014"></a><span class="lineno"> 2014</span>&#160;      <a class="code" href="../../dd/d42/lock_8h.html#ac5e13c7fe64d3b271a52028b0a78b92b">ast_mutex_lock</a>(&amp;messagelock);</div><div class="line"><a name="l02015"></a><span class="lineno"> 2015</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="../../df/d90/linkedlists_8h.html#a4a1884cde93e53bef32ca85c194a1d05">AST_LIST_EMPTY</a>(&amp;clientcfg-&gt;client-&gt;messages)) {</div><div class="line"><a name="l02016"></a><span class="lineno"> 2016</span>&#160;         res = <a class="code" href="../../dd/d42/lock_8h.html#a6add1f30b2d53ca9384b15529a6f126e">ast_cond_timedwait</a>(&amp;message_received_condition, &amp;messagelock, &amp;ts);</div><div class="line"><a name="l02017"></a><span class="lineno"> 2017</span>&#160;      }</div><div class="line"><a name="l02018"></a><span class="lineno"> 2018</span>&#160;      <a class="code" href="../../dd/d42/lock_8h.html#a873f9ce8c6287a32d48c83133e124418">ast_mutex_unlock</a>(&amp;messagelock);</div><div class="line"><a name="l02019"></a><span class="lineno"> 2019</span>&#160;      <span class="keywordflow">if</span> (res == ETIMEDOUT) {</div><div class="line"><a name="l02020"></a><span class="lineno"> 2020</span>&#160;         <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(3, <span class="stringliteral">&quot;No message received from %s in %d seconds\n&quot;</span>, <a class="code" href="../../d5/dde/test__func__file_8c.html#a7df83d295429a2562396f1ec127a46c0">args</a>.jid, timeout);</div><div class="line"><a name="l02021"></a><span class="lineno"> 2021</span>&#160;         <span class="keywordflow">break</span>;</div><div class="line"><a name="l02022"></a><span class="lineno"> 2022</span>&#160;      }</div><div class="line"><a name="l02023"></a><span class="lineno"> 2023</span>&#160;</div><div class="line"><a name="l02024"></a><span class="lineno"> 2024</span>&#160;      <a class="code" href="../../df/d90/linkedlists_8h.html#a9140a4e4d781264fa9469c52b1adae40">AST_LIST_LOCK</a>(&amp;clientcfg-&gt;client-&gt;messages);</div><div class="line"><a name="l02025"></a><span class="lineno"> 2025</span>&#160;      <a class="code" href="../../df/d90/linkedlists_8h.html#aa5be52067bf16bdc7e56ca19b5ba858d">AST_LIST_TRAVERSE_SAFE_BEGIN</a>(&amp;clientcfg-&gt;client-&gt;messages, message, list) {</div><div class="line"><a name="l02026"></a><span class="lineno"> 2026</span>&#160;         <span class="keywordflow">if</span> (jid.argc == 1) {</div><div class="line"><a name="l02027"></a><span class="lineno"> 2027</span>&#160;            <span class="comment">/* no resource provided, compare bare JIDs */</span></div><div class="line"><a name="l02028"></a><span class="lineno"> 2028</span>&#160;            <span class="keywordflow">if</span> (strncasecmp(jid.screenname, message-&gt;<a class="code" href="../../d6/d73/structast__xmpp__message.html#a765533dfc643627999c751f7e1514664">from</a>, jidlen)) {</div><div class="line"><a name="l02029"></a><span class="lineno"> 2029</span>&#160;               <span class="keywordflow">continue</span>;</div><div class="line"><a name="l02030"></a><span class="lineno"> 2030</span>&#160;            }</div><div class="line"><a name="l02031"></a><span class="lineno"> 2031</span>&#160;         } <span class="keywordflow">else</span> {</div><div class="line"><a name="l02032"></a><span class="lineno"> 2032</span>&#160;            <span class="comment">/* resource appended, compare bare JIDs and resources */</span></div><div class="line"><a name="l02033"></a><span class="lineno"> 2033</span>&#160;            <span class="keywordtype">char</span> *resource = strchr(message-&gt;<a class="code" href="../../d6/d73/structast__xmpp__message.html#a765533dfc643627999c751f7e1514664">from</a>, <span class="charliteral">&#39;/&#39;</span>);</div><div class="line"><a name="l02034"></a><span class="lineno"> 2034</span>&#160;            <span class="keywordflow">if</span> (!resource || strlen(resource) == 0) {</div><div class="line"><a name="l02035"></a><span class="lineno"> 2035</span>&#160;               <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Remote JID has no resource : %s\n&quot;</span>, message-&gt;<a class="code" href="../../d6/d73/structast__xmpp__message.html#a765533dfc643627999c751f7e1514664">from</a>);</div><div class="line"><a name="l02036"></a><span class="lineno"> 2036</span>&#160;               <span class="keywordflow">if</span> (strncasecmp(jid.screenname, message-&gt;<a class="code" href="../../d6/d73/structast__xmpp__message.html#a765533dfc643627999c751f7e1514664">from</a>, jidlen)) {</div><div class="line"><a name="l02037"></a><span class="lineno"> 2037</span>&#160;                  <span class="keywordflow">continue</span>;</div><div class="line"><a name="l02038"></a><span class="lineno"> 2038</span>&#160;               }</div><div class="line"><a name="l02039"></a><span class="lineno"> 2039</span>&#160;            } <span class="keywordflow">else</span> {</div><div class="line"><a name="l02040"></a><span class="lineno"> 2040</span>&#160;               resource ++;</div><div class="line"><a name="l02041"></a><span class="lineno"> 2041</span>&#160;               <span class="keywordflow">if</span> (strncasecmp(jid.screenname, message-&gt;<a class="code" href="../../d6/d73/structast__xmpp__message.html#a765533dfc643627999c751f7e1514664">from</a>, jidlen) || strncmp(jid.resource, resource, resourcelen)) {</div><div class="line"><a name="l02042"></a><span class="lineno"> 2042</span>&#160;                  <span class="keywordflow">continue</span>;</div><div class="line"><a name="l02043"></a><span class="lineno"> 2043</span>&#160;               }</div><div class="line"><a name="l02044"></a><span class="lineno"> 2044</span>&#160;            }</div><div class="line"><a name="l02045"></a><span class="lineno"> 2045</span>&#160;         }</div><div class="line"><a name="l02046"></a><span class="lineno"> 2046</span>&#160;         <span class="comment">/* check if the message is not too old */</span></div><div class="line"><a name="l02047"></a><span class="lineno"> 2047</span>&#160;         <span class="keywordflow">if</span> (<a class="code" href="../../de/df7/time_8h.html#a39af1febe8b93cb6f7cd59b76fc39e8f">ast_tvdiff_sec</a>(<a class="code" href="../../de/df7/time_8h.html#ad3899efb6f0e348556ef69f5b16aa7f7">ast_tvnow</a>(), message-&gt;<a class="code" href="../../d6/d73/structast__xmpp__message.html#ace5ad74ee812bf5ee2bec5d759022d0b">arrived</a>) &gt;= clientcfg-&gt;message_timeout) {</div><div class="line"><a name="l02048"></a><span class="lineno"> 2048</span>&#160;            <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(3, <span class="stringliteral">&quot;Found old message from %s, deleting it\n&quot;</span>, message-&gt;<a class="code" href="../../d6/d73/structast__xmpp__message.html#a765533dfc643627999c751f7e1514664">from</a>);</div><div class="line"><a name="l02049"></a><span class="lineno"> 2049</span>&#160;            <a class="code" href="../../df/d90/linkedlists_8h.html#aa8ac496fa9c717d5afb99a02e1e2760c">AST_LIST_REMOVE_CURRENT</a>(list);</div><div class="line"><a name="l02050"></a><span class="lineno"> 2050</span>&#160;            <a class="code" href="../../dc/d6b/res__xmpp_8c.html#abe0bf7c227d40c258b694eef9b7f7333">xmpp_message_destroy</a>(message);</div><div class="line"><a name="l02051"></a><span class="lineno"> 2051</span>&#160;            <span class="keywordflow">continue</span>;</div><div class="line"><a name="l02052"></a><span class="lineno"> 2052</span>&#160;         }</div><div class="line"><a name="l02053"></a><span class="lineno"> 2053</span>&#160;         found = 1;</div><div class="line"><a name="l02054"></a><span class="lineno"> 2054</span>&#160;         <a class="code" href="../../d6/d90/strings_8h.html#ac4040268f7b6ed77dfc49c7767626369">ast_copy_string</a>(buf, message-&gt;<a class="code" href="../../d6/d73/structast__xmpp__message.html#a0b2e8c7f76df48129f994ecc46d5c66c">message</a>, buflen);</div><div class="line"><a name="l02055"></a><span class="lineno"> 2055</span>&#160;         <a class="code" href="../../df/d90/linkedlists_8h.html#aa8ac496fa9c717d5afb99a02e1e2760c">AST_LIST_REMOVE_CURRENT</a>(list);</div><div class="line"><a name="l02056"></a><span class="lineno"> 2056</span>&#160;         <a class="code" href="../../dc/d6b/res__xmpp_8c.html#abe0bf7c227d40c258b694eef9b7f7333">xmpp_message_destroy</a>(message);</div><div class="line"><a name="l02057"></a><span class="lineno"> 2057</span>&#160;         <span class="keywordflow">break</span>;</div><div class="line"><a name="l02058"></a><span class="lineno"> 2058</span>&#160;      }</div><div class="line"><a name="l02059"></a><span class="lineno"> 2059</span>&#160;      <a class="code" href="../../df/d90/linkedlists_8h.html#a712c04b4493919a7052399cd30ee8fb9">AST_LIST_TRAVERSE_SAFE_END</a>;</div><div class="line"><a name="l02060"></a><span class="lineno"> 2060</span>&#160;      <a class="code" href="../../df/d90/linkedlists_8h.html#ab48cb9e1e612dd486b747ba1c5d68d01">AST_LIST_UNLOCK</a>(&amp;clientcfg-&gt;client-&gt;messages);</div><div class="line"><a name="l02061"></a><span class="lineno"> 2061</span>&#160;      <span class="keywordflow">if</span> (found) {</div><div class="line"><a name="l02062"></a><span class="lineno"> 2062</span>&#160;         <span class="keywordflow">break</span>;</div><div class="line"><a name="l02063"></a><span class="lineno"> 2063</span>&#160;      }</div><div class="line"><a name="l02064"></a><span class="lineno"> 2064</span>&#160;</div><div class="line"><a name="l02065"></a><span class="lineno"> 2065</span>&#160;      <span class="comment">/* check timeout */</span></div><div class="line"><a name="l02066"></a><span class="lineno"> 2066</span>&#160;      diff = <a class="code" href="../../de/df7/time_8h.html#aca4ecdab7d8d3519062aad9a90fcb29d">ast_tvdiff_ms</a>(<a class="code" href="../../de/df7/time_8h.html#ad3899efb6f0e348556ef69f5b16aa7f7">ast_tvnow</a>(), start);</div><div class="line"><a name="l02067"></a><span class="lineno"> 2067</span>&#160;   }</div><div class="line"><a name="l02068"></a><span class="lineno"> 2068</span>&#160;</div><div class="line"><a name="l02069"></a><span class="lineno"> 2069</span>&#160;   <span class="keywordflow">if</span> (chan &amp;&amp; <a class="code" href="../../d5/d7b/channel_8h.html#a08bde7d8cf72457fc8c519a4443b413b">ast_autoservice_stop</a>(chan) &lt; 0) {</div><div class="line"><a name="l02070"></a><span class="lineno"> 2070</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Cannot stop autoservice for channel %s\n&quot;</span>, <a class="code" href="../../d5/d7b/channel_8h.html#a7ca2fda13b129a55c251b56729de285b">ast_channel_name</a>(chan));</div><div class="line"><a name="l02071"></a><span class="lineno"> 2071</span>&#160;   }</div><div class="line"><a name="l02072"></a><span class="lineno"> 2072</span>&#160;</div><div class="line"><a name="l02073"></a><span class="lineno"> 2073</span>&#160;   <span class="comment">/* return if we timed out */</span></div><div class="line"><a name="l02074"></a><span class="lineno"> 2074</span>&#160;   <span class="keywordflow">if</span> (!found) {</div><div class="line"><a name="l02075"></a><span class="lineno"> 2075</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#ad89ee324d180cdcd7defcc709ff9ca42">LOG_NOTICE</a>, <span class="stringliteral">&quot;Timed out : no message received from %s\n&quot;</span>, <a class="code" href="../../d5/dde/test__func__file_8c.html#a7df83d295429a2562396f1ec127a46c0">args</a>.jid);</div><div class="line"><a name="l02076"></a><span class="lineno"> 2076</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l02077"></a><span class="lineno"> 2077</span>&#160;   }</div><div class="line"><a name="l02078"></a><span class="lineno"> 2078</span>&#160;</div><div class="line"><a name="l02079"></a><span class="lineno"> 2079</span>&#160;   <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l02080"></a><span class="lineno"> 2080</span>&#160;}</div><div class="line"><a name="l02081"></a><span class="lineno"> 2081</span>&#160;</div><div class="line"><a name="l02082"></a><span class="lineno"><a class="line" href="../../dc/d6b/res__xmpp_8c.html#a96201933819dfe8c2b3b97ee8174f179"> 2082</a></span>&#160;<span class="keyword">static</span> <span class="keyword">struct </span><a class="code" href="../../db/dc0/structast__custom__function.html">ast_custom_function</a> <a class="code" href="../../dc/d6b/res__xmpp_8c.html#a96201933819dfe8c2b3b97ee8174f179">jabberreceive_function</a> = {</div><div class="line"><a name="l02083"></a><span class="lineno"> 2083</span>&#160;   .<a class="code" href="../../db/dc0/structast__custom__function.html#afcd1706c9144e6d6eee6127661ae3be2">name</a> = <span class="stringliteral">&quot;JABBER_RECEIVE&quot;</span>,</div><div class="line"><a name="l02084"></a><span class="lineno"> 2084</span>&#160;   .read = <a class="code" href="../../dc/d6b/res__xmpp_8c.html#af0a9d049fc6d63f0491bb5e5ef5f040b">acf_jabberreceive_read</a>,</div><div class="line"><a name="l02085"></a><span class="lineno"> 2085</span>&#160;};</div><div class="line"><a name="l02086"></a><span class="lineno"> 2086</span>&#160;<span class="comment"></span></div><div class="line"><a name="l02087"></a><span class="lineno"> 2087</span>&#160;<span class="comment">/*!</span></div><div class="line"><a name="l02088"></a><span class="lineno"> 2088</span>&#160;<span class="comment"> * \internal</span></div><div class="line"><a name="l02089"></a><span class="lineno"> 2089</span>&#160;<span class="comment"> * \brief Delete old messages from a given JID</span></div><div class="line"><a name="l02090"></a><span class="lineno"> 2090</span>&#160;<span class="comment"> * Messages stored during more than client-&gt;message_timeout are deleted</span></div><div class="line"><a name="l02091"></a><span class="lineno"> 2091</span>&#160;<span class="comment"> * \param client Asterisk&#39;s XMPP client</span></div><div class="line"><a name="l02092"></a><span class="lineno"> 2092</span>&#160;<span class="comment"> * \param from the JID we received messages from</span></div><div class="line"><a name="l02093"></a><span class="lineno"> 2093</span>&#160;<span class="comment"> * \retval the number of deleted messages</span></div><div class="line"><a name="l02094"></a><span class="lineno"> 2094</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l02095"></a><span class="lineno"><a class="line" href="../../dc/d6b/res__xmpp_8c.html#a085fd2ff3dd46be750522ced5c73e060"> 2095</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../dc/d6b/res__xmpp_8c.html#a085fd2ff3dd46be750522ced5c73e060">delete_old_messages</a>(<span class="keyword">struct</span> <a class="code" href="../../df/d42/structast__xmpp__client.html">ast_xmpp_client</a> *client, <span class="keywordtype">char</span> *from)</div><div class="line"><a name="l02096"></a><span class="lineno"> 2096</span>&#160;{</div><div class="line"><a name="l02097"></a><span class="lineno"> 2097</span>&#160;   <a class="code" href="../../d5/d60/utils_8h.html#a1604b4d72144dd3d9f7da668e90337e9">RAII_VAR</a>(<span class="keyword">struct</span> <a class="code" href="../../de/d1c/structxmpp__config.html">xmpp_config</a> *, cfg, <a class="code" href="../../d5/da5/astobj2_8h.html#a86d8d6c3c8866ed0a60121da055cd225">ao2_global_obj_ref</a>(<a class="code" href="../../d3/d4e/chan__console_8c.html#aa36e3e2c486b920b166c2d17c5242221">globals</a>), <a class="code" href="../../d5/da5/astobj2_8h.html#a6321ee982370c55ab3c24c72c562cbdd">ao2_cleanup</a>);</div><div class="line"><a name="l02098"></a><span class="lineno"> 2098</span>&#160;   <a class="code" href="../../d5/d60/utils_8h.html#a1604b4d72144dd3d9f7da668e90337e9">RAII_VAR</a>(<span class="keyword">struct</span> <a class="code" href="../../da/d00/structast__xmpp__client__config.html">ast_xmpp_client_config</a> *, clientcfg, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../d5/da5/astobj2_8h.html#a6321ee982370c55ab3c24c72c562cbdd">ao2_cleanup</a>);</div><div class="line"><a name="l02099"></a><span class="lineno"> 2099</span>&#160;   <span class="keywordtype">int</span> deleted = 0, isold = 0;</div><div class="line"><a name="l02100"></a><span class="lineno"> 2100</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d6/d73/structast__xmpp__message.html">ast_xmpp_message</a> *<a class="code" href="../../d8/d9e/structmessage.html">message</a> = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l02101"></a><span class="lineno"> 2101</span>&#160;</div><div class="line"><a name="l02102"></a><span class="lineno"> 2102</span>&#160;   <span class="keywordflow">if</span> (!cfg || !cfg-&gt;clients || !(clientcfg = <a class="code" href="../../dc/d6b/res__xmpp_8c.html#a14d10033fb3b97f06238940259f45266">xmpp_config_find</a>(cfg-&gt;clients, client-&gt;<a class="code" href="../../df/d42/structast__xmpp__client.html#ace9168767fc3707cf5f0a7d049682ba3">name</a>))) {</div><div class="line"><a name="l02103"></a><span class="lineno"> 2103</span>&#160;      <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l02104"></a><span class="lineno"> 2104</span>&#160;   }</div><div class="line"><a name="l02105"></a><span class="lineno"> 2105</span>&#160;</div><div class="line"><a name="l02106"></a><span class="lineno"> 2106</span>&#160;   <a class="code" href="../../df/d90/linkedlists_8h.html#a9140a4e4d781264fa9469c52b1adae40">AST_LIST_LOCK</a>(&amp;client-&gt;<a class="code" href="../../df/d42/structast__xmpp__client.html#a17d0e5a7ebe404ac9471b8e403708c66">messages</a>);</div><div class="line"><a name="l02107"></a><span class="lineno"> 2107</span>&#160;   <a class="code" href="../../df/d90/linkedlists_8h.html#aa5be52067bf16bdc7e56ca19b5ba858d">AST_LIST_TRAVERSE_SAFE_BEGIN</a>(&amp;client-&gt;<a class="code" href="../../df/d42/structast__xmpp__client.html#a17d0e5a7ebe404ac9471b8e403708c66">messages</a>, message, <a class="code" href="../../d6/d73/structast__xmpp__message.html#a819f07fb76703e722d125863b8763d14">list</a>) {</div><div class="line"><a name="l02108"></a><span class="lineno"> 2108</span>&#160;      <span class="keywordflow">if</span> (isold) {</div><div class="line"><a name="l02109"></a><span class="lineno"> 2109</span>&#160;         <span class="keywordflow">if</span> (!from || !strncasecmp(from, message-&gt;<a class="code" href="../../d6/d73/structast__xmpp__message.html#a765533dfc643627999c751f7e1514664">from</a>, strlen(from))) {</div><div class="line"><a name="l02110"></a><span class="lineno"> 2110</span>&#160;            <a class="code" href="../../df/d90/linkedlists_8h.html#aa8ac496fa9c717d5afb99a02e1e2760c">AST_LIST_REMOVE_CURRENT</a>(<a class="code" href="../../d6/d73/structast__xmpp__message.html#a819f07fb76703e722d125863b8763d14">list</a>);</div><div class="line"><a name="l02111"></a><span class="lineno"> 2111</span>&#160;            <a class="code" href="../../dc/d6b/res__xmpp_8c.html#abe0bf7c227d40c258b694eef9b7f7333">xmpp_message_destroy</a>(message);</div><div class="line"><a name="l02112"></a><span class="lineno"> 2112</span>&#160;            deleted++;</div><div class="line"><a name="l02113"></a><span class="lineno"> 2113</span>&#160;         }</div><div class="line"><a name="l02114"></a><span class="lineno"> 2114</span>&#160;      } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="../../de/df7/time_8h.html#a39af1febe8b93cb6f7cd59b76fc39e8f">ast_tvdiff_sec</a>(<a class="code" href="../../de/df7/time_8h.html#ad3899efb6f0e348556ef69f5b16aa7f7">ast_tvnow</a>(), message-&gt;<a class="code" href="../../d6/d73/structast__xmpp__message.html#ace5ad74ee812bf5ee2bec5d759022d0b">arrived</a>) &gt;= clientcfg-&gt;message_timeout) {</div><div class="line"><a name="l02115"></a><span class="lineno"> 2115</span>&#160;         isold = 1;</div><div class="line"><a name="l02116"></a><span class="lineno"> 2116</span>&#160;         <span class="keywordflow">if</span> (!from || !strncasecmp(from, message-&gt;<a class="code" href="../../d6/d73/structast__xmpp__message.html#a765533dfc643627999c751f7e1514664">from</a>, strlen(from))) {</div><div class="line"><a name="l02117"></a><span class="lineno"> 2117</span>&#160;            <a class="code" href="../../df/d90/linkedlists_8h.html#aa8ac496fa9c717d5afb99a02e1e2760c">AST_LIST_REMOVE_CURRENT</a>(<a class="code" href="../../d6/d73/structast__xmpp__message.html#a819f07fb76703e722d125863b8763d14">list</a>);</div><div class="line"><a name="l02118"></a><span class="lineno"> 2118</span>&#160;            <a class="code" href="../../dc/d6b/res__xmpp_8c.html#abe0bf7c227d40c258b694eef9b7f7333">xmpp_message_destroy</a>(message);</div><div class="line"><a name="l02119"></a><span class="lineno"> 2119</span>&#160;            deleted++;</div><div class="line"><a name="l02120"></a><span class="lineno"> 2120</span>&#160;         }</div><div class="line"><a name="l02121"></a><span class="lineno"> 2121</span>&#160;      }</div><div class="line"><a name="l02122"></a><span class="lineno"> 2122</span>&#160;   }</div><div class="line"><a name="l02123"></a><span class="lineno"> 2123</span>&#160;   <a class="code" href="../../df/d90/linkedlists_8h.html#a712c04b4493919a7052399cd30ee8fb9">AST_LIST_TRAVERSE_SAFE_END</a>;</div><div class="line"><a name="l02124"></a><span class="lineno"> 2124</span>&#160;   <a class="code" href="../../df/d90/linkedlists_8h.html#ab48cb9e1e612dd486b747ba1c5d68d01">AST_LIST_UNLOCK</a>(&amp;client-&gt;<a class="code" href="../../df/d42/structast__xmpp__client.html#a17d0e5a7ebe404ac9471b8e403708c66">messages</a>);</div><div class="line"><a name="l02125"></a><span class="lineno"> 2125</span>&#160;</div><div class="line"><a name="l02126"></a><span class="lineno"> 2126</span>&#160;   <span class="keywordflow">return</span> deleted;</div><div class="line"><a name="l02127"></a><span class="lineno"> 2127</span>&#160;}</div><div class="line"><a name="l02128"></a><span class="lineno"> 2128</span>&#160;</div><div class="line"><a name="l02129"></a><span class="lineno"><a class="line" href="../../dc/d6b/res__xmpp_8c.html#ad0a04b9fe7c226297a873eee644c9917"> 2129</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../dc/d6b/res__xmpp_8c.html#ad0a04b9fe7c226297a873eee644c9917">xmpp_send_cb</a>(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="../../df/da1/structast__msg.html">ast_msg</a> *msg, <span class="keyword">const</span> <span class="keywordtype">char</span> *to, <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="../../d6/d73/structast__xmpp__message.html#a765533dfc643627999c751f7e1514664">from</a>)</div><div class="line"><a name="l02130"></a><span class="lineno"> 2130</span>&#160;{</div><div class="line"><a name="l02131"></a><span class="lineno"> 2131</span>&#160;   <a class="code" href="../../d5/d60/utils_8h.html#a1604b4d72144dd3d9f7da668e90337e9">RAII_VAR</a>(<span class="keyword">struct</span> <a class="code" href="../../de/d1c/structxmpp__config.html">xmpp_config</a> *, cfg, <a class="code" href="../../d5/da5/astobj2_8h.html#a86d8d6c3c8866ed0a60121da055cd225">ao2_global_obj_ref</a>(<a class="code" href="../../d3/d4e/chan__console_8c.html#aa36e3e2c486b920b166c2d17c5242221">globals</a>), <a class="code" href="../../d5/da5/astobj2_8h.html#a6321ee982370c55ab3c24c72c562cbdd">ao2_cleanup</a>);</div><div class="line"><a name="l02132"></a><span class="lineno"> 2132</span>&#160;   <a class="code" href="../../d5/d60/utils_8h.html#a1604b4d72144dd3d9f7da668e90337e9">RAII_VAR</a>(<span class="keyword">struct</span> <a class="code" href="../../da/d00/structast__xmpp__client__config.html">ast_xmpp_client_config</a> *, clientcfg, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../d5/da5/astobj2_8h.html#a6321ee982370c55ab3c24c72c562cbdd">ao2_cleanup</a>);</div><div class="line"><a name="l02133"></a><span class="lineno"> 2133</span>&#160;   <span class="keywordtype">char</span> *sender, *dest;</div><div class="line"><a name="l02134"></a><span class="lineno"> 2134</span>&#160;   <span class="keywordtype">int</span> res;</div><div class="line"><a name="l02135"></a><span class="lineno"> 2135</span>&#160;</div><div class="line"><a name="l02136"></a><span class="lineno"> 2136</span>&#160;   sender = <a class="code" href="../../d8/d8a/astmm_8h.html#ab5f0750cc80ba337fdcbddea2d3a1ee6">ast_strdupa</a>(from);</div><div class="line"><a name="l02137"></a><span class="lineno"> 2137</span>&#160;   <a class="code" href="../../de/da3/include_2asterisk_2compat_8h.html#a40eca58273c74a20a17f137d18ba826c">strsep</a>(&amp;sender, <span class="stringliteral">&quot;:&quot;</span>);</div><div class="line"><a name="l02138"></a><span class="lineno"> 2138</span>&#160;   dest = <a class="code" href="../../d8/d8a/astmm_8h.html#ab5f0750cc80ba337fdcbddea2d3a1ee6">ast_strdupa</a>(to);</div><div class="line"><a name="l02139"></a><span class="lineno"> 2139</span>&#160;   <a class="code" href="../../de/da3/include_2asterisk_2compat_8h.html#a40eca58273c74a20a17f137d18ba826c">strsep</a>(&amp;dest, <span class="stringliteral">&quot;:&quot;</span>);</div><div class="line"><a name="l02140"></a><span class="lineno"> 2140</span>&#160;</div><div class="line"><a name="l02141"></a><span class="lineno"> 2141</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a>(sender)) {</div><div class="line"><a name="l02142"></a><span class="lineno"> 2142</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;MESSAGE(from) of &#39;%s&#39; invalid for XMPP\n&quot;</span>, from);</div><div class="line"><a name="l02143"></a><span class="lineno"> 2143</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l02144"></a><span class="lineno"> 2144</span>&#160;   }</div><div class="line"><a name="l02145"></a><span class="lineno"> 2145</span>&#160;</div><div class="line"><a name="l02146"></a><span class="lineno"> 2146</span>&#160;   <span class="keywordflow">if</span> (!cfg || !cfg-&gt;clients || !(clientcfg = <a class="code" href="../../dc/d6b/res__xmpp_8c.html#a14d10033fb3b97f06238940259f45266">xmpp_config_find</a>(cfg-&gt;clients, sender))) {</div><div class="line"><a name="l02147"></a><span class="lineno"> 2147</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Could not finder account to send from as &#39;%s&#39;\n&quot;</span>, sender);</div><div class="line"><a name="l02148"></a><span class="lineno"> 2148</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l02149"></a><span class="lineno"> 2149</span>&#160;   }</div><div class="line"><a name="l02150"></a><span class="lineno"> 2150</span>&#160;</div><div class="line"><a name="l02151"></a><span class="lineno"> 2151</span>&#160;   <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(1, <span class="stringliteral">&quot;Sending message to &#39;%s&#39; from &#39;%s&#39;\n&quot;</span>, dest, clientcfg-&gt;name);</div><div class="line"><a name="l02152"></a><span class="lineno"> 2152</span>&#160;</div><div class="line"><a name="l02153"></a><span class="lineno"> 2153</span>&#160;   <span class="keywordflow">if</span> ((res = <a class="code" href="../../dc/d6b/res__xmpp_8c.html#a21d05f7d76693ba1145973de7d3f0a03">ast_xmpp_client_send_message</a>(clientcfg-&gt;client, dest, <a class="code" href="../../d2/d0d/message_8h.html#abd98509b6e22ab33822ff3c7a2e35756">ast_msg_get_body</a>(msg))) != IKS_OK) {</div><div class="line"><a name="l02154"></a><span class="lineno"> 2154</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Failed to send XMPP message (%d).\n&quot;</span>, res);</div><div class="line"><a name="l02155"></a><span class="lineno"> 2155</span>&#160;   }</div><div class="line"><a name="l02156"></a><span class="lineno"> 2156</span>&#160;</div><div class="line"><a name="l02157"></a><span class="lineno"> 2157</span>&#160;   <span class="keywordflow">return</span> res == IKS_OK ? 0 : -1;</div><div class="line"><a name="l02158"></a><span class="lineno"> 2158</span>&#160;}</div><div class="line"><a name="l02159"></a><span class="lineno"> 2159</span>&#160;</div><div class="line"><a name="l02160"></a><span class="lineno"><a class="line" href="../../dc/d6b/res__xmpp_8c.html#adee47ce28cd17bbdc773df287fc062c5"> 2160</a></span>&#160;<span class="keyword">static</span> <span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="../../df/dfc/structast__msg__tech.html">ast_msg_tech</a> <a class="code" href="../../dc/d6b/res__xmpp_8c.html#adee47ce28cd17bbdc773df287fc062c5">msg_tech</a> = {</div><div class="line"><a name="l02161"></a><span class="lineno"> 2161</span>&#160;   .<a class="code" href="../../df/dfc/structast__msg__tech.html#acc128f98d9ceca227038c771308eff39">name</a> = <span class="stringliteral">&quot;xmpp&quot;</span>,</div><div class="line"><a name="l02162"></a><span class="lineno"> 2162</span>&#160;   .msg_send = <a class="code" href="../../dc/d6b/res__xmpp_8c.html#ad0a04b9fe7c226297a873eee644c9917">xmpp_send_cb</a>,</div><div class="line"><a name="l02163"></a><span class="lineno"> 2163</span>&#160;};</div><div class="line"><a name="l02164"></a><span class="lineno"> 2164</span>&#160;<span class="comment"></span></div><div class="line"><a name="l02165"></a><span class="lineno"> 2165</span>&#160;<span class="comment">/*! \brief Internal function which creates a buddy on a client */</span></div><div class="line"><a name="l02166"></a><span class="lineno"><a class="line" href="../../dc/d6b/res__xmpp_8c.html#a4c3a2b177d134ce8482f9a5751754931"> 2166</a></span>&#160;<span class="keyword">static</span> <span class="keyword">struct </span><a class="code" href="../../d5/d25/structast__xmpp__buddy.html">ast_xmpp_buddy</a> *<a class="code" href="../../dc/d6b/res__xmpp_8c.html#a4c3a2b177d134ce8482f9a5751754931">xmpp_client_create_buddy</a>(<span class="keyword">struct</span> <a class="code" href="../../d2/da9/structao2__container.html">ao2_container</a> *<a class="code" href="../../d0/d60/res__fax_8c.html#a7ea220e4d14b05876af4430e9832ce47">container</a>, <span class="keyword">const</span> <span class="keywordtype">char</span> *<span class="keywordtype">id</span>)</div><div class="line"><a name="l02167"></a><span class="lineno"> 2167</span>&#160;{</div><div class="line"><a name="l02168"></a><span class="lineno"> 2168</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d5/d25/structast__xmpp__buddy.html">ast_xmpp_buddy</a> *buddy;</div><div class="line"><a name="l02169"></a><span class="lineno"> 2169</span>&#160;</div><div class="line"><a name="l02170"></a><span class="lineno"> 2170</span>&#160;   <span class="keywordflow">if</span> (!(buddy = <a class="code" href="../../d5/da5/astobj2_8h.html#ae0422b60d8e25b6962b2d61ae4ddf724">ao2_alloc</a>(<span class="keyword">sizeof</span>(*buddy), <a class="code" href="../../dc/d6b/res__xmpp_8c.html#aa8360dfe4cb230e7c33bc302e2667111">xmpp_buddy_destructor</a>))) {</div><div class="line"><a name="l02171"></a><span class="lineno"> 2171</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l02172"></a><span class="lineno"> 2172</span>&#160;   }</div><div class="line"><a name="l02173"></a><span class="lineno"> 2173</span>&#160;</div><div class="line"><a name="l02174"></a><span class="lineno"> 2174</span>&#160;   buddy-&gt;<a class="code" href="../../d5/d25/structast__xmpp__buddy.html#ae3222a7c2c3040d71427c9a8b33ac38c">resources</a> = <a class="code" href="../../d5/da5/astobj2_8h.html#aefc16f8aa9087cbc5c55c70cf1dd41b2">ao2_container_alloc_hash</a>(<a class="code" href="../../d5/da5/astobj2_8h.html#a2cf7e3433f08351aafe3b0cd31edf7f8a8ccf751bd6749d062999469f0694e7ad">AO2_ALLOC_OPT_LOCK_MUTEX</a>, 0,</div><div class="line"><a name="l02175"></a><span class="lineno"> 2175</span>&#160;      <a class="code" href="../../dc/d6b/res__xmpp_8c.html#a23646819bacdf301428458ef3815cdd2">RESOURCE_BUCKETS</a>, <a class="code" href="../../dc/d6b/res__xmpp_8c.html#a82a61968c7b48011f5e9317d4e1a53a9">xmpp_resource_hash</a>, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../dc/d6b/res__xmpp_8c.html#a32325f89202eb73b55ba2c0402cc1bf1">xmpp_resource_cmp</a>);</div><div class="line"><a name="l02176"></a><span class="lineno"> 2176</span>&#160;   <span class="keywordflow">if</span> (!buddy-&gt;<a class="code" href="../../d5/d25/structast__xmpp__buddy.html#ae3222a7c2c3040d71427c9a8b33ac38c">resources</a>) {</div><div class="line"><a name="l02177"></a><span class="lineno"> 2177</span>&#160;      <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(buddy, -1);</div><div class="line"><a name="l02178"></a><span class="lineno"> 2178</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l02179"></a><span class="lineno"> 2179</span>&#160;   }</div><div class="line"><a name="l02180"></a><span class="lineno"> 2180</span>&#160;</div><div class="line"><a name="l02181"></a><span class="lineno"> 2181</span>&#160;   <a class="code" href="../../d6/d90/strings_8h.html#ac4040268f7b6ed77dfc49c7767626369">ast_copy_string</a>(buddy-&gt;<a class="code" href="../../d5/d25/structast__xmpp__buddy.html#aaf2ca63234b10470cfbba573d4c0ed01">id</a>, <span class="keywordtype">id</span>, <span class="keyword">sizeof</span>(buddy-&gt;<a class="code" href="../../d5/d25/structast__xmpp__buddy.html#aaf2ca63234b10470cfbba573d4c0ed01">id</a>));</div><div class="line"><a name="l02182"></a><span class="lineno"> 2182</span>&#160;</div><div class="line"><a name="l02183"></a><span class="lineno"> 2183</span>&#160;   <span class="comment">/* Assume we need to subscribe to get their presence until proven otherwise */</span></div><div class="line"><a name="l02184"></a><span class="lineno"> 2184</span>&#160;   buddy-&gt;<a class="code" href="../../d5/d25/structast__xmpp__buddy.html#a351d3567e908210c9fa479c52eafb95a">subscribe</a> = 1;</div><div class="line"><a name="l02185"></a><span class="lineno"> 2185</span>&#160;</div><div class="line"><a name="l02186"></a><span class="lineno"> 2186</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#a1ad9f122bcae95a470639402faa3d2ee">ao2_link</a>(container, buddy);</div><div class="line"><a name="l02187"></a><span class="lineno"> 2187</span>&#160;</div><div class="line"><a name="l02188"></a><span class="lineno"> 2188</span>&#160;   <span class="keywordflow">return</span> buddy;</div><div class="line"><a name="l02189"></a><span class="lineno"> 2189</span>&#160;}</div><div class="line"><a name="l02190"></a><span class="lineno"> 2190</span>&#160;<span class="comment"></span></div><div class="line"><a name="l02191"></a><span class="lineno"> 2191</span>&#160;<span class="comment">/*! \brief Helper function which unsubscribes a user and removes them from the roster */</span></div><div class="line"><a name="l02192"></a><span class="lineno"><a class="line" href="../../dc/d6b/res__xmpp_8c.html#a2bfb5c36cf34a171138fa7d15fed6001"> 2192</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../dc/d6b/res__xmpp_8c.html#a2bfb5c36cf34a171138fa7d15fed6001">xmpp_client_unsubscribe_user</a>(<span class="keyword">struct</span> <a class="code" href="../../df/d42/structast__xmpp__client.html">ast_xmpp_client</a> *client, <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="../../d8/dbc/structuser.html">user</a>)</div><div class="line"><a name="l02193"></a><span class="lineno"> 2193</span>&#160;{</div><div class="line"><a name="l02194"></a><span class="lineno"> 2194</span>&#160;   iks *iq, *query = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, *<a class="code" href="../../d8/d4f/test__config_8c.html#aecdc7cbd5dfa76493c0212caa55d706c">item</a> = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l02195"></a><span class="lineno"> 2195</span>&#160;</div><div class="line"><a name="l02196"></a><span class="lineno"> 2196</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../dc/d6b/res__xmpp_8c.html#a01f156e90984166f2bbcbcc5a4a6e582">ast_xmpp_client_send</a>(client, iks_make_s10n(IKS_TYPE_UNSUBSCRIBE, user,</div><div class="line"><a name="l02197"></a><span class="lineno"> 2197</span>&#160;                         <span class="stringliteral">&quot;Goodbye. Your status is no longer required.\n&quot;</span>))) {</div><div class="line"><a name="l02198"></a><span class="lineno"> 2198</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l02199"></a><span class="lineno"> 2199</span>&#160;   }</div><div class="line"><a name="l02200"></a><span class="lineno"> 2200</span>&#160;</div><div class="line"><a name="l02201"></a><span class="lineno"> 2201</span>&#160;   <span class="keywordflow">if</span> (!(iq = iks_new(<span class="stringliteral">&quot;iq&quot;</span>)) || !(query = iks_new(<span class="stringliteral">&quot;query&quot;</span>)) || !(item = iks_new(<span class="stringliteral">&quot;item&quot;</span>))) {</div><div class="line"><a name="l02202"></a><span class="lineno"> 2202</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Could not allocate memory for roster removal of &#39;%s&#39; from client &#39;%s&#39;\n&quot;</span>,</div><div class="line"><a name="l02203"></a><span class="lineno"> 2203</span>&#160;         user, client-&gt;<a class="code" href="../../df/d42/structast__xmpp__client.html#ace9168767fc3707cf5f0a7d049682ba3">name</a>);</div><div class="line"><a name="l02204"></a><span class="lineno"> 2204</span>&#160;      <span class="keywordflow">goto</span> <a class="code" href="../../dc/dbf/test__amihooks_8c.html#a5992b274cfdcacdbc1fa8347fd01ebde">done</a>;</div><div class="line"><a name="l02205"></a><span class="lineno"> 2205</span>&#160;   }</div><div class="line"><a name="l02206"></a><span class="lineno"> 2206</span>&#160;</div><div class="line"><a name="l02207"></a><span class="lineno"> 2207</span>&#160;   iks_insert_attrib(iq, <span class="stringliteral">&quot;from&quot;</span>, client-&gt;<a class="code" href="../../df/d42/structast__xmpp__client.html#af738439b96e613a471505eb1222ac406">jid</a>-&gt;full);</div><div class="line"><a name="l02208"></a><span class="lineno"> 2208</span>&#160;   iks_insert_attrib(iq, <span class="stringliteral">&quot;type&quot;</span>, <span class="stringliteral">&quot;set&quot;</span>);</div><div class="line"><a name="l02209"></a><span class="lineno"> 2209</span>&#160;   iks_insert_attrib(query, <span class="stringliteral">&quot;xmlns&quot;</span>, <span class="stringliteral">&quot;jabber:iq:roster&quot;</span>);</div><div class="line"><a name="l02210"></a><span class="lineno"> 2210</span>&#160;   iks_insert_node(iq, query);</div><div class="line"><a name="l02211"></a><span class="lineno"> 2211</span>&#160;   iks_insert_attrib(item, <span class="stringliteral">&quot;jid&quot;</span>, user);</div><div class="line"><a name="l02212"></a><span class="lineno"> 2212</span>&#160;   iks_insert_attrib(item, <span class="stringliteral">&quot;subscription&quot;</span>, <span class="stringliteral">&quot;remove&quot;</span>);</div><div class="line"><a name="l02213"></a><span class="lineno"> 2213</span>&#160;   iks_insert_node(query, item);</div><div class="line"><a name="l02214"></a><span class="lineno"> 2214</span>&#160;</div><div class="line"><a name="l02215"></a><span class="lineno"> 2215</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../dc/d6b/res__xmpp_8c.html#a01f156e90984166f2bbcbcc5a4a6e582">ast_xmpp_client_send</a>(client, iq)) {</div><div class="line"><a name="l02216"></a><span class="lineno"> 2216</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Could not send roster removal request of &#39;%s&#39; from client &#39;%s&#39;\n&quot;</span>,</div><div class="line"><a name="l02217"></a><span class="lineno"> 2217</span>&#160;         user, client-&gt;<a class="code" href="../../df/d42/structast__xmpp__client.html#ace9168767fc3707cf5f0a7d049682ba3">name</a>);</div><div class="line"><a name="l02218"></a><span class="lineno"> 2218</span>&#160;   }</div><div class="line"><a name="l02219"></a><span class="lineno"> 2219</span>&#160;</div><div class="line"><a name="l02220"></a><span class="lineno"> 2220</span>&#160;<a class="code" href="../../dc/dbf/test__amihooks_8c.html#a5992b274cfdcacdbc1fa8347fd01ebde">done</a>:</div><div class="line"><a name="l02221"></a><span class="lineno"> 2221</span>&#160;   iks_delete(item);</div><div class="line"><a name="l02222"></a><span class="lineno"> 2222</span>&#160;   iks_delete(query);</div><div class="line"><a name="l02223"></a><span class="lineno"> 2223</span>&#160;   iks_delete(iq);</div><div class="line"><a name="l02224"></a><span class="lineno"> 2224</span>&#160;</div><div class="line"><a name="l02225"></a><span class="lineno"> 2225</span>&#160;   <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l02226"></a><span class="lineno"> 2226</span>&#160;}</div><div class="line"><a name="l02227"></a><span class="lineno"> 2227</span>&#160;<span class="comment"></span></div><div class="line"><a name="l02228"></a><span class="lineno"> 2228</span>&#160;<span class="comment">/*! \brief Callback function which subscribes to a user if needed */</span></div><div class="line"><a name="l02229"></a><span class="lineno"><a class="line" href="../../dc/d6b/res__xmpp_8c.html#ad7f5dc1236b0df5dde8be82a376d9c38"> 2229</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../dc/d6b/res__xmpp_8c.html#ad7f5dc1236b0df5dde8be82a376d9c38">xmpp_client_subscribe_user</a>(<span class="keywordtype">void</span> *obj, <span class="keywordtype">void</span> *arg, <span class="keywordtype">int</span> flags)</div><div class="line"><a name="l02230"></a><span class="lineno"> 2230</span>&#160;{</div><div class="line"><a name="l02231"></a><span class="lineno"> 2231</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d5/d25/structast__xmpp__buddy.html">ast_xmpp_buddy</a> *buddy = obj;</div><div class="line"><a name="l02232"></a><span class="lineno"> 2232</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../df/d42/structast__xmpp__client.html">ast_xmpp_client</a> *client = arg;</div><div class="line"><a name="l02233"></a><span class="lineno"> 2233</span>&#160;</div><div class="line"><a name="l02234"></a><span class="lineno"> 2234</span>&#160;   <span class="keywordflow">if</span> (!buddy-&gt;<a class="code" href="../../d5/d25/structast__xmpp__buddy.html#a351d3567e908210c9fa479c52eafb95a">subscribe</a>) {</div><div class="line"><a name="l02235"></a><span class="lineno"> 2235</span>&#160;      <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l02236"></a><span class="lineno"> 2236</span>&#160;   }</div><div class="line"><a name="l02237"></a><span class="lineno"> 2237</span>&#160;</div><div class="line"><a name="l02238"></a><span class="lineno"> 2238</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../dc/d6b/res__xmpp_8c.html#a01f156e90984166f2bbcbcc5a4a6e582">ast_xmpp_client_send</a>(client, iks_make_s10n(IKS_TYPE_SUBSCRIBE, buddy-&gt;<a class="code" href="../../d5/d25/structast__xmpp__buddy.html#aaf2ca63234b10470cfbba573d4c0ed01">id</a>,</div><div class="line"><a name="l02239"></a><span class="lineno"> 2239</span>&#160;                         <span class="stringliteral">&quot;Greetings! I am the Asterisk Open Source PBX and I want to subscribe to your presence\n&quot;</span>))) {</div><div class="line"><a name="l02240"></a><span class="lineno"> 2240</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Could not send subscription for &#39;%s&#39; on client &#39;%s&#39;\n&quot;</span>,</div><div class="line"><a name="l02241"></a><span class="lineno"> 2241</span>&#160;         buddy-&gt;<a class="code" href="../../d5/d25/structast__xmpp__buddy.html#aaf2ca63234b10470cfbba573d4c0ed01">id</a>, client-&gt;<a class="code" href="../../df/d42/structast__xmpp__client.html#ace9168767fc3707cf5f0a7d049682ba3">name</a>);</div><div class="line"><a name="l02242"></a><span class="lineno"> 2242</span>&#160;   }</div><div class="line"><a name="l02243"></a><span class="lineno"> 2243</span>&#160;</div><div class="line"><a name="l02244"></a><span class="lineno"> 2244</span>&#160;   buddy-&gt;<a class="code" href="../../d5/d25/structast__xmpp__buddy.html#a351d3567e908210c9fa479c52eafb95a">subscribe</a> = 0;</div><div class="line"><a name="l02245"></a><span class="lineno"> 2245</span>&#160;</div><div class="line"><a name="l02246"></a><span class="lineno"> 2246</span>&#160;   <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l02247"></a><span class="lineno"> 2247</span>&#160;}</div><div class="line"><a name="l02248"></a><span class="lineno"> 2248</span>&#160;<span class="comment"></span></div><div class="line"><a name="l02249"></a><span class="lineno"> 2249</span>&#160;<span class="comment">/*! \brief Hook function called when roster is received from server */</span></div><div class="line"><a name="l02250"></a><span class="lineno"><a class="line" href="../../dc/d6b/res__xmpp_8c.html#a697e78d60cfc0ddc36c6a9566b74bdac"> 2250</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../dc/d6b/res__xmpp_8c.html#a697e78d60cfc0ddc36c6a9566b74bdac">xmpp_roster_hook</a>(<span class="keywordtype">void</span> *data, ikspak *pak)</div><div class="line"><a name="l02251"></a><span class="lineno"> 2251</span>&#160;{</div><div class="line"><a name="l02252"></a><span class="lineno"> 2252</span>&#160;   <a class="code" href="../../d5/d60/utils_8h.html#a1604b4d72144dd3d9f7da668e90337e9">RAII_VAR</a>(<span class="keyword">struct</span> <a class="code" href="../../de/d1c/structxmpp__config.html">xmpp_config</a> *, cfg, <a class="code" href="../../d5/da5/astobj2_8h.html#a86d8d6c3c8866ed0a60121da055cd225">ao2_global_obj_ref</a>(<a class="code" href="../../d3/d4e/chan__console_8c.html#aa36e3e2c486b920b166c2d17c5242221">globals</a>), <a class="code" href="../../d5/da5/astobj2_8h.html#a6321ee982370c55ab3c24c72c562cbdd">ao2_cleanup</a>);</div><div class="line"><a name="l02253"></a><span class="lineno"> 2253</span>&#160;   <a class="code" href="../../d5/d60/utils_8h.html#a1604b4d72144dd3d9f7da668e90337e9">RAII_VAR</a>(<span class="keyword">struct</span> <a class="code" href="../../da/d00/structast__xmpp__client__config.html">ast_xmpp_client_config</a> *, clientcfg, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../d5/da5/astobj2_8h.html#a6321ee982370c55ab3c24c72c562cbdd">ao2_cleanup</a>);</div><div class="line"><a name="l02254"></a><span class="lineno"> 2254</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../df/d42/structast__xmpp__client.html">ast_xmpp_client</a> *client = data;</div><div class="line"><a name="l02255"></a><span class="lineno"> 2255</span>&#160;   iks *<a class="code" href="../../d8/d4f/test__config_8c.html#aecdc7cbd5dfa76493c0212caa55d706c">item</a>;</div><div class="line"><a name="l02256"></a><span class="lineno"> 2256</span>&#160;</div><div class="line"><a name="l02257"></a><span class="lineno"> 2257</span>&#160;   <span class="keywordflow">if</span> (!cfg || !cfg-&gt;clients || !(clientcfg = <a class="code" href="../../dc/d6b/res__xmpp_8c.html#a14d10033fb3b97f06238940259f45266">xmpp_config_find</a>(cfg-&gt;clients, client-&gt;<a class="code" href="../../df/d42/structast__xmpp__client.html#ace9168767fc3707cf5f0a7d049682ba3">name</a>))) {</div><div class="line"><a name="l02258"></a><span class="lineno"> 2258</span>&#160;      <span class="keywordflow">return</span> IKS_FILTER_EAT;</div><div class="line"><a name="l02259"></a><span class="lineno"> 2259</span>&#160;   }</div><div class="line"><a name="l02260"></a><span class="lineno"> 2260</span>&#160;</div><div class="line"><a name="l02261"></a><span class="lineno"> 2261</span>&#160;   <span class="keywordflow">for</span> (item = iks_child(pak-&gt;query); item; item = iks_next(item)) {</div><div class="line"><a name="l02262"></a><span class="lineno"> 2262</span>&#160;      <span class="keyword">struct </span><a class="code" href="../../d5/d25/structast__xmpp__buddy.html">ast_xmpp_buddy</a> *buddy;</div><div class="line"><a name="l02263"></a><span class="lineno"> 2263</span>&#160;</div><div class="line"><a name="l02264"></a><span class="lineno"> 2264</span>&#160;      <span class="keywordflow">if</span> (iks_strcmp(iks_name(item), <span class="stringliteral">&quot;item&quot;</span>)) {</div><div class="line"><a name="l02265"></a><span class="lineno"> 2265</span>&#160;         <span class="keywordflow">continue</span>;</div><div class="line"><a name="l02266"></a><span class="lineno"> 2266</span>&#160;      }</div><div class="line"><a name="l02267"></a><span class="lineno"> 2267</span>&#160;</div><div class="line"><a name="l02268"></a><span class="lineno"> 2268</span>&#160;      <span class="keywordflow">if</span> (!(buddy = <a class="code" href="../../d5/da5/astobj2_8h.html#a911e0703891a9a7aaf73978152092586">ao2_find</a>(client-&gt;<a class="code" href="../../df/d42/structast__xmpp__client.html#a5082987d3e1eac5f625574800bb72c2c">buddies</a>, iks_find_attrib(item, <span class="stringliteral">&quot;jid&quot;</span>), <a class="code" href="../../d5/da5/astobj2_8h.html#a22f40c733a085f259af94e864ebaa09a">OBJ_KEY</a>))) {</div><div class="line"><a name="l02269"></a><span class="lineno"> 2269</span>&#160;         <span class="keywordflow">if</span> (<a class="code" href="../../d5/d60/utils_8h.html#a00d4c9254c9827d6fa44f17a326744a5">ast_test_flag</a>(&amp;clientcfg-&gt;flags, <a class="code" href="../../dc/d6b/res__xmpp_8c.html#aa3759d2ddcc12f3f5ef5a8a3ffa4a4dfa56b0aacbe6240e563e08310d1b6c8ce2">XMPP_AUTOPRUNE</a>)) {</div><div class="line"><a name="l02270"></a><span class="lineno"> 2270</span>&#160;            <span class="comment">/* The buddy has not been specified in the configuration file, we no longer</span></div><div class="line"><a name="l02271"></a><span class="lineno"> 2271</span>&#160;<span class="comment">             * want them on our buddy list or to receive their presence. */</span></div><div class="line"><a name="l02272"></a><span class="lineno"> 2272</span>&#160;            <span class="keywordflow">if</span> (<a class="code" href="../../dc/d6b/res__xmpp_8c.html#a2bfb5c36cf34a171138fa7d15fed6001">xmpp_client_unsubscribe_user</a>(client, iks_find_attrib(item, <span class="stringliteral">&quot;jid&quot;</span>))) {</div><div class="line"><a name="l02273"></a><span class="lineno"> 2273</span>&#160;               <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Could not unsubscribe user &#39;%s&#39; on client &#39;%s&#39;\n&quot;</span>,</div><div class="line"><a name="l02274"></a><span class="lineno"> 2274</span>&#160;                  iks_find_attrib(item, <span class="stringliteral">&quot;jid&quot;</span>), client-&gt;<a class="code" href="../../df/d42/structast__xmpp__client.html#ace9168767fc3707cf5f0a7d049682ba3">name</a>);</div><div class="line"><a name="l02275"></a><span class="lineno"> 2275</span>&#160;            }</div><div class="line"><a name="l02276"></a><span class="lineno"> 2276</span>&#160;            <span class="keywordflow">continue</span>;</div><div class="line"><a name="l02277"></a><span class="lineno"> 2277</span>&#160;         }</div><div class="line"><a name="l02278"></a><span class="lineno"> 2278</span>&#160;</div><div class="line"><a name="l02279"></a><span class="lineno"> 2279</span>&#160;         <span class="keywordflow">if</span> (!(buddy = <a class="code" href="../../dc/d6b/res__xmpp_8c.html#a4c3a2b177d134ce8482f9a5751754931">xmpp_client_create_buddy</a>(client-&gt;<a class="code" href="../../df/d42/structast__xmpp__client.html#a5082987d3e1eac5f625574800bb72c2c">buddies</a>, iks_find_attrib(item, <span class="stringliteral">&quot;jid&quot;</span>)))) {</div><div class="line"><a name="l02280"></a><span class="lineno"> 2280</span>&#160;            <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Could not allocate buddy &#39;%s&#39; on client &#39;%s&#39;\n&quot;</span>, iks_find_attrib(item, <span class="stringliteral">&quot;jid&quot;</span>),</div><div class="line"><a name="l02281"></a><span class="lineno"> 2281</span>&#160;               client-&gt;<a class="code" href="../../df/d42/structast__xmpp__client.html#ace9168767fc3707cf5f0a7d049682ba3">name</a>);</div><div class="line"><a name="l02282"></a><span class="lineno"> 2282</span>&#160;            <span class="keywordflow">continue</span>;</div><div class="line"><a name="l02283"></a><span class="lineno"> 2283</span>&#160;         }</div><div class="line"><a name="l02284"></a><span class="lineno"> 2284</span>&#160;      }</div><div class="line"><a name="l02285"></a><span class="lineno"> 2285</span>&#160;</div><div class="line"><a name="l02286"></a><span class="lineno"> 2286</span>&#160;      <span class="comment">/* Determine if we need to subscribe to their presence or not */</span></div><div class="line"><a name="l02287"></a><span class="lineno"> 2287</span>&#160;      <span class="keywordflow">if</span> (!iks_strcmp(iks_find_attrib(item, <span class="stringliteral">&quot;subscription&quot;</span>), <span class="stringliteral">&quot;none&quot;</span>) ||</div><div class="line"><a name="l02288"></a><span class="lineno"> 2288</span>&#160;          !iks_strcmp(iks_find_attrib(item, <span class="stringliteral">&quot;subscription&quot;</span>), <span class="stringliteral">&quot;from&quot;</span>)) {</div><div class="line"><a name="l02289"></a><span class="lineno"> 2289</span>&#160;         buddy-&gt;<a class="code" href="../../d5/d25/structast__xmpp__buddy.html#a351d3567e908210c9fa479c52eafb95a">subscribe</a> = 1;</div><div class="line"><a name="l02290"></a><span class="lineno"> 2290</span>&#160;      } <span class="keywordflow">else</span> {</div><div class="line"><a name="l02291"></a><span class="lineno"> 2291</span>&#160;         buddy-&gt;<a class="code" href="../../d5/d25/structast__xmpp__buddy.html#a351d3567e908210c9fa479c52eafb95a">subscribe</a> = 0;</div><div class="line"><a name="l02292"></a><span class="lineno"> 2292</span>&#160;      }</div><div class="line"><a name="l02293"></a><span class="lineno"> 2293</span>&#160;</div><div class="line"><a name="l02294"></a><span class="lineno"> 2294</span>&#160;      <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(buddy, -1);</div><div class="line"><a name="l02295"></a><span class="lineno"> 2295</span>&#160;   }</div><div class="line"><a name="l02296"></a><span class="lineno"> 2296</span>&#160;</div><div class="line"><a name="l02297"></a><span class="lineno"> 2297</span>&#160;   <span class="comment">/* If autoregister is enabled we need to go through every buddy that we need to subscribe to and do so */</span></div><div class="line"><a name="l02298"></a><span class="lineno"> 2298</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d5/d60/utils_8h.html#a00d4c9254c9827d6fa44f17a326744a5">ast_test_flag</a>(&amp;clientcfg-&gt;flags, <a class="code" href="../../dc/d6b/res__xmpp_8c.html#aa3759d2ddcc12f3f5ef5a8a3ffa4a4dfa18ce12342ffe1b2f00bb53be6a87665d">XMPP_AUTOREGISTER</a>)) {</div><div class="line"><a name="l02299"></a><span class="lineno"> 2299</span>&#160;      <a class="code" href="../../d5/da5/astobj2_8h.html#a47857055118a703ae87ea5ebaf4842ed">ao2_callback</a>(client-&gt;<a class="code" href="../../df/d42/structast__xmpp__client.html#a5082987d3e1eac5f625574800bb72c2c">buddies</a>, <a class="code" href="../../d5/da5/astobj2_8h.html#ad9d009e87e737af900825b36db55a35ca5fc59b193d86a0a8ddfe866304be829d">OBJ_NODATA</a> | <a class="code" href="../../d5/da5/astobj2_8h.html#ad9d009e87e737af900825b36db55a35ca614744a4d36b3189d4ab5b02c8645d47">OBJ_MULTIPLE</a>, <a class="code" href="../../dc/d6b/res__xmpp_8c.html#ad7f5dc1236b0df5dde8be82a376d9c38">xmpp_client_subscribe_user</a>, client);</div><div class="line"><a name="l02300"></a><span class="lineno"> 2300</span>&#160;   }</div><div class="line"><a name="l02301"></a><span class="lineno"> 2301</span>&#160;</div><div class="line"><a name="l02302"></a><span class="lineno"> 2302</span>&#160;   <a class="code" href="../../dc/d6b/res__xmpp_8c.html#ac515389ec6c63a8b3bbd094ede0d7c4d">xmpp_client_change_state</a>(client, <a class="code" href="../../da/da0/xmpp_8h.html#ae37d560c438576bdcb47347088225ee6af75b0231e0c9888c9a6c5374abf7527f">XMPP_STATE_CONNECTED</a>);</div><div class="line"><a name="l02303"></a><span class="lineno"> 2303</span>&#160;</div><div class="line"><a name="l02304"></a><span class="lineno"> 2304</span>&#160;   <span class="keywordflow">return</span> IKS_FILTER_EAT;</div><div class="line"><a name="l02305"></a><span class="lineno"> 2305</span>&#160;}</div><div class="line"><a name="l02306"></a><span class="lineno"> 2306</span>&#160;<span class="comment"></span></div><div class="line"><a name="l02307"></a><span class="lineno"> 2307</span>&#160;<span class="comment">/*! \brief Internal function which changes the presence status of an XMPP client */</span></div><div class="line"><a name="l02308"></a><span class="lineno"><a class="line" href="../../dc/d6b/res__xmpp_8c.html#a8f64e805d3ad98e99a03d77bbdb84bed"> 2308</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../dc/d6b/res__xmpp_8c.html#a8f64e805d3ad98e99a03d77bbdb84bed">xmpp_client_set_presence</a>(<span class="keyword">struct</span> <a class="code" href="../../df/d42/structast__xmpp__client.html">ast_xmpp_client</a> *client, <span class="keyword">const</span> <span class="keywordtype">char</span> *to, <span class="keyword">const</span> <span class="keywordtype">char</span> *from, <span class="keywordtype">int</span> level, <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="../../d0/d29/cdr__mysql_8c.html#a787f82faccb7c1f40a2539a14855601b">desc</a>)</div><div class="line"><a name="l02309"></a><span class="lineno"> 2309</span>&#160;{</div><div class="line"><a name="l02310"></a><span class="lineno"> 2310</span>&#160;   <a class="code" href="../../d5/d60/utils_8h.html#a1604b4d72144dd3d9f7da668e90337e9">RAII_VAR</a>(<span class="keyword">struct</span> <a class="code" href="../../de/d1c/structxmpp__config.html">xmpp_config</a> *, cfg, <a class="code" href="../../d5/da5/astobj2_8h.html#a86d8d6c3c8866ed0a60121da055cd225">ao2_global_obj_ref</a>(<a class="code" href="../../d3/d4e/chan__console_8c.html#aa36e3e2c486b920b166c2d17c5242221">globals</a>), <a class="code" href="../../d5/da5/astobj2_8h.html#a6321ee982370c55ab3c24c72c562cbdd">ao2_cleanup</a>);</div><div class="line"><a name="l02311"></a><span class="lineno"> 2311</span>&#160;   <a class="code" href="../../d5/d60/utils_8h.html#a1604b4d72144dd3d9f7da668e90337e9">RAII_VAR</a>(<span class="keyword">struct</span> <a class="code" href="../../da/d00/structast__xmpp__client__config.html">ast_xmpp_client_config</a> *, clientcfg, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../d5/da5/astobj2_8h.html#a6321ee982370c55ab3c24c72c562cbdd">ao2_cleanup</a>);</div><div class="line"><a name="l02312"></a><span class="lineno"> 2312</span>&#160;   iks *presence = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, *cnode = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, *<a class="code" href="../../d9/d47/cdr__beanstalkd_8c.html#acec9ce2df15222151ad66fcb1d74eb9f">priority</a> = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l02313"></a><span class="lineno"> 2313</span>&#160;   <span class="keywordtype">char</span> priorityS[10];</div><div class="line"><a name="l02314"></a><span class="lineno"> 2314</span>&#160;</div><div class="line"><a name="l02315"></a><span class="lineno"> 2315</span>&#160;   <span class="keywordflow">if</span> (!cfg || !cfg-&gt;clients || !(clientcfg = <a class="code" href="../../dc/d6b/res__xmpp_8c.html#a14d10033fb3b97f06238940259f45266">xmpp_config_find</a>(cfg-&gt;clients, client-&gt;<a class="code" href="../../df/d42/structast__xmpp__client.html#ace9168767fc3707cf5f0a7d049682ba3">name</a>)) ||</div><div class="line"><a name="l02316"></a><span class="lineno"> 2316</span>&#160;       !(presence = iks_make_pres(level, desc)) || !(cnode = iks_new(<span class="stringliteral">&quot;c&quot;</span>)) || !(priority = iks_new(<span class="stringliteral">&quot;priority&quot;</span>))) {</div><div class="line"><a name="l02317"></a><span class="lineno"> 2317</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Unable to allocate stanzas for setting presence status for client &#39;%s&#39;\n&quot;</span>, client-&gt;<a class="code" href="../../df/d42/structast__xmpp__client.html#ace9168767fc3707cf5f0a7d049682ba3">name</a>);</div><div class="line"><a name="l02318"></a><span class="lineno"> 2318</span>&#160;      <span class="keywordflow">goto</span> <a class="code" href="../../dc/dbf/test__amihooks_8c.html#a5992b274cfdcacdbc1fa8347fd01ebde">done</a>;</div><div class="line"><a name="l02319"></a><span class="lineno"> 2319</span>&#160;   }</div><div class="line"><a name="l02320"></a><span class="lineno"> 2320</span>&#160;</div><div class="line"><a name="l02321"></a><span class="lineno"> 2321</span>&#160;   <span class="keywordflow">if</span> (!<a class="code" href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a>(to)) {</div><div class="line"><a name="l02322"></a><span class="lineno"> 2322</span>&#160;      iks_insert_attrib(presence, <span class="stringliteral">&quot;to&quot;</span>, to);</div><div class="line"><a name="l02323"></a><span class="lineno"> 2323</span>&#160;   }</div><div class="line"><a name="l02324"></a><span class="lineno"> 2324</span>&#160;</div><div class="line"><a name="l02325"></a><span class="lineno"> 2325</span>&#160;   <span class="keywordflow">if</span> (!<a class="code" href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a>(from)) {</div><div class="line"><a name="l02326"></a><span class="lineno"> 2326</span>&#160;      iks_insert_attrib(presence, <span class="stringliteral">&quot;from&quot;</span>, from);</div><div class="line"><a name="l02327"></a><span class="lineno"> 2327</span>&#160;   }</div><div class="line"><a name="l02328"></a><span class="lineno"> 2328</span>&#160;</div><div class="line"><a name="l02329"></a><span class="lineno"> 2329</span>&#160;   snprintf(priorityS, <span class="keyword">sizeof</span>(priorityS), <span class="stringliteral">&quot;%d&quot;</span>, clientcfg-&gt;priority);</div><div class="line"><a name="l02330"></a><span class="lineno"> 2330</span>&#160;   iks_insert_cdata(priority, priorityS, strlen(priorityS));</div><div class="line"><a name="l02331"></a><span class="lineno"> 2331</span>&#160;   iks_insert_node(presence, priority);</div><div class="line"><a name="l02332"></a><span class="lineno"> 2332</span>&#160;   iks_insert_attrib(cnode, <span class="stringliteral">&quot;node&quot;</span>, <span class="stringliteral">&quot;http://www.asterisk.org/xmpp/client/caps&quot;</span>);</div><div class="line"><a name="l02333"></a><span class="lineno"> 2333</span>&#160;   iks_insert_attrib(cnode, <span class="stringliteral">&quot;ver&quot;</span>, <span class="stringliteral">&quot;asterisk-xmpp&quot;</span>);</div><div class="line"><a name="l02334"></a><span class="lineno"> 2334</span>&#160;   iks_insert_attrib(cnode, <span class="stringliteral">&quot;ext&quot;</span>, <span class="stringliteral">&quot;voice-v1 video-v1 camera-v1&quot;</span>);</div><div class="line"><a name="l02335"></a><span class="lineno"> 2335</span>&#160;   iks_insert_attrib(cnode, <span class="stringliteral">&quot;xmlns&quot;</span>, <span class="stringliteral">&quot;http://jabber.org/protocol/caps&quot;</span>);</div><div class="line"><a name="l02336"></a><span class="lineno"> 2336</span>&#160;   iks_insert_node(presence, cnode);</div><div class="line"><a name="l02337"></a><span class="lineno"> 2337</span>&#160;   <a class="code" href="../../dc/d6b/res__xmpp_8c.html#a01f156e90984166f2bbcbcc5a4a6e582">ast_xmpp_client_send</a>(client, presence);</div><div class="line"><a name="l02338"></a><span class="lineno"> 2338</span>&#160;</div><div class="line"><a name="l02339"></a><span class="lineno"> 2339</span>&#160;<a class="code" href="../../dc/dbf/test__amihooks_8c.html#a5992b274cfdcacdbc1fa8347fd01ebde">done</a>:</div><div class="line"><a name="l02340"></a><span class="lineno"> 2340</span>&#160;   iks_delete(cnode);</div><div class="line"><a name="l02341"></a><span class="lineno"> 2341</span>&#160;   iks_delete(presence);</div><div class="line"><a name="l02342"></a><span class="lineno"> 2342</span>&#160;   iks_delete(priority);</div><div class="line"><a name="l02343"></a><span class="lineno"> 2343</span>&#160;}</div><div class="line"><a name="l02344"></a><span class="lineno"> 2344</span>&#160;<span class="comment"></span></div><div class="line"><a name="l02345"></a><span class="lineno"> 2345</span>&#160;<span class="comment">/*! \brief Hook function called when client receives a service discovery get message */</span></div><div class="line"><a name="l02346"></a><span class="lineno"><a class="line" href="../../dc/d6b/res__xmpp_8c.html#a187f3edf503d63cc794aa07e4c2013dc"> 2346</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../dc/d6b/res__xmpp_8c.html#a187f3edf503d63cc794aa07e4c2013dc">xmpp_client_service_discovery_get_hook</a>(<span class="keywordtype">void</span> *data, ikspak *pak)</div><div class="line"><a name="l02347"></a><span class="lineno"> 2347</span>&#160;{</div><div class="line"><a name="l02348"></a><span class="lineno"> 2348</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../df/d42/structast__xmpp__client.html">ast_xmpp_client</a> *client = data;</div><div class="line"><a name="l02349"></a><span class="lineno"> 2349</span>&#160;   iks *iq, *disco = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, *ident = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, *google = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, *jingle = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, *ice = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, *rtp = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, *audio = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, *video = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, *query = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l02350"></a><span class="lineno"> 2350</span>&#160;</div><div class="line"><a name="l02351"></a><span class="lineno"> 2351</span>&#160;   <span class="keywordflow">if</span> (!(iq = iks_new(<span class="stringliteral">&quot;iq&quot;</span>)) || !(query = iks_new(<span class="stringliteral">&quot;query&quot;</span>)) || !(ident = iks_new(<span class="stringliteral">&quot;identity&quot;</span>)) || !(disco = iks_new(<span class="stringliteral">&quot;feature&quot;</span>)) ||</div><div class="line"><a name="l02352"></a><span class="lineno"> 2352</span>&#160;       !(google = iks_new(<span class="stringliteral">&quot;feature&quot;</span>)) || !(jingle = iks_new(<span class="stringliteral">&quot;feature&quot;</span>)) || !(ice = iks_new(<span class="stringliteral">&quot;feature&quot;</span>)) || !(rtp = iks_new(<span class="stringliteral">&quot;feature&quot;</span>)) ||</div><div class="line"><a name="l02353"></a><span class="lineno"> 2353</span>&#160;       !(audio = iks_new(<span class="stringliteral">&quot;feature&quot;</span>)) || !(video = iks_new(<span class="stringliteral">&quot;feature&quot;</span>))) {</div><div class="line"><a name="l02354"></a><span class="lineno"> 2354</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Could not allocate memory for responding to service discovery request from &#39;%s&#39; on client &#39;%s&#39;\n&quot;</span>,</div><div class="line"><a name="l02355"></a><span class="lineno"> 2355</span>&#160;         pak-&gt;from-&gt;full, client-&gt;<a class="code" href="../../df/d42/structast__xmpp__client.html#ace9168767fc3707cf5f0a7d049682ba3">name</a>);</div><div class="line"><a name="l02356"></a><span class="lineno"> 2356</span>&#160;      <span class="keywordflow">goto</span> <a class="code" href="../../dd/d7c/eagi__proxy_8c.html#a8fd806ad19b8f5513a4cf18cbf77532c">end</a>;</div><div class="line"><a name="l02357"></a><span class="lineno"> 2357</span>&#160;   }</div><div class="line"><a name="l02358"></a><span class="lineno"> 2358</span>&#160;</div><div class="line"><a name="l02359"></a><span class="lineno"> 2359</span>&#160;   iks_insert_attrib(iq, <span class="stringliteral">&quot;from&quot;</span>, client-&gt;<a class="code" href="../../df/d42/structast__xmpp__client.html#af738439b96e613a471505eb1222ac406">jid</a>-&gt;full);</div><div class="line"><a name="l02360"></a><span class="lineno"> 2360</span>&#160;</div><div class="line"><a name="l02361"></a><span class="lineno"> 2361</span>&#160;   <span class="keywordflow">if</span> (pak-&gt;from) {</div><div class="line"><a name="l02362"></a><span class="lineno"> 2362</span>&#160;      iks_insert_attrib(iq, <span class="stringliteral">&quot;to&quot;</span>, pak-&gt;from-&gt;full);</div><div class="line"><a name="l02363"></a><span class="lineno"> 2363</span>&#160;   }</div><div class="line"><a name="l02364"></a><span class="lineno"> 2364</span>&#160;</div><div class="line"><a name="l02365"></a><span class="lineno"> 2365</span>&#160;   iks_insert_attrib(iq, <span class="stringliteral">&quot;type&quot;</span>, <span class="stringliteral">&quot;result&quot;</span>);</div><div class="line"><a name="l02366"></a><span class="lineno"> 2366</span>&#160;   iks_insert_attrib(iq, <span class="stringliteral">&quot;id&quot;</span>, pak-&gt;id);</div><div class="line"><a name="l02367"></a><span class="lineno"> 2367</span>&#160;   iks_insert_attrib(query, <span class="stringliteral">&quot;xmlns&quot;</span>, <span class="stringliteral">&quot;http://jabber.org/protocol/disco#info&quot;</span>);</div><div class="line"><a name="l02368"></a><span class="lineno"> 2368</span>&#160;   iks_insert_attrib(ident, <span class="stringliteral">&quot;category&quot;</span>, <span class="stringliteral">&quot;client&quot;</span>);</div><div class="line"><a name="l02369"></a><span class="lineno"> 2369</span>&#160;   iks_insert_attrib(ident, <span class="stringliteral">&quot;type&quot;</span>, <span class="stringliteral">&quot;pc&quot;</span>);</div><div class="line"><a name="l02370"></a><span class="lineno"> 2370</span>&#160;   iks_insert_attrib(ident, <span class="stringliteral">&quot;name&quot;</span>, <span class="stringliteral">&quot;asterisk&quot;</span>);</div><div class="line"><a name="l02371"></a><span class="lineno"> 2371</span>&#160;   iks_insert_attrib(disco, <span class="stringliteral">&quot;var&quot;</span>, <span class="stringliteral">&quot;http://jabber.org/protocol/disco#info&quot;</span>);</div><div class="line"><a name="l02372"></a><span class="lineno"> 2372</span>&#160;</div><div class="line"><a name="l02373"></a><span class="lineno"> 2373</span>&#160;   iks_insert_attrib(google, <span class="stringliteral">&quot;var&quot;</span>, <span class="stringliteral">&quot;http://www.google.com/xmpp/protocol/voice/v1&quot;</span>);</div><div class="line"><a name="l02374"></a><span class="lineno"> 2374</span>&#160;   iks_insert_attrib(jingle, <span class="stringliteral">&quot;var&quot;</span>, <span class="stringliteral">&quot;urn:xmpp:jingle:1&quot;</span>);</div><div class="line"><a name="l02375"></a><span class="lineno"> 2375</span>&#160;   iks_insert_attrib(ice, <span class="stringliteral">&quot;var&quot;</span>, <span class="stringliteral">&quot;urn:xmpp:jingle:transports:ice-udp:1&quot;</span>);</div><div class="line"><a name="l02376"></a><span class="lineno"> 2376</span>&#160;   iks_insert_attrib(rtp, <span class="stringliteral">&quot;var&quot;</span>, <span class="stringliteral">&quot;urn:xmpp:jingle:apps:rtp:1&quot;</span>);</div><div class="line"><a name="l02377"></a><span class="lineno"> 2377</span>&#160;   iks_insert_attrib(audio, <span class="stringliteral">&quot;var&quot;</span>, <span class="stringliteral">&quot;urn:xmpp:jingle:apps:rtp:audio&quot;</span>);</div><div class="line"><a name="l02378"></a><span class="lineno"> 2378</span>&#160;   iks_insert_attrib(video, <span class="stringliteral">&quot;var&quot;</span>, <span class="stringliteral">&quot;urn:xmpp:jingle:apps:rtp:video&quot;</span>);</div><div class="line"><a name="l02379"></a><span class="lineno"> 2379</span>&#160;   iks_insert_node(iq, query);</div><div class="line"><a name="l02380"></a><span class="lineno"> 2380</span>&#160;   iks_insert_node(query, ident);</div><div class="line"><a name="l02381"></a><span class="lineno"> 2381</span>&#160;   iks_insert_node(query, google);</div><div class="line"><a name="l02382"></a><span class="lineno"> 2382</span>&#160;   iks_insert_node(query, disco);</div><div class="line"><a name="l02383"></a><span class="lineno"> 2383</span>&#160;   iks_insert_node(query, jingle);</div><div class="line"><a name="l02384"></a><span class="lineno"> 2384</span>&#160;   iks_insert_node(query, ice);</div><div class="line"><a name="l02385"></a><span class="lineno"> 2385</span>&#160;   iks_insert_node(query, rtp);</div><div class="line"><a name="l02386"></a><span class="lineno"> 2386</span>&#160;   iks_insert_node(query, audio);</div><div class="line"><a name="l02387"></a><span class="lineno"> 2387</span>&#160;   iks_insert_node(query, video);</div><div class="line"><a name="l02388"></a><span class="lineno"> 2388</span>&#160;   <a class="code" href="../../dc/d6b/res__xmpp_8c.html#a01f156e90984166f2bbcbcc5a4a6e582">ast_xmpp_client_send</a>(client, iq);</div><div class="line"><a name="l02389"></a><span class="lineno"> 2389</span>&#160;</div><div class="line"><a name="l02390"></a><span class="lineno"> 2390</span>&#160;<a class="code" href="../../dd/d7c/eagi__proxy_8c.html#a8fd806ad19b8f5513a4cf18cbf77532c">end</a>:</div><div class="line"><a name="l02391"></a><span class="lineno"> 2391</span>&#160;   iks_delete(query);</div><div class="line"><a name="l02392"></a><span class="lineno"> 2392</span>&#160;   iks_delete(video);</div><div class="line"><a name="l02393"></a><span class="lineno"> 2393</span>&#160;   iks_delete(audio);</div><div class="line"><a name="l02394"></a><span class="lineno"> 2394</span>&#160;   iks_delete(rtp);</div><div class="line"><a name="l02395"></a><span class="lineno"> 2395</span>&#160;   iks_delete(ice);</div><div class="line"><a name="l02396"></a><span class="lineno"> 2396</span>&#160;   iks_delete(jingle);</div><div class="line"><a name="l02397"></a><span class="lineno"> 2397</span>&#160;   iks_delete(google);</div><div class="line"><a name="l02398"></a><span class="lineno"> 2398</span>&#160;   iks_delete(ident);</div><div class="line"><a name="l02399"></a><span class="lineno"> 2399</span>&#160;   iks_delete(disco);</div><div class="line"><a name="l02400"></a><span class="lineno"> 2400</span>&#160;   iks_delete(iq);</div><div class="line"><a name="l02401"></a><span class="lineno"> 2401</span>&#160;</div><div class="line"><a name="l02402"></a><span class="lineno"> 2402</span>&#160;   <span class="keywordflow">return</span> IKS_FILTER_EAT;</div><div class="line"><a name="l02403"></a><span class="lineno"> 2403</span>&#160;}</div><div class="line"><a name="l02404"></a><span class="lineno"> 2404</span>&#160;<span class="comment"></span></div><div class="line"><a name="l02405"></a><span class="lineno"> 2405</span>&#160;<span class="comment">/*! \brief Hook function called when client receives a service discovery result message */</span></div><div class="line"><a name="l02406"></a><span class="lineno"><a class="line" href="../../dc/d6b/res__xmpp_8c.html#aa3da78973dc8e135e540b1303de9bd25"> 2406</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../dc/d6b/res__xmpp_8c.html#aa3da78973dc8e135e540b1303de9bd25">xmpp_client_service_discovery_result_hook</a>(<span class="keywordtype">void</span> *data, ikspak *pak)</div><div class="line"><a name="l02407"></a><span class="lineno"> 2407</span>&#160;{</div><div class="line"><a name="l02408"></a><span class="lineno"> 2408</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../df/d42/structast__xmpp__client.html">ast_xmpp_client</a> *client = data;</div><div class="line"><a name="l02409"></a><span class="lineno"> 2409</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d5/d25/structast__xmpp__buddy.html">ast_xmpp_buddy</a> *buddy;</div><div class="line"><a name="l02410"></a><span class="lineno"> 2410</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d6/d90/structast__xmpp__resource.html">ast_xmpp_resource</a> *<a class="code" href="../../d6/d90/structast__xmpp__resource.html#a12856b954fce601a0303b0bcdf83c513">resource</a>;</div><div class="line"><a name="l02411"></a><span class="lineno"> 2411</span>&#160;</div><div class="line"><a name="l02412"></a><span class="lineno"> 2412</span>&#160;   <span class="keywordflow">if</span> (!(buddy = <a class="code" href="../../d5/da5/astobj2_8h.html#a911e0703891a9a7aaf73978152092586">ao2_find</a>(client-&gt;<a class="code" href="../../df/d42/structast__xmpp__client.html#a5082987d3e1eac5f625574800bb72c2c">buddies</a>, pak-&gt;from-&gt;partial, <a class="code" href="../../d5/da5/astobj2_8h.html#a22f40c733a085f259af94e864ebaa09a">OBJ_KEY</a>))) {</div><div class="line"><a name="l02413"></a><span class="lineno"> 2413</span>&#160;      <span class="keywordflow">return</span> IKS_FILTER_EAT;</div><div class="line"><a name="l02414"></a><span class="lineno"> 2414</span>&#160;   }</div><div class="line"><a name="l02415"></a><span class="lineno"> 2415</span>&#160;</div><div class="line"><a name="l02416"></a><span class="lineno"> 2416</span>&#160;   <span class="keywordflow">if</span> (!(resource = <a class="code" href="../../d5/da5/astobj2_8h.html#a47857055118a703ae87ea5ebaf4842ed">ao2_callback</a>(buddy-&gt;<a class="code" href="../../d5/d25/structast__xmpp__buddy.html#ae3222a7c2c3040d71427c9a8b33ac38c">resources</a>, 0, <a class="code" href="../../dc/d6b/res__xmpp_8c.html#a32325f89202eb73b55ba2c0402cc1bf1">xmpp_resource_cmp</a>, pak-&gt;from-&gt;resource))) {</div><div class="line"><a name="l02417"></a><span class="lineno"> 2417</span>&#160;      <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(buddy, -1);</div><div class="line"><a name="l02418"></a><span class="lineno"> 2418</span>&#160;      <span class="keywordflow">return</span> IKS_FILTER_EAT;</div><div class="line"><a name="l02419"></a><span class="lineno"> 2419</span>&#160;   }</div><div class="line"><a name="l02420"></a><span class="lineno"> 2420</span>&#160;</div><div class="line"><a name="l02421"></a><span class="lineno"> 2421</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#aa9fdb5d0a6157a56060d9f7279fe6c49">ao2_lock</a>(resource);</div><div class="line"><a name="l02422"></a><span class="lineno"> 2422</span>&#160;</div><div class="line"><a name="l02423"></a><span class="lineno"> 2423</span>&#160;   <span class="keywordflow">if</span> (iks_find_with_attrib(pak-&gt;query, <span class="stringliteral">&quot;feature&quot;</span>, <span class="stringliteral">&quot;var&quot;</span>, <span class="stringliteral">&quot;urn:xmpp:jingle:1&quot;</span>)) {</div><div class="line"><a name="l02424"></a><span class="lineno"> 2424</span>&#160;      resource-&gt;<a class="code" href="../../d6/d90/structast__xmpp__resource.html#a4ac032e592fb6d9cf9fdaf3e269fc433">caps</a>.<a class="code" href="../../da/daa/structast__xmpp__capabilities.html#ab5fb18e79b717e6ee434115344b6258f">jingle</a> = 1;</div><div class="line"><a name="l02425"></a><span class="lineno"> 2425</span>&#160;   }</div><div class="line"><a name="l02426"></a><span class="lineno"> 2426</span>&#160;</div><div class="line"><a name="l02427"></a><span class="lineno"> 2427</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#a9998bd156b936636a8780385e9a910b2">ao2_unlock</a>(resource);</div><div class="line"><a name="l02428"></a><span class="lineno"> 2428</span>&#160;</div><div class="line"><a name="l02429"></a><span class="lineno"> 2429</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(resource, -1);</div><div class="line"><a name="l02430"></a><span class="lineno"> 2430</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(buddy, -1);</div><div class="line"><a name="l02431"></a><span class="lineno"> 2431</span>&#160;</div><div class="line"><a name="l02432"></a><span class="lineno"> 2432</span>&#160;   <span class="keywordflow">return</span> IKS_FILTER_EAT;</div><div class="line"><a name="l02433"></a><span class="lineno"> 2433</span>&#160;}</div><div class="line"><a name="l02434"></a><span class="lineno"> 2434</span>&#160;<span class="comment"></span></div><div class="line"><a name="l02435"></a><span class="lineno"> 2435</span>&#160;<span class="comment">/*! \brief Hook function called when client finishes authenticating with the server */</span></div><div class="line"><a name="l02436"></a><span class="lineno"><a class="line" href="../../dc/d6b/res__xmpp_8c.html#a98529e57f9646df0ba9f6db459cf1e93"> 2436</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../dc/d6b/res__xmpp_8c.html#a98529e57f9646df0ba9f6db459cf1e93">xmpp_connect_hook</a>(<span class="keywordtype">void</span> *data, ikspak *pak)</div><div class="line"><a name="l02437"></a><span class="lineno"> 2437</span>&#160;{</div><div class="line"><a name="l02438"></a><span class="lineno"> 2438</span>&#160;   <a class="code" href="../../d5/d60/utils_8h.html#a1604b4d72144dd3d9f7da668e90337e9">RAII_VAR</a>(<span class="keyword">struct</span> <a class="code" href="../../de/d1c/structxmpp__config.html">xmpp_config</a> *, cfg, <a class="code" href="../../d5/da5/astobj2_8h.html#a86d8d6c3c8866ed0a60121da055cd225">ao2_global_obj_ref</a>(<a class="code" href="../../d3/d4e/chan__console_8c.html#aa36e3e2c486b920b166c2d17c5242221">globals</a>), <a class="code" href="../../d5/da5/astobj2_8h.html#a6321ee982370c55ab3c24c72c562cbdd">ao2_cleanup</a>);</div><div class="line"><a name="l02439"></a><span class="lineno"> 2439</span>&#160;   <a class="code" href="../../d5/d60/utils_8h.html#a1604b4d72144dd3d9f7da668e90337e9">RAII_VAR</a>(<span class="keyword">struct</span> <a class="code" href="../../da/d00/structast__xmpp__client__config.html">ast_xmpp_client_config</a> *, clientcfg, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../d5/da5/astobj2_8h.html#a6321ee982370c55ab3c24c72c562cbdd">ao2_cleanup</a>);</div><div class="line"><a name="l02440"></a><span class="lineno"> 2440</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../df/d42/structast__xmpp__client.html">ast_xmpp_client</a> *client = data;</div><div class="line"><a name="l02441"></a><span class="lineno"> 2441</span>&#160;   iks *roster;</div><div class="line"><a name="l02442"></a><span class="lineno"> 2442</span>&#160;</div><div class="line"><a name="l02443"></a><span class="lineno"> 2443</span>&#160;   <span class="keywordflow">if</span> (!cfg || !cfg-&gt;clients || !(clientcfg = <a class="code" href="../../dc/d6b/res__xmpp_8c.html#a14d10033fb3b97f06238940259f45266">xmpp_config_find</a>(cfg-&gt;clients, client-&gt;<a class="code" href="../../df/d42/structast__xmpp__client.html#ace9168767fc3707cf5f0a7d049682ba3">name</a>))) {</div><div class="line"><a name="l02444"></a><span class="lineno"> 2444</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l02445"></a><span class="lineno"> 2445</span>&#160;   }</div><div class="line"><a name="l02446"></a><span class="lineno"> 2446</span>&#160;</div><div class="line"><a name="l02447"></a><span class="lineno"> 2447</span>&#160;   client-&gt;<a class="code" href="../../df/d42/structast__xmpp__client.html#af738439b96e613a471505eb1222ac406">jid</a> = (iks_find_cdata(pak-&gt;query, <span class="stringliteral">&quot;jid&quot;</span>)) ? iks_id_new(client-&gt;<a class="code" href="../../df/d42/structast__xmpp__client.html#ae0c738f7612f5fd8ef0f227f8033324f">stack</a>, iks_find_cdata(pak-&gt;query, <span class="stringliteral">&quot;jid&quot;</span>)) : client-&gt;<a class="code" href="../../df/d42/structast__xmpp__client.html#af738439b96e613a471505eb1222ac406">jid</a>;</div><div class="line"><a name="l02448"></a><span class="lineno"> 2448</span>&#160;</div><div class="line"><a name="l02449"></a><span class="lineno"> 2449</span>&#160;   <a class="code" href="../../dc/df2/ast__expr2f_8c.html#a33e91cd0cef6786e9e3a27ac67707207">if</a> (<a class="code" href="../../d5/d60/utils_8h.html#a00d4c9254c9827d6fa44f17a326744a5">ast_test_flag</a>(&amp;clientcfg-&gt;flags, <a class="code" href="../../dc/d6b/res__xmpp_8c.html#aa3759d2ddcc12f3f5ef5a8a3ffa4a4dfa29cbc9cdcca6e5b12165e01cab18438a">XMPP_DISTRIBUTE_EVENTS</a>)) {</div><div class="line"><a name="l02450"></a><span class="lineno"> 2450</span>&#160;      <a class="code" href="../../dc/d6b/res__xmpp_8c.html#a92d502301cd0604b3db58299d86a7fe9">xmpp_init_event_distribution</a>(client);</div><div class="line"><a name="l02451"></a><span class="lineno"> 2451</span>&#160;   }</div><div class="line"><a name="l02452"></a><span class="lineno"> 2452</span>&#160;</div><div class="line"><a name="l02453"></a><span class="lineno"> 2453</span>&#160;   <span class="keywordflow">if</span> (!(roster = iks_make_iq(IKS_TYPE_GET, IKS_NS_ROSTER))) {</div><div class="line"><a name="l02454"></a><span class="lineno"> 2454</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Unable to allocate memory for roster request for client &#39;%s&#39;\n&quot;</span>, client-&gt;<a class="code" href="../../df/d42/structast__xmpp__client.html#ace9168767fc3707cf5f0a7d049682ba3">name</a>);</div><div class="line"><a name="l02455"></a><span class="lineno"> 2455</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l02456"></a><span class="lineno"> 2456</span>&#160;   }</div><div class="line"><a name="l02457"></a><span class="lineno"> 2457</span>&#160;</div><div class="line"><a name="l02458"></a><span class="lineno"> 2458</span>&#160;   iks_filter_add_rule(client-&gt;<a class="code" href="../../df/d42/structast__xmpp__client.html#a242fce88f9c9954695b13f7af1d415a9">filter</a>, <a class="code" href="../../dc/d6b/res__xmpp_8c.html#a187f3edf503d63cc794aa07e4c2013dc">xmpp_client_service_discovery_get_hook</a>, client, IKS_RULE_SUBTYPE, IKS_TYPE_GET, IKS_RULE_NS, <span class="stringliteral">&quot;http://jabber.org/protocol/disco#info&quot;</span>, IKS_RULE_DONE);</div><div class="line"><a name="l02459"></a><span class="lineno"> 2459</span>&#160;   iks_filter_add_rule(client-&gt;<a class="code" href="../../df/d42/structast__xmpp__client.html#a242fce88f9c9954695b13f7af1d415a9">filter</a>, <a class="code" href="../../dc/d6b/res__xmpp_8c.html#aa3da78973dc8e135e540b1303de9bd25">xmpp_client_service_discovery_result_hook</a>, client, IKS_RULE_SUBTYPE, IKS_TYPE_RESULT, IKS_RULE_NS, <span class="stringliteral">&quot;http://jabber.org/protocol/disco#info&quot;</span>, IKS_RULE_DONE);</div><div class="line"><a name="l02460"></a><span class="lineno"> 2460</span>&#160;</div><div class="line"><a name="l02461"></a><span class="lineno"> 2461</span>&#160;   iks_insert_attrib(roster, <span class="stringliteral">&quot;id&quot;</span>, <span class="stringliteral">&quot;roster&quot;</span>);</div><div class="line"><a name="l02462"></a><span class="lineno"> 2462</span>&#160;   <a class="code" href="../../dc/d6b/res__xmpp_8c.html#a01f156e90984166f2bbcbcc5a4a6e582">ast_xmpp_client_send</a>(client, roster);</div><div class="line"><a name="l02463"></a><span class="lineno"> 2463</span>&#160;</div><div class="line"><a name="l02464"></a><span class="lineno"> 2464</span>&#160;   iks_filter_remove_hook(client-&gt;<a class="code" href="../../df/d42/structast__xmpp__client.html#a242fce88f9c9954695b13f7af1d415a9">filter</a>, <a class="code" href="../../dc/d6b/res__xmpp_8c.html#a98529e57f9646df0ba9f6db459cf1e93">xmpp_connect_hook</a>);</div><div class="line"><a name="l02465"></a><span class="lineno"> 2465</span>&#160;   iks_filter_add_rule(client-&gt;<a class="code" href="../../df/d42/structast__xmpp__client.html#a242fce88f9c9954695b13f7af1d415a9">filter</a>, <a class="code" href="../../dc/d6b/res__xmpp_8c.html#a697e78d60cfc0ddc36c6a9566b74bdac">xmpp_roster_hook</a>, client, IKS_RULE_TYPE, IKS_PAK_IQ, IKS_RULE_SUBTYPE, IKS_TYPE_RESULT, IKS_RULE_ID, <span class="stringliteral">&quot;roster&quot;</span>, IKS_RULE_DONE);</div><div class="line"><a name="l02466"></a><span class="lineno"> 2466</span>&#160;</div><div class="line"><a name="l02467"></a><span class="lineno"> 2467</span>&#160;   <a class="code" href="../../dc/d6b/res__xmpp_8c.html#a8f64e805d3ad98e99a03d77bbdb84bed">xmpp_client_set_presence</a>(client, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, client-&gt;<a class="code" href="../../df/d42/structast__xmpp__client.html#af738439b96e613a471505eb1222ac406">jid</a>-&gt;full, clientcfg-&gt;status, clientcfg-&gt;statusmsg);</div><div class="line"><a name="l02468"></a><span class="lineno"> 2468</span>&#160;   <a class="code" href="../../dc/d6b/res__xmpp_8c.html#ac515389ec6c63a8b3bbd094ede0d7c4d">xmpp_client_change_state</a>(client, <a class="code" href="../../da/da0/xmpp_8h.html#ae37d560c438576bdcb47347088225ee6a77f9e302744e33eb45b86565a4983697">XMPP_STATE_ROSTER</a>);</div><div class="line"><a name="l02469"></a><span class="lineno"> 2469</span>&#160;</div><div class="line"><a name="l02470"></a><span class="lineno"> 2470</span>&#160;   <span class="keywordflow">return</span> IKS_FILTER_EAT;</div><div class="line"><a name="l02471"></a><span class="lineno"> 2471</span>&#160;}</div><div class="line"><a name="l02472"></a><span class="lineno"> 2472</span>&#160;<span class="comment"></span></div><div class="line"><a name="l02473"></a><span class="lineno"> 2473</span>&#160;<span class="comment">/*! \brief Logging hook function */</span></div><div class="line"><a name="l02474"></a><span class="lineno"><a class="line" href="../../dc/d6b/res__xmpp_8c.html#af02607d0a966e73d05d4934a806e79a6"> 2474</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../dc/d6b/res__xmpp_8c.html#af02607d0a966e73d05d4934a806e79a6">xmpp_log_hook</a>(<span class="keywordtype">void</span> *data, <span class="keyword">const</span> <span class="keywordtype">char</span> *xmpp, <span class="keywordtype">size_t</span> size, <span class="keywordtype">int</span> incoming)</div><div class="line"><a name="l02475"></a><span class="lineno"> 2475</span>&#160;{</div><div class="line"><a name="l02476"></a><span class="lineno"> 2476</span>&#160;   <a class="code" href="../../d5/d60/utils_8h.html#a1604b4d72144dd3d9f7da668e90337e9">RAII_VAR</a>(<span class="keyword">struct</span> <a class="code" href="../../de/d1c/structxmpp__config.html">xmpp_config</a> *, cfg, <a class="code" href="../../d5/da5/astobj2_8h.html#a86d8d6c3c8866ed0a60121da055cd225">ao2_global_obj_ref</a>(<a class="code" href="../../d3/d4e/chan__console_8c.html#aa36e3e2c486b920b166c2d17c5242221">globals</a>), <a class="code" href="../../d5/da5/astobj2_8h.html#a6321ee982370c55ab3c24c72c562cbdd">ao2_cleanup</a>);</div><div class="line"><a name="l02477"></a><span class="lineno"> 2477</span>&#160;   <a class="code" href="../../d5/d60/utils_8h.html#a1604b4d72144dd3d9f7da668e90337e9">RAII_VAR</a>(<span class="keyword">struct</span> <a class="code" href="../../da/d00/structast__xmpp__client__config.html">ast_xmpp_client_config</a> *, clientcfg, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../d5/da5/astobj2_8h.html#a6321ee982370c55ab3c24c72c562cbdd">ao2_cleanup</a>);</div><div class="line"><a name="l02478"></a><span class="lineno"> 2478</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../df/d42/structast__xmpp__client.html">ast_xmpp_client</a> *client = data;</div><div class="line"><a name="l02479"></a><span class="lineno"> 2479</span>&#160;</div><div class="line"><a name="l02480"></a><span class="lineno"> 2480</span>&#160;   <span class="keywordflow">if</span> (!debug &amp;&amp; (!cfg || !cfg-&gt;clients || !(clientcfg = <a class="code" href="../../dc/d6b/res__xmpp_8c.html#a14d10033fb3b97f06238940259f45266">xmpp_config_find</a>(cfg-&gt;clients, client-&gt;<a class="code" href="../../df/d42/structast__xmpp__client.html#ace9168767fc3707cf5f0a7d049682ba3">name</a>)) || !<a class="code" href="../../d5/d60/utils_8h.html#a00d4c9254c9827d6fa44f17a326744a5">ast_test_flag</a>(&amp;clientcfg-&gt;flags, <a class="code" href="../../dc/d6b/res__xmpp_8c.html#aa3759d2ddcc12f3f5ef5a8a3ffa4a4dfa94811fda886cb2affbcb7a810dff8eb7">XMPP_DEBUG</a>))) {</div><div class="line"><a name="l02481"></a><span class="lineno"> 2481</span>&#160;      <span class="keywordflow">return</span>;</div><div class="line"><a name="l02482"></a><span class="lineno"> 2482</span>&#160;   }</div><div class="line"><a name="l02483"></a><span class="lineno"> 2483</span>&#160;</div><div class="line"><a name="l02484"></a><span class="lineno"> 2484</span>&#160;   <span class="keywordflow">if</span> (!incoming) {</div><div class="line"><a name="l02485"></a><span class="lineno"> 2485</span>&#160;      <a class="code" href="../../d4/dc5/extconf_8c.html#a81d26348827b996085d4cb6be3e2c348">ast_verbose</a>(<span class="stringliteral">&quot;\n&lt;--- XMPP sent to &#39;%s&#39; ---&gt;\n%s\n&lt;-------------&gt;\n&quot;</span>, client-&gt;<a class="code" href="../../df/d42/structast__xmpp__client.html#ace9168767fc3707cf5f0a7d049682ba3">name</a>, xmpp);</div><div class="line"><a name="l02486"></a><span class="lineno"> 2486</span>&#160;   } <span class="keywordflow">else</span> {</div><div class="line"><a name="l02487"></a><span class="lineno"> 2487</span>&#160;      <a class="code" href="../../d4/dc5/extconf_8c.html#a81d26348827b996085d4cb6be3e2c348">ast_verbose</a>(<span class="stringliteral">&quot;\n&lt;--- XMPP received from &#39;%s&#39; ---&gt;\n%s\n&lt;-------------&gt;\n&quot;</span>, client-&gt;<a class="code" href="../../df/d42/structast__xmpp__client.html#ace9168767fc3707cf5f0a7d049682ba3">name</a>, xmpp);</div><div class="line"><a name="l02488"></a><span class="lineno"> 2488</span>&#160;   }</div><div class="line"><a name="l02489"></a><span class="lineno"> 2489</span>&#160;}</div><div class="line"><a name="l02490"></a><span class="lineno"> 2490</span>&#160;<span class="comment"></span></div><div class="line"><a name="l02491"></a><span class="lineno"> 2491</span>&#160;<span class="comment">/*! \brief Internal function which sends a raw message */</span></div><div class="line"><a name="l02492"></a><span class="lineno"><a class="line" href="../../dc/d6b/res__xmpp_8c.html#a3fd85bbc5a1a08d890b80d317ada622b"> 2492</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../dc/d6b/res__xmpp_8c.html#a3fd85bbc5a1a08d890b80d317ada622b">xmpp_client_send_raw_message</a>(<span class="keyword">struct</span> <a class="code" href="../../df/d42/structast__xmpp__client.html">ast_xmpp_client</a> *client, <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="../../d8/d9e/structmessage.html">message</a>)</div><div class="line"><a name="l02493"></a><span class="lineno"> 2493</span>&#160;{</div><div class="line"><a name="l02494"></a><span class="lineno"> 2494</span>&#160;   <span class="keywordtype">int</span> ret;</div><div class="line"><a name="l02495"></a><span class="lineno"> 2495</span>&#160;</div><div class="line"><a name="l02496"></a><span class="lineno"> 2496</span>&#160;   <span class="keywordflow">if</span> (client-&gt;<a class="code" href="../../df/d42/structast__xmpp__client.html#a0e1ad9bdec3a82e1fec4aed829cfa2a6">state</a> == <a class="code" href="../../da/da0/xmpp_8h.html#ae37d560c438576bdcb47347088225ee6a83544d57990f3fc1311d173a44928042">XMPP_STATE_DISCONNECTED</a>) {</div><div class="line"><a name="l02497"></a><span class="lineno"> 2497</span>&#160;      <span class="comment">/* iks_send_raw will crash without a connection */</span></div><div class="line"><a name="l02498"></a><span class="lineno"> 2498</span>&#160;      <span class="keywordflow">return</span> IKS_NET_NOCONN;</div><div class="line"><a name="l02499"></a><span class="lineno"> 2499</span>&#160;   }</div><div class="line"><a name="l02500"></a><span class="lineno"> 2500</span>&#160;</div><div class="line"><a name="l02501"></a><span class="lineno"> 2501</span>&#160;<span class="preprocessor">#ifdef HAVE_OPENSSL</span></div><div class="line"><a name="l02502"></a><span class="lineno"> 2502</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../dc/d6b/res__xmpp_8c.html#ae13d4153b0221e790967206a41a9e253">xmpp_is_secure</a>(client)) {</div><div class="line"><a name="l02503"></a><span class="lineno"> 2503</span>&#160;      <span class="keywordtype">int</span> <a class="code" href="../../d9/d1e/func__strings_8c.html#af24e73aaf92f3000fda15d285e66df24">len</a> = strlen(message);</div><div class="line"><a name="l02504"></a><span class="lineno"> 2504</span>&#160;</div><div class="line"><a name="l02505"></a><span class="lineno"> 2505</span>&#160;      ret = SSL_write(client-&gt;<a class="code" href="../../df/d42/structast__xmpp__client.html#a28e9fca20ae2d65b0b00c4c4b16ee59b">ssl_session</a>, message, len);</div><div class="line"><a name="l02506"></a><span class="lineno"> 2506</span>&#160;      <span class="keywordflow">if</span> (ret) {</div><div class="line"><a name="l02507"></a><span class="lineno"> 2507</span>&#160;         <span class="comment">/* Log the message here, because iksemel&#39;s logHook is</span></div><div class="line"><a name="l02508"></a><span class="lineno"> 2508</span>&#160;<span class="comment">            unaccessible */</span></div><div class="line"><a name="l02509"></a><span class="lineno"> 2509</span>&#160;         <a class="code" href="../../dc/d6b/res__xmpp_8c.html#af02607d0a966e73d05d4934a806e79a6">xmpp_log_hook</a>(client, message, len, 0);</div><div class="line"><a name="l02510"></a><span class="lineno"> 2510</span>&#160;         <span class="keywordflow">return</span> IKS_OK;</div><div class="line"><a name="l02511"></a><span class="lineno"> 2511</span>&#160;      }</div><div class="line"><a name="l02512"></a><span class="lineno"> 2512</span>&#160;   }</div><div class="line"><a name="l02513"></a><span class="lineno"> 2513</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l02514"></a><span class="lineno"> 2514</span>&#160;   <span class="comment">/* If needed, data will be sent unencrypted, and logHook will</span></div><div class="line"><a name="l02515"></a><span class="lineno"> 2515</span>&#160;<span class="comment">      be called inside iks_send_raw */</span></div><div class="line"><a name="l02516"></a><span class="lineno"> 2516</span>&#160;   ret = iks_send_raw(client-&gt;<a class="code" href="../../df/d42/structast__xmpp__client.html#a84da25e2e78fab08d8077368bdbef1c6">parser</a>, message);</div><div class="line"><a name="l02517"></a><span class="lineno"> 2517</span>&#160;   <span class="keywordflow">if</span> (ret != IKS_OK) {</div><div class="line"><a name="l02518"></a><span class="lineno"> 2518</span>&#160;      <span class="keywordflow">return</span> ret;</div><div class="line"><a name="l02519"></a><span class="lineno"> 2519</span>&#160;   }</div><div class="line"><a name="l02520"></a><span class="lineno"> 2520</span>&#160;</div><div class="line"><a name="l02521"></a><span class="lineno"> 2521</span>&#160;   <span class="keywordflow">return</span> IKS_OK;</div><div class="line"><a name="l02522"></a><span class="lineno"> 2522</span>&#160;}</div><div class="line"><a name="l02523"></a><span class="lineno"> 2523</span>&#160;<span class="comment"></span></div><div class="line"><a name="l02524"></a><span class="lineno"> 2524</span>&#160;<span class="comment">/*! \brief Helper function which sends an XMPP stream header to the server */</span></div><div class="line"><a name="l02525"></a><span class="lineno"><a class="line" href="../../dc/d6b/res__xmpp_8c.html#a2f3d4b03f949f57841694200618c8c66"> 2525</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../dc/d6b/res__xmpp_8c.html#a2f3d4b03f949f57841694200618c8c66">xmpp_send_stream_header</a>(<span class="keyword">struct</span> <a class="code" href="../../df/d42/structast__xmpp__client.html">ast_xmpp_client</a> *client, <span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="../../da/d00/structast__xmpp__client__config.html">ast_xmpp_client_config</a> *cfg, <span class="keyword">const</span> <span class="keywordtype">char</span> *to)</div><div class="line"><a name="l02526"></a><span class="lineno"> 2526</span>&#160;{</div><div class="line"><a name="l02527"></a><span class="lineno"> 2527</span>&#160;   <span class="keywordtype">char</span> *<span class="keyword">namespace </span>= <a class="code" href="../../d5/d60/utils_8h.html#a00d4c9254c9827d6fa44f17a326744a5">ast_test_flag</a>(&amp;cfg-&gt;<a class="code" href="../../da/d00/structast__xmpp__client__config.html#aec78000b2897c094f68ed72559e18acd">flags</a>, <a class="code" href="../../dc/d6b/res__xmpp_8c.html#aa3759d2ddcc12f3f5ef5a8a3ffa4a4dfadc3efad94dcc216c29d42b23edcb2d00">XMPP_COMPONENT</a>) ? <span class="stringliteral">&quot;jabber:component:accept&quot;</span> : <span class="stringliteral">&quot;jabber:client&quot;</span>;</div><div class="line"><a name="l02528"></a><span class="lineno"> 2528</span>&#160;   <span class="keywordtype">char</span> msg[91 + strlen(<span class="keyword">namespace</span>) + 6 + strlen(to) + 16 + 1];</div><div class="line"><a name="l02529"></a><span class="lineno"> 2529</span>&#160;</div><div class="line"><a name="l02530"></a><span class="lineno"> 2530</span>&#160;   snprintf(msg, <span class="keyword">sizeof</span>(msg), <span class="stringliteral">&quot;&lt;?xml version=&#39;1.0&#39;?&gt;&quot;</span></div><div class="line"><a name="l02531"></a><span class="lineno"> 2531</span>&#160;       <span class="stringliteral">&quot;&lt;stream:stream xmlns:stream=&#39;http://etherx.jabber.org/streams&#39; xmlns=&#39;&quot;</span></div><div class="line"><a name="l02532"></a><span class="lineno"> 2532</span>&#160;       <span class="stringliteral">&quot;%s&#39; to=&#39;%s&#39; version=&#39;1.0&#39;&gt;&quot;</span>, <span class="keyword">namespace</span>, to);</div><div class="line"><a name="l02533"></a><span class="lineno"> 2533</span>&#160;</div><div class="line"><a name="l02534"></a><span class="lineno"> 2534</span>&#160;   <span class="keywordflow">return</span> <a class="code" href="../../dc/d6b/res__xmpp_8c.html#a3fd85bbc5a1a08d890b80d317ada622b">xmpp_client_send_raw_message</a>(client, msg);</div><div class="line"><a name="l02535"></a><span class="lineno"> 2535</span>&#160;}</div><div class="line"><a name="l02536"></a><span class="lineno"> 2536</span>&#160;</div><div class="line"><a name="l02537"></a><span class="lineno"><a class="line" href="../../dc/d6b/res__xmpp_8c.html#a01f156e90984166f2bbcbcc5a4a6e582"> 2537</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="../../dc/d6b/res__xmpp_8c.html#a01f156e90984166f2bbcbcc5a4a6e582">ast_xmpp_client_send</a>(<span class="keyword">struct</span> <a class="code" href="../../df/d42/structast__xmpp__client.html">ast_xmpp_client</a> *client, iks *stanza)</div><div class="line"><a name="l02538"></a><span class="lineno"> 2538</span>&#160;{</div><div class="line"><a name="l02539"></a><span class="lineno"> 2539</span>&#160;   <span class="keywordflow">return</span> <a class="code" href="../../dc/d6b/res__xmpp_8c.html#a3fd85bbc5a1a08d890b80d317ada622b">xmpp_client_send_raw_message</a>(client, iks_string(iks_stack(stanza), stanza));</div><div class="line"><a name="l02540"></a><span class="lineno"> 2540</span>&#160;}</div><div class="line"><a name="l02541"></a><span class="lineno"> 2541</span>&#160;<span class="comment"></span></div><div class="line"><a name="l02542"></a><span class="lineno"> 2542</span>&#160;<span class="comment">/*! \brief Internal function called when we need to request TLS support */</span></div><div class="line"><a name="l02543"></a><span class="lineno"><a class="line" href="../../dc/d6b/res__xmpp_8c.html#adfb6a3e1f6870b3fcfe56d1303db59b7"> 2543</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../dc/d6b/res__xmpp_8c.html#adfb6a3e1f6870b3fcfe56d1303db59b7">xmpp_client_request_tls</a>(<span class="keyword">struct</span> <a class="code" href="../../df/d42/structast__xmpp__client.html">ast_xmpp_client</a> *client, <span class="keyword">struct</span> <a class="code" href="../../da/d00/structast__xmpp__client__config.html">ast_xmpp_client_config</a> *cfg, <span class="keywordtype">int</span> <a class="code" href="../../d7/d49/chan__ooh323_8c.html#a4d63fdfe5451ec2248c16a2739190c56">type</a>, iks *node)</div><div class="line"><a name="l02544"></a><span class="lineno"> 2544</span>&#160;{</div><div class="line"><a name="l02545"></a><span class="lineno"> 2545</span>&#160;   <span class="comment">/* If the client connection is already secure we can jump straight to authenticating */</span></div><div class="line"><a name="l02546"></a><span class="lineno"> 2546</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../dc/d6b/res__xmpp_8c.html#ae13d4153b0221e790967206a41a9e253">xmpp_is_secure</a>(client)) {</div><div class="line"><a name="l02547"></a><span class="lineno"> 2547</span>&#160;      <a class="code" href="../../dc/d6b/res__xmpp_8c.html#ac515389ec6c63a8b3bbd094ede0d7c4d">xmpp_client_change_state</a>(client, <a class="code" href="../../da/da0/xmpp_8h.html#ae37d560c438576bdcb47347088225ee6a1f316843c055717ccde5ccb266e1eee6">XMPP_STATE_AUTHENTICATE</a>);</div><div class="line"><a name="l02548"></a><span class="lineno"> 2548</span>&#160;      <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l02549"></a><span class="lineno"> 2549</span>&#160;   }</div><div class="line"><a name="l02550"></a><span class="lineno"> 2550</span>&#160;</div><div class="line"><a name="l02551"></a><span class="lineno"> 2551</span>&#160;<span class="preprocessor">#ifndef HAVE_OPENSSL</span></div><div class="line"><a name="l02552"></a><span class="lineno"> 2552</span>&#160;   <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;TLS connection for client &#39;%s&#39; cannot be established. OpenSSL is not available.\n&quot;</span>, client-&gt;<a class="code" href="../../df/d42/structast__xmpp__client.html#ace9168767fc3707cf5f0a7d049682ba3">name</a>);</div><div class="line"><a name="l02553"></a><span class="lineno"> 2553</span>&#160;   <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l02554"></a><span class="lineno"> 2554</span>&#160;<span class="preprocessor">#else</span></div><div class="line"><a name="l02555"></a><span class="lineno"> 2555</span>&#160;   <span class="keywordflow">if</span> (iks_send_raw(client-&gt;<a class="code" href="../../df/d42/structast__xmpp__client.html#a84da25e2e78fab08d8077368bdbef1c6">parser</a>, <span class="stringliteral">&quot;&lt;starttls xmlns=&#39;urn:ietf:params:xml:ns:xmpp-tls&#39;/&gt;&quot;</span>) == IKS_NET_TLSFAIL) {</div><div class="line"><a name="l02556"></a><span class="lineno"> 2556</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;TLS connection for client &#39;%s&#39; cannot be started.\n&quot;</span>, client-&gt;<a class="code" href="../../df/d42/structast__xmpp__client.html#ace9168767fc3707cf5f0a7d049682ba3">name</a>);</div><div class="line"><a name="l02557"></a><span class="lineno"> 2557</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l02558"></a><span class="lineno"> 2558</span>&#160;   }</div><div class="line"><a name="l02559"></a><span class="lineno"> 2559</span>&#160;</div><div class="line"><a name="l02560"></a><span class="lineno"> 2560</span>&#160;   client-&gt;<a class="code" href="../../df/d42/structast__xmpp__client.html#aa663ff5d560561c647a50b58adce4e7a">stream_flags</a> |= TRY_SECURE;</div><div class="line"><a name="l02561"></a><span class="lineno"> 2561</span>&#160;</div><div class="line"><a name="l02562"></a><span class="lineno"> 2562</span>&#160;   <a class="code" href="../../dc/d6b/res__xmpp_8c.html#ac515389ec6c63a8b3bbd094ede0d7c4d">xmpp_client_change_state</a>(client, <a class="code" href="../../da/da0/xmpp_8h.html#ae37d560c438576bdcb47347088225ee6aa3c76e3189d07fe1b59825869e4703e3">XMPP_STATE_REQUESTED_TLS</a>);</div><div class="line"><a name="l02563"></a><span class="lineno"> 2563</span>&#160;</div><div class="line"><a name="l02564"></a><span class="lineno"> 2564</span>&#160;   <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l02565"></a><span class="lineno"> 2565</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l02566"></a><span class="lineno"> 2566</span>&#160;}</div><div class="line"><a name="l02567"></a><span class="lineno"> 2567</span>&#160;</div><div class="line"><a name="l02568"></a><span class="lineno"> 2568</span>&#160;<span class="preprocessor">#ifdef HAVE_OPENSSL</span></div><div class="line"><a name="l02569"></a><span class="lineno"><a class="line" href="../../dc/d6b/res__xmpp_8c.html#ae45cca00255078960084d96a140650ef"> 2569</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">char</span> *<a class="code" href="../../dc/d6b/res__xmpp_8c.html#ae45cca00255078960084d96a140650ef">openssl_error_string</a>(<span class="keywordtype">void</span>)</div><div class="line"><a name="l02570"></a><span class="lineno"> 2570</span>&#160;{</div><div class="line"><a name="l02571"></a><span class="lineno"> 2571</span>&#160;   <span class="keywordtype">char</span> *<a class="code" href="../../dd/d7c/eagi__proxy_8c.html#ac95651d79c608a3148973b5b1fc9e525">buf</a> = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, *ret;</div><div class="line"><a name="l02572"></a><span class="lineno"> 2572</span>&#160;   <span class="keywordtype">size_t</span> <a class="code" href="../../d9/d1e/func__strings_8c.html#af24e73aaf92f3000fda15d285e66df24">len</a>;</div><div class="line"><a name="l02573"></a><span class="lineno"> 2573</span>&#160;   BIO *bio = BIO_new(BIO_s_mem());</div><div class="line"><a name="l02574"></a><span class="lineno"> 2574</span>&#160;</div><div class="line"><a name="l02575"></a><span class="lineno"> 2575</span>&#160;   ERR_print_errors(bio);</div><div class="line"><a name="l02576"></a><span class="lineno"> 2576</span>&#160;   len = BIO_get_mem_data(bio, &amp;buf);</div><div class="line"><a name="l02577"></a><span class="lineno"> 2577</span>&#160;   ret = <a class="code" href="../../d8/d8a/astmm_8h.html#ae0cd4c5524b01287ab19cbe233d9cebb">ast_calloc</a>(1, len + 1);</div><div class="line"><a name="l02578"></a><span class="lineno"> 2578</span>&#160;   <span class="keywordflow">if</span> (ret) {</div><div class="line"><a name="l02579"></a><span class="lineno"> 2579</span>&#160;      memcpy(ret, buf, len);</div><div class="line"><a name="l02580"></a><span class="lineno"> 2580</span>&#160;   }</div><div class="line"><a name="l02581"></a><span class="lineno"> 2581</span>&#160;   BIO_free(bio);</div><div class="line"><a name="l02582"></a><span class="lineno"> 2582</span>&#160;   <span class="keywordflow">return</span> ret;</div><div class="line"><a name="l02583"></a><span class="lineno"> 2583</span>&#160;}</div><div class="line"><a name="l02584"></a><span class="lineno"> 2584</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l02585"></a><span class="lineno"> 2585</span>&#160;<span class="comment"></span></div><div class="line"><a name="l02586"></a><span class="lineno"> 2586</span>&#160;<span class="comment">/*! \brief Internal function called when we receive a response to our TLS initiation request */</span></div><div class="line"><a name="l02587"></a><span class="lineno"><a class="line" href="../../dc/d6b/res__xmpp_8c.html#a061c4cbf39cf2ba5a8d8175f2a6716ee"> 2587</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../dc/d6b/res__xmpp_8c.html#a061c4cbf39cf2ba5a8d8175f2a6716ee">xmpp_client_requested_tls</a>(<span class="keyword">struct</span> <a class="code" href="../../df/d42/structast__xmpp__client.html">ast_xmpp_client</a> *client, <span class="keyword">struct</span> <a class="code" href="../../da/d00/structast__xmpp__client__config.html">ast_xmpp_client_config</a> *cfg, <span class="keywordtype">int</span> <a class="code" href="../../d7/d49/chan__ooh323_8c.html#a4d63fdfe5451ec2248c16a2739190c56">type</a>, iks *node)</div><div class="line"><a name="l02588"></a><span class="lineno"> 2588</span>&#160;{</div><div class="line"><a name="l02589"></a><span class="lineno"> 2589</span>&#160;<span class="preprocessor">#ifdef HAVE_OPENSSL</span></div><div class="line"><a name="l02590"></a><span class="lineno"> 2590</span>&#160;   <span class="keywordtype">int</span> sock;</div><div class="line"><a name="l02591"></a><span class="lineno"> 2591</span>&#160;   <span class="keywordtype">long</span> ssl_opts;</div><div class="line"><a name="l02592"></a><span class="lineno"> 2592</span>&#160;   <span class="keywordtype">char</span> *err;</div><div class="line"><a name="l02593"></a><span class="lineno"> 2593</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l02594"></a><span class="lineno"> 2594</span>&#160;</div><div class="line"><a name="l02595"></a><span class="lineno"> 2595</span>&#160;   <span class="keywordflow">if</span> (!strcmp(iks_name(node), <span class="stringliteral">&quot;success&quot;</span>)) {</div><div class="line"><a name="l02596"></a><span class="lineno"> 2596</span>&#160;      <span class="comment">/* TLS is up and working, we can move on to authenticating now */</span></div><div class="line"><a name="l02597"></a><span class="lineno"> 2597</span>&#160;      <a class="code" href="../../dc/d6b/res__xmpp_8c.html#ac515389ec6c63a8b3bbd094ede0d7c4d">xmpp_client_change_state</a>(client, <a class="code" href="../../da/da0/xmpp_8h.html#ae37d560c438576bdcb47347088225ee6a1f316843c055717ccde5ccb266e1eee6">XMPP_STATE_AUTHENTICATE</a>);</div><div class="line"><a name="l02598"></a><span class="lineno"> 2598</span>&#160;      <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l02599"></a><span class="lineno"> 2599</span>&#160;   } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcmp(iks_name(node), <span class="stringliteral">&quot;failure&quot;</span>)) {</div><div class="line"><a name="l02600"></a><span class="lineno"> 2600</span>&#160;      <span class="comment">/* TLS negotiation was a failure, close it on down! */</span></div><div class="line"><a name="l02601"></a><span class="lineno"> 2601</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l02602"></a><span class="lineno"> 2602</span>&#160;   } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strcmp(iks_name(node), <span class="stringliteral">&quot;proceed&quot;</span>)) {</div><div class="line"><a name="l02603"></a><span class="lineno"> 2603</span>&#160;      <span class="comment">/* Ignore any other responses */</span></div><div class="line"><a name="l02604"></a><span class="lineno"> 2604</span>&#160;      <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l02605"></a><span class="lineno"> 2605</span>&#160;   }</div><div class="line"><a name="l02606"></a><span class="lineno"> 2606</span>&#160;</div><div class="line"><a name="l02607"></a><span class="lineno"> 2607</span>&#160;<span class="preprocessor">#ifndef HAVE_OPENSSL</span></div><div class="line"><a name="l02608"></a><span class="lineno"> 2608</span>&#160;   <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Somehow we managed to try to start TLS negotiation on client &#39;%s&#39; without OpenSSL support, disconnecting\n&quot;</span>, client-&gt;<a class="code" href="../../df/d42/structast__xmpp__client.html#ace9168767fc3707cf5f0a7d049682ba3">name</a>);</div><div class="line"><a name="l02609"></a><span class="lineno"> 2609</span>&#160;   <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l02610"></a><span class="lineno"> 2610</span>&#160;<span class="preprocessor">#else</span></div><div class="line"><a name="l02611"></a><span class="lineno"> 2611</span>&#160;   client-&gt;<a class="code" href="../../df/d42/structast__xmpp__client.html#ab9a9b889912b9b0d0ff5199a408f29df">ssl_method</a> = SSLv23_method();</div><div class="line"><a name="l02612"></a><span class="lineno"> 2612</span>&#160;   <span class="keywordflow">if</span> (!(client-&gt;<a class="code" href="../../df/d42/structast__xmpp__client.html#a8c5d83fcb87f22326009954a4652d92e">ssl_context</a> = SSL_CTX_new((SSL_METHOD *) client-&gt;<a class="code" href="../../df/d42/structast__xmpp__client.html#ab9a9b889912b9b0d0ff5199a408f29df">ssl_method</a>))) {</div><div class="line"><a name="l02613"></a><span class="lineno"> 2613</span>&#160;      <span class="keywordflow">goto</span> failure;</div><div class="line"><a name="l02614"></a><span class="lineno"> 2614</span>&#160;   }</div><div class="line"><a name="l02615"></a><span class="lineno"> 2615</span>&#160;</div><div class="line"><a name="l02616"></a><span class="lineno"> 2616</span>&#160;   ssl_opts = SSL_OP_NO_SSLv2 | SSL_OP_NO_SSLv3;</div><div class="line"><a name="l02617"></a><span class="lineno"> 2617</span>&#160;   SSL_CTX_set_options(client-&gt;<a class="code" href="../../df/d42/structast__xmpp__client.html#a8c5d83fcb87f22326009954a4652d92e">ssl_context</a>, ssl_opts);</div><div class="line"><a name="l02618"></a><span class="lineno"> 2618</span>&#160;</div><div class="line"><a name="l02619"></a><span class="lineno"> 2619</span>&#160;   <span class="keywordflow">if</span> (!(client-&gt;<a class="code" href="../../df/d42/structast__xmpp__client.html#a28e9fca20ae2d65b0b00c4c4b16ee59b">ssl_session</a> = SSL_new(client-&gt;<a class="code" href="../../df/d42/structast__xmpp__client.html#a8c5d83fcb87f22326009954a4652d92e">ssl_context</a>))) {</div><div class="line"><a name="l02620"></a><span class="lineno"> 2620</span>&#160;      <span class="keywordflow">goto</span> failure;</div><div class="line"><a name="l02621"></a><span class="lineno"> 2621</span>&#160;   }</div><div class="line"><a name="l02622"></a><span class="lineno"> 2622</span>&#160;</div><div class="line"><a name="l02623"></a><span class="lineno"> 2623</span>&#160;   sock = iks_fd(client-&gt;<a class="code" href="../../df/d42/structast__xmpp__client.html#a84da25e2e78fab08d8077368bdbef1c6">parser</a>);</div><div class="line"><a name="l02624"></a><span class="lineno"> 2624</span>&#160;   <span class="keywordflow">if</span> (!SSL_set_fd(client-&gt;<a class="code" href="../../df/d42/structast__xmpp__client.html#a28e9fca20ae2d65b0b00c4c4b16ee59b">ssl_session</a>, sock)) {</div><div class="line"><a name="l02625"></a><span class="lineno"> 2625</span>&#160;      <span class="keywordflow">goto</span> failure;</div><div class="line"><a name="l02626"></a><span class="lineno"> 2626</span>&#160;   }</div><div class="line"><a name="l02627"></a><span class="lineno"> 2627</span>&#160;</div><div class="line"><a name="l02628"></a><span class="lineno"> 2628</span>&#160;   <span class="keywordflow">if</span> (SSL_connect(client-&gt;<a class="code" href="../../df/d42/structast__xmpp__client.html#a28e9fca20ae2d65b0b00c4c4b16ee59b">ssl_session</a>) &lt;= 0) {</div><div class="line"><a name="l02629"></a><span class="lineno"> 2629</span>&#160;      <span class="keywordflow">goto</span> failure;</div><div class="line"><a name="l02630"></a><span class="lineno"> 2630</span>&#160;   }</div><div class="line"><a name="l02631"></a><span class="lineno"> 2631</span>&#160;</div><div class="line"><a name="l02632"></a><span class="lineno"> 2632</span>&#160;   client-&gt;<a class="code" href="../../df/d42/structast__xmpp__client.html#aa663ff5d560561c647a50b58adce4e7a">stream_flags</a> &amp;= (~TRY_SECURE);</div><div class="line"><a name="l02633"></a><span class="lineno"> 2633</span>&#160;   client-&gt;<a class="code" href="../../df/d42/structast__xmpp__client.html#aa663ff5d560561c647a50b58adce4e7a">stream_flags</a> |= SECURE;</div><div class="line"><a name="l02634"></a><span class="lineno"> 2634</span>&#160;</div><div class="line"><a name="l02635"></a><span class="lineno"> 2635</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../dc/d6b/res__xmpp_8c.html#a2f3d4b03f949f57841694200618c8c66">xmpp_send_stream_header</a>(client, cfg, client-&gt;<a class="code" href="../../df/d42/structast__xmpp__client.html#af738439b96e613a471505eb1222ac406">jid</a>-&gt;server) != IKS_OK) {</div><div class="line"><a name="l02636"></a><span class="lineno"> 2636</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;TLS connection for client &#39;%s&#39; could not be established, failed to send stream header after negotiation\n&quot;</span>,</div><div class="line"><a name="l02637"></a><span class="lineno"> 2637</span>&#160;         client-&gt;<a class="code" href="../../df/d42/structast__xmpp__client.html#ace9168767fc3707cf5f0a7d049682ba3">name</a>);</div><div class="line"><a name="l02638"></a><span class="lineno"> 2638</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l02639"></a><span class="lineno"> 2639</span>&#160;   }</div><div class="line"><a name="l02640"></a><span class="lineno"> 2640</span>&#160;</div><div class="line"><a name="l02641"></a><span class="lineno"> 2641</span>&#160;   <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(1, <span class="stringliteral">&quot;TLS connection for client &#39;%s&#39; started with server\n&quot;</span>, client-&gt;<a class="code" href="../../df/d42/structast__xmpp__client.html#ace9168767fc3707cf5f0a7d049682ba3">name</a>);</div><div class="line"><a name="l02642"></a><span class="lineno"> 2642</span>&#160;</div><div class="line"><a name="l02643"></a><span class="lineno"> 2643</span>&#160;   <a class="code" href="../../dc/d6b/res__xmpp_8c.html#ac515389ec6c63a8b3bbd094ede0d7c4d">xmpp_client_change_state</a>(client, <a class="code" href="../../da/da0/xmpp_8h.html#ae37d560c438576bdcb47347088225ee6a1f316843c055717ccde5ccb266e1eee6">XMPP_STATE_AUTHENTICATE</a>);</div><div class="line"><a name="l02644"></a><span class="lineno"> 2644</span>&#160;</div><div class="line"><a name="l02645"></a><span class="lineno"> 2645</span>&#160;   <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l02646"></a><span class="lineno"> 2646</span>&#160;</div><div class="line"><a name="l02647"></a><span class="lineno"> 2647</span>&#160;failure:</div><div class="line"><a name="l02648"></a><span class="lineno"> 2648</span>&#160;   err = <a class="code" href="../../dc/d6b/res__xmpp_8c.html#ae45cca00255078960084d96a140650ef">openssl_error_string</a>();</div><div class="line"><a name="l02649"></a><span class="lineno"> 2649</span>&#160;   <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;TLS connection for client &#39;%s&#39; cannot be established. &quot;</span></div><div class="line"><a name="l02650"></a><span class="lineno"> 2650</span>&#160;      <span class="stringliteral">&quot;OpenSSL initialization failed: %s\n&quot;</span>, client-&gt;<a class="code" href="../../df/d42/structast__xmpp__client.html#ace9168767fc3707cf5f0a7d049682ba3">name</a>, err);</div><div class="line"><a name="l02651"></a><span class="lineno"> 2651</span>&#160;   <a class="code" href="../../d8/d8a/astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(err);</div><div class="line"><a name="l02652"></a><span class="lineno"> 2652</span>&#160;   <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l02653"></a><span class="lineno"> 2653</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l02654"></a><span class="lineno"> 2654</span>&#160;}</div><div class="line"><a name="l02655"></a><span class="lineno"> 2655</span>&#160;<span class="comment"></span></div><div class="line"><a name="l02656"></a><span class="lineno"> 2656</span>&#160;<span class="comment">/*! \brief Internal function called when we need to authenticate using non-SASL */</span></div><div class="line"><a name="l02657"></a><span class="lineno"><a class="line" href="../../dc/d6b/res__xmpp_8c.html#a22920dcde5570770b359775466b08d72"> 2657</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../dc/d6b/res__xmpp_8c.html#a22920dcde5570770b359775466b08d72">xmpp_client_authenticate_digest</a>(<span class="keyword">struct</span> <a class="code" href="../../df/d42/structast__xmpp__client.html">ast_xmpp_client</a> *client, <span class="keyword">struct</span> <a class="code" href="../../da/d00/structast__xmpp__client__config.html">ast_xmpp_client_config</a> *cfg, <span class="keywordtype">int</span> <a class="code" href="../../d7/d49/chan__ooh323_8c.html#a4d63fdfe5451ec2248c16a2739190c56">type</a>, iks *node)</div><div class="line"><a name="l02658"></a><span class="lineno"> 2658</span>&#160;{</div><div class="line"><a name="l02659"></a><span class="lineno"> 2659</span>&#160;   iks *iq = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, *query = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l02660"></a><span class="lineno"> 2660</span>&#160;   <span class="keywordtype">char</span> <a class="code" href="../../dd/d7c/eagi__proxy_8c.html#ac95651d79c608a3148973b5b1fc9e525">buf</a>[41], sidpass[100];</div><div class="line"><a name="l02661"></a><span class="lineno"> 2661</span>&#160;</div><div class="line"><a name="l02662"></a><span class="lineno"> 2662</span>&#160;   <span class="keywordflow">if</span> (!(iq = iks_new(<span class="stringliteral">&quot;iq&quot;</span>)) || !(query = iks_insert(iq, <span class="stringliteral">&quot;query&quot;</span>))) {</div><div class="line"><a name="l02663"></a><span class="lineno"> 2663</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Stanzas could not be allocated for authentication on client &#39;%s&#39;\n&quot;</span>, client-&gt;<a class="code" href="../../df/d42/structast__xmpp__client.html#ace9168767fc3707cf5f0a7d049682ba3">name</a>);</div><div class="line"><a name="l02664"></a><span class="lineno"> 2664</span>&#160;      iks_delete(iq);</div><div class="line"><a name="l02665"></a><span class="lineno"> 2665</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l02666"></a><span class="lineno"> 2666</span>&#160;   }</div><div class="line"><a name="l02667"></a><span class="lineno"> 2667</span>&#160;</div><div class="line"><a name="l02668"></a><span class="lineno"> 2668</span>&#160;   iks_insert_attrib(iq, <span class="stringliteral">&quot;type&quot;</span>, <span class="stringliteral">&quot;set&quot;</span>);</div><div class="line"><a name="l02669"></a><span class="lineno"> 2669</span>&#160;   iks_insert_cdata(iks_insert(query, <span class="stringliteral">&quot;username&quot;</span>), client-&gt;<a class="code" href="../../df/d42/structast__xmpp__client.html#af738439b96e613a471505eb1222ac406">jid</a>-&gt;user, 0);</div><div class="line"><a name="l02670"></a><span class="lineno"> 2670</span>&#160;   iks_insert_cdata(iks_insert(query, <span class="stringliteral">&quot;resource&quot;</span>), client-&gt;<a class="code" href="../../df/d42/structast__xmpp__client.html#af738439b96e613a471505eb1222ac406">jid</a>-&gt;resource, 0);</div><div class="line"><a name="l02671"></a><span class="lineno"> 2671</span>&#160;</div><div class="line"><a name="l02672"></a><span class="lineno"> 2672</span>&#160;   iks_insert_attrib(query, <span class="stringliteral">&quot;xmlns&quot;</span>, <span class="stringliteral">&quot;jabber:iq:auth&quot;</span>);</div><div class="line"><a name="l02673"></a><span class="lineno"> 2673</span>&#160;   snprintf(sidpass, <span class="keyword">sizeof</span>(sidpass), <span class="stringliteral">&quot;%s%s&quot;</span>, iks_find_attrib(node, <span class="stringliteral">&quot;id&quot;</span>), cfg-&gt;<a class="code" href="../../da/d00/structast__xmpp__client__config.html#a54125aa1f0e661889f7a44db13a2b4b8">password</a>);</div><div class="line"><a name="l02674"></a><span class="lineno"> 2674</span>&#160;   <a class="code" href="../../d5/d60/utils_8h.html#af35c6f780502c691f0ae35e1d0f7a444">ast_sha1_hash</a>(buf, sidpass);</div><div class="line"><a name="l02675"></a><span class="lineno"> 2675</span>&#160;   iks_insert_cdata(iks_insert(query, <span class="stringliteral">&quot;digest&quot;</span>), buf, 0);</div><div class="line"><a name="l02676"></a><span class="lineno"> 2676</span>&#160;</div><div class="line"><a name="l02677"></a><span class="lineno"> 2677</span>&#160;   <a class="code" href="../../dc/d6b/res__xmpp_8c.html#a8ca3a53044fbd45f15aabf626faac619">ast_xmpp_client_lock</a>(client);</div><div class="line"><a name="l02678"></a><span class="lineno"> 2678</span>&#160;   iks_filter_add_rule(client-&gt;<a class="code" href="../../df/d42/structast__xmpp__client.html#a242fce88f9c9954695b13f7af1d415a9">filter</a>, <a class="code" href="../../dc/d6b/res__xmpp_8c.html#a98529e57f9646df0ba9f6db459cf1e93">xmpp_connect_hook</a>, client, IKS_RULE_TYPE, IKS_PAK_IQ, IKS_RULE_SUBTYPE, IKS_TYPE_RESULT, IKS_RULE_ID, client-&gt;<a class="code" href="../../df/d42/structast__xmpp__client.html#abee5661fa88af477fe47bbbd21136301">mid</a>, IKS_RULE_DONE);</div><div class="line"><a name="l02679"></a><span class="lineno"> 2679</span>&#160;   iks_insert_attrib(iq, <span class="stringliteral">&quot;id&quot;</span>, client-&gt;<a class="code" href="../../df/d42/structast__xmpp__client.html#abee5661fa88af477fe47bbbd21136301">mid</a>);</div><div class="line"><a name="l02680"></a><span class="lineno"> 2680</span>&#160;   <a class="code" href="../../dc/d6b/res__xmpp_8c.html#a5eb8d77affaba7e2fe254f7e7fbca789">ast_xmpp_increment_mid</a>(client-&gt;<a class="code" href="../../df/d42/structast__xmpp__client.html#abee5661fa88af477fe47bbbd21136301">mid</a>);</div><div class="line"><a name="l02681"></a><span class="lineno"> 2681</span>&#160;   <a class="code" href="../../dc/d6b/res__xmpp_8c.html#a28e4ab2757e6f989d4300ecbbe5acf36">ast_xmpp_client_unlock</a>(client);</div><div class="line"><a name="l02682"></a><span class="lineno"> 2682</span>&#160;</div><div class="line"><a name="l02683"></a><span class="lineno"> 2683</span>&#160;   iks_insert_attrib(iq, <span class="stringliteral">&quot;to&quot;</span>, client-&gt;<a class="code" href="../../df/d42/structast__xmpp__client.html#af738439b96e613a471505eb1222ac406">jid</a>-&gt;server);</div><div class="line"><a name="l02684"></a><span class="lineno"> 2684</span>&#160;</div><div class="line"><a name="l02685"></a><span class="lineno"> 2685</span>&#160;   <a class="code" href="../../dc/d6b/res__xmpp_8c.html#a01f156e90984166f2bbcbcc5a4a6e582">ast_xmpp_client_send</a>(client, iq);</div><div class="line"><a name="l02686"></a><span class="lineno"> 2686</span>&#160;</div><div class="line"><a name="l02687"></a><span class="lineno"> 2687</span>&#160;   iks_delete(iq);</div><div class="line"><a name="l02688"></a><span class="lineno"> 2688</span>&#160;</div><div class="line"><a name="l02689"></a><span class="lineno"> 2689</span>&#160;   <a class="code" href="../../dc/d6b/res__xmpp_8c.html#ac515389ec6c63a8b3bbd094ede0d7c4d">xmpp_client_change_state</a>(client, <a class="code" href="../../da/da0/xmpp_8h.html#ae37d560c438576bdcb47347088225ee6aeddf64cd40acf9ce3a91bacc33c3368c">XMPP_STATE_AUTHENTICATING</a>);</div><div class="line"><a name="l02690"></a><span class="lineno"> 2690</span>&#160;</div><div class="line"><a name="l02691"></a><span class="lineno"> 2691</span>&#160;   <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l02692"></a><span class="lineno"> 2692</span>&#160;}</div><div class="line"><a name="l02693"></a><span class="lineno"> 2693</span>&#160;<span class="comment"></span></div><div class="line"><a name="l02694"></a><span class="lineno"> 2694</span>&#160;<span class="comment">/*! \brief Internal function called when we need to authenticate using SASL */</span></div><div class="line"><a name="l02695"></a><span class="lineno"><a class="line" href="../../dc/d6b/res__xmpp_8c.html#a3dea4bfefdcef9d56e2c486e958db4c8"> 2695</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../dc/d6b/res__xmpp_8c.html#a3dea4bfefdcef9d56e2c486e958db4c8">xmpp_client_authenticate_sasl</a>(<span class="keyword">struct</span> <a class="code" href="../../df/d42/structast__xmpp__client.html">ast_xmpp_client</a> *client, <span class="keyword">struct</span> <a class="code" href="../../da/d00/structast__xmpp__client__config.html">ast_xmpp_client_config</a> *cfg, <span class="keywordtype">int</span> <a class="code" href="../../d7/d49/chan__ooh323_8c.html#a4d63fdfe5451ec2248c16a2739190c56">type</a>, iks *node)</div><div class="line"><a name="l02696"></a><span class="lineno"> 2696</span>&#160;{</div><div class="line"><a name="l02697"></a><span class="lineno"> 2697</span>&#160;   <span class="keywordtype">int</span> features, <a class="code" href="../../d9/d1e/func__strings_8c.html#af24e73aaf92f3000fda15d285e66df24">len</a> = strlen(client-&gt;<a class="code" href="../../df/d42/structast__xmpp__client.html#af738439b96e613a471505eb1222ac406">jid</a>-&gt;user) + strlen(cfg-&gt;<a class="code" href="../../da/d00/structast__xmpp__client__config.html#a54125aa1f0e661889f7a44db13a2b4b8">password</a>) + 3;</div><div class="line"><a name="l02698"></a><span class="lineno"> 2698</span>&#160;   iks *auth;</div><div class="line"><a name="l02699"></a><span class="lineno"> 2699</span>&#160;   <span class="keywordtype">char</span> combined[<a class="code" href="../../d9/d1e/func__strings_8c.html#af24e73aaf92f3000fda15d285e66df24">len</a>];</div><div class="line"><a name="l02700"></a><span class="lineno"> 2700</span>&#160;   <span class="keywordtype">char</span> <a class="code" href="../../de/d1f/main_2utils_8c.html#a094cd85754f67592588ab5a0636cf0ea">base64</a>[(len + 2) * 4 / 3];</div><div class="line"><a name="l02701"></a><span class="lineno"> 2701</span>&#160;</div><div class="line"><a name="l02702"></a><span class="lineno"> 2702</span>&#160;   <span class="keywordflow">if</span> (strcmp(iks_name(node), <span class="stringliteral">&quot;stream:features&quot;</span>)) {</div><div class="line"><a name="l02703"></a><span class="lineno"> 2703</span>&#160;      <span class="comment">/* Ignore anything beside stream features */</span></div><div class="line"><a name="l02704"></a><span class="lineno"> 2704</span>&#160;      <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l02705"></a><span class="lineno"> 2705</span>&#160;   }</div><div class="line"><a name="l02706"></a><span class="lineno"> 2706</span>&#160;</div><div class="line"><a name="l02707"></a><span class="lineno"> 2707</span>&#160;   features = iks_stream_features(node);</div><div class="line"><a name="l02708"></a><span class="lineno"> 2708</span>&#160;</div><div class="line"><a name="l02709"></a><span class="lineno"> 2709</span>&#160;   <span class="keywordflow">if</span> ((features &amp; IKS_STREAM_SASL_MD5) &amp;&amp; !<a class="code" href="../../dc/d6b/res__xmpp_8c.html#ae13d4153b0221e790967206a41a9e253">xmpp_is_secure</a>(client)) {</div><div class="line"><a name="l02710"></a><span class="lineno"> 2710</span>&#160;      <span class="keywordflow">if</span> (iks_start_sasl(client-&gt;<a class="code" href="../../df/d42/structast__xmpp__client.html#a84da25e2e78fab08d8077368bdbef1c6">parser</a>, IKS_SASL_DIGEST_MD5, (<span class="keywordtype">char</span>*)client-&gt;<a class="code" href="../../df/d42/structast__xmpp__client.html#af738439b96e613a471505eb1222ac406">jid</a>-&gt;user, (<span class="keywordtype">char</span>*)cfg-&gt;<a class="code" href="../../da/d00/structast__xmpp__client__config.html#a54125aa1f0e661889f7a44db13a2b4b8">password</a>) != IKS_OK) {</div><div class="line"><a name="l02711"></a><span class="lineno"> 2711</span>&#160;         <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Tried to authenticate client &#39;%s&#39; using SASL DIGEST-MD5 but could not\n&quot;</span>, client-&gt;<a class="code" href="../../df/d42/structast__xmpp__client.html#ace9168767fc3707cf5f0a7d049682ba3">name</a>);</div><div class="line"><a name="l02712"></a><span class="lineno"> 2712</span>&#160;         <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l02713"></a><span class="lineno"> 2713</span>&#160;      }</div><div class="line"><a name="l02714"></a><span class="lineno"> 2714</span>&#160;</div><div class="line"><a name="l02715"></a><span class="lineno"> 2715</span>&#160;      <a class="code" href="../../dc/d6b/res__xmpp_8c.html#ac515389ec6c63a8b3bbd094ede0d7c4d">xmpp_client_change_state</a>(client, <a class="code" href="../../da/da0/xmpp_8h.html#ae37d560c438576bdcb47347088225ee6aeddf64cd40acf9ce3a91bacc33c3368c">XMPP_STATE_AUTHENTICATING</a>);</div><div class="line"><a name="l02716"></a><span class="lineno"> 2716</span>&#160;      <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l02717"></a><span class="lineno"> 2717</span>&#160;   }</div><div class="line"><a name="l02718"></a><span class="lineno"> 2718</span>&#160;</div><div class="line"><a name="l02719"></a><span class="lineno"> 2719</span>&#160;   <span class="comment">/* Our only other available option is plain so if they don&#39;t support it, bail out now */</span></div><div class="line"><a name="l02720"></a><span class="lineno"> 2720</span>&#160;   <span class="keywordflow">if</span> (!(features &amp; IKS_STREAM_SASL_PLAIN)) {</div><div class="line"><a name="l02721"></a><span class="lineno"> 2721</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Tried to authenticate client &#39;%s&#39; using SASL PLAIN but server does not support it\n&quot;</span>, client-&gt;<a class="code" href="../../df/d42/structast__xmpp__client.html#ace9168767fc3707cf5f0a7d049682ba3">name</a>);</div><div class="line"><a name="l02722"></a><span class="lineno"> 2722</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l02723"></a><span class="lineno"> 2723</span>&#160;   }</div><div class="line"><a name="l02724"></a><span class="lineno"> 2724</span>&#160;</div><div class="line"><a name="l02725"></a><span class="lineno"> 2725</span>&#160;   <span class="keywordflow">if</span> (!(auth = iks_new(<span class="stringliteral">&quot;auth&quot;</span>))) {</div><div class="line"><a name="l02726"></a><span class="lineno"> 2726</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Could not allocate memory for SASL PLAIN authentication for client &#39;%s&#39;\n&quot;</span>, client-&gt;<a class="code" href="../../df/d42/structast__xmpp__client.html#ace9168767fc3707cf5f0a7d049682ba3">name</a>);</div><div class="line"><a name="l02727"></a><span class="lineno"> 2727</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l02728"></a><span class="lineno"> 2728</span>&#160;   }</div><div class="line"><a name="l02729"></a><span class="lineno"> 2729</span>&#160;</div><div class="line"><a name="l02730"></a><span class="lineno"> 2730</span>&#160;   iks_insert_attrib(auth, <span class="stringliteral">&quot;xmlns&quot;</span>, IKS_NS_XMPP_SASL);</div><div class="line"><a name="l02731"></a><span class="lineno"> 2731</span>&#160;   <span class="keywordflow">if</span> (!<a class="code" href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a>(cfg-&gt;<a class="code" href="../../da/d00/structast__xmpp__client__config.html#ad300470818476484645b03f3c0c66591">refresh_token</a>)) {</div><div class="line"><a name="l02732"></a><span class="lineno"> 2732</span>&#160;      iks_insert_attrib(auth, <span class="stringliteral">&quot;mechanism&quot;</span>, <span class="stringliteral">&quot;X-OAUTH2&quot;</span>);</div><div class="line"><a name="l02733"></a><span class="lineno"> 2733</span>&#160;      iks_insert_attrib(auth, <span class="stringliteral">&quot;auth:service&quot;</span>, <span class="stringliteral">&quot;oauth2&quot;</span>);</div><div class="line"><a name="l02734"></a><span class="lineno"> 2734</span>&#160;      iks_insert_attrib(auth, <span class="stringliteral">&quot;xmlns:auth&quot;</span>, <span class="stringliteral">&quot;http://www.google.com/talk/protocol/auth&quot;</span>);</div><div class="line"><a name="l02735"></a><span class="lineno"> 2735</span>&#160;   } <span class="keywordflow">else</span> {</div><div class="line"><a name="l02736"></a><span class="lineno"> 2736</span>&#160;      iks_insert_attrib(auth, <span class="stringliteral">&quot;mechanism&quot;</span>, <span class="stringliteral">&quot;PLAIN&quot;</span>);</div><div class="line"><a name="l02737"></a><span class="lineno"> 2737</span>&#160;   }</div><div class="line"><a name="l02738"></a><span class="lineno"> 2738</span>&#160;</div><div class="line"><a name="l02739"></a><span class="lineno"> 2739</span>&#160;   <span class="keywordflow">if</span> (strchr(client-&gt;<a class="code" href="../../df/d42/structast__xmpp__client.html#af738439b96e613a471505eb1222ac406">jid</a>-&gt;user, <span class="charliteral">&#39;/&#39;</span>)) {</div><div class="line"><a name="l02740"></a><span class="lineno"> 2740</span>&#160;      <span class="keywordtype">char</span> *<a class="code" href="../../d8/dbc/structuser.html">user</a> = <a class="code" href="../../d8/d8a/astmm_8h.html#ab5f0750cc80ba337fdcbddea2d3a1ee6">ast_strdupa</a>(client-&gt;<a class="code" href="../../df/d42/structast__xmpp__client.html#af738439b96e613a471505eb1222ac406">jid</a>-&gt;user);</div><div class="line"><a name="l02741"></a><span class="lineno"> 2741</span>&#160;</div><div class="line"><a name="l02742"></a><span class="lineno"> 2742</span>&#160;      snprintf(combined, <span class="keyword">sizeof</span>(combined), <span class="stringliteral">&quot;%c%s%c%s&quot;</span>, 0, <a class="code" href="../../de/da3/include_2asterisk_2compat_8h.html#a40eca58273c74a20a17f137d18ba826c">strsep</a>(&amp;user, <span class="stringliteral">&quot;/&quot;</span>), 0, cfg-&gt;<a class="code" href="../../da/d00/structast__xmpp__client__config.html#a54125aa1f0e661889f7a44db13a2b4b8">password</a>);</div><div class="line"><a name="l02743"></a><span class="lineno"> 2743</span>&#160;   } <span class="keywordflow">else</span> {</div><div class="line"><a name="l02744"></a><span class="lineno"> 2744</span>&#160;      snprintf(combined, <span class="keyword">sizeof</span>(combined), <span class="stringliteral">&quot;%c%s%c%s&quot;</span>, 0, client-&gt;<a class="code" href="../../df/d42/structast__xmpp__client.html#af738439b96e613a471505eb1222ac406">jid</a>-&gt;user, 0, cfg-&gt;<a class="code" href="../../da/d00/structast__xmpp__client__config.html#a54125aa1f0e661889f7a44db13a2b4b8">password</a>);</div><div class="line"><a name="l02745"></a><span class="lineno"> 2745</span>&#160;   }</div><div class="line"><a name="l02746"></a><span class="lineno"> 2746</span>&#160;</div><div class="line"><a name="l02747"></a><span class="lineno"> 2747</span>&#160;   <a class="code" href="../../d5/d60/utils_8h.html#a555dad1bd5b23acf01cf08f1affab879">ast_base64encode</a>(<a class="code" href="../../de/d1f/main_2utils_8c.html#a094cd85754f67592588ab5a0636cf0ea">base64</a>, (<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *) combined, len - 1, (len + 2) * 4 / 3);</div><div class="line"><a name="l02748"></a><span class="lineno"> 2748</span>&#160;   iks_insert_cdata(auth, <a class="code" href="../../de/d1f/main_2utils_8c.html#a094cd85754f67592588ab5a0636cf0ea">base64</a>, 0);</div><div class="line"><a name="l02749"></a><span class="lineno"> 2749</span>&#160;</div><div class="line"><a name="l02750"></a><span class="lineno"> 2750</span>&#160;   <a class="code" href="../../dc/d6b/res__xmpp_8c.html#a01f156e90984166f2bbcbcc5a4a6e582">ast_xmpp_client_send</a>(client, auth);</div><div class="line"><a name="l02751"></a><span class="lineno"> 2751</span>&#160;</div><div class="line"><a name="l02752"></a><span class="lineno"> 2752</span>&#160;   iks_delete(auth);</div><div class="line"><a name="l02753"></a><span class="lineno"> 2753</span>&#160;</div><div class="line"><a name="l02754"></a><span class="lineno"> 2754</span>&#160;   <a class="code" href="../../dc/d6b/res__xmpp_8c.html#ac515389ec6c63a8b3bbd094ede0d7c4d">xmpp_client_change_state</a>(client, <a class="code" href="../../da/da0/xmpp_8h.html#ae37d560c438576bdcb47347088225ee6aeddf64cd40acf9ce3a91bacc33c3368c">XMPP_STATE_AUTHENTICATING</a>);</div><div class="line"><a name="l02755"></a><span class="lineno"> 2755</span>&#160;</div><div class="line"><a name="l02756"></a><span class="lineno"> 2756</span>&#160;   <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l02757"></a><span class="lineno"> 2757</span>&#160;}</div><div class="line"><a name="l02758"></a><span class="lineno"> 2758</span>&#160;<span class="comment"></span></div><div class="line"><a name="l02759"></a><span class="lineno"> 2759</span>&#160;<span class="comment">/*! \brief Internal function called when we need to authenticate */</span></div><div class="line"><a name="l02760"></a><span class="lineno"><a class="line" href="../../dc/d6b/res__xmpp_8c.html#aead926c74102aaf5443a74bb5d3e2a68"> 2760</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../dc/d6b/res__xmpp_8c.html#aead926c74102aaf5443a74bb5d3e2a68">xmpp_client_authenticate</a>(<span class="keyword">struct</span> <a class="code" href="../../df/d42/structast__xmpp__client.html">ast_xmpp_client</a> *client, <span class="keyword">struct</span> <a class="code" href="../../da/d00/structast__xmpp__client__config.html">ast_xmpp_client_config</a> *cfg, <span class="keywordtype">int</span> <a class="code" href="../../d7/d49/chan__ooh323_8c.html#a4d63fdfe5451ec2248c16a2739190c56">type</a>, iks *node)</div><div class="line"><a name="l02761"></a><span class="lineno"> 2761</span>&#160;{</div><div class="line"><a name="l02762"></a><span class="lineno"> 2762</span>&#160;   <span class="keywordflow">return</span> <a class="code" href="../../d5/d60/utils_8h.html#a00d4c9254c9827d6fa44f17a326744a5">ast_test_flag</a>(&amp;cfg-&gt;<a class="code" href="../../da/d00/structast__xmpp__client__config.html#aec78000b2897c094f68ed72559e18acd">flags</a>, <a class="code" href="../../dc/d6b/res__xmpp_8c.html#aa3759d2ddcc12f3f5ef5a8a3ffa4a4dfa7f963ec64d83b0ef771bb7d34a49dc34">XMPP_USESASL</a>) ? <a class="code" href="../../dc/d6b/res__xmpp_8c.html#a3dea4bfefdcef9d56e2c486e958db4c8">xmpp_client_authenticate_sasl</a>(client, cfg, type, node) : <a class="code" href="../../dc/d6b/res__xmpp_8c.html#a22920dcde5570770b359775466b08d72">xmpp_client_authenticate_digest</a>(client, cfg, type, node);</div><div class="line"><a name="l02763"></a><span class="lineno"> 2763</span>&#160;}</div><div class="line"><a name="l02764"></a><span class="lineno"> 2764</span>&#160;<span class="comment"></span></div><div class="line"><a name="l02765"></a><span class="lineno"> 2765</span>&#160;<span class="comment">/*! \brief Internal function called when we are authenticating */</span></div><div class="line"><a name="l02766"></a><span class="lineno"><a class="line" href="../../dc/d6b/res__xmpp_8c.html#ae3571a1477967e051aed72a91c32bc86"> 2766</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../dc/d6b/res__xmpp_8c.html#ae3571a1477967e051aed72a91c32bc86">xmpp_client_authenticating</a>(<span class="keyword">struct</span> <a class="code" href="../../df/d42/structast__xmpp__client.html">ast_xmpp_client</a> *client, <span class="keyword">struct</span> <a class="code" href="../../da/d00/structast__xmpp__client__config.html">ast_xmpp_client_config</a> *cfg, <span class="keywordtype">int</span> <a class="code" href="../../d7/d49/chan__ooh323_8c.html#a4d63fdfe5451ec2248c16a2739190c56">type</a>, iks *node)</div><div class="line"><a name="l02767"></a><span class="lineno"> 2767</span>&#160;{</div><div class="line"><a name="l02768"></a><span class="lineno"> 2768</span>&#160;   <span class="keywordtype">int</span> features;</div><div class="line"><a name="l02769"></a><span class="lineno"> 2769</span>&#160;</div><div class="line"><a name="l02770"></a><span class="lineno"> 2770</span>&#160;   <span class="keywordflow">if</span> (!strcmp(iks_name(node), <span class="stringliteral">&quot;success&quot;</span>)) {</div><div class="line"><a name="l02771"></a><span class="lineno"> 2771</span>&#160;      <span class="comment">/* Authentication was a success, yay! */</span></div><div class="line"><a name="l02772"></a><span class="lineno"> 2772</span>&#160;      <a class="code" href="../../dc/d6b/res__xmpp_8c.html#a2f3d4b03f949f57841694200618c8c66">xmpp_send_stream_header</a>(client, cfg, client-&gt;<a class="code" href="../../df/d42/structast__xmpp__client.html#af738439b96e613a471505eb1222ac406">jid</a>-&gt;server);</div><div class="line"><a name="l02773"></a><span class="lineno"> 2773</span>&#160;</div><div class="line"><a name="l02774"></a><span class="lineno"> 2774</span>&#160;      <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l02775"></a><span class="lineno"> 2775</span>&#160;   } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcmp(iks_name(node), <span class="stringliteral">&quot;failure&quot;</span>)) {</div><div class="line"><a name="l02776"></a><span class="lineno"> 2776</span>&#160;      <span class="comment">/* Authentication was a bust, disconnect and reconnect later */</span></div><div class="line"><a name="l02777"></a><span class="lineno"> 2777</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l02778"></a><span class="lineno"> 2778</span>&#160;   } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strcmp(iks_name(node), <span class="stringliteral">&quot;stream:features&quot;</span>)) {</div><div class="line"><a name="l02779"></a><span class="lineno"> 2779</span>&#160;      <span class="comment">/* Ignore any other responses */</span></div><div class="line"><a name="l02780"></a><span class="lineno"> 2780</span>&#160;      <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l02781"></a><span class="lineno"> 2781</span>&#160;   }</div><div class="line"><a name="l02782"></a><span class="lineno"> 2782</span>&#160;</div><div class="line"><a name="l02783"></a><span class="lineno"> 2783</span>&#160;   features = iks_stream_features(node);</div><div class="line"><a name="l02784"></a><span class="lineno"> 2784</span>&#160;</div><div class="line"><a name="l02785"></a><span class="lineno"> 2785</span>&#160;   <span class="keywordflow">if</span> (features &amp; IKS_STREAM_BIND) {</div><div class="line"><a name="l02786"></a><span class="lineno"> 2786</span>&#160;      iks *auth;</div><div class="line"><a name="l02787"></a><span class="lineno"> 2787</span>&#160;</div><div class="line"><a name="l02788"></a><span class="lineno"> 2788</span>&#160;      <span class="keywordflow">if</span> (!(auth = iks_make_resource_bind(client-&gt;<a class="code" href="../../df/d42/structast__xmpp__client.html#af738439b96e613a471505eb1222ac406">jid</a>))) {</div><div class="line"><a name="l02789"></a><span class="lineno"> 2789</span>&#160;         <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Failed to allocate memory for stream bind on client &#39;%s&#39;\n&quot;</span>, client-&gt;<a class="code" href="../../df/d42/structast__xmpp__client.html#ace9168767fc3707cf5f0a7d049682ba3">name</a>);</div><div class="line"><a name="l02790"></a><span class="lineno"> 2790</span>&#160;         <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l02791"></a><span class="lineno"> 2791</span>&#160;      }</div><div class="line"><a name="l02792"></a><span class="lineno"> 2792</span>&#160;</div><div class="line"><a name="l02793"></a><span class="lineno"> 2793</span>&#160;      <a class="code" href="../../dc/d6b/res__xmpp_8c.html#a8ca3a53044fbd45f15aabf626faac619">ast_xmpp_client_lock</a>(client);</div><div class="line"><a name="l02794"></a><span class="lineno"> 2794</span>&#160;      iks_insert_attrib(auth, <span class="stringliteral">&quot;id&quot;</span>, client-&gt;<a class="code" href="../../df/d42/structast__xmpp__client.html#abee5661fa88af477fe47bbbd21136301">mid</a>);</div><div class="line"><a name="l02795"></a><span class="lineno"> 2795</span>&#160;      <a class="code" href="../../dc/d6b/res__xmpp_8c.html#a5eb8d77affaba7e2fe254f7e7fbca789">ast_xmpp_increment_mid</a>(client-&gt;<a class="code" href="../../df/d42/structast__xmpp__client.html#abee5661fa88af477fe47bbbd21136301">mid</a>);</div><div class="line"><a name="l02796"></a><span class="lineno"> 2796</span>&#160;      <a class="code" href="../../dc/d6b/res__xmpp_8c.html#a28e4ab2757e6f989d4300ecbbe5acf36">ast_xmpp_client_unlock</a>(client);</div><div class="line"><a name="l02797"></a><span class="lineno"> 2797</span>&#160;      <a class="code" href="../../dc/d6b/res__xmpp_8c.html#a01f156e90984166f2bbcbcc5a4a6e582">ast_xmpp_client_send</a>(client, auth);</div><div class="line"><a name="l02798"></a><span class="lineno"> 2798</span>&#160;</div><div class="line"><a name="l02799"></a><span class="lineno"> 2799</span>&#160;      iks_delete(auth);</div><div class="line"><a name="l02800"></a><span class="lineno"> 2800</span>&#160;</div><div class="line"><a name="l02801"></a><span class="lineno"> 2801</span>&#160;      iks_filter_add_rule(client-&gt;<a class="code" href="../../df/d42/structast__xmpp__client.html#a242fce88f9c9954695b13f7af1d415a9">filter</a>, <a class="code" href="../../dc/d6b/res__xmpp_8c.html#a98529e57f9646df0ba9f6db459cf1e93">xmpp_connect_hook</a>, client, IKS_RULE_TYPE, IKS_PAK_IQ, IKS_RULE_SUBTYPE, IKS_TYPE_RESULT, IKS_RULE_DONE);</div><div class="line"><a name="l02802"></a><span class="lineno"> 2802</span>&#160;   }</div><div class="line"><a name="l02803"></a><span class="lineno"> 2803</span>&#160;</div><div class="line"><a name="l02804"></a><span class="lineno"> 2804</span>&#160;   <span class="keywordflow">if</span> (features &amp; IKS_STREAM_SESSION) {</div><div class="line"><a name="l02805"></a><span class="lineno"> 2805</span>&#160;      iks *auth;</div><div class="line"><a name="l02806"></a><span class="lineno"> 2806</span>&#160;</div><div class="line"><a name="l02807"></a><span class="lineno"> 2807</span>&#160;      <span class="keywordflow">if</span> (!(auth = iks_make_session())) {</div><div class="line"><a name="l02808"></a><span class="lineno"> 2808</span>&#160;         <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Failed to allocate memory for stream session on client &#39;%s&#39;\n&quot;</span>, client-&gt;<a class="code" href="../../df/d42/structast__xmpp__client.html#ace9168767fc3707cf5f0a7d049682ba3">name</a>);</div><div class="line"><a name="l02809"></a><span class="lineno"> 2809</span>&#160;         <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l02810"></a><span class="lineno"> 2810</span>&#160;      }</div><div class="line"><a name="l02811"></a><span class="lineno"> 2811</span>&#160;</div><div class="line"><a name="l02812"></a><span class="lineno"> 2812</span>&#160;      iks_insert_attrib(auth, <span class="stringliteral">&quot;id&quot;</span>, <span class="stringliteral">&quot;auth&quot;</span>);</div><div class="line"><a name="l02813"></a><span class="lineno"> 2813</span>&#160;      <a class="code" href="../../dc/d6b/res__xmpp_8c.html#a8ca3a53044fbd45f15aabf626faac619">ast_xmpp_client_lock</a>(client);</div><div class="line"><a name="l02814"></a><span class="lineno"> 2814</span>&#160;      <a class="code" href="../../dc/d6b/res__xmpp_8c.html#a5eb8d77affaba7e2fe254f7e7fbca789">ast_xmpp_increment_mid</a>(client-&gt;<a class="code" href="../../df/d42/structast__xmpp__client.html#abee5661fa88af477fe47bbbd21136301">mid</a>);</div><div class="line"><a name="l02815"></a><span class="lineno"> 2815</span>&#160;      <a class="code" href="../../dc/d6b/res__xmpp_8c.html#a28e4ab2757e6f989d4300ecbbe5acf36">ast_xmpp_client_unlock</a>(client);</div><div class="line"><a name="l02816"></a><span class="lineno"> 2816</span>&#160;      <a class="code" href="../../dc/d6b/res__xmpp_8c.html#a01f156e90984166f2bbcbcc5a4a6e582">ast_xmpp_client_send</a>(client, auth);</div><div class="line"><a name="l02817"></a><span class="lineno"> 2817</span>&#160;</div><div class="line"><a name="l02818"></a><span class="lineno"> 2818</span>&#160;      iks_delete(auth);</div><div class="line"><a name="l02819"></a><span class="lineno"> 2819</span>&#160;</div><div class="line"><a name="l02820"></a><span class="lineno"> 2820</span>&#160;      iks_filter_add_rule(client-&gt;<a class="code" href="../../df/d42/structast__xmpp__client.html#a242fce88f9c9954695b13f7af1d415a9">filter</a>, <a class="code" href="../../dc/d6b/res__xmpp_8c.html#a98529e57f9646df0ba9f6db459cf1e93">xmpp_connect_hook</a>, client, IKS_RULE_TYPE, IKS_PAK_IQ, IKS_RULE_SUBTYPE, IKS_TYPE_RESULT, IKS_RULE_ID, <span class="stringliteral">&quot;auth&quot;</span>, IKS_RULE_DONE);</div><div class="line"><a name="l02821"></a><span class="lineno"> 2821</span>&#160;   }</div><div class="line"><a name="l02822"></a><span class="lineno"> 2822</span>&#160;</div><div class="line"><a name="l02823"></a><span class="lineno"> 2823</span>&#160;   <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l02824"></a><span class="lineno"> 2824</span>&#160;}</div><div class="line"><a name="l02825"></a><span class="lineno"> 2825</span>&#160;<span class="comment"></span></div><div class="line"><a name="l02826"></a><span class="lineno"> 2826</span>&#160;<span class="comment">/*! \brief Internal function called when we should authenticate as a component */</span></div><div class="line"><a name="l02827"></a><span class="lineno"><a class="line" href="../../dc/d6b/res__xmpp_8c.html#a35b7847735c4ada0637abea6bb40f0fc"> 2827</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../dc/d6b/res__xmpp_8c.html#a35b7847735c4ada0637abea6bb40f0fc">xmpp_component_authenticate</a>(<span class="keyword">struct</span> <a class="code" href="../../df/d42/structast__xmpp__client.html">ast_xmpp_client</a> *client, <span class="keyword">struct</span> <a class="code" href="../../da/d00/structast__xmpp__client__config.html">ast_xmpp_client_config</a> *cfg, <span class="keywordtype">int</span> <a class="code" href="../../d7/d49/chan__ooh323_8c.html#a4d63fdfe5451ec2248c16a2739190c56">type</a>, iks *node)</div><div class="line"><a name="l02828"></a><span class="lineno"> 2828</span>&#160;{</div><div class="line"><a name="l02829"></a><span class="lineno"> 2829</span>&#160;   <span class="keywordtype">char</span> secret[160], shasum[320], <a class="code" href="../../d8/d9e/structmessage.html">message</a>[344];</div><div class="line"><a name="l02830"></a><span class="lineno"> 2830</span>&#160;   ikspak *pak = iks_packet(node);</div><div class="line"><a name="l02831"></a><span class="lineno"> 2831</span>&#160;</div><div class="line"><a name="l02832"></a><span class="lineno"> 2832</span>&#160;   snprintf(secret, <span class="keyword">sizeof</span>(secret), <span class="stringliteral">&quot;%s%s&quot;</span>, pak-&gt;id, cfg-&gt;<a class="code" href="../../da/d00/structast__xmpp__client__config.html#a54125aa1f0e661889f7a44db13a2b4b8">password</a>);</div><div class="line"><a name="l02833"></a><span class="lineno"> 2833</span>&#160;   <a class="code" href="../../d5/d60/utils_8h.html#af35c6f780502c691f0ae35e1d0f7a444">ast_sha1_hash</a>(shasum, secret);</div><div class="line"><a name="l02834"></a><span class="lineno"> 2834</span>&#160;   snprintf(message, <span class="keyword">sizeof</span>(message), <span class="stringliteral">&quot;&lt;handshake&gt;%s&lt;/handshake&gt;&quot;</span>, shasum);</div><div class="line"><a name="l02835"></a><span class="lineno"> 2835</span>&#160;</div><div class="line"><a name="l02836"></a><span class="lineno"> 2836</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../dc/d6b/res__xmpp_8c.html#a3fd85bbc5a1a08d890b80d317ada622b">xmpp_client_send_raw_message</a>(client, message) != IKS_OK) {</div><div class="line"><a name="l02837"></a><span class="lineno"> 2837</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Unable to send handshake for component &#39;%s&#39;\n&quot;</span>, client-&gt;<a class="code" href="../../df/d42/structast__xmpp__client.html#ace9168767fc3707cf5f0a7d049682ba3">name</a>);</div><div class="line"><a name="l02838"></a><span class="lineno"> 2838</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l02839"></a><span class="lineno"> 2839</span>&#160;   }</div><div class="line"><a name="l02840"></a><span class="lineno"> 2840</span>&#160;</div><div class="line"><a name="l02841"></a><span class="lineno"> 2841</span>&#160;   <a class="code" href="../../dc/d6b/res__xmpp_8c.html#ac515389ec6c63a8b3bbd094ede0d7c4d">xmpp_client_change_state</a>(client, <a class="code" href="../../da/da0/xmpp_8h.html#ae37d560c438576bdcb47347088225ee6aeddf64cd40acf9ce3a91bacc33c3368c">XMPP_STATE_AUTHENTICATING</a>);</div><div class="line"><a name="l02842"></a><span class="lineno"> 2842</span>&#160;</div><div class="line"><a name="l02843"></a><span class="lineno"> 2843</span>&#160;   <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l02844"></a><span class="lineno"> 2844</span>&#160;}</div><div class="line"><a name="l02845"></a><span class="lineno"> 2845</span>&#160;<span class="comment"></span></div><div class="line"><a name="l02846"></a><span class="lineno"> 2846</span>&#160;<span class="comment">/*! \brief Hook function called when component receives a service discovery get message */</span></div><div class="line"><a name="l02847"></a><span class="lineno"><a class="line" href="../../dc/d6b/res__xmpp_8c.html#ab9ffec0b6972e567ecd01d93fcc19ec4"> 2847</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../dc/d6b/res__xmpp_8c.html#ab9ffec0b6972e567ecd01d93fcc19ec4">xmpp_component_service_discovery_get_hook</a>(<span class="keywordtype">void</span> *data, ikspak *pak)</div><div class="line"><a name="l02848"></a><span class="lineno"> 2848</span>&#160;{</div><div class="line"><a name="l02849"></a><span class="lineno"> 2849</span>&#160;   <a class="code" href="../../d5/d60/utils_8h.html#a1604b4d72144dd3d9f7da668e90337e9">RAII_VAR</a>(<span class="keyword">struct</span> <a class="code" href="../../de/d1c/structxmpp__config.html">xmpp_config</a> *, cfg, <a class="code" href="../../d5/da5/astobj2_8h.html#a86d8d6c3c8866ed0a60121da055cd225">ao2_global_obj_ref</a>(<a class="code" href="../../d3/d4e/chan__console_8c.html#aa36e3e2c486b920b166c2d17c5242221">globals</a>), <a class="code" href="../../d5/da5/astobj2_8h.html#a6321ee982370c55ab3c24c72c562cbdd">ao2_cleanup</a>);</div><div class="line"><a name="l02850"></a><span class="lineno"> 2850</span>&#160;   <a class="code" href="../../d5/d60/utils_8h.html#a1604b4d72144dd3d9f7da668e90337e9">RAII_VAR</a>(<span class="keyword">struct</span> <a class="code" href="../../da/d00/structast__xmpp__client__config.html">ast_xmpp_client_config</a> *, clientcfg, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../d5/da5/astobj2_8h.html#a6321ee982370c55ab3c24c72c562cbdd">ao2_cleanup</a>);</div><div class="line"><a name="l02851"></a><span class="lineno"> 2851</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../df/d42/structast__xmpp__client.html">ast_xmpp_client</a> *client = data;</div><div class="line"><a name="l02852"></a><span class="lineno"> 2852</span>&#160;   iks *iq = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, *query = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, *identity = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, *disco = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, *reg = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, *<a class="code" href="../../dd/de9/res__agi_8c.html#aaaa94f6da87a703160a7acb2fd67422d">commands</a> = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, *gateway = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l02853"></a><span class="lineno"> 2853</span>&#160;   iks *<a class="code" href="../../d7/d49/chan__ooh323_8c.html#a81b4b1c3c855fb371e7723b473f1ee78">version</a> = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, *vcard = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, *search = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, *<a class="code" href="../../d8/d4f/test__config_8c.html#aecdc7cbd5dfa76493c0212caa55d706c">item</a> = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l02854"></a><span class="lineno"> 2854</span>&#160;   <span class="keywordtype">char</span> *node;</div><div class="line"><a name="l02855"></a><span class="lineno"> 2855</span>&#160;</div><div class="line"><a name="l02856"></a><span class="lineno"> 2856</span>&#160;   <span class="keywordflow">if</span> (!cfg || !cfg-&gt;clients || !(clientcfg = <a class="code" href="../../dc/d6b/res__xmpp_8c.html#a14d10033fb3b97f06238940259f45266">xmpp_config_find</a>(cfg-&gt;clients, client-&gt;<a class="code" href="../../df/d42/structast__xmpp__client.html#ace9168767fc3707cf5f0a7d049682ba3">name</a>)) ||</div><div class="line"><a name="l02857"></a><span class="lineno"> 2857</span>&#160;       !(iq = iks_new(<span class="stringliteral">&quot;iq&quot;</span>)) || !(query = iks_new(<span class="stringliteral">&quot;query&quot;</span>)) || !(identity = iks_new(<span class="stringliteral">&quot;identity&quot;</span>)) || !(disco = iks_new(<span class="stringliteral">&quot;feature&quot;</span>)) ||</div><div class="line"><a name="l02858"></a><span class="lineno"> 2858</span>&#160;       !(reg = iks_new(<span class="stringliteral">&quot;feature&quot;</span>)) || !(commands = iks_new(<span class="stringliteral">&quot;feature&quot;</span>)) || !(gateway = iks_new(<span class="stringliteral">&quot;feature&quot;</span>)) || !(version = iks_new(<span class="stringliteral">&quot;feature&quot;</span>)) ||</div><div class="line"><a name="l02859"></a><span class="lineno"> 2859</span>&#160;       !(vcard = iks_new(<span class="stringliteral">&quot;feature&quot;</span>)) || !(search = iks_new(<span class="stringliteral">&quot;search&quot;</span>)) || !(item = iks_new(<span class="stringliteral">&quot;item&quot;</span>))) {</div><div class="line"><a name="l02860"></a><span class="lineno"> 2860</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Failed to allocate stanzas for service discovery get response to &#39;%s&#39; on component &#39;%s&#39;\n&quot;</span>,</div><div class="line"><a name="l02861"></a><span class="lineno"> 2861</span>&#160;         pak-&gt;from-&gt;partial, client-&gt;<a class="code" href="../../df/d42/structast__xmpp__client.html#ace9168767fc3707cf5f0a7d049682ba3">name</a>);</div><div class="line"><a name="l02862"></a><span class="lineno"> 2862</span>&#160;      <span class="keywordflow">goto</span> <a class="code" href="../../dc/dbf/test__amihooks_8c.html#a5992b274cfdcacdbc1fa8347fd01ebde">done</a>;</div><div class="line"><a name="l02863"></a><span class="lineno"> 2863</span>&#160;   }</div><div class="line"><a name="l02864"></a><span class="lineno"> 2864</span>&#160;</div><div class="line"><a name="l02865"></a><span class="lineno"> 2865</span>&#160;   iks_insert_attrib(iq, <span class="stringliteral">&quot;from&quot;</span>, clientcfg-&gt;user);</div><div class="line"><a name="l02866"></a><span class="lineno"> 2866</span>&#160;   iks_insert_attrib(iq, <span class="stringliteral">&quot;to&quot;</span>, pak-&gt;from-&gt;full);</div><div class="line"><a name="l02867"></a><span class="lineno"> 2867</span>&#160;   iks_insert_attrib(iq, <span class="stringliteral">&quot;id&quot;</span>, pak-&gt;id);</div><div class="line"><a name="l02868"></a><span class="lineno"> 2868</span>&#160;   iks_insert_attrib(iq, <span class="stringliteral">&quot;type&quot;</span>, <span class="stringliteral">&quot;result&quot;</span>);</div><div class="line"><a name="l02869"></a><span class="lineno"> 2869</span>&#160;</div><div class="line"><a name="l02870"></a><span class="lineno"> 2870</span>&#160;   <span class="keywordflow">if</span> (!(node = iks_find_attrib(pak-&gt;query, <span class="stringliteral">&quot;node&quot;</span>))) {</div><div class="line"><a name="l02871"></a><span class="lineno"> 2871</span>&#160;      iks_insert_attrib(query, <span class="stringliteral">&quot;xmlns&quot;</span>, <span class="stringliteral">&quot;http://jabber.org/protocol/disco#info&quot;</span>);</div><div class="line"><a name="l02872"></a><span class="lineno"> 2872</span>&#160;      iks_insert_attrib(identity, <span class="stringliteral">&quot;category&quot;</span>, <span class="stringliteral">&quot;gateway&quot;</span>);</div><div class="line"><a name="l02873"></a><span class="lineno"> 2873</span>&#160;      iks_insert_attrib(identity, <span class="stringliteral">&quot;type&quot;</span>, <span class="stringliteral">&quot;pstn&quot;</span>);</div><div class="line"><a name="l02874"></a><span class="lineno"> 2874</span>&#160;      iks_insert_attrib(identity, <span class="stringliteral">&quot;name&quot;</span>, <span class="stringliteral">&quot;Asterisk The Open Source PBX&quot;</span>);</div><div class="line"><a name="l02875"></a><span class="lineno"> 2875</span>&#160;      iks_insert_attrib(disco, <span class="stringliteral">&quot;var&quot;</span>, <span class="stringliteral">&quot;http://jabber.org/protocol/disco&quot;</span>);</div><div class="line"><a name="l02876"></a><span class="lineno"> 2876</span>&#160;      iks_insert_attrib(reg, <span class="stringliteral">&quot;var&quot;</span>, <span class="stringliteral">&quot;jabber:iq:register&quot;</span>);</div><div class="line"><a name="l02877"></a><span class="lineno"> 2877</span>&#160;      iks_insert_attrib(commands, <span class="stringliteral">&quot;var&quot;</span>, <span class="stringliteral">&quot;http://jabber.org/protocol/commands&quot;</span>);</div><div class="line"><a name="l02878"></a><span class="lineno"> 2878</span>&#160;      iks_insert_attrib(gateway, <span class="stringliteral">&quot;var&quot;</span>, <span class="stringliteral">&quot;jabber:iq:gateway&quot;</span>);</div><div class="line"><a name="l02879"></a><span class="lineno"> 2879</span>&#160;      iks_insert_attrib(version, <span class="stringliteral">&quot;var&quot;</span>, <span class="stringliteral">&quot;jabber:iq:version&quot;</span>);</div><div class="line"><a name="l02880"></a><span class="lineno"> 2880</span>&#160;      iks_insert_attrib(vcard, <span class="stringliteral">&quot;var&quot;</span>, <span class="stringliteral">&quot;vcard-temp&quot;</span>);</div><div class="line"><a name="l02881"></a><span class="lineno"> 2881</span>&#160;      iks_insert_attrib(search, <span class="stringliteral">&quot;var&quot;</span>, <span class="stringliteral">&quot;jabber:iq:search&quot;</span>);</div><div class="line"><a name="l02882"></a><span class="lineno"> 2882</span>&#160;</div><div class="line"><a name="l02883"></a><span class="lineno"> 2883</span>&#160;      iks_insert_node(iq, query);</div><div class="line"><a name="l02884"></a><span class="lineno"> 2884</span>&#160;      iks_insert_node(query, identity);</div><div class="line"><a name="l02885"></a><span class="lineno"> 2885</span>&#160;      iks_insert_node(query, disco);</div><div class="line"><a name="l02886"></a><span class="lineno"> 2886</span>&#160;      iks_insert_node(query, reg);</div><div class="line"><a name="l02887"></a><span class="lineno"> 2887</span>&#160;      iks_insert_node(query, commands);</div><div class="line"><a name="l02888"></a><span class="lineno"> 2888</span>&#160;      iks_insert_node(query, gateway);</div><div class="line"><a name="l02889"></a><span class="lineno"> 2889</span>&#160;      iks_insert_node(query, version);</div><div class="line"><a name="l02890"></a><span class="lineno"> 2890</span>&#160;      iks_insert_node(query, vcard);</div><div class="line"><a name="l02891"></a><span class="lineno"> 2891</span>&#160;      iks_insert_node(query, search);</div><div class="line"><a name="l02892"></a><span class="lineno"> 2892</span>&#160;   } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(node, <span class="stringliteral">&quot;http://jabber.org/protocol/commands&quot;</span>)) {</div><div class="line"><a name="l02893"></a><span class="lineno"> 2893</span>&#160;      iks_insert_attrib(query, <span class="stringliteral">&quot;xmlns&quot;</span>, <span class="stringliteral">&quot;http://jabber.org/protocol/disco#items&quot;</span>);</div><div class="line"><a name="l02894"></a><span class="lineno"> 2894</span>&#160;      iks_insert_attrib(query, <span class="stringliteral">&quot;node&quot;</span>, <span class="stringliteral">&quot;http://jabber.org/protocol/commands&quot;</span>);</div><div class="line"><a name="l02895"></a><span class="lineno"> 2895</span>&#160;      iks_insert_attrib(item, <span class="stringliteral">&quot;node&quot;</span>, <span class="stringliteral">&quot;confirmaccount&quot;</span>);</div><div class="line"><a name="l02896"></a><span class="lineno"> 2896</span>&#160;      iks_insert_attrib(item, <span class="stringliteral">&quot;name&quot;</span>, <span class="stringliteral">&quot;Confirm account&quot;</span>);</div><div class="line"><a name="l02897"></a><span class="lineno"> 2897</span>&#160;      iks_insert_attrib(item, <span class="stringliteral">&quot;jid&quot;</span>, clientcfg-&gt;user);</div><div class="line"><a name="l02898"></a><span class="lineno"> 2898</span>&#160;</div><div class="line"><a name="l02899"></a><span class="lineno"> 2899</span>&#160;      iks_insert_node(iq, query);</div><div class="line"><a name="l02900"></a><span class="lineno"> 2900</span>&#160;      iks_insert_node(query, item);</div><div class="line"><a name="l02901"></a><span class="lineno"> 2901</span>&#160;   } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(node, <span class="stringliteral">&quot;confirmaccount&quot;</span>)) {</div><div class="line"><a name="l02902"></a><span class="lineno"> 2902</span>&#160;      iks_insert_attrib(query, <span class="stringliteral">&quot;xmlns&quot;</span>, <span class="stringliteral">&quot;http://jabber.org/protocol/disco#info&quot;</span>);</div><div class="line"><a name="l02903"></a><span class="lineno"> 2903</span>&#160;      iks_insert_attrib(commands, <span class="stringliteral">&quot;var&quot;</span>, <span class="stringliteral">&quot;http://jabber.org/protocol/commands&quot;</span>);</div><div class="line"><a name="l02904"></a><span class="lineno"> 2904</span>&#160;</div><div class="line"><a name="l02905"></a><span class="lineno"> 2905</span>&#160;      iks_insert_node(iq, query);</div><div class="line"><a name="l02906"></a><span class="lineno"> 2906</span>&#160;      iks_insert_node(query, commands);</div><div class="line"><a name="l02907"></a><span class="lineno"> 2907</span>&#160;   } <span class="keywordflow">else</span> {</div><div class="line"><a name="l02908"></a><span class="lineno"> 2908</span>&#160;      <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(3, <span class="stringliteral">&quot;Unsupported service discovery info request received with node &#39;%s&#39; on component &#39;%s&#39;\n&quot;</span>,</div><div class="line"><a name="l02909"></a><span class="lineno"> 2909</span>&#160;           node, client-&gt;<a class="code" href="../../df/d42/structast__xmpp__client.html#ace9168767fc3707cf5f0a7d049682ba3">name</a>);</div><div class="line"><a name="l02910"></a><span class="lineno"> 2910</span>&#160;      <span class="keywordflow">goto</span> <a class="code" href="../../dc/dbf/test__amihooks_8c.html#a5992b274cfdcacdbc1fa8347fd01ebde">done</a>;</div><div class="line"><a name="l02911"></a><span class="lineno"> 2911</span>&#160;   }</div><div class="line"><a name="l02912"></a><span class="lineno"> 2912</span>&#160;</div><div class="line"><a name="l02913"></a><span class="lineno"> 2913</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../dc/d6b/res__xmpp_8c.html#a01f156e90984166f2bbcbcc5a4a6e582">ast_xmpp_client_send</a>(client, iq)) {</div><div class="line"><a name="l02914"></a><span class="lineno"> 2914</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Could not send response to service discovery request on component &#39;%s&#39;\n&quot;</span>,</div><div class="line"><a name="l02915"></a><span class="lineno"> 2915</span>&#160;         client-&gt;<a class="code" href="../../df/d42/structast__xmpp__client.html#ace9168767fc3707cf5f0a7d049682ba3">name</a>);</div><div class="line"><a name="l02916"></a><span class="lineno"> 2916</span>&#160;   }</div><div class="line"><a name="l02917"></a><span class="lineno"> 2917</span>&#160;</div><div class="line"><a name="l02918"></a><span class="lineno"> 2918</span>&#160;<a class="code" href="../../dc/dbf/test__amihooks_8c.html#a5992b274cfdcacdbc1fa8347fd01ebde">done</a>:</div><div class="line"><a name="l02919"></a><span class="lineno"> 2919</span>&#160;   iks_delete(search);</div><div class="line"><a name="l02920"></a><span class="lineno"> 2920</span>&#160;   iks_delete(vcard);</div><div class="line"><a name="l02921"></a><span class="lineno"> 2921</span>&#160;   iks_delete(version);</div><div class="line"><a name="l02922"></a><span class="lineno"> 2922</span>&#160;   iks_delete(gateway);</div><div class="line"><a name="l02923"></a><span class="lineno"> 2923</span>&#160;   iks_delete(commands);</div><div class="line"><a name="l02924"></a><span class="lineno"> 2924</span>&#160;   iks_delete(reg);</div><div class="line"><a name="l02925"></a><span class="lineno"> 2925</span>&#160;   iks_delete(disco);</div><div class="line"><a name="l02926"></a><span class="lineno"> 2926</span>&#160;   iks_delete(identity);</div><div class="line"><a name="l02927"></a><span class="lineno"> 2927</span>&#160;   iks_delete(query);</div><div class="line"><a name="l02928"></a><span class="lineno"> 2928</span>&#160;   iks_delete(iq);</div><div class="line"><a name="l02929"></a><span class="lineno"> 2929</span>&#160;</div><div class="line"><a name="l02930"></a><span class="lineno"> 2930</span>&#160;   <span class="keywordflow">return</span> IKS_FILTER_EAT;</div><div class="line"><a name="l02931"></a><span class="lineno"> 2931</span>&#160;}</div><div class="line"><a name="l02932"></a><span class="lineno"> 2932</span>&#160;<span class="comment"></span></div><div class="line"><a name="l02933"></a><span class="lineno"> 2933</span>&#160;<span class="comment">/*! \brief Hook function called when the component is queried about registration */</span></div><div class="line"><a name="l02934"></a><span class="lineno"><a class="line" href="../../dc/d6b/res__xmpp_8c.html#a8a477b45a75d10929fc46e6e53308f27"> 2934</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../dc/d6b/res__xmpp_8c.html#a8a477b45a75d10929fc46e6e53308f27">xmpp_component_register_get_hook</a>(<span class="keywordtype">void</span> *data, ikspak *pak)</div><div class="line"><a name="l02935"></a><span class="lineno"> 2935</span>&#160;{</div><div class="line"><a name="l02936"></a><span class="lineno"> 2936</span>&#160;   <a class="code" href="../../d5/d60/utils_8h.html#a1604b4d72144dd3d9f7da668e90337e9">RAII_VAR</a>(<span class="keyword">struct</span> <a class="code" href="../../de/d1c/structxmpp__config.html">xmpp_config</a> *, cfg, <a class="code" href="../../d5/da5/astobj2_8h.html#a86d8d6c3c8866ed0a60121da055cd225">ao2_global_obj_ref</a>(<a class="code" href="../../d3/d4e/chan__console_8c.html#aa36e3e2c486b920b166c2d17c5242221">globals</a>), <a class="code" href="../../d5/da5/astobj2_8h.html#a6321ee982370c55ab3c24c72c562cbdd">ao2_cleanup</a>);</div><div class="line"><a name="l02937"></a><span class="lineno"> 2937</span>&#160;   <a class="code" href="../../d5/d60/utils_8h.html#a1604b4d72144dd3d9f7da668e90337e9">RAII_VAR</a>(<span class="keyword">struct</span> <a class="code" href="../../da/d00/structast__xmpp__client__config.html">ast_xmpp_client_config</a> *, clientcfg, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../d5/da5/astobj2_8h.html#a6321ee982370c55ab3c24c72c562cbdd">ao2_cleanup</a>);</div><div class="line"><a name="l02938"></a><span class="lineno"> 2938</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../df/d42/structast__xmpp__client.html">ast_xmpp_client</a> *client = data;</div><div class="line"><a name="l02939"></a><span class="lineno"> 2939</span>&#160;   iks *iq = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, *query = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, *<a class="code" href="../../d6/d47/utils_2frame_8c.html#a4a9391ee88e57361b613c4c2fd2bf4aa">error</a> = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, *notacceptable = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, *instructions = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l02940"></a><span class="lineno"> 2940</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d5/d25/structast__xmpp__buddy.html">ast_xmpp_buddy</a> *buddy;</div><div class="line"><a name="l02941"></a><span class="lineno"> 2941</span>&#160;   <span class="keywordtype">char</span> *node;</div><div class="line"><a name="l02942"></a><span class="lineno"> 2942</span>&#160;</div><div class="line"><a name="l02943"></a><span class="lineno"> 2943</span>&#160;   <span class="keywordflow">if</span> (!cfg || !cfg-&gt;clients || !(clientcfg = <a class="code" href="../../dc/d6b/res__xmpp_8c.html#a14d10033fb3b97f06238940259f45266">xmpp_config_find</a>(cfg-&gt;clients, client-&gt;<a class="code" href="../../df/d42/structast__xmpp__client.html#ace9168767fc3707cf5f0a7d049682ba3">name</a>)) ||</div><div class="line"><a name="l02944"></a><span class="lineno"> 2944</span>&#160;       !(iq = iks_new(<span class="stringliteral">&quot;iq&quot;</span>)) || !(query = iks_new(<span class="stringliteral">&quot;query&quot;</span>)) || !(error = iks_new(<span class="stringliteral">&quot;error&quot;</span>)) || !(notacceptable = iks_new(<span class="stringliteral">&quot;not-acceptable&quot;</span>)) ||</div><div class="line"><a name="l02945"></a><span class="lineno"> 2945</span>&#160;       !(instructions = iks_new(<span class="stringliteral">&quot;instructions&quot;</span>))) {</div><div class="line"><a name="l02946"></a><span class="lineno"> 2946</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Failed to allocate stanzas for register get response to &#39;%s&#39; on component &#39;%s&#39;\n&quot;</span>,</div><div class="line"><a name="l02947"></a><span class="lineno"> 2947</span>&#160;         pak-&gt;from-&gt;partial, client-&gt;<a class="code" href="../../df/d42/structast__xmpp__client.html#ace9168767fc3707cf5f0a7d049682ba3">name</a>);</div><div class="line"><a name="l02948"></a><span class="lineno"> 2948</span>&#160;      <span class="keywordflow">goto</span> <a class="code" href="../../dc/dbf/test__amihooks_8c.html#a5992b274cfdcacdbc1fa8347fd01ebde">done</a>;</div><div class="line"><a name="l02949"></a><span class="lineno"> 2949</span>&#160;   }</div><div class="line"><a name="l02950"></a><span class="lineno"> 2950</span>&#160;</div><div class="line"><a name="l02951"></a><span class="lineno"> 2951</span>&#160;   iks_insert_attrib(iq, <span class="stringliteral">&quot;from&quot;</span>, clientcfg-&gt;user);</div><div class="line"><a name="l02952"></a><span class="lineno"> 2952</span>&#160;   iks_insert_attrib(iq, <span class="stringliteral">&quot;to&quot;</span>, pak-&gt;from-&gt;full);</div><div class="line"><a name="l02953"></a><span class="lineno"> 2953</span>&#160;   iks_insert_attrib(iq, <span class="stringliteral">&quot;id&quot;</span>, pak-&gt;id);</div><div class="line"><a name="l02954"></a><span class="lineno"> 2954</span>&#160;   iks_insert_attrib(iq, <span class="stringliteral">&quot;type&quot;</span>, <span class="stringliteral">&quot;result&quot;</span>);</div><div class="line"><a name="l02955"></a><span class="lineno"> 2955</span>&#160;   iks_insert_attrib(query, <span class="stringliteral">&quot;xmlns&quot;</span>, <span class="stringliteral">&quot;jabber:iq:register&quot;</span>);</div><div class="line"><a name="l02956"></a><span class="lineno"> 2956</span>&#160;   iks_insert_node(iq, query);</div><div class="line"><a name="l02957"></a><span class="lineno"> 2957</span>&#160;</div><div class="line"><a name="l02958"></a><span class="lineno"> 2958</span>&#160;   <span class="keywordflow">if</span> (!(buddy = <a class="code" href="../../d5/da5/astobj2_8h.html#a911e0703891a9a7aaf73978152092586">ao2_find</a>(client-&gt;<a class="code" href="../../df/d42/structast__xmpp__client.html#a5082987d3e1eac5f625574800bb72c2c">buddies</a>, pak-&gt;from-&gt;partial, <a class="code" href="../../d5/da5/astobj2_8h.html#a22f40c733a085f259af94e864ebaa09a">OBJ_KEY</a>))) {</div><div class="line"><a name="l02959"></a><span class="lineno"> 2959</span>&#160;      iks_insert_attrib(error, <span class="stringliteral">&quot;code&quot;</span>, <span class="stringliteral">&quot;406&quot;</span>);</div><div class="line"><a name="l02960"></a><span class="lineno"> 2960</span>&#160;      iks_insert_attrib(error, <span class="stringliteral">&quot;type&quot;</span>, <span class="stringliteral">&quot;modify&quot;</span>);</div><div class="line"><a name="l02961"></a><span class="lineno"> 2961</span>&#160;      iks_insert_attrib(notacceptable, <span class="stringliteral">&quot;xmlns&quot;</span>, <span class="stringliteral">&quot;urn:ietf:params:xml:ns:xmpp-stanzas&quot;</span>);</div><div class="line"><a name="l02962"></a><span class="lineno"> 2962</span>&#160;</div><div class="line"><a name="l02963"></a><span class="lineno"> 2963</span>&#160;      iks_insert_node(iq, error);</div><div class="line"><a name="l02964"></a><span class="lineno"> 2964</span>&#160;      iks_insert_node(error, notacceptable);</div><div class="line"><a name="l02965"></a><span class="lineno"> 2965</span>&#160;</div><div class="line"><a name="l02966"></a><span class="lineno"> 2966</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Received register attempt from &#39;%s&#39; but buddy is not configured on component &#39;%s&#39;\n&quot;</span>,</div><div class="line"><a name="l02967"></a><span class="lineno"> 2967</span>&#160;         pak-&gt;from-&gt;partial, client-&gt;<a class="code" href="../../df/d42/structast__xmpp__client.html#ace9168767fc3707cf5f0a7d049682ba3">name</a>);</div><div class="line"><a name="l02968"></a><span class="lineno"> 2968</span>&#160;   } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!(node = iks_find_attrib(pak-&gt;query, <span class="stringliteral">&quot;node&quot;</span>))) {</div><div class="line"><a name="l02969"></a><span class="lineno"> 2969</span>&#160;      iks_insert_cdata(instructions, <span class="stringliteral">&quot;Welcome to Asterisk - the Open Source PBX.\n&quot;</span>, 0);</div><div class="line"><a name="l02970"></a><span class="lineno"> 2970</span>&#160;      iks_insert_node(query, instructions);</div><div class="line"><a name="l02971"></a><span class="lineno"> 2971</span>&#160;      <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(buddy, -1);</div><div class="line"><a name="l02972"></a><span class="lineno"> 2972</span>&#160;   } <span class="keywordflow">else</span> {</div><div class="line"><a name="l02973"></a><span class="lineno"> 2973</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Received register get to component &#39;%s&#39; using unsupported node &#39;%s&#39; from &#39;%s&#39;\n&quot;</span>,</div><div class="line"><a name="l02974"></a><span class="lineno"> 2974</span>&#160;         client-&gt;<a class="code" href="../../df/d42/structast__xmpp__client.html#ace9168767fc3707cf5f0a7d049682ba3">name</a>, node, pak-&gt;from-&gt;partial);</div><div class="line"><a name="l02975"></a><span class="lineno"> 2975</span>&#160;      <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(buddy, -1);</div><div class="line"><a name="l02976"></a><span class="lineno"> 2976</span>&#160;      <span class="keywordflow">goto</span> <a class="code" href="../../dc/dbf/test__amihooks_8c.html#a5992b274cfdcacdbc1fa8347fd01ebde">done</a>;</div><div class="line"><a name="l02977"></a><span class="lineno"> 2977</span>&#160;   }</div><div class="line"><a name="l02978"></a><span class="lineno"> 2978</span>&#160;</div><div class="line"><a name="l02979"></a><span class="lineno"> 2979</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../dc/d6b/res__xmpp_8c.html#a01f156e90984166f2bbcbcc5a4a6e582">ast_xmpp_client_send</a>(client, iq)) {</div><div class="line"><a name="l02980"></a><span class="lineno"> 2980</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Could not send response to &#39;%s&#39; for received register get on component &#39;%s&#39;\n&quot;</span>,</div><div class="line"><a name="l02981"></a><span class="lineno"> 2981</span>&#160;         pak-&gt;from-&gt;partial, client-&gt;<a class="code" href="../../df/d42/structast__xmpp__client.html#ace9168767fc3707cf5f0a7d049682ba3">name</a>);</div><div class="line"><a name="l02982"></a><span class="lineno"> 2982</span>&#160;   }</div><div class="line"><a name="l02983"></a><span class="lineno"> 2983</span>&#160;</div><div class="line"><a name="l02984"></a><span class="lineno"> 2984</span>&#160;<a class="code" href="../../dc/dbf/test__amihooks_8c.html#a5992b274cfdcacdbc1fa8347fd01ebde">done</a>:</div><div class="line"><a name="l02985"></a><span class="lineno"> 2985</span>&#160;   iks_delete(instructions);</div><div class="line"><a name="l02986"></a><span class="lineno"> 2986</span>&#160;   iks_delete(notacceptable);</div><div class="line"><a name="l02987"></a><span class="lineno"> 2987</span>&#160;   iks_delete(error);</div><div class="line"><a name="l02988"></a><span class="lineno"> 2988</span>&#160;   iks_delete(query);</div><div class="line"><a name="l02989"></a><span class="lineno"> 2989</span>&#160;   iks_delete(iq);</div><div class="line"><a name="l02990"></a><span class="lineno"> 2990</span>&#160;</div><div class="line"><a name="l02991"></a><span class="lineno"> 2991</span>&#160;   <span class="keywordflow">return</span> IKS_FILTER_EAT;</div><div class="line"><a name="l02992"></a><span class="lineno"> 2992</span>&#160;}</div><div class="line"><a name="l02993"></a><span class="lineno"> 2993</span>&#160;<span class="comment"></span></div><div class="line"><a name="l02994"></a><span class="lineno"> 2994</span>&#160;<span class="comment">/*! \brief Hook function called when someone registers to the component */</span></div><div class="line"><a name="l02995"></a><span class="lineno"><a class="line" href="../../dc/d6b/res__xmpp_8c.html#adb47890696cd006752bdf380ae878269"> 2995</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../dc/d6b/res__xmpp_8c.html#adb47890696cd006752bdf380ae878269">xmpp_component_register_set_hook</a>(<span class="keywordtype">void</span> *data, ikspak *pak)</div><div class="line"><a name="l02996"></a><span class="lineno"> 2996</span>&#160;{</div><div class="line"><a name="l02997"></a><span class="lineno"> 2997</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../df/d42/structast__xmpp__client.html">ast_xmpp_client</a> *client = data;</div><div class="line"><a name="l02998"></a><span class="lineno"> 2998</span>&#160;   iks *iq, *presence = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, *x = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l02999"></a><span class="lineno"> 2999</span>&#160;</div><div class="line"><a name="l03000"></a><span class="lineno"> 3000</span>&#160;   <span class="keywordflow">if</span> (!(iq = iks_new(<span class="stringliteral">&quot;iq&quot;</span>)) || !(presence = iks_new(<span class="stringliteral">&quot;presence&quot;</span>)) || !(x = iks_new(<span class="stringliteral">&quot;x&quot;</span>))) {</div><div class="line"><a name="l03001"></a><span class="lineno"> 3001</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Failed to allocate stanzas for register set response to &#39;%s&#39; on component &#39;%s&#39;\n&quot;</span>,</div><div class="line"><a name="l03002"></a><span class="lineno"> 3002</span>&#160;         pak-&gt;from-&gt;partial, client-&gt;<a class="code" href="../../df/d42/structast__xmpp__client.html#ace9168767fc3707cf5f0a7d049682ba3">name</a>);</div><div class="line"><a name="l03003"></a><span class="lineno"> 3003</span>&#160;      <span class="keywordflow">goto</span> <a class="code" href="../../dc/dbf/test__amihooks_8c.html#a5992b274cfdcacdbc1fa8347fd01ebde">done</a>;</div><div class="line"><a name="l03004"></a><span class="lineno"> 3004</span>&#160;   }</div><div class="line"><a name="l03005"></a><span class="lineno"> 3005</span>&#160;</div><div class="line"><a name="l03006"></a><span class="lineno"> 3006</span>&#160;   iks_insert_attrib(iq, <span class="stringliteral">&quot;from&quot;</span>, client-&gt;<a class="code" href="../../df/d42/structast__xmpp__client.html#af738439b96e613a471505eb1222ac406">jid</a>-&gt;full);</div><div class="line"><a name="l03007"></a><span class="lineno"> 3007</span>&#160;   iks_insert_attrib(iq, <span class="stringliteral">&quot;to&quot;</span>, pak-&gt;from-&gt;full);</div><div class="line"><a name="l03008"></a><span class="lineno"> 3008</span>&#160;   iks_insert_attrib(iq, <span class="stringliteral">&quot;id&quot;</span>, pak-&gt;id);</div><div class="line"><a name="l03009"></a><span class="lineno"> 3009</span>&#160;   iks_insert_attrib(iq, <span class="stringliteral">&quot;type&quot;</span>, <span class="stringliteral">&quot;result&quot;</span>);</div><div class="line"><a name="l03010"></a><span class="lineno"> 3010</span>&#160;</div><div class="line"><a name="l03011"></a><span class="lineno"> 3011</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../dc/d6b/res__xmpp_8c.html#a01f156e90984166f2bbcbcc5a4a6e582">ast_xmpp_client_send</a>(client, iq)) {</div><div class="line"><a name="l03012"></a><span class="lineno"> 3012</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Could not send response to &#39;%s&#39; for received register set on component &#39;%s&#39;\n&quot;</span>,</div><div class="line"><a name="l03013"></a><span class="lineno"> 3013</span>&#160;         pak-&gt;from-&gt;partial, client-&gt;<a class="code" href="../../df/d42/structast__xmpp__client.html#ace9168767fc3707cf5f0a7d049682ba3">name</a>);</div><div class="line"><a name="l03014"></a><span class="lineno"> 3014</span>&#160;      <span class="keywordflow">goto</span> <a class="code" href="../../dc/dbf/test__amihooks_8c.html#a5992b274cfdcacdbc1fa8347fd01ebde">done</a>;</div><div class="line"><a name="l03015"></a><span class="lineno"> 3015</span>&#160;   }</div><div class="line"><a name="l03016"></a><span class="lineno"> 3016</span>&#160;</div><div class="line"><a name="l03017"></a><span class="lineno"> 3017</span>&#160;   iks_insert_attrib(presence, <span class="stringliteral">&quot;from&quot;</span>, client-&gt;<a class="code" href="../../df/d42/structast__xmpp__client.html#af738439b96e613a471505eb1222ac406">jid</a>-&gt;full);</div><div class="line"><a name="l03018"></a><span class="lineno"> 3018</span>&#160;   iks_insert_attrib(presence, <span class="stringliteral">&quot;to&quot;</span>, pak-&gt;from-&gt;partial);</div><div class="line"><a name="l03019"></a><span class="lineno"> 3019</span>&#160;   <a class="code" href="../../dc/d6b/res__xmpp_8c.html#a8ca3a53044fbd45f15aabf626faac619">ast_xmpp_client_lock</a>(client);</div><div class="line"><a name="l03020"></a><span class="lineno"> 3020</span>&#160;   iks_insert_attrib(presence, <span class="stringliteral">&quot;id&quot;</span>, client-&gt;<a class="code" href="../../df/d42/structast__xmpp__client.html#abee5661fa88af477fe47bbbd21136301">mid</a>);</div><div class="line"><a name="l03021"></a><span class="lineno"> 3021</span>&#160;   <a class="code" href="../../dc/d6b/res__xmpp_8c.html#a5eb8d77affaba7e2fe254f7e7fbca789">ast_xmpp_increment_mid</a>(client-&gt;<a class="code" href="../../df/d42/structast__xmpp__client.html#abee5661fa88af477fe47bbbd21136301">mid</a>);</div><div class="line"><a name="l03022"></a><span class="lineno"> 3022</span>&#160;   <a class="code" href="../../dc/d6b/res__xmpp_8c.html#a28e4ab2757e6f989d4300ecbbe5acf36">ast_xmpp_client_unlock</a>(client);</div><div class="line"><a name="l03023"></a><span class="lineno"> 3023</span>&#160;   iks_insert_attrib(presence, <span class="stringliteral">&quot;type&quot;</span>, <span class="stringliteral">&quot;subscribe&quot;</span>);</div><div class="line"><a name="l03024"></a><span class="lineno"> 3024</span>&#160;   iks_insert_attrib(x, <span class="stringliteral">&quot;xmlns&quot;</span>, <span class="stringliteral">&quot;vcard-temp:x:update&quot;</span>);</div><div class="line"><a name="l03025"></a><span class="lineno"> 3025</span>&#160;</div><div class="line"><a name="l03026"></a><span class="lineno"> 3026</span>&#160;   iks_insert_node(presence, x);</div><div class="line"><a name="l03027"></a><span class="lineno"> 3027</span>&#160;</div><div class="line"><a name="l03028"></a><span class="lineno"> 3028</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../dc/d6b/res__xmpp_8c.html#a01f156e90984166f2bbcbcc5a4a6e582">ast_xmpp_client_send</a>(client, presence)) {</div><div class="line"><a name="l03029"></a><span class="lineno"> 3029</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Could not send subscription to &#39;%s&#39; on component &#39;%s&#39;\n&quot;</span>,</div><div class="line"><a name="l03030"></a><span class="lineno"> 3030</span>&#160;         pak-&gt;from-&gt;partial, client-&gt;<a class="code" href="../../df/d42/structast__xmpp__client.html#ace9168767fc3707cf5f0a7d049682ba3">name</a>);</div><div class="line"><a name="l03031"></a><span class="lineno"> 3031</span>&#160;   }</div><div class="line"><a name="l03032"></a><span class="lineno"> 3032</span>&#160;</div><div class="line"><a name="l03033"></a><span class="lineno"> 3033</span>&#160;<a class="code" href="../../dc/dbf/test__amihooks_8c.html#a5992b274cfdcacdbc1fa8347fd01ebde">done</a>:</div><div class="line"><a name="l03034"></a><span class="lineno"> 3034</span>&#160;   iks_delete(x);</div><div class="line"><a name="l03035"></a><span class="lineno"> 3035</span>&#160;   iks_delete(presence);</div><div class="line"><a name="l03036"></a><span class="lineno"> 3036</span>&#160;   iks_delete(iq);</div><div class="line"><a name="l03037"></a><span class="lineno"> 3037</span>&#160;</div><div class="line"><a name="l03038"></a><span class="lineno"> 3038</span>&#160;   <span class="keywordflow">return</span> IKS_FILTER_EAT;</div><div class="line"><a name="l03039"></a><span class="lineno"> 3039</span>&#160;}</div><div class="line"><a name="l03040"></a><span class="lineno"> 3040</span>&#160;<span class="comment"></span></div><div class="line"><a name="l03041"></a><span class="lineno"> 3041</span>&#160;<span class="comment">/*! \brief Hook function called when we receive a service discovery items request */</span></div><div class="line"><a name="l03042"></a><span class="lineno"><a class="line" href="../../dc/d6b/res__xmpp_8c.html#aa55d9b5fc5485de22c2ac343c921477c"> 3042</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../dc/d6b/res__xmpp_8c.html#aa55d9b5fc5485de22c2ac343c921477c">xmpp_component_service_discovery_items_hook</a>(<span class="keywordtype">void</span> *data, ikspak *pak)</div><div class="line"><a name="l03043"></a><span class="lineno"> 3043</span>&#160;{</div><div class="line"><a name="l03044"></a><span class="lineno"> 3044</span>&#160;   <a class="code" href="../../d5/d60/utils_8h.html#a1604b4d72144dd3d9f7da668e90337e9">RAII_VAR</a>(<span class="keyword">struct</span> <a class="code" href="../../de/d1c/structxmpp__config.html">xmpp_config</a> *, cfg, <a class="code" href="../../d5/da5/astobj2_8h.html#a86d8d6c3c8866ed0a60121da055cd225">ao2_global_obj_ref</a>(<a class="code" href="../../d3/d4e/chan__console_8c.html#aa36e3e2c486b920b166c2d17c5242221">globals</a>), <a class="code" href="../../d5/da5/astobj2_8h.html#a6321ee982370c55ab3c24c72c562cbdd">ao2_cleanup</a>);</div><div class="line"><a name="l03045"></a><span class="lineno"> 3045</span>&#160;   <a class="code" href="../../d5/d60/utils_8h.html#a1604b4d72144dd3d9f7da668e90337e9">RAII_VAR</a>(<span class="keyword">struct</span> <a class="code" href="../../da/d00/structast__xmpp__client__config.html">ast_xmpp_client_config</a> *, clientcfg, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../d5/da5/astobj2_8h.html#a6321ee982370c55ab3c24c72c562cbdd">ao2_cleanup</a>);</div><div class="line"><a name="l03046"></a><span class="lineno"> 3046</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../df/d42/structast__xmpp__client.html">ast_xmpp_client</a> *client = data;</div><div class="line"><a name="l03047"></a><span class="lineno"> 3047</span>&#160;   iks *iq = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, *query = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, *<a class="code" href="../../d8/d4f/test__config_8c.html#aecdc7cbd5dfa76493c0212caa55d706c">item</a> = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, *feature = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l03048"></a><span class="lineno"> 3048</span>&#160;   <span class="keywordtype">char</span> *node;</div><div class="line"><a name="l03049"></a><span class="lineno"> 3049</span>&#160;</div><div class="line"><a name="l03050"></a><span class="lineno"> 3050</span>&#160;   <span class="keywordflow">if</span> (!cfg || !cfg-&gt;clients || !(clientcfg = <a class="code" href="../../dc/d6b/res__xmpp_8c.html#a14d10033fb3b97f06238940259f45266">xmpp_config_find</a>(cfg-&gt;clients, client-&gt;<a class="code" href="../../df/d42/structast__xmpp__client.html#ace9168767fc3707cf5f0a7d049682ba3">name</a>)) ||</div><div class="line"><a name="l03051"></a><span class="lineno"> 3051</span>&#160;       !(iq = iks_new(<span class="stringliteral">&quot;iq&quot;</span>)) || !(query = iks_new(<span class="stringliteral">&quot;query&quot;</span>)) || !(item = iks_new(<span class="stringliteral">&quot;item&quot;</span>)) || !(feature = iks_new(<span class="stringliteral">&quot;feature&quot;</span>))) {</div><div class="line"><a name="l03052"></a><span class="lineno"> 3052</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Failed to allocate stanzas for service discovery items response to &#39;%s&#39; on component &#39;%s&#39;\n&quot;</span>,</div><div class="line"><a name="l03053"></a><span class="lineno"> 3053</span>&#160;         pak-&gt;from-&gt;partial, client-&gt;<a class="code" href="../../df/d42/structast__xmpp__client.html#ace9168767fc3707cf5f0a7d049682ba3">name</a>);</div><div class="line"><a name="l03054"></a><span class="lineno"> 3054</span>&#160;      <span class="keywordflow">goto</span> <a class="code" href="../../dc/dbf/test__amihooks_8c.html#a5992b274cfdcacdbc1fa8347fd01ebde">done</a>;</div><div class="line"><a name="l03055"></a><span class="lineno"> 3055</span>&#160;   }</div><div class="line"><a name="l03056"></a><span class="lineno"> 3056</span>&#160;</div><div class="line"><a name="l03057"></a><span class="lineno"> 3057</span>&#160;   iks_insert_attrib(iq, <span class="stringliteral">&quot;from&quot;</span>, clientcfg-&gt;user);</div><div class="line"><a name="l03058"></a><span class="lineno"> 3058</span>&#160;   iks_insert_attrib(iq, <span class="stringliteral">&quot;to&quot;</span>, pak-&gt;from-&gt;full);</div><div class="line"><a name="l03059"></a><span class="lineno"> 3059</span>&#160;   iks_insert_attrib(iq, <span class="stringliteral">&quot;id&quot;</span>, pak-&gt;id);</div><div class="line"><a name="l03060"></a><span class="lineno"> 3060</span>&#160;   iks_insert_attrib(iq, <span class="stringliteral">&quot;type&quot;</span>, <span class="stringliteral">&quot;result&quot;</span>);</div><div class="line"><a name="l03061"></a><span class="lineno"> 3061</span>&#160;   iks_insert_attrib(query, <span class="stringliteral">&quot;xmlns&quot;</span>, <span class="stringliteral">&quot;http://jabber.org/protocol/disco#items&quot;</span>);</div><div class="line"><a name="l03062"></a><span class="lineno"> 3062</span>&#160;   iks_insert_node(iq, query);</div><div class="line"><a name="l03063"></a><span class="lineno"> 3063</span>&#160;</div><div class="line"><a name="l03064"></a><span class="lineno"> 3064</span>&#160;   <span class="keywordflow">if</span> (!(node = iks_find_attrib(pak-&gt;query, <span class="stringliteral">&quot;node&quot;</span>))) {</div><div class="line"><a name="l03065"></a><span class="lineno"> 3065</span>&#160;      iks_insert_attrib(item, <span class="stringliteral">&quot;node&quot;</span>, <span class="stringliteral">&quot;http://jabber.org/protocol/commands&quot;</span>);</div><div class="line"><a name="l03066"></a><span class="lineno"> 3066</span>&#160;      iks_insert_attrib(item, <span class="stringliteral">&quot;name&quot;</span>, <span class="stringliteral">&quot;Asterisk Commands&quot;</span>);</div><div class="line"><a name="l03067"></a><span class="lineno"> 3067</span>&#160;      iks_insert_attrib(item, <span class="stringliteral">&quot;jid&quot;</span>, clientcfg-&gt;user);</div><div class="line"><a name="l03068"></a><span class="lineno"> 3068</span>&#160;</div><div class="line"><a name="l03069"></a><span class="lineno"> 3069</span>&#160;      iks_insert_node(query, item);</div><div class="line"><a name="l03070"></a><span class="lineno"> 3070</span>&#160;   } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(node, <span class="stringliteral">&quot;http://jabber.org/protocol/commands&quot;</span>)) {</div><div class="line"><a name="l03071"></a><span class="lineno"> 3071</span>&#160;      iks_insert_attrib(query, <span class="stringliteral">&quot;node&quot;</span>, <span class="stringliteral">&quot;http://jabber.org/protocol/commands&quot;</span>);</div><div class="line"><a name="l03072"></a><span class="lineno"> 3072</span>&#160;   } <span class="keywordflow">else</span> {</div><div class="line"><a name="l03073"></a><span class="lineno"> 3073</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Received service discovery items request to component &#39;%s&#39; using unsupported node &#39;%s&#39; from &#39;%s&#39;\n&quot;</span>,</div><div class="line"><a name="l03074"></a><span class="lineno"> 3074</span>&#160;         client-&gt;<a class="code" href="../../df/d42/structast__xmpp__client.html#ace9168767fc3707cf5f0a7d049682ba3">name</a>, node, pak-&gt;from-&gt;partial);</div><div class="line"><a name="l03075"></a><span class="lineno"> 3075</span>&#160;      <span class="keywordflow">goto</span> <a class="code" href="../../dc/dbf/test__amihooks_8c.html#a5992b274cfdcacdbc1fa8347fd01ebde">done</a>;</div><div class="line"><a name="l03076"></a><span class="lineno"> 3076</span>&#160;   }</div><div class="line"><a name="l03077"></a><span class="lineno"> 3077</span>&#160;</div><div class="line"><a name="l03078"></a><span class="lineno"> 3078</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../dc/d6b/res__xmpp_8c.html#a01f156e90984166f2bbcbcc5a4a6e582">ast_xmpp_client_send</a>(client, iq)) {</div><div class="line"><a name="l03079"></a><span class="lineno"> 3079</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Could not send response to service discovery items request from &#39;%s&#39; on component &#39;%s&#39;\n&quot;</span>,</div><div class="line"><a name="l03080"></a><span class="lineno"> 3080</span>&#160;         pak-&gt;from-&gt;partial, client-&gt;<a class="code" href="../../df/d42/structast__xmpp__client.html#ace9168767fc3707cf5f0a7d049682ba3">name</a>);</div><div class="line"><a name="l03081"></a><span class="lineno"> 3081</span>&#160;   }</div><div class="line"><a name="l03082"></a><span class="lineno"> 3082</span>&#160;</div><div class="line"><a name="l03083"></a><span class="lineno"> 3083</span>&#160;<a class="code" href="../../dc/dbf/test__amihooks_8c.html#a5992b274cfdcacdbc1fa8347fd01ebde">done</a>:</div><div class="line"><a name="l03084"></a><span class="lineno"> 3084</span>&#160;   iks_delete(feature);</div><div class="line"><a name="l03085"></a><span class="lineno"> 3085</span>&#160;   iks_delete(item);</div><div class="line"><a name="l03086"></a><span class="lineno"> 3086</span>&#160;   iks_delete(query);</div><div class="line"><a name="l03087"></a><span class="lineno"> 3087</span>&#160;   iks_delete(iq);</div><div class="line"><a name="l03088"></a><span class="lineno"> 3088</span>&#160;</div><div class="line"><a name="l03089"></a><span class="lineno"> 3089</span>&#160;   <span class="keywordflow">return</span> IKS_FILTER_EAT;</div><div class="line"><a name="l03090"></a><span class="lineno"> 3090</span>&#160;}</div><div class="line"><a name="l03091"></a><span class="lineno"> 3091</span>&#160;<span class="comment"></span></div><div class="line"><a name="l03092"></a><span class="lineno"> 3092</span>&#160;<span class="comment">/*! \brief Internal function called when we authenticated as a component */</span></div><div class="line"><a name="l03093"></a><span class="lineno"><a class="line" href="../../dc/d6b/res__xmpp_8c.html#a673106a2f8e9dfe9770923e9457d1483"> 3093</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../dc/d6b/res__xmpp_8c.html#a673106a2f8e9dfe9770923e9457d1483">xmpp_component_authenticating</a>(<span class="keyword">struct</span> <a class="code" href="../../df/d42/structast__xmpp__client.html">ast_xmpp_client</a> *client, <span class="keyword">struct</span> <a class="code" href="../../da/d00/structast__xmpp__client__config.html">ast_xmpp_client_config</a> *cfg, <span class="keywordtype">int</span> <a class="code" href="../../d7/d49/chan__ooh323_8c.html#a4d63fdfe5451ec2248c16a2739190c56">type</a>, iks *node)</div><div class="line"><a name="l03094"></a><span class="lineno"> 3094</span>&#160;{</div><div class="line"><a name="l03095"></a><span class="lineno"> 3095</span>&#160;   <span class="keywordflow">if</span> (!strcmp(iks_name(node), <span class="stringliteral">&quot;stream:features&quot;</span>)) {</div><div class="line"><a name="l03096"></a><span class="lineno"> 3096</span>&#160;      <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l03097"></a><span class="lineno"> 3097</span>&#160;   }</div><div class="line"><a name="l03098"></a><span class="lineno"> 3098</span>&#160;</div><div class="line"><a name="l03099"></a><span class="lineno"> 3099</span>&#160;   <span class="keywordflow">if</span> (strcmp(iks_name(node), <span class="stringliteral">&quot;handshake&quot;</span>)) {</div><div class="line"><a name="l03100"></a><span class="lineno"> 3100</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Failed to authenticate component &#39;%s&#39;\n&quot;</span>, client-&gt;<a class="code" href="../../df/d42/structast__xmpp__client.html#ace9168767fc3707cf5f0a7d049682ba3">name</a>);</div><div class="line"><a name="l03101"></a><span class="lineno"> 3101</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l03102"></a><span class="lineno"> 3102</span>&#160;   }</div><div class="line"><a name="l03103"></a><span class="lineno"> 3103</span>&#160;</div><div class="line"><a name="l03104"></a><span class="lineno"> 3104</span>&#160;   iks_filter_add_rule(client-&gt;<a class="code" href="../../df/d42/structast__xmpp__client.html#a242fce88f9c9954695b13f7af1d415a9">filter</a>, <a class="code" href="../../dc/d6b/res__xmpp_8c.html#aa55d9b5fc5485de22c2ac343c921477c">xmpp_component_service_discovery_items_hook</a>, client, IKS_RULE_NS, <span class="stringliteral">&quot;http://jabber.org/protocol/disco#items&quot;</span>, IKS_RULE_DONE);</div><div class="line"><a name="l03105"></a><span class="lineno"> 3105</span>&#160;</div><div class="line"><a name="l03106"></a><span class="lineno"> 3106</span>&#160;   iks_filter_add_rule(client-&gt;<a class="code" href="../../df/d42/structast__xmpp__client.html#a242fce88f9c9954695b13f7af1d415a9">filter</a>, <a class="code" href="../../dc/d6b/res__xmpp_8c.html#ab9ffec0b6972e567ecd01d93fcc19ec4">xmpp_component_service_discovery_get_hook</a>, client, IKS_RULE_SUBTYPE, IKS_TYPE_GET, IKS_RULE_NS, <span class="stringliteral">&quot;http://jabber.org/protocol/disco#info&quot;</span>, IKS_RULE_DONE);</div><div class="line"><a name="l03107"></a><span class="lineno"> 3107</span>&#160;</div><div class="line"><a name="l03108"></a><span class="lineno"> 3108</span>&#160;   <span class="comment">/* This uses the client service discovery result hook on purpose, as the code is common between both */</span></div><div class="line"><a name="l03109"></a><span class="lineno"> 3109</span>&#160;   iks_filter_add_rule(client-&gt;<a class="code" href="../../df/d42/structast__xmpp__client.html#a242fce88f9c9954695b13f7af1d415a9">filter</a>, <a class="code" href="../../dc/d6b/res__xmpp_8c.html#aa3da78973dc8e135e540b1303de9bd25">xmpp_client_service_discovery_result_hook</a>, client, IKS_RULE_SUBTYPE, IKS_TYPE_RESULT, IKS_RULE_NS, <span class="stringliteral">&quot;http://jabber.org/protocol/disco#info&quot;</span>, IKS_RULE_DONE);</div><div class="line"><a name="l03110"></a><span class="lineno"> 3110</span>&#160;</div><div class="line"><a name="l03111"></a><span class="lineno"> 3111</span>&#160;   iks_filter_add_rule(client-&gt;<a class="code" href="../../df/d42/structast__xmpp__client.html#a242fce88f9c9954695b13f7af1d415a9">filter</a>, <a class="code" href="../../dc/d6b/res__xmpp_8c.html#a8a477b45a75d10929fc46e6e53308f27">xmpp_component_register_get_hook</a>, client, IKS_RULE_SUBTYPE, IKS_TYPE_GET, IKS_RULE_NS, <span class="stringliteral">&quot;jabber:iq:register&quot;</span>, IKS_RULE_DONE);</div><div class="line"><a name="l03112"></a><span class="lineno"> 3112</span>&#160;   iks_filter_add_rule(client-&gt;<a class="code" href="../../df/d42/structast__xmpp__client.html#a242fce88f9c9954695b13f7af1d415a9">filter</a>, <a class="code" href="../../dc/d6b/res__xmpp_8c.html#adb47890696cd006752bdf380ae878269">xmpp_component_register_set_hook</a>, client, IKS_RULE_SUBTYPE, IKS_TYPE_SET, IKS_RULE_NS, <span class="stringliteral">&quot;jabber:iq:register&quot;</span>, IKS_RULE_DONE);</div><div class="line"><a name="l03113"></a><span class="lineno"> 3113</span>&#160;</div><div class="line"><a name="l03114"></a><span class="lineno"> 3114</span>&#160;   <a class="code" href="../../dc/d6b/res__xmpp_8c.html#ac515389ec6c63a8b3bbd094ede0d7c4d">xmpp_client_change_state</a>(client, <a class="code" href="../../da/da0/xmpp_8h.html#ae37d560c438576bdcb47347088225ee6af75b0231e0c9888c9a6c5374abf7527f">XMPP_STATE_CONNECTED</a>);</div><div class="line"><a name="l03115"></a><span class="lineno"> 3115</span>&#160;</div><div class="line"><a name="l03116"></a><span class="lineno"> 3116</span>&#160;   <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l03117"></a><span class="lineno"> 3117</span>&#160;}</div><div class="line"><a name="l03118"></a><span class="lineno"> 3118</span>&#160;<span class="comment"></span></div><div class="line"><a name="l03119"></a><span class="lineno"> 3119</span>&#160;<span class="comment">/*! \brief Internal function called when a message is received */</span></div><div class="line"><a name="l03120"></a><span class="lineno"><a class="line" href="../../dc/d6b/res__xmpp_8c.html#a306d2764c3a511ce4bb062987aee310c"> 3120</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../dc/d6b/res__xmpp_8c.html#a306d2764c3a511ce4bb062987aee310c">xmpp_pak_message</a>(<span class="keyword">struct</span> <a class="code" href="../../df/d42/structast__xmpp__client.html">ast_xmpp_client</a> *client, <span class="keyword">struct</span> <a class="code" href="../../da/d00/structast__xmpp__client__config.html">ast_xmpp_client_config</a> *cfg, iks *node, ikspak *pak)</div><div class="line"><a name="l03121"></a><span class="lineno"> 3121</span>&#160;{</div><div class="line"><a name="l03122"></a><span class="lineno"> 3122</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d6/d73/structast__xmpp__message.html">ast_xmpp_message</a> *<a class="code" href="../../d6/d73/structast__xmpp__message.html#a0b2e8c7f76df48129f994ecc46d5c66c">message</a>;</div><div class="line"><a name="l03123"></a><span class="lineno"> 3123</span>&#160;   <span class="keywordtype">char</span> *body;</div><div class="line"><a name="l03124"></a><span class="lineno"> 3124</span>&#160;   <span class="keywordtype">int</span> deleted = 0;</div><div class="line"><a name="l03125"></a><span class="lineno"> 3125</span>&#160;</div><div class="line"><a name="l03126"></a><span class="lineno"> 3126</span>&#160;   <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(3, <span class="stringliteral">&quot;XMPP client &#39;%s&#39; received a message\n&quot;</span>, client-&gt;<a class="code" href="../../df/d42/structast__xmpp__client.html#ace9168767fc3707cf5f0a7d049682ba3">name</a>);</div><div class="line"><a name="l03127"></a><span class="lineno"> 3127</span>&#160;</div><div class="line"><a name="l03128"></a><span class="lineno"> 3128</span>&#160;   <span class="keywordflow">if</span> (!(body = iks_find_cdata(pak-&gt;x, <span class="stringliteral">&quot;body&quot;</span>))) {</div><div class="line"><a name="l03129"></a><span class="lineno"> 3129</span>&#160;      <span class="comment">/* Message contains no body, ignore it. */</span></div><div class="line"><a name="l03130"></a><span class="lineno"> 3130</span>&#160;      <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l03131"></a><span class="lineno"> 3131</span>&#160;   }</div><div class="line"><a name="l03132"></a><span class="lineno"> 3132</span>&#160;</div><div class="line"><a name="l03133"></a><span class="lineno"> 3133</span>&#160;   <span class="keywordflow">if</span> (!(message = <a class="code" href="../../d8/d8a/astmm_8h.html#ae0cd4c5524b01287ab19cbe233d9cebb">ast_calloc</a>(1, <span class="keyword">sizeof</span>(*message)))) {</div><div class="line"><a name="l03134"></a><span class="lineno"> 3134</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l03135"></a><span class="lineno"> 3135</span>&#160;   }</div><div class="line"><a name="l03136"></a><span class="lineno"> 3136</span>&#160;</div><div class="line"><a name="l03137"></a><span class="lineno"> 3137</span>&#160;   message-&gt;<a class="code" href="../../d6/d73/structast__xmpp__message.html#ace5ad74ee812bf5ee2bec5d759022d0b">arrived</a> = <a class="code" href="../../de/df7/time_8h.html#ad3899efb6f0e348556ef69f5b16aa7f7">ast_tvnow</a>();</div><div class="line"><a name="l03138"></a><span class="lineno"> 3138</span>&#160;</div><div class="line"><a name="l03139"></a><span class="lineno"> 3139</span>&#160;   message-&gt;<a class="code" href="../../d6/d73/structast__xmpp__message.html#a0b2e8c7f76df48129f994ecc46d5c66c">message</a> = <a class="code" href="../../d8/d8a/astmm_8h.html#ab263849d03fb892847be4986db759737">ast_strdup</a>(body);</div><div class="line"><a name="l03140"></a><span class="lineno"> 3140</span>&#160;</div><div class="line"><a name="l03141"></a><span class="lineno"> 3141</span>&#160;   <a class="code" href="../../d6/d90/strings_8h.html#ac4040268f7b6ed77dfc49c7767626369">ast_copy_string</a>(message-&gt;<a class="code" href="../../d6/d73/structast__xmpp__message.html#a51d291314bf1da3f9ac4479963a4fadd">id</a>, <a class="code" href="../../d6/d90/strings_8h.html#a2faaa16929951bfd2802b7829a100ba2">S_OR</a>(pak-&gt;id, <span class="stringliteral">&quot;&quot;</span>), <span class="keyword">sizeof</span>(message-&gt;<a class="code" href="../../d6/d73/structast__xmpp__message.html#a51d291314bf1da3f9ac4479963a4fadd">id</a>));</div><div class="line"><a name="l03142"></a><span class="lineno"> 3142</span>&#160;   message-&gt;<a class="code" href="../../d6/d73/structast__xmpp__message.html#a765533dfc643627999c751f7e1514664">from</a> = !<a class="code" href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a>(pak-&gt;from-&gt;full) ? <a class="code" href="../../d8/d8a/astmm_8h.html#ab263849d03fb892847be4986db759737">ast_strdup</a>(pak-&gt;from-&gt;full) : <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l03143"></a><span class="lineno"> 3143</span>&#160;</div><div class="line"><a name="l03144"></a><span class="lineno"> 3144</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d5/d60/utils_8h.html#a00d4c9254c9827d6fa44f17a326744a5">ast_test_flag</a>(&amp;cfg-&gt;<a class="code" href="../../da/d00/structast__xmpp__client__config.html#aec78000b2897c094f68ed72559e18acd">flags</a>, <a class="code" href="../../dc/d6b/res__xmpp_8c.html#aa3759d2ddcc12f3f5ef5a8a3ffa4a4dfae6af6fd94e006a677047e6caa56c9651">XMPP_SEND_TO_DIALPLAN</a>)) {</div><div class="line"><a name="l03145"></a><span class="lineno"> 3145</span>&#160;      <span class="keyword">struct </span><a class="code" href="../../df/da1/structast__msg.html">ast_msg</a> *msg;</div><div class="line"><a name="l03146"></a><span class="lineno"> 3146</span>&#160;      <span class="keyword">struct </span><a class="code" href="../../d5/d25/structast__xmpp__buddy.html">ast_xmpp_buddy</a> *buddy;</div><div class="line"><a name="l03147"></a><span class="lineno"> 3147</span>&#160;</div><div class="line"><a name="l03148"></a><span class="lineno"> 3148</span>&#160;      <span class="keywordflow">if</span> ((msg = <a class="code" href="../../d2/d0d/message_8h.html#a0e4685c7cf1d71204087b992110e6357">ast_msg_alloc</a>())) {</div><div class="line"><a name="l03149"></a><span class="lineno"> 3149</span>&#160;         <span class="keywordtype">int</span> res;</div><div class="line"><a name="l03150"></a><span class="lineno"> 3150</span>&#160;</div><div class="line"><a name="l03151"></a><span class="lineno"> 3151</span>&#160;         <a class="code" href="../../dc/d6b/res__xmpp_8c.html#a8ca3a53044fbd45f15aabf626faac619">ast_xmpp_client_lock</a>(client);</div><div class="line"><a name="l03152"></a><span class="lineno"> 3152</span>&#160;</div><div class="line"><a name="l03153"></a><span class="lineno"> 3153</span>&#160;         buddy = <a class="code" href="../../d5/da5/astobj2_8h.html#a911e0703891a9a7aaf73978152092586">ao2_find</a>(client-&gt;<a class="code" href="../../df/d42/structast__xmpp__client.html#a5082987d3e1eac5f625574800bb72c2c">buddies</a>, pak-&gt;from-&gt;partial, <a class="code" href="../../d5/da5/astobj2_8h.html#a22f40c733a085f259af94e864ebaa09a">OBJ_KEY</a> | <a class="code" href="../../d5/da5/astobj2_8h.html#ad9d009e87e737af900825b36db55a35ca52efdf13b66ae502e2e20a5f49f068de">OBJ_NOLOCK</a>);</div><div class="line"><a name="l03154"></a><span class="lineno"> 3154</span>&#160;</div><div class="line"><a name="l03155"></a><span class="lineno"> 3155</span>&#160;         res = <a class="code" href="../../d2/d0d/message_8h.html#acf4073638cf23022399e3666c804e178">ast_msg_set_to</a>(msg, <span class="stringliteral">&quot;xmpp:%s&quot;</span>, cfg-&gt;<a class="code" href="../../da/d00/structast__xmpp__client__config.html#a661785436d89cdd720f15478d92c984b">user</a>);</div><div class="line"><a name="l03156"></a><span class="lineno"> 3156</span>&#160;         res |= <a class="code" href="../../d2/d0d/message_8h.html#a02a688837f4e91ea078c0b1b48017ef8">ast_msg_set_from</a>(msg, <span class="stringliteral">&quot;xmpp:%s&quot;</span>, message-&gt;<a class="code" href="../../d6/d73/structast__xmpp__message.html#a765533dfc643627999c751f7e1514664">from</a>);</div><div class="line"><a name="l03157"></a><span class="lineno"> 3157</span>&#160;         res |= <a class="code" href="../../d2/d0d/message_8h.html#aa21f081993590c1410b287d717a92282">ast_msg_set_body</a>(msg, <span class="stringliteral">&quot;%s&quot;</span>, message-&gt;<a class="code" href="../../d6/d73/structast__xmpp__message.html#a0b2e8c7f76df48129f994ecc46d5c66c">message</a>);</div><div class="line"><a name="l03158"></a><span class="lineno"> 3158</span>&#160;         res |= <a class="code" href="../../d2/d0d/message_8h.html#a9e2045ad672c0afd5fb2616fec6bc666">ast_msg_set_context</a>(msg, <span class="stringliteral">&quot;%s&quot;</span>, cfg-&gt;<a class="code" href="../../da/d00/structast__xmpp__client__config.html#a7faec841658b88ad0cfbc684853acad3">context</a>);</div><div class="line"><a name="l03159"></a><span class="lineno"> 3159</span>&#160;         res |= <a class="code" href="../../d2/d0d/message_8h.html#a757a64be14a9fc2b47a37f5ce9e742d5">ast_msg_set_tech</a>(msg, <span class="stringliteral">&quot;%s&quot;</span>, <span class="stringliteral">&quot;XMPP&quot;</span>);</div><div class="line"><a name="l03160"></a><span class="lineno"> 3160</span>&#160;         res |= <a class="code" href="../../d2/d0d/message_8h.html#a53573a834e1a26d67c26ba58a9ad8274">ast_msg_set_endpoint</a>(msg, <span class="stringliteral">&quot;%s&quot;</span>, client-&gt;<a class="code" href="../../df/d42/structast__xmpp__client.html#ace9168767fc3707cf5f0a7d049682ba3">name</a>);</div><div class="line"><a name="l03161"></a><span class="lineno"> 3161</span>&#160;</div><div class="line"><a name="l03162"></a><span class="lineno"> 3162</span>&#160;         <span class="keywordflow">if</span> (buddy) {</div><div class="line"><a name="l03163"></a><span class="lineno"> 3163</span>&#160;            res |= <a class="code" href="../../d2/d0d/message_8h.html#a926dc659d6f9d88782e9d0e463ba8c47">ast_msg_set_var</a>(msg, <span class="stringliteral">&quot;XMPP_BUDDY&quot;</span>, buddy-&gt;<a class="code" href="../../d5/d25/structast__xmpp__buddy.html#aaf2ca63234b10470cfbba573d4c0ed01">id</a>);</div><div class="line"><a name="l03164"></a><span class="lineno"> 3164</span>&#160;         }</div><div class="line"><a name="l03165"></a><span class="lineno"> 3165</span>&#160;</div><div class="line"><a name="l03166"></a><span class="lineno"> 3166</span>&#160;         <a class="code" href="../../d5/da5/astobj2_8h.html#a6321ee982370c55ab3c24c72c562cbdd">ao2_cleanup</a>(buddy);</div><div class="line"><a name="l03167"></a><span class="lineno"> 3167</span>&#160;</div><div class="line"><a name="l03168"></a><span class="lineno"> 3168</span>&#160;         <a class="code" href="../../dc/d6b/res__xmpp_8c.html#a28e4ab2757e6f989d4300ecbbe5acf36">ast_xmpp_client_unlock</a>(client);</div><div class="line"><a name="l03169"></a><span class="lineno"> 3169</span>&#160;</div><div class="line"><a name="l03170"></a><span class="lineno"> 3170</span>&#160;         <span class="keywordflow">if</span> (res) {</div><div class="line"><a name="l03171"></a><span class="lineno"> 3171</span>&#160;            <a class="code" href="../../d2/d0d/message_8h.html#a13b928949f293c3b6b9ba3ebe8d64075">ast_msg_destroy</a>(msg);</div><div class="line"><a name="l03172"></a><span class="lineno"> 3172</span>&#160;         } <span class="keywordflow">else</span> {</div><div class="line"><a name="l03173"></a><span class="lineno"> 3173</span>&#160;            <a class="code" href="../../d2/d0d/message_8h.html#adcb3fd70677c50be8626deec545a42c1">ast_msg_queue</a>(msg);</div><div class="line"><a name="l03174"></a><span class="lineno"> 3174</span>&#160;         }</div><div class="line"><a name="l03175"></a><span class="lineno"> 3175</span>&#160;      }</div><div class="line"><a name="l03176"></a><span class="lineno"> 3176</span>&#160;   }</div><div class="line"><a name="l03177"></a><span class="lineno"> 3177</span>&#160;</div><div class="line"><a name="l03178"></a><span class="lineno"> 3178</span>&#160;   <span class="comment">/* remove old messages received from this JID</span></div><div class="line"><a name="l03179"></a><span class="lineno"> 3179</span>&#160;<span class="comment">    * and insert received message */</span></div><div class="line"><a name="l03180"></a><span class="lineno"> 3180</span>&#160;   deleted = <a class="code" href="../../dc/d6b/res__xmpp_8c.html#a085fd2ff3dd46be750522ced5c73e060">delete_old_messages</a>(client, pak-&gt;from-&gt;partial);</div><div class="line"><a name="l03181"></a><span class="lineno"> 3181</span>&#160;   <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(3, <span class="stringliteral">&quot;Deleted %d messages for client %s from JID %s\n&quot;</span>, deleted, client-&gt;<a class="code" href="../../df/d42/structast__xmpp__client.html#ace9168767fc3707cf5f0a7d049682ba3">name</a>, pak-&gt;from-&gt;partial);</div><div class="line"><a name="l03182"></a><span class="lineno"> 3182</span>&#160;   <a class="code" href="../../df/d90/linkedlists_8h.html#a9140a4e4d781264fa9469c52b1adae40">AST_LIST_LOCK</a>(&amp;client-&gt;<a class="code" href="../../df/d42/structast__xmpp__client.html#a17d0e5a7ebe404ac9471b8e403708c66">messages</a>);</div><div class="line"><a name="l03183"></a><span class="lineno"> 3183</span>&#160;   <a class="code" href="../../df/d90/linkedlists_8h.html#aa2ded2af046bb513f77056c27c083307">AST_LIST_INSERT_HEAD</a>(&amp;client-&gt;<a class="code" href="../../df/d42/structast__xmpp__client.html#a17d0e5a7ebe404ac9471b8e403708c66">messages</a>, message, list);</div><div class="line"><a name="l03184"></a><span class="lineno"> 3184</span>&#160;   <a class="code" href="../../df/d90/linkedlists_8h.html#ab48cb9e1e612dd486b747ba1c5d68d01">AST_LIST_UNLOCK</a>(&amp;client-&gt;<a class="code" href="../../df/d42/structast__xmpp__client.html#a17d0e5a7ebe404ac9471b8e403708c66">messages</a>);</div><div class="line"><a name="l03185"></a><span class="lineno"> 3185</span>&#160;</div><div class="line"><a name="l03186"></a><span class="lineno"> 3186</span>&#160;   <span class="comment">/* wake up threads waiting for messages */</span></div><div class="line"><a name="l03187"></a><span class="lineno"> 3187</span>&#160;   <a class="code" href="../../dd/d42/lock_8h.html#ac5e13c7fe64d3b271a52028b0a78b92b">ast_mutex_lock</a>(&amp;messagelock);</div><div class="line"><a name="l03188"></a><span class="lineno"> 3188</span>&#160;   <a class="code" href="../../dd/d42/lock_8h.html#aa92ba91898426126bda5aa94a8975ba1">ast_cond_broadcast</a>(&amp;message_received_condition);</div><div class="line"><a name="l03189"></a><span class="lineno"> 3189</span>&#160;   <a class="code" href="../../dd/d42/lock_8h.html#a873f9ce8c6287a32d48c83133e124418">ast_mutex_unlock</a>(&amp;messagelock);</div><div class="line"><a name="l03190"></a><span class="lineno"> 3190</span>&#160;</div><div class="line"><a name="l03191"></a><span class="lineno"> 3191</span>&#160;   <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l03192"></a><span class="lineno"> 3192</span>&#160;}</div><div class="line"><a name="l03193"></a><span class="lineno"> 3193</span>&#160;<span class="comment"></span></div><div class="line"><a name="l03194"></a><span class="lineno"> 3194</span>&#160;<span class="comment">/*! \brief Helper function which sends a discovery information request to a user */</span></div><div class="line"><a name="l03195"></a><span class="lineno"><a class="line" href="../../dc/d6b/res__xmpp_8c.html#af7e745a942bd8d6f5ba56ca9cfe5b67e"> 3195</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../dc/d6b/res__xmpp_8c.html#af7e745a942bd8d6f5ba56ca9cfe5b67e">xmpp_client_send_disco_info_request</a>(<span class="keyword">struct</span> <a class="code" href="../../df/d42/structast__xmpp__client.html">ast_xmpp_client</a> *client, <span class="keyword">const</span> <span class="keywordtype">char</span> *to, <span class="keyword">const</span> <span class="keywordtype">char</span> *from)</div><div class="line"><a name="l03196"></a><span class="lineno"> 3196</span>&#160;{</div><div class="line"><a name="l03197"></a><span class="lineno"> 3197</span>&#160;   iks *iq, *query;</div><div class="line"><a name="l03198"></a><span class="lineno"> 3198</span>&#160;   <span class="keywordtype">int</span> res;</div><div class="line"><a name="l03199"></a><span class="lineno"> 3199</span>&#160;</div><div class="line"><a name="l03200"></a><span class="lineno"> 3200</span>&#160;   <span class="keywordflow">if</span> (!(iq = iks_new(<span class="stringliteral">&quot;iq&quot;</span>)) || !(query = iks_new(<span class="stringliteral">&quot;query&quot;</span>))) {</div><div class="line"><a name="l03201"></a><span class="lineno"> 3201</span>&#160;      iks_delete(iq);</div><div class="line"><a name="l03202"></a><span class="lineno"> 3202</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l03203"></a><span class="lineno"> 3203</span>&#160;   }</div><div class="line"><a name="l03204"></a><span class="lineno"> 3204</span>&#160;</div><div class="line"><a name="l03205"></a><span class="lineno"> 3205</span>&#160;   iks_insert_attrib(iq, <span class="stringliteral">&quot;type&quot;</span>, <span class="stringliteral">&quot;get&quot;</span>);</div><div class="line"><a name="l03206"></a><span class="lineno"> 3206</span>&#160;   iks_insert_attrib(iq, <span class="stringliteral">&quot;to&quot;</span>, to);</div><div class="line"><a name="l03207"></a><span class="lineno"> 3207</span>&#160;   iks_insert_attrib(iq, <span class="stringliteral">&quot;from&quot;</span>, from);</div><div class="line"><a name="l03208"></a><span class="lineno"> 3208</span>&#160;   <a class="code" href="../../dc/d6b/res__xmpp_8c.html#a8ca3a53044fbd45f15aabf626faac619">ast_xmpp_client_lock</a>(client);</div><div class="line"><a name="l03209"></a><span class="lineno"> 3209</span>&#160;   iks_insert_attrib(iq, <span class="stringliteral">&quot;id&quot;</span>, client-&gt;<a class="code" href="../../df/d42/structast__xmpp__client.html#abee5661fa88af477fe47bbbd21136301">mid</a>);</div><div class="line"><a name="l03210"></a><span class="lineno"> 3210</span>&#160;   <a class="code" href="../../dc/d6b/res__xmpp_8c.html#a5eb8d77affaba7e2fe254f7e7fbca789">ast_xmpp_increment_mid</a>(client-&gt;<a class="code" href="../../df/d42/structast__xmpp__client.html#abee5661fa88af477fe47bbbd21136301">mid</a>);</div><div class="line"><a name="l03211"></a><span class="lineno"> 3211</span>&#160;   <a class="code" href="../../dc/d6b/res__xmpp_8c.html#a28e4ab2757e6f989d4300ecbbe5acf36">ast_xmpp_client_unlock</a>(client);</div><div class="line"><a name="l03212"></a><span class="lineno"> 3212</span>&#160;   iks_insert_attrib(query, <span class="stringliteral">&quot;xmlns&quot;</span>, <span class="stringliteral">&quot;http://jabber.org/protocol/disco#info&quot;</span>);</div><div class="line"><a name="l03213"></a><span class="lineno"> 3213</span>&#160;   iks_insert_node(iq, query);</div><div class="line"><a name="l03214"></a><span class="lineno"> 3214</span>&#160;</div><div class="line"><a name="l03215"></a><span class="lineno"> 3215</span>&#160;   res = <a class="code" href="../../dc/d6b/res__xmpp_8c.html#a01f156e90984166f2bbcbcc5a4a6e582">ast_xmpp_client_send</a>(client, iq);</div><div class="line"><a name="l03216"></a><span class="lineno"> 3216</span>&#160;</div><div class="line"><a name="l03217"></a><span class="lineno"> 3217</span>&#160;   iks_delete(query);</div><div class="line"><a name="l03218"></a><span class="lineno"> 3218</span>&#160;   iks_delete(iq);</div><div class="line"><a name="l03219"></a><span class="lineno"> 3219</span>&#160;</div><div class="line"><a name="l03220"></a><span class="lineno"> 3220</span>&#160;   <span class="keywordflow">return</span> res;</div><div class="line"><a name="l03221"></a><span class="lineno"> 3221</span>&#160;}</div><div class="line"><a name="l03222"></a><span class="lineno"> 3222</span>&#160;<span class="comment"></span></div><div class="line"><a name="l03223"></a><span class="lineno"> 3223</span>&#160;<span class="comment">/*! \brief Callback function which returns when the resource is available */</span></div><div class="line"><a name="l03224"></a><span class="lineno"><a class="line" href="../../dc/d6b/res__xmpp_8c.html#aa5e440109f4377b97485e07c65cc7f17"> 3224</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../dc/d6b/res__xmpp_8c.html#aa5e440109f4377b97485e07c65cc7f17">xmpp_resource_is_available</a>(<span class="keywordtype">void</span> *obj, <span class="keywordtype">void</span> *arg, <span class="keywordtype">int</span> flags)</div><div class="line"><a name="l03225"></a><span class="lineno"> 3225</span>&#160;{</div><div class="line"><a name="l03226"></a><span class="lineno"> 3226</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d6/d90/structast__xmpp__resource.html">ast_xmpp_resource</a> *<a class="code" href="../../d6/d90/structast__xmpp__resource.html#a12856b954fce601a0303b0bcdf83c513">resource</a> = obj;</div><div class="line"><a name="l03227"></a><span class="lineno"> 3227</span>&#160;</div><div class="line"><a name="l03228"></a><span class="lineno"> 3228</span>&#160;   <span class="keywordflow">return</span> (resource-&gt;<a class="code" href="../../d6/d90/structast__xmpp__resource.html#a6e27f49150e9a14580fb313cc2777e00">status</a> == IKS_SHOW_AVAILABLE) ? <a class="code" href="../../d5/da5/astobj2_8h.html#a1f8b41308be4c47de8ff89a3b9c7e7d1a1959468a3c5d6aecd2fa1272d8e30fbf">CMP_MATCH</a> | <a class="code" href="../../d5/da5/astobj2_8h.html#a1f8b41308be4c47de8ff89a3b9c7e7d1a75382dc9117cc118719edf6c3d2b71df">CMP_STOP</a> : 0;</div><div class="line"><a name="l03229"></a><span class="lineno"> 3229</span>&#160;}</div><div class="line"><a name="l03230"></a><span class="lineno"> 3230</span>&#160;<span class="comment"></span></div><div class="line"><a name="l03231"></a><span class="lineno"> 3231</span>&#160;<span class="comment">/*! \brief Helper function which sends a ping request to a server */</span></div><div class="line"><a name="l03232"></a><span class="lineno"><a class="line" href="../../dc/d6b/res__xmpp_8c.html#aa8cee821cbda619ece4c14df1d7ea43c"> 3232</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../dc/d6b/res__xmpp_8c.html#aa8cee821cbda619ece4c14df1d7ea43c">xmpp_ping_request</a>(<span class="keyword">struct</span> <a class="code" href="../../df/d42/structast__xmpp__client.html">ast_xmpp_client</a> *client, <span class="keyword">const</span> <span class="keywordtype">char</span> *to, <span class="keyword">const</span> <span class="keywordtype">char</span> *from)</div><div class="line"><a name="l03233"></a><span class="lineno"> 3233</span>&#160;{</div><div class="line"><a name="l03234"></a><span class="lineno"> 3234</span>&#160;   iks *iq, *ping;</div><div class="line"><a name="l03235"></a><span class="lineno"> 3235</span>&#160;   <span class="keywordtype">int</span> res;</div><div class="line"><a name="l03236"></a><span class="lineno"> 3236</span>&#160;</div><div class="line"><a name="l03237"></a><span class="lineno"> 3237</span>&#160;   <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(2, <span class="stringliteral">&quot;JABBER: Sending Keep-Alive Ping for client &#39;%s&#39;\n&quot;</span>, client-&gt;<a class="code" href="../../df/d42/structast__xmpp__client.html#ace9168767fc3707cf5f0a7d049682ba3">name</a>);</div><div class="line"><a name="l03238"></a><span class="lineno"> 3238</span>&#160;</div><div class="line"><a name="l03239"></a><span class="lineno"> 3239</span>&#160;   <span class="keywordflow">if</span> (!(iq = iks_new(<span class="stringliteral">&quot;iq&quot;</span>)) || !(ping = iks_new(<span class="stringliteral">&quot;ping&quot;</span>))) {</div><div class="line"><a name="l03240"></a><span class="lineno"> 3240</span>&#160;      iks_delete(iq);</div><div class="line"><a name="l03241"></a><span class="lineno"> 3241</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l03242"></a><span class="lineno"> 3242</span>&#160;   }</div><div class="line"><a name="l03243"></a><span class="lineno"> 3243</span>&#160;</div><div class="line"><a name="l03244"></a><span class="lineno"> 3244</span>&#160;   iks_insert_attrib(iq, <span class="stringliteral">&quot;type&quot;</span>, <span class="stringliteral">&quot;get&quot;</span>);</div><div class="line"><a name="l03245"></a><span class="lineno"> 3245</span>&#160;   iks_insert_attrib(iq, <span class="stringliteral">&quot;to&quot;</span>, to);</div><div class="line"><a name="l03246"></a><span class="lineno"> 3246</span>&#160;   iks_insert_attrib(iq, <span class="stringliteral">&quot;from&quot;</span>, from);</div><div class="line"><a name="l03247"></a><span class="lineno"> 3247</span>&#160;</div><div class="line"><a name="l03248"></a><span class="lineno"> 3248</span>&#160;   <a class="code" href="../../dc/d6b/res__xmpp_8c.html#a8ca3a53044fbd45f15aabf626faac619">ast_xmpp_client_lock</a>(client);</div><div class="line"><a name="l03249"></a><span class="lineno"> 3249</span>&#160;   iks_insert_attrib(iq, <span class="stringliteral">&quot;id&quot;</span>, client-&gt;<a class="code" href="../../df/d42/structast__xmpp__client.html#abee5661fa88af477fe47bbbd21136301">mid</a>);</div><div class="line"><a name="l03250"></a><span class="lineno"> 3250</span>&#160;   <a class="code" href="../../dc/d6b/res__xmpp_8c.html#a5eb8d77affaba7e2fe254f7e7fbca789">ast_xmpp_increment_mid</a>(client-&gt;<a class="code" href="../../df/d42/structast__xmpp__client.html#abee5661fa88af477fe47bbbd21136301">mid</a>);</div><div class="line"><a name="l03251"></a><span class="lineno"> 3251</span>&#160;   <a class="code" href="../../dc/d6b/res__xmpp_8c.html#a28e4ab2757e6f989d4300ecbbe5acf36">ast_xmpp_client_unlock</a>(client);</div><div class="line"><a name="l03252"></a><span class="lineno"> 3252</span>&#160;</div><div class="line"><a name="l03253"></a><span class="lineno"> 3253</span>&#160;   iks_insert_attrib(ping, <span class="stringliteral">&quot;xmlns&quot;</span>, <span class="stringliteral">&quot;urn:xmpp:ping&quot;</span>);</div><div class="line"><a name="l03254"></a><span class="lineno"> 3254</span>&#160;   iks_insert_node(iq, ping);</div><div class="line"><a name="l03255"></a><span class="lineno"> 3255</span>&#160;</div><div class="line"><a name="l03256"></a><span class="lineno"> 3256</span>&#160;   res = <a class="code" href="../../dc/d6b/res__xmpp_8c.html#a01f156e90984166f2bbcbcc5a4a6e582">ast_xmpp_client_send</a>(client, iq);</div><div class="line"><a name="l03257"></a><span class="lineno"> 3257</span>&#160;</div><div class="line"><a name="l03258"></a><span class="lineno"> 3258</span>&#160;   iks_delete(ping);</div><div class="line"><a name="l03259"></a><span class="lineno"> 3259</span>&#160;   iks_delete(iq);</div><div class="line"><a name="l03260"></a><span class="lineno"> 3260</span>&#160;</div><div class="line"><a name="l03261"></a><span class="lineno"> 3261</span>&#160;</div><div class="line"><a name="l03262"></a><span class="lineno"> 3262</span>&#160;   <span class="keywordflow">return</span> res;</div><div class="line"><a name="l03263"></a><span class="lineno"> 3263</span>&#160;}</div><div class="line"><a name="l03264"></a><span class="lineno"> 3264</span>&#160;<span class="comment"></span></div><div class="line"><a name="l03265"></a><span class="lineno"> 3265</span>&#160;<span class="comment">/*! \brief Internal function called when a presence message is received */</span></div><div class="line"><a name="l03266"></a><span class="lineno"><a class="line" href="../../dc/d6b/res__xmpp_8c.html#a563e7271ebe6156d3db9f21bfac02db1"> 3266</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../dc/d6b/res__xmpp_8c.html#a563e7271ebe6156d3db9f21bfac02db1">xmpp_pak_presence</a>(<span class="keyword">struct</span> <a class="code" href="../../df/d42/structast__xmpp__client.html">ast_xmpp_client</a> *client, <span class="keyword">struct</span> <a class="code" href="../../da/d00/structast__xmpp__client__config.html">ast_xmpp_client_config</a> *cfg, iks *node, ikspak *pak)</div><div class="line"><a name="l03267"></a><span class="lineno"> 3267</span>&#160;{</div><div class="line"><a name="l03268"></a><span class="lineno"> 3268</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d5/d25/structast__xmpp__buddy.html">ast_xmpp_buddy</a> *buddy;</div><div class="line"><a name="l03269"></a><span class="lineno"> 3269</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d6/d90/structast__xmpp__resource.html">ast_xmpp_resource</a> *<a class="code" href="../../d6/d90/structast__xmpp__resource.html#a12856b954fce601a0303b0bcdf83c513">resource</a>;</div><div class="line"><a name="l03270"></a><span class="lineno"> 3270</span>&#160;   <span class="keywordtype">char</span> *<a class="code" href="../../d7/d49/chan__ooh323_8c.html#a4d63fdfe5451ec2248c16a2739190c56">type</a> = iks_find_attrib(pak-&gt;x, <span class="stringliteral">&quot;type&quot;</span>);</div><div class="line"><a name="l03271"></a><span class="lineno"> 3271</span>&#160;   <span class="keywordtype">int</span> <a class="code" href="../../de/dcd/app__jack_8c.html#ac191e5810fa65e63095409471eb5648f">status</a> = pak-&gt;show ? pak-&gt;show : <a class="code" href="../../dc/d6b/res__xmpp_8c.html#ab99da9edf20009f484cbf3799f4b8638">STATUS_DISAPPEAR</a>;</div><div class="line"><a name="l03272"></a><span class="lineno"> 3272</span>&#160;   <span class="keyword">enum</span> <a class="code" href="../../da/da2/devicestate_8h.html#af72f8a5c0601e4c1f8a852749cd44eee">ast_device_state</a> <a class="code" href="../../d4/d88/structstate.html">state</a> = <a class="code" href="../../da/da2/devicestate_8h.html#af72f8a5c0601e4c1f8a852749cd44eeeafac147cbabf3ccb80e50e86027710549">AST_DEVICE_UNAVAILABLE</a>;</div><div class="line"><a name="l03273"></a><span class="lineno"> 3273</span>&#160;</div><div class="line"><a name="l03274"></a><span class="lineno"> 3274</span>&#160;   <span class="comment">/* If this is a component presence probe request answer immediately with our presence status */</span></div><div class="line"><a name="l03275"></a><span class="lineno"> 3275</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d5/d60/utils_8h.html#a00d4c9254c9827d6fa44f17a326744a5">ast_test_flag</a>(&amp;cfg-&gt;<a class="code" href="../../da/d00/structast__xmpp__client__config.html#aec78000b2897c094f68ed72559e18acd">flags</a>, <a class="code" href="../../dc/d6b/res__xmpp_8c.html#aa3759d2ddcc12f3f5ef5a8a3ffa4a4dfadc3efad94dcc216c29d42b23edcb2d00">XMPP_COMPONENT</a>) &amp;&amp; !<a class="code" href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a>(type) &amp;&amp; !strcasecmp(type, <span class="stringliteral">&quot;probe&quot;</span>)) {</div><div class="line"><a name="l03276"></a><span class="lineno"> 3276</span>&#160;      <a class="code" href="../../dc/d6b/res__xmpp_8c.html#a8f64e805d3ad98e99a03d77bbdb84bed">xmpp_client_set_presence</a>(client, pak-&gt;from-&gt;full, iks_find_attrib(pak-&gt;x, <span class="stringliteral">&quot;to&quot;</span>), cfg-&gt;<a class="code" href="../../da/d00/structast__xmpp__client__config.html#a522b409a211fd313b8a02f071aea6751">status</a>, cfg-&gt;<a class="code" href="../../da/d00/structast__xmpp__client__config.html#a9347a33c3d64978bccf502f846c0d854">statusmsg</a>);</div><div class="line"><a name="l03277"></a><span class="lineno"> 3277</span>&#160;   }</div><div class="line"><a name="l03278"></a><span class="lineno"> 3278</span>&#160;</div><div class="line"><a name="l03279"></a><span class="lineno"> 3279</span>&#160;   <span class="comment">/* If no resource is available this is a general buddy presence update, which we will ignore */</span></div><div class="line"><a name="l03280"></a><span class="lineno"> 3280</span>&#160;   <span class="keywordflow">if</span> (!pak-&gt;from-&gt;resource) {</div><div class="line"><a name="l03281"></a><span class="lineno"> 3281</span>&#160;      <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l03282"></a><span class="lineno"> 3282</span>&#160;   }</div><div class="line"><a name="l03283"></a><span class="lineno"> 3283</span>&#160;</div><div class="line"><a name="l03284"></a><span class="lineno"> 3284</span>&#160;   <span class="keywordflow">if</span> (!(buddy = <a class="code" href="../../d5/da5/astobj2_8h.html#a911e0703891a9a7aaf73978152092586">ao2_find</a>(client-&gt;<a class="code" href="../../df/d42/structast__xmpp__client.html#a5082987d3e1eac5f625574800bb72c2c">buddies</a>, pak-&gt;from-&gt;partial, <a class="code" href="../../d5/da5/astobj2_8h.html#a22f40c733a085f259af94e864ebaa09a">OBJ_KEY</a>))) {</div><div class="line"><a name="l03285"></a><span class="lineno"> 3285</span>&#160;      <span class="comment">/* Only output the message if it is not about us */</span></div><div class="line"><a name="l03286"></a><span class="lineno"> 3286</span>&#160;      <span class="keywordflow">if</span> (strcmp(client-&gt;<a class="code" href="../../df/d42/structast__xmpp__client.html#af738439b96e613a471505eb1222ac406">jid</a>-&gt;partial, pak-&gt;from-&gt;partial)) {</div><div class="line"><a name="l03287"></a><span class="lineno"> 3287</span>&#160;         <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Received presence information about &#39;%s&#39; despite not having them in roster on client &#39;%s&#39;\n&quot;</span>,</div><div class="line"><a name="l03288"></a><span class="lineno"> 3288</span>&#160;            pak-&gt;from-&gt;partial, client-&gt;<a class="code" href="../../df/d42/structast__xmpp__client.html#ace9168767fc3707cf5f0a7d049682ba3">name</a>);</div><div class="line"><a name="l03289"></a><span class="lineno"> 3289</span>&#160;      }</div><div class="line"><a name="l03290"></a><span class="lineno"> 3290</span>&#160;      <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l03291"></a><span class="lineno"> 3291</span>&#160;   }</div><div class="line"><a name="l03292"></a><span class="lineno"> 3292</span>&#160;</div><div class="line"><a name="l03293"></a><span class="lineno"> 3293</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#aa9fdb5d0a6157a56060d9f7279fe6c49">ao2_lock</a>(buddy-&gt;<a class="code" href="../../d5/d25/structast__xmpp__buddy.html#ae3222a7c2c3040d71427c9a8b33ac38c">resources</a>);</div><div class="line"><a name="l03294"></a><span class="lineno"> 3294</span>&#160;</div><div class="line"><a name="l03295"></a><span class="lineno"> 3295</span>&#160;   <span class="keywordflow">if</span> (!(resource = <a class="code" href="../../d5/da5/astobj2_8h.html#a47857055118a703ae87ea5ebaf4842ed">ao2_callback</a>(buddy-&gt;<a class="code" href="../../d5/d25/structast__xmpp__buddy.html#ae3222a7c2c3040d71427c9a8b33ac38c">resources</a>, <a class="code" href="../../d5/da5/astobj2_8h.html#ad9d009e87e737af900825b36db55a35ca52efdf13b66ae502e2e20a5f49f068de">OBJ_NOLOCK</a>, <a class="code" href="../../dc/d6b/res__xmpp_8c.html#a32325f89202eb73b55ba2c0402cc1bf1">xmpp_resource_cmp</a>, pak-&gt;from-&gt;resource))) {</div><div class="line"><a name="l03296"></a><span class="lineno"> 3296</span>&#160;      <span class="comment">/* Only create the new resource if it is not going away - in reality this should not happen */</span></div><div class="line"><a name="l03297"></a><span class="lineno"> 3297</span>&#160;      <span class="keywordflow">if</span> (status != <a class="code" href="../../dc/d6b/res__xmpp_8c.html#ab99da9edf20009f484cbf3799f4b8638">STATUS_DISAPPEAR</a>) {</div><div class="line"><a name="l03298"></a><span class="lineno"> 3298</span>&#160;         <span class="keywordflow">if</span> (!(resource = <a class="code" href="../../d5/da5/astobj2_8h.html#ae0422b60d8e25b6962b2d61ae4ddf724">ao2_alloc</a>(<span class="keyword">sizeof</span>(*resource), <a class="code" href="../../dc/d6b/res__xmpp_8c.html#af278a5f2035bacdf8351da59953f7605">xmpp_resource_destructor</a>))) {</div><div class="line"><a name="l03299"></a><span class="lineno"> 3299</span>&#160;            <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Could not allocate resource object for resource &#39;%s&#39; of buddy &#39;%s&#39; on client &#39;%s&#39;\n&quot;</span>,</div><div class="line"><a name="l03300"></a><span class="lineno"> 3300</span>&#160;               pak-&gt;from-&gt;resource, buddy-&gt;<a class="code" href="../../d5/d25/structast__xmpp__buddy.html#aaf2ca63234b10470cfbba573d4c0ed01">id</a>, client-&gt;<a class="code" href="../../df/d42/structast__xmpp__client.html#ace9168767fc3707cf5f0a7d049682ba3">name</a>);</div><div class="line"><a name="l03301"></a><span class="lineno"> 3301</span>&#160;            <a class="code" href="../../d5/da5/astobj2_8h.html#a9998bd156b936636a8780385e9a910b2">ao2_unlock</a>(buddy-&gt;<a class="code" href="../../d5/d25/structast__xmpp__buddy.html#ae3222a7c2c3040d71427c9a8b33ac38c">resources</a>);</div><div class="line"><a name="l03302"></a><span class="lineno"> 3302</span>&#160;            <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(buddy, -1);</div><div class="line"><a name="l03303"></a><span class="lineno"> 3303</span>&#160;            <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l03304"></a><span class="lineno"> 3304</span>&#160;         }</div><div class="line"><a name="l03305"></a><span class="lineno"> 3305</span>&#160;</div><div class="line"><a name="l03306"></a><span class="lineno"> 3306</span>&#160;         <a class="code" href="../../d6/d90/strings_8h.html#ac4040268f7b6ed77dfc49c7767626369">ast_copy_string</a>(resource-&gt;<a class="code" href="../../d6/d90/structast__xmpp__resource.html#a12856b954fce601a0303b0bcdf83c513">resource</a>, pak-&gt;from-&gt;resource, <span class="keyword">sizeof</span>(resource-&gt;<a class="code" href="../../d6/d90/structast__xmpp__resource.html#a12856b954fce601a0303b0bcdf83c513">resource</a>));</div><div class="line"><a name="l03307"></a><span class="lineno"> 3307</span>&#160;      }</div><div class="line"><a name="l03308"></a><span class="lineno"> 3308</span>&#160;   } <span class="keywordflow">else</span> {</div><div class="line"><a name="l03309"></a><span class="lineno"> 3309</span>&#160;      <span class="comment">/* We unlink the resource in case the priority changes or in case they are going away */</span></div><div class="line"><a name="l03310"></a><span class="lineno"> 3310</span>&#160;      <a class="code" href="../../d5/da5/astobj2_8h.html#a77df7775a2a8b6cbef307e211dbf045c">ao2_unlink_flags</a>(buddy-&gt;<a class="code" href="../../d5/d25/structast__xmpp__buddy.html#ae3222a7c2c3040d71427c9a8b33ac38c">resources</a>, resource, <a class="code" href="../../d5/da5/astobj2_8h.html#ad9d009e87e737af900825b36db55a35ca52efdf13b66ae502e2e20a5f49f068de">OBJ_NOLOCK</a>);</div><div class="line"><a name="l03311"></a><span class="lineno"> 3311</span>&#160;   }</div><div class="line"><a name="l03312"></a><span class="lineno"> 3312</span>&#160;</div><div class="line"><a name="l03313"></a><span class="lineno"> 3313</span>&#160;   <span class="comment">/* Only update the resource and add it back in if it is not going away */</span></div><div class="line"><a name="l03314"></a><span class="lineno"> 3314</span>&#160;   <span class="keywordflow">if</span> (resource &amp;&amp; (status != <a class="code" href="../../dc/d6b/res__xmpp_8c.html#ab99da9edf20009f484cbf3799f4b8638">STATUS_DISAPPEAR</a>)) {</div><div class="line"><a name="l03315"></a><span class="lineno"> 3315</span>&#160;      <span class="keywordtype">char</span> *node, *ver;</div><div class="line"><a name="l03316"></a><span class="lineno"> 3316</span>&#160;</div><div class="line"><a name="l03317"></a><span class="lineno"> 3317</span>&#160;      <span class="comment">/* Try to get the XMPP spec node, and fall back to Google if not found */</span></div><div class="line"><a name="l03318"></a><span class="lineno"> 3318</span>&#160;      <span class="keywordflow">if</span> (!(node = iks_find_attrib(iks_find(pak-&gt;x, <span class="stringliteral">&quot;c&quot;</span>), <span class="stringliteral">&quot;node&quot;</span>))) {</div><div class="line"><a name="l03319"></a><span class="lineno"> 3319</span>&#160;         node = iks_find_attrib(iks_find(pak-&gt;x, <span class="stringliteral">&quot;caps:c&quot;</span>), <span class="stringliteral">&quot;node&quot;</span>);</div><div class="line"><a name="l03320"></a><span class="lineno"> 3320</span>&#160;      }</div><div class="line"><a name="l03321"></a><span class="lineno"> 3321</span>&#160;</div><div class="line"><a name="l03322"></a><span class="lineno"> 3322</span>&#160;      <span class="keywordflow">if</span> (!(ver = iks_find_attrib(iks_find(pak-&gt;x, <span class="stringliteral">&quot;c&quot;</span>), <span class="stringliteral">&quot;ver&quot;</span>))) {</div><div class="line"><a name="l03323"></a><span class="lineno"> 3323</span>&#160;         ver = iks_find_attrib(iks_find(pak-&gt;x, <span class="stringliteral">&quot;caps:c&quot;</span>), <span class="stringliteral">&quot;ver&quot;</span>);</div><div class="line"><a name="l03324"></a><span class="lineno"> 3324</span>&#160;      }</div><div class="line"><a name="l03325"></a><span class="lineno"> 3325</span>&#160;</div><div class="line"><a name="l03326"></a><span class="lineno"> 3326</span>&#160;      <span class="keywordflow">if</span> (resource-&gt;<a class="code" href="../../d6/d90/structast__xmpp__resource.html#a8444d6e0dfe2bbab0b5e7b24308f1559">description</a>) {</div><div class="line"><a name="l03327"></a><span class="lineno"> 3327</span>&#160;         <a class="code" href="../../d8/d8a/astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(resource-&gt;<a class="code" href="../../d6/d90/structast__xmpp__resource.html#a8444d6e0dfe2bbab0b5e7b24308f1559">description</a>);</div><div class="line"><a name="l03328"></a><span class="lineno"> 3328</span>&#160;      }</div><div class="line"><a name="l03329"></a><span class="lineno"> 3329</span>&#160;</div><div class="line"><a name="l03330"></a><span class="lineno"> 3330</span>&#160;      <span class="keywordflow">if</span> ((node &amp;&amp; strcmp(resource-&gt;<a class="code" href="../../d6/d90/structast__xmpp__resource.html#a4ac032e592fb6d9cf9fdaf3e269fc433">caps</a>.<a class="code" href="../../da/daa/structast__xmpp__capabilities.html#a987239273bb4a074ad22c76c6486d5b1">node</a>, node)) || (ver &amp;&amp; strcmp(resource-&gt;<a class="code" href="../../d6/d90/structast__xmpp__resource.html#a4ac032e592fb6d9cf9fdaf3e269fc433">caps</a>.<a class="code" href="../../da/daa/structast__xmpp__capabilities.html#a039f1dc229c7bd812108a7e8f54249e5">version</a>, ver))) {</div><div class="line"><a name="l03331"></a><span class="lineno"> 3331</span>&#160;         <span class="comment">/* For interoperability reasons, proceed even if the resource fails to provide node or version */</span></div><div class="line"><a name="l03332"></a><span class="lineno"> 3332</span>&#160;         <span class="keywordflow">if</span> (node) {</div><div class="line"><a name="l03333"></a><span class="lineno"> 3333</span>&#160;            <a class="code" href="../../d6/d90/strings_8h.html#ac4040268f7b6ed77dfc49c7767626369">ast_copy_string</a>(resource-&gt;<a class="code" href="../../d6/d90/structast__xmpp__resource.html#a4ac032e592fb6d9cf9fdaf3e269fc433">caps</a>.<a class="code" href="../../da/daa/structast__xmpp__capabilities.html#a987239273bb4a074ad22c76c6486d5b1">node</a>, node, <span class="keyword">sizeof</span>(resource-&gt;<a class="code" href="../../d6/d90/structast__xmpp__resource.html#a4ac032e592fb6d9cf9fdaf3e269fc433">caps</a>.<a class="code" href="../../da/daa/structast__xmpp__capabilities.html#a987239273bb4a074ad22c76c6486d5b1">node</a>));</div><div class="line"><a name="l03334"></a><span class="lineno"> 3334</span>&#160;         }</div><div class="line"><a name="l03335"></a><span class="lineno"> 3335</span>&#160;         <span class="keywordflow">if</span> (ver) {</div><div class="line"><a name="l03336"></a><span class="lineno"> 3336</span>&#160;            <a class="code" href="../../d6/d90/strings_8h.html#ac4040268f7b6ed77dfc49c7767626369">ast_copy_string</a>(resource-&gt;<a class="code" href="../../d6/d90/structast__xmpp__resource.html#a4ac032e592fb6d9cf9fdaf3e269fc433">caps</a>.<a class="code" href="../../da/daa/structast__xmpp__capabilities.html#a039f1dc229c7bd812108a7e8f54249e5">version</a>, ver, <span class="keyword">sizeof</span>(resource-&gt;<a class="code" href="../../d6/d90/structast__xmpp__resource.html#a4ac032e592fb6d9cf9fdaf3e269fc433">caps</a>.<a class="code" href="../../da/daa/structast__xmpp__capabilities.html#a039f1dc229c7bd812108a7e8f54249e5">version</a>));</div><div class="line"><a name="l03337"></a><span class="lineno"> 3337</span>&#160;         }</div><div class="line"><a name="l03338"></a><span class="lineno"> 3338</span>&#160;</div><div class="line"><a name="l03339"></a><span class="lineno"> 3339</span>&#160;         <span class="comment">/* Google Talk places the capabilities information directly in presence, so see if it is there */</span></div><div class="line"><a name="l03340"></a><span class="lineno"> 3340</span>&#160;         <span class="keywordflow">if</span> (iks_find_with_attrib(pak-&gt;x, <span class="stringliteral">&quot;c&quot;</span>, <span class="stringliteral">&quot;node&quot;</span>, <span class="stringliteral">&quot;http://www.google.com/xmpp/client/caps&quot;</span>) ||</div><div class="line"><a name="l03341"></a><span class="lineno"> 3341</span>&#160;             iks_find_with_attrib(pak-&gt;x, <span class="stringliteral">&quot;caps:c&quot;</span>, <span class="stringliteral">&quot;node&quot;</span>, <span class="stringliteral">&quot;http://www.google.com/xmpp/client/caps&quot;</span>) ||</div><div class="line"><a name="l03342"></a><span class="lineno"> 3342</span>&#160;             iks_find_with_attrib(pak-&gt;x, <span class="stringliteral">&quot;c&quot;</span>, <span class="stringliteral">&quot;node&quot;</span>, <span class="stringliteral">&quot;http://www.android.com/gtalk/client/caps&quot;</span>) ||</div><div class="line"><a name="l03343"></a><span class="lineno"> 3343</span>&#160;             iks_find_with_attrib(pak-&gt;x, <span class="stringliteral">&quot;caps:c&quot;</span>, <span class="stringliteral">&quot;node&quot;</span>, <span class="stringliteral">&quot;http://www.android.com/gtalk/client/caps&quot;</span>) ||</div><div class="line"><a name="l03344"></a><span class="lineno"> 3344</span>&#160;             iks_find_with_attrib(pak-&gt;x, <span class="stringliteral">&quot;c&quot;</span>, <span class="stringliteral">&quot;node&quot;</span>, <span class="stringliteral">&quot;http://mail.google.com/xmpp/client/caps&quot;</span>) ||</div><div class="line"><a name="l03345"></a><span class="lineno"> 3345</span>&#160;             iks_find_with_attrib(pak-&gt;x, <span class="stringliteral">&quot;caps:c&quot;</span>, <span class="stringliteral">&quot;node&quot;</span>, <span class="stringliteral">&quot;http://mail.google.com/xmpp/client/caps&quot;</span>)) {</div><div class="line"><a name="l03346"></a><span class="lineno"> 3346</span>&#160;            resource-&gt;<a class="code" href="../../d6/d90/structast__xmpp__resource.html#a4ac032e592fb6d9cf9fdaf3e269fc433">caps</a>.<a class="code" href="../../da/daa/structast__xmpp__capabilities.html#a641f34a6ff897f49fcdf930758ff69fe">google</a> = 1;</div><div class="line"><a name="l03347"></a><span class="lineno"> 3347</span>&#160;         }</div><div class="line"><a name="l03348"></a><span class="lineno"> 3348</span>&#160;</div><div class="line"><a name="l03349"></a><span class="lineno"> 3349</span>&#160;         <span class="comment">/* To discover if the buddy supports Jingle we need to query, so do so */</span></div><div class="line"><a name="l03350"></a><span class="lineno"> 3350</span>&#160;         <span class="keywordflow">if</span> (<a class="code" href="../../dc/d6b/res__xmpp_8c.html#af7e745a942bd8d6f5ba56ca9cfe5b67e">xmpp_client_send_disco_info_request</a>(client, pak-&gt;from-&gt;full, client-&gt;<a class="code" href="../../df/d42/structast__xmpp__client.html#af738439b96e613a471505eb1222ac406">jid</a>-&gt;full)) {</div><div class="line"><a name="l03351"></a><span class="lineno"> 3351</span>&#160;            <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Could not send discovery information request to resource &#39;%s&#39; of buddy &#39;%s&#39; on client &#39;%s&#39;, capabilities may be incomplete\n&quot;</span>, resource-&gt;<a class="code" href="../../d6/d90/structast__xmpp__resource.html#a12856b954fce601a0303b0bcdf83c513">resource</a>, buddy-&gt;<a class="code" href="../../d5/d25/structast__xmpp__buddy.html#aaf2ca63234b10470cfbba573d4c0ed01">id</a>, client-&gt;<a class="code" href="../../df/d42/structast__xmpp__client.html#ace9168767fc3707cf5f0a7d049682ba3">name</a>);</div><div class="line"><a name="l03352"></a><span class="lineno"> 3352</span>&#160;         }</div><div class="line"><a name="l03353"></a><span class="lineno"> 3353</span>&#160;      }</div><div class="line"><a name="l03354"></a><span class="lineno"> 3354</span>&#160;</div><div class="line"><a name="l03355"></a><span class="lineno"> 3355</span>&#160;      resource-&gt;<a class="code" href="../../d6/d90/structast__xmpp__resource.html#a6e27f49150e9a14580fb313cc2777e00">status</a> = <a class="code" href="../../de/dcd/app__jack_8c.html#ac191e5810fa65e63095409471eb5648f">status</a>;</div><div class="line"><a name="l03356"></a><span class="lineno"> 3356</span>&#160;      resource-&gt;<a class="code" href="../../d6/d90/structast__xmpp__resource.html#a8444d6e0dfe2bbab0b5e7b24308f1559">description</a> = <a class="code" href="../../d8/d8a/astmm_8h.html#ab263849d03fb892847be4986db759737">ast_strdup</a>(iks_find_cdata(pak-&gt;x, <span class="stringliteral">&quot;status&quot;</span>));</div><div class="line"><a name="l03357"></a><span class="lineno"> 3357</span>&#160;      resource-&gt;<a class="code" href="../../d6/d90/structast__xmpp__resource.html#acec9ce2df15222151ad66fcb1d74eb9f">priority</a> = atoi((iks_find_cdata(pak-&gt;x, <span class="stringliteral">&quot;priority&quot;</span>)) ? iks_find_cdata(pak-&gt;x, <span class="stringliteral">&quot;priority&quot;</span>) : <span class="stringliteral">&quot;0&quot;</span>);</div><div class="line"><a name="l03358"></a><span class="lineno"> 3358</span>&#160;</div><div class="line"><a name="l03359"></a><span class="lineno"> 3359</span>&#160;      <a class="code" href="../../d5/da5/astobj2_8h.html#a7ce8563daf84a18540a86504d165b444">ao2_link_flags</a>(buddy-&gt;<a class="code" href="../../d5/d25/structast__xmpp__buddy.html#ae3222a7c2c3040d71427c9a8b33ac38c">resources</a>, resource, <a class="code" href="../../d5/da5/astobj2_8h.html#ad9d009e87e737af900825b36db55a35ca52efdf13b66ae502e2e20a5f49f068de">OBJ_NOLOCK</a>);</div><div class="line"><a name="l03360"></a><span class="lineno"> 3360</span>&#160;</div><div class="line"><a name="l03361"></a><span class="lineno"> 3361</span>&#160;      <a class="code" href="../../db/d45/manager_8h.html#a1ef0ee0044dbbeb4c3a5abc6c046b208">manager_event</a>(<a class="code" href="../../db/d45/manager_8h.html#acc12c2bc03dce67ddd1590d67ab11f4d">EVENT_FLAG_USER</a>, <span class="stringliteral">&quot;JabberStatus&quot;</span>,</div><div class="line"><a name="l03362"></a><span class="lineno"> 3362</span>&#160;               <span class="stringliteral">&quot;Account: %s\r\nJID: %s\r\nResource: %s\r\nStatus: %d\r\nPriority: %d&quot;</span></div><div class="line"><a name="l03363"></a><span class="lineno"> 3363</span>&#160;               <span class="stringliteral">&quot;\r\nDescription: %s\r\n&quot;</span>,</div><div class="line"><a name="l03364"></a><span class="lineno"> 3364</span>&#160;               client-&gt;<a class="code" href="../../df/d42/structast__xmpp__client.html#ace9168767fc3707cf5f0a7d049682ba3">name</a>, pak-&gt;from-&gt;partial, resource-&gt;<a class="code" href="../../d6/d90/structast__xmpp__resource.html#a12856b954fce601a0303b0bcdf83c513">resource</a>, resource-&gt;<a class="code" href="../../d6/d90/structast__xmpp__resource.html#a6e27f49150e9a14580fb313cc2777e00">status</a>,</div><div class="line"><a name="l03365"></a><span class="lineno"> 3365</span>&#160;               resource-&gt;<a class="code" href="../../d6/d90/structast__xmpp__resource.html#acec9ce2df15222151ad66fcb1d74eb9f">priority</a>, <a class="code" href="../../d6/d90/strings_8h.html#a2faaa16929951bfd2802b7829a100ba2">S_OR</a>(resource-&gt;<a class="code" href="../../d6/d90/structast__xmpp__resource.html#a8444d6e0dfe2bbab0b5e7b24308f1559">description</a>, <span class="stringliteral">&quot;&quot;</span>));</div><div class="line"><a name="l03366"></a><span class="lineno"> 3366</span>&#160;</div><div class="line"><a name="l03367"></a><span class="lineno"> 3367</span>&#160;      <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(resource, -1);</div><div class="line"><a name="l03368"></a><span class="lineno"> 3368</span>&#160;   } <span class="keywordflow">else</span> {</div><div class="line"><a name="l03369"></a><span class="lineno"> 3369</span>&#160;      <span class="comment">/* This will get hit by presence coming in for an unknown resource, and also when a resource goes away */</span></div><div class="line"><a name="l03370"></a><span class="lineno"> 3370</span>&#160;      <span class="keywordflow">if</span> (resource) {</div><div class="line"><a name="l03371"></a><span class="lineno"> 3371</span>&#160;         <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(resource, -1);</div><div class="line"><a name="l03372"></a><span class="lineno"> 3372</span>&#160;      }</div><div class="line"><a name="l03373"></a><span class="lineno"> 3373</span>&#160;</div><div class="line"><a name="l03374"></a><span class="lineno"> 3374</span>&#160;      <a class="code" href="../../db/d45/manager_8h.html#a1ef0ee0044dbbeb4c3a5abc6c046b208">manager_event</a>(<a class="code" href="../../db/d45/manager_8h.html#acc12c2bc03dce67ddd1590d67ab11f4d">EVENT_FLAG_USER</a>, <span class="stringliteral">&quot;JabberStatus&quot;</span>,</div><div class="line"><a name="l03375"></a><span class="lineno"> 3375</span>&#160;               <span class="stringliteral">&quot;Account: %s\r\nJID: %s\r\nStatus: %u\r\n&quot;</span>,</div><div class="line"><a name="l03376"></a><span class="lineno"> 3376</span>&#160;               client-&gt;<a class="code" href="../../df/d42/structast__xmpp__client.html#ace9168767fc3707cf5f0a7d049682ba3">name</a>, pak-&gt;from-&gt;partial, pak-&gt;show ? pak-&gt;show : IKS_SHOW_UNAVAILABLE);</div><div class="line"><a name="l03377"></a><span class="lineno"> 3377</span>&#160;   }</div><div class="line"><a name="l03378"></a><span class="lineno"> 3378</span>&#160;</div><div class="line"><a name="l03379"></a><span class="lineno"> 3379</span>&#160;   <span class="comment">/* Determine if at least one resource is available for device state purposes */</span></div><div class="line"><a name="l03380"></a><span class="lineno"> 3380</span>&#160;   <span class="keywordflow">if</span> ((resource = <a class="code" href="../../d5/da5/astobj2_8h.html#a47857055118a703ae87ea5ebaf4842ed">ao2_callback</a>(buddy-&gt;<a class="code" href="../../d5/d25/structast__xmpp__buddy.html#ae3222a7c2c3040d71427c9a8b33ac38c">resources</a>, <a class="code" href="../../d5/da5/astobj2_8h.html#ad9d009e87e737af900825b36db55a35ca52efdf13b66ae502e2e20a5f49f068de">OBJ_NOLOCK</a>, <a class="code" href="../../dc/d6b/res__xmpp_8c.html#aa5e440109f4377b97485e07c65cc7f17">xmpp_resource_is_available</a>, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>))) {</div><div class="line"><a name="l03381"></a><span class="lineno"> 3381</span>&#160;      state = <a class="code" href="../../da/da2/devicestate_8h.html#af72f8a5c0601e4c1f8a852749cd44eeeadee91fc4886ffc7b4efb8459cef48fe2">AST_DEVICE_NOT_INUSE</a>;</div><div class="line"><a name="l03382"></a><span class="lineno"> 3382</span>&#160;      <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(resource, -1);</div><div class="line"><a name="l03383"></a><span class="lineno"> 3383</span>&#160;   }</div><div class="line"><a name="l03384"></a><span class="lineno"> 3384</span>&#160;</div><div class="line"><a name="l03385"></a><span class="lineno"> 3385</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#a9998bd156b936636a8780385e9a910b2">ao2_unlock</a>(buddy-&gt;<a class="code" href="../../d5/d25/structast__xmpp__buddy.html#ae3222a7c2c3040d71427c9a8b33ac38c">resources</a>);</div><div class="line"><a name="l03386"></a><span class="lineno"> 3386</span>&#160;</div><div class="line"><a name="l03387"></a><span class="lineno"> 3387</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(buddy, -1);</div><div class="line"><a name="l03388"></a><span class="lineno"> 3388</span>&#160;</div><div class="line"><a name="l03389"></a><span class="lineno"> 3389</span>&#160;   <a class="code" href="../../da/da2/devicestate_8h.html#a62a8e6bc4b82dd797e505688f9f29bff">ast_devstate_changed</a>(state, <a class="code" href="../../da/da2/devicestate_8h.html#a26cbac580d3e86b529f90058f6e91ac7a3683b746ab070a6455934b5d24dbd779">AST_DEVSTATE_CACHABLE</a>, <span class="stringliteral">&quot;XMPP/%s/%s&quot;</span>, client-&gt;<a class="code" href="../../df/d42/structast__xmpp__client.html#ace9168767fc3707cf5f0a7d049682ba3">name</a>, pak-&gt;from-&gt;partial);</div><div class="line"><a name="l03390"></a><span class="lineno"> 3390</span>&#160;</div><div class="line"><a name="l03391"></a><span class="lineno"> 3391</span>&#160;   <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l03392"></a><span class="lineno"> 3392</span>&#160;}</div><div class="line"><a name="l03393"></a><span class="lineno"> 3393</span>&#160;<span class="comment"></span></div><div class="line"><a name="l03394"></a><span class="lineno"> 3394</span>&#160;<span class="comment">/*! \brief Internal function called when a subscription message is received */</span></div><div class="line"><a name="l03395"></a><span class="lineno"><a class="line" href="../../dc/d6b/res__xmpp_8c.html#a24812e0efb23effa2797b3d7848f2bb3"> 3395</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../dc/d6b/res__xmpp_8c.html#a24812e0efb23effa2797b3d7848f2bb3">xmpp_pak_s10n</a>(<span class="keyword">struct</span> <a class="code" href="../../df/d42/structast__xmpp__client.html">ast_xmpp_client</a> *client, <span class="keyword">struct</span> <a class="code" href="../../da/d00/structast__xmpp__client__config.html">ast_xmpp_client_config</a> *cfg,iks *node, ikspak *pak)</div><div class="line"><a name="l03396"></a><span class="lineno"> 3396</span>&#160;{</div><div class="line"><a name="l03397"></a><span class="lineno"> 3397</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d5/d25/structast__xmpp__buddy.html">ast_xmpp_buddy</a> *buddy;</div><div class="line"><a name="l03398"></a><span class="lineno"> 3398</span>&#160;</div><div class="line"><a name="l03399"></a><span class="lineno"> 3399</span>&#160;   <span class="keywordflow">switch</span> (pak-&gt;subtype) {</div><div class="line"><a name="l03400"></a><span class="lineno"> 3400</span>&#160;   <span class="keywordflow">case</span> IKS_TYPE_SUBSCRIBE:</div><div class="line"><a name="l03401"></a><span class="lineno"> 3401</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="../../d5/d60/utils_8h.html#a00d4c9254c9827d6fa44f17a326744a5">ast_test_flag</a>(&amp;cfg-&gt;<a class="code" href="../../da/d00/structast__xmpp__client__config.html#aec78000b2897c094f68ed72559e18acd">flags</a>, <a class="code" href="../../dc/d6b/res__xmpp_8c.html#aa3759d2ddcc12f3f5ef5a8a3ffa4a4dfa18ce12342ffe1b2f00bb53be6a87665d">XMPP_AUTOREGISTER</a>)) {</div><div class="line"><a name="l03402"></a><span class="lineno"> 3402</span>&#160;         iks *presence, *<a class="code" href="../../de/dcd/app__jack_8c.html#ac191e5810fa65e63095409471eb5648f">status</a> = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l03403"></a><span class="lineno"> 3403</span>&#160;</div><div class="line"><a name="l03404"></a><span class="lineno"> 3404</span>&#160;         <span class="keywordflow">if</span> ((presence = iks_new(<span class="stringliteral">&quot;presence&quot;</span>)) &amp;&amp; (status = iks_new(<span class="stringliteral">&quot;status&quot;</span>))) {</div><div class="line"><a name="l03405"></a><span class="lineno"> 3405</span>&#160;            iks_insert_attrib(presence, <span class="stringliteral">&quot;type&quot;</span>, <span class="stringliteral">&quot;subscribed&quot;</span>);</div><div class="line"><a name="l03406"></a><span class="lineno"> 3406</span>&#160;            iks_insert_attrib(presence, <span class="stringliteral">&quot;to&quot;</span>, pak-&gt;from-&gt;full);</div><div class="line"><a name="l03407"></a><span class="lineno"> 3407</span>&#160;            iks_insert_attrib(presence, <span class="stringliteral">&quot;from&quot;</span>, client-&gt;<a class="code" href="../../df/d42/structast__xmpp__client.html#af738439b96e613a471505eb1222ac406">jid</a>-&gt;full);</div><div class="line"><a name="l03408"></a><span class="lineno"> 3408</span>&#160;</div><div class="line"><a name="l03409"></a><span class="lineno"> 3409</span>&#160;            <span class="keywordflow">if</span> (pak-&gt;id) {</div><div class="line"><a name="l03410"></a><span class="lineno"> 3410</span>&#160;               iks_insert_attrib(presence, <span class="stringliteral">&quot;id&quot;</span>, pak-&gt;id);</div><div class="line"><a name="l03411"></a><span class="lineno"> 3411</span>&#160;            }</div><div class="line"><a name="l03412"></a><span class="lineno"> 3412</span>&#160;</div><div class="line"><a name="l03413"></a><span class="lineno"> 3413</span>&#160;            iks_insert_cdata(status, <span class="stringliteral">&quot;Asterisk has approved your subscription&quot;</span>, 0);</div><div class="line"><a name="l03414"></a><span class="lineno"> 3414</span>&#160;            iks_insert_node(presence, status);</div><div class="line"><a name="l03415"></a><span class="lineno"> 3415</span>&#160;</div><div class="line"><a name="l03416"></a><span class="lineno"> 3416</span>&#160;            <span class="keywordflow">if</span> (<a class="code" href="../../dc/d6b/res__xmpp_8c.html#a01f156e90984166f2bbcbcc5a4a6e582">ast_xmpp_client_send</a>(client, presence)) {</div><div class="line"><a name="l03417"></a><span class="lineno"> 3417</span>&#160;               <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Could not send subscription acceptance to &#39;%s&#39; from client &#39;%s&#39;\n&quot;</span>,</div><div class="line"><a name="l03418"></a><span class="lineno"> 3418</span>&#160;                  pak-&gt;from-&gt;partial, client-&gt;<a class="code" href="../../df/d42/structast__xmpp__client.html#ace9168767fc3707cf5f0a7d049682ba3">name</a>);</div><div class="line"><a name="l03419"></a><span class="lineno"> 3419</span>&#160;            }</div><div class="line"><a name="l03420"></a><span class="lineno"> 3420</span>&#160;         } <span class="keywordflow">else</span> {</div><div class="line"><a name="l03421"></a><span class="lineno"> 3421</span>&#160;            <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Could not allocate presence stanzas for accepting subscription from &#39;%s&#39; to client &#39;%s&#39;\n&quot;</span>,</div><div class="line"><a name="l03422"></a><span class="lineno"> 3422</span>&#160;               pak-&gt;from-&gt;partial, client-&gt;<a class="code" href="../../df/d42/structast__xmpp__client.html#ace9168767fc3707cf5f0a7d049682ba3">name</a>);</div><div class="line"><a name="l03423"></a><span class="lineno"> 3423</span>&#160;         }</div><div class="line"><a name="l03424"></a><span class="lineno"> 3424</span>&#160;</div><div class="line"><a name="l03425"></a><span class="lineno"> 3425</span>&#160;         iks_delete(status);</div><div class="line"><a name="l03426"></a><span class="lineno"> 3426</span>&#160;         iks_delete(presence);</div><div class="line"><a name="l03427"></a><span class="lineno"> 3427</span>&#160;      }</div><div class="line"><a name="l03428"></a><span class="lineno"> 3428</span>&#160;</div><div class="line"><a name="l03429"></a><span class="lineno"> 3429</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="../../d5/d60/utils_8h.html#a00d4c9254c9827d6fa44f17a326744a5">ast_test_flag</a>(&amp;cfg-&gt;<a class="code" href="../../da/d00/structast__xmpp__client__config.html#aec78000b2897c094f68ed72559e18acd">flags</a>, <a class="code" href="../../dc/d6b/res__xmpp_8c.html#aa3759d2ddcc12f3f5ef5a8a3ffa4a4dfadc3efad94dcc216c29d42b23edcb2d00">XMPP_COMPONENT</a>)) {</div><div class="line"><a name="l03430"></a><span class="lineno"> 3430</span>&#160;         <a class="code" href="../../dc/d6b/res__xmpp_8c.html#a8f64e805d3ad98e99a03d77bbdb84bed">xmpp_client_set_presence</a>(client, pak-&gt;from-&gt;full, iks_find_attrib(pak-&gt;x, <span class="stringliteral">&quot;to&quot;</span>), cfg-&gt;<a class="code" href="../../da/d00/structast__xmpp__client__config.html#a522b409a211fd313b8a02f071aea6751">status</a>, cfg-&gt;<a class="code" href="../../da/d00/structast__xmpp__client__config.html#a9347a33c3d64978bccf502f846c0d854">statusmsg</a>);</div><div class="line"><a name="l03431"></a><span class="lineno"> 3431</span>&#160;      }</div><div class="line"><a name="l03432"></a><span class="lineno"> 3432</span>&#160;      <span class="comment">/* This purposely flows through so we have the subscriber amongst our buddies */</span></div><div class="line"><a name="l03433"></a><span class="lineno"> 3433</span>&#160;   <span class="keywordflow">case</span> IKS_TYPE_SUBSCRIBED:</div><div class="line"><a name="l03434"></a><span class="lineno"> 3434</span>&#160;      <a class="code" href="../../d5/da5/astobj2_8h.html#aa9fdb5d0a6157a56060d9f7279fe6c49">ao2_lock</a>(client-&gt;<a class="code" href="../../df/d42/structast__xmpp__client.html#a5082987d3e1eac5f625574800bb72c2c">buddies</a>);</div><div class="line"><a name="l03435"></a><span class="lineno"> 3435</span>&#160;</div><div class="line"><a name="l03436"></a><span class="lineno"> 3436</span>&#160;      <span class="keywordflow">if</span> (!(buddy = <a class="code" href="../../d5/da5/astobj2_8h.html#a911e0703891a9a7aaf73978152092586">ao2_find</a>(client-&gt;<a class="code" href="../../df/d42/structast__xmpp__client.html#a5082987d3e1eac5f625574800bb72c2c">buddies</a>, pak-&gt;from-&gt;partial, <a class="code" href="../../d5/da5/astobj2_8h.html#a22f40c733a085f259af94e864ebaa09a">OBJ_KEY</a> | <a class="code" href="../../d5/da5/astobj2_8h.html#ad9d009e87e737af900825b36db55a35ca52efdf13b66ae502e2e20a5f49f068de">OBJ_NOLOCK</a>))) {</div><div class="line"><a name="l03437"></a><span class="lineno"> 3437</span>&#160;         buddy = <a class="code" href="../../dc/d6b/res__xmpp_8c.html#a4c3a2b177d134ce8482f9a5751754931">xmpp_client_create_buddy</a>(client-&gt;<a class="code" href="../../df/d42/structast__xmpp__client.html#a5082987d3e1eac5f625574800bb72c2c">buddies</a>, pak-&gt;from-&gt;partial);</div><div class="line"><a name="l03438"></a><span class="lineno"> 3438</span>&#160;      }</div><div class="line"><a name="l03439"></a><span class="lineno"> 3439</span>&#160;</div><div class="line"><a name="l03440"></a><span class="lineno"> 3440</span>&#160;      <span class="keywordflow">if</span> (!buddy) {</div><div class="line"><a name="l03441"></a><span class="lineno"> 3441</span>&#160;         <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Could not find or create buddy &#39;%s&#39; on client &#39;%s&#39;\n&quot;</span>,</div><div class="line"><a name="l03442"></a><span class="lineno"> 3442</span>&#160;            pak-&gt;from-&gt;partial, client-&gt;<a class="code" href="../../df/d42/structast__xmpp__client.html#ace9168767fc3707cf5f0a7d049682ba3">name</a>);</div><div class="line"><a name="l03443"></a><span class="lineno"> 3443</span>&#160;      } <span class="keywordflow">else</span> {</div><div class="line"><a name="l03444"></a><span class="lineno"> 3444</span>&#160;         <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(buddy, -1);</div><div class="line"><a name="l03445"></a><span class="lineno"> 3445</span>&#160;      }</div><div class="line"><a name="l03446"></a><span class="lineno"> 3446</span>&#160;</div><div class="line"><a name="l03447"></a><span class="lineno"> 3447</span>&#160;      <a class="code" href="../../d5/da5/astobj2_8h.html#a9998bd156b936636a8780385e9a910b2">ao2_unlock</a>(client-&gt;<a class="code" href="../../df/d42/structast__xmpp__client.html#a5082987d3e1eac5f625574800bb72c2c">buddies</a>);</div><div class="line"><a name="l03448"></a><span class="lineno"> 3448</span>&#160;</div><div class="line"><a name="l03449"></a><span class="lineno"> 3449</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l03450"></a><span class="lineno"> 3450</span>&#160;   <span class="keywordflow">default</span>:</div><div class="line"><a name="l03451"></a><span class="lineno"> 3451</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l03452"></a><span class="lineno"> 3452</span>&#160;   }</div><div class="line"><a name="l03453"></a><span class="lineno"> 3453</span>&#160;</div><div class="line"><a name="l03454"></a><span class="lineno"> 3454</span>&#160;   <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l03455"></a><span class="lineno"> 3455</span>&#160;}</div><div class="line"><a name="l03456"></a><span class="lineno"> 3456</span>&#160;<span class="comment"></span></div><div class="line"><a name="l03457"></a><span class="lineno"> 3457</span>&#160;<span class="comment">/*! \brief Action hook for when things occur */</span></div><div class="line"><a name="l03458"></a><span class="lineno"><a class="line" href="../../dc/d6b/res__xmpp_8c.html#ae87b447a7957b9901ac78e5b6eae182a"> 3458</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../dc/d6b/res__xmpp_8c.html#ae87b447a7957b9901ac78e5b6eae182a">xmpp_action_hook</a>(<span class="keywordtype">void</span> *data, <span class="keywordtype">int</span> <a class="code" href="../../d7/d49/chan__ooh323_8c.html#a4d63fdfe5451ec2248c16a2739190c56">type</a>, iks *node)</div><div class="line"><a name="l03459"></a><span class="lineno"> 3459</span>&#160;{</div><div class="line"><a name="l03460"></a><span class="lineno"> 3460</span>&#160;   <a class="code" href="../../d5/d60/utils_8h.html#a1604b4d72144dd3d9f7da668e90337e9">RAII_VAR</a>(<span class="keyword">struct</span> <a class="code" href="../../de/d1c/structxmpp__config.html">xmpp_config</a> *, cfg, <a class="code" href="../../d5/da5/astobj2_8h.html#a86d8d6c3c8866ed0a60121da055cd225">ao2_global_obj_ref</a>(<a class="code" href="../../d3/d4e/chan__console_8c.html#aa36e3e2c486b920b166c2d17c5242221">globals</a>), <a class="code" href="../../d5/da5/astobj2_8h.html#a6321ee982370c55ab3c24c72c562cbdd">ao2_cleanup</a>);</div><div class="line"><a name="l03461"></a><span class="lineno"> 3461</span>&#160;   <a class="code" href="../../d5/d60/utils_8h.html#a1604b4d72144dd3d9f7da668e90337e9">RAII_VAR</a>(<span class="keyword">struct</span> <a class="code" href="../../da/d00/structast__xmpp__client__config.html">ast_xmpp_client_config</a> *, clientcfg, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../d5/da5/astobj2_8h.html#a6321ee982370c55ab3c24c72c562cbdd">ao2_cleanup</a>);</div><div class="line"><a name="l03462"></a><span class="lineno"> 3462</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../df/d42/structast__xmpp__client.html">ast_xmpp_client</a> *client = data;</div><div class="line"><a name="l03463"></a><span class="lineno"> 3463</span>&#160;   ikspak *pak;</div><div class="line"><a name="l03464"></a><span class="lineno"> 3464</span>&#160;   <span class="keywordtype">int</span> i;</div><div class="line"><a name="l03465"></a><span class="lineno"> 3465</span>&#160;</div><div class="line"><a name="l03466"></a><span class="lineno"> 3466</span>&#160;   <span class="keywordflow">if</span> (!node) {</div><div class="line"><a name="l03467"></a><span class="lineno"> 3467</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;xmpp_action_hook was called without a packet\n&quot;</span>);</div><div class="line"><a name="l03468"></a><span class="lineno"> 3468</span>&#160;      <span class="keywordflow">return</span> IKS_HOOK;</div><div class="line"><a name="l03469"></a><span class="lineno"> 3469</span>&#160;   }</div><div class="line"><a name="l03470"></a><span class="lineno"> 3470</span>&#160;</div><div class="line"><a name="l03471"></a><span class="lineno"> 3471</span>&#160;   <span class="keywordflow">if</span> (!cfg || !cfg-&gt;clients || !(clientcfg = <a class="code" href="../../dc/d6b/res__xmpp_8c.html#a14d10033fb3b97f06238940259f45266">xmpp_config_find</a>(cfg-&gt;clients, client-&gt;<a class="code" href="../../df/d42/structast__xmpp__client.html#ace9168767fc3707cf5f0a7d049682ba3">name</a>))) {</div><div class="line"><a name="l03472"></a><span class="lineno"> 3472</span>&#160;      <span class="keywordflow">return</span> IKS_HOOK;</div><div class="line"><a name="l03473"></a><span class="lineno"> 3473</span>&#160;   }</div><div class="line"><a name="l03474"></a><span class="lineno"> 3474</span>&#160;</div><div class="line"><a name="l03475"></a><span class="lineno"> 3475</span>&#160;   <span class="comment">/* If the client is disconnecting ignore everything */</span></div><div class="line"><a name="l03476"></a><span class="lineno"> 3476</span>&#160;   <span class="keywordflow">if</span> (client-&gt;<a class="code" href="../../df/d42/structast__xmpp__client.html#a0e1ad9bdec3a82e1fec4aed829cfa2a6">state</a> == <a class="code" href="../../da/da0/xmpp_8h.html#ae37d560c438576bdcb47347088225ee6ac443c6d96cc4879bf26ca95710628aad">XMPP_STATE_DISCONNECTING</a>) {</div><div class="line"><a name="l03477"></a><span class="lineno"> 3477</span>&#160;      <span class="keywordflow">return</span> IKS_HOOK;</div><div class="line"><a name="l03478"></a><span class="lineno"> 3478</span>&#160;   }</div><div class="line"><a name="l03479"></a><span class="lineno"> 3479</span>&#160;</div><div class="line"><a name="l03480"></a><span class="lineno"> 3480</span>&#160;   pak = iks_packet(node);</div><div class="line"><a name="l03481"></a><span class="lineno"> 3481</span>&#160;</div><div class="line"><a name="l03482"></a><span class="lineno"> 3482</span>&#160;   <span class="comment">/* work around iksemel&#39;s impossibility to recognize node names</span></div><div class="line"><a name="l03483"></a><span class="lineno"> 3483</span>&#160;<span class="comment">    * containing a colon. Set the namespace of the corresponding</span></div><div class="line"><a name="l03484"></a><span class="lineno"> 3484</span>&#160;<span class="comment">    * node accordingly. */</span></div><div class="line"><a name="l03485"></a><span class="lineno"> 3485</span>&#160;   <span class="keywordflow">if</span> (iks_has_children(node) &amp;&amp; strchr(iks_name(iks_child(node)), <span class="charliteral">&#39;:&#39;</span>)) {</div><div class="line"><a name="l03486"></a><span class="lineno"> 3486</span>&#160;      <span class="keywordtype">char</span> *node_ns = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l03487"></a><span class="lineno"> 3487</span>&#160;      <span class="keywordtype">char</span> attr[<a class="code" href="../../da/da0/xmpp_8h.html#ac2b3164e8b2827daa8c2ae41c254fdbf">XMPP_MAX_ATTRLEN</a>];</div><div class="line"><a name="l03488"></a><span class="lineno"> 3488</span>&#160;      <span class="keywordtype">char</span> *node_name = iks_name(iks_child(node));</div><div class="line"><a name="l03489"></a><span class="lineno"> 3489</span>&#160;      <span class="keywordtype">char</span> *aux = strchr(node_name, <span class="charliteral">&#39;:&#39;</span>) + 1;</div><div class="line"><a name="l03490"></a><span class="lineno"> 3490</span>&#160;      snprintf(attr, strlen(<span class="stringliteral">&quot;xmlns:&quot;</span>) + (strlen(node_name) - strlen(aux)), <span class="stringliteral">&quot;xmlns:%s&quot;</span>, node_name);</div><div class="line"><a name="l03491"></a><span class="lineno"> 3491</span>&#160;      node_ns = iks_find_attrib(iks_child(node), attr);</div><div class="line"><a name="l03492"></a><span class="lineno"> 3492</span>&#160;      <span class="keywordflow">if</span> (node_ns) {</div><div class="line"><a name="l03493"></a><span class="lineno"> 3493</span>&#160;         pak-&gt;ns = node_ns;</div><div class="line"><a name="l03494"></a><span class="lineno"> 3494</span>&#160;         pak-&gt;query = iks_child(node);</div><div class="line"><a name="l03495"></a><span class="lineno"> 3495</span>&#160;      }</div><div class="line"><a name="l03496"></a><span class="lineno"> 3496</span>&#160;   }</div><div class="line"><a name="l03497"></a><span class="lineno"> 3497</span>&#160;</div><div class="line"><a name="l03498"></a><span class="lineno"> 3498</span>&#160;   <span class="comment">/* Process through any state handlers */</span></div><div class="line"><a name="l03499"></a><span class="lineno"> 3499</span>&#160;   <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="../../de/dfe/isdn__lib_8c.html#ab9129b977a587b50ea801daac75e178f">ARRAY_LEN</a>(<a class="code" href="../../dc/d6b/res__xmpp_8c.html#a15a090fb684bb844a1808b5531dedfac">xmpp_state_handlers</a>); i++) {</div><div class="line"><a name="l03500"></a><span class="lineno"> 3500</span>&#160;      <span class="keywordflow">if</span> ((<a class="code" href="../../dc/d6b/res__xmpp_8c.html#a15a090fb684bb844a1808b5531dedfac">xmpp_state_handlers</a>[i].<a class="code" href="../../d4/d88/structstate.html">state</a> == client-&gt;<a class="code" href="../../df/d42/structast__xmpp__client.html#a0e1ad9bdec3a82e1fec4aed829cfa2a6">state</a>) &amp;&amp; (<a class="code" href="../../dc/d6b/res__xmpp_8c.html#a15a090fb684bb844a1808b5531dedfac">xmpp_state_handlers</a>[i].<a class="code" href="../../dc/d18/structxmpp__state__handler.html#a3c56304946202b57877d2c12f3ad491a">component</a> == (<a class="code" href="../../d5/d60/utils_8h.html#a00d4c9254c9827d6fa44f17a326744a5">ast_test_flag</a>(&amp;clientcfg-&gt;flags, <a class="code" href="../../dc/d6b/res__xmpp_8c.html#aa3759d2ddcc12f3f5ef5a8a3ffa4a4dfadc3efad94dcc216c29d42b23edcb2d00">XMPP_COMPONENT</a>) ? 1 : 0))) {</div><div class="line"><a name="l03501"></a><span class="lineno"> 3501</span>&#160;         <span class="keywordflow">if</span> (<a class="code" href="../../dc/d6b/res__xmpp_8c.html#a15a090fb684bb844a1808b5531dedfac">xmpp_state_handlers</a>[i].<a class="code" href="../../da/d03/test__ari_8c.html#a695cc202c7a2869aa8202bb20726ea3c">handler</a>(client, clientcfg, type, node)) {</div><div class="line"><a name="l03502"></a><span class="lineno"> 3502</span>&#160;            <span class="comment">/* If the handler wants us to stop now, do so */</span></div><div class="line"><a name="l03503"></a><span class="lineno"> 3503</span>&#160;            <span class="keywordflow">return</span> IKS_HOOK;</div><div class="line"><a name="l03504"></a><span class="lineno"> 3504</span>&#160;         }</div><div class="line"><a name="l03505"></a><span class="lineno"> 3505</span>&#160;         <span class="keywordflow">break</span>;</div><div class="line"><a name="l03506"></a><span class="lineno"> 3506</span>&#160;      }</div><div class="line"><a name="l03507"></a><span class="lineno"> 3507</span>&#160;   }</div><div class="line"><a name="l03508"></a><span class="lineno"> 3508</span>&#160;</div><div class="line"><a name="l03509"></a><span class="lineno"> 3509</span>&#160;   <span class="comment">/* Process through any PAK handlers */</span></div><div class="line"><a name="l03510"></a><span class="lineno"> 3510</span>&#160;   <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="../../de/dfe/isdn__lib_8c.html#ab9129b977a587b50ea801daac75e178f">ARRAY_LEN</a>(<a class="code" href="../../dc/d6b/res__xmpp_8c.html#ae417655500bd50e80fc52f68c18accc9">xmpp_pak_handlers</a>); i++) {</div><div class="line"><a name="l03511"></a><span class="lineno"> 3511</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="../../dc/d6b/res__xmpp_8c.html#ae417655500bd50e80fc52f68c18accc9">xmpp_pak_handlers</a>[i].type == pak-&gt;<a class="code" href="../../d9/da1/structxmpp__pak__handler.html#ac765329451135abec74c45e1897abf26">type</a>) {</div><div class="line"><a name="l03512"></a><span class="lineno"> 3512</span>&#160;         <span class="keywordflow">if</span> (<a class="code" href="../../dc/d6b/res__xmpp_8c.html#ae417655500bd50e80fc52f68c18accc9">xmpp_pak_handlers</a>[i].<a class="code" href="../../da/d03/test__ari_8c.html#a695cc202c7a2869aa8202bb20726ea3c">handler</a>(client, clientcfg, node, pak)) {</div><div class="line"><a name="l03513"></a><span class="lineno"> 3513</span>&#160;            <span class="comment">/* If the handler wants us to stop now, do so */</span></div><div class="line"><a name="l03514"></a><span class="lineno"> 3514</span>&#160;            <span class="keywordflow">return</span> IKS_HOOK;</div><div class="line"><a name="l03515"></a><span class="lineno"> 3515</span>&#160;         }</div><div class="line"><a name="l03516"></a><span class="lineno"> 3516</span>&#160;         <span class="keywordflow">break</span>;</div><div class="line"><a name="l03517"></a><span class="lineno"> 3517</span>&#160;      }</div><div class="line"><a name="l03518"></a><span class="lineno"> 3518</span>&#160;   }</div><div class="line"><a name="l03519"></a><span class="lineno"> 3519</span>&#160;</div><div class="line"><a name="l03520"></a><span class="lineno"> 3520</span>&#160;   <span class="comment">/* Send the packet through the filter in case any filters want to process it */</span></div><div class="line"><a name="l03521"></a><span class="lineno"> 3521</span>&#160;   iks_filter_packet(client-&gt;<a class="code" href="../../df/d42/structast__xmpp__client.html#a242fce88f9c9954695b13f7af1d415a9">filter</a>, pak);</div><div class="line"><a name="l03522"></a><span class="lineno"> 3522</span>&#160;</div><div class="line"><a name="l03523"></a><span class="lineno"> 3523</span>&#160;   iks_delete(node);</div><div class="line"><a name="l03524"></a><span class="lineno"> 3524</span>&#160;</div><div class="line"><a name="l03525"></a><span class="lineno"> 3525</span>&#160;   <span class="keywordflow">return</span> IKS_OK;</div><div class="line"><a name="l03526"></a><span class="lineno"> 3526</span>&#160;}</div><div class="line"><a name="l03527"></a><span class="lineno"> 3527</span>&#160;</div><div class="line"><a name="l03528"></a><span class="lineno"><a class="line" href="../../dc/d6b/res__xmpp_8c.html#abd1cce3d4d067a7306e5e17dee2876dd"> 3528</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="../../dc/d6b/res__xmpp_8c.html#abd1cce3d4d067a7306e5e17dee2876dd">ast_xmpp_client_disconnect</a>(<span class="keyword">struct</span> <a class="code" href="../../df/d42/structast__xmpp__client.html">ast_xmpp_client</a> *client)</div><div class="line"><a name="l03529"></a><span class="lineno"> 3529</span>&#160;{</div><div class="line"><a name="l03530"></a><span class="lineno"> 3530</span>&#160;   <span class="keywordflow">if</span> ((client-&gt;<a class="code" href="../../df/d42/structast__xmpp__client.html#a01f75a9ad916f63a94e06a27635ba278">thread</a> != <a class="code" href="../../dd/d42/lock_8h.html#a6009440c7a72f8e2e3b1ec97641ad160">AST_PTHREADT_NULL</a>) &amp;&amp; !pthread_equal(pthread_self(), client-&gt;<a class="code" href="../../df/d42/structast__xmpp__client.html#a01f75a9ad916f63a94e06a27635ba278">thread</a>)) {</div><div class="line"><a name="l03531"></a><span class="lineno"> 3531</span>&#160;      <a class="code" href="../../dc/d6b/res__xmpp_8c.html#ac515389ec6c63a8b3bbd094ede0d7c4d">xmpp_client_change_state</a>(client, <a class="code" href="../../da/da0/xmpp_8h.html#ae37d560c438576bdcb47347088225ee6ac443c6d96cc4879bf26ca95710628aad">XMPP_STATE_DISCONNECTING</a>);</div><div class="line"><a name="l03532"></a><span class="lineno"> 3532</span>&#160;      pthread_cancel(client-&gt;<a class="code" href="../../df/d42/structast__xmpp__client.html#a01f75a9ad916f63a94e06a27635ba278">thread</a>);</div><div class="line"><a name="l03533"></a><span class="lineno"> 3533</span>&#160;      pthread_join(client-&gt;<a class="code" href="../../df/d42/structast__xmpp__client.html#a01f75a9ad916f63a94e06a27635ba278">thread</a>, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div><div class="line"><a name="l03534"></a><span class="lineno"> 3534</span>&#160;      client-&gt;<a class="code" href="../../df/d42/structast__xmpp__client.html#a01f75a9ad916f63a94e06a27635ba278">thread</a> = <a class="code" href="../../dd/d42/lock_8h.html#a6009440c7a72f8e2e3b1ec97641ad160">AST_PTHREADT_NULL</a>;</div><div class="line"><a name="l03535"></a><span class="lineno"> 3535</span>&#160;   }</div><div class="line"><a name="l03536"></a><span class="lineno"> 3536</span>&#160;</div><div class="line"><a name="l03537"></a><span class="lineno"> 3537</span>&#160;   <span class="keywordflow">if</span> (client-&gt;<a class="code" href="../../df/d42/structast__xmpp__client.html#a422af54ca3d288f34246a66114879f27">mwi_sub</a>) {</div><div class="line"><a name="l03538"></a><span class="lineno"> 3538</span>&#160;      client-&gt;<a class="code" href="../../df/d42/structast__xmpp__client.html#a422af54ca3d288f34246a66114879f27">mwi_sub</a> = <a class="code" href="../../dd/d79/stasis_8h.html#a221d05010106dcde0cc2e2b43c1a8b67">stasis_unsubscribe_and_join</a>(client-&gt;<a class="code" href="../../df/d42/structast__xmpp__client.html#a422af54ca3d288f34246a66114879f27">mwi_sub</a>);</div><div class="line"><a name="l03539"></a><span class="lineno"> 3539</span>&#160;      <a class="code" href="../../dc/d6b/res__xmpp_8c.html#a6884e3f2670be5350b11f3f6c98f5f91">xmpp_pubsub_unsubscribe</a>(client, <span class="stringliteral">&quot;message_waiting&quot;</span>);</div><div class="line"><a name="l03540"></a><span class="lineno"> 3540</span>&#160;   }</div><div class="line"><a name="l03541"></a><span class="lineno"> 3541</span>&#160;</div><div class="line"><a name="l03542"></a><span class="lineno"> 3542</span>&#160;   <span class="keywordflow">if</span> (client-&gt;<a class="code" href="../../df/d42/structast__xmpp__client.html#ace475b3c63f137d8ff9af0e10d4f5e97">device_state_sub</a>) {</div><div class="line"><a name="l03543"></a><span class="lineno"> 3543</span>&#160;      client-&gt;<a class="code" href="../../df/d42/structast__xmpp__client.html#ace475b3c63f137d8ff9af0e10d4f5e97">device_state_sub</a> = <a class="code" href="../../dd/d79/stasis_8h.html#a221d05010106dcde0cc2e2b43c1a8b67">stasis_unsubscribe_and_join</a>(client-&gt;<a class="code" href="../../df/d42/structast__xmpp__client.html#ace475b3c63f137d8ff9af0e10d4f5e97">device_state_sub</a>);</div><div class="line"><a name="l03544"></a><span class="lineno"> 3544</span>&#160;      <a class="code" href="../../dc/d6b/res__xmpp_8c.html#a6884e3f2670be5350b11f3f6c98f5f91">xmpp_pubsub_unsubscribe</a>(client, <span class="stringliteral">&quot;device_state&quot;</span>);</div><div class="line"><a name="l03545"></a><span class="lineno"> 3545</span>&#160;   }</div><div class="line"><a name="l03546"></a><span class="lineno"> 3546</span>&#160;</div><div class="line"><a name="l03547"></a><span class="lineno"> 3547</span>&#160;<span class="preprocessor">#ifdef HAVE_OPENSSL</span></div><div class="line"><a name="l03548"></a><span class="lineno"> 3548</span>&#160;   <span class="keywordflow">if</span> (client-&gt;<a class="code" href="../../df/d42/structast__xmpp__client.html#aa663ff5d560561c647a50b58adce4e7a">stream_flags</a> &amp; SECURE) {</div><div class="line"><a name="l03549"></a><span class="lineno"> 3549</span>&#160;      SSL_shutdown(client-&gt;<a class="code" href="../../df/d42/structast__xmpp__client.html#a28e9fca20ae2d65b0b00c4c4b16ee59b">ssl_session</a>);</div><div class="line"><a name="l03550"></a><span class="lineno"> 3550</span>&#160;      SSL_CTX_free(client-&gt;<a class="code" href="../../df/d42/structast__xmpp__client.html#a8c5d83fcb87f22326009954a4652d92e">ssl_context</a>);</div><div class="line"><a name="l03551"></a><span class="lineno"> 3551</span>&#160;      SSL_free(client-&gt;<a class="code" href="../../df/d42/structast__xmpp__client.html#a28e9fca20ae2d65b0b00c4c4b16ee59b">ssl_session</a>);</div><div class="line"><a name="l03552"></a><span class="lineno"> 3552</span>&#160;   }</div><div class="line"><a name="l03553"></a><span class="lineno"> 3553</span>&#160;</div><div class="line"><a name="l03554"></a><span class="lineno"> 3554</span>&#160;   client-&gt;<a class="code" href="../../df/d42/structast__xmpp__client.html#aa663ff5d560561c647a50b58adce4e7a">stream_flags</a> = 0;</div><div class="line"><a name="l03555"></a><span class="lineno"> 3555</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l03556"></a><span class="lineno"> 3556</span>&#160;</div><div class="line"><a name="l03557"></a><span class="lineno"> 3557</span>&#160;   <span class="keywordflow">if</span> (client-&gt;<a class="code" href="../../df/d42/structast__xmpp__client.html#a84da25e2e78fab08d8077368bdbef1c6">parser</a>) {</div><div class="line"><a name="l03558"></a><span class="lineno"> 3558</span>&#160;      iks_disconnect(client-&gt;<a class="code" href="../../df/d42/structast__xmpp__client.html#a84da25e2e78fab08d8077368bdbef1c6">parser</a>);</div><div class="line"><a name="l03559"></a><span class="lineno"> 3559</span>&#160;   }</div><div class="line"><a name="l03560"></a><span class="lineno"> 3560</span>&#160;</div><div class="line"><a name="l03561"></a><span class="lineno"> 3561</span>&#160;   <a class="code" href="../../dc/d6b/res__xmpp_8c.html#ac515389ec6c63a8b3bbd094ede0d7c4d">xmpp_client_change_state</a>(client, <a class="code" href="../../da/da0/xmpp_8h.html#ae37d560c438576bdcb47347088225ee6a83544d57990f3fc1311d173a44928042">XMPP_STATE_DISCONNECTED</a>);</div><div class="line"><a name="l03562"></a><span class="lineno"> 3562</span>&#160;</div><div class="line"><a name="l03563"></a><span class="lineno"> 3563</span>&#160;   <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l03564"></a><span class="lineno"> 3564</span>&#160;}</div><div class="line"><a name="l03565"></a><span class="lineno"> 3565</span>&#160;<span class="comment"></span></div><div class="line"><a name="l03566"></a><span class="lineno"> 3566</span>&#160;<span class="comment">/*! \brief Internal function used to reconnect an XMPP client to its server */</span></div><div class="line"><a name="l03567"></a><span class="lineno"><a class="line" href="../../dc/d6b/res__xmpp_8c.html#a2c4cc886bbbb4ecd8487b33634e68c5b"> 3567</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../dc/d6b/res__xmpp_8c.html#a2c4cc886bbbb4ecd8487b33634e68c5b">xmpp_client_reconnect</a>(<span class="keyword">struct</span> <a class="code" href="../../df/d42/structast__xmpp__client.html">ast_xmpp_client</a> *client)</div><div class="line"><a name="l03568"></a><span class="lineno"> 3568</span>&#160;{</div><div class="line"><a name="l03569"></a><span class="lineno"> 3569</span>&#160;   <span class="keyword">struct </span>timeval tv = { .tv_sec = 5, .tv_usec = 0 };</div><div class="line"><a name="l03570"></a><span class="lineno"> 3570</span>&#160;   <a class="code" href="../../d5/d60/utils_8h.html#a1604b4d72144dd3d9f7da668e90337e9">RAII_VAR</a>(<span class="keyword">struct</span> <a class="code" href="../../de/d1c/structxmpp__config.html">xmpp_config</a> *, cfg, <a class="code" href="../../d5/da5/astobj2_8h.html#a86d8d6c3c8866ed0a60121da055cd225">ao2_global_obj_ref</a>(<a class="code" href="../../d3/d4e/chan__console_8c.html#aa36e3e2c486b920b166c2d17c5242221">globals</a>), <a class="code" href="../../d5/da5/astobj2_8h.html#a6321ee982370c55ab3c24c72c562cbdd">ao2_cleanup</a>);</div><div class="line"><a name="l03571"></a><span class="lineno"> 3571</span>&#160;   <a class="code" href="../../d5/d60/utils_8h.html#a1604b4d72144dd3d9f7da668e90337e9">RAII_VAR</a>(<span class="keyword">struct</span> <a class="code" href="../../da/d00/structast__xmpp__client__config.html">ast_xmpp_client_config</a> *, clientcfg, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../d5/da5/astobj2_8h.html#a6321ee982370c55ab3c24c72c562cbdd">ao2_cleanup</a>);</div><div class="line"><a name="l03572"></a><span class="lineno"> 3572</span>&#160;   <span class="keywordtype">int</span> res = IKS_NET_NOCONN;</div><div class="line"><a name="l03573"></a><span class="lineno"> 3573</span>&#160;</div><div class="line"><a name="l03574"></a><span class="lineno"> 3574</span>&#160;   <span class="keywordflow">if</span> (!cfg || !cfg-&gt;clients || !(clientcfg = <a class="code" href="../../dc/d6b/res__xmpp_8c.html#a14d10033fb3b97f06238940259f45266">xmpp_config_find</a>(cfg-&gt;clients, client-&gt;<a class="code" href="../../df/d42/structast__xmpp__client.html#ace9168767fc3707cf5f0a7d049682ba3">name</a>))) {</div><div class="line"><a name="l03575"></a><span class="lineno"> 3575</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l03576"></a><span class="lineno"> 3576</span>&#160;   }</div><div class="line"><a name="l03577"></a><span class="lineno"> 3577</span>&#160;</div><div class="line"><a name="l03578"></a><span class="lineno"> 3578</span>&#160;   <a class="code" href="../../dc/d6b/res__xmpp_8c.html#abd1cce3d4d067a7306e5e17dee2876dd">ast_xmpp_client_disconnect</a>(client);</div><div class="line"><a name="l03579"></a><span class="lineno"> 3579</span>&#160;</div><div class="line"><a name="l03580"></a><span class="lineno"> 3580</span>&#160;   client-&gt;<a class="code" href="../../df/d42/structast__xmpp__client.html#a493b57f443cc38b3d3df9c1e584d9d82">timeout</a> = 50;</div><div class="line"><a name="l03581"></a><span class="lineno"> 3581</span>&#160;   iks_parser_reset(client-&gt;<a class="code" href="../../df/d42/structast__xmpp__client.html#a84da25e2e78fab08d8077368bdbef1c6">parser</a>);</div><div class="line"><a name="l03582"></a><span class="lineno"> 3582</span>&#160;</div><div class="line"><a name="l03583"></a><span class="lineno"> 3583</span>&#160;   <span class="keywordflow">if</span> (!client-&gt;<a class="code" href="../../df/d42/structast__xmpp__client.html#a242fce88f9c9954695b13f7af1d415a9">filter</a> &amp;&amp; !(client-&gt;<a class="code" href="../../df/d42/structast__xmpp__client.html#a242fce88f9c9954695b13f7af1d415a9">filter</a> = iks_filter_new())) {</div><div class="line"><a name="l03584"></a><span class="lineno"> 3584</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Could not create IKS filter for client connection &#39;%s&#39;\n&quot;</span>, client-&gt;<a class="code" href="../../df/d42/structast__xmpp__client.html#ace9168767fc3707cf5f0a7d049682ba3">name</a>);</div><div class="line"><a name="l03585"></a><span class="lineno"> 3585</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l03586"></a><span class="lineno"> 3586</span>&#160;   }</div><div class="line"><a name="l03587"></a><span class="lineno"> 3587</span>&#160;</div><div class="line"><a name="l03588"></a><span class="lineno"> 3588</span>&#160;   <span class="keywordflow">if</span> (!<a class="code" href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a>(clientcfg-&gt;refresh_token)) {</div><div class="line"><a name="l03589"></a><span class="lineno"> 3589</span>&#160;      <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(2, <span class="stringliteral">&quot;Obtaining OAuth access token for client &#39;%s&#39;\n&quot;</span>, client-&gt;<a class="code" href="../../df/d42/structast__xmpp__client.html#ace9168767fc3707cf5f0a7d049682ba3">name</a>);</div><div class="line"><a name="l03590"></a><span class="lineno"> 3590</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="../../dc/d6b/res__xmpp_8c.html#a651fdf11709558c6200662ad0e18fb28">fetch_access_token</a>(clientcfg)) {</div><div class="line"><a name="l03591"></a><span class="lineno"> 3591</span>&#160;         <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l03592"></a><span class="lineno"> 3592</span>&#160;      }</div><div class="line"><a name="l03593"></a><span class="lineno"> 3593</span>&#160;   }</div><div class="line"><a name="l03594"></a><span class="lineno"> 3594</span>&#160;</div><div class="line"><a name="l03595"></a><span class="lineno"> 3595</span>&#160;   <span class="comment">/* If it&#39;s a component connect to user otherwise connect to server */</span></div><div class="line"><a name="l03596"></a><span class="lineno"> 3596</span>&#160;   res = iks_connect_via(client-&gt;<a class="code" href="../../df/d42/structast__xmpp__client.html#a84da25e2e78fab08d8077368bdbef1c6">parser</a>, <a class="code" href="../../d6/d90/strings_8h.html#a2faaa16929951bfd2802b7829a100ba2">S_OR</a>(clientcfg-&gt;server, client-&gt;<a class="code" href="../../df/d42/structast__xmpp__client.html#af738439b96e613a471505eb1222ac406">jid</a>-&gt;server), clientcfg-&gt;port,</div><div class="line"><a name="l03597"></a><span class="lineno"> 3597</span>&#160;               <a class="code" href="../../d5/d60/utils_8h.html#a00d4c9254c9827d6fa44f17a326744a5">ast_test_flag</a>(&amp;clientcfg-&gt;flags, <a class="code" href="../../dc/d6b/res__xmpp_8c.html#aa3759d2ddcc12f3f5ef5a8a3ffa4a4dfadc3efad94dcc216c29d42b23edcb2d00">XMPP_COMPONENT</a>) ? clientcfg-&gt;user : client-&gt;<a class="code" href="../../df/d42/structast__xmpp__client.html#af738439b96e613a471505eb1222ac406">jid</a>-&gt;server);</div><div class="line"><a name="l03598"></a><span class="lineno"> 3598</span>&#160;</div><div class="line"><a name="l03599"></a><span class="lineno"> 3599</span>&#160;   <span class="comment">/* Set socket timeout options */</span></div><div class="line"><a name="l03600"></a><span class="lineno"> 3600</span>&#160;   setsockopt(iks_fd(client-&gt;<a class="code" href="../../df/d42/structast__xmpp__client.html#a84da25e2e78fab08d8077368bdbef1c6">parser</a>), SOL_SOCKET, SO_RCVTIMEO, (<span class="keywordtype">char</span> *)&amp;tv,<span class="keyword">sizeof</span>(<span class="keyword">struct</span> timeval));</div><div class="line"><a name="l03601"></a><span class="lineno"> 3601</span>&#160;</div><div class="line"><a name="l03602"></a><span class="lineno"> 3602</span>&#160;   <span class="keywordflow">if</span> (res == IKS_NET_NOCONN) {</div><div class="line"><a name="l03603"></a><span class="lineno"> 3603</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;No XMPP connection available when trying to connect client &#39;%s&#39;\n&quot;</span>, client-&gt;<a class="code" href="../../df/d42/structast__xmpp__client.html#ace9168767fc3707cf5f0a7d049682ba3">name</a>);</div><div class="line"><a name="l03604"></a><span class="lineno"> 3604</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l03605"></a><span class="lineno"> 3605</span>&#160;   } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (res == IKS_NET_NODNS) {</div><div class="line"><a name="l03606"></a><span class="lineno"> 3606</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;No DNS available for XMPP connection when trying to connect client &#39;%s&#39;\n&quot;</span>, client-&gt;<a class="code" href="../../df/d42/structast__xmpp__client.html#ace9168767fc3707cf5f0a7d049682ba3">name</a>);</div><div class="line"><a name="l03607"></a><span class="lineno"> 3607</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l03608"></a><span class="lineno"> 3608</span>&#160;   }</div><div class="line"><a name="l03609"></a><span class="lineno"> 3609</span>&#160;</div><div class="line"><a name="l03610"></a><span class="lineno"> 3610</span>&#160;   <span class="comment">/* Depending on the configuration of the client we eiher jump to requesting TLS, or authenticating */</span></div><div class="line"><a name="l03611"></a><span class="lineno"> 3611</span>&#160;   <a class="code" href="../../dc/d6b/res__xmpp_8c.html#ac515389ec6c63a8b3bbd094ede0d7c4d">xmpp_client_change_state</a>(client, (<a class="code" href="../../d5/d60/utils_8h.html#a00d4c9254c9827d6fa44f17a326744a5">ast_test_flag</a>(&amp;clientcfg-&gt;flags, <a class="code" href="../../dc/d6b/res__xmpp_8c.html#aa3759d2ddcc12f3f5ef5a8a3ffa4a4dfa2ee5bcbb4cbb964175aaddb7bf70c0cb">XMPP_USETLS</a>) ? <a class="code" href="../../da/da0/xmpp_8h.html#ae37d560c438576bdcb47347088225ee6a9ae50cb46cd7faba7bdde6259d1e7e11">XMPP_STATE_REQUEST_TLS</a> : <a class="code" href="../../da/da0/xmpp_8h.html#ae37d560c438576bdcb47347088225ee6a1f316843c055717ccde5ccb266e1eee6">XMPP_STATE_AUTHENTICATE</a>));</div><div class="line"><a name="l03612"></a><span class="lineno"> 3612</span>&#160;</div><div class="line"><a name="l03613"></a><span class="lineno"> 3613</span>&#160;   <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l03614"></a><span class="lineno"> 3614</span>&#160;}</div><div class="line"><a name="l03615"></a><span class="lineno"> 3615</span>&#160;<span class="comment"></span></div><div class="line"><a name="l03616"></a><span class="lineno"> 3616</span>&#160;<span class="comment">/*! \brief Internal function which polls on an XMPP client and receives data */</span></div><div class="line"><a name="l03617"></a><span class="lineno"><a class="line" href="../../dc/d6b/res__xmpp_8c.html#abb887526b9c7f8318531cdf9ad043717"> 3617</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../dc/d6b/res__xmpp_8c.html#abb887526b9c7f8318531cdf9ad043717">xmpp_io_recv</a>(<span class="keyword">struct</span> <a class="code" href="../../df/d42/structast__xmpp__client.html">ast_xmpp_client</a> *client, <span class="keywordtype">char</span> *buffer, <span class="keywordtype">size_t</span> buf_len, <span class="keywordtype">int</span> <a class="code" href="../../d0/d29/cdr__mysql_8c.html#a493b57f443cc38b3d3df9c1e584d9d82">timeout</a>)</div><div class="line"><a name="l03618"></a><span class="lineno"> 3618</span>&#160;{</div><div class="line"><a name="l03619"></a><span class="lineno"> 3619</span>&#160;   <span class="keyword">struct </span>pollfd pfd = { .events = POLLIN };</div><div class="line"><a name="l03620"></a><span class="lineno"> 3620</span>&#160;   <span class="keywordtype">int</span> <a class="code" href="../../d9/d1e/func__strings_8c.html#af24e73aaf92f3000fda15d285e66df24">len</a>, res;</div><div class="line"><a name="l03621"></a><span class="lineno"> 3621</span>&#160;</div><div class="line"><a name="l03622"></a><span class="lineno"> 3622</span>&#160;<span class="preprocessor">#ifdef HAVE_OPENSSL</span></div><div class="line"><a name="l03623"></a><span class="lineno"> 3623</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../dc/d6b/res__xmpp_8c.html#ae13d4153b0221e790967206a41a9e253">xmpp_is_secure</a>(client)) {</div><div class="line"><a name="l03624"></a><span class="lineno"> 3624</span>&#160;      pfd.fd = SSL_get_fd(client-&gt;<a class="code" href="../../df/d42/structast__xmpp__client.html#a28e9fca20ae2d65b0b00c4c4b16ee59b">ssl_session</a>);</div><div class="line"><a name="l03625"></a><span class="lineno"> 3625</span>&#160;      <span class="keywordflow">if</span> (pfd.fd &lt; 0) {</div><div class="line"><a name="l03626"></a><span class="lineno"> 3626</span>&#160;         <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l03627"></a><span class="lineno"> 3627</span>&#160;      }</div><div class="line"><a name="l03628"></a><span class="lineno"> 3628</span>&#160;   } <span class="keywordflow">else</span></div><div class="line"><a name="l03629"></a><span class="lineno"> 3629</span>&#160;<span class="preprocessor">#endif </span><span class="comment">/* HAVE_OPENSSL */</span><span class="preprocessor"></span></div><div class="line"><a name="l03630"></a><span class="lineno"> 3630</span>&#160;      pfd.fd = iks_fd(client-&gt;<a class="code" href="../../df/d42/structast__xmpp__client.html#a84da25e2e78fab08d8077368bdbef1c6">parser</a>);</div><div class="line"><a name="l03631"></a><span class="lineno"> 3631</span>&#160;</div><div class="line"><a name="l03632"></a><span class="lineno"> 3632</span>&#160;   res = <a class="code" href="../../d4/dfb/poll-compat_8h.html#a5a0c58fa8311e94cd0ed34382aa822f9">ast_poll</a>(&amp;pfd, 1, timeout &gt; 0 ? timeout * 1000 : -1);</div><div class="line"><a name="l03633"></a><span class="lineno"> 3633</span>&#160;   <span class="keywordflow">if</span> (res &gt; 0) {</div><div class="line"><a name="l03634"></a><span class="lineno"> 3634</span>&#160;<span class="preprocessor">#ifdef HAVE_OPENSSL</span></div><div class="line"><a name="l03635"></a><span class="lineno"> 3635</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="../../dc/d6b/res__xmpp_8c.html#ae13d4153b0221e790967206a41a9e253">xmpp_is_secure</a>(client)) {</div><div class="line"><a name="l03636"></a><span class="lineno"> 3636</span>&#160;         len = SSL_read(client-&gt;<a class="code" href="../../df/d42/structast__xmpp__client.html#a28e9fca20ae2d65b0b00c4c4b16ee59b">ssl_session</a>, buffer, buf_len);</div><div class="line"><a name="l03637"></a><span class="lineno"> 3637</span>&#160;      } <span class="keywordflow">else</span></div><div class="line"><a name="l03638"></a><span class="lineno"> 3638</span>&#160;<span class="preprocessor">#endif </span><span class="comment">/* HAVE_OPENSSL */</span><span class="preprocessor"></span></div><div class="line"><a name="l03639"></a><span class="lineno"> 3639</span>&#160;         len = recv(pfd.fd, buffer, buf_len, 0);</div><div class="line"><a name="l03640"></a><span class="lineno"> 3640</span>&#160;</div><div class="line"><a name="l03641"></a><span class="lineno"> 3641</span>&#160;      <span class="keywordflow">if</span> (len &gt; 0) {</div><div class="line"><a name="l03642"></a><span class="lineno"> 3642</span>&#160;         <span class="keywordflow">return</span> <a class="code" href="../../d9/d1e/func__strings_8c.html#af24e73aaf92f3000fda15d285e66df24">len</a>;</div><div class="line"><a name="l03643"></a><span class="lineno"> 3643</span>&#160;      } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (len &lt;= 0) {</div><div class="line"><a name="l03644"></a><span class="lineno"> 3644</span>&#160;         <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l03645"></a><span class="lineno"> 3645</span>&#160;      }</div><div class="line"><a name="l03646"></a><span class="lineno"> 3646</span>&#160;   }</div><div class="line"><a name="l03647"></a><span class="lineno"> 3647</span>&#160;   <span class="keywordflow">return</span> res;</div><div class="line"><a name="l03648"></a><span class="lineno"> 3648</span>&#160;}</div><div class="line"><a name="l03649"></a><span class="lineno"> 3649</span>&#160;<span class="comment"></span></div><div class="line"><a name="l03650"></a><span class="lineno"> 3650</span>&#160;<span class="comment">/*! \brief Internal function which receives data from the XMPP client connection */</span></div><div class="line"><a name="l03651"></a><span class="lineno"><a class="line" href="../../dc/d6b/res__xmpp_8c.html#ade776dcd1dbcfe2f28831298e7db444e"> 3651</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../dc/d6b/res__xmpp_8c.html#ade776dcd1dbcfe2f28831298e7db444e">xmpp_client_receive</a>(<span class="keyword">struct</span> <a class="code" href="../../df/d42/structast__xmpp__client.html">ast_xmpp_client</a> *client, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="../../d0/d29/cdr__mysql_8c.html#a493b57f443cc38b3d3df9c1e584d9d82">timeout</a>)</div><div class="line"><a name="l03652"></a><span class="lineno"> 3652</span>&#160;{</div><div class="line"><a name="l03653"></a><span class="lineno"> 3653</span>&#160;   <span class="keywordtype">int</span> <a class="code" href="../../d9/d1e/func__strings_8c.html#af24e73aaf92f3000fda15d285e66df24">len</a>, ret, pos = 0, newbufpos = 0;</div><div class="line"><a name="l03654"></a><span class="lineno"> 3654</span>&#160;   <span class="keywordtype">char</span> <a class="code" href="../../dd/d7c/eagi__proxy_8c.html#ac95651d79c608a3148973b5b1fc9e525">buf</a>[<a class="code" href="../../da/da0/xmpp_8h.html#a88194d0f499931c26ef4df0738f26ec1">NET_IO_BUF_SIZE</a> - 1] = <span class="stringliteral">&quot;&quot;</span>;</div><div class="line"><a name="l03655"></a><span class="lineno"> 3655</span>&#160;   <span class="keywordtype">char</span> <a class="code" href="../../d1/d7c/hash__buf_8c.html#aa2831bb926e4abf05aba216f708dfc4a">newbuf</a>[<a class="code" href="../../da/da0/xmpp_8h.html#a88194d0f499931c26ef4df0738f26ec1">NET_IO_BUF_SIZE</a> - 1] = <span class="stringliteral">&quot;&quot;</span>;</div><div class="line"><a name="l03656"></a><span class="lineno"> 3656</span>&#160;   <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> <a class="code" href="../../d7/d6f/test__linkedlists_8c.html#acd9db00336027462cfb25b97b5356883">c</a>;</div><div class="line"><a name="l03657"></a><span class="lineno"> 3657</span>&#160;</div><div class="line"><a name="l03658"></a><span class="lineno"> 3658</span>&#160;   <span class="keywordflow">while</span> (1) {</div><div class="line"><a name="l03659"></a><span class="lineno"> 3659</span>&#160;      len = <a class="code" href="../../dc/d6b/res__xmpp_8c.html#abb887526b9c7f8318531cdf9ad043717">xmpp_io_recv</a>(client, buf, <a class="code" href="../../da/da0/xmpp_8h.html#a88194d0f499931c26ef4df0738f26ec1">NET_IO_BUF_SIZE</a> - 2, timeout);</div><div class="line"><a name="l03660"></a><span class="lineno"> 3660</span>&#160;      <span class="keywordflow">if</span> (len &lt; 0) <span class="keywordflow">return</span> IKS_NET_RWERR;</div><div class="line"><a name="l03661"></a><span class="lineno"> 3661</span>&#160;      <span class="keywordflow">if</span> (len == 0) <span class="keywordflow">return</span> <a class="code" href="../../da/da0/xmpp_8h.html#a99fa4c2cecd405f4430c8d137af93db9">IKS_NET_EXPIRED</a>;</div><div class="line"><a name="l03662"></a><span class="lineno"> 3662</span>&#160;      buf[<a class="code" href="../../d9/d1e/func__strings_8c.html#af24e73aaf92f3000fda15d285e66df24">len</a>] = <span class="charliteral">&#39;\0&#39;</span>;</div><div class="line"><a name="l03663"></a><span class="lineno"> 3663</span>&#160;</div><div class="line"><a name="l03664"></a><span class="lineno"> 3664</span>&#160;      <span class="comment">/* our iksemel parser won&#39;t work as expected if we feed</span></div><div class="line"><a name="l03665"></a><span class="lineno"> 3665</span>&#160;<span class="comment">         it with XML packets that contain multiple whitespace</span></div><div class="line"><a name="l03666"></a><span class="lineno"> 3666</span>&#160;<span class="comment">         characters between tags */</span></div><div class="line"><a name="l03667"></a><span class="lineno"> 3667</span>&#160;      <span class="keywordflow">while</span> (pos &lt; len) {</div><div class="line"><a name="l03668"></a><span class="lineno"> 3668</span>&#160;         c = buf[pos];</div><div class="line"><a name="l03669"></a><span class="lineno"> 3669</span>&#160;         <span class="comment">/* if we stumble on the ending tag character,</span></div><div class="line"><a name="l03670"></a><span class="lineno"> 3670</span>&#160;<span class="comment">            we skip any whitespace that follows it*/</span></div><div class="line"><a name="l03671"></a><span class="lineno"> 3671</span>&#160;         <span class="keywordflow">if</span> (c == <span class="charliteral">&#39;&gt;&#39;</span>) {</div><div class="line"><a name="l03672"></a><span class="lineno"> 3672</span>&#160;            <span class="keywordflow">while</span> (isspace(buf[pos+1])) {</div><div class="line"><a name="l03673"></a><span class="lineno"> 3673</span>&#160;               pos++;</div><div class="line"><a name="l03674"></a><span class="lineno"> 3674</span>&#160;            }</div><div class="line"><a name="l03675"></a><span class="lineno"> 3675</span>&#160;         }</div><div class="line"><a name="l03676"></a><span class="lineno"> 3676</span>&#160;         newbuf[newbufpos] = <a class="code" href="../../d7/d6f/test__linkedlists_8c.html#acd9db00336027462cfb25b97b5356883">c</a>;</div><div class="line"><a name="l03677"></a><span class="lineno"> 3677</span>&#160;         newbufpos++;</div><div class="line"><a name="l03678"></a><span class="lineno"> 3678</span>&#160;         pos++;</div><div class="line"><a name="l03679"></a><span class="lineno"> 3679</span>&#160;      }</div><div class="line"><a name="l03680"></a><span class="lineno"> 3680</span>&#160;      pos = 0;</div><div class="line"><a name="l03681"></a><span class="lineno"> 3681</span>&#160;      newbufpos = 0;</div><div class="line"><a name="l03682"></a><span class="lineno"> 3682</span>&#160;</div><div class="line"><a name="l03683"></a><span class="lineno"> 3683</span>&#160;      <span class="comment">/* Log the message here, because iksemel&#39;s logHook is</span></div><div class="line"><a name="l03684"></a><span class="lineno"> 3684</span>&#160;<span class="comment">         unaccessible */</span></div><div class="line"><a name="l03685"></a><span class="lineno"> 3685</span>&#160;      <a class="code" href="../../dc/d6b/res__xmpp_8c.html#af02607d0a966e73d05d4934a806e79a6">xmpp_log_hook</a>(client, buf, len, 1);</div><div class="line"><a name="l03686"></a><span class="lineno"> 3686</span>&#160;</div><div class="line"><a name="l03687"></a><span class="lineno"> 3687</span>&#160;      <span class="keywordflow">if</span>(buf[0] == <span class="charliteral">&#39; &#39;</span>) {</div><div class="line"><a name="l03688"></a><span class="lineno"> 3688</span>&#160;         <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(1, <span class="stringliteral">&quot;JABBER: Detected Google Keep Alive. &quot;</span></div><div class="line"><a name="l03689"></a><span class="lineno"> 3689</span>&#160;            <span class="stringliteral">&quot;Sending out Ping request for client &#39;%s&#39;\n&quot;</span>, client-&gt;<a class="code" href="../../df/d42/structast__xmpp__client.html#ace9168767fc3707cf5f0a7d049682ba3">name</a>);</div><div class="line"><a name="l03690"></a><span class="lineno"> 3690</span>&#160;         <span class="comment">/* If we just send out the ping here then we will have socket</span></div><div class="line"><a name="l03691"></a><span class="lineno"> 3691</span>&#160;<span class="comment">          * read errors because the socket will timeout */</span></div><div class="line"><a name="l03692"></a><span class="lineno"> 3692</span>&#160;         <a class="code" href="../../dc/d6b/res__xmpp_8c.html#aa8cee821cbda619ece4c14df1d7ea43c">xmpp_ping_request</a>(client, client-&gt;<a class="code" href="../../df/d42/structast__xmpp__client.html#af738439b96e613a471505eb1222ac406">jid</a>-&gt;server, client-&gt;<a class="code" href="../../df/d42/structast__xmpp__client.html#af738439b96e613a471505eb1222ac406">jid</a>-&gt;full);</div><div class="line"><a name="l03693"></a><span class="lineno"> 3693</span>&#160;      }</div><div class="line"><a name="l03694"></a><span class="lineno"> 3694</span>&#160;</div><div class="line"><a name="l03695"></a><span class="lineno"> 3695</span>&#160;      <span class="comment">/* let iksemel deal with the string length,</span></div><div class="line"><a name="l03696"></a><span class="lineno"> 3696</span>&#160;<span class="comment">         and reset our buffer */</span></div><div class="line"><a name="l03697"></a><span class="lineno"> 3697</span>&#160;      ret = iks_parse(client-&gt;<a class="code" href="../../df/d42/structast__xmpp__client.html#a84da25e2e78fab08d8077368bdbef1c6">parser</a>, newbuf, 0, 0);</div><div class="line"><a name="l03698"></a><span class="lineno"> 3698</span>&#160;      memset(newbuf, 0, <span class="keyword">sizeof</span>(newbuf));</div><div class="line"><a name="l03699"></a><span class="lineno"> 3699</span>&#160;</div><div class="line"><a name="l03700"></a><span class="lineno"> 3700</span>&#160;      <span class="keywordflow">switch</span> (ret) {</div><div class="line"><a name="l03701"></a><span class="lineno"> 3701</span>&#160;      <span class="keywordflow">case</span> IKS_NOMEM:</div><div class="line"><a name="l03702"></a><span class="lineno"> 3702</span>&#160;         <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Parsing failure: Out of memory.\n&quot;</span>);</div><div class="line"><a name="l03703"></a><span class="lineno"> 3703</span>&#160;         <span class="keywordflow">break</span>;</div><div class="line"><a name="l03704"></a><span class="lineno"> 3704</span>&#160;      <span class="keywordflow">case</span> IKS_BADXML:</div><div class="line"><a name="l03705"></a><span class="lineno"> 3705</span>&#160;         <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Parsing failure: Invalid XML.\n&quot;</span>);</div><div class="line"><a name="l03706"></a><span class="lineno"> 3706</span>&#160;         <span class="keywordflow">break</span>;</div><div class="line"><a name="l03707"></a><span class="lineno"> 3707</span>&#160;      <span class="keywordflow">case</span> IKS_HOOK:</div><div class="line"><a name="l03708"></a><span class="lineno"> 3708</span>&#160;         <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Parsing failure: Hook returned an error.\n&quot;</span>);</div><div class="line"><a name="l03709"></a><span class="lineno"> 3709</span>&#160;         <span class="keywordflow">break</span>;</div><div class="line"><a name="l03710"></a><span class="lineno"> 3710</span>&#160;      }</div><div class="line"><a name="l03711"></a><span class="lineno"> 3711</span>&#160;      <span class="keywordflow">if</span> (ret != IKS_OK) {</div><div class="line"><a name="l03712"></a><span class="lineno"> 3712</span>&#160;         <span class="keywordflow">return</span> ret;</div><div class="line"><a name="l03713"></a><span class="lineno"> 3713</span>&#160;      }</div><div class="line"><a name="l03714"></a><span class="lineno"> 3714</span>&#160;      <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(3, <span class="stringliteral">&quot;XML parsing successful\n&quot;</span>);</div><div class="line"><a name="l03715"></a><span class="lineno"> 3715</span>&#160;   }</div><div class="line"><a name="l03716"></a><span class="lineno"> 3716</span>&#160;   <span class="keywordflow">return</span> IKS_OK;</div><div class="line"><a name="l03717"></a><span class="lineno"> 3717</span>&#160;}</div><div class="line"><a name="l03718"></a><span class="lineno"> 3718</span>&#160;</div><div class="line"><a name="l03719"></a><span class="lineno"><a class="line" href="../../dc/d6b/res__xmpp_8c.html#a6dd3009fd3143bcb30b3fd55eafe04da"> 3719</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../dc/d6b/res__xmpp_8c.html#a6dd3009fd3143bcb30b3fd55eafe04da">sleep_with_backoff</a>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> *sleep_time)</div><div class="line"><a name="l03720"></a><span class="lineno"> 3720</span>&#160;{</div><div class="line"><a name="l03721"></a><span class="lineno"> 3721</span>&#160;   <span class="comment">/* We&#39;re OK with our thread dying here */</span></div><div class="line"><a name="l03722"></a><span class="lineno"> 3722</span>&#160;   pthread_setcancelstate(PTHREAD_CANCEL_ENABLE, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div><div class="line"><a name="l03723"></a><span class="lineno"> 3723</span>&#160;</div><div class="line"><a name="l03724"></a><span class="lineno"> 3724</span>&#160;   sleep(*sleep_time);</div><div class="line"><a name="l03725"></a><span class="lineno"> 3725</span>&#160;   *sleep_time = <a class="code" href="../../d5/d60/utils_8h.html#a3acffbd305ee72dcd4593c0d8af64a4f">MIN</a>(60, *sleep_time * 2);</div><div class="line"><a name="l03726"></a><span class="lineno"> 3726</span>&#160;</div><div class="line"><a name="l03727"></a><span class="lineno"> 3727</span>&#160;   pthread_setcancelstate(PTHREAD_CANCEL_DISABLE, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div><div class="line"><a name="l03728"></a><span class="lineno"> 3728</span>&#160;}</div><div class="line"><a name="l03729"></a><span class="lineno"> 3729</span>&#160;<span class="comment"></span></div><div class="line"><a name="l03730"></a><span class="lineno"> 3730</span>&#160;<span class="comment">/*! \brief XMPP client connection thread */</span></div><div class="line"><a name="l03731"></a><span class="lineno"><a class="line" href="../../dc/d6b/res__xmpp_8c.html#a26fe05af8a6e35300033d69700b9d94f"> 3731</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> *<a class="code" href="../../dc/d6b/res__xmpp_8c.html#a26fe05af8a6e35300033d69700b9d94f">xmpp_client_thread</a>(<span class="keywordtype">void</span> *data)</div><div class="line"><a name="l03732"></a><span class="lineno"> 3732</span>&#160;{</div><div class="line"><a name="l03733"></a><span class="lineno"> 3733</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../df/d42/structast__xmpp__client.html">ast_xmpp_client</a> *client = data;</div><div class="line"><a name="l03734"></a><span class="lineno"> 3734</span>&#160;   <span class="keywordtype">int</span> res = IKS_NET_RWERR;</div><div class="line"><a name="l03735"></a><span class="lineno"> 3735</span>&#160;   <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> sleep_time = 1;</div><div class="line"><a name="l03736"></a><span class="lineno"> 3736</span>&#160;</div><div class="line"><a name="l03737"></a><span class="lineno"> 3737</span>&#160;   <span class="comment">/* We only allow cancellation while sleeping */</span></div><div class="line"><a name="l03738"></a><span class="lineno"> 3738</span>&#160;   pthread_setcancelstate(PTHREAD_CANCEL_DISABLE, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div><div class="line"><a name="l03739"></a><span class="lineno"> 3739</span>&#160;</div><div class="line"><a name="l03740"></a><span class="lineno"> 3740</span>&#160;   <span class="keywordflow">do</span> {</div><div class="line"><a name="l03741"></a><span class="lineno"> 3741</span>&#160;      <span class="keywordflow">if</span> (client-&gt;<a class="code" href="../../df/d42/structast__xmpp__client.html#a0e1ad9bdec3a82e1fec4aed829cfa2a6">state</a> == <a class="code" href="../../da/da0/xmpp_8h.html#ae37d560c438576bdcb47347088225ee6ac443c6d96cc4879bf26ca95710628aad">XMPP_STATE_DISCONNECTING</a>) {</div><div class="line"><a name="l03742"></a><span class="lineno"> 3742</span>&#160;         <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(1, <span class="stringliteral">&quot;[%s] Disconnecting\n&quot;</span>, client-&gt;<a class="code" href="../../df/d42/structast__xmpp__client.html#ace9168767fc3707cf5f0a7d049682ba3">name</a>);</div><div class="line"><a name="l03743"></a><span class="lineno"> 3743</span>&#160;         <span class="keywordflow">break</span>;</div><div class="line"><a name="l03744"></a><span class="lineno"> 3744</span>&#160;      }</div><div class="line"><a name="l03745"></a><span class="lineno"> 3745</span>&#160;</div><div class="line"><a name="l03746"></a><span class="lineno"> 3746</span>&#160;      <span class="keywordflow">if</span> (res == IKS_NET_RWERR || client-&gt;<a class="code" href="../../df/d42/structast__xmpp__client.html#a493b57f443cc38b3d3df9c1e584d9d82">timeout</a> == 0) {</div><div class="line"><a name="l03747"></a><span class="lineno"> 3747</span>&#160;         <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(3, <span class="stringliteral">&quot;[%s] Connecting\n&quot;</span>, client-&gt;<a class="code" href="../../df/d42/structast__xmpp__client.html#ace9168767fc3707cf5f0a7d049682ba3">name</a>);</div><div class="line"><a name="l03748"></a><span class="lineno"> 3748</span>&#160;         <span class="keywordflow">if</span> ((res = <a class="code" href="../../dc/d6b/res__xmpp_8c.html#a2c4cc886bbbb4ecd8487b33634e68c5b">xmpp_client_reconnect</a>(client)) != IKS_OK) {</div><div class="line"><a name="l03749"></a><span class="lineno"> 3749</span>&#160;            <a class="code" href="../../dc/d6b/res__xmpp_8c.html#a6dd3009fd3143bcb30b3fd55eafe04da">sleep_with_backoff</a>(&amp;sleep_time);</div><div class="line"><a name="l03750"></a><span class="lineno"> 3750</span>&#160;            res = IKS_NET_RWERR;</div><div class="line"><a name="l03751"></a><span class="lineno"> 3751</span>&#160;         }</div><div class="line"><a name="l03752"></a><span class="lineno"> 3752</span>&#160;         <span class="keywordflow">continue</span>;</div><div class="line"><a name="l03753"></a><span class="lineno"> 3753</span>&#160;      }</div><div class="line"><a name="l03754"></a><span class="lineno"> 3754</span>&#160;</div><div class="line"><a name="l03755"></a><span class="lineno"> 3755</span>&#160;      res = <a class="code" href="../../dc/d6b/res__xmpp_8c.html#ade776dcd1dbcfe2f28831298e7db444e">xmpp_client_receive</a>(client, 1);</div><div class="line"><a name="l03756"></a><span class="lineno"> 3756</span>&#160;</div><div class="line"><a name="l03757"></a><span class="lineno"> 3757</span>&#160;      <span class="comment">/* Decrease timeout if no data received, and delete</span></div><div class="line"><a name="l03758"></a><span class="lineno"> 3758</span>&#160;<span class="comment">       * old messages globally */</span></div><div class="line"><a name="l03759"></a><span class="lineno"> 3759</span>&#160;      <span class="keywordflow">if</span> (res == <a class="code" href="../../da/da0/xmpp_8h.html#a99fa4c2cecd405f4430c8d137af93db9">IKS_NET_EXPIRED</a>) {</div><div class="line"><a name="l03760"></a><span class="lineno"> 3760</span>&#160;         client-&gt;<a class="code" href="../../df/d42/structast__xmpp__client.html#a493b57f443cc38b3d3df9c1e584d9d82">timeout</a>--;</div><div class="line"><a name="l03761"></a><span class="lineno"> 3761</span>&#160;      }</div><div class="line"><a name="l03762"></a><span class="lineno"> 3762</span>&#160;</div><div class="line"><a name="l03763"></a><span class="lineno"> 3763</span>&#160;      <span class="keywordflow">if</span> (res == IKS_HOOK) {</div><div class="line"><a name="l03764"></a><span class="lineno"> 3764</span>&#160;         <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(2, <span class="stringliteral">&quot;[%s] Got hook event\n&quot;</span>, client-&gt;<a class="code" href="../../df/d42/structast__xmpp__client.html#ace9168767fc3707cf5f0a7d049682ba3">name</a>);</div><div class="line"><a name="l03765"></a><span class="lineno"> 3765</span>&#160;      } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (res == IKS_NET_TLSFAIL) {</div><div class="line"><a name="l03766"></a><span class="lineno"> 3766</span>&#160;         <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;[%s] TLS failure\n&quot;</span>, client-&gt;<a class="code" href="../../df/d42/structast__xmpp__client.html#ace9168767fc3707cf5f0a7d049682ba3">name</a>);</div><div class="line"><a name="l03767"></a><span class="lineno"> 3767</span>&#160;      } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!client-&gt;<a class="code" href="../../df/d42/structast__xmpp__client.html#a493b57f443cc38b3d3df9c1e584d9d82">timeout</a> &amp;&amp; client-&gt;<a class="code" href="../../df/d42/structast__xmpp__client.html#a0e1ad9bdec3a82e1fec4aed829cfa2a6">state</a> == <a class="code" href="../../da/da0/xmpp_8h.html#ae37d560c438576bdcb47347088225ee6af75b0231e0c9888c9a6c5374abf7527f">XMPP_STATE_CONNECTED</a>) {</div><div class="line"><a name="l03768"></a><span class="lineno"> 3768</span>&#160;         <a class="code" href="../../d5/d60/utils_8h.html#a1604b4d72144dd3d9f7da668e90337e9">RAII_VAR</a>(<span class="keyword">struct</span> <a class="code" href="../../de/d1c/structxmpp__config.html">xmpp_config</a> *, cfg, <a class="code" href="../../d5/da5/astobj2_8h.html#a86d8d6c3c8866ed0a60121da055cd225">ao2_global_obj_ref</a>(<a class="code" href="../../d3/d4e/chan__console_8c.html#aa36e3e2c486b920b166c2d17c5242221">globals</a>), <a class="code" href="../../d5/da5/astobj2_8h.html#a6321ee982370c55ab3c24c72c562cbdd">ao2_cleanup</a>);</div><div class="line"><a name="l03769"></a><span class="lineno"> 3769</span>&#160;         <a class="code" href="../../d5/d60/utils_8h.html#a1604b4d72144dd3d9f7da668e90337e9">RAII_VAR</a>(<span class="keyword">struct</span> <a class="code" href="../../da/d00/structast__xmpp__client__config.html">ast_xmpp_client_config</a> *, clientcfg, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../d5/da5/astobj2_8h.html#a6321ee982370c55ab3c24c72c562cbdd">ao2_cleanup</a>);</div><div class="line"><a name="l03770"></a><span class="lineno"> 3770</span>&#160;</div><div class="line"><a name="l03771"></a><span class="lineno"> 3771</span>&#160;         <span class="keywordflow">if</span> (cfg &amp;&amp; cfg-&gt;clients) {</div><div class="line"><a name="l03772"></a><span class="lineno"> 3772</span>&#160;            clientcfg = <a class="code" href="../../dc/d6b/res__xmpp_8c.html#a14d10033fb3b97f06238940259f45266">xmpp_config_find</a>(cfg-&gt;clients, client-&gt;<a class="code" href="../../df/d42/structast__xmpp__client.html#ace9168767fc3707cf5f0a7d049682ba3">name</a>);</div><div class="line"><a name="l03773"></a><span class="lineno"> 3773</span>&#160;         }</div><div class="line"><a name="l03774"></a><span class="lineno"> 3774</span>&#160;</div><div class="line"><a name="l03775"></a><span class="lineno"> 3775</span>&#160;         <span class="keywordflow">if</span> (clientcfg &amp;&amp; <a class="code" href="../../d5/d60/utils_8h.html#a00d4c9254c9827d6fa44f17a326744a5">ast_test_flag</a>(&amp;clientcfg-&gt;flags, <a class="code" href="../../dc/d6b/res__xmpp_8c.html#aa3759d2ddcc12f3f5ef5a8a3ffa4a4dfac4a9cd4f07050cadcb19c07c6d3bf30f">XMPP_KEEPALIVE</a>)) {</div><div class="line"><a name="l03776"></a><span class="lineno"> 3776</span>&#160;            res = <a class="code" href="../../dc/d6b/res__xmpp_8c.html#aa8cee821cbda619ece4c14df1d7ea43c">xmpp_ping_request</a>(client, client-&gt;<a class="code" href="../../df/d42/structast__xmpp__client.html#af738439b96e613a471505eb1222ac406">jid</a>-&gt;server, client-&gt;<a class="code" href="../../df/d42/structast__xmpp__client.html#af738439b96e613a471505eb1222ac406">jid</a>-&gt;full);</div><div class="line"><a name="l03777"></a><span class="lineno"> 3777</span>&#160;         } <span class="keywordflow">else</span> {</div><div class="line"><a name="l03778"></a><span class="lineno"> 3778</span>&#160;            res = IKS_OK;</div><div class="line"><a name="l03779"></a><span class="lineno"> 3779</span>&#160;         }</div><div class="line"><a name="l03780"></a><span class="lineno"> 3780</span>&#160;</div><div class="line"><a name="l03781"></a><span class="lineno"> 3781</span>&#160;         <span class="keywordflow">if</span> (res == IKS_OK) {</div><div class="line"><a name="l03782"></a><span class="lineno"> 3782</span>&#160;            client-&gt;<a class="code" href="../../df/d42/structast__xmpp__client.html#a493b57f443cc38b3d3df9c1e584d9d82">timeout</a> = 50;</div><div class="line"><a name="l03783"></a><span class="lineno"> 3783</span>&#160;         } <span class="keywordflow">else</span> {</div><div class="line"><a name="l03784"></a><span class="lineno"> 3784</span>&#160;            <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;[%s] Network timeout\n&quot;</span>, client-&gt;<a class="code" href="../../df/d42/structast__xmpp__client.html#ace9168767fc3707cf5f0a7d049682ba3">name</a>);</div><div class="line"><a name="l03785"></a><span class="lineno"> 3785</span>&#160;         }</div><div class="line"><a name="l03786"></a><span class="lineno"> 3786</span>&#160;      } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (res == IKS_NET_RWERR) {</div><div class="line"><a name="l03787"></a><span class="lineno"> 3787</span>&#160;         <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;[%s] Socket read error\n&quot;</span>, client-&gt;<a class="code" href="../../df/d42/structast__xmpp__client.html#ace9168767fc3707cf5f0a7d049682ba3">name</a>);</div><div class="line"><a name="l03788"></a><span class="lineno"> 3788</span>&#160;         <a class="code" href="../../dc/d6b/res__xmpp_8c.html#abd1cce3d4d067a7306e5e17dee2876dd">ast_xmpp_client_disconnect</a>(client);</div><div class="line"><a name="l03789"></a><span class="lineno"> 3789</span>&#160;         <a class="code" href="../../dc/d6b/res__xmpp_8c.html#a6dd3009fd3143bcb30b3fd55eafe04da">sleep_with_backoff</a>(&amp;sleep_time);</div><div class="line"><a name="l03790"></a><span class="lineno"> 3790</span>&#160;      } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (res == IKS_NET_NOSOCK) {</div><div class="line"><a name="l03791"></a><span class="lineno"> 3791</span>&#160;         <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;[%s] No socket\n&quot;</span>, client-&gt;<a class="code" href="../../df/d42/structast__xmpp__client.html#ace9168767fc3707cf5f0a7d049682ba3">name</a>);</div><div class="line"><a name="l03792"></a><span class="lineno"> 3792</span>&#160;      } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (res == IKS_NET_NOCONN) {</div><div class="line"><a name="l03793"></a><span class="lineno"> 3793</span>&#160;         <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;[%s] No connection\n&quot;</span>, client-&gt;<a class="code" href="../../df/d42/structast__xmpp__client.html#ace9168767fc3707cf5f0a7d049682ba3">name</a>);</div><div class="line"><a name="l03794"></a><span class="lineno"> 3794</span>&#160;      } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (res == IKS_NET_NODNS) {</div><div class="line"><a name="l03795"></a><span class="lineno"> 3795</span>&#160;         <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;[%s] No DNS\n&quot;</span>, client-&gt;<a class="code" href="../../df/d42/structast__xmpp__client.html#ace9168767fc3707cf5f0a7d049682ba3">name</a>);</div><div class="line"><a name="l03796"></a><span class="lineno"> 3796</span>&#160;      } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (res == IKS_NET_NOTSUPP) {</div><div class="line"><a name="l03797"></a><span class="lineno"> 3797</span>&#160;         <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;[%s] Not supported\n&quot;</span>, client-&gt;<a class="code" href="../../df/d42/structast__xmpp__client.html#ace9168767fc3707cf5f0a7d049682ba3">name</a>);</div><div class="line"><a name="l03798"></a><span class="lineno"> 3798</span>&#160;      } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (res == IKS_NET_DROPPED) {</div><div class="line"><a name="l03799"></a><span class="lineno"> 3799</span>&#160;         <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;[%s] Dropped?\n&quot;</span>, client-&gt;<a class="code" href="../../df/d42/structast__xmpp__client.html#ace9168767fc3707cf5f0a7d049682ba3">name</a>);</div><div class="line"><a name="l03800"></a><span class="lineno"> 3800</span>&#160;      } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (res == IKS_NET_UNKNOWN) {</div><div class="line"><a name="l03801"></a><span class="lineno"> 3801</span>&#160;         <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(5, <span class="stringliteral">&quot;[%s] Unknown\n&quot;</span>, client-&gt;<a class="code" href="../../df/d42/structast__xmpp__client.html#ace9168767fc3707cf5f0a7d049682ba3">name</a>);</div><div class="line"><a name="l03802"></a><span class="lineno"> 3802</span>&#160;      } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (res == IKS_OK) {</div><div class="line"><a name="l03803"></a><span class="lineno"> 3803</span>&#160;         sleep_time = 1;</div><div class="line"><a name="l03804"></a><span class="lineno"> 3804</span>&#160;      }</div><div class="line"><a name="l03805"></a><span class="lineno"> 3805</span>&#160;</div><div class="line"><a name="l03806"></a><span class="lineno"> 3806</span>&#160;   } <span class="keywordflow">while</span> (1);</div><div class="line"><a name="l03807"></a><span class="lineno"> 3807</span>&#160;</div><div class="line"><a name="l03808"></a><span class="lineno"> 3808</span>&#160;   <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l03809"></a><span class="lineno"> 3809</span>&#160;}</div><div class="line"><a name="l03810"></a><span class="lineno"> 3810</span>&#160;</div><div class="line"><a name="l03811"></a><span class="lineno"><a class="line" href="../../dc/d6b/res__xmpp_8c.html#a17f29e437cb3706f6b4a152f291ed515"> 3811</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../dc/d6b/res__xmpp_8c.html#a17f29e437cb3706f6b4a152f291ed515">xmpp_client_config_merge_buddies</a>(<span class="keywordtype">void</span> *obj, <span class="keywordtype">void</span> *arg, <span class="keywordtype">int</span> flags)</div><div class="line"><a name="l03812"></a><span class="lineno"> 3812</span>&#160;{</div><div class="line"><a name="l03813"></a><span class="lineno"> 3813</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d5/d25/structast__xmpp__buddy.html">ast_xmpp_buddy</a> *buddy1 = obj, *buddy2;</div><div class="line"><a name="l03814"></a><span class="lineno"> 3814</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d2/da9/structao2__container.html">ao2_container</a> *buddies = arg;</div><div class="line"><a name="l03815"></a><span class="lineno"> 3815</span>&#160;</div><div class="line"><a name="l03816"></a><span class="lineno"> 3816</span>&#160;   <span class="comment">/* If the buddy does not already exist link it into the client buddies container */</span></div><div class="line"><a name="l03817"></a><span class="lineno"> 3817</span>&#160;   <span class="keywordflow">if</span> (!(buddy2 = <a class="code" href="../../d5/da5/astobj2_8h.html#a911e0703891a9a7aaf73978152092586">ao2_find</a>(buddies, buddy1-&gt;<a class="code" href="../../d5/d25/structast__xmpp__buddy.html#aaf2ca63234b10470cfbba573d4c0ed01">id</a>, <a class="code" href="../../d5/da5/astobj2_8h.html#a22f40c733a085f259af94e864ebaa09a">OBJ_KEY</a>))) {</div><div class="line"><a name="l03818"></a><span class="lineno"> 3818</span>&#160;      <a class="code" href="../../d5/da5/astobj2_8h.html#a1ad9f122bcae95a470639402faa3d2ee">ao2_link</a>(buddies, buddy1);</div><div class="line"><a name="l03819"></a><span class="lineno"> 3819</span>&#160;   } <span class="keywordflow">else</span> {</div><div class="line"><a name="l03820"></a><span class="lineno"> 3820</span>&#160;      <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(buddy2, -1);</div><div class="line"><a name="l03821"></a><span class="lineno"> 3821</span>&#160;   }</div><div class="line"><a name="l03822"></a><span class="lineno"> 3822</span>&#160;</div><div class="line"><a name="l03823"></a><span class="lineno"> 3823</span>&#160;   <span class="comment">/* All buddies are unlinked from the configuration buddies container, always */</span></div><div class="line"><a name="l03824"></a><span class="lineno"> 3824</span>&#160;   <span class="keywordflow">return</span> 1;</div><div class="line"><a name="l03825"></a><span class="lineno"> 3825</span>&#160;}</div><div class="line"><a name="l03826"></a><span class="lineno"> 3826</span>&#160;</div><div class="line"><a name="l03827"></a><span class="lineno"><a class="line" href="../../dc/d6b/res__xmpp_8c.html#a651fdf11709558c6200662ad0e18fb28"> 3827</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../dc/d6b/res__xmpp_8c.html#a651fdf11709558c6200662ad0e18fb28">fetch_access_token</a>(<span class="keyword">struct</span> <a class="code" href="../../da/d00/structast__xmpp__client__config.html">ast_xmpp_client_config</a> *cfg)</div><div class="line"><a name="l03828"></a><span class="lineno"> 3828</span>&#160;{</div><div class="line"><a name="l03829"></a><span class="lineno"> 3829</span>&#160;   <a class="code" href="../../d5/d60/utils_8h.html#a1604b4d72144dd3d9f7da668e90337e9">RAII_VAR</a>(<span class="keywordtype">char</span> *, cmd, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../d8/d8a/astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>);</div><div class="line"><a name="l03830"></a><span class="lineno"> 3830</span>&#160;   <span class="keywordtype">char</span> cBuf[1024] = <span class="stringliteral">&quot;&quot;</span>;</div><div class="line"><a name="l03831"></a><span class="lineno"> 3831</span>&#160;   <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="../../dc/d12/res__config__ldap_8c.html#a75e4590043edf35241d30fabe2eda546">url</a> = <span class="stringliteral">&quot;https://www.googleapis.com/oauth2/v3/token&quot;</span>;</div><div class="line"><a name="l03832"></a><span class="lineno"> 3832</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d0/d96/structast__json__error.html">ast_json_error</a> error;</div><div class="line"><a name="l03833"></a><span class="lineno"> 3833</span>&#160;   <a class="code" href="../../d5/d60/utils_8h.html#a1604b4d72144dd3d9f7da668e90337e9">RAII_VAR</a>(<span class="keyword">struct</span> <a class="code" href="../../d1/da1/structast__json.html">ast_json</a> *, jobj, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../d4/d05/json_8h.html#a33bcd9181e613a659eefe411ec42c87c">ast_json_unref</a>);</div><div class="line"><a name="l03834"></a><span class="lineno"> 3834</span>&#160;</div><div class="line"><a name="l03835"></a><span class="lineno"> 3835</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d8/d8a/astmm_8h.html#ada667b6f84a08e6848cb37c5ffb94a5f">ast_asprintf</a>(&amp;cmd,</div><div class="line"><a name="l03836"></a><span class="lineno"> 3836</span>&#160;      <span class="stringliteral">&quot;CURL(%s,client_id=%s&amp;client_secret=%s&amp;refresh_token=%s&amp;grant_type=refresh_token)&quot;</span>,</div><div class="line"><a name="l03837"></a><span class="lineno"> 3837</span>&#160;      url, cfg-&gt;<a class="code" href="../../da/d00/structast__xmpp__client__config.html#a4b8582884dc99ca78481aaf09d2a8aaa">oauth_clientid</a>, cfg-&gt;<a class="code" href="../../da/d00/structast__xmpp__client__config.html#a4e8ff91b48d6fcdfb7f0265d59bdd979">oauth_secret</a>, cfg-&gt;<a class="code" href="../../da/d00/structast__xmpp__client__config.html#ad300470818476484645b03f3c0c66591">refresh_token</a>) &lt; 0) {</div><div class="line"><a name="l03838"></a><span class="lineno"> 3838</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l03839"></a><span class="lineno"> 3839</span>&#160;   }</div><div class="line"><a name="l03840"></a><span class="lineno"> 3840</span>&#160;</div><div class="line"><a name="l03841"></a><span class="lineno"> 3841</span>&#160;   <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(2, <span class="stringliteral">&quot;Performing OAuth 2.0 authentication for client &#39;%s&#39; using command: %s\n&quot;</span>,</div><div class="line"><a name="l03842"></a><span class="lineno"> 3842</span>&#160;      cfg-&gt;<a class="code" href="../../da/d00/structast__xmpp__client__config.html#ace9168767fc3707cf5f0a7d049682ba3">name</a>, cmd);</div><div class="line"><a name="l03843"></a><span class="lineno"> 3843</span>&#160;</div><div class="line"><a name="l03844"></a><span class="lineno"> 3844</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../db/de0/pbx_8h.html#aa4e9618aa036a586af7d7663afd9b507">ast_func_read</a>(<a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, cmd, cBuf, <span class="keyword">sizeof</span>(cBuf) - 1)) {</div><div class="line"><a name="l03845"></a><span class="lineno"> 3845</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;CURL is unavailable. This is required for OAuth 2.0 authentication of XMPP client &#39;%s&#39;. Please ensure it is loaded.\n&quot;</span>,</div><div class="line"><a name="l03846"></a><span class="lineno"> 3846</span>&#160;         cfg-&gt;<a class="code" href="../../da/d00/structast__xmpp__client__config.html#ace9168767fc3707cf5f0a7d049682ba3">name</a>);</div><div class="line"><a name="l03847"></a><span class="lineno"> 3847</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l03848"></a><span class="lineno"> 3848</span>&#160;   }</div><div class="line"><a name="l03849"></a><span class="lineno"> 3849</span>&#160;</div><div class="line"><a name="l03850"></a><span class="lineno"> 3850</span>&#160;   <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(2, <span class="stringliteral">&quot;OAuth 2.0 authentication for client &#39;%s&#39; returned: %s\n&quot;</span>, cfg-&gt;<a class="code" href="../../da/d00/structast__xmpp__client__config.html#ace9168767fc3707cf5f0a7d049682ba3">name</a>, cBuf);</div><div class="line"><a name="l03851"></a><span class="lineno"> 3851</span>&#160;</div><div class="line"><a name="l03852"></a><span class="lineno"> 3852</span>&#160;   jobj = <a class="code" href="../../d4/d05/json_8h.html#adca5179982d1f48df7127c123f15ce74">ast_json_load_string</a>(cBuf, &amp;error);</div><div class="line"><a name="l03853"></a><span class="lineno"> 3853</span>&#160;   <span class="keywordflow">if</span> (jobj) {</div><div class="line"><a name="l03854"></a><span class="lineno"> 3854</span>&#160;      <span class="keyword">const</span> <span class="keywordtype">char</span> *token = <a class="code" href="../../d4/d05/json_8h.html#a6772fcee88746a9d4f6ec6f240b76dd0">ast_json_string_get</a>(<a class="code" href="../../d4/d05/json_8h.html#a53707225c3bf831e263245c6e3800676">ast_json_object_get</a>(jobj, <span class="stringliteral">&quot;access_token&quot;</span>));</div><div class="line"><a name="l03855"></a><span class="lineno"> 3855</span>&#160;      <span class="keywordflow">if</span> (token) {</div><div class="line"><a name="l03856"></a><span class="lineno"> 3856</span>&#160;         <a class="code" href="../../d1/d0f/stringfields_8h.html#a653461abd6e0d16e4e3326ab90e0501d">ast_string_field_set</a>(cfg, <a class="code" href="../../d0/d29/cdr__mysql_8c.html#ab4fdb206838f2974bd15fc2ca1e9d366">password</a>, token);</div><div class="line"><a name="l03857"></a><span class="lineno"> 3857</span>&#160;         <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l03858"></a><span class="lineno"> 3858</span>&#160;      }</div><div class="line"><a name="l03859"></a><span class="lineno"> 3859</span>&#160;   }</div><div class="line"><a name="l03860"></a><span class="lineno"> 3860</span>&#160;</div><div class="line"><a name="l03861"></a><span class="lineno"> 3861</span>&#160;   <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;An error occurred while performing OAuth 2.0 authentication for client &#39;%s&#39;: %s\n&quot;</span>, cfg-&gt;<a class="code" href="../../da/d00/structast__xmpp__client__config.html#ace9168767fc3707cf5f0a7d049682ba3">name</a>, cBuf);</div><div class="line"><a name="l03862"></a><span class="lineno"> 3862</span>&#160;</div><div class="line"><a name="l03863"></a><span class="lineno"> 3863</span>&#160;   <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l03864"></a><span class="lineno"> 3864</span>&#160;}</div><div class="line"><a name="l03865"></a><span class="lineno"> 3865</span>&#160;</div><div class="line"><a name="l03866"></a><span class="lineno"><a class="line" href="../../dc/d6b/res__xmpp_8c.html#a3ff94d7d97bc1497542220144f60afbf"> 3866</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../dc/d6b/res__xmpp_8c.html#a3ff94d7d97bc1497542220144f60afbf">xmpp_client_config_post_apply</a>(<span class="keywordtype">void</span> *obj, <span class="keywordtype">void</span> *arg, <span class="keywordtype">int</span> flags)</div><div class="line"><a name="l03867"></a><span class="lineno"> 3867</span>&#160;{</div><div class="line"><a name="l03868"></a><span class="lineno"> 3868</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../da/d00/structast__xmpp__client__config.html">ast_xmpp_client_config</a> *cfg = obj;</div><div class="line"><a name="l03869"></a><span class="lineno"> 3869</span>&#160;   <a class="code" href="../../d5/d60/utils_8h.html#a1604b4d72144dd3d9f7da668e90337e9">RAII_VAR</a>(<span class="keyword">struct</span> <a class="code" href="../../de/d1c/structxmpp__config.html">xmpp_config</a> *, gcfg, <a class="code" href="../../d5/da5/astobj2_8h.html#a86d8d6c3c8866ed0a60121da055cd225">ao2_global_obj_ref</a>(<a class="code" href="../../d3/d4e/chan__console_8c.html#aa36e3e2c486b920b166c2d17c5242221">globals</a>), <a class="code" href="../../d5/da5/astobj2_8h.html#a6321ee982370c55ab3c24c72c562cbdd">ao2_cleanup</a>);</div><div class="line"><a name="l03870"></a><span class="lineno"> 3870</span>&#160;</div><div class="line"><a name="l03871"></a><span class="lineno"> 3871</span>&#160;   <span class="comment">/* Merge global options that have not been modified */</span></div><div class="line"><a name="l03872"></a><span class="lineno"> 3872</span>&#160;   <a class="code" href="../../d5/d60/utils_8h.html#ab9da1c7265610eff83ed6146f104dc6f">ast_copy_flags</a>(&amp;cfg-&gt;<a class="code" href="../../da/d00/structast__xmpp__client__config.html#aec78000b2897c094f68ed72559e18acd">flags</a>, &amp;gcfg-&gt;global-&gt;general, ~(cfg-&gt;<a class="code" href="../../da/d00/structast__xmpp__client__config.html#afd35dbdf461b0fbd44e300eee66edebf">mod_flags</a>.<a class="code" href="../../dc/dac/structast__flags.html#ac92588540e8c1d014a08cd8a45462b19">flags</a>) &amp; (<a class="code" href="../../dc/d6b/res__xmpp_8c.html#aa3759d2ddcc12f3f5ef5a8a3ffa4a4dfa56b0aacbe6240e563e08310d1b6c8ce2">XMPP_AUTOPRUNE</a> | <a class="code" href="../../dc/d6b/res__xmpp_8c.html#aa3759d2ddcc12f3f5ef5a8a3ffa4a4dfa18ce12342ffe1b2f00bb53be6a87665d">XMPP_AUTOREGISTER</a> | <a class="code" href="../../dc/d6b/res__xmpp_8c.html#aa3759d2ddcc12f3f5ef5a8a3ffa4a4dfa8c4cc198db356150269f85b0339f00bf">XMPP_AUTOACCEPT</a>));</div><div class="line"><a name="l03873"></a><span class="lineno"> 3873</span>&#160;</div><div class="line"><a name="l03874"></a><span class="lineno"> 3874</span>&#160;   <span class="comment">/* Merge buddies as need be */</span></div><div class="line"><a name="l03875"></a><span class="lineno"> 3875</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#a47857055118a703ae87ea5ebaf4842ed">ao2_callback</a>(cfg-&gt;<a class="code" href="../../da/d00/structast__xmpp__client__config.html#a5082987d3e1eac5f625574800bb72c2c">buddies</a>, <a class="code" href="../../d5/da5/astobj2_8h.html#ad9d009e87e737af900825b36db55a35ca614744a4d36b3189d4ab5b02c8645d47">OBJ_MULTIPLE</a> | <a class="code" href="../../d5/da5/astobj2_8h.html#ad9d009e87e737af900825b36db55a35ca71f42ec6460e60eb6e10956c53329e45">OBJ_UNLINK</a>, <a class="code" href="../../dc/d6b/res__xmpp_8c.html#a17f29e437cb3706f6b4a152f291ed515">xmpp_client_config_merge_buddies</a>, cfg-&gt;<a class="code" href="../../da/d00/structast__xmpp__client__config.html#a83bf6907a1184b56931bf86ff744279e">client</a>-&gt;<a class="code" href="../../df/d42/structast__xmpp__client.html#a5082987d3e1eac5f625574800bb72c2c">buddies</a>);</div><div class="line"><a name="l03876"></a><span class="lineno"> 3876</span>&#160;</div><div class="line"><a name="l03877"></a><span class="lineno"> 3877</span>&#160;   <span class="keywordflow">if</span> (cfg-&gt;<a class="code" href="../../da/d00/structast__xmpp__client__config.html#a83bf6907a1184b56931bf86ff744279e">client</a>-&gt;<a class="code" href="../../df/d42/structast__xmpp__client.html#a6588648b50745df0a20957b8d09fd919">reconnect</a>) {</div><div class="line"><a name="l03878"></a><span class="lineno"> 3878</span>&#160;      <span class="comment">/* Disconnect the existing session since our role is changing, or we are starting up */</span></div><div class="line"><a name="l03879"></a><span class="lineno"> 3879</span>&#160;      <a class="code" href="../../dc/d6b/res__xmpp_8c.html#abd1cce3d4d067a7306e5e17dee2876dd">ast_xmpp_client_disconnect</a>(cfg-&gt;<a class="code" href="../../da/d00/structast__xmpp__client__config.html#a83bf6907a1184b56931bf86ff744279e">client</a>);</div><div class="line"><a name="l03880"></a><span class="lineno"> 3880</span>&#160;</div><div class="line"><a name="l03881"></a><span class="lineno"> 3881</span>&#160;      <span class="keywordflow">if</span> (!(cfg-&gt;<a class="code" href="../../da/d00/structast__xmpp__client__config.html#a83bf6907a1184b56931bf86ff744279e">client</a>-&gt;<a class="code" href="../../df/d42/structast__xmpp__client.html#a84da25e2e78fab08d8077368bdbef1c6">parser</a> = iks_stream_new(<a class="code" href="../../d5/d60/utils_8h.html#a00d4c9254c9827d6fa44f17a326744a5">ast_test_flag</a>(&amp;cfg-&gt;<a class="code" href="../../da/d00/structast__xmpp__client__config.html#aec78000b2897c094f68ed72559e18acd">flags</a>, <a class="code" href="../../dc/d6b/res__xmpp_8c.html#aa3759d2ddcc12f3f5ef5a8a3ffa4a4dfadc3efad94dcc216c29d42b23edcb2d00">XMPP_COMPONENT</a>) ? <span class="stringliteral">&quot;jabber:component:accept&quot;</span> : <span class="stringliteral">&quot;jabber:client&quot;</span>, cfg-&gt;<a class="code" href="../../da/d00/structast__xmpp__client__config.html#a83bf6907a1184b56931bf86ff744279e">client</a>,</div><div class="line"><a name="l03882"></a><span class="lineno"> 3882</span>&#160;                        <a class="code" href="../../dc/d6b/res__xmpp_8c.html#ae87b447a7957b9901ac78e5b6eae182a">xmpp_action_hook</a>))) {</div><div class="line"><a name="l03883"></a><span class="lineno"> 3883</span>&#160;         <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Iksemel stream could not be created for client &#39;%s&#39; - client not active\n&quot;</span>, cfg-&gt;<a class="code" href="../../da/d00/structast__xmpp__client__config.html#ace9168767fc3707cf5f0a7d049682ba3">name</a>);</div><div class="line"><a name="l03884"></a><span class="lineno"> 3884</span>&#160;         <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l03885"></a><span class="lineno"> 3885</span>&#160;      }</div><div class="line"><a name="l03886"></a><span class="lineno"> 3886</span>&#160;</div><div class="line"><a name="l03887"></a><span class="lineno"> 3887</span>&#160;      iks_set_log_hook(cfg-&gt;<a class="code" href="../../da/d00/structast__xmpp__client__config.html#a83bf6907a1184b56931bf86ff744279e">client</a>-&gt;<a class="code" href="../../df/d42/structast__xmpp__client.html#a84da25e2e78fab08d8077368bdbef1c6">parser</a>, <a class="code" href="../../dc/d6b/res__xmpp_8c.html#af02607d0a966e73d05d4934a806e79a6">xmpp_log_hook</a>);</div><div class="line"><a name="l03888"></a><span class="lineno"> 3888</span>&#160;</div><div class="line"><a name="l03889"></a><span class="lineno"> 3889</span>&#160;      <span class="comment">/* Create a JID based on the given user, if no resource is given use the default */</span></div><div class="line"><a name="l03890"></a><span class="lineno"> 3890</span>&#160;      <span class="keywordflow">if</span> (!strchr(cfg-&gt;<a class="code" href="../../da/d00/structast__xmpp__client__config.html#a661785436d89cdd720f15478d92c984b">user</a>, <span class="charliteral">&#39;/&#39;</span>) &amp;&amp; !<a class="code" href="../../d5/d60/utils_8h.html#a00d4c9254c9827d6fa44f17a326744a5">ast_test_flag</a>(&amp;cfg-&gt;<a class="code" href="../../da/d00/structast__xmpp__client__config.html#aec78000b2897c094f68ed72559e18acd">flags</a>, <a class="code" href="../../dc/d6b/res__xmpp_8c.html#aa3759d2ddcc12f3f5ef5a8a3ffa4a4dfadc3efad94dcc216c29d42b23edcb2d00">XMPP_COMPONENT</a>)) {</div><div class="line"><a name="l03891"></a><span class="lineno"> 3891</span>&#160;         <span class="keywordtype">char</span> resource[strlen(cfg-&gt;<a class="code" href="../../da/d00/structast__xmpp__client__config.html#a661785436d89cdd720f15478d92c984b">user</a>) + strlen(<span class="stringliteral">&quot;/asterisk-xmpp&quot;</span>) + 1];</div><div class="line"><a name="l03892"></a><span class="lineno"> 3892</span>&#160;</div><div class="line"><a name="l03893"></a><span class="lineno"> 3893</span>&#160;         snprintf(resource, <span class="keyword">sizeof</span>(resource), <span class="stringliteral">&quot;%s/asterisk-xmpp&quot;</span>, cfg-&gt;<a class="code" href="../../da/d00/structast__xmpp__client__config.html#a661785436d89cdd720f15478d92c984b">user</a>);</div><div class="line"><a name="l03894"></a><span class="lineno"> 3894</span>&#160;         cfg-&gt;<a class="code" href="../../da/d00/structast__xmpp__client__config.html#a83bf6907a1184b56931bf86ff744279e">client</a>-&gt;<a class="code" href="../../df/d42/structast__xmpp__client.html#af738439b96e613a471505eb1222ac406">jid</a> = iks_id_new(cfg-&gt;<a class="code" href="../../da/d00/structast__xmpp__client__config.html#a83bf6907a1184b56931bf86ff744279e">client</a>-&gt;<a class="code" href="../../df/d42/structast__xmpp__client.html#ae0c738f7612f5fd8ef0f227f8033324f">stack</a>, resource);</div><div class="line"><a name="l03895"></a><span class="lineno"> 3895</span>&#160;      } <span class="keywordflow">else</span> {</div><div class="line"><a name="l03896"></a><span class="lineno"> 3896</span>&#160;         cfg-&gt;<a class="code" href="../../da/d00/structast__xmpp__client__config.html#a83bf6907a1184b56931bf86ff744279e">client</a>-&gt;<a class="code" href="../../df/d42/structast__xmpp__client.html#af738439b96e613a471505eb1222ac406">jid</a> = iks_id_new(cfg-&gt;<a class="code" href="../../da/d00/structast__xmpp__client__config.html#a83bf6907a1184b56931bf86ff744279e">client</a>-&gt;<a class="code" href="../../df/d42/structast__xmpp__client.html#ae0c738f7612f5fd8ef0f227f8033324f">stack</a>, cfg-&gt;<a class="code" href="../../da/d00/structast__xmpp__client__config.html#a661785436d89cdd720f15478d92c984b">user</a>);</div><div class="line"><a name="l03897"></a><span class="lineno"> 3897</span>&#160;      }</div><div class="line"><a name="l03898"></a><span class="lineno"> 3898</span>&#160;</div><div class="line"><a name="l03899"></a><span class="lineno"> 3899</span>&#160;      <span class="keywordflow">if</span> (!cfg-&gt;<a class="code" href="../../da/d00/structast__xmpp__client__config.html#a83bf6907a1184b56931bf86ff744279e">client</a>-&gt;<a class="code" href="../../df/d42/structast__xmpp__client.html#af738439b96e613a471505eb1222ac406">jid</a> || (<a class="code" href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a>(cfg-&gt;<a class="code" href="../../da/d00/structast__xmpp__client__config.html#a83bf6907a1184b56931bf86ff744279e">client</a>-&gt;<a class="code" href="../../df/d42/structast__xmpp__client.html#af738439b96e613a471505eb1222ac406">jid</a>-&gt;user) &amp;&amp; !<a class="code" href="../../d5/d60/utils_8h.html#a00d4c9254c9827d6fa44f17a326744a5">ast_test_flag</a>(&amp;cfg-&gt;<a class="code" href="../../da/d00/structast__xmpp__client__config.html#aec78000b2897c094f68ed72559e18acd">flags</a>, <a class="code" href="../../dc/d6b/res__xmpp_8c.html#aa3759d2ddcc12f3f5ef5a8a3ffa4a4dfadc3efad94dcc216c29d42b23edcb2d00">XMPP_COMPONENT</a>))) {</div><div class="line"><a name="l03900"></a><span class="lineno"> 3900</span>&#160;         <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Jabber identity &#39;%s&#39; could not be created for client &#39;%s&#39; - client not active\n&quot;</span>, cfg-&gt;<a class="code" href="../../da/d00/structast__xmpp__client__config.html#a661785436d89cdd720f15478d92c984b">user</a>, cfg-&gt;<a class="code" href="../../da/d00/structast__xmpp__client__config.html#ace9168767fc3707cf5f0a7d049682ba3">name</a>);</div><div class="line"><a name="l03901"></a><span class="lineno"> 3901</span>&#160;         <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l03902"></a><span class="lineno"> 3902</span>&#160;      }</div><div class="line"><a name="l03903"></a><span class="lineno"> 3903</span>&#160;</div><div class="line"><a name="l03904"></a><span class="lineno"> 3904</span>&#160;      <a class="code" href="../../d5/d60/utils_8h.html#a595e2f8aa398f4bd21e381c3211235fe">ast_pthread_create_background</a>(&amp;cfg-&gt;<a class="code" href="../../da/d00/structast__xmpp__client__config.html#a83bf6907a1184b56931bf86ff744279e">client</a>-&gt;<a class="code" href="../../df/d42/structast__xmpp__client.html#a01f75a9ad916f63a94e06a27635ba278">thread</a>, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../dc/d6b/res__xmpp_8c.html#a26fe05af8a6e35300033d69700b9d94f">xmpp_client_thread</a>, cfg-&gt;<a class="code" href="../../da/d00/structast__xmpp__client__config.html#a83bf6907a1184b56931bf86ff744279e">client</a>);</div><div class="line"><a name="l03905"></a><span class="lineno"> 3905</span>&#160;</div><div class="line"><a name="l03906"></a><span class="lineno"> 3906</span>&#160;      cfg-&gt;<a class="code" href="../../da/d00/structast__xmpp__client__config.html#a83bf6907a1184b56931bf86ff744279e">client</a>-&gt;<a class="code" href="../../df/d42/structast__xmpp__client.html#a6588648b50745df0a20957b8d09fd919">reconnect</a> = 0;</div><div class="line"><a name="l03907"></a><span class="lineno"> 3907</span>&#160;   } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (cfg-&gt;<a class="code" href="../../da/d00/structast__xmpp__client__config.html#a83bf6907a1184b56931bf86ff744279e">client</a>-&gt;<a class="code" href="../../df/d42/structast__xmpp__client.html#a0e1ad9bdec3a82e1fec4aed829cfa2a6">state</a> == <a class="code" href="../../da/da0/xmpp_8h.html#ae37d560c438576bdcb47347088225ee6af75b0231e0c9888c9a6c5374abf7527f">XMPP_STATE_CONNECTED</a>) {</div><div class="line"><a name="l03908"></a><span class="lineno"> 3908</span>&#160;      <span class="comment">/* If this client is connected update their presence status since it may have changed */</span></div><div class="line"><a name="l03909"></a><span class="lineno"> 3909</span>&#160;      <a class="code" href="../../dc/d6b/res__xmpp_8c.html#a8f64e805d3ad98e99a03d77bbdb84bed">xmpp_client_set_presence</a>(cfg-&gt;<a class="code" href="../../da/d00/structast__xmpp__client__config.html#a83bf6907a1184b56931bf86ff744279e">client</a>, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, cfg-&gt;<a class="code" href="../../da/d00/structast__xmpp__client__config.html#a83bf6907a1184b56931bf86ff744279e">client</a>-&gt;<a class="code" href="../../df/d42/structast__xmpp__client.html#af738439b96e613a471505eb1222ac406">jid</a>-&gt;full, cfg-&gt;<a class="code" href="../../da/d00/structast__xmpp__client__config.html#a522b409a211fd313b8a02f071aea6751">status</a>, cfg-&gt;<a class="code" href="../../da/d00/structast__xmpp__client__config.html#a9347a33c3d64978bccf502f846c0d854">statusmsg</a>);</div><div class="line"><a name="l03910"></a><span class="lineno"> 3910</span>&#160;</div><div class="line"><a name="l03911"></a><span class="lineno"> 3911</span>&#160;      <span class="comment">/* Subscribe to the status of any newly added buddies */</span></div><div class="line"><a name="l03912"></a><span class="lineno"> 3912</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="../../d5/d60/utils_8h.html#a00d4c9254c9827d6fa44f17a326744a5">ast_test_flag</a>(&amp;cfg-&gt;<a class="code" href="../../da/d00/structast__xmpp__client__config.html#aec78000b2897c094f68ed72559e18acd">flags</a>, <a class="code" href="../../dc/d6b/res__xmpp_8c.html#aa3759d2ddcc12f3f5ef5a8a3ffa4a4dfa18ce12342ffe1b2f00bb53be6a87665d">XMPP_AUTOREGISTER</a>)) {</div><div class="line"><a name="l03913"></a><span class="lineno"> 3913</span>&#160;         <a class="code" href="../../d5/da5/astobj2_8h.html#a47857055118a703ae87ea5ebaf4842ed">ao2_callback</a>(cfg-&gt;<a class="code" href="../../da/d00/structast__xmpp__client__config.html#a83bf6907a1184b56931bf86ff744279e">client</a>-&gt;<a class="code" href="../../df/d42/structast__xmpp__client.html#a5082987d3e1eac5f625574800bb72c2c">buddies</a>, <a class="code" href="../../d5/da5/astobj2_8h.html#ad9d009e87e737af900825b36db55a35ca5fc59b193d86a0a8ddfe866304be829d">OBJ_NODATA</a> | <a class="code" href="../../d5/da5/astobj2_8h.html#ad9d009e87e737af900825b36db55a35ca614744a4d36b3189d4ab5b02c8645d47">OBJ_MULTIPLE</a>, <a class="code" href="../../dc/d6b/res__xmpp_8c.html#ad7f5dc1236b0df5dde8be82a376d9c38">xmpp_client_subscribe_user</a>, cfg-&gt;<a class="code" href="../../da/d00/structast__xmpp__client__config.html#a83bf6907a1184b56931bf86ff744279e">client</a>);</div><div class="line"><a name="l03914"></a><span class="lineno"> 3914</span>&#160;      }</div><div class="line"><a name="l03915"></a><span class="lineno"> 3915</span>&#160;   }</div><div class="line"><a name="l03916"></a><span class="lineno"> 3916</span>&#160;</div><div class="line"><a name="l03917"></a><span class="lineno"> 3917</span>&#160;   <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l03918"></a><span class="lineno"> 3918</span>&#160;}</div><div class="line"><a name="l03919"></a><span class="lineno"> 3919</span>&#160;<span class="comment"></span></div><div class="line"><a name="l03920"></a><span class="lineno"> 3920</span>&#160;<span class="comment">/*!</span></div><div class="line"><a name="l03921"></a><span class="lineno"> 3921</span>&#160;<span class="comment"> * \internal</span></div><div class="line"><a name="l03922"></a><span class="lineno"> 3922</span>&#160;<span class="comment"> * \brief  Send a Jabber Message via call from the Manager</span></div><div class="line"><a name="l03923"></a><span class="lineno"> 3923</span>&#160;<span class="comment"> * \param s mansession Manager session</span></div><div class="line"><a name="l03924"></a><span class="lineno"> 3924</span>&#160;<span class="comment"> * \param m message Message to send</span></div><div class="line"><a name="l03925"></a><span class="lineno"> 3925</span>&#160;<span class="comment"> * \return  0</span></div><div class="line"><a name="l03926"></a><span class="lineno"> 3926</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l03927"></a><span class="lineno"><a class="line" href="../../dc/d6b/res__xmpp_8c.html#a48ebc7a99890a29f1901304e574d4f03"> 3927</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../dc/d6b/res__xmpp_8c.html#a48ebc7a99890a29f1901304e574d4f03">manager_jabber_send</a>(<span class="keyword">struct</span> <a class="code" href="../../d2/d8a/structmansession.html">mansession</a> *s, <span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="../../d8/d9e/structmessage.html">message</a> *m)</div><div class="line"><a name="l03928"></a><span class="lineno"> 3928</span>&#160;{</div><div class="line"><a name="l03929"></a><span class="lineno"> 3929</span>&#160;   <a class="code" href="../../d5/d60/utils_8h.html#a1604b4d72144dd3d9f7da668e90337e9">RAII_VAR</a>(<span class="keyword">struct</span> <a class="code" href="../../de/d1c/structxmpp__config.html">xmpp_config</a> *, cfg, <a class="code" href="../../d5/da5/astobj2_8h.html#a86d8d6c3c8866ed0a60121da055cd225">ao2_global_obj_ref</a>(<a class="code" href="../../d3/d4e/chan__console_8c.html#aa36e3e2c486b920b166c2d17c5242221">globals</a>), <a class="code" href="../../d5/da5/astobj2_8h.html#a6321ee982370c55ab3c24c72c562cbdd">ao2_cleanup</a>);</div><div class="line"><a name="l03930"></a><span class="lineno"> 3930</span>&#160;   <a class="code" href="../../d5/d60/utils_8h.html#a1604b4d72144dd3d9f7da668e90337e9">RAII_VAR</a>(<span class="keyword">struct</span> <a class="code" href="../../da/d00/structast__xmpp__client__config.html">ast_xmpp_client_config</a> *, clientcfg, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../d5/da5/astobj2_8h.html#a6321ee982370c55ab3c24c72c562cbdd">ao2_cleanup</a>);</div><div class="line"><a name="l03931"></a><span class="lineno"> 3931</span>&#160;   <span class="keyword">const</span> <span class="keywordtype">char</span> *<span class="keywordtype">id</span> = <a class="code" href="../../df/d72/group__Group__AMI.html#gac6a9f3498f9afffecfd78c485af41556">astman_get_header</a>(m, <span class="stringliteral">&quot;ActionID&quot;</span>);</div><div class="line"><a name="l03932"></a><span class="lineno"> 3932</span>&#160;   <span class="keyword">const</span> <span class="keywordtype">char</span> *jabber = <a class="code" href="../../df/d72/group__Group__AMI.html#gac6a9f3498f9afffecfd78c485af41556">astman_get_header</a>(m, <span class="stringliteral">&quot;Jabber&quot;</span>);</div><div class="line"><a name="l03933"></a><span class="lineno"> 3933</span>&#160;   <span class="keyword">const</span> <span class="keywordtype">char</span> *screenname = <a class="code" href="../../df/d72/group__Group__AMI.html#gac6a9f3498f9afffecfd78c485af41556">astman_get_header</a>(m, <span class="stringliteral">&quot;ScreenName&quot;</span>);</div><div class="line"><a name="l03934"></a><span class="lineno"> 3934</span>&#160;   <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="../../d8/d9e/structmessage.html">message</a> = <a class="code" href="../../df/d72/group__Group__AMI.html#gac6a9f3498f9afffecfd78c485af41556">astman_get_header</a>(m, <span class="stringliteral">&quot;Message&quot;</span>);</div><div class="line"><a name="l03935"></a><span class="lineno"> 3935</span>&#160;</div><div class="line"><a name="l03936"></a><span class="lineno"> 3936</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a>(jabber)) {</div><div class="line"><a name="l03937"></a><span class="lineno"> 3937</span>&#160;      <a class="code" href="../../df/d72/group__Group__AMI.html#ga31a02a7d3cc36aa66ebebdedfc574d1c">astman_send_error</a>(s, m, <span class="stringliteral">&quot;No transport specified&quot;</span>);</div><div class="line"><a name="l03938"></a><span class="lineno"> 3938</span>&#160;      <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l03939"></a><span class="lineno"> 3939</span>&#160;   }</div><div class="line"><a name="l03940"></a><span class="lineno"> 3940</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a>(screenname)) {</div><div class="line"><a name="l03941"></a><span class="lineno"> 3941</span>&#160;      <a class="code" href="../../df/d72/group__Group__AMI.html#ga31a02a7d3cc36aa66ebebdedfc574d1c">astman_send_error</a>(s, m, <span class="stringliteral">&quot;No ScreenName specified&quot;</span>);</div><div class="line"><a name="l03942"></a><span class="lineno"> 3942</span>&#160;      <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l03943"></a><span class="lineno"> 3943</span>&#160;   }</div><div class="line"><a name="l03944"></a><span class="lineno"> 3944</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a>(message)) {</div><div class="line"><a name="l03945"></a><span class="lineno"> 3945</span>&#160;      <a class="code" href="../../df/d72/group__Group__AMI.html#ga31a02a7d3cc36aa66ebebdedfc574d1c">astman_send_error</a>(s, m, <span class="stringliteral">&quot;No Message specified&quot;</span>);</div><div class="line"><a name="l03946"></a><span class="lineno"> 3946</span>&#160;      <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l03947"></a><span class="lineno"> 3947</span>&#160;   }</div><div class="line"><a name="l03948"></a><span class="lineno"> 3948</span>&#160;</div><div class="line"><a name="l03949"></a><span class="lineno"> 3949</span>&#160;   <a class="code" href="../../df/d72/group__Group__AMI.html#ga77315fa8e29950f0c88120501acda0a3">astman_send_ack</a>(s, m, <span class="stringliteral">&quot;Attempting to send Jabber Message&quot;</span>);</div><div class="line"><a name="l03950"></a><span class="lineno"> 3950</span>&#160;</div><div class="line"><a name="l03951"></a><span class="lineno"> 3951</span>&#160;   <span class="keywordflow">if</span> (!cfg || !cfg-&gt;clients || !(clientcfg = <a class="code" href="../../dc/d6b/res__xmpp_8c.html#a14d10033fb3b97f06238940259f45266">xmpp_config_find</a>(cfg-&gt;clients, jabber))) {</div><div class="line"><a name="l03952"></a><span class="lineno"> 3952</span>&#160;      <a class="code" href="../../df/d72/group__Group__AMI.html#ga31a02a7d3cc36aa66ebebdedfc574d1c">astman_send_error</a>(s, m, <span class="stringliteral">&quot;Could not find Sender&quot;</span>);</div><div class="line"><a name="l03953"></a><span class="lineno"> 3953</span>&#160;      <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l03954"></a><span class="lineno"> 3954</span>&#160;   }</div><div class="line"><a name="l03955"></a><span class="lineno"> 3955</span>&#160;</div><div class="line"><a name="l03956"></a><span class="lineno"> 3956</span>&#160;   <span class="keywordflow">if</span> (strchr(screenname, <span class="charliteral">&#39;@&#39;</span>) &amp;&amp; !<a class="code" href="../../dc/d6b/res__xmpp_8c.html#a21d05f7d76693ba1145973de7d3f0a03">ast_xmpp_client_send_message</a>(clientcfg-&gt;client, screenname, message)) {</div><div class="line"><a name="l03957"></a><span class="lineno"> 3957</span>&#160;      <a class="code" href="../../df/d72/group__Group__AMI.html#gac2d42f7be13c532b6a70d50f1b8983d2">astman_append</a>(s, <span class="stringliteral">&quot;Response: Success\r\n&quot;</span>);</div><div class="line"><a name="l03958"></a><span class="lineno"> 3958</span>&#160;   } <span class="keywordflow">else</span> {</div><div class="line"><a name="l03959"></a><span class="lineno"> 3959</span>&#160;      <a class="code" href="../../df/d72/group__Group__AMI.html#gac2d42f7be13c532b6a70d50f1b8983d2">astman_append</a>(s, <span class="stringliteral">&quot;Response: Error\r\n&quot;</span>);</div><div class="line"><a name="l03960"></a><span class="lineno"> 3960</span>&#160;   }</div><div class="line"><a name="l03961"></a><span class="lineno"> 3961</span>&#160;</div><div class="line"><a name="l03962"></a><span class="lineno"> 3962</span>&#160;   <span class="keywordflow">if</span> (!<a class="code" href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a>(<span class="keywordtype">id</span>)) {</div><div class="line"><a name="l03963"></a><span class="lineno"> 3963</span>&#160;      <a class="code" href="../../df/d72/group__Group__AMI.html#gac2d42f7be13c532b6a70d50f1b8983d2">astman_append</a>(s, <span class="stringliteral">&quot;ActionID: %s\r\n&quot;</span>, <span class="keywordtype">id</span>);</div><div class="line"><a name="l03964"></a><span class="lineno"> 3964</span>&#160;   }</div><div class="line"><a name="l03965"></a><span class="lineno"> 3965</span>&#160;</div><div class="line"><a name="l03966"></a><span class="lineno"> 3966</span>&#160;   <a class="code" href="../../df/d72/group__Group__AMI.html#gac2d42f7be13c532b6a70d50f1b8983d2">astman_append</a>(s, <span class="stringliteral">&quot;\r\n&quot;</span>);</div><div class="line"><a name="l03967"></a><span class="lineno"> 3967</span>&#160;</div><div class="line"><a name="l03968"></a><span class="lineno"> 3968</span>&#160;   <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l03969"></a><span class="lineno"> 3969</span>&#160;}</div><div class="line"><a name="l03970"></a><span class="lineno"> 3970</span>&#160;<span class="comment"></span></div><div class="line"><a name="l03971"></a><span class="lineno"> 3971</span>&#160;<span class="comment">/*!</span></div><div class="line"><a name="l03972"></a><span class="lineno"> 3972</span>&#160;<span class="comment"> * \brief Build the a node request</span></div><div class="line"><a name="l03973"></a><span class="lineno"> 3973</span>&#160;<span class="comment"> * \param client the configured XMPP client we use to connect to a XMPP server</span></div><div class="line"><a name="l03974"></a><span class="lineno"> 3974</span>&#160;<span class="comment"> * \param collection name of the collection for request</span></div><div class="line"><a name="l03975"></a><span class="lineno"> 3975</span>&#160;<span class="comment"> * \return iks*</span></div><div class="line"><a name="l03976"></a><span class="lineno"> 3976</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l03977"></a><span class="lineno"><a class="line" href="../../dc/d6b/res__xmpp_8c.html#ab81f77a88ce40a22216d745dbeb9c3be"> 3977</a></span>&#160;<span class="keyword">static</span> iks* <a class="code" href="../../dc/d6b/res__xmpp_8c.html#ab81f77a88ce40a22216d745dbeb9c3be">xmpp_pubsub_build_node_request</a>(<span class="keyword">struct</span> <a class="code" href="../../df/d42/structast__xmpp__client.html">ast_xmpp_client</a> *client, <span class="keyword">const</span> <span class="keywordtype">char</span> *collection)</div><div class="line"><a name="l03978"></a><span class="lineno"> 3978</span>&#160;{</div><div class="line"><a name="l03979"></a><span class="lineno"> 3979</span>&#160;   iks *<a class="code" href="../../d0/d29/chan__pjsip_8c.html#a4e2e6fb7d874f0d2deddd2ecfc8afb32">request</a> = <a class="code" href="../../dc/d6b/res__xmpp_8c.html#a6b65b4b3c50fb1a3560fbafd70cf21bd">xmpp_pubsub_iq_create</a>(client, <span class="stringliteral">&quot;get&quot;</span>), *query;</div><div class="line"><a name="l03980"></a><span class="lineno"> 3980</span>&#160;</div><div class="line"><a name="l03981"></a><span class="lineno"> 3981</span>&#160;   <span class="keywordflow">if</span> (!request) {</div><div class="line"><a name="l03982"></a><span class="lineno"> 3982</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l03983"></a><span class="lineno"> 3983</span>&#160;   }</div><div class="line"><a name="l03984"></a><span class="lineno"> 3984</span>&#160;</div><div class="line"><a name="l03985"></a><span class="lineno"> 3985</span>&#160;   query = iks_insert(request, <span class="stringliteral">&quot;query&quot;</span>);</div><div class="line"><a name="l03986"></a><span class="lineno"> 3986</span>&#160;   iks_insert_attrib(query, <span class="stringliteral">&quot;xmlns&quot;</span>, <span class="stringliteral">&quot;http://jabber.org/protocol/disco#items&quot;</span>);</div><div class="line"><a name="l03987"></a><span class="lineno"> 3987</span>&#160;</div><div class="line"><a name="l03988"></a><span class="lineno"> 3988</span>&#160;   <span class="keywordflow">if</span> (collection) {</div><div class="line"><a name="l03989"></a><span class="lineno"> 3989</span>&#160;      iks_insert_attrib(query, <span class="stringliteral">&quot;node&quot;</span>, collection);</div><div class="line"><a name="l03990"></a><span class="lineno"> 3990</span>&#160;   }</div><div class="line"><a name="l03991"></a><span class="lineno"> 3991</span>&#160;</div><div class="line"><a name="l03992"></a><span class="lineno"> 3992</span>&#160;   <span class="keywordflow">return</span> <a class="code" href="../../d0/d29/chan__pjsip_8c.html#a4e2e6fb7d874f0d2deddd2ecfc8afb32">request</a>;</div><div class="line"><a name="l03993"></a><span class="lineno"> 3993</span>&#160;}</div><div class="line"><a name="l03994"></a><span class="lineno"> 3994</span>&#160;<span class="comment"></span></div><div class="line"><a name="l03995"></a><span class="lineno"> 3995</span>&#160;<span class="comment">/*!</span></div><div class="line"><a name="l03996"></a><span class="lineno"> 3996</span>&#160;<span class="comment"> * \brief Receive pubsub item lists</span></div><div class="line"><a name="l03997"></a><span class="lineno"> 3997</span>&#160;<span class="comment"> * \param data pointer to ast_xmpp_client structure</span></div><div class="line"><a name="l03998"></a><span class="lineno"> 3998</span>&#160;<span class="comment"> * \param pak response from pubsub diso#items query</span></div><div class="line"><a name="l03999"></a><span class="lineno"> 3999</span>&#160;<span class="comment"> * \return IKS_FILTER_EAT</span></div><div class="line"><a name="l04000"></a><span class="lineno"> 4000</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l04001"></a><span class="lineno"><a class="line" href="../../dc/d6b/res__xmpp_8c.html#aa2256c5ac61afb7f66a1f717a58c39f5"> 4001</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../dc/d6b/res__xmpp_8c.html#aa2256c5ac61afb7f66a1f717a58c39f5">xmpp_pubsub_receive_node_list</a>(<span class="keywordtype">void</span> *data, ikspak* pak)</div><div class="line"><a name="l04002"></a><span class="lineno"> 4002</span>&#160;{</div><div class="line"><a name="l04003"></a><span class="lineno"> 4003</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../df/d42/structast__xmpp__client.html">ast_xmpp_client</a> *client = data;</div><div class="line"><a name="l04004"></a><span class="lineno"> 4004</span>&#160;   iks *<a class="code" href="../../d8/d4f/test__config_8c.html#aecdc7cbd5dfa76493c0212caa55d706c">item</a> = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l04005"></a><span class="lineno"> 4005</span>&#160;</div><div class="line"><a name="l04006"></a><span class="lineno"> 4006</span>&#160;   <span class="keywordflow">if</span> (iks_has_children(pak-&gt;query)) {</div><div class="line"><a name="l04007"></a><span class="lineno"> 4007</span>&#160;      item = iks_first_tag(pak-&gt;query);</div><div class="line"><a name="l04008"></a><span class="lineno"> 4008</span>&#160;      <a class="code" href="../../d4/dc5/extconf_8c.html#a81d26348827b996085d4cb6be3e2c348">ast_verbose</a>(<span class="stringliteral">&quot;Connection %s: %s\nNode name: %s\n&quot;</span>, client-&gt;<a class="code" href="../../df/d42/structast__xmpp__client.html#ace9168767fc3707cf5f0a7d049682ba3">name</a>, client-&gt;<a class="code" href="../../df/d42/structast__xmpp__client.html#af738439b96e613a471505eb1222ac406">jid</a>-&gt;partial,</div><div class="line"><a name="l04009"></a><span class="lineno"> 4009</span>&#160;             iks_find_attrib(item, <span class="stringliteral">&quot;node&quot;</span>));</div><div class="line"><a name="l04010"></a><span class="lineno"> 4010</span>&#160;      <span class="keywordflow">while</span> ((item = iks_next_tag(item))) {</div><div class="line"><a name="l04011"></a><span class="lineno"> 4011</span>&#160;         <a class="code" href="../../d4/dc5/extconf_8c.html#a81d26348827b996085d4cb6be3e2c348">ast_verbose</a>(<span class="stringliteral">&quot;Node name: %s\n&quot;</span>, iks_find_attrib(item, <span class="stringliteral">&quot;node&quot;</span>));</div><div class="line"><a name="l04012"></a><span class="lineno"> 4012</span>&#160;      }</div><div class="line"><a name="l04013"></a><span class="lineno"> 4013</span>&#160;   }</div><div class="line"><a name="l04014"></a><span class="lineno"> 4014</span>&#160;</div><div class="line"><a name="l04015"></a><span class="lineno"> 4015</span>&#160;   <span class="keywordflow">if</span> (item) {</div><div class="line"><a name="l04016"></a><span class="lineno"> 4016</span>&#160;      iks_delete(item);</div><div class="line"><a name="l04017"></a><span class="lineno"> 4017</span>&#160;   }</div><div class="line"><a name="l04018"></a><span class="lineno"> 4018</span>&#160;</div><div class="line"><a name="l04019"></a><span class="lineno"> 4019</span>&#160;</div><div class="line"><a name="l04020"></a><span class="lineno"> 4020</span>&#160;   <span class="keywordflow">return</span> IKS_FILTER_EAT;</div><div class="line"><a name="l04021"></a><span class="lineno"> 4021</span>&#160;}</div><div class="line"><a name="l04022"></a><span class="lineno"> 4022</span>&#160;<span class="comment"></span></div><div class="line"><a name="l04023"></a><span class="lineno"> 4023</span>&#160;<span class="comment">/*!</span></div><div class="line"><a name="l04024"></a><span class="lineno"> 4024</span>&#160;<span class="comment">* \brief Request item list from pubsub</span></div><div class="line"><a name="l04025"></a><span class="lineno"> 4025</span>&#160;<span class="comment">* \param client the configured XMPP client we use to connect to a XMPP server</span></div><div class="line"><a name="l04026"></a><span class="lineno"> 4026</span>&#160;<span class="comment">* \param collection name of the collection for request</span></div><div class="line"><a name="l04027"></a><span class="lineno"> 4027</span>&#160;<span class="comment">* \return void</span></div><div class="line"><a name="l04028"></a><span class="lineno"> 4028</span>&#160;<span class="comment">*/</span></div><div class="line"><a name="l04029"></a><span class="lineno"><a class="line" href="../../dc/d6b/res__xmpp_8c.html#ac466d42a9eeb5b2faeddf009e8640b33"> 4029</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../dc/d6b/res__xmpp_8c.html#ac466d42a9eeb5b2faeddf009e8640b33">xmpp_pubsub_request_nodes</a>(<span class="keyword">struct</span> <a class="code" href="../../df/d42/structast__xmpp__client.html">ast_xmpp_client</a> *client, <span class="keyword">const</span> <span class="keywordtype">char</span> *collection)</div><div class="line"><a name="l04030"></a><span class="lineno"> 4030</span>&#160;{</div><div class="line"><a name="l04031"></a><span class="lineno"> 4031</span>&#160;   iks *<a class="code" href="../../d0/d29/chan__pjsip_8c.html#a4e2e6fb7d874f0d2deddd2ecfc8afb32">request</a> = <a class="code" href="../../dc/d6b/res__xmpp_8c.html#ab81f77a88ce40a22216d745dbeb9c3be">xmpp_pubsub_build_node_request</a>(client, collection);</div><div class="line"><a name="l04032"></a><span class="lineno"> 4032</span>&#160;</div><div class="line"><a name="l04033"></a><span class="lineno"> 4033</span>&#160;   <span class="keywordflow">if</span> (!request) {</div><div class="line"><a name="l04034"></a><span class="lineno"> 4034</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Could not request pubsub nodes on client &#39;%s&#39; - IQ could not be created\n&quot;</span>, client-&gt;<a class="code" href="../../df/d42/structast__xmpp__client.html#ace9168767fc3707cf5f0a7d049682ba3">name</a>);</div><div class="line"><a name="l04035"></a><span class="lineno"> 4035</span>&#160;      <span class="keywordflow">return</span>;</div><div class="line"><a name="l04036"></a><span class="lineno"> 4036</span>&#160;   }</div><div class="line"><a name="l04037"></a><span class="lineno"> 4037</span>&#160;</div><div class="line"><a name="l04038"></a><span class="lineno"> 4038</span>&#160;   iks_filter_add_rule(client-&gt;<a class="code" href="../../df/d42/structast__xmpp__client.html#a242fce88f9c9954695b13f7af1d415a9">filter</a>, <a class="code" href="../../dc/d6b/res__xmpp_8c.html#aa2256c5ac61afb7f66a1f717a58c39f5">xmpp_pubsub_receive_node_list</a>, client, IKS_RULE_TYPE,</div><div class="line"><a name="l04039"></a><span class="lineno"> 4039</span>&#160;             IKS_PAK_IQ, IKS_RULE_SUBTYPE, IKS_TYPE_RESULT, IKS_RULE_ID, client-&gt;<a class="code" href="../../df/d42/structast__xmpp__client.html#abee5661fa88af477fe47bbbd21136301">mid</a>,</div><div class="line"><a name="l04040"></a><span class="lineno"> 4040</span>&#160;             IKS_RULE_DONE);</div><div class="line"><a name="l04041"></a><span class="lineno"> 4041</span>&#160;   <a class="code" href="../../dc/d6b/res__xmpp_8c.html#a01f156e90984166f2bbcbcc5a4a6e582">ast_xmpp_client_send</a>(client, request);</div><div class="line"><a name="l04042"></a><span class="lineno"> 4042</span>&#160;   iks_delete(request);</div><div class="line"><a name="l04043"></a><span class="lineno"> 4043</span>&#160;</div><div class="line"><a name="l04044"></a><span class="lineno"> 4044</span>&#160;}</div><div class="line"><a name="l04045"></a><span class="lineno"> 4045</span>&#160;</div><div class="line"><a name="l04046"></a><span class="lineno"> 4046</span>&#160;<span class="comment">/*</span></div><div class="line"><a name="l04047"></a><span class="lineno"> 4047</span>&#160;<span class="comment"> * \brief Method to expose PubSub node list via CLI.</span></div><div class="line"><a name="l04048"></a><span class="lineno"> 4048</span>&#160;<span class="comment"> * \param e pointer to ast_cli_entry structure</span></div><div class="line"><a name="l04049"></a><span class="lineno"> 4049</span>&#160;<span class="comment"> * \param cmd</span></div><div class="line"><a name="l04050"></a><span class="lineno"> 4050</span>&#160;<span class="comment"> * \param a pointer to ast_cli_args structure</span></div><div class="line"><a name="l04051"></a><span class="lineno"> 4051</span>&#160;<span class="comment"> * \return char *</span></div><div class="line"><a name="l04052"></a><span class="lineno"> 4052</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l04053"></a><span class="lineno"><a class="line" href="../../dc/d6b/res__xmpp_8c.html#a42466f982f15a72f75bc9c1ce1ecf4ab"> 4053</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">char</span> *<a class="code" href="../../dc/d6b/res__xmpp_8c.html#a42466f982f15a72f75bc9c1ce1ecf4ab">xmpp_cli_list_pubsub_nodes</a>(<span class="keyword">struct</span> <a class="code" href="../../d8/d07/structast__cli__entry.html">ast_cli_entry</a> *e, <span class="keywordtype">int</span> cmd, <span class="keyword">struct</span></div><div class="line"><a name="l04054"></a><span class="lineno"> 4054</span>&#160;               <a class="code" href="../../d3/dad/structast__cli__args.html">ast_cli_args</a> *<a class="code" href="../../d7/d6f/test__linkedlists_8c.html#a13dd15487fee89a002d17ef3aff62d02">a</a>)</div><div class="line"><a name="l04055"></a><span class="lineno"> 4055</span>&#160;{</div><div class="line"><a name="l04056"></a><span class="lineno"> 4056</span>&#160;   <a class="code" href="../../d5/d60/utils_8h.html#a1604b4d72144dd3d9f7da668e90337e9">RAII_VAR</a>(<span class="keyword">struct</span> <a class="code" href="../../de/d1c/structxmpp__config.html">xmpp_config</a> *, cfg, <a class="code" href="../../d5/da5/astobj2_8h.html#a86d8d6c3c8866ed0a60121da055cd225">ao2_global_obj_ref</a>(<a class="code" href="../../d3/d4e/chan__console_8c.html#aa36e3e2c486b920b166c2d17c5242221">globals</a>), <a class="code" href="../../d5/da5/astobj2_8h.html#a6321ee982370c55ab3c24c72c562cbdd">ao2_cleanup</a>);</div><div class="line"><a name="l04057"></a><span class="lineno"> 4057</span>&#160;   <a class="code" href="../../d5/d60/utils_8h.html#a1604b4d72144dd3d9f7da668e90337e9">RAII_VAR</a>(<span class="keyword">struct</span> <a class="code" href="../../da/d00/structast__xmpp__client__config.html">ast_xmpp_client_config</a> *, clientcfg, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../d5/da5/astobj2_8h.html#a6321ee982370c55ab3c24c72c562cbdd">ao2_cleanup</a>);</div><div class="line"><a name="l04058"></a><span class="lineno"> 4058</span>&#160;   <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="../../d0/d29/cdr__mysql_8c.html#a0980a105ccb863d8008eb6201a51da52">name</a> = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, *collection = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l04059"></a><span class="lineno"> 4059</span>&#160;</div><div class="line"><a name="l04060"></a><span class="lineno"> 4060</span>&#160;   <span class="keywordflow">switch</span> (cmd) {</div><div class="line"><a name="l04061"></a><span class="lineno"> 4061</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="../../dc/db0/cli_8h.html#ab33e5350a923c3a8cedbeb496cd88ec9a71745eb63dd093f560a1add3e430d2a9">CLI_INIT</a>:</div><div class="line"><a name="l04062"></a><span class="lineno"> 4062</span>&#160;      e-&gt;<a class="code" href="../../d8/d07/structast__cli__entry.html#ade9cba72805fe52685a1deea307a8e82">command</a> = <span class="stringliteral">&quot;xmpp list nodes&quot;</span>;</div><div class="line"><a name="l04063"></a><span class="lineno"> 4063</span>&#160;      e-&gt;<a class="code" href="../../d8/d07/structast__cli__entry.html#aef1bd6ad890a110b466cb0e8088507a2">usage</a> =</div><div class="line"><a name="l04064"></a><span class="lineno"> 4064</span>&#160;         <span class="stringliteral">&quot;Usage: xmpp list nodes &lt;connection&gt; [collection]\n&quot;</span></div><div class="line"><a name="l04065"></a><span class="lineno"> 4065</span>&#160;         <span class="stringliteral">&quot;       Lists the user&#39;s nodes on the respective connection\n&quot;</span></div><div class="line"><a name="l04066"></a><span class="lineno"> 4066</span>&#160;         <span class="stringliteral">&quot;       ([connection] as configured in xmpp.conf.)\n&quot;</span>;</div><div class="line"><a name="l04067"></a><span class="lineno"> 4067</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l04068"></a><span class="lineno"> 4068</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="../../dc/db0/cli_8h.html#ab33e5350a923c3a8cedbeb496cd88ec9a76bf33139279b03ec1691f2be2d1be40">CLI_GENERATE</a>:</div><div class="line"><a name="l04069"></a><span class="lineno"> 4069</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l04070"></a><span class="lineno"> 4070</span>&#160;   }</div><div class="line"><a name="l04071"></a><span class="lineno"> 4071</span>&#160;</div><div class="line"><a name="l04072"></a><span class="lineno"> 4072</span>&#160;   <span class="keywordflow">if</span> (a-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#a98e1d8441ca58834f11f7367be4b3345">argc</a> &gt; 5 || a-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#a98e1d8441ca58834f11f7367be4b3345">argc</a> &lt; 4) {</div><div class="line"><a name="l04073"></a><span class="lineno"> 4073</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/db0/cli_8h.html#a0873456096960dab21fff0ce68c95acb">CLI_SHOWUSAGE</a>;</div><div class="line"><a name="l04074"></a><span class="lineno"> 4074</span>&#160;   } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (a-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#a98e1d8441ca58834f11f7367be4b3345">argc</a> == 4 || a-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#a98e1d8441ca58834f11f7367be4b3345">argc</a> == 5) {</div><div class="line"><a name="l04075"></a><span class="lineno"> 4075</span>&#160;      name = a-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#ad0a19c4d63698f9e9cfd5653e8851452">argv</a>[3];</div><div class="line"><a name="l04076"></a><span class="lineno"> 4076</span>&#160;   }</div><div class="line"><a name="l04077"></a><span class="lineno"> 4077</span>&#160;</div><div class="line"><a name="l04078"></a><span class="lineno"> 4078</span>&#160;   <span class="keywordflow">if</span> (a-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#a98e1d8441ca58834f11f7367be4b3345">argc</a> == 5) {</div><div class="line"><a name="l04079"></a><span class="lineno"> 4079</span>&#160;      collection = a-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#ad0a19c4d63698f9e9cfd5653e8851452">argv</a>[4];</div><div class="line"><a name="l04080"></a><span class="lineno"> 4080</span>&#160;   }</div><div class="line"><a name="l04081"></a><span class="lineno"> 4081</span>&#160;</div><div class="line"><a name="l04082"></a><span class="lineno"> 4082</span>&#160;   <span class="keywordflow">if</span> (!cfg || !cfg-&gt;clients || !(clientcfg = <a class="code" href="../../dc/d6b/res__xmpp_8c.html#a14d10033fb3b97f06238940259f45266">xmpp_config_find</a>(cfg-&gt;clients, name))) {</div><div class="line"><a name="l04083"></a><span class="lineno"> 4083</span>&#160;      <a class="code" href="../../dc/db0/cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#acf64f219885421479997667d2ed3f08a">fd</a>, <span class="stringliteral">&quot;Unable to find client &#39;%s&#39;!\n&quot;</span>, name);</div><div class="line"><a name="l04084"></a><span class="lineno"> 4084</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/db0/cli_8h.html#ae47751901c430ebb833e59291a5e0b3f">CLI_FAILURE</a>;</div><div class="line"><a name="l04085"></a><span class="lineno"> 4085</span>&#160;   }</div><div class="line"><a name="l04086"></a><span class="lineno"> 4086</span>&#160;</div><div class="line"><a name="l04087"></a><span class="lineno"> 4087</span>&#160;   <a class="code" href="../../dc/db0/cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#acf64f219885421479997667d2ed3f08a">fd</a>, <span class="stringliteral">&quot;Listing pubsub nodes.\n&quot;</span>);</div><div class="line"><a name="l04088"></a><span class="lineno"> 4088</span>&#160;</div><div class="line"><a name="l04089"></a><span class="lineno"> 4089</span>&#160;   <a class="code" href="../../dc/d6b/res__xmpp_8c.html#ac466d42a9eeb5b2faeddf009e8640b33">xmpp_pubsub_request_nodes</a>(clientcfg-&gt;client, collection);</div><div class="line"><a name="l04090"></a><span class="lineno"> 4090</span>&#160;</div><div class="line"><a name="l04091"></a><span class="lineno"> 4091</span>&#160;   <span class="keywordflow">return</span> <a class="code" href="../../dc/db0/cli_8h.html#a50989f00b32eeb2516a3803cb2ffb766">CLI_SUCCESS</a>;</div><div class="line"><a name="l04092"></a><span class="lineno"> 4092</span>&#160;}</div><div class="line"><a name="l04093"></a><span class="lineno"> 4093</span>&#160;<span class="comment"></span></div><div class="line"><a name="l04094"></a><span class="lineno"> 4094</span>&#160;<span class="comment">/*!</span></div><div class="line"><a name="l04095"></a><span class="lineno"> 4095</span>&#160;<span class="comment"> * \brief Delete pubsub item lists</span></div><div class="line"><a name="l04096"></a><span class="lineno"> 4096</span>&#160;<span class="comment"> * \param data pointer to ast_xmpp_client structure</span></div><div class="line"><a name="l04097"></a><span class="lineno"> 4097</span>&#160;<span class="comment"> * \param pak response from pubsub diso#items query</span></div><div class="line"><a name="l04098"></a><span class="lineno"> 4098</span>&#160;<span class="comment"> * \return IKS_FILTER_EAT</span></div><div class="line"><a name="l04099"></a><span class="lineno"> 4099</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l04100"></a><span class="lineno"><a class="line" href="../../dc/d6b/res__xmpp_8c.html#a64092ba9f84b91fb023868280e7d1c81"> 4100</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../dc/d6b/res__xmpp_8c.html#a64092ba9f84b91fb023868280e7d1c81">xmpp_pubsub_delete_node_list</a>(<span class="keywordtype">void</span> *data, ikspak* pak)</div><div class="line"><a name="l04101"></a><span class="lineno"> 4101</span>&#160;{</div><div class="line"><a name="l04102"></a><span class="lineno"> 4102</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../df/d42/structast__xmpp__client.html">ast_xmpp_client</a> *client = data;</div><div class="line"><a name="l04103"></a><span class="lineno"> 4103</span>&#160;   iks *<a class="code" href="../../d8/d4f/test__config_8c.html#aecdc7cbd5dfa76493c0212caa55d706c">item</a> = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l04104"></a><span class="lineno"> 4104</span>&#160;</div><div class="line"><a name="l04105"></a><span class="lineno"> 4105</span>&#160;   <span class="keywordflow">if</span> (iks_has_children(pak-&gt;query)) {</div><div class="line"><a name="l04106"></a><span class="lineno"> 4106</span>&#160;      item = iks_first_tag(pak-&gt;query);</div><div class="line"><a name="l04107"></a><span class="lineno"> 4107</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Connection: %s  Node name: %s\n&quot;</span>, client-&gt;<a class="code" href="../../df/d42/structast__xmpp__client.html#af738439b96e613a471505eb1222ac406">jid</a>-&gt;partial,</div><div class="line"><a name="l04108"></a><span class="lineno"> 4108</span>&#160;         iks_find_attrib(item, <span class="stringliteral">&quot;node&quot;</span>));</div><div class="line"><a name="l04109"></a><span class="lineno"> 4109</span>&#160;      <span class="keywordflow">while</span> ((item = iks_next_tag(item))) {</div><div class="line"><a name="l04110"></a><span class="lineno"> 4110</span>&#160;         <a class="code" href="../../dc/d6b/res__xmpp_8c.html#a7aa063e7e023aac98e55edc4d9faea55">xmpp_pubsub_delete_node</a>(client, iks_find_attrib(item, <span class="stringliteral">&quot;node&quot;</span>));</div><div class="line"><a name="l04111"></a><span class="lineno"> 4111</span>&#160;      }</div><div class="line"><a name="l04112"></a><span class="lineno"> 4112</span>&#160;   }</div><div class="line"><a name="l04113"></a><span class="lineno"> 4113</span>&#160;</div><div class="line"><a name="l04114"></a><span class="lineno"> 4114</span>&#160;   <span class="keywordflow">if</span> (item) {</div><div class="line"><a name="l04115"></a><span class="lineno"> 4115</span>&#160;      iks_delete(item);</div><div class="line"><a name="l04116"></a><span class="lineno"> 4116</span>&#160;   }</div><div class="line"><a name="l04117"></a><span class="lineno"> 4117</span>&#160;</div><div class="line"><a name="l04118"></a><span class="lineno"> 4118</span>&#160;   <span class="keywordflow">return</span> IKS_FILTER_EAT;</div><div class="line"><a name="l04119"></a><span class="lineno"> 4119</span>&#160;}</div><div class="line"><a name="l04120"></a><span class="lineno"> 4120</span>&#160;</div><div class="line"><a name="l04121"></a><span class="lineno"><a class="line" href="../../dc/d6b/res__xmpp_8c.html#a01eac67a11ae1cdbd757bec21e9ee2de"> 4121</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../dc/d6b/res__xmpp_8c.html#a01eac67a11ae1cdbd757bec21e9ee2de">xmpp_pubsub_purge_nodes</a>(<span class="keyword">struct</span> <a class="code" href="../../df/d42/structast__xmpp__client.html">ast_xmpp_client</a> *client, <span class="keyword">const</span> <span class="keywordtype">char</span>* collection_name)</div><div class="line"><a name="l04122"></a><span class="lineno"> 4122</span>&#160;{</div><div class="line"><a name="l04123"></a><span class="lineno"> 4123</span>&#160;   iks *<a class="code" href="../../d0/d29/chan__pjsip_8c.html#a4e2e6fb7d874f0d2deddd2ecfc8afb32">request</a> = <a class="code" href="../../dc/d6b/res__xmpp_8c.html#ab81f77a88ce40a22216d745dbeb9c3be">xmpp_pubsub_build_node_request</a>(client, collection_name);</div><div class="line"><a name="l04124"></a><span class="lineno"> 4124</span>&#160;   <a class="code" href="../../dc/d6b/res__xmpp_8c.html#a01f156e90984166f2bbcbcc5a4a6e582">ast_xmpp_client_send</a>(client, request);</div><div class="line"><a name="l04125"></a><span class="lineno"> 4125</span>&#160;   iks_filter_add_rule(client-&gt;<a class="code" href="../../df/d42/structast__xmpp__client.html#a242fce88f9c9954695b13f7af1d415a9">filter</a>, <a class="code" href="../../dc/d6b/res__xmpp_8c.html#a64092ba9f84b91fb023868280e7d1c81">xmpp_pubsub_delete_node_list</a>, client, IKS_RULE_TYPE,</div><div class="line"><a name="l04126"></a><span class="lineno"> 4126</span>&#160;             IKS_PAK_IQ, IKS_RULE_SUBTYPE, IKS_TYPE_RESULT, IKS_RULE_ID, client-&gt;<a class="code" href="../../df/d42/structast__xmpp__client.html#abee5661fa88af477fe47bbbd21136301">mid</a>,</div><div class="line"><a name="l04127"></a><span class="lineno"> 4127</span>&#160;             IKS_RULE_DONE);</div><div class="line"><a name="l04128"></a><span class="lineno"> 4128</span>&#160;   <a class="code" href="../../dc/d6b/res__xmpp_8c.html#a01f156e90984166f2bbcbcc5a4a6e582">ast_xmpp_client_send</a>(client, request);</div><div class="line"><a name="l04129"></a><span class="lineno"> 4129</span>&#160;   iks_delete(request);</div><div class="line"><a name="l04130"></a><span class="lineno"> 4130</span>&#160;}</div><div class="line"><a name="l04131"></a><span class="lineno"> 4131</span>&#160;<span class="comment"></span></div><div class="line"><a name="l04132"></a><span class="lineno"> 4132</span>&#160;<span class="comment">/*!</span></div><div class="line"><a name="l04133"></a><span class="lineno"> 4133</span>&#160;<span class="comment"> * \brief Method to purge PubSub nodes via CLI.</span></div><div class="line"><a name="l04134"></a><span class="lineno"> 4134</span>&#160;<span class="comment"> * \param e pointer to ast_cli_entry structure</span></div><div class="line"><a name="l04135"></a><span class="lineno"> 4135</span>&#160;<span class="comment"> * \param cmd</span></div><div class="line"><a name="l04136"></a><span class="lineno"> 4136</span>&#160;<span class="comment"> * \param a pointer to ast_cli_args structure</span></div><div class="line"><a name="l04137"></a><span class="lineno"> 4137</span>&#160;<span class="comment"> * \return char *</span></div><div class="line"><a name="l04138"></a><span class="lineno"> 4138</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l04139"></a><span class="lineno"><a class="line" href="../../dc/d6b/res__xmpp_8c.html#acc06b389a6a5247288ad580fde1e56bd"> 4139</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">char</span> *<a class="code" href="../../dc/d6b/res__xmpp_8c.html#acc06b389a6a5247288ad580fde1e56bd">xmpp_cli_purge_pubsub_nodes</a>(<span class="keyword">struct</span> <a class="code" href="../../d8/d07/structast__cli__entry.html">ast_cli_entry</a> *e, <span class="keywordtype">int</span> cmd, <span class="keyword">struct</span></div><div class="line"><a name="l04140"></a><span class="lineno"> 4140</span>&#160;                <a class="code" href="../../d3/dad/structast__cli__args.html">ast_cli_args</a> *<a class="code" href="../../d7/d6f/test__linkedlists_8c.html#a13dd15487fee89a002d17ef3aff62d02">a</a>)</div><div class="line"><a name="l04141"></a><span class="lineno"> 4141</span>&#160;{</div><div class="line"><a name="l04142"></a><span class="lineno"> 4142</span>&#160;   <a class="code" href="../../d5/d60/utils_8h.html#a1604b4d72144dd3d9f7da668e90337e9">RAII_VAR</a>(<span class="keyword">struct</span> <a class="code" href="../../de/d1c/structxmpp__config.html">xmpp_config</a> *, cfg, <a class="code" href="../../d5/da5/astobj2_8h.html#a86d8d6c3c8866ed0a60121da055cd225">ao2_global_obj_ref</a>(<a class="code" href="../../d3/d4e/chan__console_8c.html#aa36e3e2c486b920b166c2d17c5242221">globals</a>), <a class="code" href="../../d5/da5/astobj2_8h.html#a6321ee982370c55ab3c24c72c562cbdd">ao2_cleanup</a>);</div><div class="line"><a name="l04143"></a><span class="lineno"> 4143</span>&#160;   <a class="code" href="../../d5/d60/utils_8h.html#a1604b4d72144dd3d9f7da668e90337e9">RAII_VAR</a>(<span class="keyword">struct</span> <a class="code" href="../../da/d00/structast__xmpp__client__config.html">ast_xmpp_client_config</a> *, clientcfg, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../d5/da5/astobj2_8h.html#a6321ee982370c55ab3c24c72c562cbdd">ao2_cleanup</a>);</div><div class="line"><a name="l04144"></a><span class="lineno"> 4144</span>&#160;   <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="../../d0/d29/cdr__mysql_8c.html#a0980a105ccb863d8008eb6201a51da52">name</a>;</div><div class="line"><a name="l04145"></a><span class="lineno"> 4145</span>&#160;</div><div class="line"><a name="l04146"></a><span class="lineno"> 4146</span>&#160;   <span class="keywordflow">switch</span> (cmd) {</div><div class="line"><a name="l04147"></a><span class="lineno"> 4147</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="../../dc/db0/cli_8h.html#ab33e5350a923c3a8cedbeb496cd88ec9a71745eb63dd093f560a1add3e430d2a9">CLI_INIT</a>:</div><div class="line"><a name="l04148"></a><span class="lineno"> 4148</span>&#160;      e-&gt;<a class="code" href="../../d8/d07/structast__cli__entry.html#ade9cba72805fe52685a1deea307a8e82">command</a> = <span class="stringliteral">&quot;xmpp purge nodes&quot;</span>;</div><div class="line"><a name="l04149"></a><span class="lineno"> 4149</span>&#160;      e-&gt;<a class="code" href="../../d8/d07/structast__cli__entry.html#aef1bd6ad890a110b466cb0e8088507a2">usage</a> =</div><div class="line"><a name="l04150"></a><span class="lineno"> 4150</span>&#160;         <span class="stringliteral">&quot;Usage: xmpp purge nodes &lt;connection&gt; &lt;node&gt;\n&quot;</span></div><div class="line"><a name="l04151"></a><span class="lineno"> 4151</span>&#160;         <span class="stringliteral">&quot;       Purges nodes on PubSub server\n&quot;</span></div><div class="line"><a name="l04152"></a><span class="lineno"> 4152</span>&#160;         <span class="stringliteral">&quot;       as configured in xmpp.conf.\n&quot;</span>;</div><div class="line"><a name="l04153"></a><span class="lineno"> 4153</span>&#160;         <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l04154"></a><span class="lineno"> 4154</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="../../dc/db0/cli_8h.html#ab33e5350a923c3a8cedbeb496cd88ec9a76bf33139279b03ec1691f2be2d1be40">CLI_GENERATE</a>:</div><div class="line"><a name="l04155"></a><span class="lineno"> 4155</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l04156"></a><span class="lineno"> 4156</span>&#160;   }</div><div class="line"><a name="l04157"></a><span class="lineno"> 4157</span>&#160;</div><div class="line"><a name="l04158"></a><span class="lineno"> 4158</span>&#160;   <span class="keywordflow">if</span> (a-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#a98e1d8441ca58834f11f7367be4b3345">argc</a> != 5) {</div><div class="line"><a name="l04159"></a><span class="lineno"> 4159</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/db0/cli_8h.html#a0873456096960dab21fff0ce68c95acb">CLI_SHOWUSAGE</a>;</div><div class="line"><a name="l04160"></a><span class="lineno"> 4160</span>&#160;   }</div><div class="line"><a name="l04161"></a><span class="lineno"> 4161</span>&#160;   name = a-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#ad0a19c4d63698f9e9cfd5653e8851452">argv</a>[3];</div><div class="line"><a name="l04162"></a><span class="lineno"> 4162</span>&#160;</div><div class="line"><a name="l04163"></a><span class="lineno"> 4163</span>&#160;   <span class="keywordflow">if</span> (!cfg || !cfg-&gt;clients || !(clientcfg = <a class="code" href="../../dc/d6b/res__xmpp_8c.html#a14d10033fb3b97f06238940259f45266">xmpp_config_find</a>(cfg-&gt;clients, name))) {</div><div class="line"><a name="l04164"></a><span class="lineno"> 4164</span>&#160;      <a class="code" href="../../dc/db0/cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#acf64f219885421479997667d2ed3f08a">fd</a>, <span class="stringliteral">&quot;Unable to find client &#39;%s&#39;!\n&quot;</span>, name);</div><div class="line"><a name="l04165"></a><span class="lineno"> 4165</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/db0/cli_8h.html#ae47751901c430ebb833e59291a5e0b3f">CLI_FAILURE</a>;</div><div class="line"><a name="l04166"></a><span class="lineno"> 4166</span>&#160;   }</div><div class="line"><a name="l04167"></a><span class="lineno"> 4167</span>&#160;</div><div class="line"><a name="l04168"></a><span class="lineno"> 4168</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d5/d60/utils_8h.html#a00d4c9254c9827d6fa44f17a326744a5">ast_test_flag</a>(&amp;cfg-&gt;global-&gt;pubsub, <a class="code" href="../../dc/d6b/res__xmpp_8c.html#ac5b95f02723021833cc47477b06a962ca045d4dbda72ca97ef5ef8c383279d7dc">XMPP_XEP0248</a>)) {</div><div class="line"><a name="l04169"></a><span class="lineno"> 4169</span>&#160;      <a class="code" href="../../dc/d6b/res__xmpp_8c.html#a01eac67a11ae1cdbd757bec21e9ee2de">xmpp_pubsub_purge_nodes</a>(clientcfg-&gt;client, a-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#ad0a19c4d63698f9e9cfd5653e8851452">argv</a>[4]);</div><div class="line"><a name="l04170"></a><span class="lineno"> 4170</span>&#160;   } <span class="keywordflow">else</span> {</div><div class="line"><a name="l04171"></a><span class="lineno"> 4171</span>&#160;      <a class="code" href="../../dc/d6b/res__xmpp_8c.html#a7aa063e7e023aac98e55edc4d9faea55">xmpp_pubsub_delete_node</a>(clientcfg-&gt;client, a-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#ad0a19c4d63698f9e9cfd5653e8851452">argv</a>[4]);</div><div class="line"><a name="l04172"></a><span class="lineno"> 4172</span>&#160;   }</div><div class="line"><a name="l04173"></a><span class="lineno"> 4173</span>&#160;</div><div class="line"><a name="l04174"></a><span class="lineno"> 4174</span>&#160;   <span class="keywordflow">return</span> <a class="code" href="../../dc/db0/cli_8h.html#a50989f00b32eeb2516a3803cb2ffb766">CLI_SUCCESS</a>;</div><div class="line"><a name="l04175"></a><span class="lineno"> 4175</span>&#160;}</div><div class="line"><a name="l04176"></a><span class="lineno"> 4176</span>&#160;<span class="comment"></span></div><div class="line"><a name="l04177"></a><span class="lineno"> 4177</span>&#160;<span class="comment">/*!</span></div><div class="line"><a name="l04178"></a><span class="lineno"> 4178</span>&#160;<span class="comment"> * \brief Method to expose PubSub node deletion via CLI.</span></div><div class="line"><a name="l04179"></a><span class="lineno"> 4179</span>&#160;<span class="comment"> * \param e pointer to ast_cli_entry structure</span></div><div class="line"><a name="l04180"></a><span class="lineno"> 4180</span>&#160;<span class="comment"> * \param cmd</span></div><div class="line"><a name="l04181"></a><span class="lineno"> 4181</span>&#160;<span class="comment"> * \param a pointer to ast_cli_args structure</span></div><div class="line"><a name="l04182"></a><span class="lineno"> 4182</span>&#160;<span class="comment"> * \return char *</span></div><div class="line"><a name="l04183"></a><span class="lineno"> 4183</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l04184"></a><span class="lineno"><a class="line" href="../../dc/d6b/res__xmpp_8c.html#ac8e69048e81bd7cf71a4f623262fe67b"> 4184</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">char</span> *<a class="code" href="../../dc/d6b/res__xmpp_8c.html#ac8e69048e81bd7cf71a4f623262fe67b">xmpp_cli_delete_pubsub_node</a>(<span class="keyword">struct</span> <a class="code" href="../../d8/d07/structast__cli__entry.html">ast_cli_entry</a> *e, <span class="keywordtype">int</span> cmd, <span class="keyword">struct</span></div><div class="line"><a name="l04185"></a><span class="lineno"> 4185</span>&#160;               <a class="code" href="../../d3/dad/structast__cli__args.html">ast_cli_args</a> *<a class="code" href="../../d7/d6f/test__linkedlists_8c.html#a13dd15487fee89a002d17ef3aff62d02">a</a>)</div><div class="line"><a name="l04186"></a><span class="lineno"> 4186</span>&#160;{</div><div class="line"><a name="l04187"></a><span class="lineno"> 4187</span>&#160;   <a class="code" href="../../d5/d60/utils_8h.html#a1604b4d72144dd3d9f7da668e90337e9">RAII_VAR</a>(<span class="keyword">struct</span> <a class="code" href="../../de/d1c/structxmpp__config.html">xmpp_config</a> *, cfg, <a class="code" href="../../d5/da5/astobj2_8h.html#a86d8d6c3c8866ed0a60121da055cd225">ao2_global_obj_ref</a>(<a class="code" href="../../d3/d4e/chan__console_8c.html#aa36e3e2c486b920b166c2d17c5242221">globals</a>), <a class="code" href="../../d5/da5/astobj2_8h.html#a6321ee982370c55ab3c24c72c562cbdd">ao2_cleanup</a>);</div><div class="line"><a name="l04188"></a><span class="lineno"> 4188</span>&#160;   <a class="code" href="../../d5/d60/utils_8h.html#a1604b4d72144dd3d9f7da668e90337e9">RAII_VAR</a>(<span class="keyword">struct</span> <a class="code" href="../../da/d00/structast__xmpp__client__config.html">ast_xmpp_client_config</a> *, clientcfg, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../d5/da5/astobj2_8h.html#a6321ee982370c55ab3c24c72c562cbdd">ao2_cleanup</a>);</div><div class="line"><a name="l04189"></a><span class="lineno"> 4189</span>&#160;   <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="../../d0/d29/cdr__mysql_8c.html#a0980a105ccb863d8008eb6201a51da52">name</a>;</div><div class="line"><a name="l04190"></a><span class="lineno"> 4190</span>&#160;</div><div class="line"><a name="l04191"></a><span class="lineno"> 4191</span>&#160;   <span class="keywordflow">switch</span> (cmd) {</div><div class="line"><a name="l04192"></a><span class="lineno"> 4192</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="../../dc/db0/cli_8h.html#ab33e5350a923c3a8cedbeb496cd88ec9a71745eb63dd093f560a1add3e430d2a9">CLI_INIT</a>:</div><div class="line"><a name="l04193"></a><span class="lineno"> 4193</span>&#160;      e-&gt;<a class="code" href="../../d8/d07/structast__cli__entry.html#ade9cba72805fe52685a1deea307a8e82">command</a> = <span class="stringliteral">&quot;xmpp delete node&quot;</span>;</div><div class="line"><a name="l04194"></a><span class="lineno"> 4194</span>&#160;      e-&gt;<a class="code" href="../../d8/d07/structast__cli__entry.html#aef1bd6ad890a110b466cb0e8088507a2">usage</a> =</div><div class="line"><a name="l04195"></a><span class="lineno"> 4195</span>&#160;         <span class="stringliteral">&quot;Usage: xmpp delete node &lt;connection&gt; &lt;node&gt;\n&quot;</span></div><div class="line"><a name="l04196"></a><span class="lineno"> 4196</span>&#160;         <span class="stringliteral">&quot;       Deletes a node on PubSub server\n&quot;</span></div><div class="line"><a name="l04197"></a><span class="lineno"> 4197</span>&#160;         <span class="stringliteral">&quot;       as configured in xmpp.conf.\n&quot;</span>;</div><div class="line"><a name="l04198"></a><span class="lineno"> 4198</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l04199"></a><span class="lineno"> 4199</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="../../dc/db0/cli_8h.html#ab33e5350a923c3a8cedbeb496cd88ec9a76bf33139279b03ec1691f2be2d1be40">CLI_GENERATE</a>:</div><div class="line"><a name="l04200"></a><span class="lineno"> 4200</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l04201"></a><span class="lineno"> 4201</span>&#160;   }</div><div class="line"><a name="l04202"></a><span class="lineno"> 4202</span>&#160;</div><div class="line"><a name="l04203"></a><span class="lineno"> 4203</span>&#160;   <span class="keywordflow">if</span> (a-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#a98e1d8441ca58834f11f7367be4b3345">argc</a> != 5) {</div><div class="line"><a name="l04204"></a><span class="lineno"> 4204</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/db0/cli_8h.html#a0873456096960dab21fff0ce68c95acb">CLI_SHOWUSAGE</a>;</div><div class="line"><a name="l04205"></a><span class="lineno"> 4205</span>&#160;   }</div><div class="line"><a name="l04206"></a><span class="lineno"> 4206</span>&#160;   name = a-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#ad0a19c4d63698f9e9cfd5653e8851452">argv</a>[3];</div><div class="line"><a name="l04207"></a><span class="lineno"> 4207</span>&#160;</div><div class="line"><a name="l04208"></a><span class="lineno"> 4208</span>&#160;   <span class="keywordflow">if</span> (!cfg || !cfg-&gt;clients || !(clientcfg = <a class="code" href="../../dc/d6b/res__xmpp_8c.html#a14d10033fb3b97f06238940259f45266">xmpp_config_find</a>(cfg-&gt;clients, name))) {</div><div class="line"><a name="l04209"></a><span class="lineno"> 4209</span>&#160;      <a class="code" href="../../dc/db0/cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#acf64f219885421479997667d2ed3f08a">fd</a>, <span class="stringliteral">&quot;Unable to find client &#39;%s&#39;!\n&quot;</span>, name);</div><div class="line"><a name="l04210"></a><span class="lineno"> 4210</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/db0/cli_8h.html#ae47751901c430ebb833e59291a5e0b3f">CLI_FAILURE</a>;</div><div class="line"><a name="l04211"></a><span class="lineno"> 4211</span>&#160;   }</div><div class="line"><a name="l04212"></a><span class="lineno"> 4212</span>&#160;</div><div class="line"><a name="l04213"></a><span class="lineno"> 4213</span>&#160;   <a class="code" href="../../dc/d6b/res__xmpp_8c.html#a7aa063e7e023aac98e55edc4d9faea55">xmpp_pubsub_delete_node</a>(clientcfg-&gt;client, a-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#ad0a19c4d63698f9e9cfd5653e8851452">argv</a>[4]);</div><div class="line"><a name="l04214"></a><span class="lineno"> 4214</span>&#160;</div><div class="line"><a name="l04215"></a><span class="lineno"> 4215</span>&#160;   <span class="keywordflow">return</span> <a class="code" href="../../dc/db0/cli_8h.html#a50989f00b32eeb2516a3803cb2ffb766">CLI_SUCCESS</a>;</div><div class="line"><a name="l04216"></a><span class="lineno"> 4216</span>&#160;}</div><div class="line"><a name="l04217"></a><span class="lineno"> 4217</span>&#160;<span class="comment"></span></div><div class="line"><a name="l04218"></a><span class="lineno"> 4218</span>&#160;<span class="comment">/*!</span></div><div class="line"><a name="l04219"></a><span class="lineno"> 4219</span>&#160;<span class="comment"> * \brief Method to expose PubSub collection node creation via CLI.</span></div><div class="line"><a name="l04220"></a><span class="lineno"> 4220</span>&#160;<span class="comment"> * \return char *.</span></div><div class="line"><a name="l04221"></a><span class="lineno"> 4221</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l04222"></a><span class="lineno"><a class="line" href="../../dc/d6b/res__xmpp_8c.html#a783db61e3ab13bfd85c23fad88f30b9b"> 4222</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">char</span> *<a class="code" href="../../dc/d6b/res__xmpp_8c.html#a783db61e3ab13bfd85c23fad88f30b9b">xmpp_cli_create_collection</a>(<span class="keyword">struct</span> <a class="code" href="../../d8/d07/structast__cli__entry.html">ast_cli_entry</a> *e, <span class="keywordtype">int</span> cmd, <span class="keyword">struct</span> <a class="code" href="../../d3/dad/structast__cli__args.html">ast_cli_args</a> *<a class="code" href="../../d7/d6f/test__linkedlists_8c.html#a13dd15487fee89a002d17ef3aff62d02">a</a>)</div><div class="line"><a name="l04223"></a><span class="lineno"> 4223</span>&#160;{</div><div class="line"><a name="l04224"></a><span class="lineno"> 4224</span>&#160;   <a class="code" href="../../d5/d60/utils_8h.html#a1604b4d72144dd3d9f7da668e90337e9">RAII_VAR</a>(<span class="keyword">struct</span> <a class="code" href="../../de/d1c/structxmpp__config.html">xmpp_config</a> *, cfg, <a class="code" href="../../d5/da5/astobj2_8h.html#a86d8d6c3c8866ed0a60121da055cd225">ao2_global_obj_ref</a>(<a class="code" href="../../d3/d4e/chan__console_8c.html#aa36e3e2c486b920b166c2d17c5242221">globals</a>), <a class="code" href="../../d5/da5/astobj2_8h.html#a6321ee982370c55ab3c24c72c562cbdd">ao2_cleanup</a>);</div><div class="line"><a name="l04225"></a><span class="lineno"> 4225</span>&#160;   <a class="code" href="../../d5/d60/utils_8h.html#a1604b4d72144dd3d9f7da668e90337e9">RAII_VAR</a>(<span class="keyword">struct</span> <a class="code" href="../../da/d00/structast__xmpp__client__config.html">ast_xmpp_client_config</a> *, clientcfg, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../d5/da5/astobj2_8h.html#a6321ee982370c55ab3c24c72c562cbdd">ao2_cleanup</a>);</div><div class="line"><a name="l04226"></a><span class="lineno"> 4226</span>&#160;   <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="../../d0/d29/cdr__mysql_8c.html#a0980a105ccb863d8008eb6201a51da52">name</a>, *collection_name;</div><div class="line"><a name="l04227"></a><span class="lineno"> 4227</span>&#160;</div><div class="line"><a name="l04228"></a><span class="lineno"> 4228</span>&#160;   <span class="keywordflow">switch</span> (cmd) {</div><div class="line"><a name="l04229"></a><span class="lineno"> 4229</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="../../dc/db0/cli_8h.html#ab33e5350a923c3a8cedbeb496cd88ec9a71745eb63dd093f560a1add3e430d2a9">CLI_INIT</a>:</div><div class="line"><a name="l04230"></a><span class="lineno"> 4230</span>&#160;      e-&gt;<a class="code" href="../../d8/d07/structast__cli__entry.html#ade9cba72805fe52685a1deea307a8e82">command</a> = <span class="stringliteral">&quot;xmpp create collection&quot;</span>;</div><div class="line"><a name="l04231"></a><span class="lineno"> 4231</span>&#160;      e-&gt;<a class="code" href="../../d8/d07/structast__cli__entry.html#aef1bd6ad890a110b466cb0e8088507a2">usage</a> =</div><div class="line"><a name="l04232"></a><span class="lineno"> 4232</span>&#160;         <span class="stringliteral">&quot;Usage: xmpp create collection &lt;connection&gt; &lt;collection&gt;\n&quot;</span></div><div class="line"><a name="l04233"></a><span class="lineno"> 4233</span>&#160;         <span class="stringliteral">&quot;       Creates a PubSub collection node using the account\n&quot;</span></div><div class="line"><a name="l04234"></a><span class="lineno"> 4234</span>&#160;         <span class="stringliteral">&quot;       as configured in xmpp.conf.\n&quot;</span>;</div><div class="line"><a name="l04235"></a><span class="lineno"> 4235</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l04236"></a><span class="lineno"> 4236</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="../../dc/db0/cli_8h.html#ab33e5350a923c3a8cedbeb496cd88ec9a76bf33139279b03ec1691f2be2d1be40">CLI_GENERATE</a>:</div><div class="line"><a name="l04237"></a><span class="lineno"> 4237</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l04238"></a><span class="lineno"> 4238</span>&#160;   }</div><div class="line"><a name="l04239"></a><span class="lineno"> 4239</span>&#160;</div><div class="line"><a name="l04240"></a><span class="lineno"> 4240</span>&#160;   <span class="keywordflow">if</span> (a-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#a98e1d8441ca58834f11f7367be4b3345">argc</a> != 5) {</div><div class="line"><a name="l04241"></a><span class="lineno"> 4241</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/db0/cli_8h.html#a0873456096960dab21fff0ce68c95acb">CLI_SHOWUSAGE</a>;</div><div class="line"><a name="l04242"></a><span class="lineno"> 4242</span>&#160;   }</div><div class="line"><a name="l04243"></a><span class="lineno"> 4243</span>&#160;   name = a-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#ad0a19c4d63698f9e9cfd5653e8851452">argv</a>[3];</div><div class="line"><a name="l04244"></a><span class="lineno"> 4244</span>&#160;   collection_name = a-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#ad0a19c4d63698f9e9cfd5653e8851452">argv</a>[4];</div><div class="line"><a name="l04245"></a><span class="lineno"> 4245</span>&#160;</div><div class="line"><a name="l04246"></a><span class="lineno"> 4246</span>&#160;   <span class="keywordflow">if</span> (!cfg || !cfg-&gt;clients || !(clientcfg = <a class="code" href="../../dc/d6b/res__xmpp_8c.html#a14d10033fb3b97f06238940259f45266">xmpp_config_find</a>(cfg-&gt;clients, name))) {</div><div class="line"><a name="l04247"></a><span class="lineno"> 4247</span>&#160;      <a class="code" href="../../dc/db0/cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#acf64f219885421479997667d2ed3f08a">fd</a>, <span class="stringliteral">&quot;Unable to find client &#39;%s&#39;!\n&quot;</span>, name);</div><div class="line"><a name="l04248"></a><span class="lineno"> 4248</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/db0/cli_8h.html#ae47751901c430ebb833e59291a5e0b3f">CLI_FAILURE</a>;</div><div class="line"><a name="l04249"></a><span class="lineno"> 4249</span>&#160;   }</div><div class="line"><a name="l04250"></a><span class="lineno"> 4250</span>&#160;</div><div class="line"><a name="l04251"></a><span class="lineno"> 4251</span>&#160;   <a class="code" href="../../dc/db0/cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#acf64f219885421479997667d2ed3f08a">fd</a>, <span class="stringliteral">&quot;Creating test PubSub node collection.\n&quot;</span>);</div><div class="line"><a name="l04252"></a><span class="lineno"> 4252</span>&#160;</div><div class="line"><a name="l04253"></a><span class="lineno"> 4253</span>&#160;   <a class="code" href="../../dc/d6b/res__xmpp_8c.html#a64804aabc6379d1e89d71ac9ae686654">xmpp_pubsub_create_collection</a>(clientcfg-&gt;client, collection_name);</div><div class="line"><a name="l04254"></a><span class="lineno"> 4254</span>&#160;</div><div class="line"><a name="l04255"></a><span class="lineno"> 4255</span>&#160;   <span class="keywordflow">return</span> <a class="code" href="../../dc/db0/cli_8h.html#a50989f00b32eeb2516a3803cb2ffb766">CLI_SUCCESS</a>;</div><div class="line"><a name="l04256"></a><span class="lineno"> 4256</span>&#160;}</div><div class="line"><a name="l04257"></a><span class="lineno"> 4257</span>&#160;<span class="comment"></span></div><div class="line"><a name="l04258"></a><span class="lineno"> 4258</span>&#160;<span class="comment">/*!</span></div><div class="line"><a name="l04259"></a><span class="lineno"> 4259</span>&#160;<span class="comment"> * \brief Method to expose PubSub leaf node creation via CLI.</span></div><div class="line"><a name="l04260"></a><span class="lineno"> 4260</span>&#160;<span class="comment"> * \return char *.</span></div><div class="line"><a name="l04261"></a><span class="lineno"> 4261</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l04262"></a><span class="lineno"><a class="line" href="../../dc/d6b/res__xmpp_8c.html#af90c7b8a64756048c4816729b5a2a141"> 4262</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">char</span> *<a class="code" href="../../dc/d6b/res__xmpp_8c.html#af90c7b8a64756048c4816729b5a2a141">xmpp_cli_create_leafnode</a>(<span class="keyword">struct</span> <a class="code" href="../../d8/d07/structast__cli__entry.html">ast_cli_entry</a> *e, <span class="keywordtype">int</span> cmd, <span class="keyword">struct</span> <a class="code" href="../../d3/dad/structast__cli__args.html">ast_cli_args</a> *<a class="code" href="../../d7/d6f/test__linkedlists_8c.html#a13dd15487fee89a002d17ef3aff62d02">a</a>)</div><div class="line"><a name="l04263"></a><span class="lineno"> 4263</span>&#160;{</div><div class="line"><a name="l04264"></a><span class="lineno"> 4264</span>&#160;   <a class="code" href="../../d5/d60/utils_8h.html#a1604b4d72144dd3d9f7da668e90337e9">RAII_VAR</a>(<span class="keyword">struct</span> <a class="code" href="../../de/d1c/structxmpp__config.html">xmpp_config</a> *, cfg, <a class="code" href="../../d5/da5/astobj2_8h.html#a86d8d6c3c8866ed0a60121da055cd225">ao2_global_obj_ref</a>(<a class="code" href="../../d3/d4e/chan__console_8c.html#aa36e3e2c486b920b166c2d17c5242221">globals</a>), <a class="code" href="../../d5/da5/astobj2_8h.html#a6321ee982370c55ab3c24c72c562cbdd">ao2_cleanup</a>);</div><div class="line"><a name="l04265"></a><span class="lineno"> 4265</span>&#160;   <a class="code" href="../../d5/d60/utils_8h.html#a1604b4d72144dd3d9f7da668e90337e9">RAII_VAR</a>(<span class="keyword">struct</span> <a class="code" href="../../da/d00/structast__xmpp__client__config.html">ast_xmpp_client_config</a> *, clientcfg, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../d5/da5/astobj2_8h.html#a6321ee982370c55ab3c24c72c562cbdd">ao2_cleanup</a>);</div><div class="line"><a name="l04266"></a><span class="lineno"> 4266</span>&#160;   <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="../../d0/d29/cdr__mysql_8c.html#a0980a105ccb863d8008eb6201a51da52">name</a>, *collection_name, *leaf_name;</div><div class="line"><a name="l04267"></a><span class="lineno"> 4267</span>&#160;</div><div class="line"><a name="l04268"></a><span class="lineno"> 4268</span>&#160;   <span class="keywordflow">switch</span> (cmd) {</div><div class="line"><a name="l04269"></a><span class="lineno"> 4269</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="../../dc/db0/cli_8h.html#ab33e5350a923c3a8cedbeb496cd88ec9a71745eb63dd093f560a1add3e430d2a9">CLI_INIT</a>:</div><div class="line"><a name="l04270"></a><span class="lineno"> 4270</span>&#160;      e-&gt;<a class="code" href="../../d8/d07/structast__cli__entry.html#ade9cba72805fe52685a1deea307a8e82">command</a> = <span class="stringliteral">&quot;xmpp create leaf&quot;</span>;</div><div class="line"><a name="l04271"></a><span class="lineno"> 4271</span>&#160;      e-&gt;<a class="code" href="../../d8/d07/structast__cli__entry.html#aef1bd6ad890a110b466cb0e8088507a2">usage</a> =</div><div class="line"><a name="l04272"></a><span class="lineno"> 4272</span>&#160;         <span class="stringliteral">&quot;Usage: xmpp create leaf &lt;connection&gt; &lt;collection&gt; &lt;leaf&gt;\n&quot;</span></div><div class="line"><a name="l04273"></a><span class="lineno"> 4273</span>&#160;         <span class="stringliteral">&quot;       Creates a PubSub leaf node using the account\n&quot;</span></div><div class="line"><a name="l04274"></a><span class="lineno"> 4274</span>&#160;         <span class="stringliteral">&quot;       as configured in xmpp.conf.\n&quot;</span>;</div><div class="line"><a name="l04275"></a><span class="lineno"> 4275</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l04276"></a><span class="lineno"> 4276</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="../../dc/db0/cli_8h.html#ab33e5350a923c3a8cedbeb496cd88ec9a76bf33139279b03ec1691f2be2d1be40">CLI_GENERATE</a>:</div><div class="line"><a name="l04277"></a><span class="lineno"> 4277</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l04278"></a><span class="lineno"> 4278</span>&#160;   }</div><div class="line"><a name="l04279"></a><span class="lineno"> 4279</span>&#160;</div><div class="line"><a name="l04280"></a><span class="lineno"> 4280</span>&#160;   <span class="keywordflow">if</span> (a-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#a98e1d8441ca58834f11f7367be4b3345">argc</a> != 6) {</div><div class="line"><a name="l04281"></a><span class="lineno"> 4281</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/db0/cli_8h.html#a0873456096960dab21fff0ce68c95acb">CLI_SHOWUSAGE</a>;</div><div class="line"><a name="l04282"></a><span class="lineno"> 4282</span>&#160;   }</div><div class="line"><a name="l04283"></a><span class="lineno"> 4283</span>&#160;   name = a-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#ad0a19c4d63698f9e9cfd5653e8851452">argv</a>[3];</div><div class="line"><a name="l04284"></a><span class="lineno"> 4284</span>&#160;   collection_name = a-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#ad0a19c4d63698f9e9cfd5653e8851452">argv</a>[4];</div><div class="line"><a name="l04285"></a><span class="lineno"> 4285</span>&#160;   leaf_name = a-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#ad0a19c4d63698f9e9cfd5653e8851452">argv</a>[5];</div><div class="line"><a name="l04286"></a><span class="lineno"> 4286</span>&#160;</div><div class="line"><a name="l04287"></a><span class="lineno"> 4287</span>&#160;   <span class="keywordflow">if</span> (!cfg || !cfg-&gt;clients || !(clientcfg = <a class="code" href="../../dc/d6b/res__xmpp_8c.html#a14d10033fb3b97f06238940259f45266">xmpp_config_find</a>(cfg-&gt;clients, name))) {</div><div class="line"><a name="l04288"></a><span class="lineno"> 4288</span>&#160;      <a class="code" href="../../dc/db0/cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#acf64f219885421479997667d2ed3f08a">fd</a>, <span class="stringliteral">&quot;Unable to find client &#39;%s&#39;!\n&quot;</span>, name);</div><div class="line"><a name="l04289"></a><span class="lineno"> 4289</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/db0/cli_8h.html#ae47751901c430ebb833e59291a5e0b3f">CLI_FAILURE</a>;</div><div class="line"><a name="l04290"></a><span class="lineno"> 4290</span>&#160;   }</div><div class="line"><a name="l04291"></a><span class="lineno"> 4291</span>&#160;</div><div class="line"><a name="l04292"></a><span class="lineno"> 4292</span>&#160;   <a class="code" href="../../dc/db0/cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#acf64f219885421479997667d2ed3f08a">fd</a>, <span class="stringliteral">&quot;Creating test PubSub node collection.\n&quot;</span>);</div><div class="line"><a name="l04293"></a><span class="lineno"> 4293</span>&#160;</div><div class="line"><a name="l04294"></a><span class="lineno"> 4294</span>&#160;   <a class="code" href="../../dc/d6b/res__xmpp_8c.html#a8e8150ade4edbd105394640480f6cd2c">xmpp_pubsub_create_leaf</a>(clientcfg-&gt;client, collection_name, leaf_name);</div><div class="line"><a name="l04295"></a><span class="lineno"> 4295</span>&#160;</div><div class="line"><a name="l04296"></a><span class="lineno"> 4296</span>&#160;   <span class="keywordflow">return</span> <a class="code" href="../../dc/db0/cli_8h.html#a50989f00b32eeb2516a3803cb2ffb766">CLI_SUCCESS</a>;</div><div class="line"><a name="l04297"></a><span class="lineno"> 4297</span>&#160;}</div><div class="line"><a name="l04298"></a><span class="lineno"> 4298</span>&#160;<span class="comment"></span></div><div class="line"><a name="l04299"></a><span class="lineno"> 4299</span>&#160;<span class="comment">/*!</span></div><div class="line"><a name="l04300"></a><span class="lineno"> 4300</span>&#160;<span class="comment"> * \internal</span></div><div class="line"><a name="l04301"></a><span class="lineno"> 4301</span>&#160;<span class="comment"> * \brief Turn on/off console debugging.</span></div><div class="line"><a name="l04302"></a><span class="lineno"> 4302</span>&#160;<span class="comment"> * \return CLI_SUCCESS.</span></div><div class="line"><a name="l04303"></a><span class="lineno"> 4303</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l04304"></a><span class="lineno"><a class="line" href="../../dc/d6b/res__xmpp_8c.html#aa1b7f2cc76fae598ccb5315910a6093a"> 4304</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">char</span> *<a class="code" href="../../dc/d6b/res__xmpp_8c.html#aa1b7f2cc76fae598ccb5315910a6093a">xmpp_do_set_debug</a>(<span class="keyword">struct</span> <a class="code" href="../../d8/d07/structast__cli__entry.html">ast_cli_entry</a> *e, <span class="keywordtype">int</span> cmd, <span class="keyword">struct</span> <a class="code" href="../../d3/dad/structast__cli__args.html">ast_cli_args</a> *<a class="code" href="../../d7/d6f/test__linkedlists_8c.html#a13dd15487fee89a002d17ef3aff62d02">a</a>)</div><div class="line"><a name="l04305"></a><span class="lineno"> 4305</span>&#160;{</div><div class="line"><a name="l04306"></a><span class="lineno"> 4306</span>&#160;   <span class="keywordflow">switch</span> (cmd) {</div><div class="line"><a name="l04307"></a><span class="lineno"> 4307</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="../../dc/db0/cli_8h.html#ab33e5350a923c3a8cedbeb496cd88ec9a71745eb63dd093f560a1add3e430d2a9">CLI_INIT</a>:</div><div class="line"><a name="l04308"></a><span class="lineno"> 4308</span>&#160;      e-&gt;<a class="code" href="../../d8/d07/structast__cli__entry.html#ade9cba72805fe52685a1deea307a8e82">command</a> = <span class="stringliteral">&quot;xmpp set debug {on|off}&quot;</span>;</div><div class="line"><a name="l04309"></a><span class="lineno"> 4309</span>&#160;      e-&gt;<a class="code" href="../../d8/d07/structast__cli__entry.html#aef1bd6ad890a110b466cb0e8088507a2">usage</a> =</div><div class="line"><a name="l04310"></a><span class="lineno"> 4310</span>&#160;         <span class="stringliteral">&quot;Usage: xmpp set debug {on|off}\n&quot;</span></div><div class="line"><a name="l04311"></a><span class="lineno"> 4311</span>&#160;         <span class="stringliteral">&quot;       Enables/disables dumping of XMPP/Jabber packets for debugging purposes.\n&quot;</span>;</div><div class="line"><a name="l04312"></a><span class="lineno"> 4312</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l04313"></a><span class="lineno"> 4313</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="../../dc/db0/cli_8h.html#ab33e5350a923c3a8cedbeb496cd88ec9a76bf33139279b03ec1691f2be2d1be40">CLI_GENERATE</a>:</div><div class="line"><a name="l04314"></a><span class="lineno"> 4314</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l04315"></a><span class="lineno"> 4315</span>&#160;   }</div><div class="line"><a name="l04316"></a><span class="lineno"> 4316</span>&#160;</div><div class="line"><a name="l04317"></a><span class="lineno"> 4317</span>&#160;   <span class="keywordflow">if</span> (a-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#a98e1d8441ca58834f11f7367be4b3345">argc</a> != e-&gt;<a class="code" href="../../d8/d07/structast__cli__entry.html#a1bd7a8575ca2650132d636d65dcda2f6">args</a>) {</div><div class="line"><a name="l04318"></a><span class="lineno"> 4318</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/db0/cli_8h.html#a0873456096960dab21fff0ce68c95acb">CLI_SHOWUSAGE</a>;</div><div class="line"><a name="l04319"></a><span class="lineno"> 4319</span>&#160;   }</div><div class="line"><a name="l04320"></a><span class="lineno"> 4320</span>&#160;</div><div class="line"><a name="l04321"></a><span class="lineno"> 4321</span>&#160;   <span class="keywordflow">if</span> (!strncasecmp(a-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#ad0a19c4d63698f9e9cfd5653e8851452">argv</a>[e-&gt;<a class="code" href="../../d8/d07/structast__cli__entry.html#a1bd7a8575ca2650132d636d65dcda2f6">args</a> - 1], <span class="stringliteral">&quot;on&quot;</span>, 2)) {</div><div class="line"><a name="l04322"></a><span class="lineno"> 4322</span>&#160;      debug = 1;</div><div class="line"><a name="l04323"></a><span class="lineno"> 4323</span>&#160;      <a class="code" href="../../dc/db0/cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#acf64f219885421479997667d2ed3f08a">fd</a>, <span class="stringliteral">&quot;XMPP Debugging Enabled.\n&quot;</span>);</div><div class="line"><a name="l04324"></a><span class="lineno"> 4324</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/db0/cli_8h.html#a50989f00b32eeb2516a3803cb2ffb766">CLI_SUCCESS</a>;</div><div class="line"><a name="l04325"></a><span class="lineno"> 4325</span>&#160;   } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strncasecmp(a-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#ad0a19c4d63698f9e9cfd5653e8851452">argv</a>[e-&gt;<a class="code" href="../../d8/d07/structast__cli__entry.html#a1bd7a8575ca2650132d636d65dcda2f6">args</a> - 1], <span class="stringliteral">&quot;off&quot;</span>, 3)) {</div><div class="line"><a name="l04326"></a><span class="lineno"> 4326</span>&#160;      debug = 0;</div><div class="line"><a name="l04327"></a><span class="lineno"> 4327</span>&#160;      <a class="code" href="../../dc/db0/cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#acf64f219885421479997667d2ed3f08a">fd</a>, <span class="stringliteral">&quot;XMPP Debugging Disabled.\n&quot;</span>);</div><div class="line"><a name="l04328"></a><span class="lineno"> 4328</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/db0/cli_8h.html#a50989f00b32eeb2516a3803cb2ffb766">CLI_SUCCESS</a>;</div><div class="line"><a name="l04329"></a><span class="lineno"> 4329</span>&#160;   }</div><div class="line"><a name="l04330"></a><span class="lineno"> 4330</span>&#160;   <span class="keywordflow">return</span> <a class="code" href="../../dc/db0/cli_8h.html#a0873456096960dab21fff0ce68c95acb">CLI_SHOWUSAGE</a>; <span class="comment">/* defaults to invalid */</span></div><div class="line"><a name="l04331"></a><span class="lineno"> 4331</span>&#160;}</div><div class="line"><a name="l04332"></a><span class="lineno"> 4332</span>&#160;<span class="comment"></span></div><div class="line"><a name="l04333"></a><span class="lineno"> 4333</span>&#160;<span class="comment">/*!</span></div><div class="line"><a name="l04334"></a><span class="lineno"> 4334</span>&#160;<span class="comment"> * \internal</span></div><div class="line"><a name="l04335"></a><span class="lineno"> 4335</span>&#160;<span class="comment"> * \brief Show client status.</span></div><div class="line"><a name="l04336"></a><span class="lineno"> 4336</span>&#160;<span class="comment"> * \return CLI_SUCCESS.</span></div><div class="line"><a name="l04337"></a><span class="lineno"> 4337</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l04338"></a><span class="lineno"><a class="line" href="../../dc/d6b/res__xmpp_8c.html#ae14a19eca8ea66ff91e63ea8f6cb33f4"> 4338</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">char</span> *<a class="code" href="../../dc/d6b/res__xmpp_8c.html#ae14a19eca8ea66ff91e63ea8f6cb33f4">xmpp_show_clients</a>(<span class="keyword">struct</span> <a class="code" href="../../d8/d07/structast__cli__entry.html">ast_cli_entry</a> *e, <span class="keywordtype">int</span> cmd, <span class="keyword">struct</span> <a class="code" href="../../d3/dad/structast__cli__args.html">ast_cli_args</a> *<a class="code" href="../../d7/d6f/test__linkedlists_8c.html#a13dd15487fee89a002d17ef3aff62d02">a</a>)</div><div class="line"><a name="l04339"></a><span class="lineno"> 4339</span>&#160;{</div><div class="line"><a name="l04340"></a><span class="lineno"> 4340</span>&#160;   <a class="code" href="../../d5/d60/utils_8h.html#a1604b4d72144dd3d9f7da668e90337e9">RAII_VAR</a>(<span class="keyword">struct</span> <a class="code" href="../../de/d1c/structxmpp__config.html">xmpp_config</a> *, cfg, <a class="code" href="../../d5/da5/astobj2_8h.html#a86d8d6c3c8866ed0a60121da055cd225">ao2_global_obj_ref</a>(<a class="code" href="../../d3/d4e/chan__console_8c.html#aa36e3e2c486b920b166c2d17c5242221">globals</a>), <a class="code" href="../../d5/da5/astobj2_8h.html#a6321ee982370c55ab3c24c72c562cbdd">ao2_cleanup</a>);</div><div class="line"><a name="l04341"></a><span class="lineno"> 4341</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d9/d97/structao2__iterator.html">ao2_iterator</a> i;</div><div class="line"><a name="l04342"></a><span class="lineno"> 4342</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../da/d00/structast__xmpp__client__config.html">ast_xmpp_client_config</a> *clientcfg;</div><div class="line"><a name="l04343"></a><span class="lineno"> 4343</span>&#160;</div><div class="line"><a name="l04344"></a><span class="lineno"> 4344</span>&#160;   <span class="keywordflow">switch</span> (cmd) {</div><div class="line"><a name="l04345"></a><span class="lineno"> 4345</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="../../dc/db0/cli_8h.html#ab33e5350a923c3a8cedbeb496cd88ec9a71745eb63dd093f560a1add3e430d2a9">CLI_INIT</a>:</div><div class="line"><a name="l04346"></a><span class="lineno"> 4346</span>&#160;      e-&gt;<a class="code" href="../../d8/d07/structast__cli__entry.html#ade9cba72805fe52685a1deea307a8e82">command</a> = <span class="stringliteral">&quot;xmpp show connections&quot;</span>;</div><div class="line"><a name="l04347"></a><span class="lineno"> 4347</span>&#160;      e-&gt;<a class="code" href="../../d8/d07/structast__cli__entry.html#aef1bd6ad890a110b466cb0e8088507a2">usage</a> =</div><div class="line"><a name="l04348"></a><span class="lineno"> 4348</span>&#160;         <span class="stringliteral">&quot;Usage: xmpp show connections\n&quot;</span></div><div class="line"><a name="l04349"></a><span class="lineno"> 4349</span>&#160;         <span class="stringliteral">&quot;       Shows state of client and component connections\n&quot;</span>;</div><div class="line"><a name="l04350"></a><span class="lineno"> 4350</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l04351"></a><span class="lineno"> 4351</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="../../dc/db0/cli_8h.html#ab33e5350a923c3a8cedbeb496cd88ec9a76bf33139279b03ec1691f2be2d1be40">CLI_GENERATE</a>:</div><div class="line"><a name="l04352"></a><span class="lineno"> 4352</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l04353"></a><span class="lineno"> 4353</span>&#160;   }</div><div class="line"><a name="l04354"></a><span class="lineno"> 4354</span>&#160;</div><div class="line"><a name="l04355"></a><span class="lineno"> 4355</span>&#160;   <span class="keywordflow">if</span> (!cfg || !cfg-&gt;clients) {</div><div class="line"><a name="l04356"></a><span class="lineno"> 4356</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l04357"></a><span class="lineno"> 4357</span>&#160;   }</div><div class="line"><a name="l04358"></a><span class="lineno"> 4358</span>&#160;</div><div class="line"><a name="l04359"></a><span class="lineno"> 4359</span>&#160;   <a class="code" href="../../dc/db0/cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#acf64f219885421479997667d2ed3f08a">fd</a>, <span class="stringliteral">&quot;Jabber Users and their status:\n&quot;</span>);</div><div class="line"><a name="l04360"></a><span class="lineno"> 4360</span>&#160;</div><div class="line"><a name="l04361"></a><span class="lineno"> 4361</span>&#160;   i = <a class="code" href="../../d5/da5/astobj2_8h.html#a91d5d37d00874ae7a92d1a15c0a3b3a6">ao2_iterator_init</a>(cfg-&gt;clients, 0);</div><div class="line"><a name="l04362"></a><span class="lineno"> 4362</span>&#160;   <span class="keywordflow">while</span> ((clientcfg = <a class="code" href="../../d5/da5/astobj2_8h.html#a17990ea630db7dbd1252ef0132133a2b">ao2_iterator_next</a>(&amp;i))) {</div><div class="line"><a name="l04363"></a><span class="lineno"> 4363</span>&#160;      <span class="keywordtype">char</span> *<a class="code" href="../../d5/dfe/chan__sip_8c.html#a14a9662e09deed264497073732fb014a">state</a>;</div><div class="line"><a name="l04364"></a><span class="lineno"> 4364</span>&#160;</div><div class="line"><a name="l04365"></a><span class="lineno"> 4365</span>&#160;      <span class="keywordflow">switch</span> (clientcfg-&gt;<a class="code" href="../../da/d00/structast__xmpp__client__config.html#a83bf6907a1184b56931bf86ff744279e">client</a>-&gt;<a class="code" href="../../df/d42/structast__xmpp__client.html#a0e1ad9bdec3a82e1fec4aed829cfa2a6">state</a>) {</div><div class="line"><a name="l04366"></a><span class="lineno"> 4366</span>&#160;      <span class="keywordflow">case</span> <a class="code" href="../../da/da0/xmpp_8h.html#ae37d560c438576bdcb47347088225ee6ac443c6d96cc4879bf26ca95710628aad">XMPP_STATE_DISCONNECTING</a>:</div><div class="line"><a name="l04367"></a><span class="lineno"> 4367</span>&#160;         state = <span class="stringliteral">&quot;Disconnecting&quot;</span>;</div><div class="line"><a name="l04368"></a><span class="lineno"> 4368</span>&#160;         <span class="keywordflow">break</span>;</div><div class="line"><a name="l04369"></a><span class="lineno"> 4369</span>&#160;      <span class="keywordflow">case</span> <a class="code" href="../../da/da0/xmpp_8h.html#ae37d560c438576bdcb47347088225ee6a83544d57990f3fc1311d173a44928042">XMPP_STATE_DISCONNECTED</a>:</div><div class="line"><a name="l04370"></a><span class="lineno"> 4370</span>&#160;         state = <span class="stringliteral">&quot;Disconnected&quot;</span>;</div><div class="line"><a name="l04371"></a><span class="lineno"> 4371</span>&#160;         <span class="keywordflow">break</span>;</div><div class="line"><a name="l04372"></a><span class="lineno"> 4372</span>&#160;      <span class="keywordflow">case</span> <a class="code" href="../../da/da0/xmpp_8h.html#ae37d560c438576bdcb47347088225ee6ab1364f19fef96645ce7255d0f65af144">XMPP_STATE_CONNECTING</a>:</div><div class="line"><a name="l04373"></a><span class="lineno"> 4373</span>&#160;         state = <span class="stringliteral">&quot;Connecting&quot;</span>;</div><div class="line"><a name="l04374"></a><span class="lineno"> 4374</span>&#160;         <span class="keywordflow">break</span>;</div><div class="line"><a name="l04375"></a><span class="lineno"> 4375</span>&#160;      <span class="keywordflow">case</span> <a class="code" href="../../da/da0/xmpp_8h.html#ae37d560c438576bdcb47347088225ee6a9ae50cb46cd7faba7bdde6259d1e7e11">XMPP_STATE_REQUEST_TLS</a>:</div><div class="line"><a name="l04376"></a><span class="lineno"> 4376</span>&#160;         state = <span class="stringliteral">&quot;Waiting to request TLS&quot;</span>;</div><div class="line"><a name="l04377"></a><span class="lineno"> 4377</span>&#160;         <span class="keywordflow">break</span>;</div><div class="line"><a name="l04378"></a><span class="lineno"> 4378</span>&#160;      <span class="keywordflow">case</span> <a class="code" href="../../da/da0/xmpp_8h.html#ae37d560c438576bdcb47347088225ee6aa3c76e3189d07fe1b59825869e4703e3">XMPP_STATE_REQUESTED_TLS</a>:</div><div class="line"><a name="l04379"></a><span class="lineno"> 4379</span>&#160;         state = <span class="stringliteral">&quot;Requested TLS&quot;</span>;</div><div class="line"><a name="l04380"></a><span class="lineno"> 4380</span>&#160;         <span class="keywordflow">break</span>;</div><div class="line"><a name="l04381"></a><span class="lineno"> 4381</span>&#160;      <span class="keywordflow">case</span> <a class="code" href="../../da/da0/xmpp_8h.html#ae37d560c438576bdcb47347088225ee6a1f316843c055717ccde5ccb266e1eee6">XMPP_STATE_AUTHENTICATE</a>:</div><div class="line"><a name="l04382"></a><span class="lineno"> 4382</span>&#160;         state = <span class="stringliteral">&quot;Waiting to authenticate&quot;</span>;</div><div class="line"><a name="l04383"></a><span class="lineno"> 4383</span>&#160;         <span class="keywordflow">break</span>;</div><div class="line"><a name="l04384"></a><span class="lineno"> 4384</span>&#160;      <span class="keywordflow">case</span> <a class="code" href="../../da/da0/xmpp_8h.html#ae37d560c438576bdcb47347088225ee6aeddf64cd40acf9ce3a91bacc33c3368c">XMPP_STATE_AUTHENTICATING</a>:</div><div class="line"><a name="l04385"></a><span class="lineno"> 4385</span>&#160;         state = <span class="stringliteral">&quot;Authenticating&quot;</span>;</div><div class="line"><a name="l04386"></a><span class="lineno"> 4386</span>&#160;         <span class="keywordflow">break</span>;</div><div class="line"><a name="l04387"></a><span class="lineno"> 4387</span>&#160;      <span class="keywordflow">case</span> <a class="code" href="../../da/da0/xmpp_8h.html#ae37d560c438576bdcb47347088225ee6a77f9e302744e33eb45b86565a4983697">XMPP_STATE_ROSTER</a>:</div><div class="line"><a name="l04388"></a><span class="lineno"> 4388</span>&#160;         state = <span class="stringliteral">&quot;Retrieving roster&quot;</span>;</div><div class="line"><a name="l04389"></a><span class="lineno"> 4389</span>&#160;         <span class="keywordflow">break</span>;</div><div class="line"><a name="l04390"></a><span class="lineno"> 4390</span>&#160;      <span class="keywordflow">case</span> <a class="code" href="../../da/da0/xmpp_8h.html#ae37d560c438576bdcb47347088225ee6af75b0231e0c9888c9a6c5374abf7527f">XMPP_STATE_CONNECTED</a>:</div><div class="line"><a name="l04391"></a><span class="lineno"> 4391</span>&#160;         state = <span class="stringliteral">&quot;Connected&quot;</span>;</div><div class="line"><a name="l04392"></a><span class="lineno"> 4392</span>&#160;         <span class="keywordflow">break</span>;</div><div class="line"><a name="l04393"></a><span class="lineno"> 4393</span>&#160;      <span class="keywordflow">default</span>:</div><div class="line"><a name="l04394"></a><span class="lineno"> 4394</span>&#160;         state = <span class="stringliteral">&quot;Unknown&quot;</span>;</div><div class="line"><a name="l04395"></a><span class="lineno"> 4395</span>&#160;      }</div><div class="line"><a name="l04396"></a><span class="lineno"> 4396</span>&#160;</div><div class="line"><a name="l04397"></a><span class="lineno"> 4397</span>&#160;      <a class="code" href="../../dc/db0/cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#acf64f219885421479997667d2ed3f08a">fd</a>, <span class="stringliteral">&quot;       [%s] %s     - %s\n&quot;</span>, clientcfg-&gt;<a class="code" href="../../da/d00/structast__xmpp__client__config.html#ace9168767fc3707cf5f0a7d049682ba3">name</a>, clientcfg-&gt;<a class="code" href="../../da/d00/structast__xmpp__client__config.html#a661785436d89cdd720f15478d92c984b">user</a>, state);</div><div class="line"><a name="l04398"></a><span class="lineno"> 4398</span>&#160;</div><div class="line"><a name="l04399"></a><span class="lineno"> 4399</span>&#160;      <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(clientcfg, -1);</div><div class="line"><a name="l04400"></a><span class="lineno"> 4400</span>&#160;   }</div><div class="line"><a name="l04401"></a><span class="lineno"> 4401</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#ad36841ab6daa3997f7ca7047ad2d033a">ao2_iterator_destroy</a>(&amp;i);</div><div class="line"><a name="l04402"></a><span class="lineno"> 4402</span>&#160;</div><div class="line"><a name="l04403"></a><span class="lineno"> 4403</span>&#160;   <a class="code" href="../../dc/db0/cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#acf64f219885421479997667d2ed3f08a">fd</a>, <span class="stringliteral">&quot;----\n&quot;</span>);</div><div class="line"><a name="l04404"></a><span class="lineno"> 4404</span>&#160;   <a class="code" href="../../dc/db0/cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#acf64f219885421479997667d2ed3f08a">fd</a>, <span class="stringliteral">&quot;   Number of clients: %d\n&quot;</span>, <a class="code" href="../../d5/da5/astobj2_8h.html#a512cc40ce96c63b3d5c78040baa4c9cd">ao2_container_count</a>(cfg-&gt;clients));</div><div class="line"><a name="l04405"></a><span class="lineno"> 4405</span>&#160;</div><div class="line"><a name="l04406"></a><span class="lineno"> 4406</span>&#160;   <span class="keywordflow">return</span> <a class="code" href="../../dc/db0/cli_8h.html#a50989f00b32eeb2516a3803cb2ffb766">CLI_SUCCESS</a>;</div><div class="line"><a name="l04407"></a><span class="lineno"> 4407</span>&#160;}</div><div class="line"><a name="l04408"></a><span class="lineno"> 4408</span>&#160;<span class="comment"></span></div><div class="line"><a name="l04409"></a><span class="lineno"> 4409</span>&#160;<span class="comment">/*!</span></div><div class="line"><a name="l04410"></a><span class="lineno"> 4410</span>&#160;<span class="comment"> * \internal</span></div><div class="line"><a name="l04411"></a><span class="lineno"> 4411</span>&#160;<span class="comment"> * \brief Show buddy lists</span></div><div class="line"><a name="l04412"></a><span class="lineno"> 4412</span>&#160;<span class="comment"> * \return CLI_SUCCESS.</span></div><div class="line"><a name="l04413"></a><span class="lineno"> 4413</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l04414"></a><span class="lineno"><a class="line" href="../../dc/d6b/res__xmpp_8c.html#a0b3b1969e0cde893da791a0a490dc7b5"> 4414</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">char</span> *<a class="code" href="../../dc/d6b/res__xmpp_8c.html#a0b3b1969e0cde893da791a0a490dc7b5">xmpp_show_buddies</a>(<span class="keyword">struct</span> <a class="code" href="../../d8/d07/structast__cli__entry.html">ast_cli_entry</a> *e, <span class="keywordtype">int</span> cmd, <span class="keyword">struct</span> <a class="code" href="../../d3/dad/structast__cli__args.html">ast_cli_args</a> *<a class="code" href="../../d7/d6f/test__linkedlists_8c.html#a13dd15487fee89a002d17ef3aff62d02">a</a>)</div><div class="line"><a name="l04415"></a><span class="lineno"> 4415</span>&#160;{</div><div class="line"><a name="l04416"></a><span class="lineno"> 4416</span>&#160;   <a class="code" href="../../d5/d60/utils_8h.html#a1604b4d72144dd3d9f7da668e90337e9">RAII_VAR</a>(<span class="keyword">struct</span> <a class="code" href="../../de/d1c/structxmpp__config.html">xmpp_config</a> *, cfg, <a class="code" href="../../d5/da5/astobj2_8h.html#a86d8d6c3c8866ed0a60121da055cd225">ao2_global_obj_ref</a>(<a class="code" href="../../d3/d4e/chan__console_8c.html#aa36e3e2c486b920b166c2d17c5242221">globals</a>), <a class="code" href="../../d5/da5/astobj2_8h.html#a6321ee982370c55ab3c24c72c562cbdd">ao2_cleanup</a>);</div><div class="line"><a name="l04417"></a><span class="lineno"> 4417</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d9/d97/structao2__iterator.html">ao2_iterator</a> i;</div><div class="line"><a name="l04418"></a><span class="lineno"> 4418</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../da/d00/structast__xmpp__client__config.html">ast_xmpp_client_config</a> *clientcfg;</div><div class="line"><a name="l04419"></a><span class="lineno"> 4419</span>&#160;</div><div class="line"><a name="l04420"></a><span class="lineno"> 4420</span>&#160;   <span class="keywordflow">switch</span> (cmd) {</div><div class="line"><a name="l04421"></a><span class="lineno"> 4421</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="../../dc/db0/cli_8h.html#ab33e5350a923c3a8cedbeb496cd88ec9a71745eb63dd093f560a1add3e430d2a9">CLI_INIT</a>:</div><div class="line"><a name="l04422"></a><span class="lineno"> 4422</span>&#160;      e-&gt;<a class="code" href="../../d8/d07/structast__cli__entry.html#ade9cba72805fe52685a1deea307a8e82">command</a> = <span class="stringliteral">&quot;xmpp show buddies&quot;</span>;</div><div class="line"><a name="l04423"></a><span class="lineno"> 4423</span>&#160;      e-&gt;<a class="code" href="../../d8/d07/structast__cli__entry.html#aef1bd6ad890a110b466cb0e8088507a2">usage</a> =</div><div class="line"><a name="l04424"></a><span class="lineno"> 4424</span>&#160;         <span class="stringliteral">&quot;Usage: xmpp show buddies\n&quot;</span></div><div class="line"><a name="l04425"></a><span class="lineno"> 4425</span>&#160;         <span class="stringliteral">&quot;       Shows buddy lists of our clients\n&quot;</span>;</div><div class="line"><a name="l04426"></a><span class="lineno"> 4426</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l04427"></a><span class="lineno"> 4427</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="../../dc/db0/cli_8h.html#ab33e5350a923c3a8cedbeb496cd88ec9a76bf33139279b03ec1691f2be2d1be40">CLI_GENERATE</a>:</div><div class="line"><a name="l04428"></a><span class="lineno"> 4428</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l04429"></a><span class="lineno"> 4429</span>&#160;   }</div><div class="line"><a name="l04430"></a><span class="lineno"> 4430</span>&#160;</div><div class="line"><a name="l04431"></a><span class="lineno"> 4431</span>&#160;   <span class="keywordflow">if</span> (!cfg || !cfg-&gt;clients) {</div><div class="line"><a name="l04432"></a><span class="lineno"> 4432</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l04433"></a><span class="lineno"> 4433</span>&#160;   }</div><div class="line"><a name="l04434"></a><span class="lineno"> 4434</span>&#160;</div><div class="line"><a name="l04435"></a><span class="lineno"> 4435</span>&#160;   <a class="code" href="../../dc/db0/cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#acf64f219885421479997667d2ed3f08a">fd</a>, <span class="stringliteral">&quot;XMPP buddy lists\n&quot;</span>);</div><div class="line"><a name="l04436"></a><span class="lineno"> 4436</span>&#160;</div><div class="line"><a name="l04437"></a><span class="lineno"> 4437</span>&#160;   i = <a class="code" href="../../d5/da5/astobj2_8h.html#a91d5d37d00874ae7a92d1a15c0a3b3a6">ao2_iterator_init</a>(cfg-&gt;clients, 0);</div><div class="line"><a name="l04438"></a><span class="lineno"> 4438</span>&#160;   <span class="keywordflow">while</span> ((clientcfg = <a class="code" href="../../d5/da5/astobj2_8h.html#a17990ea630db7dbd1252ef0132133a2b">ao2_iterator_next</a>(&amp;i))) {</div><div class="line"><a name="l04439"></a><span class="lineno"> 4439</span>&#160;      <span class="keyword">struct </span><a class="code" href="../../d9/d97/structao2__iterator.html">ao2_iterator</a> bud;</div><div class="line"><a name="l04440"></a><span class="lineno"> 4440</span>&#160;      <span class="keyword">struct </span><a class="code" href="../../d5/d25/structast__xmpp__buddy.html">ast_xmpp_buddy</a> *buddy;</div><div class="line"><a name="l04441"></a><span class="lineno"> 4441</span>&#160;</div><div class="line"><a name="l04442"></a><span class="lineno"> 4442</span>&#160;      <a class="code" href="../../dc/db0/cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#acf64f219885421479997667d2ed3f08a">fd</a>, <span class="stringliteral">&quot;Client: %s\n&quot;</span>, clientcfg-&gt;<a class="code" href="../../da/d00/structast__xmpp__client__config.html#ace9168767fc3707cf5f0a7d049682ba3">name</a>);</div><div class="line"><a name="l04443"></a><span class="lineno"> 4443</span>&#160;</div><div class="line"><a name="l04444"></a><span class="lineno"> 4444</span>&#160;      bud = <a class="code" href="../../d5/da5/astobj2_8h.html#a91d5d37d00874ae7a92d1a15c0a3b3a6">ao2_iterator_init</a>(clientcfg-&gt;<a class="code" href="../../da/d00/structast__xmpp__client__config.html#a83bf6907a1184b56931bf86ff744279e">client</a>-&gt;<a class="code" href="../../df/d42/structast__xmpp__client.html#a5082987d3e1eac5f625574800bb72c2c">buddies</a>, 0);</div><div class="line"><a name="l04445"></a><span class="lineno"> 4445</span>&#160;      <span class="keywordflow">while</span> ((buddy = <a class="code" href="../../d5/da5/astobj2_8h.html#a17990ea630db7dbd1252ef0132133a2b">ao2_iterator_next</a>(&amp;bud))) {</div><div class="line"><a name="l04446"></a><span class="lineno"> 4446</span>&#160;         <span class="keyword">struct </span><a class="code" href="../../d9/d97/structao2__iterator.html">ao2_iterator</a> res;</div><div class="line"><a name="l04447"></a><span class="lineno"> 4447</span>&#160;         <span class="keyword">struct </span><a class="code" href="../../d6/d90/structast__xmpp__resource.html">ast_xmpp_resource</a> *<a class="code" href="../../d6/d90/structast__xmpp__resource.html#a12856b954fce601a0303b0bcdf83c513">resource</a>;</div><div class="line"><a name="l04448"></a><span class="lineno"> 4448</span>&#160;</div><div class="line"><a name="l04449"></a><span class="lineno"> 4449</span>&#160;         <a class="code" href="../../dc/db0/cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#acf64f219885421479997667d2ed3f08a">fd</a>, <span class="stringliteral">&quot;\tBuddy:\t%s\n&quot;</span>, buddy-&gt;<a class="code" href="../../d5/d25/structast__xmpp__buddy.html#aaf2ca63234b10470cfbba573d4c0ed01">id</a>);</div><div class="line"><a name="l04450"></a><span class="lineno"> 4450</span>&#160;</div><div class="line"><a name="l04451"></a><span class="lineno"> 4451</span>&#160;         res = <a class="code" href="../../d5/da5/astobj2_8h.html#a91d5d37d00874ae7a92d1a15c0a3b3a6">ao2_iterator_init</a>(buddy-&gt;<a class="code" href="../../d5/d25/structast__xmpp__buddy.html#ae3222a7c2c3040d71427c9a8b33ac38c">resources</a>, 0);</div><div class="line"><a name="l04452"></a><span class="lineno"> 4452</span>&#160;         <span class="keywordflow">while</span> ((resource = <a class="code" href="../../d5/da5/astobj2_8h.html#a17990ea630db7dbd1252ef0132133a2b">ao2_iterator_next</a>(&amp;res))) {</div><div class="line"><a name="l04453"></a><span class="lineno"> 4453</span>&#160;            <a class="code" href="../../dc/db0/cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#acf64f219885421479997667d2ed3f08a">fd</a>, <span class="stringliteral">&quot;\t\tResource: %s\n&quot;</span>, resource-&gt;<a class="code" href="../../d6/d90/structast__xmpp__resource.html#a12856b954fce601a0303b0bcdf83c513">resource</a>);</div><div class="line"><a name="l04454"></a><span class="lineno"> 4454</span>&#160;            <a class="code" href="../../dc/db0/cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#acf64f219885421479997667d2ed3f08a">fd</a>, <span class="stringliteral">&quot;\t\t\tnode: %s\n&quot;</span>, resource-&gt;<a class="code" href="../../d6/d90/structast__xmpp__resource.html#a4ac032e592fb6d9cf9fdaf3e269fc433">caps</a>.<a class="code" href="../../da/daa/structast__xmpp__capabilities.html#a987239273bb4a074ad22c76c6486d5b1">node</a>);</div><div class="line"><a name="l04455"></a><span class="lineno"> 4455</span>&#160;            <a class="code" href="../../dc/db0/cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#acf64f219885421479997667d2ed3f08a">fd</a>, <span class="stringliteral">&quot;\t\t\tversion: %s\n&quot;</span>, resource-&gt;<a class="code" href="../../d6/d90/structast__xmpp__resource.html#a4ac032e592fb6d9cf9fdaf3e269fc433">caps</a>.<a class="code" href="../../da/daa/structast__xmpp__capabilities.html#a039f1dc229c7bd812108a7e8f54249e5">version</a>);</div><div class="line"><a name="l04456"></a><span class="lineno"> 4456</span>&#160;            <a class="code" href="../../dc/db0/cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#acf64f219885421479997667d2ed3f08a">fd</a>, <span class="stringliteral">&quot;\t\t\tGoogle Talk capable: %s\n&quot;</span>, resource-&gt;<a class="code" href="../../d6/d90/structast__xmpp__resource.html#a4ac032e592fb6d9cf9fdaf3e269fc433">caps</a>.<a class="code" href="../../da/daa/structast__xmpp__capabilities.html#a641f34a6ff897f49fcdf930758ff69fe">google</a> ? <span class="stringliteral">&quot;yes&quot;</span> : <span class="stringliteral">&quot;no&quot;</span>);</div><div class="line"><a name="l04457"></a><span class="lineno"> 4457</span>&#160;            <a class="code" href="../../dc/db0/cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#acf64f219885421479997667d2ed3f08a">fd</a>, <span class="stringliteral">&quot;\t\t\tJingle capable: %s\n&quot;</span>, resource-&gt;<a class="code" href="../../d6/d90/structast__xmpp__resource.html#a4ac032e592fb6d9cf9fdaf3e269fc433">caps</a>.<a class="code" href="../../da/daa/structast__xmpp__capabilities.html#ab5fb18e79b717e6ee434115344b6258f">jingle</a> ? <span class="stringliteral">&quot;yes&quot;</span> : <span class="stringliteral">&quot;no&quot;</span>);</div><div class="line"><a name="l04458"></a><span class="lineno"> 4458</span>&#160;</div><div class="line"><a name="l04459"></a><span class="lineno"> 4459</span>&#160;            <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(resource, -1);</div><div class="line"><a name="l04460"></a><span class="lineno"> 4460</span>&#160;         }</div><div class="line"><a name="l04461"></a><span class="lineno"> 4461</span>&#160;         <a class="code" href="../../d5/da5/astobj2_8h.html#ad36841ab6daa3997f7ca7047ad2d033a">ao2_iterator_destroy</a>(&amp;res);</div><div class="line"><a name="l04462"></a><span class="lineno"> 4462</span>&#160;</div><div class="line"><a name="l04463"></a><span class="lineno"> 4463</span>&#160;         <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(buddy, -1);</div><div class="line"><a name="l04464"></a><span class="lineno"> 4464</span>&#160;      }</div><div class="line"><a name="l04465"></a><span class="lineno"> 4465</span>&#160;      <a class="code" href="../../d5/da5/astobj2_8h.html#ad36841ab6daa3997f7ca7047ad2d033a">ao2_iterator_destroy</a>(&amp;bud);</div><div class="line"><a name="l04466"></a><span class="lineno"> 4466</span>&#160;</div><div class="line"><a name="l04467"></a><span class="lineno"> 4467</span>&#160;      <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(clientcfg, -1);</div><div class="line"><a name="l04468"></a><span class="lineno"> 4468</span>&#160;   }</div><div class="line"><a name="l04469"></a><span class="lineno"> 4469</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#ad36841ab6daa3997f7ca7047ad2d033a">ao2_iterator_destroy</a>(&amp;i);</div><div class="line"><a name="l04470"></a><span class="lineno"> 4470</span>&#160;</div><div class="line"><a name="l04471"></a><span class="lineno"> 4471</span>&#160;   <span class="keywordflow">return</span> <a class="code" href="../../dc/db0/cli_8h.html#a50989f00b32eeb2516a3803cb2ffb766">CLI_SUCCESS</a>;</div><div class="line"><a name="l04472"></a><span class="lineno"> 4472</span>&#160;}</div><div class="line"><a name="l04473"></a><span class="lineno"> 4473</span>&#160;</div><div class="line"><a name="l04474"></a><span class="lineno"><a class="line" href="../../dc/d6b/res__xmpp_8c.html#a75b0b81d9879c0094f99cb284ae9d178"> 4474</a></span>&#160;<span class="keyword">static</span> <span class="keyword">struct </span><a class="code" href="../../d8/d07/structast__cli__entry.html">ast_cli_entry</a> <a class="code" href="../../dc/d6b/res__xmpp_8c.html#a75b0b81d9879c0094f99cb284ae9d178">xmpp_cli</a>[] = {</div><div class="line"><a name="l04475"></a><span class="lineno"> 4475</span>&#160;   <a class="code" href="../../dc/db0/cli_8h.html#a5c4130cf8f1e93acfdd84416cebf1aef">AST_CLI_DEFINE</a>(<a class="code" href="../../dc/d6b/res__xmpp_8c.html#aa1b7f2cc76fae598ccb5315910a6093a">xmpp_do_set_debug</a>, <span class="stringliteral">&quot;Enable/Disable Jabber debug&quot;</span>),</div><div class="line"><a name="l04476"></a><span class="lineno"> 4476</span>&#160;   <a class="code" href="../../dc/db0/cli_8h.html#a5c4130cf8f1e93acfdd84416cebf1aef">AST_CLI_DEFINE</a>(<a class="code" href="../../dc/d6b/res__xmpp_8c.html#ae14a19eca8ea66ff91e63ea8f6cb33f4">xmpp_show_clients</a>, <span class="stringliteral">&quot;Show state of clients and components&quot;</span>),</div><div class="line"><a name="l04477"></a><span class="lineno"> 4477</span>&#160;   <a class="code" href="../../dc/db0/cli_8h.html#a5c4130cf8f1e93acfdd84416cebf1aef">AST_CLI_DEFINE</a>(<a class="code" href="../../dc/d6b/res__xmpp_8c.html#a0b3b1969e0cde893da791a0a490dc7b5">xmpp_show_buddies</a>, <span class="stringliteral">&quot;Show buddy lists of our clients&quot;</span>),</div><div class="line"><a name="l04478"></a><span class="lineno"> 4478</span>&#160;   <a class="code" href="../../dc/db0/cli_8h.html#a5c4130cf8f1e93acfdd84416cebf1aef">AST_CLI_DEFINE</a>(<a class="code" href="../../dc/d6b/res__xmpp_8c.html#a783db61e3ab13bfd85c23fad88f30b9b">xmpp_cli_create_collection</a>, <span class="stringliteral">&quot;Creates a PubSub node collection.&quot;</span>),</div><div class="line"><a name="l04479"></a><span class="lineno"> 4479</span>&#160;   <a class="code" href="../../dc/db0/cli_8h.html#a5c4130cf8f1e93acfdd84416cebf1aef">AST_CLI_DEFINE</a>(<a class="code" href="../../dc/d6b/res__xmpp_8c.html#a42466f982f15a72f75bc9c1ce1ecf4ab">xmpp_cli_list_pubsub_nodes</a>, <span class="stringliteral">&quot;Lists PubSub nodes&quot;</span>),</div><div class="line"><a name="l04480"></a><span class="lineno"> 4480</span>&#160;   <a class="code" href="../../dc/db0/cli_8h.html#a5c4130cf8f1e93acfdd84416cebf1aef">AST_CLI_DEFINE</a>(<a class="code" href="../../dc/d6b/res__xmpp_8c.html#af90c7b8a64756048c4816729b5a2a141">xmpp_cli_create_leafnode</a>, <span class="stringliteral">&quot;Creates a PubSub leaf node&quot;</span>),</div><div class="line"><a name="l04481"></a><span class="lineno"> 4481</span>&#160;   <a class="code" href="../../dc/db0/cli_8h.html#a5c4130cf8f1e93acfdd84416cebf1aef">AST_CLI_DEFINE</a>(<a class="code" href="../../dc/d6b/res__xmpp_8c.html#ac8e69048e81bd7cf71a4f623262fe67b">xmpp_cli_delete_pubsub_node</a>, <span class="stringliteral">&quot;Deletes a PubSub node&quot;</span>),</div><div class="line"><a name="l04482"></a><span class="lineno"> 4482</span>&#160;   <a class="code" href="../../dc/db0/cli_8h.html#a5c4130cf8f1e93acfdd84416cebf1aef">AST_CLI_DEFINE</a>(<a class="code" href="../../dc/d6b/res__xmpp_8c.html#acc06b389a6a5247288ad580fde1e56bd">xmpp_cli_purge_pubsub_nodes</a>, <span class="stringliteral">&quot;Purges PubSub nodes&quot;</span>),</div><div class="line"><a name="l04483"></a><span class="lineno"> 4483</span>&#160;};</div><div class="line"><a name="l04484"></a><span class="lineno"> 4484</span>&#160;</div><div class="line"><a name="l04485"></a><span class="lineno"><a class="line" href="../../dc/d6b/res__xmpp_8c.html#ad09fa931f468002152a3cc2d5ce25eae"> 4485</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../dc/d6b/res__xmpp_8c.html#ad09fa931f468002152a3cc2d5ce25eae">unload_module</a>(<span class="keywordtype">void</span>)</div><div class="line"><a name="l04486"></a><span class="lineno"> 4486</span>&#160;{</div><div class="line"><a name="l04487"></a><span class="lineno"> 4487</span>&#160;   <a class="code" href="../../d2/d0d/message_8h.html#a8a1ffcfecf1ffbc22c526796cdf954a7">ast_msg_tech_unregister</a>(&amp;msg_tech);</div><div class="line"><a name="l04488"></a><span class="lineno"> 4488</span>&#160;   <a class="code" href="../../dc/db0/cli_8h.html#a56b6b59ee2eaa994597a5b0f4e9f9d09">ast_cli_unregister_multiple</a>(xmpp_cli, <a class="code" href="../../de/dfe/isdn__lib_8c.html#ab9129b977a587b50ea801daac75e178f">ARRAY_LEN</a>(xmpp_cli));</div><div class="line"><a name="l04489"></a><span class="lineno"> 4489</span>&#160;   <a class="code" href="../../d5/d16/module_8h.html#ad2ca15621101154f29748cf1dac3c3cf">ast_unregister_application</a>(app_ajisend);</div><div class="line"><a name="l04490"></a><span class="lineno"> 4490</span>&#160;   <a class="code" href="../../d5/d16/module_8h.html#ad2ca15621101154f29748cf1dac3c3cf">ast_unregister_application</a>(app_ajisendgroup);</div><div class="line"><a name="l04491"></a><span class="lineno"> 4491</span>&#160;   <a class="code" href="../../d5/d16/module_8h.html#ad2ca15621101154f29748cf1dac3c3cf">ast_unregister_application</a>(app_ajistatus);</div><div class="line"><a name="l04492"></a><span class="lineno"> 4492</span>&#160;   <a class="code" href="../../d5/d16/module_8h.html#ad2ca15621101154f29748cf1dac3c3cf">ast_unregister_application</a>(app_ajijoin);</div><div class="line"><a name="l04493"></a><span class="lineno"> 4493</span>&#160;   <a class="code" href="../../d5/d16/module_8h.html#ad2ca15621101154f29748cf1dac3c3cf">ast_unregister_application</a>(app_ajileave);</div><div class="line"><a name="l04494"></a><span class="lineno"> 4494</span>&#160;   <a class="code" href="../../df/d72/group__Group__AMI.html#gafadf012f66a9fd7ecf985ec5b9dee101">ast_manager_unregister</a>(<span class="stringliteral">&quot;JabberSend&quot;</span>);</div><div class="line"><a name="l04495"></a><span class="lineno"> 4495</span>&#160;   <a class="code" href="../../db/de0/pbx_8h.html#a965977ea9a3144bc203e0ce7a64680a1">ast_custom_function_unregister</a>(&amp;jabberstatus_function);</div><div class="line"><a name="l04496"></a><span class="lineno"> 4496</span>&#160;   <a class="code" href="../../db/de0/pbx_8h.html#a965977ea9a3144bc203e0ce7a64680a1">ast_custom_function_unregister</a>(&amp;jabberreceive_function);</div><div class="line"><a name="l04497"></a><span class="lineno"> 4497</span>&#160;   <a class="code" href="../../db/dfe/config__options_8h.html#a21b11339ca4d0b1167c956a9f816bd19">aco_info_destroy</a>(&amp;cfg_info);</div><div class="line"><a name="l04498"></a><span class="lineno"> 4498</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#ac0e1cbc7cf050c8b7b8e3a8fee92c50e">ao2_global_obj_release</a>(<a class="code" href="../../d3/d4e/chan__console_8c.html#aa36e3e2c486b920b166c2d17c5242221">globals</a>);</div><div class="line"><a name="l04499"></a><span class="lineno"> 4499</span>&#160;</div><div class="line"><a name="l04500"></a><span class="lineno"> 4500</span>&#160;   <a class="code" href="../../dd/d42/lock_8h.html#a1ea2f4040a736cddbecea48b30ffedfd">ast_cond_destroy</a>(&amp;message_received_condition);</div><div class="line"><a name="l04501"></a><span class="lineno"> 4501</span>&#160;   <a class="code" href="../../dd/d42/lock_8h.html#ab8977a71822daa556f19f30ba6eec765">ast_mutex_destroy</a>(&amp;messagelock);</div><div class="line"><a name="l04502"></a><span class="lineno"> 4502</span>&#160;</div><div class="line"><a name="l04503"></a><span class="lineno"> 4503</span>&#160;   <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l04504"></a><span class="lineno"> 4504</span>&#160;}</div><div class="line"><a name="l04505"></a><span class="lineno"> 4505</span>&#160;</div><div class="line"><a name="l04506"></a><span class="lineno"><a class="line" href="../../dc/d6b/res__xmpp_8c.html#a12d4caeaa50e0b2bf034ca996bd5e2a4"> 4506</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../dc/d6b/res__xmpp_8c.html#a12d4caeaa50e0b2bf034ca996bd5e2a4">global_bitfield_handler</a>(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="../../db/de0/structaco__option.html">aco_option</a> *opt, <span class="keyword">struct</span> <a class="code" href="../../dd/d02/structast__variable.html">ast_variable</a> *<a class="code" href="../../dc/df2/ast__expr2f_8c.html#a1b0936415a643c88ce543099c10e0d7f">var</a>, <span class="keywordtype">void</span> *obj)</div><div class="line"><a name="l04507"></a><span class="lineno"> 4507</span>&#160;{</div><div class="line"><a name="l04508"></a><span class="lineno"> 4508</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../da/d70/structast__xmpp__global__config.html">ast_xmpp_global_config</a> *<a class="code" href="../../d8/d4f/test__config_8c.html#ab8aa28659d870c360b8afb1662c1b302">global</a> = obj;</div><div class="line"><a name="l04509"></a><span class="lineno"> 4509</span>&#160;</div><div class="line"><a name="l04510"></a><span class="lineno"> 4510</span>&#160;   <span class="keywordflow">if</span> (!strcasecmp(var-&gt;<a class="code" href="../../dd/d02/structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;debug&quot;</span>)) {</div><div class="line"><a name="l04511"></a><span class="lineno"> 4511</span>&#160;      debug = <a class="code" href="../../d6/d90/strings_8h.html#a387a69b3871ca31061566a73f45d20f4">ast_true</a>(var-&gt;<a class="code" href="../../dd/d02/structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>);</div><div class="line"><a name="l04512"></a><span class="lineno"> 4512</span>&#160;   } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(var-&gt;<a class="code" href="../../dd/d02/structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;autoprune&quot;</span>)) {</div><div class="line"><a name="l04513"></a><span class="lineno"> 4513</span>&#160;      <a class="code" href="../../d5/d60/utils_8h.html#a67b6713ff86cf82aaed821e9a87d1c21">ast_set2_flag</a>(&amp;global-&gt;<a class="code" href="../../da/d70/structast__xmpp__global__config.html#a4dded5c7628fc70e772d321ee6bd5748">general</a>, <a class="code" href="../../d6/d90/strings_8h.html#a387a69b3871ca31061566a73f45d20f4">ast_true</a>(var-&gt;<a class="code" href="../../dd/d02/structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>), <a class="code" href="../../dc/d6b/res__xmpp_8c.html#aa3759d2ddcc12f3f5ef5a8a3ffa4a4dfa56b0aacbe6240e563e08310d1b6c8ce2">XMPP_AUTOPRUNE</a>);</div><div class="line"><a name="l04514"></a><span class="lineno"> 4514</span>&#160;   } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(var-&gt;<a class="code" href="../../dd/d02/structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;autoregister&quot;</span>)) {</div><div class="line"><a name="l04515"></a><span class="lineno"> 4515</span>&#160;      <a class="code" href="../../d5/d60/utils_8h.html#a67b6713ff86cf82aaed821e9a87d1c21">ast_set2_flag</a>(&amp;global-&gt;<a class="code" href="../../da/d70/structast__xmpp__global__config.html#a4dded5c7628fc70e772d321ee6bd5748">general</a>, <a class="code" href="../../d6/d90/strings_8h.html#a387a69b3871ca31061566a73f45d20f4">ast_true</a>(var-&gt;<a class="code" href="../../dd/d02/structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>), <a class="code" href="../../dc/d6b/res__xmpp_8c.html#aa3759d2ddcc12f3f5ef5a8a3ffa4a4dfa18ce12342ffe1b2f00bb53be6a87665d">XMPP_AUTOREGISTER</a>);</div><div class="line"><a name="l04516"></a><span class="lineno"> 4516</span>&#160;   } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(var-&gt;<a class="code" href="../../dd/d02/structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;auth_policy&quot;</span>)) {</div><div class="line"><a name="l04517"></a><span class="lineno"> 4517</span>&#160;      <a class="code" href="../../d5/d60/utils_8h.html#a67b6713ff86cf82aaed821e9a87d1c21">ast_set2_flag</a>(&amp;global-&gt;<a class="code" href="../../da/d70/structast__xmpp__global__config.html#a4dded5c7628fc70e772d321ee6bd5748">general</a>, !strcasecmp(var-&gt;<a class="code" href="../../dd/d02/structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, <span class="stringliteral">&quot;accept&quot;</span>) ? 1 : 0, <a class="code" href="../../dc/d6b/res__xmpp_8c.html#aa3759d2ddcc12f3f5ef5a8a3ffa4a4dfa8c4cc198db356150269f85b0339f00bf">XMPP_AUTOACCEPT</a>);</div><div class="line"><a name="l04518"></a><span class="lineno"> 4518</span>&#160;   } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(var-&gt;<a class="code" href="../../dd/d02/structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;collection_nodes&quot;</span>)) {</div><div class="line"><a name="l04519"></a><span class="lineno"> 4519</span>&#160;      <a class="code" href="../../d5/d60/utils_8h.html#a67b6713ff86cf82aaed821e9a87d1c21">ast_set2_flag</a>(&amp;global-&gt;<a class="code" href="../../da/d70/structast__xmpp__global__config.html#ab40b53f823544fcdeff79c7fc6beb69b">pubsub</a>, <a class="code" href="../../d6/d90/strings_8h.html#a387a69b3871ca31061566a73f45d20f4">ast_true</a>(var-&gt;<a class="code" href="../../dd/d02/structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>), <a class="code" href="../../dc/d6b/res__xmpp_8c.html#ac5b95f02723021833cc47477b06a962ca045d4dbda72ca97ef5ef8c383279d7dc">XMPP_XEP0248</a>);</div><div class="line"><a name="l04520"></a><span class="lineno"> 4520</span>&#160;   } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(var-&gt;<a class="code" href="../../dd/d02/structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;pubsub_autocreate&quot;</span>)) {</div><div class="line"><a name="l04521"></a><span class="lineno"> 4521</span>&#160;      <a class="code" href="../../d5/d60/utils_8h.html#a67b6713ff86cf82aaed821e9a87d1c21">ast_set2_flag</a>(&amp;global-&gt;<a class="code" href="../../da/d70/structast__xmpp__global__config.html#ab40b53f823544fcdeff79c7fc6beb69b">pubsub</a>, <a class="code" href="../../d6/d90/strings_8h.html#a387a69b3871ca31061566a73f45d20f4">ast_true</a>(var-&gt;<a class="code" href="../../dd/d02/structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>), <a class="code" href="../../dc/d6b/res__xmpp_8c.html#ac5b95f02723021833cc47477b06a962ca78acf22c4ab1b2450bf154c89e82d065">XMPP_PUBSUB_AUTOCREATE</a>);</div><div class="line"><a name="l04522"></a><span class="lineno"> 4522</span>&#160;   } <span class="keywordflow">else</span> {</div><div class="line"><a name="l04523"></a><span class="lineno"> 4523</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l04524"></a><span class="lineno"> 4524</span>&#160;   }</div><div class="line"><a name="l04525"></a><span class="lineno"> 4525</span>&#160;</div><div class="line"><a name="l04526"></a><span class="lineno"> 4526</span>&#160;   <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l04527"></a><span class="lineno"> 4527</span>&#160;}</div><div class="line"><a name="l04528"></a><span class="lineno"> 4528</span>&#160;</div><div class="line"><a name="l04529"></a><span class="lineno"><a class="line" href="../../dc/d6b/res__xmpp_8c.html#a46e9779a8a2096c9837d9e04943b5613"> 4529</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../dc/d6b/res__xmpp_8c.html#a46e9779a8a2096c9837d9e04943b5613">client_bitfield_handler</a>(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="../../db/de0/structaco__option.html">aco_option</a> *opt, <span class="keyword">struct</span> <a class="code" href="../../dd/d02/structast__variable.html">ast_variable</a> *<a class="code" href="../../dc/df2/ast__expr2f_8c.html#a1b0936415a643c88ce543099c10e0d7f">var</a>, <span class="keywordtype">void</span> *obj)</div><div class="line"><a name="l04530"></a><span class="lineno"> 4530</span>&#160;{</div><div class="line"><a name="l04531"></a><span class="lineno"> 4531</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../da/d00/structast__xmpp__client__config.html">ast_xmpp_client_config</a> *cfg = obj;</div><div class="line"><a name="l04532"></a><span class="lineno"> 4532</span>&#160;</div><div class="line"><a name="l04533"></a><span class="lineno"> 4533</span>&#160;   <span class="keywordflow">if</span> (!strcasecmp(var-&gt;<a class="code" href="../../dd/d02/structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;debug&quot;</span>)) {</div><div class="line"><a name="l04534"></a><span class="lineno"> 4534</span>&#160;      <a class="code" href="../../d5/d60/utils_8h.html#a67b6713ff86cf82aaed821e9a87d1c21">ast_set2_flag</a>(&amp;cfg-&gt;<a class="code" href="../../da/d00/structast__xmpp__client__config.html#aec78000b2897c094f68ed72559e18acd">flags</a>, <a class="code" href="../../d6/d90/strings_8h.html#a387a69b3871ca31061566a73f45d20f4">ast_true</a>(var-&gt;<a class="code" href="../../dd/d02/structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>), <a class="code" href="../../dc/d6b/res__xmpp_8c.html#aa3759d2ddcc12f3f5ef5a8a3ffa4a4dfa94811fda886cb2affbcb7a810dff8eb7">XMPP_DEBUG</a>);</div><div class="line"><a name="l04535"></a><span class="lineno"> 4535</span>&#160;   } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(var-&gt;<a class="code" href="../../dd/d02/structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;type&quot;</span>)) {</div><div class="line"><a name="l04536"></a><span class="lineno"> 4536</span>&#160;      <a class="code" href="../../d5/d60/utils_8h.html#a67b6713ff86cf82aaed821e9a87d1c21">ast_set2_flag</a>(&amp;cfg-&gt;<a class="code" href="../../da/d00/structast__xmpp__client__config.html#aec78000b2897c094f68ed72559e18acd">flags</a>, !strcasecmp(var-&gt;<a class="code" href="../../dd/d02/structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, <span class="stringliteral">&quot;component&quot;</span>) ? 1 : 0, <a class="code" href="../../dc/d6b/res__xmpp_8c.html#aa3759d2ddcc12f3f5ef5a8a3ffa4a4dfadc3efad94dcc216c29d42b23edcb2d00">XMPP_COMPONENT</a>);</div><div class="line"><a name="l04537"></a><span class="lineno"> 4537</span>&#160;   } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(var-&gt;<a class="code" href="../../dd/d02/structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;distribute_events&quot;</span>)) {</div><div class="line"><a name="l04538"></a><span class="lineno"> 4538</span>&#160;      <a class="code" href="../../d5/d60/utils_8h.html#a67b6713ff86cf82aaed821e9a87d1c21">ast_set2_flag</a>(&amp;cfg-&gt;<a class="code" href="../../da/d00/structast__xmpp__client__config.html#aec78000b2897c094f68ed72559e18acd">flags</a>, <a class="code" href="../../d6/d90/strings_8h.html#a387a69b3871ca31061566a73f45d20f4">ast_true</a>(var-&gt;<a class="code" href="../../dd/d02/structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>), <a class="code" href="../../dc/d6b/res__xmpp_8c.html#aa3759d2ddcc12f3f5ef5a8a3ffa4a4dfa29cbc9cdcca6e5b12165e01cab18438a">XMPP_DISTRIBUTE_EVENTS</a>);</div><div class="line"><a name="l04539"></a><span class="lineno"> 4539</span>&#160;   } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(var-&gt;<a class="code" href="../../dd/d02/structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;usetls&quot;</span>)) {</div><div class="line"><a name="l04540"></a><span class="lineno"> 4540</span>&#160;      <a class="code" href="../../d5/d60/utils_8h.html#a67b6713ff86cf82aaed821e9a87d1c21">ast_set2_flag</a>(&amp;cfg-&gt;<a class="code" href="../../da/d00/structast__xmpp__client__config.html#aec78000b2897c094f68ed72559e18acd">flags</a>, <a class="code" href="../../d6/d90/strings_8h.html#a387a69b3871ca31061566a73f45d20f4">ast_true</a>(var-&gt;<a class="code" href="../../dd/d02/structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>), <a class="code" href="../../dc/d6b/res__xmpp_8c.html#aa3759d2ddcc12f3f5ef5a8a3ffa4a4dfa2ee5bcbb4cbb964175aaddb7bf70c0cb">XMPP_USETLS</a>);</div><div class="line"><a name="l04541"></a><span class="lineno"> 4541</span>&#160;   } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(var-&gt;<a class="code" href="../../dd/d02/structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;usesasl&quot;</span>)) {</div><div class="line"><a name="l04542"></a><span class="lineno"> 4542</span>&#160;      <a class="code" href="../../d5/d60/utils_8h.html#a67b6713ff86cf82aaed821e9a87d1c21">ast_set2_flag</a>(&amp;cfg-&gt;<a class="code" href="../../da/d00/structast__xmpp__client__config.html#aec78000b2897c094f68ed72559e18acd">flags</a>, <a class="code" href="../../d6/d90/strings_8h.html#a387a69b3871ca31061566a73f45d20f4">ast_true</a>(var-&gt;<a class="code" href="../../dd/d02/structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>), <a class="code" href="../../dc/d6b/res__xmpp_8c.html#aa3759d2ddcc12f3f5ef5a8a3ffa4a4dfa7f963ec64d83b0ef771bb7d34a49dc34">XMPP_USESASL</a>);</div><div class="line"><a name="l04543"></a><span class="lineno"> 4543</span>&#160;   } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(var-&gt;<a class="code" href="../../dd/d02/structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;forceoldssl&quot;</span>)) {</div><div class="line"><a name="l04544"></a><span class="lineno"> 4544</span>&#160;      <a class="code" href="../../d5/d60/utils_8h.html#a67b6713ff86cf82aaed821e9a87d1c21">ast_set2_flag</a>(&amp;cfg-&gt;<a class="code" href="../../da/d00/structast__xmpp__client__config.html#aec78000b2897c094f68ed72559e18acd">flags</a>, <a class="code" href="../../d6/d90/strings_8h.html#a387a69b3871ca31061566a73f45d20f4">ast_true</a>(var-&gt;<a class="code" href="../../dd/d02/structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>), <a class="code" href="../../dc/d6b/res__xmpp_8c.html#aa3759d2ddcc12f3f5ef5a8a3ffa4a4dfa74ecf707a853e6e98644728f19c98b3f">XMPP_FORCESSL</a>);</div><div class="line"><a name="l04545"></a><span class="lineno"> 4545</span>&#160;   } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(var-&gt;<a class="code" href="../../dd/d02/structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;keepalive&quot;</span>)) {</div><div class="line"><a name="l04546"></a><span class="lineno"> 4546</span>&#160;      <a class="code" href="../../d5/d60/utils_8h.html#a67b6713ff86cf82aaed821e9a87d1c21">ast_set2_flag</a>(&amp;cfg-&gt;<a class="code" href="../../da/d00/structast__xmpp__client__config.html#aec78000b2897c094f68ed72559e18acd">flags</a>, <a class="code" href="../../d6/d90/strings_8h.html#a387a69b3871ca31061566a73f45d20f4">ast_true</a>(var-&gt;<a class="code" href="../../dd/d02/structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>), <a class="code" href="../../dc/d6b/res__xmpp_8c.html#aa3759d2ddcc12f3f5ef5a8a3ffa4a4dfac4a9cd4f07050cadcb19c07c6d3bf30f">XMPP_KEEPALIVE</a>);</div><div class="line"><a name="l04547"></a><span class="lineno"> 4547</span>&#160;   } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(var-&gt;<a class="code" href="../../dd/d02/structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;autoprune&quot;</span>)) {</div><div class="line"><a name="l04548"></a><span class="lineno"> 4548</span>&#160;      <a class="code" href="../../d5/d60/utils_8h.html#a67b6713ff86cf82aaed821e9a87d1c21">ast_set2_flag</a>(&amp;cfg-&gt;<a class="code" href="../../da/d00/structast__xmpp__client__config.html#aec78000b2897c094f68ed72559e18acd">flags</a>, <a class="code" href="../../d6/d90/strings_8h.html#a387a69b3871ca31061566a73f45d20f4">ast_true</a>(var-&gt;<a class="code" href="../../dd/d02/structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>), <a class="code" href="../../dc/d6b/res__xmpp_8c.html#aa3759d2ddcc12f3f5ef5a8a3ffa4a4dfa56b0aacbe6240e563e08310d1b6c8ce2">XMPP_AUTOPRUNE</a>);</div><div class="line"><a name="l04549"></a><span class="lineno"> 4549</span>&#160;      <a class="code" href="../../d5/d60/utils_8h.html#a67b6713ff86cf82aaed821e9a87d1c21">ast_set2_flag</a>(&amp;cfg-&gt;<a class="code" href="../../da/d00/structast__xmpp__client__config.html#afd35dbdf461b0fbd44e300eee66edebf">mod_flags</a>, 1, <a class="code" href="../../dc/d6b/res__xmpp_8c.html#aa3759d2ddcc12f3f5ef5a8a3ffa4a4dfa56b0aacbe6240e563e08310d1b6c8ce2">XMPP_AUTOPRUNE</a>);</div><div class="line"><a name="l04550"></a><span class="lineno"> 4550</span>&#160;   } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(var-&gt;<a class="code" href="../../dd/d02/structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;autoregister&quot;</span>)) {</div><div class="line"><a name="l04551"></a><span class="lineno"> 4551</span>&#160;      <a class="code" href="../../d5/d60/utils_8h.html#a67b6713ff86cf82aaed821e9a87d1c21">ast_set2_flag</a>(&amp;cfg-&gt;<a class="code" href="../../da/d00/structast__xmpp__client__config.html#aec78000b2897c094f68ed72559e18acd">flags</a>, <a class="code" href="../../d6/d90/strings_8h.html#a387a69b3871ca31061566a73f45d20f4">ast_true</a>(var-&gt;<a class="code" href="../../dd/d02/structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>), <a class="code" href="../../dc/d6b/res__xmpp_8c.html#aa3759d2ddcc12f3f5ef5a8a3ffa4a4dfa18ce12342ffe1b2f00bb53be6a87665d">XMPP_AUTOREGISTER</a>);</div><div class="line"><a name="l04552"></a><span class="lineno"> 4552</span>&#160;      <a class="code" href="../../d5/d60/utils_8h.html#a67b6713ff86cf82aaed821e9a87d1c21">ast_set2_flag</a>(&amp;cfg-&gt;<a class="code" href="../../da/d00/structast__xmpp__client__config.html#afd35dbdf461b0fbd44e300eee66edebf">mod_flags</a>, 1, <a class="code" href="../../dc/d6b/res__xmpp_8c.html#aa3759d2ddcc12f3f5ef5a8a3ffa4a4dfa18ce12342ffe1b2f00bb53be6a87665d">XMPP_AUTOREGISTER</a>);</div><div class="line"><a name="l04553"></a><span class="lineno"> 4553</span>&#160;   } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(var-&gt;<a class="code" href="../../dd/d02/structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;auth_policy&quot;</span>)) {</div><div class="line"><a name="l04554"></a><span class="lineno"> 4554</span>&#160;      <a class="code" href="../../d5/d60/utils_8h.html#a67b6713ff86cf82aaed821e9a87d1c21">ast_set2_flag</a>(&amp;cfg-&gt;<a class="code" href="../../da/d00/structast__xmpp__client__config.html#aec78000b2897c094f68ed72559e18acd">flags</a>, !strcasecmp(var-&gt;<a class="code" href="../../dd/d02/structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, <span class="stringliteral">&quot;accept&quot;</span>) ? 1 : 0, <a class="code" href="../../dc/d6b/res__xmpp_8c.html#aa3759d2ddcc12f3f5ef5a8a3ffa4a4dfa8c4cc198db356150269f85b0339f00bf">XMPP_AUTOACCEPT</a>);</div><div class="line"><a name="l04555"></a><span class="lineno"> 4555</span>&#160;      <a class="code" href="../../d5/d60/utils_8h.html#a67b6713ff86cf82aaed821e9a87d1c21">ast_set2_flag</a>(&amp;cfg-&gt;<a class="code" href="../../da/d00/structast__xmpp__client__config.html#afd35dbdf461b0fbd44e300eee66edebf">mod_flags</a>, 1, <a class="code" href="../../dc/d6b/res__xmpp_8c.html#aa3759d2ddcc12f3f5ef5a8a3ffa4a4dfa8c4cc198db356150269f85b0339f00bf">XMPP_AUTOACCEPT</a>);</div><div class="line"><a name="l04556"></a><span class="lineno"> 4556</span>&#160;   } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(var-&gt;<a class="code" href="../../dd/d02/structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;sendtodialplan&quot;</span>)) {</div><div class="line"><a name="l04557"></a><span class="lineno"> 4557</span>&#160;      <a class="code" href="../../d5/d60/utils_8h.html#a67b6713ff86cf82aaed821e9a87d1c21">ast_set2_flag</a>(&amp;cfg-&gt;<a class="code" href="../../da/d00/structast__xmpp__client__config.html#aec78000b2897c094f68ed72559e18acd">flags</a>, <a class="code" href="../../d6/d90/strings_8h.html#a387a69b3871ca31061566a73f45d20f4">ast_true</a>(var-&gt;<a class="code" href="../../dd/d02/structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>), <a class="code" href="../../dc/d6b/res__xmpp_8c.html#aa3759d2ddcc12f3f5ef5a8a3ffa4a4dfae6af6fd94e006a677047e6caa56c9651">XMPP_SEND_TO_DIALPLAN</a>);</div><div class="line"><a name="l04558"></a><span class="lineno"> 4558</span>&#160;   } <span class="keywordflow">else</span> {</div><div class="line"><a name="l04559"></a><span class="lineno"> 4559</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l04560"></a><span class="lineno"> 4560</span>&#160;   }</div><div class="line"><a name="l04561"></a><span class="lineno"> 4561</span>&#160;</div><div class="line"><a name="l04562"></a><span class="lineno"> 4562</span>&#160;   <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l04563"></a><span class="lineno"> 4563</span>&#160;}</div><div class="line"><a name="l04564"></a><span class="lineno"> 4564</span>&#160;</div><div class="line"><a name="l04565"></a><span class="lineno"><a class="line" href="../../dc/d6b/res__xmpp_8c.html#ae209090303331da87de8e8ac0ffb6956"> 4565</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../dc/d6b/res__xmpp_8c.html#ae209090303331da87de8e8ac0ffb6956">client_status_handler</a>(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="../../db/de0/structaco__option.html">aco_option</a> *opt, <span class="keyword">struct</span> <a class="code" href="../../dd/d02/structast__variable.html">ast_variable</a> *<a class="code" href="../../dc/df2/ast__expr2f_8c.html#a1b0936415a643c88ce543099c10e0d7f">var</a>, <span class="keywordtype">void</span> *obj)</div><div class="line"><a name="l04566"></a><span class="lineno"> 4566</span>&#160;{</div><div class="line"><a name="l04567"></a><span class="lineno"> 4567</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../da/d00/structast__xmpp__client__config.html">ast_xmpp_client_config</a> *cfg = obj;</div><div class="line"><a name="l04568"></a><span class="lineno"> 4568</span>&#160;</div><div class="line"><a name="l04569"></a><span class="lineno"> 4569</span>&#160;   <span class="keywordflow">if</span> (!strcasecmp(var-&gt;<a class="code" href="../../dd/d02/structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, <span class="stringliteral">&quot;unavailable&quot;</span>)) {</div><div class="line"><a name="l04570"></a><span class="lineno"> 4570</span>&#160;      cfg-&gt;<a class="code" href="../../da/d00/structast__xmpp__client__config.html#a522b409a211fd313b8a02f071aea6751">status</a> = IKS_SHOW_UNAVAILABLE;</div><div class="line"><a name="l04571"></a><span class="lineno"> 4571</span>&#160;   } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(var-&gt;<a class="code" href="../../dd/d02/structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, <span class="stringliteral">&quot;available&quot;</span>) || !strcasecmp(var-&gt;<a class="code" href="../../dd/d02/structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, <span class="stringliteral">&quot;online&quot;</span>)) {</div><div class="line"><a name="l04572"></a><span class="lineno"> 4572</span>&#160;      cfg-&gt;<a class="code" href="../../da/d00/structast__xmpp__client__config.html#a522b409a211fd313b8a02f071aea6751">status</a> = IKS_SHOW_AVAILABLE;</div><div class="line"><a name="l04573"></a><span class="lineno"> 4573</span>&#160;   } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(var-&gt;<a class="code" href="../../dd/d02/structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, <span class="stringliteral">&quot;chat&quot;</span>) || !strcasecmp(var-&gt;<a class="code" href="../../dd/d02/structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, <span class="stringliteral">&quot;chatty&quot;</span>)) {</div><div class="line"><a name="l04574"></a><span class="lineno"> 4574</span>&#160;      cfg-&gt;<a class="code" href="../../da/d00/structast__xmpp__client__config.html#a522b409a211fd313b8a02f071aea6751">status</a> = IKS_SHOW_CHAT;</div><div class="line"><a name="l04575"></a><span class="lineno"> 4575</span>&#160;   } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(var-&gt;<a class="code" href="../../dd/d02/structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, <span class="stringliteral">&quot;away&quot;</span>)) {</div><div class="line"><a name="l04576"></a><span class="lineno"> 4576</span>&#160;      cfg-&gt;<a class="code" href="../../da/d00/structast__xmpp__client__config.html#a522b409a211fd313b8a02f071aea6751">status</a> = IKS_SHOW_AWAY;</div><div class="line"><a name="l04577"></a><span class="lineno"> 4577</span>&#160;   } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(var-&gt;<a class="code" href="../../dd/d02/structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, <span class="stringliteral">&quot;xa&quot;</span>) || !strcasecmp(var-&gt;<a class="code" href="../../dd/d02/structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, <span class="stringliteral">&quot;xaway&quot;</span>)) {</div><div class="line"><a name="l04578"></a><span class="lineno"> 4578</span>&#160;      cfg-&gt;<a class="code" href="../../da/d00/structast__xmpp__client__config.html#a522b409a211fd313b8a02f071aea6751">status</a> = IKS_SHOW_XA;</div><div class="line"><a name="l04579"></a><span class="lineno"> 4579</span>&#160;   } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(var-&gt;<a class="code" href="../../dd/d02/structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, <span class="stringliteral">&quot;dnd&quot;</span>)) {</div><div class="line"><a name="l04580"></a><span class="lineno"> 4580</span>&#160;      cfg-&gt;<a class="code" href="../../da/d00/structast__xmpp__client__config.html#a522b409a211fd313b8a02f071aea6751">status</a> = IKS_SHOW_DND;</div><div class="line"><a name="l04581"></a><span class="lineno"> 4581</span>&#160;   } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(var-&gt;<a class="code" href="../../dd/d02/structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, <span class="stringliteral">&quot;invisible&quot;</span>)) {</div><div class="line"><a name="l04582"></a><span class="lineno"> 4582</span>&#160;<span class="preprocessor">#ifdef IKS_SHOW_INVISIBLE</span></div><div class="line"><a name="l04583"></a><span class="lineno"> 4583</span>&#160;      cfg-&gt;<a class="code" href="../../da/d00/structast__xmpp__client__config.html#a522b409a211fd313b8a02f071aea6751">status</a> = IKS_SHOW_INVISIBLE;</div><div class="line"><a name="l04584"></a><span class="lineno"> 4584</span>&#160;<span class="preprocessor">#else</span></div><div class="line"><a name="l04585"></a><span class="lineno"> 4585</span>&#160;      cfg-&gt;<a class="code" href="../../da/d00/structast__xmpp__client__config.html#a522b409a211fd313b8a02f071aea6751">status</a> = IKS_SHOW_DND;</div><div class="line"><a name="l04586"></a><span class="lineno"> 4586</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l04587"></a><span class="lineno"> 4587</span>&#160;   } <span class="keywordflow">else</span> {</div><div class="line"><a name="l04588"></a><span class="lineno"> 4588</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l04589"></a><span class="lineno"> 4589</span>&#160;   }</div><div class="line"><a name="l04590"></a><span class="lineno"> 4590</span>&#160;</div><div class="line"><a name="l04591"></a><span class="lineno"> 4591</span>&#160;   <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l04592"></a><span class="lineno"> 4592</span>&#160;}</div><div class="line"><a name="l04593"></a><span class="lineno"> 4593</span>&#160;</div><div class="line"><a name="l04594"></a><span class="lineno"><a class="line" href="../../dc/d6b/res__xmpp_8c.html#a89bb3d5d1a7726a6bb95af3760e70d51"> 4594</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../dc/d6b/res__xmpp_8c.html#a89bb3d5d1a7726a6bb95af3760e70d51">client_buddy_handler</a>(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="../../db/de0/structaco__option.html">aco_option</a> *opt, <span class="keyword">struct</span> <a class="code" href="../../dd/d02/structast__variable.html">ast_variable</a> *<a class="code" href="../../dc/df2/ast__expr2f_8c.html#a1b0936415a643c88ce543099c10e0d7f">var</a>, <span class="keywordtype">void</span> *obj)</div><div class="line"><a name="l04595"></a><span class="lineno"> 4595</span>&#160;{</div><div class="line"><a name="l04596"></a><span class="lineno"> 4596</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../da/d00/structast__xmpp__client__config.html">ast_xmpp_client_config</a> *cfg = obj;</div><div class="line"><a name="l04597"></a><span class="lineno"> 4597</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d5/d25/structast__xmpp__buddy.html">ast_xmpp_buddy</a> *buddy;</div><div class="line"><a name="l04598"></a><span class="lineno"> 4598</span>&#160;</div><div class="line"><a name="l04599"></a><span class="lineno"> 4599</span>&#160;   <span class="keywordflow">if</span> ((buddy = <a class="code" href="../../d5/da5/astobj2_8h.html#a911e0703891a9a7aaf73978152092586">ao2_find</a>(cfg-&gt;<a class="code" href="../../da/d00/structast__xmpp__client__config.html#a5082987d3e1eac5f625574800bb72c2c">buddies</a>, var-&gt;<a class="code" href="../../dd/d02/structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, <a class="code" href="../../d5/da5/astobj2_8h.html#a22f40c733a085f259af94e864ebaa09a">OBJ_KEY</a>))) {</div><div class="line"><a name="l04600"></a><span class="lineno"> 4600</span>&#160;      <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(buddy, -1);</div><div class="line"><a name="l04601"></a><span class="lineno"> 4601</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l04602"></a><span class="lineno"> 4602</span>&#160;   }</div><div class="line"><a name="l04603"></a><span class="lineno"> 4603</span>&#160;</div><div class="line"><a name="l04604"></a><span class="lineno"> 4604</span>&#160;   <span class="keywordflow">if</span> (!(buddy = <a class="code" href="../../dc/d6b/res__xmpp_8c.html#a4c3a2b177d134ce8482f9a5751754931">xmpp_client_create_buddy</a>(cfg-&gt;<a class="code" href="../../da/d00/structast__xmpp__client__config.html#a5082987d3e1eac5f625574800bb72c2c">buddies</a>, var-&gt;<a class="code" href="../../dd/d02/structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>))) {</div><div class="line"><a name="l04605"></a><span class="lineno"> 4605</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l04606"></a><span class="lineno"> 4606</span>&#160;   }</div><div class="line"><a name="l04607"></a><span class="lineno"> 4607</span>&#160;</div><div class="line"><a name="l04608"></a><span class="lineno"> 4608</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(buddy, -1);</div><div class="line"><a name="l04609"></a><span class="lineno"> 4609</span>&#160;</div><div class="line"><a name="l04610"></a><span class="lineno"> 4610</span>&#160;   <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l04611"></a><span class="lineno"> 4611</span>&#160;}</div><div class="line"><a name="l04612"></a><span class="lineno"> 4612</span>&#160;<span class="comment"></span></div><div class="line"><a name="l04613"></a><span class="lineno"> 4613</span>&#160;<span class="comment">/*!</span></div><div class="line"><a name="l04614"></a><span class="lineno"> 4614</span>&#160;<span class="comment"> * \brief Load the module</span></div><div class="line"><a name="l04615"></a><span class="lineno"> 4615</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l04616"></a><span class="lineno"> 4616</span>&#160;<span class="comment"> * Module loading including tests for configuration or dependencies.</span></div><div class="line"><a name="l04617"></a><span class="lineno"> 4617</span>&#160;<span class="comment"> * This function can return AST_MODULE_LOAD_FAILURE, AST_MODULE_LOAD_DECLINE,</span></div><div class="line"><a name="l04618"></a><span class="lineno"> 4618</span>&#160;<span class="comment"> * or AST_MODULE_LOAD_SUCCESS. If a dependency or environment variable fails</span></div><div class="line"><a name="l04619"></a><span class="lineno"> 4619</span>&#160;<span class="comment"> * tests return AST_MODULE_LOAD_FAILURE. If the module can not load the</span></div><div class="line"><a name="l04620"></a><span class="lineno"> 4620</span>&#160;<span class="comment"> * configuration file or other non-critical problem return</span></div><div class="line"><a name="l04621"></a><span class="lineno"> 4621</span>&#160;<span class="comment"> * AST_MODULE_LOAD_DECLINE. On success return AST_MODULE_LOAD_SUCCESS.</span></div><div class="line"><a name="l04622"></a><span class="lineno"> 4622</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l04623"></a><span class="lineno"><a class="line" href="../../dc/d6b/res__xmpp_8c.html#ac3382bf6da54c56b37069bd76bbdf4f9"> 4623</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../dc/d6b/res__xmpp_8c.html#ac3382bf6da54c56b37069bd76bbdf4f9">load_module</a>(<span class="keywordtype">void</span>)</div><div class="line"><a name="l04624"></a><span class="lineno"> 4624</span>&#160;{</div><div class="line"><a name="l04625"></a><span class="lineno"> 4625</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../db/dfe/config__options_8h.html#a3f40a7cffea07c21a21faaee64d24398">aco_info_init</a>(&amp;cfg_info)) {</div><div class="line"><a name="l04626"></a><span class="lineno"> 4626</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../d5/d16/module_8h.html#adc09474f0ff557e9925b722ee5b952dfac742921e9f9512d28f62c74ea2affe57">AST_MODULE_LOAD_DECLINE</a>;</div><div class="line"><a name="l04627"></a><span class="lineno"> 4627</span>&#160;   }</div><div class="line"><a name="l04628"></a><span class="lineno"> 4628</span>&#160;</div><div class="line"><a name="l04629"></a><span class="lineno"> 4629</span>&#160;   <a class="code" href="../../db/dfe/config__options_8h.html#a83b8d55eb1ba88ac7291f77a3ebfce45">aco_option_register_custom</a>(&amp;cfg_info, <span class="stringliteral">&quot;debug&quot;</span>, <a class="code" href="../../db/dfe/config__options_8h.html#a1b87da445ce6937e5cfbdaed1288a572abba7035409cf0b61400c00ef5bb59b52">ACO_EXACT</a>, global_options, <span class="stringliteral">&quot;no&quot;</span>, <a class="code" href="../../dc/d6b/res__xmpp_8c.html#a12d4caeaa50e0b2bf034ca996bd5e2a4">global_bitfield_handler</a>, 0);</div><div class="line"><a name="l04630"></a><span class="lineno"> 4630</span>&#160;   <a class="code" href="../../db/dfe/config__options_8h.html#a83b8d55eb1ba88ac7291f77a3ebfce45">aco_option_register_custom</a>(&amp;cfg_info, <span class="stringliteral">&quot;autoprune&quot;</span>, <a class="code" href="../../db/dfe/config__options_8h.html#a1b87da445ce6937e5cfbdaed1288a572abba7035409cf0b61400c00ef5bb59b52">ACO_EXACT</a>, global_options, <span class="stringliteral">&quot;no&quot;</span>, <a class="code" href="../../dc/d6b/res__xmpp_8c.html#a12d4caeaa50e0b2bf034ca996bd5e2a4">global_bitfield_handler</a>, 0);</div><div class="line"><a name="l04631"></a><span class="lineno"> 4631</span>&#160;   <a class="code" href="../../db/dfe/config__options_8h.html#a83b8d55eb1ba88ac7291f77a3ebfce45">aco_option_register_custom</a>(&amp;cfg_info, <span class="stringliteral">&quot;autoregister&quot;</span>, <a class="code" href="../../db/dfe/config__options_8h.html#a1b87da445ce6937e5cfbdaed1288a572abba7035409cf0b61400c00ef5bb59b52">ACO_EXACT</a>, global_options, <span class="stringliteral">&quot;yes&quot;</span>, <a class="code" href="../../dc/d6b/res__xmpp_8c.html#a12d4caeaa50e0b2bf034ca996bd5e2a4">global_bitfield_handler</a>, 0);</div><div class="line"><a name="l04632"></a><span class="lineno"> 4632</span>&#160;   <a class="code" href="../../db/dfe/config__options_8h.html#a83b8d55eb1ba88ac7291f77a3ebfce45">aco_option_register_custom</a>(&amp;cfg_info, <span class="stringliteral">&quot;collection_nodes&quot;</span>, <a class="code" href="../../db/dfe/config__options_8h.html#a1b87da445ce6937e5cfbdaed1288a572abba7035409cf0b61400c00ef5bb59b52">ACO_EXACT</a>, global_options, <span class="stringliteral">&quot;no&quot;</span>, <a class="code" href="../../dc/d6b/res__xmpp_8c.html#a12d4caeaa50e0b2bf034ca996bd5e2a4">global_bitfield_handler</a>, 0);</div><div class="line"><a name="l04633"></a><span class="lineno"> 4633</span>&#160;   <a class="code" href="../../db/dfe/config__options_8h.html#a83b8d55eb1ba88ac7291f77a3ebfce45">aco_option_register_custom</a>(&amp;cfg_info, <span class="stringliteral">&quot;pubsub_autocreate&quot;</span>, <a class="code" href="../../db/dfe/config__options_8h.html#a1b87da445ce6937e5cfbdaed1288a572abba7035409cf0b61400c00ef5bb59b52">ACO_EXACT</a>, global_options, <span class="stringliteral">&quot;no&quot;</span>, <a class="code" href="../../dc/d6b/res__xmpp_8c.html#a12d4caeaa50e0b2bf034ca996bd5e2a4">global_bitfield_handler</a>, 0);</div><div class="line"><a name="l04634"></a><span class="lineno"> 4634</span>&#160;   <a class="code" href="../../db/dfe/config__options_8h.html#a83b8d55eb1ba88ac7291f77a3ebfce45">aco_option_register_custom</a>(&amp;cfg_info, <span class="stringliteral">&quot;auth_policy&quot;</span>, <a class="code" href="../../db/dfe/config__options_8h.html#a1b87da445ce6937e5cfbdaed1288a572abba7035409cf0b61400c00ef5bb59b52">ACO_EXACT</a>, global_options, <span class="stringliteral">&quot;accept&quot;</span>, <a class="code" href="../../dc/d6b/res__xmpp_8c.html#a12d4caeaa50e0b2bf034ca996bd5e2a4">global_bitfield_handler</a>, 0);</div><div class="line"><a name="l04635"></a><span class="lineno"> 4635</span>&#160;</div><div class="line"><a name="l04636"></a><span class="lineno"> 4636</span>&#160;   <a class="code" href="../../db/dfe/config__options_8h.html#a60d17d3e9451ddcb5aa861339c757bed">aco_option_register</a>(&amp;cfg_info, <span class="stringliteral">&quot;username&quot;</span>, <a class="code" href="../../db/dfe/config__options_8h.html#a1b87da445ce6937e5cfbdaed1288a572abba7035409cf0b61400c00ef5bb59b52">ACO_EXACT</a>, client_options, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../db/dfe/config__options_8h.html#a61bb4940517e7d00e7104de8273c2144afec8c0a18639b70f2e518bc8ee9f3540">OPT_STRINGFIELD_T</a>, 0, <a class="code" href="../../db/dfe/config__options_8h.html#a3e5be807d4a10b6da6382a40a0004ace">STRFLDSET</a>(<span class="keyword">struct</span> <a class="code" href="../../da/d00/structast__xmpp__client__config.html">ast_xmpp_client_config</a>, <a class="code" href="../../d8/dbc/structuser.html">user</a>));</div><div class="line"><a name="l04637"></a><span class="lineno"> 4637</span>&#160;   <a class="code" href="../../db/dfe/config__options_8h.html#a60d17d3e9451ddcb5aa861339c757bed">aco_option_register</a>(&amp;cfg_info, <span class="stringliteral">&quot;secret&quot;</span>, <a class="code" href="../../db/dfe/config__options_8h.html#a1b87da445ce6937e5cfbdaed1288a572abba7035409cf0b61400c00ef5bb59b52">ACO_EXACT</a>, client_options, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../db/dfe/config__options_8h.html#a61bb4940517e7d00e7104de8273c2144afec8c0a18639b70f2e518bc8ee9f3540">OPT_STRINGFIELD_T</a>, 0, <a class="code" href="../../db/dfe/config__options_8h.html#a3e5be807d4a10b6da6382a40a0004ace">STRFLDSET</a>(<span class="keyword">struct</span> <a class="code" href="../../da/d00/structast__xmpp__client__config.html">ast_xmpp_client_config</a>, <a class="code" href="../../d0/d29/cdr__mysql_8c.html#ab4fdb206838f2974bd15fc2ca1e9d366">password</a>));</div><div class="line"><a name="l04638"></a><span class="lineno"> 4638</span>&#160;   <a class="code" href="../../db/dfe/config__options_8h.html#a60d17d3e9451ddcb5aa861339c757bed">aco_option_register</a>(&amp;cfg_info, <span class="stringliteral">&quot;refresh_token&quot;</span>, <a class="code" href="../../db/dfe/config__options_8h.html#a1b87da445ce6937e5cfbdaed1288a572abba7035409cf0b61400c00ef5bb59b52">ACO_EXACT</a>, client_options, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../db/dfe/config__options_8h.html#a61bb4940517e7d00e7104de8273c2144afec8c0a18639b70f2e518bc8ee9f3540">OPT_STRINGFIELD_T</a>, 0, <a class="code" href="../../db/dfe/config__options_8h.html#a3e5be807d4a10b6da6382a40a0004ace">STRFLDSET</a>(<span class="keyword">struct</span> <a class="code" href="../../da/d00/structast__xmpp__client__config.html">ast_xmpp_client_config</a>, refresh_token));</div><div class="line"><a name="l04639"></a><span class="lineno"> 4639</span>&#160;   <a class="code" href="../../db/dfe/config__options_8h.html#a60d17d3e9451ddcb5aa861339c757bed">aco_option_register</a>(&amp;cfg_info, <span class="stringliteral">&quot;oauth_clientid&quot;</span>, <a class="code" href="../../db/dfe/config__options_8h.html#a1b87da445ce6937e5cfbdaed1288a572abba7035409cf0b61400c00ef5bb59b52">ACO_EXACT</a>, client_options, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../db/dfe/config__options_8h.html#a61bb4940517e7d00e7104de8273c2144afec8c0a18639b70f2e518bc8ee9f3540">OPT_STRINGFIELD_T</a>, 0, <a class="code" href="../../db/dfe/config__options_8h.html#a3e5be807d4a10b6da6382a40a0004ace">STRFLDSET</a>(<span class="keyword">struct</span> <a class="code" href="../../da/d00/structast__xmpp__client__config.html">ast_xmpp_client_config</a>, oauth_clientid));</div><div class="line"><a name="l04640"></a><span class="lineno"> 4640</span>&#160;   <a class="code" href="../../db/dfe/config__options_8h.html#a60d17d3e9451ddcb5aa861339c757bed">aco_option_register</a>(&amp;cfg_info, <span class="stringliteral">&quot;oauth_secret&quot;</span>, <a class="code" href="../../db/dfe/config__options_8h.html#a1b87da445ce6937e5cfbdaed1288a572abba7035409cf0b61400c00ef5bb59b52">ACO_EXACT</a>, client_options, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../db/dfe/config__options_8h.html#a61bb4940517e7d00e7104de8273c2144afec8c0a18639b70f2e518bc8ee9f3540">OPT_STRINGFIELD_T</a>, 0, <a class="code" href="../../db/dfe/config__options_8h.html#a3e5be807d4a10b6da6382a40a0004ace">STRFLDSET</a>(<span class="keyword">struct</span> <a class="code" href="../../da/d00/structast__xmpp__client__config.html">ast_xmpp_client_config</a>, oauth_secret));</div><div class="line"><a name="l04641"></a><span class="lineno"> 4641</span>&#160;   <a class="code" href="../../db/dfe/config__options_8h.html#a60d17d3e9451ddcb5aa861339c757bed">aco_option_register</a>(&amp;cfg_info, <span class="stringliteral">&quot;serverhost&quot;</span>, <a class="code" href="../../db/dfe/config__options_8h.html#a1b87da445ce6937e5cfbdaed1288a572abba7035409cf0b61400c00ef5bb59b52">ACO_EXACT</a>, client_options, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../db/dfe/config__options_8h.html#a61bb4940517e7d00e7104de8273c2144afec8c0a18639b70f2e518bc8ee9f3540">OPT_STRINGFIELD_T</a>, 0, <a class="code" href="../../db/dfe/config__options_8h.html#a3e5be807d4a10b6da6382a40a0004ace">STRFLDSET</a>(<span class="keyword">struct</span> <a class="code" href="../../da/d00/structast__xmpp__client__config.html">ast_xmpp_client_config</a>, server));</div><div class="line"><a name="l04642"></a><span class="lineno"> 4642</span>&#160;   <a class="code" href="../../db/dfe/config__options_8h.html#a60d17d3e9451ddcb5aa861339c757bed">aco_option_register</a>(&amp;cfg_info, <span class="stringliteral">&quot;statusmessage&quot;</span>, <a class="code" href="../../db/dfe/config__options_8h.html#a1b87da445ce6937e5cfbdaed1288a572abba7035409cf0b61400c00ef5bb59b52">ACO_EXACT</a>, client_options, <span class="stringliteral">&quot;Online and Available&quot;</span>, <a class="code" href="../../db/dfe/config__options_8h.html#a61bb4940517e7d00e7104de8273c2144afec8c0a18639b70f2e518bc8ee9f3540">OPT_STRINGFIELD_T</a>, 0, <a class="code" href="../../db/dfe/config__options_8h.html#a3e5be807d4a10b6da6382a40a0004ace">STRFLDSET</a>(<span class="keyword">struct</span> <a class="code" href="../../da/d00/structast__xmpp__client__config.html">ast_xmpp_client_config</a>, statusmsg));</div><div class="line"><a name="l04643"></a><span class="lineno"> 4643</span>&#160;   <a class="code" href="../../db/dfe/config__options_8h.html#a60d17d3e9451ddcb5aa861339c757bed">aco_option_register</a>(&amp;cfg_info, <span class="stringliteral">&quot;pubsub_node&quot;</span>, <a class="code" href="../../db/dfe/config__options_8h.html#a1b87da445ce6937e5cfbdaed1288a572abba7035409cf0b61400c00ef5bb59b52">ACO_EXACT</a>, client_options, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../db/dfe/config__options_8h.html#a61bb4940517e7d00e7104de8273c2144afec8c0a18639b70f2e518bc8ee9f3540">OPT_STRINGFIELD_T</a>, 0, <a class="code" href="../../db/dfe/config__options_8h.html#a3e5be807d4a10b6da6382a40a0004ace">STRFLDSET</a>(<span class="keyword">struct</span> <a class="code" href="../../da/d00/structast__xmpp__client__config.html">ast_xmpp_client_config</a>, pubsubnode));</div><div class="line"><a name="l04644"></a><span class="lineno"> 4644</span>&#160;   <a class="code" href="../../db/dfe/config__options_8h.html#a60d17d3e9451ddcb5aa861339c757bed">aco_option_register</a>(&amp;cfg_info, <span class="stringliteral">&quot;context&quot;</span>, <a class="code" href="../../db/dfe/config__options_8h.html#a1b87da445ce6937e5cfbdaed1288a572abba7035409cf0b61400c00ef5bb59b52">ACO_EXACT</a>, client_options, <span class="stringliteral">&quot;default&quot;</span>, <a class="code" href="../../db/dfe/config__options_8h.html#a61bb4940517e7d00e7104de8273c2144afec8c0a18639b70f2e518bc8ee9f3540">OPT_STRINGFIELD_T</a>, 0, <a class="code" href="../../db/dfe/config__options_8h.html#a3e5be807d4a10b6da6382a40a0004ace">STRFLDSET</a>(<span class="keyword">struct</span> <a class="code" href="../../da/d00/structast__xmpp__client__config.html">ast_xmpp_client_config</a>, <a class="code" href="../../da/d45/chan__alsa_8c.html#ac25ea00ee3f082df06e0cf468cbde240">context</a>));</div><div class="line"><a name="l04645"></a><span class="lineno"> 4645</span>&#160;   <a class="code" href="../../db/dfe/config__options_8h.html#a60d17d3e9451ddcb5aa861339c757bed">aco_option_register</a>(&amp;cfg_info, <span class="stringliteral">&quot;priority&quot;</span>, <a class="code" href="../../db/dfe/config__options_8h.html#a1b87da445ce6937e5cfbdaed1288a572abba7035409cf0b61400c00ef5bb59b52">ACO_EXACT</a>, client_options, <span class="stringliteral">&quot;1&quot;</span>, <a class="code" href="../../db/dfe/config__options_8h.html#a61bb4940517e7d00e7104de8273c2144a019a75c8729b63787919b2e67331c84f">OPT_UINT_T</a>, 0, <a class="code" href="../../db/dfe/config__options_8h.html#a5793d5d6ccf2df0b2423eb3274af7802">FLDSET</a>(<span class="keyword">struct</span> <a class="code" href="../../da/d00/structast__xmpp__client__config.html">ast_xmpp_client_config</a>, <a class="code" href="../../d9/d47/cdr__beanstalkd_8c.html#acec9ce2df15222151ad66fcb1d74eb9f">priority</a>));</div><div class="line"><a name="l04646"></a><span class="lineno"> 4646</span>&#160;   <a class="code" href="../../db/dfe/config__options_8h.html#a60d17d3e9451ddcb5aa861339c757bed">aco_option_register</a>(&amp;cfg_info, <span class="stringliteral">&quot;port&quot;</span>, <a class="code" href="../../db/dfe/config__options_8h.html#a1b87da445ce6937e5cfbdaed1288a572abba7035409cf0b61400c00ef5bb59b52">ACO_EXACT</a>, client_options, <span class="stringliteral">&quot;5222&quot;</span>, <a class="code" href="../../db/dfe/config__options_8h.html#a61bb4940517e7d00e7104de8273c2144a019a75c8729b63787919b2e67331c84f">OPT_UINT_T</a>, 0, <a class="code" href="../../db/dfe/config__options_8h.html#a5793d5d6ccf2df0b2423eb3274af7802">FLDSET</a>(<span class="keyword">struct</span> <a class="code" href="../../da/d00/structast__xmpp__client__config.html">ast_xmpp_client_config</a>, port));</div><div class="line"><a name="l04647"></a><span class="lineno"> 4647</span>&#160;   <a class="code" href="../../db/dfe/config__options_8h.html#a60d17d3e9451ddcb5aa861339c757bed">aco_option_register</a>(&amp;cfg_info, <span class="stringliteral">&quot;timeout&quot;</span>, <a class="code" href="../../db/dfe/config__options_8h.html#a1b87da445ce6937e5cfbdaed1288a572abba7035409cf0b61400c00ef5bb59b52">ACO_EXACT</a>, client_options, <span class="stringliteral">&quot;5&quot;</span>, <a class="code" href="../../db/dfe/config__options_8h.html#a61bb4940517e7d00e7104de8273c2144a019a75c8729b63787919b2e67331c84f">OPT_UINT_T</a>, 0, <a class="code" href="../../db/dfe/config__options_8h.html#a5793d5d6ccf2df0b2423eb3274af7802">FLDSET</a>(<span class="keyword">struct</span> <a class="code" href="../../da/d00/structast__xmpp__client__config.html">ast_xmpp_client_config</a>, message_timeout));</div><div class="line"><a name="l04648"></a><span class="lineno"> 4648</span>&#160;</div><div class="line"><a name="l04649"></a><span class="lineno"> 4649</span>&#160;   <span class="comment">/* Global options that can be overridden per client must not specify a default */</span></div><div class="line"><a name="l04650"></a><span class="lineno"> 4650</span>&#160;   <a class="code" href="../../db/dfe/config__options_8h.html#a83b8d55eb1ba88ac7291f77a3ebfce45">aco_option_register_custom</a>(&amp;cfg_info, <span class="stringliteral">&quot;autoprune&quot;</span>, <a class="code" href="../../db/dfe/config__options_8h.html#a1b87da445ce6937e5cfbdaed1288a572abba7035409cf0b61400c00ef5bb59b52">ACO_EXACT</a>, client_options, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../dc/d6b/res__xmpp_8c.html#a46e9779a8a2096c9837d9e04943b5613">client_bitfield_handler</a>, 0);</div><div class="line"><a name="l04651"></a><span class="lineno"> 4651</span>&#160;   <a class="code" href="../../db/dfe/config__options_8h.html#a83b8d55eb1ba88ac7291f77a3ebfce45">aco_option_register_custom</a>(&amp;cfg_info, <span class="stringliteral">&quot;autoregister&quot;</span>, <a class="code" href="../../db/dfe/config__options_8h.html#a1b87da445ce6937e5cfbdaed1288a572abba7035409cf0b61400c00ef5bb59b52">ACO_EXACT</a>, client_options, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../dc/d6b/res__xmpp_8c.html#a46e9779a8a2096c9837d9e04943b5613">client_bitfield_handler</a>, 0);</div><div class="line"><a name="l04652"></a><span class="lineno"> 4652</span>&#160;   <a class="code" href="../../db/dfe/config__options_8h.html#a83b8d55eb1ba88ac7291f77a3ebfce45">aco_option_register_custom</a>(&amp;cfg_info, <span class="stringliteral">&quot;auth_policy&quot;</span>, <a class="code" href="../../db/dfe/config__options_8h.html#a1b87da445ce6937e5cfbdaed1288a572abba7035409cf0b61400c00ef5bb59b52">ACO_EXACT</a>, client_options, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../dc/d6b/res__xmpp_8c.html#a46e9779a8a2096c9837d9e04943b5613">client_bitfield_handler</a>, 0);</div><div class="line"><a name="l04653"></a><span class="lineno"> 4653</span>&#160;</div><div class="line"><a name="l04654"></a><span class="lineno"> 4654</span>&#160;   <a class="code" href="../../db/dfe/config__options_8h.html#a83b8d55eb1ba88ac7291f77a3ebfce45">aco_option_register_custom</a>(&amp;cfg_info, <span class="stringliteral">&quot;debug&quot;</span>, <a class="code" href="../../db/dfe/config__options_8h.html#a1b87da445ce6937e5cfbdaed1288a572abba7035409cf0b61400c00ef5bb59b52">ACO_EXACT</a>, client_options, <span class="stringliteral">&quot;no&quot;</span>, <a class="code" href="../../dc/d6b/res__xmpp_8c.html#a46e9779a8a2096c9837d9e04943b5613">client_bitfield_handler</a>, 0);</div><div class="line"><a name="l04655"></a><span class="lineno"> 4655</span>&#160;   <a class="code" href="../../db/dfe/config__options_8h.html#a83b8d55eb1ba88ac7291f77a3ebfce45">aco_option_register_custom</a>(&amp;cfg_info, <span class="stringliteral">&quot;type&quot;</span>, <a class="code" href="../../db/dfe/config__options_8h.html#a1b87da445ce6937e5cfbdaed1288a572abba7035409cf0b61400c00ef5bb59b52">ACO_EXACT</a>, client_options, <span class="stringliteral">&quot;client&quot;</span>, <a class="code" href="../../dc/d6b/res__xmpp_8c.html#a46e9779a8a2096c9837d9e04943b5613">client_bitfield_handler</a>, 0);</div><div class="line"><a name="l04656"></a><span class="lineno"> 4656</span>&#160;   <a class="code" href="../../db/dfe/config__options_8h.html#a83b8d55eb1ba88ac7291f77a3ebfce45">aco_option_register_custom</a>(&amp;cfg_info, <span class="stringliteral">&quot;distribute_events&quot;</span>, <a class="code" href="../../db/dfe/config__options_8h.html#a1b87da445ce6937e5cfbdaed1288a572abba7035409cf0b61400c00ef5bb59b52">ACO_EXACT</a>, client_options, <span class="stringliteral">&quot;no&quot;</span>, <a class="code" href="../../dc/d6b/res__xmpp_8c.html#a46e9779a8a2096c9837d9e04943b5613">client_bitfield_handler</a>, 0);</div><div class="line"><a name="l04657"></a><span class="lineno"> 4657</span>&#160;   <a class="code" href="../../db/dfe/config__options_8h.html#a83b8d55eb1ba88ac7291f77a3ebfce45">aco_option_register_custom</a>(&amp;cfg_info, <span class="stringliteral">&quot;usetls&quot;</span>, <a class="code" href="../../db/dfe/config__options_8h.html#a1b87da445ce6937e5cfbdaed1288a572abba7035409cf0b61400c00ef5bb59b52">ACO_EXACT</a>, client_options, <span class="stringliteral">&quot;yes&quot;</span>, <a class="code" href="../../dc/d6b/res__xmpp_8c.html#a46e9779a8a2096c9837d9e04943b5613">client_bitfield_handler</a>, 0);</div><div class="line"><a name="l04658"></a><span class="lineno"> 4658</span>&#160;   <a class="code" href="../../db/dfe/config__options_8h.html#a83b8d55eb1ba88ac7291f77a3ebfce45">aco_option_register_custom</a>(&amp;cfg_info, <span class="stringliteral">&quot;usesasl&quot;</span>, <a class="code" href="../../db/dfe/config__options_8h.html#a1b87da445ce6937e5cfbdaed1288a572abba7035409cf0b61400c00ef5bb59b52">ACO_EXACT</a>, client_options, <span class="stringliteral">&quot;yes&quot;</span>, <a class="code" href="../../dc/d6b/res__xmpp_8c.html#a46e9779a8a2096c9837d9e04943b5613">client_bitfield_handler</a>, 0);</div><div class="line"><a name="l04659"></a><span class="lineno"> 4659</span>&#160;   <a class="code" href="../../db/dfe/config__options_8h.html#a83b8d55eb1ba88ac7291f77a3ebfce45">aco_option_register_custom</a>(&amp;cfg_info, <span class="stringliteral">&quot;forceoldssl&quot;</span>, <a class="code" href="../../db/dfe/config__options_8h.html#a1b87da445ce6937e5cfbdaed1288a572abba7035409cf0b61400c00ef5bb59b52">ACO_EXACT</a>, client_options, <span class="stringliteral">&quot;no&quot;</span>, <a class="code" href="../../dc/d6b/res__xmpp_8c.html#a46e9779a8a2096c9837d9e04943b5613">client_bitfield_handler</a>, 0);</div><div class="line"><a name="l04660"></a><span class="lineno"> 4660</span>&#160;   <a class="code" href="../../db/dfe/config__options_8h.html#a83b8d55eb1ba88ac7291f77a3ebfce45">aco_option_register_custom</a>(&amp;cfg_info, <span class="stringliteral">&quot;keepalive&quot;</span>, <a class="code" href="../../db/dfe/config__options_8h.html#a1b87da445ce6937e5cfbdaed1288a572abba7035409cf0b61400c00ef5bb59b52">ACO_EXACT</a>, client_options, <span class="stringliteral">&quot;yes&quot;</span>, <a class="code" href="../../dc/d6b/res__xmpp_8c.html#a46e9779a8a2096c9837d9e04943b5613">client_bitfield_handler</a>, 0);</div><div class="line"><a name="l04661"></a><span class="lineno"> 4661</span>&#160;   <a class="code" href="../../db/dfe/config__options_8h.html#a83b8d55eb1ba88ac7291f77a3ebfce45">aco_option_register_custom</a>(&amp;cfg_info, <span class="stringliteral">&quot;sendtodialplan&quot;</span>, <a class="code" href="../../db/dfe/config__options_8h.html#a1b87da445ce6937e5cfbdaed1288a572abba7035409cf0b61400c00ef5bb59b52">ACO_EXACT</a>, client_options, <span class="stringliteral">&quot;no&quot;</span>, <a class="code" href="../../dc/d6b/res__xmpp_8c.html#a46e9779a8a2096c9837d9e04943b5613">client_bitfield_handler</a>, 0);</div><div class="line"><a name="l04662"></a><span class="lineno"> 4662</span>&#160;   <a class="code" href="../../db/dfe/config__options_8h.html#a83b8d55eb1ba88ac7291f77a3ebfce45">aco_option_register_custom</a>(&amp;cfg_info, <span class="stringliteral">&quot;status&quot;</span>, <a class="code" href="../../db/dfe/config__options_8h.html#a1b87da445ce6937e5cfbdaed1288a572abba7035409cf0b61400c00ef5bb59b52">ACO_EXACT</a>, client_options, <span class="stringliteral">&quot;available&quot;</span>, <a class="code" href="../../dc/d6b/res__xmpp_8c.html#ae209090303331da87de8e8ac0ffb6956">client_status_handler</a>, 0);</div><div class="line"><a name="l04663"></a><span class="lineno"> 4663</span>&#160;   <a class="code" href="../../db/dfe/config__options_8h.html#a83b8d55eb1ba88ac7291f77a3ebfce45">aco_option_register_custom</a>(&amp;cfg_info, <span class="stringliteral">&quot;buddy&quot;</span>, <a class="code" href="../../db/dfe/config__options_8h.html#a1b87da445ce6937e5cfbdaed1288a572abba7035409cf0b61400c00ef5bb59b52">ACO_EXACT</a>, client_options, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../dc/d6b/res__xmpp_8c.html#a89bb3d5d1a7726a6bb95af3760e70d51">client_buddy_handler</a>, 0);</div><div class="line"><a name="l04664"></a><span class="lineno"> 4664</span>&#160;</div><div class="line"><a name="l04665"></a><span class="lineno"> 4665</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../db/dfe/config__options_8h.html#af28935f8c2547723d5922ebed1c71898">aco_process_config</a>(&amp;cfg_info, 0) == <a class="code" href="../../db/dfe/config__options_8h.html#a3b4f259d48ef20f47171b73078282d75a832b5997265d8870481f9684cbca5792">ACO_PROCESS_ERROR</a>) {</div><div class="line"><a name="l04666"></a><span class="lineno"> 4666</span>&#160;      <a class="code" href="../../db/dfe/config__options_8h.html#a21b11339ca4d0b1167c956a9f816bd19">aco_info_destroy</a>(&amp;cfg_info);</div><div class="line"><a name="l04667"></a><span class="lineno"> 4667</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../d5/d16/module_8h.html#adc09474f0ff557e9925b722ee5b952dfac742921e9f9512d28f62c74ea2affe57">AST_MODULE_LOAD_DECLINE</a>;</div><div class="line"><a name="l04668"></a><span class="lineno"> 4668</span>&#160;   }</div><div class="line"><a name="l04669"></a><span class="lineno"> 4669</span>&#160;</div><div class="line"><a name="l04670"></a><span class="lineno"> 4670</span>&#160;   <a class="code" href="../../db/d45/manager_8h.html#a5b63b8a8faede2d852e071e1f7b31c11">ast_manager_register_xml</a>(<span class="stringliteral">&quot;JabberSend&quot;</span>, <a class="code" href="../../db/d45/manager_8h.html#a420f0f755e1c3378b45ca7f6f0669ffa">EVENT_FLAG_SYSTEM</a>, <a class="code" href="../../dc/d6b/res__xmpp_8c.html#a48ebc7a99890a29f1901304e574d4f03">manager_jabber_send</a>);</div><div class="line"><a name="l04671"></a><span class="lineno"> 4671</span>&#160;</div><div class="line"><a name="l04672"></a><span class="lineno"> 4672</span>&#160;   <a class="code" href="../../d5/d16/module_8h.html#afba4eb7a910b10969041ae4cd488729d">ast_register_application_xml</a>(app_ajisend, <a class="code" href="../../dc/d6b/res__xmpp_8c.html#a0e0cd41a2d8096259189d003db0238d7">xmpp_send_exec</a>);</div><div class="line"><a name="l04673"></a><span class="lineno"> 4673</span>&#160;   <a class="code" href="../../d5/d16/module_8h.html#afba4eb7a910b10969041ae4cd488729d">ast_register_application_xml</a>(app_ajisendgroup, <a class="code" href="../../dc/d6b/res__xmpp_8c.html#aef2ad31249e4f24084ed1e9c478147ca">xmpp_sendgroup_exec</a>);</div><div class="line"><a name="l04674"></a><span class="lineno"> 4674</span>&#160;   <a class="code" href="../../d5/d16/module_8h.html#afba4eb7a910b10969041ae4cd488729d">ast_register_application_xml</a>(app_ajijoin, <a class="code" href="../../dc/d6b/res__xmpp_8c.html#a4d9c4b11143ef37e2b1608c75680b1a7">xmpp_join_exec</a>);</div><div class="line"><a name="l04675"></a><span class="lineno"> 4675</span>&#160;   <a class="code" href="../../d5/d16/module_8h.html#afba4eb7a910b10969041ae4cd488729d">ast_register_application_xml</a>(app_ajileave, <a class="code" href="../../dc/d6b/res__xmpp_8c.html#aec97d98f13445cd1a95c1deed32489be">xmpp_leave_exec</a>);</div><div class="line"><a name="l04676"></a><span class="lineno"> 4676</span>&#160;</div><div class="line"><a name="l04677"></a><span class="lineno"> 4677</span>&#160;   <a class="code" href="../../dc/db0/cli_8h.html#aea8910ed9e301e7f741f87942c244eac">ast_cli_register_multiple</a>(xmpp_cli, <a class="code" href="../../de/dfe/isdn__lib_8c.html#ab9129b977a587b50ea801daac75e178f">ARRAY_LEN</a>(xmpp_cli));</div><div class="line"><a name="l04678"></a><span class="lineno"> 4678</span>&#160;   <a class="code" href="../../db/de0/pbx_8h.html#a8af0e93442a9e468425f63cc52b0ac7b">ast_custom_function_register</a>(&amp;jabberstatus_function);</div><div class="line"><a name="l04679"></a><span class="lineno"> 4679</span>&#160;   <a class="code" href="../../db/de0/pbx_8h.html#a8af0e93442a9e468425f63cc52b0ac7b">ast_custom_function_register</a>(&amp;jabberreceive_function);</div><div class="line"><a name="l04680"></a><span class="lineno"> 4680</span>&#160;   <a class="code" href="../../d2/d0d/message_8h.html#a98ae66acbd6268c5010acf52be7e40a4">ast_msg_tech_register</a>(&amp;msg_tech);</div><div class="line"><a name="l04681"></a><span class="lineno"> 4681</span>&#160;</div><div class="line"><a name="l04682"></a><span class="lineno"> 4682</span>&#160;   <a class="code" href="../../dd/d42/lock_8h.html#a76e8ed6bb354be6c6dd9e51acc1d7a1b">ast_mutex_init</a>(&amp;messagelock);</div><div class="line"><a name="l04683"></a><span class="lineno"> 4683</span>&#160;   <a class="code" href="../../dd/d42/lock_8h.html#a69e9591803d36f5683eb9b084442be9b">ast_cond_init</a>(&amp;message_received_condition, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div><div class="line"><a name="l04684"></a><span class="lineno"> 4684</span>&#160;</div><div class="line"><a name="l04685"></a><span class="lineno"> 4685</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d5/d60/utils_8h.html#a9052010ef014bd56be478fab26feb2e1">ast_eid_is_empty</a>(&amp;<a class="code" href="../../d5/d60/utils_8h.html#ad5db11fa27352e2b9a3c669adc76955f">ast_eid_default</a>)) {</div><div class="line"><a name="l04686"></a><span class="lineno"> 4686</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Entity ID is not set. The distributing device state or MWI will not work.\n&quot;</span>);</div><div class="line"><a name="l04687"></a><span class="lineno"> 4687</span>&#160;   }</div><div class="line"><a name="l04688"></a><span class="lineno"> 4688</span>&#160;</div><div class="line"><a name="l04689"></a><span class="lineno"> 4689</span>&#160;   <span class="keywordflow">return</span> <a class="code" href="../../d5/d16/module_8h.html#adc09474f0ff557e9925b722ee5b952dfa89bb877ade9ce418ad6663f3d936f314">AST_MODULE_LOAD_SUCCESS</a>;</div><div class="line"><a name="l04690"></a><span class="lineno"> 4690</span>&#160;}</div><div class="line"><a name="l04691"></a><span class="lineno"> 4691</span>&#160;</div><div class="line"><a name="l04692"></a><span class="lineno"><a class="line" href="../../dc/d6b/res__xmpp_8c.html#ad1982509765f4870f1f63412a53ea668"> 4692</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../dc/d6b/res__xmpp_8c.html#ad1982509765f4870f1f63412a53ea668">reload</a>(<span class="keywordtype">void</span>)</div><div class="line"><a name="l04693"></a><span class="lineno"> 4693</span>&#160;{</div><div class="line"><a name="l04694"></a><span class="lineno"> 4694</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../db/dfe/config__options_8h.html#af28935f8c2547723d5922ebed1c71898">aco_process_config</a>(&amp;cfg_info, 1) == <a class="code" href="../../db/dfe/config__options_8h.html#a3b4f259d48ef20f47171b73078282d75a832b5997265d8870481f9684cbca5792">ACO_PROCESS_ERROR</a>) {</div><div class="line"><a name="l04695"></a><span class="lineno"> 4695</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../d5/d16/module_8h.html#adc09474f0ff557e9925b722ee5b952dfac742921e9f9512d28f62c74ea2affe57">AST_MODULE_LOAD_DECLINE</a>;</div><div class="line"><a name="l04696"></a><span class="lineno"> 4696</span>&#160;   }</div><div class="line"><a name="l04697"></a><span class="lineno"> 4697</span>&#160;</div><div class="line"><a name="l04698"></a><span class="lineno"> 4698</span>&#160;   <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l04699"></a><span class="lineno"> 4699</span>&#160;}</div><div class="line"><a name="l04700"></a><span class="lineno"> 4700</span>&#160;</div><div class="line"><a name="l04701"></a><span class="lineno"> 4701</span>&#160;<a class="code" href="../../d9/de9/res__phoneprov_8c.html#addaa208b0ed785225e24490fb9f28a80">AST_MODULE_INFO</a>(<a class="code" href="../../d5/d16/module_8h.html#aba2c8d4be709a254658b21a834f8294a">ASTERISK_GPL_KEY</a>, <a class="code" href="../../d5/d16/module_8h.html#a155a0df9c59e04e305d4a2fa3e35f843a835b27a90d895a488e4e14cc3d2dee8c">AST_MODFLAG_GLOBAL_SYMBOLS</a> | <a class="code" href="../../d5/d16/module_8h.html#a155a0df9c59e04e305d4a2fa3e35f843a12c3f60dd7655dfa8d4430cbf04b1223">AST_MODFLAG_LOAD_ORDER</a>, <span class="stringliteral">&quot;Asterisk XMPP Interface&quot;</span>,</div><div class="line"><a name="l04702"></a><span class="lineno"> 4702</span>&#160;   .support_level = <a class="code" href="../../d5/d16/module_8h.html#ab35bc4efd9f79706300965c9d36a0ce5a634484c0074e7b6b630756fab09e2c15">AST_MODULE_SUPPORT_CORE</a>,</div><div class="line"><a name="l04703"></a><span class="lineno"> 4703</span>&#160;   .load = <a class="code" href="../../dc/d6b/res__xmpp_8c.html#ac3382bf6da54c56b37069bd76bbdf4f9">load_module</a>,</div><div class="line"><a name="l04704"></a><span class="lineno"> 4704</span>&#160;   .unload = <a class="code" href="../../dc/d6b/res__xmpp_8c.html#ad09fa931f468002152a3cc2d5ce25eae">unload_module</a>,</div><div class="line"><a name="l04705"></a><span class="lineno"> 4705</span>&#160;   .<a class="code" href="../../dc/d6b/res__xmpp_8c.html#ad1982509765f4870f1f63412a53ea668">reload</a> = <a class="code" href="../../dc/d6b/res__xmpp_8c.html#ad1982509765f4870f1f63412a53ea668">reload</a>,</div><div class="line"><a name="l04706"></a><span class="lineno"> 4706</span>&#160;   .load_pri = <a class="code" href="../../d5/d16/module_8h.html#aa4f734041ffd9d75b07cefb0291e1e58a87717b8c3b913bbbb55297fc169086e0">AST_MODPRI_CHANNEL_DEPEND</a>,</div><div class="line"><a name="l04707"></a><span class="lineno"><a class="line" href="../../dc/d6b/res__xmpp_8c.html#a4fb0aca9bbcdb9709fa52a70aded6cae"> 4707</a></span>&#160;);</div><div class="ttc" id="res__xmpp_8c_html_a4c3a2b177d134ce8482f9a5751754931"><div class="ttname"><a href="../../dc/d6b/res__xmpp_8c.html#a4c3a2b177d134ce8482f9a5751754931">xmpp_client_create_buddy</a></div><div class="ttdeci">static struct ast_xmpp_buddy * xmpp_client_create_buddy(struct ao2_container *container, const char *id)</div><div class="ttdoc">Internal function which creates a buddy on a client. </div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d6b/res__xmpp_8c_source.html#l02166">res_xmpp.c:2166</a></div></div>
<div class="ttc" id="res__xmpp_8c_html_a45bbfe12870c0702404b51a94b7175ee"><div class="ttname"><a href="../../dc/d6b/res__xmpp_8c.html#a45bbfe12870c0702404b51a94b7175ee">BUDDY_NOT_IN_ROSTER</a></div><div class="ttdeci">#define BUDDY_NOT_IN_ROSTER</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d6b/res__xmpp_8c_source.html#l01633">res_xmpp.c:1633</a></div></div>
<div class="ttc" id="structast__custom__function_html_afcd1706c9144e6d6eee6127661ae3be2"><div class="ttname"><a href="../../db/dc0/structast__custom__function.html#afcd1706c9144e6d6eee6127661ae3be2">ast_custom_function::name</a></div><div class="ttdeci">const char * name</div><div class="ttdef"><b>Definition:</b> <a href="../../db/de0/pbx_8h_source.html#l00119">pbx.h:119</a></div></div>
<div class="ttc" id="res__xmpp_8c_html_a12d4caeaa50e0b2bf034ca996bd5e2a4"><div class="ttname"><a href="../../dc/d6b/res__xmpp_8c.html#a12d4caeaa50e0b2bf034ca996bd5e2a4">global_bitfield_handler</a></div><div class="ttdeci">static int global_bitfield_handler(const struct aco_option *opt, struct ast_variable *var, void *obj)</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d6b/res__xmpp_8c_source.html#l04506">res_xmpp.c:4506</a></div></div>
<div class="ttc" id="res__xmpp_8c_html_ac5044645216f6146c0bed265a2f8367c"><div class="ttname"><a href="../../dc/d6b/res__xmpp_8c.html#ac5044645216f6146c0bed265a2f8367c">acf_jabberstatus_read</a></div><div class="ttdeci">static int acf_jabberstatus_read(struct ast_channel *chan, const char *name, char *data, char *buf, size_t buflen)</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d6b/res__xmpp_8c_source.html#l01670">res_xmpp.c:1670</a></div></div>
<div class="ttc" id="chan__ooh323_8c_html_a4d63fdfe5451ec2248c16a2739190c56"><div class="ttname"><a href="../../d7/d49/chan__ooh323_8c.html#a4d63fdfe5451ec2248c16a2739190c56">type</a></div><div class="ttdeci">static const char type[]</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d49/chan__ooh323_8c_source.html#l00109">chan_ooh323.c:109</a></div></div>
<div class="ttc" id="chan__sip_8c_html_a14a9662e09deed264497073732fb014a"><div class="ttname"><a href="../../d5/dfe/chan__sip_8c.html#a14a9662e09deed264497073732fb014a">state</a></div><div class="ttdeci">enum sip_cc_notify_state state</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/dfe/chan__sip_8c_source.html#l00959">chan_sip.c:959</a></div></div>
<div class="ttc" id="res__xmpp_8c_html_a5c2497ea229bcf66b0c800d5d0e69680"><div class="ttname"><a href="../../dc/d6b/res__xmpp_8c.html#a5c2497ea229bcf66b0c800d5d0e69680">ast_xmpp_chatroom_leave</a></div><div class="ttdeci">int ast_xmpp_chatroom_leave(struct ast_xmpp_client *client, const char *room, const char *nickname)</div><div class="ttdoc">Leave an XMPP multi-user chatroom. </div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d6b/res__xmpp_8c_source.html#l01014">res_xmpp.c:1014</a></div></div>
<div class="ttc" id="res__xmpp_8c_html_aa622f42343ccc4a9d2e1135019da9905"><div class="ttname"><a href="../../dc/d6b/res__xmpp_8c.html#aa622f42343ccc4a9d2e1135019da9905">BUDDY_OFFLINE</a></div><div class="ttdeci">#define BUDDY_OFFLINE</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d6b/res__xmpp_8c_source.html#l01632">res_xmpp.c:1632</a></div></div>
<div class="ttc" id="pbx_8h_html_aa4e9618aa036a586af7d7663afd9b507"><div class="ttname"><a href="../../db/de0/pbx_8h.html#aa4e9618aa036a586af7d7663afd9b507">ast_func_read</a></div><div class="ttdeci">int ast_func_read(struct ast_channel *chan, const char *function, char *workspace, size_t len)</div><div class="ttdoc">executes a read operation on a function </div><div class="ttdef"><b>Definition:</b> <a href="../../db/d70/pbx__functions_8c_source.html#l00599">pbx_functions.c:599</a></div></div>
<div class="ttc" id="structast__channel_html"><div class="ttname"><a href="../../df/d3c/structast__channel.html">ast_channel</a></div><div class="ttdoc">Main Channel structure associated with a channel. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/de2/channel__internal__api_8c_source.html#l00073">channel_internal_api.c:73</a></div></div>
<div class="ttc" id="res__xmpp_8c_html_a187f3edf503d63cc794aa07e4c2013dc"><div class="ttname"><a href="../../dc/d6b/res__xmpp_8c.html#a187f3edf503d63cc794aa07e4c2013dc">xmpp_client_service_discovery_get_hook</a></div><div class="ttdeci">static int xmpp_client_service_discovery_get_hook(void *data, ikspak *pak)</div><div class="ttdoc">Hook function called when client receives a service discovery get message. </div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d6b/res__xmpp_8c_source.html#l02346">res_xmpp.c:2346</a></div></div>
<div class="ttc" id="structnode_html"><div class="ttname"><a href="../../d5/da1/structnode.html">node</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d2b/test__heap_8c_source.html#l00038">test_heap.c:38</a></div></div>
<div class="ttc" id="structast__xmpp__client_html_ae0c738f7612f5fd8ef0f227f8033324f"><div class="ttname"><a href="../../df/d42/structast__xmpp__client.html#ae0c738f7612f5fd8ef0f227f8033324f">ast_xmpp_client::stack</a></div><div class="ttdeci">ikstack * stack</div><div class="ttdef"><b>Definition:</b> <a href="../../da/da0/xmpp_8h_source.html#l00129">xmpp.h:129</a></div></div>
<div class="ttc" id="res__xmpp_8c_html_a1adde8184c850e2d9150c59b5ffcff24"><div class="ttname"><a href="../../dc/d6b/res__xmpp_8c.html#a1adde8184c850e2d9150c59b5ffcff24">ast_xmpp_chatroom_send</a></div><div class="ttdeci">int ast_xmpp_chatroom_send(struct ast_xmpp_client *client, const char *nickname, const char *address, const char *message)</div><div class="ttdoc">Send a message to an XMPP multi-user chatroom. </div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d6b/res__xmpp_8c_source.html#l01009">res_xmpp.c:1009</a></div></div>
<div class="ttc" id="cli_8h_html_a5c4130cf8f1e93acfdd84416cebf1aef"><div class="ttname"><a href="../../dc/db0/cli_8h.html#a5c4130cf8f1e93acfdd84416cebf1aef">AST_CLI_DEFINE</a></div><div class="ttdeci">#define AST_CLI_DEFINE(fn, txt,...)</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/db0/cli_8h_source.html#l00197">cli.h:197</a></div></div>
<div class="ttc" id="devicestate_8h_html_af72f8a5c0601e4c1f8a852749cd44eee"><div class="ttname"><a href="../../da/da2/devicestate_8h.html#af72f8a5c0601e4c1f8a852749cd44eee">ast_device_state</a></div><div class="ttdeci">ast_device_state</div><div class="ttdoc">Device States. </div><div class="ttdef"><b>Definition:</b> <a href="../../da/da2/devicestate_8h_source.html#l00052">devicestate.h:52</a></div></div>
<div class="ttc" id="config__options_8h_html_ab29e0267f5b05969bcd1d16e97100ebbaaac7fc23ff5841dd793b5d145c420eee"><div class="ttname"><a href="../../db/dfe/config__options_8h.html#ab29e0267f5b05969bcd1d16e97100ebbaaac7fc23ff5841dd793b5d145c420eee">ACO_BLACKLIST_EXACT</a></div><div class="ttdef"><b>Definition:</b> <a href="../../db/dfe/config__options_8h_source.html#l00053">config_options.h:53</a></div></div>
<div class="ttc" id="res__xmpp_8c_html_a82a61968c7b48011f5e9317d4e1a53a9"><div class="ttname"><a href="../../dc/d6b/res__xmpp_8c.html#a82a61968c7b48011f5e9317d4e1a53a9">xmpp_resource_hash</a></div><div class="ttdeci">static int xmpp_resource_hash(const void *obj, const int flags)</div><div class="ttdoc">Hashing function for XMPP resource. </div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d6b/res__xmpp_8c_source.html#l00839">res_xmpp.c:839</a></div></div>
<div class="ttc" id="structast__xmpp__client_html_a84da25e2e78fab08d8077368bdbef1c6"><div class="ttname"><a href="../../df/d42/structast__xmpp__client.html#a84da25e2e78fab08d8077368bdbef1c6">ast_xmpp_client::parser</a></div><div class="ttdeci">iksparser * parser</div><div class="ttdef"><b>Definition:</b> <a href="../../da/da0/xmpp_8h_source.html#l00127">xmpp.h:127</a></div></div>
<div class="ttc" id="message_8h_html_a757a64be14a9fc2b47a37f5ce9e742d5"><div class="ttname"><a href="../../d2/d0d/message_8h.html#a757a64be14a9fc2b47a37f5ce9e742d5">ast_msg_set_tech</a></div><div class="ttdeci">int ast_msg_set_tech(struct ast_msg *msg, const char *fmt,...)</div><div class="ttdoc">Set the technology associated with this message. </div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d6d/message_8c_source.html#l00509">message.c:509</a></div></div>
<div class="ttc" id="config__options_8h_html_a840871f014617f5415dacb9a7d32a59ba423543a2da4422bd5c7664a0b8ca84d8"><div class="ttname"><a href="../../db/dfe/config__options_8h.html#a840871f014617f5415dacb9a7d32a59ba423543a2da4422bd5c7664a0b8ca84d8">ACO_ITEM</a></div><div class="ttdef"><b>Definition:</b> <a href="../../db/dfe/config__options_8h_source.html#l00042">config_options.h:42</a></div></div>
<div class="ttc" id="structmessage_html"><div class="ttname"><a href="../../d8/d9e/structmessage.html">message</a></div><div class="ttdef"><b>Definition:</b> <a href="../../db/d45/manager_8h_source.html#l00144">manager.h:144</a></div></div>
<div class="ttc" id="linkedlists_8h_html_a9140a4e4d781264fa9469c52b1adae40"><div class="ttname"><a href="../../df/d90/linkedlists_8h.html#a9140a4e4d781264fa9469c52b1adae40">AST_LIST_LOCK</a></div><div class="ttdeci">#define AST_LIST_LOCK(head)</div><div class="ttdoc">Locks a list. </div><div class="ttdef"><b>Definition:</b> <a href="../../df/d90/linkedlists_8h_source.html#l00039">linkedlists.h:39</a></div></div>
<div class="ttc" id="xmpp_8h_html_ae37d560c438576bdcb47347088225ee6a9ae50cb46cd7faba7bdde6259d1e7e11"><div class="ttname"><a href="../../da/da0/xmpp_8h.html#ae37d560c438576bdcb47347088225ee6a9ae50cb46cd7faba7bdde6259d1e7e11">XMPP_STATE_REQUEST_TLS</a></div><div class="ttdef"><b>Definition:</b> <a href="../../da/da0/xmpp_8h_source.html#l00075">xmpp.h:75</a></div></div>
<div class="ttc" id="res__xmpp_8c_html_a3dea4bfefdcef9d56e2c486e958db4c8"><div class="ttname"><a href="../../dc/d6b/res__xmpp_8c.html#a3dea4bfefdcef9d56e2c486e958db4c8">xmpp_client_authenticate_sasl</a></div><div class="ttdeci">static int xmpp_client_authenticate_sasl(struct ast_xmpp_client *client, struct ast_xmpp_client_config *cfg, int type, iks *node)</div><div class="ttdoc">Internal function called when we need to authenticate using SASL. </div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d6b/res__xmpp_8c_source.html#l02695">res_xmpp.c:2695</a></div></div>
<div class="ttc" id="group__Group__AMI_html_gac2d42f7be13c532b6a70d50f1b8983d2"><div class="ttname"><a href="../../df/d72/group__Group__AMI.html#gac2d42f7be13c532b6a70d50f1b8983d2">astman_append</a></div><div class="ttdeci">void astman_append(struct mansession *s, const char *fmt,...)</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d10/manager_8c_source.html#l03080">manager.c:3080</a></div></div>
<div class="ttc" id="asterisk_8h_html"><div class="ttname"><a href="../../db/db2/asterisk_8h.html">asterisk.h</a></div><div class="ttdoc">Asterisk main include file. File version handling, generic pbx functions. </div></div>
<div class="ttc" id="res__xmpp_8c_html_aa3759d2ddcc12f3f5ef5a8a3ffa4a4dfae6af6fd94e006a677047e6caa56c9651"><div class="ttname"><a href="../../dc/d6b/res__xmpp_8c.html#aa3759d2ddcc12f3f5ef5a8a3ffa4a4dfae6af6fd94e006a677047e6caa56c9651">XMPP_SEND_TO_DIALPLAN</a></div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d6b/res__xmpp_8c_source.html#l00408">res_xmpp.c:408</a></div></div>
<div class="ttc" id="res__xmpp_8c_html_a64804aabc6379d1e89d71ac9ae686654"><div class="ttname"><a href="../../dc/d6b/res__xmpp_8c.html#a64804aabc6379d1e89d71ac9ae686654">xmpp_pubsub_create_collection</a></div><div class="ttdeci">static void xmpp_pubsub_create_collection(struct ast_xmpp_client *client, const char *collection_name)</div><div class="ttdoc">Create a PubSub collection node. </div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d6b/res__xmpp_8c_source.html#l01242">res_xmpp.c:1242</a></div></div>
<div class="ttc" id="xmpp_8h_html_a88194d0f499931c26ef4df0738f26ec1"><div class="ttname"><a href="../../da/da0/xmpp_8h.html#a88194d0f499931c26ef4df0738f26ec1">NET_IO_BUF_SIZE</a></div><div class="ttdeci">#define NET_IO_BUF_SIZE</div><div class="ttdef"><b>Definition:</b> <a href="../../da/da0/xmpp_8h_source.html#l00038">xmpp.h:38</a></div></div>
<div class="ttc" id="astobj2_8h_html_a512cc40ce96c63b3d5c78040baa4c9cd"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#a512cc40ce96c63b3d5c78040baa4c9cd">ao2_container_count</a></div><div class="ttdeci">int ao2_container_count(struct ao2_container *c)</div><div class="ttdoc">Returns the number of elements in a container. </div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d22/astobj2__container_8c_source.html#l00034">astobj2_container.c:34</a></div></div>
<div class="ttc" id="isdn__lib_8c_html_ab9129b977a587b50ea801daac75e178f"><div class="ttname"><a href="../../de/dfe/isdn__lib_8c.html#ab9129b977a587b50ea801daac75e178f">ARRAY_LEN</a></div><div class="ttdeci">#define ARRAY_LEN(a)</div><div class="ttdef"><b>Definition:</b> <a href="../../de/dfe/isdn__lib_8c_source.html#l00042">isdn_lib.c:42</a></div></div>
<div class="ttc" id="res__xmpp_8c_html_a89bb3d5d1a7726a6bb95af3760e70d51"><div class="ttname"><a href="../../dc/d6b/res__xmpp_8c.html#a89bb3d5d1a7726a6bb95af3760e70d51">client_buddy_handler</a></div><div class="ttdeci">static int client_buddy_handler(const struct aco_option *opt, struct ast_variable *var, void *obj)</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d6b/res__xmpp_8c_source.html#l04594">res_xmpp.c:4594</a></div></div>
<div class="ttc" id="channel_8h_html_a7a8f6a50f3db42cb40cad7cfbd1d54f9"><div class="ttname"><a href="../../d5/d7b/channel_8h.html#a7a8f6a50f3db42cb40cad7cfbd1d54f9">ast_autoservice_start</a></div><div class="ttdeci">int ast_autoservice_start(struct ast_channel *chan)</div><div class="ttdoc">Automatically service a channel for us... </div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d66/autoservice_8c_source.html#l00200">autoservice.c:200</a></div></div>
<div class="ttc" id="module_8h_html_adc09474f0ff557e9925b722ee5b952dfa89bb877ade9ce418ad6663f3d936f314"><div class="ttname"><a href="../../d5/d16/module_8h.html#adc09474f0ff557e9925b722ee5b952dfa89bb877ade9ce418ad6663f3d936f314">AST_MODULE_LOAD_SUCCESS</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d16/module_8h_source.html#l00070">module.h:70</a></div></div>
<div class="ttc" id="res__xmpp_8c_html_a783db61e3ab13bfd85c23fad88f30b9b"><div class="ttname"><a href="../../dc/d6b/res__xmpp_8c.html#a783db61e3ab13bfd85c23fad88f30b9b">xmpp_cli_create_collection</a></div><div class="ttdeci">static char * xmpp_cli_create_collection(struct ast_cli_entry *e, int cmd, struct ast_cli_args *a)</div><div class="ttdoc">Method to expose PubSub collection node creation via CLI. </div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d6b/res__xmpp_8c_source.html#l04222">res_xmpp.c:4222</a></div></div>
<div class="ttc" id="config__options_8h_html_a1b87da445ce6937e5cfbdaed1288a572abba7035409cf0b61400c00ef5bb59b52"><div class="ttname"><a href="../../db/dfe/config__options_8h.html#a1b87da445ce6937e5cfbdaed1288a572abba7035409cf0b61400c00ef5bb59b52">ACO_EXACT</a></div><div class="ttdef"><b>Definition:</b> <a href="../../db/dfe/config__options_8h_source.html#l00064">config_options.h:64</a></div></div>
<div class="ttc" id="res__xmpp_8c_html_a6dd3009fd3143bcb30b3fd55eafe04da"><div class="ttname"><a href="../../dc/d6b/res__xmpp_8c.html#a6dd3009fd3143bcb30b3fd55eafe04da">sleep_with_backoff</a></div><div class="ttdeci">static void sleep_with_backoff(unsigned int *sleep_time)</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d6b/res__xmpp_8c_source.html#l03719">res_xmpp.c:3719</a></div></div>
<div class="ttc" id="xmpp_8h_html_ae37d560c438576bdcb47347088225ee6aa3c76e3189d07fe1b59825869e4703e3"><div class="ttname"><a href="../../da/da0/xmpp_8h.html#ae37d560c438576bdcb47347088225ee6aa3c76e3189d07fe1b59825869e4703e3">XMPP_STATE_REQUESTED_TLS</a></div><div class="ttdef"><b>Definition:</b> <a href="../../da/da0/xmpp_8h_source.html#l00076">xmpp.h:76</a></div></div>
<div class="ttc" id="test__config_8c_html_ab8aa28659d870c360b8afb1662c1b302"><div class="ttname"><a href="../../d8/d4f/test__config_8c.html#ab8aa28659d870c360b8afb1662c1b302">global</a></div><div class="ttdeci">static struct aco_type global</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d4f/test__config_8c_source.html#l01445">test_config.c:1445</a></div></div>
<div class="ttc" id="res__xmpp_8c_html_a290fc293cd6e9547fc434b6bb23b0ede"><div class="ttname"><a href="../../dc/d6b/res__xmpp_8c.html#a290fc293cd6e9547fc434b6bb23b0ede">ast_xmpp_client_config_alloc</a></div><div class="ttdeci">static void * ast_xmpp_client_config_alloc(const char *cat)</div><div class="ttdoc">Allocator function for configuration. </div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d6b/res__xmpp_8c_source.html#l00671">res_xmpp.c:671</a></div></div>
<div class="ttc" id="module_8h_html_ab35bc4efd9f79706300965c9d36a0ce5a634484c0074e7b6b630756fab09e2c15"><div class="ttname"><a href="../../d5/d16/module_8h.html#ab35bc4efd9f79706300965c9d36a0ce5a634484c0074e7b6b630756fab09e2c15">AST_MODULE_SUPPORT_CORE</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d16/module_8h_source.html#l00121">module.h:121</a></div></div>
<div class="ttc" id="structast__xmpp__client__config_html"><div class="ttname"><a href="../../da/d00/structast__xmpp__client__config.html">ast_xmpp_client_config</a></div><div class="ttdoc">XMPP Client Configuration. </div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d6b/res__xmpp_8c_source.html#l00444">res_xmpp.c:444</a></div></div>
<div class="ttc" id="res__xmpp_8c_html_ac5b95f02723021833cc47477b06a962ca045d4dbda72ca97ef5ef8c383279d7dc"><div class="ttname"><a href="../../dc/d6b/res__xmpp_8c.html#ac5b95f02723021833cc47477b06a962ca045d4dbda72ca97ef5ef8c383279d7dc">XMPP_XEP0248</a></div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d6b/res__xmpp_8c_source.html#l00414">res_xmpp.c:414</a></div></div>
<div class="ttc" id="res__xmpp_8c_html_a0010de435ba84b865dc08a3a0e78fcca"><div class="ttname"><a href="../../dc/d6b/res__xmpp_8c.html#a0010de435ba84b865dc08a3a0e78fcca">CONFIG_INFO_STANDARD</a></div><div class="ttdeci">CONFIG_INFO_STANDARD(cfg_info, globals, xmpp_config_alloc,.files=ACO_FILES(&amp;res_xmpp_conf),.post_apply_config=xmpp_config_post_apply,)</div></div>
<div class="ttc" id="structxmpp__pak__handler_html_ac765329451135abec74c45e1897abf26"><div class="ttname"><a href="../../d9/da1/structxmpp__pak__handler.html#ac765329451135abec74c45e1897abf26">xmpp_pak_handler::type</a></div><div class="ttdeci">int type</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d6b/res__xmpp_8c_source.html#l00502">res_xmpp.c:502</a></div></div>
<div class="ttc" id="res__xmpp_8c_html_a48ebc7a99890a29f1901304e574d4f03"><div class="ttname"><a href="../../dc/d6b/res__xmpp_8c.html#a48ebc7a99890a29f1901304e574d4f03">manager_jabber_send</a></div><div class="ttdeci">static int manager_jabber_send(struct mansession *s, const struct message *m)</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d6b/res__xmpp_8c_source.html#l03927">res_xmpp.c:3927</a></div></div>
<div class="ttc" id="message_8h_html_a9e2045ad672c0afd5fb2616fec6bc666"><div class="ttname"><a href="../../d2/d0d/message_8h.html#a9e2045ad672c0afd5fb2616fec6bc666">ast_msg_set_context</a></div><div class="ttdeci">int ast_msg_set_context(struct ast_msg *msg, const char *fmt,...)</div><div class="ttdoc">Set the dialplan context for this message. </div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d6d/message_8c_source.html#l00487">message.c:487</a></div></div>
<div class="ttc" id="config__options_8h_html_a83b8d55eb1ba88ac7291f77a3ebfce45"><div class="ttname"><a href="../../db/dfe/config__options_8h.html#a83b8d55eb1ba88ac7291f77a3ebfce45">aco_option_register_custom</a></div><div class="ttdeci">#define aco_option_register_custom(info, name, matchtype, types, default_val, handler, flags)</div><div class="ttdoc">Register a config option. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/dfe/config__options_8h_source.html#l00638">config_options.h:638</a></div></div>
<div class="ttc" id="res__xmpp_8c_html_aa3759d2ddcc12f3f5ef5a8a3ffa4a4dfa29cbc9cdcca6e5b12165e01cab18438a"><div class="ttname"><a href="../../dc/d6b/res__xmpp_8c.html#aa3759d2ddcc12f3f5ef5a8a3ffa4a4dfa29cbc9cdcca6e5b12165e01cab18438a">XMPP_DISTRIBUTE_EVENTS</a></div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d6b/res__xmpp_8c_source.html#l00409">res_xmpp.c:409</a></div></div>
<div class="ttc" id="cli_8h_html_a56b6b59ee2eaa994597a5b0f4e9f9d09"><div class="ttname"><a href="../../dc/db0/cli_8h.html#a56b6b59ee2eaa994597a5b0f4e9f9d09">ast_cli_unregister_multiple</a></div><div class="ttdeci">int ast_cli_unregister_multiple(struct ast_cli_entry *e, int len)</div><div class="ttdoc">Unregister multiple commands. </div><div class="ttdef"><b>Definition:</b> <a href="../../da/d4d/clicompat_8c_source.html#l00030">clicompat.c:30</a></div></div>
<div class="ttc" id="utils_8h_html_a8ebf6841073ea2a063a0c86a5092a85b"><div class="ttname"><a href="../../d5/d60/utils_8h.html#a8ebf6841073ea2a063a0c86a5092a85b">ast_eid_to_str</a></div><div class="ttdeci">char * ast_eid_to_str(char *s, int maxlen, struct ast_eid *eid)</div><div class="ttdoc">Convert an EID to a string. </div><div class="ttdef"><b>Definition:</b> <a href="../../de/d1f/main_2utils_8c_source.html#l02587">main/utils.c:2587</a></div></div>
<div class="ttc" id="res__xmpp_8c_html_ade776dcd1dbcfe2f28831298e7db444e"><div class="ttname"><a href="../../dc/d6b/res__xmpp_8c.html#ade776dcd1dbcfe2f28831298e7db444e">xmpp_client_receive</a></div><div class="ttdeci">static int xmpp_client_receive(struct ast_xmpp_client *client, unsigned int timeout)</div><div class="ttdoc">Internal function which receives data from the XMPP client connection. </div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d6b/res__xmpp_8c_source.html#l03651">res_xmpp.c:3651</a></div></div>
<div class="ttc" id="res__xmpp_8c_html_a2bfb5c36cf34a171138fa7d15fed6001"><div class="ttname"><a href="../../dc/d6b/res__xmpp_8c.html#a2bfb5c36cf34a171138fa7d15fed6001">xmpp_client_unsubscribe_user</a></div><div class="ttdeci">static int xmpp_client_unsubscribe_user(struct ast_xmpp_client *client, const char *user)</div><div class="ttdoc">Helper function which unsubscribes a user and removes them from the roster. </div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d6b/res__xmpp_8c_source.html#l02192">res_xmpp.c:2192</a></div></div>
<div class="ttc" id="message_8h_html_aa21f081993590c1410b287d717a92282"><div class="ttname"><a href="../../d2/d0d/message_8h.html#aa21f081993590c1410b287d717a92282">ast_msg_set_body</a></div><div class="ttdeci">int ast_msg_set_body(struct ast_msg *msg, const char *fmt,...)</div><div class="ttdoc">Set the &amp;#39;body&amp;#39; text of a message (in UTF-8) </div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d6d/message_8c_source.html#l00476">message.c:476</a></div></div>
<div class="ttc" id="endpoints_8h_html_a6d7a27b4849c075f31991c8ca796ccf2"><div class="ttname"><a href="../../d4/d61/endpoints_8h.html#a6d7a27b4849c075f31991c8ca796ccf2">ast_endpoint_create</a></div><div class="ttdeci">struct ast_endpoint * ast_endpoint_create(const char *tech, const char *resource)</div><div class="ttdoc">Create an endpoint struct. </div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d4b/main_2endpoints_8c_source.html#l00319">main/endpoints.c:319</a></div></div>
<div class="ttc" id="utils_8h_html_a67b6713ff86cf82aaed821e9a87d1c21"><div class="ttname"><a href="../../d5/d60/utils_8h.html#a67b6713ff86cf82aaed821e9a87d1c21">ast_set2_flag</a></div><div class="ttdeci">#define ast_set2_flag(p, value, flag)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d60/utils_8h_source.html#l00094">utils.h:94</a></div></div>
<div class="ttc" id="utils_8h_html_a00d4c9254c9827d6fa44f17a326744a5"><div class="ttname"><a href="../../d5/d60/utils_8h.html#a00d4c9254c9827d6fa44f17a326744a5">ast_test_flag</a></div><div class="ttdeci">#define ast_test_flag(p, flag)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d60/utils_8h_source.html#l00063">utils.h:63</a></div></div>
<div class="ttc" id="res__xmpp_8c_html_ac8e69048e81bd7cf71a4f623262fe67b"><div class="ttname"><a href="../../dc/d6b/res__xmpp_8c.html#ac8e69048e81bd7cf71a4f623262fe67b">xmpp_cli_delete_pubsub_node</a></div><div class="ttdeci">static char * xmpp_cli_delete_pubsub_node(struct ast_cli_entry *e, int cmd, struct ast_cli_args *a)</div><div class="ttdoc">Method to expose PubSub node deletion via CLI. </div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d6b/res__xmpp_8c_source.html#l04184">res_xmpp.c:4184</a></div></div>
<div class="ttc" id="res__xmpp_8c_html_aa3759d2ddcc12f3f5ef5a8a3ffa4a4dfa2ee5bcbb4cbb964175aaddb7bf70c0cb"><div class="ttname"><a href="../../dc/d6b/res__xmpp_8c.html#aa3759d2ddcc12f3f5ef5a8a3ffa4a4dfa2ee5bcbb4cbb964175aaddb7bf70c0cb">XMPP_USETLS</a></div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d6b/res__xmpp_8c_source.html#l00403">res_xmpp.c:403</a></div></div>
<div class="ttc" id="res__xmpp_8c_html_acfb92986809bdc3d6dac95527cd8f9bb"><div class="ttname"><a href="../../dc/d6b/res__xmpp_8c.html#acfb92986809bdc3d6dac95527cd8f9bb">xmpp_pubsub_build_node_config</a></div><div class="ttdeci">static iks * xmpp_pubsub_build_node_config(iks *pubsub, const char *node_type, const char *collection_name)</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d6b/res__xmpp_8c_source.html#l01108">res_xmpp.c:1108</a></div></div>
<div class="ttc" id="json_8h_html_a33bcd9181e613a659eefe411ec42c87c"><div class="ttname"><a href="../../d4/d05/json_8h.html#a33bcd9181e613a659eefe411ec42c87c">ast_json_unref</a></div><div class="ttdeci">void ast_json_unref(struct ast_json *value)</div><div class="ttdoc">Decrease refcount on value. If refcount reaches zero, value is freed. </div><div class="ttdef"><b>Definition:</b> <a href="../../df/d98/json_8c_source.html#l00073">json.c:73</a></div></div>
<div class="ttc" id="res__xmpp_8c_html_a824abffc29ae94875ca0f3c3526ebbbe"><div class="ttname"><a href="../../dc/d6b/res__xmpp_8c.html#a824abffc29ae94875ca0f3c3526ebbbe">xmpp_config_prelink</a></div><div class="ttdeci">static int xmpp_config_prelink(void *newitem)</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d6b/res__xmpp_8c_source.html#l00742">res_xmpp.c:742</a></div></div>
<div class="ttc" id="astobj2_8h_html_a22f40c733a085f259af94e864ebaa09a"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#a22f40c733a085f259af94e864ebaa09a">OBJ_KEY</a></div><div class="ttdeci">#define OBJ_KEY</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l01155">astobj2.h:1155</a></div></div>
<div class="ttc" id="f2c_8h_html_a27c1bdb0cba23a9db2a51eed7b3b2ac1"><div class="ttname"><a href="../../dc/dc2/f2c_8h.html#a27c1bdb0cba23a9db2a51eed7b3b2ac1">address</a></div><div class="ttdeci">char * address</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/dc2/f2c_8h_source.html#l00059">f2c.h:59</a></div></div>
<div class="ttc" id="eagi__proxy_8c_html_ac95651d79c608a3148973b5b1fc9e525"><div class="ttname"><a href="../../dd/d7c/eagi__proxy_8c.html#ac95651d79c608a3148973b5b1fc9e525">buf</a></div><div class="ttdeci">char buf[BUFSIZE]</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d7c/eagi__proxy_8c_source.html#l00066">eagi_proxy.c:66</a></div></div>
<div class="ttc" id="astobj2_8h_html_ad9d009e87e737af900825b36db55a35ca5fc59b193d86a0a8ddfe866304be829d"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#ad9d009e87e737af900825b36db55a35ca5fc59b193d86a0a8ddfe866304be829d">OBJ_NODATA</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l01048">astobj2.h:1048</a></div></div>
<div class="ttc" id="res__xmpp_8c_html_aa3da78973dc8e135e540b1303de9bd25"><div class="ttname"><a href="../../dc/d6b/res__xmpp_8c.html#aa3da78973dc8e135e540b1303de9bd25">xmpp_client_service_discovery_result_hook</a></div><div class="ttdeci">static int xmpp_client_service_discovery_result_hook(void *data, ikspak *pak)</div><div class="ttdoc">Hook function called when client receives a service discovery result message. </div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d6b/res__xmpp_8c_source.html#l02406">res_xmpp.c:2406</a></div></div>
<div class="ttc" id="res__xmpp_8c_html_a64092ba9f84b91fb023868280e7d1c81"><div class="ttname"><a href="../../dc/d6b/res__xmpp_8c.html#a64092ba9f84b91fb023868280e7d1c81">xmpp_pubsub_delete_node_list</a></div><div class="ttdeci">static int xmpp_pubsub_delete_node_list(void *data, ikspak *pak)</div><div class="ttdoc">Delete pubsub item lists. </div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d6b/res__xmpp_8c_source.html#l04100">res_xmpp.c:4100</a></div></div>
<div class="ttc" id="res__xmpp_8c_html_aec97d98f13445cd1a95c1deed32489be"><div class="ttname"><a href="../../dc/d6b/res__xmpp_8c.html#aec97d98f13445cd1a95c1deed32489be">xmpp_leave_exec</a></div><div class="ttdeci">static int xmpp_leave_exec(struct ast_channel *chan, const char *data)</div><div class="ttdoc">Application to leave a chat room. </div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d6b/res__xmpp_8c_source.html#l01781">res_xmpp.c:1781</a></div></div>
<div class="ttc" id="include_2asterisk_2app_8h_html_ac08f7eb1eb9476b30987c73e1052ada8"><div class="ttname"><a href="../../d3/d93/include_2asterisk_2app_8h.html#ac08f7eb1eb9476b30987c73e1052ada8">AST_STANDARD_APP_ARGS</a></div><div class="ttdeci">#define AST_STANDARD_APP_ARGS(args, parse)</div><div class="ttdoc">Performs the &amp;#39;standard&amp;#39; argument separation process for an application. </div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d93/include_2asterisk_2app_8h_source.html#l01285">include/asterisk/app.h:1285</a></div></div>
<div class="ttc" id="res__xmpp_8c_html_aa55d9b5fc5485de22c2ac343c921477c"><div class="ttname"><a href="../../dc/d6b/res__xmpp_8c.html#aa55d9b5fc5485de22c2ac343c921477c">xmpp_component_service_discovery_items_hook</a></div><div class="ttdeci">static int xmpp_component_service_discovery_items_hook(void *data, ikspak *pak)</div><div class="ttdoc">Hook function called when we receive a service discovery items request. </div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d6b/res__xmpp_8c_source.html#l03042">res_xmpp.c:3042</a></div></div>
<div class="ttc" id="structast__cli__entry_html"><div class="ttname"><a href="../../d8/d07/structast__cli__entry.html">ast_cli_entry</a></div><div class="ttdoc">descriptor for a cli entry. </div><div class="ttdef"><b>Definition:</b> <a href="../../dc/db0/cli_8h_source.html#l00171">cli.h:171</a></div></div>
<div class="ttc" id="res__xmpp_8c_html_a5ea6322164aec70dc95255761f184036"><div class="ttname"><a href="../../dc/d6b/res__xmpp_8c.html#a5ea6322164aec70dc95255761f184036">ast_xmpp_chatroom_invite</a></div><div class="ttdeci">int ast_xmpp_chatroom_invite(struct ast_xmpp_client *client, const char *user, const char *room, const char *message)</div><div class="ttdoc">Invite a user to an XMPP multi-user chatroom. </div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d6b/res__xmpp_8c_source.html#l00937">res_xmpp.c:937</a></div></div>
<div class="ttc" id="structast__cli__args_html_a98e1d8441ca58834f11f7367be4b3345"><div class="ttname"><a href="../../d3/dad/structast__cli__args.html#a98e1d8441ca58834f11f7367be4b3345">ast_cli_args::argc</a></div><div class="ttdeci">const int argc</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/db0/cli_8h_source.html#l00160">cli.h:160</a></div></div>
<div class="ttc" id="logger_8h_html_adf4476a6a4ea6c74231c826e899d7189"><div class="ttname"><a href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a></div><div class="ttdeci">#define LOG_WARNING</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d8c/logger_8h_source.html#l00274">logger.h:274</a></div></div>
<div class="ttc" id="structast__xmpp__resource_html_a6e27f49150e9a14580fb313cc2777e00"><div class="ttname"><a href="../../d6/d90/structast__xmpp__resource.html#a6e27f49150e9a14580fb313cc2777e00">ast_xmpp_resource::status</a></div><div class="ttdeci">int status</div><div class="ttdef"><b>Definition:</b> <a href="../../da/da0/xmpp_8h_source.html#l00094">xmpp.h:94</a></div></div>
<div class="ttc" id="res__xmpp_8c_html_a14d10033fb3b97f06238940259f45266"><div class="ttname"><a href="../../dc/d6b/res__xmpp_8c.html#a14d10033fb3b97f06238940259f45266">xmpp_config_find</a></div><div class="ttdeci">static void * xmpp_config_find(struct ao2_container *tmp_container, const char *category)</div><div class="ttdoc">Find function for configuration. </div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d6b/res__xmpp_8c_source.html#l00651">res_xmpp.c:651</a></div></div>
<div class="ttc" id="linkedlists_8h_html_ab48cb9e1e612dd486b747ba1c5d68d01"><div class="ttname"><a href="../../df/d90/linkedlists_8h.html#ab48cb9e1e612dd486b747ba1c5d68d01">AST_LIST_UNLOCK</a></div><div class="ttdeci">#define AST_LIST_UNLOCK(head)</div><div class="ttdoc">Attempts to unlock a list. </div><div class="ttdef"><b>Definition:</b> <a href="../../df/d90/linkedlists_8h_source.html#l00139">linkedlists.h:139</a></div></div>
<div class="ttc" id="res__xmpp_8c_html_a8816b23744b8848485aaefb051b97f69"><div class="ttname"><a href="../../dc/d6b/res__xmpp_8c.html#a8816b23744b8848485aaefb051b97f69">xmpp_pubsub_mwi_cb</a></div><div class="ttdeci">static void xmpp_pubsub_mwi_cb(void *data, struct stasis_subscription *sub, struct stasis_message *msg)</div><div class="ttdoc">Callback function for MWI events. </div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d6b/res__xmpp_8c_source.html#l01336">res_xmpp.c:1336</a></div></div>
<div class="ttc" id="time_8h_html_a39af1febe8b93cb6f7cd59b76fc39e8f"><div class="ttname"><a href="../../de/df7/time_8h.html#a39af1febe8b93cb6f7cd59b76fc39e8f">ast_tvdiff_sec</a></div><div class="ttdeci">int64_t ast_tvdiff_sec(struct timeval end, struct timeval start)</div><div class="ttdoc">Computes the difference (in seconds) between two struct timeval instances. </div><div class="ttdef"><b>Definition:</b> <a href="../../de/df7/time_8h_source.html#l00064">time.h:64</a></div></div>
<div class="ttc" id="res__xmpp_8c_html_ac3e1795766a80ec63b157951b4b9a7d4"><div class="ttname"><a href="../../dc/d6b/res__xmpp_8c.html#ac3e1795766a80ec63b157951b4b9a7d4">debug</a></div><div class="ttdeci">static int debug</div><div class="ttdoc">Global debug status. </div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d6b/res__xmpp_8c_source.html#l00435">res_xmpp.c:435</a></div></div>
<div class="ttc" id="res__xmpp_8c_html_a21e2c653d707e26b4e8cbbcfa76e7037"><div class="ttname"><a href="../../dc/d6b/res__xmpp_8c.html#a21e2c653d707e26b4e8cbbcfa76e7037">xmpp_config_post_apply</a></div><div class="ttdeci">static void xmpp_config_post_apply(void)</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d6b/res__xmpp_8c_source.html#l00787">res_xmpp.c:787</a></div></div>
<div class="ttc" id="res__xmpp_8c_html_ad0a04b9fe7c226297a873eee644c9917"><div class="ttname"><a href="../../dc/d6b/res__xmpp_8c.html#ad0a04b9fe7c226297a873eee644c9917">xmpp_send_cb</a></div><div class="ttdeci">static int xmpp_send_cb(const struct ast_msg *msg, const char *to, const char *from)</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d6b/res__xmpp_8c_source.html#l02129">res_xmpp.c:2129</a></div></div>
<div class="ttc" id="astobj2_8h_html_a47857055118a703ae87ea5ebaf4842ed"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#a47857055118a703ae87ea5ebaf4842ed">ao2_callback</a></div><div class="ttdeci">#define ao2_callback(c, flags, cb_fn, arg)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l01716">astobj2.h:1716</a></div></div>
<div class="ttc" id="res__xmpp_8c_html_a6b8f4ce31d30e5a3e2c3894e6224f952"><div class="ttname"><a href="../../dc/d6b/res__xmpp_8c.html#a6b8f4ce31d30e5a3e2c3894e6224f952">AO2_GLOBAL_OBJ_STATIC</a></div><div class="ttdeci">static AO2_GLOBAL_OBJ_STATIC(globals)</div></div>
<div class="ttc" id="message_8h_html_a0e4685c7cf1d71204087b992110e6357"><div class="ttname"><a href="../../d2/d0d/message_8h.html#a0e4685c7cf1d71204087b992110e6357">ast_msg_alloc</a></div><div class="ttdeci">struct ast_msg * ast_msg_alloc(void)</div><div class="ttdoc">Allocate a message. </div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d6d/message_8c_source.html#l00418">message.c:418</a></div></div>
<div class="ttc" id="config__options_8h_html_a60d17d3e9451ddcb5aa861339c757bed"><div class="ttname"><a href="../../db/dfe/config__options_8h.html#a60d17d3e9451ddcb5aa861339c757bed">aco_option_register</a></div><div class="ttdeci">#define aco_option_register(info, name, matchtype, types, default_val, opt_type, flags,...)</div><div class="ttdoc">Register a config option. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/dfe/config__options_8h_source.html#l00623">config_options.h:623</a></div></div>
<div class="ttc" id="res__xmpp_8c_html_a23646819bacdf301428458ef3815cdd2"><div class="ttname"><a href="../../dc/d6b/res__xmpp_8c.html#a23646819bacdf301428458ef3815cdd2">RESOURCE_BUCKETS</a></div><div class="ttdeci">#define RESOURCE_BUCKETS</div><div class="ttdoc">Number of buckets for resources (per buddy) </div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d6b/res__xmpp_8c_source.html#l00426">res_xmpp.c:426</a></div></div>
<div class="ttc" id="structast__device__state__message_html_a1acd064aff48cf4d5eafec1030f8429d"><div class="ttname"><a href="../../db/d92/structast__device__state__message.html#a1acd064aff48cf4d5eafec1030f8429d">ast_device_state_message::state</a></div><div class="ttdeci">enum ast_device_state state</div><div class="ttdef"><b>Definition:</b> <a href="../../da/da2/devicestate_8h_source.html#l00250">devicestate.h:250</a></div></div>
<div class="ttc" id="res__xmpp_8c_html_ae3571a1477967e051aed72a91c32bc86"><div class="ttname"><a href="../../dc/d6b/res__xmpp_8c.html#ae3571a1477967e051aed72a91c32bc86">xmpp_client_authenticating</a></div><div class="ttdeci">static int xmpp_client_authenticating(struct ast_xmpp_client *client, struct ast_xmpp_client_config *cfg, int type, iks *node)</div><div class="ttdoc">Internal function called when we are authenticating. </div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d6b/res__xmpp_8c_source.html#l02766">res_xmpp.c:2766</a></div></div>
<div class="ttc" id="stasis_8h_html_acd5bedbb2212956dac77be47dceef510"><div class="ttname"><a href="../../dd/d79/stasis_8h.html#acd5bedbb2212956dac77be47dceef510">stasis_subscription_is_subscribed</a></div><div class="ttdeci">int stasis_subscription_is_subscribed(const struct stasis_subscription *sub)</div><div class="ttdoc">Returns whether a subscription is currently subscribed. </div><div class="ttdef"><b>Definition:</b> <a href="../../d0/df4/stasis_8c_source.html#l01152">stasis.c:1152</a></div></div>
<div class="ttc" id="cdr__mysql_8c_html_a493b57f443cc38b3d3df9c1e584d9d82"><div class="ttname"><a href="../../d0/d29/cdr__mysql_8c.html#a493b57f443cc38b3d3df9c1e584d9d82">timeout</a></div><div class="ttdeci">static int timeout</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d29/cdr__mysql_8c_source.html#l00086">cdr_mysql.c:86</a></div></div>
<div class="ttc" id="res__xmpp_8c_html_a5eb8d77affaba7e2fe254f7e7fbca789"><div class="ttname"><a href="../../dc/d6b/res__xmpp_8c.html#a5eb8d77affaba7e2fe254f7e7fbca789">ast_xmpp_increment_mid</a></div><div class="ttdeci">void ast_xmpp_increment_mid(char *mid)</div><div class="ttdoc">Helper function which increments the message identifier. </div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d6b/res__xmpp_8c_source.html#l01019">res_xmpp.c:1019</a></div></div>
<div class="ttc" id="res__xmpp_8c_html_a26fe05af8a6e35300033d69700b9d94f"><div class="ttname"><a href="../../dc/d6b/res__xmpp_8c.html#a26fe05af8a6e35300033d69700b9d94f">xmpp_client_thread</a></div><div class="ttdeci">static void * xmpp_client_thread(void *data)</div><div class="ttdoc">XMPP client connection thread. </div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d6b/res__xmpp_8c_source.html#l03731">res_xmpp.c:3731</a></div></div>
<div class="ttc" id="res__xmpp_8c_html_acc06b389a6a5247288ad580fde1e56bd"><div class="ttname"><a href="../../dc/d6b/res__xmpp_8c.html#acc06b389a6a5247288ad580fde1e56bd">xmpp_cli_purge_pubsub_nodes</a></div><div class="ttdeci">static char * xmpp_cli_purge_pubsub_nodes(struct ast_cli_entry *e, int cmd, struct ast_cli_args *a)</div><div class="ttdoc">Method to purge PubSub nodes via CLI. </div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d6b/res__xmpp_8c_source.html#l04139">res_xmpp.c:4139</a></div></div>
<div class="ttc" id="astobj2_8h_html_add41bd9979cb8642f81dd38aa2dfcd6d"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#add41bd9979cb8642f81dd38aa2dfcd6d">ao2_container_alloc_list</a></div><div class="ttdeci">#define ao2_container_alloc_list(ao2_options, container_options, sort_fn, cmp_fn)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l01335">astobj2.h:1335</a></div></div>
<div class="ttc" id="res__xmpp_8c_html_adc271ee017945747c052865b5b6d94a8"><div class="ttname"><a href="../../dc/d6b/res__xmpp_8c.html#adc271ee017945747c052865b5b6d94a8">ast_xmpp_chatroom_join</a></div><div class="ttdeci">int ast_xmpp_chatroom_join(struct ast_xmpp_client *client, const char *room, const char *nickname)</div><div class="ttdoc">Join an XMPP multi-user chatroom. </div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d6b/res__xmpp_8c_source.html#l01004">res_xmpp.c:1004</a></div></div>
<div class="ttc" id="structast__flags_html_ac92588540e8c1d014a08cd8a45462b19"><div class="ttname"><a href="../../dc/dac/structast__flags.html#ac92588540e8c1d014a08cd8a45462b19">ast_flags::flags</a></div><div class="ttdeci">unsigned int flags</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d60/utils_8h_source.html#l00200">utils.h:200</a></div></div>
<div class="ttc" id="xmpp_8h_html_ae37d560c438576bdcb47347088225ee6aeddf64cd40acf9ce3a91bacc33c3368c"><div class="ttname"><a href="../../da/da0/xmpp_8h.html#ae37d560c438576bdcb47347088225ee6aeddf64cd40acf9ce3a91bacc33c3368c">XMPP_STATE_AUTHENTICATING</a></div><div class="ttdef"><b>Definition:</b> <a href="../../da/da0/xmpp_8h_source.html#l00078">xmpp.h:78</a></div></div>
<div class="ttc" id="structast__variable_html"><div class="ttname"><a href="../../dd/d02/structast__variable.html">ast_variable</a></div><div class="ttdoc">Structure for variables, used for configurations and for channel variables. </div><div class="ttdef"><b>Definition:</b> <a href="../../d3/de6/include_2asterisk_2config_8h_source.html#l00083">include/asterisk/config.h:83</a></div></div>
<div class="ttc" id="structast__xmpp__client__config_html_a54125aa1f0e661889f7a44db13a2b4b8"><div class="ttname"><a href="../../da/d00/structast__xmpp__client__config.html#a54125aa1f0e661889f7a44db13a2b4b8">ast_xmpp_client_config::password</a></div><div class="ttdeci">const ast_string_field password</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d6b/res__xmpp_8c_source.html#l00456">res_xmpp.c:456</a></div></div>
<div class="ttc" id="structast__xmpp__message_html_a819f07fb76703e722d125863b8763d14"><div class="ttname"><a href="../../d6/d73/structast__xmpp__message.html#a819f07fb76703e722d125863b8763d14">ast_xmpp_message::list</a></div><div class="ttdeci">struct ast_xmpp_message::@329 list</div></div>
<div class="ttc" id="res__xmpp_8c_html_ac466d42a9eeb5b2faeddf009e8640b33"><div class="ttname"><a href="../../dc/d6b/res__xmpp_8c.html#ac466d42a9eeb5b2faeddf009e8640b33">xmpp_pubsub_request_nodes</a></div><div class="ttdeci">static void xmpp_pubsub_request_nodes(struct ast_xmpp_client *client, const char *collection)</div><div class="ttdoc">Request item list from pubsub. </div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d6b/res__xmpp_8c_source.html#l04029">res_xmpp.c:4029</a></div></div>
<div class="ttc" id="ast__expr2f_8c_html_a1b0936415a643c88ce543099c10e0d7f"><div class="ttname"><a href="../../dc/df2/ast__expr2f_8c.html#a1b0936415a643c88ce543099c10e0d7f">var</a></div><div class="ttdeci">#define var</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/df2/ast__expr2f_8c_source.html#l00614">ast_expr2f.c:614</a></div></div>
<div class="ttc" id="structstasis__subscription_html"><div class="ttname"><a href="../../d9/de4/structstasis__subscription.html">stasis_subscription</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d0/df4/stasis_8c_source.html#l00681">stasis.c:681</a></div></div>
<div class="ttc" id="structast__xmpp__buddy_html_aaf2ca63234b10470cfbba573d4c0ed01"><div class="ttname"><a href="../../d5/d25/structast__xmpp__buddy.html#aaf2ca63234b10470cfbba573d4c0ed01">ast_xmpp_buddy::id</a></div><div class="ttdeci">char id[XMPP_MAX_JIDLEN]</div><div class="ttdef"><b>Definition:</b> <a href="../../da/da0/xmpp_8h_source.html#l00113">xmpp.h:113</a></div></div>
<div class="ttc" id="devicestate_8h_html_af72f8a5c0601e4c1f8a852749cd44eeeafac147cbabf3ccb80e50e86027710549"><div class="ttname"><a href="../../da/da2/devicestate_8h.html#af72f8a5c0601e4c1f8a852749cd44eeeafac147cbabf3ccb80e50e86027710549">AST_DEVICE_UNAVAILABLE</a></div><div class="ttdef"><b>Definition:</b> <a href="../../da/da2/devicestate_8h_source.html#l00058">devicestate.h:58</a></div></div>
<div class="ttc" id="res__xmpp_8c_html_adef938b4fb0bcfdcec3572e373fb1333"><div class="ttname"><a href="../../dc/d6b/res__xmpp_8c.html#adef938b4fb0bcfdcec3572e373fb1333">xmpp_client_alloc</a></div><div class="ttdeci">static struct ast_xmpp_client * xmpp_client_alloc(const char *name)</div><div class="ttdoc">Allocator function for ast_xmpp_client. </div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d6b/res__xmpp_8c_source.html#l00604">res_xmpp.c:604</a></div></div>
<div class="ttc" id="res__xmpp_8c_html_aa3759d2ddcc12f3f5ef5a8a3ffa4a4dfa18ce12342ffe1b2f00bb53be6a87665d"><div class="ttname"><a href="../../dc/d6b/res__xmpp_8c.html#aa3759d2ddcc12f3f5ef5a8a3ffa4a4dfa18ce12342ffe1b2f00bb53be6a87665d">XMPP_AUTOREGISTER</a></div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d6b/res__xmpp_8c_source.html#l00400">res_xmpp.c:400</a></div></div>
<div class="ttc" id="structast__msg__tech_html_acc128f98d9ceca227038c771308eff39"><div class="ttname"><a href="../../df/dfc/structast__msg__tech.html#acc128f98d9ceca227038c771308eff39">ast_msg_tech::name</a></div><div class="ttdeci">const char *const name</div><div class="ttdoc">Name of this message technology. </div><div class="ttdef"><b>Definition:</b> <a href="../../d2/d0d/message_8h_source.html#l00061">message.h:61</a></div></div>
<div class="ttc" id="cli_8h_html_ab33e5350a923c3a8cedbeb496cd88ec9a71745eb63dd093f560a1add3e430d2a9"><div class="ttname"><a href="../../dc/db0/cli_8h.html#ab33e5350a923c3a8cedbeb496cd88ec9a71745eb63dd093f560a1add3e430d2a9">CLI_INIT</a></div><div class="ttdef"><b>Definition:</b> <a href="../../dc/db0/cli_8h_source.html#l00152">cli.h:152</a></div></div>
<div class="ttc" id="res__xmpp_8c_html_adfb6a3e1f6870b3fcfe56d1303db59b7"><div class="ttname"><a href="../../dc/d6b/res__xmpp_8c.html#adfb6a3e1f6870b3fcfe56d1303db59b7">xmpp_client_request_tls</a></div><div class="ttdeci">static int xmpp_client_request_tls(struct ast_xmpp_client *client, struct ast_xmpp_client_config *cfg, int type, iks *node)</div><div class="ttdoc">Internal function called when we need to request TLS support. </div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d6b/res__xmpp_8c_source.html#l02543">res_xmpp.c:2543</a></div></div>
<div class="ttc" id="cdr__mysql_8c_html_a787f82faccb7c1f40a2539a14855601b"><div class="ttname"><a href="../../d0/d29/cdr__mysql_8c.html#a787f82faccb7c1f40a2539a14855601b">desc</a></div><div class="ttdeci">static const char desc[]</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d29/cdr__mysql_8c_source.html#l00073">cdr_mysql.c:73</a></div></div>
<div class="ttc" id="structast__xmpp__client__config_html_aec78000b2897c094f68ed72559e18acd"><div class="ttname"><a href="../../da/d00/structast__xmpp__client__config.html#aec78000b2897c094f68ed72559e18acd">ast_xmpp_client_config::flags</a></div><div class="ttdeci">struct ast_flags flags</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d6b/res__xmpp_8c_source.html#l00460">res_xmpp.c:460</a></div></div>
<div class="ttc" id="astobj2_8h_html_ad9d009e87e737af900825b36db55a35ca52efdf13b66ae502e2e20a5f49f068de"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#ad9d009e87e737af900825b36db55a35ca52efdf13b66ae502e2e20a5f49f068de">OBJ_NOLOCK</a></div><div class="ttdoc">Assume that the ao2_container is already locked. </div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l01067">astobj2.h:1067</a></div></div>
<div class="ttc" id="ast__expr2f_8c_html_a33e91cd0cef6786e9e3a27ac67707207"><div class="ttname"><a href="../../dc/df2/ast__expr2f_8c.html#a33e91cd0cef6786e9e3a27ac67707207">if</a></div><div class="ttdeci">if(!yyg-&gt;yy_init)</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/df2/ast__expr2f_8c_source.html#l00868">ast_expr2f.c:868</a></div></div>
<div class="ttc" id="stasis_8h_html_a9356e8a29344ca4eac93088198ccff89"><div class="ttname"><a href="../../dd/d79/stasis_8h.html#a9356e8a29344ca4eac93088198ccff89">stasis_message_type</a></div><div class="ttdeci">struct stasis_message_type * stasis_message_type(const struct stasis_message *msg)</div><div class="ttdoc">Get the message type for a stasis_message. </div><div class="ttdef"><b>Definition:</b> <a href="../../d2/db9/stasis__message_8c_source.html#l00187">stasis_message.c:187</a></div></div>
<div class="ttc" id="stasis_8h_html_a52b5393bef89d7781c0d039d6489de23"><div class="ttname"><a href="../../dd/d79/stasis_8h.html#a52b5393bef89d7781c0d039d6489de23">stasis_subscription_set_filter</a></div><div class="ttdeci">int stasis_subscription_set_filter(struct stasis_subscription *subscription, enum stasis_subscription_message_filter filter)</div><div class="ttdoc">Set the message type filtering level on a subscription. </div><div class="ttdef"><b>Definition:</b> <a href="../../d0/df4/stasis_8c_source.html#l01079">stasis.c:1079</a></div></div>
<div class="ttc" id="res__xmpp_8c_html_a8ca3a53044fbd45f15aabf626faac619"><div class="ttname"><a href="../../dc/d6b/res__xmpp_8c.html#a8ca3a53044fbd45f15aabf626faac619">ast_xmpp_client_lock</a></div><div class="ttdeci">void ast_xmpp_client_lock(struct ast_xmpp_client *client)</div><div class="ttdoc">Lock an XMPP client connection. </div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d6b/res__xmpp_8c_source.html#l00893">res_xmpp.c:893</a></div></div>
<div class="ttc" id="res__xmpp_8c_html_aa3759d2ddcc12f3f5ef5a8a3ffa4a4dfa7f963ec64d83b0ef771bb7d34a49dc34"><div class="ttname"><a href="../../dc/d6b/res__xmpp_8c.html#aa3759d2ddcc12f3f5ef5a8a3ffa4a4dfa7f963ec64d83b0ef771bb7d34a49dc34">XMPP_USESASL</a></div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d6b/res__xmpp_8c_source.html#l00404">res_xmpp.c:404</a></div></div>
<div class="ttc" id="xmpp_8h_html_ac2b3164e8b2827daa8c2ae41c254fdbf"><div class="ttname"><a href="../../da/da0/xmpp_8h.html#ac2b3164e8b2827daa8c2ae41c254fdbf">XMPP_MAX_ATTRLEN</a></div><div class="ttdeci">#define XMPP_MAX_ATTRLEN</div><div class="ttdoc">Maximum size of an attribute. </div><div class="ttdef"><b>Definition:</b> <a href="../../da/da0/xmpp_8h_source.html#l00068">xmpp.h:68</a></div></div>
<div class="ttc" id="module_8h_html_aa4f734041ffd9d75b07cefb0291e1e58a87717b8c3b913bbbb55297fc169086e0"><div class="ttname"><a href="../../d5/d16/module_8h.html#aa4f734041ffd9d75b07cefb0291e1e58a87717b8c3b913bbbb55297fc169086e0">AST_MODPRI_CHANNEL_DEPEND</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d16/module_8h_source.html#l00326">module.h:326</a></div></div>
<div class="ttc" id="res__xmpp_8c_html_af7e745a942bd8d6f5ba56ca9cfe5b67e"><div class="ttname"><a href="../../dc/d6b/res__xmpp_8c.html#af7e745a942bd8d6f5ba56ca9cfe5b67e">xmpp_client_send_disco_info_request</a></div><div class="ttdeci">static int xmpp_client_send_disco_info_request(struct ast_xmpp_client *client, const char *to, const char *from)</div><div class="ttdoc">Helper function which sends a discovery information request to a user. </div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d6b/res__xmpp_8c_source.html#l03195">res_xmpp.c:3195</a></div></div>
<div class="ttc" id="xmpp_8h_html_ae37d560c438576bdcb47347088225ee6a77f9e302744e33eb45b86565a4983697"><div class="ttname"><a href="../../da/da0/xmpp_8h.html#ae37d560c438576bdcb47347088225ee6a77f9e302744e33eb45b86565a4983697">XMPP_STATE_ROSTER</a></div><div class="ttdef"><b>Definition:</b> <a href="../../da/da0/xmpp_8h_source.html#l00079">xmpp.h:79</a></div></div>
<div class="ttc" id="message_8h_html_a98ae66acbd6268c5010acf52be7e40a4"><div class="ttname"><a href="../../d2/d0d/message_8h.html#a98ae66acbd6268c5010acf52be7e40a4">ast_msg_tech_register</a></div><div class="ttdeci">int ast_msg_tech_register(const struct ast_msg_tech *tech)</div><div class="ttdoc">Register a message technology. </div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d6d/message_8c_source.html#l01569">message.c:1569</a></div></div>
<div class="ttc" id="res__xmpp_8c_html_af278a5f2035bacdf8351da59953f7605"><div class="ttname"><a href="../../dc/d6b/res__xmpp_8c.html#af278a5f2035bacdf8351da59953f7605">xmpp_resource_destructor</a></div><div class="ttdeci">static void xmpp_resource_destructor(void *obj)</div><div class="ttdoc">Destructor callback function for XMPP resource. </div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d6b/res__xmpp_8c_source.html#l00829">res_xmpp.c:829</a></div></div>
<div class="ttc" id="structstasis__message_html"><div class="ttname"><a href="../../d7/d55/structstasis__message.html">stasis_message</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d2/db9/stasis__message_8c_source.html#l00121">stasis_message.c:121</a></div></div>
<div class="ttc" id="lock_8h_html_a69e9591803d36f5683eb9b084442be9b"><div class="ttname"><a href="../../dd/d42/lock_8h.html#a69e9591803d36f5683eb9b084442be9b">ast_cond_init</a></div><div class="ttdeci">#define ast_cond_init(cond, attr)</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d42/lock_8h_source.html#l00199">lock.h:199</a></div></div>
<div class="ttc" id="structast__xmpp__resource_html_a12856b954fce601a0303b0bcdf83c513"><div class="ttname"><a href="../../d6/d90/structast__xmpp__resource.html#a12856b954fce601a0303b0bcdf83c513">ast_xmpp_resource::resource</a></div><div class="ttdeci">char resource[XMPP_MAX_RESJIDLEN]</div><div class="ttdef"><b>Definition:</b> <a href="../../da/da0/xmpp_8h_source.html#l00093">xmpp.h:93</a></div></div>
<div class="ttc" id="cli_8h_html_aea8910ed9e301e7f741f87942c244eac"><div class="ttname"><a href="../../dc/db0/cli_8h.html#aea8910ed9e301e7f741f87942c244eac">ast_cli_register_multiple</a></div><div class="ttdeci">#define ast_cli_register_multiple(e, len)</div><div class="ttdoc">Register multiple commands. </div><div class="ttdef"><b>Definition:</b> <a href="../../dc/db0/cli_8h_source.html#l00265">cli.h:265</a></div></div>
<div class="ttc" id="config__options_8h_html_af28935f8c2547723d5922ebed1c71898"><div class="ttname"><a href="../../db/dfe/config__options_8h.html#af28935f8c2547723d5922ebed1c71898">aco_process_config</a></div><div class="ttdeci">enum aco_process_status aco_process_config(struct aco_info *info, int reload)</div><div class="ttdoc">Process a config info via the options registered with an aco_info. </div><div class="ttdef"><b>Definition:</b> <a href="../../d6/dc8/config__options_8c_source.html#l00652">config_options.c:652</a></div></div>
<div class="ttc" id="res__xmpp_8c_html_a0b3b1969e0cde893da791a0a490dc7b5"><div class="ttname"><a href="../../dc/d6b/res__xmpp_8c.html#a0b3b1969e0cde893da791a0a490dc7b5">xmpp_show_buddies</a></div><div class="ttdeci">static char * xmpp_show_buddies(struct ast_cli_entry *e, int cmd, struct ast_cli_args *a)</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d6b/res__xmpp_8c_source.html#l04414">res_xmpp.c:4414</a></div></div>
<div class="ttc" id="test__config_8c_html_aecdc7cbd5dfa76493c0212caa55d706c"><div class="ttname"><a href="../../d8/d4f/test__config_8c.html#aecdc7cbd5dfa76493c0212caa55d706c">item</a></div><div class="ttdeci">static struct aco_type item</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d4f/test__config_8c_source.html#l01463">test_config.c:1463</a></div></div>
<div class="ttc" id="astobj2_8h_html_a86d8d6c3c8866ed0a60121da055cd225"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#a86d8d6c3c8866ed0a60121da055cd225">ao2_global_obj_ref</a></div><div class="ttdeci">#define ao2_global_obj_ref(holder)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l00925">astobj2.h:925</a></div></div>
<div class="ttc" id="astobj2_8h_html_ad36841ab6daa3997f7ca7047ad2d033a"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#ad36841ab6daa3997f7ca7047ad2d033a">ao2_iterator_destroy</a></div><div class="ttdeci">void ao2_iterator_destroy(struct ao2_iterator *iter)</div><div class="ttdoc">Destroy a container iterator. </div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d22/astobj2__container_8c_source.html#l00534">astobj2_container.c:534</a></div></div>
<div class="ttc" id="structast__xmpp__client_html_a6588648b50745df0a20957b8d09fd919"><div class="ttname"><a href="../../df/d42/structast__xmpp__client.html#a6588648b50745df0a20957b8d09fd919">ast_xmpp_client::reconnect</a></div><div class="ttdeci">unsigned int reconnect</div><div class="ttdef"><b>Definition:</b> <a href="../../da/da0/xmpp_8h_source.html#l00142">xmpp.h:142</a></div></div>
<div class="ttc" id="structast__device__state__message_html_ac2f672c1450e8212e5462a749d393b0b"><div class="ttname"><a href="../../db/d92/structast__device__state__message.html#ac2f672c1450e8212e5462a749d393b0b">ast_device_state_message::cachable</a></div><div class="ttdeci">enum ast_devstate_cache cachable</div><div class="ttdef"><b>Definition:</b> <a href="../../da/da2/devicestate_8h_source.html#l00252">devicestate.h:252</a></div></div>
<div class="ttc" id="res__xmpp_8c_html_aa3759d2ddcc12f3f5ef5a8a3ffa4a4dfa8c4cc198db356150269f85b0339f00bf"><div class="ttname"><a href="../../dc/d6b/res__xmpp_8c.html#aa3759d2ddcc12f3f5ef5a8a3ffa4a4dfa8c4cc198db356150269f85b0339f00bf">XMPP_AUTOACCEPT</a></div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d6b/res__xmpp_8c_source.html#l00401">res_xmpp.c:401</a></div></div>
<div class="ttc" id="res__xmpp_8c_html_af90c7b8a64756048c4816729b5a2a141"><div class="ttname"><a href="../../dc/d6b/res__xmpp_8c.html#af90c7b8a64756048c4816729b5a2a141">xmpp_cli_create_leafnode</a></div><div class="ttdeci">static char * xmpp_cli_create_leafnode(struct ast_cli_entry *e, int cmd, struct ast_cli_args *a)</div><div class="ttdoc">Method to expose PubSub leaf node creation via CLI. </div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d6b/res__xmpp_8c_source.html#l04262">res_xmpp.c:4262</a></div></div>
<div class="ttc" id="time_8h_html_ad3899efb6f0e348556ef69f5b16aa7f7"><div class="ttname"><a href="../../de/df7/time_8h.html#ad3899efb6f0e348556ef69f5b16aa7f7">ast_tvnow</a></div><div class="ttdeci">struct timeval ast_tvnow(void)</div><div class="ttdoc">Returns current timeval. Meant to replace calls to gettimeofday(). </div><div class="ttdef"><b>Definition:</b> <a href="../../de/df7/time_8h_source.html#l00150">time.h:150</a></div></div>
<div class="ttc" id="stringfields_8h_html_a061580e89c55282a7140fa3fdfd52b6d"><div class="ttname"><a href="../../d1/d0f/stringfields_8h.html#a061580e89c55282a7140fa3fdfd52b6d">AST_DECLARE_STRING_FIELDS</a></div><div class="ttdeci">#define AST_DECLARE_STRING_FIELDS(field_list)</div><div class="ttdoc">Declare the fields needed in a structure. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d0f/stringfields_8h_source.html#l00337">stringfields.h:337</a></div></div>
<div class="ttc" id="endpoints_8h_html_a04bfc77dacce061c28fa31e2b86827e8"><div class="ttname"><a href="../../d4/d61/endpoints_8h.html#a04bfc77dacce061c28fa31e2b86827e8">ast_endpoint_set_state</a></div><div class="ttdeci">void ast_endpoint_set_state(struct ast_endpoint *endpoint, enum ast_endpoint_state state)</div><div class="ttdoc">Updates the state of the given endpoint. </div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d4b/main_2endpoints_8c_source.html#l00407">main/endpoints.c:407</a></div></div>
<div class="ttc" id="res__xmpp_8c_html_a697e78d60cfc0ddc36c6a9566b74bdac"><div class="ttname"><a href="../../dc/d6b/res__xmpp_8c.html#a697e78d60cfc0ddc36c6a9566b74bdac">xmpp_roster_hook</a></div><div class="ttdeci">static int xmpp_roster_hook(void *data, ikspak *pak)</div><div class="ttdoc">Hook function called when roster is received from server. </div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d6b/res__xmpp_8c_source.html#l02250">res_xmpp.c:2250</a></div></div>
<div class="ttc" id="json_8h_html_adca5179982d1f48df7127c123f15ce74"><div class="ttname"><a href="../../d4/d05/json_8h.html#adca5179982d1f48df7127c123f15ce74">ast_json_load_string</a></div><div class="ttdeci">struct ast_json * ast_json_load_string(const char *input, struct ast_json_error *error)</div><div class="ttdoc">Parse null terminated string into a JSON object or array. </div><div class="ttdef"><b>Definition:</b> <a href="../../df/d98/json_8c_source.html#l00546">json.c:546</a></div></div>
<div class="ttc" id="linkedlists_8h_html_a4a1884cde93e53bef32ca85c194a1d05"><div class="ttname"><a href="../../df/d90/linkedlists_8h.html#a4a1884cde93e53bef32ca85c194a1d05">AST_LIST_EMPTY</a></div><div class="ttdeci">#define AST_LIST_EMPTY(head)</div><div class="ttdoc">Checks whether the specified list contains any entries. </div><div class="ttdef"><b>Definition:</b> <a href="../../df/d90/linkedlists_8h_source.html#l00449">linkedlists.h:449</a></div></div>
<div class="ttc" id="astobj2_8h_html_a7ce8563daf84a18540a86504d165b444"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#a7ce8563daf84a18540a86504d165b444">ao2_link_flags</a></div><div class="ttdeci">#define ao2_link_flags(container, obj, flags)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l01572">astobj2.h:1572</a></div></div>
<div class="ttc" id="group__Group__AMI_html_ga77315fa8e29950f0c88120501acda0a3"><div class="ttname"><a href="../../df/d72/group__Group__AMI.html#ga77315fa8e29950f0c88120501acda0a3">astman_send_ack</a></div><div class="ttdeci">void astman_send_ack(struct mansession *s, const struct message *m, char *msg)</div><div class="ttdoc">Send ack in manager transaction. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d10/manager_8c_source.html#l03191">manager.c:3191</a></div></div>
<div class="ttc" id="lock_8h_html_ac5e13c7fe64d3b271a52028b0a78b92b"><div class="ttname"><a href="../../dd/d42/lock_8h.html#ac5e13c7fe64d3b271a52028b0a78b92b">ast_mutex_lock</a></div><div class="ttdeci">#define ast_mutex_lock(a)</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d42/lock_8h_source.html#l00187">lock.h:187</a></div></div>
<div class="ttc" id="astobj2_8h_html_a9998bd156b936636a8780385e9a910b2"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#a9998bd156b936636a8780385e9a910b2">ao2_unlock</a></div><div class="ttdeci">#define ao2_unlock(a)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l00730">astobj2.h:730</a></div></div>
<div class="ttc" id="test__linkedlists_8c_html_acd9db00336027462cfb25b97b5356883"><div class="ttname"><a href="../../d7/d6f/test__linkedlists_8c.html#acd9db00336027462cfb25b97b5356883">c</a></div><div class="ttdeci">static struct test_val c</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d6f/test__linkedlists_8c_source.html#l00048">test_linkedlists.c:48</a></div></div>
<div class="ttc" id="chan__iax2_8c_html_a7dd0190efe1c61151a9dbab078bdb263"><div class="ttname"><a href="../../d5/dff/chan__iax2_8c.html#a7dd0190efe1c61151a9dbab078bdb263">match</a></div><div class="ttdeci">static int match(struct ast_sockaddr *addr, unsigned short callno, unsigned short dcallno, const struct chan_iax2_pvt *cur, int check_dcallno)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/dff/chan__iax2_8c_source.html#l02315">chan_iax2.c:2315</a></div></div>
<div class="ttc" id="utils_8h_html_ab9da1c7265610eff83ed6146f104dc6f"><div class="ttname"><a href="../../d5/d60/utils_8h.html#ab9da1c7265610eff83ed6146f104dc6f">ast_copy_flags</a></div><div class="ttdeci">#define ast_copy_flags(dest, src, flagz)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d60/utils_8h_source.html#l00084">utils.h:84</a></div></div>
<div class="ttc" id="res__xmpp_8c_html_a17f29e437cb3706f6b4a152f291ed515"><div class="ttname"><a href="../../dc/d6b/res__xmpp_8c.html#a17f29e437cb3706f6b4a152f291ed515">xmpp_client_config_merge_buddies</a></div><div class="ttdeci">static int xmpp_client_config_merge_buddies(void *obj, void *arg, int flags)</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d6b/res__xmpp_8c_source.html#l03811">res_xmpp.c:3811</a></div></div>
<div class="ttc" id="time_8h_html_aca4ecdab7d8d3519062aad9a90fcb29d"><div class="ttname"><a href="../../de/df7/time_8h.html#aca4ecdab7d8d3519062aad9a90fcb29d">ast_tvdiff_ms</a></div><div class="ttdeci">int64_t ast_tvdiff_ms(struct timeval end, struct timeval start)</div><div class="ttdoc">Computes the difference (in milliseconds) between two struct timeval instances. </div><div class="ttdef"><b>Definition:</b> <a href="../../de/df7/time_8h_source.html#l00098">time.h:98</a></div></div>
<div class="ttc" id="extconf_8c_html_a81d26348827b996085d4cb6be3e2c348"><div class="ttname"><a href="../../d4/dc5/extconf_8c.html#a81d26348827b996085d4cb6be3e2c348">ast_verbose</a></div><div class="ttdeci">void ast_verbose(const char *fmt,...)</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/dc5/extconf_8c_source.html#l02207">extconf.c:2207</a></div></div>
<div class="ttc" id="res__xmpp_8c_html_a00680af12351f02dbeee7a2b4893917c"><div class="ttname"><a href="../../dc/d6b/res__xmpp_8c.html#a00680af12351f02dbeee7a2b4893917c">xmpp_buddy_cmp</a></div><div class="ttdeci">static int xmpp_buddy_cmp(void *obj, void *arg, int flags)</div><div class="ttdoc">Comparator function for XMPP buddy. </div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d6b/res__xmpp_8c_source.html#l00581">res_xmpp.c:581</a></div></div>
<div class="ttc" id="astmm_8h_html_ab263849d03fb892847be4986db759737"><div class="ttname"><a href="../../d8/d8a/astmm_8h.html#ab263849d03fb892847be4986db759737">ast_strdup</a></div><div class="ttdeci">#define ast_strdup(str)</div><div class="ttdoc">A wrapper for strdup() </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d8a/astmm_8h_source.html#l00243">astmm.h:243</a></div></div>
<div class="ttc" id="astobj2_8h_html_a1f8b41308be4c47de8ff89a3b9c7e7d1a75382dc9117cc118719edf6c3d2b71df"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#a1f8b41308be4c47de8ff89a3b9c7e7d1a75382dc9117cc118719edf6c3d2b71df">CMP_STOP</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l01032">astobj2.h:1032</a></div></div>
<div class="ttc" id="structxmpp__state__handler_html"><div class="ttname"><a href="../../dc/d18/structxmpp__state__handler.html">xmpp_state_handler</a></div><div class="ttdoc">Defined handlers for XMPP client states. </div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d6b/res__xmpp_8c_source.html#l00483">res_xmpp.c:483</a></div></div>
<div class="ttc" id="group__StasisTopicsAndMessages_html_ga547ae87810e6cd121cea7b3149343366"><div class="ttname"><a href="../../df/deb/group__StasisTopicsAndMessages.html#ga547ae87810e6cd121cea7b3149343366">ast_mwi_topic_all</a></div><div class="ttdeci">struct stasis_topic * ast_mwi_topic_all(void)</div><div class="ttdoc">Get the Stasis Message Bus API topic for MWI messages. </div><div class="ttdef"><b>Definition:</b> <a href="../../d6/db4/mwi_8c_source.html#l00085">mwi.c:85</a></div></div>
<div class="ttc" id="test__func__file_8c_html_a7df83d295429a2562396f1ec127a46c0"><div class="ttname"><a href="../../d5/dde/test__func__file_8c.html#a7df83d295429a2562396f1ec127a46c0">args</a></div><div class="ttdeci">const char * args</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/dde/test__func__file_8c_source.html#l00046">test_func_file.c:46</a></div></div>
<div class="ttc" id="stasis_8h_html_a8c5612920b22beb93b5e8acbdae40078"><div class="ttname"><a href="../../dd/d79/stasis_8h.html#a8c5612920b22beb93b5e8acbdae40078">stasis_cache_dump</a></div><div class="ttdeci">struct ao2_container * stasis_cache_dump(struct stasis_cache *cache, struct stasis_message_type *type)</div><div class="ttdoc">Dump cached items to a subscription for the ast_eid_default entity. </div><div class="ttdef"><b>Definition:</b> <a href="../../d0/da9/stasis__cache_8c_source.html#l00736">stasis_cache.c:736</a></div></div>
<div class="ttc" id="resample_8c_html_a070d2ce7b6bb7e5c05602aa8c308d0c4"><div class="ttname"><a href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a></div><div class="ttdeci">#define NULL</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d7f/resample_8c_source.html#l00096">resample.c:96</a></div></div>
<div class="ttc" id="eagi__proxy_8c_html_a8fd806ad19b8f5513a4cf18cbf77532c"><div class="ttname"><a href="../../dd/d7c/eagi__proxy_8c.html#a8fd806ad19b8f5513a4cf18cbf77532c">end</a></div><div class="ttdeci">char * end</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d7c/eagi__proxy_8c_source.html#l00073">eagi_proxy.c:73</a></div></div>
<div class="ttc" id="message_8h_html"><div class="ttname"><a href="../../d2/d0d/message_8h.html">message.h</a></div><div class="ttdoc">Out-of-call text message support. </div></div>
<div class="ttc" id="structast__xmpp__client_html_ace475b3c63f137d8ff9af0e10d4f5e97"><div class="ttname"><a href="../../df/d42/structast__xmpp__client.html#ace475b3c63f137d8ff9af0e10d4f5e97">ast_xmpp_client::device_state_sub</a></div><div class="ttdeci">struct stasis_subscription * device_state_sub</div><div class="ttdef"><b>Definition:</b> <a href="../../da/da0/xmpp_8h_source.html#l00146">xmpp.h:146</a></div></div>
<div class="ttc" id="structaco__file_html"><div class="ttname"><a href="../../d9/d9c/structaco__file.html">aco_file</a></div><div class="ttdoc">The representation of a single configuration file to be processed. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/dfe/config__options_8h_source.html#l00161">config_options.h:161</a></div></div>
<div class="ttc" id="cli_8h_html_a791bf9f5637185bee5e8f0907c762130"><div class="ttname"><a href="../../dc/db0/cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a></div><div class="ttdeci">void ast_cli(int fd, const char *fmt,...)</div><div class="ttdef"><b>Definition:</b> <a href="../../da/d4d/clicompat_8c_source.html#l00006">clicompat.c:6</a></div></div>
<div class="ttc" id="res__xmpp_8c_html_a8a477b45a75d10929fc46e6e53308f27"><div class="ttname"><a href="../../dc/d6b/res__xmpp_8c.html#a8a477b45a75d10929fc46e6e53308f27">xmpp_component_register_get_hook</a></div><div class="ttdeci">static int xmpp_component_register_get_hook(void *data, ikspak *pak)</div><div class="ttdoc">Hook function called when the component is queried about registration. </div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d6b/res__xmpp_8c_source.html#l02934">res_xmpp.c:2934</a></div></div>
<div class="ttc" id="res__xmpp_8c_html_a65b4aeae7d602f7aa68d217f0576c033"><div class="ttname"><a href="../../dc/d6b/res__xmpp_8c.html#a65b4aeae7d602f7aa68d217f0576c033">xmpp_pubsub_devstate_cb</a></div><div class="ttdeci">static void xmpp_pubsub_devstate_cb(void *data, struct stasis_subscription *sub, struct stasis_message *msg)</div><div class="ttdoc">Callback function for device state events. </div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d6b/res__xmpp_8c_source.html#l01364">res_xmpp.c:1364</a></div></div>
<div class="ttc" id="cdr__beanstalkd_8c_html_acec9ce2df15222151ad66fcb1d74eb9f"><div class="ttname"><a href="../../d9/d47/cdr__beanstalkd_8c.html#acec9ce2df15222151ad66fcb1d74eb9f">priority</a></div><div class="ttdeci">static int priority</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d47/cdr__beanstalkd_8c_source.html#l00076">cdr_beanstalkd.c:76</a></div></div>
<div class="ttc" id="module_8h_html_ad2ca15621101154f29748cf1dac3c3cf"><div class="ttname"><a href="../../d5/d16/module_8h.html#ad2ca15621101154f29748cf1dac3c3cf">ast_unregister_application</a></div><div class="ttdeci">int ast_unregister_application(const char *app)</div><div class="ttdoc">Unregister an application. </div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d16/pbx__app_8c_source.html#l00392">pbx_app.c:392</a></div></div>
<div class="ttc" id="res__xmpp_8c_html_a92d502301cd0604b3db58299d86a7fe9"><div class="ttname"><a href="../../dc/d6b/res__xmpp_8c.html#a92d502301cd0604b3db58299d86a7fe9">xmpp_init_event_distribution</a></div><div class="ttdeci">static void xmpp_init_event_distribution(struct ast_xmpp_client *client)</div><div class="ttdoc">Initialize collections for event distribution. </div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d6b/res__xmpp_8c_source.html#l01588">res_xmpp.c:1588</a></div></div>
<div class="ttc" id="structaco__type_html_a41ea490a42392545d2f6e2c6888cd94e"><div class="ttname"><a href="../../de/d71/structaco__type.html#a41ea490a42392545d2f6e2c6888cd94e">aco_type::type</a></div><div class="ttdeci">enum aco_type_t type</div><div class="ttdef"><b>Definition:</b> <a href="../../db/dfe/config__options_8h_source.html#l00123">config_options.h:123</a></div></div>
<div class="ttc" id="linkedlists_8h_html_a712c04b4493919a7052399cd30ee8fb9"><div class="ttname"><a href="../../df/d90/linkedlists_8h.html#a712c04b4493919a7052399cd30ee8fb9">AST_LIST_TRAVERSE_SAFE_END</a></div><div class="ttdeci">#define AST_LIST_TRAVERSE_SAFE_END</div><div class="ttdoc">Closes a safe loop traversal block. </div><div class="ttdef"><b>Definition:</b> <a href="../../df/d90/linkedlists_8h_source.html#l00614">linkedlists.h:614</a></div></div>
<div class="ttc" id="config__options_8h_html_af773eedd7f94d718752798605c687c4b"><div class="ttname"><a href="../../db/dfe/config__options_8h.html#af773eedd7f94d718752798605c687c4b">ACO_TYPES</a></div><div class="ttdeci">#define ACO_TYPES(...)</div><div class="ttdoc">A helper macro to ensure that aco_info types always have a sentinel. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/dfe/config__options_8h_source.html#l00181">config_options.h:181</a></div></div>
<div class="ttc" id="message_8h_html_abd98509b6e22ab33822ff3c7a2e35756"><div class="ttname"><a href="../../d2/d0d/message_8h.html#abd98509b6e22ab33822ff3c7a2e35756">ast_msg_get_body</a></div><div class="ttdeci">const char * ast_msg_get_body(const struct ast_msg *msg)</div><div class="ttdoc">Get the body of a message. </div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d6d/message_8c_source.html#l00531">message.c:531</a></div></div>
<div class="ttc" id="res__xmpp_8c_html_a12ea81a7f47eca38c7c4ac9a07bddd40"><div class="ttname"><a href="../../dc/d6b/res__xmpp_8c.html#a12ea81a7f47eca38c7c4ac9a07bddd40">jabberstatus_function</a></div><div class="ttdeci">static struct ast_custom_function jabberstatus_function</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d6b/res__xmpp_8c_source.html#l01710">res_xmpp.c:1710</a></div></div>
<div class="ttc" id="res__xmpp_8c_html_afdce9cb2efa5b4eff4cd68976402e8b1"><div class="ttname"><a href="../../dc/d6b/res__xmpp_8c.html#afdce9cb2efa5b4eff4cd68976402e8b1">ast_xmpp_client_find</a></div><div class="ttdeci">struct ast_xmpp_client * ast_xmpp_client_find(const char *name)</div><div class="ttdoc">Find an XMPP client connection using a given name. </div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d6b/res__xmpp_8c_source.html#l00875">res_xmpp.c:875</a></div></div>
<div class="ttc" id="cdr__mysql_8c_html_ab4fdb206838f2974bd15fc2ca1e9d366"><div class="ttname"><a href="../../d0/d29/cdr__mysql_8c.html#ab4fdb206838f2974bd15fc2ca1e9d366">password</a></div><div class="ttdeci">static struct ast_str * password</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d29/cdr__mysql_8c_source.html#l00077">cdr_mysql.c:77</a></div></div>
<div class="ttc" id="astobj2_8h_html_ad9d009e87e737af900825b36db55a35ca71f42ec6460e60eb6e10956c53329e45"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#ad9d009e87e737af900825b36db55a35ca71f42ec6460e60eb6e10956c53329e45">OBJ_UNLINK</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l01043">astobj2.h:1043</a></div></div>
<div class="ttc" id="structast__eid_html"><div class="ttname"><a href="../../d0/d86/structast__eid.html">ast_eid</a></div><div class="ttdoc">An Entity ID is essentially a MAC address, brief and unique. </div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d60/utils_8h_source.html#l00786">utils.h:786</a></div></div>
<div class="ttc" id="structast__json__error_html"><div class="ttname"><a href="../../d0/d96/structast__json__error.html">ast_json_error</a></div><div class="ttdoc">JSON parsing error information. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d05/json_8h_source.html#l00829">json.h:829</a></div></div>
<div class="ttc" id="structast__xmpp__client__config_html_acec9ce2df15222151ad66fcb1d74eb9f"><div class="ttname"><a href="../../da/d00/structast__xmpp__client__config.html#acec9ce2df15222151ad66fcb1d74eb9f">ast_xmpp_client_config::priority</a></div><div class="ttdeci">int priority</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d6b/res__xmpp_8c_source.html#l00459">res_xmpp.c:459</a></div></div>
<div class="ttc" id="res__xmpp_8c_html_a5aea6229c4245877b1461ef047e4208e"><div class="ttname"><a href="../../dc/d6b/res__xmpp_8c.html#a5aea6229c4245877b1461ef047e4208e">xmpp_pubsub_subscribe</a></div><div class="ttdeci">static void xmpp_pubsub_subscribe(struct ast_xmpp_client *client, const char *node)</div><div class="ttdoc">Subscribe to a PubSub node. </div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d6b/res__xmpp_8c_source.html#l01414">res_xmpp.c:1414</a></div></div>
<div class="ttc" id="xmpp_8h_html_a99fa4c2cecd405f4430c8d137af93db9"><div class="ttname"><a href="../../da/da0/xmpp_8h.html#a99fa4c2cecd405f4430c8d137af93db9">IKS_NET_EXPIRED</a></div><div class="ttdeci">#define IKS_NET_EXPIRED</div><div class="ttdef"><b>Definition:</b> <a href="../../da/da0/xmpp_8h_source.html#l00041">xmpp.h:41</a></div></div>
<div class="ttc" id="pbx_8h_html_a965977ea9a3144bc203e0ce7a64680a1"><div class="ttname"><a href="../../db/de0/pbx_8h.html#a965977ea9a3144bc203e0ce7a64680a1">ast_custom_function_unregister</a></div><div class="ttdeci">int ast_custom_function_unregister(struct ast_custom_function *acf)</div><div class="ttdoc">Unregister a custom function. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/d70/pbx__functions_8c_source.html#l00273">pbx_functions.c:273</a></div></div>
<div class="ttc" id="message_8h_html_acf4073638cf23022399e3666c804e178"><div class="ttname"><a href="../../d2/d0d/message_8h.html#acf4073638cf23022399e3666c804e178">ast_msg_set_to</a></div><div class="ttdeci">int ast_msg_set_to(struct ast_msg *msg, const char *fmt,...)</div><div class="ttdoc">Set the &amp;#39;to&amp;#39; URI of a message. </div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d6d/message_8c_source.html#l00454">message.c:454</a></div></div>
<div class="ttc" id="structast__xmpp__client_html_a17d0e5a7ebe404ac9471b8e403708c66"><div class="ttname"><a href="../../df/d42/structast__xmpp__client.html#a17d0e5a7ebe404ac9471b8e403708c66">ast_xmpp_client::messages</a></div><div class="ttdeci">struct ast_xmpp_client::@330 messages</div></div>
<div class="ttc" id="utils_8h_html_a4e9f7c7ca75b0ff48b60b136e3961b61"><div class="ttname"><a href="../../d5/d60/utils_8h.html#a4e9f7c7ca75b0ff48b60b136e3961b61">ast_eid_cmp</a></div><div class="ttdeci">int ast_eid_cmp(const struct ast_eid *eid1, const struct ast_eid *eid2)</div><div class="ttdoc">Compare two EIDs. </div><div class="ttdef"><b>Definition:</b> <a href="../../de/d1f/main_2utils_8c_source.html#l02842">main/utils.c:2842</a></div></div>
<div class="ttc" id="res__corosync_8c_html_aa4002959b64099e84d20e09e38c2e51e"><div class="ttname"><a href="../../d1/da4/res__corosync_8c.html#aa4002959b64099e84d20e09e38c2e51e">publish</a></div><div class="ttdeci">unsigned char publish</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/da4/res__corosync_8c_source.html#l00241">res_corosync.c:241</a></div></div>
<div class="ttc" id="astmm_8h_html_ada667b6f84a08e6848cb37c5ffb94a5f"><div class="ttname"><a href="../../d8/d8a/astmm_8h.html#ada667b6f84a08e6848cb37c5ffb94a5f">ast_asprintf</a></div><div class="ttdeci">#define ast_asprintf(ret, fmt,...)</div><div class="ttdoc">A wrapper for asprintf() </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d8a/astmm_8h_source.html#l00269">astmm.h:269</a></div></div>
<div class="ttc" id="structast__cli__entry_html_a1bd7a8575ca2650132d636d65dcda2f6"><div class="ttname"><a href="../../d8/d07/structast__cli__entry.html#a1bd7a8575ca2650132d636d65dcda2f6">ast_cli_entry::args</a></div><div class="ttdeci">int args</div><div class="ttdoc">This gets set in ast_cli_register() </div><div class="ttdef"><b>Definition:</b> <a href="../../dc/db0/cli_8h_source.html#l00185">cli.h:185</a></div></div>
<div class="ttc" id="res__xmpp_8c_html_aa073dd3fd02ac2d0b962a7b040b0b706"><div class="ttname"><a href="../../dc/d6b/res__xmpp_8c.html#aa073dd3fd02ac2d0b962a7b040b0b706">cached_devstate_cb</a></div><div class="ttdeci">static int cached_devstate_cb(void *obj, void *arg, int flags)</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d6b/res__xmpp_8c_source.html#l01575">res_xmpp.c:1575</a></div></div>
<div class="ttc" id="res__xmpp_8c_html_ad09fa931f468002152a3cc2d5ce25eae"><div class="ttname"><a href="../../dc/d6b/res__xmpp_8c.html#ad09fa931f468002152a3cc2d5ce25eae">unload_module</a></div><div class="ttdeci">static int unload_module(void)</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d6b/res__xmpp_8c_source.html#l04485">res_xmpp.c:4485</a></div></div>
<div class="ttc" id="group__Group__AMI_html_gac6a9f3498f9afffecfd78c485af41556"><div class="ttname"><a href="../../df/d72/group__Group__AMI.html#gac6a9f3498f9afffecfd78c485af41556">astman_get_header</a></div><div class="ttdeci">const char * astman_get_header(const struct message *m, char *var)</div><div class="ttdoc">Get header from mananger transaction. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d10/manager_8c_source.html#l02820">manager.c:2820</a></div></div>
<div class="ttc" id="lock_8h_html_ab134d98cdfe7de0f7a72b377c0765dc7"><div class="ttname"><a href="../../dd/d42/lock_8h.html#ab134d98cdfe7de0f7a72b377c0765dc7">ast_cond_t</a></div><div class="ttdeci">pthread_cond_t ast_cond_t</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d42/lock_8h_source.html#l00176">lock.h:176</a></div></div>
<div class="ttc" id="res__xmpp_8c_html_a8f64e805d3ad98e99a03d77bbdb84bed"><div class="ttname"><a href="../../dc/d6b/res__xmpp_8c.html#a8f64e805d3ad98e99a03d77bbdb84bed">xmpp_client_set_presence</a></div><div class="ttdeci">static void xmpp_client_set_presence(struct ast_xmpp_client *client, const char *to, const char *from, int level, const char *desc)</div><div class="ttdoc">Internal function which changes the presence status of an XMPP client. </div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d6b/res__xmpp_8c_source.html#l02308">res_xmpp.c:2308</a></div></div>
<div class="ttc" id="strings_8h_html_a372554b7a2d69a8bd3adac5157672036"><div class="ttname"><a href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a></div><div class="ttdeci">#define ast_strlen_zero(foo)</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d90/strings_8h_source.html#l00052">strings.h:52</a></div></div>
<div class="ttc" id="linkedlists_8h_html_a47bafe663a14b91827082787d7654d7c"><div class="ttname"><a href="../../df/d90/linkedlists_8h.html#a47bafe663a14b91827082787d7654d7c">AST_LIST_HEAD_DESTROY</a></div><div class="ttdeci">#define AST_LIST_HEAD_DESTROY(head)</div><div class="ttdoc">Destroys a list head structure. </div><div class="ttdef"><b>Definition:</b> <a href="../../df/d90/linkedlists_8h_source.html#l00652">linkedlists.h:652</a></div></div>
<div class="ttc" id="config__options_8h_html_a840871f014617f5415dacb9a7d32a59bab3719e39fd87c376c6f143e337f73e12"><div class="ttname"><a href="../../db/dfe/config__options_8h.html#a840871f014617f5415dacb9a7d32a59bab3719e39fd87c376c6f143e337f73e12">ACO_GLOBAL</a></div><div class="ttdef"><b>Definition:</b> <a href="../../db/dfe/config__options_8h_source.html#l00041">config_options.h:41</a></div></div>
<div class="ttc" id="utils_8h_html_a595e2f8aa398f4bd21e381c3211235fe"><div class="ttname"><a href="../../d5/d60/utils_8h.html#a595e2f8aa398f4bd21e381c3211235fe">ast_pthread_create_background</a></div><div class="ttdeci">#define ast_pthread_create_background(a, b, c, d)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d60/utils_8h_source.html#l00567">utils.h:567</a></div></div>
<div class="ttc" id="test__amihooks_8c_html_a5992b274cfdcacdbc1fa8347fd01ebde"><div class="ttname"><a href="../../dc/dbf/test__amihooks_8c.html#a5992b274cfdcacdbc1fa8347fd01ebde">done</a></div><div class="ttdeci">int done</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/dbf/test__amihooks_8c_source.html#l00048">test_amihooks.c:48</a></div></div>
<div class="ttc" id="res__xmpp_8c_html_aa1b7f2cc76fae598ccb5315910a6093a"><div class="ttname"><a href="../../dc/d6b/res__xmpp_8c.html#aa1b7f2cc76fae598ccb5315910a6093a">xmpp_do_set_debug</a></div><div class="ttdeci">static char * xmpp_do_set_debug(struct ast_cli_entry *e, int cmd, struct ast_cli_args *a)</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d6b/res__xmpp_8c_source.html#l04304">res_xmpp.c:4304</a></div></div>
<div class="ttc" id="structast__xmpp__client__config_html_a63c89c04d1feae07ca35558055155ffb"><div class="ttname"><a href="../../da/d00/structast__xmpp__client__config.html#a63c89c04d1feae07ca35558055155ffb">ast_xmpp_client_config::port</a></div><div class="ttdeci">int port</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d6b/res__xmpp_8c_source.html#l00457">res_xmpp.c:457</a></div></div>
<div class="ttc" id="utils_8h_html_a3acffbd305ee72dcd4593c0d8af64a4f"><div class="ttname"><a href="../../d5/d60/utils_8h.html#a3acffbd305ee72dcd4593c0d8af64a4f">MIN</a></div><div class="ttdeci">#define MIN(a, b)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d60/utils_8h_source.html#l00226">utils.h:226</a></div></div>
<div class="ttc" id="res__xmpp_8c_html_a15a090fb684bb844a1808b5531dedfac"><div class="ttname"><a href="../../dc/d6b/res__xmpp_8c.html#a15a090fb684bb844a1808b5531dedfac">xmpp_state_handlers</a></div><div class="ttdeci">static const struct xmpp_state_handler xmpp_state_handlers[]</div></div>
<div class="ttc" id="chan__mgcp_8c_html_a6b49cafa2a3d359a2e865992f551874a"><div class="ttname"><a href="../../d0/dd6/chan__mgcp_8c.html#a6b49cafa2a3d359a2e865992f551874a">mailbox</a></div><div class="ttdeci">static char mailbox[AST_MAX_MAILBOX_UNIQUEID]</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/dd6/chan__mgcp_8c_source.html#l00204">chan_mgcp.c:204</a></div></div>
<div class="ttc" id="devicestate_8h_html_a9459272db1c8c968ed1aff1387f0f9fd"><div class="ttname"><a href="../../da/da2/devicestate_8h.html#a9459272db1c8c968ed1aff1387f0f9fd">ast_device_state_message_type</a></div><div class="ttdeci">struct stasis_message_type * ast_device_state_message_type(void)</div><div class="ttdoc">Get the Stasis message type for device state messages. </div></div>
<div class="ttc" id="structast__xmpp__client_html_aa663ff5d560561c647a50b58adce4e7a"><div class="ttname"><a href="../../df/d42/structast__xmpp__client.html#aa663ff5d560561c647a50b58adce4e7a">ast_xmpp_client::stream_flags</a></div><div class="ttdeci">unsigned int stream_flags</div><div class="ttdef"><b>Definition:</b> <a href="../../da/da0/xmpp_8h_source.html#l00134">xmpp.h:134</a></div></div>
<div class="ttc" id="res__xmpp_8c_html_af3eb7b696a9437a0b6ffba5a79f696bd"><div class="ttname"><a href="../../dc/d6b/res__xmpp_8c.html#af3eb7b696a9437a0b6ffba5a79f696bd">xmpp_pubsub_handle_event</a></div><div class="ttdeci">static int xmpp_pubsub_handle_event(void *data, ikspak *pak)</div><div class="ttdoc">Callback for handling PubSub events. </div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d6b/res__xmpp_8c_source.html#l01461">res_xmpp.c:1461</a></div></div>
<div class="ttc" id="res__xmpp_8c_html_aa62316b52aedcca330fd1113c1f3c97e"><div class="ttname"><a href="../../dc/d6b/res__xmpp_8c.html#aa62316b52aedcca330fd1113c1f3c97e">BUDDY_BUCKETS</a></div><div class="ttdeci">#define BUDDY_BUCKETS</div><div class="ttdoc">Number of buckets for buddies (per client) </div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d6b/res__xmpp_8c_source.html#l00423">res_xmpp.c:423</a></div></div>
<div class="ttc" id="manager_8h_html_a420f0f755e1c3378b45ca7f6f0669ffa"><div class="ttname"><a href="../../db/d45/manager_8h.html#a420f0f755e1c3378b45ca7f6f0669ffa">EVENT_FLAG_SYSTEM</a></div><div class="ttdeci">#define EVENT_FLAG_SYSTEM</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d45/manager_8h_source.html#l00071">manager.h:71</a></div></div>
<div class="ttc" id="structast__xmpp__global__config_html_ab40b53f823544fcdeff79c7fc6beb69b"><div class="ttname"><a href="../../da/d70/structast__xmpp__global__config.html#ab40b53f823544fcdeff79c7fc6beb69b">ast_xmpp_global_config::pubsub</a></div><div class="ttdeci">struct ast_flags pubsub</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d6b/res__xmpp_8c_source.html#l00440">res_xmpp.c:440</a></div></div>
<div class="ttc" id="logger_8h_html_a3f248112c8d6ce7e3959aa723dade648"><div class="ttname"><a href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a></div><div class="ttdeci">#define ast_debug(level,...)</div><div class="ttdoc">Log a DEBUG message. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d8c/logger_8h_source.html#l00452">logger.h:452</a></div></div>
<div class="ttc" id="astobj2_8c_html_a96a00b3a518d7f32b6d51dc28f09bf9b"><div class="ttname"><a href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a></div><div class="ttdeci">#define ast_log</div><div class="ttdef"><b>Definition:</b> <a href="../../da/df7/astobj2_8c_source.html#l00042">astobj2.c:42</a></div></div>
<div class="ttc" id="structast__xmpp__client_html_a422af54ca3d288f34246a66114879f27"><div class="ttname"><a href="../../df/d42/structast__xmpp__client.html#a422af54ca3d288f34246a66114879f27">ast_xmpp_client::mwi_sub</a></div><div class="ttdeci">struct stasis_subscription * mwi_sub</div><div class="ttdef"><b>Definition:</b> <a href="../../da/da0/xmpp_8h_source.html#l00144">xmpp.h:144</a></div></div>
<div class="ttc" id="structast__xmpp__capabilities_html_a987239273bb4a074ad22c76c6486d5b1"><div class="ttname"><a href="../../da/daa/structast__xmpp__capabilities.html#a987239273bb4a074ad22c76c6486d5b1">ast_xmpp_capabilities::node</a></div><div class="ttdeci">char node[200]</div><div class="ttdef"><b>Definition:</b> <a href="../../da/da0/xmpp_8h_source.html#l00085">xmpp.h:85</a></div></div>
<div class="ttc" id="structast__variable_html_a8556878012feffc9e0beb86cd78f424d"><div class="ttname"><a href="../../dd/d02/structast__variable.html#a8556878012feffc9e0beb86cd78f424d">ast_variable::value</a></div><div class="ttdeci">const char * value</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/de6/include_2asterisk_2config_8h_source.html#l00087">include/asterisk/config.h:87</a></div></div>
<div class="ttc" id="config__options_8h_html_a5793d5d6ccf2df0b2423eb3274af7802"><div class="ttname"><a href="../../db/dfe/config__options_8h.html#a5793d5d6ccf2df0b2423eb3274af7802">FLDSET</a></div><div class="ttdeci">#define FLDSET(type,...)</div><div class="ttdoc">Convert a struct and list of fields to an argument list of field offsets. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/dfe/config__options_8h_source.html#l00816">config_options.h:816</a></div></div>
<div class="ttc" id="structast__xmpp__message_html_a765533dfc643627999c751f7e1514664"><div class="ttname"><a href="../../d6/d73/structast__xmpp__message.html#a765533dfc643627999c751f7e1514664">ast_xmpp_message::from</a></div><div class="ttdeci">char * from</div><div class="ttdef"><b>Definition:</b> <a href="../../da/da0/xmpp_8h_source.html#l00102">xmpp.h:102</a></div></div>
<div class="ttc" id="res__xmpp_8c_html_a14d1e59aa727645c2d87c794f4d00b8e"><div class="ttname"><a href="../../dc/d6b/res__xmpp_8c.html#a14d1e59aa727645c2d87c794f4d00b8e">app_ajisendgroup</a></div><div class="ttdeci">static const char * app_ajisendgroup</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d6b/res__xmpp_8c_source.html#l00511">res_xmpp.c:511</a></div></div>
<div class="ttc" id="devicestate_8h_html_a62a8e6bc4b82dd797e505688f9f29bff"><div class="ttname"><a href="../../da/da2/devicestate_8h.html#a62a8e6bc4b82dd797e505688f9f29bff">ast_devstate_changed</a></div><div class="ttdeci">int ast_devstate_changed(enum ast_device_state state, enum ast_devstate_cache cachable, const char *fmt,...)</div><div class="ttdoc">Tells Asterisk the State for Device is changed. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d80/devicestate_8c_source.html#l00510">devicestate.c:510</a></div></div>
<div class="ttc" id="config__options_8h_html_a3f40a7cffea07c21a21faaee64d24398"><div class="ttname"><a href="../../db/dfe/config__options_8h.html#a3f40a7cffea07c21a21faaee64d24398">aco_info_init</a></div><div class="ttdeci">int aco_info_init(struct aco_info *info)</div><div class="ttdoc">Initialize an aco_info structure. </div><div class="ttdef"><b>Definition:</b> <a href="../../d6/dc8/config__options_8c_source.html#l00877">config_options.c:877</a></div></div>
<div class="ttc" id="res__xmpp_8c_html_a957dd973b2f620b41c4e6e87c407297d"><div class="ttname"><a href="../../dc/d6b/res__xmpp_8c.html#a957dd973b2f620b41c4e6e87c407297d">app_ajistatus</a></div><div class="ttdeci">static const char * app_ajistatus</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d6b/res__xmpp_8c_source.html#l00512">res_xmpp.c:512</a></div></div>
<div class="ttc" id="xmpp_8h_html_ae37d560c438576bdcb47347088225ee6a83544d57990f3fc1311d173a44928042"><div class="ttname"><a href="../../da/da0/xmpp_8h.html#ae37d560c438576bdcb47347088225ee6a83544d57990f3fc1311d173a44928042">XMPP_STATE_DISCONNECTED</a></div><div class="ttdef"><b>Definition:</b> <a href="../../da/da0/xmpp_8h_source.html#l00073">xmpp.h:73</a></div></div>
<div class="ttc" id="devicestate_8h_html_ae148e0b95218b57b0348ab53f2f82657"><div class="ttname"><a href="../../da/da2/devicestate_8h.html#ae148e0b95218b57b0348ab53f2f82657">ast_devstate_val</a></div><div class="ttdeci">enum ast_device_state ast_devstate_val(const char *val)</div><div class="ttdoc">Convert device state from text to integer value. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d80/devicestate_8c_source.html#l00260">devicestate.c:260</a></div></div>
<div class="ttc" id="xmpp_8h_html_a4ac42d40c03218246d548fbb3fc06e59"><div class="ttname"><a href="../../da/da0/xmpp_8h.html#a4ac42d40c03218246d548fbb3fc06e59">XMPP_MAX_RESJIDLEN</a></div><div class="ttdeci">#define XMPP_MAX_RESJIDLEN</div><div class="ttdoc">Maximum size of a resource JID. </div><div class="ttdef"><b>Definition:</b> <a href="../../da/da0/xmpp_8h_source.html#l00065">xmpp.h:65</a></div></div>
<div class="ttc" id="json_8h_html"><div class="ttname"><a href="../../d4/d05/json_8h.html">json.h</a></div><div class="ttdoc">Asterisk JSON abstraction layer. </div></div>
<div class="ttc" id="res__xmpp_8c_html_adb47890696cd006752bdf380ae878269"><div class="ttname"><a href="../../dc/d6b/res__xmpp_8c.html#adb47890696cd006752bdf380ae878269">xmpp_component_register_set_hook</a></div><div class="ttdeci">static int xmpp_component_register_set_hook(void *data, ikspak *pak)</div><div class="ttdoc">Hook function called when someone registers to the component. </div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d6b/res__xmpp_8c_source.html#l02995">res_xmpp.c:2995</a></div></div>
<div class="ttc" id="module_8h_html_a155a0df9c59e04e305d4a2fa3e35f843a12c3f60dd7655dfa8d4430cbf04b1223"><div class="ttname"><a href="../../d5/d16/module_8h.html#a155a0df9c59e04e305d4a2fa3e35f843a12c3f60dd7655dfa8d4430cbf04b1223">AST_MODFLAG_LOAD_ORDER</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d16/module_8h_source.html#l00317">module.h:317</a></div></div>
<div class="ttc" id="res__xmpp_8c_html_a22920dcde5570770b359775466b08d72"><div class="ttname"><a href="../../dc/d6b/res__xmpp_8c.html#a22920dcde5570770b359775466b08d72">xmpp_client_authenticate_digest</a></div><div class="ttdeci">static int xmpp_client_authenticate_digest(struct ast_xmpp_client *client, struct ast_xmpp_client_config *cfg, int type, iks *node)</div><div class="ttdoc">Internal function called when we need to authenticate using non-SASL. </div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d6b/res__xmpp_8c_source.html#l02657">res_xmpp.c:2657</a></div></div>
<div class="ttc" id="structast__xmpp__client_html"><div class="ttname"><a href="../../df/d42/structast__xmpp__client.html">ast_xmpp_client</a></div><div class="ttdoc">XMPP Client Connection. </div><div class="ttdef"><b>Definition:</b> <a href="../../da/da0/xmpp_8h_source.html#l00119">xmpp.h:119</a></div></div>
<div class="ttc" id="res__xmpp_8c_html_adee47ce28cd17bbdc773df287fc062c5"><div class="ttname"><a href="../../dc/d6b/res__xmpp_8c.html#adee47ce28cd17bbdc773df287fc062c5">msg_tech</a></div><div class="ttdeci">static const struct ast_msg_tech msg_tech</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d6b/res__xmpp_8c_source.html#l02160">res_xmpp.c:2160</a></div></div>
<div class="ttc" id="xmpp_8h_html"><div class="ttname"><a href="../../da/da0/xmpp_8h.html">xmpp.h</a></div><div class="ttdoc">XMPP Interface. </div></div>
<div class="ttc" id="utils_8h_html_a1604b4d72144dd3d9f7da668e90337e9"><div class="ttname"><a href="../../d5/d60/utils_8h.html#a1604b4d72144dd3d9f7da668e90337e9">RAII_VAR</a></div><div class="ttdeci">#define RAII_VAR(vartype, varname, initval, dtor)</div><div class="ttdoc">Declare a variable that will call a destructor function when it goes out of scope. </div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d60/utils_8h_source.html#l00911">utils.h:911</a></div></div>
<div class="ttc" id="config__options_8h_html_a61bb4940517e7d00e7104de8273c2144a019a75c8729b63787919b2e67331c84f"><div class="ttname"><a href="../../db/dfe/config__options_8h.html#a61bb4940517e7d00e7104de8273c2144a019a75c8729b63787919b2e67331c84f">OPT_UINT_T</a></div><div class="ttdoc">Type for default option handler for unsigned integers. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/dfe/config__options_8h_source.html#l00459">config_options.h:459</a></div></div>
<div class="ttc" id="structast__cli__args_html_acf64f219885421479997667d2ed3f08a"><div class="ttname"><a href="../../d3/dad/structast__cli__args.html#acf64f219885421479997667d2ed3f08a">ast_cli_args::fd</a></div><div class="ttdeci">const int fd</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/db0/cli_8h_source.html#l00159">cli.h:159</a></div></div>
<div class="ttc" id="res__xmpp_8c_html_a01eac67a11ae1cdbd757bec21e9ee2de"><div class="ttname"><a href="../../dc/d6b/res__xmpp_8c.html#a01eac67a11ae1cdbd757bec21e9ee2de">xmpp_pubsub_purge_nodes</a></div><div class="ttdeci">static void xmpp_pubsub_purge_nodes(struct ast_xmpp_client *client, const char *collection_name)</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d6b/res__xmpp_8c_source.html#l04121">res_xmpp.c:4121</a></div></div>
<div class="ttc" id="structast__device__state__message_html_a39d1b63955a48c72508fa9f884d05762"><div class="ttname"><a href="../../db/d92/structast__device__state__message.html#a39d1b63955a48c72508fa9f884d05762">ast_device_state_message::eid</a></div><div class="ttdeci">const struct ast_eid * eid</div><div class="ttdoc">The EID of the server where this message originated. </div><div class="ttdef"><b>Definition:</b> <a href="../../da/da2/devicestate_8h_source.html#l00248">devicestate.h:248</a></div></div>
<div class="ttc" id="stringfields_8h_html_a871274fa4fd2687c7a44849a84df3665"><div class="ttname"><a href="../../d1/d0f/stringfields_8h.html#a871274fa4fd2687c7a44849a84df3665">ast_string_field_init</a></div><div class="ttdeci">#define ast_string_field_init(x, size)</div><div class="ttdoc">Initialize a field pool and fields. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d0f/stringfields_8h_source.html#l00353">stringfields.h:353</a></div></div>
<div class="ttc" id="lock_8h_html_a6009440c7a72f8e2e3b1ec97641ad160"><div class="ttname"><a href="../../dd/d42/lock_8h.html#a6009440c7a72f8e2e3b1ec97641ad160">AST_PTHREADT_NULL</a></div><div class="ttdeci">#define AST_PTHREADT_NULL</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d42/lock_8h_source.html#l00066">lock.h:66</a></div></div>
<div class="ttc" id="structast__device__state__message_html_a8059c3b19eb356cf729e5d25b139647e"><div class="ttname"><a href="../../db/d92/structast__device__state__message.html#a8059c3b19eb356cf729e5d25b139647e">ast_device_state_message::device</a></div><div class="ttdeci">const char * device</div><div class="ttdef"><b>Definition:</b> <a href="../../da/da2/devicestate_8h_source.html#l00242">devicestate.h:242</a></div></div>
<div class="ttc" id="res__xmpp_8c_html_ab99da9edf20009f484cbf3799f4b8638"><div class="ttname"><a href="../../dc/d6b/res__xmpp_8c.html#ab99da9edf20009f484cbf3799f4b8638">STATUS_DISAPPEAR</a></div><div class="ttdeci">#define STATUS_DISAPPEAR</div><div class="ttdoc">Status for a disappearing buddy. </div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d6b/res__xmpp_8c_source.html#l00432">res_xmpp.c:432</a></div></div>
<div class="ttc" id="poll-compat_8h_html_a5a0c58fa8311e94cd0ed34382aa822f9"><div class="ttname"><a href="../../d4/dfb/poll-compat_8h.html#a5a0c58fa8311e94cd0ed34382aa822f9">ast_poll</a></div><div class="ttdeci">#define ast_poll(a, b, c)</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/dfb/poll-compat_8h_source.html#l00088">poll-compat.h:88</a></div></div>
<div class="ttc" id="structast__custom__function_html"><div class="ttname"><a href="../../db/dc0/structast__custom__function.html">ast_custom_function</a></div><div class="ttdoc">Data structure associated with a custom dialplan function. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/de0/pbx_8h_source.html#l00118">pbx.h:118</a></div></div>
<div class="ttc" id="structast__xmpp__capabilities_html_a641f34a6ff897f49fcdf930758ff69fe"><div class="ttname"><a href="../../da/daa/structast__xmpp__capabilities.html#a641f34a6ff897f49fcdf930758ff69fe">ast_xmpp_capabilities::google</a></div><div class="ttdeci">unsigned int google</div><div class="ttdef"><b>Definition:</b> <a href="../../da/da0/xmpp_8h_source.html#l00088">xmpp.h:88</a></div></div>
<div class="ttc" id="res__xmpp_8c_html_ac5b95f02723021833cc47477b06a962ca78acf22c4ab1b2450bf154c89e82d065"><div class="ttname"><a href="../../dc/d6b/res__xmpp_8c.html#ac5b95f02723021833cc47477b06a962ca78acf22c4ab1b2450bf154c89e82d065">XMPP_PUBSUB_AUTOCREATE</a></div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d6b/res__xmpp_8c_source.html#l00416">res_xmpp.c:416</a></div></div>
<div class="ttc" id="stringfields_8h_html_a51b5729220efb7cda4393ed35ecdfea2"><div class="ttname"><a href="../../d1/d0f/stringfields_8h.html#a51b5729220efb7cda4393ed35ecdfea2">AST_STRING_FIELD</a></div><div class="ttdeci">#define AST_STRING_FIELD(name)</div><div class="ttdoc">Declare a string field. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d0f/stringfields_8h_source.html#l00299">stringfields.h:299</a></div></div>
<div class="ttc" id="res__xmpp_8c_html_a2c4cc886bbbb4ecd8487b33634e68c5b"><div class="ttname"><a href="../../dc/d6b/res__xmpp_8c.html#a2c4cc886bbbb4ecd8487b33634e68c5b">xmpp_client_reconnect</a></div><div class="ttdeci">static int xmpp_client_reconnect(struct ast_xmpp_client *client)</div><div class="ttdoc">Internal function used to reconnect an XMPP client to its server. </div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d6b/res__xmpp_8c_source.html#l03567">res_xmpp.c:3567</a></div></div>
<div class="ttc" id="linkedlists_8h_html_aa8ac496fa9c717d5afb99a02e1e2760c"><div class="ttname"><a href="../../df/d90/linkedlists_8h.html#aa8ac496fa9c717d5afb99a02e1e2760c">AST_LIST_REMOVE_CURRENT</a></div><div class="ttdeci">#define AST_LIST_REMOVE_CURRENT(field)</div><div class="ttdoc">Removes the current entry from a list during a traversal. </div><div class="ttdef"><b>Definition:</b> <a href="../../df/d90/linkedlists_8h_source.html#l00556">linkedlists.h:556</a></div></div>
<div class="ttc" id="astobj2_8h_html_aaca5e8eac39a22f9da1c36fc6c922270"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a></div><div class="ttdeci">#define ao2_ref(o, delta)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l00464">astobj2.h:464</a></div></div>
<div class="ttc" id="astobj2_8h_html_a1f8b41308be4c47de8ff89a3b9c7e7d1a1959468a3c5d6aecd2fa1272d8e30fbf"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#a1f8b41308be4c47de8ff89a3b9c7e7d1a1959468a3c5d6aecd2fa1272d8e30fbf">CMP_MATCH</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l01031">astobj2.h:1031</a></div></div>
<div class="ttc" id="structmansession_html"><div class="ttname"><a href="../../d2/d8a/structmansession.html">mansession</a></div><div class="ttdoc">In case you didn&amp;#39;t read that giant block of text above the mansession_session struct, the struct mansession is named this solely to keep the API the same in Asterisk. This structure really represents data that is different from Manager action to Manager action. The mansession_session pointer contained within points to session-specific data. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d10/manager_8c_source.html#l01625">manager.c:1625</a></div></div>
<div class="ttc" id="res__agi_8c_html_aaaa94f6da87a703160a7acb2fd67422d"><div class="ttname"><a href="../../dd/de9/res__agi_8c.html#aaaa94f6da87a703160a7acb2fd67422d">commands</a></div><div class="ttdeci">static struct agi_command commands[]</div><div class="ttdoc">AGI commands list. </div><div class="ttdef"><b>Definition:</b> <a href="../../dd/de9/res__agi_8c_source.html#l03706">res_agi.c:3706</a></div></div>
<div class="ttc" id="res__xmpp_8c_html_af60b543d7d09cb11f2f9d7d070208ca0"><div class="ttname"><a href="../../dc/d6b/res__xmpp_8c.html#af60b543d7d09cb11f2f9d7d070208ca0">ast_xmpp_client_config_destructor</a></div><div class="ttdeci">static void ast_xmpp_client_config_destructor(void *obj)</div><div class="ttdoc">Destructor function for configuration. </div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d6b/res__xmpp_8c_source.html#l00523">res_xmpp.c:523</a></div></div>
<div class="ttc" id="astobj2_8h_html_aa9fdb5d0a6157a56060d9f7279fe6c49"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#aa9fdb5d0a6157a56060d9f7279fe6c49">ao2_lock</a></div><div class="ttdeci">#define ao2_lock(a)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l00718">astobj2.h:718</a></div></div>
<div class="ttc" id="group__StasisTopicsAndMessages_html_ga4369ae7c984aba22ce6d0e92718f2b29"><div class="ttname"><a href="../../df/deb/group__StasisTopicsAndMessages.html#ga4369ae7c984aba22ce6d0e92718f2b29">ast_mwi_state::old_msgs</a></div><div class="ttdeci">int old_msgs</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d33/mwi_8h_source.html#l00462">mwi.h:462</a></div></div>
<div class="ttc" id="ast__expr2_8c_html_a6a276b85e2da28c5f9c3dbce61c55682"><div class="ttname"><a href="../../d3/dd1/ast__expr2_8c.html#a6a276b85e2da28c5f9c3dbce61c55682">node_type</a></div><div class="ttdeci">node_type</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/dd1/ast__expr2_8c_source.html#l00333">ast_expr2.c:333</a></div></div>
<div class="ttc" id="utils_8h_html_ad60a8c795e1f64b7beeed705425c555f"><div class="ttname"><a href="../../d5/d60/utils_8h.html#ad60a8c795e1f64b7beeed705425c555f">ast_str_to_eid</a></div><div class="ttdeci">int ast_str_to_eid(struct ast_eid *eid, const char *s)</div><div class="ttdoc">Convert a string into an EID. </div><div class="ttdef"><b>Definition:</b> <a href="../../de/d1f/main_2utils_8c_source.html#l02825">main/utils.c:2825</a></div></div>
<div class="ttc" id="res__xmpp_8c_html_a411ba34b877bce9bddd1b289c486aabc"><div class="ttname"><a href="../../dc/d6b/res__xmpp_8c.html#a411ba34b877bce9bddd1b289c486aabc">xmpp_config_alloc</a></div><div class="ttdeci">static void * xmpp_config_alloc(void)</div><div class="ttdoc">Allocator for XMPP configuration. </div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d6b/res__xmpp_8c_source.html#l00718">res_xmpp.c:718</a></div></div>
<div class="ttc" id="astmm_8h_html_ab5f0750cc80ba337fdcbddea2d3a1ee6"><div class="ttname"><a href="../../d8/d8a/astmm_8h.html#ab5f0750cc80ba337fdcbddea2d3a1ee6">ast_strdupa</a></div><div class="ttdeci">#define ast_strdupa(s)</div><div class="ttdoc">duplicate a string in memory from the stack </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d8a/astmm_8h_source.html#l00300">astmm.h:300</a></div></div>
<div class="ttc" id="xmpp_8h_html_ae37d560c438576bdcb47347088225ee6ab1364f19fef96645ce7255d0f65af144"><div class="ttname"><a href="../../da/da0/xmpp_8h.html#ae37d560c438576bdcb47347088225ee6ab1364f19fef96645ce7255d0f65af144">XMPP_STATE_CONNECTING</a></div><div class="ttdef"><b>Definition:</b> <a href="../../da/da0/xmpp_8h_source.html#l00074">xmpp.h:74</a></div></div>
<div class="ttc" id="structast__xmpp__client__config_html_a661785436d89cdd720f15478d92c984b"><div class="ttname"><a href="../../da/d00/structast__xmpp__client__config.html#a661785436d89cdd720f15478d92c984b">ast_xmpp_client_config::user</a></div><div class="ttdeci">const ast_string_field user</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d6b/res__xmpp_8c_source.html#l00456">res_xmpp.c:456</a></div></div>
<div class="ttc" id="structast__xmpp__client__config_html_a9347a33c3d64978bccf502f846c0d854"><div class="ttname"><a href="../../da/d00/structast__xmpp__client__config.html#a9347a33c3d64978bccf502f846c0d854">ast_xmpp_client_config::statusmsg</a></div><div class="ttdeci">const ast_string_field statusmsg</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d6b/res__xmpp_8c_source.html#l00456">res_xmpp.c:456</a></div></div>
<div class="ttc" id="json_8h_html_a6772fcee88746a9d4f6ec6f240b76dd0"><div class="ttname"><a href="../../d4/d05/json_8h.html#a6772fcee88746a9d4f6ec6f240b76dd0">ast_json_string_get</a></div><div class="ttdeci">const char * ast_json_string_get(const struct ast_json *string)</div><div class="ttdoc">Get the value of a JSON string. </div><div class="ttdef"><b>Definition:</b> <a href="../../df/d98/json_8c_source.html#l00273">json.c:273</a></div></div>
<div class="ttc" id="res__xmpp_8c_html_aa3759d2ddcc12f3f5ef5a8a3ffa4a4dfa74ecf707a853e6e98644728f19c98b3f"><div class="ttname"><a href="../../dc/d6b/res__xmpp_8c.html#aa3759d2ddcc12f3f5ef5a8a3ffa4a4dfa74ecf707a853e6e98644728f19c98b3f">XMPP_FORCESSL</a></div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d6b/res__xmpp_8c_source.html#l00405">res_xmpp.c:405</a></div></div>
<div class="ttc" id="structast__variable_html_a8f8f80d37794cde9472343e4487ba3eb"><div class="ttname"><a href="../../dd/d02/structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">ast_variable::name</a></div><div class="ttdeci">const char * name</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/de6/include_2asterisk_2config_8h_source.html#l00085">include/asterisk/config.h:85</a></div></div>
<div class="ttc" id="res__fax_8c_html_a7ea220e4d14b05876af4430e9832ce47"><div class="ttname"><a href="../../d0/d60/res__fax_8c.html#a7ea220e4d14b05876af4430e9832ce47">container</a></div><div class="ttdeci">struct ao2_container * container</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d60/res__fax_8c_source.html#l00502">res_fax.c:502</a></div></div>
<div class="ttc" id="chan__console_8c_html_aa36e3e2c486b920b166c2d17c5242221"><div class="ttname"><a href="../../d3/d4e/chan__console_8c.html#aa36e3e2c486b920b166c2d17c5242221">globals</a></div><div class="ttdeci">static struct console_pvt globals</div></div>
<div class="ttc" id="res__xmpp_8c_html_a085fd2ff3dd46be750522ced5c73e060"><div class="ttname"><a href="../../dc/d6b/res__xmpp_8c.html#a085fd2ff3dd46be750522ced5c73e060">delete_old_messages</a></div><div class="ttdeci">static int delete_old_messages(struct ast_xmpp_client *client, char *from)</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d6b/res__xmpp_8c_source.html#l02095">res_xmpp.c:2095</a></div></div>
<div class="ttc" id="lock_8h_html_aa92ba91898426126bda5aa94a8975ba1"><div class="ttname"><a href="../../dd/d42/lock_8h.html#aa92ba91898426126bda5aa94a8975ba1">ast_cond_broadcast</a></div><div class="ttdeci">#define ast_cond_broadcast(cond)</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d42/lock_8h_source.html#l00202">lock.h:202</a></div></div>
<div class="ttc" id="linkedlists_8h_html_aadfe2a69fbba4f27c201266a2ca5f989"><div class="ttname"><a href="../../df/d90/linkedlists_8h.html#aadfe2a69fbba4f27c201266a2ca5f989">AST_LIST_REMOVE_HEAD</a></div><div class="ttdeci">#define AST_LIST_REMOVE_HEAD(head, field)</div><div class="ttdoc">Removes and returns the head entry from a list. </div><div class="ttdef"><b>Definition:</b> <a href="../../df/d90/linkedlists_8h_source.html#l00832">linkedlists.h:832</a></div></div>
<div class="ttc" id="endpoints_8h_html_a00db6879caf0ce423b5a35b57d01448ea18800ee482eac39e9d235ddd357b9de3"><div class="ttname"><a href="../../d4/d61/endpoints_8h.html#a00db6879caf0ce423b5a35b57d01448ea18800ee482eac39e9d235ddd357b9de3">AST_ENDPOINT_ONLINE</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d61/endpoints_8h_source.html#l00057">endpoints.h:57</a></div></div>
<div class="ttc" id="message_8h_html_a926dc659d6f9d88782e9d0e463ba8c47"><div class="ttname"><a href="../../d2/d0d/message_8h.html#a926dc659d6f9d88782e9d0e463ba8c47">ast_msg_set_var</a></div><div class="ttdeci">int ast_msg_set_var(struct ast_msg *msg, const char *name, const char *value)</div><div class="ttdoc">Set a variable on the message going to the dialplan. </div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d6d/message_8c_source.html#l00615">message.c:615</a></div></div>
<div class="ttc" id="astobj2_8h_html_a2cf7e3433f08351aafe3b0cd31edf7f8a8ccf751bd6749d062999469f0694e7ad"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#a2cf7e3433f08351aafe3b0cd31edf7f8a8ccf751bd6749d062999469f0694e7ad">AO2_ALLOC_OPT_LOCK_MUTEX</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l00365">astobj2.h:365</a></div></div>
<div class="ttc" id="res__xmpp_8c_html_a40875f6b772224b7ea66bd2a3bcdf680"><div class="ttname"><a href="../../dc/d6b/res__xmpp_8c.html#a40875f6b772224b7ea66bd2a3bcdf680">client_options</a></div><div class="ttdeci">struct aco_type * client_options[]</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d6b/res__xmpp_8c_source.html#l00815">res_xmpp.c:815</a></div></div>
<div class="ttc" id="structast__xmpp__client__config_html_a5082987d3e1eac5f625574800bb72c2c"><div class="ttname"><a href="../../da/d00/structast__xmpp__client__config.html#a5082987d3e1eac5f625574800bb72c2c">ast_xmpp_client_config::buddies</a></div><div class="ttdeci">struct ao2_container * buddies</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d6b/res__xmpp_8c_source.html#l00464">res_xmpp.c:464</a></div></div>
<div class="ttc" id="res__xmpp_8c_html_abd1cce3d4d067a7306e5e17dee2876dd"><div class="ttname"><a href="../../dc/d6b/res__xmpp_8c.html#abd1cce3d4d067a7306e5e17dee2876dd">ast_xmpp_client_disconnect</a></div><div class="ttdeci">int ast_xmpp_client_disconnect(struct ast_xmpp_client *client)</div><div class="ttdoc">Disconnect an XMPP client connection. </div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d6b/res__xmpp_8c_source.html#l03528">res_xmpp.c:3528</a></div></div>
<div class="ttc" id="devicestate_8h_html_af72f8a5c0601e4c1f8a852749cd44eeeadee91fc4886ffc7b4efb8459cef48fe2"><div class="ttname"><a href="../../da/da2/devicestate_8h.html#af72f8a5c0601e4c1f8a852749cd44eeeadee91fc4886ffc7b4efb8459cef48fe2">AST_DEVICE_NOT_INUSE</a></div><div class="ttdef"><b>Definition:</b> <a href="../../da/da2/devicestate_8h_source.html#l00054">devicestate.h:54</a></div></div>
<div class="ttc" id="res__xmpp_8c_html_a563e7271ebe6156d3db9f21bfac02db1"><div class="ttname"><a href="../../dc/d6b/res__xmpp_8c.html#a563e7271ebe6156d3db9f21bfac02db1">xmpp_pak_presence</a></div><div class="ttdeci">static int xmpp_pak_presence(struct ast_xmpp_client *client, struct ast_xmpp_client_config *cfg, iks *node, ikspak *pak)</div><div class="ttdoc">Internal function called when a presence message is received. </div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d6b/res__xmpp_8c_source.html#l03266">res_xmpp.c:3266</a></div></div>
<div class="ttc" id="channel_8h_html_a08bde7d8cf72457fc8c519a4443b413b"><div class="ttname"><a href="../../d5/d7b/channel_8h.html#a08bde7d8cf72457fc8c519a4443b413b">ast_autoservice_stop</a></div><div class="ttdeci">int ast_autoservice_stop(struct ast_channel *chan)</div><div class="ttdoc">Stop servicing a channel for us... </div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d66/autoservice_8c_source.html#l00266">autoservice.c:266</a></div></div>
<div class="ttc" id="res__xmpp_8c_html_ae13d4153b0221e790967206a41a9e253"><div class="ttname"><a href="../../dc/d6b/res__xmpp_8c.html#ae13d4153b0221e790967206a41a9e253">xmpp_is_secure</a></div><div class="ttdeci">static int xmpp_is_secure(struct ast_xmpp_client *client)</div><div class="ttdoc">Helper function which returns whether an XMPP client connection is secure or not. ...</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d6b/res__xmpp_8c_source.html#l00866">res_xmpp.c:866</a></div></div>
<div class="ttc" id="structast__xmpp__message_html_ace5ad74ee812bf5ee2bec5d759022d0b"><div class="ttname"><a href="../../d6/d73/structast__xmpp__message.html#ace5ad74ee812bf5ee2bec5d759022d0b">ast_xmpp_message::arrived</a></div><div class="ttdeci">struct timeval arrived</div><div class="ttdef"><b>Definition:</b> <a href="../../da/da0/xmpp_8h_source.html#l00105">xmpp.h:105</a></div></div>
<div class="ttc" id="stasis_8h_html_ae3fe7fe099389094244002113814ec23"><div class="ttname"><a href="../../dd/d79/stasis_8h.html#ae3fe7fe099389094244002113814ec23">stasis_subscribe</a></div><div class="ttdeci">#define stasis_subscribe(topic, callback, data)</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d79/stasis_8h_source.html#l00652">stasis.h:652</a></div></div>
<div class="ttc" id="res__xmpp_8c_html_a96201933819dfe8c2b3b97ee8174f179"><div class="ttname"><a href="../../dc/d6b/res__xmpp_8c.html#a96201933819dfe8c2b3b97ee8174f179">jabberreceive_function</a></div><div class="ttdeci">static struct ast_custom_function jabberreceive_function</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d6b/res__xmpp_8c_source.html#l02082">res_xmpp.c:2082</a></div></div>
<div class="ttc" id="mwi_8h_html_a889083170a9d78ccdbfbcb75406ed98d"><div class="ttname"><a href="../../dc/d33/mwi_8h.html#a889083170a9d78ccdbfbcb75406ed98d">ast_publish_mwi_state_full</a></div><div class="ttdeci">int ast_publish_mwi_state_full(const char *mailbox, const char *context, int new_msgs, int old_msgs, const char *channel_id, struct ast_eid *eid)</div><div class="ttdoc">Publish a MWI state update via stasis with all parameters. </div><div class="ttdef"><b>Definition:</b> <a href="../../d6/db4/mwi_8c_source.html#l00388">mwi.c:388</a></div></div>
<div class="ttc" id="config__options_8h_html_a3b4f259d48ef20f47171b73078282d75a832b5997265d8870481f9684cbca5792"><div class="ttname"><a href="../../db/dfe/config__options_8h.html#a3b4f259d48ef20f47171b73078282d75a832b5997265d8870481f9684cbca5792">ACO_PROCESS_ERROR</a></div><div class="ttdoc">Their was an error and no changes were applied. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/dfe/config__options_8h_source.html#l00527">config_options.h:527</a></div></div>
<div class="ttc" id="xmpp_8h_html_a88ace060762475a37823dd4bc7b3076f"><div class="ttname"><a href="../../da/da0/xmpp_8h.html#a88ace060762475a37823dd4bc7b3076f">XMPP_MAX_JIDLEN</a></div><div class="ttdeci">#define XMPP_MAX_JIDLEN</div><div class="ttdef"><b>Definition:</b> <a href="../../da/da0/xmpp_8h_source.html#l00062">xmpp.h:62</a></div></div>
<div class="ttc" id="res__xmpp_8c_html_a75b0b81d9879c0094f99cb284ae9d178"><div class="ttname"><a href="../../dc/d6b/res__xmpp_8c.html#a75b0b81d9879c0094f99cb284ae9d178">xmpp_cli</a></div><div class="ttdeci">static struct ast_cli_entry xmpp_cli[]</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d6b/res__xmpp_8c_source.html#l04474">res_xmpp.c:4474</a></div></div>
<div class="ttc" id="utils_8h_html_af35c6f780502c691f0ae35e1d0f7a444"><div class="ttname"><a href="../../d5/d60/utils_8h.html#af35c6f780502c691f0ae35e1d0f7a444">ast_sha1_hash</a></div><div class="ttdeci">void ast_sha1_hash(char *output, const char *input)</div><div class="ttdoc">Produces SHA1 hash based on input string. </div><div class="ttdef"><b>Definition:</b> <a href="../../de/d1f/main_2utils_8c_source.html#l00264">main/utils.c:264</a></div></div>
<div class="ttc" id="res__xmpp_8c_html_a0da763b62c39978974a34ec56044a9db"><div class="ttname"><a href="../../dc/d6b/res__xmpp_8c.html#a0da763b62c39978974a34ec56044a9db">xmpp_resource_immediate</a></div><div class="ttdeci">static int xmpp_resource_immediate(void *obj, void *arg, int flags)</div><div class="ttdoc">Internal astobj2 callback function which returns the first resource, which is the highest priority on...</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d6b/res__xmpp_8c_source.html#l01627">res_xmpp.c:1627</a></div></div>
<div class="ttc" id="structast__cli__args_html_ad0a19c4d63698f9e9cfd5653e8851452"><div class="ttname"><a href="../../d3/dad/structast__cli__args.html#ad0a19c4d63698f9e9cfd5653e8851452">ast_cli_args::argv</a></div><div class="ttdeci">const char *const  * argv</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/db0/cli_8h_source.html#l00161">cli.h:161</a></div></div>
<div class="ttc" id="res__xmpp_8c_html_af0a9d049fc6d63f0491bb5e5ef5f040b"><div class="ttname"><a href="../../dc/d6b/res__xmpp_8c.html#af0a9d049fc6d63f0491bb5e5ef5f040b">acf_jabberreceive_read</a></div><div class="ttdeci">static int acf_jabberreceive_read(struct ast_channel *chan, const char *name, char *data, char *buf, size_t buflen)</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d6b/res__xmpp_8c_source.html#l01936">res_xmpp.c:1936</a></div></div>
<div class="ttc" id="res__xmpp_8c_html_a3fd85bbc5a1a08d890b80d317ada622b"><div class="ttname"><a href="../../dc/d6b/res__xmpp_8c.html#a3fd85bbc5a1a08d890b80d317ada622b">xmpp_client_send_raw_message</a></div><div class="ttdeci">static int xmpp_client_send_raw_message(struct ast_xmpp_client *client, const char *message)</div><div class="ttdoc">Internal function which sends a raw message. </div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d6b/res__xmpp_8c_source.html#l02492">res_xmpp.c:2492</a></div></div>
<div class="ttc" id="devicestate_8h_html_a6190de57ac370315e51f2c46724d5b10"><div class="ttname"><a href="../../da/da2/devicestate_8h.html#a6190de57ac370315e51f2c46724d5b10">ast_devstate_str</a></div><div class="ttdeci">const char * ast_devstate_str(enum ast_device_state devstate) attribute_pure</div><div class="ttdoc">Convert device state to text string that is easier to parse. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d80/devicestate_8c_source.html#l00255">devicestate.c:255</a></div></div>
<div class="ttc" id="message_8h_html_adcb3fd70677c50be8626deec545a42c1"><div class="ttname"><a href="../../d2/d0d/message_8h.html#adcb3fd70677c50be8626deec545a42c1">ast_msg_queue</a></div><div class="ttdeci">int ast_msg_queue(struct ast_msg *msg)</div><div class="ttdoc">Queue a message for routing through the dialplan. </div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d6d/message_8c_source.html#l00958">message.c:958</a></div></div>
<div class="ttc" id="endpoints_8h_html_a00db6879caf0ce423b5a35b57d01448ea0c201502490a90f732b9946dc7545114"><div class="ttname"><a href="../../d4/d61/endpoints_8h.html#a00db6879caf0ce423b5a35b57d01448ea0c201502490a90f732b9946dc7545114">AST_ENDPOINT_OFFLINE</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d61/endpoints_8h_source.html#l00055">endpoints.h:55</a></div></div>
<div class="ttc" id="group__Group__AMI_html_gafadf012f66a9fd7ecf985ec5b9dee101"><div class="ttname"><a href="../../df/d72/group__Group__AMI.html#gafadf012f66a9fd7ecf985ec5b9dee101">ast_manager_unregister</a></div><div class="ttdeci">int ast_manager_unregister(const char *action)</div><div class="ttdoc">Unregister a registered manager command. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d10/manager_8c_source.html#l07258">manager.c:7258</a></div></div>
<div class="ttc" id="manager_8h_html"><div class="ttname"><a href="../../db/d45/manager_8h.html">manager.h</a></div><div class="ttdoc">The AMI - Asterisk Manager Interface - is a TCP protocol created to manage Asterisk with third-party ...</div></div>
<div class="ttc" id="res__xmpp_8c_html_ab81f77a88ce40a22216d745dbeb9c3be"><div class="ttname"><a href="../../dc/d6b/res__xmpp_8c.html#ab81f77a88ce40a22216d745dbeb9c3be">xmpp_pubsub_build_node_request</a></div><div class="ttdeci">static iks * xmpp_pubsub_build_node_request(struct ast_xmpp_client *client, const char *collection)</div><div class="ttdoc">Build the a node request. </div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d6b/res__xmpp_8c_source.html#l03977">res_xmpp.c:3977</a></div></div>
<div class="ttc" id="structast__xmpp__client__config_html_ace9168767fc3707cf5f0a7d049682ba3"><div class="ttname"><a href="../../da/d00/structast__xmpp__client__config.html#ace9168767fc3707cf5f0a7d049682ba3">ast_xmpp_client_config::name</a></div><div class="ttdeci">const ast_string_field name</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d6b/res__xmpp_8c_source.html#l00456">res_xmpp.c:456</a></div></div>
<div class="ttc" id="structast__xmpp__buddy_html_a351d3567e908210c9fa479c52eafb95a"><div class="ttname"><a href="../../d5/d25/structast__xmpp__buddy.html#a351d3567e908210c9fa479c52eafb95a">ast_xmpp_buddy::subscribe</a></div><div class="ttdeci">unsigned int subscribe</div><div class="ttdef"><b>Definition:</b> <a href="../../da/da0/xmpp_8h_source.html#l00115">xmpp.h:115</a></div></div>
<div class="ttc" id="structast__xmpp__resource_html"><div class="ttname"><a href="../../d6/d90/structast__xmpp__resource.html">ast_xmpp_resource</a></div><div class="ttdoc">XMPP Resource. </div><div class="ttdef"><b>Definition:</b> <a href="../../da/da0/xmpp_8h_source.html#l00092">xmpp.h:92</a></div></div>
<div class="ttc" id="config__options_8h_html"><div class="ttname"><a href="../../db/dfe/config__options_8h.html">config_options.h</a></div><div class="ttdoc">Configuration option-handling. </div></div>
<div class="ttc" id="res__xmpp_8c_html_a46e9779a8a2096c9837d9e04943b5613"><div class="ttname"><a href="../../dc/d6b/res__xmpp_8c.html#a46e9779a8a2096c9837d9e04943b5613">client_bitfield_handler</a></div><div class="ttdeci">static int client_bitfield_handler(const struct aco_option *opt, struct ast_variable *var, void *obj)</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d6b/res__xmpp_8c_source.html#l04529">res_xmpp.c:4529</a></div></div>
<div class="ttc" id="devicestate_8h_html_afe9dc809c9ea4d32dfb4abd5fd92dfb2"><div class="ttname"><a href="../../da/da2/devicestate_8h.html#afe9dc809c9ea4d32dfb4abd5fd92dfb2">ast_publish_device_state_full</a></div><div class="ttdeci">int ast_publish_device_state_full(const char *device, enum ast_device_state state, enum ast_devstate_cache cachable, struct ast_eid *eid)</div><div class="ttdoc">Publish a device state update with EID. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d80/devicestate_8c_source.html#l00709">devicestate.c:709</a></div></div>
<div class="ttc" id="structast__xmpp__client_html_ab9a9b889912b9b0d0ff5199a408f29df"><div class="ttname"><a href="../../df/d42/structast__xmpp__client.html#ab9a9b889912b9b0d0ff5199a408f29df">ast_xmpp_client::ssl_method</a></div><div class="ttdeci">const SSL_METHOD * ssl_method</div><div class="ttdef"><b>Definition:</b> <a href="../../da/da0/xmpp_8h_source.html#l00133">xmpp.h:133</a></div></div>
<div class="ttc" id="logger_8h_html_aced66975c154ea0e2a8ec3bc818b4e08"><div class="ttname"><a href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a></div><div class="ttdeci">#define LOG_ERROR</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d8c/logger_8h_source.html#l00285">logger.h:285</a></div></div>
<div class="ttc" id="structast__xmpp__message_html_a0b2e8c7f76df48129f994ecc46d5c66c"><div class="ttname"><a href="../../d6/d73/structast__xmpp__message.html#a0b2e8c7f76df48129f994ecc46d5c66c">ast_xmpp_message::message</a></div><div class="ttdeci">char * message</div><div class="ttdef"><b>Definition:</b> <a href="../../da/da0/xmpp_8h_source.html#l00103">xmpp.h:103</a></div></div>
<div class="ttc" id="astobj2_8h_html_aefc16f8aa9087cbc5c55c70cf1dd41b2"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#aefc16f8aa9087cbc5c55c70cf1dd41b2">ao2_container_alloc_hash</a></div><div class="ttdeci">#define ao2_container_alloc_hash(ao2_options, container_options, n_buckets, hash_fn, sort_fn, cmp_fn)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l01310">astobj2.h:1310</a></div></div>
<div class="ttc" id="devicestate_8h_html_a52892d3b3fec63dbcf67954d8c3589d5"><div class="ttname"><a href="../../da/da2/devicestate_8h.html#a52892d3b3fec63dbcf67954d8c3589d5">ast_device_state_cache</a></div><div class="ttdeci">struct stasis_cache * ast_device_state_cache(void)</div><div class="ttdoc">Backend cache for ast_device_state_topic_cached() </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d80/devicestate_8c_source.html#l00673">devicestate.c:673</a></div></div>
<div class="ttc" id="strings_8h_html_a387a69b3871ca31061566a73f45d20f4"><div class="ttname"><a href="../../d6/d90/strings_8h.html#a387a69b3871ca31061566a73f45d20f4">ast_true</a></div><div class="ttdeci">int attribute_pure ast_true(const char *val)</div><div class="ttdoc">Make sure something is true. Determine if a string containing a boolean value is &quot;true&quot;. This function checks to see whether a string passed to it is an indication of an &quot;true&quot; value. It checks to see if the string is &quot;yes&quot;, &quot;true&quot;, &quot;y&quot;, &quot;t&quot;, &quot;on&quot; or &quot;1&quot;. </div><div class="ttdef"><b>Definition:</b> <a href="../../de/d1f/main_2utils_8c_source.html#l01951">main/utils.c:1951</a></div></div>
<div class="ttc" id="structast__xmpp__message_html"><div class="ttname"><a href="../../d6/d73/structast__xmpp__message.html">ast_xmpp_message</a></div><div class="ttdoc">XMPP Message. </div><div class="ttdef"><b>Definition:</b> <a href="../../da/da0/xmpp_8h_source.html#l00101">xmpp.h:101</a></div></div>
<div class="ttc" id="res__xmpp_8c_html_ada34a179b875baddf7e8be5f31f09666"><div class="ttname"><a href="../../dc/d6b/res__xmpp_8c.html#ada34a179b875baddf7e8be5f31f09666">xmpp_pubsub_create_affiliations</a></div><div class="ttdeci">static void xmpp_pubsub_create_affiliations(struct ast_xmpp_client *client, const char *node)</div><div class="ttdoc">Add Owner affiliations for pubsub node. </div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d6b/res__xmpp_8c_source.html#l01156">res_xmpp.c:1156</a></div></div>
<div class="ttc" id="res__xmpp_8c_html_aa3759d2ddcc12f3f5ef5a8a3ffa4a4dfa56b0aacbe6240e563e08310d1b6c8ce2"><div class="ttname"><a href="../../dc/d6b/res__xmpp_8c.html#aa3759d2ddcc12f3f5ef5a8a3ffa4a4dfa56b0aacbe6240e563e08310d1b6c8ce2">XMPP_AUTOPRUNE</a></div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d6b/res__xmpp_8c_source.html#l00399">res_xmpp.c:399</a></div></div>
<div class="ttc" id="utils_8h_html_a555dad1bd5b23acf01cf08f1affab879"><div class="ttname"><a href="../../d5/d60/utils_8h.html#a555dad1bd5b23acf01cf08f1affab879">ast_base64encode</a></div><div class="ttdeci">int ast_base64encode(char *dst, const unsigned char *src, int srclen, int max)</div><div class="ttdoc">Encode data in base64. </div><div class="ttdef"><b>Definition:</b> <a href="../../de/d1f/main_2utils_8c_source.html#l00404">main/utils.c:404</a></div></div>
<div class="ttc" id="res__xmpp_8c_html_ac3382bf6da54c56b37069bd76bbdf4f9"><div class="ttname"><a href="../../dc/d6b/res__xmpp_8c.html#ac3382bf6da54c56b37069bd76bbdf4f9">load_module</a></div><div class="ttdeci">static int load_module(void)</div><div class="ttdoc">Load the module. </div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d6b/res__xmpp_8c_source.html#l04623">res_xmpp.c:4623</a></div></div>
<div class="ttc" id="structxmpp__pak__handler_html"><div class="ttname"><a href="../../d9/da1/structxmpp__pak__handler.html">xmpp_pak_handler</a></div><div class="ttdoc">Defined handlers for different PAK types. </div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d6b/res__xmpp_8c_source.html#l00501">res_xmpp.c:501</a></div></div>
<div class="ttc" id="res__xmpp_8c_html_a75acdd980d5df2f98aa014607e773167"><div class="ttname"><a href="../../dc/d6b/res__xmpp_8c.html#a75acdd980d5df2f98aa014607e773167">app_ajisend</a></div><div class="ttdeci">static const char * app_ajisend</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d6b/res__xmpp_8c_source.html#l00510">res_xmpp.c:510</a></div></div>
<div class="ttc" id="res__xmpp_8c_html_a244b9b274ea2f4f90ff95a60fc7935f5"><div class="ttname"><a href="../../dc/d6b/res__xmpp_8c.html#a244b9b274ea2f4f90ff95a60fc7935f5">xmpp_pubsub_build_publish_skeleton</a></div><div class="ttdeci">static iks * xmpp_pubsub_build_publish_skeleton(struct ast_xmpp_client *client, const char *node, const char *event_type, unsigned int cachable)</div><div class="ttdoc">Build the skeleton of a publish. </div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d6b/res__xmpp_8c_source.html#l01071">res_xmpp.c:1071</a></div></div>
<div class="ttc" id="res__xmpp_8c_html_aa2256c5ac61afb7f66a1f717a58c39f5"><div class="ttname"><a href="../../dc/d6b/res__xmpp_8c.html#aa2256c5ac61afb7f66a1f717a58c39f5">xmpp_pubsub_receive_node_list</a></div><div class="ttdeci">static int xmpp_pubsub_receive_node_list(void *data, ikspak *pak)</div><div class="ttdoc">Receive pubsub item lists. </div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d6b/res__xmpp_8c_source.html#l04001">res_xmpp.c:4001</a></div></div>
<div class="ttc" id="cli_8h_html_a0873456096960dab21fff0ce68c95acb"><div class="ttname"><a href="../../dc/db0/cli_8h.html#a0873456096960dab21fff0ce68c95acb">CLI_SHOWUSAGE</a></div><div class="ttdeci">#define CLI_SHOWUSAGE</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/db0/cli_8h_source.html#l00045">cli.h:45</a></div></div>
<div class="ttc" id="message_8h_html_a8a1ffcfecf1ffbc22c526796cdf954a7"><div class="ttname"><a href="../../d2/d0d/message_8h.html#a8a1ffcfecf1ffbc22c526796cdf954a7">ast_msg_tech_unregister</a></div><div class="ttdeci">int ast_msg_tech_unregister(const struct ast_msg_tech *tech)</div><div class="ttdoc">Unregister a message technology. </div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d6d/message_8c_source.html#l01610">message.c:1610</a></div></div>
<div class="ttc" id="res__xmpp_8c_html_af8aef0634532b054dc2369c7dfe185e2"><div class="ttname"><a href="../../dc/d6b/res__xmpp_8c.html#af8aef0634532b054dc2369c7dfe185e2">xmpp_buddy_hash</a></div><div class="ttdeci">static int xmpp_buddy_hash(const void *obj, const int flags)</div><div class="ttdoc">Hashing function for XMPP buddy. </div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d6b/res__xmpp_8c_source.html#l00572">res_xmpp.c:572</a></div></div>
<div class="ttc" id="res__xmpp_8c_html_abe0bf7c227d40c258b694eef9b7f7333"><div class="ttname"><a href="../../dc/d6b/res__xmpp_8c.html#abe0bf7c227d40c258b694eef9b7f7333">xmpp_message_destroy</a></div><div class="ttdeci">static void xmpp_message_destroy(struct ast_xmpp_message *message)</div><div class="ttdoc">Destroy function for XMPP messages. </div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d6b/res__xmpp_8c_source.html#l00532">res_xmpp.c:532</a></div></div>
<div class="ttc" id="stasis_8h_html_af6081f17431b81bc1a010b680517491d"><div class="ttname"><a href="../../dd/d79/stasis_8h.html#af6081f17431b81bc1a010b680517491d">stasis_message_data</a></div><div class="ttdeci">void * stasis_message_data(const struct stasis_message *msg)</div><div class="ttdoc">Get the data contained in a message. </div><div class="ttdef"><b>Definition:</b> <a href="../../d2/db9/stasis__message_8c_source.html#l00195">stasis_message.c:195</a></div></div>
<div class="ttc" id="config__options_8h_html_a21b11339ca4d0b1167c956a9f816bd19"><div class="ttname"><a href="../../db/dfe/config__options_8h.html#a21b11339ca4d0b1167c956a9f816bd19">aco_info_destroy</a></div><div class="ttdeci">void aco_info_destroy(struct aco_info *info)</div><div class="ttdoc">Destroy an initialized aco_info struct. </div><div class="ttdef"><b>Definition:</b> <a href="../../d6/dc8/config__options_8c_source.html#l00910">config_options.c:910</a></div></div>
<div class="ttc" id="structast__xmpp__client__config_html_afcb76ae4daf94120b9c6e8e3a8926e36"><div class="ttname"><a href="../../da/d00/structast__xmpp__client__config.html#afcb76ae4daf94120b9c6e8e3a8926e36">ast_xmpp_client_config::message_timeout</a></div><div class="ttdeci">int message_timeout</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d6b/res__xmpp_8c_source.html#l00458">res_xmpp.c:458</a></div></div>
<div class="ttc" id="res__xmpp_8c_html_aa3759d2ddcc12f3f5ef5a8a3ffa4a4dfac4a9cd4f07050cadcb19c07c6d3bf30f"><div class="ttname"><a href="../../dc/d6b/res__xmpp_8c.html#aa3759d2ddcc12f3f5ef5a8a3ffa4a4dfac4a9cd4f07050cadcb19c07c6d3bf30f">XMPP_KEEPALIVE</a></div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d6b/res__xmpp_8c_source.html#l00406">res_xmpp.c:406</a></div></div>
<div class="ttc" id="res__xmpp_8c_html_acfeca2f192278988482711d67605556c"><div class="ttname"><a href="../../dc/d6b/res__xmpp_8c.html#acfeca2f192278988482711d67605556c">xmpp_config_destructor</a></div><div class="ttdeci">static void xmpp_config_destructor(void *obj)</div><div class="ttdoc">Destructor for XMPP configuration. </div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d6b/res__xmpp_8c_source.html#l00702">res_xmpp.c:702</a></div></div>
<div class="ttc" id="astobj2_8h_html_ac0e1cbc7cf050c8b7b8e3a8fee92c50e"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#ac0e1cbc7cf050c8b7b8e3a8fee92c50e">ao2_global_obj_release</a></div><div class="ttdeci">#define ao2_global_obj_release(holder)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l00865">astobj2.h:865</a></div></div>
<div class="ttc" id="res__xmpp_8c_html_aa8cee821cbda619ece4c14df1d7ea43c"><div class="ttname"><a href="../../dc/d6b/res__xmpp_8c.html#aa8cee821cbda619ece4c14df1d7ea43c">xmpp_ping_request</a></div><div class="ttdeci">static int xmpp_ping_request(struct ast_xmpp_client *client, const char *to, const char *from)</div><div class="ttdoc">Helper function which sends a ping request to a server. </div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d6b/res__xmpp_8c_source.html#l03232">res_xmpp.c:3232</a></div></div>
<div class="ttc" id="structast__xmpp__client_html_a0e1ad9bdec3a82e1fec4aed829cfa2a6"><div class="ttname"><a href="../../df/d42/structast__xmpp__client.html#a0e1ad9bdec3a82e1fec4aed829cfa2a6">ast_xmpp_client::state</a></div><div class="ttdeci">enum xmpp_state state</div><div class="ttdef"><b>Definition:</b> <a href="../../da/da0/xmpp_8h_source.html#l00136">xmpp.h:136</a></div></div>
<div class="ttc" id="structast__xmpp__client__config_html_a83bf6907a1184b56931bf86ff744279e"><div class="ttname"><a href="../../da/d00/structast__xmpp__client__config.html#a83bf6907a1184b56931bf86ff744279e">ast_xmpp_client_config::client</a></div><div class="ttdeci">struct ast_xmpp_client * client</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d6b/res__xmpp_8c_source.html#l00463">res_xmpp.c:463</a></div></div>
<div class="ttc" id="structast__xmpp__capabilities_html_ab5fb18e79b717e6ee434115344b6258f"><div class="ttname"><a href="../../da/daa/structast__xmpp__capabilities.html#ab5fb18e79b717e6ee434115344b6258f">ast_xmpp_capabilities::jingle</a></div><div class="ttdeci">unsigned int jingle</div><div class="ttdef"><b>Definition:</b> <a href="../../da/da0/xmpp_8h_source.html#l00087">xmpp.h:87</a></div></div>
<div class="ttc" id="include_2asterisk_2app_8h_html_accfcb380df76a64251d88ef49c2dd4e3"><div class="ttname"><a href="../../d3/d93/include_2asterisk_2app_8h.html#accfcb380df76a64251d88ef49c2dd4e3">AST_NONSTANDARD_APP_ARGS</a></div><div class="ttdeci">#define AST_NONSTANDARD_APP_ARGS(args, parse, sep)</div><div class="ttdoc">Performs the &amp;#39;nonstandard&amp;#39; argument separation process for an application. </div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d93/include_2asterisk_2app_8h_source.html#l01300">include/asterisk/app.h:1300</a></div></div>
<div class="ttc" id="res__xmpp_8c_html_aead014b9851763645f1f68598fee3623"><div class="ttname"><a href="../../dc/d6b/res__xmpp_8c.html#aead014b9851763645f1f68598fee3623">xmpp_config_cmp</a></div><div class="ttdeci">static int xmpp_config_cmp(void *obj, void *arg, int flags)</div><div class="ttdoc">Comparator function for configuration. </div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d6b/res__xmpp_8c_source.html#l00710">res_xmpp.c:710</a></div></div>
<div class="ttc" id="res__xmpp_8c_html_a2f3d4b03f949f57841694200618c8c66"><div class="ttname"><a href="../../dc/d6b/res__xmpp_8c.html#a2f3d4b03f949f57841694200618c8c66">xmpp_send_stream_header</a></div><div class="ttdeci">static int xmpp_send_stream_header(struct ast_xmpp_client *client, const struct ast_xmpp_client_config *cfg, const char *to)</div><div class="ttdoc">Helper function which sends an XMPP stream header to the server. </div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d6b/res__xmpp_8c_source.html#l02525">res_xmpp.c:2525</a></div></div>
<div class="ttc" id="manager_8h_html_acc12c2bc03dce67ddd1590d67ab11f4d"><div class="ttname"><a href="../../db/d45/manager_8h.html#acc12c2bc03dce67ddd1590d67ab11f4d">EVENT_FLAG_USER</a></div><div class="ttdeci">#define EVENT_FLAG_USER</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d45/manager_8h_source.html#l00077">manager.h:77</a></div></div>
<div class="ttc" id="func__strings_8c_html_af24e73aaf92f3000fda15d285e66df24"><div class="ttname"><a href="../../d9/d1e/func__strings_8c.html#af24e73aaf92f3000fda15d285e66df24">len</a></div><div class="ttdeci">static int len(struct ast_channel *chan, const char *cmd, char *data, char *buf, size_t buflen)</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d1e/func__strings_8c_source.html#l01344">func_strings.c:1344</a></div></div>
<div class="ttc" id="structast__xmpp__client_html_a242fce88f9c9954695b13f7af1d415a9"><div class="ttname"><a href="../../df/d42/structast__xmpp__client.html#a242fce88f9c9954695b13f7af1d415a9">ast_xmpp_client::filter</a></div><div class="ttdeci">iksfilter * filter</div><div class="ttdef"><b>Definition:</b> <a href="../../da/da0/xmpp_8h_source.html#l00128">xmpp.h:128</a></div></div>
<div class="ttc" id="res__xmpp_8c_html_aff0f221b95d8bd4a8f211c5afa3e312f"><div class="ttname"><a href="../../dc/d6b/res__xmpp_8c.html#aff0f221b95d8bd4a8f211c5afa3e312f">xmpp_pubsub_publish_mwi</a></div><div class="ttdeci">static void xmpp_pubsub_publish_mwi(struct ast_xmpp_client *client, const char *mailbox, const char *oldmsgs, const char *newmsgs)</div><div class="ttdoc">Publish MWI to a PubSub node. </div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d6b/res__xmpp_8c_source.html#l01269">res_xmpp.c:1269</a></div></div>
<div class="ttc" id="structast__xmpp__capabilities_html_a039f1dc229c7bd812108a7e8f54249e5"><div class="ttname"><a href="../../da/daa/structast__xmpp__capabilities.html#a039f1dc229c7bd812108a7e8f54249e5">ast_xmpp_capabilities::version</a></div><div class="ttdeci">char version[50]</div><div class="ttdef"><b>Definition:</b> <a href="../../da/da0/xmpp_8h_source.html#l00086">xmpp.h:86</a></div></div>
<div class="ttc" id="stasis_8h_html_a597f7a30fe616c9f083a93ed168955ed"><div class="ttname"><a href="../../dd/d79/stasis_8h.html#a597f7a30fe616c9f083a93ed168955ed">stasis_subscribe_pool</a></div><div class="ttdeci">#define stasis_subscribe_pool(topic, callback, data)</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d79/stasis_8h_source.html#l00682">stasis.h:682</a></div></div>
<div class="ttc" id="time_8h_html_a97e1bb8fbd7a103212789e87e7ed6073"><div class="ttname"><a href="../../de/df7/time_8h.html#a97e1bb8fbd7a103212789e87e7ed6073">ast_tvadd</a></div><div class="ttdeci">struct timeval ast_tvadd(struct timeval a, struct timeval b)</div><div class="ttdoc">Returns the sum of two timevals a + b. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/dc5/extconf_8c_source.html#l02283">extconf.c:2283</a></div></div>
<div class="ttc" id="res__xmpp_8c_html_aaff8533a174033f88941d1e57aea183d"><div class="ttname"><a href="../../dc/d6b/res__xmpp_8c.html#aaff8533a174033f88941d1e57aea183d">client_option</a></div><div class="ttdeci">static struct aco_type client_option</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d6b/res__xmpp_8c_source.html#l00804">res_xmpp.c:804</a></div></div>
<div class="ttc" id="structast__msg__tech_html"><div class="ttname"><a href="../../df/dfc/structast__msg__tech.html">ast_msg_tech</a></div><div class="ttdoc">A message technology. </div><div class="ttdef"><b>Definition:</b> <a href="../../d2/d0d/message_8h_source.html#l00052">message.h:52</a></div></div>
<div class="ttc" id="res__xmpp_8c_html_aa3759d2ddcc12f3f5ef5a8a3ffa4a4dfadc3efad94dcc216c29d42b23edcb2d00"><div class="ttname"><a href="../../dc/d6b/res__xmpp_8c.html#aa3759d2ddcc12f3f5ef5a8a3ffa4a4dfadc3efad94dcc216c29d42b23edcb2d00">XMPP_COMPONENT</a></div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d6b/res__xmpp_8c_source.html#l00407">res_xmpp.c:407</a></div></div>
<div class="ttc" id="stasis_8h_html_a3498301077e2005383f0d261c471388b"><div class="ttname"><a href="../../dd/d79/stasis_8h.html#a3498301077e2005383f0d261c471388b">stasis_unsubscribe</a></div><div class="ttdeci">struct stasis_subscription * stasis_unsubscribe(struct stasis_subscription *subscription)</div><div class="ttdoc">Cancel a subscription. </div><div class="ttdef"><b>Definition:</b> <a href="../../d0/df4/stasis_8c_source.html#l00973">stasis.c:973</a></div></div>
<div class="ttc" id="astobj2_8h_html_a17990ea630db7dbd1252ef0132133a2b"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#a17990ea630db7dbd1252ef0132133a2b">ao2_iterator_next</a></div><div class="ttdeci">#define ao2_iterator_next(iter)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l01933">astobj2.h:1933</a></div></div>
<div class="ttc" id="lock_8h_html_a1ea2f4040a736cddbecea48b30ffedfd"><div class="ttname"><a href="../../dd/d42/lock_8h.html#a1ea2f4040a736cddbecea48b30ffedfd">ast_cond_destroy</a></div><div class="ttdeci">#define ast_cond_destroy(cond)</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d42/lock_8h_source.html#l00200">lock.h:200</a></div></div>
<div class="ttc" id="structast__xmpp__client__config_html_a7faec841658b88ad0cfbc684853acad3"><div class="ttname"><a href="../../da/d00/structast__xmpp__client__config.html#a7faec841658b88ad0cfbc684853acad3">ast_xmpp_client_config::context</a></div><div class="ttdeci">const ast_string_field context</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d6b/res__xmpp_8c_source.html#l00456">res_xmpp.c:456</a></div></div>
<div class="ttc" id="astobj2_8h_html_ae0422b60d8e25b6962b2d61ae4ddf724"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#ae0422b60d8e25b6962b2d61ae4ddf724">ao2_alloc</a></div><div class="ttdeci">#define ao2_alloc(data_size, destructor_fn)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l00411">astobj2.h:411</a></div></div>
<div class="ttc" id="structxmpp__state__handler_html_a3c56304946202b57877d2c12f3ad491a"><div class="ttname"><a href="../../dc/d18/structxmpp__state__handler.html#a3c56304946202b57877d2c12f3ad491a">xmpp_state_handler::component</a></div><div class="ttdeci">int component</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d6b/res__xmpp_8c_source.html#l00485">res_xmpp.c:485</a></div></div>
<div class="ttc" id="logger_8h_html_ad89ee324d180cdcd7defcc709ff9ca42"><div class="ttname"><a href="../../d1/d8c/logger_8h.html#ad89ee324d180cdcd7defcc709ff9ca42">LOG_NOTICE</a></div><div class="ttdeci">#define LOG_NOTICE</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d8c/logger_8h_source.html#l00263">logger.h:263</a></div></div>
<div class="ttc" id="devicestate_8h_html_a9fa7376e8e627cf5a512209005692013"><div class="ttname"><a href="../../da/da2/devicestate_8h.html#a9fa7376e8e627cf5a512209005692013">ast_device_state_topic_all</a></div><div class="ttdeci">struct stasis_topic * ast_device_state_topic_all(void)</div><div class="ttdoc">Get the Stasis topic for device state messages. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d80/devicestate_8c_source.html#l00668">devicestate.c:668</a></div></div>
<div class="ttc" id="linkedlists_8h_html_aa2ded2af046bb513f77056c27c083307"><div class="ttname"><a href="../../df/d90/linkedlists_8h.html#aa2ded2af046bb513f77056c27c083307">AST_LIST_INSERT_HEAD</a></div><div class="ttdeci">#define AST_LIST_INSERT_HEAD(head, elm, field)</div><div class="ttdoc">Inserts a list entry at the head of a list. </div><div class="ttdef"><b>Definition:</b> <a href="../../df/d90/linkedlists_8h_source.html#l00710">linkedlists.h:710</a></div></div>
<div class="ttc" id="res__xmpp_8c_html_aca3aa26e115851782ebae0ba598728e0"><div class="ttname"><a href="../../dc/d6b/res__xmpp_8c.html#aca3aa26e115851782ebae0ba598728e0">xmpp_pubsub_create_node</a></div><div class="ttdeci">static void xmpp_pubsub_create_node(struct ast_xmpp_client *client, const char *node_type, const char *name, const char *collection_name)</div><div class="ttdoc">Create a pubsub node. </div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d6b/res__xmpp_8c_source.html#l01194">res_xmpp.c:1194</a></div></div>
<div class="ttc" id="chan__ooh323_8c_html_a81b4b1c3c855fb371e7723b473f1ee78"><div class="ttname"><a href="../../d7/d49/chan__ooh323_8c.html#a81b4b1c3c855fb371e7723b473f1ee78">version</a></div><div class="ttdeci">static char version[AST_MAX_EXTENSION]</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d49/chan__ooh323_8c_source.html#l00391">chan_ooh323.c:391</a></div></div>
<div class="ttc" id="cli_8h_html_ae47751901c430ebb833e59291a5e0b3f"><div class="ttname"><a href="../../dc/db0/cli_8h.html#ae47751901c430ebb833e59291a5e0b3f">CLI_FAILURE</a></div><div class="ttdeci">#define CLI_FAILURE</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/db0/cli_8h_source.html#l00046">cli.h:46</a></div></div>
<div class="ttc" id="chan__mgcp_8c_html_a2e006acff60d9b3d65d7d60f975d6747"><div class="ttname"><a href="../../d0/dd6/chan__mgcp_8c.html#a2e006acff60d9b3d65d7d60f975d6747">parse</a></div><div class="ttdeci">static void parse(struct mgcp_request *req)</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/dd6/chan__mgcp_8c_source.html#l01872">chan_mgcp.c:1872</a></div></div>
<div class="ttc" id="res__xmpp_8c_html_af02607d0a966e73d05d4934a806e79a6"><div class="ttname"><a href="../../dc/d6b/res__xmpp_8c.html#af02607d0a966e73d05d4934a806e79a6">xmpp_log_hook</a></div><div class="ttdeci">static void xmpp_log_hook(void *data, const char *xmpp, size_t size, int incoming)</div><div class="ttdoc">Logging hook function. </div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d6b/res__xmpp_8c_source.html#l02474">res_xmpp.c:2474</a></div></div>
<div class="ttc" id="cdr__mysql_8c_html_a0980a105ccb863d8008eb6201a51da52"><div class="ttname"><a href="../../d0/d29/cdr__mysql_8c.html#a0980a105ccb863d8008eb6201a51da52">name</a></div><div class="ttdeci">static const char name[]</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d29/cdr__mysql_8c_source.html#l00074">cdr_mysql.c:74</a></div></div>
<div class="ttc" id="linkedlists_8h_html_a6f42d3bf45cc9af6f794d9d1cf8c45ca"><div class="ttname"><a href="../../df/d90/linkedlists_8h.html#a6f42d3bf45cc9af6f794d9d1cf8c45ca">AST_LIST_HEAD_INIT</a></div><div class="ttdeci">#define AST_LIST_HEAD_INIT(head)</div><div class="ttdoc">Initializes a list head structure. </div><div class="ttdef"><b>Definition:</b> <a href="../../df/d90/linkedlists_8h_source.html#l00625">linkedlists.h:625</a></div></div>
<div class="ttc" id="res__xmpp_8c_html_a0e0cd41a2d8096259189d003db0238d7"><div class="ttname"><a href="../../dc/d6b/res__xmpp_8c.html#a0e0cd41a2d8096259189d003db0238d7">xmpp_send_exec</a></div><div class="ttdeci">static int xmpp_send_exec(struct ast_channel *chan, const char *data)</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d6b/res__xmpp_8c_source.html#l01842">res_xmpp.c:1842</a></div></div>
<div class="ttc" id="astmm_8h_html_a402072d6789f6ed9e3a81da27504127e"><div class="ttname"><a href="../../d8/d8a/astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a></div><div class="ttdeci">#define ast_free(a)</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d8a/astmm_8h_source.html#l00182">astmm.h:182</a></div></div>
<div class="ttc" id="structast__cli__entry_html_ade9cba72805fe52685a1deea307a8e82"><div class="ttname"><a href="../../d8/d07/structast__cli__entry.html#ade9cba72805fe52685a1deea307a8e82">ast_cli_entry::command</a></div><div class="ttdeci">char * command</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/db0/cli_8h_source.html#l00186">cli.h:186</a></div></div>
<div class="ttc" id="res__xmpp_8c_html_aef2ad31249e4f24084ed1e9c478147ca"><div class="ttname"><a href="../../dc/d6b/res__xmpp_8c.html#aef2ad31249e4f24084ed1e9c478147ca">xmpp_sendgroup_exec</a></div><div class="ttdeci">static int xmpp_sendgroup_exec(struct ast_channel *chan, const char *data)</div><div class="ttdoc">Application to send a message to a groupchat. </div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d6b/res__xmpp_8c_source.html#l01883">res_xmpp.c:1883</a></div></div>
<div class="ttc" id="astmm_8h_html_ae0cd4c5524b01287ab19cbe233d9cebb"><div class="ttname"><a href="../../d8/d8a/astmm_8h.html#ae0cd4c5524b01287ab19cbe233d9cebb">ast_calloc</a></div><div class="ttdeci">#define ast_calloc(num, len)</div><div class="ttdoc">A wrapper for calloc() </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d8a/astmm_8h_source.html#l00204">astmm.h:204</a></div></div>
<div class="ttc" id="structgroup_html"><div class="ttname"><a href="../../d3/d08/structgroup.html">group</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d35/func__dialgroup_8c_source.html#l00084">func_dialgroup.c:84</a></div></div>
<div class="ttc" id="res__xmpp_8c_html_ae209090303331da87de8e8ac0ffb6956"><div class="ttname"><a href="../../dc/d6b/res__xmpp_8c.html#ae209090303331da87de8e8ac0ffb6956">client_status_handler</a></div><div class="ttdeci">static int client_status_handler(const struct aco_option *opt, struct ast_variable *var, void *obj)</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d6b/res__xmpp_8c_source.html#l04565">res_xmpp.c:4565</a></div></div>
<div class="ttc" id="structast__xmpp__buddy_html"><div class="ttname"><a href="../../d5/d25/structast__xmpp__buddy.html">ast_xmpp_buddy</a></div><div class="ttdoc">XMPP Buddy. </div><div class="ttdef"><b>Definition:</b> <a href="../../da/da0/xmpp_8h_source.html#l00112">xmpp.h:112</a></div></div>
<div class="ttc" id="structast__xmpp__client_html_aad78dcd53e5bd3e0d6a9098a462e98f6"><div class="ttname"><a href="../../df/d42/structast__xmpp__client.html#aad78dcd53e5bd3e0d6a9098a462e98f6">ast_xmpp_client::endpoint</a></div><div class="ttdeci">struct ast_endpoint * endpoint</div><div class="ttdef"><b>Definition:</b> <a href="../../da/da0/xmpp_8h_source.html#l00148">xmpp.h:148</a></div></div>
<div class="ttc" id="res__xmpp_8c_html_a061c4cbf39cf2ba5a8d8175f2a6716ee"><div class="ttname"><a href="../../dc/d6b/res__xmpp_8c.html#a061c4cbf39cf2ba5a8d8175f2a6716ee">xmpp_client_requested_tls</a></div><div class="ttdeci">static int xmpp_client_requested_tls(struct ast_xmpp_client *client, struct ast_xmpp_client_config *cfg, int type, iks *node)</div><div class="ttdoc">Internal function called when we receive a response to our TLS initiation request. </div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d6b/res__xmpp_8c_source.html#l02587">res_xmpp.c:2587</a></div></div>
<div class="ttc" id="res__xmpp_8c_html_abb887526b9c7f8318531cdf9ad043717"><div class="ttname"><a href="../../dc/d6b/res__xmpp_8c.html#abb887526b9c7f8318531cdf9ad043717">xmpp_io_recv</a></div><div class="ttdeci">static int xmpp_io_recv(struct ast_xmpp_client *client, char *buffer, size_t buf_len, int timeout)</div><div class="ttdoc">Internal function which polls on an XMPP client and receives data. </div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d6b/res__xmpp_8c_source.html#l03617">res_xmpp.c:3617</a></div></div>
<div class="ttc" id="config__options_8h_html_a3e5be807d4a10b6da6382a40a0004ace"><div class="ttname"><a href="../../db/dfe/config__options_8h.html#a3e5be807d4a10b6da6382a40a0004ace">STRFLDSET</a></div><div class="ttdeci">#define STRFLDSET(type,...)</div><div class="ttdoc">Convert a struct and a list of stringfield fields to an argument list of field offsets. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/dfe/config__options_8h_source.html#l00827">config_options.h:827</a></div></div>
<div class="ttc" id="stasis_8h_html_a221d05010106dcde0cc2e2b43c1a8b67"><div class="ttname"><a href="../../dd/d79/stasis_8h.html#a221d05010106dcde0cc2e2b43c1a8b67">stasis_unsubscribe_and_join</a></div><div class="ttdeci">struct stasis_subscription * stasis_unsubscribe_and_join(struct stasis_subscription *subscription)</div><div class="ttdoc">Cancel a subscription, blocking until the last message is processed. </div><div class="ttdef"><b>Definition:</b> <a href="../../d0/df4/stasis_8c_source.html#l01136">stasis.c:1136</a></div></div>
<div class="ttc" id="group__StasisTopicsAndMessages_html_gaf226cf2d1a4dbbbf220521d58c05ac0f"><div class="ttname"><a href="../../df/deb/group__StasisTopicsAndMessages.html#gaf226cf2d1a4dbbbf220521d58c05ac0f">ast_mwi_state_type</a></div><div class="ttdeci">struct stasis_message_type * ast_mwi_state_type(void)</div><div class="ttdoc">Get the Stasis Message Bus API message type for MWI messages. </div></div>
<div class="ttc" id="res__xmpp_8c_html_a42466f982f15a72f75bc9c1ce1ecf4ab"><div class="ttname"><a href="../../dc/d6b/res__xmpp_8c.html#a42466f982f15a72f75bc9c1ce1ecf4ab">xmpp_cli_list_pubsub_nodes</a></div><div class="ttdeci">static char * xmpp_cli_list_pubsub_nodes(struct ast_cli_entry *e, int cmd, struct ast_cli_args *a)</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d6b/res__xmpp_8c_source.html#l04053">res_xmpp.c:4053</a></div></div>
<div class="ttc" id="module_8h_html_adc09474f0ff557e9925b722ee5b952dfac742921e9f9512d28f62c74ea2affe57"><div class="ttname"><a href="../../d5/d16/module_8h.html#adc09474f0ff557e9925b722ee5b952dfac742921e9f9512d28f62c74ea2affe57">AST_MODULE_LOAD_DECLINE</a></div><div class="ttdoc">Module has failed to load, may be in an inconsistent state. </div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d16/module_8h_source.html#l00078">module.h:78</a></div></div>
<div class="ttc" id="res__xmpp_8c_html_a482fd1cd3b669c1aa7986835733f8f47"><div class="ttname"><a href="../../dc/d6b/res__xmpp_8c.html#a482fd1cd3b669c1aa7986835733f8f47">messagelock</a></div><div class="ttdeci">static ast_mutex_t messagelock</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d6b/res__xmpp_8c_source.html#l00517">res_xmpp.c:517</a></div></div>
<div class="ttc" id="structaco__option_html"><div class="ttname"><a href="../../db/de0/structaco__option.html">aco_option</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d6/dc8/config__options_8c_source.html#l00062">config_options.c:62</a></div></div>
<div class="ttc" id="devicestate_8h_html_a26cbac580d3e86b529f90058f6e91ac7a3683b746ab070a6455934b5d24dbd779"><div class="ttname"><a href="../../da/da2/devicestate_8h.html#a26cbac580d3e86b529f90058f6e91ac7a3683b746ab070a6455934b5d24dbd779">AST_DEVSTATE_CACHABLE</a></div><div class="ttdef"><b>Definition:</b> <a href="../../da/da2/devicestate_8h_source.html#l00070">devicestate.h:70</a></div></div>
<div class="ttc" id="astobj2_8h_html_a911e0703891a9a7aaf73978152092586"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#a911e0703891a9a7aaf73978152092586">ao2_find</a></div><div class="ttdeci">#define ao2_find(container, arg, flags)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l01756">astobj2.h:1756</a></div></div>
<div class="ttc" id="structast__xmpp__buddy_html_ae3222a7c2c3040d71427c9a8b33ac38c"><div class="ttname"><a href="../../d5/d25/structast__xmpp__buddy.html#ae3222a7c2c3040d71427c9a8b33ac38c">ast_xmpp_buddy::resources</a></div><div class="ttdeci">struct ao2_container * resources</div><div class="ttdef"><b>Definition:</b> <a href="../../da/da0/xmpp_8h_source.html#l00114">xmpp.h:114</a></div></div>
<div class="ttc" id="res__pjsip__mwi_8c_html_a30833678d2fe25c6b56dfe159b3d281b"><div class="ttname"><a href="../../d8/d25/res__pjsip__mwi_8c.html#a30833678d2fe25c6b56dfe159b3d281b">unsubscribe</a></div><div class="ttdeci">static int unsubscribe(void *obj, void *arg, int flags)</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d25/res__pjsip__mwi_8c_source.html#l01292">res_pjsip_mwi.c:1292</a></div></div>
<div class="ttc" id="chan__pjsip_8c_html_a4e2e6fb7d874f0d2deddd2ecfc8afb32"><div class="ttname"><a href="../../d0/d29/chan__pjsip_8c.html#a4e2e6fb7d874f0d2deddd2ecfc8afb32">request</a></div><div class="ttdeci">static int request(void *obj)</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d29/chan__pjsip_8c_source.html#l02559">chan_pjsip.c:2559</a></div></div>
<div class="ttc" id="res__xmpp_8c_html_ae87b447a7957b9901ac78e5b6eae182a"><div class="ttname"><a href="../../dc/d6b/res__xmpp_8c.html#ae87b447a7957b9901ac78e5b6eae182a">xmpp_action_hook</a></div><div class="ttdeci">static int xmpp_action_hook(void *data, int type, iks *node)</div><div class="ttdoc">Action hook for when things occur. </div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d6b/res__xmpp_8c_source.html#l03458">res_xmpp.c:3458</a></div></div>
<div class="ttc" id="structast__xmpp__global__config_html_a4dded5c7628fc70e772d321ee6bd5748"><div class="ttname"><a href="../../da/d70/structast__xmpp__global__config.html#a4dded5c7628fc70e772d321ee6bd5748">ast_xmpp_global_config::general</a></div><div class="ttdeci">struct ast_flags general</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d6b/res__xmpp_8c_source.html#l00439">res_xmpp.c:439</a></div></div>
<div class="ttc" id="structstate_html"><div class="ttname"><a href="../../d4/d88/structstate.html">state</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d9/df8/localtime_8c_source.html#l00158">localtime.c:158</a></div></div>
<div class="ttc" id="res__xmpp_8c_html_a3ff94d7d97bc1497542220144f60afbf"><div class="ttname"><a href="../../dc/d6b/res__xmpp_8c.html#a3ff94d7d97bc1497542220144f60afbf">xmpp_client_config_post_apply</a></div><div class="ttdeci">static int xmpp_client_config_post_apply(void *obj, void *arg, int flags)</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d6b/res__xmpp_8c_source.html#l03866">res_xmpp.c:3866</a></div></div>
<div class="ttc" id="res__xmpp_8c_html_aeab1543f7ac14f52ba5148960429e849"><div class="ttname"><a href="../../dc/d6b/res__xmpp_8c.html#aeab1543f7ac14f52ba5148960429e849">global_option</a></div><div class="ttdeci">static struct aco_type global_option</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d6b/res__xmpp_8c_source.html#l00794">res_xmpp.c:794</a></div></div>
<div class="ttc" id="structast__xmpp__client_html_af738439b96e613a471505eb1222ac406"><div class="ttname"><a href="../../df/d42/structast__xmpp__client.html#af738439b96e613a471505eb1222ac406">ast_xmpp_client::jid</a></div><div class="ttdeci">iksid * jid</div><div class="ttdef"><b>Definition:</b> <a href="../../da/da0/xmpp_8h_source.html#l00126">xmpp.h:126</a></div></div>
<div class="ttc" id="res__xmpp_8c_html_ad7f5dc1236b0df5dde8be82a376d9c38"><div class="ttname"><a href="../../dc/d6b/res__xmpp_8c.html#ad7f5dc1236b0df5dde8be82a376d9c38">xmpp_client_subscribe_user</a></div><div class="ttdeci">static int xmpp_client_subscribe_user(void *obj, void *arg, int flags)</div><div class="ttdoc">Callback function which subscribes to a user if needed. </div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d6b/res__xmpp_8c_source.html#l02229">res_xmpp.c:2229</a></div></div>
<div class="ttc" id="structuser_html"><div class="ttname"><a href="../../d8/dbc/structuser.html">user</a></div><div class="ttdoc">structure to hold users read from users.conf </div><div class="ttdef"><b>Definition:</b> <a href="../../d9/de9/res__phoneprov_8c_source.html#l00312">res_phoneprov.c:312</a></div></div>
<div class="ttc" id="res__xmpp_8c_html_a5d78f1d69258138fd512b397eb27f393"><div class="ttname"><a href="../../dc/d6b/res__xmpp_8c.html#a5d78f1d69258138fd512b397eb27f393">xmpp_pubsub_publish_device_state</a></div><div class="ttdeci">static void xmpp_pubsub_publish_device_state(struct ast_xmpp_client *client, const char *device, const char *device_state, unsigned int cachable)</div><div class="ttdoc">Publish device state to a PubSub node. </div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d6b/res__xmpp_8c_source.html#l01300">res_xmpp.c:1300</a></div></div>
<div class="ttc" id="structast__flags_html"><div class="ttname"><a href="../../dc/dac/structast__flags.html">ast_flags</a></div><div class="ttdoc">Structure used to handle boolean flags. </div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d60/utils_8h_source.html#l00199">utils.h:199</a></div></div>
<div class="ttc" id="structast__xmpp__client__config_html_a4e8ff91b48d6fcdfb7f0265d59bdd979"><div class="ttname"><a href="../../da/d00/structast__xmpp__client__config.html#a4e8ff91b48d6fcdfb7f0265d59bdd979">ast_xmpp_client_config::oauth_secret</a></div><div class="ttdeci">const ast_string_field oauth_secret</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d6b/res__xmpp_8c_source.html#l00456">res_xmpp.c:456</a></div></div>
<div class="ttc" id="structast__xmpp__client_html_ace9168767fc3707cf5f0a7d049682ba3"><div class="ttname"><a href="../../df/d42/structast__xmpp__client.html#ace9168767fc3707cf5f0a7d049682ba3">ast_xmpp_client::name</a></div><div class="ttdeci">const ast_string_field name</div><div class="ttdef"><b>Definition:</b> <a href="../../da/da0/xmpp_8h_source.html#l00123">xmpp.h:123</a></div></div>
<div class="ttc" id="res__xmpp_8c_html_a32325f89202eb73b55ba2c0402cc1bf1"><div class="ttname"><a href="../../dc/d6b/res__xmpp_8c.html#a32325f89202eb73b55ba2c0402cc1bf1">xmpp_resource_cmp</a></div><div class="ttdeci">static int xmpp_resource_cmp(void *obj, void *arg, int flags)</div><div class="ttdoc">Comparator function for XMPP resource. </div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d6b/res__xmpp_8c_source.html#l00847">res_xmpp.c:847</a></div></div>
<div class="ttc" id="res__phoneprov_8c_html_addaa208b0ed785225e24490fb9f28a80"><div class="ttname"><a href="../../d9/de9/res__phoneprov_8c.html#addaa208b0ed785225e24490fb9f28a80">AST_MODULE_INFO</a></div><div class="ttdeci">AST_MODULE_INFO(ASTERISK_GPL_KEY, AST_MODFLAG_GLOBAL_SYMBOLS|AST_MODFLAG_LOAD_ORDER, &quot;HTTP Phone Provisioning&quot;,.support_level=AST_MODULE_SUPPORT_EXTENDED,.load=load_module,.unload=unload_module,.reload=reload,.load_pri=AST_MODPRI_CHANNEL_DEPEND,.requires=&quot;http&quot;,)</div></div>
<div class="ttc" id="res__xmpp_8c_html_aa12ed649e4948ec6111d956215c63913"><div class="ttname"><a href="../../dc/d6b/res__xmpp_8c.html#aa12ed649e4948ec6111d956215c63913">res_xmpp_conf</a></div><div class="ttdeci">struct aco_file res_xmpp_conf</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d6b/res__xmpp_8c_source.html#l00817">res_xmpp.c:817</a></div></div>
<div class="ttc" id="message_8h_html_a02a688837f4e91ea078c0b1b48017ef8"><div class="ttname"><a href="../../d2/d0d/message_8h.html#a02a688837f4e91ea078c0b1b48017ef8">ast_msg_set_from</a></div><div class="ttdeci">int ast_msg_set_from(struct ast_msg *msg, const char *fmt,...)</div><div class="ttdoc">Set the &amp;#39;from&amp;#39; URI of a message. </div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d6d/message_8c_source.html#l00465">message.c:465</a></div></div>
<div class="ttc" id="structast__cli__entry_html_aef1bd6ad890a110b466cb0e8088507a2"><div class="ttname"><a href="../../d8/d07/structast__cli__entry.html#aef1bd6ad890a110b466cb0e8088507a2">ast_cli_entry::usage</a></div><div class="ttdeci">const char * usage</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/db0/cli_8h_source.html#l00177">cli.h:177</a></div></div>
<div class="ttc" id="res__xmpp_8c_html_a71f51aa05e7a0aab01106f57cd93affa"><div class="ttname"><a href="../../dc/d6b/res__xmpp_8c.html#a71f51aa05e7a0aab01106f57cd93affa">xmpp_client_destructor</a></div><div class="ttdeci">static void xmpp_client_destructor(void *obj)</div><div class="ttdoc">Destructor callback function for XMPP client. </div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d6b/res__xmpp_8c_source.html#l00545">res_xmpp.c:545</a></div></div>
<div class="ttc" id="structxmpp__state__handler_html_a89f234133d3efe315836311cbf21c64b"><div class="ttname"><a href="../../dc/d18/structxmpp__state__handler.html#a89f234133d3efe315836311cbf21c64b">xmpp_state_handler::state</a></div><div class="ttdeci">int state</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d6b/res__xmpp_8c_source.html#l00484">res_xmpp.c:484</a></div></div>
<div class="ttc" id="utils_8h_html_ad5db11fa27352e2b9a3c669adc76955f"><div class="ttname"><a href="../../d5/d60/utils_8h.html#ad5db11fa27352e2b9a3c669adc76955f">ast_eid_default</a></div><div class="ttdeci">struct ast_eid ast_eid_default</div><div class="ttdoc">Global EID. </div><div class="ttdef"><b>Definition:</b> <a href="../../de/dc5/options_8c_source.html#l00093">options.c:93</a></div></div>
<div class="ttc" id="structast__xmpp__client_html_a5082987d3e1eac5f625574800bb72c2c"><div class="ttname"><a href="../../df/d42/structast__xmpp__client.html#a5082987d3e1eac5f625574800bb72c2c">ast_xmpp_client::buddies</a></div><div class="ttdeci">struct ao2_container * buddies</div><div class="ttdef"><b>Definition:</b> <a href="../../da/da0/xmpp_8h_source.html#l00137">xmpp.h:137</a></div></div>
<div class="ttc" id="structxmpp__config_html"><div class="ttname"><a href="../../de/d1c/structxmpp__config.html">xmpp_config</a></div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d6b/res__xmpp_8c_source.html#l00467">res_xmpp.c:467</a></div></div>
<div class="ttc" id="structast__xmpp__client_html_a01f75a9ad916f63a94e06a27635ba278"><div class="ttname"><a href="../../df/d42/structast__xmpp__client.html#a01f75a9ad916f63a94e06a27635ba278">ast_xmpp_client::thread</a></div><div class="ttdeci">pthread_t thread</div><div class="ttdef"><b>Definition:</b> <a href="../../da/da0/xmpp_8h_source.html#l00139">xmpp.h:139</a></div></div>
<div class="ttc" id="structast__xmpp__client_html_a8c5d83fcb87f22326009954a4652d92e"><div class="ttname"><a href="../../df/d42/structast__xmpp__client.html#a8c5d83fcb87f22326009954a4652d92e">ast_xmpp_client::ssl_context</a></div><div class="ttdeci">SSL_CTX * ssl_context</div><div class="ttdef"><b>Definition:</b> <a href="../../da/da0/xmpp_8h_source.html#l00131">xmpp.h:131</a></div></div>
<div class="ttc" id="res__xmpp_8c_html_a6884e3f2670be5350b11f3f6c98f5f91"><div class="ttname"><a href="../../dc/d6b/res__xmpp_8c.html#a6884e3f2670be5350b11f3f6c98f5f91">xmpp_pubsub_unsubscribe</a></div><div class="ttdeci">static void xmpp_pubsub_unsubscribe(struct ast_xmpp_client *client, const char *node)</div><div class="ttdoc">Unsubscribe from a PubSub node. </div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d6b/res__xmpp_8c_source.html#l01388">res_xmpp.c:1388</a></div></div>
<div class="ttc" id="res__xmpp_8c_html_af93c6d3d569b1db56ee10a4b9615a50d"><div class="ttname"><a href="../../dc/d6b/res__xmpp_8c.html#af93c6d3d569b1db56ee10a4b9615a50d">message_received_condition</a></div><div class="ttdeci">static ast_cond_t message_received_condition</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d6b/res__xmpp_8c_source.html#l00516">res_xmpp.c:516</a></div></div>
<div class="ttc" id="cli_8h_html_a50989f00b32eeb2516a3803cb2ffb766"><div class="ttname"><a href="../../dc/db0/cli_8h.html#a50989f00b32eeb2516a3803cb2ffb766">CLI_SUCCESS</a></div><div class="ttdeci">#define CLI_SUCCESS</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/db0/cli_8h_source.html#l00044">cli.h:44</a></div></div>
<div class="ttc" id="res__xmpp_8c_html_aa8360dfe4cb230e7c33bc302e2667111"><div class="ttname"><a href="../../dc/d6b/res__xmpp_8c.html#aa8360dfe4cb230e7c33bc302e2667111">xmpp_buddy_destructor</a></div><div class="ttdeci">static void xmpp_buddy_destructor(void *obj)</div><div class="ttdoc">Destructor callback function for XMPP buddy. </div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d6b/res__xmpp_8c_source.html#l00856">res_xmpp.c:856</a></div></div>
<div class="ttc" id="config__options_8h_html_a60d2944aab4537720434ab9c90e12418"><div class="ttname"><a href="../../db/dfe/config__options_8h.html#a60d2944aab4537720434ab9c90e12418">ACO_FILES</a></div><div class="ttdeci">#define ACO_FILES(...)</div><div class="ttdef"><b>Definition:</b> <a href="../../db/dfe/config__options_8h_source.html#l00182">config_options.h:182</a></div></div>
<div class="ttc" id="cli_8h_html_ab33e5350a923c3a8cedbeb496cd88ec9a76bf33139279b03ec1691f2be2d1be40"><div class="ttname"><a href="../../dc/db0/cli_8h.html#ab33e5350a923c3a8cedbeb496cd88ec9a76bf33139279b03ec1691f2be2d1be40">CLI_GENERATE</a></div><div class="ttdef"><b>Definition:</b> <a href="../../dc/db0/cli_8h_source.html#l00153">cli.h:153</a></div></div>
<div class="ttc" id="config__options_8h_html_ab29e0267f5b05969bcd1d16e97100ebba3e6bada4dbda566888d4317e3bf6343b"><div class="ttname"><a href="../../db/dfe/config__options_8h.html#ab29e0267f5b05969bcd1d16e97100ebba3e6bada4dbda566888d4317e3bf6343b">ACO_WHITELIST_EXACT</a></div><div class="ttdef"><b>Definition:</b> <a href="../../db/dfe/config__options_8h_source.html#l00055">config_options.h:55</a></div></div>
<div class="ttc" id="include_2asterisk_2compat_8h_html_a40eca58273c74a20a17f137d18ba826c"><div class="ttname"><a href="../../de/da3/include_2asterisk_2compat_8h.html#a40eca58273c74a20a17f137d18ba826c">strsep</a></div><div class="ttdeci">char * strsep(char **str, const char *delims)</div></div>
<div class="ttc" id="res__xmpp_8c_html_a24812e0efb23effa2797b3d7848f2bb3"><div class="ttname"><a href="../../dc/d6b/res__xmpp_8c.html#a24812e0efb23effa2797b3d7848f2bb3">xmpp_pak_s10n</a></div><div class="ttdeci">static int xmpp_pak_s10n(struct ast_xmpp_client *client, struct ast_xmpp_client_config *cfg, iks *node, ikspak *pak)</div><div class="ttdoc">Internal function called when a subscription message is received. </div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d6b/res__xmpp_8c_source.html#l03395">res_xmpp.c:3395</a></div></div>
<div class="ttc" id="res__xmpp_8c_html_a05b71d76cff3ccd9fe2a0c4a16d21271"><div class="ttname"><a href="../../dc/d6b/res__xmpp_8c.html#a05b71d76cff3ccd9fe2a0c4a16d21271">global_options</a></div><div class="ttdeci">struct aco_type * global_options[]</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d6b/res__xmpp_8c_source.html#l00802">res_xmpp.c:802</a></div></div>
<div class="ttc" id="xmpp_8h_html_ae37d560c438576bdcb47347088225ee6af75b0231e0c9888c9a6c5374abf7527f"><div class="ttname"><a href="../../da/da0/xmpp_8h.html#ae37d560c438576bdcb47347088225ee6af75b0231e0c9888c9a6c5374abf7527f">XMPP_STATE_CONNECTED</a></div><div class="ttdef"><b>Definition:</b> <a href="../../da/da0/xmpp_8h_source.html#l00080">xmpp.h:80</a></div></div>
<div class="ttc" id="message_8h_html_a53573a834e1a26d67c26ba58a9ad8274"><div class="ttname"><a href="../../d2/d0d/message_8h.html#a53573a834e1a26d67c26ba58a9ad8274">ast_msg_set_endpoint</a></div><div class="ttdeci">int ast_msg_set_endpoint(struct ast_msg *msg, const char *fmt,...)</div><div class="ttdoc">Set the technology&amp;#39;s endpoint associated with this message. </div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d6d/message_8c_source.html#l00520">message.c:520</a></div></div>
<div class="ttc" id="res__corosync_8c_html_a84fa7112345dca92d94860c1dcef8ba6"><div class="ttname"><a href="../../d1/da4/res__corosync_8c.html#a84fa7112345dca92d94860c1dcef8ba6">subscribe</a></div><div class="ttdeci">unsigned char subscribe</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/da4/res__corosync_8c_source.html#l00243">res_corosync.c:243</a></div></div>
<div class="ttc" id="res__xmpp_8c_html_a122bb577b8da348b111a9e75c0d66e07"><div class="ttname"><a href="../../dc/d6b/res__xmpp_8c.html#a122bb577b8da348b111a9e75c0d66e07">app_ajijoin</a></div><div class="ttdeci">static const char * app_ajijoin</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d6b/res__xmpp_8c_source.html#l00513">res_xmpp.c:513</a></div></div>
<div class="ttc" id="structast__xmpp__client__config_html_a4b8582884dc99ca78481aaf09d2a8aaa"><div class="ttname"><a href="../../da/d00/structast__xmpp__client__config.html#a4b8582884dc99ca78481aaf09d2a8aaa">ast_xmpp_client_config::oauth_clientid</a></div><div class="ttdeci">const ast_string_field oauth_clientid</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d6b/res__xmpp_8c_source.html#l00456">res_xmpp.c:456</a></div></div>
<div class="ttc" id="res__xmpp_8c_html_a8e8150ade4edbd105394640480f6cd2c"><div class="ttname"><a href="../../dc/d6b/res__xmpp_8c.html#a8e8150ade4edbd105394640480f6cd2c">xmpp_pubsub_create_leaf</a></div><div class="ttdeci">static void xmpp_pubsub_create_leaf(struct ast_xmpp_client *client, const char *collection_name, const char *leaf_name)</div><div class="ttdoc">Create a PubSub leaf node. </div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d6b/res__xmpp_8c_source.html#l01255">res_xmpp.c:1255</a></div></div>
<div class="ttc" id="structao2__iterator_html"><div class="ttname"><a href="../../d9/d97/structao2__iterator.html">ao2_iterator</a></div><div class="ttdoc">When we need to walk through a container, we use an ao2_iterator to keep track of the current positio...</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l01841">astobj2.h:1841</a></div></div>
<div class="ttc" id="res__xmpp_8c_html_a49915a5613cc77c903e5f8ee0630351b"><div class="ttname"><a href="../../dc/d6b/res__xmpp_8c.html#a49915a5613cc77c903e5f8ee0630351b">get_buddy_status</a></div><div class="ttdeci">static int get_buddy_status(struct ast_xmpp_client_config *clientcfg, char *screenname, char *resource)</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d6b/res__xmpp_8c_source.html#l01635">res_xmpp.c:1635</a></div></div>
<div class="ttc" id="astobj2_8h_html_a6321ee982370c55ab3c24c72c562cbdd"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#a6321ee982370c55ab3c24c72c562cbdd">ao2_cleanup</a></div><div class="ttdeci">#define ao2_cleanup(obj)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l01958">astobj2.h:1958</a></div></div>
<div class="ttc" id="cli_8h_html"><div class="ttname"><a href="../../dc/db0/cli_8h.html">cli.h</a></div><div class="ttdoc">Standard Command Line Interface. </div></div>
<div class="ttc" id="json_8h_html_a53707225c3bf831e263245c6e3800676"><div class="ttname"><a href="../../d4/d05/json_8h.html#a53707225c3bf831e263245c6e3800676">ast_json_object_get</a></div><div class="ttdeci">struct ast_json * ast_json_object_get(struct ast_json *object, const char *key)</div><div class="ttdoc">Get a field from a JSON object. </div><div class="ttdef"><b>Definition:</b> <a href="../../df/d98/json_8c_source.html#l00397">json.c:397</a></div></div>
<div class="ttc" id="structaco__type_html"><div class="ttname"><a href="../../de/d71/structaco__type.html">aco_type</a></div><div class="ttdoc">Type information about a category-level configurable object. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/dfe/config__options_8h_source.html#l00121">config_options.h:121</a></div></div>
<div class="ttc" id="strings_8h_html_ac4040268f7b6ed77dfc49c7767626369"><div class="ttname"><a href="../../d6/d90/strings_8h.html#ac4040268f7b6ed77dfc49c7767626369">ast_copy_string</a></div><div class="ttdeci">void ast_copy_string(char *dst, const char *src, size_t size)</div><div class="ttdoc">Size-limited null-terminating string copy. </div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d90/strings_8h_source.html#l00401">strings.h:401</a></div></div>
<div class="ttc" id="structast__xmpp__client_html_a493b57f443cc38b3d3df9c1e584d9d82"><div class="ttname"><a href="../../df/d42/structast__xmpp__client.html#a493b57f443cc38b3d3df9c1e584d9d82">ast_xmpp_client::timeout</a></div><div class="ttdeci">int timeout</div><div class="ttdef"><b>Definition:</b> <a href="../../da/da0/xmpp_8h_source.html#l00140">xmpp.h:140</a></div></div>
<div class="ttc" id="strings_8h_html_a2faaa16929951bfd2802b7829a100ba2"><div class="ttname"><a href="../../d6/d90/strings_8h.html#a2faaa16929951bfd2802b7829a100ba2">S_OR</a></div><div class="ttdeci">#define S_OR(a, b)</div><div class="ttdoc">returns the equivalent of logic or for strings: first one if not empty, otherwise second one...</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d90/strings_8h_source.html#l00079">strings.h:79</a></div></div>
<div class="ttc" id="time_8h_html_aebf04439f206cc509472ce4b6da48a5a"><div class="ttname"><a href="../../de/df7/time_8h.html#aebf04439f206cc509472ce4b6da48a5a">ast_tv</a></div><div class="ttdeci">struct timeval ast_tv(ast_time_t sec, ast_suseconds_t usec)</div><div class="ttdoc">Returns a timeval from sec, usec. </div><div class="ttdef"><b>Definition:</b> <a href="../../de/df7/time_8h_source.html#l00226">time.h:226</a></div></div>
<div class="ttc" id="channel_8h_html_a7ca2fda13b129a55c251b56729de285b"><div class="ttname"><a href="../../d5/d7b/channel_8h.html#a7ca2fda13b129a55c251b56729de285b">ast_channel_name</a></div><div class="ttdeci">const char * ast_channel_name(const struct ast_channel *chan)</div></div>
<div class="ttc" id="structaco__file_html_a7efa5e9c7494c7d4586359300221aa5d"><div class="ttname"><a href="../../d9/d9c/structaco__file.html#a7efa5e9c7494c7d4586359300221aa5d">aco_file::filename</a></div><div class="ttdeci">const char * filename</div><div class="ttdef"><b>Definition:</b> <a href="../../db/dfe/config__options_8h_source.html#l00162">config_options.h:162</a></div></div>
<div class="ttc" id="group__StasisTopicsAndMessages_html_ga70de9f16a229e2c5bf1a973372949d3e"><div class="ttname"><a href="../../df/deb/group__StasisTopicsAndMessages.html#ga70de9f16a229e2c5bf1a973372949d3e">ast_mwi_state::new_msgs</a></div><div class="ttdeci">int new_msgs</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d33/mwi_8h_source.html#l00461">mwi.h:461</a></div></div>
<div class="ttc" id="structast__xmpp__client__config_html_a522b409a211fd313b8a02f071aea6751"><div class="ttname"><a href="../../da/d00/structast__xmpp__client__config.html#a522b409a211fd313b8a02f071aea6751">ast_xmpp_client_config::status</a></div><div class="ttdeci">enum ikshowtype status</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d6b/res__xmpp_8c_source.html#l00462">res_xmpp.c:462</a></div></div>
<div class="ttc" id="res__xmpp_8c_html_aa3759d2ddcc12f3f5ef5a8a3ffa4a4dfa94811fda886cb2affbcb7a810dff8eb7"><div class="ttname"><a href="../../dc/d6b/res__xmpp_8c.html#aa3759d2ddcc12f3f5ef5a8a3ffa4a4dfa94811fda886cb2affbcb7a810dff8eb7">XMPP_DEBUG</a></div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d6b/res__xmpp_8c_source.html#l00402">res_xmpp.c:402</a></div></div>
<div class="ttc" id="res__xmpp_8c_html_a4d9c4b11143ef37e2b1608c75680b1a7"><div class="ttname"><a href="../../dc/d6b/res__xmpp_8c.html#a4d9c4b11143ef37e2b1608c75680b1a7">xmpp_join_exec</a></div><div class="ttdeci">static int xmpp_join_exec(struct ast_channel *chan, const char *data)</div><div class="ttdoc">Application to join a chat room. </div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d6b/res__xmpp_8c_source.html#l01722">res_xmpp.c:1722</a></div></div>
<div class="ttc" id="group__StasisTopicsAndMessages_html_ga753c7b39e3284d771f13f513b003d033"><div class="ttname"><a href="../../df/deb/group__StasisTopicsAndMessages.html#ga753c7b39e3284d771f13f513b003d033">ast_mwi_state::uniqueid</a></div><div class="ttdeci">const ast_string_field uniqueid</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d33/mwi_8h_source.html#l00460">mwi.h:460</a></div></div>
<div class="ttc" id="structast__xmpp__client_html_abee5661fa88af477fe47bbbd21136301"><div class="ttname"><a href="../../df/d42/structast__xmpp__client.html#abee5661fa88af477fe47bbbd21136301">ast_xmpp_client::mid</a></div><div class="ttdeci">char mid[6]</div><div class="ttdef"><b>Definition:</b> <a href="../../da/da0/xmpp_8h_source.html#l00125">xmpp.h:125</a></div></div>
<div class="ttc" id="test__ari_8c_html_a695cc202c7a2869aa8202bb20726ea3c"><div class="ttname"><a href="../../da/d03/test__ari_8c.html#a695cc202c7a2869aa8202bb20726ea3c">handler</a></div><div class="ttdeci">static void handler(const char *name, int response_code, struct ast_variable *get_params, struct ast_variable *path_vars, struct ast_variable *headers, struct ast_json *body, struct ast_ari_response *response)</div><div class="ttdef"><b>Definition:</b> <a href="../../da/d03/test__ari_8c_source.html#l00059">test_ari.c:59</a></div></div>
<div class="ttc" id="mwi_8h_html"><div class="ttname"><a href="../../dc/d33/mwi_8h.html">mwi.h</a></div><div class="ttdoc">Asterisk MWI API. </div></div>
<div class="ttc" id="structast__xmpp__message_html_a51d291314bf1da3f9ac4479963a4fadd"><div class="ttname"><a href="../../d6/d73/structast__xmpp__message.html#a51d291314bf1da3f9ac4479963a4fadd">ast_xmpp_message::id</a></div><div class="ttdeci">char id[25]</div><div class="ttdef"><b>Definition:</b> <a href="../../da/da0/xmpp_8h_source.html#l00104">xmpp.h:104</a></div></div>
<div class="ttc" id="res__xmpp_8c_html_a7aa063e7e023aac98e55edc4d9faea55"><div class="ttname"><a href="../../dc/d6b/res__xmpp_8c.html#a7aa063e7e023aac98e55edc4d9faea55">xmpp_pubsub_delete_node</a></div><div class="ttdeci">static void xmpp_pubsub_delete_node(struct ast_xmpp_client *client, const char *node_name)</div><div class="ttdoc">Delete a PubSub node. </div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d6b/res__xmpp_8c_source.html#l01219">res_xmpp.c:1219</a></div></div>
<div class="ttc" id="hash__buf_8c_html_aa2831bb926e4abf05aba216f708dfc4a"><div class="ttname"><a href="../../d1/d7c/hash__buf_8c.html#aa2831bb926e4abf05aba216f708dfc4a">newbuf</a></div><div class="ttdeci">static BUFHEAD * newbuf(HTAB *hashp, u_int32_t addr, BUFHEAD *prev_bp)</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d7c/hash__buf_8c_source.html#l00160">hash_buf.c:160</a></div></div>
<div class="ttc" id="stasis_8h_html_a4f248ee5f4791f05d0af8768aaab282b"><div class="ttname"><a href="../../dd/d79/stasis_8h.html#a4f248ee5f4791f05d0af8768aaab282b">stasis_subscription_accept_message_type</a></div><div class="ttdeci">int stasis_subscription_accept_message_type(struct stasis_subscription *subscription, const struct stasis_message_type *type)</div><div class="ttdoc">Indicate to a subscription that we are interested in a message type. </div><div class="ttdef"><b>Definition:</b> <a href="../../d0/df4/stasis_8c_source.html#l01025">stasis.c:1025</a></div></div>
<div class="ttc" id="res__corosync_8c_html_a8e51289dd0fc7415cee40e7a57b49fdf"><div class="ttname"><a href="../../d1/da4/res__corosync_8c.html#a8e51289dd0fc7415cee40e7a57b49fdf">sub</a></div><div class="ttdeci">struct stasis_forward * sub</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/da4/res__corosync_8c_source.html#l00240">res_corosync.c:240</a></div></div>
<div class="ttc" id="astobj2_8h_html_a77df7775a2a8b6cbef307e211dbf045c"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#a77df7775a2a8b6cbef307e211dbf045c">ao2_unlink_flags</a></div><div class="ttdeci">#define ao2_unlink_flags(container, obj, flags)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l01622">astobj2.h:1622</a></div></div>
<div class="ttc" id="stasis_8h_html_a3804fa8ec76d77090d5cda80fc4ac891a0e40588366edb9a53e453d47ef26d567"><div class="ttname"><a href="../../dd/d79/stasis_8h.html#a3804fa8ec76d77090d5cda80fc4ac891a0e40588366edb9a53e453d47ef26d567">STASIS_SUBSCRIPTION_FILTER_SELECTIVE</a></div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d79/stasis_8h_source.html#l00300">stasis.h:300</a></div></div>
<div class="ttc" id="structast__json_html"><div class="ttname"><a href="../../d1/da1/structast__json.html">ast_json</a></div><div class="ttdoc">Abstract JSON element (object, array, string, int, ...). </div></div>
<div class="ttc" id="config__options_8h_html_a61bb4940517e7d00e7104de8273c2144afec8c0a18639b70f2e518bc8ee9f3540"><div class="ttname"><a href="../../db/dfe/config__options_8h.html#a61bb4940517e7d00e7104de8273c2144afec8c0a18639b70f2e518bc8ee9f3540">OPT_STRINGFIELD_T</a></div><div class="ttdoc">Type for default option handler for stringfields. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/dfe/config__options_8h_source.html#l00435">config_options.h:435</a></div></div>
<div class="ttc" id="structast__cli__args_html"><div class="ttname"><a href="../../d3/dad/structast__cli__args.html">ast_cli_args</a></div><div class="ttdef"><b>Definition:</b> <a href="../../dc/db0/cli_8h_source.html#l00158">cli.h:158</a></div></div>
<div class="ttc" id="res__xmpp_8c_html_a306d2764c3a511ce4bb062987aee310c"><div class="ttname"><a href="../../dc/d6b/res__xmpp_8c.html#a306d2764c3a511ce4bb062987aee310c">xmpp_pak_message</a></div><div class="ttdeci">static int xmpp_pak_message(struct ast_xmpp_client *client, struct ast_xmpp_client_config *cfg, iks *node, ikspak *pak)</div><div class="ttdoc">Internal function called when a message is received. </div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d6b/res__xmpp_8c_source.html#l03120">res_xmpp.c:3120</a></div></div>
<div class="ttc" id="res__xmpp_8c_html_a28e4ab2757e6f989d4300ecbbe5acf36"><div class="ttname"><a href="../../dc/d6b/res__xmpp_8c.html#a28e4ab2757e6f989d4300ecbbe5acf36">ast_xmpp_client_unlock</a></div><div class="ttdeci">void ast_xmpp_client_unlock(struct ast_xmpp_client *client)</div><div class="ttdoc">Unlock an XMPP client connection. </div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d6b/res__xmpp_8c_source.html#l00898">res_xmpp.c:898</a></div></div>
<div class="ttc" id="res__xmpp_8c_html_a58ab8a642d8aeb224c46ff80298855ae"><div class="ttname"><a href="../../dc/d6b/res__xmpp_8c.html#a58ab8a642d8aeb224c46ff80298855ae">app_ajileave</a></div><div class="ttdeci">static const char * app_ajileave</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d6b/res__xmpp_8c_source.html#l00514">res_xmpp.c:514</a></div></div>
<div class="ttc" id="structast__device__state__message_html"><div class="ttname"><a href="../../db/d92/structast__device__state__message.html">ast_device_state_message</a></div><div class="ttdoc">The structure that contains device state. </div><div class="ttdef"><b>Definition:</b> <a href="../../da/da2/devicestate_8h_source.html#l00240">devicestate.h:240</a></div></div>
<div class="ttc" id="utils_2frame_8c_html_a4a9391ee88e57361b613c4c2fd2bf4aa"><div class="ttname"><a href="../../d6/d47/utils_2frame_8c.html#a4a9391ee88e57361b613c4c2fd2bf4aa">error</a></div><div class="ttdeci">int error(const char *format,...)</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d47/utils_2frame_8c_source.html#l00999">utils/frame.c:999</a></div></div>
<div class="ttc" id="res__xmpp_8c_html_ae417655500bd50e80fc52f68c18accc9"><div class="ttname"><a href="../../dc/d6b/res__xmpp_8c.html#ae417655500bd50e80fc52f68c18accc9">xmpp_pak_handlers</a></div><div class="ttdeci">static const struct xmpp_pak_handler xmpp_pak_handlers[]</div></div>
<div class="ttc" id="xmpp_8h_html_ae37d560c438576bdcb47347088225ee6a1f316843c055717ccde5ccb266e1eee6"><div class="ttname"><a href="../../da/da0/xmpp_8h.html#ae37d560c438576bdcb47347088225ee6a1f316843c055717ccde5ccb266e1eee6">XMPP_STATE_AUTHENTICATE</a></div><div class="ttdef"><b>Definition:</b> <a href="../../da/da0/xmpp_8h_source.html#l00077">xmpp.h:77</a></div></div>
<div class="ttc" id="linkedlists_8h_html_aa5be52067bf16bdc7e56ca19b5ba858d"><div class="ttname"><a href="../../df/d90/linkedlists_8h.html#aa5be52067bf16bdc7e56ca19b5ba858d">AST_LIST_TRAVERSE_SAFE_BEGIN</a></div><div class="ttdeci">#define AST_LIST_TRAVERSE_SAFE_BEGIN(head, var, field)</div><div class="ttdoc">Loops safely over (traverses) the entries in a list. </div><div class="ttdef"><b>Definition:</b> <a href="../../df/d90/linkedlists_8h_source.html#l00528">linkedlists.h:528</a></div></div>
<div class="ttc" id="devicestate_8h_html_a26cbac580d3e86b529f90058f6e91ac7a4dbd4bd0c7bf0b9d8c3c2c800d39cfc1"><div class="ttname"><a href="../../da/da2/devicestate_8h.html#a26cbac580d3e86b529f90058f6e91ac7a4dbd4bd0c7bf0b9d8c3c2c800d39cfc1">AST_DEVSTATE_NOT_CACHABLE</a></div><div class="ttdef"><b>Definition:</b> <a href="../../da/da2/devicestate_8h_source.html#l00069">devicestate.h:69</a></div></div>
<div class="ttc" id="utils_8h_html_a9052010ef014bd56be478fab26feb2e1"><div class="ttname"><a href="../../d5/d60/utils_8h.html#a9052010ef014bd56be478fab26feb2e1">ast_eid_is_empty</a></div><div class="ttdeci">int ast_eid_is_empty(const struct ast_eid *eid)</div><div class="ttdoc">Check if EID is empty. </div><div class="ttdef"><b>Definition:</b> <a href="../../de/d1f/main_2utils_8c_source.html#l02847">main/utils.c:2847</a></div></div>
<div class="ttc" id="lock_8h_html_a76e8ed6bb354be6c6dd9e51acc1d7a1b"><div class="ttname"><a href="../../dd/d42/lock_8h.html#a76e8ed6bb354be6c6dd9e51acc1d7a1b">ast_mutex_init</a></div><div class="ttdeci">#define ast_mutex_init(pmutex)</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d42/lock_8h_source.html#l00184">lock.h:184</a></div></div>
<div class="ttc" id="structxmpp__config_html_ad69ce1bbfeca1aac1f78e32a4a240a58"><div class="ttname"><a href="../../de/d1c/structxmpp__config.html#ad69ce1bbfeca1aac1f78e32a4a240a58">xmpp_config::global</a></div><div class="ttdeci">struct ast_xmpp_global_config * global</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d6b/res__xmpp_8c_source.html#l00468">res_xmpp.c:468</a></div></div>
<div class="ttc" id="structast__xmpp__client_html_a28e9fca20ae2d65b0b00c4c4b16ee59b"><div class="ttname"><a href="../../df/d42/structast__xmpp__client.html#a28e9fca20ae2d65b0b00c4c4b16ee59b">ast_xmpp_client::ssl_session</a></div><div class="ttdeci">SSL * ssl_session</div><div class="ttdef"><b>Definition:</b> <a href="../../da/da0/xmpp_8h_source.html#l00132">xmpp.h:132</a></div></div>
<div class="ttc" id="structao2__container_html"><div class="ttname"><a href="../../d2/da9/structao2__container.html">ao2_container</a></div><div class="ttdoc">Generic container type. </div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d20/astobj2__container__private_8h_source.html#l00282">astobj2_container_private.h:282</a></div></div>
<div class="ttc" id="structast__msg_html"><div class="ttname"><a href="../../df/da1/structast__msg.html">ast_msg</a></div><div class="ttdoc">A message. </div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d6d/message_8c_source.html#l00233">message.c:233</a></div></div>
<div class="ttc" id="res__xmpp_8c_html_ae45cca00255078960084d96a140650ef"><div class="ttname"><a href="../../dc/d6b/res__xmpp_8c.html#ae45cca00255078960084d96a140650ef">openssl_error_string</a></div><div class="ttdeci">static char * openssl_error_string(void)</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d6b/res__xmpp_8c_source.html#l02569">res_xmpp.c:2569</a></div></div>
<div class="ttc" id="structast__xmpp__client__config_html_ad300470818476484645b03f3c0c66591"><div class="ttname"><a href="../../da/d00/structast__xmpp__client__config.html#ad300470818476484645b03f3c0c66591">ast_xmpp_client_config::refresh_token</a></div><div class="ttdeci">const ast_string_field refresh_token</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d6b/res__xmpp_8c_source.html#l00456">res_xmpp.c:456</a></div></div>
<div class="ttc" id="test__http__media__cache_8c_html_a80c8e3ae5087d90d422675d034eeebc7"><div class="ttname"><a href="../../d4/d45/test__http__media__cache_8c.html#a80c8e3ae5087d90d422675d034eeebc7">options</a></div><div class="ttdeci">static struct test_options options</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d45/test__http__media__cache_8c_source.html#l00062">test_http_media_cache.c:62</a></div></div>
<div class="ttc" id="res__xmpp_8c_html_a65f7b336543acb8fb68f3f2b814d6b30"><div class="ttname"><a href="../../dc/d6b/res__xmpp_8c.html#a65f7b336543acb8fb68f3f2b814d6b30">xmpp_client_send_message</a></div><div class="ttdeci">static int xmpp_client_send_message(struct ast_xmpp_client *client, int group, const char *nick, const char *address, const char *message)</div><div class="ttdoc">Internal function used to send a message to a user or chatroom. </div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d6b/res__xmpp_8c_source.html#l00904">res_xmpp.c:904</a></div></div>
<div class="ttc" id="res__xmpp_8c_html_aead926c74102aaf5443a74bb5d3e2a68"><div class="ttname"><a href="../../dc/d6b/res__xmpp_8c.html#aead926c74102aaf5443a74bb5d3e2a68">xmpp_client_authenticate</a></div><div class="ttdeci">static int xmpp_client_authenticate(struct ast_xmpp_client *client, struct ast_xmpp_client_config *cfg, int type, iks *node)</div><div class="ttdoc">Internal function called when we need to authenticate. </div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d6b/res__xmpp_8c_source.html#l02760">res_xmpp.c:2760</a></div></div>
<div class="ttc" id="structast__xmpp__resource_html_acec9ce2df15222151ad66fcb1d74eb9f"><div class="ttname"><a href="../../d6/d90/structast__xmpp__resource.html#acec9ce2df15222151ad66fcb1d74eb9f">ast_xmpp_resource::priority</a></div><div class="ttdeci">int priority</div><div class="ttdef"><b>Definition:</b> <a href="../../da/da0/xmpp_8h_source.html#l00096">xmpp.h:96</a></div></div>
<div class="ttc" id="chan__alsa_8c_html_ac25ea00ee3f082df06e0cf468cbde240"><div class="ttname"><a href="../../da/d45/chan__alsa_8c.html#ac25ea00ee3f082df06e0cf468cbde240">context</a></div><div class="ttdeci">static char context[AST_MAX_CONTEXT]</div><div class="ttdef"><b>Definition:</b> <a href="../../da/d45/chan__alsa_8c_source.html#l00116">chan_alsa.c:116</a></div></div>
<div class="ttc" id="lock_8h_html_ab8977a71822daa556f19f30ba6eec765"><div class="ttname"><a href="../../dd/d42/lock_8h.html#ab8977a71822daa556f19f30ba6eec765">ast_mutex_destroy</a></div><div class="ttdeci">#define ast_mutex_destroy(a)</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d42/lock_8h_source.html#l00186">lock.h:186</a></div></div>
<div class="ttc" id="structast__xmpp__resource_html_a4ac032e592fb6d9cf9fdaf3e269fc433"><div class="ttname"><a href="../../d6/d90/structast__xmpp__resource.html#a4ac032e592fb6d9cf9fdaf3e269fc433">ast_xmpp_resource::caps</a></div><div class="ttdeci">struct ast_xmpp_capabilities caps</div><div class="ttdef"><b>Definition:</b> <a href="../../da/da0/xmpp_8h_source.html#l00097">xmpp.h:97</a></div></div>
<div class="ttc" id="message_8h_html_a13b928949f293c3b6b9ba3ebe8d64075"><div class="ttname"><a href="../../d2/d0d/message_8h.html#a13b928949f293c3b6b9ba3ebe8d64075">ast_msg_destroy</a></div><div class="ttdeci">struct ast_msg * ast_msg_destroy(struct ast_msg *msg)</div><div class="ttdoc">Destroy an ast_msg. </div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d6d/message_8c_source.html#l00448">message.c:448</a></div></div>
<div class="ttc" id="res__xmpp_8c_html_ab9ffec0b6972e567ecd01d93fcc19ec4"><div class="ttname"><a href="../../dc/d6b/res__xmpp_8c.html#ab9ffec0b6972e567ecd01d93fcc19ec4">xmpp_component_service_discovery_get_hook</a></div><div class="ttdeci">static int xmpp_component_service_discovery_get_hook(void *data, ikspak *pak)</div><div class="ttdoc">Hook function called when component receives a service discovery get message. </div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d6b/res__xmpp_8c_source.html#l02847">res_xmpp.c:2847</a></div></div>
<div class="ttc" id="res__xmpp_8c_html_ac5b95f02723021833cc47477b06a962ca2dbcf8f03775f69e9fd4b9dbab076ce9"><div class="ttname"><a href="../../dc/d6b/res__xmpp_8c.html#ac5b95f02723021833cc47477b06a962ca2dbcf8f03775f69e9fd4b9dbab076ce9">XMPP_PUBSUB</a></div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d6b/res__xmpp_8c_source.html#l00415">res_xmpp.c:415</a></div></div>
<div class="ttc" id="module_8h_html_a155a0df9c59e04e305d4a2fa3e35f843a835b27a90d895a488e4e14cc3d2dee8c"><div class="ttname"><a href="../../d5/d16/module_8h.html#a155a0df9c59e04e305d4a2fa3e35f843a835b27a90d895a488e4e14cc3d2dee8c">AST_MODFLAG_GLOBAL_SYMBOLS</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d16/module_8h_source.html#l00316">module.h:316</a></div></div>
<div class="ttc" id="structast__xmpp__client__config_html_a0246557045a820161e6e736a1b16f31f"><div class="ttname"><a href="../../da/d00/structast__xmpp__client__config.html#a0246557045a820161e6e736a1b16f31f">ast_xmpp_client_config::server</a></div><div class="ttdeci">const ast_string_field server</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d6b/res__xmpp_8c_source.html#l00456">res_xmpp.c:456</a></div></div>
<div class="ttc" id="res__xmpp_8c_html_aa6cfea569255dcae7c7f6b900dab4876"><div class="ttname"><a href="../../dc/d6b/res__xmpp_8c.html#aa6cfea569255dcae7c7f6b900dab4876">xmpp_pubsub_handle_error</a></div><div class="ttdeci">static int xmpp_pubsub_handle_error(void *data, ikspak *pak)</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d6b/res__xmpp_8c_source.html#l01507">res_xmpp.c:1507</a></div></div>
<div class="ttc" id="structast__mwi__state_html"><div class="ttname"><a href="../../d6/d45/structast__mwi__state.html">ast_mwi_state</a></div><div class="ttdoc">The structure that contains MWI state. </div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d33/mwi_8h_source.html#l00457">mwi.h:457</a></div></div>
<div class="ttc" id="res__config__ldap_8c_html_a75e4590043edf35241d30fabe2eda546"><div class="ttname"><a href="../../dc/d12/res__config__ldap_8c.html#a75e4590043edf35241d30fabe2eda546">url</a></div><div class="ttdeci">static char url[512]</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d12/res__config__ldap_8c_source.html#l00074">res_config_ldap.c:74</a></div></div>
<div class="ttc" id="manager_8h_html_a5b63b8a8faede2d852e071e1f7b31c11"><div class="ttname"><a href="../../db/d45/manager_8h.html#a5b63b8a8faede2d852e071e1f7b31c11">ast_manager_register_xml</a></div><div class="ttdeci">#define ast_manager_register_xml(action, authority, func)</div><div class="ttdoc">Register a manager callback using XML documentation to describe the manager. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/d45/manager_8h_source.html#l00186">manager.h:186</a></div></div>
<div class="ttc" id="endpoints_8h_html_a6a92006e96890f26789df16ae8a4994d"><div class="ttname"><a href="../../d4/d61/endpoints_8h.html#a6a92006e96890f26789df16ae8a4994d">ast_endpoint_shutdown</a></div><div class="ttdeci">void ast_endpoint_shutdown(struct ast_endpoint *endpoint)</div><div class="ttdoc">Shutsdown an ast_endpoint. </div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d4b/main_2endpoints_8c_source.html#l00350">main/endpoints.c:350</a></div></div>
<div class="ttc" id="module_8h_html_aba2c8d4be709a254658b21a834f8294a"><div class="ttname"><a href="../../d5/d16/module_8h.html#aba2c8d4be709a254658b21a834f8294a">ASTERISK_GPL_KEY</a></div><div class="ttdeci">#define ASTERISK_GPL_KEY</div><div class="ttdoc">The text the key() function should return. </div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d16/module_8h_source.html#l00046">module.h:46</a></div></div>
<div class="ttc" id="res__xmpp_8c_html_ae14a19eca8ea66ff91e63ea8f6cb33f4"><div class="ttname"><a href="../../dc/d6b/res__xmpp_8c.html#ae14a19eca8ea66ff91e63ea8f6cb33f4">xmpp_show_clients</a></div><div class="ttdeci">static char * xmpp_show_clients(struct ast_cli_entry *e, int cmd, struct ast_cli_args *a)</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d6b/res__xmpp_8c_source.html#l04338">res_xmpp.c:4338</a></div></div>
<div class="ttc" id="manager_8h_html_a1ef0ee0044dbbeb4c3a5abc6c046b208"><div class="ttname"><a href="../../db/d45/manager_8h.html#a1ef0ee0044dbbeb4c3a5abc6c046b208">manager_event</a></div><div class="ttdeci">#define manager_event(category, event, contents,...)</div><div class="ttdoc">External routines may send asterisk manager events this way. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/d45/manager_8h_source.html#l00248">manager.h:248</a></div></div>
<div class="ttc" id="res__xmpp_8c_html_a277607fa8955c1eb2c954d17d3d0ebaa"><div class="ttname"><a href="../../dc/d6b/res__xmpp_8c.html#a277607fa8955c1eb2c954d17d3d0ebaa">xmpp_client_find_or_create</a></div><div class="ttdeci">static void * xmpp_client_find_or_create(const char *category)</div><div class="ttdoc">Look up existing client or create a new one. </div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d6b/res__xmpp_8c_source.html#l00657">res_xmpp.c:657</a></div></div>
<div class="ttc" id="group__Group__AMI_html_ga31a02a7d3cc36aa66ebebdedfc574d1c"><div class="ttname"><a href="../../df/d72/group__Group__AMI.html#ga31a02a7d3cc36aa66ebebdedfc574d1c">astman_send_error</a></div><div class="ttdeci">void astman_send_error(struct mansession *s, const struct message *m, char *error)</div><div class="ttdoc">Send error in manager transaction. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d10/manager_8c_source.html#l03159">manager.c:3159</a></div></div>
<div class="ttc" id="module_8h_html"><div class="ttname"><a href="../../d5/d16/module_8h.html">module.h</a></div><div class="ttdoc">Asterisk module definitions. </div></div>
<div class="ttc" id="res__xmpp_8c_html_ad1982509765f4870f1f63412a53ea668"><div class="ttname"><a href="../../dc/d6b/res__xmpp_8c.html#ad1982509765f4870f1f63412a53ea668">reload</a></div><div class="ttdeci">static int reload(void)</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d6b/res__xmpp_8c_source.html#l04692">res_xmpp.c:4692</a></div></div>
<div class="ttc" id="res__xmpp_8c_html_a169296c840b246f178488ab5fdc8b498"><div class="ttname"><a href="../../dc/d6b/res__xmpp_8c.html#a169296c840b246f178488ab5fdc8b498">ast_xmpp_client_unref</a></div><div class="ttdeci">void ast_xmpp_client_unref(struct ast_xmpp_client *client)</div><div class="ttdoc">Release XMPP client connection reference. </div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d6b/res__xmpp_8c_source.html#l00888">res_xmpp.c:888</a></div></div>
<div class="ttc" id="structast__xmpp__global__config_html"><div class="ttname"><a href="../../da/d70/structast__xmpp__global__config.html">ast_xmpp_global_config</a></div><div class="ttdoc">XMPP Global Configuration. </div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d6b/res__xmpp_8c_source.html#l00438">res_xmpp.c:438</a></div></div>
<div class="ttc" id="res__xmpp_8c_html_ac515389ec6c63a8b3bbd094ede0d7c4d"><div class="ttname"><a href="../../dc/d6b/res__xmpp_8c.html#ac515389ec6c63a8b3bbd094ede0d7c4d">xmpp_client_change_state</a></div><div class="ttdeci">static void xmpp_client_change_state(struct ast_xmpp_client *client, int state)</div><div class="ttdoc">Internal function which changes the XMPP client state. </div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d6b/res__xmpp_8c_source.html#l00590">res_xmpp.c:590</a></div></div>
<div class="ttc" id="include_2asterisk_2app_8h_html_a80cd3f6f786b59b742bcecfc0b3be7c2"><div class="ttname"><a href="../../d3/d93/include_2asterisk_2app_8h.html#a80cd3f6f786b59b742bcecfc0b3be7c2">AST_DECLARE_APP_ARGS</a></div><div class="ttdeci">#define AST_DECLARE_APP_ARGS(name, arglist)</div><div class="ttdoc">Declare a structure to hold an application&amp;#39;s arguments. </div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d93/include_2asterisk_2app_8h_source.html#l01249">include/asterisk/app.h:1249</a></div></div>
<div class="ttc" id="stringfields_8h_html_abf60f862ae6a141d2f86a0f5e82792de"><div class="ttname"><a href="../../d1/d0f/stringfields_8h.html#abf60f862ae6a141d2f86a0f5e82792de">ast_string_field_free_memory</a></div><div class="ttdeci">#define ast_string_field_free_memory(x)</div><div class="ttdoc">free all memory - to be called before destroying the object </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d0f/stringfields_8h_source.html#l00368">stringfields.h:368</a></div></div>
<div class="ttc" id="include_2asterisk_2app_8h_html"><div class="ttname"><a href="../../d3/d93/include_2asterisk_2app_8h.html">app.h</a></div><div class="ttdoc">Application convenience functions, designed to give consistent look and feel to Asterisk apps...</div></div>
<div class="ttc" id="res__xmpp_8c_html_a651fdf11709558c6200662ad0e18fb28"><div class="ttname"><a href="../../dc/d6b/res__xmpp_8c.html#a651fdf11709558c6200662ad0e18fb28">fetch_access_token</a></div><div class="ttdeci">static int fetch_access_token(struct ast_xmpp_client_config *cfg)</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d6b/res__xmpp_8c_source.html#l03827">res_xmpp.c:3827</a></div></div>
<div class="ttc" id="res__xmpp_8c_html_a673106a2f8e9dfe9770923e9457d1483"><div class="ttname"><a href="../../dc/d6b/res__xmpp_8c.html#a673106a2f8e9dfe9770923e9457d1483">xmpp_component_authenticating</a></div><div class="ttdeci">static int xmpp_component_authenticating(struct ast_xmpp_client *client, struct ast_xmpp_client_config *cfg, int type, iks *node)</div><div class="ttdoc">Internal function called when we authenticated as a component. </div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d6b/res__xmpp_8c_source.html#l03093">res_xmpp.c:3093</a></div></div>
<div class="ttc" id="astobj2_8h_html_ad9d009e87e737af900825b36db55a35ca614744a4d36b3189d4ab5b02c8645d47"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#ad9d009e87e737af900825b36db55a35ca614744a4d36b3189d4ab5b02c8645d47">OBJ_MULTIPLE</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l01053">astobj2.h:1053</a></div></div>
<div class="ttc" id="res__xmpp_8c_html_a35b7847735c4ada0637abea6bb40f0fc"><div class="ttname"><a href="../../dc/d6b/res__xmpp_8c.html#a35b7847735c4ada0637abea6bb40f0fc">xmpp_component_authenticate</a></div><div class="ttdeci">static int xmpp_component_authenticate(struct ast_xmpp_client *client, struct ast_xmpp_client_config *cfg, int type, iks *node)</div><div class="ttdoc">Internal function called when we should authenticate as a component. </div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d6b/res__xmpp_8c_source.html#l02827">res_xmpp.c:2827</a></div></div>
<div class="ttc" id="group__StasisTopicsAndMessages_html_gaa1d7e6e6eb6d297e62f2d79dbdfaafb4"><div class="ttname"><a href="../../df/deb/group__StasisTopicsAndMessages.html#gaa1d7e6e6eb6d297e62f2d79dbdfaafb4">ast_mwi_state::eid</a></div><div class="ttdeci">struct ast_eid eid</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d33/mwi_8h_source.html#l00465">mwi.h:465</a></div></div>
<div class="ttc" id="astobj2_8h_html_a91d5d37d00874ae7a92d1a15c0a3b3a6"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#a91d5d37d00874ae7a92d1a15c0a3b3a6">ao2_iterator_init</a></div><div class="ttdeci">struct ao2_iterator ao2_iterator_init(struct ao2_container *c, int flags) attribute_warn_unused_result</div><div class="ttdoc">Create an iterator for a container. </div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d22/astobj2__container_8c_source.html#l00485">astobj2_container.c:485</a></div></div>
<div class="ttc" id="lock_8h_html_a6add1f30b2d53ca9384b15529a6f126e"><div class="ttname"><a href="../../dd/d42/lock_8h.html#a6add1f30b2d53ca9384b15529a6f126e">ast_cond_timedwait</a></div><div class="ttdeci">#define ast_cond_timedwait(cond, mutex, time)</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d42/lock_8h_source.html#l00204">lock.h:204</a></div></div>
<div class="ttc" id="pbx_8h_html_a8af0e93442a9e468425f63cc52b0ac7b"><div class="ttname"><a href="../../db/de0/pbx_8h.html#a8af0e93442a9e468425f63cc52b0ac7b">ast_custom_function_register</a></div><div class="ttdeci">#define ast_custom_function_register(acf)</div><div class="ttdoc">Register a custom function. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/de0/pbx_8h_source.html#l01508">pbx.h:1508</a></div></div>
<div class="ttc" id="structast__xmpp__client__config_html_afd35dbdf461b0fbd44e300eee66edebf"><div class="ttname"><a href="../../da/d00/structast__xmpp__client__config.html#afd35dbdf461b0fbd44e300eee66edebf">ast_xmpp_client_config::mod_flags</a></div><div class="ttdeci">struct ast_flags mod_flags</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d6b/res__xmpp_8c_source.html#l00461">res_xmpp.c:461</a></div></div>
<div class="ttc" id="res__xmpp_8c_html_a6b65b4b3c50fb1a3560fbafd70cf21bd"><div class="ttname"><a href="../../dc/d6b/res__xmpp_8c.html#a6b65b4b3c50fb1a3560fbafd70cf21bd">xmpp_pubsub_iq_create</a></div><div class="ttdeci">static iks * xmpp_pubsub_iq_create(struct ast_xmpp_client *client, const char *type)</div><div class="ttdoc">Create an IQ packet. </div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d6b/res__xmpp_8c_source.html#l01039">res_xmpp.c:1039</a></div></div>
<div class="ttc" id="structast__xmpp__resource_html_a8444d6e0dfe2bbab0b5e7b24308f1559"><div class="ttname"><a href="../../d6/d90/structast__xmpp__resource.html#a8444d6e0dfe2bbab0b5e7b24308f1559">ast_xmpp_resource::description</a></div><div class="ttdeci">char * description</div><div class="ttdef"><b>Definition:</b> <a href="../../da/da0/xmpp_8h_source.html#l00095">xmpp.h:95</a></div></div>
<div class="ttc" id="module_8h_html_afba4eb7a910b10969041ae4cd488729d"><div class="ttname"><a href="../../d5/d16/module_8h.html#afba4eb7a910b10969041ae4cd488729d">ast_register_application_xml</a></div><div class="ttdeci">#define ast_register_application_xml(app, execute)</div><div class="ttdoc">Register an application using XML documentation. </div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d16/module_8h_source.html#l00626">module.h:626</a></div></div>
<div class="ttc" id="res__xmpp_8c_html_a01f156e90984166f2bbcbcc5a4a6e582"><div class="ttname"><a href="../../dc/d6b/res__xmpp_8c.html#a01f156e90984166f2bbcbcc5a4a6e582">ast_xmpp_client_send</a></div><div class="ttdeci">int ast_xmpp_client_send(struct ast_xmpp_client *client, iks *stanza)</div><div class="ttdoc">Send an XML stanza out using an established XMPP client connection. </div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d6b/res__xmpp_8c_source.html#l02537">res_xmpp.c:2537</a></div></div>
<div class="ttc" id="structxmpp__config_html_a6de943884a1b221ba681176782c49393"><div class="ttname"><a href="../../de/d1c/structxmpp__config.html#a6de943884a1b221ba681176782c49393">xmpp_config::clients</a></div><div class="ttdeci">struct ao2_container * clients</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d6b/res__xmpp_8c_source.html#l00469">res_xmpp.c:469</a></div></div>
<div class="ttc" id="structast__mutex__info_html"><div class="ttname"><a href="../../d8/dc5/structast__mutex__info.html">ast_mutex_info</a></div><div class="ttdoc">Structure for mutex and tracking information. </div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d42/lock_8h_source.html#l00135">lock.h:135</a></div></div>
<div class="ttc" id="res__xmpp_8c_html_aa5e440109f4377b97485e07c65cc7f17"><div class="ttname"><a href="../../dc/d6b/res__xmpp_8c.html#aa5e440109f4377b97485e07c65cc7f17">xmpp_resource_is_available</a></div><div class="ttdeci">static int xmpp_resource_is_available(void *obj, void *arg, int flags)</div><div class="ttdoc">Callback function which returns when the resource is available. </div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d6b/res__xmpp_8c_source.html#l03224">res_xmpp.c:3224</a></div></div>
<div class="ttc" id="main_2utils_8c_html_a094cd85754f67592588ab5a0636cf0ea"><div class="ttname"><a href="../../de/d1f/main_2utils_8c.html#a094cd85754f67592588ab5a0636cf0ea">base64</a></div><div class="ttdeci">static char base64[64]</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d1f/main_2utils_8c_source.html#l00078">main/utils.c:78</a></div></div>
<div class="ttc" id="app__jack_8c_html_ac191e5810fa65e63095409471eb5648f"><div class="ttname"><a href="../../de/dcd/app__jack_8c.html#ac191e5810fa65e63095409471eb5648f">status</a></div><div class="ttdeci">jack_status_t status</div><div class="ttdef"><b>Definition:</b> <a href="../../de/dcd/app__jack_8c_source.html#l00146">app_jack.c:146</a></div></div>
<div class="ttc" id="res__xmpp_8c_html_adf0e01ed33114f9da5be8607ab81c741"><div class="ttname"><a href="../../dc/d6b/res__xmpp_8c.html#adf0e01ed33114f9da5be8607ab81c741">xmpp_client_set_group_presence</a></div><div class="ttdeci">static int xmpp_client_set_group_presence(struct ast_xmpp_client *client, const char *room, int level, const char *nick)</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d6b/res__xmpp_8c_source.html#l00968">res_xmpp.c:968</a></div></div>
<div class="ttc" id="res__xmpp_8c_html_a21d05f7d76693ba1145973de7d3f0a03"><div class="ttname"><a href="../../dc/d6b/res__xmpp_8c.html#a21d05f7d76693ba1145973de7d3f0a03">ast_xmpp_client_send_message</a></div><div class="ttdeci">int ast_xmpp_client_send_message(struct ast_xmpp_client *client, const char *user, const char *message)</div><div class="ttdoc">Send a message to a given user using an established XMPP client connection. </div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d6b/res__xmpp_8c_source.html#l00932">res_xmpp.c:932</a></div></div>
<div class="ttc" id="lock_8h_html_a873f9ce8c6287a32d48c83133e124418"><div class="ttname"><a href="../../dd/d42/lock_8h.html#a873f9ce8c6287a32d48c83133e124418">ast_mutex_unlock</a></div><div class="ttdeci">#define ast_mutex_unlock(a)</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d42/lock_8h_source.html#l00188">lock.h:188</a></div></div>
<div class="ttc" id="include_2asterisk_2app_8h_html_a037e9a5b28477b17e7c9acbe7ecb21d5"><div class="ttname"><a href="../../d3/d93/include_2asterisk_2app_8h.html#a037e9a5b28477b17e7c9acbe7ecb21d5">AST_APP_ARG</a></div><div class="ttdeci">#define AST_APP_ARG(name)</div><div class="ttdoc">Define an application argument. </div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d93/include_2asterisk_2app_8h_source.html#l01232">include/asterisk/app.h:1232</a></div></div>
<div class="ttc" id="strings_8h_html_a33ab7fa091d5513d8507d3bd33ef5b55"><div class="ttname"><a href="../../d6/d90/strings_8h.html#a33ab7fa091d5513d8507d3bd33ef5b55">ast_str_hash</a></div><div class="ttdeci">static force_inline int attribute_pure ast_str_hash(const char *str)</div><div class="ttdoc">Compute a hash value on a string. </div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d90/strings_8h_source.html#l01206">strings.h:1206</a></div></div>
<div class="ttc" id="stringfields_8h_html_a653461abd6e0d16e4e3326ab90e0501d"><div class="ttname"><a href="../../d1/d0f/stringfields_8h.html#a653461abd6e0d16e4e3326ab90e0501d">ast_string_field_set</a></div><div class="ttdeci">#define ast_string_field_set(x, field, data)</div><div class="ttdoc">Set a field to a simple string value. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d0f/stringfields_8h_source.html#l00514">stringfields.h:514</a></div></div>
<div class="ttc" id="test__linkedlists_8c_html_a13dd15487fee89a002d17ef3aff62d02"><div class="ttname"><a href="../../d7/d6f/test__linkedlists_8c.html#a13dd15487fee89a002d17ef3aff62d02">a</a></div><div class="ttdeci">static struct test_val a</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d6f/test__linkedlists_8c_source.html#l00046">test_linkedlists.c:46</a></div></div>
<div class="ttc" id="astobj2_8h_html_a1ad9f122bcae95a470639402faa3d2ee"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#a1ad9f122bcae95a470639402faa3d2ee">ao2_link</a></div><div class="ttdeci">#define ao2_link(container, obj)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l01549">astobj2.h:1549</a></div></div>
<div class="ttc" id="xmpp_8h_html_ae37d560c438576bdcb47347088225ee6ac443c6d96cc4879bf26ca95710628aad"><div class="ttname"><a href="../../da/da0/xmpp_8h.html#ae37d560c438576bdcb47347088225ee6ac443c6d96cc4879bf26ca95710628aad">XMPP_STATE_DISCONNECTING</a></div><div class="ttdef"><b>Definition:</b> <a href="../../da/da0/xmpp_8h_source.html#l00072">xmpp.h:72</a></div></div>
<div class="ttc" id="res__xmpp_8c_html_a98529e57f9646df0ba9f6db459cf1e93"><div class="ttname"><a href="../../dc/d6b/res__xmpp_8c.html#a98529e57f9646df0ba9f6db459cf1e93">xmpp_connect_hook</a></div><div class="ttdeci">static int xmpp_connect_hook(void *data, ikspak *pak)</div><div class="ttdoc">Hook function called when client finishes authenticating with the server. </div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d6b/res__xmpp_8c_source.html#l02436">res_xmpp.c:2436</a></div></div>
</div><!-- fragment --></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Sun Aug 8 2021 19:44:10 for Asterisk - The Open Source Telephony Project by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="../../doxygen.png" alt="doxygen"/>
</a> 1.8.13
</small></address>
</body>
</html>
