<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Asterisk - The Open Source Telephony Project: SIP transfer Support (REFER)</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Asterisk - The Open Source Telephony Project
   &#160;<span id="projectnumber">18.5.0</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "../../search",false,'Search');
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('../../',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">SIP transfer Support (REFER) </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>Handle incoming REFER request</p>
<p>REFER is used for call transfer in SIP. We get a REFER to place a new call with an INVITE somwhere and then keep the transferor up-to-date of the transfer. If the transfer fails, get back on line with the orginal call.</p>
<ul>
<li>REFER can be sent outside or inside of a dialog. Asterisk only accepts REFER inside of a dialog.</li>
<li>If we get a replaces header, it is an attended transfer</li>
</ul>
<dl class="section user"><dt>Blind transfers</dt><dd>The transferor provides the transferee with the transfer targets contact. The signalling between transferer or transferee should not be cancelled, so the call is recoverable if the transfer target can not be reached by the transferee.</dd></dl>
<p>In this case, Asterisk receives a TRANSFER from the transferor, thus is the transferee. We should try to set up a call to the contact provided and if that fails, re-connect the current session. If the new call is set up, we issue a hangup. In this scenario, we are following section 5.2 in the SIP CC Transfer draft. (Transfer without a GRUU)</p>
<dl class="section user"><dt>Transfer with consultation hold</dt><dd>In this case, the transferor talks to the transfer target before the transfer takes place. This is implemented with SIP hold and transfer. Note: The invite From: string could indicate a transfer. (Section 6. Transfer with consultation hold) The transferor places the transferee on hold, starts a call with the transfer target to alert them to the impending transfer, terminates the connection with the target, then proceeds with the transfer (as in Blind transfer above)</dd></dl>
<dl class="section user"><dt>Attended transfer</dt><dd>The transferor places the transferee on hold, calls the transfer target to alert them, places the target on hold, then proceeds with the transfer using a Replaces header field in the Refer-to header. This will force the transfee to send an Invite to the target, with a replaces header that instructs the target to hangup the call between the transferor and the target. In this case, the Refer/to: uses the AOR address. (The same URI that the transferee used to establish the session with the transfer target (To: ). The Require: replaces header should be in the INVITE to avoid the wrong UA in a forked SIP proxy scenario to answer and have no call to replace with.</dd></dl>
<p>The referred-by header is <em>NOT</em> required, but if we get it, can be copied into the INVITE to the transfer target to inform the target about the transferor</p>
<p>"Any REFER request has to be appropriately authenticated.".</p>
<p>We can't destroy dialogs, since we want the call to continue. </p>
</div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Sun Aug 8 2021 19:47:03 for Asterisk - The Open Source Telephony Project by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="../../doxygen.png" alt="doxygen"/>
</a> 1.8.13
</small></address>
</body>
</html>
