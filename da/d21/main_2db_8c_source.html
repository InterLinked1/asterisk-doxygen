<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Asterisk - The Open Source Telephony Project: db.c Source File</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Asterisk - The Open Source Telephony Project
   &#160;<span id="projectnumber">18.5.0</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "../../search",false,'Search');
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('../../',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="../../dir_5c982d53a68cdbcd421152b4020263a9.html">main</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">main/db.c</div>  </div>
</div><!--header-->
<div class="contents">
<a href="../../da/d21/main_2db_8c.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="comment">/*</span></div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="comment"> * Asterisk -- An open source telephony toolkit.</span></div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="comment"> * Copyright (C) 1999 - 2005, Digium, Inc.</span></div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="comment"> * Mark Spencer &lt;markster@digium.com&gt;</span></div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="comment"> * See http://www.asterisk.org for more information about</span></div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="comment"> * the Asterisk project. Please do not directly contact</span></div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;<span class="comment"> * any of the maintainers of this project for assistance;</span></div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;<span class="comment"> * the project provides a web site, mailing lists and IRC</span></div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;<span class="comment"> * channels for your use.</span></div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;<span class="comment"> * This program is free software, distributed under the terms of</span></div><div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;<span class="comment"> * the GNU General Public License Version 2. See the LICENSE file</span></div><div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;<span class="comment"> * at the top of the source tree.</span></div><div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;<span class="comment">/*! \file</span></div><div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;<span class="comment"> * \brief ASTdb Management</span></div><div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;<span class="comment"> * \author Mark Spencer &lt;markster@digium.com&gt;</span></div><div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;<span class="comment"> * \note DB3 is licensed under Sleepycat Public License and is thus incompatible</span></div><div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;<span class="comment"> * with GPL.  To avoid having to make another exception (and complicate</span></div><div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;<span class="comment"> * licensing even further) we elect to use DB1 which is BSD licensed</span></div><div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;</div><div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;<span class="comment">/*** MODULEINFO</span></div><div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;<span class="comment">   &lt;support_level&gt;core&lt;/support_level&gt;</span></div><div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;<span class="comment"> ***/</span></div><div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;</div><div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../db/db2/asterisk_8h.html">asterisk.h</a>&quot;</span></div><div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;</div><div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../d4/d78/__private_8h.html">asterisk/_private.h</a>&quot;</span></div><div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../dd/df2/paths_8h.html">asterisk/paths.h</a>&quot;</span>   <span class="comment">/* use ast_config_AST_DB */</span></div><div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;<span class="preprocessor">#include &lt;sys/time.h&gt;</span></div><div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;<span class="preprocessor">#include &lt;sys/types.h&gt;</span></div><div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;<span class="preprocessor">#include &lt;sys/stat.h&gt;</span></div><div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;<span class="preprocessor">#include &lt;unistd.h&gt;</span></div><div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;<span class="preprocessor">#include &lt;signal.h&gt;</span></div><div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;<span class="preprocessor">#include &lt;dirent.h&gt;</span></div><div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;<span class="preprocessor">#include &lt;sqlite3.h&gt;</span></div><div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;</div><div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../d5/d7b/channel_8h.html">asterisk/channel.h</a>&quot;</span></div><div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../d2/d4d/file_8h.html">asterisk/file.h</a>&quot;</span></div><div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../d3/d93/include_2asterisk_2app_8h.html">asterisk/app.h</a>&quot;</span></div><div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../d3/d08/dsp_8h.html">asterisk/dsp.h</a>&quot;</span></div><div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../de/d4a/astdb_8h.html">asterisk/astdb.h</a>&quot;</span></div><div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../dc/db0/cli_8h.html">asterisk/cli.h</a>&quot;</span></div><div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../d5/d60/utils_8h.html">asterisk/utils.h</a>&quot;</span></div><div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../db/d45/manager_8h.html">asterisk/manager.h</a>&quot;</span></div><div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;</div><div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;<span class="comment">/*** DOCUMENTATION</span></div><div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;<span class="comment">   &lt;manager name=&quot;DBGet&quot; language=&quot;en_US&quot;&gt;</span></div><div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;<span class="comment">      &lt;synopsis&gt;</span></div><div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;<span class="comment">         Get DB Entry.</span></div><div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;<span class="comment">      &lt;/synopsis&gt;</span></div><div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;<span class="comment">      &lt;syntax&gt;</span></div><div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;<span class="comment">         &lt;xi:include xpointer=&quot;xpointer(/docs/manager[@name=&#39;Login&#39;]/syntax/parameter[@name=&#39;ActionID&#39;])&quot; /&gt;</span></div><div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;<span class="comment">         &lt;parameter name=&quot;Family&quot; required=&quot;true&quot; /&gt;</span></div><div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;<span class="comment">         &lt;parameter name=&quot;Key&quot; required=&quot;true&quot; /&gt;</span></div><div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;<span class="comment">      &lt;/syntax&gt;</span></div><div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;<span class="comment">      &lt;description&gt;</span></div><div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;<span class="comment">      &lt;/description&gt;</span></div><div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;<span class="comment">   &lt;/manager&gt;</span></div><div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;<span class="comment">   &lt;manager name=&quot;DBPut&quot; language=&quot;en_US&quot;&gt;</span></div><div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;<span class="comment">      &lt;synopsis&gt;</span></div><div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;<span class="comment">         Put DB entry.</span></div><div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;<span class="comment">      &lt;/synopsis&gt;</span></div><div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;<span class="comment">      &lt;syntax&gt;</span></div><div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;<span class="comment">         &lt;xi:include xpointer=&quot;xpointer(/docs/manager[@name=&#39;Login&#39;]/syntax/parameter[@name=&#39;ActionID&#39;])&quot; /&gt;</span></div><div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;<span class="comment">         &lt;parameter name=&quot;Family&quot; required=&quot;true&quot; /&gt;</span></div><div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;<span class="comment">         &lt;parameter name=&quot;Key&quot; required=&quot;true&quot; /&gt;</span></div><div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;<span class="comment">         &lt;parameter name=&quot;Val&quot; /&gt;</span></div><div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;<span class="comment">      &lt;/syntax&gt;</span></div><div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;<span class="comment">      &lt;description&gt;</span></div><div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;<span class="comment">      &lt;/description&gt;</span></div><div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;<span class="comment">   &lt;/manager&gt;</span></div><div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;<span class="comment">   &lt;manager name=&quot;DBDel&quot; language=&quot;en_US&quot;&gt;</span></div><div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;<span class="comment">      &lt;synopsis&gt;</span></div><div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;<span class="comment">         Delete DB entry.</span></div><div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;<span class="comment">      &lt;/synopsis&gt;</span></div><div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;<span class="comment">      &lt;syntax&gt;</span></div><div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;<span class="comment">         &lt;xi:include xpointer=&quot;xpointer(/docs/manager[@name=&#39;Login&#39;]/syntax/parameter[@name=&#39;ActionID&#39;])&quot; /&gt;</span></div><div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;<span class="comment">         &lt;parameter name=&quot;Family&quot; required=&quot;true&quot; /&gt;</span></div><div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;<span class="comment">         &lt;parameter name=&quot;Key&quot; required=&quot;true&quot; /&gt;</span></div><div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;<span class="comment">      &lt;/syntax&gt;</span></div><div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;<span class="comment">      &lt;description&gt;</span></div><div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;<span class="comment">      &lt;/description&gt;</span></div><div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;<span class="comment">   &lt;/manager&gt;</span></div><div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;<span class="comment">   &lt;manager name=&quot;DBDelTree&quot; language=&quot;en_US&quot;&gt;</span></div><div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;<span class="comment">      &lt;synopsis&gt;</span></div><div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;<span class="comment">         Delete DB Tree.</span></div><div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;<span class="comment">      &lt;/synopsis&gt;</span></div><div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;<span class="comment">      &lt;syntax&gt;</span></div><div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;<span class="comment">         &lt;xi:include xpointer=&quot;xpointer(/docs/manager[@name=&#39;Login&#39;]/syntax/parameter[@name=&#39;ActionID&#39;])&quot; /&gt;</span></div><div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;<span class="comment">         &lt;parameter name=&quot;Family&quot; required=&quot;true&quot; /&gt;</span></div><div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;<span class="comment">         &lt;parameter name=&quot;Key&quot; /&gt;</span></div><div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;<span class="comment">      &lt;/syntax&gt;</span></div><div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;<span class="comment">      &lt;description&gt;</span></div><div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;<span class="comment">      &lt;/description&gt;</span></div><div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;<span class="comment">   &lt;/manager&gt;</span></div><div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;<span class="comment"> ***/</span></div><div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;</div><div class="line"><a name="l00107"></a><span class="lineno"><a class="line" href="../../da/d21/main_2db_8c.html#afe1f0caaa1c711f16bb23bfcc54ff386">  107</a></span>&#160;<span class="preprocessor">#define MAX_DB_FIELD 256</span></div><div class="line"><a name="l00108"></a><span class="lineno"><a class="line" href="../../da/d21/main_2db_8c.html#a885611b04f0f81cde233f5648aa58b7c">  108</a></span>&#160;<a class="code" href="../../dd/d42/lock_8h.html#ac840092853644cea0a186efdc58985f5">AST_MUTEX_DEFINE_STATIC</a>(<a class="code" href="../../da/d21/main_2db_8c.html#a885611b04f0f81cde233f5648aa58b7c">dblock</a>);</div><div class="line"><a name="l00109"></a><span class="lineno"><a class="line" href="../../da/d21/main_2db_8c.html#aa6604f5f92051f2351cd9a350d5f6284">  109</a></span>&#160;<span class="keyword">static</span> <a class="code" href="../../dd/d42/lock_8h.html#ab134d98cdfe7de0f7a72b377c0765dc7">ast_cond_t</a> <a class="code" href="../../da/d21/main_2db_8c.html#aa6604f5f92051f2351cd9a350d5f6284">dbcond</a>;</div><div class="line"><a name="l00110"></a><span class="lineno"><a class="line" href="../../da/d21/main_2db_8c.html#a59f6376a471012a10b27b3e902256be0">  110</a></span>&#160;<span class="keyword">static</span> sqlite3 *<a class="code" href="../../da/d21/main_2db_8c.html#a59f6376a471012a10b27b3e902256be0">astdb</a>;</div><div class="line"><a name="l00111"></a><span class="lineno"><a class="line" href="../../da/d21/main_2db_8c.html#ac332fd073c41ceb9b1826af8791b241b">  111</a></span>&#160;<span class="keyword">static</span> pthread_t <a class="code" href="../../da/d21/main_2db_8c.html#ac332fd073c41ceb9b1826af8791b241b">syncthread</a>;</div><div class="line"><a name="l00112"></a><span class="lineno"><a class="line" href="../../da/d21/main_2db_8c.html#a0e55a773a7175671526f96f16cc0fabd">  112</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../da/d21/main_2db_8c.html#a0e55a773a7175671526f96f16cc0fabd">doexit</a>;</div><div class="line"><a name="l00113"></a><span class="lineno"><a class="line" href="../../da/d21/main_2db_8c.html#abdf814ae947ec73f933c8f8839916d68">  113</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../da/d21/main_2db_8c.html#abdf814ae947ec73f933c8f8839916d68">dosync</a>;</div><div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;</div><div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../da/d21/main_2db_8c.html#a0a19fc05bc020876fec791200e169eb2">db_sync</a>(<span class="keywordtype">void</span>);</div><div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;</div><div class="line"><a name="l00117"></a><span class="lineno"><a class="line" href="../../da/d21/main_2db_8c.html#a9fe361bde1b07f7f0331bbd3fe482d88">  117</a></span>&#160;<span class="preprocessor">#define DEFINE_SQL_STATEMENT(stmt,sql) static sqlite3_stmt *stmt; \</span></div><div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;<span class="preprocessor">   const char stmt##_sql[] = sql;</span></div><div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;</div><div class="line"><a name="l00120"></a><span class="lineno"><a class="line" href="../../da/d21/main_2db_8c.html#a201034315922e6445fe90541a78e981f">  120</a></span>&#160;<a class="code" href="../../da/d21/main_2db_8c.html#a9fe361bde1b07f7f0331bbd3fe482d88">DEFINE_SQL_STATEMENT</a>(put_stmt, <span class="stringliteral">&quot;INSERT OR REPLACE INTO astdb (key, value) VALUES (?, ?)&quot;</span>)</div><div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;<a class="code" href="../../da/d21/main_2db_8c.html#a9fe361bde1b07f7f0331bbd3fe482d88">DEFINE_SQL_STATEMENT</a>(get_stmt, &quot;SELECT <a class="code" href="../../d4/d2f/syslog_8c.html#ac4f474c82e82cbb89ca7c36dd52be0ed">value</a> FROM <a class="code" href="../../da/d21/main_2db_8c.html#a59f6376a471012a10b27b3e902256be0">astdb</a> WHERE key=?&quot;)</div><div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;<a class="code" href="../../da/d21/main_2db_8c.html#a9fe361bde1b07f7f0331bbd3fe482d88">DEFINE_SQL_STATEMENT</a>(del_stmt, &quot;<a class="code" href="../../dc/df4/app__voicemail_8c.html#a6f612696ee3ef9e74363b000efc92122">DELETE</a> FROM <a class="code" href="../../da/d21/main_2db_8c.html#a59f6376a471012a10b27b3e902256be0">astdb</a> WHERE key=?&quot;)</div><div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;<a class="code" href="../../da/d21/main_2db_8c.html#a9fe361bde1b07f7f0331bbd3fe482d88">DEFINE_SQL_STATEMENT</a>(deltree_stmt, &quot;<a class="code" href="../../dc/df4/app__voicemail_8c.html#a6f612696ee3ef9e74363b000efc92122">DELETE</a> FROM <a class="code" href="../../da/d21/main_2db_8c.html#a59f6376a471012a10b27b3e902256be0">astdb</a> WHERE key || &#39;/&#39; LIKE ? || &#39;/&#39; || &#39;%&#39;&quot;)</div><div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;<a class="code" href="../../da/d21/main_2db_8c.html#a9fe361bde1b07f7f0331bbd3fe482d88">DEFINE_SQL_STATEMENT</a>(deltree_all_stmt, &quot;<a class="code" href="../../dc/df4/app__voicemail_8c.html#a6f612696ee3ef9e74363b000efc92122">DELETE</a> FROM <a class="code" href="../../da/d21/main_2db_8c.html#a59f6376a471012a10b27b3e902256be0">astdb</a>&quot;)</div><div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;<a class="code" href="../../da/d21/main_2db_8c.html#a9fe361bde1b07f7f0331bbd3fe482d88">DEFINE_SQL_STATEMENT</a>(gettree_stmt, &quot;SELECT key, <a class="code" href="../../d4/d2f/syslog_8c.html#ac4f474c82e82cbb89ca7c36dd52be0ed">value</a> FROM <a class="code" href="../../da/d21/main_2db_8c.html#a59f6376a471012a10b27b3e902256be0">astdb</a> WHERE key || &#39;/&#39; LIKE ? || &#39;/&#39; || &#39;%&#39; ORDER BY key&quot;)</div><div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;<a class="code" href="../../da/d21/main_2db_8c.html#a9fe361bde1b07f7f0331bbd3fe482d88">DEFINE_SQL_STATEMENT</a>(gettree_all_stmt, &quot;SELECT key, <a class="code" href="../../d4/d2f/syslog_8c.html#ac4f474c82e82cbb89ca7c36dd52be0ed">value</a> FROM <a class="code" href="../../da/d21/main_2db_8c.html#a59f6376a471012a10b27b3e902256be0">astdb</a> ORDER BY key&quot;)</div><div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;<a class="code" href="../../da/d21/main_2db_8c.html#a9fe361bde1b07f7f0331bbd3fe482d88">DEFINE_SQL_STATEMENT</a>(showkey_stmt, &quot;SELECT key, <a class="code" href="../../d4/d2f/syslog_8c.html#ac4f474c82e82cbb89ca7c36dd52be0ed">value</a> FROM <a class="code" href="../../da/d21/main_2db_8c.html#a59f6376a471012a10b27b3e902256be0">astdb</a> WHERE key LIKE &#39;%&#39; || &#39;/&#39; || ? ORDER BY key&quot;)</div><div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;<a class="code" href="../../da/d21/main_2db_8c.html#a9fe361bde1b07f7f0331bbd3fe482d88">DEFINE_SQL_STATEMENT</a>(create_astdb_stmt, &quot;CREATE TABLE IF NOT <a class="code" href="../../dc/df4/app__voicemail_8c.html#a0aef50eb58931d34f6a6d4ad18182d7c">EXISTS</a> <a class="code" href="../../da/d21/main_2db_8c.html#a59f6376a471012a10b27b3e902256be0">astdb</a>(key VARCHAR(256), <a class="code" href="../../d4/d2f/syslog_8c.html#ac4f474c82e82cbb89ca7c36dd52be0ed">value</a> VARCHAR(256), PRIMARY <a class="code" href="../../db/dbb/test__db_8c.html#aafd99d3f4de9ecd56b7b03f5fb70e8d2a147e71049e3285d642d0d5268dba260f">KEY</a>(key))&quot;)</div><div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;</div><div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;<span class="comment">/* This query begs an explanation:</span></div><div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;<span class="comment"> * First, the parameter binding syntax used here is slightly different than the other</span></div><div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;<span class="comment"> * queries in that we use a numbered parameter so that we can bind once and get the same</span></div><div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;<span class="comment"> * value substituted multiple times within the executed query.</span></div><div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;<span class="comment"> * Second, the key comparison is being used to find all keys that are lexicographically</span></div><div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;<span class="comment"> * greater than the provided key, but less than the provided key with a high (but</span></div><div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;<span class="comment"> * invalid) Unicode codepoint appended to it. This will give us all keys in the database</span></div><div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;<span class="comment"> * that have &#39;key&#39; as a prefix and performs much better than the equivalent &quot;LIKE key ||</span></div><div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;<span class="comment"> * &#39;%&#39;&quot; operation.</span></div><div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;<a class="code" href="../../da/d21/main_2db_8c.html#a9fe361bde1b07f7f0331bbd3fe482d88">DEFINE_SQL_STATEMENT</a>(gettree_prefix_stmt, &quot;SELECT key, <a class="code" href="../../d4/d2f/syslog_8c.html#ac4f474c82e82cbb89ca7c36dd52be0ed">value</a> FROM <a class="code" href="../../da/d21/main_2db_8c.html#a59f6376a471012a10b27b3e902256be0">astdb</a> WHERE key &gt; ?1 AND key &lt;= ?1 || X&#39;ffff&#39;&quot;)</div><div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;</div><div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;static <span class="keywordtype">int</span> <a class="code" href="../../de/d8b/astdb2sqlite3_8c.html#afc11762d7334c2e8f24d0df9c5560cec">init_stmt</a>(sqlite3_stmt **stmt, const <span class="keywordtype">char</span> *sql, <span class="keywordtype">size_t</span> <a class="code" href="../../d9/d1e/func__strings_8c.html#af24e73aaf92f3000fda15d285e66df24">len</a>)</div><div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;{</div><div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;   <a class="code" href="../../dd/d42/lock_8h.html#ac5e13c7fe64d3b271a52028b0a78b92b">ast_mutex_lock</a>(&amp;<a class="code" href="../../da/d21/main_2db_8c.html#a885611b04f0f81cde233f5648aa58b7c">dblock</a>);</div><div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;   <span class="keywordflow">if</span> (sqlite3_prepare(<a class="code" href="../../da/d21/main_2db_8c.html#a59f6376a471012a10b27b3e902256be0">astdb</a>, sql, len, stmt, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) != SQLITE_OK) {</div><div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Couldn&#39;t prepare statement &#39;%s&#39;: %s\n&quot;</span>, sql, sqlite3_errmsg(<a class="code" href="../../da/d21/main_2db_8c.html#a59f6376a471012a10b27b3e902256be0">astdb</a>));</div><div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;      <a class="code" href="../../dd/d42/lock_8h.html#a873f9ce8c6287a32d48c83133e124418">ast_mutex_unlock</a>(&amp;<a class="code" href="../../da/d21/main_2db_8c.html#a885611b04f0f81cde233f5648aa58b7c">dblock</a>);</div><div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;   }</div><div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;   <a class="code" href="../../dd/d42/lock_8h.html#a873f9ce8c6287a32d48c83133e124418">ast_mutex_unlock</a>(&amp;<a class="code" href="../../da/d21/main_2db_8c.html#a885611b04f0f81cde233f5648aa58b7c">dblock</a>);</div><div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;</div><div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;   <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;}</div><div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;<span class="comment">/*! \internal</span></div><div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;<span class="comment"> * \brief Clean up the prepared SQLite3 statement</span></div><div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;<span class="comment"> * \note dblock should already be locked prior to calling this method</span></div><div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00161"></a><span class="lineno"><a class="line" href="../../da/d21/main_2db_8c.html#ae762c18aae8214fa4ceab417742bd19e">  161</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../da/d21/main_2db_8c.html#ae762c18aae8214fa4ceab417742bd19e">clean_stmt</a>(sqlite3_stmt **stmt, <span class="keyword">const</span> <span class="keywordtype">char</span> *sql)</div><div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;{</div><div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;   <span class="keywordflow">if</span> (sqlite3_finalize(*stmt) != SQLITE_OK) {</div><div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Couldn&#39;t finalize statement &#39;%s&#39;: %s\n&quot;</span>, sql, sqlite3_errmsg(<a class="code" href="../../da/d21/main_2db_8c.html#a59f6376a471012a10b27b3e902256be0">astdb</a>));</div><div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;      *stmt = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;   }</div><div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;   *stmt = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;   <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;}</div><div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;<span class="comment">/*! \internal</span></div><div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;<span class="comment"> * \brief Clean up all prepared SQLite3 statements</span></div><div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;<span class="comment"> * \note dblock should already be locked prior to calling this method</span></div><div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00176"></a><span class="lineno"><a class="line" href="../../da/d21/main_2db_8c.html#a113d1cff6b7f6ff34c7adf7d6ee6dfc8">  176</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../da/d21/main_2db_8c.html#a113d1cff6b7f6ff34c7adf7d6ee6dfc8">clean_statements</a>(<span class="keywordtype">void</span>)</div><div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;{</div><div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;   <a class="code" href="../../da/d21/main_2db_8c.html#ae762c18aae8214fa4ceab417742bd19e">clean_stmt</a>(&amp;get_stmt, get_stmt_sql);</div><div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;   <a class="code" href="../../da/d21/main_2db_8c.html#ae762c18aae8214fa4ceab417742bd19e">clean_stmt</a>(&amp;del_stmt, del_stmt_sql);</div><div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;   <a class="code" href="../../da/d21/main_2db_8c.html#ae762c18aae8214fa4ceab417742bd19e">clean_stmt</a>(&amp;deltree_stmt, deltree_stmt_sql);</div><div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;   <a class="code" href="../../da/d21/main_2db_8c.html#ae762c18aae8214fa4ceab417742bd19e">clean_stmt</a>(&amp;deltree_all_stmt, deltree_all_stmt_sql);</div><div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;   <a class="code" href="../../da/d21/main_2db_8c.html#ae762c18aae8214fa4ceab417742bd19e">clean_stmt</a>(&amp;gettree_stmt, gettree_stmt_sql);</div><div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;   <a class="code" href="../../da/d21/main_2db_8c.html#ae762c18aae8214fa4ceab417742bd19e">clean_stmt</a>(&amp;gettree_all_stmt, gettree_all_stmt_sql);</div><div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;   <a class="code" href="../../da/d21/main_2db_8c.html#ae762c18aae8214fa4ceab417742bd19e">clean_stmt</a>(&amp;gettree_prefix_stmt, gettree_prefix_stmt_sql);</div><div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;   <a class="code" href="../../da/d21/main_2db_8c.html#ae762c18aae8214fa4ceab417742bd19e">clean_stmt</a>(&amp;showkey_stmt, showkey_stmt_sql);</div><div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;   <a class="code" href="../../da/d21/main_2db_8c.html#ae762c18aae8214fa4ceab417742bd19e">clean_stmt</a>(&amp;put_stmt, put_stmt_sql);</div><div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;   <a class="code" href="../../da/d21/main_2db_8c.html#ae762c18aae8214fa4ceab417742bd19e">clean_stmt</a>(&amp;create_astdb_stmt, create_astdb_stmt_sql);</div><div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;}</div><div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;</div><div class="line"><a name="l00190"></a><span class="lineno"><a class="line" href="../../da/d21/main_2db_8c.html#ae171d616861e08d90bf27ba78d300581">  190</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../da/d21/main_2db_8c.html#ae171d616861e08d90bf27ba78d300581">init_statements</a>(<span class="keywordtype">void</span>)</div><div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;{</div><div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;   <span class="comment">/* Don&#39;t initialize create_astdb_statement here as the astdb table needs to exist</span></div><div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;<span class="comment">    * brefore these statements can be initialized */</span></div><div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;   <span class="keywordflow">return</span> <a class="code" href="../../de/d8b/astdb2sqlite3_8c.html#afc11762d7334c2e8f24d0df9c5560cec">init_stmt</a>(&amp;get_stmt, get_stmt_sql, <span class="keyword">sizeof</span>(get_stmt_sql))</div><div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;   || <a class="code" href="../../de/d8b/astdb2sqlite3_8c.html#afc11762d7334c2e8f24d0df9c5560cec">init_stmt</a>(&amp;del_stmt, del_stmt_sql, <span class="keyword">sizeof</span>(del_stmt_sql))</div><div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;   || <a class="code" href="../../de/d8b/astdb2sqlite3_8c.html#afc11762d7334c2e8f24d0df9c5560cec">init_stmt</a>(&amp;deltree_stmt, deltree_stmt_sql, <span class="keyword">sizeof</span>(deltree_stmt_sql))</div><div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;   || <a class="code" href="../../de/d8b/astdb2sqlite3_8c.html#afc11762d7334c2e8f24d0df9c5560cec">init_stmt</a>(&amp;deltree_all_stmt, deltree_all_stmt_sql, <span class="keyword">sizeof</span>(deltree_all_stmt_sql))</div><div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;   || <a class="code" href="../../de/d8b/astdb2sqlite3_8c.html#afc11762d7334c2e8f24d0df9c5560cec">init_stmt</a>(&amp;gettree_stmt, gettree_stmt_sql, <span class="keyword">sizeof</span>(gettree_stmt_sql))</div><div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;   || <a class="code" href="../../de/d8b/astdb2sqlite3_8c.html#afc11762d7334c2e8f24d0df9c5560cec">init_stmt</a>(&amp;gettree_all_stmt, gettree_all_stmt_sql, <span class="keyword">sizeof</span>(gettree_all_stmt_sql))</div><div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;   || <a class="code" href="../../de/d8b/astdb2sqlite3_8c.html#afc11762d7334c2e8f24d0df9c5560cec">init_stmt</a>(&amp;gettree_prefix_stmt, gettree_prefix_stmt_sql, <span class="keyword">sizeof</span>(gettree_prefix_stmt_sql))</div><div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;   || <a class="code" href="../../de/d8b/astdb2sqlite3_8c.html#afc11762d7334c2e8f24d0df9c5560cec">init_stmt</a>(&amp;showkey_stmt, showkey_stmt_sql, <span class="keyword">sizeof</span>(showkey_stmt_sql))</div><div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;   || <a class="code" href="../../de/d8b/astdb2sqlite3_8c.html#afc11762d7334c2e8f24d0df9c5560cec">init_stmt</a>(&amp;put_stmt, put_stmt_sql, <span class="keyword">sizeof</span>(put_stmt_sql));</div><div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;}</div><div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;</div><div class="line"><a name="l00205"></a><span class="lineno"><a class="line" href="../../da/d21/main_2db_8c.html#a5b3a44a41cbaf00d3c93de1a253aa642">  205</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../da/d21/main_2db_8c.html#a5b3a44a41cbaf00d3c93de1a253aa642">convert_bdb_to_sqlite3</a>(<span class="keywordtype">void</span>)</div><div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;{</div><div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;   <span class="keywordtype">char</span> *cmd;</div><div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;   <span class="keywordtype">int</span> res;</div><div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;</div><div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;   res = <a class="code" href="../../d8/d8a/astmm_8h.html#ada667b6f84a08e6848cb37c5ffb94a5f">ast_asprintf</a>(&amp;cmd, <span class="stringliteral">&quot;%s/astdb2sqlite3 &#39;%s&#39;\n&quot;</span>, <a class="code" href="../../dd/df2/paths_8h.html#abd1a940d0d1399a0bf6714fe156443ce">ast_config_AST_SBIN_DIR</a>, <a class="code" href="../../dd/df2/paths_8h.html#af89b8aa53d5b08a03b56f5163805bd97">ast_config_AST_DB</a>);</div><div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;   <span class="keywordflow">if</span> (0 &lt;= res) {</div><div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;      res = <a class="code" href="../../d3/d93/include_2asterisk_2app_8h.html#a9fb5cf0385848033ee3e98625e5f9784">ast_safe_system</a>(cmd);</div><div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;      <a class="code" href="../../d8/d8a/astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(cmd);</div><div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;   }</div><div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;</div><div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;   <span class="keywordflow">return</span> res;</div><div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;}</div><div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;</div><div class="line"><a name="l00219"></a><span class="lineno"><a class="line" href="../../da/d21/main_2db_8c.html#a6e6da68c88e22a65dbe728653ceef20f">  219</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../da/d21/main_2db_8c.html#a6e6da68c88e22a65dbe728653ceef20f">db_create_astdb</a>(<span class="keywordtype">void</span>)</div><div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;{</div><div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;   <span class="keywordtype">int</span> res = 0;</div><div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;</div><div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;   <span class="keywordflow">if</span> (!create_astdb_stmt) {</div><div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;      <a class="code" href="../../de/d8b/astdb2sqlite3_8c.html#afc11762d7334c2e8f24d0df9c5560cec">init_stmt</a>(&amp;create_astdb_stmt, create_astdb_stmt_sql, <span class="keyword">sizeof</span>(create_astdb_stmt_sql));</div><div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;   }</div><div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;</div><div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;   <a class="code" href="../../dd/d42/lock_8h.html#ac5e13c7fe64d3b271a52028b0a78b92b">ast_mutex_lock</a>(&amp;<a class="code" href="../../da/d21/main_2db_8c.html#a885611b04f0f81cde233f5648aa58b7c">dblock</a>);</div><div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;   <span class="keywordflow">if</span> (sqlite3_step(create_astdb_stmt) != SQLITE_DONE) {</div><div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Couldn&#39;t create astdb table: %s\n&quot;</span>, sqlite3_errmsg(<a class="code" href="../../da/d21/main_2db_8c.html#a59f6376a471012a10b27b3e902256be0">astdb</a>));</div><div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;      res = -1;</div><div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;   }</div><div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;   sqlite3_reset(create_astdb_stmt);</div><div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;   <a class="code" href="../../da/d21/main_2db_8c.html#a0a19fc05bc020876fec791200e169eb2">db_sync</a>();</div><div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;   <a class="code" href="../../dd/d42/lock_8h.html#a873f9ce8c6287a32d48c83133e124418">ast_mutex_unlock</a>(&amp;<a class="code" href="../../da/d21/main_2db_8c.html#a885611b04f0f81cde233f5648aa58b7c">dblock</a>);</div><div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;</div><div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;   <span class="keywordflow">return</span> res;</div><div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;}</div><div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;</div><div class="line"><a name="l00239"></a><span class="lineno"><a class="line" href="../../da/d21/main_2db_8c.html#a7cd1fd997f708421b79d7c8242c6ae99">  239</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../da/d21/main_2db_8c.html#a7cd1fd997f708421b79d7c8242c6ae99">db_open</a>(<span class="keywordtype">void</span>)</div><div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;{</div><div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;   <span class="keywordtype">char</span> *<a class="code" href="../../d0/d29/cdr__mysql_8c.html#a1ca8a7e4d80187db326fa34a9c6ca0c1">dbname</a>;</div><div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;   <span class="keyword">struct </span>stat dont_care;</div><div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;</div><div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;   <span class="keywordflow">if</span> (!(dbname = <a class="code" href="../../d8/d8a/astmm_8h.html#a249282ecc7ba5a1a49fa75e9a33d1717">ast_alloca</a>(strlen(<a class="code" href="../../dd/df2/paths_8h.html#af89b8aa53d5b08a03b56f5163805bd97">ast_config_AST_DB</a>) + <span class="keyword">sizeof</span>(<span class="stringliteral">&quot;.sqlite3&quot;</span>)))) {</div><div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;   }</div><div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;   strcpy(dbname, <a class="code" href="../../dd/df2/paths_8h.html#af89b8aa53d5b08a03b56f5163805bd97">ast_config_AST_DB</a>);</div><div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;   strcat(dbname, <span class="stringliteral">&quot;.sqlite3&quot;</span>);</div><div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;</div><div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;   <span class="keywordflow">if</span> (stat(dbname, &amp;dont_care) &amp;&amp; !stat(<a class="code" href="../../dd/df2/paths_8h.html#af89b8aa53d5b08a03b56f5163805bd97">ast_config_AST_DB</a>, &amp;dont_care)) {</div><div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="../../da/d21/main_2db_8c.html#a5b3a44a41cbaf00d3c93de1a253aa642">convert_bdb_to_sqlite3</a>()) {</div><div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;         <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;*** Database conversion failed!\n&quot;</span>);</div><div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;         <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;*** Asterisk now uses SQLite3 for its internal\n&quot;</span>);</div><div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;         <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;*** database. Conversion from the old astdb\n&quot;</span>);</div><div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;         <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;*** failed. Most likely the astdb2sqlite3 utility\n&quot;</span>);</div><div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;         <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;*** was not selected for build. To convert the\n&quot;</span>);</div><div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;         <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;*** old astdb, please delete &#39;%s&#39;\n&quot;</span>, dbname);</div><div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;         <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;*** and re-run &#39;make menuselect&#39; and select astdb2sqlite3\n&quot;</span>);</div><div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;         <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;*** in the Utilities section, then &#39;make &amp;&amp; make install&#39;.\n&quot;</span>);</div><div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;         <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;*** It is also imperative that the user under which\n&quot;</span>);</div><div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;         <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;*** Asterisk runs have write permission to the directory\n&quot;</span>);</div><div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;         <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;*** where the database resides.\n&quot;</span>);</div><div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;         sleep(5);</div><div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;      } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;         <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#ad89ee324d180cdcd7defcc709ff9ca42">LOG_NOTICE</a>, <span class="stringliteral">&quot;Database conversion succeeded!\n&quot;</span>);</div><div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;      }</div><div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;   }</div><div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;</div><div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;   <a class="code" href="../../dd/d42/lock_8h.html#ac5e13c7fe64d3b271a52028b0a78b92b">ast_mutex_lock</a>(&amp;<a class="code" href="../../da/d21/main_2db_8c.html#a885611b04f0f81cde233f5648aa58b7c">dblock</a>);</div><div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;   <span class="keywordflow">if</span> (sqlite3_open(dbname, &amp;<a class="code" href="../../da/d21/main_2db_8c.html#a59f6376a471012a10b27b3e902256be0">astdb</a>) != SQLITE_OK) {</div><div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Unable to open Asterisk database &#39;%s&#39;: %s\n&quot;</span>, dbname, sqlite3_errmsg(<a class="code" href="../../da/d21/main_2db_8c.html#a59f6376a471012a10b27b3e902256be0">astdb</a>));</div><div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;      sqlite3_close(<a class="code" href="../../da/d21/main_2db_8c.html#a59f6376a471012a10b27b3e902256be0">astdb</a>);</div><div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;      <a class="code" href="../../dd/d42/lock_8h.html#a873f9ce8c6287a32d48c83133e124418">ast_mutex_unlock</a>(&amp;<a class="code" href="../../da/d21/main_2db_8c.html#a885611b04f0f81cde233f5648aa58b7c">dblock</a>);</div><div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;   }</div><div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;</div><div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;   <a class="code" href="../../dd/d42/lock_8h.html#a873f9ce8c6287a32d48c83133e124418">ast_mutex_unlock</a>(&amp;<a class="code" href="../../da/d21/main_2db_8c.html#a885611b04f0f81cde233f5648aa58b7c">dblock</a>);</div><div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;</div><div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;   <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;}</div><div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;</div><div class="line"><a name="l00282"></a><span class="lineno"><a class="line" href="../../da/d21/main_2db_8c.html#a4b1471f09e67989f00b31639c428fb24">  282</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../da/d21/main_2db_8c.html#a4b1471f09e67989f00b31639c428fb24">db_init</a>(<span class="keywordtype">void</span>)</div><div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;{</div><div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../da/d21/main_2db_8c.html#a59f6376a471012a10b27b3e902256be0">astdb</a>) {</div><div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;      <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;   }</div><div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;</div><div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../da/d21/main_2db_8c.html#a7cd1fd997f708421b79d7c8242c6ae99">db_open</a>() || <a class="code" href="../../da/d21/main_2db_8c.html#a6e6da68c88e22a65dbe728653ceef20f">db_create_astdb</a>() || <a class="code" href="../../da/d21/main_2db_8c.html#ae171d616861e08d90bf27ba78d300581">init_statements</a>()) {</div><div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;   }</div><div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;</div><div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;   <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;}</div><div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;</div><div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;<span class="comment">/* We purposely don&#39;t lock around the sqlite3 call because the transaction</span></div><div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;<span class="comment"> * calls will be called with the database lock held. For any other use, make</span></div><div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;<span class="comment"> * sure to take the dblock yourself. */</span></div><div class="line"><a name="l00298"></a><span class="lineno"><a class="line" href="../../da/d21/main_2db_8c.html#a642962023fc731aa4c7d8e459865d986">  298</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../da/d21/main_2db_8c.html#a642962023fc731aa4c7d8e459865d986">db_execute_sql</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *sql, <span class="keywordtype">int</span> (*callback)(<span class="keywordtype">void</span> *, <span class="keywordtype">int</span>, <span class="keywordtype">char</span> **, <span class="keywordtype">char</span> **), <span class="keywordtype">void</span> *arg)</div><div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;{</div><div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;   <span class="keywordtype">char</span> *errmsg = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;   <span class="keywordtype">int</span> res =0;</div><div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;</div><div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;   <span class="keywordflow">if</span> (sqlite3_exec(<a class="code" href="../../da/d21/main_2db_8c.html#a59f6376a471012a10b27b3e902256be0">astdb</a>, sql, callback, arg, &amp;errmsg) != SQLITE_OK) {</div><div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Error executing SQL (%s): %s\n&quot;</span>, sql, errmsg);</div><div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;      sqlite3_free(errmsg);</div><div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;      res = -1;</div><div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;   }</div><div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;</div><div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;   <span class="keywordflow">return</span> res;</div><div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;}</div><div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;</div><div class="line"><a name="l00312"></a><span class="lineno"><a class="line" href="../../da/d21/main_2db_8c.html#a6c334012bbd6b166af5841f29f9ae58c">  312</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../da/d21/main_2db_8c.html#a6c334012bbd6b166af5841f29f9ae58c">ast_db_begin_transaction</a>(<span class="keywordtype">void</span>)</div><div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;{</div><div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;   <span class="keywordflow">return</span> <a class="code" href="../../da/d21/main_2db_8c.html#a642962023fc731aa4c7d8e459865d986">db_execute_sql</a>(<span class="stringliteral">&quot;BEGIN TRANSACTION&quot;</span>, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div><div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;}</div><div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;</div><div class="line"><a name="l00317"></a><span class="lineno"><a class="line" href="../../da/d21/main_2db_8c.html#a736d314a0dfd064f03dcead874493f16">  317</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../da/d21/main_2db_8c.html#a736d314a0dfd064f03dcead874493f16">ast_db_commit_transaction</a>(<span class="keywordtype">void</span>)</div><div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;{</div><div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;   <span class="keywordflow">return</span> <a class="code" href="../../da/d21/main_2db_8c.html#a642962023fc731aa4c7d8e459865d986">db_execute_sql</a>(<span class="stringliteral">&quot;COMMIT&quot;</span>, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div><div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;}</div><div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;</div><div class="line"><a name="l00322"></a><span class="lineno"><a class="line" href="../../da/d21/main_2db_8c.html#af06db2a8f64fb9fcd382b24a0cffd608">  322</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../da/d21/main_2db_8c.html#af06db2a8f64fb9fcd382b24a0cffd608">ast_db_rollback_transaction</a>(<span class="keywordtype">void</span>)</div><div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;{</div><div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;   <span class="keywordflow">return</span> <a class="code" href="../../da/d21/main_2db_8c.html#a642962023fc731aa4c7d8e459865d986">db_execute_sql</a>(<span class="stringliteral">&quot;ROLLBACK&quot;</span>, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div><div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;}</div><div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;</div><div class="line"><a name="l00327"></a><span class="lineno"><a class="line" href="../../da/d21/main_2db_8c.html#a0f14f6bff4f412c88b50aba34d3a5e35">  327</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="../../da/d21/main_2db_8c.html#a0f14f6bff4f412c88b50aba34d3a5e35">ast_db_put</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *family, <span class="keyword">const</span> <span class="keywordtype">char</span> *key, <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="../../d4/d2f/syslog_8c.html#ac4f474c82e82cbb89ca7c36dd52be0ed">value</a>)</div><div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;{</div><div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;   <span class="keywordtype">char</span> fullkey[<a class="code" href="../../da/d21/main_2db_8c.html#afe1f0caaa1c711f16bb23bfcc54ff386">MAX_DB_FIELD</a>];</div><div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;   <span class="keywordtype">size_t</span> fullkey_len;</div><div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;   <span class="keywordtype">int</span> res = 0;</div><div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;</div><div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;   <span class="keywordflow">if</span> (strlen(family) + strlen(key) + 2 &gt; <span class="keyword">sizeof</span>(fullkey) - 1) {</div><div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Family and key length must be less than %zu bytes\n&quot;</span>, <span class="keyword">sizeof</span>(fullkey) - 3);</div><div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;   }</div><div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;</div><div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;   fullkey_len = snprintf(fullkey, <span class="keyword">sizeof</span>(fullkey), <span class="stringliteral">&quot;/%s/%s&quot;</span>, family, key);</div><div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;</div><div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;   <a class="code" href="../../dd/d42/lock_8h.html#ac5e13c7fe64d3b271a52028b0a78b92b">ast_mutex_lock</a>(&amp;<a class="code" href="../../da/d21/main_2db_8c.html#a885611b04f0f81cde233f5648aa58b7c">dblock</a>);</div><div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;   <span class="keywordflow">if</span> (sqlite3_bind_text(put_stmt, 1, fullkey, fullkey_len, SQLITE_STATIC) != SQLITE_OK) {</div><div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Couldn&#39;t bind key to stmt: %s\n&quot;</span>, sqlite3_errmsg(<a class="code" href="../../da/d21/main_2db_8c.html#a59f6376a471012a10b27b3e902256be0">astdb</a>));</div><div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;      res = -1;</div><div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;   } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (sqlite3_bind_text(put_stmt, 2, value, -1, SQLITE_STATIC) != SQLITE_OK) {</div><div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Couldn&#39;t bind value to stmt: %s\n&quot;</span>, sqlite3_errmsg(<a class="code" href="../../da/d21/main_2db_8c.html#a59f6376a471012a10b27b3e902256be0">astdb</a>));</div><div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;      res = -1;</div><div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;   } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (sqlite3_step(put_stmt) != SQLITE_DONE) {</div><div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Couldn&#39;t execute statement: %s\n&quot;</span>, sqlite3_errmsg(<a class="code" href="../../da/d21/main_2db_8c.html#a59f6376a471012a10b27b3e902256be0">astdb</a>));</div><div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;      res = -1;</div><div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;   }</div><div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;</div><div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;   sqlite3_reset(put_stmt);</div><div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;   <a class="code" href="../../da/d21/main_2db_8c.html#a0a19fc05bc020876fec791200e169eb2">db_sync</a>();</div><div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;   <a class="code" href="../../dd/d42/lock_8h.html#a873f9ce8c6287a32d48c83133e124418">ast_mutex_unlock</a>(&amp;<a class="code" href="../../da/d21/main_2db_8c.html#a885611b04f0f81cde233f5648aa58b7c">dblock</a>);</div><div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;</div><div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;   <span class="keywordflow">return</span> res;</div><div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;}</div><div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;<span class="comment">/*!</span></div><div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;<span class="comment"> * \internal</span></div><div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;<span class="comment"> * \brief Get key value specified by family/key.</span></div><div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;<span class="comment"> * Gets the value associated with the specified \a family and \a key, and</span></div><div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;<span class="comment"> * stores it, either into the fixed sized buffer specified by \a buffer</span></div><div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;<span class="comment"> * and \a bufferlen, or as a heap allocated string if \a bufferlen is -1.</span></div><div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;<span class="comment"> * \note If \a bufferlen is -1, \a buffer points to heap allocated memory</span></div><div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;<span class="comment"> *       and must be freed by calling ast_free().</span></div><div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;<span class="comment"> * \retval -1 An error occurred</span></div><div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;<span class="comment"> * \retval 0 Success</span></div><div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00373"></a><span class="lineno"><a class="line" href="../../da/d21/main_2db_8c.html#ae6b28eed96c88f9a9848f9121608699d">  373</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../da/d21/main_2db_8c.html#ae6b28eed96c88f9a9848f9121608699d">db_get_common</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *family, <span class="keyword">const</span> <span class="keywordtype">char</span> *key, <span class="keywordtype">char</span> **buffer, <span class="keywordtype">int</span> bufferlen)</div><div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;{</div><div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;   <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *<a class="code" href="../../de/d1b/cel__pgsql_8c.html#ad6c487210772a9b4b0ca04b04b847d4c">result</a>;</div><div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;   <span class="keywordtype">char</span> fullkey[<a class="code" href="../../da/d21/main_2db_8c.html#afe1f0caaa1c711f16bb23bfcc54ff386">MAX_DB_FIELD</a>];</div><div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;   <span class="keywordtype">size_t</span> fullkey_len;</div><div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;   <span class="keywordtype">int</span> res = 0;</div><div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;</div><div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;   <span class="keywordflow">if</span> (strlen(family) + strlen(key) + 2 &gt; <span class="keyword">sizeof</span>(fullkey) - 1) {</div><div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Family and key length must be less than %zu bytes\n&quot;</span>, <span class="keyword">sizeof</span>(fullkey) - 3);</div><div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;   }</div><div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;</div><div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;   fullkey_len = snprintf(fullkey, <span class="keyword">sizeof</span>(fullkey), <span class="stringliteral">&quot;/%s/%s&quot;</span>, family, key);</div><div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;</div><div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;   <a class="code" href="../../dd/d42/lock_8h.html#ac5e13c7fe64d3b271a52028b0a78b92b">ast_mutex_lock</a>(&amp;<a class="code" href="../../da/d21/main_2db_8c.html#a885611b04f0f81cde233f5648aa58b7c">dblock</a>);</div><div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;   <span class="keywordflow">if</span> (sqlite3_bind_text(get_stmt, 1, fullkey, fullkey_len, SQLITE_STATIC) != SQLITE_OK) {</div><div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Couldn&#39;t bind key to stmt: %s\n&quot;</span>, sqlite3_errmsg(<a class="code" href="../../da/d21/main_2db_8c.html#a59f6376a471012a10b27b3e902256be0">astdb</a>));</div><div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;      res = -1;</div><div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;   } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (sqlite3_step(get_stmt) != SQLITE_ROW) {</div><div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;      <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(1, <span class="stringliteral">&quot;Unable to find key &#39;%s&#39; in family &#39;%s&#39;\n&quot;</span>, key, family);</div><div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;      res = -1;</div><div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;   } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!(result = sqlite3_column_text(get_stmt, 0))) {</div><div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Couldn&#39;t get value\n&quot;</span>);</div><div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;      res = -1;</div><div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;   } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;      <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="../../d4/d2f/syslog_8c.html#ac4f474c82e82cbb89ca7c36dd52be0ed">value</a> = (<span class="keyword">const</span> <span class="keywordtype">char</span> *) result;</div><div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;</div><div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;      <span class="keywordflow">if</span> (bufferlen == -1) {</div><div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;         *buffer = <a class="code" href="../../d8/d8a/astmm_8h.html#ab263849d03fb892847be4986db759737">ast_strdup</a>(value);</div><div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;      } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;         <a class="code" href="../../d6/d90/strings_8h.html#ac4040268f7b6ed77dfc49c7767626369">ast_copy_string</a>(*buffer, value, bufferlen);</div><div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;      }</div><div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;   }</div><div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;   sqlite3_reset(get_stmt);</div><div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;   <a class="code" href="../../dd/d42/lock_8h.html#a873f9ce8c6287a32d48c83133e124418">ast_mutex_unlock</a>(&amp;<a class="code" href="../../da/d21/main_2db_8c.html#a885611b04f0f81cde233f5648aa58b7c">dblock</a>);</div><div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;</div><div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;   <span class="keywordflow">return</span> res;</div><div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;}</div><div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;</div><div class="line"><a name="l00412"></a><span class="lineno"><a class="line" href="../../da/d21/main_2db_8c.html#a6ab91701fa0db9fad7759fe42a581c17">  412</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="../../da/d21/main_2db_8c.html#a6ab91701fa0db9fad7759fe42a581c17">ast_db_get</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *family, <span class="keyword">const</span> <span class="keywordtype">char</span> *key, <span class="keywordtype">char</span> *<a class="code" href="../../d4/d2f/syslog_8c.html#ac4f474c82e82cbb89ca7c36dd52be0ed">value</a>, <span class="keywordtype">int</span> valuelen)</div><div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;{</div><div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;   <a class="code" href="../../d5/d60/utils_8h.html#a24374da24af1931d8a7ccde5b352bb2c">ast_assert</a>(value != <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div><div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;</div><div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;   <span class="comment">/* Make sure we initialize */</span></div><div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;   value[0] = 0;</div><div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;</div><div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;   <span class="keywordflow">return</span> <a class="code" href="../../da/d21/main_2db_8c.html#ae6b28eed96c88f9a9848f9121608699d">db_get_common</a>(family, key, &amp;value, valuelen);</div><div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;}</div><div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;</div><div class="line"><a name="l00422"></a><span class="lineno"><a class="line" href="../../da/d21/main_2db_8c.html#a60488b5c3b6fd447d39d58e52172657e">  422</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="../../da/d21/main_2db_8c.html#a60488b5c3b6fd447d39d58e52172657e">ast_db_get_allocated</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *family, <span class="keyword">const</span> <span class="keywordtype">char</span> *key, <span class="keywordtype">char</span> **<a class="code" href="../../d6/d47/utils_2frame_8c.html#a48bc11919b2752df9d14ce89557cfb25">out</a>)</div><div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;{</div><div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;   *out = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;</div><div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;   <span class="keywordflow">return</span> <a class="code" href="../../da/d21/main_2db_8c.html#ae6b28eed96c88f9a9848f9121608699d">db_get_common</a>(family, key, out, -1);</div><div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;}</div><div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;</div><div class="line"><a name="l00429"></a><span class="lineno"><a class="line" href="../../da/d21/main_2db_8c.html#a71e8d5ab1757b184683a99125d1c8160">  429</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="../../da/d21/main_2db_8c.html#a71e8d5ab1757b184683a99125d1c8160">ast_db_del</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *family, <span class="keyword">const</span> <span class="keywordtype">char</span> *key)</div><div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;{</div><div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;   <span class="keywordtype">char</span> fullkey[<a class="code" href="../../da/d21/main_2db_8c.html#afe1f0caaa1c711f16bb23bfcc54ff386">MAX_DB_FIELD</a>];</div><div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;   <span class="keywordtype">size_t</span> fullkey_len;</div><div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;   <span class="keywordtype">int</span> res = 0;</div><div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;</div><div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;   <span class="keywordflow">if</span> (strlen(family) + strlen(key) + 2 &gt; <span class="keyword">sizeof</span>(fullkey) - 1) {</div><div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Family and key length must be less than %zu bytes\n&quot;</span>, <span class="keyword">sizeof</span>(fullkey) - 3);</div><div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;   }</div><div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;</div><div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;   fullkey_len = snprintf(fullkey, <span class="keyword">sizeof</span>(fullkey), <span class="stringliteral">&quot;/%s/%s&quot;</span>, family, key);</div><div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;</div><div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;   <a class="code" href="../../dd/d42/lock_8h.html#ac5e13c7fe64d3b271a52028b0a78b92b">ast_mutex_lock</a>(&amp;<a class="code" href="../../da/d21/main_2db_8c.html#a885611b04f0f81cde233f5648aa58b7c">dblock</a>);</div><div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;   <span class="keywordflow">if</span> (sqlite3_bind_text(del_stmt, 1, fullkey, fullkey_len, SQLITE_STATIC) != SQLITE_OK) {</div><div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Couldn&#39;t bind key to stmt: %s\n&quot;</span>, sqlite3_errmsg(<a class="code" href="../../da/d21/main_2db_8c.html#a59f6376a471012a10b27b3e902256be0">astdb</a>));</div><div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;      res = -1;</div><div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;   } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (sqlite3_step(del_stmt) != SQLITE_DONE) {</div><div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;      <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(1, <span class="stringliteral">&quot;Unable to find key &#39;%s&#39; in family &#39;%s&#39;\n&quot;</span>, key, family);</div><div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;      res = -1;</div><div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;   }</div><div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;   sqlite3_reset(del_stmt);</div><div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;   <a class="code" href="../../da/d21/main_2db_8c.html#a0a19fc05bc020876fec791200e169eb2">db_sync</a>();</div><div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;   <a class="code" href="../../dd/d42/lock_8h.html#a873f9ce8c6287a32d48c83133e124418">ast_mutex_unlock</a>(&amp;<a class="code" href="../../da/d21/main_2db_8c.html#a885611b04f0f81cde233f5648aa58b7c">dblock</a>);</div><div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;</div><div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;   <span class="keywordflow">return</span> res;</div><div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;}</div><div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;</div><div class="line"><a name="l00457"></a><span class="lineno"><a class="line" href="../../da/d21/main_2db_8c.html#af251d986cfe884ffd5ca864531253f62">  457</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="../../da/d21/main_2db_8c.html#af251d986cfe884ffd5ca864531253f62">ast_db_deltree</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *family, <span class="keyword">const</span> <span class="keywordtype">char</span> *keytree)</div><div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;{</div><div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;   sqlite3_stmt *stmt = deltree_stmt;</div><div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;   <span class="keywordtype">char</span> <a class="code" href="../../dd/d43/http_8c.html#a6f25bc812d09fedb86bf394c01061c56">prefix</a>[<a class="code" href="../../da/d21/main_2db_8c.html#afe1f0caaa1c711f16bb23bfcc54ff386">MAX_DB_FIELD</a>];</div><div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;   <span class="keywordtype">int</span> res = 0;</div><div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;</div><div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;   <span class="keywordflow">if</span> (!<a class="code" href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a>(family)) {</div><div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;      <span class="keywordflow">if</span> (!<a class="code" href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a>(keytree)) {</div><div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;         <span class="comment">/* Family and key tree */</span></div><div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;         snprintf(prefix, <span class="keyword">sizeof</span>(prefix), <span class="stringliteral">&quot;/%s/%s&quot;</span>, family, keytree);</div><div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;      } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;         <span class="comment">/* Family only */</span></div><div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;         snprintf(prefix, <span class="keyword">sizeof</span>(prefix), <span class="stringliteral">&quot;/%s&quot;</span>, family);</div><div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;      }</div><div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;   } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;      prefix[0] = <span class="charliteral">&#39;\0&#39;</span>;</div><div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;      stmt = deltree_all_stmt;</div><div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;   }</div><div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;</div><div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;   <a class="code" href="../../dd/d42/lock_8h.html#ac5e13c7fe64d3b271a52028b0a78b92b">ast_mutex_lock</a>(&amp;<a class="code" href="../../da/d21/main_2db_8c.html#a885611b04f0f81cde233f5648aa58b7c">dblock</a>);</div><div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;   <span class="keywordflow">if</span> (!<a class="code" href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a>(prefix) &amp;&amp; (sqlite3_bind_text(stmt, 1, prefix, -1, SQLITE_STATIC) != SQLITE_OK)) {</div><div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Could bind %s to stmt: %s\n&quot;</span>, prefix, sqlite3_errmsg(<a class="code" href="../../da/d21/main_2db_8c.html#a59f6376a471012a10b27b3e902256be0">astdb</a>));</div><div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;      res = -1;</div><div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;   } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (sqlite3_step(stmt) != SQLITE_DONE) {</div><div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Couldn&#39;t execute stmt: %s\n&quot;</span>, sqlite3_errmsg(<a class="code" href="../../da/d21/main_2db_8c.html#a59f6376a471012a10b27b3e902256be0">astdb</a>));</div><div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;      res = -1;</div><div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;   }</div><div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;   res = sqlite3_changes(<a class="code" href="../../da/d21/main_2db_8c.html#a59f6376a471012a10b27b3e902256be0">astdb</a>);</div><div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;   sqlite3_reset(stmt);</div><div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;   <a class="code" href="../../da/d21/main_2db_8c.html#a0a19fc05bc020876fec791200e169eb2">db_sync</a>();</div><div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;   <a class="code" href="../../dd/d42/lock_8h.html#a873f9ce8c6287a32d48c83133e124418">ast_mutex_unlock</a>(&amp;<a class="code" href="../../da/d21/main_2db_8c.html#a885611b04f0f81cde233f5648aa58b7c">dblock</a>);</div><div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;</div><div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;   <span class="keywordflow">return</span> res;</div><div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;}</div><div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;</div><div class="line"><a name="l00492"></a><span class="lineno"><a class="line" href="../../da/d21/main_2db_8c.html#a332d50e70dcfd68a970533f20cdba278">  492</a></span>&#160;<span class="keyword">static</span> <span class="keyword">struct </span><a class="code" href="../../da/d1d/structast__db__entry.html">ast_db_entry</a> *<a class="code" href="../../da/d21/main_2db_8c.html#a332d50e70dcfd68a970533f20cdba278">db_gettree_common</a>(sqlite3_stmt *stmt)</div><div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;{</div><div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../da/d1d/structast__db__entry.html">ast_db_entry</a> *head = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, *prev = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, *cur;</div><div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;</div><div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;   <span class="keywordflow">while</span> (sqlite3_step(stmt) == SQLITE_ROW) {</div><div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;      <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="../../da/d1d/structast__db__entry.html#a5892a9181e6a332f84d27aecd41dcd12">key</a>, *<a class="code" href="../../d4/d2f/syslog_8c.html#ac4f474c82e82cbb89ca7c36dd52be0ed">value</a>;</div><div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;      <span class="keywordtype">size_t</span> key_len, value_len;</div><div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;</div><div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;      key   = (<span class="keyword">const</span> <span class="keywordtype">char</span> *) sqlite3_column_text(stmt, 0);</div><div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;      value = (<span class="keyword">const</span> <span class="keywordtype">char</span> *) sqlite3_column_text(stmt, 1);</div><div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;</div><div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;      <span class="keywordflow">if</span> (!key || !value) {</div><div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;         <span class="keywordflow">break</span>;</div><div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;      }</div><div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;</div><div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;      key_len = strlen(key);</div><div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;      value_len = strlen(value);</div><div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;</div><div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;      cur = <a class="code" href="../../d8/d8a/astmm_8h.html#ae63d4f486bcf6eac7c1593f867717d91">ast_malloc</a>(<span class="keyword">sizeof</span>(*cur) + key_len + value_len + 2);</div><div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;      <span class="keywordflow">if</span> (!cur) {</div><div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;         <span class="keywordflow">break</span>;</div><div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;      }</div><div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;</div><div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;      cur-&gt;next = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;      cur-&gt;key = cur-&gt;data + value_len + 1;</div><div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;      memcpy(cur-&gt;data, value, value_len + 1);</div><div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;      memcpy(cur-&gt;key, key, key_len + 1);</div><div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;</div><div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;      <span class="keywordflow">if</span> (prev) {</div><div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;         prev-&gt;next = cur;</div><div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;      } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;         head = cur;</div><div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;      }</div><div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;      prev = cur;</div><div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;   }</div><div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;</div><div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;   <span class="keywordflow">return</span> head;</div><div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;}</div><div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;</div><div class="line"><a name="l00531"></a><span class="lineno"><a class="line" href="../../da/d21/main_2db_8c.html#afeb9839f89da4fc24838de74739d181e">  531</a></span>&#160;<span class="keyword">struct </span><a class="code" href="../../da/d1d/structast__db__entry.html">ast_db_entry</a> *<a class="code" href="../../da/d21/main_2db_8c.html#afeb9839f89da4fc24838de74739d181e">ast_db_gettree</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *family, <span class="keyword">const</span> <span class="keywordtype">char</span> *keytree)</div><div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;{</div><div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;   <span class="keywordtype">char</span> <a class="code" href="../../dd/d43/http_8c.html#a6f25bc812d09fedb86bf394c01061c56">prefix</a>[<a class="code" href="../../da/d21/main_2db_8c.html#afe1f0caaa1c711f16bb23bfcc54ff386">MAX_DB_FIELD</a>];</div><div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;   sqlite3_stmt *stmt = gettree_stmt;</div><div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;   <span class="keywordtype">size_t</span> res = 0;</div><div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../da/d1d/structast__db__entry.html">ast_db_entry</a> *ret;</div><div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;</div><div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;   <span class="keywordflow">if</span> (!<a class="code" href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a>(family)) {</div><div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;      <span class="keywordflow">if</span> (!<a class="code" href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a>(keytree)) {</div><div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;         <span class="comment">/* Family and key tree */</span></div><div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;         res = snprintf(prefix, <span class="keyword">sizeof</span>(prefix), <span class="stringliteral">&quot;/%s/%s&quot;</span>, family, keytree);</div><div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;      } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;         <span class="comment">/* Family only */</span></div><div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;         res = snprintf(prefix, <span class="keyword">sizeof</span>(prefix), <span class="stringliteral">&quot;/%s&quot;</span>, family);</div><div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;      }</div><div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;</div><div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;      <span class="keywordflow">if</span> (res &gt;= <span class="keyword">sizeof</span>(prefix)) {</div><div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;         <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Requested prefix is too long: %s\n&quot;</span>, keytree);</div><div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;         <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;      }</div><div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;   } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;      prefix[0] = <span class="charliteral">&#39;\0&#39;</span>;</div><div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;      stmt = gettree_all_stmt;</div><div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;   }</div><div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;</div><div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;   <a class="code" href="../../dd/d42/lock_8h.html#ac5e13c7fe64d3b271a52028b0a78b92b">ast_mutex_lock</a>(&amp;<a class="code" href="../../da/d21/main_2db_8c.html#a885611b04f0f81cde233f5648aa58b7c">dblock</a>);</div><div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;   <span class="keywordflow">if</span> (res &amp;&amp; (sqlite3_bind_text(stmt, 1, prefix, res, SQLITE_STATIC) != SQLITE_OK)) {</div><div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Could not bind %s to stmt: %s\n&quot;</span>, prefix, sqlite3_errmsg(<a class="code" href="../../da/d21/main_2db_8c.html#a59f6376a471012a10b27b3e902256be0">astdb</a>));</div><div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;      sqlite3_reset(stmt);</div><div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;      <a class="code" href="../../dd/d42/lock_8h.html#a873f9ce8c6287a32d48c83133e124418">ast_mutex_unlock</a>(&amp;<a class="code" href="../../da/d21/main_2db_8c.html#a885611b04f0f81cde233f5648aa58b7c">dblock</a>);</div><div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;   }</div><div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;</div><div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;   ret = <a class="code" href="../../da/d21/main_2db_8c.html#a332d50e70dcfd68a970533f20cdba278">db_gettree_common</a>(stmt);</div><div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;   sqlite3_reset(stmt);</div><div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;   <a class="code" href="../../dd/d42/lock_8h.html#a873f9ce8c6287a32d48c83133e124418">ast_mutex_unlock</a>(&amp;<a class="code" href="../../da/d21/main_2db_8c.html#a885611b04f0f81cde233f5648aa58b7c">dblock</a>);</div><div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;</div><div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;   <span class="keywordflow">return</span> ret;</div><div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;}</div><div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;</div><div class="line"><a name="l00571"></a><span class="lineno"><a class="line" href="../../da/d21/main_2db_8c.html#aadc9b80ccfd78701b69d004a09f55b08">  571</a></span>&#160;<span class="keyword">struct </span><a class="code" href="../../da/d1d/structast__db__entry.html">ast_db_entry</a> *<a class="code" href="../../da/d21/main_2db_8c.html#aadc9b80ccfd78701b69d004a09f55b08">ast_db_gettree_by_prefix</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *family, <span class="keyword">const</span> <span class="keywordtype">char</span> *key_prefix)</div><div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;{</div><div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;   <span class="keywordtype">char</span> <a class="code" href="../../dd/d43/http_8c.html#a6f25bc812d09fedb86bf394c01061c56">prefix</a>[<a class="code" href="../../da/d21/main_2db_8c.html#afe1f0caaa1c711f16bb23bfcc54ff386">MAX_DB_FIELD</a>];</div><div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;   <span class="keywordtype">size_t</span> res;</div><div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../da/d1d/structast__db__entry.html">ast_db_entry</a> *ret;</div><div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;</div><div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;   res = snprintf(prefix, <span class="keyword">sizeof</span>(prefix), <span class="stringliteral">&quot;/%s/%s&quot;</span>, family, key_prefix);</div><div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;   <span class="keywordflow">if</span> (res &gt;= <span class="keyword">sizeof</span>(prefix)) {</div><div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Requested key prefix is too long: %s\n&quot;</span>, key_prefix);</div><div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;   }</div><div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;</div><div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;   <a class="code" href="../../dd/d42/lock_8h.html#ac5e13c7fe64d3b271a52028b0a78b92b">ast_mutex_lock</a>(&amp;<a class="code" href="../../da/d21/main_2db_8c.html#a885611b04f0f81cde233f5648aa58b7c">dblock</a>);</div><div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;   <span class="keywordflow">if</span> (sqlite3_bind_text(gettree_prefix_stmt, 1, prefix, res, SQLITE_STATIC) != SQLITE_OK) {</div><div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Could not bind %s to stmt: %s\n&quot;</span>, prefix, sqlite3_errmsg(<a class="code" href="../../da/d21/main_2db_8c.html#a59f6376a471012a10b27b3e902256be0">astdb</a>));</div><div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;      sqlite3_reset(gettree_prefix_stmt);</div><div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;      <a class="code" href="../../dd/d42/lock_8h.html#a873f9ce8c6287a32d48c83133e124418">ast_mutex_unlock</a>(&amp;<a class="code" href="../../da/d21/main_2db_8c.html#a885611b04f0f81cde233f5648aa58b7c">dblock</a>);</div><div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;   }</div><div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;</div><div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;   ret = <a class="code" href="../../da/d21/main_2db_8c.html#a332d50e70dcfd68a970533f20cdba278">db_gettree_common</a>(gettree_prefix_stmt);</div><div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;   sqlite3_reset(gettree_prefix_stmt);</div><div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;   <a class="code" href="../../dd/d42/lock_8h.html#a873f9ce8c6287a32d48c83133e124418">ast_mutex_unlock</a>(&amp;<a class="code" href="../../da/d21/main_2db_8c.html#a885611b04f0f81cde233f5648aa58b7c">dblock</a>);</div><div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;</div><div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;   <span class="keywordflow">return</span> ret;</div><div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;}</div><div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;</div><div class="line"><a name="l00598"></a><span class="lineno"><a class="line" href="../../da/d21/main_2db_8c.html#a3387fe63f8d0b59067f32d626dea29be">  598</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../da/d21/main_2db_8c.html#a3387fe63f8d0b59067f32d626dea29be">ast_db_freetree</a>(<span class="keyword">struct</span> <a class="code" href="../../da/d1d/structast__db__entry.html">ast_db_entry</a> *dbe)</div><div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;{</div><div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../da/d1d/structast__db__entry.html">ast_db_entry</a> *<a class="code" href="../../df/d44/app__meetme_8c.html#ae9dd6bdb4c5c0529195a03583d0d4a8d">last</a>;</div><div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;   <span class="keywordflow">while</span> (dbe) {</div><div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;      last = dbe;</div><div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;      dbe = dbe-&gt;<a class="code" href="../../da/d1d/structast__db__entry.html#a3fee4a0a4bff112e0262fb8d49f41b5e">next</a>;</div><div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;      <a class="code" href="../../d8/d8a/astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(last);</div><div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;   }</div><div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;}</div><div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;</div><div class="line"><a name="l00608"></a><span class="lineno"><a class="line" href="../../da/d21/main_2db_8c.html#a05c446a72a078b710425b61d0d999e07">  608</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">char</span> *<a class="code" href="../../da/d21/main_2db_8c.html#a05c446a72a078b710425b61d0d999e07">handle_cli_database_put</a>(<span class="keyword">struct</span> <a class="code" href="../../d8/d07/structast__cli__entry.html">ast_cli_entry</a> *e, <span class="keywordtype">int</span> cmd, <span class="keyword">struct</span> <a class="code" href="../../d3/dad/structast__cli__args.html">ast_cli_args</a> *<a class="code" href="../../d7/d6f/test__linkedlists_8c.html#a13dd15487fee89a002d17ef3aff62d02">a</a>)</div><div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;{</div><div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;   <span class="keywordtype">int</span> res;</div><div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;</div><div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;   <span class="keywordflow">switch</span> (cmd) {</div><div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="../../dc/db0/cli_8h.html#ab33e5350a923c3a8cedbeb496cd88ec9a71745eb63dd093f560a1add3e430d2a9">CLI_INIT</a>:</div><div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;      e-&gt;<a class="code" href="../../d8/d07/structast__cli__entry.html#ade9cba72805fe52685a1deea307a8e82">command</a> = <span class="stringliteral">&quot;database put&quot;</span>;</div><div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;      e-&gt;<a class="code" href="../../d8/d07/structast__cli__entry.html#aef1bd6ad890a110b466cb0e8088507a2">usage</a> =</div><div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;         <span class="stringliteral">&quot;Usage: database put &lt;family&gt; &lt;key&gt; &lt;value&gt;\n&quot;</span></div><div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160;         <span class="stringliteral">&quot;       Adds or updates an entry in the Asterisk database for\n&quot;</span></div><div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160;         <span class="stringliteral">&quot;       a given family, key, and value.\n&quot;</span>;</div><div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="../../dc/db0/cli_8h.html#ab33e5350a923c3a8cedbeb496cd88ec9a76bf33139279b03ec1691f2be2d1be40">CLI_GENERATE</a>:</div><div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;   }</div><div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;</div><div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;   <span class="keywordflow">if</span> (a-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#a98e1d8441ca58834f11f7367be4b3345">argc</a> != 5)</div><div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/db0/cli_8h.html#a0873456096960dab21fff0ce68c95acb">CLI_SHOWUSAGE</a>;</div><div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160;   res = <a class="code" href="../../da/d21/main_2db_8c.html#a0f14f6bff4f412c88b50aba34d3a5e35">ast_db_put</a>(a-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#ad0a19c4d63698f9e9cfd5653e8851452">argv</a>[2], a-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#ad0a19c4d63698f9e9cfd5653e8851452">argv</a>[3], a-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#ad0a19c4d63698f9e9cfd5653e8851452">argv</a>[4]);</div><div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160;   <span class="keywordflow">if</span> (res)  {</div><div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;      <a class="code" href="../../dc/db0/cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#acf64f219885421479997667d2ed3f08a">fd</a>, <span class="stringliteral">&quot;Failed to update entry\n&quot;</span>);</div><div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160;   } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;      <a class="code" href="../../dc/db0/cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#acf64f219885421479997667d2ed3f08a">fd</a>, <span class="stringliteral">&quot;Updated database successfully\n&quot;</span>);</div><div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160;   }</div><div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160;   <span class="keywordflow">return</span> <a class="code" href="../../dc/db0/cli_8h.html#a50989f00b32eeb2516a3803cb2ffb766">CLI_SUCCESS</a>;</div><div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160;}</div><div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160;</div><div class="line"><a name="l00635"></a><span class="lineno"><a class="line" href="../../da/d21/main_2db_8c.html#afb5ce976f5d19ec85c79189213596d96">  635</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">char</span> *<a class="code" href="../../da/d21/main_2db_8c.html#afb5ce976f5d19ec85c79189213596d96">handle_cli_database_get</a>(<span class="keyword">struct</span> <a class="code" href="../../d8/d07/structast__cli__entry.html">ast_cli_entry</a> *e, <span class="keywordtype">int</span> cmd, <span class="keyword">struct</span> <a class="code" href="../../d3/dad/structast__cli__args.html">ast_cli_args</a> *<a class="code" href="../../d7/d6f/test__linkedlists_8c.html#a13dd15487fee89a002d17ef3aff62d02">a</a>)</div><div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160;{</div><div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160;   <span class="keywordtype">int</span> res;</div><div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160;   <span class="keywordtype">char</span> <a class="code" href="../../de/d1e/bt__open_8c.html#a1cdd2bb1a9a71d3e1120100229315d67">tmp</a>[<a class="code" href="../../da/d21/main_2db_8c.html#afe1f0caaa1c711f16bb23bfcc54ff386">MAX_DB_FIELD</a>];</div><div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160;</div><div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160;   <span class="keywordflow">switch</span> (cmd) {</div><div class="line"><a name="l00641"></a><span class="lineno">  641</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="../../dc/db0/cli_8h.html#ab33e5350a923c3a8cedbeb496cd88ec9a71745eb63dd093f560a1add3e430d2a9">CLI_INIT</a>:</div><div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160;      e-&gt;<a class="code" href="../../d8/d07/structast__cli__entry.html#ade9cba72805fe52685a1deea307a8e82">command</a> = <span class="stringliteral">&quot;database get&quot;</span>;</div><div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160;      e-&gt;<a class="code" href="../../d8/d07/structast__cli__entry.html#aef1bd6ad890a110b466cb0e8088507a2">usage</a> =</div><div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160;         <span class="stringliteral">&quot;Usage: database get &lt;family&gt; &lt;key&gt;\n&quot;</span></div><div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160;         <span class="stringliteral">&quot;       Retrieves an entry in the Asterisk database for a given\n&quot;</span></div><div class="line"><a name="l00646"></a><span class="lineno">  646</span>&#160;         <span class="stringliteral">&quot;       family and key.\n&quot;</span>;</div><div class="line"><a name="l00647"></a><span class="lineno">  647</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l00648"></a><span class="lineno">  648</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="../../dc/db0/cli_8h.html#ab33e5350a923c3a8cedbeb496cd88ec9a76bf33139279b03ec1691f2be2d1be40">CLI_GENERATE</a>:</div><div class="line"><a name="l00649"></a><span class="lineno">  649</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l00650"></a><span class="lineno">  650</span>&#160;   }</div><div class="line"><a name="l00651"></a><span class="lineno">  651</span>&#160;</div><div class="line"><a name="l00652"></a><span class="lineno">  652</span>&#160;   <span class="keywordflow">if</span> (a-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#a98e1d8441ca58834f11f7367be4b3345">argc</a> != 4)</div><div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/db0/cli_8h.html#a0873456096960dab21fff0ce68c95acb">CLI_SHOWUSAGE</a>;</div><div class="line"><a name="l00654"></a><span class="lineno">  654</span>&#160;   res = <a class="code" href="../../da/d21/main_2db_8c.html#a6ab91701fa0db9fad7759fe42a581c17">ast_db_get</a>(a-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#ad0a19c4d63698f9e9cfd5653e8851452">argv</a>[2], a-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#ad0a19c4d63698f9e9cfd5653e8851452">argv</a>[3], tmp, <span class="keyword">sizeof</span>(tmp));</div><div class="line"><a name="l00655"></a><span class="lineno">  655</span>&#160;   <span class="keywordflow">if</span> (res) {</div><div class="line"><a name="l00656"></a><span class="lineno">  656</span>&#160;      <a class="code" href="../../dc/db0/cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#acf64f219885421479997667d2ed3f08a">fd</a>, <span class="stringliteral">&quot;Database entry not found.\n&quot;</span>);</div><div class="line"><a name="l00657"></a><span class="lineno">  657</span>&#160;   } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00658"></a><span class="lineno">  658</span>&#160;      <a class="code" href="../../dc/db0/cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#acf64f219885421479997667d2ed3f08a">fd</a>, <span class="stringliteral">&quot;Value: %s\n&quot;</span>, tmp);</div><div class="line"><a name="l00659"></a><span class="lineno">  659</span>&#160;   }</div><div class="line"><a name="l00660"></a><span class="lineno">  660</span>&#160;   <span class="keywordflow">return</span> <a class="code" href="../../dc/db0/cli_8h.html#a50989f00b32eeb2516a3803cb2ffb766">CLI_SUCCESS</a>;</div><div class="line"><a name="l00661"></a><span class="lineno">  661</span>&#160;}</div><div class="line"><a name="l00662"></a><span class="lineno">  662</span>&#160;</div><div class="line"><a name="l00663"></a><span class="lineno"><a class="line" href="../../da/d21/main_2db_8c.html#ab2ffb685a189bc273c1de00753c31091">  663</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">char</span> *<a class="code" href="../../da/d21/main_2db_8c.html#ab2ffb685a189bc273c1de00753c31091">handle_cli_database_del</a>(<span class="keyword">struct</span> <a class="code" href="../../d8/d07/structast__cli__entry.html">ast_cli_entry</a> *e, <span class="keywordtype">int</span> cmd, <span class="keyword">struct</span> <a class="code" href="../../d3/dad/structast__cli__args.html">ast_cli_args</a> *<a class="code" href="../../d7/d6f/test__linkedlists_8c.html#a13dd15487fee89a002d17ef3aff62d02">a</a>)</div><div class="line"><a name="l00664"></a><span class="lineno">  664</span>&#160;{</div><div class="line"><a name="l00665"></a><span class="lineno">  665</span>&#160;   <span class="keywordtype">int</span> res;</div><div class="line"><a name="l00666"></a><span class="lineno">  666</span>&#160;</div><div class="line"><a name="l00667"></a><span class="lineno">  667</span>&#160;   <span class="keywordflow">switch</span> (cmd) {</div><div class="line"><a name="l00668"></a><span class="lineno">  668</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="../../dc/db0/cli_8h.html#ab33e5350a923c3a8cedbeb496cd88ec9a71745eb63dd093f560a1add3e430d2a9">CLI_INIT</a>:</div><div class="line"><a name="l00669"></a><span class="lineno">  669</span>&#160;      e-&gt;<a class="code" href="../../d8/d07/structast__cli__entry.html#ade9cba72805fe52685a1deea307a8e82">command</a> = <span class="stringliteral">&quot;database del&quot;</span>;</div><div class="line"><a name="l00670"></a><span class="lineno">  670</span>&#160;      e-&gt;<a class="code" href="../../d8/d07/structast__cli__entry.html#aef1bd6ad890a110b466cb0e8088507a2">usage</a> =</div><div class="line"><a name="l00671"></a><span class="lineno">  671</span>&#160;         <span class="stringliteral">&quot;Usage: database del &lt;family&gt; &lt;key&gt;\n&quot;</span></div><div class="line"><a name="l00672"></a><span class="lineno">  672</span>&#160;         <span class="stringliteral">&quot;       Deletes an entry in the Asterisk database for a given\n&quot;</span></div><div class="line"><a name="l00673"></a><span class="lineno">  673</span>&#160;         <span class="stringliteral">&quot;       family and key.\n&quot;</span>;</div><div class="line"><a name="l00674"></a><span class="lineno">  674</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l00675"></a><span class="lineno">  675</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="../../dc/db0/cli_8h.html#ab33e5350a923c3a8cedbeb496cd88ec9a76bf33139279b03ec1691f2be2d1be40">CLI_GENERATE</a>:</div><div class="line"><a name="l00676"></a><span class="lineno">  676</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l00677"></a><span class="lineno">  677</span>&#160;   }</div><div class="line"><a name="l00678"></a><span class="lineno">  678</span>&#160;</div><div class="line"><a name="l00679"></a><span class="lineno">  679</span>&#160;   <span class="keywordflow">if</span> (a-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#a98e1d8441ca58834f11f7367be4b3345">argc</a> != 4)</div><div class="line"><a name="l00680"></a><span class="lineno">  680</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/db0/cli_8h.html#a0873456096960dab21fff0ce68c95acb">CLI_SHOWUSAGE</a>;</div><div class="line"><a name="l00681"></a><span class="lineno">  681</span>&#160;   res = <a class="code" href="../../da/d21/main_2db_8c.html#a71e8d5ab1757b184683a99125d1c8160">ast_db_del</a>(a-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#ad0a19c4d63698f9e9cfd5653e8851452">argv</a>[2], a-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#ad0a19c4d63698f9e9cfd5653e8851452">argv</a>[3]);</div><div class="line"><a name="l00682"></a><span class="lineno">  682</span>&#160;   <span class="keywordflow">if</span> (res) {</div><div class="line"><a name="l00683"></a><span class="lineno">  683</span>&#160;      <a class="code" href="../../dc/db0/cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#acf64f219885421479997667d2ed3f08a">fd</a>, <span class="stringliteral">&quot;Database entry does not exist.\n&quot;</span>);</div><div class="line"><a name="l00684"></a><span class="lineno">  684</span>&#160;   } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00685"></a><span class="lineno">  685</span>&#160;      <a class="code" href="../../dc/db0/cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#acf64f219885421479997667d2ed3f08a">fd</a>, <span class="stringliteral">&quot;Database entry removed.\n&quot;</span>);</div><div class="line"><a name="l00686"></a><span class="lineno">  686</span>&#160;   }</div><div class="line"><a name="l00687"></a><span class="lineno">  687</span>&#160;   <span class="keywordflow">return</span> <a class="code" href="../../dc/db0/cli_8h.html#a50989f00b32eeb2516a3803cb2ffb766">CLI_SUCCESS</a>;</div><div class="line"><a name="l00688"></a><span class="lineno">  688</span>&#160;}</div><div class="line"><a name="l00689"></a><span class="lineno">  689</span>&#160;</div><div class="line"><a name="l00690"></a><span class="lineno"><a class="line" href="../../da/d21/main_2db_8c.html#ac0dc7f1713e81aee579767f2269b6ce1">  690</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">char</span> *<a class="code" href="../../da/d21/main_2db_8c.html#ac0dc7f1713e81aee579767f2269b6ce1">handle_cli_database_deltree</a>(<span class="keyword">struct</span> <a class="code" href="../../d8/d07/structast__cli__entry.html">ast_cli_entry</a> *e, <span class="keywordtype">int</span> cmd, <span class="keyword">struct</span> <a class="code" href="../../d3/dad/structast__cli__args.html">ast_cli_args</a> *<a class="code" href="../../d7/d6f/test__linkedlists_8c.html#a13dd15487fee89a002d17ef3aff62d02">a</a>)</div><div class="line"><a name="l00691"></a><span class="lineno">  691</span>&#160;{</div><div class="line"><a name="l00692"></a><span class="lineno">  692</span>&#160;   <span class="keywordtype">int</span> num_deleted;</div><div class="line"><a name="l00693"></a><span class="lineno">  693</span>&#160;</div><div class="line"><a name="l00694"></a><span class="lineno">  694</span>&#160;   <span class="keywordflow">switch</span> (cmd) {</div><div class="line"><a name="l00695"></a><span class="lineno">  695</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="../../dc/db0/cli_8h.html#ab33e5350a923c3a8cedbeb496cd88ec9a71745eb63dd093f560a1add3e430d2a9">CLI_INIT</a>:</div><div class="line"><a name="l00696"></a><span class="lineno">  696</span>&#160;      e-&gt;<a class="code" href="../../d8/d07/structast__cli__entry.html#ade9cba72805fe52685a1deea307a8e82">command</a> = <span class="stringliteral">&quot;database deltree&quot;</span>;</div><div class="line"><a name="l00697"></a><span class="lineno">  697</span>&#160;      e-&gt;<a class="code" href="../../d8/d07/structast__cli__entry.html#aef1bd6ad890a110b466cb0e8088507a2">usage</a> =</div><div class="line"><a name="l00698"></a><span class="lineno">  698</span>&#160;         <span class="stringliteral">&quot;Usage: database deltree &lt;family&gt; [keytree]\n&quot;</span></div><div class="line"><a name="l00699"></a><span class="lineno">  699</span>&#160;         <span class="stringliteral">&quot;   OR: database deltree &lt;family&gt;[/keytree]\n&quot;</span></div><div class="line"><a name="l00700"></a><span class="lineno">  700</span>&#160;         <span class="stringliteral">&quot;       Deletes a family or specific keytree within a family\n&quot;</span></div><div class="line"><a name="l00701"></a><span class="lineno">  701</span>&#160;         <span class="stringliteral">&quot;       in the Asterisk database.  The two arguments may be\n&quot;</span></div><div class="line"><a name="l00702"></a><span class="lineno">  702</span>&#160;         <span class="stringliteral">&quot;       separated by either a space or a slash.\n&quot;</span>;</div><div class="line"><a name="l00703"></a><span class="lineno">  703</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l00704"></a><span class="lineno">  704</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="../../dc/db0/cli_8h.html#ab33e5350a923c3a8cedbeb496cd88ec9a76bf33139279b03ec1691f2be2d1be40">CLI_GENERATE</a>:</div><div class="line"><a name="l00705"></a><span class="lineno">  705</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l00706"></a><span class="lineno">  706</span>&#160;   }</div><div class="line"><a name="l00707"></a><span class="lineno">  707</span>&#160;</div><div class="line"><a name="l00708"></a><span class="lineno">  708</span>&#160;   <span class="keywordflow">if</span> ((a-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#a98e1d8441ca58834f11f7367be4b3345">argc</a> &lt; 3) || (a-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#a98e1d8441ca58834f11f7367be4b3345">argc</a> &gt; 4))</div><div class="line"><a name="l00709"></a><span class="lineno">  709</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/db0/cli_8h.html#a0873456096960dab21fff0ce68c95acb">CLI_SHOWUSAGE</a>;</div><div class="line"><a name="l00710"></a><span class="lineno">  710</span>&#160;   <span class="keywordflow">if</span> (a-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#a98e1d8441ca58834f11f7367be4b3345">argc</a> == 4) {</div><div class="line"><a name="l00711"></a><span class="lineno">  711</span>&#160;      num_deleted = <a class="code" href="../../da/d21/main_2db_8c.html#af251d986cfe884ffd5ca864531253f62">ast_db_deltree</a>(a-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#ad0a19c4d63698f9e9cfd5653e8851452">argv</a>[2], a-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#ad0a19c4d63698f9e9cfd5653e8851452">argv</a>[3]);</div><div class="line"><a name="l00712"></a><span class="lineno">  712</span>&#160;   } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00713"></a><span class="lineno">  713</span>&#160;      num_deleted = <a class="code" href="../../da/d21/main_2db_8c.html#af251d986cfe884ffd5ca864531253f62">ast_db_deltree</a>(a-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#ad0a19c4d63698f9e9cfd5653e8851452">argv</a>[2], <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div><div class="line"><a name="l00714"></a><span class="lineno">  714</span>&#160;   }</div><div class="line"><a name="l00715"></a><span class="lineno">  715</span>&#160;   <span class="keywordflow">if</span> (num_deleted &lt; 0) {</div><div class="line"><a name="l00716"></a><span class="lineno">  716</span>&#160;      <a class="code" href="../../dc/db0/cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#acf64f219885421479997667d2ed3f08a">fd</a>, <span class="stringliteral">&quot;Database unavailable.\n&quot;</span>);</div><div class="line"><a name="l00717"></a><span class="lineno">  717</span>&#160;   } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (num_deleted == 0) {</div><div class="line"><a name="l00718"></a><span class="lineno">  718</span>&#160;      <a class="code" href="../../dc/db0/cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#acf64f219885421479997667d2ed3f08a">fd</a>, <span class="stringliteral">&quot;Database entries do not exist.\n&quot;</span>);</div><div class="line"><a name="l00719"></a><span class="lineno">  719</span>&#160;   } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00720"></a><span class="lineno">  720</span>&#160;      <a class="code" href="../../dc/db0/cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#acf64f219885421479997667d2ed3f08a">fd</a>, <span class="stringliteral">&quot;%d database entries removed.\n&quot;</span>,num_deleted);</div><div class="line"><a name="l00721"></a><span class="lineno">  721</span>&#160;   }</div><div class="line"><a name="l00722"></a><span class="lineno">  722</span>&#160;   <span class="keywordflow">return</span> <a class="code" href="../../dc/db0/cli_8h.html#a50989f00b32eeb2516a3803cb2ffb766">CLI_SUCCESS</a>;</div><div class="line"><a name="l00723"></a><span class="lineno">  723</span>&#160;}</div><div class="line"><a name="l00724"></a><span class="lineno">  724</span>&#160;</div><div class="line"><a name="l00725"></a><span class="lineno"><a class="line" href="../../da/d21/main_2db_8c.html#aed10f708f89ad5111a2f1ca77013305e">  725</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">char</span> *<a class="code" href="../../da/d21/main_2db_8c.html#aed10f708f89ad5111a2f1ca77013305e">handle_cli_database_show</a>(<span class="keyword">struct</span> <a class="code" href="../../d8/d07/structast__cli__entry.html">ast_cli_entry</a> *e, <span class="keywordtype">int</span> cmd, <span class="keyword">struct</span> <a class="code" href="../../d3/dad/structast__cli__args.html">ast_cli_args</a> *<a class="code" href="../../d7/d6f/test__linkedlists_8c.html#a13dd15487fee89a002d17ef3aff62d02">a</a>)</div><div class="line"><a name="l00726"></a><span class="lineno">  726</span>&#160;{</div><div class="line"><a name="l00727"></a><span class="lineno">  727</span>&#160;   <span class="keywordtype">char</span> <a class="code" href="../../dd/d43/http_8c.html#a6f25bc812d09fedb86bf394c01061c56">prefix</a>[<a class="code" href="../../da/d21/main_2db_8c.html#afe1f0caaa1c711f16bb23bfcc54ff386">MAX_DB_FIELD</a>];</div><div class="line"><a name="l00728"></a><span class="lineno">  728</span>&#160;   <span class="keywordtype">int</span> counter = 0;</div><div class="line"><a name="l00729"></a><span class="lineno">  729</span>&#160;   sqlite3_stmt *stmt = gettree_stmt;</div><div class="line"><a name="l00730"></a><span class="lineno">  730</span>&#160;</div><div class="line"><a name="l00731"></a><span class="lineno">  731</span>&#160;   <span class="keywordflow">switch</span> (cmd) {</div><div class="line"><a name="l00732"></a><span class="lineno">  732</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="../../dc/db0/cli_8h.html#ab33e5350a923c3a8cedbeb496cd88ec9a71745eb63dd093f560a1add3e430d2a9">CLI_INIT</a>:</div><div class="line"><a name="l00733"></a><span class="lineno">  733</span>&#160;      e-&gt;<a class="code" href="../../d8/d07/structast__cli__entry.html#ade9cba72805fe52685a1deea307a8e82">command</a> = <span class="stringliteral">&quot;database show&quot;</span>;</div><div class="line"><a name="l00734"></a><span class="lineno">  734</span>&#160;      e-&gt;<a class="code" href="../../d8/d07/structast__cli__entry.html#aef1bd6ad890a110b466cb0e8088507a2">usage</a> =</div><div class="line"><a name="l00735"></a><span class="lineno">  735</span>&#160;         <span class="stringliteral">&quot;Usage: database show [family [keytree]]\n&quot;</span></div><div class="line"><a name="l00736"></a><span class="lineno">  736</span>&#160;         <span class="stringliteral">&quot;   OR: database show [family[/keytree]]\n&quot;</span></div><div class="line"><a name="l00737"></a><span class="lineno">  737</span>&#160;         <span class="stringliteral">&quot;       Shows Asterisk database contents, optionally restricted\n&quot;</span></div><div class="line"><a name="l00738"></a><span class="lineno">  738</span>&#160;         <span class="stringliteral">&quot;       to a given family, or family and keytree. The two arguments\n&quot;</span></div><div class="line"><a name="l00739"></a><span class="lineno">  739</span>&#160;         <span class="stringliteral">&quot;       may be separated either by a space or by a slash.\n&quot;</span>;</div><div class="line"><a name="l00740"></a><span class="lineno">  740</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l00741"></a><span class="lineno">  741</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="../../dc/db0/cli_8h.html#ab33e5350a923c3a8cedbeb496cd88ec9a76bf33139279b03ec1691f2be2d1be40">CLI_GENERATE</a>:</div><div class="line"><a name="l00742"></a><span class="lineno">  742</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l00743"></a><span class="lineno">  743</span>&#160;   }</div><div class="line"><a name="l00744"></a><span class="lineno">  744</span>&#160;</div><div class="line"><a name="l00745"></a><span class="lineno">  745</span>&#160;   <span class="keywordflow">if</span> (a-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#a98e1d8441ca58834f11f7367be4b3345">argc</a> == 4) {</div><div class="line"><a name="l00746"></a><span class="lineno">  746</span>&#160;      <span class="comment">/* Family and key tree */</span></div><div class="line"><a name="l00747"></a><span class="lineno">  747</span>&#160;      snprintf(prefix, <span class="keyword">sizeof</span>(prefix), <span class="stringliteral">&quot;/%s/%s&quot;</span>, a-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#ad0a19c4d63698f9e9cfd5653e8851452">argv</a>[2], a-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#ad0a19c4d63698f9e9cfd5653e8851452">argv</a>[3]);</div><div class="line"><a name="l00748"></a><span class="lineno">  748</span>&#160;   } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (a-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#a98e1d8441ca58834f11f7367be4b3345">argc</a> == 3) {</div><div class="line"><a name="l00749"></a><span class="lineno">  749</span>&#160;      <span class="comment">/* Family only */</span></div><div class="line"><a name="l00750"></a><span class="lineno">  750</span>&#160;      snprintf(prefix, <span class="keyword">sizeof</span>(prefix), <span class="stringliteral">&quot;/%s&quot;</span>, a-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#ad0a19c4d63698f9e9cfd5653e8851452">argv</a>[2]);</div><div class="line"><a name="l00751"></a><span class="lineno">  751</span>&#160;   } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (a-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#a98e1d8441ca58834f11f7367be4b3345">argc</a> == 2) {</div><div class="line"><a name="l00752"></a><span class="lineno">  752</span>&#160;      <span class="comment">/* Neither */</span></div><div class="line"><a name="l00753"></a><span class="lineno">  753</span>&#160;      prefix[0] = <span class="charliteral">&#39;\0&#39;</span>;</div><div class="line"><a name="l00754"></a><span class="lineno">  754</span>&#160;      stmt = gettree_all_stmt;</div><div class="line"><a name="l00755"></a><span class="lineno">  755</span>&#160;</div><div class="line"><a name="l00756"></a><span class="lineno">  756</span>&#160;   } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00757"></a><span class="lineno">  757</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/db0/cli_8h.html#a0873456096960dab21fff0ce68c95acb">CLI_SHOWUSAGE</a>;</div><div class="line"><a name="l00758"></a><span class="lineno">  758</span>&#160;   }</div><div class="line"><a name="l00759"></a><span class="lineno">  759</span>&#160;</div><div class="line"><a name="l00760"></a><span class="lineno">  760</span>&#160;   <a class="code" href="../../dd/d42/lock_8h.html#ac5e13c7fe64d3b271a52028b0a78b92b">ast_mutex_lock</a>(&amp;<a class="code" href="../../da/d21/main_2db_8c.html#a885611b04f0f81cde233f5648aa58b7c">dblock</a>);</div><div class="line"><a name="l00761"></a><span class="lineno">  761</span>&#160;   <span class="keywordflow">if</span> (!<a class="code" href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a>(prefix) &amp;&amp; (sqlite3_bind_text(stmt, 1, prefix, -1, SQLITE_STATIC) != SQLITE_OK)) {</div><div class="line"><a name="l00762"></a><span class="lineno">  762</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Could bind %s to stmt: %s\n&quot;</span>, prefix, sqlite3_errmsg(<a class="code" href="../../da/d21/main_2db_8c.html#a59f6376a471012a10b27b3e902256be0">astdb</a>));</div><div class="line"><a name="l00763"></a><span class="lineno">  763</span>&#160;      sqlite3_reset(stmt);</div><div class="line"><a name="l00764"></a><span class="lineno">  764</span>&#160;      <a class="code" href="../../dd/d42/lock_8h.html#a873f9ce8c6287a32d48c83133e124418">ast_mutex_unlock</a>(&amp;<a class="code" href="../../da/d21/main_2db_8c.html#a885611b04f0f81cde233f5648aa58b7c">dblock</a>);</div><div class="line"><a name="l00765"></a><span class="lineno">  765</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l00766"></a><span class="lineno">  766</span>&#160;   }</div><div class="line"><a name="l00767"></a><span class="lineno">  767</span>&#160;</div><div class="line"><a name="l00768"></a><span class="lineno">  768</span>&#160;   <span class="keywordflow">while</span> (sqlite3_step(stmt) == SQLITE_ROW) {</div><div class="line"><a name="l00769"></a><span class="lineno">  769</span>&#160;      <span class="keyword">const</span> <span class="keywordtype">char</span> *key_s, *value_s;</div><div class="line"><a name="l00770"></a><span class="lineno">  770</span>&#160;      <span class="keywordflow">if</span> (!(key_s = (<span class="keyword">const</span> <span class="keywordtype">char</span> *) sqlite3_column_text(stmt, 0))) {</div><div class="line"><a name="l00771"></a><span class="lineno">  771</span>&#160;         <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Skipping invalid key!\n&quot;</span>);</div><div class="line"><a name="l00772"></a><span class="lineno">  772</span>&#160;         <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00773"></a><span class="lineno">  773</span>&#160;      }</div><div class="line"><a name="l00774"></a><span class="lineno">  774</span>&#160;      <span class="keywordflow">if</span> (!(value_s = (<span class="keyword">const</span> <span class="keywordtype">char</span> *) sqlite3_column_text(stmt, 1))) {</div><div class="line"><a name="l00775"></a><span class="lineno">  775</span>&#160;         <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Skipping invalid value!\n&quot;</span>);</div><div class="line"><a name="l00776"></a><span class="lineno">  776</span>&#160;         <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00777"></a><span class="lineno">  777</span>&#160;      }</div><div class="line"><a name="l00778"></a><span class="lineno">  778</span>&#160;      ++counter;</div><div class="line"><a name="l00779"></a><span class="lineno">  779</span>&#160;      <a class="code" href="../../dc/db0/cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#acf64f219885421479997667d2ed3f08a">fd</a>, <span class="stringliteral">&quot;%-50s: %-25s\n&quot;</span>, key_s, value_s);</div><div class="line"><a name="l00780"></a><span class="lineno">  780</span>&#160;   }</div><div class="line"><a name="l00781"></a><span class="lineno">  781</span>&#160;</div><div class="line"><a name="l00782"></a><span class="lineno">  782</span>&#160;   sqlite3_reset(stmt);</div><div class="line"><a name="l00783"></a><span class="lineno">  783</span>&#160;   <a class="code" href="../../dd/d42/lock_8h.html#a873f9ce8c6287a32d48c83133e124418">ast_mutex_unlock</a>(&amp;<a class="code" href="../../da/d21/main_2db_8c.html#a885611b04f0f81cde233f5648aa58b7c">dblock</a>);</div><div class="line"><a name="l00784"></a><span class="lineno">  784</span>&#160;</div><div class="line"><a name="l00785"></a><span class="lineno">  785</span>&#160;   <a class="code" href="../../dc/db0/cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#acf64f219885421479997667d2ed3f08a">fd</a>, <span class="stringliteral">&quot;%d results found.\n&quot;</span>, counter);</div><div class="line"><a name="l00786"></a><span class="lineno">  786</span>&#160;   <span class="keywordflow">return</span> <a class="code" href="../../dc/db0/cli_8h.html#a50989f00b32eeb2516a3803cb2ffb766">CLI_SUCCESS</a>;</div><div class="line"><a name="l00787"></a><span class="lineno">  787</span>&#160;}</div><div class="line"><a name="l00788"></a><span class="lineno">  788</span>&#160;</div><div class="line"><a name="l00789"></a><span class="lineno"><a class="line" href="../../da/d21/main_2db_8c.html#ade1bc05ba29175fe3f6a5f2b67143ffd">  789</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">char</span> *<a class="code" href="../../da/d21/main_2db_8c.html#ade1bc05ba29175fe3f6a5f2b67143ffd">handle_cli_database_showkey</a>(<span class="keyword">struct</span> <a class="code" href="../../d8/d07/structast__cli__entry.html">ast_cli_entry</a> *e, <span class="keywordtype">int</span> cmd, <span class="keyword">struct</span> <a class="code" href="../../d3/dad/structast__cli__args.html">ast_cli_args</a> *<a class="code" href="../../d7/d6f/test__linkedlists_8c.html#a13dd15487fee89a002d17ef3aff62d02">a</a>)</div><div class="line"><a name="l00790"></a><span class="lineno">  790</span>&#160;{</div><div class="line"><a name="l00791"></a><span class="lineno">  791</span>&#160;   <span class="keywordtype">int</span> counter = 0;</div><div class="line"><a name="l00792"></a><span class="lineno">  792</span>&#160;</div><div class="line"><a name="l00793"></a><span class="lineno">  793</span>&#160;   <span class="keywordflow">switch</span> (cmd) {</div><div class="line"><a name="l00794"></a><span class="lineno">  794</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="../../dc/db0/cli_8h.html#ab33e5350a923c3a8cedbeb496cd88ec9a71745eb63dd093f560a1add3e430d2a9">CLI_INIT</a>:</div><div class="line"><a name="l00795"></a><span class="lineno">  795</span>&#160;      e-&gt;<a class="code" href="../../d8/d07/structast__cli__entry.html#ade9cba72805fe52685a1deea307a8e82">command</a> = <span class="stringliteral">&quot;database showkey&quot;</span>;</div><div class="line"><a name="l00796"></a><span class="lineno">  796</span>&#160;      e-&gt;<a class="code" href="../../d8/d07/structast__cli__entry.html#aef1bd6ad890a110b466cb0e8088507a2">usage</a> =</div><div class="line"><a name="l00797"></a><span class="lineno">  797</span>&#160;         <span class="stringliteral">&quot;Usage: database showkey &lt;keytree&gt;\n&quot;</span></div><div class="line"><a name="l00798"></a><span class="lineno">  798</span>&#160;         <span class="stringliteral">&quot;       Shows Asterisk database contents, restricted to a given key.\n&quot;</span>;</div><div class="line"><a name="l00799"></a><span class="lineno">  799</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l00800"></a><span class="lineno">  800</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="../../dc/db0/cli_8h.html#ab33e5350a923c3a8cedbeb496cd88ec9a76bf33139279b03ec1691f2be2d1be40">CLI_GENERATE</a>:</div><div class="line"><a name="l00801"></a><span class="lineno">  801</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l00802"></a><span class="lineno">  802</span>&#160;   }</div><div class="line"><a name="l00803"></a><span class="lineno">  803</span>&#160;</div><div class="line"><a name="l00804"></a><span class="lineno">  804</span>&#160;   <span class="keywordflow">if</span> (a-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#a98e1d8441ca58834f11f7367be4b3345">argc</a> != 3) {</div><div class="line"><a name="l00805"></a><span class="lineno">  805</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/db0/cli_8h.html#a0873456096960dab21fff0ce68c95acb">CLI_SHOWUSAGE</a>;</div><div class="line"><a name="l00806"></a><span class="lineno">  806</span>&#160;   }</div><div class="line"><a name="l00807"></a><span class="lineno">  807</span>&#160;</div><div class="line"><a name="l00808"></a><span class="lineno">  808</span>&#160;   <a class="code" href="../../dd/d42/lock_8h.html#ac5e13c7fe64d3b271a52028b0a78b92b">ast_mutex_lock</a>(&amp;<a class="code" href="../../da/d21/main_2db_8c.html#a885611b04f0f81cde233f5648aa58b7c">dblock</a>);</div><div class="line"><a name="l00809"></a><span class="lineno">  809</span>&#160;   <span class="keywordflow">if</span> (!<a class="code" href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a>(a-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#ad0a19c4d63698f9e9cfd5653e8851452">argv</a>[2]) &amp;&amp; (sqlite3_bind_text(showkey_stmt, 1, a-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#ad0a19c4d63698f9e9cfd5653e8851452">argv</a>[2], -1, SQLITE_STATIC) != SQLITE_OK)) {</div><div class="line"><a name="l00810"></a><span class="lineno">  810</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Could bind %s to stmt: %s\n&quot;</span>, a-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#ad0a19c4d63698f9e9cfd5653e8851452">argv</a>[2], sqlite3_errmsg(<a class="code" href="../../da/d21/main_2db_8c.html#a59f6376a471012a10b27b3e902256be0">astdb</a>));</div><div class="line"><a name="l00811"></a><span class="lineno">  811</span>&#160;      sqlite3_reset(showkey_stmt);</div><div class="line"><a name="l00812"></a><span class="lineno">  812</span>&#160;      <a class="code" href="../../dd/d42/lock_8h.html#a873f9ce8c6287a32d48c83133e124418">ast_mutex_unlock</a>(&amp;<a class="code" href="../../da/d21/main_2db_8c.html#a885611b04f0f81cde233f5648aa58b7c">dblock</a>);</div><div class="line"><a name="l00813"></a><span class="lineno">  813</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l00814"></a><span class="lineno">  814</span>&#160;   }</div><div class="line"><a name="l00815"></a><span class="lineno">  815</span>&#160;</div><div class="line"><a name="l00816"></a><span class="lineno">  816</span>&#160;   <span class="keywordflow">while</span> (sqlite3_step(showkey_stmt) == SQLITE_ROW) {</div><div class="line"><a name="l00817"></a><span class="lineno">  817</span>&#160;      <span class="keyword">const</span> <span class="keywordtype">char</span> *key_s, *value_s;</div><div class="line"><a name="l00818"></a><span class="lineno">  818</span>&#160;      <span class="keywordflow">if</span> (!(key_s = (<span class="keyword">const</span> <span class="keywordtype">char</span> *) sqlite3_column_text(showkey_stmt, 0))) {</div><div class="line"><a name="l00819"></a><span class="lineno">  819</span>&#160;         <span class="keywordflow">break</span>;</div><div class="line"><a name="l00820"></a><span class="lineno">  820</span>&#160;      }</div><div class="line"><a name="l00821"></a><span class="lineno">  821</span>&#160;      <span class="keywordflow">if</span> (!(value_s = (<span class="keyword">const</span> <span class="keywordtype">char</span> *) sqlite3_column_text(showkey_stmt, 1))) {</div><div class="line"><a name="l00822"></a><span class="lineno">  822</span>&#160;         <span class="keywordflow">break</span>;</div><div class="line"><a name="l00823"></a><span class="lineno">  823</span>&#160;      }</div><div class="line"><a name="l00824"></a><span class="lineno">  824</span>&#160;      ++counter;</div><div class="line"><a name="l00825"></a><span class="lineno">  825</span>&#160;      <a class="code" href="../../dc/db0/cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#acf64f219885421479997667d2ed3f08a">fd</a>, <span class="stringliteral">&quot;%-50s: %-25s\n&quot;</span>, key_s, value_s);</div><div class="line"><a name="l00826"></a><span class="lineno">  826</span>&#160;   }</div><div class="line"><a name="l00827"></a><span class="lineno">  827</span>&#160;   sqlite3_reset(showkey_stmt);</div><div class="line"><a name="l00828"></a><span class="lineno">  828</span>&#160;   <a class="code" href="../../dd/d42/lock_8h.html#a873f9ce8c6287a32d48c83133e124418">ast_mutex_unlock</a>(&amp;<a class="code" href="../../da/d21/main_2db_8c.html#a885611b04f0f81cde233f5648aa58b7c">dblock</a>);</div><div class="line"><a name="l00829"></a><span class="lineno">  829</span>&#160;</div><div class="line"><a name="l00830"></a><span class="lineno">  830</span>&#160;   <a class="code" href="../../dc/db0/cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#acf64f219885421479997667d2ed3f08a">fd</a>, <span class="stringliteral">&quot;%d results found.\n&quot;</span>, counter);</div><div class="line"><a name="l00831"></a><span class="lineno">  831</span>&#160;   <span class="keywordflow">return</span> <a class="code" href="../../dc/db0/cli_8h.html#a50989f00b32eeb2516a3803cb2ffb766">CLI_SUCCESS</a>;</div><div class="line"><a name="l00832"></a><span class="lineno">  832</span>&#160;}</div><div class="line"><a name="l00833"></a><span class="lineno">  833</span>&#160;</div><div class="line"><a name="l00834"></a><span class="lineno"><a class="line" href="../../da/d21/main_2db_8c.html#a65028e1ec1751f2c880ac29d2086ec49">  834</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../da/d21/main_2db_8c.html#a65028e1ec1751f2c880ac29d2086ec49">display_results</a>(<span class="keywordtype">void</span> *arg, <span class="keywordtype">int</span> <a class="code" href="../../d7/dec/structcolumns.html">columns</a>, <span class="keywordtype">char</span> **<a class="code" href="../../d2/d2b/structvalues.html">values</a>, <span class="keywordtype">char</span> **colnames)</div><div class="line"><a name="l00835"></a><span class="lineno">  835</span>&#160;{</div><div class="line"><a name="l00836"></a><span class="lineno">  836</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d3/dad/structast__cli__args.html">ast_cli_args</a> *<a class="code" href="../../d7/d6f/test__linkedlists_8c.html#a13dd15487fee89a002d17ef3aff62d02">a</a> = arg;</div><div class="line"><a name="l00837"></a><span class="lineno">  837</span>&#160;   <span class="keywordtype">size_t</span> x;</div><div class="line"><a name="l00838"></a><span class="lineno">  838</span>&#160;</div><div class="line"><a name="l00839"></a><span class="lineno">  839</span>&#160;   <span class="keywordflow">for</span> (x = 0; x &lt; <a class="code" href="../../d0/d29/cdr__mysql_8c.html#a9607ce10e06d5a012bffa2ab3ac23742">columns</a>; x++) {</div><div class="line"><a name="l00840"></a><span class="lineno">  840</span>&#160;      <a class="code" href="../../dc/db0/cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#acf64f219885421479997667d2ed3f08a">fd</a>, <span class="stringliteral">&quot;%-5s: %-50s\n&quot;</span>, colnames[x], values[x]);</div><div class="line"><a name="l00841"></a><span class="lineno">  841</span>&#160;   }</div><div class="line"><a name="l00842"></a><span class="lineno">  842</span>&#160;   <a class="code" href="../../dc/db0/cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#acf64f219885421479997667d2ed3f08a">fd</a>, <span class="stringliteral">&quot;\n&quot;</span>);</div><div class="line"><a name="l00843"></a><span class="lineno">  843</span>&#160;</div><div class="line"><a name="l00844"></a><span class="lineno">  844</span>&#160;   <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00845"></a><span class="lineno">  845</span>&#160;}</div><div class="line"><a name="l00846"></a><span class="lineno">  846</span>&#160;</div><div class="line"><a name="l00847"></a><span class="lineno"><a class="line" href="../../da/d21/main_2db_8c.html#a69be3660772d66c70e5f1d8ab2c27cef">  847</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">char</span> *<a class="code" href="../../da/d21/main_2db_8c.html#a69be3660772d66c70e5f1d8ab2c27cef">handle_cli_database_query</a>(<span class="keyword">struct</span> <a class="code" href="../../d8/d07/structast__cli__entry.html">ast_cli_entry</a> *e, <span class="keywordtype">int</span> cmd, <span class="keyword">struct</span> <a class="code" href="../../d3/dad/structast__cli__args.html">ast_cli_args</a> *<a class="code" href="../../d7/d6f/test__linkedlists_8c.html#a13dd15487fee89a002d17ef3aff62d02">a</a>)</div><div class="line"><a name="l00848"></a><span class="lineno">  848</span>&#160;{</div><div class="line"><a name="l00849"></a><span class="lineno">  849</span>&#160;</div><div class="line"><a name="l00850"></a><span class="lineno">  850</span>&#160;   <span class="keywordflow">switch</span> (cmd) {</div><div class="line"><a name="l00851"></a><span class="lineno">  851</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="../../dc/db0/cli_8h.html#ab33e5350a923c3a8cedbeb496cd88ec9a71745eb63dd093f560a1add3e430d2a9">CLI_INIT</a>:</div><div class="line"><a name="l00852"></a><span class="lineno">  852</span>&#160;      e-&gt;<a class="code" href="../../d8/d07/structast__cli__entry.html#ade9cba72805fe52685a1deea307a8e82">command</a> = <span class="stringliteral">&quot;database query&quot;</span>;</div><div class="line"><a name="l00853"></a><span class="lineno">  853</span>&#160;      e-&gt;<a class="code" href="../../d8/d07/structast__cli__entry.html#aef1bd6ad890a110b466cb0e8088507a2">usage</a> =</div><div class="line"><a name="l00854"></a><span class="lineno">  854</span>&#160;         <span class="stringliteral">&quot;Usage: database query \&quot;&lt;SQL Statement&gt;\&quot;\n&quot;</span></div><div class="line"><a name="l00855"></a><span class="lineno">  855</span>&#160;         <span class="stringliteral">&quot;       Run a user-specified SQL query on the database. Be careful.\n&quot;</span>;</div><div class="line"><a name="l00856"></a><span class="lineno">  856</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l00857"></a><span class="lineno">  857</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="../../dc/db0/cli_8h.html#ab33e5350a923c3a8cedbeb496cd88ec9a76bf33139279b03ec1691f2be2d1be40">CLI_GENERATE</a>:</div><div class="line"><a name="l00858"></a><span class="lineno">  858</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l00859"></a><span class="lineno">  859</span>&#160;   }</div><div class="line"><a name="l00860"></a><span class="lineno">  860</span>&#160;</div><div class="line"><a name="l00861"></a><span class="lineno">  861</span>&#160;   <span class="keywordflow">if</span> (a-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#a98e1d8441ca58834f11f7367be4b3345">argc</a> != 3) {</div><div class="line"><a name="l00862"></a><span class="lineno">  862</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/db0/cli_8h.html#a0873456096960dab21fff0ce68c95acb">CLI_SHOWUSAGE</a>;</div><div class="line"><a name="l00863"></a><span class="lineno">  863</span>&#160;   }</div><div class="line"><a name="l00864"></a><span class="lineno">  864</span>&#160;</div><div class="line"><a name="l00865"></a><span class="lineno">  865</span>&#160;   <a class="code" href="../../dd/d42/lock_8h.html#ac5e13c7fe64d3b271a52028b0a78b92b">ast_mutex_lock</a>(&amp;<a class="code" href="../../da/d21/main_2db_8c.html#a885611b04f0f81cde233f5648aa58b7c">dblock</a>);</div><div class="line"><a name="l00866"></a><span class="lineno">  866</span>&#160;   <a class="code" href="../../da/d21/main_2db_8c.html#a642962023fc731aa4c7d8e459865d986">db_execute_sql</a>(a-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#ad0a19c4d63698f9e9cfd5653e8851452">argv</a>[2], <a class="code" href="../../da/d21/main_2db_8c.html#a65028e1ec1751f2c880ac29d2086ec49">display_results</a>, a);</div><div class="line"><a name="l00867"></a><span class="lineno">  867</span>&#160;   <a class="code" href="../../da/d21/main_2db_8c.html#a0a19fc05bc020876fec791200e169eb2">db_sync</a>(); <span class="comment">/* Go ahead and sync the db in case they write */</span></div><div class="line"><a name="l00868"></a><span class="lineno">  868</span>&#160;   <a class="code" href="../../dd/d42/lock_8h.html#a873f9ce8c6287a32d48c83133e124418">ast_mutex_unlock</a>(&amp;<a class="code" href="../../da/d21/main_2db_8c.html#a885611b04f0f81cde233f5648aa58b7c">dblock</a>);</div><div class="line"><a name="l00869"></a><span class="lineno">  869</span>&#160;</div><div class="line"><a name="l00870"></a><span class="lineno">  870</span>&#160;   <span class="keywordflow">return</span> <a class="code" href="../../dc/db0/cli_8h.html#a50989f00b32eeb2516a3803cb2ffb766">CLI_SUCCESS</a>;</div><div class="line"><a name="l00871"></a><span class="lineno">  871</span>&#160;}</div><div class="line"><a name="l00872"></a><span class="lineno">  872</span>&#160;</div><div class="line"><a name="l00873"></a><span class="lineno"><a class="line" href="../../da/d21/main_2db_8c.html#a2956356b5eeaacfec5a223ce1417fc6d">  873</a></span>&#160;<span class="keyword">static</span> <span class="keyword">struct </span><a class="code" href="../../d8/d07/structast__cli__entry.html">ast_cli_entry</a> <a class="code" href="../../da/d21/main_2db_8c.html#a2956356b5eeaacfec5a223ce1417fc6d">cli_database</a>[] = {</div><div class="line"><a name="l00874"></a><span class="lineno">  874</span>&#160;   <a class="code" href="../../dc/db0/cli_8h.html#a5c4130cf8f1e93acfdd84416cebf1aef">AST_CLI_DEFINE</a>(<a class="code" href="../../da/d21/main_2db_8c.html#aed10f708f89ad5111a2f1ca77013305e">handle_cli_database_show</a>,    <span class="stringliteral">&quot;Shows database contents&quot;</span>),</div><div class="line"><a name="l00875"></a><span class="lineno">  875</span>&#160;   <a class="code" href="../../dc/db0/cli_8h.html#a5c4130cf8f1e93acfdd84416cebf1aef">AST_CLI_DEFINE</a>(<a class="code" href="../../da/d21/main_2db_8c.html#ade1bc05ba29175fe3f6a5f2b67143ffd">handle_cli_database_showkey</a>, <span class="stringliteral">&quot;Shows database contents&quot;</span>),</div><div class="line"><a name="l00876"></a><span class="lineno">  876</span>&#160;   <a class="code" href="../../dc/db0/cli_8h.html#a5c4130cf8f1e93acfdd84416cebf1aef">AST_CLI_DEFINE</a>(<a class="code" href="../../da/d21/main_2db_8c.html#afb5ce976f5d19ec85c79189213596d96">handle_cli_database_get</a>,     <span class="stringliteral">&quot;Gets database value&quot;</span>),</div><div class="line"><a name="l00877"></a><span class="lineno">  877</span>&#160;   <a class="code" href="../../dc/db0/cli_8h.html#a5c4130cf8f1e93acfdd84416cebf1aef">AST_CLI_DEFINE</a>(<a class="code" href="../../da/d21/main_2db_8c.html#a05c446a72a078b710425b61d0d999e07">handle_cli_database_put</a>,     <span class="stringliteral">&quot;Adds/updates database value&quot;</span>),</div><div class="line"><a name="l00878"></a><span class="lineno">  878</span>&#160;   <a class="code" href="../../dc/db0/cli_8h.html#a5c4130cf8f1e93acfdd84416cebf1aef">AST_CLI_DEFINE</a>(<a class="code" href="../../da/d21/main_2db_8c.html#ab2ffb685a189bc273c1de00753c31091">handle_cli_database_del</a>,     <span class="stringliteral">&quot;Removes database key/value&quot;</span>),</div><div class="line"><a name="l00879"></a><span class="lineno">  879</span>&#160;   <a class="code" href="../../dc/db0/cli_8h.html#a5c4130cf8f1e93acfdd84416cebf1aef">AST_CLI_DEFINE</a>(<a class="code" href="../../da/d21/main_2db_8c.html#ac0dc7f1713e81aee579767f2269b6ce1">handle_cli_database_deltree</a>, <span class="stringliteral">&quot;Removes database keytree/values&quot;</span>),</div><div class="line"><a name="l00880"></a><span class="lineno">  880</span>&#160;   <a class="code" href="../../dc/db0/cli_8h.html#a5c4130cf8f1e93acfdd84416cebf1aef">AST_CLI_DEFINE</a>(<a class="code" href="../../da/d21/main_2db_8c.html#a69be3660772d66c70e5f1d8ab2c27cef">handle_cli_database_query</a>,   <span class="stringliteral">&quot;Run a user-specified query on the astdb&quot;</span>),</div><div class="line"><a name="l00881"></a><span class="lineno">  881</span>&#160;};</div><div class="line"><a name="l00882"></a><span class="lineno">  882</span>&#160;</div><div class="line"><a name="l00883"></a><span class="lineno"><a class="line" href="../../da/d21/main_2db_8c.html#a63408b76b1f9eed31bcd1211d2081f03">  883</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../da/d21/main_2db_8c.html#a63408b76b1f9eed31bcd1211d2081f03">manager_dbput</a>(<span class="keyword">struct</span> <a class="code" href="../../d2/d8a/structmansession.html">mansession</a> *s, <span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="../../d8/d9e/structmessage.html">message</a> *m)</div><div class="line"><a name="l00884"></a><span class="lineno">  884</span>&#160;{</div><div class="line"><a name="l00885"></a><span class="lineno">  885</span>&#160;   <span class="keyword">const</span> <span class="keywordtype">char</span> *family = <a class="code" href="../../df/d72/group__Group__AMI.html#gac6a9f3498f9afffecfd78c485af41556">astman_get_header</a>(m, <span class="stringliteral">&quot;Family&quot;</span>);</div><div class="line"><a name="l00886"></a><span class="lineno">  886</span>&#160;   <span class="keyword">const</span> <span class="keywordtype">char</span> *key = <a class="code" href="../../df/d72/group__Group__AMI.html#gac6a9f3498f9afffecfd78c485af41556">astman_get_header</a>(m, <span class="stringliteral">&quot;Key&quot;</span>);</div><div class="line"><a name="l00887"></a><span class="lineno">  887</span>&#160;   <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="../../d5/d85/structval.html">val</a> = <a class="code" href="../../df/d72/group__Group__AMI.html#gac6a9f3498f9afffecfd78c485af41556">astman_get_header</a>(m, <span class="stringliteral">&quot;Val&quot;</span>);</div><div class="line"><a name="l00888"></a><span class="lineno">  888</span>&#160;   <span class="keywordtype">int</span> res;</div><div class="line"><a name="l00889"></a><span class="lineno">  889</span>&#160;</div><div class="line"><a name="l00890"></a><span class="lineno">  890</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a>(family)) {</div><div class="line"><a name="l00891"></a><span class="lineno">  891</span>&#160;      <a class="code" href="../../df/d72/group__Group__AMI.html#ga31a02a7d3cc36aa66ebebdedfc574d1c">astman_send_error</a>(s, m, <span class="stringliteral">&quot;No family specified&quot;</span>);</div><div class="line"><a name="l00892"></a><span class="lineno">  892</span>&#160;      <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00893"></a><span class="lineno">  893</span>&#160;   }</div><div class="line"><a name="l00894"></a><span class="lineno">  894</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a>(key)) {</div><div class="line"><a name="l00895"></a><span class="lineno">  895</span>&#160;      <a class="code" href="../../df/d72/group__Group__AMI.html#ga31a02a7d3cc36aa66ebebdedfc574d1c">astman_send_error</a>(s, m, <span class="stringliteral">&quot;No key specified&quot;</span>);</div><div class="line"><a name="l00896"></a><span class="lineno">  896</span>&#160;      <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00897"></a><span class="lineno">  897</span>&#160;   }</div><div class="line"><a name="l00898"></a><span class="lineno">  898</span>&#160;</div><div class="line"><a name="l00899"></a><span class="lineno">  899</span>&#160;   res = <a class="code" href="../../da/d21/main_2db_8c.html#a0f14f6bff4f412c88b50aba34d3a5e35">ast_db_put</a>(family, key, <a class="code" href="../../d6/d90/strings_8h.html#a2faaa16929951bfd2802b7829a100ba2">S_OR</a>(val, <span class="stringliteral">&quot;&quot;</span>));</div><div class="line"><a name="l00900"></a><span class="lineno">  900</span>&#160;   <span class="keywordflow">if</span> (res) {</div><div class="line"><a name="l00901"></a><span class="lineno">  901</span>&#160;      <a class="code" href="../../df/d72/group__Group__AMI.html#ga31a02a7d3cc36aa66ebebdedfc574d1c">astman_send_error</a>(s, m, <span class="stringliteral">&quot;Failed to update entry&quot;</span>);</div><div class="line"><a name="l00902"></a><span class="lineno">  902</span>&#160;   } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00903"></a><span class="lineno">  903</span>&#160;      <a class="code" href="../../df/d72/group__Group__AMI.html#ga77315fa8e29950f0c88120501acda0a3">astman_send_ack</a>(s, m, <span class="stringliteral">&quot;Updated database successfully&quot;</span>);</div><div class="line"><a name="l00904"></a><span class="lineno">  904</span>&#160;   }</div><div class="line"><a name="l00905"></a><span class="lineno">  905</span>&#160;   <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00906"></a><span class="lineno">  906</span>&#160;}</div><div class="line"><a name="l00907"></a><span class="lineno">  907</span>&#160;</div><div class="line"><a name="l00908"></a><span class="lineno"><a class="line" href="../../da/d21/main_2db_8c.html#a415a23bb61c561440bc3ae9d263461ad">  908</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../da/d21/main_2db_8c.html#a415a23bb61c561440bc3ae9d263461ad">manager_dbget</a>(<span class="keyword">struct</span> <a class="code" href="../../d2/d8a/structmansession.html">mansession</a> *s, <span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="../../d8/d9e/structmessage.html">message</a> *m)</div><div class="line"><a name="l00909"></a><span class="lineno">  909</span>&#160;{</div><div class="line"><a name="l00910"></a><span class="lineno">  910</span>&#160;   <span class="keyword">const</span> <span class="keywordtype">char</span> *<span class="keywordtype">id</span> = <a class="code" href="../../df/d72/group__Group__AMI.html#gac6a9f3498f9afffecfd78c485af41556">astman_get_header</a>(m,<span class="stringliteral">&quot;ActionID&quot;</span>);</div><div class="line"><a name="l00911"></a><span class="lineno">  911</span>&#160;   <span class="keywordtype">char</span> idText[256];</div><div class="line"><a name="l00912"></a><span class="lineno">  912</span>&#160;   <span class="keyword">const</span> <span class="keywordtype">char</span> *family = <a class="code" href="../../df/d72/group__Group__AMI.html#gac6a9f3498f9afffecfd78c485af41556">astman_get_header</a>(m, <span class="stringliteral">&quot;Family&quot;</span>);</div><div class="line"><a name="l00913"></a><span class="lineno">  913</span>&#160;   <span class="keyword">const</span> <span class="keywordtype">char</span> *key = <a class="code" href="../../df/d72/group__Group__AMI.html#gac6a9f3498f9afffecfd78c485af41556">astman_get_header</a>(m, <span class="stringliteral">&quot;Key&quot;</span>);</div><div class="line"><a name="l00914"></a><span class="lineno">  914</span>&#160;   <span class="keywordtype">char</span> <a class="code" href="../../de/d1e/bt__open_8c.html#a1cdd2bb1a9a71d3e1120100229315d67">tmp</a>[<a class="code" href="../../da/d21/main_2db_8c.html#afe1f0caaa1c711f16bb23bfcc54ff386">MAX_DB_FIELD</a>];</div><div class="line"><a name="l00915"></a><span class="lineno">  915</span>&#160;   <span class="keywordtype">int</span> res;</div><div class="line"><a name="l00916"></a><span class="lineno">  916</span>&#160;</div><div class="line"><a name="l00917"></a><span class="lineno">  917</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a>(family)) {</div><div class="line"><a name="l00918"></a><span class="lineno">  918</span>&#160;      <a class="code" href="../../df/d72/group__Group__AMI.html#ga31a02a7d3cc36aa66ebebdedfc574d1c">astman_send_error</a>(s, m, <span class="stringliteral">&quot;No family specified.&quot;</span>);</div><div class="line"><a name="l00919"></a><span class="lineno">  919</span>&#160;      <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00920"></a><span class="lineno">  920</span>&#160;   }</div><div class="line"><a name="l00921"></a><span class="lineno">  921</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a>(key)) {</div><div class="line"><a name="l00922"></a><span class="lineno">  922</span>&#160;      <a class="code" href="../../df/d72/group__Group__AMI.html#ga31a02a7d3cc36aa66ebebdedfc574d1c">astman_send_error</a>(s, m, <span class="stringliteral">&quot;No key specified.&quot;</span>);</div><div class="line"><a name="l00923"></a><span class="lineno">  923</span>&#160;      <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00924"></a><span class="lineno">  924</span>&#160;   }</div><div class="line"><a name="l00925"></a><span class="lineno">  925</span>&#160;</div><div class="line"><a name="l00926"></a><span class="lineno">  926</span>&#160;   idText[0] = <span class="charliteral">&#39;\0&#39;</span>;</div><div class="line"><a name="l00927"></a><span class="lineno">  927</span>&#160;   <span class="keywordflow">if</span> (!<a class="code" href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a>(<span class="keywordtype">id</span>))</div><div class="line"><a name="l00928"></a><span class="lineno">  928</span>&#160;      snprintf(idText, <span class="keyword">sizeof</span>(idText) ,<span class="stringliteral">&quot;ActionID: %s\r\n&quot;</span>, <span class="keywordtype">id</span>);</div><div class="line"><a name="l00929"></a><span class="lineno">  929</span>&#160;</div><div class="line"><a name="l00930"></a><span class="lineno">  930</span>&#160;   res = <a class="code" href="../../da/d21/main_2db_8c.html#a6ab91701fa0db9fad7759fe42a581c17">ast_db_get</a>(family, key, tmp, <span class="keyword">sizeof</span>(tmp));</div><div class="line"><a name="l00931"></a><span class="lineno">  931</span>&#160;   <span class="keywordflow">if</span> (res) {</div><div class="line"><a name="l00932"></a><span class="lineno">  932</span>&#160;      <a class="code" href="../../df/d72/group__Group__AMI.html#ga31a02a7d3cc36aa66ebebdedfc574d1c">astman_send_error</a>(s, m, <span class="stringliteral">&quot;Database entry not found&quot;</span>);</div><div class="line"><a name="l00933"></a><span class="lineno">  933</span>&#160;   } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00934"></a><span class="lineno">  934</span>&#160;      <a class="code" href="../../df/d72/group__Group__AMI.html#ga0ee6ee1f4d200f711e2983bffe770a72">astman_send_listack</a>(s, m, <span class="stringliteral">&quot;Result will follow&quot;</span>, <span class="stringliteral">&quot;start&quot;</span>);</div><div class="line"><a name="l00935"></a><span class="lineno">  935</span>&#160;</div><div class="line"><a name="l00936"></a><span class="lineno">  936</span>&#160;      <a class="code" href="../../df/d72/group__Group__AMI.html#gac2d42f7be13c532b6a70d50f1b8983d2">astman_append</a>(s, <span class="stringliteral">&quot;Event: DBGetResponse\r\n&quot;</span></div><div class="line"><a name="l00937"></a><span class="lineno">  937</span>&#160;            <span class="stringliteral">&quot;Family: %s\r\n&quot;</span></div><div class="line"><a name="l00938"></a><span class="lineno">  938</span>&#160;            <span class="stringliteral">&quot;Key: %s\r\n&quot;</span></div><div class="line"><a name="l00939"></a><span class="lineno">  939</span>&#160;            <span class="stringliteral">&quot;Val: %s\r\n&quot;</span></div><div class="line"><a name="l00940"></a><span class="lineno">  940</span>&#160;            <span class="stringliteral">&quot;%s&quot;</span></div><div class="line"><a name="l00941"></a><span class="lineno">  941</span>&#160;            <span class="stringliteral">&quot;\r\n&quot;</span>,</div><div class="line"><a name="l00942"></a><span class="lineno">  942</span>&#160;            family, key, tmp, idText);</div><div class="line"><a name="l00943"></a><span class="lineno">  943</span>&#160;</div><div class="line"><a name="l00944"></a><span class="lineno">  944</span>&#160;      <a class="code" href="../../df/d72/group__Group__AMI.html#ga58c3e3da5d31739cafaee1df6ddf9342">astman_send_list_complete_start</a>(s, m, <span class="stringliteral">&quot;DBGetComplete&quot;</span>, 1);</div><div class="line"><a name="l00945"></a><span class="lineno">  945</span>&#160;      <a class="code" href="../../df/d72/group__Group__AMI.html#gabf7c909efbfc26d0d9c66786c83b8f69">astman_send_list_complete_end</a>(s);</div><div class="line"><a name="l00946"></a><span class="lineno">  946</span>&#160;   }</div><div class="line"><a name="l00947"></a><span class="lineno">  947</span>&#160;   <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00948"></a><span class="lineno">  948</span>&#160;}</div><div class="line"><a name="l00949"></a><span class="lineno">  949</span>&#160;</div><div class="line"><a name="l00950"></a><span class="lineno"><a class="line" href="../../da/d21/main_2db_8c.html#a03f7dee6cad1dff30caf7133244cd811">  950</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../da/d21/main_2db_8c.html#a03f7dee6cad1dff30caf7133244cd811">manager_dbdel</a>(<span class="keyword">struct</span> <a class="code" href="../../d2/d8a/structmansession.html">mansession</a> *s, <span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="../../d8/d9e/structmessage.html">message</a> *m)</div><div class="line"><a name="l00951"></a><span class="lineno">  951</span>&#160;{</div><div class="line"><a name="l00952"></a><span class="lineno">  952</span>&#160;   <span class="keyword">const</span> <span class="keywordtype">char</span> *family = <a class="code" href="../../df/d72/group__Group__AMI.html#gac6a9f3498f9afffecfd78c485af41556">astman_get_header</a>(m, <span class="stringliteral">&quot;Family&quot;</span>);</div><div class="line"><a name="l00953"></a><span class="lineno">  953</span>&#160;   <span class="keyword">const</span> <span class="keywordtype">char</span> *key = <a class="code" href="../../df/d72/group__Group__AMI.html#gac6a9f3498f9afffecfd78c485af41556">astman_get_header</a>(m, <span class="stringliteral">&quot;Key&quot;</span>);</div><div class="line"><a name="l00954"></a><span class="lineno">  954</span>&#160;   <span class="keywordtype">int</span> res;</div><div class="line"><a name="l00955"></a><span class="lineno">  955</span>&#160;</div><div class="line"><a name="l00956"></a><span class="lineno">  956</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a>(family)) {</div><div class="line"><a name="l00957"></a><span class="lineno">  957</span>&#160;      <a class="code" href="../../df/d72/group__Group__AMI.html#ga31a02a7d3cc36aa66ebebdedfc574d1c">astman_send_error</a>(s, m, <span class="stringliteral">&quot;No family specified.&quot;</span>);</div><div class="line"><a name="l00958"></a><span class="lineno">  958</span>&#160;      <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00959"></a><span class="lineno">  959</span>&#160;   }</div><div class="line"><a name="l00960"></a><span class="lineno">  960</span>&#160;</div><div class="line"><a name="l00961"></a><span class="lineno">  961</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a>(key)) {</div><div class="line"><a name="l00962"></a><span class="lineno">  962</span>&#160;      <a class="code" href="../../df/d72/group__Group__AMI.html#ga31a02a7d3cc36aa66ebebdedfc574d1c">astman_send_error</a>(s, m, <span class="stringliteral">&quot;No key specified.&quot;</span>);</div><div class="line"><a name="l00963"></a><span class="lineno">  963</span>&#160;      <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00964"></a><span class="lineno">  964</span>&#160;   }</div><div class="line"><a name="l00965"></a><span class="lineno">  965</span>&#160;</div><div class="line"><a name="l00966"></a><span class="lineno">  966</span>&#160;   res = <a class="code" href="../../da/d21/main_2db_8c.html#a71e8d5ab1757b184683a99125d1c8160">ast_db_del</a>(family, key);</div><div class="line"><a name="l00967"></a><span class="lineno">  967</span>&#160;   <span class="keywordflow">if</span> (res)</div><div class="line"><a name="l00968"></a><span class="lineno">  968</span>&#160;      <a class="code" href="../../df/d72/group__Group__AMI.html#ga31a02a7d3cc36aa66ebebdedfc574d1c">astman_send_error</a>(s, m, <span class="stringliteral">&quot;Database entry not found&quot;</span>);</div><div class="line"><a name="l00969"></a><span class="lineno">  969</span>&#160;   <span class="keywordflow">else</span></div><div class="line"><a name="l00970"></a><span class="lineno">  970</span>&#160;      <a class="code" href="../../df/d72/group__Group__AMI.html#ga77315fa8e29950f0c88120501acda0a3">astman_send_ack</a>(s, m, <span class="stringliteral">&quot;Key deleted successfully&quot;</span>);</div><div class="line"><a name="l00971"></a><span class="lineno">  971</span>&#160;</div><div class="line"><a name="l00972"></a><span class="lineno">  972</span>&#160;   <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00973"></a><span class="lineno">  973</span>&#160;}</div><div class="line"><a name="l00974"></a><span class="lineno">  974</span>&#160;</div><div class="line"><a name="l00975"></a><span class="lineno"><a class="line" href="../../da/d21/main_2db_8c.html#a274fd536a82bf71830421f6b0ff63702">  975</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../da/d21/main_2db_8c.html#a274fd536a82bf71830421f6b0ff63702">manager_dbdeltree</a>(<span class="keyword">struct</span> <a class="code" href="../../d2/d8a/structmansession.html">mansession</a> *s, <span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="../../d8/d9e/structmessage.html">message</a> *m)</div><div class="line"><a name="l00976"></a><span class="lineno">  976</span>&#160;{</div><div class="line"><a name="l00977"></a><span class="lineno">  977</span>&#160;   <span class="keyword">const</span> <span class="keywordtype">char</span> *family = <a class="code" href="../../df/d72/group__Group__AMI.html#gac6a9f3498f9afffecfd78c485af41556">astman_get_header</a>(m, <span class="stringliteral">&quot;Family&quot;</span>);</div><div class="line"><a name="l00978"></a><span class="lineno">  978</span>&#160;   <span class="keyword">const</span> <span class="keywordtype">char</span> *key = <a class="code" href="../../df/d72/group__Group__AMI.html#gac6a9f3498f9afffecfd78c485af41556">astman_get_header</a>(m, <span class="stringliteral">&quot;Key&quot;</span>);</div><div class="line"><a name="l00979"></a><span class="lineno">  979</span>&#160;   <span class="keywordtype">int</span> num_deleted;</div><div class="line"><a name="l00980"></a><span class="lineno">  980</span>&#160;</div><div class="line"><a name="l00981"></a><span class="lineno">  981</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a>(family)) {</div><div class="line"><a name="l00982"></a><span class="lineno">  982</span>&#160;      <a class="code" href="../../df/d72/group__Group__AMI.html#ga31a02a7d3cc36aa66ebebdedfc574d1c">astman_send_error</a>(s, m, <span class="stringliteral">&quot;No family specified.&quot;</span>);</div><div class="line"><a name="l00983"></a><span class="lineno">  983</span>&#160;      <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00984"></a><span class="lineno">  984</span>&#160;   }</div><div class="line"><a name="l00985"></a><span class="lineno">  985</span>&#160;</div><div class="line"><a name="l00986"></a><span class="lineno">  986</span>&#160;   <span class="keywordflow">if</span> (!<a class="code" href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a>(key)) {</div><div class="line"><a name="l00987"></a><span class="lineno">  987</span>&#160;      num_deleted = <a class="code" href="../../da/d21/main_2db_8c.html#af251d986cfe884ffd5ca864531253f62">ast_db_deltree</a>(family, key);</div><div class="line"><a name="l00988"></a><span class="lineno">  988</span>&#160;   } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00989"></a><span class="lineno">  989</span>&#160;      num_deleted = <a class="code" href="../../da/d21/main_2db_8c.html#af251d986cfe884ffd5ca864531253f62">ast_db_deltree</a>(family, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div><div class="line"><a name="l00990"></a><span class="lineno">  990</span>&#160;   }</div><div class="line"><a name="l00991"></a><span class="lineno">  991</span>&#160;</div><div class="line"><a name="l00992"></a><span class="lineno">  992</span>&#160;   <span class="keywordflow">if</span> (num_deleted &lt; 0) {</div><div class="line"><a name="l00993"></a><span class="lineno">  993</span>&#160;      <a class="code" href="../../df/d72/group__Group__AMI.html#ga31a02a7d3cc36aa66ebebdedfc574d1c">astman_send_error</a>(s, m, <span class="stringliteral">&quot;Database unavailable&quot;</span>);</div><div class="line"><a name="l00994"></a><span class="lineno">  994</span>&#160;   } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (num_deleted == 0) {</div><div class="line"><a name="l00995"></a><span class="lineno">  995</span>&#160;      <a class="code" href="../../df/d72/group__Group__AMI.html#ga31a02a7d3cc36aa66ebebdedfc574d1c">astman_send_error</a>(s, m, <span class="stringliteral">&quot;Database entry not found&quot;</span>);</div><div class="line"><a name="l00996"></a><span class="lineno">  996</span>&#160;   } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00997"></a><span class="lineno">  997</span>&#160;      <a class="code" href="../../df/d72/group__Group__AMI.html#ga77315fa8e29950f0c88120501acda0a3">astman_send_ack</a>(s, m, <span class="stringliteral">&quot;Key tree deleted successfully&quot;</span>);</div><div class="line"><a name="l00998"></a><span class="lineno">  998</span>&#160;   }</div><div class="line"><a name="l00999"></a><span class="lineno">  999</span>&#160;</div><div class="line"><a name="l01000"></a><span class="lineno"> 1000</span>&#160;   <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l01001"></a><span class="lineno"> 1001</span>&#160;}</div><div class="line"><a name="l01002"></a><span class="lineno"> 1002</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01003"></a><span class="lineno"> 1003</span>&#160;<span class="comment">/*!</span></div><div class="line"><a name="l01004"></a><span class="lineno"> 1004</span>&#160;<span class="comment"> * \internal</span></div><div class="line"><a name="l01005"></a><span class="lineno"> 1005</span>&#160;<span class="comment"> * \brief Signal the astdb sync thread to do its thing.</span></div><div class="line"><a name="l01006"></a><span class="lineno"> 1006</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l01007"></a><span class="lineno"> 1007</span>&#160;<span class="comment"> * \note dblock is assumed to be held when calling this function.</span></div><div class="line"><a name="l01008"></a><span class="lineno"> 1008</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l01009"></a><span class="lineno"><a class="line" href="../../da/d21/main_2db_8c.html#a0a19fc05bc020876fec791200e169eb2"> 1009</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../da/d21/main_2db_8c.html#a0a19fc05bc020876fec791200e169eb2">db_sync</a>(<span class="keywordtype">void</span>)</div><div class="line"><a name="l01010"></a><span class="lineno"> 1010</span>&#160;{</div><div class="line"><a name="l01011"></a><span class="lineno"> 1011</span>&#160;   <a class="code" href="../../da/d21/main_2db_8c.html#abdf814ae947ec73f933c8f8839916d68">dosync</a> = 1;</div><div class="line"><a name="l01012"></a><span class="lineno"> 1012</span>&#160;   <a class="code" href="../../dd/d42/lock_8h.html#ae2cdf274a5da241c3ad7324d82bf6af0">ast_cond_signal</a>(&amp;<a class="code" href="../../da/d21/main_2db_8c.html#aa6604f5f92051f2351cd9a350d5f6284">dbcond</a>);</div><div class="line"><a name="l01013"></a><span class="lineno"> 1013</span>&#160;}</div><div class="line"><a name="l01014"></a><span class="lineno"> 1014</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01015"></a><span class="lineno"> 1015</span>&#160;<span class="comment">/*!</span></div><div class="line"><a name="l01016"></a><span class="lineno"> 1016</span>&#160;<span class="comment"> * \internal</span></div><div class="line"><a name="l01017"></a><span class="lineno"> 1017</span>&#160;<span class="comment"> * \brief astdb sync thread</span></div><div class="line"><a name="l01018"></a><span class="lineno"> 1018</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l01019"></a><span class="lineno"> 1019</span>&#160;<span class="comment"> * This thread is in charge of syncing astdb to disk after a change.</span></div><div class="line"><a name="l01020"></a><span class="lineno"> 1020</span>&#160;<span class="comment"> * By pushing it off to this thread to take care of, this I/O bound operation</span></div><div class="line"><a name="l01021"></a><span class="lineno"> 1021</span>&#160;<span class="comment"> * will not block other threads from performing other critical processing.</span></div><div class="line"><a name="l01022"></a><span class="lineno"> 1022</span>&#160;<span class="comment"> * If changes happen rapidly, this thread will also ensure that the sync</span></div><div class="line"><a name="l01023"></a><span class="lineno"> 1023</span>&#160;<span class="comment"> * operations are rate limited.</span></div><div class="line"><a name="l01024"></a><span class="lineno"> 1024</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l01025"></a><span class="lineno"><a class="line" href="../../da/d21/main_2db_8c.html#ac22ef757982d3cd0728dac39f0bbe834"> 1025</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> *<a class="code" href="../../da/d21/main_2db_8c.html#ac22ef757982d3cd0728dac39f0bbe834">db_sync_thread</a>(<span class="keywordtype">void</span> *data)</div><div class="line"><a name="l01026"></a><span class="lineno"> 1026</span>&#160;{</div><div class="line"><a name="l01027"></a><span class="lineno"> 1027</span>&#160;   <a class="code" href="../../dd/d42/lock_8h.html#ac5e13c7fe64d3b271a52028b0a78b92b">ast_mutex_lock</a>(&amp;<a class="code" href="../../da/d21/main_2db_8c.html#a885611b04f0f81cde233f5648aa58b7c">dblock</a>);</div><div class="line"><a name="l01028"></a><span class="lineno"> 1028</span>&#160;   <a class="code" href="../../da/d21/main_2db_8c.html#a6c334012bbd6b166af5841f29f9ae58c">ast_db_begin_transaction</a>();</div><div class="line"><a name="l01029"></a><span class="lineno"> 1029</span>&#160;   <span class="keywordflow">for</span> (;;) {</div><div class="line"><a name="l01030"></a><span class="lineno"> 1030</span>&#160;      <span class="comment">/* If dosync is set, db_sync() was called during sleep(1),</span></div><div class="line"><a name="l01031"></a><span class="lineno"> 1031</span>&#160;<span class="comment">       * and the pending transaction should be committed.</span></div><div class="line"><a name="l01032"></a><span class="lineno"> 1032</span>&#160;<span class="comment">       * Otherwise, block until db_sync() is called.</span></div><div class="line"><a name="l01033"></a><span class="lineno"> 1033</span>&#160;<span class="comment">       */</span></div><div class="line"><a name="l01034"></a><span class="lineno"> 1034</span>&#160;      <span class="keywordflow">while</span> (!<a class="code" href="../../da/d21/main_2db_8c.html#abdf814ae947ec73f933c8f8839916d68">dosync</a>) {</div><div class="line"><a name="l01035"></a><span class="lineno"> 1035</span>&#160;         <a class="code" href="../../dd/d42/lock_8h.html#a36233c5520173c095bf732a788356aee">ast_cond_wait</a>(&amp;<a class="code" href="../../da/d21/main_2db_8c.html#aa6604f5f92051f2351cd9a350d5f6284">dbcond</a>, &amp;<a class="code" href="../../da/d21/main_2db_8c.html#a885611b04f0f81cde233f5648aa58b7c">dblock</a>);</div><div class="line"><a name="l01036"></a><span class="lineno"> 1036</span>&#160;      }</div><div class="line"><a name="l01037"></a><span class="lineno"> 1037</span>&#160;      <a class="code" href="../../da/d21/main_2db_8c.html#abdf814ae947ec73f933c8f8839916d68">dosync</a> = 0;</div><div class="line"><a name="l01038"></a><span class="lineno"> 1038</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="../../da/d21/main_2db_8c.html#a736d314a0dfd064f03dcead874493f16">ast_db_commit_transaction</a>()) {</div><div class="line"><a name="l01039"></a><span class="lineno"> 1039</span>&#160;         <a class="code" href="../../da/d21/main_2db_8c.html#af06db2a8f64fb9fcd382b24a0cffd608">ast_db_rollback_transaction</a>();</div><div class="line"><a name="l01040"></a><span class="lineno"> 1040</span>&#160;      }</div><div class="line"><a name="l01041"></a><span class="lineno"> 1041</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="../../da/d21/main_2db_8c.html#a0e55a773a7175671526f96f16cc0fabd">doexit</a>) {</div><div class="line"><a name="l01042"></a><span class="lineno"> 1042</span>&#160;         <a class="code" href="../../dd/d42/lock_8h.html#a873f9ce8c6287a32d48c83133e124418">ast_mutex_unlock</a>(&amp;<a class="code" href="../../da/d21/main_2db_8c.html#a885611b04f0f81cde233f5648aa58b7c">dblock</a>);</div><div class="line"><a name="l01043"></a><span class="lineno"> 1043</span>&#160;         <span class="keywordflow">break</span>;</div><div class="line"><a name="l01044"></a><span class="lineno"> 1044</span>&#160;      }</div><div class="line"><a name="l01045"></a><span class="lineno"> 1045</span>&#160;      <a class="code" href="../../da/d21/main_2db_8c.html#a6c334012bbd6b166af5841f29f9ae58c">ast_db_begin_transaction</a>();</div><div class="line"><a name="l01046"></a><span class="lineno"> 1046</span>&#160;      <a class="code" href="../../dd/d42/lock_8h.html#a873f9ce8c6287a32d48c83133e124418">ast_mutex_unlock</a>(&amp;<a class="code" href="../../da/d21/main_2db_8c.html#a885611b04f0f81cde233f5648aa58b7c">dblock</a>);</div><div class="line"><a name="l01047"></a><span class="lineno"> 1047</span>&#160;      sleep(1);</div><div class="line"><a name="l01048"></a><span class="lineno"> 1048</span>&#160;      <a class="code" href="../../dd/d42/lock_8h.html#ac5e13c7fe64d3b271a52028b0a78b92b">ast_mutex_lock</a>(&amp;<a class="code" href="../../da/d21/main_2db_8c.html#a885611b04f0f81cde233f5648aa58b7c">dblock</a>);</div><div class="line"><a name="l01049"></a><span class="lineno"> 1049</span>&#160;   }</div><div class="line"><a name="l01050"></a><span class="lineno"> 1050</span>&#160;</div><div class="line"><a name="l01051"></a><span class="lineno"> 1051</span>&#160;   <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l01052"></a><span class="lineno"> 1052</span>&#160;}</div><div class="line"><a name="l01053"></a><span class="lineno"> 1053</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01054"></a><span class="lineno"> 1054</span>&#160;<span class="comment">/*!</span></div><div class="line"><a name="l01055"></a><span class="lineno"> 1055</span>&#160;<span class="comment"> * \internal</span></div><div class="line"><a name="l01056"></a><span class="lineno"> 1056</span>&#160;<span class="comment"> * \brief Clean up resources on Asterisk shutdown</span></div><div class="line"><a name="l01057"></a><span class="lineno"> 1057</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l01058"></a><span class="lineno"><a class="line" href="../../da/d21/main_2db_8c.html#ad49c809fe5f26726a336c23e6dc32c12"> 1058</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../da/d21/main_2db_8c.html#ad49c809fe5f26726a336c23e6dc32c12">astdb_atexit</a>(<span class="keywordtype">void</span>)</div><div class="line"><a name="l01059"></a><span class="lineno"> 1059</span>&#160;{</div><div class="line"><a name="l01060"></a><span class="lineno"> 1060</span>&#160;   <a class="code" href="../../dc/db0/cli_8h.html#a56b6b59ee2eaa994597a5b0f4e9f9d09">ast_cli_unregister_multiple</a>(cli_database, <a class="code" href="../../de/dfe/isdn__lib_8c.html#ab9129b977a587b50ea801daac75e178f">ARRAY_LEN</a>(cli_database));</div><div class="line"><a name="l01061"></a><span class="lineno"> 1061</span>&#160;   <a class="code" href="../../df/d72/group__Group__AMI.html#gafadf012f66a9fd7ecf985ec5b9dee101">ast_manager_unregister</a>(<span class="stringliteral">&quot;DBGet&quot;</span>);</div><div class="line"><a name="l01062"></a><span class="lineno"> 1062</span>&#160;   <a class="code" href="../../df/d72/group__Group__AMI.html#gafadf012f66a9fd7ecf985ec5b9dee101">ast_manager_unregister</a>(<span class="stringliteral">&quot;DBPut&quot;</span>);</div><div class="line"><a name="l01063"></a><span class="lineno"> 1063</span>&#160;   <a class="code" href="../../df/d72/group__Group__AMI.html#gafadf012f66a9fd7ecf985ec5b9dee101">ast_manager_unregister</a>(<span class="stringliteral">&quot;DBDel&quot;</span>);</div><div class="line"><a name="l01064"></a><span class="lineno"> 1064</span>&#160;   <a class="code" href="../../df/d72/group__Group__AMI.html#gafadf012f66a9fd7ecf985ec5b9dee101">ast_manager_unregister</a>(<span class="stringliteral">&quot;DBDelTree&quot;</span>);</div><div class="line"><a name="l01065"></a><span class="lineno"> 1065</span>&#160;</div><div class="line"><a name="l01066"></a><span class="lineno"> 1066</span>&#160;   <span class="comment">/* Set doexit to 1 to kill thread. db_sync must be called with</span></div><div class="line"><a name="l01067"></a><span class="lineno"> 1067</span>&#160;<span class="comment">    * mutex held. */</span></div><div class="line"><a name="l01068"></a><span class="lineno"> 1068</span>&#160;   <a class="code" href="../../dd/d42/lock_8h.html#ac5e13c7fe64d3b271a52028b0a78b92b">ast_mutex_lock</a>(&amp;<a class="code" href="../../da/d21/main_2db_8c.html#a885611b04f0f81cde233f5648aa58b7c">dblock</a>);</div><div class="line"><a name="l01069"></a><span class="lineno"> 1069</span>&#160;   <a class="code" href="../../da/d21/main_2db_8c.html#a0e55a773a7175671526f96f16cc0fabd">doexit</a> = 1;</div><div class="line"><a name="l01070"></a><span class="lineno"> 1070</span>&#160;   <a class="code" href="../../da/d21/main_2db_8c.html#a0a19fc05bc020876fec791200e169eb2">db_sync</a>();</div><div class="line"><a name="l01071"></a><span class="lineno"> 1071</span>&#160;   <a class="code" href="../../dd/d42/lock_8h.html#a873f9ce8c6287a32d48c83133e124418">ast_mutex_unlock</a>(&amp;<a class="code" href="../../da/d21/main_2db_8c.html#a885611b04f0f81cde233f5648aa58b7c">dblock</a>);</div><div class="line"><a name="l01072"></a><span class="lineno"> 1072</span>&#160;</div><div class="line"><a name="l01073"></a><span class="lineno"> 1073</span>&#160;   pthread_join(<a class="code" href="../../da/d21/main_2db_8c.html#ac332fd073c41ceb9b1826af8791b241b">syncthread</a>, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div><div class="line"><a name="l01074"></a><span class="lineno"> 1074</span>&#160;   <a class="code" href="../../dd/d42/lock_8h.html#ac5e13c7fe64d3b271a52028b0a78b92b">ast_mutex_lock</a>(&amp;<a class="code" href="../../da/d21/main_2db_8c.html#a885611b04f0f81cde233f5648aa58b7c">dblock</a>);</div><div class="line"><a name="l01075"></a><span class="lineno"> 1075</span>&#160;   <a class="code" href="../../da/d21/main_2db_8c.html#a113d1cff6b7f6ff34c7adf7d6ee6dfc8">clean_statements</a>();</div><div class="line"><a name="l01076"></a><span class="lineno"> 1076</span>&#160;   <span class="keywordflow">if</span> (sqlite3_close(<a class="code" href="../../da/d21/main_2db_8c.html#a59f6376a471012a10b27b3e902256be0">astdb</a>) == SQLITE_OK) {</div><div class="line"><a name="l01077"></a><span class="lineno"> 1077</span>&#160;      <a class="code" href="../../da/d21/main_2db_8c.html#a59f6376a471012a10b27b3e902256be0">astdb</a> = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l01078"></a><span class="lineno"> 1078</span>&#160;   }</div><div class="line"><a name="l01079"></a><span class="lineno"> 1079</span>&#160;   <a class="code" href="../../dd/d42/lock_8h.html#a873f9ce8c6287a32d48c83133e124418">ast_mutex_unlock</a>(&amp;<a class="code" href="../../da/d21/main_2db_8c.html#a885611b04f0f81cde233f5648aa58b7c">dblock</a>);</div><div class="line"><a name="l01080"></a><span class="lineno"> 1080</span>&#160;}</div><div class="line"><a name="l01081"></a><span class="lineno"> 1081</span>&#160;</div><div class="line"><a name="l01082"></a><span class="lineno"><a class="line" href="../../da/d21/main_2db_8c.html#a52d9808db8eba7a1ff32fc6686042f04"> 1082</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="../../da/d21/main_2db_8c.html#a52d9808db8eba7a1ff32fc6686042f04">astdb_init</a>(<span class="keywordtype">void</span>)</div><div class="line"><a name="l01083"></a><span class="lineno"> 1083</span>&#160;{</div><div class="line"><a name="l01084"></a><span class="lineno"> 1084</span>&#160;   <a class="code" href="../../dd/d42/lock_8h.html#a69e9591803d36f5683eb9b084442be9b">ast_cond_init</a>(&amp;<a class="code" href="../../da/d21/main_2db_8c.html#aa6604f5f92051f2351cd9a350d5f6284">dbcond</a>, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div><div class="line"><a name="l01085"></a><span class="lineno"> 1085</span>&#160;</div><div class="line"><a name="l01086"></a><span class="lineno"> 1086</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../da/d21/main_2db_8c.html#a4b1471f09e67989f00b31639c428fb24">db_init</a>()) {</div><div class="line"><a name="l01087"></a><span class="lineno"> 1087</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l01088"></a><span class="lineno"> 1088</span>&#160;   }</div><div class="line"><a name="l01089"></a><span class="lineno"> 1089</span>&#160;</div><div class="line"><a name="l01090"></a><span class="lineno"> 1090</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d5/d60/utils_8h.html#a595e2f8aa398f4bd21e381c3211235fe">ast_pthread_create_background</a>(&amp;<a class="code" href="../../da/d21/main_2db_8c.html#ac332fd073c41ceb9b1826af8791b241b">syncthread</a>, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../da/d21/main_2db_8c.html#ac22ef757982d3cd0728dac39f0bbe834">db_sync_thread</a>, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)) {</div><div class="line"><a name="l01091"></a><span class="lineno"> 1091</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l01092"></a><span class="lineno"> 1092</span>&#160;   }</div><div class="line"><a name="l01093"></a><span class="lineno"> 1093</span>&#160;</div><div class="line"><a name="l01094"></a><span class="lineno"> 1094</span>&#160;   <a class="code" href="../../db/db2/asterisk_8h.html#a9b09e95876dfecb9a8573819da0b255e">ast_register_atexit</a>(<a class="code" href="../../da/d21/main_2db_8c.html#ad49c809fe5f26726a336c23e6dc32c12">astdb_atexit</a>);</div><div class="line"><a name="l01095"></a><span class="lineno"> 1095</span>&#160;   <a class="code" href="../../dc/db0/cli_8h.html#aea8910ed9e301e7f741f87942c244eac">ast_cli_register_multiple</a>(cli_database, <a class="code" href="../../de/dfe/isdn__lib_8c.html#ab9129b977a587b50ea801daac75e178f">ARRAY_LEN</a>(cli_database));</div><div class="line"><a name="l01096"></a><span class="lineno"> 1096</span>&#160;   <a class="code" href="../../db/d45/manager_8h.html#a1d34461b8a3210b19e66f06bcdebfeb3">ast_manager_register_xml_core</a>(<span class="stringliteral">&quot;DBGet&quot;</span>, <a class="code" href="../../db/d45/manager_8h.html#a420f0f755e1c3378b45ca7f6f0669ffa">EVENT_FLAG_SYSTEM</a> | <a class="code" href="../../db/d45/manager_8h.html#a0b1b4140c2836696a6950e92ab48a580">EVENT_FLAG_REPORTING</a>, <a class="code" href="../../da/d21/main_2db_8c.html#a415a23bb61c561440bc3ae9d263461ad">manager_dbget</a>);</div><div class="line"><a name="l01097"></a><span class="lineno"> 1097</span>&#160;   <a class="code" href="../../db/d45/manager_8h.html#a1d34461b8a3210b19e66f06bcdebfeb3">ast_manager_register_xml_core</a>(<span class="stringliteral">&quot;DBPut&quot;</span>, <a class="code" href="../../db/d45/manager_8h.html#a420f0f755e1c3378b45ca7f6f0669ffa">EVENT_FLAG_SYSTEM</a>, <a class="code" href="../../da/d21/main_2db_8c.html#a63408b76b1f9eed31bcd1211d2081f03">manager_dbput</a>);</div><div class="line"><a name="l01098"></a><span class="lineno"> 1098</span>&#160;   <a class="code" href="../../db/d45/manager_8h.html#a1d34461b8a3210b19e66f06bcdebfeb3">ast_manager_register_xml_core</a>(<span class="stringliteral">&quot;DBDel&quot;</span>, <a class="code" href="../../db/d45/manager_8h.html#a420f0f755e1c3378b45ca7f6f0669ffa">EVENT_FLAG_SYSTEM</a>, <a class="code" href="../../da/d21/main_2db_8c.html#a03f7dee6cad1dff30caf7133244cd811">manager_dbdel</a>);</div><div class="line"><a name="l01099"></a><span class="lineno"> 1099</span>&#160;   <a class="code" href="../../db/d45/manager_8h.html#a1d34461b8a3210b19e66f06bcdebfeb3">ast_manager_register_xml_core</a>(<span class="stringliteral">&quot;DBDelTree&quot;</span>, <a class="code" href="../../db/d45/manager_8h.html#a420f0f755e1c3378b45ca7f6f0669ffa">EVENT_FLAG_SYSTEM</a>, <a class="code" href="../../da/d21/main_2db_8c.html#a274fd536a82bf71830421f6b0ff63702">manager_dbdeltree</a>);</div><div class="line"><a name="l01100"></a><span class="lineno"> 1100</span>&#160;   <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l01101"></a><span class="lineno"> 1101</span>&#160;}</div><div class="ttc" id="main_2db_8c_html_ae762c18aae8214fa4ceab417742bd19e"><div class="ttname"><a href="../../da/d21/main_2db_8c.html#ae762c18aae8214fa4ceab417742bd19e">clean_stmt</a></div><div class="ttdeci">static int clean_stmt(sqlite3_stmt **stmt, const char *sql)</div><div class="ttdef"><b>Definition:</b> <a href="../../da/d21/main_2db_8c_source.html#l00161">main/db.c:161</a></div></div>
<div class="ttc" id="main_2db_8c_html_a2956356b5eeaacfec5a223ce1417fc6d"><div class="ttname"><a href="../../da/d21/main_2db_8c.html#a2956356b5eeaacfec5a223ce1417fc6d">cli_database</a></div><div class="ttdeci">static struct ast_cli_entry cli_database[]</div><div class="ttdef"><b>Definition:</b> <a href="../../da/d21/main_2db_8c_source.html#l00873">main/db.c:873</a></div></div>
<div class="ttc" id="cli_8h_html_a5c4130cf8f1e93acfdd84416cebf1aef"><div class="ttname"><a href="../../dc/db0/cli_8h.html#a5c4130cf8f1e93acfdd84416cebf1aef">AST_CLI_DEFINE</a></div><div class="ttdeci">#define AST_CLI_DEFINE(fn, txt,...)</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/db0/cli_8h_source.html#l00197">cli.h:197</a></div></div>
<div class="ttc" id="main_2db_8c_html_ad49c809fe5f26726a336c23e6dc32c12"><div class="ttname"><a href="../../da/d21/main_2db_8c.html#ad49c809fe5f26726a336c23e6dc32c12">astdb_atexit</a></div><div class="ttdeci">static void astdb_atexit(void)</div><div class="ttdef"><b>Definition:</b> <a href="../../da/d21/main_2db_8c_source.html#l01058">main/db.c:1058</a></div></div>
<div class="ttc" id="structmessage_html"><div class="ttname"><a href="../../d8/d9e/structmessage.html">message</a></div><div class="ttdef"><b>Definition:</b> <a href="../../db/d45/manager_8h_source.html#l00144">manager.h:144</a></div></div>
<div class="ttc" id="group__Group__AMI_html_gac2d42f7be13c532b6a70d50f1b8983d2"><div class="ttname"><a href="../../df/d72/group__Group__AMI.html#gac2d42f7be13c532b6a70d50f1b8983d2">astman_append</a></div><div class="ttdeci">void astman_append(struct mansession *s, const char *fmt,...)</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d10/manager_8c_source.html#l03080">manager.c:3080</a></div></div>
<div class="ttc" id="asterisk_8h_html"><div class="ttname"><a href="../../db/db2/asterisk_8h.html">asterisk.h</a></div><div class="ttdoc">Asterisk main include file. File version handling, generic pbx functions. </div></div>
<div class="ttc" id="isdn__lib_8c_html_ab9129b977a587b50ea801daac75e178f"><div class="ttname"><a href="../../de/dfe/isdn__lib_8c.html#ab9129b977a587b50ea801daac75e178f">ARRAY_LEN</a></div><div class="ttdeci">#define ARRAY_LEN(a)</div><div class="ttdef"><b>Definition:</b> <a href="../../de/dfe/isdn__lib_8c_source.html#l00042">isdn_lib.c:42</a></div></div>
<div class="ttc" id="paths_8h_html_af89b8aa53d5b08a03b56f5163805bd97"><div class="ttname"><a href="../../dd/df2/paths_8h.html#af89b8aa53d5b08a03b56f5163805bd97">ast_config_AST_DB</a></div><div class="ttdeci">const char * ast_config_AST_DB</div><div class="ttdef"><b>Definition:</b> <a href="../../de/dc5/options_8c_source.html#l00165">options.c:165</a></div></div>
<div class="ttc" id="structval_html"><div class="ttname"><a href="../../d5/d85/structval.html">val</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d3/dd1/ast__expr2_8c_source.html#l00325">ast_expr2.c:325</a></div></div>
<div class="ttc" id="paths_8h_html_abd1a940d0d1399a0bf6714fe156443ce"><div class="ttname"><a href="../../dd/df2/paths_8h.html#abd1a940d0d1399a0bf6714fe156443ce">ast_config_AST_SBIN_DIR</a></div><div class="ttdeci">const char * ast_config_AST_SBIN_DIR</div><div class="ttdef"><b>Definition:</b> <a href="../../de/dc5/options_8c_source.html#l00163">options.c:163</a></div></div>
<div class="ttc" id="cli_8h_html_a56b6b59ee2eaa994597a5b0f4e9f9d09"><div class="ttname"><a href="../../dc/db0/cli_8h.html#a56b6b59ee2eaa994597a5b0f4e9f9d09">ast_cli_unregister_multiple</a></div><div class="ttdeci">int ast_cli_unregister_multiple(struct ast_cli_entry *e, int len)</div><div class="ttdoc">Unregister multiple commands. </div><div class="ttdef"><b>Definition:</b> <a href="../../da/d4d/clicompat_8c_source.html#l00030">clicompat.c:30</a></div></div>
<div class="ttc" id="test__db_8c_html_aafd99d3f4de9ecd56b7b03f5fb70e8d2a147e71049e3285d642d0d5268dba260f"><div class="ttname"><a href="../../db/dbb/test__db_8c.html#aafd99d3f4de9ecd56b7b03f5fb70e8d2a147e71049e3285d642d0d5268dba260f">KEY</a></div><div class="ttdef"><b>Definition:</b> <a href="../../db/dbb/test__db_8c_source.html#l00041">test_db.c:41</a></div></div>
<div class="ttc" id="main_2db_8c_html_a03f7dee6cad1dff30caf7133244cd811"><div class="ttname"><a href="../../da/d21/main_2db_8c.html#a03f7dee6cad1dff30caf7133244cd811">manager_dbdel</a></div><div class="ttdeci">static int manager_dbdel(struct mansession *s, const struct message *m)</div><div class="ttdef"><b>Definition:</b> <a href="../../da/d21/main_2db_8c_source.html#l00950">main/db.c:950</a></div></div>
<div class="ttc" id="main_2db_8c_html_a736d314a0dfd064f03dcead874493f16"><div class="ttname"><a href="../../da/d21/main_2db_8c.html#a736d314a0dfd064f03dcead874493f16">ast_db_commit_transaction</a></div><div class="ttdeci">static int ast_db_commit_transaction(void)</div><div class="ttdef"><b>Definition:</b> <a href="../../da/d21/main_2db_8c_source.html#l00317">main/db.c:317</a></div></div>
<div class="ttc" id="dsp_8h_html"><div class="ttname"><a href="../../d3/d08/dsp_8h.html">dsp.h</a></div><div class="ttdoc">Convenient Signal Processing routines. </div></div>
<div class="ttc" id="group__Group__AMI_html_ga58c3e3da5d31739cafaee1df6ddf9342"><div class="ttname"><a href="../../df/d72/group__Group__AMI.html#ga58c3e3da5d31739cafaee1df6ddf9342">astman_send_list_complete_start</a></div><div class="ttdeci">void astman_send_list_complete_start(struct mansession *s, const struct message *m, const char *event_name, int count)</div><div class="ttdoc">Start the list complete event. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d10/manager_8c_source.html#l03237">manager.c:3237</a></div></div>
<div class="ttc" id="structast__cli__entry_html"><div class="ttname"><a href="../../d8/d07/structast__cli__entry.html">ast_cli_entry</a></div><div class="ttdoc">descriptor for a cli entry. </div><div class="ttdef"><b>Definition:</b> <a href="../../dc/db0/cli_8h_source.html#l00171">cli.h:171</a></div></div>
<div class="ttc" id="structast__cli__args_html_a98e1d8441ca58834f11f7367be4b3345"><div class="ttname"><a href="../../d3/dad/structast__cli__args.html#a98e1d8441ca58834f11f7367be4b3345">ast_cli_args::argc</a></div><div class="ttdeci">const int argc</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/db0/cli_8h_source.html#l00160">cli.h:160</a></div></div>
<div class="ttc" id="logger_8h_html_adf4476a6a4ea6c74231c826e899d7189"><div class="ttname"><a href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a></div><div class="ttdeci">#define LOG_WARNING</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d8c/logger_8h_source.html#l00274">logger.h:274</a></div></div>
<div class="ttc" id="main_2db_8c_html_a3387fe63f8d0b59067f32d626dea29be"><div class="ttname"><a href="../../da/d21/main_2db_8c.html#a3387fe63f8d0b59067f32d626dea29be">ast_db_freetree</a></div><div class="ttdeci">void ast_db_freetree(struct ast_db_entry *dbe)</div><div class="ttdoc">Free structure created by ast_db_gettree() </div><div class="ttdef"><b>Definition:</b> <a href="../../da/d21/main_2db_8c_source.html#l00598">main/db.c:598</a></div></div>
<div class="ttc" id="bt__open_8c_html_a1cdd2bb1a9a71d3e1120100229315d67"><div class="ttname"><a href="../../de/d1e/bt__open_8c.html#a1cdd2bb1a9a71d3e1120100229315d67">tmp</a></div><div class="ttdeci">static int tmp()</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d1e/bt__open_8c_source.html#l00389">bt_open.c:389</a></div></div>
<div class="ttc" id="main_2db_8c_html_ae6b28eed96c88f9a9848f9121608699d"><div class="ttname"><a href="../../da/d21/main_2db_8c.html#ae6b28eed96c88f9a9848f9121608699d">db_get_common</a></div><div class="ttdeci">static int db_get_common(const char *family, const char *key, char **buffer, int bufferlen)</div><div class="ttdef"><b>Definition:</b> <a href="../../da/d21/main_2db_8c_source.html#l00373">main/db.c:373</a></div></div>
<div class="ttc" id="cli_8h_html_ab33e5350a923c3a8cedbeb496cd88ec9a71745eb63dd093f560a1add3e430d2a9"><div class="ttname"><a href="../../dc/db0/cli_8h.html#ab33e5350a923c3a8cedbeb496cd88ec9a71745eb63dd093f560a1add3e430d2a9">CLI_INIT</a></div><div class="ttdef"><b>Definition:</b> <a href="../../dc/db0/cli_8h_source.html#l00152">cli.h:152</a></div></div>
<div class="ttc" id="lock_8h_html_a36233c5520173c095bf732a788356aee"><div class="ttname"><a href="../../dd/d42/lock_8h.html#a36233c5520173c095bf732a788356aee">ast_cond_wait</a></div><div class="ttdeci">#define ast_cond_wait(cond, mutex)</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d42/lock_8h_source.html#l00203">lock.h:203</a></div></div>
<div class="ttc" id="lock_8h_html_a69e9591803d36f5683eb9b084442be9b"><div class="ttname"><a href="../../dd/d42/lock_8h.html#a69e9591803d36f5683eb9b084442be9b">ast_cond_init</a></div><div class="ttdeci">#define ast_cond_init(cond, attr)</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d42/lock_8h_source.html#l00199">lock.h:199</a></div></div>
<div class="ttc" id="cli_8h_html_aea8910ed9e301e7f741f87942c244eac"><div class="ttname"><a href="../../dc/db0/cli_8h.html#aea8910ed9e301e7f741f87942c244eac">ast_cli_register_multiple</a></div><div class="ttdeci">#define ast_cli_register_multiple(e, len)</div><div class="ttdoc">Register multiple commands. </div><div class="ttdef"><b>Definition:</b> <a href="../../dc/db0/cli_8h_source.html#l00265">cli.h:265</a></div></div>
<div class="ttc" id="main_2db_8c_html_ade1bc05ba29175fe3f6a5f2b67143ffd"><div class="ttname"><a href="../../da/d21/main_2db_8c.html#ade1bc05ba29175fe3f6a5f2b67143ffd">handle_cli_database_showkey</a></div><div class="ttdeci">static char * handle_cli_database_showkey(struct ast_cli_entry *e, int cmd, struct ast_cli_args *a)</div><div class="ttdef"><b>Definition:</b> <a href="../../da/d21/main_2db_8c_source.html#l00789">main/db.c:789</a></div></div>
<div class="ttc" id="utils_8h_html_a24374da24af1931d8a7ccde5b352bb2c"><div class="ttname"><a href="../../d5/d60/utils_8h.html#a24374da24af1931d8a7ccde5b352bb2c">ast_assert</a></div><div class="ttdeci">#define ast_assert(a)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d60/utils_8h_source.html#l00695">utils.h:695</a></div></div>
<div class="ttc" id="group__Group__AMI_html_ga77315fa8e29950f0c88120501acda0a3"><div class="ttname"><a href="../../df/d72/group__Group__AMI.html#ga77315fa8e29950f0c88120501acda0a3">astman_send_ack</a></div><div class="ttdeci">void astman_send_ack(struct mansession *s, const struct message *m, char *msg)</div><div class="ttdoc">Send ack in manager transaction. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d10/manager_8c_source.html#l03191">manager.c:3191</a></div></div>
<div class="ttc" id="lock_8h_html_ac5e13c7fe64d3b271a52028b0a78b92b"><div class="ttname"><a href="../../dd/d42/lock_8h.html#ac5e13c7fe64d3b271a52028b0a78b92b">ast_mutex_lock</a></div><div class="ttdeci">#define ast_mutex_lock(a)</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d42/lock_8h_source.html#l00187">lock.h:187</a></div></div>
<div class="ttc" id="astmm_8h_html_ab263849d03fb892847be4986db759737"><div class="ttname"><a href="../../d8/d8a/astmm_8h.html#ab263849d03fb892847be4986db759737">ast_strdup</a></div><div class="ttdeci">#define ast_strdup(str)</div><div class="ttdoc">A wrapper for strdup() </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d8a/astmm_8h_source.html#l00243">astmm.h:243</a></div></div>
<div class="ttc" id="file_8h_html"><div class="ttname"><a href="../../d2/d4d/file_8h.html">file.h</a></div><div class="ttdoc">Generic File Format Support. Should be included by clients of the file handling routines. File service providers should instead include mod_format.h. </div></div>
<div class="ttc" id="main_2db_8c_html_ae171d616861e08d90bf27ba78d300581"><div class="ttname"><a href="../../da/d21/main_2db_8c.html#ae171d616861e08d90bf27ba78d300581">init_statements</a></div><div class="ttdeci">static int init_statements(void)</div><div class="ttdef"><b>Definition:</b> <a href="../../da/d21/main_2db_8c_source.html#l00190">main/db.c:190</a></div></div>
<div class="ttc" id="resample_8c_html_a070d2ce7b6bb7e5c05602aa8c308d0c4"><div class="ttname"><a href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a></div><div class="ttdeci">#define NULL</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d7f/resample_8c_source.html#l00096">resample.c:96</a></div></div>
<div class="ttc" id="main_2db_8c_html_afeb9839f89da4fc24838de74739d181e"><div class="ttname"><a href="../../da/d21/main_2db_8c.html#afeb9839f89da4fc24838de74739d181e">ast_db_gettree</a></div><div class="ttdeci">struct ast_db_entry * ast_db_gettree(const char *family, const char *keytree)</div><div class="ttdoc">Get a list of values within the astdb tree. </div><div class="ttdef"><b>Definition:</b> <a href="../../da/d21/main_2db_8c_source.html#l00531">main/db.c:531</a></div></div>
<div class="ttc" id="manager_8h_html_a1d34461b8a3210b19e66f06bcdebfeb3"><div class="ttname"><a href="../../db/d45/manager_8h.html#a1d34461b8a3210b19e66f06bcdebfeb3">ast_manager_register_xml_core</a></div><div class="ttdeci">#define ast_manager_register_xml_core(action, authority, func)</div><div class="ttdoc">Register a manager callback using XML documentation to describe the manager. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/d45/manager_8h_source.html#l00197">manager.h:197</a></div></div>
<div class="ttc" id="syslog_8c_html_ac4f474c82e82cbb89ca7c36dd52be0ed"><div class="ttname"><a href="../../d4/d2f/syslog_8c.html#ac4f474c82e82cbb89ca7c36dd52be0ed">value</a></div><div class="ttdeci">int value</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d2f/syslog_8c_source.html#l00037">syslog.c:37</a></div></div>
<div class="ttc" id="cli_8h_html_a791bf9f5637185bee5e8f0907c762130"><div class="ttname"><a href="../../dc/db0/cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a></div><div class="ttdeci">void ast_cli(int fd, const char *fmt,...)</div><div class="ttdef"><b>Definition:</b> <a href="../../da/d4d/clicompat_8c_source.html#l00006">clicompat.c:6</a></div></div>
<div class="ttc" id="main_2db_8c_html_a52d9808db8eba7a1ff32fc6686042f04"><div class="ttname"><a href="../../da/d21/main_2db_8c.html#a52d9808db8eba7a1ff32fc6686042f04">astdb_init</a></div><div class="ttdeci">int astdb_init(void)</div><div class="ttdef"><b>Definition:</b> <a href="../../da/d21/main_2db_8c_source.html#l01082">main/db.c:1082</a></div></div>
<div class="ttc" id="main_2db_8c_html_a71e8d5ab1757b184683a99125d1c8160"><div class="ttname"><a href="../../da/d21/main_2db_8c.html#a71e8d5ab1757b184683a99125d1c8160">ast_db_del</a></div><div class="ttdeci">int ast_db_del(const char *family, const char *key)</div><div class="ttdoc">Delete entry in astdb. </div><div class="ttdef"><b>Definition:</b> <a href="../../da/d21/main_2db_8c_source.html#l00429">main/db.c:429</a></div></div>
<div class="ttc" id="lock_8h_html_ae2cdf274a5da241c3ad7324d82bf6af0"><div class="ttname"><a href="../../dd/d42/lock_8h.html#ae2cdf274a5da241c3ad7324d82bf6af0">ast_cond_signal</a></div><div class="ttdeci">#define ast_cond_signal(cond)</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d42/lock_8h_source.html#l00201">lock.h:201</a></div></div>
<div class="ttc" id="main_2db_8c_html_a885611b04f0f81cde233f5648aa58b7c"><div class="ttname"><a href="../../da/d21/main_2db_8c.html#a885611b04f0f81cde233f5648aa58b7c">dblock</a></div><div class="ttdeci">static ast_mutex_t dblock</div><div class="ttdef"><b>Definition:</b> <a href="../../da/d21/main_2db_8c_source.html#l00108">main/db.c:108</a></div></div>
<div class="ttc" id="utils_8h_html"><div class="ttname"><a href="../../d5/d60/utils_8h.html">utils.h</a></div><div class="ttdoc">Utility functions. </div></div>
<div class="ttc" id="astmm_8h_html_ada667b6f84a08e6848cb37c5ffb94a5f"><div class="ttname"><a href="../../d8/d8a/astmm_8h.html#ada667b6f84a08e6848cb37c5ffb94a5f">ast_asprintf</a></div><div class="ttdeci">#define ast_asprintf(ret, fmt,...)</div><div class="ttdoc">A wrapper for asprintf() </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d8a/astmm_8h_source.html#l00269">astmm.h:269</a></div></div>
<div class="ttc" id="group__Group__AMI_html_gac6a9f3498f9afffecfd78c485af41556"><div class="ttname"><a href="../../df/d72/group__Group__AMI.html#gac6a9f3498f9afffecfd78c485af41556">astman_get_header</a></div><div class="ttdeci">const char * astman_get_header(const struct message *m, char *var)</div><div class="ttdoc">Get header from mananger transaction. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d10/manager_8c_source.html#l02820">manager.c:2820</a></div></div>
<div class="ttc" id="main_2db_8c_html_a6ab91701fa0db9fad7759fe42a581c17"><div class="ttname"><a href="../../da/d21/main_2db_8c.html#a6ab91701fa0db9fad7759fe42a581c17">ast_db_get</a></div><div class="ttdeci">int ast_db_get(const char *family, const char *key, char *value, int valuelen)</div><div class="ttdoc">Get key value specified by family/key. </div><div class="ttdef"><b>Definition:</b> <a href="../../da/d21/main_2db_8c_source.html#l00412">main/db.c:412</a></div></div>
<div class="ttc" id="lock_8h_html_ab134d98cdfe7de0f7a72b377c0765dc7"><div class="ttname"><a href="../../dd/d42/lock_8h.html#ab134d98cdfe7de0f7a72b377c0765dc7">ast_cond_t</a></div><div class="ttdeci">pthread_cond_t ast_cond_t</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d42/lock_8h_source.html#l00176">lock.h:176</a></div></div>
<div class="ttc" id="strings_8h_html_a372554b7a2d69a8bd3adac5157672036"><div class="ttname"><a href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a></div><div class="ttdeci">#define ast_strlen_zero(foo)</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d90/strings_8h_source.html#l00052">strings.h:52</a></div></div>
<div class="ttc" id="utils_8h_html_a595e2f8aa398f4bd21e381c3211235fe"><div class="ttname"><a href="../../d5/d60/utils_8h.html#a595e2f8aa398f4bd21e381c3211235fe">ast_pthread_create_background</a></div><div class="ttdeci">#define ast_pthread_create_background(a, b, c, d)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d60/utils_8h_source.html#l00567">utils.h:567</a></div></div>
<div class="ttc" id="main_2db_8c_html_ac332fd073c41ceb9b1826af8791b241b"><div class="ttname"><a href="../../da/d21/main_2db_8c.html#ac332fd073c41ceb9b1826af8791b241b">syncthread</a></div><div class="ttdeci">static pthread_t syncthread</div><div class="ttdef"><b>Definition:</b> <a href="../../da/d21/main_2db_8c_source.html#l00111">main/db.c:111</a></div></div>
<div class="ttc" id="manager_8h_html_a420f0f755e1c3378b45ca7f6f0669ffa"><div class="ttname"><a href="../../db/d45/manager_8h.html#a420f0f755e1c3378b45ca7f6f0669ffa">EVENT_FLAG_SYSTEM</a></div><div class="ttdeci">#define EVENT_FLAG_SYSTEM</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d45/manager_8h_source.html#l00071">manager.h:71</a></div></div>
<div class="ttc" id="logger_8h_html_a3f248112c8d6ce7e3959aa723dade648"><div class="ttname"><a href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a></div><div class="ttdeci">#define ast_debug(level,...)</div><div class="ttdoc">Log a DEBUG message. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d8c/logger_8h_source.html#l00452">logger.h:452</a></div></div>
<div class="ttc" id="astobj2_8c_html_a96a00b3a518d7f32b6d51dc28f09bf9b"><div class="ttname"><a href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a></div><div class="ttdeci">#define ast_log</div><div class="ttdef"><b>Definition:</b> <a href="../../da/df7/astobj2_8c_source.html#l00042">astobj2.c:42</a></div></div>
<div class="ttc" id="structast__db__entry_html_a3fee4a0a4bff112e0262fb8d49f41b5e"><div class="ttname"><a href="../../da/d1d/structast__db__entry.html#a3fee4a0a4bff112e0262fb8d49f41b5e">ast_db_entry::next</a></div><div class="ttdeci">struct ast_db_entry * next</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d4a/astdb_8h_source.html#l00032">astdb.h:32</a></div></div>
<div class="ttc" id="main_2db_8c_html_aed10f708f89ad5111a2f1ca77013305e"><div class="ttname"><a href="../../da/d21/main_2db_8c.html#aed10f708f89ad5111a2f1ca77013305e">handle_cli_database_show</a></div><div class="ttdeci">static char * handle_cli_database_show(struct ast_cli_entry *e, int cmd, struct ast_cli_args *a)</div><div class="ttdef"><b>Definition:</b> <a href="../../da/d21/main_2db_8c_source.html#l00725">main/db.c:725</a></div></div>
<div class="ttc" id="channel_8h_html"><div class="ttname"><a href="../../d5/d7b/channel_8h.html">channel.h</a></div><div class="ttdoc">General Asterisk PBX channel definitions. </div></div>
<div class="ttc" id="paths_8h_html"><div class="ttname"><a href="../../dd/df2/paths_8h.html">paths.h</a></div><div class="ttdoc">Asterisk file paths, configured in asterisk.conf. </div></div>
<div class="ttc" id="structcolumns_html"><div class="ttname"><a href="../../d7/dec/structcolumns.html">columns</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d29/cdr__mysql_8c_source.html#l00107">cdr_mysql.c:107</a></div></div>
<div class="ttc" id="group__Group__AMI_html_gabf7c909efbfc26d0d9c66786c83b8f69"><div class="ttname"><a href="../../df/d72/group__Group__AMI.html#gabf7c909efbfc26d0d9c66786c83b8f69">astman_send_list_complete_end</a></div><div class="ttdeci">void astman_send_list_complete_end(struct mansession *s)</div><div class="ttdoc">End the list complete event. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d10/manager_8c_source.html#l03245">manager.c:3245</a></div></div>
<div class="ttc" id="structast__cli__args_html_acf64f219885421479997667d2ed3f08a"><div class="ttname"><a href="../../d3/dad/structast__cli__args.html#acf64f219885421479997667d2ed3f08a">ast_cli_args::fd</a></div><div class="ttdeci">const int fd</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/db0/cli_8h_source.html#l00159">cli.h:159</a></div></div>
<div class="ttc" id="app__meetme_8c_html_ae9dd6bdb4c5c0529195a03583d0d4a8d"><div class="ttname"><a href="../../df/d44/app__meetme_8c.html#ae9dd6bdb4c5c0529195a03583d0d4a8d">last</a></div><div class="ttdeci">struct sla_ringing_trunk * last</div><div class="ttdef"><b>Definition:</b> <a href="../../df/d44/app__meetme_8c_source.html#l01092">app_meetme.c:1092</a></div></div>
<div class="ttc" id="main_2db_8c_html_a69be3660772d66c70e5f1d8ab2c27cef"><div class="ttname"><a href="../../da/d21/main_2db_8c.html#a69be3660772d66c70e5f1d8ab2c27cef">handle_cli_database_query</a></div><div class="ttdeci">static char * handle_cli_database_query(struct ast_cli_entry *e, int cmd, struct ast_cli_args *a)</div><div class="ttdef"><b>Definition:</b> <a href="../../da/d21/main_2db_8c_source.html#l00847">main/db.c:847</a></div></div>
<div class="ttc" id="structmansession_html"><div class="ttname"><a href="../../d2/d8a/structmansession.html">mansession</a></div><div class="ttdoc">In case you didn&amp;#39;t read that giant block of text above the mansession_session struct, the struct mansession is named this solely to keep the API the same in Asterisk. This structure really represents data that is different from Manager action to Manager action. The mansession_session pointer contained within points to session-specific data. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d10/manager_8c_source.html#l01625">manager.c:1625</a></div></div>
<div class="ttc" id="asterisk_8h_html_a9b09e95876dfecb9a8573819da0b255e"><div class="ttname"><a href="../../db/db2/asterisk_8h.html#a9b09e95876dfecb9a8573819da0b255e">ast_register_atexit</a></div><div class="ttdeci">int ast_register_atexit(void(*func)(void))</div><div class="ttdoc">Register a function to be executed before Asterisk exits. </div><div class="ttdef"><b>Definition:</b> <a href="../../da/d4d/clicompat_8c_source.html#l00013">clicompat.c:13</a></div></div>
<div class="ttc" id="main_2db_8c_html_a332d50e70dcfd68a970533f20cdba278"><div class="ttname"><a href="../../da/d21/main_2db_8c.html#a332d50e70dcfd68a970533f20cdba278">db_gettree_common</a></div><div class="ttdeci">static struct ast_db_entry * db_gettree_common(sqlite3_stmt *stmt)</div><div class="ttdef"><b>Definition:</b> <a href="../../da/d21/main_2db_8c_source.html#l00492">main/db.c:492</a></div></div>
<div class="ttc" id="main_2db_8c_html_afe1f0caaa1c711f16bb23bfcc54ff386"><div class="ttname"><a href="../../da/d21/main_2db_8c.html#afe1f0caaa1c711f16bb23bfcc54ff386">MAX_DB_FIELD</a></div><div class="ttdeci">#define MAX_DB_FIELD</div><div class="ttdef"><b>Definition:</b> <a href="../../da/d21/main_2db_8c_source.html#l00107">main/db.c:107</a></div></div>
<div class="ttc" id="astmm_8h_html_ae63d4f486bcf6eac7c1593f867717d91"><div class="ttname"><a href="../../d8/d8a/astmm_8h.html#ae63d4f486bcf6eac7c1593f867717d91">ast_malloc</a></div><div class="ttdeci">#define ast_malloc(len)</div><div class="ttdoc">A wrapper for malloc() </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d8a/astmm_8h_source.html#l00193">astmm.h:193</a></div></div>
<div class="ttc" id="main_2db_8c_html_a4b1471f09e67989f00b31639c428fb24"><div class="ttname"><a href="../../da/d21/main_2db_8c.html#a4b1471f09e67989f00b31639c428fb24">db_init</a></div><div class="ttdeci">static int db_init(void)</div><div class="ttdef"><b>Definition:</b> <a href="../../da/d21/main_2db_8c_source.html#l00282">main/db.c:282</a></div></div>
<div class="ttc" id="app__voicemail_8c_html_a6f612696ee3ef9e74363b000efc92122"><div class="ttname"><a href="../../dc/df4/app__voicemail_8c.html#a6f612696ee3ef9e74363b000efc92122">DELETE</a></div><div class="ttdeci">#define DELETE(a, b, c, d)</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/df4/app__voicemail_8c_source.html#l00873">app_voicemail.c:873</a></div></div>
<div class="ttc" id="main_2db_8c_html_aa6604f5f92051f2351cd9a350d5f6284"><div class="ttname"><a href="../../da/d21/main_2db_8c.html#aa6604f5f92051f2351cd9a350d5f6284">dbcond</a></div><div class="ttdeci">static ast_cond_t dbcond</div><div class="ttdef"><b>Definition:</b> <a href="../../da/d21/main_2db_8c_source.html#l00109">main/db.c:109</a></div></div>
<div class="ttc" id="main_2db_8c_html_a05c446a72a078b710425b61d0d999e07"><div class="ttname"><a href="../../da/d21/main_2db_8c.html#a05c446a72a078b710425b61d0d999e07">handle_cli_database_put</a></div><div class="ttdeci">static char * handle_cli_database_put(struct ast_cli_entry *e, int cmd, struct ast_cli_args *a)</div><div class="ttdef"><b>Definition:</b> <a href="../../da/d21/main_2db_8c_source.html#l00608">main/db.c:608</a></div></div>
<div class="ttc" id="astmm_8h_html_a249282ecc7ba5a1a49fa75e9a33d1717"><div class="ttname"><a href="../../d8/d8a/astmm_8h.html#a249282ecc7ba5a1a49fa75e9a33d1717">ast_alloca</a></div><div class="ttdeci">#define ast_alloca(size)</div><div class="ttdoc">call __builtin_alloca to ensure we get gcc builtin semantics </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d8a/astmm_8h_source.html#l00290">astmm.h:290</a></div></div>
<div class="ttc" id="structast__cli__args_html_ad0a19c4d63698f9e9cfd5653e8851452"><div class="ttname"><a href="../../d3/dad/structast__cli__args.html#ad0a19c4d63698f9e9cfd5653e8851452">ast_cli_args::argv</a></div><div class="ttdeci">const char *const  * argv</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/db0/cli_8h_source.html#l00161">cli.h:161</a></div></div>
<div class="ttc" id="group__Group__AMI_html_gafadf012f66a9fd7ecf985ec5b9dee101"><div class="ttname"><a href="../../df/d72/group__Group__AMI.html#gafadf012f66a9fd7ecf985ec5b9dee101">ast_manager_unregister</a></div><div class="ttdeci">int ast_manager_unregister(const char *action)</div><div class="ttdoc">Unregister a registered manager command. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d10/manager_8c_source.html#l07258">manager.c:7258</a></div></div>
<div class="ttc" id="manager_8h_html"><div class="ttname"><a href="../../db/d45/manager_8h.html">manager.h</a></div><div class="ttdoc">The AMI - Asterisk Manager Interface - is a TCP protocol created to manage Asterisk with third-party ...</div></div>
<div class="ttc" id="main_2db_8c_html_a65028e1ec1751f2c880ac29d2086ec49"><div class="ttname"><a href="../../da/d21/main_2db_8c.html#a65028e1ec1751f2c880ac29d2086ec49">display_results</a></div><div class="ttdeci">static int display_results(void *arg, int columns, char **values, char **colnames)</div><div class="ttdef"><b>Definition:</b> <a href="../../da/d21/main_2db_8c_source.html#l00834">main/db.c:834</a></div></div>
<div class="ttc" id="logger_8h_html_aced66975c154ea0e2a8ec3bc818b4e08"><div class="ttname"><a href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a></div><div class="ttdeci">#define LOG_ERROR</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d8c/logger_8h_source.html#l00285">logger.h:285</a></div></div>
<div class="ttc" id="include_2asterisk_2app_8h_html_a9fb5cf0385848033ee3e98625e5f9784"><div class="ttname"><a href="../../d3/d93/include_2asterisk_2app_8h.html#a9fb5cf0385848033ee3e98625e5f9784">ast_safe_system</a></div><div class="ttdeci">int ast_safe_system(const char *s)</div><div class="ttdoc">Safely spawn an OS shell command while closing file descriptors. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/dc5/extconf_8c_source.html#l00829">extconf.c:829</a></div></div>
<div class="ttc" id="cli_8h_html_a0873456096960dab21fff0ce68c95acb"><div class="ttname"><a href="../../dc/db0/cli_8h.html#a0873456096960dab21fff0ce68c95acb">CLI_SHOWUSAGE</a></div><div class="ttdeci">#define CLI_SHOWUSAGE</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/db0/cli_8h_source.html#l00045">cli.h:45</a></div></div>
<div class="ttc" id="main_2db_8c_html_a113d1cff6b7f6ff34c7adf7d6ee6dfc8"><div class="ttname"><a href="../../da/d21/main_2db_8c.html#a113d1cff6b7f6ff34c7adf7d6ee6dfc8">clean_statements</a></div><div class="ttdeci">static void clean_statements(void)</div><div class="ttdef"><b>Definition:</b> <a href="../../da/d21/main_2db_8c_source.html#l00176">main/db.c:176</a></div></div>
<div class="ttc" id="main_2db_8c_html_ac22ef757982d3cd0728dac39f0bbe834"><div class="ttname"><a href="../../da/d21/main_2db_8c.html#ac22ef757982d3cd0728dac39f0bbe834">db_sync_thread</a></div><div class="ttdeci">static void * db_sync_thread(void *data)</div><div class="ttdef"><b>Definition:</b> <a href="../../da/d21/main_2db_8c_source.html#l01025">main/db.c:1025</a></div></div>
<div class="ttc" id="main_2db_8c_html_abdf814ae947ec73f933c8f8839916d68"><div class="ttname"><a href="../../da/d21/main_2db_8c.html#abdf814ae947ec73f933c8f8839916d68">dosync</a></div><div class="ttdeci">static int dosync</div><div class="ttdef"><b>Definition:</b> <a href="../../da/d21/main_2db_8c_source.html#l00113">main/db.c:113</a></div></div>
<div class="ttc" id="func__strings_8c_html_af24e73aaf92f3000fda15d285e66df24"><div class="ttname"><a href="../../d9/d1e/func__strings_8c.html#af24e73aaf92f3000fda15d285e66df24">len</a></div><div class="ttdeci">static int len(struct ast_channel *chan, const char *cmd, char *data, char *buf, size_t buflen)</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d1e/func__strings_8c_source.html#l01344">func_strings.c:1344</a></div></div>
<div class="ttc" id="main_2db_8c_html_aadc9b80ccfd78701b69d004a09f55b08"><div class="ttname"><a href="../../da/d21/main_2db_8c.html#aadc9b80ccfd78701b69d004a09f55b08">ast_db_gettree_by_prefix</a></div><div class="ttdeci">struct ast_db_entry * ast_db_gettree_by_prefix(const char *family, const char *key_prefix)</div><div class="ttdoc">Get a list of values with the given key prefix. </div><div class="ttdef"><b>Definition:</b> <a href="../../da/d21/main_2db_8c_source.html#l00571">main/db.c:571</a></div></div>
<div class="ttc" id="logger_8h_html_ad89ee324d180cdcd7defcc709ff9ca42"><div class="ttname"><a href="../../d1/d8c/logger_8h.html#ad89ee324d180cdcd7defcc709ff9ca42">LOG_NOTICE</a></div><div class="ttdeci">#define LOG_NOTICE</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d8c/logger_8h_source.html#l00263">logger.h:263</a></div></div>
<div class="ttc" id="structast__db__entry_html"><div class="ttname"><a href="../../da/d1d/structast__db__entry.html">ast_db_entry</a></div><div class="ttdef"><b>Definition:</b> <a href="../../de/d4a/astdb_8h_source.html#l00031">astdb.h:31</a></div></div>
<div class="ttc" id="cdr__mysql_8c_html_a9607ce10e06d5a012bffa2ab3ac23742"><div class="ttname"><a href="../../d0/d29/cdr__mysql_8c.html#a9607ce10e06d5a012bffa2ab3ac23742">columns</a></div><div class="ttdeci">static struct columns columns</div></div>
<div class="ttc" id="main_2db_8c_html_a59f6376a471012a10b27b3e902256be0"><div class="ttname"><a href="../../da/d21/main_2db_8c.html#a59f6376a471012a10b27b3e902256be0">astdb</a></div><div class="ttdeci">static sqlite3 * astdb</div><div class="ttdef"><b>Definition:</b> <a href="../../da/d21/main_2db_8c_source.html#l00110">main/db.c:110</a></div></div>
<div class="ttc" id="astdb2sqlite3_8c_html_afc11762d7334c2e8f24d0df9c5560cec"><div class="ttname"><a href="../../de/d8b/astdb2sqlite3_8c.html#afc11762d7334c2e8f24d0df9c5560cec">init_stmt</a></div><div class="ttdeci">static int init_stmt(sqlite3_stmt **stmt, const char *sql, size_t len)</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d8b/astdb2sqlite3_8c_source.html#l00137">astdb2sqlite3.c:137</a></div></div>
<div class="ttc" id="cdr__mysql_8c_html_a1ca8a7e4d80187db326fa34a9c6ca0c1"><div class="ttname"><a href="../../d0/d29/cdr__mysql_8c.html#a1ca8a7e4d80187db326fa34a9c6ca0c1">dbname</a></div><div class="ttdeci">static struct ast_str * dbname</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d29/cdr__mysql_8c_source.html#l00077">cdr_mysql.c:77</a></div></div>
<div class="ttc" id="main_2db_8c_html_a9fe361bde1b07f7f0331bbd3fe482d88"><div class="ttname"><a href="../../da/d21/main_2db_8c.html#a9fe361bde1b07f7f0331bbd3fe482d88">DEFINE_SQL_STATEMENT</a></div><div class="ttdeci">#define DEFINE_SQL_STATEMENT(stmt, sql)</div><div class="ttdef"><b>Definition:</b> <a href="../../da/d21/main_2db_8c_source.html#l00117">main/db.c:117</a></div></div>
<div class="ttc" id="astmm_8h_html_a402072d6789f6ed9e3a81da27504127e"><div class="ttname"><a href="../../d8/d8a/astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a></div><div class="ttdeci">#define ast_free(a)</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d8a/astmm_8h_source.html#l00182">astmm.h:182</a></div></div>
<div class="ttc" id="structast__cli__entry_html_ade9cba72805fe52685a1deea307a8e82"><div class="ttname"><a href="../../d8/d07/structast__cli__entry.html#ade9cba72805fe52685a1deea307a8e82">ast_cli_entry::command</a></div><div class="ttdeci">char * command</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/db0/cli_8h_source.html#l00186">cli.h:186</a></div></div>
<div class="ttc" id="main_2db_8c_html_a642962023fc731aa4c7d8e459865d986"><div class="ttname"><a href="../../da/d21/main_2db_8c.html#a642962023fc731aa4c7d8e459865d986">db_execute_sql</a></div><div class="ttdeci">static int db_execute_sql(const char *sql, int(*callback)(void *, int, char **, char **), void *arg)</div><div class="ttdef"><b>Definition:</b> <a href="../../da/d21/main_2db_8c_source.html#l00298">main/db.c:298</a></div></div>
<div class="ttc" id="structvalues_html"><div class="ttname"><a href="../../d2/d2b/structvalues.html">values</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d5/dd1/cdr__sqlite3__custom_8c_source.html#l00066">cdr_sqlite3_custom.c:66</a></div></div>
<div class="ttc" id="__private_8h_html"><div class="ttname"><a href="../../d4/d78/__private_8h.html">_private.h</a></div><div class="ttdoc">Prototypes for public functions only of internal interest,. </div></div>
<div class="ttc" id="main_2db_8c_html_a0e55a773a7175671526f96f16cc0fabd"><div class="ttname"><a href="../../da/d21/main_2db_8c.html#a0e55a773a7175671526f96f16cc0fabd">doexit</a></div><div class="ttdeci">static int doexit</div><div class="ttdef"><b>Definition:</b> <a href="../../da/d21/main_2db_8c_source.html#l00112">main/db.c:112</a></div></div>
<div class="ttc" id="main_2db_8c_html_afb5ce976f5d19ec85c79189213596d96"><div class="ttname"><a href="../../da/d21/main_2db_8c.html#afb5ce976f5d19ec85c79189213596d96">handle_cli_database_get</a></div><div class="ttdeci">static char * handle_cli_database_get(struct ast_cli_entry *e, int cmd, struct ast_cli_args *a)</div><div class="ttdef"><b>Definition:</b> <a href="../../da/d21/main_2db_8c_source.html#l00635">main/db.c:635</a></div></div>
<div class="ttc" id="main_2db_8c_html_a415a23bb61c561440bc3ae9d263461ad"><div class="ttname"><a href="../../da/d21/main_2db_8c.html#a415a23bb61c561440bc3ae9d263461ad">manager_dbget</a></div><div class="ttdeci">static int manager_dbget(struct mansession *s, const struct message *m)</div><div class="ttdef"><b>Definition:</b> <a href="../../da/d21/main_2db_8c_source.html#l00908">main/db.c:908</a></div></div>
<div class="ttc" id="main_2db_8c_html_af06db2a8f64fb9fcd382b24a0cffd608"><div class="ttname"><a href="../../da/d21/main_2db_8c.html#af06db2a8f64fb9fcd382b24a0cffd608">ast_db_rollback_transaction</a></div><div class="ttdeci">static int ast_db_rollback_transaction(void)</div><div class="ttdef"><b>Definition:</b> <a href="../../da/d21/main_2db_8c_source.html#l00322">main/db.c:322</a></div></div>
<div class="ttc" id="structast__cli__entry_html_aef1bd6ad890a110b466cb0e8088507a2"><div class="ttname"><a href="../../d8/d07/structast__cli__entry.html#aef1bd6ad890a110b466cb0e8088507a2">ast_cli_entry::usage</a></div><div class="ttdeci">const char * usage</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/db0/cli_8h_source.html#l00177">cli.h:177</a></div></div>
<div class="ttc" id="main_2db_8c_html_a5b3a44a41cbaf00d3c93de1a253aa642"><div class="ttname"><a href="../../da/d21/main_2db_8c.html#a5b3a44a41cbaf00d3c93de1a253aa642">convert_bdb_to_sqlite3</a></div><div class="ttdeci">static int convert_bdb_to_sqlite3(void)</div><div class="ttdef"><b>Definition:</b> <a href="../../da/d21/main_2db_8c_source.html#l00205">main/db.c:205</a></div></div>
<div class="ttc" id="main_2db_8c_html_a63408b76b1f9eed31bcd1211d2081f03"><div class="ttname"><a href="../../da/d21/main_2db_8c.html#a63408b76b1f9eed31bcd1211d2081f03">manager_dbput</a></div><div class="ttdeci">static int manager_dbput(struct mansession *s, const struct message *m)</div><div class="ttdef"><b>Definition:</b> <a href="../../da/d21/main_2db_8c_source.html#l00883">main/db.c:883</a></div></div>
<div class="ttc" id="main_2db_8c_html_ac0dc7f1713e81aee579767f2269b6ce1"><div class="ttname"><a href="../../da/d21/main_2db_8c.html#ac0dc7f1713e81aee579767f2269b6ce1">handle_cli_database_deltree</a></div><div class="ttdeci">static char * handle_cli_database_deltree(struct ast_cli_entry *e, int cmd, struct ast_cli_args *a)</div><div class="ttdef"><b>Definition:</b> <a href="../../da/d21/main_2db_8c_source.html#l00690">main/db.c:690</a></div></div>
<div class="ttc" id="manager_8h_html_a0b1b4140c2836696a6950e92ab48a580"><div class="ttname"><a href="../../db/d45/manager_8h.html#a0b1b4140c2836696a6950e92ab48a580">EVENT_FLAG_REPORTING</a></div><div class="ttdeci">#define EVENT_FLAG_REPORTING</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d45/manager_8h_source.html#l00080">manager.h:80</a></div></div>
<div class="ttc" id="cli_8h_html_a50989f00b32eeb2516a3803cb2ffb766"><div class="ttname"><a href="../../dc/db0/cli_8h.html#a50989f00b32eeb2516a3803cb2ffb766">CLI_SUCCESS</a></div><div class="ttdeci">#define CLI_SUCCESS</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/db0/cli_8h_source.html#l00044">cli.h:44</a></div></div>
<div class="ttc" id="main_2db_8c_html_a274fd536a82bf71830421f6b0ff63702"><div class="ttname"><a href="../../da/d21/main_2db_8c.html#a274fd536a82bf71830421f6b0ff63702">manager_dbdeltree</a></div><div class="ttdeci">static int manager_dbdeltree(struct mansession *s, const struct message *m)</div><div class="ttdef"><b>Definition:</b> <a href="../../da/d21/main_2db_8c_source.html#l00975">main/db.c:975</a></div></div>
<div class="ttc" id="cli_8h_html_ab33e5350a923c3a8cedbeb496cd88ec9a76bf33139279b03ec1691f2be2d1be40"><div class="ttname"><a href="../../dc/db0/cli_8h.html#ab33e5350a923c3a8cedbeb496cd88ec9a76bf33139279b03ec1691f2be2d1be40">CLI_GENERATE</a></div><div class="ttdef"><b>Definition:</b> <a href="../../dc/db0/cli_8h_source.html#l00153">cli.h:153</a></div></div>
<div class="ttc" id="main_2db_8c_html_a6e6da68c88e22a65dbe728653ceef20f"><div class="ttname"><a href="../../da/d21/main_2db_8c.html#a6e6da68c88e22a65dbe728653ceef20f">db_create_astdb</a></div><div class="ttdeci">static int db_create_astdb(void)</div><div class="ttdef"><b>Definition:</b> <a href="../../da/d21/main_2db_8c_source.html#l00219">main/db.c:219</a></div></div>
<div class="ttc" id="main_2db_8c_html_ab2ffb685a189bc273c1de00753c31091"><div class="ttname"><a href="../../da/d21/main_2db_8c.html#ab2ffb685a189bc273c1de00753c31091">handle_cli_database_del</a></div><div class="ttdeci">static char * handle_cli_database_del(struct ast_cli_entry *e, int cmd, struct ast_cli_args *a)</div><div class="ttdef"><b>Definition:</b> <a href="../../da/d21/main_2db_8c_source.html#l00663">main/db.c:663</a></div></div>
<div class="ttc" id="utils_2frame_8c_html_a48bc11919b2752df9d14ce89557cfb25"><div class="ttname"><a href="../../d6/d47/utils_2frame_8c.html#a48bc11919b2752df9d14ce89557cfb25">out</a></div><div class="ttdeci">FILE * out</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d47/utils_2frame_8c_source.html#l00033">utils/frame.c:33</a></div></div>
<div class="ttc" id="cli_8h_html"><div class="ttname"><a href="../../dc/db0/cli_8h.html">cli.h</a></div><div class="ttdoc">Standard Command Line Interface. </div></div>
<div class="ttc" id="strings_8h_html_ac4040268f7b6ed77dfc49c7767626369"><div class="ttname"><a href="../../d6/d90/strings_8h.html#ac4040268f7b6ed77dfc49c7767626369">ast_copy_string</a></div><div class="ttdeci">void ast_copy_string(char *dst, const char *src, size_t size)</div><div class="ttdoc">Size-limited null-terminating string copy. </div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d90/strings_8h_source.html#l00401">strings.h:401</a></div></div>
<div class="ttc" id="strings_8h_html_a2faaa16929951bfd2802b7829a100ba2"><div class="ttname"><a href="../../d6/d90/strings_8h.html#a2faaa16929951bfd2802b7829a100ba2">S_OR</a></div><div class="ttdeci">#define S_OR(a, b)</div><div class="ttdoc">returns the equivalent of logic or for strings: first one if not empty, otherwise second one...</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d90/strings_8h_source.html#l00079">strings.h:79</a></div></div>
<div class="ttc" id="app__voicemail_8c_html_a0aef50eb58931d34f6a6d4ad18182d7c"><div class="ttname"><a href="../../dc/df4/app__voicemail_8c.html#a0aef50eb58931d34f6a6d4ad18182d7c">EXISTS</a></div><div class="ttdeci">#define EXISTS(a, b, c, d)</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/df4/app__voicemail_8c_source.html#l00870">app_voicemail.c:870</a></div></div>
<div class="ttc" id="cel__pgsql_8c_html_ad6c487210772a9b4b0ca04b04b847d4c"><div class="ttname"><a href="../../de/d1b/cel__pgsql_8c.html#ad6c487210772a9b4b0ca04b04b847d4c">result</a></div><div class="ttdeci">static PGresult * result</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d1b/cel__pgsql_8c_source.html#l00088">cel_pgsql.c:88</a></div></div>
<div class="ttc" id="structast__cli__args_html"><div class="ttname"><a href="../../d3/dad/structast__cli__args.html">ast_cli_args</a></div><div class="ttdef"><b>Definition:</b> <a href="../../dc/db0/cli_8h_source.html#l00158">cli.h:158</a></div></div>
<div class="ttc" id="main_2db_8c_html_a60488b5c3b6fd447d39d58e52172657e"><div class="ttname"><a href="../../da/d21/main_2db_8c.html#a60488b5c3b6fd447d39d58e52172657e">ast_db_get_allocated</a></div><div class="ttdeci">int ast_db_get_allocated(const char *family, const char *key, char **out)</div><div class="ttdoc">Get key value specified by family/key as a heap allocated string. </div><div class="ttdef"><b>Definition:</b> <a href="../../da/d21/main_2db_8c_source.html#l00422">main/db.c:422</a></div></div>
<div class="ttc" id="main_2db_8c_html_a0f14f6bff4f412c88b50aba34d3a5e35"><div class="ttname"><a href="../../da/d21/main_2db_8c.html#a0f14f6bff4f412c88b50aba34d3a5e35">ast_db_put</a></div><div class="ttdeci">int ast_db_put(const char *family, const char *key, const char *value)</div><div class="ttdoc">Store value addressed by family/key. </div><div class="ttdef"><b>Definition:</b> <a href="../../da/d21/main_2db_8c_source.html#l00327">main/db.c:327</a></div></div>
<div class="ttc" id="group__Group__AMI_html_ga31a02a7d3cc36aa66ebebdedfc574d1c"><div class="ttname"><a href="../../df/d72/group__Group__AMI.html#ga31a02a7d3cc36aa66ebebdedfc574d1c">astman_send_error</a></div><div class="ttdeci">void astman_send_error(struct mansession *s, const struct message *m, char *error)</div><div class="ttdoc">Send error in manager transaction. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d10/manager_8c_source.html#l03159">manager.c:3159</a></div></div>
<div class="ttc" id="main_2db_8c_html_a6c334012bbd6b166af5841f29f9ae58c"><div class="ttname"><a href="../../da/d21/main_2db_8c.html#a6c334012bbd6b166af5841f29f9ae58c">ast_db_begin_transaction</a></div><div class="ttdeci">static int ast_db_begin_transaction(void)</div><div class="ttdef"><b>Definition:</b> <a href="../../da/d21/main_2db_8c_source.html#l00312">main/db.c:312</a></div></div>
<div class="ttc" id="astdb_8h_html"><div class="ttname"><a href="../../de/d4a/astdb_8h.html">astdb.h</a></div><div class="ttdoc">Persistant data storage (akin to *doze registry) </div></div>
<div class="ttc" id="include_2asterisk_2app_8h_html"><div class="ttname"><a href="../../d3/d93/include_2asterisk_2app_8h.html">app.h</a></div><div class="ttdoc">Application convenience functions, designed to give consistent look and feel to Asterisk apps...</div></div>
<div class="ttc" id="main_2db_8c_html_af251d986cfe884ffd5ca864531253f62"><div class="ttname"><a href="../../da/d21/main_2db_8c.html#af251d986cfe884ffd5ca864531253f62">ast_db_deltree</a></div><div class="ttdeci">int ast_db_deltree(const char *family, const char *keytree)</div><div class="ttdoc">Delete one or more entries in astdb. </div><div class="ttdef"><b>Definition:</b> <a href="../../da/d21/main_2db_8c_source.html#l00457">main/db.c:457</a></div></div>
<div class="ttc" id="lock_8h_html_ac840092853644cea0a186efdc58985f5"><div class="ttname"><a href="../../dd/d42/lock_8h.html#ac840092853644cea0a186efdc58985f5">AST_MUTEX_DEFINE_STATIC</a></div><div class="ttdeci">#define AST_MUTEX_DEFINE_STATIC(mutex)</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d42/lock_8h_source.html#l00518">lock.h:518</a></div></div>
<div class="ttc" id="main_2db_8c_html_a0a19fc05bc020876fec791200e169eb2"><div class="ttname"><a href="../../da/d21/main_2db_8c.html#a0a19fc05bc020876fec791200e169eb2">db_sync</a></div><div class="ttdeci">static void db_sync(void)</div><div class="ttdef"><b>Definition:</b> <a href="../../da/d21/main_2db_8c_source.html#l01009">main/db.c:1009</a></div></div>
<div class="ttc" id="lock_8h_html_a873f9ce8c6287a32d48c83133e124418"><div class="ttname"><a href="../../dd/d42/lock_8h.html#a873f9ce8c6287a32d48c83133e124418">ast_mutex_unlock</a></div><div class="ttdeci">#define ast_mutex_unlock(a)</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d42/lock_8h_source.html#l00188">lock.h:188</a></div></div>
<div class="ttc" id="structast__db__entry_html_a5892a9181e6a332f84d27aecd41dcd12"><div class="ttname"><a href="../../da/d1d/structast__db__entry.html#a5892a9181e6a332f84d27aecd41dcd12">ast_db_entry::key</a></div><div class="ttdeci">char * key</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d4a/astdb_8h_source.html#l00033">astdb.h:33</a></div></div>
<div class="ttc" id="http_8c_html_a6f25bc812d09fedb86bf394c01061c56"><div class="ttname"><a href="../../dd/d43/http_8c.html#a6f25bc812d09fedb86bf394c01061c56">prefix</a></div><div class="ttdeci">static char prefix[MAX_PREFIX]</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d43/http_8c_source.html#l00141">http.c:141</a></div></div>
<div class="ttc" id="main_2db_8c_html_a7cd1fd997f708421b79d7c8242c6ae99"><div class="ttname"><a href="../../da/d21/main_2db_8c.html#a7cd1fd997f708421b79d7c8242c6ae99">db_open</a></div><div class="ttdeci">static int db_open(void)</div><div class="ttdef"><b>Definition:</b> <a href="../../da/d21/main_2db_8c_source.html#l00239">main/db.c:239</a></div></div>
<div class="ttc" id="group__Group__AMI_html_ga0ee6ee1f4d200f711e2983bffe770a72"><div class="ttname"><a href="../../df/d72/group__Group__AMI.html#ga0ee6ee1f4d200f711e2983bffe770a72">astman_send_listack</a></div><div class="ttdeci">void astman_send_listack(struct mansession *s, const struct message *m, char *msg, char *listflag)</div><div class="ttdoc">Send ack in manager transaction to begin a list. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d10/manager_8c_source.html#l03201">manager.c:3201</a></div></div>
<div class="ttc" id="test__linkedlists_8c_html_a13dd15487fee89a002d17ef3aff62d02"><div class="ttname"><a href="../../d7/d6f/test__linkedlists_8c.html#a13dd15487fee89a002d17ef3aff62d02">a</a></div><div class="ttdeci">static struct test_val a</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d6f/test__linkedlists_8c_source.html#l00046">test_linkedlists.c:46</a></div></div>
</div><!-- fragment --></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Sun Aug 8 2021 19:43:41 for Asterisk - The Open Source Telephony Project by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="../../doxygen.png" alt="doxygen"/>
</a> 1.8.13
</small></address>
</body>
</html>
