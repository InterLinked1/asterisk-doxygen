<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Asterisk - The Open Source Telephony Project: res_stasis_test.c File Reference</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Asterisk - The Open Source Telephony Project
   &#160;<span id="projectnumber">18.5.0</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "../../search",false,'Search');
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('../../',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="../../dir_7b47cca4d318623bb4270ab1fb592ef5.html">res</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a> &#124;
<a href="#var-members">Variables</a>  </div>
  <div class="headertitle">
<div class="title">res_stasis_test.c File Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>Test infrastructure for dealing with Stasis.  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &quot;<a class="el" href="../../db/db2/asterisk_8h_source.html">asterisk.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="../../d5/da5/astobj2_8h_source.html">asterisk/astobj2.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="../../d5/d16/module_8h_source.html">asterisk/module.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="../../d6/d31/stasis__test_8h_source.html">asterisk/stasis_test.h</a>&quot;</code><br />
</div><div class="textblock"><div class="dynheader">
Include dependency graph for res_stasis_test.c:</div>
<div class="dyncontent">
<div class="center"><img src="../../da/d6b/res__stasis__test_8c__incl.png" border="0" usemap="#res__stasis__test_8c" alt=""/></div>
<map name="res__stasis__test_8c" id="res__stasis__test_8c">
<area shape="rect" id="node2" href="../../db/db2/asterisk_8h.html" title="Asterisk main include file. File version handling, generic pbx functions. " alt="" coords="147,379,231,405"/>
<area shape="rect" id="node22" href="../../d5/da5/astobj2_8h.html" title="asterisk/astobj2.h" alt="" coords="1623,379,1757,405"/>
<area shape="rect" id="node32" href="../../d5/d16/module_8h.html" title="Asterisk module definitions. " alt="" coords="1651,155,1787,181"/>
<area shape="rect" id="node38" href="../../d6/d31/stasis__test_8h.html" title="Test infrastructure for dealing with Stasis. " alt="" coords="1911,80,2069,107"/>
<area shape="rect" id="node3" href="../../d8/d20/autoconfig_8h.html" title="asterisk/autoconfig.h" alt="" coords="107,677,262,704"/>
<area shape="rect" id="node5" href="../../de/da3/include_2asterisk_2compat_8h.html" title="General Definitions for Asterisk top level program Included by asterisk.h to handle platform&#45;specific..." alt="" coords="904,453,1041,480"/>
<area shape="rect" id="node21" href="../../d8/d8a/astmm_8h.html" title="Asterisk memory management routines. " alt="" coords="5,453,140,480"/>
<area shape="rect" id="node4" href="../../dc/dba/buildopts_8h.html" title="asterisk/buildopts.h" alt="" coords="111,752,258,779"/>
<area shape="rect" id="node6" href="../../d4/dd1/compiler_8h.html" title="Compiler&#45;specific macros and other items. " alt="" coords="1419,603,1561,629"/>
<area shape="rect" id="node23" href="../../dd/d42/lock_8h.html" title="Asterisk locking&#45;related definitions: " alt="" coords="1767,528,1880,555"/>
<area shape="rect" id="node26" href="../../d5/d9d/inline__api_8h.html" title="Inlinable API function macro. " alt="" coords="1370,677,1517,704"/>
<area shape="rect" id="node31" href="../../df/d90/linkedlists_8h.html" title="A set of macros to manage forward&#45;linked lists. " alt="" coords="1635,453,1785,480"/>
<area shape="rect" id="node25" href="../../de/df7/time_8h.html" title="Time&#45;related functions and macros. " alt="" coords="368,603,431,629"/>
<area shape="rect" id="node29" href="../../d3/dda/backtrace_8h.html" title="Asterisk backtrace generation. " alt="" coords="1748,603,1899,629"/>
<area shape="rect" id="node30" href="../../d1/d8c/logger_8h.html" title="Support for logging to various files, console and syslog Configuration in file logger.conf. " alt="" coords="2157,603,2284,629"/>
<area shape="rect" id="node33" href="../../d5/d60/utils_8h.html" title="Utility functions. " alt="" coords="1637,229,1751,256"/>
<area shape="rect" id="node34" href="../../d9/d94/network_8h.html" title="Wrapper for network related headers, masking differences between various operating systems..." alt="" coords="2013,304,2151,331"/>
<area shape="rect" id="node35" href="../../d5/deb/localtime_8h.html" title="Custom localtime functions for multiple timezones. " alt="" coords="1311,304,1458,331"/>
<area shape="rect" id="node36" href="../../d1/d0f/stringfields_8h.html" title="asterisk/stringfields.h" alt="" coords="2198,379,2355,405"/>
<area shape="rect" id="node37" href="../../d6/d90/strings_8h.html" title="String manipulation functions. " alt="" coords="1605,304,1735,331"/>
<area shape="rect" id="node39" href="../../dd/d79/stasis_8h.html" title="Stasis Message Bus API. See Stasis Message Bus API for detailed documentation. " alt="" coords="1962,155,2087,181"/>
<area shape="rect" id="node40" href="../../d4/d05/json_8h.html" title="Asterisk JSON abstraction layer. " alt="" coords="1962,229,2077,256"/>
<area shape="rect" id="node41" href="../../db/d45/manager_8h.html" title="The AMI &#45; Asterisk Manager Interface &#45; is a TCP protocol created to manage Asterisk with third&#45;party ..." alt="" coords="2249,229,2395,256"/>
<area shape="rect" id="node42" href="../../dd/d20/event_8h.html" title="asterisk/event.h" alt="" coords="2101,229,2225,256"/>
</map>
</div>
</div>
<p><a href="../../da/dca/res__stasis__test_8c_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a88b7c88fed6b80fd18f34f97757dfc04"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../da/dca/res__stasis__test_8c.html#a88b7c88fed6b80fd18f34f97757dfc04">__reg_module</a> (void)</td></tr>
<tr class="separator:a88b7c88fed6b80fd18f34f97757dfc04"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:afeab1257bd17282b95875499393a147a"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../da/dca/res__stasis__test_8c.html#afeab1257bd17282b95875499393a147a">__unreg_module</a> (void)</td></tr>
<tr class="separator:afeab1257bd17282b95875499393a147a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4fb0aca9bbcdb9709fa52a70aded6cae"><td class="memItemLeft" align="right" valign="top">struct <a class="el" href="../../d9/df5/structast__module.html">ast_module</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../da/dca/res__stasis__test_8c.html#a4fb0aca9bbcdb9709fa52a70aded6cae">AST_MODULE_SELF_SYM</a> (void)</td></tr>
<tr class="separator:a4fb0aca9bbcdb9709fa52a70aded6cae"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac3382bf6da54c56b37069bd76bbdf4f9"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../da/dca/res__stasis__test_8c.html#ac3382bf6da54c56b37069bd76bbdf4f9">load_module</a> (void)</td></tr>
<tr class="separator:ac3382bf6da54c56b37069bd76bbdf4f9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a697ee0eea34570cb67e9b4ab805e03c9"><td class="memItemLeft" align="right" valign="top">static struct timespec&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../da/dca/res__stasis__test_8c.html#a697ee0eea34570cb67e9b4ab805e03c9">make_deadline</a> (int timeout_millis)</td></tr>
<tr class="separator:a697ee0eea34570cb67e9b4ab805e03c9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3dc12c9df35267a85e65b120956cc809"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../da/dca/res__stasis__test_8c.html#a3dc12c9df35267a85e65b120956cc809">message_sink_cb</a> (void *data, struct <a class="el" href="../../d9/de4/structstasis__subscription.html">stasis_subscription</a> *<a class="el" href="../../d1/da4/res__corosync_8c.html#a8e51289dd0fc7415cee40e7a57b49fdf">sub</a>, struct <a class="el" href="../../d7/d55/structstasis__message.html">stasis_message</a> *<a class="el" href="../../d8/d9e/structmessage.html">message</a>)</td></tr>
<tr class="memdesc:a3dc12c9df35267a85e65b120956cc809"><td class="mdescLeft">&#160;</td><td class="mdescRight">Implementation of the <a class="el" href="../../da/dca/res__stasis__test_8c.html#aed5dc93cef18d85a7ad8e49f803fe860" title="Topic callback to receive messages. ">stasis_message_sink_cb()</a> callback.  <a href="#a3dc12c9df35267a85e65b120956cc809">More...</a><br /></td></tr>
<tr class="separator:a3dc12c9df35267a85e65b120956cc809"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aed5dc93cef18d85a7ad8e49f803fe860"><td class="memItemLeft" align="right" valign="top"><a class="el" href="../../dd/d79/stasis_8h.html#a2b7854b4fb538be6f885943a24d60c8f">stasis_subscription_cb</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../da/dca/res__stasis__test_8c.html#aed5dc93cef18d85a7ad8e49f803fe860">stasis_message_sink_cb</a> (void)</td></tr>
<tr class="memdesc:aed5dc93cef18d85a7ad8e49f803fe860"><td class="mdescLeft">&#160;</td><td class="mdescRight">Topic callback to receive messages.  <a href="#aed5dc93cef18d85a7ad8e49f803fe860">More...</a><br /></td></tr>
<tr class="separator:aed5dc93cef18d85a7ad8e49f803fe860"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7cbf24ef1829924094bca0c90ee2e933"><td class="memItemLeft" align="right" valign="top">struct <a class="el" href="../../d1/db7/structstasis__message__sink.html">stasis_message_sink</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../da/dca/res__stasis__test_8c.html#a7cbf24ef1829924094bca0c90ee2e933">stasis_message_sink_create</a> (void)</td></tr>
<tr class="memdesc:a7cbf24ef1829924094bca0c90ee2e933"><td class="mdescLeft">&#160;</td><td class="mdescRight">Create a message sink.  <a href="#a7cbf24ef1829924094bca0c90ee2e933">More...</a><br /></td></tr>
<tr class="separator:a7cbf24ef1829924094bca0c90ee2e933"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9aaa11026150e5bc050702005327a25d"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../da/dca/res__stasis__test_8c.html#a9aaa11026150e5bc050702005327a25d">stasis_message_sink_dtor</a> (void *obj)</td></tr>
<tr class="separator:a9aaa11026150e5bc050702005327a25d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0bcb44162d4355ad60ec420b1cef2cb7"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../da/dca/res__stasis__test_8c.html#a0bcb44162d4355ad60ec420b1cef2cb7">stasis_message_sink_should_stay</a> (struct <a class="el" href="../../d1/db7/structstasis__message__sink.html">stasis_message_sink</a> *sink, int num_messages, int timeout_millis)</td></tr>
<tr class="memdesc:a0bcb44162d4355ad60ec420b1cef2cb7"><td class="mdescLeft">&#160;</td><td class="mdescRight">Ensures that no new messages are received.  <a href="#a0bcb44162d4355ad60ec420b1cef2cb7">More...</a><br /></td></tr>
<tr class="separator:a0bcb44162d4355ad60ec420b1cef2cb7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab3d88a9f84cee5cc16fbab577bbeeeaa"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../da/dca/res__stasis__test_8c.html#ab3d88a9f84cee5cc16fbab577bbeeeaa">stasis_message_sink_wait_for</a> (struct <a class="el" href="../../d1/db7/structstasis__message__sink.html">stasis_message_sink</a> *sink, int start, <a class="el" href="../../d6/d31/stasis__test_8h.html#a2ff062ff74f4e2e0b3d2d616a0809321">stasis_wait_cb</a> cmp_cb, const void *data, int timeout_millis)</td></tr>
<tr class="memdesc:ab3d88a9f84cee5cc16fbab577bbeeeaa"><td class="mdescLeft">&#160;</td><td class="mdescRight">Wait for a message that matches the given criteria.  <a href="#ab3d88a9f84cee5cc16fbab577bbeeeaa">More...</a><br /></td></tr>
<tr class="separator:ab3d88a9f84cee5cc16fbab577bbeeeaa"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa22cd15a52dfd21c087bc817c2e5845d"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../da/dca/res__stasis__test_8c.html#aa22cd15a52dfd21c087bc817c2e5845d">stasis_message_sink_wait_for_count</a> (struct <a class="el" href="../../d1/db7/structstasis__message__sink.html">stasis_message_sink</a> *sink, int num_messages, int timeout_millis)</td></tr>
<tr class="memdesc:aa22cd15a52dfd21c087bc817c2e5845d"><td class="mdescLeft">&#160;</td><td class="mdescRight">Wait for a sink's num_messages field to reach a certain level.  <a href="#aa22cd15a52dfd21c087bc817c2e5845d">More...</a><br /></td></tr>
<tr class="separator:aa22cd15a52dfd21c087bc817c2e5845d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9b1cfb22818f3b27fb9e95c008a40e61"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../da/dca/res__stasis__test_8c.html#a9b1cfb22818f3b27fb9e95c008a40e61">STASIS_MESSAGE_TYPE_DEFN</a> (<a class="el" href="../../df/deb/group__StasisTopicsAndMessages.html#gaa0a46c6b720362854b798adef799ce78">stasis_test_message_type</a>)</td></tr>
<tr class="separator:a9b1cfb22818f3b27fb9e95c008a40e61"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga5abf633202a5c4e0caec70cf8df00047"><td class="memItemLeft" align="right" valign="top">struct <a class="el" href="../../d7/d55/structstasis__message.html">stasis_message</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../df/deb/group__StasisTopicsAndMessages.html#ga5abf633202a5c4e0caec70cf8df00047">stasis_test_message_create</a> (void)</td></tr>
<tr class="memdesc:ga5abf633202a5c4e0caec70cf8df00047"><td class="mdescLeft">&#160;</td><td class="mdescRight">Creates a test message.  <a href="../../df/deb/group__StasisTopicsAndMessages.html#ga5abf633202a5c4e0caec70cf8df00047">More...</a><br /></td></tr>
<tr class="separator:ga5abf633202a5c4e0caec70cf8df00047"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad09fa931f468002152a3cc2d5ce25eae"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../da/dca/res__stasis__test_8c.html#ad09fa931f468002152a3cc2d5ce25eae">unload_module</a> (void)</td></tr>
<tr class="separator:ad09fa931f468002152a3cc2d5ce25eae"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="var-members"></a>
Variables</h2></td></tr>
<tr class="memitem:ab22f32016155f7f403e7178767163d7d"><td class="memItemLeft" align="right" valign="top">static struct <a class="el" href="../../dd/d5f/structast__module__info.html">ast_module_info</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../da/dca/res__stasis__test_8c.html#ab22f32016155f7f403e7178767163d7d">__mod_info</a> = { .<a class="el" href="../../d1/da4/res__corosync_8c.html#a8f8f80d37794cde9472343e4487ba3eb">name</a> = <a class="el" href="../../da/ddd/named__acl_8c.html#aec23fc5034c3bb08140fc021f4955877">AST_MODULE</a>, .flags = <a class="el" href="../../d5/d16/module_8h.html#a155a0df9c59e04e305d4a2fa3e35f843a835b27a90d895a488e4e14cc3d2dee8c">AST_MODFLAG_GLOBAL_SYMBOLS</a> | <a class="el" href="../../d5/d16/module_8h.html#a155a0df9c59e04e305d4a2fa3e35f843a12c3f60dd7655dfa8d4430cbf04b1223">AST_MODFLAG_LOAD_ORDER</a> , .description = &quot;Stasis <a class="el" href="../../d8/d89/structtest.html">test</a> utilities&quot; , .key = &quot;This paragraph is copyright (<a class="el" href="../../d7/d6f/test__linkedlists_8c.html#acd9db00336027462cfb25b97b5356883">c</a>) 2006 by Digium, Inc. \In <a class="el" href="../../d5/d14/voicin_8c.html#aed7ca058008dc3e5ee131e575abed285">order</a> for your module to load, it must return this \key via <a class="el" href="../../d7/d6f/test__linkedlists_8c.html#a13dd15487fee89a002d17ef3aff62d02">a</a> function called \&quot;key\&quot;. Any code which \includes this paragraph must <a class="el" href="../../dd/d7c/eagi__proxy_8c.html#a39730e90126aad69cfc9ca4d6fcdb3a6">be</a> licensed under the GNU \General Public License <a class="el" href="../../da/d7c/utils_2frame_8h.html#a56abfaab87c46691c1ef3ad0df23e864">version</a> 2 or later (at your \option). In addition to Digium's general reservations \of rights, Digium expressly reserves the right to \allow other parties to license this paragraph under \different terms. Any use of Digium, Inc. trademarks or \logos (including \&quot;Asterisk\&quot; or \&quot;Digium\&quot;) without \express written <a class="el" href="../../d4/d4c/structpermission.html">permission</a> of Digium, Inc. is prohibited.\n&quot; , .buildopt_sum = <a class="el" href="../../da/d84/res__pjsip__stir__shaken_8c.html#a6e79b87e069c15a5fb21826e5eed0971">AST_BUILDOPT_SUM</a>, .support_level = <a class="el" href="../../d5/d16/module_8h.html#ab35bc4efd9f79706300965c9d36a0ce5a634484c0074e7b6b630756fab09e2c15">AST_MODULE_SUPPORT_CORE</a>, .load = <a class="el" href="../../d6/d7a/test__xml__escape_8c.html#ac3382bf6da54c56b37069bd76bbdf4f9">load_module</a>, .unload = <a class="el" href="../../d6/d7a/test__xml__escape_8c.html#ad09fa931f468002152a3cc2d5ce25eae">unload_module</a>, .load_pri = <a class="el" href="../../d5/d16/module_8h.html#aa4f734041ffd9d75b07cefb0291e1e58a08d902290b0d6cbffd8e607d5e399a06">AST_MODPRI_APP_DEPEND</a>, }</td></tr>
<tr class="separator:ab22f32016155f7f403e7178767163d7d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad60e83b9aa660040fed4d5377966cc21"><td class="memItemLeft" align="right" valign="top">static const struct <a class="el" href="../../dd/d5f/structast__module__info.html">ast_module_info</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../da/dca/res__stasis__test_8c.html#ad60e83b9aa660040fed4d5377966cc21">ast_module_info</a> = &amp;<a class="el" href="../../d6/d7a/test__xml__escape_8c.html#ab22f32016155f7f403e7178767163d7d">__mod_info</a></td></tr>
<tr class="separator:ad60e83b9aa660040fed4d5377966cc21"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Test infrastructure for dealing with Stasis. </p>
<dl class="section author"><dt>Author</dt><dd>David M. Lee, II <a href="#" onclick="location.href='mai'+'lto:'+'dle'+'e@'+'dig'+'iu'+'m.c'+'om'; return false;">dlee@<span style="display: none;">.nosp@m.</span>digi<span style="display: none;">.nosp@m.</span>um.co<span style="display: none;">.nosp@m.</span>m</a> </dd></dl>

<p class="definition">Definition in file <a class="el" href="../../da/dca/res__stasis__test_8c_source.html">res_stasis_test.c</a>.</p>
</div><h2 class="groupheader">Function Documentation</h2>
<a id="a88b7c88fed6b80fd18f34f97757dfc04"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a88b7c88fed6b80fd18f34f97757dfc04">&#9670;&nbsp;</a></span>__reg_module()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void __reg_module </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="../../da/dca/res__stasis__test_8c_source.html#l00273">273</a> of file <a class="el" href="../../da/dca/res__stasis__test_8c_source.html">res_stasis_test.c</a>.</p>

</div>
</div>
<a id="afeab1257bd17282b95875499393a147a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#afeab1257bd17282b95875499393a147a">&#9670;&nbsp;</a></span>__unreg_module()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void __unreg_module </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="../../da/dca/res__stasis__test_8c_source.html#l00273">273</a> of file <a class="el" href="../../da/dca/res__stasis__test_8c_source.html">res_stasis_test.c</a>.</p>

</div>
</div>
<a id="a4fb0aca9bbcdb9709fa52a70aded6cae"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4fb0aca9bbcdb9709fa52a70aded6cae">&#9670;&nbsp;</a></span>AST_MODULE_SELF_SYM()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="../../d9/df5/structast__module.html">ast_module</a>* AST_MODULE_SELF_SYM </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="../../da/dca/res__stasis__test_8c_source.html#l00273">273</a> of file <a class="el" href="../../da/dca/res__stasis__test_8c_source.html">res_stasis_test.c</a>.</p>

</div>
</div>
<a id="ac3382bf6da54c56b37069bd76bbdf4f9"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac3382bf6da54c56b37069bd76bbdf4f9">&#9670;&nbsp;</a></span>load_module()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int load_module </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="../../da/dca/res__stasis__test_8c_source.html#l00259">259</a> of file <a class="el" href="../../da/dca/res__stasis__test_8c_source.html">res_stasis_test.c</a>.</p>

<p class="reference">References <a class="el" href="../../d5/d16/module_8h_source.html#l00316">AST_MODFLAG_GLOBAL_SYMBOLS</a>, <a class="el" href="../../d5/d16/module_8h_source.html#l00317">AST_MODFLAG_LOAD_ORDER</a>, <a class="el" href="../../d5/d16/module_8h_source.html#l00328">AST_MODPRI_APP_DEPEND</a>, <a class="el" href="../../d9/de9/res__phoneprov_8c.html#addaa208b0ed785225e24490fb9f28a80">AST_MODULE_INFO()</a>, <a class="el" href="../../d5/d16/module_8h_source.html#l00078">AST_MODULE_LOAD_DECLINE</a>, <a class="el" href="../../d5/d16/module_8h_source.html#l00070">AST_MODULE_LOAD_SUCCESS</a>, <a class="el" href="../../d5/d16/module_8h_source.html#l00121">AST_MODULE_SUPPORT_CORE</a>, <a class="el" href="../../d5/d16/module_8h_source.html#l00046">ASTERISK_GPL_KEY</a>, <a class="el" href="../../dd/d79/stasis_8h_source.html#l01501">STASIS_MESSAGE_TYPE_INIT</a>, <a class="el" href="../../df/deb/group__StasisTopicsAndMessages.html#gaa0a46c6b720362854b798adef799ce78">stasis_test_message_type()</a>, and <a class="el" href="../../da/dca/res__stasis__test_8c_source.html#l00253">unload_module()</a>.</p>
<div class="fragment"><div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;{</div><div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../dd/d79/stasis_8h.html#a70cd046d8e3fd50de5c51aecb2830d2a">STASIS_MESSAGE_TYPE_INIT</a>(<a class="code" href="../../df/deb/group__StasisTopicsAndMessages.html#gaa0a46c6b720362854b798adef799ce78">stasis_test_message_type</a>) != 0) {</div><div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../d5/d16/module_8h.html#adc09474f0ff557e9925b722ee5b952dfac742921e9f9512d28f62c74ea2affe57">AST_MODULE_LOAD_DECLINE</a>;</div><div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;   }</div><div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;</div><div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;   <span class="keywordflow">return</span> <a class="code" href="../../d5/d16/module_8h.html#adc09474f0ff557e9925b722ee5b952dfa89bb877ade9ce418ad6663f3d936f314">AST_MODULE_LOAD_SUCCESS</a>;</div><div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;}</div><div class="ttc" id="module_8h_html_adc09474f0ff557e9925b722ee5b952dfa89bb877ade9ce418ad6663f3d936f314"><div class="ttname"><a href="../../d5/d16/module_8h.html#adc09474f0ff557e9925b722ee5b952dfa89bb877ade9ce418ad6663f3d936f314">AST_MODULE_LOAD_SUCCESS</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d16/module_8h_source.html#l00070">module.h:70</a></div></div>
<div class="ttc" id="stasis_8h_html_a70cd046d8e3fd50de5c51aecb2830d2a"><div class="ttname"><a href="../../dd/d79/stasis_8h.html#a70cd046d8e3fd50de5c51aecb2830d2a">STASIS_MESSAGE_TYPE_INIT</a></div><div class="ttdeci">#define STASIS_MESSAGE_TYPE_INIT(name)</div><div class="ttdoc">Boiler-plate messaging macro for initializing message types. </div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d79/stasis_8h_source.html#l01501">stasis.h:1501</a></div></div>
<div class="ttc" id="group__StasisTopicsAndMessages_html_gaa0a46c6b720362854b798adef799ce78"><div class="ttname"><a href="../../df/deb/group__StasisTopicsAndMessages.html#gaa0a46c6b720362854b798adef799ce78">stasis_test_message_type</a></div><div class="ttdeci">struct stasis_message_type * stasis_test_message_type(void)</div><div class="ttdoc">Gets the type of messages created by stasis_test_message_create(). </div></div>
<div class="ttc" id="module_8h_html_adc09474f0ff557e9925b722ee5b952dfac742921e9f9512d28f62c74ea2affe57"><div class="ttname"><a href="../../d5/d16/module_8h.html#adc09474f0ff557e9925b722ee5b952dfac742921e9f9512d28f62c74ea2affe57">AST_MODULE_LOAD_DECLINE</a></div><div class="ttdoc">Module has failed to load, may be in an inconsistent state. </div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d16/module_8h_source.html#l00078">module.h:78</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a697ee0eea34570cb67e9b4ab805e03c9"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a697ee0eea34570cb67e9b4ab805e03c9">&#9670;&nbsp;</a></span>make_deadline()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static struct timespec make_deadline </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>timeout_millis</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="../../da/dca/res__stasis__test_8c_source.html#l00063">63</a> of file <a class="el" href="../../da/dca/res__stasis__test_8c_source.html">res_stasis_test.c</a>.</p>

<p class="reference">References <a class="el" href="../../d4/dc5/extconf_8c_source.html#l02283">ast_tvadd()</a>, and <a class="el" href="../../de/df7/time_8h_source.html#l00150">ast_tvnow()</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../da/dca/res__stasis__test_8c_source.html#l00170">stasis_message_sink_should_stay()</a>, <a class="el" href="../../da/dca/res__stasis__test_8c_source.html#l00191">stasis_message_sink_wait_for()</a>, and <a class="el" href="../../da/dca/res__stasis__test_8c_source.html#l00149">stasis_message_sink_wait_for_count()</a>.</p>
<div class="fragment"><div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;{</div><div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;   <span class="keyword">struct </span>timeval start = <a class="code" href="../../de/df7/time_8h.html#ad3899efb6f0e348556ef69f5b16aa7f7">ast_tvnow</a>();</div><div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;   <span class="keyword">struct </span>timeval delta = {</div><div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;      .tv_sec = timeout_millis / 1000,</div><div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;      .tv_usec = (timeout_millis % 1000) * 1000,</div><div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;   };</div><div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;   <span class="keyword">struct </span>timeval deadline_tv = <a class="code" href="../../de/df7/time_8h.html#a97e1bb8fbd7a103212789e87e7ed6073">ast_tvadd</a>(start, delta);</div><div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;   <span class="keyword">struct </span>timespec deadline = {</div><div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;      .tv_sec = deadline_tv.tv_sec,</div><div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;      .tv_nsec = 1000 * deadline_tv.tv_usec,</div><div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;   };</div><div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;</div><div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;   <span class="keywordflow">return</span> deadline;</div><div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;}</div><div class="ttc" id="time_8h_html_ad3899efb6f0e348556ef69f5b16aa7f7"><div class="ttname"><a href="../../de/df7/time_8h.html#ad3899efb6f0e348556ef69f5b16aa7f7">ast_tvnow</a></div><div class="ttdeci">struct timeval ast_tvnow(void)</div><div class="ttdoc">Returns current timeval. Meant to replace calls to gettimeofday(). </div><div class="ttdef"><b>Definition:</b> <a href="../../de/df7/time_8h_source.html#l00150">time.h:150</a></div></div>
<div class="ttc" id="time_8h_html_a97e1bb8fbd7a103212789e87e7ed6073"><div class="ttname"><a href="../../de/df7/time_8h.html#a97e1bb8fbd7a103212789e87e7ed6073">ast_tvadd</a></div><div class="ttdeci">struct timeval ast_tvadd(struct timeval a, struct timeval b)</div><div class="ttdoc">Returns the sum of two timevals a + b. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/dc5/extconf_8c_source.html#l02283">extconf.c:2283</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a3dc12c9df35267a85e65b120956cc809"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3dc12c9df35267a85e65b120956cc809">&#9670;&nbsp;</a></span>message_sink_cb()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void message_sink_cb </td>
          <td>(</td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>data</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="../../d9/de4/structstasis__subscription.html">stasis_subscription</a> *&#160;</td>
          <td class="paramname"><em>sub</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="../../d7/d55/structstasis__message.html">stasis_message</a> *&#160;</td>
          <td class="paramname"><em>message</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Implementation of the <a class="el" href="../../da/dca/res__stasis__test_8c.html#aed5dc93cef18d85a7ad8e49f803fe860" title="Topic callback to receive messages. ">stasis_message_sink_cb()</a> callback. </p>
<p>Why the roundabout way of exposing this via <a class="el" href="../../da/dca/res__stasis__test_8c.html#aed5dc93cef18d85a7ad8e49f803fe860" title="Topic callback to receive messages. ">stasis_message_sink_cb()</a>? Well, it has to do with how we previously loaded modules, using <code>RTLD_LAZY</code>.</p>
<p>The <a class="el" href="../../da/dca/res__stasis__test_8c.html#aed5dc93cef18d85a7ad8e49f803fe860" title="Topic callback to receive messages. ">stasis_message_sink_cb()</a> function gave us a layer of indirection so that the initial lazy binding would still work as expected. </p>

<p class="definition">Definition at line <a class="el" href="../../da/dca/res__stasis__test_8c_source.html#l00108">108</a> of file <a class="el" href="../../da/dca/res__stasis__test_8c_source.html">res_stasis_test.c</a>.</p>

<p class="reference">References <a class="el" href="../../d5/da5/astobj2_8h_source.html#l00464">ao2_ref</a>, <a class="el" href="../../dd/d42/lock_8h_source.html#l00201">ast_cond_signal</a>, <a class="el" href="../../d8/d8a/astmm_8h_source.html#l00228">ast_realloc</a>, <a class="el" href="../../d6/d31/stasis__test_8h_source.html#l00048">stasis_message_sink::cond</a>, <a class="el" href="../../d6/d31/stasis__test_8h_source.html#l00055">stasis_message_sink::is_done</a>, <a class="el" href="../../d6/d31/stasis__test_8h_source.html#l00046">stasis_message_sink::lock</a>, <a class="el" href="../../df/d44/app__meetme_8c_source.html#l01091">lock</a>, <a class="el" href="../../d6/d31/stasis__test_8h_source.html#l00051">stasis_message_sink::max_messages</a>, <a class="el" href="../../d6/d31/stasis__test_8h_source.html#l00057">stasis_message_sink::messages</a>, <a class="el" href="../../d6/d31/stasis__test_8h_source.html#l00053">stasis_message_sink::num_messages</a>, <a class="el" href="../../dd/d42/lock_8h_source.html#l00587">SCOPED_MUTEX</a>, <a class="el" href="../../d2/db9/stasis__message_8c_source.html#l00187">stasis_message_type()</a>, <a class="el" href="../../df/deb/group__StasisTopicsAndMessages.html#gafae630f05995b59b49dc523a5b9ce757">stasis_subscription_change_type()</a>, and <a class="el" href="../../d0/df4/stasis_8c_source.html#l01176">stasis_subscription_final_message()</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../da/dca/res__stasis__test_8c_source.html#l00143">stasis_message_sink_cb()</a>.</p>
<div class="fragment"><div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;{</div><div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d1/db7/structstasis__message__sink.html">stasis_message_sink</a> *sink = data;</div><div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;</div><div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;   <a class="code" href="../../dd/d42/lock_8h.html#ab13590ad27fac3b9c7c7b792c603c9b3">SCOPED_MUTEX</a>(<a class="code" href="../../df/d44/app__meetme_8c.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>, &amp;sink-&gt;<a class="code" href="../../d1/db7/structstasis__message__sink.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);</div><div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;</div><div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../dd/d79/stasis_8h.html#a839350445aaa51cedf31f6daec933ee0">stasis_subscription_final_message</a>(sub, message)) {</div><div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;      sink-&gt;<a class="code" href="../../d1/db7/structstasis__message__sink.html#a31ea9139740eed42579595bee74e6d70">is_done</a> = 1;</div><div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;      <a class="code" href="../../dd/d42/lock_8h.html#ae2cdf274a5da241c3ad7324d82bf6af0">ast_cond_signal</a>(&amp;sink-&gt;<a class="code" href="../../d1/db7/structstasis__message__sink.html#a1c7181c39f99ee801943a0d0aa9872b9">cond</a>);</div><div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;      <span class="keywordflow">return</span>;</div><div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;   }</div><div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;</div><div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../df/deb/group__StasisTopicsAndMessages.html#gafae630f05995b59b49dc523a5b9ce757">stasis_subscription_change_type</a>() == <a class="code" href="../../dd/d79/stasis_8h.html#a9356e8a29344ca4eac93088198ccff89">stasis_message_type</a>(message)) {</div><div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;      <span class="comment">/* Ignore subscription changes */</span></div><div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;      <span class="keywordflow">return</span>;</div><div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;   }</div><div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;</div><div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;   <span class="keywordflow">if</span> (sink-&gt;<a class="code" href="../../d1/db7/structstasis__message__sink.html#ab011c00a1ee07d6bccad0127c0130dd5">num_messages</a> == sink-&gt;<a class="code" href="../../d1/db7/structstasis__message__sink.html#ac6bb1ec8624b81cd62e5307e3c50dcf9">max_messages</a>) {</div><div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;      <span class="keywordtype">size_t</span> new_max_messages = sink-&gt;<a class="code" href="../../d1/db7/structstasis__message__sink.html#ac6bb1ec8624b81cd62e5307e3c50dcf9">max_messages</a> * 2;</div><div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;      <span class="keyword">struct </span><a class="code" href="../../d7/d55/structstasis__message.html">stasis_message</a> **new_messages = <a class="code" href="../../d8/d8a/astmm_8h.html#aa6bcdb74dc1508c22986f0adf171a0f2">ast_realloc</a>(</div><div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;         sink-&gt;<a class="code" href="../../d1/db7/structstasis__message__sink.html#a7657d3ac0a1e4b72fd1f8db2e0cc56cb">messages</a>,</div><div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;         <span class="keyword">sizeof</span>(*new_messages) * new_max_messages);</div><div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;      <span class="keywordflow">if</span> (!new_messages) {</div><div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;         <span class="keywordflow">return</span>;</div><div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;      }</div><div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;      sink-&gt;<a class="code" href="../../d1/db7/structstasis__message__sink.html#ac6bb1ec8624b81cd62e5307e3c50dcf9">max_messages</a> = new_max_messages;</div><div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;      sink-&gt;<a class="code" href="../../d1/db7/structstasis__message__sink.html#a7657d3ac0a1e4b72fd1f8db2e0cc56cb">messages</a> = new_messages;</div><div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;   }</div><div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;</div><div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(message, +1);</div><div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;   sink-&gt;<a class="code" href="../../d1/db7/structstasis__message__sink.html#a7657d3ac0a1e4b72fd1f8db2e0cc56cb">messages</a>[sink-&gt;<a class="code" href="../../d1/db7/structstasis__message__sink.html#ab011c00a1ee07d6bccad0127c0130dd5">num_messages</a>++] = message;</div><div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;   <a class="code" href="../../dd/d42/lock_8h.html#ae2cdf274a5da241c3ad7324d82bf6af0">ast_cond_signal</a>(&amp;sink-&gt;<a class="code" href="../../d1/db7/structstasis__message__sink.html#a1c7181c39f99ee801943a0d0aa9872b9">cond</a>);</div><div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;}</div><div class="ttc" id="structstasis__message__sink_html"><div class="ttname"><a href="../../d1/db7/structstasis__message__sink.html">stasis_message_sink</a></div><div class="ttdoc">Structure that collects messages from a topic. </div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d31/stasis__test_8h_source.html#l00044">stasis_test.h:44</a></div></div>
<div class="ttc" id="astmm_8h_html_aa6bcdb74dc1508c22986f0adf171a0f2"><div class="ttname"><a href="../../d8/d8a/astmm_8h.html#aa6bcdb74dc1508c22986f0adf171a0f2">ast_realloc</a></div><div class="ttdeci">#define ast_realloc(p, len)</div><div class="ttdoc">A wrapper for realloc() </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d8a/astmm_8h_source.html#l00228">astmm.h:228</a></div></div>
<div class="ttc" id="structstasis__message__sink_html_a7657d3ac0a1e4b72fd1f8db2e0cc56cb"><div class="ttname"><a href="../../d1/db7/structstasis__message__sink.html#a7657d3ac0a1e4b72fd1f8db2e0cc56cb">stasis_message_sink::messages</a></div><div class="ttdeci">struct stasis_message ** messages</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d31/stasis__test_8h_source.html#l00057">stasis_test.h:57</a></div></div>
<div class="ttc" id="stasis_8h_html_a9356e8a29344ca4eac93088198ccff89"><div class="ttname"><a href="../../dd/d79/stasis_8h.html#a9356e8a29344ca4eac93088198ccff89">stasis_message_type</a></div><div class="ttdeci">struct stasis_message_type * stasis_message_type(const struct stasis_message *msg)</div><div class="ttdoc">Get the message type for a stasis_message. </div><div class="ttdef"><b>Definition:</b> <a href="../../d2/db9/stasis__message_8c_source.html#l00187">stasis_message.c:187</a></div></div>
<div class="ttc" id="structstasis__message_html"><div class="ttname"><a href="../../d7/d55/structstasis__message.html">stasis_message</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d2/db9/stasis__message_8c_source.html#l00121">stasis_message.c:121</a></div></div>
<div class="ttc" id="structstasis__message__sink_html_a1c7181c39f99ee801943a0d0aa9872b9"><div class="ttname"><a href="../../d1/db7/structstasis__message__sink.html#a1c7181c39f99ee801943a0d0aa9872b9">stasis_message_sink::cond</a></div><div class="ttdeci">ast_cond_t cond</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d31/stasis__test_8h_source.html#l00048">stasis_test.h:48</a></div></div>
<div class="ttc" id="lock_8h_html_ae2cdf274a5da241c3ad7324d82bf6af0"><div class="ttname"><a href="../../dd/d42/lock_8h.html#ae2cdf274a5da241c3ad7324d82bf6af0">ast_cond_signal</a></div><div class="ttdeci">#define ast_cond_signal(cond)</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d42/lock_8h_source.html#l00201">lock.h:201</a></div></div>
<div class="ttc" id="structstasis__message__sink_html_ac6bb1ec8624b81cd62e5307e3c50dcf9"><div class="ttname"><a href="../../d1/db7/structstasis__message__sink.html#ac6bb1ec8624b81cd62e5307e3c50dcf9">stasis_message_sink::max_messages</a></div><div class="ttdeci">size_t max_messages</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d31/stasis__test_8h_source.html#l00051">stasis_test.h:51</a></div></div>
<div class="ttc" id="lock_8h_html_ab13590ad27fac3b9c7c7b792c603c9b3"><div class="ttname"><a href="../../dd/d42/lock_8h.html#ab13590ad27fac3b9c7c7b792c603c9b3">SCOPED_MUTEX</a></div><div class="ttdeci">#define SCOPED_MUTEX(varname, lock)</div><div class="ttdoc">scoped lock specialization for mutexes </div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d42/lock_8h_source.html#l00587">lock.h:587</a></div></div>
<div class="ttc" id="structstasis__message__sink_html_ab011c00a1ee07d6bccad0127c0130dd5"><div class="ttname"><a href="../../d1/db7/structstasis__message__sink.html#ab011c00a1ee07d6bccad0127c0130dd5">stasis_message_sink::num_messages</a></div><div class="ttdeci">size_t num_messages</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d31/stasis__test_8h_source.html#l00053">stasis_test.h:53</a></div></div>
<div class="ttc" id="app__meetme_8c_html_adf04f66344e3fb0a6f6a69bf39d19902"><div class="ttname"><a href="../../df/d44/app__meetme_8c.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a></div><div class="ttdeci">ast_mutex_t lock</div><div class="ttdef"><b>Definition:</b> <a href="../../df/d44/app__meetme_8c_source.html#l01091">app_meetme.c:1091</a></div></div>
<div class="ttc" id="astobj2_8h_html_aaca5e8eac39a22f9da1c36fc6c922270"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a></div><div class="ttdeci">#define ao2_ref(o, delta)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l00464">astobj2.h:464</a></div></div>
<div class="ttc" id="stasis_8h_html_a839350445aaa51cedf31f6daec933ee0"><div class="ttname"><a href="../../dd/d79/stasis_8h.html#a839350445aaa51cedf31f6daec933ee0">stasis_subscription_final_message</a></div><div class="ttdeci">int stasis_subscription_final_message(struct stasis_subscription *sub, struct stasis_message *msg)</div><div class="ttdoc">Determine whether a message is the final message to be received on a subscription. </div><div class="ttdef"><b>Definition:</b> <a href="../../d0/df4/stasis_8c_source.html#l01176">stasis.c:1176</a></div></div>
<div class="ttc" id="structstasis__message__sink_html_adf04f66344e3fb0a6f6a69bf39d19902"><div class="ttname"><a href="../../d1/db7/structstasis__message__sink.html#adf04f66344e3fb0a6f6a69bf39d19902">stasis_message_sink::lock</a></div><div class="ttdeci">ast_mutex_t lock</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d31/stasis__test_8h_source.html#l00046">stasis_test.h:46</a></div></div>
<div class="ttc" id="structstasis__message__sink_html_a31ea9139740eed42579595bee74e6d70"><div class="ttname"><a href="../../d1/db7/structstasis__message__sink.html#a31ea9139740eed42579595bee74e6d70">stasis_message_sink::is_done</a></div><div class="ttdeci">int is_done</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d31/stasis__test_8h_source.html#l00055">stasis_test.h:55</a></div></div>
<div class="ttc" id="group__StasisTopicsAndMessages_html_gafae630f05995b59b49dc523a5b9ce757"><div class="ttname"><a href="../../df/deb/group__StasisTopicsAndMessages.html#gafae630f05995b59b49dc523a5b9ce757">stasis_subscription_change_type</a></div><div class="ttdeci">struct stasis_message_type * stasis_subscription_change_type(void)</div><div class="ttdoc">Gets the message type for subscription change notices. </div></div>
</div><!-- fragment -->
</div>
</div>
<a id="aed5dc93cef18d85a7ad8e49f803fe860"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aed5dc93cef18d85a7ad8e49f803fe860">&#9670;&nbsp;</a></span>stasis_message_sink_cb()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../dd/d79/stasis_8h.html#a2b7854b4fb538be6f885943a24d60c8f">stasis_subscription_cb</a> stasis_message_sink_cb </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Topic callback to receive messages. </p>
<p>We return a function pointer instead of simply exposing the function because of the vagaries of dlopen(), <code>RTLD_LAZY</code>, and function pointers. See the comment on the implementation for details why.</p>
<dl class="section return"><dt>Returns</dt><dd>Function pointer to <a class="el" href="../../d1/db7/structstasis__message__sink.html">stasis_message_sink</a>'s message handling function </dd></dl>

<p class="definition">Definition at line <a class="el" href="../../da/dca/res__stasis__test_8c_source.html#l00143">143</a> of file <a class="el" href="../../da/dca/res__stasis__test_8c_source.html">res_stasis_test.c</a>.</p>

<p class="reference">References <a class="el" href="../../da/dca/res__stasis__test_8c_source.html#l00108">message_sink_cb()</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../d5/d3c/test__stasis__endpoints_8c_source.html#l00070">AST_TEST_DEFINE()</a>.</p>
<div class="fragment"><div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;{</div><div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;   <span class="keywordflow">return</span> <a class="code" href="../../da/dca/res__stasis__test_8c.html#a3dc12c9df35267a85e65b120956cc809">message_sink_cb</a>;</div><div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;}</div><div class="ttc" id="res__stasis__test_8c_html_a3dc12c9df35267a85e65b120956cc809"><div class="ttname"><a href="../../da/dca/res__stasis__test_8c.html#a3dc12c9df35267a85e65b120956cc809">message_sink_cb</a></div><div class="ttdeci">static void message_sink_cb(void *data, struct stasis_subscription *sub, struct stasis_message *message)</div><div class="ttdoc">Implementation of the stasis_message_sink_cb() callback. </div><div class="ttdef"><b>Definition:</b> <a href="../../da/dca/res__stasis__test_8c_source.html#l00108">res_stasis_test.c:108</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a7cbf24ef1829924094bca0c90ee2e933"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a7cbf24ef1829924094bca0c90ee2e933">&#9670;&nbsp;</a></span>stasis_message_sink_create()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="../../d1/db7/structstasis__message__sink.html">stasis_message_sink</a>* stasis_message_sink_create </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Create a message sink. </p>
<p>This is an AO2 managed object, which you <a class="el" href="../../d5/da5/astobj2_8h.html#a6321ee982370c55ab3c24c72c562cbdd">ao2_cleanup()</a> when done. The destructor waits for an unsubscribe message to be received, to ensure the object isn't disposed of before the topic is finished. </p>

<p class="definition">Definition at line <a class="el" href="../../da/dca/res__stasis__test_8c_source.html#l00079">79</a> of file <a class="el" href="../../da/dca/res__stasis__test_8c_source.html">res_stasis_test.c</a>.</p>

<p class="reference">References <a class="el" href="../../d5/da5/astobj2_8h_source.html#l00411">ao2_alloc</a>, <a class="el" href="../../d5/da5/astobj2_8h_source.html#l01958">ao2_cleanup</a>, <a class="el" href="../../d5/da5/astobj2_8h_source.html#l00464">ao2_ref</a>, <a class="el" href="../../dd/d42/lock_8h_source.html#l00199">ast_cond_init</a>, <a class="el" href="../../d8/d8a/astmm_8h_source.html#l00193">ast_malloc</a>, <a class="el" href="../../dd/d42/lock_8h_source.html#l00184">ast_mutex_init</a>, <a class="el" href="../../dc/d7f/resample_8c_source.html#l00096">NULL</a>, <a class="el" href="../../d5/d60/utils_8h_source.html#l00911">RAII_VAR</a>, and <a class="el" href="../../da/dca/res__stasis__test_8c_source.html#l00039">stasis_message_sink_dtor()</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../d5/d3c/test__stasis__endpoints_8c_source.html#l00070">AST_TEST_DEFINE()</a>.</p>
<div class="fragment"><div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;{</div><div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;   <a class="code" href="../../d5/d60/utils_8h.html#a1604b4d72144dd3d9f7da668e90337e9">RAII_VAR</a>(<span class="keyword">struct</span> <a class="code" href="../../d1/db7/structstasis__message__sink.html">stasis_message_sink</a> *, sink, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../d5/da5/astobj2_8h.html#a6321ee982370c55ab3c24c72c562cbdd">ao2_cleanup</a>);</div><div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;</div><div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;   sink = <a class="code" href="../../d5/da5/astobj2_8h.html#ae0422b60d8e25b6962b2d61ae4ddf724">ao2_alloc</a>(<span class="keyword">sizeof</span>(*sink), <a class="code" href="../../da/dca/res__stasis__test_8c.html#a9aaa11026150e5bc050702005327a25d">stasis_message_sink_dtor</a>);</div><div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;   <span class="keywordflow">if</span> (!sink) {</div><div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;   }</div><div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;   <a class="code" href="../../dd/d42/lock_8h.html#a76e8ed6bb354be6c6dd9e51acc1d7a1b">ast_mutex_init</a>(&amp;sink-&gt;lock);</div><div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;   <a class="code" href="../../dd/d42/lock_8h.html#a69e9591803d36f5683eb9b084442be9b">ast_cond_init</a>(&amp;sink-&gt;cond, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div><div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;   sink-&gt;max_messages = 4;</div><div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;   sink-&gt;messages =</div><div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;      <a class="code" href="../../d8/d8a/astmm_8h.html#ae63d4f486bcf6eac7c1593f867717d91">ast_malloc</a>(<span class="keyword">sizeof</span>(*sink-&gt;messages) * sink-&gt;max_messages);</div><div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;   <span class="keywordflow">if</span> (!sink-&gt;messages) {</div><div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;   }</div><div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(sink, +1);</div><div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;   <span class="keywordflow">return</span> sink;</div><div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;}</div><div class="ttc" id="structstasis__message__sink_html"><div class="ttname"><a href="../../d1/db7/structstasis__message__sink.html">stasis_message_sink</a></div><div class="ttdoc">Structure that collects messages from a topic. </div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d31/stasis__test_8h_source.html#l00044">stasis_test.h:44</a></div></div>
<div class="ttc" id="lock_8h_html_a69e9591803d36f5683eb9b084442be9b"><div class="ttname"><a href="../../dd/d42/lock_8h.html#a69e9591803d36f5683eb9b084442be9b">ast_cond_init</a></div><div class="ttdeci">#define ast_cond_init(cond, attr)</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d42/lock_8h_source.html#l00199">lock.h:199</a></div></div>
<div class="ttc" id="resample_8c_html_a070d2ce7b6bb7e5c05602aa8c308d0c4"><div class="ttname"><a href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a></div><div class="ttdeci">#define NULL</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d7f/resample_8c_source.html#l00096">resample.c:96</a></div></div>
<div class="ttc" id="utils_8h_html_a1604b4d72144dd3d9f7da668e90337e9"><div class="ttname"><a href="../../d5/d60/utils_8h.html#a1604b4d72144dd3d9f7da668e90337e9">RAII_VAR</a></div><div class="ttdeci">#define RAII_VAR(vartype, varname, initval, dtor)</div><div class="ttdoc">Declare a variable that will call a destructor function when it goes out of scope. </div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d60/utils_8h_source.html#l00911">utils.h:911</a></div></div>
<div class="ttc" id="astobj2_8h_html_aaca5e8eac39a22f9da1c36fc6c922270"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a></div><div class="ttdeci">#define ao2_ref(o, delta)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l00464">astobj2.h:464</a></div></div>
<div class="ttc" id="astmm_8h_html_ae63d4f486bcf6eac7c1593f867717d91"><div class="ttname"><a href="../../d8/d8a/astmm_8h.html#ae63d4f486bcf6eac7c1593f867717d91">ast_malloc</a></div><div class="ttdeci">#define ast_malloc(len)</div><div class="ttdoc">A wrapper for malloc() </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d8a/astmm_8h_source.html#l00193">astmm.h:193</a></div></div>
<div class="ttc" id="res__stasis__test_8c_html_a9aaa11026150e5bc050702005327a25d"><div class="ttname"><a href="../../da/dca/res__stasis__test_8c.html#a9aaa11026150e5bc050702005327a25d">stasis_message_sink_dtor</a></div><div class="ttdeci">static void stasis_message_sink_dtor(void *obj)</div><div class="ttdef"><b>Definition:</b> <a href="../../da/dca/res__stasis__test_8c_source.html#l00039">res_stasis_test.c:39</a></div></div>
<div class="ttc" id="astobj2_8h_html_ae0422b60d8e25b6962b2d61ae4ddf724"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#ae0422b60d8e25b6962b2d61ae4ddf724">ao2_alloc</a></div><div class="ttdeci">#define ao2_alloc(data_size, destructor_fn)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l00411">astobj2.h:411</a></div></div>
<div class="ttc" id="astobj2_8h_html_a6321ee982370c55ab3c24c72c562cbdd"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#a6321ee982370c55ab3c24c72c562cbdd">ao2_cleanup</a></div><div class="ttdeci">#define ao2_cleanup(obj)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l01958">astobj2.h:1958</a></div></div>
<div class="ttc" id="lock_8h_html_a76e8ed6bb354be6c6dd9e51acc1d7a1b"><div class="ttname"><a href="../../dd/d42/lock_8h.html#a76e8ed6bb354be6c6dd9e51acc1d7a1b">ast_mutex_init</a></div><div class="ttdeci">#define ast_mutex_init(pmutex)</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d42/lock_8h_source.html#l00184">lock.h:184</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a9aaa11026150e5bc050702005327a25d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a9aaa11026150e5bc050702005327a25d">&#9670;&nbsp;</a></span>stasis_message_sink_dtor()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void stasis_message_sink_dtor </td>
          <td>(</td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>obj</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="../../da/dca/res__stasis__test_8c_source.html#l00039">39</a> of file <a class="el" href="../../da/dca/res__stasis__test_8c_source.html">res_stasis_test.c</a>.</p>

<p class="reference">References <a class="el" href="../../d5/da5/astobj2_8h_source.html#l01958">ao2_cleanup</a>, <a class="el" href="../../dd/d42/lock_8h_source.html#l00200">ast_cond_destroy</a>, <a class="el" href="../../dd/d42/lock_8h_source.html#l00203">ast_cond_wait</a>, <a class="el" href="../../d8/d8a/astmm_8h_source.html#l00182">ast_free</a>, <a class="el" href="../../dd/d42/lock_8h_source.html#l00186">ast_mutex_destroy</a>, <a class="el" href="../../d6/d31/stasis__test_8h_source.html#l00048">stasis_message_sink::cond</a>, <a class="el" href="../../d6/d31/stasis__test_8h_source.html#l00055">stasis_message_sink::is_done</a>, <a class="el" href="../../d6/d31/stasis__test_8h_source.html#l00046">stasis_message_sink::lock</a>, <a class="el" href="../../df/d44/app__meetme_8c_source.html#l01091">lock</a>, <a class="el" href="../../d6/d31/stasis__test_8h_source.html#l00051">stasis_message_sink::max_messages</a>, <a class="el" href="../../d6/d31/stasis__test_8h_source.html#l00057">stasis_message_sink::messages</a>, <a class="el" href="../../dc/d7f/resample_8c_source.html#l00096">NULL</a>, <a class="el" href="../../d6/d31/stasis__test_8h_source.html#l00053">stasis_message_sink::num_messages</a>, and <a class="el" href="../../dd/d42/lock_8h_source.html#l00587">SCOPED_MUTEX</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../da/dca/res__stasis__test_8c_source.html#l00079">stasis_message_sink_create()</a>.</p>
<div class="fragment"><div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;{</div><div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d1/db7/structstasis__message__sink.html">stasis_message_sink</a> *sink = obj;</div><div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;</div><div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;   {</div><div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;      <a class="code" href="../../dd/d42/lock_8h.html#ab13590ad27fac3b9c7c7b792c603c9b3">SCOPED_MUTEX</a>(<a class="code" href="../../df/d44/app__meetme_8c.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>, &amp;sink-&gt;<a class="code" href="../../d1/db7/structstasis__message__sink.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);</div><div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;      <span class="keywordflow">while</span> (!sink-&gt;<a class="code" href="../../d1/db7/structstasis__message__sink.html#a31ea9139740eed42579595bee74e6d70">is_done</a>) {</div><div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;         <span class="comment">/* Normally waiting forever is bad, but if we&#39;re not</span></div><div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;<span class="comment">          * done, we&#39;re not done. */</span></div><div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;         <a class="code" href="../../dd/d42/lock_8h.html#a36233c5520173c095bf732a788356aee">ast_cond_wait</a>(&amp;sink-&gt;<a class="code" href="../../d1/db7/structstasis__message__sink.html#a1c7181c39f99ee801943a0d0aa9872b9">cond</a>, &amp;sink-&gt;<a class="code" href="../../d1/db7/structstasis__message__sink.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);</div><div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;      }</div><div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;   }</div><div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;</div><div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;   <a class="code" href="../../dd/d42/lock_8h.html#ab8977a71822daa556f19f30ba6eec765">ast_mutex_destroy</a>(&amp;sink-&gt;<a class="code" href="../../d1/db7/structstasis__message__sink.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);</div><div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;   <a class="code" href="../../dd/d42/lock_8h.html#a1ea2f4040a736cddbecea48b30ffedfd">ast_cond_destroy</a>(&amp;sink-&gt;<a class="code" href="../../d1/db7/structstasis__message__sink.html#a1c7181c39f99ee801943a0d0aa9872b9">cond</a>);</div><div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;</div><div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;   <span class="keywordflow">while</span> (sink-&gt;<a class="code" href="../../d1/db7/structstasis__message__sink.html#ab011c00a1ee07d6bccad0127c0130dd5">num_messages</a> &gt; 0) {</div><div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;      <a class="code" href="../../d5/da5/astobj2_8h.html#a6321ee982370c55ab3c24c72c562cbdd">ao2_cleanup</a>(sink-&gt;<a class="code" href="../../d1/db7/structstasis__message__sink.html#a7657d3ac0a1e4b72fd1f8db2e0cc56cb">messages</a>[--sink-&gt;<a class="code" href="../../d1/db7/structstasis__message__sink.html#ab011c00a1ee07d6bccad0127c0130dd5">num_messages</a>]);</div><div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;   }</div><div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;   <a class="code" href="../../d8/d8a/astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(sink-&gt;<a class="code" href="../../d1/db7/structstasis__message__sink.html#a7657d3ac0a1e4b72fd1f8db2e0cc56cb">messages</a>);</div><div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;   sink-&gt;<a class="code" href="../../d1/db7/structstasis__message__sink.html#a7657d3ac0a1e4b72fd1f8db2e0cc56cb">messages</a> = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;   sink-&gt;<a class="code" href="../../d1/db7/structstasis__message__sink.html#ac6bb1ec8624b81cd62e5307e3c50dcf9">max_messages</a> = 0;</div><div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;}</div><div class="ttc" id="structstasis__message__sink_html"><div class="ttname"><a href="../../d1/db7/structstasis__message__sink.html">stasis_message_sink</a></div><div class="ttdoc">Structure that collects messages from a topic. </div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d31/stasis__test_8h_source.html#l00044">stasis_test.h:44</a></div></div>
<div class="ttc" id="structstasis__message__sink_html_a7657d3ac0a1e4b72fd1f8db2e0cc56cb"><div class="ttname"><a href="../../d1/db7/structstasis__message__sink.html#a7657d3ac0a1e4b72fd1f8db2e0cc56cb">stasis_message_sink::messages</a></div><div class="ttdeci">struct stasis_message ** messages</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d31/stasis__test_8h_source.html#l00057">stasis_test.h:57</a></div></div>
<div class="ttc" id="lock_8h_html_a36233c5520173c095bf732a788356aee"><div class="ttname"><a href="../../dd/d42/lock_8h.html#a36233c5520173c095bf732a788356aee">ast_cond_wait</a></div><div class="ttdeci">#define ast_cond_wait(cond, mutex)</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d42/lock_8h_source.html#l00203">lock.h:203</a></div></div>
<div class="ttc" id="resample_8c_html_a070d2ce7b6bb7e5c05602aa8c308d0c4"><div class="ttname"><a href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a></div><div class="ttdeci">#define NULL</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d7f/resample_8c_source.html#l00096">resample.c:96</a></div></div>
<div class="ttc" id="structstasis__message__sink_html_a1c7181c39f99ee801943a0d0aa9872b9"><div class="ttname"><a href="../../d1/db7/structstasis__message__sink.html#a1c7181c39f99ee801943a0d0aa9872b9">stasis_message_sink::cond</a></div><div class="ttdeci">ast_cond_t cond</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d31/stasis__test_8h_source.html#l00048">stasis_test.h:48</a></div></div>
<div class="ttc" id="structstasis__message__sink_html_ac6bb1ec8624b81cd62e5307e3c50dcf9"><div class="ttname"><a href="../../d1/db7/structstasis__message__sink.html#ac6bb1ec8624b81cd62e5307e3c50dcf9">stasis_message_sink::max_messages</a></div><div class="ttdeci">size_t max_messages</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d31/stasis__test_8h_source.html#l00051">stasis_test.h:51</a></div></div>
<div class="ttc" id="lock_8h_html_ab13590ad27fac3b9c7c7b792c603c9b3"><div class="ttname"><a href="../../dd/d42/lock_8h.html#ab13590ad27fac3b9c7c7b792c603c9b3">SCOPED_MUTEX</a></div><div class="ttdeci">#define SCOPED_MUTEX(varname, lock)</div><div class="ttdoc">scoped lock specialization for mutexes </div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d42/lock_8h_source.html#l00587">lock.h:587</a></div></div>
<div class="ttc" id="structstasis__message__sink_html_ab011c00a1ee07d6bccad0127c0130dd5"><div class="ttname"><a href="../../d1/db7/structstasis__message__sink.html#ab011c00a1ee07d6bccad0127c0130dd5">stasis_message_sink::num_messages</a></div><div class="ttdeci">size_t num_messages</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d31/stasis__test_8h_source.html#l00053">stasis_test.h:53</a></div></div>
<div class="ttc" id="app__meetme_8c_html_adf04f66344e3fb0a6f6a69bf39d19902"><div class="ttname"><a href="../../df/d44/app__meetme_8c.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a></div><div class="ttdeci">ast_mutex_t lock</div><div class="ttdef"><b>Definition:</b> <a href="../../df/d44/app__meetme_8c_source.html#l01091">app_meetme.c:1091</a></div></div>
<div class="ttc" id="lock_8h_html_a1ea2f4040a736cddbecea48b30ffedfd"><div class="ttname"><a href="../../dd/d42/lock_8h.html#a1ea2f4040a736cddbecea48b30ffedfd">ast_cond_destroy</a></div><div class="ttdeci">#define ast_cond_destroy(cond)</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d42/lock_8h_source.html#l00200">lock.h:200</a></div></div>
<div class="ttc" id="astmm_8h_html_a402072d6789f6ed9e3a81da27504127e"><div class="ttname"><a href="../../d8/d8a/astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a></div><div class="ttdeci">#define ast_free(a)</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d8a/astmm_8h_source.html#l00182">astmm.h:182</a></div></div>
<div class="ttc" id="structstasis__message__sink_html_adf04f66344e3fb0a6f6a69bf39d19902"><div class="ttname"><a href="../../d1/db7/structstasis__message__sink.html#adf04f66344e3fb0a6f6a69bf39d19902">stasis_message_sink::lock</a></div><div class="ttdeci">ast_mutex_t lock</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d31/stasis__test_8h_source.html#l00046">stasis_test.h:46</a></div></div>
<div class="ttc" id="astobj2_8h_html_a6321ee982370c55ab3c24c72c562cbdd"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#a6321ee982370c55ab3c24c72c562cbdd">ao2_cleanup</a></div><div class="ttdeci">#define ao2_cleanup(obj)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l01958">astobj2.h:1958</a></div></div>
<div class="ttc" id="structstasis__message__sink_html_a31ea9139740eed42579595bee74e6d70"><div class="ttname"><a href="../../d1/db7/structstasis__message__sink.html#a31ea9139740eed42579595bee74e6d70">stasis_message_sink::is_done</a></div><div class="ttdeci">int is_done</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d31/stasis__test_8h_source.html#l00055">stasis_test.h:55</a></div></div>
<div class="ttc" id="lock_8h_html_ab8977a71822daa556f19f30ba6eec765"><div class="ttname"><a href="../../dd/d42/lock_8h.html#ab8977a71822daa556f19f30ba6eec765">ast_mutex_destroy</a></div><div class="ttdeci">#define ast_mutex_destroy(a)</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d42/lock_8h_source.html#l00186">lock.h:186</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a0bcb44162d4355ad60ec420b1cef2cb7"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0bcb44162d4355ad60ec420b1cef2cb7">&#9670;&nbsp;</a></span>stasis_message_sink_should_stay()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int stasis_message_sink_should_stay </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="../../d1/db7/structstasis__message__sink.html">stasis_message_sink</a> *&#160;</td>
          <td class="paramname"><em>sink</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>num_messages</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>timeout_millis</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Ensures that no new messages are received. </p>
<p>The optional timeout prevents complete deadlock in a test.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">sink</td><td>Sink to wait on. </td></tr>
    <tr><td class="paramname">num_messages</td><td>expecte <em>sink-&gt;num_messages</em>. </td></tr>
    <tr><td class="paramname">timeout_millis</td><td>Number of milliseconds to wait for. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>Actual sink-&gt;num_messages value at return. If this is &lt; <em>num_messages</em>, then the timeout expired. </dd></dl>

<p class="definition">Definition at line <a class="el" href="../../da/dca/res__stasis__test_8c_source.html#l00170">170</a> of file <a class="el" href="../../da/dca/res__stasis__test_8c_source.html">res_stasis_test.c</a>.</p>

<p class="reference">References <a class="el" href="../../dd/d42/lock_8h_source.html#l00204">ast_cond_timedwait</a>, <a class="el" href="../../da/df7/astobj2_8c_source.html#l00042">ast_log</a>, <a class="el" href="../../d6/d31/stasis__test_8h_source.html#l00048">stasis_message_sink::cond</a>, <a class="el" href="../../d6/d31/stasis__test_8h_source.html#l00046">stasis_message_sink::lock</a>, <a class="el" href="../../df/d44/app__meetme_8c_source.html#l01091">lock</a>, <a class="el" href="../../d1/d8c/logger_8h_source.html#l00285">LOG_ERROR</a>, <a class="el" href="../../da/dca/res__stasis__test_8c_source.html#l00063">make_deadline()</a>, <a class="el" href="../../d6/d31/stasis__test_8h_source.html#l00053">stasis_message_sink::num_messages</a>, and <a class="el" href="../../dd/d42/lock_8h_source.html#l00587">SCOPED_MUTEX</a>.</p>
<div class="fragment"><div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;{</div><div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;   <span class="keyword">struct </span>timespec deadline = <a class="code" href="../../da/dca/res__stasis__test_8c.html#a697ee0eea34570cb67e9b4ab805e03c9">make_deadline</a>(timeout_millis);</div><div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;</div><div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;   <a class="code" href="../../dd/d42/lock_8h.html#ab13590ad27fac3b9c7c7b792c603c9b3">SCOPED_MUTEX</a>(<a class="code" href="../../df/d44/app__meetme_8c.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>, &amp;sink-&gt;<a class="code" href="../../d1/db7/structstasis__message__sink.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);</div><div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;   <span class="keywordflow">while</span> (sink-&gt;<a class="code" href="../../d1/db7/structstasis__message__sink.html#ab011c00a1ee07d6bccad0127c0130dd5">num_messages</a> == num_messages) {</div><div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;      <span class="keywordtype">int</span> r = <a class="code" href="../../dd/d42/lock_8h.html#a6add1f30b2d53ca9384b15529a6f126e">ast_cond_timedwait</a>(&amp;sink-&gt;<a class="code" href="../../d1/db7/structstasis__message__sink.html#a1c7181c39f99ee801943a0d0aa9872b9">cond</a>, &amp;sink-&gt;<a class="code" href="../../d1/db7/structstasis__message__sink.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>, &amp;deadline);</div><div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;</div><div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;      <span class="keywordflow">if</span> (r == ETIMEDOUT) {</div><div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;         <span class="keywordflow">break</span>;</div><div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;      }</div><div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;      <span class="keywordflow">if</span> (r != 0) {</div><div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;         <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Unexpected condition error: %s\n&quot;</span>,</div><div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;            strerror(r));</div><div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;         <span class="keywordflow">break</span>;</div><div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;      }</div><div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;   }</div><div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;   <span class="keywordflow">return</span> sink-&gt;<a class="code" href="../../d1/db7/structstasis__message__sink.html#ab011c00a1ee07d6bccad0127c0130dd5">num_messages</a>;</div><div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;}</div><div class="ttc" id="structstasis__message__sink_html_a1c7181c39f99ee801943a0d0aa9872b9"><div class="ttname"><a href="../../d1/db7/structstasis__message__sink.html#a1c7181c39f99ee801943a0d0aa9872b9">stasis_message_sink::cond</a></div><div class="ttdeci">ast_cond_t cond</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d31/stasis__test_8h_source.html#l00048">stasis_test.h:48</a></div></div>
<div class="ttc" id="astobj2_8c_html_a96a00b3a518d7f32b6d51dc28f09bf9b"><div class="ttname"><a href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a></div><div class="ttdeci">#define ast_log</div><div class="ttdef"><b>Definition:</b> <a href="../../da/df7/astobj2_8c_source.html#l00042">astobj2.c:42</a></div></div>
<div class="ttc" id="lock_8h_html_ab13590ad27fac3b9c7c7b792c603c9b3"><div class="ttname"><a href="../../dd/d42/lock_8h.html#ab13590ad27fac3b9c7c7b792c603c9b3">SCOPED_MUTEX</a></div><div class="ttdeci">#define SCOPED_MUTEX(varname, lock)</div><div class="ttdoc">scoped lock specialization for mutexes </div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d42/lock_8h_source.html#l00587">lock.h:587</a></div></div>
<div class="ttc" id="structstasis__message__sink_html_ab011c00a1ee07d6bccad0127c0130dd5"><div class="ttname"><a href="../../d1/db7/structstasis__message__sink.html#ab011c00a1ee07d6bccad0127c0130dd5">stasis_message_sink::num_messages</a></div><div class="ttdeci">size_t num_messages</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d31/stasis__test_8h_source.html#l00053">stasis_test.h:53</a></div></div>
<div class="ttc" id="app__meetme_8c_html_adf04f66344e3fb0a6f6a69bf39d19902"><div class="ttname"><a href="../../df/d44/app__meetme_8c.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a></div><div class="ttdeci">ast_mutex_t lock</div><div class="ttdef"><b>Definition:</b> <a href="../../df/d44/app__meetme_8c_source.html#l01091">app_meetme.c:1091</a></div></div>
<div class="ttc" id="logger_8h_html_aced66975c154ea0e2a8ec3bc818b4e08"><div class="ttname"><a href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a></div><div class="ttdeci">#define LOG_ERROR</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d8c/logger_8h_source.html#l00285">logger.h:285</a></div></div>
<div class="ttc" id="res__stasis__test_8c_html_a697ee0eea34570cb67e9b4ab805e03c9"><div class="ttname"><a href="../../da/dca/res__stasis__test_8c.html#a697ee0eea34570cb67e9b4ab805e03c9">make_deadline</a></div><div class="ttdeci">static struct timespec make_deadline(int timeout_millis)</div><div class="ttdef"><b>Definition:</b> <a href="../../da/dca/res__stasis__test_8c_source.html#l00063">res_stasis_test.c:63</a></div></div>
<div class="ttc" id="structstasis__message__sink_html_adf04f66344e3fb0a6f6a69bf39d19902"><div class="ttname"><a href="../../d1/db7/structstasis__message__sink.html#adf04f66344e3fb0a6f6a69bf39d19902">stasis_message_sink::lock</a></div><div class="ttdeci">ast_mutex_t lock</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d31/stasis__test_8h_source.html#l00046">stasis_test.h:46</a></div></div>
<div class="ttc" id="lock_8h_html_a6add1f30b2d53ca9384b15529a6f126e"><div class="ttname"><a href="../../dd/d42/lock_8h.html#a6add1f30b2d53ca9384b15529a6f126e">ast_cond_timedwait</a></div><div class="ttdeci">#define ast_cond_timedwait(cond, mutex, time)</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d42/lock_8h_source.html#l00204">lock.h:204</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="ab3d88a9f84cee5cc16fbab577bbeeeaa"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab3d88a9f84cee5cc16fbab577bbeeeaa">&#9670;&nbsp;</a></span>stasis_message_sink_wait_for()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int stasis_message_sink_wait_for </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="../../d1/db7/structstasis__message__sink.html">stasis_message_sink</a> *&#160;</td>
          <td class="paramname"><em>sink</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>start</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../d6/d31/stasis__test_8h.html#a2ff062ff74f4e2e0b3d2d616a0809321">stasis_wait_cb</a>&#160;</td>
          <td class="paramname"><em>cmp_cb</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const void *&#160;</td>
          <td class="paramname"><em>data</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>timeout_millis</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Wait for a message that matches the given criteria. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">sink</td><td>Sink to wait on. </td></tr>
    <tr><td class="paramname">start</td><td>Index of message to start with. </td></tr>
    <tr><td class="paramname">cmp_cb</td><td>comparison function. This returns true (non-zero) on match and false (zero) on match. </td></tr>
    <tr><td class="paramname">timeout_millis</td><td>Number of milliseconds to wait. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>Index of the matching message. </dd>
<dd>
Negative for no match. </dd></dl>

<p class="definition">Definition at line <a class="el" href="../../da/dca/res__stasis__test_8c_source.html#l00191">191</a> of file <a class="el" href="../../da/dca/res__stasis__test_8c_source.html">res_stasis_test.c</a>.</p>

<p class="reference">References <a class="el" href="../../dd/d42/lock_8h_source.html#l00204">ast_cond_timedwait</a>, <a class="el" href="../../da/df7/astobj2_8c_source.html#l00042">ast_log</a>, <a class="el" href="../../d6/d31/stasis__test_8h_source.html#l00048">stasis_message_sink::cond</a>, <a class="el" href="../../d6/d31/stasis__test_8h_source.html#l00046">stasis_message_sink::lock</a>, <a class="el" href="../../df/d44/app__meetme_8c_source.html#l01091">lock</a>, <a class="el" href="../../d1/d8c/logger_8h_source.html#l00285">LOG_ERROR</a>, <a class="el" href="../../da/dca/res__stasis__test_8c_source.html#l00063">make_deadline()</a>, <a class="el" href="../../d6/d31/stasis__test_8h_source.html#l00057">stasis_message_sink::messages</a>, <a class="el" href="../../d6/d31/stasis__test_8h_source.html#l00053">stasis_message_sink::num_messages</a>, and <a class="el" href="../../dd/d42/lock_8h_source.html#l00587">SCOPED_MUTEX</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../d5/d3c/test__stasis__endpoints_8c_source.html#l00126">AST_TEST_DEFINE()</a>.</p>
<div class="fragment"><div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;{</div><div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;   <span class="keyword">struct </span>timespec deadline = <a class="code" href="../../da/dca/res__stasis__test_8c.html#a697ee0eea34570cb67e9b4ab805e03c9">make_deadline</a>(timeout_millis);</div><div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;</div><div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;   <a class="code" href="../../dd/d42/lock_8h.html#ab13590ad27fac3b9c7c7b792c603c9b3">SCOPED_MUTEX</a>(<a class="code" href="../../df/d44/app__meetme_8c.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>, &amp;sink-&gt;<a class="code" href="../../d1/db7/structstasis__message__sink.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);</div><div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;</div><div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;   <span class="comment">/* wait for the start */</span></div><div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;   <span class="keywordflow">while</span> (sink-&gt;<a class="code" href="../../d1/db7/structstasis__message__sink.html#ab011c00a1ee07d6bccad0127c0130dd5">num_messages</a> &lt; start + 1) {</div><div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;      <span class="keywordtype">int</span> r = <a class="code" href="../../dd/d42/lock_8h.html#a6add1f30b2d53ca9384b15529a6f126e">ast_cond_timedwait</a>(&amp;sink-&gt;<a class="code" href="../../d1/db7/structstasis__message__sink.html#a1c7181c39f99ee801943a0d0aa9872b9">cond</a>, &amp;sink-&gt;<a class="code" href="../../d1/db7/structstasis__message__sink.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>, &amp;deadline);</div><div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;</div><div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;      <span class="keywordflow">if</span> (r == ETIMEDOUT) {</div><div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;         <span class="comment">/* Timed out waiting for the start */</span></div><div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;         <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;      }</div><div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;      <span class="keywordflow">if</span> (r != 0) {</div><div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;         <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Unexpected condition error: %s\n&quot;</span>,</div><div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;            strerror(r));</div><div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;         <span class="keywordflow">return</span> -2;</div><div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;      }</div><div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;   }</div><div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;</div><div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;</div><div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;   <span class="keywordflow">while</span> (!cmp_cb(sink-&gt;<a class="code" href="../../d1/db7/structstasis__message__sink.html#a7657d3ac0a1e4b72fd1f8db2e0cc56cb">messages</a>[start], data)) {</div><div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;      ++start;</div><div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;</div><div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;      <span class="keywordflow">while</span> (sink-&gt;<a class="code" href="../../d1/db7/structstasis__message__sink.html#ab011c00a1ee07d6bccad0127c0130dd5">num_messages</a> &lt; start + 1) {</div><div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;         <span class="keywordtype">int</span> r = <a class="code" href="../../dd/d42/lock_8h.html#a6add1f30b2d53ca9384b15529a6f126e">ast_cond_timedwait</a>(&amp;sink-&gt;<a class="code" href="../../d1/db7/structstasis__message__sink.html#a1c7181c39f99ee801943a0d0aa9872b9">cond</a>,</div><div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;            &amp;sink-&gt;<a class="code" href="../../d1/db7/structstasis__message__sink.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>, &amp;deadline);</div><div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;</div><div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;         <span class="keywordflow">if</span> (r == ETIMEDOUT) {</div><div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;            <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;         }</div><div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;         <span class="keywordflow">if</span> (r != 0) {</div><div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;            <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>,</div><div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;               <span class="stringliteral">&quot;Unexpected condition error: %s\n&quot;</span>,</div><div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;               strerror(r));</div><div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;            <span class="keywordflow">return</span> -2;</div><div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;         }</div><div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;      }</div><div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;   }</div><div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;</div><div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;   <span class="keywordflow">return</span> start;</div><div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;}</div><div class="ttc" id="structstasis__message__sink_html_a7657d3ac0a1e4b72fd1f8db2e0cc56cb"><div class="ttname"><a href="../../d1/db7/structstasis__message__sink.html#a7657d3ac0a1e4b72fd1f8db2e0cc56cb">stasis_message_sink::messages</a></div><div class="ttdeci">struct stasis_message ** messages</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d31/stasis__test_8h_source.html#l00057">stasis_test.h:57</a></div></div>
<div class="ttc" id="structstasis__message__sink_html_a1c7181c39f99ee801943a0d0aa9872b9"><div class="ttname"><a href="../../d1/db7/structstasis__message__sink.html#a1c7181c39f99ee801943a0d0aa9872b9">stasis_message_sink::cond</a></div><div class="ttdeci">ast_cond_t cond</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d31/stasis__test_8h_source.html#l00048">stasis_test.h:48</a></div></div>
<div class="ttc" id="astobj2_8c_html_a96a00b3a518d7f32b6d51dc28f09bf9b"><div class="ttname"><a href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a></div><div class="ttdeci">#define ast_log</div><div class="ttdef"><b>Definition:</b> <a href="../../da/df7/astobj2_8c_source.html#l00042">astobj2.c:42</a></div></div>
<div class="ttc" id="lock_8h_html_ab13590ad27fac3b9c7c7b792c603c9b3"><div class="ttname"><a href="../../dd/d42/lock_8h.html#ab13590ad27fac3b9c7c7b792c603c9b3">SCOPED_MUTEX</a></div><div class="ttdeci">#define SCOPED_MUTEX(varname, lock)</div><div class="ttdoc">scoped lock specialization for mutexes </div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d42/lock_8h_source.html#l00587">lock.h:587</a></div></div>
<div class="ttc" id="structstasis__message__sink_html_ab011c00a1ee07d6bccad0127c0130dd5"><div class="ttname"><a href="../../d1/db7/structstasis__message__sink.html#ab011c00a1ee07d6bccad0127c0130dd5">stasis_message_sink::num_messages</a></div><div class="ttdeci">size_t num_messages</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d31/stasis__test_8h_source.html#l00053">stasis_test.h:53</a></div></div>
<div class="ttc" id="app__meetme_8c_html_adf04f66344e3fb0a6f6a69bf39d19902"><div class="ttname"><a href="../../df/d44/app__meetme_8c.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a></div><div class="ttdeci">ast_mutex_t lock</div><div class="ttdef"><b>Definition:</b> <a href="../../df/d44/app__meetme_8c_source.html#l01091">app_meetme.c:1091</a></div></div>
<div class="ttc" id="logger_8h_html_aced66975c154ea0e2a8ec3bc818b4e08"><div class="ttname"><a href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a></div><div class="ttdeci">#define LOG_ERROR</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d8c/logger_8h_source.html#l00285">logger.h:285</a></div></div>
<div class="ttc" id="res__stasis__test_8c_html_a697ee0eea34570cb67e9b4ab805e03c9"><div class="ttname"><a href="../../da/dca/res__stasis__test_8c.html#a697ee0eea34570cb67e9b4ab805e03c9">make_deadline</a></div><div class="ttdeci">static struct timespec make_deadline(int timeout_millis)</div><div class="ttdef"><b>Definition:</b> <a href="../../da/dca/res__stasis__test_8c_source.html#l00063">res_stasis_test.c:63</a></div></div>
<div class="ttc" id="structstasis__message__sink_html_adf04f66344e3fb0a6f6a69bf39d19902"><div class="ttname"><a href="../../d1/db7/structstasis__message__sink.html#adf04f66344e3fb0a6f6a69bf39d19902">stasis_message_sink::lock</a></div><div class="ttdeci">ast_mutex_t lock</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d31/stasis__test_8h_source.html#l00046">stasis_test.h:46</a></div></div>
<div class="ttc" id="lock_8h_html_a6add1f30b2d53ca9384b15529a6f126e"><div class="ttname"><a href="../../dd/d42/lock_8h.html#a6add1f30b2d53ca9384b15529a6f126e">ast_cond_timedwait</a></div><div class="ttdeci">#define ast_cond_timedwait(cond, mutex, time)</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d42/lock_8h_source.html#l00204">lock.h:204</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="aa22cd15a52dfd21c087bc817c2e5845d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa22cd15a52dfd21c087bc817c2e5845d">&#9670;&nbsp;</a></span>stasis_message_sink_wait_for_count()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int stasis_message_sink_wait_for_count </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="../../d1/db7/structstasis__message__sink.html">stasis_message_sink</a> *&#160;</td>
          <td class="paramname"><em>sink</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>num_messages</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>timeout_millis</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Wait for a sink's num_messages field to reach a certain level. </p>
<p>The optional timeout prevents complete deadlock in a test.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">sink</td><td>Sink to wait on. </td></tr>
    <tr><td class="paramname">num_messages</td><td>sink-&gt;num_messages value to wait for. </td></tr>
    <tr><td class="paramname">timeout_millis</td><td>Number of milliseconds to wait. -1 to wait forever. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>Actual sink-&gt;num_messages value at return. If this is &lt; <em>num_messages</em>, then the timeout expired. </dd></dl>

<p class="definition">Definition at line <a class="el" href="../../da/dca/res__stasis__test_8c_source.html#l00149">149</a> of file <a class="el" href="../../da/dca/res__stasis__test_8c_source.html">res_stasis_test.c</a>.</p>

<p class="reference">References <a class="el" href="../../dd/d42/lock_8h_source.html#l00204">ast_cond_timedwait</a>, <a class="el" href="../../da/df7/astobj2_8c_source.html#l00042">ast_log</a>, <a class="el" href="../../d6/d31/stasis__test_8h_source.html#l00048">stasis_message_sink::cond</a>, <a class="el" href="../../d6/d31/stasis__test_8h_source.html#l00046">stasis_message_sink::lock</a>, <a class="el" href="../../df/d44/app__meetme_8c_source.html#l01091">lock</a>, <a class="el" href="../../d1/d8c/logger_8h_source.html#l00285">LOG_ERROR</a>, <a class="el" href="../../da/dca/res__stasis__test_8c_source.html#l00063">make_deadline()</a>, <a class="el" href="../../d6/d31/stasis__test_8h_source.html#l00053">stasis_message_sink::num_messages</a>, and <a class="el" href="../../dd/d42/lock_8h_source.html#l00587">SCOPED_MUTEX</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../d5/d3c/test__stasis__endpoints_8c_source.html#l00070">AST_TEST_DEFINE()</a>.</p>
<div class="fragment"><div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;{</div><div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;   <span class="keyword">struct </span>timespec deadline = <a class="code" href="../../da/dca/res__stasis__test_8c.html#a697ee0eea34570cb67e9b4ab805e03c9">make_deadline</a>(timeout_millis);</div><div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;</div><div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;   <a class="code" href="../../dd/d42/lock_8h.html#ab13590ad27fac3b9c7c7b792c603c9b3">SCOPED_MUTEX</a>(<a class="code" href="../../df/d44/app__meetme_8c.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>, &amp;sink-&gt;<a class="code" href="../../d1/db7/structstasis__message__sink.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);</div><div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;   <span class="keywordflow">while</span> (sink-&gt;<a class="code" href="../../d1/db7/structstasis__message__sink.html#ab011c00a1ee07d6bccad0127c0130dd5">num_messages</a> &lt; num_messages) {</div><div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;      <span class="keywordtype">int</span> r = <a class="code" href="../../dd/d42/lock_8h.html#a6add1f30b2d53ca9384b15529a6f126e">ast_cond_timedwait</a>(&amp;sink-&gt;<a class="code" href="../../d1/db7/structstasis__message__sink.html#a1c7181c39f99ee801943a0d0aa9872b9">cond</a>, &amp;sink-&gt;<a class="code" href="../../d1/db7/structstasis__message__sink.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>, &amp;deadline);</div><div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;</div><div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;      <span class="keywordflow">if</span> (r == ETIMEDOUT) {</div><div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;         <span class="keywordflow">break</span>;</div><div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;      }</div><div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;      <span class="keywordflow">if</span> (r != 0) {</div><div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;         <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Unexpected condition error: %s\n&quot;</span>,</div><div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;            strerror(r));</div><div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;         <span class="keywordflow">break</span>;</div><div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;      }</div><div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;   }</div><div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;   <span class="keywordflow">return</span> sink-&gt;<a class="code" href="../../d1/db7/structstasis__message__sink.html#ab011c00a1ee07d6bccad0127c0130dd5">num_messages</a>;</div><div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;}</div><div class="ttc" id="structstasis__message__sink_html_a1c7181c39f99ee801943a0d0aa9872b9"><div class="ttname"><a href="../../d1/db7/structstasis__message__sink.html#a1c7181c39f99ee801943a0d0aa9872b9">stasis_message_sink::cond</a></div><div class="ttdeci">ast_cond_t cond</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d31/stasis__test_8h_source.html#l00048">stasis_test.h:48</a></div></div>
<div class="ttc" id="astobj2_8c_html_a96a00b3a518d7f32b6d51dc28f09bf9b"><div class="ttname"><a href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a></div><div class="ttdeci">#define ast_log</div><div class="ttdef"><b>Definition:</b> <a href="../../da/df7/astobj2_8c_source.html#l00042">astobj2.c:42</a></div></div>
<div class="ttc" id="lock_8h_html_ab13590ad27fac3b9c7c7b792c603c9b3"><div class="ttname"><a href="../../dd/d42/lock_8h.html#ab13590ad27fac3b9c7c7b792c603c9b3">SCOPED_MUTEX</a></div><div class="ttdeci">#define SCOPED_MUTEX(varname, lock)</div><div class="ttdoc">scoped lock specialization for mutexes </div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d42/lock_8h_source.html#l00587">lock.h:587</a></div></div>
<div class="ttc" id="structstasis__message__sink_html_ab011c00a1ee07d6bccad0127c0130dd5"><div class="ttname"><a href="../../d1/db7/structstasis__message__sink.html#ab011c00a1ee07d6bccad0127c0130dd5">stasis_message_sink::num_messages</a></div><div class="ttdeci">size_t num_messages</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d31/stasis__test_8h_source.html#l00053">stasis_test.h:53</a></div></div>
<div class="ttc" id="app__meetme_8c_html_adf04f66344e3fb0a6f6a69bf39d19902"><div class="ttname"><a href="../../df/d44/app__meetme_8c.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a></div><div class="ttdeci">ast_mutex_t lock</div><div class="ttdef"><b>Definition:</b> <a href="../../df/d44/app__meetme_8c_source.html#l01091">app_meetme.c:1091</a></div></div>
<div class="ttc" id="logger_8h_html_aced66975c154ea0e2a8ec3bc818b4e08"><div class="ttname"><a href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a></div><div class="ttdeci">#define LOG_ERROR</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d8c/logger_8h_source.html#l00285">logger.h:285</a></div></div>
<div class="ttc" id="res__stasis__test_8c_html_a697ee0eea34570cb67e9b4ab805e03c9"><div class="ttname"><a href="../../da/dca/res__stasis__test_8c.html#a697ee0eea34570cb67e9b4ab805e03c9">make_deadline</a></div><div class="ttdeci">static struct timespec make_deadline(int timeout_millis)</div><div class="ttdef"><b>Definition:</b> <a href="../../da/dca/res__stasis__test_8c_source.html#l00063">res_stasis_test.c:63</a></div></div>
<div class="ttc" id="structstasis__message__sink_html_adf04f66344e3fb0a6f6a69bf39d19902"><div class="ttname"><a href="../../d1/db7/structstasis__message__sink.html#adf04f66344e3fb0a6f6a69bf39d19902">stasis_message_sink::lock</a></div><div class="ttdeci">ast_mutex_t lock</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d31/stasis__test_8h_source.html#l00046">stasis_test.h:46</a></div></div>
<div class="ttc" id="lock_8h_html_a6add1f30b2d53ca9384b15529a6f126e"><div class="ttname"><a href="../../dd/d42/lock_8h.html#a6add1f30b2d53ca9384b15529a6f126e">ast_cond_timedwait</a></div><div class="ttdeci">#define ast_cond_timedwait(cond, mutex, time)</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d42/lock_8h_source.html#l00204">lock.h:204</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a9b1cfb22818f3b27fb9e95c008a40e61"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a9b1cfb22818f3b27fb9e95c008a40e61">&#9670;&nbsp;</a></span>STASIS_MESSAGE_TYPE_DEFN()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">STASIS_MESSAGE_TYPE_DEFN </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="../../df/deb/group__StasisTopicsAndMessages.html#gaa0a46c6b720362854b798adef799ce78">stasis_test_message_type</a>&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="ad09fa931f468002152a3cc2d5ce25eae"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad09fa931f468002152a3cc2d5ce25eae">&#9670;&nbsp;</a></span>unload_module()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int unload_module </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="../../da/dca/res__stasis__test_8c_source.html#l00253">253</a> of file <a class="el" href="../../da/dca/res__stasis__test_8c_source.html">res_stasis_test.c</a>.</p>

<p class="reference">References <a class="el" href="../../dd/d79/stasis_8h_source.html#l01523">STASIS_MESSAGE_TYPE_CLEANUP</a>, and <a class="el" href="../../df/deb/group__StasisTopicsAndMessages.html#gaa0a46c6b720362854b798adef799ce78">stasis_test_message_type()</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../da/dca/res__stasis__test_8c_source.html#l00259">load_module()</a>.</p>
<div class="fragment"><div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;{</div><div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;   <a class="code" href="../../dd/d79/stasis_8h.html#a31197e193b1dfd6c122ff6d7c7f6b3fa">STASIS_MESSAGE_TYPE_CLEANUP</a>(<a class="code" href="../../df/deb/group__StasisTopicsAndMessages.html#gaa0a46c6b720362854b798adef799ce78">stasis_test_message_type</a>);</div><div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;   <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;}</div><div class="ttc" id="group__StasisTopicsAndMessages_html_gaa0a46c6b720362854b798adef799ce78"><div class="ttname"><a href="../../df/deb/group__StasisTopicsAndMessages.html#gaa0a46c6b720362854b798adef799ce78">stasis_test_message_type</a></div><div class="ttdeci">struct stasis_message_type * stasis_test_message_type(void)</div><div class="ttdoc">Gets the type of messages created by stasis_test_message_create(). </div></div>
<div class="ttc" id="stasis_8h_html_a31197e193b1dfd6c122ff6d7c7f6b3fa"><div class="ttname"><a href="../../dd/d79/stasis_8h.html#a31197e193b1dfd6c122ff6d7c7f6b3fa">STASIS_MESSAGE_TYPE_CLEANUP</a></div><div class="ttdeci">#define STASIS_MESSAGE_TYPE_CLEANUP(name)</div><div class="ttdoc">Boiler-plate messaging macro for cleaning up message types. </div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d79/stasis_8h_source.html#l01523">stasis.h:1523</a></div></div>
</div><!-- fragment -->
</div>
</div>
<h2 class="groupheader">Variable Documentation</h2>
<a id="ab22f32016155f7f403e7178767163d7d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab22f32016155f7f403e7178767163d7d">&#9670;&nbsp;</a></span>__mod_info</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="../../dd/d5f/structast__module__info.html">ast_module_info</a> __mod_info = { .<a class="el" href="../../d1/da4/res__corosync_8c.html#a8f8f80d37794cde9472343e4487ba3eb">name</a> = <a class="el" href="../../da/ddd/named__acl_8c.html#aec23fc5034c3bb08140fc021f4955877">AST_MODULE</a>, .flags = <a class="el" href="../../d5/d16/module_8h.html#a155a0df9c59e04e305d4a2fa3e35f843a835b27a90d895a488e4e14cc3d2dee8c">AST_MODFLAG_GLOBAL_SYMBOLS</a> | <a class="el" href="../../d5/d16/module_8h.html#a155a0df9c59e04e305d4a2fa3e35f843a12c3f60dd7655dfa8d4430cbf04b1223">AST_MODFLAG_LOAD_ORDER</a> , .description = &quot;Stasis <a class="el" href="../../d8/d89/structtest.html">test</a> utilities&quot; , .key = &quot;This paragraph is copyright (<a class="el" href="../../d7/d6f/test__linkedlists_8c.html#acd9db00336027462cfb25b97b5356883">c</a>) 2006 by Digium, Inc. \In <a class="el" href="../../d5/d14/voicin_8c.html#aed7ca058008dc3e5ee131e575abed285">order</a> for your module to load, it must return this \key via <a class="el" href="../../d7/d6f/test__linkedlists_8c.html#a13dd15487fee89a002d17ef3aff62d02">a</a> function called \&quot;key\&quot;. Any code which \includes this paragraph must <a class="el" href="../../dd/d7c/eagi__proxy_8c.html#a39730e90126aad69cfc9ca4d6fcdb3a6">be</a> licensed under the GNU \General Public License <a class="el" href="../../da/d7c/utils_2frame_8h.html#a56abfaab87c46691c1ef3ad0df23e864">version</a> 2 or later (at your \option). In addition to Digium's general reservations \of rights, Digium expressly reserves the right to \allow other parties to license this paragraph under \different terms. Any use of Digium, Inc. trademarks or \logos (including \&quot;Asterisk\&quot; or \&quot;Digium\&quot;) without \express written <a class="el" href="../../d4/d4c/structpermission.html">permission</a> of Digium, Inc. is prohibited.\n&quot; , .buildopt_sum = <a class="el" href="../../da/d84/res__pjsip__stir__shaken_8c.html#a6e79b87e069c15a5fb21826e5eed0971">AST_BUILDOPT_SUM</a>, .support_level = <a class="el" href="../../d5/d16/module_8h.html#ab35bc4efd9f79706300965c9d36a0ce5a634484c0074e7b6b630756fab09e2c15">AST_MODULE_SUPPORT_CORE</a>, .load = <a class="el" href="../../d6/d7a/test__xml__escape_8c.html#ac3382bf6da54c56b37069bd76bbdf4f9">load_module</a>, .unload = <a class="el" href="../../d6/d7a/test__xml__escape_8c.html#ad09fa931f468002152a3cc2d5ce25eae">unload_module</a>, .load_pri = <a class="el" href="../../d5/d16/module_8h.html#aa4f734041ffd9d75b07cefb0291e1e58a08d902290b0d6cbffd8e607d5e399a06">AST_MODPRI_APP_DEPEND</a>, }</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="../../da/dca/res__stasis__test_8c_source.html#l00273">273</a> of file <a class="el" href="../../da/dca/res__stasis__test_8c_source.html">res_stasis_test.c</a>.</p>

</div>
</div>
<a id="ad60e83b9aa660040fed4d5377966cc21"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad60e83b9aa660040fed4d5377966cc21">&#9670;&nbsp;</a></span>ast_module_info</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">const struct <a class="el" href="../../dd/d5f/structast__module__info.html">ast_module_info</a>* <a class="el" href="../../dd/d5f/structast__module__info.html">ast_module_info</a> = &amp;<a class="el" href="../../d6/d7a/test__xml__escape_8c.html#ab22f32016155f7f403e7178767163d7d">__mod_info</a></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="../../da/dca/res__stasis__test_8c_source.html#l00273">273</a> of file <a class="el" href="../../da/dca/res__stasis__test_8c_source.html">res_stasis_test.c</a>.</p>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Sun Aug 8 2021 19:46:39 for Asterisk - The Open Source Telephony Project by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="../../doxygen.png" alt="doxygen"/>
</a> 1.8.13
</small></address>
</body>
</html>
