<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Asterisk - The Open Source Telephony Project: res_pjsip_stir_shaken.c File Reference</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Asterisk - The Open Source Telephony Project
   &#160;<span id="projectnumber">18.5.0</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "../../search",false,'Search');
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('../../',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="../../dir_7b47cca4d318623bb4270ab1fb592ef5.html">res</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#define-members">Macros</a> &#124;
<a href="#func-members">Functions</a> &#124;
<a href="#var-members">Variables</a>  </div>
  <div class="headertitle">
<div class="title">res_pjsip_stir_shaken.c File Reference</div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><code>#include &quot;<a class="el" href="../../db/db2/asterisk_8h_source.html">asterisk.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="../../d8/d8c/res__pjsip_8h_source.html">asterisk/res_pjsip.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="../../d9/de7/res__pjsip__session_8h_source.html">asterisk/res_pjsip_session.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="../../d5/d16/module_8h_source.html">asterisk/module.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="../../d2/db7/res__stir__shaken_8h_source.html">asterisk/res_stir_shaken.h</a>&quot;</code><br />
</div><div class="textblock"><div class="dynheader">
Include dependency graph for res_pjsip_stir_shaken.c:</div>
<div class="dyncontent">
<div class="center"><img src="../../de/d1b/res__pjsip__stir__shaken_8c__incl.png" border="0" usemap="#res__pjsip__stir__shaken_8c" alt=""/></div>
<map name="res__pjsip__stir__shaken_8c" id="res__pjsip__stir__shaken_8c">
<area shape="rect" id="node2" href="../../db/db2/asterisk_8h.html" title="Asterisk main include file. File version handling, generic pbx functions. " alt="" coords="805,244,889,271"/>
<area shape="rect" id="node22" href="../../d8/d8c/res__pjsip_8h.html" title="asterisk/res_pjsip.h" alt="" coords="2343,87,2487,114"/>
<area shape="rect" id="node46" href="../../d9/de7/res__pjsip__session_8h.html" title="asterisk/res_pjsip\l_session.h" alt="" coords="3091,80,3223,121"/>
<area shape="rect" id="node49" href="../../d5/d16/module_8h.html" title="Asterisk module definitions. " alt="" coords="1836,87,1972,114"/>
<area shape="rect" id="node50" href="../../d2/db7/res__stir__shaken_8h.html" title="asterisk/res_stir_shaken.h" alt="" coords="3247,87,3435,114"/>
<area shape="rect" id="node3" href="../../d8/d20/autoconfig_8h.html" title="asterisk/autoconfig.h" alt="" coords="684,319,839,345"/>
<area shape="rect" id="node5" href="../../de/da3/include_2asterisk_2compat_8h.html" title="General Definitions for Asterisk top level program Included by asterisk.h to handle platform&#45;specific..." alt="" coords="863,319,1001,345"/>
<area shape="rect" id="node21" href="../../d8/d8a/astmm_8h.html" title="Asterisk memory management routines. " alt="" coords="525,319,659,345"/>
<area shape="rect" id="node4" href="../../dc/dba/buildopts_8h.html" title="asterisk/buildopts.h" alt="" coords="5,393,152,420"/>
<area shape="rect" id="node6" href="../../d4/dd1/compiler_8h.html" title="Compiler&#45;specific macros and other items. " alt="" coords="526,393,669,420"/>
<area shape="rect" id="node28" href="../../d1/d0f/stringfields_8h.html" title="asterisk/stringfields.h" alt="" coords="1847,393,2004,420"/>
<area shape="rect" id="node30" href="../../d6/d68/vector_8h.html" title="Vector container support. " alt="" coords="2835,468,2962,495"/>
<area shape="rect" id="node31" href="../../db/df1/netsock2_8h.html" title="Network socket handling. " alt="" coords="2861,319,3008,345"/>
<area shape="rect" id="node34" href="../../df/d90/linkedlists_8h.html" title="A set of macros to manage forward&#45;linked lists. " alt="" coords="3167,319,3318,345"/>
<area shape="rect" id="node35" href="../../d5/d7b/channel_8h.html" title="General Asterisk PBX channel definitions. " alt="" coords="2351,244,2489,271"/>
<area shape="rect" id="node37" href="../../d4/d61/endpoints_8h.html" title="Endpoint abstractions. " alt="" coords="1661,319,1811,345"/>
<area shape="rect" id="node38" href="../../d8/d25/sorcery_8h.html" title="Sorcery Data Access Layer API. " alt="" coords="1520,169,1653,196"/>
<area shape="rect" id="node39" href="../../db/dc4/dnsmgr_8h.html" title="Background DNS update manager. " alt="" coords="2761,244,2897,271"/>
<area shape="rect" id="node40" href="../../d5/da1/udptl_8h.html" title="UDPTL support for T.38. " alt="" coords="2613,169,2733,196"/>
<area shape="rect" id="node41" href="../../d5/dde/rtp__engine_8h.html" title="Pluggable RTP Architecture. " alt="" coords="3023,244,3179,271"/>
<area shape="rect" id="node42" href="../../d9/d4a/stasis__channels_8h.html" title="asterisk/stasis_channels.h" alt="" coords="2400,169,2589,196"/>
<area shape="rect" id="node43" href="../../d7/d44/stasis__endpoints_8h.html" title="Endpoint abstractions. " alt="" coords="1515,244,1709,271"/>
<area shape="rect" id="node44" href="../../d8/d95/stream_8h.html" title="Media Stream API. " alt="" coords="3362,169,3497,196"/>
<area shape="rect" id="node29" href="../../d5/d9d/inline__api_8h.html" title="Inlinable API function macro. " alt="" coords="1852,468,1999,495"/>
<area shape="rect" id="node36" href="../../d5/d60/utils_8h.html" title="Utility functions. " alt="" coords="1471,319,1585,345"/>
<area shape="rect" id="node45" href="../../d1/d16/codec_8h.html" title="Codec API. " alt="" coords="3433,244,3559,271"/>
<area shape="rect" id="node47" href="../../de/d5f/sdp__srtp_8h.html" title="SRTP and SDP Security descriptions. " alt="" coords="3195,169,3338,196"/>
</map>
</div>
</div>
<p><a href="../../da/d84/res__pjsip__stir__shaken_8c_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="define-members"></a>
Macros</h2></td></tr>
<tr class="memitem:a6e79b87e069c15a5fb21826e5eed0971"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../da/d84/res__pjsip__stir__shaken_8c.html#a6e79b87e069c15a5fb21826e5eed0971">AST_BUILDOPT_SUM</a>&#160;&#160;&#160;&quot;&quot;</td></tr>
<tr class="separator:a6e79b87e069c15a5fb21826e5eed0971"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a88b7c88fed6b80fd18f34f97757dfc04"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../da/d84/res__pjsip__stir__shaken_8c.html#a88b7c88fed6b80fd18f34f97757dfc04">__reg_module</a> (void)</td></tr>
<tr class="separator:a88b7c88fed6b80fd18f34f97757dfc04"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:afeab1257bd17282b95875499393a147a"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../da/d84/res__pjsip__stir__shaken_8c.html#afeab1257bd17282b95875499393a147a">__unreg_module</a> (void)</td></tr>
<tr class="separator:afeab1257bd17282b95875499393a147a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a81686f89684b79be2b2ca95abb3c907c"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../da/d84/res__pjsip__stir__shaken_8c.html#a81686f89684b79be2b2ca95abb3c907c">add_date_header</a> (const struct <a class="el" href="../../d2/dec/structast__sip__session.html">ast_sip_session</a> *<a class="el" href="../../d2/d4d/astman_8c.html#ac4a6ae0400e4457f0b35beddec80c93d">session</a>, pjsip_tx_data *tdata)</td></tr>
<tr class="separator:a81686f89684b79be2b2ca95abb3c907c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a79960471926a97003f809a78a228bc80"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../da/d84/res__pjsip__stir__shaken_8c.html#a79960471926a97003f809a78a228bc80">add_identity_header</a> (const struct <a class="el" href="../../d2/dec/structast__sip__session.html">ast_sip_session</a> *<a class="el" href="../../d2/d4d/astman_8c.html#ac4a6ae0400e4457f0b35beddec80c93d">session</a>, pjsip_tx_data *tdata)</td></tr>
<tr class="separator:a79960471926a97003f809a78a228bc80"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4fb0aca9bbcdb9709fa52a70aded6cae"><td class="memItemLeft" align="right" valign="top">struct <a class="el" href="../../d9/df5/structast__module.html">ast_module</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../da/d84/res__pjsip__stir__shaken_8c.html#a4fb0aca9bbcdb9709fa52a70aded6cae">AST_MODULE_SELF_SYM</a> (void)</td></tr>
<tr class="separator:a4fb0aca9bbcdb9709fa52a70aded6cae"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4c87764448ebe4e4319625ce6c413055"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../da/d84/res__pjsip__stir__shaken_8c.html#a4c87764448ebe4e4319625ce6c413055">compare_caller_id</a> (char *caller_id, const char *json_str)</td></tr>
<tr class="memdesc:a4c87764448ebe4e4319625ce6c413055"><td class="mdescLeft">&#160;</td><td class="mdescRight">Compare the caller ID from the INVITE with the one in the payload.  <a href="#a4c87764448ebe4e4319625ce6c413055">More...</a><br /></td></tr>
<tr class="separator:a4c87764448ebe4e4319625ce6c413055"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a75df7f7863cbebc09bd89458e652ce1c"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../da/d84/res__pjsip__stir__shaken_8c.html#a75df7f7863cbebc09bd89458e652ce1c">compare_timestamp</a> (const char *json_str)</td></tr>
<tr class="memdesc:a75df7f7863cbebc09bd89458e652ce1c"><td class="mdescLeft">&#160;</td><td class="mdescRight">Compare the current timestamp with the one in the payload. If the difference is greater than the signature timeout, it's not valid anymore.  <a href="#a75df7f7863cbebc09bd89458e652ce1c">More...</a><br /></td></tr>
<tr class="separator:a75df7f7863cbebc09bd89458e652ce1c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a730d4ecb068b716bda32617440fcf8ea"><td class="memItemLeft" align="right" valign="top">static char *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../da/d84/res__pjsip__stir__shaken_8c.html#a730d4ecb068b716bda32617440fcf8ea">get_attestation_from_payload</a> (const char *json_str)</td></tr>
<tr class="memdesc:a730d4ecb068b716bda32617440fcf8ea"><td class="mdescLeft">&#160;</td><td class="mdescRight">Get the attestation from the payload.  <a href="#a730d4ecb068b716bda32617440fcf8ea">More...</a><br /></td></tr>
<tr class="separator:a730d4ecb068b716bda32617440fcf8ea"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac3382bf6da54c56b37069bd76bbdf4f9"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../da/d84/res__pjsip__stir__shaken_8c.html#ac3382bf6da54c56b37069bd76bbdf4f9">load_module</a> (void)</td></tr>
<tr class="separator:ac3382bf6da54c56b37069bd76bbdf4f9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5ae7b57d2f58c1261689f0a605afd60f"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../da/d84/res__pjsip__stir__shaken_8c.html#a5ae7b57d2f58c1261689f0a605afd60f">stir_shaken_incoming_request</a> (struct <a class="el" href="../../d2/dec/structast__sip__session.html">ast_sip_session</a> *<a class="el" href="../../d2/d4d/astman_8c.html#ac4a6ae0400e4457f0b35beddec80c93d">session</a>, pjsip_rx_data *rdata)</td></tr>
<tr class="separator:a5ae7b57d2f58c1261689f0a605afd60f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a37f6665c717cf7d52187eb495456863c"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../da/d84/res__pjsip__stir__shaken_8c.html#a37f6665c717cf7d52187eb495456863c">stir_shaken_outgoing_request</a> (struct <a class="el" href="../../d2/dec/structast__sip__session.html">ast_sip_session</a> *<a class="el" href="../../d2/d4d/astman_8c.html#ac4a6ae0400e4457f0b35beddec80c93d">session</a>, pjsip_tx_data *tdata)</td></tr>
<tr class="separator:a37f6665c717cf7d52187eb495456863c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad09fa931f468002152a3cc2d5ce25eae"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../da/d84/res__pjsip__stir__shaken_8c.html#ad09fa931f468002152a3cc2d5ce25eae">unload_module</a> (void)</td></tr>
<tr class="separator:ad09fa931f468002152a3cc2d5ce25eae"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="var-members"></a>
Variables</h2></td></tr>
<tr class="memitem:ab22f32016155f7f403e7178767163d7d"><td class="memItemLeft" align="right" valign="top">static struct <a class="el" href="../../dd/d5f/structast__module__info.html">ast_module_info</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../da/d84/res__pjsip__stir__shaken_8c.html#ab22f32016155f7f403e7178767163d7d">__mod_info</a> = { .<a class="el" href="../../d1/da4/res__corosync_8c.html#a8f8f80d37794cde9472343e4487ba3eb">name</a> = <a class="el" href="../../da/ddd/named__acl_8c.html#aec23fc5034c3bb08140fc021f4955877">AST_MODULE</a>, .flags = <a class="el" href="../../d5/d16/module_8h.html#a155a0df9c59e04e305d4a2fa3e35f843a835b27a90d895a488e4e14cc3d2dee8c">AST_MODFLAG_GLOBAL_SYMBOLS</a> | <a class="el" href="../../d5/d16/module_8h.html#a155a0df9c59e04e305d4a2fa3e35f843a12c3f60dd7655dfa8d4430cbf04b1223">AST_MODFLAG_LOAD_ORDER</a> , .description = &quot;PJSIP STIR/SHAKEN Module for Asterisk&quot; , .key = &quot;This paragraph is copyright (<a class="el" href="../../d7/d6f/test__linkedlists_8c.html#acd9db00336027462cfb25b97b5356883">c</a>) 2006 by Digium, Inc. \In <a class="el" href="../../d5/d14/voicin_8c.html#aed7ca058008dc3e5ee131e575abed285">order</a> for your module to load, it must return this \key via <a class="el" href="../../d7/d6f/test__linkedlists_8c.html#a13dd15487fee89a002d17ef3aff62d02">a</a> function called \&quot;key\&quot;. Any code which \includes this paragraph must <a class="el" href="../../dd/d7c/eagi__proxy_8c.html#a39730e90126aad69cfc9ca4d6fcdb3a6">be</a> licensed under the GNU \General Public License <a class="el" href="../../da/d7c/utils_2frame_8h.html#a56abfaab87c46691c1ef3ad0df23e864">version</a> 2 or later (at your \option). In addition to Digium's general reservations \of rights, Digium expressly reserves the right to \allow other parties to license this paragraph under \different terms. Any use of Digium, Inc. trademarks or \logos (including \&quot;Asterisk\&quot; or \&quot;Digium\&quot;) without \express written <a class="el" href="../../d4/d4c/structpermission.html">permission</a> of Digium, Inc. is prohibited.\n&quot; , .buildopt_sum = &quot;&quot; , .support_level = <a class="el" href="../../d5/d16/module_8h.html#ab35bc4efd9f79706300965c9d36a0ce5a634484c0074e7b6b630756fab09e2c15">AST_MODULE_SUPPORT_CORE</a>, .load = <a class="el" href="../../d6/d7a/test__xml__escape_8c.html#ac3382bf6da54c56b37069bd76bbdf4f9">load_module</a>, .unload = <a class="el" href="../../d6/d7a/test__xml__escape_8c.html#ad09fa931f468002152a3cc2d5ce25eae">unload_module</a>, .load_pri = <a class="el" href="../../d5/d16/module_8h.html#aa4f734041ffd9d75b07cefb0291e1e58a1d1eb207e01a2d3bf6aa6ba271c27dee">AST_MODPRI_DEFAULT</a>, .requires = &quot;res_pjsip,res_pjsip_session,res_stir_shaken&quot;, }</td></tr>
<tr class="separator:ab22f32016155f7f403e7178767163d7d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad60e83b9aa660040fed4d5377966cc21"><td class="memItemLeft" align="right" valign="top">static const struct <a class="el" href="../../dd/d5f/structast__module__info.html">ast_module_info</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../da/d84/res__pjsip__stir__shaken_8c.html#ad60e83b9aa660040fed4d5377966cc21">ast_module_info</a> = &amp;<a class="el" href="../../d6/d7a/test__xml__escape_8c.html#ab22f32016155f7f403e7178767163d7d">__mod_info</a></td></tr>
<tr class="separator:ad60e83b9aa660040fed4d5377966cc21"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab5dadd4061795ec68a0136ee0998e9ca"><td class="memItemLeft" align="right" valign="top">static struct <a class="el" href="../../df/db8/structast__sip__session__supplement.html">ast_sip_session_supplement</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../da/d84/res__pjsip__stir__shaken_8c.html#ab5dadd4061795ec68a0136ee0998e9ca">stir_shaken_supplement</a></td></tr>
<tr class="separator:ab5dadd4061795ec68a0136ee0998e9ca"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<h2 class="groupheader">Macro Definition Documentation</h2>
<a id="a6e79b87e069c15a5fb21826e5eed0971"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6e79b87e069c15a5fb21826e5eed0971">&#9670;&nbsp;</a></span>AST_BUILDOPT_SUM</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define AST_BUILDOPT_SUM&#160;&#160;&#160;&quot;&quot;</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="../../da/d84/res__pjsip__stir__shaken_8c_source.html#l00373">373</a> of file <a class="el" href="../../da/d84/res__pjsip__stir__shaken_8c_source.html">res_pjsip_stir_shaken.c</a>.</p>

</div>
</div>
<h2 class="groupheader">Function Documentation</h2>
<a id="a88b7c88fed6b80fd18f34f97757dfc04"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a88b7c88fed6b80fd18f34f97757dfc04">&#9670;&nbsp;</a></span>__reg_module()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void __reg_module </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="../../da/d84/res__pjsip__stir__shaken_8c_source.html#l00381">381</a> of file <a class="el" href="../../da/d84/res__pjsip__stir__shaken_8c_source.html">res_pjsip_stir_shaken.c</a>.</p>

</div>
</div>
<a id="afeab1257bd17282b95875499393a147a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#afeab1257bd17282b95875499393a147a">&#9670;&nbsp;</a></span>__unreg_module()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void __unreg_module </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="../../da/d84/res__pjsip__stir__shaken_8c_source.html#l00381">381</a> of file <a class="el" href="../../da/d84/res__pjsip__stir__shaken_8c_source.html">res_pjsip_stir_shaken.c</a>.</p>

</div>
</div>
<a id="a81686f89684b79be2b2ca95abb3c907c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a81686f89684b79be2b2ca95abb3c907c">&#9670;&nbsp;</a></span>add_date_header()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void add_date_header </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="../../d2/dec/structast__sip__session.html">ast_sip_session</a> *&#160;</td>
          <td class="paramname"><em>session</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">pjsip_tx_data *&#160;</td>
          <td class="paramname"><em>tdata</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="../../da/d84/res__pjsip__stir__shaken_8c_source.html#l00320">320</a> of file <a class="el" href="../../da/d84/res__pjsip__stir__shaken_8c_source.html">res_pjsip_stir_shaken.c</a>.</p>

<p class="reference">References <a class="el" href="../../d1/d8c/logger_8h_source.html#l00452">ast_debug</a>, <a class="el" href="../../de/d96/res__pjsip_8c_source.html#l03288">ast_sip_add_date_header()</a>, and <a class="el" href="../../dc/d7f/resample_8c_source.html#l00096">NULL</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../da/d84/res__pjsip__stir__shaken_8c_source.html#l00334">stir_shaken_outgoing_request()</a>.</p>
<div class="fragment"><div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;{</div><div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;   <span class="keyword">static</span> <span class="keyword">const</span> pj_str_t date_str = { <span class="stringliteral">&quot;Date&quot;</span>, 4 };</div><div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;   pjsip_fromto_hdr *old_date;</div><div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;</div><div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;   old_date = pjsip_msg_find_hdr_by_name(tdata-&gt;msg, &amp;date_str, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div><div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;   <span class="keywordflow">if</span> (old_date) {</div><div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;      <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(3, <span class="stringliteral">&quot;Found old STIR/SHAKEN date header, no need to add one\n&quot;</span>);</div><div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;      <span class="keywordflow">return</span>;</div><div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;   }</div><div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;</div><div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;   <a class="code" href="../../d8/d8c/res__pjsip_8h.html#a541e93ff798b3c8ce99a158831338718">ast_sip_add_date_header</a>(tdata);</div><div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;}</div><div class="ttc" id="resample_8c_html_a070d2ce7b6bb7e5c05602aa8c308d0c4"><div class="ttname"><a href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a></div><div class="ttdeci">#define NULL</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d7f/resample_8c_source.html#l00096">resample.c:96</a></div></div>
<div class="ttc" id="logger_8h_html_a3f248112c8d6ce7e3959aa723dade648"><div class="ttname"><a href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a></div><div class="ttdeci">#define ast_debug(level,...)</div><div class="ttdoc">Log a DEBUG message. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d8c/logger_8h_source.html#l00452">logger.h:452</a></div></div>
<div class="ttc" id="res__pjsip_8h_html_a541e93ff798b3c8ce99a158831338718"><div class="ttname"><a href="../../d8/d8c/res__pjsip_8h.html#a541e93ff798b3c8ce99a158831338718">ast_sip_add_date_header</a></div><div class="ttdeci">void ast_sip_add_date_header(pjsip_tx_data *tdata)</div><div class="ttdoc">Adds a Date header to the tdata, formatted like: Date: Wed, 01 Jan 2021 14:53:01 GMT. </div><div class="ttdef"><b>Definition:</b> <a href="../../de/d96/res__pjsip_8c_source.html#l03288">res_pjsip.c:3288</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a79960471926a97003f809a78a228bc80"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a79960471926a97003f809a78a228bc80">&#9670;&nbsp;</a></span>add_identity_header()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int add_identity_header </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="../../d2/dec/structast__sip__session.html">ast_sip_session</a> *&#160;</td>
          <td class="paramname"><em>session</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">pjsip_tx_data *&#160;</td>
          <td class="paramname"><em>tdata</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="../../da/d84/res__pjsip__stir__shaken_8c_source.html#l00211">211</a> of file <a class="el" href="../../da/d84/res__pjsip__stir__shaken_8c_source.html">res_pjsip_stir_shaken.c</a>.</p>

<p class="reference">References <a class="el" href="../../de/d1f/main_2utils_8c_source.html#l00521">ast_base64url_encode_string()</a>, <a class="el" href="../../d8/d8a/astmm_8h_source.html#l00204">ast_calloc</a>, <a class="el" href="../../de/d96/res__pjsip_8c_source.html#l05240">ast_copy_pj_str()</a>, <a class="el" href="../../d8/d8a/astmm_8h_source.html#l00182">ast_free</a>, <a class="el" href="../../d4/d05/json_8h_source.html#l00763">ast_json_dump_string</a>, <a class="el" href="../../df/d98/json_8c_source.html#l00052">ast_json_free()</a>, <a class="el" href="../../df/d98/json_8c_source.html#l00397">ast_json_object_get()</a>, <a class="el" href="../../df/d98/json_8c_source.html#l00591">ast_json_pack()</a>, <a class="el" href="../../da/df7/astobj2_8c_source.html#l00042">ast_log</a>, <a class="el" href="../../d8/d8a/astmm_8h_source.html#l00193">ast_malloc</a>, <a class="el" href="../../d9/d2d/res__stir__shaken_8c_source.html#l00178">ast_stir_shaken_payload_free()</a>, <a class="el" href="../../d9/d2d/res__stir__shaken_8c_source.html#l00198">ast_stir_shaken_payload_get_public_cert_url()</a>, <a class="el" href="../../d9/d2d/res__stir__shaken_8c_source.html#l00193">ast_stir_shaken_payload_get_signature()</a>, <a class="el" href="../../d9/d2d/res__stir__shaken_8c_source.html#l01046">ast_stir_shaken_sign()</a>, <a class="el" href="../../d9/de7/res__pjsip__session_8h_source.html#l00207">ast_sip_session::id</a>, <a class="el" href="../../d1/d8c/logger_8h_source.html#l00285">LOG_ERROR</a>, <a class="el" href="../../dc/d7f/resample_8c_source.html#l00096">NULL</a>, <a class="el" href="../../d5/d7b/channel_8h_source.html#l00343">ast_party_id::number</a>, <a class="el" href="../../d9/d2d/res__stir__shaken_8c_source.html#l00170">ast_stir_shaken_payload::public_cert_url</a>, <a class="el" href="../../d5/d60/utils_8h_source.html#l00911">RAII_VAR</a>, <a class="el" href="../../d9/d2d/res__stir__shaken_8c_source.html#l00166">ast_stir_shaken_payload::signature</a>, <a class="el" href="../../d2/db7/res__stir__shaken_8h_source.html#l00021">STIR_SHAKEN_ENCRYPTION_ALGORITHM</a>, <a class="el" href="../../d2/db7/res__stir__shaken_8h_source.html#l00022">STIR_SHAKEN_PPT</a>, and <a class="el" href="../../d5/d7b/channel_8h_source.html#l00292">ast_party_number::str</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../da/d84/res__pjsip__stir__shaken_8c_source.html#l00334">stir_shaken_outgoing_request()</a>.</p>
<div class="fragment"><div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;{</div><div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;   <span class="keyword">static</span> <span class="keyword">const</span> pj_str_t identity_str = { <span class="stringliteral">&quot;Identity&quot;</span>, 8 };</div><div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;   pjsip_generic_string_hdr *identity_hdr;</div><div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;   pj_str_t identity_val;</div><div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;   pjsip_fromto_hdr *old_identity;</div><div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;   pjsip_fromto_hdr *to;</div><div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;   pjsip_sip_uri *uri;</div><div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;   <span class="keywordtype">char</span> *signature;</div><div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;   <span class="keywordtype">char</span> *public_cert_url;</div><div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d1/da1/structast__json.html">ast_json</a> *<a class="code" href="../../d5/d65/structheader.html">header</a>;</div><div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d1/da1/structast__json.html">ast_json</a> *payload;</div><div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;   <span class="keywordtype">char</span> *dumped_string;</div><div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;   <a class="code" href="../../d5/d60/utils_8h.html#a1604b4d72144dd3d9f7da668e90337e9">RAII_VAR</a>(<span class="keywordtype">char</span> *, dest_tn, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../d8/d8a/astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>);</div><div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;   <a class="code" href="../../d5/d60/utils_8h.html#a1604b4d72144dd3d9f7da668e90337e9">RAII_VAR</a>(<span class="keyword">struct</span> <a class="code" href="../../d1/da1/structast__json.html">ast_json</a> *, json, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../d4/d05/json_8h.html#a38eea5afa847432f7c10af8e69fb013e">ast_json_free</a>);</div><div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;   <a class="code" href="../../d5/d60/utils_8h.html#a1604b4d72144dd3d9f7da668e90337e9">RAII_VAR</a>(<span class="keyword">struct</span> <a class="code" href="../../d1/d8b/structast__stir__shaken__payload.html">ast_stir_shaken_payload</a> *, ss_payload, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../d2/db7/res__stir__shaken_8h.html#a2cc390b9c52dc61196df9bb674f13b23">ast_stir_shaken_payload_free</a>);</div><div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;   <a class="code" href="../../d5/d60/utils_8h.html#a1604b4d72144dd3d9f7da668e90337e9">RAII_VAR</a>(<span class="keywordtype">char</span> *, encoded_header, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../d8/d8a/astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>);</div><div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;   <a class="code" href="../../d5/d60/utils_8h.html#a1604b4d72144dd3d9f7da668e90337e9">RAII_VAR</a>(<span class="keywordtype">char</span> *, encoded_payload, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../d8/d8a/astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>);</div><div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;   <a class="code" href="../../d5/d60/utils_8h.html#a1604b4d72144dd3d9f7da668e90337e9">RAII_VAR</a>(<span class="keywordtype">char</span> *, combined_str, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../d8/d8a/astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>);</div><div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;   <span class="keywordtype">size_t</span> combined_size;</div><div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;</div><div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;   old_identity = pjsip_msg_find_hdr_by_name(tdata-&gt;msg, &amp;identity_str, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div><div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;   <span class="keywordflow">if</span> (old_identity) {</div><div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;      <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;   }</div><div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;</div><div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;   to = pjsip_msg_find_hdr(tdata-&gt;msg, PJSIP_H_TO, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div><div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;   <span class="keywordflow">if</span> (!to) {</div><div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Failed to find To header while adding STIR/SHAKEN Identity header\n&quot;</span>);</div><div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;   }</div><div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;</div><div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;   uri = pjsip_uri_get_uri(to-&gt;uri);</div><div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;   <span class="keywordflow">if</span> (!uri) {</div><div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Failed to retrieve URI from To header while adding STIR/SHAKEN Identity header\n&quot;</span>);</div><div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;   }</div><div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;</div><div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;   dest_tn = <a class="code" href="../../d8/d8a/astmm_8h.html#ae63d4f486bcf6eac7c1593f867717d91">ast_malloc</a>(uri-&gt;user.slen + 1);</div><div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;   <span class="keywordflow">if</span> (!dest_tn) {</div><div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Failed to allocate memory for STIR/SHAKEN dest-&gt;tn\n&quot;</span>);</div><div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;   }</div><div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;</div><div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;   <a class="code" href="../../d8/d8c/res__pjsip_8h.html#a7da3e1f7ee3fcb77f29d41a76a7528fe">ast_copy_pj_str</a>(dest_tn, &amp;uri-&gt;user, uri-&gt;user.slen + 1);</div><div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;</div><div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;   <span class="comment">/* x5u (public key URL), attestation, and origid will be added by ast_stir_shaken_sign */</span></div><div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;   json = <a class="code" href="../../d4/d05/json_8h.html#a99715667e822b2ad409b34ca041e535d">ast_json_pack</a>(<span class="stringliteral">&quot;{s: {s: s, s: s, s: s}, s: {s: {s: s}, s: {s: s}}}&quot;</span>,</div><div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;      <span class="stringliteral">&quot;header&quot;</span>, <span class="stringliteral">&quot;alg&quot;</span>, <span class="stringliteral">&quot;ES256&quot;</span>, <span class="stringliteral">&quot;ppt&quot;</span>, <span class="stringliteral">&quot;shaken&quot;</span>, <span class="stringliteral">&quot;typ&quot;</span>, <span class="stringliteral">&quot;passport&quot;</span>,</div><div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;      <span class="stringliteral">&quot;payload&quot;</span>, <span class="stringliteral">&quot;dest&quot;</span>, <span class="stringliteral">&quot;tn&quot;</span>, dest_tn, <span class="stringliteral">&quot;orig&quot;</span>, <span class="stringliteral">&quot;tn&quot;</span>,</div><div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;      session-&gt;<a class="code" href="../../d2/dec/structast__sip__session.html#a8791d240f8a9c2dc271a1c8542cfe8cc">id</a>.<a class="code" href="../../d1/dcb/structast__party__id.html#aca2d7de6c89f201dc8bd0a2642d2a352">number</a>.<a class="code" href="../../d6/dbb/structast__party__number.html#ab50d783982593ef993ea0b68f7ad8b80">str</a>);</div><div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;   <span class="keywordflow">if</span> (!json) {</div><div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Failed to allocate memory for STIR/SHAKEN JSON\n&quot;</span>);</div><div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;   }</div><div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;</div><div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;   ss_payload = <a class="code" href="../../d2/db7/res__stir__shaken_8h.html#a452722781ee869834324e0ccc8d42962">ast_stir_shaken_sign</a>(json);</div><div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;   <span class="keywordflow">if</span> (!ss_payload) {</div><div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Failed to allocate memory for STIR/SHAKEN payload\n&quot;</span>);</div><div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;   }</div><div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;</div><div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;   header = <a class="code" href="../../d4/d05/json_8h.html#a53707225c3bf831e263245c6e3800676">ast_json_object_get</a>(json, <span class="stringliteral">&quot;header&quot;</span>);</div><div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;   dumped_string = <a class="code" href="../../d4/d05/json_8h.html#a51a96b2baa67b671ac68a9fcaebbaeea">ast_json_dump_string</a>(header);</div><div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;   encoded_header = <a class="code" href="../../d5/d60/utils_8h.html#aa9c299b1a6f79bd9ad798eb8555096a4">ast_base64url_encode_string</a>(dumped_string);</div><div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;   <a class="code" href="../../d4/d05/json_8h.html#a38eea5afa847432f7c10af8e69fb013e">ast_json_free</a>(dumped_string);</div><div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;   <span class="keywordflow">if</span> (!encoded_header) {</div><div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Failed to encode STIR/SHAKEN header\n&quot;</span>);</div><div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;   }</div><div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;</div><div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;   payload = <a class="code" href="../../d4/d05/json_8h.html#a53707225c3bf831e263245c6e3800676">ast_json_object_get</a>(json, <span class="stringliteral">&quot;payload&quot;</span>);</div><div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;   dumped_string = <a class="code" href="../../d4/d05/json_8h.html#a51a96b2baa67b671ac68a9fcaebbaeea">ast_json_dump_string</a>(payload);</div><div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;   encoded_payload = <a class="code" href="../../d5/d60/utils_8h.html#aa9c299b1a6f79bd9ad798eb8555096a4">ast_base64url_encode_string</a>(dumped_string);</div><div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;   <a class="code" href="../../d4/d05/json_8h.html#a38eea5afa847432f7c10af8e69fb013e">ast_json_free</a>(dumped_string);</div><div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;   <span class="keywordflow">if</span> (!encoded_payload) {</div><div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Failed to encode STIR/SHAKEN payload\n&quot;</span>);</div><div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;   }</div><div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;</div><div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;   signature = (<span class="keywordtype">char</span> *)<a class="code" href="../../d2/db7/res__stir__shaken_8h.html#abc005995e3ab4798df0d47d10d3c3f3d">ast_stir_shaken_payload_get_signature</a>(ss_payload);</div><div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;   public_cert_url = <a class="code" href="../../d2/db7/res__stir__shaken_8h.html#a15a5bb3613dfcd15925bc0f3c38ecd57">ast_stir_shaken_payload_get_public_cert_url</a>(ss_payload);</div><div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;</div><div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;   <span class="comment">/* The format for the identity header:</span></div><div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;<span class="comment">    * header.payload.signature;info=&lt;public_cert_url&gt;alg=STIR_SHAKEN_ENCRYPTION_ALGORITHM;ppt=STIR_SHAKEN_PPT</span></div><div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;<span class="comment">    */</span></div><div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;   combined_size = strlen(encoded_header) + 1 + strlen(encoded_payload) + 1</div><div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;      + strlen(signature) + strlen(<span class="stringliteral">&quot;;info=&lt;&gt;alg=;ppt=&quot;</span>) + strlen(public_cert_url)</div><div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;      + strlen(<a class="code" href="../../d2/db7/res__stir__shaken_8h.html#a7fa9ce960630ba4818351dce356650ba">STIR_SHAKEN_ENCRYPTION_ALGORITHM</a>) + strlen(<a class="code" href="../../d2/db7/res__stir__shaken_8h.html#a8ac6f48a993e1cfdb7780fa13b8bff06">STIR_SHAKEN_PPT</a>) + 1;</div><div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;   combined_str = <a class="code" href="../../d8/d8a/astmm_8h.html#ae0cd4c5524b01287ab19cbe233d9cebb">ast_calloc</a>(1, combined_size);</div><div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;   <span class="keywordflow">if</span> (!combined_str) {</div><div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Failed to allocate memory for STIR/SHAKEN identity string\n&quot;</span>);</div><div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;   }</div><div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;   snprintf(combined_str, combined_size, <span class="stringliteral">&quot;%s.%s.%s;info=&lt;%s&gt;alg=%s;ppt=%s&quot;</span>, encoded_header,</div><div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;      encoded_payload, signature, public_cert_url, <a class="code" href="../../d2/db7/res__stir__shaken_8h.html#a7fa9ce960630ba4818351dce356650ba">STIR_SHAKEN_ENCRYPTION_ALGORITHM</a>, <a class="code" href="../../d2/db7/res__stir__shaken_8h.html#a8ac6f48a993e1cfdb7780fa13b8bff06">STIR_SHAKEN_PPT</a>);</div><div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;</div><div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;   identity_val = pj_str(combined_str);</div><div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;   identity_hdr = pjsip_generic_string_hdr_create(tdata-&gt;pool, &amp;identity_str, &amp;identity_val);</div><div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;   <span class="keywordflow">if</span> (!identity_hdr) {</div><div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Failed to create STIR/SHAKEN Identity header\n&quot;</span>);</div><div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;   }</div><div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;</div><div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;   pjsip_msg_add_hdr(tdata-&gt;msg, (pjsip_hdr *)identity_hdr);</div><div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;</div><div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;   <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;}</div><div class="ttc" id="structast__party__number_html_ab50d783982593ef993ea0b68f7ad8b80"><div class="ttname"><a href="../../d6/dbb/structast__party__number.html#ab50d783982593ef993ea0b68f7ad8b80">ast_party_number::str</a></div><div class="ttdeci">char * str</div><div class="ttdoc">Subscriber phone number (Malloced) </div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d7b/channel_8h_source.html#l00292">channel.h:292</a></div></div>
<div class="ttc" id="json_8h_html_a99715667e822b2ad409b34ca041e535d"><div class="ttname"><a href="../../d4/d05/json_8h.html#a99715667e822b2ad409b34ca041e535d">ast_json_pack</a></div><div class="ttdeci">struct ast_json * ast_json_pack(char const *format,...)</div><div class="ttdoc">Helper for creating complex JSON values. </div><div class="ttdef"><b>Definition:</b> <a href="../../df/d98/json_8c_source.html#l00591">json.c:591</a></div></div>
<div class="ttc" id="json_8h_html_a38eea5afa847432f7c10af8e69fb013e"><div class="ttname"><a href="../../d4/d05/json_8h.html#a38eea5afa847432f7c10af8e69fb013e">ast_json_free</a></div><div class="ttdeci">void ast_json_free(void *p)</div><div class="ttdoc">Asterisk&amp;#39;s custom JSON allocator. Exposed for use by unit tests. </div><div class="ttdef"><b>Definition:</b> <a href="../../df/d98/json_8c_source.html#l00052">json.c:52</a></div></div>
<div class="ttc" id="json_8h_html_a51a96b2baa67b671ac68a9fcaebbaeea"><div class="ttname"><a href="../../d4/d05/json_8h.html#a51a96b2baa67b671ac68a9fcaebbaeea">ast_json_dump_string</a></div><div class="ttdeci">#define ast_json_dump_string(root)</div><div class="ttdoc">Encode a JSON value to a compact string. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d05/json_8h_source.html#l00763">json.h:763</a></div></div>
<div class="ttc" id="res__stir__shaken_8h_html_a15a5bb3613dfcd15925bc0f3c38ecd57"><div class="ttname"><a href="../../d2/db7/res__stir__shaken_8h.html#a15a5bb3613dfcd15925bc0f3c38ecd57">ast_stir_shaken_payload_get_public_cert_url</a></div><div class="ttdeci">char * ast_stir_shaken_payload_get_public_cert_url(const struct ast_stir_shaken_payload *payload)</div><div class="ttdoc">Retrieve the value for &amp;#39;public_cert_url&amp;#39; from an ast_stir_shaken_payload. </div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d2d/res__stir__shaken_8c_source.html#l00198">res_stir_shaken.c:198</a></div></div>
<div class="ttc" id="res__pjsip_8h_html_a7da3e1f7ee3fcb77f29d41a76a7528fe"><div class="ttname"><a href="../../d8/d8c/res__pjsip_8h.html#a7da3e1f7ee3fcb77f29d41a76a7528fe">ast_copy_pj_str</a></div><div class="ttdeci">void ast_copy_pj_str(char *dest, const pj_str_t *src, size_t size)</div><div class="ttdoc">Copy a pj_str_t into a standard character buffer. </div><div class="ttdef"><b>Definition:</b> <a href="../../de/d96/res__pjsip_8c_source.html#l05240">res_pjsip.c:5240</a></div></div>
<div class="ttc" id="resample_8c_html_a070d2ce7b6bb7e5c05602aa8c308d0c4"><div class="ttname"><a href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a></div><div class="ttdeci">#define NULL</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d7f/resample_8c_source.html#l00096">resample.c:96</a></div></div>
<div class="ttc" id="astobj2_8c_html_a96a00b3a518d7f32b6d51dc28f09bf9b"><div class="ttname"><a href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a></div><div class="ttdeci">#define ast_log</div><div class="ttdef"><b>Definition:</b> <a href="../../da/df7/astobj2_8c_source.html#l00042">astobj2.c:42</a></div></div>
<div class="ttc" id="res__stir__shaken_8h_html_a452722781ee869834324e0ccc8d42962"><div class="ttname"><a href="../../d2/db7/res__stir__shaken_8h.html#a452722781ee869834324e0ccc8d42962">ast_stir_shaken_sign</a></div><div class="ttdeci">struct ast_stir_shaken_payload * ast_stir_shaken_sign(struct ast_json *json)</div><div class="ttdoc">Sign a JSON STIR/SHAKEN payload. </div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d2d/res__stir__shaken_8c_source.html#l01046">res_stir_shaken.c:1046</a></div></div>
<div class="ttc" id="utils_8h_html_a1604b4d72144dd3d9f7da668e90337e9"><div class="ttname"><a href="../../d5/d60/utils_8h.html#a1604b4d72144dd3d9f7da668e90337e9">RAII_VAR</a></div><div class="ttdeci">#define RAII_VAR(vartype, varname, initval, dtor)</div><div class="ttdoc">Declare a variable that will call a destructor function when it goes out of scope. </div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d60/utils_8h_source.html#l00911">utils.h:911</a></div></div>
<div class="ttc" id="utils_8h_html_aa9c299b1a6f79bd9ad798eb8555096a4"><div class="ttname"><a href="../../d5/d60/utils_8h.html#aa9c299b1a6f79bd9ad798eb8555096a4">ast_base64url_encode_string</a></div><div class="ttdeci">char * ast_base64url_encode_string(const char *src)</div><div class="ttdoc">Encode string in base64 URL. </div><div class="ttdef"><b>Definition:</b> <a href="../../de/d1f/main_2utils_8c_source.html#l00521">main/utils.c:521</a></div></div>
<div class="ttc" id="astmm_8h_html_ae63d4f486bcf6eac7c1593f867717d91"><div class="ttname"><a href="../../d8/d8a/astmm_8h.html#ae63d4f486bcf6eac7c1593f867717d91">ast_malloc</a></div><div class="ttdeci">#define ast_malloc(len)</div><div class="ttdoc">A wrapper for malloc() </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d8a/astmm_8h_source.html#l00193">astmm.h:193</a></div></div>
<div class="ttc" id="res__stir__shaken_8h_html_a7fa9ce960630ba4818351dce356650ba"><div class="ttname"><a href="../../d2/db7/res__stir__shaken_8h.html#a7fa9ce960630ba4818351dce356650ba">STIR_SHAKEN_ENCRYPTION_ALGORITHM</a></div><div class="ttdeci">#define STIR_SHAKEN_ENCRYPTION_ALGORITHM</div><div class="ttdef"><b>Definition:</b> <a href="../../d2/db7/res__stir__shaken_8h_source.html#l00021">res_stir_shaken.h:21</a></div></div>
<div class="ttc" id="logger_8h_html_aced66975c154ea0e2a8ec3bc818b4e08"><div class="ttname"><a href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a></div><div class="ttdeci">#define LOG_ERROR</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d8c/logger_8h_source.html#l00285">logger.h:285</a></div></div>
<div class="ttc" id="astmm_8h_html_a402072d6789f6ed9e3a81da27504127e"><div class="ttname"><a href="../../d8/d8a/astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a></div><div class="ttdeci">#define ast_free(a)</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d8a/astmm_8h_source.html#l00182">astmm.h:182</a></div></div>
<div class="ttc" id="astmm_8h_html_ae0cd4c5524b01287ab19cbe233d9cebb"><div class="ttname"><a href="../../d8/d8a/astmm_8h.html#ae0cd4c5524b01287ab19cbe233d9cebb">ast_calloc</a></div><div class="ttdeci">#define ast_calloc(num, len)</div><div class="ttdoc">A wrapper for calloc() </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d8a/astmm_8h_source.html#l00204">astmm.h:204</a></div></div>
<div class="ttc" id="structast__stir__shaken__payload_html"><div class="ttname"><a href="../../d1/d8b/structast__stir__shaken__payload.html">ast_stir_shaken_payload</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d2d/res__stir__shaken_8c_source.html#l00160">res_stir_shaken.c:160</a></div></div>
<div class="ttc" id="res__stir__shaken_8h_html_abc005995e3ab4798df0d47d10d3c3f3d"><div class="ttname"><a href="../../d2/db7/res__stir__shaken_8h.html#abc005995e3ab4798df0d47d10d3c3f3d">ast_stir_shaken_payload_get_signature</a></div><div class="ttdeci">unsigned char * ast_stir_shaken_payload_get_signature(const struct ast_stir_shaken_payload *payload)</div><div class="ttdoc">Retrieve the value for &amp;#39;signature&amp;#39; from an ast_stir_shaken_payload. </div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d2d/res__stir__shaken_8c_source.html#l00193">res_stir_shaken.c:193</a></div></div>
<div class="ttc" id="res__stir__shaken_8h_html_a8ac6f48a993e1cfdb7780fa13b8bff06"><div class="ttname"><a href="../../d2/db7/res__stir__shaken_8h.html#a8ac6f48a993e1cfdb7780fa13b8bff06">STIR_SHAKEN_PPT</a></div><div class="ttdeci">#define STIR_SHAKEN_PPT</div><div class="ttdef"><b>Definition:</b> <a href="../../d2/db7/res__stir__shaken_8h_source.html#l00022">res_stir_shaken.h:22</a></div></div>
<div class="ttc" id="structheader_html"><div class="ttname"><a href="../../d5/d65/structheader.html">header</a></div><div class="ttdef"><b>Definition:</b> <a href="../../db/d73/pjsip__global__headers_8c_source.html#l00047">pjsip_global_headers.c:47</a></div></div>
<div class="ttc" id="json_8h_html_a53707225c3bf831e263245c6e3800676"><div class="ttname"><a href="../../d4/d05/json_8h.html#a53707225c3bf831e263245c6e3800676">ast_json_object_get</a></div><div class="ttdeci">struct ast_json * ast_json_object_get(struct ast_json *object, const char *key)</div><div class="ttdoc">Get a field from a JSON object. </div><div class="ttdef"><b>Definition:</b> <a href="../../df/d98/json_8c_source.html#l00397">json.c:397</a></div></div>
<div class="ttc" id="structast__json_html"><div class="ttname"><a href="../../d1/da1/structast__json.html">ast_json</a></div><div class="ttdoc">Abstract JSON element (object, array, string, int, ...). </div></div>
<div class="ttc" id="res__stir__shaken_8h_html_a2cc390b9c52dc61196df9bb674f13b23"><div class="ttname"><a href="../../d2/db7/res__stir__shaken_8h.html#a2cc390b9c52dc61196df9bb674f13b23">ast_stir_shaken_payload_free</a></div><div class="ttdeci">void ast_stir_shaken_payload_free(struct ast_stir_shaken_payload *payload)</div><div class="ttdoc">Free a STIR/SHAKEN payload. </div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d2d/res__stir__shaken_8c_source.html#l00178">res_stir_shaken.c:178</a></div></div>
<div class="ttc" id="structast__sip__session_html_a8791d240f8a9c2dc271a1c8542cfe8cc"><div class="ttname"><a href="../../d2/dec/structast__sip__session.html#a8791d240f8a9c2dc271a1c8542cfe8cc">ast_sip_session::id</a></div><div class="ttdeci">struct ast_party_id id</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/de7/res__pjsip__session_8h_source.html#l00207">res_pjsip_session.h:207</a></div></div>
<div class="ttc" id="structast__party__id_html_aca2d7de6c89f201dc8bd0a2642d2a352"><div class="ttname"><a href="../../d1/dcb/structast__party__id.html#aca2d7de6c89f201dc8bd0a2642d2a352">ast_party_id::number</a></div><div class="ttdeci">struct ast_party_number number</div><div class="ttdoc">Subscriber phone number. </div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d7b/channel_8h_source.html#l00343">channel.h:343</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a4fb0aca9bbcdb9709fa52a70aded6cae"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4fb0aca9bbcdb9709fa52a70aded6cae">&#9670;&nbsp;</a></span>AST_MODULE_SELF_SYM()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="../../d9/df5/structast__module.html">ast_module</a>* AST_MODULE_SELF_SYM </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="../../da/d84/res__pjsip__stir__shaken_8c_source.html#l00381">381</a> of file <a class="el" href="../../da/d84/res__pjsip__stir__shaken_8c_source.html">res_pjsip_stir_shaken.c</a>.</p>

</div>
</div>
<a id="a4c87764448ebe4e4319625ce6c413055"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4c87764448ebe4e4319625ce6c413055">&#9670;&nbsp;</a></span>compare_caller_id()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int compare_caller_id </td>
          <td>(</td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>caller_id</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>json_str</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Compare the caller ID from the INVITE with the one in the payload. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">json_str</td><td>The JSON string represntation of the payload</td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">-1</td><td>on failure </td></tr>
    <tr><td class="paramname">0</td><td>on success </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="../../da/d84/res__pjsip__stir__shaken_8c_source.html#l00066">66</a> of file <a class="el" href="../../da/d84/res__pjsip__stir__shaken_8c_source.html">res_pjsip_stir_shaken.c</a>.</p>

<p class="reference">References <a class="el" href="../../df/d98/json_8c_source.html#l00052">ast_json_free()</a>, <a class="el" href="../../df/d98/json_8c_source.html#l00546">ast_json_load_string()</a>, <a class="el" href="../../df/d98/json_8c_source.html#l00397">ast_json_object_get()</a>, <a class="el" href="../../df/d98/json_8c_source.html#l00273">ast_json_string_get()</a>, <a class="el" href="../../dc/d7f/resample_8c_source.html#l00096">NULL</a>, and <a class="el" href="../../d5/d60/utils_8h_source.html#l00911">RAII_VAR</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../da/d84/res__pjsip__stir__shaken_8c_source.html#l00122">stir_shaken_incoming_request()</a>.</p>
<div class="fragment"><div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;{</div><div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;   <a class="code" href="../../d5/d60/utils_8h.html#a1604b4d72144dd3d9f7da668e90337e9">RAII_VAR</a>(<span class="keyword">struct</span> <a class="code" href="../../d1/da1/structast__json.html">ast_json</a> *, json, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../d4/d05/json_8h.html#a38eea5afa847432f7c10af8e69fb013e">ast_json_free</a>);</div><div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;   <span class="keywordtype">char</span> *caller_id_other;</div><div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;</div><div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;   json = <a class="code" href="../../d4/d05/json_8h.html#adca5179982d1f48df7127c123f15ce74">ast_json_load_string</a>(json_str, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div><div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;   caller_id_other = (<span class="keywordtype">char</span> *)<a class="code" href="../../d4/d05/json_8h.html#a6772fcee88746a9d4f6ec6f240b76dd0">ast_json_string_get</a>(<a class="code" href="../../d4/d05/json_8h.html#a53707225c3bf831e263245c6e3800676">ast_json_object_get</a>(</div><div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;      <a class="code" href="../../d4/d05/json_8h.html#a53707225c3bf831e263245c6e3800676">ast_json_object_get</a>(json, <span class="stringliteral">&quot;orig&quot;</span>), <span class="stringliteral">&quot;tn&quot;</span>));</div><div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;</div><div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;   <span class="keywordflow">if</span> (strcmp(caller_id, caller_id_other)) {</div><div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;   }</div><div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;</div><div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;   <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;}</div><div class="ttc" id="json_8h_html_a38eea5afa847432f7c10af8e69fb013e"><div class="ttname"><a href="../../d4/d05/json_8h.html#a38eea5afa847432f7c10af8e69fb013e">ast_json_free</a></div><div class="ttdeci">void ast_json_free(void *p)</div><div class="ttdoc">Asterisk&amp;#39;s custom JSON allocator. Exposed for use by unit tests. </div><div class="ttdef"><b>Definition:</b> <a href="../../df/d98/json_8c_source.html#l00052">json.c:52</a></div></div>
<div class="ttc" id="json_8h_html_adca5179982d1f48df7127c123f15ce74"><div class="ttname"><a href="../../d4/d05/json_8h.html#adca5179982d1f48df7127c123f15ce74">ast_json_load_string</a></div><div class="ttdeci">struct ast_json * ast_json_load_string(const char *input, struct ast_json_error *error)</div><div class="ttdoc">Parse null terminated string into a JSON object or array. </div><div class="ttdef"><b>Definition:</b> <a href="../../df/d98/json_8c_source.html#l00546">json.c:546</a></div></div>
<div class="ttc" id="resample_8c_html_a070d2ce7b6bb7e5c05602aa8c308d0c4"><div class="ttname"><a href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a></div><div class="ttdeci">#define NULL</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d7f/resample_8c_source.html#l00096">resample.c:96</a></div></div>
<div class="ttc" id="utils_8h_html_a1604b4d72144dd3d9f7da668e90337e9"><div class="ttname"><a href="../../d5/d60/utils_8h.html#a1604b4d72144dd3d9f7da668e90337e9">RAII_VAR</a></div><div class="ttdeci">#define RAII_VAR(vartype, varname, initval, dtor)</div><div class="ttdoc">Declare a variable that will call a destructor function when it goes out of scope. </div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d60/utils_8h_source.html#l00911">utils.h:911</a></div></div>
<div class="ttc" id="json_8h_html_a6772fcee88746a9d4f6ec6f240b76dd0"><div class="ttname"><a href="../../d4/d05/json_8h.html#a6772fcee88746a9d4f6ec6f240b76dd0">ast_json_string_get</a></div><div class="ttdeci">const char * ast_json_string_get(const struct ast_json *string)</div><div class="ttdoc">Get the value of a JSON string. </div><div class="ttdef"><b>Definition:</b> <a href="../../df/d98/json_8c_source.html#l00273">json.c:273</a></div></div>
<div class="ttc" id="json_8h_html_a53707225c3bf831e263245c6e3800676"><div class="ttname"><a href="../../d4/d05/json_8h.html#a53707225c3bf831e263245c6e3800676">ast_json_object_get</a></div><div class="ttdeci">struct ast_json * ast_json_object_get(struct ast_json *object, const char *key)</div><div class="ttdoc">Get a field from a JSON object. </div><div class="ttdef"><b>Definition:</b> <a href="../../df/d98/json_8c_source.html#l00397">json.c:397</a></div></div>
<div class="ttc" id="structast__json_html"><div class="ttname"><a href="../../d1/da1/structast__json.html">ast_json</a></div><div class="ttdoc">Abstract JSON element (object, array, string, int, ...). </div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a75df7f7863cbebc09bd89458e652ce1c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a75df7f7863cbebc09bd89458e652ce1c">&#9670;&nbsp;</a></span>compare_timestamp()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int compare_timestamp </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>json_str</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Compare the current timestamp with the one in the payload. If the difference is greater than the signature timeout, it's not valid anymore. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">json_str</td><td>The JSON string representation of the payload</td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">-1</td><td>on failure </td></tr>
    <tr><td class="paramname">0</td><td>on success </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="../../da/d84/res__pjsip__stir__shaken_8c_source.html#l00091">91</a> of file <a class="el" href="../../da/d84/res__pjsip__stir__shaken_8c_source.html">res_pjsip_stir_shaken.c</a>.</p>

<p class="reference">References <a class="el" href="../../d1/d8c/logger_8h_source.html#l00452">ast_debug</a>, <a class="el" href="../../df/d98/json_8c_source.html#l00052">ast_json_free()</a>, <a class="el" href="../../df/d98/json_8c_source.html#l00322">ast_json_integer_get()</a>, <a class="el" href="../../df/d98/json_8c_source.html#l00546">ast_json_load_string()</a>, <a class="el" href="../../df/d98/json_8c_source.html#l00397">ast_json_object_get()</a>, <a class="el" href="../../d9/d2d/res__stir__shaken_8c_source.html#l00203">ast_stir_shaken_get_signature_timeout()</a>, <a class="el" href="../../de/df7/time_8h_source.html#l00150">ast_tvnow()</a>, <a class="el" href="../../dc/d7f/resample_8c_source.html#l00096">NULL</a>, and <a class="el" href="../../d5/d60/utils_8h_source.html#l00911">RAII_VAR</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../da/d84/res__pjsip__stir__shaken_8c_source.html#l00122">stir_shaken_incoming_request()</a>.</p>
<div class="fragment"><div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;{</div><div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;   <a class="code" href="../../d5/d60/utils_8h.html#a1604b4d72144dd3d9f7da668e90337e9">RAII_VAR</a>(<span class="keyword">struct</span> <a class="code" href="../../d1/da1/structast__json.html">ast_json</a> *, json, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../d4/d05/json_8h.html#a38eea5afa847432f7c10af8e69fb013e">ast_json_free</a>);</div><div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;   <span class="keywordtype">long</span> <span class="keywordtype">int</span> timestamp;</div><div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;   <span class="keyword">struct </span>timeval now = <a class="code" href="../../de/df7/time_8h.html#ad3899efb6f0e348556ef69f5b16aa7f7">ast_tvnow</a>();</div><div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;</div><div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;<span class="preprocessor">#ifdef TEST_FRAMEWORK</span></div><div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;   <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(3, <span class="stringliteral">&quot;Ignoring STIR/SHAKEN timestamp\n&quot;</span>);</div><div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;   <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;</div><div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;   json = <a class="code" href="../../d4/d05/json_8h.html#adca5179982d1f48df7127c123f15ce74">ast_json_load_string</a>(json_str, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div><div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;   timestamp = <a class="code" href="../../d4/d05/json_8h.html#ad20fdcbab1ed5c078284a687cced2877">ast_json_integer_get</a>(<a class="code" href="../../d4/d05/json_8h.html#a53707225c3bf831e263245c6e3800676">ast_json_object_get</a>(json, <span class="stringliteral">&quot;iat&quot;</span>));</div><div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;</div><div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;   <span class="keywordflow">if</span> (now.tv_sec - timestamp &gt; <a class="code" href="../../d2/db7/res__stir__shaken_8h.html#a48e5109a0465759e8c374218a844fcae">ast_stir_shaken_get_signature_timeout</a>()) {</div><div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;   }</div><div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;</div><div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;   <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;}</div><div class="ttc" id="json_8h_html_a38eea5afa847432f7c10af8e69fb013e"><div class="ttname"><a href="../../d4/d05/json_8h.html#a38eea5afa847432f7c10af8e69fb013e">ast_json_free</a></div><div class="ttdeci">void ast_json_free(void *p)</div><div class="ttdoc">Asterisk&amp;#39;s custom JSON allocator. Exposed for use by unit tests. </div><div class="ttdef"><b>Definition:</b> <a href="../../df/d98/json_8c_source.html#l00052">json.c:52</a></div></div>
<div class="ttc" id="res__stir__shaken_8h_html_a48e5109a0465759e8c374218a844fcae"><div class="ttname"><a href="../../d2/db7/res__stir__shaken_8h.html#a48e5109a0465759e8c374218a844fcae">ast_stir_shaken_get_signature_timeout</a></div><div class="ttdeci">unsigned int ast_stir_shaken_get_signature_timeout(void)</div><div class="ttdoc">Retrieve the value for &amp;#39;signature_timeout&amp;#39; from &amp;#39;general&amp;#39; config object. </div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d2d/res__stir__shaken_8c_source.html#l00203">res_stir_shaken.c:203</a></div></div>
<div class="ttc" id="time_8h_html_ad3899efb6f0e348556ef69f5b16aa7f7"><div class="ttname"><a href="../../de/df7/time_8h.html#ad3899efb6f0e348556ef69f5b16aa7f7">ast_tvnow</a></div><div class="ttdeci">struct timeval ast_tvnow(void)</div><div class="ttdoc">Returns current timeval. Meant to replace calls to gettimeofday(). </div><div class="ttdef"><b>Definition:</b> <a href="../../de/df7/time_8h_source.html#l00150">time.h:150</a></div></div>
<div class="ttc" id="json_8h_html_adca5179982d1f48df7127c123f15ce74"><div class="ttname"><a href="../../d4/d05/json_8h.html#adca5179982d1f48df7127c123f15ce74">ast_json_load_string</a></div><div class="ttdeci">struct ast_json * ast_json_load_string(const char *input, struct ast_json_error *error)</div><div class="ttdoc">Parse null terminated string into a JSON object or array. </div><div class="ttdef"><b>Definition:</b> <a href="../../df/d98/json_8c_source.html#l00546">json.c:546</a></div></div>
<div class="ttc" id="resample_8c_html_a070d2ce7b6bb7e5c05602aa8c308d0c4"><div class="ttname"><a href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a></div><div class="ttdeci">#define NULL</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d7f/resample_8c_source.html#l00096">resample.c:96</a></div></div>
<div class="ttc" id="logger_8h_html_a3f248112c8d6ce7e3959aa723dade648"><div class="ttname"><a href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a></div><div class="ttdeci">#define ast_debug(level,...)</div><div class="ttdoc">Log a DEBUG message. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d8c/logger_8h_source.html#l00452">logger.h:452</a></div></div>
<div class="ttc" id="utils_8h_html_a1604b4d72144dd3d9f7da668e90337e9"><div class="ttname"><a href="../../d5/d60/utils_8h.html#a1604b4d72144dd3d9f7da668e90337e9">RAII_VAR</a></div><div class="ttdeci">#define RAII_VAR(vartype, varname, initval, dtor)</div><div class="ttdoc">Declare a variable that will call a destructor function when it goes out of scope. </div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d60/utils_8h_source.html#l00911">utils.h:911</a></div></div>
<div class="ttc" id="json_8h_html_a53707225c3bf831e263245c6e3800676"><div class="ttname"><a href="../../d4/d05/json_8h.html#a53707225c3bf831e263245c6e3800676">ast_json_object_get</a></div><div class="ttdeci">struct ast_json * ast_json_object_get(struct ast_json *object, const char *key)</div><div class="ttdoc">Get a field from a JSON object. </div><div class="ttdef"><b>Definition:</b> <a href="../../df/d98/json_8c_source.html#l00397">json.c:397</a></div></div>
<div class="ttc" id="structast__json_html"><div class="ttname"><a href="../../d1/da1/structast__json.html">ast_json</a></div><div class="ttdoc">Abstract JSON element (object, array, string, int, ...). </div></div>
<div class="ttc" id="json_8h_html_ad20fdcbab1ed5c078284a687cced2877"><div class="ttname"><a href="../../d4/d05/json_8h.html#ad20fdcbab1ed5c078284a687cced2877">ast_json_integer_get</a></div><div class="ttdeci">intmax_t ast_json_integer_get(const struct ast_json *integer)</div><div class="ttdoc">Get the value from a JSON integer. </div><div class="ttdef"><b>Definition:</b> <a href="../../df/d98/json_8c_source.html#l00322">json.c:322</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a730d4ecb068b716bda32617440fcf8ea"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a730d4ecb068b716bda32617440fcf8ea">&#9670;&nbsp;</a></span>get_attestation_from_payload()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static char* get_attestation_from_payload </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>json_str</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Get the attestation from the payload. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">json_str</td><td>The JSON string representation of the payload</td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">Empty</td><td>string on failure </td></tr>
    <tr><td class="paramname">The</td><td>attestation on success </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="../../da/d84/res__pjsip__stir__shaken_8c_source.html#l00043">43</a> of file <a class="el" href="../../da/d84/res__pjsip__stir__shaken_8c_source.html">res_pjsip_stir_shaken.c</a>.</p>

<p class="reference">References <a class="el" href="../../df/d98/json_8c_source.html#l00052">ast_json_free()</a>, <a class="el" href="../../df/d98/json_8c_source.html#l00546">ast_json_load_string()</a>, <a class="el" href="../../df/d98/json_8c_source.html#l00397">ast_json_object_get()</a>, <a class="el" href="../../df/d98/json_8c_source.html#l00273">ast_json_string_get()</a>, <a class="el" href="../../d6/d90/strings_8h_source.html#l00052">ast_strlen_zero</a>, <a class="el" href="../../dc/d7f/resample_8c_source.html#l00096">NULL</a>, and <a class="el" href="../../d5/d60/utils_8h_source.html#l00911">RAII_VAR</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../da/d84/res__pjsip__stir__shaken_8c_source.html#l00122">stir_shaken_incoming_request()</a>.</p>
<div class="fragment"><div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;{</div><div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;   <a class="code" href="../../d5/d60/utils_8h.html#a1604b4d72144dd3d9f7da668e90337e9">RAII_VAR</a>(<span class="keyword">struct</span> <a class="code" href="../../d1/da1/structast__json.html">ast_json</a> *, json, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../d4/d05/json_8h.html#a38eea5afa847432f7c10af8e69fb013e">ast_json_free</a>);</div><div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;   <span class="keywordtype">char</span> *attestation;</div><div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;</div><div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;   json = <a class="code" href="../../d4/d05/json_8h.html#adca5179982d1f48df7127c123f15ce74">ast_json_load_string</a>(json_str, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div><div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;   attestation = (<span class="keywordtype">char</span> *)<a class="code" href="../../d4/d05/json_8h.html#a6772fcee88746a9d4f6ec6f240b76dd0">ast_json_string_get</a>(<a class="code" href="../../d4/d05/json_8h.html#a53707225c3bf831e263245c6e3800676">ast_json_object_get</a>(json, <span class="stringliteral">&quot;attest&quot;</span>));</div><div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;</div><div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;   <span class="keywordflow">if</span> (!<a class="code" href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a>(attestation)) {</div><div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;      <span class="keywordflow">return</span> attestation;</div><div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;   }</div><div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;</div><div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;   <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;</div><div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;}</div><div class="ttc" id="json_8h_html_a38eea5afa847432f7c10af8e69fb013e"><div class="ttname"><a href="../../d4/d05/json_8h.html#a38eea5afa847432f7c10af8e69fb013e">ast_json_free</a></div><div class="ttdeci">void ast_json_free(void *p)</div><div class="ttdoc">Asterisk&amp;#39;s custom JSON allocator. Exposed for use by unit tests. </div><div class="ttdef"><b>Definition:</b> <a href="../../df/d98/json_8c_source.html#l00052">json.c:52</a></div></div>
<div class="ttc" id="json_8h_html_adca5179982d1f48df7127c123f15ce74"><div class="ttname"><a href="../../d4/d05/json_8h.html#adca5179982d1f48df7127c123f15ce74">ast_json_load_string</a></div><div class="ttdeci">struct ast_json * ast_json_load_string(const char *input, struct ast_json_error *error)</div><div class="ttdoc">Parse null terminated string into a JSON object or array. </div><div class="ttdef"><b>Definition:</b> <a href="../../df/d98/json_8c_source.html#l00546">json.c:546</a></div></div>
<div class="ttc" id="resample_8c_html_a070d2ce7b6bb7e5c05602aa8c308d0c4"><div class="ttname"><a href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a></div><div class="ttdeci">#define NULL</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d7f/resample_8c_source.html#l00096">resample.c:96</a></div></div>
<div class="ttc" id="strings_8h_html_a372554b7a2d69a8bd3adac5157672036"><div class="ttname"><a href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a></div><div class="ttdeci">#define ast_strlen_zero(foo)</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d90/strings_8h_source.html#l00052">strings.h:52</a></div></div>
<div class="ttc" id="utils_8h_html_a1604b4d72144dd3d9f7da668e90337e9"><div class="ttname"><a href="../../d5/d60/utils_8h.html#a1604b4d72144dd3d9f7da668e90337e9">RAII_VAR</a></div><div class="ttdeci">#define RAII_VAR(vartype, varname, initval, dtor)</div><div class="ttdoc">Declare a variable that will call a destructor function when it goes out of scope. </div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d60/utils_8h_source.html#l00911">utils.h:911</a></div></div>
<div class="ttc" id="json_8h_html_a6772fcee88746a9d4f6ec6f240b76dd0"><div class="ttname"><a href="../../d4/d05/json_8h.html#a6772fcee88746a9d4f6ec6f240b76dd0">ast_json_string_get</a></div><div class="ttdeci">const char * ast_json_string_get(const struct ast_json *string)</div><div class="ttdoc">Get the value of a JSON string. </div><div class="ttdef"><b>Definition:</b> <a href="../../df/d98/json_8c_source.html#l00273">json.c:273</a></div></div>
<div class="ttc" id="json_8h_html_a53707225c3bf831e263245c6e3800676"><div class="ttname"><a href="../../d4/d05/json_8h.html#a53707225c3bf831e263245c6e3800676">ast_json_object_get</a></div><div class="ttdeci">struct ast_json * ast_json_object_get(struct ast_json *object, const char *key)</div><div class="ttdoc">Get a field from a JSON object. </div><div class="ttdef"><b>Definition:</b> <a href="../../df/d98/json_8c_source.html#l00397">json.c:397</a></div></div>
<div class="ttc" id="structast__json_html"><div class="ttname"><a href="../../d1/da1/structast__json.html">ast_json</a></div><div class="ttdoc">Abstract JSON element (object, array, string, int, ...). </div></div>
</div><!-- fragment -->
</div>
</div>
<a id="ac3382bf6da54c56b37069bd76bbdf4f9"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac3382bf6da54c56b37069bd76bbdf4f9">&#9670;&nbsp;</a></span>load_module()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int load_module </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="../../da/d84/res__pjsip__stir__shaken_8c_source.html#l00366">366</a> of file <a class="el" href="../../da/d84/res__pjsip__stir__shaken_8c_source.html">res_pjsip_stir_shaken.c</a>.</p>

<p class="reference">References <a class="el" href="../../d5/d16/module_8h_source.html#l00070">AST_MODULE_LOAD_SUCCESS</a>, and <a class="el" href="../../d9/de7/res__pjsip__session_8h_source.html#l00616">ast_sip_session_register_supplement</a>.</p>
<div class="fragment"><div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;{</div><div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;   <a class="code" href="../../d9/de7/res__pjsip__session_8h.html#aa21df5d2fdfb2d6e2734a3056ec3db7c">ast_sip_session_register_supplement</a>(&amp;<a class="code" href="../../da/d84/res__pjsip__stir__shaken_8c.html#ab5dadd4061795ec68a0136ee0998e9ca">stir_shaken_supplement</a>);</div><div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;   <span class="keywordflow">return</span> <a class="code" href="../../d5/d16/module_8h.html#adc09474f0ff557e9925b722ee5b952dfa89bb877ade9ce418ad6663f3d936f314">AST_MODULE_LOAD_SUCCESS</a>;</div><div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;}</div><div class="ttc" id="module_8h_html_adc09474f0ff557e9925b722ee5b952dfa89bb877ade9ce418ad6663f3d936f314"><div class="ttname"><a href="../../d5/d16/module_8h.html#adc09474f0ff557e9925b722ee5b952dfa89bb877ade9ce418ad6663f3d936f314">AST_MODULE_LOAD_SUCCESS</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d16/module_8h_source.html#l00070">module.h:70</a></div></div>
<div class="ttc" id="res__pjsip__stir__shaken_8c_html_ab5dadd4061795ec68a0136ee0998e9ca"><div class="ttname"><a href="../../da/d84/res__pjsip__stir__shaken_8c.html#ab5dadd4061795ec68a0136ee0998e9ca">stir_shaken_supplement</a></div><div class="ttdeci">static struct ast_sip_session_supplement stir_shaken_supplement</div><div class="ttdef"><b>Definition:</b> <a href="../../da/d84/res__pjsip__stir__shaken_8c_source.html#l00353">res_pjsip_stir_shaken.c:353</a></div></div>
<div class="ttc" id="res__pjsip__session_8h_html_aa21df5d2fdfb2d6e2734a3056ec3db7c"><div class="ttname"><a href="../../d9/de7/res__pjsip__session_8h.html#aa21df5d2fdfb2d6e2734a3056ec3db7c">ast_sip_session_register_supplement</a></div><div class="ttdeci">#define ast_sip_session_register_supplement(supplement)</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/de7/res__pjsip__session_8h_source.html#l00616">res_pjsip_session.h:616</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a5ae7b57d2f58c1261689f0a605afd60f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a5ae7b57d2f58c1261689f0a605afd60f">&#9670;&nbsp;</a></span>stir_shaken_incoming_request()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int stir_shaken_incoming_request </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="../../d2/dec/structast__sip__session.html">ast_sip_session</a> *&#160;</td>
          <td class="paramname"><em>session</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">pjsip_rx_data *&#160;</td>
          <td class="paramname"><em>rdata</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="../../da/d84/res__pjsip__stir__shaken_8c_source.html#l00122">122</a> of file <a class="el" href="../../da/d84/res__pjsip__stir__shaken_8c_source.html">res_pjsip_stir_shaken.c</a>.</p>

<p class="reference">References <a class="el" href="../../de/d1f/main_2utils_8c_source.html#l00448">ast_base64url_decode_string()</a>, <a class="el" href="../../d6/d90/strings_8h_source.html#l00094">ast_begins_with()</a>, <a class="el" href="../../d8/d8a/astmm_8h_source.html#l00182">ast_free</a>, <a class="el" href="../../de/d96/res__pjsip_8c_source.html#l03543">ast_sip_rdata_get_header_value()</a>, <a class="el" href="../../d9/d2d/res__stir__shaken_8c_source.html#l00277">ast_stir_shaken_add_verification()</a>, <a class="el" href="../../d9/d2d/res__stir__shaken_8c_source.html#l00178">ast_stir_shaken_payload_free()</a>, <a class="el" href="../../d9/d2d/res__stir__shaken_8c_source.html#l00620">ast_stir_shaken_verify()</a>, <a class="el" href="../../d2/db7/res__stir__shaken_8h_source.html#l00028">AST_STIR_SHAKEN_VERIFY_MISMATCH</a>, <a class="el" href="../../d2/db7/res__stir__shaken_8h_source.html#l00026">AST_STIR_SHAKEN_VERIFY_NOT_PRESENT</a>, <a class="el" href="../../d2/db7/res__stir__shaken_8h_source.html#l00029">AST_STIR_SHAKEN_VERIFY_PASSED</a>, <a class="el" href="../../d2/db7/res__stir__shaken_8h_source.html#l00027">AST_STIR_SHAKEN_VERIFY_SIGNATURE_FAILED</a>, <a class="el" href="../../d6/d90/strings_8h_source.html#l00052">ast_strlen_zero</a>, <a class="el" href="../../d9/de7/res__pjsip__session_8h_source.html#l00189">ast_sip_session::channel</a>, <a class="el" href="../../da/d84/res__pjsip__stir__shaken_8c_source.html#l00066">compare_caller_id()</a>, <a class="el" href="../../da/d84/res__pjsip__stir__shaken_8c_source.html#l00091">compare_timestamp()</a>, <a class="el" href="../../d9/de7/res__pjsip__session_8h_source.html#l00183">ast_sip_session::endpoint</a>, <a class="el" href="../../da/d84/res__pjsip__stir__shaken_8c_source.html#l00043">get_attestation_from_payload()</a>, <a class="el" href="../../d9/de7/res__pjsip__session_8h_source.html#l00207">ast_sip_session::id</a>, <a class="el" href="../../dc/d7f/resample_8c_source.html#l00096">NULL</a>, <a class="el" href="../../d5/d7b/channel_8h_source.html#l00343">ast_party_id::number</a>, <a class="el" href="../../d9/d2d/res__stir__shaken_8c_source.html#l00164">ast_stir_shaken_payload::payload</a>, <a class="el" href="../../d5/d60/utils_8h_source.html#l00911">RAII_VAR</a>, <a class="el" href="../../d8/d8c/res__pjsip_8h_source.html#l00903">ast_sip_endpoint::stir_shaken</a>, and <a class="el" href="../../d5/d7b/channel_8h_source.html#l00292">ast_party_number::str</a>.</p>
<div class="fragment"><div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;{</div><div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;   <span class="keyword">static</span> <span class="keyword">const</span> pj_str_t identity_str = { <span class="stringliteral">&quot;Identity&quot;</span>, 8 };</div><div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;   <span class="keywordtype">char</span> *identity_hdr_val;</div><div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;   <span class="keywordtype">char</span> *encoded_val;</div><div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../df/d3c/structast__channel.html">ast_channel</a> *chan = session-&gt;<a class="code" href="../../d2/dec/structast__sip__session.html#a48371aaa1ad1144e564ebcd179a2db2e">channel</a>;</div><div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;   <span class="keywordtype">char</span> *caller_id = session-&gt;<a class="code" href="../../d2/dec/structast__sip__session.html#a8791d240f8a9c2dc271a1c8542cfe8cc">id</a>.<a class="code" href="../../d1/dcb/structast__party__id.html#aca2d7de6c89f201dc8bd0a2642d2a352">number</a>.<a class="code" href="../../d6/dbb/structast__party__number.html#ab50d783982593ef993ea0b68f7ad8b80">str</a>;</div><div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;   <a class="code" href="../../d5/d60/utils_8h.html#a1604b4d72144dd3d9f7da668e90337e9">RAII_VAR</a>(<span class="keywordtype">char</span> *, <a class="code" href="../../d5/d65/structheader.html">header</a>, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../d8/d8a/astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>);</div><div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;   <a class="code" href="../../d5/d60/utils_8h.html#a1604b4d72144dd3d9f7da668e90337e9">RAII_VAR</a>(<span class="keywordtype">char</span> *, payload, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../d8/d8a/astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>);</div><div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;   <span class="keywordtype">char</span> *signature;</div><div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;   <span class="keywordtype">char</span> *algorithm;</div><div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;   <span class="keywordtype">char</span> *public_cert_url;</div><div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;   <span class="keywordtype">char</span> *attestation;</div><div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;   <span class="keywordtype">int</span> mismatch = 0;</div><div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d1/d8b/structast__stir__shaken__payload.html">ast_stir_shaken_payload</a> *ss_payload;</div><div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;</div><div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;   <span class="keywordflow">if</span> (!session-&gt;<a class="code" href="../../d2/dec/structast__sip__session.html#a3960205b2a4e7e012dc9f0eae1855f01">endpoint</a>-&gt;<a class="code" href="../../d3/d46/structast__sip__endpoint.html#aa558bb7de8eedb9b11b368b7c8eadb20">stir_shaken</a>) {</div><div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;      <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;   }</div><div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;</div><div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;   identity_hdr_val = <a class="code" href="../../d8/d8c/res__pjsip_8h.html#a8789fca05b6fcb5ca809e7758995959c">ast_sip_rdata_get_header_value</a>(rdata, identity_str);</div><div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a>(identity_hdr_val)) {</div><div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;      <a class="code" href="../../d2/db7/res__stir__shaken_8h.html#a4aa5534cc4b2efccf5cd9624de367c25">ast_stir_shaken_add_verification</a>(chan, caller_id, <span class="stringliteral">&quot;&quot;</span>, <a class="code" href="../../d2/db7/res__stir__shaken_8h.html#a230ddbb49b17c100af2d1d5fc397f9d0a57139df4ed6e2de5edee1a9a333dde20">AST_STIR_SHAKEN_VERIFY_NOT_PRESENT</a>);</div><div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;      <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;   }</div><div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;</div><div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;   encoded_val = strtok_r(identity_hdr_val, <span class="stringliteral">&quot;.&quot;</span>, &amp;identity_hdr_val);</div><div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;   <a class="code" href="../../d5/d65/structheader.html">header</a> = <a class="code" href="../../d5/d60/utils_8h.html#a4296e13b9fbe979767f71d7315b9f66e">ast_base64url_decode_string</a>(encoded_val);</div><div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a>(<a class="code" href="../../d5/d65/structheader.html">header</a>)) {</div><div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;      <a class="code" href="../../d2/db7/res__stir__shaken_8h.html#a4aa5534cc4b2efccf5cd9624de367c25">ast_stir_shaken_add_verification</a>(chan, caller_id, <span class="stringliteral">&quot;&quot;</span>, <a class="code" href="../../d2/db7/res__stir__shaken_8h.html#a230ddbb49b17c100af2d1d5fc397f9d0a5b96508b53c19e20c3961656aaeddcba">AST_STIR_SHAKEN_VERIFY_SIGNATURE_FAILED</a>);</div><div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;      <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;   }</div><div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;</div><div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;   encoded_val = strtok_r(identity_hdr_val, <span class="stringliteral">&quot;.&quot;</span>, &amp;identity_hdr_val);</div><div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;   <a class="code" href="../../d1/d8b/structast__stir__shaken__payload.html#a848d5ae12b5a75efa9c4cf6bf1935639">payload</a> = <a class="code" href="../../d5/d60/utils_8h.html#a4296e13b9fbe979767f71d7315b9f66e">ast_base64url_decode_string</a>(encoded_val);</div><div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a>(<a class="code" href="../../d1/d8b/structast__stir__shaken__payload.html#a848d5ae12b5a75efa9c4cf6bf1935639">payload</a>)) {</div><div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;      <a class="code" href="../../d2/db7/res__stir__shaken_8h.html#a4aa5534cc4b2efccf5cd9624de367c25">ast_stir_shaken_add_verification</a>(chan, caller_id, <span class="stringliteral">&quot;&quot;</span>, <a class="code" href="../../d2/db7/res__stir__shaken_8h.html#a230ddbb49b17c100af2d1d5fc397f9d0a5b96508b53c19e20c3961656aaeddcba">AST_STIR_SHAKEN_VERIFY_SIGNATURE_FAILED</a>);</div><div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;      <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;   }</div><div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;</div><div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;   <span class="comment">/* It&#39;s fine to leave the signature encoded */</span></div><div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;   signature = strtok_r(identity_hdr_val, <span class="stringliteral">&quot;;&quot;</span>, &amp;identity_hdr_val);</div><div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a>(signature)) {</div><div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;      <a class="code" href="../../d2/db7/res__stir__shaken_8h.html#a4aa5534cc4b2efccf5cd9624de367c25">ast_stir_shaken_add_verification</a>(chan, caller_id, <span class="stringliteral">&quot;&quot;</span>, <a class="code" href="../../d2/db7/res__stir__shaken_8h.html#a230ddbb49b17c100af2d1d5fc397f9d0a5b96508b53c19e20c3961656aaeddcba">AST_STIR_SHAKEN_VERIFY_SIGNATURE_FAILED</a>);</div><div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;      <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;   }</div><div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;</div><div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;   <span class="comment">/* Trim &quot;info=&lt;&quot; to get public cert URL */</span></div><div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;   strtok_r(identity_hdr_val, <span class="stringliteral">&quot;&lt;&quot;</span>, &amp;identity_hdr_val);</div><div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;   public_cert_url = strtok_r(identity_hdr_val, <span class="stringliteral">&quot;&gt;&quot;</span>, &amp;identity_hdr_val);</div><div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a>(public_cert_url)) {</div><div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;      <a class="code" href="../../d2/db7/res__stir__shaken_8h.html#a4aa5534cc4b2efccf5cd9624de367c25">ast_stir_shaken_add_verification</a>(chan, caller_id, <span class="stringliteral">&quot;&quot;</span>, <a class="code" href="../../d2/db7/res__stir__shaken_8h.html#a230ddbb49b17c100af2d1d5fc397f9d0a5b96508b53c19e20c3961656aaeddcba">AST_STIR_SHAKEN_VERIFY_SIGNATURE_FAILED</a>);</div><div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;      <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;   }</div><div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;</div><div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;   <span class="comment">/* Make sure the public URL is actually a URL */</span></div><div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;   <span class="keywordflow">if</span> (!<a class="code" href="../../d6/d90/strings_8h.html#ac51fa66c90ce950b248c9ff3e8c4e453">ast_begins_with</a>(public_cert_url, <span class="stringliteral">&quot;http&quot;</span>)) {</div><div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;      <a class="code" href="../../d2/db7/res__stir__shaken_8h.html#a4aa5534cc4b2efccf5cd9624de367c25">ast_stir_shaken_add_verification</a>(chan, caller_id, <span class="stringliteral">&quot;&quot;</span>, <a class="code" href="../../d2/db7/res__stir__shaken_8h.html#a230ddbb49b17c100af2d1d5fc397f9d0a5b96508b53c19e20c3961656aaeddcba">AST_STIR_SHAKEN_VERIFY_SIGNATURE_FAILED</a>);</div><div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;      <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;   }</div><div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;</div><div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;   algorithm = strtok_r(identity_hdr_val, <span class="stringliteral">&quot;;&quot;</span>, &amp;identity_hdr_val);</div><div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a>(algorithm)) {</div><div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;      <a class="code" href="../../d2/db7/res__stir__shaken_8h.html#a4aa5534cc4b2efccf5cd9624de367c25">ast_stir_shaken_add_verification</a>(chan, caller_id, <span class="stringliteral">&quot;&quot;</span>, <a class="code" href="../../d2/db7/res__stir__shaken_8h.html#a230ddbb49b17c100af2d1d5fc397f9d0a5b96508b53c19e20c3961656aaeddcba">AST_STIR_SHAKEN_VERIFY_SIGNATURE_FAILED</a>);</div><div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;      <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;   }</div><div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;</div><div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;   attestation = <a class="code" href="../../da/d84/res__pjsip__stir__shaken_8c.html#a730d4ecb068b716bda32617440fcf8ea">get_attestation_from_payload</a>(<a class="code" href="../../d1/d8b/structast__stir__shaken__payload.html#a848d5ae12b5a75efa9c4cf6bf1935639">payload</a>);</div><div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;</div><div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;   ss_payload = <a class="code" href="../../d2/db7/res__stir__shaken_8h.html#ab278c30830333da943d6dfd5332d978a">ast_stir_shaken_verify</a>(<a class="code" href="../../d5/d65/structheader.html">header</a>, <a class="code" href="../../d1/d8b/structast__stir__shaken__payload.html#a848d5ae12b5a75efa9c4cf6bf1935639">payload</a>, signature, algorithm, public_cert_url);</div><div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;   <span class="keywordflow">if</span> (!ss_payload) {</div><div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;      <a class="code" href="../../d2/db7/res__stir__shaken_8h.html#a4aa5534cc4b2efccf5cd9624de367c25">ast_stir_shaken_add_verification</a>(chan, caller_id, attestation, <a class="code" href="../../d2/db7/res__stir__shaken_8h.html#a230ddbb49b17c100af2d1d5fc397f9d0a5b96508b53c19e20c3961656aaeddcba">AST_STIR_SHAKEN_VERIFY_SIGNATURE_FAILED</a>);</div><div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;      <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;   }</div><div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;   <a class="code" href="../../d2/db7/res__stir__shaken_8h.html#a2cc390b9c52dc61196df9bb674f13b23">ast_stir_shaken_payload_free</a>(ss_payload);</div><div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;</div><div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;   mismatch |= <a class="code" href="../../da/d84/res__pjsip__stir__shaken_8c.html#a4c87764448ebe4e4319625ce6c413055">compare_caller_id</a>(caller_id, <a class="code" href="../../d1/d8b/structast__stir__shaken__payload.html#a848d5ae12b5a75efa9c4cf6bf1935639">payload</a>);</div><div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;   mismatch |= <a class="code" href="../../da/d84/res__pjsip__stir__shaken_8c.html#a75df7f7863cbebc09bd89458e652ce1c">compare_timestamp</a>(<a class="code" href="../../d1/d8b/structast__stir__shaken__payload.html#a848d5ae12b5a75efa9c4cf6bf1935639">payload</a>);</div><div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;</div><div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;   <span class="keywordflow">if</span> (mismatch) {</div><div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;      <a class="code" href="../../d2/db7/res__stir__shaken_8h.html#a4aa5534cc4b2efccf5cd9624de367c25">ast_stir_shaken_add_verification</a>(chan, caller_id, attestation, <a class="code" href="../../d2/db7/res__stir__shaken_8h.html#a230ddbb49b17c100af2d1d5fc397f9d0a036497dd5292f9bfa00805027be73c7e">AST_STIR_SHAKEN_VERIFY_MISMATCH</a>);</div><div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;      <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;   }</div><div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;</div><div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;   <a class="code" href="../../d2/db7/res__stir__shaken_8h.html#a4aa5534cc4b2efccf5cd9624de367c25">ast_stir_shaken_add_verification</a>(chan, caller_id, attestation, <a class="code" href="../../d2/db7/res__stir__shaken_8h.html#a230ddbb49b17c100af2d1d5fc397f9d0ae9480fab55d60d33b1944fcc4f174798">AST_STIR_SHAKEN_VERIFY_PASSED</a>);</div><div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;</div><div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;   <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;}</div><div class="ttc" id="res__stir__shaken_8h_html_a230ddbb49b17c100af2d1d5fc397f9d0ae9480fab55d60d33b1944fcc4f174798"><div class="ttname"><a href="../../d2/db7/res__stir__shaken_8h.html#a230ddbb49b17c100af2d1d5fc397f9d0ae9480fab55d60d33b1944fcc4f174798">AST_STIR_SHAKEN_VERIFY_PASSED</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d2/db7/res__stir__shaken_8h_source.html#l00029">res_stir_shaken.h:29</a></div></div>
<div class="ttc" id="structast__channel_html"><div class="ttname"><a href="../../df/d3c/structast__channel.html">ast_channel</a></div><div class="ttdoc">Main Channel structure associated with a channel. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/de2/channel__internal__api_8c_source.html#l00073">channel_internal_api.c:73</a></div></div>
<div class="ttc" id="structast__sip__session_html_a3960205b2a4e7e012dc9f0eae1855f01"><div class="ttname"><a href="../../d2/dec/structast__sip__session.html#a3960205b2a4e7e012dc9f0eae1855f01">ast_sip_session::endpoint</a></div><div class="ttdeci">struct ast_sip_endpoint * endpoint</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/de7/res__pjsip__session_8h_source.html#l00183">res_pjsip_session.h:183</a></div></div>
<div class="ttc" id="utils_8h_html_a4296e13b9fbe979767f71d7315b9f66e"><div class="ttname"><a href="../../d5/d60/utils_8h.html#a4296e13b9fbe979767f71d7315b9f66e">ast_base64url_decode_string</a></div><div class="ttdeci">char * ast_base64url_decode_string(const char *src)</div><div class="ttdoc">Decode string from base64 URL. </div><div class="ttdef"><b>Definition:</b> <a href="../../de/d1f/main_2utils_8c_source.html#l00448">main/utils.c:448</a></div></div>
<div class="ttc" id="structast__party__number_html_ab50d783982593ef993ea0b68f7ad8b80"><div class="ttname"><a href="../../d6/dbb/structast__party__number.html#ab50d783982593ef993ea0b68f7ad8b80">ast_party_number::str</a></div><div class="ttdeci">char * str</div><div class="ttdoc">Subscriber phone number (Malloced) </div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d7b/channel_8h_source.html#l00292">channel.h:292</a></div></div>
<div class="ttc" id="resample_8c_html_a070d2ce7b6bb7e5c05602aa8c308d0c4"><div class="ttname"><a href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a></div><div class="ttdeci">#define NULL</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d7f/resample_8c_source.html#l00096">resample.c:96</a></div></div>
<div class="ttc" id="res__stir__shaken_8h_html_a230ddbb49b17c100af2d1d5fc397f9d0a57139df4ed6e2de5edee1a9a333dde20"><div class="ttname"><a href="../../d2/db7/res__stir__shaken_8h.html#a230ddbb49b17c100af2d1d5fc397f9d0a57139df4ed6e2de5edee1a9a333dde20">AST_STIR_SHAKEN_VERIFY_NOT_PRESENT</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d2/db7/res__stir__shaken_8h_source.html#l00026">res_stir_shaken.h:26</a></div></div>
<div class="ttc" id="strings_8h_html_a372554b7a2d69a8bd3adac5157672036"><div class="ttname"><a href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a></div><div class="ttdeci">#define ast_strlen_zero(foo)</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d90/strings_8h_source.html#l00052">strings.h:52</a></div></div>
<div class="ttc" id="res__pjsip_8h_html_a8789fca05b6fcb5ca809e7758995959c"><div class="ttname"><a href="../../d8/d8c/res__pjsip_8h.html#a8789fca05b6fcb5ca809e7758995959c">ast_sip_rdata_get_header_value</a></div><div class="ttdeci">char * ast_sip_rdata_get_header_value(pjsip_rx_data *rdata, const pj_str_t str)</div><div class="ttdoc">Get a specific header value from rdata. </div><div class="ttdef"><b>Definition:</b> <a href="../../de/d96/res__pjsip_8c_source.html#l03543">res_pjsip.c:3543</a></div></div>
<div class="ttc" id="utils_8h_html_a1604b4d72144dd3d9f7da668e90337e9"><div class="ttname"><a href="../../d5/d60/utils_8h.html#a1604b4d72144dd3d9f7da668e90337e9">RAII_VAR</a></div><div class="ttdeci">#define RAII_VAR(vartype, varname, initval, dtor)</div><div class="ttdoc">Declare a variable that will call a destructor function when it goes out of scope. </div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d60/utils_8h_source.html#l00911">utils.h:911</a></div></div>
<div class="ttc" id="res__pjsip__stir__shaken_8c_html_a75df7f7863cbebc09bd89458e652ce1c"><div class="ttname"><a href="../../da/d84/res__pjsip__stir__shaken_8c.html#a75df7f7863cbebc09bd89458e652ce1c">compare_timestamp</a></div><div class="ttdeci">static int compare_timestamp(const char *json_str)</div><div class="ttdoc">Compare the current timestamp with the one in the payload. If the difference is greater than the sign...</div><div class="ttdef"><b>Definition:</b> <a href="../../da/d84/res__pjsip__stir__shaken_8c_source.html#l00091">res_pjsip_stir_shaken.c:91</a></div></div>
<div class="ttc" id="structast__sip__session_html_a48371aaa1ad1144e564ebcd179a2db2e"><div class="ttname"><a href="../../d2/dec/structast__sip__session.html#a48371aaa1ad1144e564ebcd179a2db2e">ast_sip_session::channel</a></div><div class="ttdeci">struct ast_channel * channel</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/de7/res__pjsip__session_8h_source.html#l00189">res_pjsip_session.h:189</a></div></div>
<div class="ttc" id="res__pjsip__stir__shaken_8c_html_a730d4ecb068b716bda32617440fcf8ea"><div class="ttname"><a href="../../da/d84/res__pjsip__stir__shaken_8c.html#a730d4ecb068b716bda32617440fcf8ea">get_attestation_from_payload</a></div><div class="ttdeci">static char * get_attestation_from_payload(const char *json_str)</div><div class="ttdoc">Get the attestation from the payload. </div><div class="ttdef"><b>Definition:</b> <a href="../../da/d84/res__pjsip__stir__shaken_8c_source.html#l00043">res_pjsip_stir_shaken.c:43</a></div></div>
<div class="ttc" id="res__stir__shaken_8h_html_ab278c30830333da943d6dfd5332d978a"><div class="ttname"><a href="../../d2/db7/res__stir__shaken_8h.html#ab278c30830333da943d6dfd5332d978a">ast_stir_shaken_verify</a></div><div class="ttdeci">struct ast_stir_shaken_payload * ast_stir_shaken_verify(const char *header, const char *payload, const char *signature, const char *algorithm, const char *public_cert_url)</div><div class="ttdoc">Verify a JSON STIR/SHAKEN payload. </div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d2d/res__stir__shaken_8c_source.html#l00620">res_stir_shaken.c:620</a></div></div>
<div class="ttc" id="res__stir__shaken_8h_html_a4aa5534cc4b2efccf5cd9624de367c25"><div class="ttname"><a href="../../d2/db7/res__stir__shaken_8h.html#a4aa5534cc4b2efccf5cd9624de367c25">ast_stir_shaken_add_verification</a></div><div class="ttdeci">int ast_stir_shaken_add_verification(struct ast_channel *chan, const char *identity, const char *attestation, enum ast_stir_shaken_verification_result result)</div><div class="ttdoc">Add a STIR/SHAKEN verification result to a channel. </div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d2d/res__stir__shaken_8c_source.html#l00277">res_stir_shaken.c:277</a></div></div>
<div class="ttc" id="astmm_8h_html_a402072d6789f6ed9e3a81da27504127e"><div class="ttname"><a href="../../d8/d8a/astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a></div><div class="ttdeci">#define ast_free(a)</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d8a/astmm_8h_source.html#l00182">astmm.h:182</a></div></div>
<div class="ttc" id="structast__stir__shaken__payload_html"><div class="ttname"><a href="../../d1/d8b/structast__stir__shaken__payload.html">ast_stir_shaken_payload</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d2d/res__stir__shaken_8c_source.html#l00160">res_stir_shaken.c:160</a></div></div>
<div class="ttc" id="structheader_html"><div class="ttname"><a href="../../d5/d65/structheader.html">header</a></div><div class="ttdef"><b>Definition:</b> <a href="../../db/d73/pjsip__global__headers_8c_source.html#l00047">pjsip_global_headers.c:47</a></div></div>
<div class="ttc" id="res__stir__shaken_8h_html_a230ddbb49b17c100af2d1d5fc397f9d0a5b96508b53c19e20c3961656aaeddcba"><div class="ttname"><a href="../../d2/db7/res__stir__shaken_8h.html#a230ddbb49b17c100af2d1d5fc397f9d0a5b96508b53c19e20c3961656aaeddcba">AST_STIR_SHAKEN_VERIFY_SIGNATURE_FAILED</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d2/db7/res__stir__shaken_8h_source.html#l00027">res_stir_shaken.h:27</a></div></div>
<div class="ttc" id="structast__stir__shaken__payload_html_a848d5ae12b5a75efa9c4cf6bf1935639"><div class="ttname"><a href="../../d1/d8b/structast__stir__shaken__payload.html#a848d5ae12b5a75efa9c4cf6bf1935639">ast_stir_shaken_payload::payload</a></div><div class="ttdeci">struct ast_json * payload</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d2d/res__stir__shaken_8c_source.html#l00164">res_stir_shaken.c:164</a></div></div>
<div class="ttc" id="res__stir__shaken_8h_html_a230ddbb49b17c100af2d1d5fc397f9d0a036497dd5292f9bfa00805027be73c7e"><div class="ttname"><a href="../../d2/db7/res__stir__shaken_8h.html#a230ddbb49b17c100af2d1d5fc397f9d0a036497dd5292f9bfa00805027be73c7e">AST_STIR_SHAKEN_VERIFY_MISMATCH</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d2/db7/res__stir__shaken_8h_source.html#l00028">res_stir_shaken.h:28</a></div></div>
<div class="ttc" id="res__pjsip__stir__shaken_8c_html_a4c87764448ebe4e4319625ce6c413055"><div class="ttname"><a href="../../da/d84/res__pjsip__stir__shaken_8c.html#a4c87764448ebe4e4319625ce6c413055">compare_caller_id</a></div><div class="ttdeci">static int compare_caller_id(char *caller_id, const char *json_str)</div><div class="ttdoc">Compare the caller ID from the INVITE with the one in the payload. </div><div class="ttdef"><b>Definition:</b> <a href="../../da/d84/res__pjsip__stir__shaken_8c_source.html#l00066">res_pjsip_stir_shaken.c:66</a></div></div>
<div class="ttc" id="strings_8h_html_ac51fa66c90ce950b248c9ff3e8c4e453"><div class="ttname"><a href="../../d6/d90/strings_8h.html#ac51fa66c90ce950b248c9ff3e8c4e453">ast_begins_with</a></div><div class="ttdeci">static int force_inline attribute_pure ast_begins_with(const char *str, const char *prefix)</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d90/strings_8h_source.html#l00094">strings.h:94</a></div></div>
<div class="ttc" id="res__stir__shaken_8h_html_a2cc390b9c52dc61196df9bb674f13b23"><div class="ttname"><a href="../../d2/db7/res__stir__shaken_8h.html#a2cc390b9c52dc61196df9bb674f13b23">ast_stir_shaken_payload_free</a></div><div class="ttdeci">void ast_stir_shaken_payload_free(struct ast_stir_shaken_payload *payload)</div><div class="ttdoc">Free a STIR/SHAKEN payload. </div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d2d/res__stir__shaken_8c_source.html#l00178">res_stir_shaken.c:178</a></div></div>
<div class="ttc" id="structast__sip__endpoint_html_aa558bb7de8eedb9b11b368b7c8eadb20"><div class="ttname"><a href="../../d3/d46/structast__sip__endpoint.html#aa558bb7de8eedb9b11b368b7c8eadb20">ast_sip_endpoint::stir_shaken</a></div><div class="ttdeci">unsigned int stir_shaken</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d8c/res__pjsip_8h_source.html#l00903">res_pjsip.h:903</a></div></div>
<div class="ttc" id="structast__sip__session_html_a8791d240f8a9c2dc271a1c8542cfe8cc"><div class="ttname"><a href="../../d2/dec/structast__sip__session.html#a8791d240f8a9c2dc271a1c8542cfe8cc">ast_sip_session::id</a></div><div class="ttdeci">struct ast_party_id id</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/de7/res__pjsip__session_8h_source.html#l00207">res_pjsip_session.h:207</a></div></div>
<div class="ttc" id="structast__party__id_html_aca2d7de6c89f201dc8bd0a2642d2a352"><div class="ttname"><a href="../../d1/dcb/structast__party__id.html#aca2d7de6c89f201dc8bd0a2642d2a352">ast_party_id::number</a></div><div class="ttdeci">struct ast_party_number number</div><div class="ttdoc">Subscriber phone number. </div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d7b/channel_8h_source.html#l00343">channel.h:343</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a37f6665c717cf7d52187eb495456863c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a37f6665c717cf7d52187eb495456863c">&#9670;&nbsp;</a></span>stir_shaken_outgoing_request()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void stir_shaken_outgoing_request </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="../../d2/dec/structast__sip__session.html">ast_sip_session</a> *&#160;</td>
          <td class="paramname"><em>session</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">pjsip_tx_data *&#160;</td>
          <td class="paramname"><em>tdata</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="../../da/d84/res__pjsip__stir__shaken_8c_source.html#l00334">334</a> of file <a class="el" href="../../da/d84/res__pjsip__stir__shaken_8c_source.html">res_pjsip_stir_shaken.c</a>.</p>

<p class="reference">References <a class="el" href="../../da/d84/res__pjsip__stir__shaken_8c_source.html#l00320">add_date_header()</a>, <a class="el" href="../../da/d84/res__pjsip__stir__shaken_8c_source.html#l00211">add_identity_header()</a>, <a class="el" href="../../d6/d90/strings_8h_source.html#l00052">ast_strlen_zero</a>, <a class="el" href="../../d9/de7/res__pjsip__session_8h_source.html#l00183">ast_sip_session::endpoint</a>, <a class="el" href="../../d9/de7/res__pjsip__session_8h_source.html#l00207">ast_sip_session::id</a>, <a class="el" href="../../d5/d7b/channel_8h_source.html#l00343">ast_party_id::number</a>, <a class="el" href="../../d8/d8c/res__pjsip_8h_source.html#l00903">ast_sip_endpoint::stir_shaken</a>, <a class="el" href="../../d5/d7b/channel_8h_source.html#l00292">ast_party_number::str</a>, and <a class="el" href="../../d5/d7b/channel_8h_source.html#l00298">ast_party_number::valid</a>.</p>
<div class="fragment"><div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;{</div><div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;   <span class="keywordflow">if</span> (!session-&gt;<a class="code" href="../../d2/dec/structast__sip__session.html#a3960205b2a4e7e012dc9f0eae1855f01">endpoint</a>-&gt;<a class="code" href="../../d3/d46/structast__sip__endpoint.html#aa558bb7de8eedb9b11b368b7c8eadb20">stir_shaken</a>) {</div><div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;      <span class="keywordflow">return</span>;</div><div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;   }</div><div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;</div><div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a>(session-&gt;<a class="code" href="../../d2/dec/structast__sip__session.html#a8791d240f8a9c2dc271a1c8542cfe8cc">id</a>.<a class="code" href="../../d1/dcb/structast__party__id.html#aca2d7de6c89f201dc8bd0a2642d2a352">number</a>.<a class="code" href="../../d6/dbb/structast__party__number.html#ab50d783982593ef993ea0b68f7ad8b80">str</a>) &amp;&amp; session-&gt;<a class="code" href="../../d2/dec/structast__sip__session.html#a8791d240f8a9c2dc271a1c8542cfe8cc">id</a>.<a class="code" href="../../d1/dcb/structast__party__id.html#aca2d7de6c89f201dc8bd0a2642d2a352">number</a>.<a class="code" href="../../d6/dbb/structast__party__number.html#aaa04218f9e3a9065afa8be2491da8904">valid</a>) {</div><div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;      <span class="keywordflow">return</span>;</div><div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;   }</div><div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;</div><div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;   <span class="comment">/* If adding the Identity header fails for some reason, there&#39;s no point</span></div><div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;<span class="comment">    * adding the Date header.</span></div><div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;<span class="comment">    */</span></div><div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;   <span class="keywordflow">if</span> ((<a class="code" href="../../da/d84/res__pjsip__stir__shaken_8c.html#a79960471926a97003f809a78a228bc80">add_identity_header</a>(session, tdata)) != 0) {</div><div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;      <span class="keywordflow">return</span>;</div><div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;   }</div><div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;   <a class="code" href="../../da/d84/res__pjsip__stir__shaken_8c.html#a81686f89684b79be2b2ca95abb3c907c">add_date_header</a>(session, tdata);</div><div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;}</div><div class="ttc" id="structast__sip__session_html_a3960205b2a4e7e012dc9f0eae1855f01"><div class="ttname"><a href="../../d2/dec/structast__sip__session.html#a3960205b2a4e7e012dc9f0eae1855f01">ast_sip_session::endpoint</a></div><div class="ttdeci">struct ast_sip_endpoint * endpoint</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/de7/res__pjsip__session_8h_source.html#l00183">res_pjsip_session.h:183</a></div></div>
<div class="ttc" id="structast__party__number_html_ab50d783982593ef993ea0b68f7ad8b80"><div class="ttname"><a href="../../d6/dbb/structast__party__number.html#ab50d783982593ef993ea0b68f7ad8b80">ast_party_number::str</a></div><div class="ttdeci">char * str</div><div class="ttdoc">Subscriber phone number (Malloced) </div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d7b/channel_8h_source.html#l00292">channel.h:292</a></div></div>
<div class="ttc" id="res__pjsip__stir__shaken_8c_html_a79960471926a97003f809a78a228bc80"><div class="ttname"><a href="../../da/d84/res__pjsip__stir__shaken_8c.html#a79960471926a97003f809a78a228bc80">add_identity_header</a></div><div class="ttdeci">static int add_identity_header(const struct ast_sip_session *session, pjsip_tx_data *tdata)</div><div class="ttdef"><b>Definition:</b> <a href="../../da/d84/res__pjsip__stir__shaken_8c_source.html#l00211">res_pjsip_stir_shaken.c:211</a></div></div>
<div class="ttc" id="res__pjsip__stir__shaken_8c_html_a81686f89684b79be2b2ca95abb3c907c"><div class="ttname"><a href="../../da/d84/res__pjsip__stir__shaken_8c.html#a81686f89684b79be2b2ca95abb3c907c">add_date_header</a></div><div class="ttdeci">static void add_date_header(const struct ast_sip_session *session, pjsip_tx_data *tdata)</div><div class="ttdef"><b>Definition:</b> <a href="../../da/d84/res__pjsip__stir__shaken_8c_source.html#l00320">res_pjsip_stir_shaken.c:320</a></div></div>
<div class="ttc" id="strings_8h_html_a372554b7a2d69a8bd3adac5157672036"><div class="ttname"><a href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a></div><div class="ttdeci">#define ast_strlen_zero(foo)</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d90/strings_8h_source.html#l00052">strings.h:52</a></div></div>
<div class="ttc" id="structast__sip__endpoint_html_aa558bb7de8eedb9b11b368b7c8eadb20"><div class="ttname"><a href="../../d3/d46/structast__sip__endpoint.html#aa558bb7de8eedb9b11b368b7c8eadb20">ast_sip_endpoint::stir_shaken</a></div><div class="ttdeci">unsigned int stir_shaken</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d8c/res__pjsip_8h_source.html#l00903">res_pjsip.h:903</a></div></div>
<div class="ttc" id="structast__sip__session_html_a8791d240f8a9c2dc271a1c8542cfe8cc"><div class="ttname"><a href="../../d2/dec/structast__sip__session.html#a8791d240f8a9c2dc271a1c8542cfe8cc">ast_sip_session::id</a></div><div class="ttdeci">struct ast_party_id id</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/de7/res__pjsip__session_8h_source.html#l00207">res_pjsip_session.h:207</a></div></div>
<div class="ttc" id="structast__party__number_html_aaa04218f9e3a9065afa8be2491da8904"><div class="ttname"><a href="../../d6/dbb/structast__party__number.html#aaa04218f9e3a9065afa8be2491da8904">ast_party_number::valid</a></div><div class="ttdeci">unsigned char valid</div><div class="ttdoc">TRUE if the number information is valid/present. </div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d7b/channel_8h_source.html#l00298">channel.h:298</a></div></div>
<div class="ttc" id="structast__party__id_html_aca2d7de6c89f201dc8bd0a2642d2a352"><div class="ttname"><a href="../../d1/dcb/structast__party__id.html#aca2d7de6c89f201dc8bd0a2642d2a352">ast_party_id::number</a></div><div class="ttdeci">struct ast_party_number number</div><div class="ttdoc">Subscriber phone number. </div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d7b/channel_8h_source.html#l00343">channel.h:343</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="ad09fa931f468002152a3cc2d5ce25eae"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad09fa931f468002152a3cc2d5ce25eae">&#9670;&nbsp;</a></span>unload_module()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int unload_module </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="../../da/d84/res__pjsip__stir__shaken_8c_source.html#l00360">360</a> of file <a class="el" href="../../da/d84/res__pjsip__stir__shaken_8c_source.html">res_pjsip_stir_shaken.c</a>.</p>

<p class="reference">References <a class="el" href="../../d2/dc0/pjsip__session_8c_source.html#l00063">ast_sip_session_unregister_supplement()</a>.</p>
<div class="fragment"><div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;{</div><div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;   <a class="code" href="../../d9/de7/res__pjsip__session_8h.html#aae89632996ffdcf888ab251c14dc6cdb">ast_sip_session_unregister_supplement</a>(&amp;<a class="code" href="../../da/d84/res__pjsip__stir__shaken_8c.html#ab5dadd4061795ec68a0136ee0998e9ca">stir_shaken_supplement</a>);</div><div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;   <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;}</div><div class="ttc" id="res__pjsip__session_8h_html_aae89632996ffdcf888ab251c14dc6cdb"><div class="ttname"><a href="../../d9/de7/res__pjsip__session_8h.html#aae89632996ffdcf888ab251c14dc6cdb">ast_sip_session_unregister_supplement</a></div><div class="ttdeci">void ast_sip_session_unregister_supplement(struct ast_sip_session_supplement *supplement)</div><div class="ttdoc">Unregister a an supplement to SIP session processing. </div><div class="ttdef"><b>Definition:</b> <a href="../../d2/dc0/pjsip__session_8c_source.html#l00063">pjsip_session.c:63</a></div></div>
<div class="ttc" id="res__pjsip__stir__shaken_8c_html_ab5dadd4061795ec68a0136ee0998e9ca"><div class="ttname"><a href="../../da/d84/res__pjsip__stir__shaken_8c.html#ab5dadd4061795ec68a0136ee0998e9ca">stir_shaken_supplement</a></div><div class="ttdeci">static struct ast_sip_session_supplement stir_shaken_supplement</div><div class="ttdef"><b>Definition:</b> <a href="../../da/d84/res__pjsip__stir__shaken_8c_source.html#l00353">res_pjsip_stir_shaken.c:353</a></div></div>
</div><!-- fragment -->
</div>
</div>
<h2 class="groupheader">Variable Documentation</h2>
<a id="ab22f32016155f7f403e7178767163d7d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab22f32016155f7f403e7178767163d7d">&#9670;&nbsp;</a></span>__mod_info</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="../../dd/d5f/structast__module__info.html">ast_module_info</a> __mod_info = { .<a class="el" href="../../d1/da4/res__corosync_8c.html#a8f8f80d37794cde9472343e4487ba3eb">name</a> = <a class="el" href="../../da/ddd/named__acl_8c.html#aec23fc5034c3bb08140fc021f4955877">AST_MODULE</a>, .flags = <a class="el" href="../../d5/d16/module_8h.html#a155a0df9c59e04e305d4a2fa3e35f843a835b27a90d895a488e4e14cc3d2dee8c">AST_MODFLAG_GLOBAL_SYMBOLS</a> | <a class="el" href="../../d5/d16/module_8h.html#a155a0df9c59e04e305d4a2fa3e35f843a12c3f60dd7655dfa8d4430cbf04b1223">AST_MODFLAG_LOAD_ORDER</a> , .description = &quot;PJSIP STIR/SHAKEN Module for Asterisk&quot; , .key = &quot;This paragraph is copyright (<a class="el" href="../../d7/d6f/test__linkedlists_8c.html#acd9db00336027462cfb25b97b5356883">c</a>) 2006 by Digium, Inc. \In <a class="el" href="../../d5/d14/voicin_8c.html#aed7ca058008dc3e5ee131e575abed285">order</a> for your module to load, it must return this \key via <a class="el" href="../../d7/d6f/test__linkedlists_8c.html#a13dd15487fee89a002d17ef3aff62d02">a</a> function called \&quot;key\&quot;. Any code which \includes this paragraph must <a class="el" href="../../dd/d7c/eagi__proxy_8c.html#a39730e90126aad69cfc9ca4d6fcdb3a6">be</a> licensed under the GNU \General Public License <a class="el" href="../../da/d7c/utils_2frame_8h.html#a56abfaab87c46691c1ef3ad0df23e864">version</a> 2 or later (at your \option). In addition to Digium's general reservations \of rights, Digium expressly reserves the right to \allow other parties to license this paragraph under \different terms. Any use of Digium, Inc. trademarks or \logos (including \&quot;Asterisk\&quot; or \&quot;Digium\&quot;) without \express written <a class="el" href="../../d4/d4c/structpermission.html">permission</a> of Digium, Inc. is prohibited.\n&quot; , .buildopt_sum = &quot;&quot; , .support_level = <a class="el" href="../../d5/d16/module_8h.html#ab35bc4efd9f79706300965c9d36a0ce5a634484c0074e7b6b630756fab09e2c15">AST_MODULE_SUPPORT_CORE</a>, .load = <a class="el" href="../../d6/d7a/test__xml__escape_8c.html#ac3382bf6da54c56b37069bd76bbdf4f9">load_module</a>, .unload = <a class="el" href="../../d6/d7a/test__xml__escape_8c.html#ad09fa931f468002152a3cc2d5ce25eae">unload_module</a>, .load_pri = <a class="el" href="../../d5/d16/module_8h.html#aa4f734041ffd9d75b07cefb0291e1e58a1d1eb207e01a2d3bf6aa6ba271c27dee">AST_MODPRI_DEFAULT</a>, .requires = &quot;res_pjsip,res_pjsip_session,res_stir_shaken&quot;, }</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="../../da/d84/res__pjsip__stir__shaken_8c_source.html#l00381">381</a> of file <a class="el" href="../../da/d84/res__pjsip__stir__shaken_8c_source.html">res_pjsip_stir_shaken.c</a>.</p>

</div>
</div>
<a id="ad60e83b9aa660040fed4d5377966cc21"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad60e83b9aa660040fed4d5377966cc21">&#9670;&nbsp;</a></span>ast_module_info</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">const struct <a class="el" href="../../dd/d5f/structast__module__info.html">ast_module_info</a>* <a class="el" href="../../dd/d5f/structast__module__info.html">ast_module_info</a> = &amp;<a class="el" href="../../d6/d7a/test__xml__escape_8c.html#ab22f32016155f7f403e7178767163d7d">__mod_info</a></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="../../da/d84/res__pjsip__stir__shaken_8c_source.html#l00381">381</a> of file <a class="el" href="../../da/d84/res__pjsip__stir__shaken_8c_source.html">res_pjsip_stir_shaken.c</a>.</p>

</div>
</div>
<a id="ab5dadd4061795ec68a0136ee0998e9ca"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab5dadd4061795ec68a0136ee0998e9ca">&#9670;&nbsp;</a></span>stir_shaken_supplement</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="../../df/db8/structast__sip__session__supplement.html">ast_sip_session_supplement</a> stir_shaken_supplement</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="../../da/d84/res__pjsip__stir__shaken_8c_source.html#l00353">353</a> of file <a class="el" href="../../da/d84/res__pjsip__stir__shaken_8c_source.html">res_pjsip_stir_shaken.c</a>.</p>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Sun Aug 8 2021 19:46:35 for Asterisk - The Open Source Telephony Project by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="../../doxygen.png" alt="doxygen"/>
</a> 1.8.13
</small></address>
</body>
</html>
