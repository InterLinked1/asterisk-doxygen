<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Asterisk - The Open Source Telephony Project: stasis_app_impl.h File Reference</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Asterisk - The Open Source Telephony Project
   &#160;<span id="projectnumber">18.5.0</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "../../search",false,'Search');
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('../../',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="../../dir_d44c64559bbebec7f509842c48db8b23.html">include</a></li><li class="navelem"><a class="el" href="../../dir_6d4b1cdb59e2db6ad82005b337288fef.html">asterisk</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#typedef-members">Typedefs</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">stasis_app_impl.h File Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>Backend API for implementing components of res_stasis.  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &quot;<a class="el" href="../../d8/d9c/stasis__app_8h_source.html">asterisk/stasis_app.h</a>&quot;</code><br />
</div><div class="textblock"><div class="dynheader">
Include dependency graph for stasis_app_impl.h:</div>
<div class="dyncontent">
<div class="center"><img src="../../d1/db4/stasis__app__impl_8h__incl.png" border="0" usemap="#stasis__app__impl_8h" alt=""/></div>
<map name="stasis__app__impl_8h" id="stasis__app__impl_8h">
<area shape="rect" id="node2" href="../../d8/d9c/stasis__app_8h.html" title="Stasis Application API. See Stasis Application API for detailed documentation. " alt="" coords="813,80,969,107"/>
<area shape="rect" id="node3" href="../../d5/d7b/channel_8h.html" title="General Asterisk PBX channel definitions. " alt="" coords="821,155,960,181"/>
<area shape="rect" id="node4" href="../../dc/d4d/alertpipe_8h.html" title="asterisk/alertpipe.h" alt="" coords="49,229,193,256"/>
<area shape="rect" id="node5" href="../../d5/d60/utils_8h.html" title="Utility functions. " alt="" coords="107,304,221,331"/>
<area shape="rect" id="node6" href="../../dd/d42/lock_8h.html" title="Asterisk locking&#45;related definitions: " alt="" coords="362,453,475,480"/>
<area shape="rect" id="node7" href="../../d1/d0f/stringfields_8h.html" title="asterisk/stringfields.h" alt="" coords="5,379,163,405"/>
<area shape="rect" id="node8" href="../../dc/d14/abstract__jb_8h.html" title="Common implementation&#45;independent jitterbuffer stuff. " alt="" coords="1055,229,1214,256"/>
<area shape="rect" id="node9" href="../../d5/da5/astobj2_8h.html" title="asterisk/astobj2.h" alt="" coords="418,304,553,331"/>
<area shape="rect" id="node10" href="../../df/d90/linkedlists_8h.html" title="A set of macros to manage forward&#45;linked lists. " alt="" coords="721,379,871,405"/>
<area shape="rect" id="node11" href="../../d4/dfb/poll-compat_8h.html" title="asterisk/poll&#45;compat.h" alt="" coords="1238,229,1402,256"/>
<area shape="rect" id="node12" href="../../d6/d66/include_2asterisk_2frame_8h.html" title="Asterisk internal frame definitions. " alt="" coords="577,304,703,331"/>
<area shape="rect" id="node13" href="../../d9/de7/chanvars_8h.html" title="Channel Variables. " alt="" coords="779,304,925,331"/>
<area shape="rect" id="node14" href="../../d3/de6/include_2asterisk_2config_8h.html" title="Configuration File Parser. " alt="" coords="218,229,345,256"/>
<area shape="rect" id="node15" href="../../dc/d07/cdr_8h.html" title="Call Detail Record API. " alt="" coords="1427,229,1533,256"/>
<area shape="rect" id="node16" href="../../d9/db6/datastore_8h.html" title="Asterisk datastore objects. " alt="" coords="950,304,1101,331"/>
<area shape="rect" id="node17" href="../../d0/d3c/format__cap_8h.html" title="Format Capabilities API. " alt="" coords="1558,229,1719,256"/>
<area shape="rect" id="node18" href="../../d9/d95/channelstate_8h.html" title="Channel states. " alt="" coords="1744,229,1915,256"/>
<area shape="rect" id="node19" href="../../de/dc8/ccss_8h.html" title="Call Completion Supplementary Services API. " alt="" coords="1125,304,1241,331"/>
<area shape="rect" id="node20" href="../../db/d3c/framehook_8h.html" title="FrameHook Architecture. " alt="" coords="671,229,828,256"/>
<area shape="rect" id="node21" href="../../dd/d79/stasis_8h.html" title="Stasis Message Bus API. See Stasis Message Bus API for detailed documentation. " alt="" coords="369,229,495,256"/>
<area shape="rect" id="node22" href="../../d4/d61/endpoints_8h.html" title="Endpoint abstractions. " alt="" coords="1939,229,2090,256"/>
</map>
</div>
</div><div class="textblock"><div class="dynheader">
This graph shows which files directly or indirectly include this file:</div>
<div class="dyncontent">
<div class="center"><img src="../../d3/d12/stasis__app__impl_8h__dep__incl.png" border="0" usemap="#stasis__app__impl_8hdep" alt=""/></div>
<map name="stasis__app__impl_8hdep" id="stasis__app__impl_8hdep">
<area shape="rect" id="node2" href="../../d1/d25/app__stasis_8c.html" title="Stasis dialplan application. " alt="" coords="5,80,107,107"/>
<area shape="rect" id="node3" href="../../db/d0b/resource__bridges_8c.html" title="Implementation for ARI stubs. " alt="" coords="131,80,274,107"/>
<area shape="rect" id="node4" href="../../d2/d80/res__stasis_8c.html" title="Stasis application support. " alt="" coords="298,80,395,107"/>
<area shape="rect" id="node5" href="../../d4/d26/res__stasis__answer_8c.html" title="Stasis application control support. " alt="" coords="419,80,567,107"/>
<area shape="rect" id="node6" href="../../dd/d71/res__stasis__device__state_8c.html" title="res_stasis_device_state.c" alt="" coords="591,80,777,107"/>
<area shape="rect" id="node7" href="../../d5/daa/res__stasis__mailbox_8c.html" title="res_stasis_mailbox.c" alt="" coords="801,80,956,107"/>
<area shape="rect" id="node8" href="../../d7/de1/res__stasis__playback_8c.html" title="res_stasis playback support. " alt="" coords="980,80,1140,107"/>
<area shape="rect" id="node9" href="../../d8/d4c/res__stasis__recording_8c.html" title="res_stasis recording support. " alt="" coords="1165,80,1329,107"/>
<area shape="rect" id="node10" href="../../dd/da3/res__stasis__snoop_8c.html" title="Stasis application snoop control support. " alt="" coords="1353,80,1495,107"/>
<area shape="rect" id="node11" href="../../d0/d09/command_8h.html" title="Internal API for the Stasis application commands. " alt="" coords="1583,80,1681,107"/>
<area shape="rect" id="node12" href="../../d5/d2e/command_8c.html" title="Stasis application command support. " alt="" coords="1477,155,1576,181"/>
<area shape="rect" id="node13" href="../../de/de3/control_8c.html" title="Stasis application control support. " alt="" coords="1600,155,1677,181"/>
<area shape="rect" id="node14" href="../../d9/de0/stasis__bridge_8c.html" title="Stasis bridge subclass. " alt="" coords="1701,155,1819,181"/>
</map>
</div>
</div>
<p><a href="../../de/d0b/stasis__app__impl_8h_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="typedef-members"></a>
Typedefs</h2></td></tr>
<tr class="memitem:a66ead0f2f762f64bbad7eb8a026cf62c"><td class="memItemLeft" align="right" valign="top">typedef void(*&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../de/d0b/stasis__app__impl_8h.html#a66ead0f2f762f64bbad7eb8a026cf62c">command_data_destructor_fn</a>) (void *data)</td></tr>
<tr class="memdesc:a66ead0f2f762f64bbad7eb8a026cf62c"><td class="mdescLeft">&#160;</td><td class="mdescRight">Typedef for data destructor for stasis app commands.  <a href="#a66ead0f2f762f64bbad7eb8a026cf62c">More...</a><br /></td></tr>
<tr class="separator:a66ead0f2f762f64bbad7eb8a026cf62c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a816a21221be6d5a93cc55b8cb97d46ab"><td class="memItemLeft" align="right" valign="top">typedef int(*&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../de/d0b/stasis__app__impl_8h.html#a816a21221be6d5a93cc55b8cb97d46ab">stasis_app_command_cb</a>) (struct <a class="el" href="../../da/da4/structstasis__app__control.html">stasis_app_control</a> *control, struct <a class="el" href="../../df/d3c/structast__channel.html">ast_channel</a> *chan, void *data)</td></tr>
<tr class="separator:a816a21221be6d5a93cc55b8cb97d46ab"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a191ce41140cf0af9be11f05be98b66ce"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../de/d0b/stasis__app__impl_8h.html#a191ce41140cf0af9be11f05be98b66ce">stasis_app_exec</a> (struct <a class="el" href="../../df/d3c/structast__channel.html">ast_channel</a> *chan, const char *<a class="el" href="../../d9/da0/pbx__private_8h.html#a6d3c140ecf1f736c6750d5a17e5bf958">app_name</a>, int argc, char *argv[])</td></tr>
<tr class="memdesc:a191ce41140cf0af9be11f05be98b66ce"><td class="mdescLeft">&#160;</td><td class="mdescRight">Control a channel using <code><a class="el" href="../../d4/de3/structstasis__app.html">stasis_app</a></code>.  <a href="#a191ce41140cf0af9be11f05be98b66ce">More...</a><br /></td></tr>
<tr class="separator:a191ce41140cf0af9be11f05be98b66ce"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a36343c21d88758d9df3ff6aa217caf5d"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../de/d0b/stasis__app__impl_8h.html#a36343c21d88758d9df3ff6aa217caf5d">stasis_app_send_command</a> (struct <a class="el" href="../../da/da4/structstasis__app__control.html">stasis_app_control</a> *control, <a class="el" href="../../de/d0b/stasis__app__impl_8h.html#a816a21221be6d5a93cc55b8cb97d46ab">stasis_app_command_cb</a> command, void *data, <a class="el" href="../../de/d0b/stasis__app__impl_8h.html#a66ead0f2f762f64bbad7eb8a026cf62c">command_data_destructor_fn</a> data_destructor)</td></tr>
<tr class="memdesc:a36343c21d88758d9df3ff6aa217caf5d"><td class="mdescLeft">&#160;</td><td class="mdescRight">Invokes a <em>command</em> on a <em>control's</em> channel.  <a href="#a36343c21d88758d9df3ff6aa217caf5d">More...</a><br /></td></tr>
<tr class="separator:a36343c21d88758d9df3ff6aa217caf5d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a838fef3012703b621ce65fb0e55b4af5"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../de/d0b/stasis__app__impl_8h.html#a838fef3012703b621ce65fb0e55b4af5">stasis_app_send_command_async</a> (struct <a class="el" href="../../da/da4/structstasis__app__control.html">stasis_app_control</a> *control, <a class="el" href="../../de/d0b/stasis__app__impl_8h.html#a816a21221be6d5a93cc55b8cb97d46ab">stasis_app_command_cb</a> command, void *data, <a class="el" href="../../de/d0b/stasis__app__impl_8h.html#a66ead0f2f762f64bbad7eb8a026cf62c">command_data_destructor_fn</a> data_destructor)</td></tr>
<tr class="memdesc:a838fef3012703b621ce65fb0e55b4af5"><td class="mdescLeft">&#160;</td><td class="mdescRight">Asynchronous version of <a class="el" href="../../de/d0b/stasis__app__impl_8h.html#a36343c21d88758d9df3ff6aa217caf5d" title="Invokes a command on a control&#39;s channel. ">stasis_app_send_command()</a>.  <a href="#a838fef3012703b621ce65fb0e55b4af5">More...</a><br /></td></tr>
<tr class="separator:a838fef3012703b621ce65fb0e55b4af5"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Backend API for implementing components of res_stasis. </p>
<dl class="section author"><dt>Author</dt><dd>David M. Lee, II <a href="#" onclick="location.href='mai'+'lto:'+'dle'+'e@'+'dig'+'iu'+'m.c'+'om'; return false;">dlee@<span style="display: none;">.nosp@m.</span>digi<span style="display: none;">.nosp@m.</span>um.co<span style="display: none;">.nosp@m.</span>m</a> </dd></dl>
<dl class="section since"><dt>Since</dt><dd>12</dd></dl>
<p>This file defines functions useful for defining new commands to execute on channels while they are in Stasis. </p>

<p class="definition">Definition in file <a class="el" href="../../de/d0b/stasis__app__impl_8h_source.html">stasis_app_impl.h</a>.</p>
</div><h2 class="groupheader">Typedef Documentation</h2>
<a id="a66ead0f2f762f64bbad7eb8a026cf62c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a66ead0f2f762f64bbad7eb8a026cf62c">&#9670;&nbsp;</a></span>command_data_destructor_fn</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef void(* command_data_destructor_fn) (void *data)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Typedef for data destructor for stasis app commands. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">data</td><td>Data to destroy.</td></tr>
  </table>
  </dd>
</dl>
<p>This is called during destruction of the command or if we fail to schedule a command. It is passed a pointer to the user-defined data of the command.</p>
<dl class="section return"><dt>Returns</dt><dd>Nothing </dd></dl>

<p class="definition">Definition at line <a class="el" href="../../de/d0b/stasis__app__impl_8h_source.html#l00062">62</a> of file <a class="el" href="../../de/d0b/stasis__app__impl_8h_source.html">stasis_app_impl.h</a>.</p>

</div>
</div>
<a id="a816a21221be6d5a93cc55b8cb97d46ab"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a816a21221be6d5a93cc55b8cb97d46ab">&#9670;&nbsp;</a></span>stasis_app_command_cb</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef int(* stasis_app_command_cb) (struct <a class="el" href="../../da/da4/structstasis__app__control.html">stasis_app_control</a> *control, struct <a class="el" href="../../df/d3c/structast__channel.html">ast_channel</a> *chan, void *data)</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Callback type for stasis app commands </p>

<p class="definition">Definition at line <a class="el" href="../../de/d0b/stasis__app__impl_8h_source.html#l00065">65</a> of file <a class="el" href="../../de/d0b/stasis__app__impl_8h_source.html">stasis_app_impl.h</a>.</p>

</div>
</div>
<h2 class="groupheader">Function Documentation</h2>
<a id="a191ce41140cf0af9be11f05be98b66ce"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a191ce41140cf0af9be11f05be98b66ce">&#9670;&nbsp;</a></span>stasis_app_exec()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int stasis_app_exec </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="../../df/d3c/structast__channel.html">ast_channel</a> *&#160;</td>
          <td class="paramname"><em>chan</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>app_name</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>argc</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>argv</em>[]&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Control a channel using <code><a class="el" href="../../d4/de3/structstasis__app.html">stasis_app</a></code>. </p>
<dl class="section since"><dt>Since</dt><dd>12 This function blocks until the channel hangs up, or <a class="el" href="../../d8/d9c/stasis__app_8h.html#a44c0b1bbbf0189d3c6b076eccd0a6d8f" title="Exit res_stasis and continue execution in the dialplan. ">stasis_app_control_continue()</a> is called on the channel's <a class="el" href="../../da/da4/structstasis__app__control.html">stasis_app_control</a> struct.</dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">chan</td><td>Channel to control with Stasis. </td></tr>
    <tr><td class="paramname">app_name</td><td>Application controlling the channel. </td></tr>
    <tr><td class="paramname">argc</td><td>Number of arguments for the application. </td></tr>
    <tr><td class="paramname">argv</td><td>Arguments for the application.</td></tr>
  </table>
  </dd>
</dl>
<p>/brief Stasis dialplan application callback </p>

<p class="definition">Definition at line <a class="el" href="../../d2/d80/res__stasis_8c_source.html#l01324">1324</a> of file <a class="el" href="../../d2/d80/res__stasis_8c_source.html">res_stasis.c</a>.</p>

<p class="reference">References <a class="el" href="../../d2/d80/res__stasis_8c_source.html#l01217">add_masquerade_store()</a>, <a class="el" href="../../d5/da5/astobj2_8h_source.html#l00491">ao2_bump</a>, <a class="el" href="../../d5/da5/astobj2_8h_source.html#l01958">ao2_cleanup</a>, <a class="el" href="../../d5/da5/astobj2_8h_source.html#l01756">ao2_find</a>, <a class="el" href="../../d5/da5/astobj2_8h_source.html#l01549">ao2_link</a>, <a class="el" href="../../d5/da5/astobj2_8h_source.html#l00464">ao2_ref</a>, <a class="el" href="../../d0/db6/app__mysql_8c_source.html#l00062">app</a>, <a class="el" href="../../d3/d5e/res_2stasis_2app_8c_source.html#l01094">app_is_active()</a>, <a class="el" href="../../d3/d5e/res_2stasis_2app_8c_source.html#l01038">app_send()</a>, <a class="el" href="../../d2/d80/res__stasis_8c_source.html#l01083">app_send_end_msg()</a>, <a class="el" href="../../d3/d5e/res_2stasis_2app_8c_source.html#l01428">app_subscribe_bridge()</a>, <a class="el" href="../../d3/d5e/res_2stasis_2app_8c_source.html#l01486">app_unsubscribe_bridge()</a>, <a class="el" href="../../d5/d60/utils_8h_source.html#l00695">ast_assert</a>, <a class="el" href="../../d0/d95/bridge_8c_source.html#l01952">ast_bridge_depart()</a>, <a class="el" href="../../d4/d28/channel_8c_source.html#l02437">ast_channel_clear_softhangup()</a>, <a class="el" href="../../db/de2/channel__internal__api_8c_source.html#l00419">ast_channel_fdno()</a>, <a class="el" href="../../db/de2/channel__internal__api_8c_source.html#l01251">ast_channel_internal_bridge_channel()</a>, <a class="el" href="../../d5/d7b/channel_8h_source.html#l02945">ast_channel_lock</a>, <a class="el" href="../../d5/d7b/channel_8h.html#a7ca2fda13b129a55c251b56729de285b">ast_channel_name()</a>, <a class="el" href="../../db/de2/channel__internal__api_8c_source.html#l00721">ast_channel_pbx()</a>, <a class="el" href="../../dc/d2b/stasis__channels_8c_source.html#l00903">ast_channel_snapshot_get_latest()</a>, <a class="el" href="../../dc/d2b/stasis__channels_8c_source.html#l01255">ast_channel_snapshot_to_json()</a>, <a class="el" href="../../db/de2/channel__internal__api_8c_source.html#l00305">ast_channel_uniqueid()</a>, <a class="el" href="../../d5/d7b/channel_8h_source.html#l02946">ast_channel_unlock</a>, <a class="el" href="../../d4/d28/channel_8c_source.html#l00445">ast_check_hangup()</a>, <a class="el" href="../../d4/d28/channel_8c_source.html#l00459">ast_check_hangup_locked()</a>, <a class="el" href="../../d6/d66/include_2asterisk_2frame_8h_source.html#l00278">AST_CONTROL_HANGUP</a>, <a class="el" href="../../d1/d8c/logger_8h_source.html#l00452">ast_debug</a>, <a class="el" href="../../d6/d66/include_2asterisk_2frame_8h_source.html#l00105">AST_FRAME_CONTROL</a>, <a class="el" href="../../df/d55/main_2frame_8c_source.html#l00187">ast_frame_dtor()</a>, <a class="el" href="../../d8/d8a/astmm_8h_source.html#l00182">ast_free</a>, <a class="el" href="../../df/d98/json_8c_source.html#l00368">ast_json_array_append()</a>, <a class="el" href="../../df/d98/json_8c_source.html#l00397">ast_json_object_get()</a>, <a class="el" href="../../df/d98/json_8c_source.html#l00591">ast_json_pack()</a>, <a class="el" href="../../df/d98/json_8c_source.html#l00268">ast_json_string_create()</a>, <a class="el" href="../../df/d98/json_8c_source.html#l00649">ast_json_timeval()</a>, <a class="el" href="../../df/d98/json_8c_source.html#l00073">ast_json_unref()</a>, <a class="el" href="../../da/df7/astobj2_8c_source.html#l00042">ast_log</a>, <a class="el" href="../../db/d94/pbx_8c_source.html#l04739">ast_pbx_run_args()</a>, <a class="el" href="../../d4/d28/channel_8c_source.html#l04302">ast_read()</a>, <a class="el" href="../../d5/d7b/channel_8h_source.html#l01127">AST_SOFTHANGUP_ASYNCGOTO</a>, <a class="el" href="../../de/df7/time_8h_source.html#l00150">ast_tvnow()</a>, <a class="el" href="../../d4/d28/channel_8c_source.html#l03171">ast_waitfor()</a>, <a class="el" href="../../d2/d80/res__stasis_8c_source.html#l00327">cleanup()</a>, <a class="el" href="../../de/de3/control_8c_source.html#l01563">control_app()</a>, <a class="el" href="../../de/de3/control_8c_source.html#l00123">control_create()</a>, <a class="el" href="../../de/de3/control_8c_source.html#l01495">control_dispatch_all()</a>, <a class="el" href="../../de/de3/control_8c_source.html#l01482">control_flush_queue()</a>, <a class="el" href="../../de/de3/control_8c_source.html#l00348">control_is_done()</a>, <a class="el" href="../../de/de3/control_8c_source.html#l00354">control_mark_done()</a>, <a class="el" href="../../de/de3/control_8c_source.html#l01702">control_move_cleanup()</a>, <a class="el" href="../../de/de3/control_8c_source.html#l01697">control_next_app()</a>, <a class="el" href="../../de/de3/control_8c_source.html#l01710">control_next_app_args()</a>, <a class="el" href="../../de/de3/control_8c_source.html#l01715">control_next_app_args_size()</a>, <a class="el" href="../../de/de3/control_8c_source.html#l01535">control_prestart_dispatch_all()</a>, <a class="el" href="../../de/de3/control_8c_source.html#l01691">control_set_app()</a>, <a class="el" href="../../de/de3/control_8c_source.html#l00837">control_silence_stop_now()</a>, <a class="el" href="../../d2/d80/res__stasis_8c_source.html#l00785">control_unlink()</a>, <a class="el" href="../../de/de3/control_8c_source.html#l01515">control_wait()</a>, <a class="el" href="../../d2/d80/res__stasis_8c_source.html#l01211">has_masquerade_store()</a>, <a class="el" href="../../d1/d8c/logger_8h_source.html#l00285">LOG_ERROR</a>, <a class="el" href="../../d2/d80/res__stasis_8c_source.html#l00077">MAX_WAIT_MS</a>, <a class="el" href="../../db/de0/pbx_8h_source.html#l00398">ast_pbx_args::no_hangup_chan</a>, <a class="el" href="../../dc/d7f/resample_8c_source.html#l00096">NULL</a>, <a class="el" href="../../d5/da5/astobj2_8h_source.html#l01105">OBJ_SEARCH_KEY</a>, <a class="el" href="../../d5/d60/utils_8h_source.html#l00911">RAII_VAR</a>, <a class="el" href="../../d2/d80/res__stasis_8c_source.html#l01236">remove_masquerade_store()</a>, <a class="el" href="../../d2/d80/res__stasis_8c_source.html#l01310">remove_stasis_end_published()</a>, <a class="el" href="../../d2/d80/res__stasis_8c_source.html#l01057">send_start_msg()</a>, <a class="el" href="../../d2/d80/res__stasis_8c_source.html#l01299">stasis_app_channel_is_stasis_end_published()</a>, <a class="el" href="../../de/de3/control_8c_source.html#l00931">stasis_app_get_bridge()</a>, and <a class="el" href="../../d3/d5e/res_2stasis_2app_8c_source.html#l01156">stasis_app_name()</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../d1/d25/app__stasis_8c_source.html#l00083">app_exec()</a>.</p>
<div class="fragment"><div class="line"><a name="l01326"></a><span class="lineno"> 1326</span>&#160;{</div><div class="line"><a name="l01327"></a><span class="lineno"> 1327</span>&#160;   <a class="code" href="../../d5/d60/utils_8h.html#a1604b4d72144dd3d9f7da668e90337e9">RAII_VAR</a>(<span class="keyword">struct</span> <a class="code" href="../../d4/de3/structstasis__app.html">stasis_app</a> *, <a class="code" href="../../d0/db6/app__mysql_8c.html#a1d9b1eccfc259a14525ce817482a3f88">app</a>, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../d5/da5/astobj2_8h.html#a6321ee982370c55ab3c24c72c562cbdd">ao2_cleanup</a>);</div><div class="line"><a name="l01328"></a><span class="lineno"> 1328</span>&#160;   <a class="code" href="../../d5/d60/utils_8h.html#a1604b4d72144dd3d9f7da668e90337e9">RAII_VAR</a>(<span class="keyword">struct</span> <a class="code" href="../../da/da4/structstasis__app__control.html">stasis_app_control</a> *, control, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../d2/d80/res__stasis_8c.html#ae122dda67c23017097471a5cca1d4d42">control_unlink</a>);</div><div class="line"><a name="l01329"></a><span class="lineno"> 1329</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d4/d84/structast__bridge.html">ast_bridge</a> *bridge = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l01330"></a><span class="lineno"> 1330</span>&#160;   <span class="keywordtype">int</span> res = 0;</div><div class="line"><a name="l01331"></a><span class="lineno"> 1331</span>&#160;   <span class="keywordtype">int</span> needs_depart;</div><div class="line"><a name="l01332"></a><span class="lineno"> 1332</span>&#160;</div><div class="line"><a name="l01333"></a><span class="lineno"> 1333</span>&#160;   <a class="code" href="../../d5/d60/utils_8h.html#a24374da24af1931d8a7ccde5b352bb2c">ast_assert</a>(chan != <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div><div class="line"><a name="l01334"></a><span class="lineno"> 1334</span>&#160;</div><div class="line"><a name="l01335"></a><span class="lineno"> 1335</span>&#160;   <span class="comment">/* Just in case there&#39;s a lingering indication that the channel has had a stasis</span></div><div class="line"><a name="l01336"></a><span class="lineno"> 1336</span>&#160;<span class="comment">    * end published on it, remove that now.</span></div><div class="line"><a name="l01337"></a><span class="lineno"> 1337</span>&#160;<span class="comment">    */</span></div><div class="line"><a name="l01338"></a><span class="lineno"> 1338</span>&#160;   <a class="code" href="../../d2/d80/res__stasis_8c.html#a4f80fe370f00634dabf90663604ab50c">remove_stasis_end_published</a>(chan);</div><div class="line"><a name="l01339"></a><span class="lineno"> 1339</span>&#160;</div><div class="line"><a name="l01340"></a><span class="lineno"> 1340</span>&#160;   <span class="keywordflow">if</span> (!<a class="code" href="../../d2/d80/res__stasis_8c.html#adb747ddc4dbb36c7544cbb3b695a777e">apps_registry</a>) {</div><div class="line"><a name="l01341"></a><span class="lineno"> 1341</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l01342"></a><span class="lineno"> 1342</span>&#160;   }</div><div class="line"><a name="l01343"></a><span class="lineno"> 1343</span>&#160;</div><div class="line"><a name="l01344"></a><span class="lineno"> 1344</span>&#160;   <a class="code" href="../../d0/db6/app__mysql_8c.html#a1d9b1eccfc259a14525ce817482a3f88">app</a> = <a class="code" href="../../d5/da5/astobj2_8h.html#a911e0703891a9a7aaf73978152092586">ao2_find</a>(<a class="code" href="../../d2/d80/res__stasis_8c.html#adb747ddc4dbb36c7544cbb3b695a777e">apps_registry</a>, <a class="code" href="../../dd/d16/pbx__app_8c.html#a6d3c140ecf1f736c6750d5a17e5bf958">app_name</a>, <a class="code" href="../../d5/da5/astobj2_8h.html#ad9d009e87e737af900825b36db55a35caa13a6e0771cc457e86f425d95c3b8d54">OBJ_SEARCH_KEY</a>);</div><div class="line"><a name="l01345"></a><span class="lineno"> 1345</span>&#160;   <span class="keywordflow">if</span> (!<a class="code" href="../../d0/db6/app__mysql_8c.html#a1d9b1eccfc259a14525ce817482a3f88">app</a>) {</div><div class="line"><a name="l01346"></a><span class="lineno"> 1346</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>,</div><div class="line"><a name="l01347"></a><span class="lineno"> 1347</span>&#160;         <span class="stringliteral">&quot;Stasis app &#39;%s&#39; not registered\n&quot;</span>, <a class="code" href="../../dd/d16/pbx__app_8c.html#a6d3c140ecf1f736c6750d5a17e5bf958">app_name</a>);</div><div class="line"><a name="l01348"></a><span class="lineno"> 1348</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l01349"></a><span class="lineno"> 1349</span>&#160;   }</div><div class="line"><a name="l01350"></a><span class="lineno"> 1350</span>&#160;   <span class="keywordflow">if</span> (!<a class="code" href="../../d3/d5e/res_2stasis_2app_8c.html#aafff5782ef991feae701cb5762457461">app_is_active</a>(<a class="code" href="../../d0/db6/app__mysql_8c.html#a1d9b1eccfc259a14525ce817482a3f88">app</a>)) {</div><div class="line"><a name="l01351"></a><span class="lineno"> 1351</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>,</div><div class="line"><a name="l01352"></a><span class="lineno"> 1352</span>&#160;         <span class="stringliteral">&quot;Stasis app &#39;%s&#39; not active\n&quot;</span>, <a class="code" href="../../dd/d16/pbx__app_8c.html#a6d3c140ecf1f736c6750d5a17e5bf958">app_name</a>);</div><div class="line"><a name="l01353"></a><span class="lineno"> 1353</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l01354"></a><span class="lineno"> 1354</span>&#160;   }</div><div class="line"><a name="l01355"></a><span class="lineno"> 1355</span>&#160;</div><div class="line"><a name="l01356"></a><span class="lineno"> 1356</span>&#160;   control = <a class="code" href="../../de/de3/control_8c.html#a76527348c55f4a4a8a3cfb7ccd798793">control_create</a>(chan, <a class="code" href="../../d0/db6/app__mysql_8c.html#a1d9b1eccfc259a14525ce817482a3f88">app</a>);</div><div class="line"><a name="l01357"></a><span class="lineno"> 1357</span>&#160;   <span class="keywordflow">if</span> (!control) {</div><div class="line"><a name="l01358"></a><span class="lineno"> 1358</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Control allocation failed or Stasis app &#39;%s&#39; not registered\n&quot;</span>, <a class="code" href="../../dd/d16/pbx__app_8c.html#a6d3c140ecf1f736c6750d5a17e5bf958">app_name</a>);</div><div class="line"><a name="l01359"></a><span class="lineno"> 1359</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l01360"></a><span class="lineno"> 1360</span>&#160;   }</div><div class="line"><a name="l01361"></a><span class="lineno"> 1361</span>&#160;</div><div class="line"><a name="l01362"></a><span class="lineno"> 1362</span>&#160;   <span class="keywordflow">if</span> (!<a class="code" href="../../de/de3/control_8c.html#a724086dccbb01edfef800bde10a80b55">control_app</a>(control)) {</div><div class="line"><a name="l01363"></a><span class="lineno"> 1363</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Stasis app &#39;%s&#39; not registered\n&quot;</span>, <a class="code" href="../../dd/d16/pbx__app_8c.html#a6d3c140ecf1f736c6750d5a17e5bf958">app_name</a>);</div><div class="line"><a name="l01364"></a><span class="lineno"> 1364</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l01365"></a><span class="lineno"> 1365</span>&#160;   }</div><div class="line"><a name="l01366"></a><span class="lineno"> 1366</span>&#160;</div><div class="line"><a name="l01367"></a><span class="lineno"> 1367</span>&#160;   <span class="keywordflow">if</span> (!<a class="code" href="../../d3/d5e/res_2stasis_2app_8c.html#aafff5782ef991feae701cb5762457461">app_is_active</a>(<a class="code" href="../../de/de3/control_8c.html#a724086dccbb01edfef800bde10a80b55">control_app</a>(control))) {</div><div class="line"><a name="l01368"></a><span class="lineno"> 1368</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Stasis app &#39;%s&#39; not active\n&quot;</span>, <a class="code" href="../../dd/d16/pbx__app_8c.html#a6d3c140ecf1f736c6750d5a17e5bf958">app_name</a>);</div><div class="line"><a name="l01369"></a><span class="lineno"> 1369</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l01370"></a><span class="lineno"> 1370</span>&#160;   }</div><div class="line"><a name="l01371"></a><span class="lineno"> 1371</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#a1ad9f122bcae95a470639402faa3d2ee">ao2_link</a>(<a class="code" href="../../d2/d80/res__stasis_8c.html#a45c33c16626c653874a91777849d600a">app_controls</a>, control);</div><div class="line"><a name="l01372"></a><span class="lineno"> 1372</span>&#160;</div><div class="line"><a name="l01373"></a><span class="lineno"> 1373</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d2/d80/res__stasis_8c.html#a781587330ea876be1a47210cd6be469f">add_masquerade_store</a>(chan)) {</div><div class="line"><a name="l01374"></a><span class="lineno"> 1374</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Failed to attach masquerade detector\n&quot;</span>);</div><div class="line"><a name="l01375"></a><span class="lineno"> 1375</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l01376"></a><span class="lineno"> 1376</span>&#160;   }</div><div class="line"><a name="l01377"></a><span class="lineno"> 1377</span>&#160;</div><div class="line"><a name="l01378"></a><span class="lineno"> 1378</span>&#160;   res = <a class="code" href="../../d2/d80/res__stasis_8c.html#a02463233ac15605b10e896437db30384">send_start_msg</a>(<a class="code" href="../../de/de3/control_8c.html#a724086dccbb01edfef800bde10a80b55">control_app</a>(control), chan, argc, argv);</div><div class="line"><a name="l01379"></a><span class="lineno"> 1379</span>&#160;   <span class="keywordflow">if</span> (res != 0) {</div><div class="line"><a name="l01380"></a><span class="lineno"> 1380</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>,</div><div class="line"><a name="l01381"></a><span class="lineno"> 1381</span>&#160;         <span class="stringliteral">&quot;Error sending start message to &#39;%s&#39;\n&quot;</span>, <a class="code" href="../../dd/d16/pbx__app_8c.html#a6d3c140ecf1f736c6750d5a17e5bf958">app_name</a>);</div><div class="line"><a name="l01382"></a><span class="lineno"> 1382</span>&#160;      <a class="code" href="../../d2/d80/res__stasis_8c.html#ac5d6bc383547bf03ea940e5fd25b04ec">remove_masquerade_store</a>(chan);</div><div class="line"><a name="l01383"></a><span class="lineno"> 1383</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l01384"></a><span class="lineno"> 1384</span>&#160;   }</div><div class="line"><a name="l01385"></a><span class="lineno"> 1385</span>&#160;</div><div class="line"><a name="l01386"></a><span class="lineno"> 1386</span>&#160;   <span class="comment">/* Pull queued prestart commands and execute */</span></div><div class="line"><a name="l01387"></a><span class="lineno"> 1387</span>&#160;   <a class="code" href="../../de/de3/control_8c.html#a1a3d3390c840aa706358dd3238942bbf">control_prestart_dispatch_all</a>(control, chan);</div><div class="line"><a name="l01388"></a><span class="lineno"> 1388</span>&#160;</div><div class="line"><a name="l01389"></a><span class="lineno"> 1389</span>&#160;   <span class="keywordflow">while</span> (!<a class="code" href="../../de/de3/control_8c.html#a54676258e38bccbf5366bf1ba5a18f9c">control_is_done</a>(control)) {</div><div class="line"><a name="l01390"></a><span class="lineno"> 1390</span>&#160;      <a class="code" href="../../d5/d60/utils_8h.html#a1604b4d72144dd3d9f7da668e90337e9">RAII_VAR</a>(<span class="keyword">struct</span> <a class="code" href="../../d0/d99/structast__frame.html">ast_frame</a> *, f, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../d6/d66/include_2asterisk_2frame_8h.html#a31a8e2bf0224cfe62148232ed25e1aea">ast_frame_dtor</a>);</div><div class="line"><a name="l01391"></a><span class="lineno"> 1391</span>&#160;      <span class="keywordtype">int</span> r;</div><div class="line"><a name="l01392"></a><span class="lineno"> 1392</span>&#160;      <span class="keywordtype">int</span> command_count;</div><div class="line"><a name="l01393"></a><span class="lineno"> 1393</span>&#160;      <a class="code" href="../../d5/d60/utils_8h.html#a1604b4d72144dd3d9f7da668e90337e9">RAII_VAR</a>(<span class="keyword">struct</span> <a class="code" href="../../d4/d84/structast__bridge.html">ast_bridge</a> *, last_bridge, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../d5/da5/astobj2_8h.html#a6321ee982370c55ab3c24c72c562cbdd">ao2_cleanup</a>);</div><div class="line"><a name="l01394"></a><span class="lineno"> 1394</span>&#160;</div><div class="line"><a name="l01395"></a><span class="lineno"> 1395</span>&#160;      <span class="comment">/* Check to see if a bridge absorbed our hangup frame */</span></div><div class="line"><a name="l01396"></a><span class="lineno"> 1396</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="../../d5/d7b/channel_8h.html#a723ac44c92b9edb6c1a731e01edacb4a">ast_check_hangup_locked</a>(chan)) {</div><div class="line"><a name="l01397"></a><span class="lineno"> 1397</span>&#160;         <a class="code" href="../../de/de3/control_8c.html#afe81650a0b8e4926475d3b47fa00da06">control_mark_done</a>(control);</div><div class="line"><a name="l01398"></a><span class="lineno"> 1398</span>&#160;         <span class="keywordflow">break</span>;</div><div class="line"><a name="l01399"></a><span class="lineno"> 1399</span>&#160;      }</div><div class="line"><a name="l01400"></a><span class="lineno"> 1400</span>&#160;</div><div class="line"><a name="l01401"></a><span class="lineno"> 1401</span>&#160;      <span class="comment">/* control-&gt;next_app is only modified within the control thread, so this is safe */</span></div><div class="line"><a name="l01402"></a><span class="lineno"> 1402</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="../../de/de3/control_8c.html#a932badf3c545b8bd5111cad9aaed4c3c">control_next_app</a>(control)) {</div><div class="line"><a name="l01403"></a><span class="lineno"> 1403</span>&#160;         <span class="keyword">struct </span><a class="code" href="../../d4/de3/structstasis__app.html">stasis_app</a> *next_app = <a class="code" href="../../d5/da5/astobj2_8h.html#a911e0703891a9a7aaf73978152092586">ao2_find</a>(<a class="code" href="../../d2/d80/res__stasis_8c.html#adb747ddc4dbb36c7544cbb3b695a777e">apps_registry</a>, <a class="code" href="../../de/de3/control_8c.html#a932badf3c545b8bd5111cad9aaed4c3c">control_next_app</a>(control), <a class="code" href="../../d5/da5/astobj2_8h.html#ad9d009e87e737af900825b36db55a35caa13a6e0771cc457e86f425d95c3b8d54">OBJ_SEARCH_KEY</a>);</div><div class="line"><a name="l01404"></a><span class="lineno"> 1404</span>&#160;</div><div class="line"><a name="l01405"></a><span class="lineno"> 1405</span>&#160;         <span class="keywordflow">if</span> (next_app &amp;&amp; <a class="code" href="../../d3/d5e/res_2stasis_2app_8c.html#aafff5782ef991feae701cb5762457461">app_is_active</a>(next_app)) {</div><div class="line"><a name="l01406"></a><span class="lineno"> 1406</span>&#160;            <span class="keywordtype">int</span> idx;</div><div class="line"><a name="l01407"></a><span class="lineno"> 1407</span>&#160;            <span class="keywordtype">int</span> next_argc;</div><div class="line"><a name="l01408"></a><span class="lineno"> 1408</span>&#160;            <span class="keywordtype">char</span> **next_argv;</div><div class="line"><a name="l01409"></a><span class="lineno"> 1409</span>&#160;</div><div class="line"><a name="l01410"></a><span class="lineno"> 1410</span>&#160;            <span class="comment">/* If something goes wrong in this conditional, res will need to be non-zero</span></div><div class="line"><a name="l01411"></a><span class="lineno"> 1411</span>&#160;<span class="comment">             * so that the code below the exec loop knows something went wrong during a move.</span></div><div class="line"><a name="l01412"></a><span class="lineno"> 1412</span>&#160;<span class="comment">             */</span></div><div class="line"><a name="l01413"></a><span class="lineno"> 1413</span>&#160;            <span class="keywordflow">if</span> (!<a class="code" href="../../d2/d80/res__stasis_8c.html#ae429eca049aebfe3cb49325eef2cb7e8">stasis_app_channel_is_stasis_end_published</a>(chan)) {</div><div class="line"><a name="l01414"></a><span class="lineno"> 1414</span>&#160;               res = <a class="code" href="../../d2/d80/res__stasis_8c.html#a80b5b0071fb1ea9bdac14298a6214064">has_masquerade_store</a>(chan) &amp;&amp; <a class="code" href="../../d2/d80/res__stasis_8c.html#a814d56d14f2e4afead2c709145b240f3">app_send_end_msg</a>(<a class="code" href="../../de/de3/control_8c.html#a724086dccbb01edfef800bde10a80b55">control_app</a>(control), chan);</div><div class="line"><a name="l01415"></a><span class="lineno"> 1415</span>&#160;               <span class="keywordflow">if</span> (res != 0) {</div><div class="line"><a name="l01416"></a><span class="lineno"> 1416</span>&#160;                  <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>,</div><div class="line"><a name="l01417"></a><span class="lineno"> 1417</span>&#160;                     <span class="stringliteral">&quot;Error sending end message to %s\n&quot;</span>, <a class="code" href="../../d8/d9c/stasis__app_8h.html#a8f04206486943b8208052323a7dfd101">stasis_app_name</a>(<a class="code" href="../../de/de3/control_8c.html#a724086dccbb01edfef800bde10a80b55">control_app</a>(control)));</div><div class="line"><a name="l01418"></a><span class="lineno"> 1418</span>&#160;                  <a class="code" href="../../de/de3/control_8c.html#afe81650a0b8e4926475d3b47fa00da06">control_mark_done</a>(control);</div><div class="line"><a name="l01419"></a><span class="lineno"> 1419</span>&#160;                  <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(next_app, -1);</div><div class="line"><a name="l01420"></a><span class="lineno"> 1420</span>&#160;                  <span class="keywordflow">break</span>;</div><div class="line"><a name="l01421"></a><span class="lineno"> 1421</span>&#160;               }</div><div class="line"><a name="l01422"></a><span class="lineno"> 1422</span>&#160;            } <span class="keywordflow">else</span> {</div><div class="line"><a name="l01423"></a><span class="lineno"> 1423</span>&#160;               <a class="code" href="../../d2/d80/res__stasis_8c.html#a4f80fe370f00634dabf90663604ab50c">remove_stasis_end_published</a>(chan);</div><div class="line"><a name="l01424"></a><span class="lineno"> 1424</span>&#160;            }</div><div class="line"><a name="l01425"></a><span class="lineno"> 1425</span>&#160;</div><div class="line"><a name="l01426"></a><span class="lineno"> 1426</span>&#160;            <span class="comment">/* This will ao2_bump next_app, and unref the previous app by 1 */</span></div><div class="line"><a name="l01427"></a><span class="lineno"> 1427</span>&#160;            <a class="code" href="../../de/de3/control_8c.html#aa58df566beb26758f5728fc4b8e693ea">control_set_app</a>(control, next_app);</div><div class="line"><a name="l01428"></a><span class="lineno"> 1428</span>&#160;</div><div class="line"><a name="l01429"></a><span class="lineno"> 1429</span>&#160;            <span class="comment">/* There&#39;s a chance that the previous application is ready for clean up, so go ahead</span></div><div class="line"><a name="l01430"></a><span class="lineno"> 1430</span>&#160;<span class="comment">             * and do that now.</span></div><div class="line"><a name="l01431"></a><span class="lineno"> 1431</span>&#160;<span class="comment">             */</span></div><div class="line"><a name="l01432"></a><span class="lineno"> 1432</span>&#160;            <a class="code" href="../../d2/d80/res__stasis_8c.html#a5c6551bf9ea9cf51ae7f2076c4cbe8ef">cleanup</a>();</div><div class="line"><a name="l01433"></a><span class="lineno"> 1433</span>&#160;</div><div class="line"><a name="l01434"></a><span class="lineno"> 1434</span>&#160;            <span class="comment">/* We need to add another masquerade store, otherwise the leave message will</span></div><div class="line"><a name="l01435"></a><span class="lineno"> 1435</span>&#160;<span class="comment">             * not show up for the correct application.</span></div><div class="line"><a name="l01436"></a><span class="lineno"> 1436</span>&#160;<span class="comment">             */</span></div><div class="line"><a name="l01437"></a><span class="lineno"> 1437</span>&#160;            <span class="keywordflow">if</span> (<a class="code" href="../../d2/d80/res__stasis_8c.html#a781587330ea876be1a47210cd6be469f">add_masquerade_store</a>(chan)) {</div><div class="line"><a name="l01438"></a><span class="lineno"> 1438</span>&#160;               <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Failed to attach masquerade detector\n&quot;</span>);</div><div class="line"><a name="l01439"></a><span class="lineno"> 1439</span>&#160;               res = -1;</div><div class="line"><a name="l01440"></a><span class="lineno"> 1440</span>&#160;               <a class="code" href="../../de/de3/control_8c.html#afe81650a0b8e4926475d3b47fa00da06">control_mark_done</a>(control);</div><div class="line"><a name="l01441"></a><span class="lineno"> 1441</span>&#160;               <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(next_app, -1);</div><div class="line"><a name="l01442"></a><span class="lineno"> 1442</span>&#160;               <span class="keywordflow">break</span>;</div><div class="line"><a name="l01443"></a><span class="lineno"> 1443</span>&#160;            }</div><div class="line"><a name="l01444"></a><span class="lineno"> 1444</span>&#160;</div><div class="line"><a name="l01445"></a><span class="lineno"> 1445</span>&#160;            <span class="comment">/* We MUST get the size before the list, as control_next_app_args steals the elements</span></div><div class="line"><a name="l01446"></a><span class="lineno"> 1446</span>&#160;<span class="comment">             * from the string vector.</span></div><div class="line"><a name="l01447"></a><span class="lineno"> 1447</span>&#160;<span class="comment">             */</span></div><div class="line"><a name="l01448"></a><span class="lineno"> 1448</span>&#160;            next_argc = <a class="code" href="../../de/de3/control_8c.html#a9f8795fd466c8645027ce6ff3620f962">control_next_app_args_size</a>(control);</div><div class="line"><a name="l01449"></a><span class="lineno"> 1449</span>&#160;            next_argv = <a class="code" href="../../de/de3/control_8c.html#ab5db9a2d5072ae2e6b5bd2c718c03ab2">control_next_app_args</a>(control);</div><div class="line"><a name="l01450"></a><span class="lineno"> 1450</span>&#160;</div><div class="line"><a name="l01451"></a><span class="lineno"> 1451</span>&#160;            res = <a class="code" href="../../d2/d80/res__stasis_8c.html#a02463233ac15605b10e896437db30384">send_start_msg</a>(<a class="code" href="../../de/de3/control_8c.html#a724086dccbb01edfef800bde10a80b55">control_app</a>(control), chan, next_argc, next_argv);</div><div class="line"><a name="l01452"></a><span class="lineno"> 1452</span>&#160;</div><div class="line"><a name="l01453"></a><span class="lineno"> 1453</span>&#160;            <span class="comment">/* Even if res != 0, we still need to free the memory we got from control_argv */</span></div><div class="line"><a name="l01454"></a><span class="lineno"> 1454</span>&#160;            <span class="keywordflow">if</span> (next_argv) {</div><div class="line"><a name="l01455"></a><span class="lineno"> 1455</span>&#160;               <span class="keywordflow">for</span> (idx = 0; idx &lt; next_argc; idx++) {</div><div class="line"><a name="l01456"></a><span class="lineno"> 1456</span>&#160;                  <a class="code" href="../../d8/d8a/astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(next_argv[idx]);</div><div class="line"><a name="l01457"></a><span class="lineno"> 1457</span>&#160;               }</div><div class="line"><a name="l01458"></a><span class="lineno"> 1458</span>&#160;               <a class="code" href="../../d8/d8a/astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(next_argv);</div><div class="line"><a name="l01459"></a><span class="lineno"> 1459</span>&#160;            }</div><div class="line"><a name="l01460"></a><span class="lineno"> 1460</span>&#160;</div><div class="line"><a name="l01461"></a><span class="lineno"> 1461</span>&#160;            <span class="keywordflow">if</span> (res != 0) {</div><div class="line"><a name="l01462"></a><span class="lineno"> 1462</span>&#160;               <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>,</div><div class="line"><a name="l01463"></a><span class="lineno"> 1463</span>&#160;                  <span class="stringliteral">&quot;Error sending start message to &#39;%s&#39;\n&quot;</span>, <a class="code" href="../../d8/d9c/stasis__app_8h.html#a8f04206486943b8208052323a7dfd101">stasis_app_name</a>(<a class="code" href="../../de/de3/control_8c.html#a724086dccbb01edfef800bde10a80b55">control_app</a>(control)));</div><div class="line"><a name="l01464"></a><span class="lineno"> 1464</span>&#160;               <a class="code" href="../../d2/d80/res__stasis_8c.html#ac5d6bc383547bf03ea940e5fd25b04ec">remove_masquerade_store</a>(chan);</div><div class="line"><a name="l01465"></a><span class="lineno"> 1465</span>&#160;               <a class="code" href="../../de/de3/control_8c.html#afe81650a0b8e4926475d3b47fa00da06">control_mark_done</a>(control);</div><div class="line"><a name="l01466"></a><span class="lineno"> 1466</span>&#160;               <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(next_app, -1);</div><div class="line"><a name="l01467"></a><span class="lineno"> 1467</span>&#160;               <span class="keywordflow">break</span>;</div><div class="line"><a name="l01468"></a><span class="lineno"> 1468</span>&#160;            }</div><div class="line"><a name="l01469"></a><span class="lineno"> 1469</span>&#160;</div><div class="line"><a name="l01470"></a><span class="lineno"> 1470</span>&#160;            <span class="comment">/* Done switching applications, free memory and clean up */</span></div><div class="line"><a name="l01471"></a><span class="lineno"> 1471</span>&#160;            <a class="code" href="../../de/de3/control_8c.html#afa96ec6119d11c38a2a9385429513cf9">control_move_cleanup</a>(control);</div><div class="line"><a name="l01472"></a><span class="lineno"> 1472</span>&#160;         } <span class="keywordflow">else</span> {</div><div class="line"><a name="l01473"></a><span class="lineno"> 1473</span>&#160;            <span class="comment">/* If we can&#39;t switch applications, do nothing */</span></div><div class="line"><a name="l01474"></a><span class="lineno"> 1474</span>&#160;            <span class="keyword">struct </span><a class="code" href="../../d1/da1/structast__json.html">ast_json</a> *msg;</div><div class="line"><a name="l01475"></a><span class="lineno"> 1475</span>&#160;            <a class="code" href="../../d5/d60/utils_8h.html#a1604b4d72144dd3d9f7da668e90337e9">RAII_VAR</a>(<span class="keyword">struct</span> <a class="code" href="../../dd/dbe/structast__channel__snapshot.html">ast_channel_snapshot</a> *, snapshot, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../d5/da5/astobj2_8h.html#a6321ee982370c55ab3c24c72c562cbdd">ao2_cleanup</a>);</div><div class="line"><a name="l01476"></a><span class="lineno"> 1476</span>&#160;</div><div class="line"><a name="l01477"></a><span class="lineno"> 1477</span>&#160;            <span class="keywordflow">if</span> (!next_app) {</div><div class="line"><a name="l01478"></a><span class="lineno"> 1478</span>&#160;               <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Could not move to Stasis app &#39;%s&#39; - not registered\n&quot;</span>,</div><div class="line"><a name="l01479"></a><span class="lineno"> 1479</span>&#160;                  <a class="code" href="../../de/de3/control_8c.html#a932badf3c545b8bd5111cad9aaed4c3c">control_next_app</a>(control));</div><div class="line"><a name="l01480"></a><span class="lineno"> 1480</span>&#160;            } <span class="keywordflow">else</span> {</div><div class="line"><a name="l01481"></a><span class="lineno"> 1481</span>&#160;               <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Could not move to Stasis app &#39;%s&#39; - not active\n&quot;</span>,</div><div class="line"><a name="l01482"></a><span class="lineno"> 1482</span>&#160;                  <a class="code" href="../../de/de3/control_8c.html#a932badf3c545b8bd5111cad9aaed4c3c">control_next_app</a>(control));</div><div class="line"><a name="l01483"></a><span class="lineno"> 1483</span>&#160;            }</div><div class="line"><a name="l01484"></a><span class="lineno"> 1484</span>&#160;</div><div class="line"><a name="l01485"></a><span class="lineno"> 1485</span>&#160;            snapshot = <a class="code" href="../../df/deb/group__StasisTopicsAndMessages.html#ga68c55b443ba97dc157b493aafd05c876">ast_channel_snapshot_get_latest</a>(<a class="code" href="../../d5/d7b/channel_8h.html#a3b6254f6d3832ef928f0a727113b1c63">ast_channel_uniqueid</a>(chan));</div><div class="line"><a name="l01486"></a><span class="lineno"> 1486</span>&#160;            <span class="keywordflow">if</span> (!snapshot) {</div><div class="line"><a name="l01487"></a><span class="lineno"> 1487</span>&#160;               <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Could not get channel shapshot for &#39;%s&#39;\n&quot;</span>,</div><div class="line"><a name="l01488"></a><span class="lineno"> 1488</span>&#160;                  <a class="code" href="../../d5/d7b/channel_8h.html#a7ca2fda13b129a55c251b56729de285b">ast_channel_name</a>(chan));</div><div class="line"><a name="l01489"></a><span class="lineno"> 1489</span>&#160;            } <span class="keywordflow">else</span> {</div><div class="line"><a name="l01490"></a><span class="lineno"> 1490</span>&#160;               <span class="keyword">struct </span><a class="code" href="../../d1/da1/structast__json.html">ast_json</a> *json_args;</div><div class="line"><a name="l01491"></a><span class="lineno"> 1491</span>&#160;               <span class="keywordtype">int</span> next_argc = <a class="code" href="../../de/de3/control_8c.html#a9f8795fd466c8645027ce6ff3620f962">control_next_app_args_size</a>(control);</div><div class="line"><a name="l01492"></a><span class="lineno"> 1492</span>&#160;               <span class="keywordtype">char</span> **next_argv = <a class="code" href="../../de/de3/control_8c.html#ab5db9a2d5072ae2e6b5bd2c718c03ab2">control_next_app_args</a>(control);</div><div class="line"><a name="l01493"></a><span class="lineno"> 1493</span>&#160;</div><div class="line"><a name="l01494"></a><span class="lineno"> 1494</span>&#160;               msg = <a class="code" href="../../d4/d05/json_8h.html#a99715667e822b2ad409b34ca041e535d">ast_json_pack</a>(<span class="stringliteral">&quot;{s: s, s: o, s: o, s: s, s: []}&quot;</span>,</div><div class="line"><a name="l01495"></a><span class="lineno"> 1495</span>&#160;                  <span class="stringliteral">&quot;type&quot;</span>, <span class="stringliteral">&quot;ApplicationMoveFailed&quot;</span>,</div><div class="line"><a name="l01496"></a><span class="lineno"> 1496</span>&#160;                  <span class="stringliteral">&quot;timestamp&quot;</span>, <a class="code" href="../../d4/d05/json_8h.html#a2b7c72e2e3ab2634d8a4f8b708440d95">ast_json_timeval</a>(<a class="code" href="../../de/df7/time_8h.html#ad3899efb6f0e348556ef69f5b16aa7f7">ast_tvnow</a>(), <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>),</div><div class="line"><a name="l01497"></a><span class="lineno"> 1497</span>&#160;                  <span class="stringliteral">&quot;channel&quot;</span>, <a class="code" href="../../d9/d4a/stasis__channels_8h.html#a7571e6d10d716525aaa64b1f6583979b">ast_channel_snapshot_to_json</a>(snapshot, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>),</div><div class="line"><a name="l01498"></a><span class="lineno"> 1498</span>&#160;                  <span class="stringliteral">&quot;destination&quot;</span>, <a class="code" href="../../de/de3/control_8c.html#a932badf3c545b8bd5111cad9aaed4c3c">control_next_app</a>(control),</div><div class="line"><a name="l01499"></a><span class="lineno"> 1499</span>&#160;                  <span class="stringliteral">&quot;args&quot;</span>);</div><div class="line"><a name="l01500"></a><span class="lineno"> 1500</span>&#160;               <span class="keywordflow">if</span> (!msg) {</div><div class="line"><a name="l01501"></a><span class="lineno"> 1501</span>&#160;                  <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Failed to pack JSON for ApplicationMoveFailed message\n&quot;</span>);</div><div class="line"><a name="l01502"></a><span class="lineno"> 1502</span>&#160;               } <span class="keywordflow">else</span> {</div><div class="line"><a name="l01503"></a><span class="lineno"> 1503</span>&#160;                  json_args = <a class="code" href="../../d4/d05/json_8h.html#a53707225c3bf831e263245c6e3800676">ast_json_object_get</a>(msg, <span class="stringliteral">&quot;args&quot;</span>);</div><div class="line"><a name="l01504"></a><span class="lineno"> 1504</span>&#160;                  <span class="keywordflow">if</span> (!json_args) {</div><div class="line"><a name="l01505"></a><span class="lineno"> 1505</span>&#160;                     <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Could not get args json array&quot;</span>);</div><div class="line"><a name="l01506"></a><span class="lineno"> 1506</span>&#160;                  } <span class="keywordflow">else</span> {</div><div class="line"><a name="l01507"></a><span class="lineno"> 1507</span>&#160;                     <span class="keywordtype">int</span> r = 0;</div><div class="line"><a name="l01508"></a><span class="lineno"> 1508</span>&#160;                     <span class="keywordtype">int</span> idx;</div><div class="line"><a name="l01509"></a><span class="lineno"> 1509</span>&#160;                     <span class="keywordflow">for</span> (idx = 0; idx &lt; next_argc; ++idx) {</div><div class="line"><a name="l01510"></a><span class="lineno"> 1510</span>&#160;                        r = <a class="code" href="../../d4/d05/json_8h.html#a3d675e52f866630a6a03302df2712b8d">ast_json_array_append</a>(json_args,</div><div class="line"><a name="l01511"></a><span class="lineno"> 1511</span>&#160;                           <a class="code" href="../../d4/d05/json_8h.html#adc52f8d76b7fdd0c8d12987981fd5bf5">ast_json_string_create</a>(next_argv[idx]));</div><div class="line"><a name="l01512"></a><span class="lineno"> 1512</span>&#160;                        <span class="keywordflow">if</span> (r != 0) {</div><div class="line"><a name="l01513"></a><span class="lineno"> 1513</span>&#160;                           <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Error appending to ApplicationMoveFailed message\n&quot;</span>);</div><div class="line"><a name="l01514"></a><span class="lineno"> 1514</span>&#160;                           <span class="keywordflow">break</span>;</div><div class="line"><a name="l01515"></a><span class="lineno"> 1515</span>&#160;                        }</div><div class="line"><a name="l01516"></a><span class="lineno"> 1516</span>&#160;                     }</div><div class="line"><a name="l01517"></a><span class="lineno"> 1517</span>&#160;                     <span class="keywordflow">if</span> (r == 0) {</div><div class="line"><a name="l01518"></a><span class="lineno"> 1518</span>&#160;                        <a class="code" href="../../d3/d5e/res_2stasis_2app_8c.html#afc2b5ef224bf880e5ef556a910f41a37">app_send</a>(<a class="code" href="../../de/de3/control_8c.html#a724086dccbb01edfef800bde10a80b55">control_app</a>(control), msg);</div><div class="line"><a name="l01519"></a><span class="lineno"> 1519</span>&#160;                     }</div><div class="line"><a name="l01520"></a><span class="lineno"> 1520</span>&#160;                  }</div><div class="line"><a name="l01521"></a><span class="lineno"> 1521</span>&#160;                  <a class="code" href="../../d4/d05/json_8h.html#a33bcd9181e613a659eefe411ec42c87c">ast_json_unref</a>(msg);</div><div class="line"><a name="l01522"></a><span class="lineno"> 1522</span>&#160;               }</div><div class="line"><a name="l01523"></a><span class="lineno"> 1523</span>&#160;            }</div><div class="line"><a name="l01524"></a><span class="lineno"> 1524</span>&#160;         }</div><div class="line"><a name="l01525"></a><span class="lineno"> 1525</span>&#160;         <a class="code" href="../../de/de3/control_8c.html#afa96ec6119d11c38a2a9385429513cf9">control_move_cleanup</a>(control);</div><div class="line"><a name="l01526"></a><span class="lineno"> 1526</span>&#160;         <a class="code" href="../../d5/da5/astobj2_8h.html#a6321ee982370c55ab3c24c72c562cbdd">ao2_cleanup</a>(next_app);</div><div class="line"><a name="l01527"></a><span class="lineno"> 1527</span>&#160;      }</div><div class="line"><a name="l01528"></a><span class="lineno"> 1528</span>&#160;</div><div class="line"><a name="l01529"></a><span class="lineno"> 1529</span>&#160;      last_bridge = bridge;</div><div class="line"><a name="l01530"></a><span class="lineno"> 1530</span>&#160;      bridge = <a class="code" href="../../d5/da5/astobj2_8h.html#ac438c3fcd3150481fad38689fd813a15">ao2_bump</a>(<a class="code" href="../../d8/d9c/stasis__app_8h.html#a00eec5811d50eb68749bf440708e156b">stasis_app_get_bridge</a>(control));</div><div class="line"><a name="l01531"></a><span class="lineno"> 1531</span>&#160;</div><div class="line"><a name="l01532"></a><span class="lineno"> 1532</span>&#160;      <span class="keywordflow">if</span> (bridge != last_bridge) {</div><div class="line"><a name="l01533"></a><span class="lineno"> 1533</span>&#160;         <span class="keywordflow">if</span> (last_bridge) {</div><div class="line"><a name="l01534"></a><span class="lineno"> 1534</span>&#160;            <a class="code" href="../../d3/d5e/res_2stasis_2app_8c.html#a3319e8e92c07466ddc920e885c6d23f0">app_unsubscribe_bridge</a>(<a class="code" href="../../de/de3/control_8c.html#a724086dccbb01edfef800bde10a80b55">control_app</a>(control), last_bridge);</div><div class="line"><a name="l01535"></a><span class="lineno"> 1535</span>&#160;         }</div><div class="line"><a name="l01536"></a><span class="lineno"> 1536</span>&#160;         <span class="keywordflow">if</span> (bridge) {</div><div class="line"><a name="l01537"></a><span class="lineno"> 1537</span>&#160;            <a class="code" href="../../d3/d5e/res_2stasis_2app_8c.html#a0c81b198af25100a727e3b42f6a6a5ab">app_subscribe_bridge</a>(<a class="code" href="../../de/de3/control_8c.html#a724086dccbb01edfef800bde10a80b55">control_app</a>(control), bridge);</div><div class="line"><a name="l01538"></a><span class="lineno"> 1538</span>&#160;         }</div><div class="line"><a name="l01539"></a><span class="lineno"> 1539</span>&#160;      }</div><div class="line"><a name="l01540"></a><span class="lineno"> 1540</span>&#160;</div><div class="line"><a name="l01541"></a><span class="lineno"> 1541</span>&#160;      <span class="keywordflow">if</span> (bridge) {</div><div class="line"><a name="l01542"></a><span class="lineno"> 1542</span>&#160;         <span class="comment">/* Bridge/dial is handling channel frames */</span></div><div class="line"><a name="l01543"></a><span class="lineno"> 1543</span>&#160;         <a class="code" href="../../de/de3/control_8c.html#a316d08ca5342616eaf4b154d784477a1">control_wait</a>(control);</div><div class="line"><a name="l01544"></a><span class="lineno"> 1544</span>&#160;         <a class="code" href="../../de/de3/control_8c.html#a9f61f3aaffc1704240675904f5dea104">control_dispatch_all</a>(control, chan);</div><div class="line"><a name="l01545"></a><span class="lineno"> 1545</span>&#160;         <span class="keywordflow">continue</span>;</div><div class="line"><a name="l01546"></a><span class="lineno"> 1546</span>&#160;      }</div><div class="line"><a name="l01547"></a><span class="lineno"> 1547</span>&#160;</div><div class="line"><a name="l01548"></a><span class="lineno"> 1548</span>&#160;      r = <a class="code" href="../../d5/d7b/channel_8h.html#a60e0bcaed001e8d5ed1ba0eb2644b3cc">ast_waitfor</a>(chan, <a class="code" href="../../d2/d80/res__stasis_8c.html#ab274133b24b2c226e9d1cda3bbe5eed3">MAX_WAIT_MS</a>);</div><div class="line"><a name="l01549"></a><span class="lineno"> 1549</span>&#160;</div><div class="line"><a name="l01550"></a><span class="lineno"> 1550</span>&#160;      <span class="keywordflow">if</span> (r &lt; 0) {</div><div class="line"><a name="l01551"></a><span class="lineno"> 1551</span>&#160;         <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(3, <span class="stringliteral">&quot;%s: Poll error\n&quot;</span>,</div><div class="line"><a name="l01552"></a><span class="lineno"> 1552</span>&#160;              <a class="code" href="../../d5/d7b/channel_8h.html#a3b6254f6d3832ef928f0a727113b1c63">ast_channel_uniqueid</a>(chan));</div><div class="line"><a name="l01553"></a><span class="lineno"> 1553</span>&#160;         <a class="code" href="../../de/de3/control_8c.html#afe81650a0b8e4926475d3b47fa00da06">control_mark_done</a>(control);</div><div class="line"><a name="l01554"></a><span class="lineno"> 1554</span>&#160;         <span class="keywordflow">break</span>;</div><div class="line"><a name="l01555"></a><span class="lineno"> 1555</span>&#160;      }</div><div class="line"><a name="l01556"></a><span class="lineno"> 1556</span>&#160;</div><div class="line"><a name="l01557"></a><span class="lineno"> 1557</span>&#160;      command_count = <a class="code" href="../../de/de3/control_8c.html#a9f61f3aaffc1704240675904f5dea104">control_dispatch_all</a>(control, chan);</div><div class="line"><a name="l01558"></a><span class="lineno"> 1558</span>&#160;</div><div class="line"><a name="l01559"></a><span class="lineno"> 1559</span>&#160;      <span class="keywordflow">if</span> (command_count &gt; 0 &amp;&amp; <a class="code" href="../../d5/d7b/channel_8h.html#a3e3e7e66e65ad9cdba2299e36b13e173">ast_channel_fdno</a>(chan) == -1) {</div><div class="line"><a name="l01560"></a><span class="lineno"> 1560</span>&#160;         <span class="comment">/* Command drained the channel; wait for next frame */</span></div><div class="line"><a name="l01561"></a><span class="lineno"> 1561</span>&#160;         <span class="keywordflow">continue</span>;</div><div class="line"><a name="l01562"></a><span class="lineno"> 1562</span>&#160;      }</div><div class="line"><a name="l01563"></a><span class="lineno"> 1563</span>&#160;</div><div class="line"><a name="l01564"></a><span class="lineno"> 1564</span>&#160;      <span class="keywordflow">if</span> (r == 0) {</div><div class="line"><a name="l01565"></a><span class="lineno"> 1565</span>&#160;         <span class="comment">/* Timeout */</span></div><div class="line"><a name="l01566"></a><span class="lineno"> 1566</span>&#160;         <span class="keywordflow">continue</span>;</div><div class="line"><a name="l01567"></a><span class="lineno"> 1567</span>&#160;      }</div><div class="line"><a name="l01568"></a><span class="lineno"> 1568</span>&#160;</div><div class="line"><a name="l01569"></a><span class="lineno"> 1569</span>&#160;      f = <a class="code" href="../../d5/d7b/channel_8h.html#a7ef6737309dc9e8b6c4a7cb4800638b1">ast_read</a>(chan);</div><div class="line"><a name="l01570"></a><span class="lineno"> 1570</span>&#160;      <span class="keywordflow">if</span> (!f) {</div><div class="line"><a name="l01571"></a><span class="lineno"> 1571</span>&#160;         <span class="comment">/* Continue on in the dialplan */</span></div><div class="line"><a name="l01572"></a><span class="lineno"> 1572</span>&#160;         <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(3, <span class="stringliteral">&quot;%s: Hangup (no more frames)\n&quot;</span>,</div><div class="line"><a name="l01573"></a><span class="lineno"> 1573</span>&#160;            <a class="code" href="../../d5/d7b/channel_8h.html#a3b6254f6d3832ef928f0a727113b1c63">ast_channel_uniqueid</a>(chan));</div><div class="line"><a name="l01574"></a><span class="lineno"> 1574</span>&#160;         <a class="code" href="../../de/de3/control_8c.html#afe81650a0b8e4926475d3b47fa00da06">control_mark_done</a>(control);</div><div class="line"><a name="l01575"></a><span class="lineno"> 1575</span>&#160;         <span class="keywordflow">break</span>;</div><div class="line"><a name="l01576"></a><span class="lineno"> 1576</span>&#160;      }</div><div class="line"><a name="l01577"></a><span class="lineno"> 1577</span>&#160;</div><div class="line"><a name="l01578"></a><span class="lineno"> 1578</span>&#160;      <span class="keywordflow">if</span> (f-&gt;frametype == <a class="code" href="../../d6/d66/include_2asterisk_2frame_8h.html#ae2e1a9c4e048da387b761f619312d6e0ae1dae388b0d70825876e137ae95bb0c1">AST_FRAME_CONTROL</a>) {</div><div class="line"><a name="l01579"></a><span class="lineno"> 1579</span>&#160;         <span class="keywordflow">if</span> (f-&gt;subclass.integer == <a class="code" href="../../d6/d66/include_2asterisk_2frame_8h.html#aedda41918e992000fe921f8f7363b390aa7dac1c1896ab418c2ff351aae707fba">AST_CONTROL_HANGUP</a>) {</div><div class="line"><a name="l01580"></a><span class="lineno"> 1580</span>&#160;            <span class="comment">/* Continue on in the dialplan */</span></div><div class="line"><a name="l01581"></a><span class="lineno"> 1581</span>&#160;            <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(3, <span class="stringliteral">&quot;%s: Hangup\n&quot;</span>,</div><div class="line"><a name="l01582"></a><span class="lineno"> 1582</span>&#160;               <a class="code" href="../../d5/d7b/channel_8h.html#a3b6254f6d3832ef928f0a727113b1c63">ast_channel_uniqueid</a>(chan));</div><div class="line"><a name="l01583"></a><span class="lineno"> 1583</span>&#160;            <a class="code" href="../../de/de3/control_8c.html#afe81650a0b8e4926475d3b47fa00da06">control_mark_done</a>(control);</div><div class="line"><a name="l01584"></a><span class="lineno"> 1584</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l01585"></a><span class="lineno"> 1585</span>&#160;         }</div><div class="line"><a name="l01586"></a><span class="lineno"> 1586</span>&#160;      }</div><div class="line"><a name="l01587"></a><span class="lineno"> 1587</span>&#160;   }</div><div class="line"><a name="l01588"></a><span class="lineno"> 1588</span>&#160;</div><div class="line"><a name="l01589"></a><span class="lineno"> 1589</span>&#160;   <a class="code" href="../../d5/d7b/channel_8h.html#a493bdebe876caafb8ee535853310364a">ast_channel_lock</a>(chan);</div><div class="line"><a name="l01590"></a><span class="lineno"> 1590</span>&#160;   needs_depart = (<a class="code" href="../../d5/d7b/channel_8h.html#a5e41daaa81df59fc1e8eea2796029c31">ast_channel_internal_bridge_channel</a>(chan) != <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div><div class="line"><a name="l01591"></a><span class="lineno"> 1591</span>&#160;   <a class="code" href="../../d5/d7b/channel_8h.html#af476c537b29be3f29240489032f9db39">ast_channel_unlock</a>(chan);</div><div class="line"><a name="l01592"></a><span class="lineno"> 1592</span>&#160;   <span class="keywordflow">if</span> (needs_depart) {</div><div class="line"><a name="l01593"></a><span class="lineno"> 1593</span>&#160;      <a class="code" href="../../d4/d56/bridge_8h.html#a0075715d330c8492e03c6d3ca3f48e13">ast_bridge_depart</a>(chan);</div><div class="line"><a name="l01594"></a><span class="lineno"> 1594</span>&#160;   }</div><div class="line"><a name="l01595"></a><span class="lineno"> 1595</span>&#160;</div><div class="line"><a name="l01596"></a><span class="lineno"> 1596</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d8/d9c/stasis__app_8h.html#a00eec5811d50eb68749bf440708e156b">stasis_app_get_bridge</a>(control)) {</div><div class="line"><a name="l01597"></a><span class="lineno"> 1597</span>&#160;      <a class="code" href="../../d3/d5e/res_2stasis_2app_8c.html#a3319e8e92c07466ddc920e885c6d23f0">app_unsubscribe_bridge</a>(<a class="code" href="../../de/de3/control_8c.html#a724086dccbb01edfef800bde10a80b55">control_app</a>(control), <a class="code" href="../../d8/d9c/stasis__app_8h.html#a00eec5811d50eb68749bf440708e156b">stasis_app_get_bridge</a>(control));</div><div class="line"><a name="l01598"></a><span class="lineno"> 1598</span>&#160;   }</div><div class="line"><a name="l01599"></a><span class="lineno"> 1599</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#a6321ee982370c55ab3c24c72c562cbdd">ao2_cleanup</a>(bridge);</div><div class="line"><a name="l01600"></a><span class="lineno"> 1600</span>&#160;</div><div class="line"><a name="l01601"></a><span class="lineno"> 1601</span>&#160;   <span class="comment">/* Only publish a stasis_end event if it hasn&#39;t already been published */</span></div><div class="line"><a name="l01602"></a><span class="lineno"> 1602</span>&#160;   <span class="keywordflow">if</span> (!res &amp;&amp; !<a class="code" href="../../d2/d80/res__stasis_8c.html#ae429eca049aebfe3cb49325eef2cb7e8">stasis_app_channel_is_stasis_end_published</a>(chan)) {</div><div class="line"><a name="l01603"></a><span class="lineno"> 1603</span>&#160;      <span class="comment">/* A masquerade has occurred and this message will be wrong so it</span></div><div class="line"><a name="l01604"></a><span class="lineno"> 1604</span>&#160;<span class="comment">       * has already been sent elsewhere. */</span></div><div class="line"><a name="l01605"></a><span class="lineno"> 1605</span>&#160;      res = <a class="code" href="../../d2/d80/res__stasis_8c.html#a80b5b0071fb1ea9bdac14298a6214064">has_masquerade_store</a>(chan) &amp;&amp; <a class="code" href="../../d2/d80/res__stasis_8c.html#a814d56d14f2e4afead2c709145b240f3">app_send_end_msg</a>(<a class="code" href="../../de/de3/control_8c.html#a724086dccbb01edfef800bde10a80b55">control_app</a>(control), chan);</div><div class="line"><a name="l01606"></a><span class="lineno"> 1606</span>&#160;      <span class="keywordflow">if</span> (res != 0) {</div><div class="line"><a name="l01607"></a><span class="lineno"> 1607</span>&#160;         <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>,</div><div class="line"><a name="l01608"></a><span class="lineno"> 1608</span>&#160;            <span class="stringliteral">&quot;Error sending end message to %s\n&quot;</span>, <a class="code" href="../../d8/d9c/stasis__app_8h.html#a8f04206486943b8208052323a7dfd101">stasis_app_name</a>(<a class="code" href="../../de/de3/control_8c.html#a724086dccbb01edfef800bde10a80b55">control_app</a>(control)));</div><div class="line"><a name="l01609"></a><span class="lineno"> 1609</span>&#160;         <span class="keywordflow">return</span> res;</div><div class="line"><a name="l01610"></a><span class="lineno"> 1610</span>&#160;      }</div><div class="line"><a name="l01611"></a><span class="lineno"> 1611</span>&#160;   } <span class="keywordflow">else</span> {</div><div class="line"><a name="l01612"></a><span class="lineno"> 1612</span>&#160;      <a class="code" href="../../d2/d80/res__stasis_8c.html#a4f80fe370f00634dabf90663604ab50c">remove_stasis_end_published</a>(chan);</div><div class="line"><a name="l01613"></a><span class="lineno"> 1613</span>&#160;   }</div><div class="line"><a name="l01614"></a><span class="lineno"> 1614</span>&#160;</div><div class="line"><a name="l01615"></a><span class="lineno"> 1615</span>&#160;   <a class="code" href="../../de/de3/control_8c.html#a80664020fe48449d024096157937b40c">control_flush_queue</a>(control);</div><div class="line"><a name="l01616"></a><span class="lineno"> 1616</span>&#160;</div><div class="line"><a name="l01617"></a><span class="lineno"> 1617</span>&#160;   <span class="comment">/* Stop any lingering silence generator */</span></div><div class="line"><a name="l01618"></a><span class="lineno"> 1618</span>&#160;   <a class="code" href="../../de/de3/control_8c.html#ad25a5432fda39aae3c2c68f19105b059">control_silence_stop_now</a>(control);</div><div class="line"><a name="l01619"></a><span class="lineno"> 1619</span>&#160;</div><div class="line"><a name="l01620"></a><span class="lineno"> 1620</span>&#160;   <span class="comment">/* There&#39;s an off chance that app is ready for cleanup. Go ahead</span></div><div class="line"><a name="l01621"></a><span class="lineno"> 1621</span>&#160;<span class="comment">    * and clean up, just in case</span></div><div class="line"><a name="l01622"></a><span class="lineno"> 1622</span>&#160;<span class="comment">    */</span></div><div class="line"><a name="l01623"></a><span class="lineno"> 1623</span>&#160;   <a class="code" href="../../d2/d80/res__stasis_8c.html#a5c6551bf9ea9cf51ae7f2076c4cbe8ef">cleanup</a>();</div><div class="line"><a name="l01624"></a><span class="lineno"> 1624</span>&#160;</div><div class="line"><a name="l01625"></a><span class="lineno"> 1625</span>&#160;   <span class="comment">/* The control needs to be removed from the controls container in</span></div><div class="line"><a name="l01626"></a><span class="lineno"> 1626</span>&#160;<span class="comment">    * case a new PBX is started and ends up coming back into Stasis.</span></div><div class="line"><a name="l01627"></a><span class="lineno"> 1627</span>&#160;<span class="comment">    */</span></div><div class="line"><a name="l01628"></a><span class="lineno"> 1628</span>&#160;   <a class="code" href="../../d2/d80/res__stasis_8c.html#ae122dda67c23017097471a5cca1d4d42">control_unlink</a>(control);</div><div class="line"><a name="l01629"></a><span class="lineno"> 1629</span>&#160;   control = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l01630"></a><span class="lineno"> 1630</span>&#160;</div><div class="line"><a name="l01631"></a><span class="lineno"> 1631</span>&#160;   <span class="keywordflow">if</span> (!res &amp;&amp; !<a class="code" href="../../d5/d7b/channel_8h.html#a488b7d6f7488bedc53be45d4ef4471c9">ast_channel_pbx</a>(chan)) {</div><div class="line"><a name="l01632"></a><span class="lineno"> 1632</span>&#160;      <span class="keywordtype">int</span> chan_hungup;</div><div class="line"><a name="l01633"></a><span class="lineno"> 1633</span>&#160;</div><div class="line"><a name="l01634"></a><span class="lineno"> 1634</span>&#160;      <span class="comment">/* The ASYNCGOTO softhangup flag may have broken the channel out of</span></div><div class="line"><a name="l01635"></a><span class="lineno"> 1635</span>&#160;<span class="comment">       * its bridge to run dialplan, so if there&#39;s no pbx on the channel</span></div><div class="line"><a name="l01636"></a><span class="lineno"> 1636</span>&#160;<span class="comment">       * let it run dialplan here. Otherwise, it will run when this</span></div><div class="line"><a name="l01637"></a><span class="lineno"> 1637</span>&#160;<span class="comment">       * application exits. */</span></div><div class="line"><a name="l01638"></a><span class="lineno"> 1638</span>&#160;      <a class="code" href="../../d5/d7b/channel_8h.html#a493bdebe876caafb8ee535853310364a">ast_channel_lock</a>(chan);</div><div class="line"><a name="l01639"></a><span class="lineno"> 1639</span>&#160;      <a class="code" href="../../d5/d7b/channel_8h.html#a21c057f81ff8b02eb1120410ae86e657">ast_channel_clear_softhangup</a>(chan, <a class="code" href="../../d5/d7b/channel_8h.html#a9e9505a91a84992d04ba4e85217fb4e4a085c0c603de12dc2474a17a92e1cb5a4">AST_SOFTHANGUP_ASYNCGOTO</a>);</div><div class="line"><a name="l01640"></a><span class="lineno"> 1640</span>&#160;      chan_hungup = <a class="code" href="../../d5/d7b/channel_8h.html#a9c63fff1d736568d1ee332dd7ea502bd">ast_check_hangup</a>(chan);</div><div class="line"><a name="l01641"></a><span class="lineno"> 1641</span>&#160;      <a class="code" href="../../d5/d7b/channel_8h.html#af476c537b29be3f29240489032f9db39">ast_channel_unlock</a>(chan);</div><div class="line"><a name="l01642"></a><span class="lineno"> 1642</span>&#160;</div><div class="line"><a name="l01643"></a><span class="lineno"> 1643</span>&#160;      <span class="keywordflow">if</span> (!chan_hungup) {</div><div class="line"><a name="l01644"></a><span class="lineno"> 1644</span>&#160;         <span class="keyword">struct </span><a class="code" href="../../da/db8/structast__pbx__args.html">ast_pbx_args</a> pbx_args;</div><div class="line"><a name="l01645"></a><span class="lineno"> 1645</span>&#160;</div><div class="line"><a name="l01646"></a><span class="lineno"> 1646</span>&#160;         memset(&amp;pbx_args, 0, <span class="keyword">sizeof</span>(pbx_args));</div><div class="line"><a name="l01647"></a><span class="lineno"> 1647</span>&#160;         pbx_args.no_hangup_chan = 1;</div><div class="line"><a name="l01648"></a><span class="lineno"> 1648</span>&#160;</div><div class="line"><a name="l01649"></a><span class="lineno"> 1649</span>&#160;         res = <a class="code" href="../../db/de0/pbx_8h.html#a2c502c100b8b4791d9efe395e08d620b">ast_pbx_run_args</a>(chan, &amp;pbx_args);</div><div class="line"><a name="l01650"></a><span class="lineno"> 1650</span>&#160;      }</div><div class="line"><a name="l01651"></a><span class="lineno"> 1651</span>&#160;   }</div><div class="line"><a name="l01652"></a><span class="lineno"> 1652</span>&#160;</div><div class="line"><a name="l01653"></a><span class="lineno"> 1653</span>&#160;   <span class="keywordflow">return</span> res;</div><div class="line"><a name="l01654"></a><span class="lineno"> 1654</span>&#160;}</div><div class="ttc" id="stasis__app_8h_html_a00eec5811d50eb68749bf440708e156b"><div class="ttname"><a href="../../d8/d9c/stasis__app_8h.html#a00eec5811d50eb68749bf440708e156b">stasis_app_get_bridge</a></div><div class="ttdeci">struct ast_bridge * stasis_app_get_bridge(struct stasis_app_control *control)</div><div class="ttdoc">Gets the bridge currently associated with a control object. </div><div class="ttdef"><b>Definition:</b> <a href="../../de/de3/control_8c_source.html#l00931">control.c:931</a></div></div>
<div class="ttc" id="structast__pbx__args_html"><div class="ttname"><a href="../../da/db8/structast__pbx__args.html">ast_pbx_args</a></div><div class="ttdoc">Options for ast_pbx_run() </div><div class="ttdef"><b>Definition:</b> <a href="../../db/de0/pbx_8h_source.html#l00391">pbx.h:391</a></div></div>
<div class="ttc" id="channel_8h_html_a493bdebe876caafb8ee535853310364a"><div class="ttname"><a href="../../d5/d7b/channel_8h.html#a493bdebe876caafb8ee535853310364a">ast_channel_lock</a></div><div class="ttdeci">#define ast_channel_lock(chan)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d7b/channel_8h_source.html#l02945">channel.h:2945</a></div></div>
<div class="ttc" id="control_8c_html_a932badf3c545b8bd5111cad9aaed4c3c"><div class="ttname"><a href="../../de/de3/control_8c.html#a932badf3c545b8bd5111cad9aaed4c3c">control_next_app</a></div><div class="ttdeci">char * control_next_app(struct stasis_app_control *control)</div><div class="ttdoc">Returns the name of the application we are moving to. </div><div class="ttdef"><b>Definition:</b> <a href="../../de/de3/control_8c_source.html#l01697">control.c:1697</a></div></div>
<div class="ttc" id="control_8c_html_ab5db9a2d5072ae2e6b5bd2c718c03ab2"><div class="ttname"><a href="../../de/de3/control_8c.html#ab5db9a2d5072ae2e6b5bd2c718c03ab2">control_next_app_args</a></div><div class="ttdeci">char ** control_next_app_args(struct stasis_app_control *control)</div><div class="ttdoc">Returns the list of arguments to pass to the application we are moving to. </div><div class="ttdef"><b>Definition:</b> <a href="../../de/de3/control_8c_source.html#l01710">control.c:1710</a></div></div>
<div class="ttc" id="json_8h_html_a99715667e822b2ad409b34ca041e535d"><div class="ttname"><a href="../../d4/d05/json_8h.html#a99715667e822b2ad409b34ca041e535d">ast_json_pack</a></div><div class="ttdeci">struct ast_json * ast_json_pack(char const *format,...)</div><div class="ttdoc">Helper for creating complex JSON values. </div><div class="ttdef"><b>Definition:</b> <a href="../../df/d98/json_8c_source.html#l00591">json.c:591</a></div></div>
<div class="ttc" id="astobj2_8h_html_ad9d009e87e737af900825b36db55a35caa13a6e0771cc457e86f425d95c3b8d54"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#ad9d009e87e737af900825b36db55a35caa13a6e0771cc457e86f425d95c3b8d54">OBJ_SEARCH_KEY</a></div><div class="ttdoc">The arg parameter is a search key, but is not an object. </div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l01105">astobj2.h:1105</a></div></div>
<div class="ttc" id="json_8h_html_a33bcd9181e613a659eefe411ec42c87c"><div class="ttname"><a href="../../d4/d05/json_8h.html#a33bcd9181e613a659eefe411ec42c87c">ast_json_unref</a></div><div class="ttdeci">void ast_json_unref(struct ast_json *value)</div><div class="ttdoc">Decrease refcount on value. If refcount reaches zero, value is freed. </div><div class="ttdef"><b>Definition:</b> <a href="../../df/d98/json_8c_source.html#l00073">json.c:73</a></div></div>
<div class="ttc" id="control_8c_html_afe81650a0b8e4926475d3b47fa00da06"><div class="ttname"><a href="../../de/de3/control_8c.html#afe81650a0b8e4926475d3b47fa00da06">control_mark_done</a></div><div class="ttdeci">void control_mark_done(struct stasis_app_control *control)</div><div class="ttdef"><b>Definition:</b> <a href="../../de/de3/control_8c_source.html#l00354">control.c:354</a></div></div>
<div class="ttc" id="channel_8h_html_a723ac44c92b9edb6c1a731e01edacb4a"><div class="ttname"><a href="../../d5/d7b/channel_8h.html#a723ac44c92b9edb6c1a731e01edacb4a">ast_check_hangup_locked</a></div><div class="ttdeci">int ast_check_hangup_locked(struct ast_channel *chan)</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d28/channel_8c_source.html#l00459">channel.c:459</a></div></div>
<div class="ttc" id="control_8c_html_a80664020fe48449d024096157937b40c"><div class="ttname"><a href="../../de/de3/control_8c.html#a80664020fe48449d024096157937b40c">control_flush_queue</a></div><div class="ttdeci">void control_flush_queue(struct stasis_app_control *control)</div><div class="ttdoc">Flush the control command queue. </div><div class="ttdef"><b>Definition:</b> <a href="../../de/de3/control_8c_source.html#l01482">control.c:1482</a></div></div>
<div class="ttc" id="structast__channel__snapshot_html"><div class="ttname"><a href="../../dd/dbe/structast__channel__snapshot.html">ast_channel_snapshot</a></div><div class="ttdoc">Structure representing a snapshot of channel state. </div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d4a/stasis__channels_8h_source.html#l00145">stasis_channels.h:145</a></div></div>
<div class="ttc" id="channel_8h_html_a7ef6737309dc9e8b6c4a7cb4800638b1"><div class="ttname"><a href="../../d5/d7b/channel_8h.html#a7ef6737309dc9e8b6c4a7cb4800638b1">ast_read</a></div><div class="ttdeci">struct ast_frame * ast_read(struct ast_channel *chan)</div><div class="ttdoc">Reads a frame. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d28/channel_8c_source.html#l04302">channel.c:4302</a></div></div>
<div class="ttc" id="structstasis__app_html"><div class="ttname"><a href="../../d4/de3/structstasis__app.html">stasis_app</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d5e/res_2stasis_2app_8c_source.html#l00049">res/stasis/app.c:49</a></div></div>
<div class="ttc" id="res__stasis_8c_html_a80b5b0071fb1ea9bdac14298a6214064"><div class="ttname"><a href="../../d2/d80/res__stasis_8c.html#a80b5b0071fb1ea9bdac14298a6214064">has_masquerade_store</a></div><div class="ttdeci">static int has_masquerade_store(struct ast_channel *chan)</div><div class="ttdef"><b>Definition:</b> <a href="../../d2/d80/res__stasis_8c_source.html#l01211">res_stasis.c:1211</a></div></div>
<div class="ttc" id="time_8h_html_ad3899efb6f0e348556ef69f5b16aa7f7"><div class="ttname"><a href="../../de/df7/time_8h.html#ad3899efb6f0e348556ef69f5b16aa7f7">ast_tvnow</a></div><div class="ttdeci">struct timeval ast_tvnow(void)</div><div class="ttdoc">Returns current timeval. Meant to replace calls to gettimeofday(). </div><div class="ttdef"><b>Definition:</b> <a href="../../de/df7/time_8h_source.html#l00150">time.h:150</a></div></div>
<div class="ttc" id="utils_8h_html_a24374da24af1931d8a7ccde5b352bb2c"><div class="ttname"><a href="../../d5/d60/utils_8h.html#a24374da24af1931d8a7ccde5b352bb2c">ast_assert</a></div><div class="ttdeci">#define ast_assert(a)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d60/utils_8h_source.html#l00695">utils.h:695</a></div></div>
<div class="ttc" id="res__stasis_8c_html_ac5d6bc383547bf03ea940e5fd25b04ec"><div class="ttname"><a href="../../d2/d80/res__stasis_8c.html#ac5d6bc383547bf03ea940e5fd25b04ec">remove_masquerade_store</a></div><div class="ttdeci">static void remove_masquerade_store(struct ast_channel *chan)</div><div class="ttdef"><b>Definition:</b> <a href="../../d2/d80/res__stasis_8c_source.html#l01236">res_stasis.c:1236</a></div></div>
<div class="ttc" id="resample_8c_html_a070d2ce7b6bb7e5c05602aa8c308d0c4"><div class="ttname"><a href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a></div><div class="ttdeci">#define NULL</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d7f/resample_8c_source.html#l00096">resample.c:96</a></div></div>
<div class="ttc" id="control_8c_html_a724086dccbb01edfef800bde10a80b55"><div class="ttname"><a href="../../de/de3/control_8c.html#a724086dccbb01edfef800bde10a80b55">control_app</a></div><div class="ttdeci">struct stasis_app * control_app(struct stasis_app_control *control)</div><div class="ttdoc">Returns the pointer (non-reffed) to the app associated with this control. </div><div class="ttdef"><b>Definition:</b> <a href="../../de/de3/control_8c_source.html#l01563">control.c:1563</a></div></div>
<div class="ttc" id="res_2stasis_2app_8c_html_aafff5782ef991feae701cb5762457461"><div class="ttname"><a href="../../d3/d5e/res_2stasis_2app_8c.html#aafff5782ef991feae701cb5762457461">app_is_active</a></div><div class="ttdeci">int app_is_active(struct stasis_app *app)</div><div class="ttdoc">Checks whether an app is active. </div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d5e/res_2stasis_2app_8c_source.html#l01094">res/stasis/app.c:1094</a></div></div>
<div class="ttc" id="control_8c_html_a9f61f3aaffc1704240675904f5dea104"><div class="ttname"><a href="../../de/de3/control_8c.html#a9f61f3aaffc1704240675904f5dea104">control_dispatch_all</a></div><div class="ttdeci">int control_dispatch_all(struct stasis_app_control *control, struct ast_channel *chan)</div><div class="ttdoc">Dispatch all commands enqueued to this control. </div><div class="ttdef"><b>Definition:</b> <a href="../../de/de3/control_8c_source.html#l01495">control.c:1495</a></div></div>
<div class="ttc" id="res_2stasis_2app_8c_html_a0c81b198af25100a727e3b42f6a6a5ab"><div class="ttname"><a href="../../d3/d5e/res_2stasis_2app_8c.html#a0c81b198af25100a727e3b42f6a6a5ab">app_subscribe_bridge</a></div><div class="ttdeci">int app_subscribe_bridge(struct stasis_app *app, struct ast_bridge *bridge)</div><div class="ttdoc">Add a bridge subscription to an existing channel subscription. </div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d5e/res_2stasis_2app_8c_source.html#l01428">res/stasis/app.c:1428</a></div></div>
<div class="ttc" id="include_2asterisk_2frame_8h_html_a31a8e2bf0224cfe62148232ed25e1aea"><div class="ttname"><a href="../../d6/d66/include_2asterisk_2frame_8h.html#a31a8e2bf0224cfe62148232ed25e1aea">ast_frame_dtor</a></div><div class="ttdeci">void ast_frame_dtor(struct ast_frame *frame)</div><div class="ttdoc">NULL-safe wrapper for ast_frfree, good for RAII_VAR. </div><div class="ttdef"><b>Definition:</b> <a href="../../df/d55/main_2frame_8c_source.html#l00187">main/frame.c:187</a></div></div>
<div class="ttc" id="res__stasis_8c_html_a45c33c16626c653874a91777849d600a"><div class="ttname"><a href="../../d2/d80/res__stasis_8c.html#a45c33c16626c653874a91777849d600a">app_controls</a></div><div class="ttdeci">struct ao2_container * app_controls</div><div class="ttdef"><b>Definition:</b> <a href="../../d2/d80/res__stasis_8c_source.html#l00102">res_stasis.c:102</a></div></div>
<div class="ttc" id="res__stasis_8c_html_a814d56d14f2e4afead2c709145b240f3"><div class="ttname"><a href="../../d2/d80/res__stasis_8c.html#a814d56d14f2e4afead2c709145b240f3">app_send_end_msg</a></div><div class="ttdeci">int app_send_end_msg(struct stasis_app *app, struct ast_channel *chan)</div><div class="ttdoc">Send StasisEnd message to the listening app. </div><div class="ttdef"><b>Definition:</b> <a href="../../d2/d80/res__stasis_8c_source.html#l01083">res_stasis.c:1083</a></div></div>
<div class="ttc" id="astobj2_8h_html_ac438c3fcd3150481fad38689fd813a15"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#ac438c3fcd3150481fad38689fd813a15">ao2_bump</a></div><div class="ttdeci">#define ao2_bump(obj)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l00491">astobj2.h:491</a></div></div>
<div class="ttc" id="logger_8h_html_a3f248112c8d6ce7e3959aa723dade648"><div class="ttname"><a href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a></div><div class="ttdeci">#define ast_debug(level,...)</div><div class="ttdoc">Log a DEBUG message. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d8c/logger_8h_source.html#l00452">logger.h:452</a></div></div>
<div class="ttc" id="astobj2_8c_html_a96a00b3a518d7f32b6d51dc28f09bf9b"><div class="ttname"><a href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a></div><div class="ttdeci">#define ast_log</div><div class="ttdef"><b>Definition:</b> <a href="../../da/df7/astobj2_8c_source.html#l00042">astobj2.c:42</a></div></div>
<div class="ttc" id="res__stasis_8c_html_a5c6551bf9ea9cf51ae7f2076c4cbe8ef"><div class="ttname"><a href="../../d2/d80/res__stasis_8c.html#a5c6551bf9ea9cf51ae7f2076c4cbe8ef">cleanup</a></div><div class="ttdeci">static void cleanup(void)</div><div class="ttdoc">Clean up any old apps that we don&amp;#39;t need any more. </div><div class="ttdef"><b>Definition:</b> <a href="../../d2/d80/res__stasis_8c_source.html#l00327">res_stasis.c:327</a></div></div>
<div class="ttc" id="res__stasis_8c_html_ae429eca049aebfe3cb49325eef2cb7e8"><div class="ttname"><a href="../../d2/d80/res__stasis_8c.html#ae429eca049aebfe3cb49325eef2cb7e8">stasis_app_channel_is_stasis_end_published</a></div><div class="ttdeci">int stasis_app_channel_is_stasis_end_published(struct ast_channel *chan)</div><div class="ttdoc">Has this channel had a StasisEnd published on it? </div><div class="ttdef"><b>Definition:</b> <a href="../../d2/d80/res__stasis_8c_source.html#l01299">res_stasis.c:1299</a></div></div>
<div class="ttc" id="control_8c_html_afa96ec6119d11c38a2a9385429513cf9"><div class="ttname"><a href="../../de/de3/control_8c.html#afa96ec6119d11c38a2a9385429513cf9">control_move_cleanup</a></div><div class="ttdeci">void control_move_cleanup(struct stasis_app_control *control)</div><div class="ttdoc">Free any memory that was allocated for switching applications via /channels/{channelId}/move. </div><div class="ttdef"><b>Definition:</b> <a href="../../de/de3/control_8c_source.html#l01702">control.c:1702</a></div></div>
<div class="ttc" id="structstasis__app__control_html"><div class="ttname"><a href="../../da/da4/structstasis__app__control.html">stasis_app_control</a></div><div class="ttdef"><b>Definition:</b> <a href="../../de/de3/control_8c_source.html#l00051">control.c:51</a></div></div>
<div class="ttc" id="channel_8h_html_a21c057f81ff8b02eb1120410ae86e657"><div class="ttname"><a href="../../d5/d7b/channel_8h.html#a21c057f81ff8b02eb1120410ae86e657">ast_channel_clear_softhangup</a></div><div class="ttdeci">void ast_channel_clear_softhangup(struct ast_channel *chan, int flag)</div><div class="ttdoc">Clear a set of softhangup flags from a channel. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d28/channel_8c_source.html#l02437">channel.c:2437</a></div></div>
<div class="ttc" id="utils_8h_html_a1604b4d72144dd3d9f7da668e90337e9"><div class="ttname"><a href="../../d5/d60/utils_8h.html#a1604b4d72144dd3d9f7da668e90337e9">RAII_VAR</a></div><div class="ttdeci">#define RAII_VAR(vartype, varname, initval, dtor)</div><div class="ttdoc">Declare a variable that will call a destructor function when it goes out of scope. </div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d60/utils_8h_source.html#l00911">utils.h:911</a></div></div>
<div class="ttc" id="json_8h_html_adc52f8d76b7fdd0c8d12987981fd5bf5"><div class="ttname"><a href="../../d4/d05/json_8h.html#adc52f8d76b7fdd0c8d12987981fd5bf5">ast_json_string_create</a></div><div class="ttdeci">struct ast_json * ast_json_string_create(const char *value)</div><div class="ttdoc">Construct a JSON string from value. </div><div class="ttdef"><b>Definition:</b> <a href="../../df/d98/json_8c_source.html#l00268">json.c:268</a></div></div>
<div class="ttc" id="channel_8h_html_a488b7d6f7488bedc53be45d4ef4471c9"><div class="ttname"><a href="../../d5/d7b/channel_8h.html#a488b7d6f7488bedc53be45d4ef4471c9">ast_channel_pbx</a></div><div class="ttdeci">struct ast_pbx * ast_channel_pbx(const struct ast_channel *chan)</div><div class="ttdef"><b>Definition:</b> <a href="../../db/de2/channel__internal__api_8c_source.html#l00721">channel_internal_api.c:721</a></div></div>
<div class="ttc" id="pbx_8h_html_a2c502c100b8b4791d9efe395e08d620b"><div class="ttname"><a href="../../db/de0/pbx_8h.html#a2c502c100b8b4791d9efe395e08d620b">ast_pbx_run_args</a></div><div class="ttdeci">enum ast_pbx_result ast_pbx_run_args(struct ast_channel *c, struct ast_pbx_args *args)</div><div class="ttdoc">Execute the PBX in the current thread. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l04739">pbx.c:4739</a></div></div>
<div class="ttc" id="control_8c_html_a9f8795fd466c8645027ce6ff3620f962"><div class="ttname"><a href="../../de/de3/control_8c.html#a9f8795fd466c8645027ce6ff3620f962">control_next_app_args_size</a></div><div class="ttdeci">int control_next_app_args_size(struct stasis_app_control *control)</div><div class="ttdoc">Returns the number of arguments to be passed to the application we are moving to. ...</div><div class="ttdef"><b>Definition:</b> <a href="../../de/de3/control_8c_source.html#l01715">control.c:1715</a></div></div>
<div class="ttc" id="stasis__app_8h_html_a8f04206486943b8208052323a7dfd101"><div class="ttname"><a href="../../d8/d9c/stasis__app_8h.html#a8f04206486943b8208052323a7dfd101">stasis_app_name</a></div><div class="ttdeci">const char * stasis_app_name(const struct stasis_app *app)</div><div class="ttdoc">Retrieve an application&amp;#39;s name. </div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d5e/res_2stasis_2app_8c_source.html#l01156">res/stasis/app.c:1156</a></div></div>
<div class="ttc" id="astobj2_8h_html_aaca5e8eac39a22f9da1c36fc6c922270"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a></div><div class="ttdeci">#define ao2_ref(o, delta)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l00464">astobj2.h:464</a></div></div>
<div class="ttc" id="channel_8h_html_a5e41daaa81df59fc1e8eea2796029c31"><div class="ttname"><a href="../../d5/d7b/channel_8h.html#a5e41daaa81df59fc1e8eea2796029c31">ast_channel_internal_bridge_channel</a></div><div class="ttdeci">struct ast_bridge_channel * ast_channel_internal_bridge_channel(const struct ast_channel *chan)</div><div class="ttdef"><b>Definition:</b> <a href="../../db/de2/channel__internal__api_8c_source.html#l01251">channel_internal_api.c:1251</a></div></div>
<div class="ttc" id="channel_8h_html_a9c63fff1d736568d1ee332dd7ea502bd"><div class="ttname"><a href="../../d5/d7b/channel_8h.html#a9c63fff1d736568d1ee332dd7ea502bd">ast_check_hangup</a></div><div class="ttdeci">int ast_check_hangup(struct ast_channel *chan)</div><div class="ttdoc">Check to see if a channel is needing hang up. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d28/channel_8c_source.html#l00445">channel.c:445</a></div></div>
<div class="ttc" id="json_8h_html_a2b7c72e2e3ab2634d8a4f8b708440d95"><div class="ttname"><a href="../../d4/d05/json_8h.html#a2b7c72e2e3ab2634d8a4f8b708440d95">ast_json_timeval</a></div><div class="ttdeci">struct ast_json * ast_json_timeval(const struct timeval tv, const char *zone)</div><div class="ttdoc">Construct a timeval as JSON. </div><div class="ttdef"><b>Definition:</b> <a href="../../df/d98/json_8c_source.html#l00649">json.c:649</a></div></div>
<div class="ttc" id="include_2asterisk_2frame_8h_html_ae2e1a9c4e048da387b761f619312d6e0ae1dae388b0d70825876e137ae95bb0c1"><div class="ttname"><a href="../../d6/d66/include_2asterisk_2frame_8h.html#ae2e1a9c4e048da387b761f619312d6e0ae1dae388b0d70825876e137ae95bb0c1">AST_FRAME_CONTROL</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d66/include_2asterisk_2frame_8h_source.html#l00105">include/asterisk/frame.h:105</a></div></div>
<div class="ttc" id="json_8h_html_a3d675e52f866630a6a03302df2712b8d"><div class="ttname"><a href="../../d4/d05/json_8h.html#a3d675e52f866630a6a03302df2712b8d">ast_json_array_append</a></div><div class="ttdeci">int ast_json_array_append(struct ast_json *array, struct ast_json *value)</div><div class="ttdoc">Append to an array. </div><div class="ttdef"><b>Definition:</b> <a href="../../df/d98/json_8c_source.html#l00368">json.c:368</a></div></div>
<div class="ttc" id="channel_8h_html_a3e3e7e66e65ad9cdba2299e36b13e173"><div class="ttname"><a href="../../d5/d7b/channel_8h.html#a3e3e7e66e65ad9cdba2299e36b13e173">ast_channel_fdno</a></div><div class="ttdeci">int ast_channel_fdno(const struct ast_channel *chan)</div><div class="ttdef"><b>Definition:</b> <a href="../../db/de2/channel__internal__api_8c_source.html#l00419">channel_internal_api.c:419</a></div></div>
<div class="ttc" id="channel_8h_html_a3b6254f6d3832ef928f0a727113b1c63"><div class="ttname"><a href="../../d5/d7b/channel_8h.html#a3b6254f6d3832ef928f0a727113b1c63">ast_channel_uniqueid</a></div><div class="ttdeci">const char * ast_channel_uniqueid(const struct ast_channel *chan)</div><div class="ttdef"><b>Definition:</b> <a href="../../db/de2/channel__internal__api_8c_source.html#l00305">channel_internal_api.c:305</a></div></div>
<div class="ttc" id="structast__bridge_html"><div class="ttname"><a href="../../d4/d84/structast__bridge.html">ast_bridge</a></div><div class="ttdoc">Structure that contains information about a bridge. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d56/bridge_8h_source.html#l00357">bridge.h:357</a></div></div>
<div class="ttc" id="res__stasis_8c_html_a02463233ac15605b10e896437db30384"><div class="ttname"><a href="../../d2/d80/res__stasis_8c.html#a02463233ac15605b10e896437db30384">send_start_msg</a></div><div class="ttdeci">static int send_start_msg(struct stasis_app *app, struct ast_channel *chan, int argc, char *argv[])</div><div class="ttdef"><b>Definition:</b> <a href="../../d2/d80/res__stasis_8c_source.html#l01057">res_stasis.c:1057</a></div></div>
<div class="ttc" id="res_2stasis_2app_8c_html_afc2b5ef224bf880e5ef556a910f41a37"><div class="ttname"><a href="../../d3/d5e/res_2stasis_2app_8c.html#afc2b5ef224bf880e5ef556a910f41a37">app_send</a></div><div class="ttdeci">void app_send(struct stasis_app *app, struct ast_json *message)</div><div class="ttdoc">Send a message to the given application. </div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d5e/res_2stasis_2app_8c_source.html#l01038">res/stasis/app.c:1038</a></div></div>
<div class="ttc" id="logger_8h_html_aced66975c154ea0e2a8ec3bc818b4e08"><div class="ttname"><a href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a></div><div class="ttdeci">#define LOG_ERROR</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d8c/logger_8h_source.html#l00285">logger.h:285</a></div></div>
<div class="ttc" id="include_2asterisk_2frame_8h_html_aedda41918e992000fe921f8f7363b390aa7dac1c1896ab418c2ff351aae707fba"><div class="ttname"><a href="../../d6/d66/include_2asterisk_2frame_8h.html#aedda41918e992000fe921f8f7363b390aa7dac1c1896ab418c2ff351aae707fba">AST_CONTROL_HANGUP</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d66/include_2asterisk_2frame_8h_source.html#l00278">include/asterisk/frame.h:278</a></div></div>
<div class="ttc" id="bridge_8h_html_a0075715d330c8492e03c6d3ca3f48e13"><div class="ttname"><a href="../../d4/d56/bridge_8h.html#a0075715d330c8492e03c6d3ca3f48e13">ast_bridge_depart</a></div><div class="ttdeci">int ast_bridge_depart(struct ast_channel *chan)</div><div class="ttdoc">Depart a channel from a bridge. </div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d95/bridge_8c_source.html#l01952">bridge.c:1952</a></div></div>
<div class="ttc" id="control_8c_html_a76527348c55f4a4a8a3cfb7ccd798793"><div class="ttname"><a href="../../de/de3/control_8c.html#a76527348c55f4a4a8a3cfb7ccd798793">control_create</a></div><div class="ttdeci">struct stasis_app_control * control_create(struct ast_channel *channel, struct stasis_app *app)</div><div class="ttdoc">Create a control object. </div><div class="ttdef"><b>Definition:</b> <a href="../../de/de3/control_8c_source.html#l00123">control.c:123</a></div></div>
<div class="ttc" id="pbx__app_8c_html_a6d3c140ecf1f736c6750d5a17e5bf958"><div class="ttname"><a href="../../dd/d16/pbx__app_8c.html#a6d3c140ecf1f736c6750d5a17e5bf958">app_name</a></div><div class="ttdeci">const char * app_name(struct ast_app *app)</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d16/pbx__app_8c_source.html#l00463">pbx_app.c:463</a></div></div>
<div class="ttc" id="channel_8h_html_af476c537b29be3f29240489032f9db39"><div class="ttname"><a href="../../d5/d7b/channel_8h.html#af476c537b29be3f29240489032f9db39">ast_channel_unlock</a></div><div class="ttdeci">#define ast_channel_unlock(chan)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d7b/channel_8h_source.html#l02946">channel.h:2946</a></div></div>
<div class="ttc" id="stasis__channels_8h_html_a7571e6d10d716525aaa64b1f6583979b"><div class="ttname"><a href="../../d9/d4a/stasis__channels_8h.html#a7571e6d10d716525aaa64b1f6583979b">ast_channel_snapshot_to_json</a></div><div class="ttdeci">struct ast_json * ast_channel_snapshot_to_json(const struct ast_channel_snapshot *snapshot, const struct stasis_message_sanitizer *sanitize)</div><div class="ttdoc">Build a JSON object from a ast_channel_snapshot. </div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d2b/stasis__channels_8c_source.html#l01255">stasis_channels.c:1255</a></div></div>
<div class="ttc" id="astmm_8h_html_a402072d6789f6ed9e3a81da27504127e"><div class="ttname"><a href="../../d8/d8a/astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a></div><div class="ttdeci">#define ast_free(a)</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d8a/astmm_8h_source.html#l00182">astmm.h:182</a></div></div>
<div class="ttc" id="res__stasis_8c_html_ae122dda67c23017097471a5cca1d4d42"><div class="ttname"><a href="../../d2/d80/res__stasis_8c.html#ae122dda67c23017097471a5cca1d4d42">control_unlink</a></div><div class="ttdeci">static void control_unlink(struct stasis_app_control *control)</div><div class="ttdoc">In addition to running ao2_cleanup(), this function also removes the object from the app_controls con...</div><div class="ttdef"><b>Definition:</b> <a href="../../d2/d80/res__stasis_8c_source.html#l00785">res_stasis.c:785</a></div></div>
<div class="ttc" id="res__stasis_8c_html_ab274133b24b2c226e9d1cda3bbe5eed3"><div class="ttname"><a href="../../d2/d80/res__stasis_8c.html#ab274133b24b2c226e9d1cda3bbe5eed3">MAX_WAIT_MS</a></div><div class="ttdeci">#define MAX_WAIT_MS</div><div class="ttdef"><b>Definition:</b> <a href="../../d2/d80/res__stasis_8c_source.html#l00077">res_stasis.c:77</a></div></div>
<div class="ttc" id="astobj2_8h_html_a911e0703891a9a7aaf73978152092586"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#a911e0703891a9a7aaf73978152092586">ao2_find</a></div><div class="ttdeci">#define ao2_find(container, arg, flags)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l01756">astobj2.h:1756</a></div></div>
<div class="ttc" id="control_8c_html_aa58df566beb26758f5728fc4b8e693ea"><div class="ttname"><a href="../../de/de3/control_8c.html#aa58df566beb26758f5728fc4b8e693ea">control_set_app</a></div><div class="ttdeci">void control_set_app(struct stasis_app_control *control, struct stasis_app *app)</div><div class="ttdoc">Set the application the control object belongs to. </div><div class="ttdef"><b>Definition:</b> <a href="../../de/de3/control_8c_source.html#l01691">control.c:1691</a></div></div>
<div class="ttc" id="control_8c_html_ad25a5432fda39aae3c2c68f19105b059"><div class="ttname"><a href="../../de/de3/control_8c.html#ad25a5432fda39aae3c2c68f19105b059">control_silence_stop_now</a></div><div class="ttdeci">void control_silence_stop_now(struct stasis_app_control *control)</div><div class="ttdoc">Stop playing silence to a channel right now. </div><div class="ttdef"><b>Definition:</b> <a href="../../de/de3/control_8c_source.html#l00837">control.c:837</a></div></div>
<div class="ttc" id="channel_8h_html_a9e9505a91a84992d04ba4e85217fb4e4a085c0c603de12dc2474a17a92e1cb5a4"><div class="ttname"><a href="../../d5/d7b/channel_8h.html#a9e9505a91a84992d04ba4e85217fb4e4a085c0c603de12dc2474a17a92e1cb5a4">AST_SOFTHANGUP_ASYNCGOTO</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d7b/channel_8h_source.html#l01127">channel.h:1127</a></div></div>
<div class="ttc" id="control_8c_html_a54676258e38bccbf5366bf1ba5a18f9c"><div class="ttname"><a href="../../de/de3/control_8c.html#a54676258e38bccbf5366bf1ba5a18f9c">control_is_done</a></div><div class="ttdeci">int control_is_done(struct stasis_app_control *control)</div><div class="ttdoc">Returns true if control_continue() has been called on this control. </div><div class="ttdef"><b>Definition:</b> <a href="../../de/de3/control_8c_source.html#l00348">control.c:348</a></div></div>
<div class="ttc" id="channel_8h_html_a60e0bcaed001e8d5ed1ba0eb2644b3cc"><div class="ttname"><a href="../../d5/d7b/channel_8h.html#a60e0bcaed001e8d5ed1ba0eb2644b3cc">ast_waitfor</a></div><div class="ttdeci">int ast_waitfor(struct ast_channel *chan, int ms)</div><div class="ttdoc">Wait for input on a channel. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d28/channel_8c_source.html#l03171">channel.c:3171</a></div></div>
<div class="ttc" id="group__StasisTopicsAndMessages_html_ga68c55b443ba97dc157b493aafd05c876"><div class="ttname"><a href="../../df/deb/group__StasisTopicsAndMessages.html#ga68c55b443ba97dc157b493aafd05c876">ast_channel_snapshot_get_latest</a></div><div class="ttdeci">struct ast_channel_snapshot * ast_channel_snapshot_get_latest(const char *uniqueid)</div><div class="ttdoc">Obtain the latest ast_channel_snapshot from the Stasis Message Bus API cache. This is an ao2 object...</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d2b/stasis__channels_8c_source.html#l00903">stasis_channels.c:903</a></div></div>
<div class="ttc" id="astobj2_8h_html_a6321ee982370c55ab3c24c72c562cbdd"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#a6321ee982370c55ab3c24c72c562cbdd">ao2_cleanup</a></div><div class="ttdeci">#define ao2_cleanup(obj)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l01958">astobj2.h:1958</a></div></div>
<div class="ttc" id="json_8h_html_a53707225c3bf831e263245c6e3800676"><div class="ttname"><a href="../../d4/d05/json_8h.html#a53707225c3bf831e263245c6e3800676">ast_json_object_get</a></div><div class="ttdeci">struct ast_json * ast_json_object_get(struct ast_json *object, const char *key)</div><div class="ttdoc">Get a field from a JSON object. </div><div class="ttdef"><b>Definition:</b> <a href="../../df/d98/json_8c_source.html#l00397">json.c:397</a></div></div>
<div class="ttc" id="res_2stasis_2app_8c_html_a3319e8e92c07466ddc920e885c6d23f0"><div class="ttname"><a href="../../d3/d5e/res_2stasis_2app_8c.html#a3319e8e92c07466ddc920e885c6d23f0">app_unsubscribe_bridge</a></div><div class="ttdeci">int app_unsubscribe_bridge(struct stasis_app *app, struct ast_bridge *bridge)</div><div class="ttdoc">Cancel the bridge subscription for an application. </div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d5e/res_2stasis_2app_8c_source.html#l01486">res/stasis/app.c:1486</a></div></div>
<div class="ttc" id="res__stasis_8c_html_adb747ddc4dbb36c7544cbb3b695a777e"><div class="ttname"><a href="../../d2/d80/res__stasis_8c.html#adb747ddc4dbb36c7544cbb3b695a777e">apps_registry</a></div><div class="ttdeci">struct ao2_container * apps_registry</div><div class="ttdoc">Stasis application container. </div><div class="ttdef"><b>Definition:</b> <a href="../../d2/d80/res__stasis_8c_source.html#l00100">res_stasis.c:100</a></div></div>
<div class="ttc" id="channel_8h_html_a7ca2fda13b129a55c251b56729de285b"><div class="ttname"><a href="../../d5/d7b/channel_8h.html#a7ca2fda13b129a55c251b56729de285b">ast_channel_name</a></div><div class="ttdeci">const char * ast_channel_name(const struct ast_channel *chan)</div></div>
<div class="ttc" id="structast__frame_html"><div class="ttname"><a href="../../d0/d99/structast__frame.html">ast_frame</a></div><div class="ttdoc">Data structure associated with a single frame of data. </div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d66/include_2asterisk_2frame_8h_source.html#l00165">include/asterisk/frame.h:165</a></div></div>
<div class="ttc" id="structast__json_html"><div class="ttname"><a href="../../d1/da1/structast__json.html">ast_json</a></div><div class="ttdoc">Abstract JSON element (object, array, string, int, ...). </div></div>
<div class="ttc" id="res__stasis_8c_html_a781587330ea876be1a47210cd6be469f"><div class="ttname"><a href="../../d2/d80/res__stasis_8c.html#a781587330ea876be1a47210cd6be469f">add_masquerade_store</a></div><div class="ttdeci">static int add_masquerade_store(struct ast_channel *chan)</div><div class="ttdef"><b>Definition:</b> <a href="../../d2/d80/res__stasis_8c_source.html#l01217">res_stasis.c:1217</a></div></div>
<div class="ttc" id="app__mysql_8c_html_a1d9b1eccfc259a14525ce817482a3f88"><div class="ttname"><a href="../../d0/db6/app__mysql_8c.html#a1d9b1eccfc259a14525ce817482a3f88">app</a></div><div class="ttdeci">static const char app[]</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/db6/app__mysql_8c_source.html#l00062">app_mysql.c:62</a></div></div>
<div class="ttc" id="res__stasis_8c_html_a4f80fe370f00634dabf90663604ab50c"><div class="ttname"><a href="../../d2/d80/res__stasis_8c.html#a4f80fe370f00634dabf90663604ab50c">remove_stasis_end_published</a></div><div class="ttdeci">static void remove_stasis_end_published(struct ast_channel *chan)</div><div class="ttdef"><b>Definition:</b> <a href="../../d2/d80/res__stasis_8c_source.html#l01310">res_stasis.c:1310</a></div></div>
<div class="ttc" id="control_8c_html_a1a3d3390c840aa706358dd3238942bbf"><div class="ttname"><a href="../../de/de3/control_8c.html#a1a3d3390c840aa706358dd3238942bbf">control_prestart_dispatch_all</a></div><div class="ttdeci">int control_prestart_dispatch_all(struct stasis_app_control *control, struct ast_channel *chan)</div><div class="ttdoc">Dispatch all queued prestart commands. </div><div class="ttdef"><b>Definition:</b> <a href="../../de/de3/control_8c_source.html#l01535">control.c:1535</a></div></div>
<div class="ttc" id="control_8c_html_a316d08ca5342616eaf4b154d784477a1"><div class="ttname"><a href="../../de/de3/control_8c.html#a316d08ca5342616eaf4b154d784477a1">control_wait</a></div><div class="ttdeci">void control_wait(struct stasis_app_control *control)</div><div class="ttdoc">Blocks until control&amp;#39;s command queue has a command available. </div><div class="ttdef"><b>Definition:</b> <a href="../../de/de3/control_8c_source.html#l01515">control.c:1515</a></div></div>
<div class="ttc" id="astobj2_8h_html_a1ad9f122bcae95a470639402faa3d2ee"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#a1ad9f122bcae95a470639402faa3d2ee">ao2_link</a></div><div class="ttdeci">#define ao2_link(container, obj)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l01549">astobj2.h:1549</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a36343c21d88758d9df3ff6aa217caf5d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a36343c21d88758d9df3ff6aa217caf5d">&#9670;&nbsp;</a></span>stasis_app_send_command()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int stasis_app_send_command </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="../../da/da4/structstasis__app__control.html">stasis_app_control</a> *&#160;</td>
          <td class="paramname"><em>control</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../de/d0b/stasis__app__impl_8h.html#a816a21221be6d5a93cc55b8cb97d46ab">stasis_app_command_cb</a>&#160;</td>
          <td class="paramname"><em>command</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>data</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../de/d0b/stasis__app__impl_8h.html#a66ead0f2f762f64bbad7eb8a026cf62c">command_data_destructor_fn</a>&#160;</td>
          <td class="paramname"><em>data_destructor</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Invokes a <em>command</em> on a <em>control's</em> channel. </p>
<dl class="section since"><dt>Since</dt><dd>12 This function dispatches the command to be executed in the context of <a class="el" href="../../de/d0b/stasis__app__impl_8h.html#a191ce41140cf0af9be11f05be98b66ce" title="Control a channel using stasis_app. ">stasis_app_exec()</a>, so this command will block waiting for the results of the command.</dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">control</td><td>Control object for the channel to send the command to. </td></tr>
    <tr><td class="paramname">command</td><td>Command function to execute. </td></tr>
    <tr><td class="paramname">data</td><td>Optional data to pass along with the control function. </td></tr>
    <tr><td class="paramname">data_destructor</td><td>Optional function which will be called on the data in either the event of command completion or failure to schedule or complete the command</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>zero on success. </dd>
<dd>
error code otherwise. </dd></dl>

<p class="definition">Definition at line <a class="el" href="../../de/de3/control_8c_source.html#l00898">898</a> of file <a class="el" href="../../de/de3/control_8c_source.html">control.c</a>.</p>

<p class="reference">References <a class="el" href="../../de/de3/control_8c_source.html#l00866">app_send_command_on_condition()</a>, and <a class="el" href="../../dc/d7f/resample_8c_source.html#l00096">NULL</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../db/d0b/resource__bridges_8c_source.html#l01016">ast_ari_bridges_set_video_source()</a>, and <a class="el" href="../../d4/d26/res__stasis__answer_8c_source.html#l00044">stasis_app_control_answer()</a>.</p>
<div class="fragment"><div class="line"><a name="l00900"></a><span class="lineno">  900</span>&#160;{</div><div class="line"><a name="l00901"></a><span class="lineno">  901</span>&#160;   <span class="keywordflow">return</span> <a class="code" href="../../de/de3/control_8c.html#a85b0a5b1bb2e49db6d60d35adc39f708">app_send_command_on_condition</a>(control, command_fn, data, data_destructor, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div><div class="line"><a name="l00902"></a><span class="lineno">  902</span>&#160;}</div><div class="ttc" id="resample_8c_html_a070d2ce7b6bb7e5c05602aa8c308d0c4"><div class="ttname"><a href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a></div><div class="ttdeci">#define NULL</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d7f/resample_8c_source.html#l00096">resample.c:96</a></div></div>
<div class="ttc" id="control_8c_html_a85b0a5b1bb2e49db6d60d35adc39f708"><div class="ttname"><a href="../../de/de3/control_8c.html#a85b0a5b1bb2e49db6d60d35adc39f708">app_send_command_on_condition</a></div><div class="ttdeci">static int app_send_command_on_condition(struct stasis_app_control *control, stasis_app_command_cb command_fn, void *data, command_data_destructor_fn data_destructor, app_command_can_exec_cb can_exec_fn)</div><div class="ttdef"><b>Definition:</b> <a href="../../de/de3/control_8c_source.html#l00866">control.c:866</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a838fef3012703b621ce65fb0e55b4af5"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a838fef3012703b621ce65fb0e55b4af5">&#9670;&nbsp;</a></span>stasis_app_send_command_async()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int stasis_app_send_command_async </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="../../da/da4/structstasis__app__control.html">stasis_app_control</a> *&#160;</td>
          <td class="paramname"><em>control</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../de/d0b/stasis__app__impl_8h.html#a816a21221be6d5a93cc55b8cb97d46ab">stasis_app_command_cb</a>&#160;</td>
          <td class="paramname"><em>command</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>data</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../de/d0b/stasis__app__impl_8h.html#a66ead0f2f762f64bbad7eb8a026cf62c">command_data_destructor_fn</a>&#160;</td>
          <td class="paramname"><em>data_destructor</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Asynchronous version of <a class="el" href="../../de/d0b/stasis__app__impl_8h.html#a36343c21d88758d9df3ff6aa217caf5d" title="Invokes a command on a control&#39;s channel. ">stasis_app_send_command()</a>. </p>
<dl class="section since"><dt>Since</dt><dd>12 This function enqueues a command for execution, but returns immediately without waiting for the response.</dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">control</td><td>Control object for the channel to send the command to. </td></tr>
    <tr><td class="paramname">command</td><td>Command function to execute. </td></tr>
    <tr><td class="paramname">data</td><td>Optional data to pass along with the control function. </td></tr>
    <tr><td class="paramname">data_destructor</td><td>Optional function which will be called on the data in either the event of command completion or failure to schedule or complete the command </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>0 on success. </dd>
<dd>
Non-zero on error. </dd></dl>

<p class="definition">Definition at line <a class="el" href="../../de/de3/control_8c_source.html#l00904">904</a> of file <a class="el" href="../../de/de3/control_8c_source.html">control.c</a>.</p>

<p class="reference">References <a class="el" href="../../d5/da5/astobj2_8h_source.html#l00464">ao2_ref</a>, <a class="el" href="../../d5/d2e/command_8c_source.html#l00038">stasis_app_command::data_destructor</a>, <a class="el" href="../../de/de3/control_8c_source.html#l00301">exec_command()</a>, and <a class="el" href="../../dc/d7f/resample_8c_source.html#l00096">NULL</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../de/de3/control_8c_source.html#l01215">bridge_timeout()</a>, <a class="el" href="../../de/de3/control_8c_source.html#l01009">dial_bridge_after_cb()</a>, <a class="el" href="../../de/de3/control_8c_source.html#l01108">internal_bridge_after_cb()</a>, <a class="el" href="../../de/de3/control_8c_source.html#l00316">stasis_app_control_add_role()</a>, <a class="el" href="../../de/de3/control_8c_source.html#l00338">stasis_app_control_clear_roles()</a>, <a class="el" href="../../de/de3/control_8c_source.html#l00389">stasis_app_control_continue()</a>, <a class="el" href="../../de/de3/control_8c_source.html#l01666">stasis_app_control_dial()</a>, <a class="el" href="../../de/de3/control_8c_source.html#l00565">stasis_app_control_dtmf()</a>, <a class="el" href="../../de/de3/control_8c_source.html#l00748">stasis_app_control_hold()</a>, <a class="el" href="../../de/de3/control_8c_source.html#l00780">stasis_app_control_moh_start()</a>, <a class="el" href="../../de/de3/control_8c_source.html#l00798">stasis_app_control_moh_stop()</a>, <a class="el" href="../../de/de3/control_8c_source.html#l00451">stasis_app_control_move()</a>, <a class="el" href="../../de/de3/control_8c_source.html#l00631">stasis_app_control_mute()</a>, <a class="el" href="../../d7/de1/res__stasis__playback_8c_source.html#l00471">stasis_app_control_play_uri()</a>, <a class="el" href="../../d8/d4c/res__stasis__recording_8c_source.html#l00370">stasis_app_control_record()</a>, <a class="el" href="../../de/de3/control_8c_source.html#l00500">stasis_app_control_redirect()</a>, <a class="el" href="../../de/de3/control_8c_source.html#l00592">stasis_app_control_ring()</a>, <a class="el" href="../../de/de3/control_8c_source.html#l00607">stasis_app_control_ring_stop()</a>, <a class="el" href="../../de/de3/control_8c_source.html#l00711">stasis_app_control_set_channel_var()</a>, <a class="el" href="../../de/de3/control_8c_source.html#l00832">stasis_app_control_silence_start()</a>, <a class="el" href="../../de/de3/control_8c_source.html#l00855">stasis_app_control_silence_stop()</a>, <a class="el" href="../../de/de3/control_8c_source.html#l00761">stasis_app_control_unhold()</a>, and <a class="el" href="../../de/de3/control_8c_source.html#l00659">stasis_app_control_unmute()</a>.</p>
<div class="fragment"><div class="line"><a name="l00907"></a><span class="lineno">  907</span>&#160;{</div><div class="line"><a name="l00908"></a><span class="lineno">  908</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d0/d41/structstasis__app__command.html">stasis_app_command</a> *command;</div><div class="line"><a name="l00909"></a><span class="lineno">  909</span>&#160;</div><div class="line"><a name="l00910"></a><span class="lineno">  910</span>&#160;   <span class="keywordflow">if</span> (control == <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a> || control-&gt;is_done) {</div><div class="line"><a name="l00911"></a><span class="lineno">  911</span>&#160;      <span class="comment">/* If exec_command fails, it calls the data_destructor. In order to</span></div><div class="line"><a name="l00912"></a><span class="lineno">  912</span>&#160;<span class="comment">       * provide consistent behavior, we&#39;ll also call the data_destructor</span></div><div class="line"><a name="l00913"></a><span class="lineno">  913</span>&#160;<span class="comment">       * on this error path. This way, callers never have to call the</span></div><div class="line"><a name="l00914"></a><span class="lineno">  914</span>&#160;<span class="comment">       * data_destructor themselves.</span></div><div class="line"><a name="l00915"></a><span class="lineno">  915</span>&#160;<span class="comment">       */</span></div><div class="line"><a name="l00916"></a><span class="lineno">  916</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="../../d0/d41/structstasis__app__command.html#a4e3605fea633c7eeb14d4fa7dae7813b">data_destructor</a>) {</div><div class="line"><a name="l00917"></a><span class="lineno">  917</span>&#160;         <a class="code" href="../../d0/d41/structstasis__app__command.html#a4e3605fea633c7eeb14d4fa7dae7813b">data_destructor</a>(<a class="code" href="../../d0/d41/structstasis__app__command.html#a735984d41155bc1032e09bece8f8d66d">data</a>);</div><div class="line"><a name="l00918"></a><span class="lineno">  918</span>&#160;      }</div><div class="line"><a name="l00919"></a><span class="lineno">  919</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l00920"></a><span class="lineno">  920</span>&#160;   }</div><div class="line"><a name="l00921"></a><span class="lineno">  921</span>&#160;</div><div class="line"><a name="l00922"></a><span class="lineno">  922</span>&#160;   command = <a class="code" href="../../de/de3/control_8c.html#a042492cd8c48f148a8107214bb9d1db2">exec_command</a>(control, command_fn, <a class="code" href="../../d0/d41/structstasis__app__command.html#a735984d41155bc1032e09bece8f8d66d">data</a>, <a class="code" href="../../d0/d41/structstasis__app__command.html#a4e3605fea633c7eeb14d4fa7dae7813b">data_destructor</a>);</div><div class="line"><a name="l00923"></a><span class="lineno">  923</span>&#160;   <span class="keywordflow">if</span> (!command) {</div><div class="line"><a name="l00924"></a><span class="lineno">  924</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l00925"></a><span class="lineno">  925</span>&#160;   }</div><div class="line"><a name="l00926"></a><span class="lineno">  926</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(command, -1);</div><div class="line"><a name="l00927"></a><span class="lineno">  927</span>&#160;</div><div class="line"><a name="l00928"></a><span class="lineno">  928</span>&#160;   <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00929"></a><span class="lineno">  929</span>&#160;}</div><div class="ttc" id="structstasis__app__command_html_a735984d41155bc1032e09bece8f8d66d"><div class="ttname"><a href="../../d0/d41/structstasis__app__command.html#a735984d41155bc1032e09bece8f8d66d">stasis_app_command::data</a></div><div class="ttdeci">void * data</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d2e/command_8c_source.html#l00037">command.c:37</a></div></div>
<div class="ttc" id="control_8c_html_a042492cd8c48f148a8107214bb9d1db2"><div class="ttname"><a href="../../de/de3/control_8c.html#a042492cd8c48f148a8107214bb9d1db2">exec_command</a></div><div class="ttdeci">static struct stasis_app_command * exec_command(struct stasis_app_control *control, stasis_app_command_cb command_fn, void *data, command_data_destructor_fn data_destructor)</div><div class="ttdef"><b>Definition:</b> <a href="../../de/de3/control_8c_source.html#l00301">control.c:301</a></div></div>
<div class="ttc" id="resample_8c_html_a070d2ce7b6bb7e5c05602aa8c308d0c4"><div class="ttname"><a href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a></div><div class="ttdeci">#define NULL</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d7f/resample_8c_source.html#l00096">resample.c:96</a></div></div>
<div class="ttc" id="structstasis__app__command_html_a4e3605fea633c7eeb14d4fa7dae7813b"><div class="ttname"><a href="../../d0/d41/structstasis__app__command.html#a4e3605fea633c7eeb14d4fa7dae7813b">stasis_app_command::data_destructor</a></div><div class="ttdeci">command_data_destructor_fn data_destructor</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d2e/command_8c_source.html#l00038">command.c:38</a></div></div>
<div class="ttc" id="structstasis__app__command_html"><div class="ttname"><a href="../../d0/d41/structstasis__app__command.html">stasis_app_command</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d2e/command_8c_source.html#l00033">command.c:33</a></div></div>
<div class="ttc" id="astobj2_8h_html_aaca5e8eac39a22f9da1c36fc6c922270"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a></div><div class="ttdeci">#define ao2_ref(o, delta)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l00464">astobj2.h:464</a></div></div>
</div><!-- fragment -->
</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Sun Aug 8 2021 19:46:49 for Asterisk - The Open Source Telephony Project by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="../../doxygen.png" alt="doxygen"/>
</a> 1.8.13
</small></address>
</body>
</html>
