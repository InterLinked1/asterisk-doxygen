<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Asterisk - The Open Source Telephony Project: app_minivm.c Source File</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Asterisk - The Open Source Telephony Project
   &#160;<span id="projectnumber">18.5.0</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "../../search",false,'Search');
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('../../',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="../../dir_9654b8d08f4bba4e84b362c5fd320bee.html">apps</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">app_minivm.c</div>  </div>
</div><!--header-->
<div class="contents">
<a href="../../de/dfe/app__minivm_8c.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="comment">/*</span></div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="comment"> * Asterisk -- An open source telephony toolkit.</span></div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="comment"> * Copyright (C) 1999 - 2005, Digium, Inc.</span></div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="comment"> * and Edvina AB, Sollentuna, Sweden</span></div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="comment"> * Mark Spencer &lt;markster@digium.com&gt; (Comedian Mail)</span></div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="comment"> * and Olle E. Johansson, Edvina.net &lt;oej@edvina.net&gt; (Mini-Voicemail changes)</span></div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;<span class="comment"> * See http://www.asterisk.org for more information about</span></div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;<span class="comment"> * the Asterisk project. Please do not directly contact</span></div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;<span class="comment"> * any of the maintainers of this project for assistance;</span></div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;<span class="comment"> * the project provides a web site, mailing lists and IRC</span></div><div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;<span class="comment"> * channels for your use.</span></div><div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;<span class="comment"> * This program is free software, distributed under the terms of</span></div><div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;<span class="comment"> * the GNU General Public License Version 2. See the LICENSE file</span></div><div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;<span class="comment"> * at the top of the source tree.</span></div><div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;<span class="comment">/*! \file</span></div><div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;<span class="comment"> * \brief MiniVoiceMail - A Minimal Voicemail System for Asterisk</span></div><div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;<span class="comment"> * A voicemail system in small building blocks, working together</span></div><div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;<span class="comment"> * based on the Comedian Mail voicemail system (app_voicemail.c).</span></div><div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;<span class="comment"> * \par See also</span></div><div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;<span class="comment"> * \arg \ref Config_minivm_examples</span></div><div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;<span class="comment"> * \arg \ref App_minivm</span></div><div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;<span class="comment"> * \ingroup applications</span></div><div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;<span class="comment"> * \page App_minivm  Asterisk Mini-voicemail - A minimal voicemail system</span></div><div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;<span class="comment"> * This is a minimal voicemail system, building blocks for something</span></div><div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;<span class="comment"> * else. It is built for multi-language systems.</span></div><div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;<span class="comment"> * The current version is focused on accounts where voicemail is</span></div><div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;<span class="comment"> * forwarded to users in e-mail. It&#39;s work in progress, with loosed ends hanging</span></div><div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;<span class="comment"> * around from the old voicemail system and it&#39;s configuration.</span></div><div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;<span class="comment"> * Hopefully, we can expand this to be a full replacement of voicemail() and voicemailmain()</span></div><div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;<span class="comment"> * in the future.</span></div><div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;<span class="comment"> * Dialplan applications</span></div><div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;<span class="comment"> * - minivmRecord - record voicemail and send as e-mail ( \ref minivm_record_exec() )</span></div><div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;<span class="comment"> * - minivmGreet - Play user&#39;s greeting or default greeting ( \ref minivm_greet_exec() )</span></div><div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;<span class="comment"> * - minivmNotify - Notify user of message ( \ref minivm_notify_exec() )</span></div><div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;<span class="comment"> *    - minivmDelete - Delete voicemail message ( \ref minivm_delete_exec() )</span></div><div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;<span class="comment"> * - minivmAccMess - Record personal messages (busy | unavailable | temporary)</span></div><div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;<span class="comment"> * Dialplan functions</span></div><div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;<span class="comment"> * - MINIVMACCOUNT() - A dialplan function</span></div><div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;<span class="comment"> * - MINIVMCOUNTER() - Manage voicemail-related counters for accounts or domains</span></div><div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;<span class="comment"> * CLI Commands</span></div><div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;<span class="comment"> * - minivm list accounts</span></div><div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;<span class="comment"> * - minivm list zones</span></div><div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;<span class="comment"> * - minivm list templates</span></div><div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;<span class="comment"> * - minivm show stats</span></div><div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;<span class="comment"> * - minivm show settings</span></div><div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;<span class="comment"> * Some notes</span></div><div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;<span class="comment"> * - General configuration in minivm.conf</span></div><div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;<span class="comment"> * - Users in realtime or configuration file</span></div><div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;<span class="comment"> * - Or configured on the command line with just the e-mail address</span></div><div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;<span class="comment"> * Voicemail accounts are identified by userid and domain</span></div><div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;<span class="comment"> * Language codes are like setlocale - langcode_countrycode</span></div><div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;<span class="comment"> * \note Don&#39;t use language codes like the rest of Asterisk, two letter countrycode. Use</span></div><div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;<span class="comment"> * language_country like setlocale().</span></div><div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;<span class="comment"> * Examples:</span></div><div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;<span class="comment"> *    - Swedish, Sweden sv_se</span></div><div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;<span class="comment"> *    - Swedish, Finland   sv_fi</span></div><div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;<span class="comment"> *    - English, USA    en_us</span></div><div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;<span class="comment"> *    - English, GB     en_gb</span></div><div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;<span class="comment"> * \par See also</span></div><div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;<span class="comment"> * \arg \ref Config_minivm</span></div><div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;<span class="comment"> * \arg \ref Config_minivm_examples</span></div><div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;<span class="comment"> * \arg \ref Minivm_directories</span></div><div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;<span class="comment"> * \arg \ref app_minivm.c</span></div><div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;<span class="comment"> * \arg Comedian mail: app_voicemail.c</span></div><div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;<span class="comment"> * \arg \ref descrip_minivm_accmess</span></div><div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;<span class="comment"> * \arg \ref descrip_minivm_greet</span></div><div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;<span class="comment"> * \arg \ref descrip_minivm_record</span></div><div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;<span class="comment"> * \arg \ref descrip_minivm_delete</span></div><div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;<span class="comment"> * \arg \ref descrip_minivm_notify</span></div><div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;<span class="comment"> * \arg \ref App_minivm_todo</span></div><div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;<span class="comment"> */</span><span class="comment"></span></div><div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;<span class="comment">/*! \page Minivm_directories Asterisk Mini-Voicemail Directory structure</span></div><div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;<span class="comment"> * The directory structure for storing voicemail</span></div><div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;<span class="comment"> *    - AST_SPOOL_DIR - usually /var/spool/asterisk (configurable in asterisk.conf)</span></div><div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;<span class="comment"> *    - MVM_SPOOL_DIR - should be configurable, usually AST_SPOOL_DIR/voicemail</span></div><div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;<span class="comment"> *    - Domain MVM_SPOOL_DIR/domain</span></div><div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;<span class="comment"> *    - Username  MVM_SPOOL_DIR/domain/username</span></div><div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;<span class="comment"> *       - /greet : Recording of account owner&#39;s name</span></div><div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;<span class="comment"> *       - /busy     : Busy message</span></div><div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;<span class="comment"> *       - /unavailable  : Unavailable message</span></div><div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;<span class="comment"> *       - /temp     : Temporary message</span></div><div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;<span class="comment"> * For account anita@localdomain.xx the account directory would as a default be</span></div><div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;<span class="comment"> *    \b /var/spool/asterisk/voicemail/localdomain.xx/anita</span></div><div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;<span class="comment"> * To avoid transcoding, these sound files should be converted into several formats</span></div><div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;<span class="comment"> * They are recorded in the format closest to the incoming streams</span></div><div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;<span class="comment"> * Back: \ref App_minivm</span></div><div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;<span class="comment">/*! \page Config_minivm_examples Example dialplan for Mini-Voicemail</span></div><div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;<span class="comment"> * \section Example dialplan scripts for Mini-Voicemail</span></div><div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;<span class="comment"> *  \verbinclude extensions_minivm.conf.sample</span></div><div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;<span class="comment"> * Back: \ref App_minivm</span></div><div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;<span class="comment">/*! \page App_minivm_todo Asterisk Mini-Voicemail - todo</span></div><div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;<span class="comment"> * - configure accounts from AMI?</span></div><div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;<span class="comment"> * - test, test, test, test</span></div><div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;<span class="comment"> * - fix &quot;vm-theextensionis.gsm&quot; voiceprompt from Allison in various formats</span></div><div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;<span class="comment"> *    &quot;The extension you are calling&quot;</span></div><div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;<span class="comment"> * - For trunk, consider using channel storage for information passing between small applications</span></div><div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;<span class="comment"> * - Set default directory for voicemail</span></div><div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;<span class="comment"> * - New app for creating directory for account if it does not exist</span></div><div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;<span class="comment"> * - Re-insert code for IMAP storage at some point</span></div><div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;<span class="comment"> * - Jabber integration for notifications</span></div><div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;<span class="comment"> * - Figure out how to handle video in voicemail</span></div><div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;<span class="comment"> * - Integration with the HTTP server</span></div><div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;<span class="comment"> * - New app for moving messages between mailboxes, and optionally mark it as &quot;new&quot;</span></div><div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;<span class="comment"> * For Asterisk 1.4/trunk</span></div><div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;<span class="comment"> * - Use string fields for minivm_account</span></div><div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;<span class="comment"> * Back: \ref App_minivm</span></div><div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;</div><div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;<span class="comment">/*** MODULEINFO</span></div><div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;<span class="comment">   &lt;support_level&gt;extended&lt;/support_level&gt;</span></div><div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;<span class="comment"> ***/</span></div><div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;</div><div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../db/db2/asterisk_8h.html">asterisk.h</a>&quot;</span></div><div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;</div><div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;<span class="preprocessor">#include &lt;ctype.h&gt;</span></div><div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;<span class="preprocessor">#include &lt;sys/time.h&gt;</span></div><div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;<span class="preprocessor">#include &lt;sys/stat.h&gt;</span></div><div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;<span class="preprocessor">#include &lt;sys/mman.h&gt;</span></div><div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;<span class="preprocessor">#include &lt;<a class="code" href="../../de/df7/time_8h.html">time.h</a>&gt;</span></div><div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;<span class="preprocessor">#include &lt;dirent.h&gt;</span></div><div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;<span class="preprocessor">#include &lt;locale.h&gt;</span></div><div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;</div><div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;</div><div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../dd/df2/paths_8h.html">asterisk/paths.h</a>&quot;</span>   <span class="comment">/* use various paths */</span></div><div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../dd/d42/lock_8h.html">asterisk/lock.h</a>&quot;</span></div><div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../d2/d4d/file_8h.html">asterisk/file.h</a>&quot;</span></div><div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../d5/d7b/channel_8h.html">asterisk/channel.h</a>&quot;</span></div><div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../db/de0/pbx_8h.html">asterisk/pbx.h</a>&quot;</span></div><div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../d3/de6/include_2asterisk_2config_8h.html">asterisk/config.h</a>&quot;</span></div><div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../db/dce/say_8h.html">asterisk/say.h</a>&quot;</span></div><div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../d5/d16/module_8h.html">asterisk/module.h</a>&quot;</span></div><div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../d3/d93/include_2asterisk_2app_8h.html">asterisk/app.h</a>&quot;</span></div><div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../dc/d33/mwi_8h.html">asterisk/mwi.h</a>&quot;</span></div><div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../d3/d08/dsp_8h.html">asterisk/dsp.h</a>&quot;</span></div><div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../d5/deb/localtime_8h.html">asterisk/localtime.h</a>&quot;</span></div><div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../dc/db0/cli_8h.html">asterisk/cli.h</a>&quot;</span></div><div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../d5/d60/utils_8h.html">asterisk/utils.h</a>&quot;</span></div><div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../df/d90/linkedlists_8h.html">asterisk/linkedlists.h</a>&quot;</span></div><div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../de/d47/callerid_8h.html">asterisk/callerid.h</a>&quot;</span></div><div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../dd/d79/stasis_8h.html">asterisk/stasis.h</a>&quot;</span></div><div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../d9/d4a/stasis__channels_8h.html">asterisk/stasis_channels.h</a>&quot;</span></div><div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../d4/d05/json_8h.html">asterisk/json.h</a>&quot;</span></div><div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;</div><div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;<span class="comment">/*** DOCUMENTATION</span></div><div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;<span class="comment">&lt;application name=&quot;MinivmRecord&quot; language=&quot;en_US&quot;&gt;</span></div><div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;<span class="comment">   &lt;synopsis&gt;</span></div><div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;<span class="comment">      Receive Mini-Voicemail and forward via e-mail.</span></div><div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;<span class="comment">   &lt;/synopsis&gt;</span></div><div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;<span class="comment">   &lt;syntax&gt;</span></div><div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;<span class="comment">      &lt;parameter name=&quot;mailbox&quot; required=&quot;true&quot; argsep=&quot;@&quot;&gt;</span></div><div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;<span class="comment">         &lt;argument name=&quot;username&quot; required=&quot;true&quot;&gt;</span></div><div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;<span class="comment">            &lt;para&gt;Voicemail username&lt;/para&gt;</span></div><div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;<span class="comment">         &lt;/argument&gt;</span></div><div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;<span class="comment">         &lt;argument name=&quot;domain&quot; required=&quot;true&quot;&gt;</span></div><div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;<span class="comment">            &lt;para&gt;Voicemail domain&lt;/para&gt;</span></div><div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;<span class="comment">         &lt;/argument&gt;</span></div><div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;<span class="comment">      &lt;/parameter&gt;</span></div><div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;<span class="comment">      &lt;parameter name=&quot;options&quot; required=&quot;false&quot;&gt;</span></div><div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;<span class="comment">         &lt;optionlist&gt;</span></div><div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;<span class="comment">            &lt;option name=&quot;0&quot;&gt;</span></div><div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;<span class="comment">               &lt;para&gt;Jump to the &lt;literal&gt;o&lt;/literal&gt; extension in the current dialplan context.&lt;/para&gt;</span></div><div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;<span class="comment">            &lt;/option&gt;</span></div><div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;<span class="comment">            &lt;option name=&quot;*&quot;&gt;</span></div><div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;<span class="comment">               &lt;para&gt;Jump to the &lt;literal&gt;a&lt;/literal&gt; extension in the current dialplan context.&lt;/para&gt;</span></div><div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;<span class="comment">            &lt;/option&gt;</span></div><div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;<span class="comment">            &lt;option name=&quot;g&quot;&gt;</span></div><div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;<span class="comment">               &lt;argument name=&quot;gain&quot;&gt;</span></div><div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;<span class="comment">                  &lt;para&gt;Amount of gain to use&lt;/para&gt;</span></div><div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;<span class="comment">               &lt;/argument&gt;</span></div><div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;<span class="comment">               &lt;para&gt;Use the specified amount of gain when recording the voicemail message.</span></div><div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;<span class="comment">               The units are whole-number decibels (dB).&lt;/para&gt;</span></div><div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;<span class="comment">            &lt;/option&gt;</span></div><div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;<span class="comment">         &lt;/optionlist&gt;</span></div><div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;<span class="comment">      &lt;/parameter&gt;</span></div><div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;<span class="comment">   &lt;/syntax&gt;</span></div><div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;<span class="comment">   &lt;description&gt;</span></div><div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;<span class="comment">      &lt;para&gt;This application is part of the Mini-Voicemail system, configured in &lt;filename&gt;minivm.conf&lt;/filename&gt;&lt;/para&gt;</span></div><div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;<span class="comment">      &lt;para&gt;MiniVM records audio file in configured format and forwards message to e-mail and pager.&lt;/para&gt;</span></div><div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;<span class="comment">      &lt;para&gt;If there&#39;s no user account for that address, a temporary account will be used with default options.&lt;/para&gt;</span></div><div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;<span class="comment">      &lt;para&gt;The recorded file name and path will be stored in &lt;variable&gt;MVM_FILENAME&lt;/variable&gt; and the duration</span></div><div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;<span class="comment">      of the message will be stored in &lt;variable&gt;MVM_DURATION&lt;/variable&gt;&lt;/para&gt;</span></div><div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;<span class="comment">      &lt;note&gt;&lt;para&gt;If the caller hangs up after the recording, the only way to send the message and clean up is to</span></div><div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;<span class="comment">      execute in the &lt;literal&gt;h&lt;/literal&gt; extension. The application will exit if any of the following DTMF digits</span></div><div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;<span class="comment">      are received and the requested extension exist in the current context.&lt;/para&gt;&lt;/note&gt;</span></div><div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;<span class="comment">      &lt;variablelist&gt;</span></div><div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;<span class="comment">         &lt;variable name=&quot;MVM_RECORD_STATUS&quot;&gt;</span></div><div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;<span class="comment">            &lt;para&gt;This is the status of the record operation&lt;/para&gt;</span></div><div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;<span class="comment">            &lt;value name=&quot;SUCCESS&quot; /&gt;</span></div><div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;<span class="comment">            &lt;value name=&quot;USEREXIT&quot; /&gt;</span></div><div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;<span class="comment">            &lt;value name=&quot;FAILED&quot; /&gt;</span></div><div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;<span class="comment">         &lt;/variable&gt;</span></div><div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;<span class="comment">      &lt;/variablelist&gt;</span></div><div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;<span class="comment">   &lt;/description&gt;</span></div><div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;<span class="comment">&lt;/application&gt;</span></div><div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;<span class="comment">&lt;application name=&quot;MinivmGreet&quot; language=&quot;en_US&quot;&gt;</span></div><div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;<span class="comment">   &lt;synopsis&gt;</span></div><div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;<span class="comment">      Play Mini-Voicemail prompts.</span></div><div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;<span class="comment">   &lt;/synopsis&gt;</span></div><div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;<span class="comment">   &lt;syntax&gt;</span></div><div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;<span class="comment">      &lt;parameter name=&quot;mailbox&quot; required=&quot;true&quot; argsep=&quot;@&quot;&gt;</span></div><div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;<span class="comment">         &lt;argument name=&quot;username&quot; required=&quot;true&quot;&gt;</span></div><div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;<span class="comment">            &lt;para&gt;Voicemail username&lt;/para&gt;</span></div><div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;<span class="comment">         &lt;/argument&gt;</span></div><div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;<span class="comment">         &lt;argument name=&quot;domain&quot; required=&quot;true&quot;&gt;</span></div><div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;<span class="comment">            &lt;para&gt;Voicemail domain&lt;/para&gt;</span></div><div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;<span class="comment">         &lt;/argument&gt;</span></div><div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;<span class="comment">      &lt;/parameter&gt;</span></div><div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;<span class="comment">      &lt;parameter name=&quot;options&quot; required=&quot;false&quot;&gt;</span></div><div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;<span class="comment">         &lt;optionlist&gt;</span></div><div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;<span class="comment">            &lt;option name=&quot;b&quot;&gt;</span></div><div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;<span class="comment">               &lt;para&gt;Play the &lt;literal&gt;busy&lt;/literal&gt; greeting to the calling party.&lt;/para&gt;</span></div><div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;<span class="comment">            &lt;/option&gt;</span></div><div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;<span class="comment">            &lt;option name=&quot;s&quot;&gt;</span></div><div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;<span class="comment">               &lt;para&gt;Skip the playback of instructions for leaving a message to the calling party.&lt;/para&gt;</span></div><div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;<span class="comment">            &lt;/option&gt;</span></div><div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;<span class="comment">            &lt;option name=&quot;u&quot;&gt;</span></div><div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;<span class="comment">               &lt;para&gt;Play the &lt;literal&gt;unavailable&lt;/literal&gt; greeting.&lt;/para&gt;</span></div><div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;<span class="comment">            &lt;/option&gt;</span></div><div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;<span class="comment">         &lt;/optionlist&gt;</span></div><div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;<span class="comment">      &lt;/parameter&gt;</span></div><div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;<span class="comment">   &lt;/syntax&gt;</span></div><div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;<span class="comment">   &lt;description&gt;</span></div><div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;<span class="comment">      &lt;para&gt;This application is part of the Mini-Voicemail system, configured in minivm.conf.&lt;/para&gt;</span></div><div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;<span class="comment">      &lt;para&gt;MinivmGreet() plays default prompts or user specific prompts for an account.&lt;/para&gt;</span></div><div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;<span class="comment">      &lt;para&gt;Busy and unavailable messages can be choosen, but will be overridden if a temporary</span></div><div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;<span class="comment">      message exists for the account.&lt;/para&gt;</span></div><div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;<span class="comment">      &lt;variablelist&gt;</span></div><div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;<span class="comment">         &lt;variable name=&quot;MVM_GREET_STATUS&quot;&gt;</span></div><div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;<span class="comment">            &lt;para&gt;This is the status of the greeting playback.&lt;/para&gt;</span></div><div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;<span class="comment">            &lt;value name=&quot;SUCCESS&quot; /&gt;</span></div><div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;<span class="comment">            &lt;value name=&quot;USEREXIT&quot; /&gt;</span></div><div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;<span class="comment">            &lt;value name=&quot;FAILED&quot; /&gt;</span></div><div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;<span class="comment">         &lt;/variable&gt;</span></div><div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;<span class="comment">      &lt;/variablelist&gt;</span></div><div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;<span class="comment">   &lt;/description&gt;</span></div><div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;<span class="comment">&lt;/application&gt;</span></div><div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;<span class="comment">&lt;application name=&quot;MinivmNotify&quot; language=&quot;en_US&quot;&gt;</span></div><div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;<span class="comment">   &lt;synopsis&gt;</span></div><div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;<span class="comment">      Notify voicemail owner about new messages.</span></div><div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;<span class="comment">   &lt;/synopsis&gt;</span></div><div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;<span class="comment">   &lt;syntax&gt;</span></div><div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;<span class="comment">      &lt;parameter name=&quot;mailbox&quot; required=&quot;true&quot; argsep=&quot;@&quot;&gt;</span></div><div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;<span class="comment">         &lt;argument name=&quot;username&quot; required=&quot;true&quot;&gt;</span></div><div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;<span class="comment">            &lt;para&gt;Voicemail username&lt;/para&gt;</span></div><div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;<span class="comment">         &lt;/argument&gt;</span></div><div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;<span class="comment">         &lt;argument name=&quot;domain&quot; required=&quot;true&quot;&gt;</span></div><div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;<span class="comment">            &lt;para&gt;Voicemail domain&lt;/para&gt;</span></div><div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;<span class="comment">         &lt;/argument&gt;</span></div><div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;<span class="comment">      &lt;/parameter&gt;</span></div><div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;<span class="comment">      &lt;parameter name=&quot;options&quot; required=&quot;false&quot;&gt;</span></div><div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;<span class="comment">         &lt;optionlist&gt;</span></div><div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;<span class="comment">            &lt;option name=&quot;template&quot;&gt;</span></div><div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;<span class="comment">               &lt;para&gt;E-mail template to use for voicemail notification&lt;/para&gt;</span></div><div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;<span class="comment">            &lt;/option&gt;</span></div><div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;<span class="comment">         &lt;/optionlist&gt;</span></div><div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;<span class="comment">      &lt;/parameter&gt;</span></div><div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;<span class="comment">   &lt;/syntax&gt;</span></div><div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;<span class="comment">   &lt;description&gt;</span></div><div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;<span class="comment">      &lt;para&gt;This application is part of the Mini-Voicemail system, configured in minivm.conf.&lt;/para&gt;</span></div><div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;<span class="comment">      &lt;para&gt;MiniVMnotify forwards messages about new voicemail to e-mail and pager. If there&#39;s no user</span></div><div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;<span class="comment">      account for that address, a temporary account will be used with default options (set in</span></div><div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;<span class="comment">      &lt;filename&gt;minivm.conf&lt;/filename&gt;).&lt;/para&gt;</span></div><div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;<span class="comment">      &lt;para&gt;If the channel variable &lt;variable&gt;MVM_COUNTER&lt;/variable&gt; is set, this will be used in the message</span></div><div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;<span class="comment">      file name and available in the template for the message.&lt;/para&gt;</span></div><div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;<span class="comment">      &lt;para&gt;If no template is given, the default email template will be used to send email and default pager</span></div><div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;<span class="comment">      template to send paging message (if the user account is configured with a paging address.&lt;/para&gt;</span></div><div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;<span class="comment">      &lt;variablelist&gt;</span></div><div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;<span class="comment">         &lt;variable name=&quot;MVM_NOTIFY_STATUS&quot;&gt;</span></div><div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;<span class="comment">            &lt;para&gt;This is the status of the notification attempt&lt;/para&gt;</span></div><div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;<span class="comment">            &lt;value name=&quot;SUCCESS&quot; /&gt;</span></div><div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;<span class="comment">            &lt;value name=&quot;FAILED&quot; /&gt;</span></div><div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;<span class="comment">         &lt;/variable&gt;</span></div><div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;<span class="comment">      &lt;/variablelist&gt;</span></div><div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;<span class="comment">   &lt;/description&gt;</span></div><div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;<span class="comment">&lt;/application&gt;</span></div><div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;<span class="comment">&lt;application name=&quot;MinivmDelete&quot; language=&quot;en_US&quot;&gt;</span></div><div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;<span class="comment">   &lt;synopsis&gt;</span></div><div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;<span class="comment">      Delete Mini-Voicemail voicemail messages.</span></div><div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;<span class="comment">   &lt;/synopsis&gt;</span></div><div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;<span class="comment">   &lt;syntax&gt;</span></div><div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;<span class="comment">      &lt;parameter name=&quot;filename&quot; required=&quot;true&quot;&gt;</span></div><div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;<span class="comment">         &lt;para&gt;File to delete&lt;/para&gt;</span></div><div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;<span class="comment">      &lt;/parameter&gt;</span></div><div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;<span class="comment">   &lt;/syntax&gt;</span></div><div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;<span class="comment">   &lt;description&gt;</span></div><div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;<span class="comment">      &lt;para&gt;This application is part of the Mini-Voicemail system, configured in &lt;filename&gt;minivm.conf&lt;/filename&gt;.&lt;/para&gt;</span></div><div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;<span class="comment">      &lt;para&gt;It deletes voicemail file set in MVM_FILENAME or given filename.&lt;/para&gt;</span></div><div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;<span class="comment">      &lt;variablelist&gt;</span></div><div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;<span class="comment">         &lt;variable name=&quot;MVM_DELETE_STATUS&quot;&gt;</span></div><div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;<span class="comment">            &lt;para&gt;This is the status of the delete operation.&lt;/para&gt;</span></div><div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;<span class="comment">            &lt;value name=&quot;SUCCESS&quot; /&gt;</span></div><div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;<span class="comment">            &lt;value name=&quot;FAILED&quot; /&gt;</span></div><div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;<span class="comment">         &lt;/variable&gt;</span></div><div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;<span class="comment">      &lt;/variablelist&gt;</span></div><div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;<span class="comment">   &lt;/description&gt;</span></div><div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;<span class="comment">&lt;/application&gt;</span></div><div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;<span class="comment">&lt;application name=&quot;MinivmAccMess&quot; language=&quot;en_US&quot;&gt;</span></div><div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;<span class="comment">   &lt;synopsis&gt;</span></div><div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;<span class="comment">      Record account specific messages.</span></div><div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;<span class="comment">   &lt;/synopsis&gt;</span></div><div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;<span class="comment">   &lt;syntax&gt;</span></div><div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;<span class="comment">      &lt;parameter name=&quot;mailbox&quot; required=&quot;true&quot; argsep=&quot;@&quot;&gt;</span></div><div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;<span class="comment">         &lt;argument name=&quot;username&quot; required=&quot;true&quot;&gt;</span></div><div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;<span class="comment">            &lt;para&gt;Voicemail username&lt;/para&gt;</span></div><div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;<span class="comment">         &lt;/argument&gt;</span></div><div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;<span class="comment">         &lt;argument name=&quot;domain&quot; required=&quot;true&quot;&gt;</span></div><div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;<span class="comment">            &lt;para&gt;Voicemail domain&lt;/para&gt;</span></div><div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;<span class="comment">         &lt;/argument&gt;</span></div><div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;<span class="comment">      &lt;/parameter&gt;</span></div><div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;<span class="comment">      &lt;parameter name=&quot;options&quot; required=&quot;false&quot;&gt;</span></div><div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;<span class="comment">         &lt;optionlist&gt;</span></div><div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;<span class="comment">            &lt;option name=&quot;u&quot;&gt;</span></div><div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;<span class="comment">               &lt;para&gt;Record the &lt;literal&gt;unavailable&lt;/literal&gt; greeting.&lt;/para&gt;</span></div><div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;<span class="comment">            &lt;/option&gt;</span></div><div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;<span class="comment">            &lt;option name=&quot;b&quot;&gt;</span></div><div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;<span class="comment">               &lt;para&gt;Record the &lt;literal&gt;busy&lt;/literal&gt; greeting.&lt;/para&gt;</span></div><div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;<span class="comment">            &lt;/option&gt;</span></div><div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;<span class="comment">            &lt;option name=&quot;t&quot;&gt;</span></div><div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;<span class="comment">               &lt;para&gt;Record the temporary greeting.&lt;/para&gt;</span></div><div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;<span class="comment">            &lt;/option&gt;</span></div><div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;<span class="comment">            &lt;option name=&quot;n&quot;&gt;</span></div><div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;<span class="comment">               &lt;para&gt;Account name.&lt;/para&gt;</span></div><div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;<span class="comment">            &lt;/option&gt;</span></div><div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;<span class="comment">         &lt;/optionlist&gt;</span></div><div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;<span class="comment">      &lt;/parameter&gt;</span></div><div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;<span class="comment">   &lt;/syntax&gt;</span></div><div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;<span class="comment">   &lt;description&gt;</span></div><div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;<span class="comment">      &lt;para&gt;This application is part of the Mini-Voicemail system, configured in &lt;filename&gt;minivm.conf&lt;/filename&gt;.&lt;/para&gt;</span></div><div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;<span class="comment">      &lt;para&gt;Use this application to record account specific audio/video messages for busy, unavailable</span></div><div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;<span class="comment">      and temporary messages.&lt;/para&gt;</span></div><div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;<span class="comment">      &lt;para&gt;Account specific directories will be created if they do not exist.&lt;/para&gt;</span></div><div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;<span class="comment">      &lt;variablelist&gt;</span></div><div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;<span class="comment">         &lt;variable name=&quot;MVM_ACCMESS_STATUS&quot;&gt;</span></div><div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;<span class="comment">            &lt;para&gt;This is the result of the attempt to record the specified greeting.&lt;/para&gt;</span></div><div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;<span class="comment">            &lt;para&gt;&lt;literal&gt;FAILED&lt;/literal&gt; is set if the file can&#39;t be created.&lt;/para&gt;</span></div><div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;<span class="comment">            &lt;value name=&quot;SUCCESS&quot; /&gt;</span></div><div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;<span class="comment">            &lt;value name=&quot;FAILED&quot; /&gt;</span></div><div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;<span class="comment">         &lt;/variable&gt;</span></div><div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;<span class="comment">      &lt;/variablelist&gt;</span></div><div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;<span class="comment">   &lt;/description&gt;</span></div><div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;<span class="comment">&lt;/application&gt;</span></div><div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;<span class="comment">&lt;application name=&quot;MinivmMWI&quot; language=&quot;en_US&quot;&gt;</span></div><div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;<span class="comment">   &lt;synopsis&gt;</span></div><div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;<span class="comment">      Send Message Waiting Notification to subscriber(s) of mailbox.</span></div><div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;<span class="comment">   &lt;/synopsis&gt;</span></div><div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;<span class="comment">   &lt;syntax&gt;</span></div><div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;<span class="comment">      &lt;parameter name=&quot;mailbox&quot; required=&quot;true&quot; argsep=&quot;@&quot;&gt;</span></div><div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;<span class="comment">         &lt;argument name=&quot;username&quot; required=&quot;true&quot;&gt;</span></div><div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;<span class="comment">            &lt;para&gt;Voicemail username&lt;/para&gt;</span></div><div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;<span class="comment">         &lt;/argument&gt;</span></div><div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;<span class="comment">         &lt;argument name=&quot;domain&quot; required=&quot;true&quot;&gt;</span></div><div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;<span class="comment">            &lt;para&gt;Voicemail domain&lt;/para&gt;</span></div><div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;<span class="comment">         &lt;/argument&gt;</span></div><div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;<span class="comment">      &lt;/parameter&gt;</span></div><div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;<span class="comment">      &lt;parameter name=&quot;urgent&quot; required=&quot;true&quot;&gt;</span></div><div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;<span class="comment">         &lt;para&gt;Number of urgent messages in mailbox.&lt;/para&gt;</span></div><div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;<span class="comment">      &lt;/parameter&gt;</span></div><div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;<span class="comment">      &lt;parameter name=&quot;new&quot; required=&quot;true&quot;&gt;</span></div><div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;<span class="comment">         &lt;para&gt;Number of new messages in mailbox.&lt;/para&gt;</span></div><div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;<span class="comment">      &lt;/parameter&gt;</span></div><div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;<span class="comment">      &lt;parameter name=&quot;old&quot; required=&quot;true&quot;&gt;</span></div><div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;<span class="comment">         &lt;para&gt;Number of old messages in mailbox.&lt;/para&gt;</span></div><div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;<span class="comment">      &lt;/parameter&gt;</span></div><div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;<span class="comment">   &lt;/syntax&gt;</span></div><div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;<span class="comment">   &lt;description&gt;</span></div><div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;<span class="comment">      &lt;para&gt;This application is part of the Mini-Voicemail system, configured in &lt;filename&gt;minivm.conf&lt;/filename&gt;.&lt;/para&gt;</span></div><div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;<span class="comment">      &lt;para&gt;MinivmMWI is used to send message waiting indication to any devices whose channels have</span></div><div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;<span class="comment">      subscribed to the mailbox passed in the first parameter.&lt;/para&gt;</span></div><div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;<span class="comment">   &lt;/description&gt;</span></div><div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;<span class="comment">&lt;/application&gt;</span></div><div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;<span class="comment">&lt;function name=&quot;MINIVMCOUNTER&quot; language=&quot;en_US&quot;&gt;</span></div><div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;<span class="comment">   &lt;synopsis&gt;</span></div><div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;<span class="comment">      Reads or sets counters for MiniVoicemail message.</span></div><div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;<span class="comment">   &lt;/synopsis&gt;</span></div><div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;<span class="comment">   &lt;syntax argsep=&quot;:&quot;&gt;</span></div><div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;<span class="comment">      &lt;parameter name=&quot;account&quot; required=&quot;true&quot;&gt;</span></div><div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;<span class="comment">         &lt;para&gt;If account is given and it exists, the counter is specific for the account.&lt;/para&gt;</span></div><div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;<span class="comment">         &lt;para&gt;If account is a domain and the domain directory exists, counters are specific for a domain.&lt;/para&gt;</span></div><div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;<span class="comment">      &lt;/parameter&gt;</span></div><div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;<span class="comment">      &lt;parameter name=&quot;name&quot; required=&quot;true&quot;&gt;</span></div><div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;<span class="comment">         &lt;para&gt;The name of the counter is a string, up to 10 characters.&lt;/para&gt;</span></div><div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;<span class="comment">      &lt;/parameter&gt;</span></div><div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;<span class="comment">      &lt;parameter name=&quot;operand&quot;&gt;</span></div><div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;<span class="comment">         &lt;para&gt;The counters never goes below zero. Valid operands for changing the value of a counter when assigning a value are:&lt;/para&gt;</span></div><div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;<span class="comment">         &lt;enumlist&gt;</span></div><div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;<span class="comment">            &lt;enum name=&quot;i&quot;&gt;&lt;para&gt;Increment by value.&lt;/para&gt;&lt;/enum&gt;</span></div><div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;<span class="comment">            &lt;enum name=&quot;d&quot;&gt;&lt;para&gt;Decrement by value.&lt;/para&gt;&lt;/enum&gt;</span></div><div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;<span class="comment">            &lt;enum name=&quot;s&quot;&gt;&lt;para&gt;Set to value.&lt;/para&gt;&lt;/enum&gt;</span></div><div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;<span class="comment">         &lt;/enumlist&gt;</span></div><div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;<span class="comment">      &lt;/parameter&gt;</span></div><div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;<span class="comment">   &lt;/syntax&gt;</span></div><div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;<span class="comment">   &lt;description&gt;</span></div><div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;<span class="comment">      &lt;para&gt;The operation is atomic and the counter is locked while changing the value. The counters are stored as text files in the minivm account directories. It might be better to use realtime functions if you are using a database to operate your Asterisk.&lt;/para&gt;</span></div><div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;<span class="comment">   &lt;/description&gt;</span></div><div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;<span class="comment">   &lt;see-also&gt;</span></div><div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;<span class="comment">      &lt;ref type=&quot;application&quot;&gt;MinivmRecord&lt;/ref&gt;</span></div><div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;<span class="comment">      &lt;ref type=&quot;application&quot;&gt;MinivmGreet&lt;/ref&gt;</span></div><div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;<span class="comment">      &lt;ref type=&quot;application&quot;&gt;MinivmNotify&lt;/ref&gt;</span></div><div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;<span class="comment">      &lt;ref type=&quot;application&quot;&gt;MinivmDelete&lt;/ref&gt;</span></div><div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;<span class="comment">      &lt;ref type=&quot;application&quot;&gt;MinivmAccMess&lt;/ref&gt;</span></div><div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;<span class="comment">      &lt;ref type=&quot;application&quot;&gt;MinivmMWI&lt;/ref&gt;</span></div><div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;<span class="comment">      &lt;ref type=&quot;function&quot;&gt;MINIVMACCOUNT&lt;/ref&gt;</span></div><div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;<span class="comment">   &lt;/see-also&gt;</span></div><div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;<span class="comment">&lt;/function&gt;</span></div><div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;<span class="comment">&lt;function name=&quot;MINIVMACCOUNT&quot; language=&quot;en_US&quot;&gt;</span></div><div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;<span class="comment">   &lt;synopsis&gt;</span></div><div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;<span class="comment">      Gets MiniVoicemail account information.</span></div><div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;<span class="comment">   &lt;/synopsis&gt;</span></div><div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;<span class="comment">   &lt;syntax argsep=&quot;:&quot;&gt;</span></div><div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;<span class="comment">      &lt;parameter name=&quot;account&quot; required=&quot;true&quot; /&gt;</span></div><div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;<span class="comment">      &lt;parameter name=&quot;item&quot; required=&quot;true&quot;&gt;</span></div><div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;<span class="comment">         &lt;para&gt;Valid items are:&lt;/para&gt;</span></div><div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;<span class="comment">         &lt;enumlist&gt;</span></div><div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;<span class="comment">            &lt;enum name=&quot;path&quot;&gt;</span></div><div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;<span class="comment">               &lt;para&gt;Path to account mailbox (if account exists, otherwise temporary mailbox).&lt;/para&gt;</span></div><div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;<span class="comment">            &lt;/enum&gt;</span></div><div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;<span class="comment">            &lt;enum name=&quot;hasaccount&quot;&gt;</span></div><div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;<span class="comment">               &lt;para&gt;1 is static Minivm account exists, 0 otherwise.&lt;/para&gt;</span></div><div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;<span class="comment">            &lt;/enum&gt;</span></div><div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;<span class="comment">            &lt;enum name=&quot;fullname&quot;&gt;</span></div><div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;<span class="comment">               &lt;para&gt;Full name of account owner.&lt;/para&gt;</span></div><div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;<span class="comment">            &lt;/enum&gt;</span></div><div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;<span class="comment">            &lt;enum name=&quot;email&quot;&gt;</span></div><div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;<span class="comment">               &lt;para&gt;Email address used for account.&lt;/para&gt;</span></div><div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;<span class="comment">            &lt;/enum&gt;</span></div><div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;<span class="comment">            &lt;enum name=&quot;etemplate&quot;&gt;</span></div><div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;<span class="comment">               &lt;para&gt;Email template for account (default template if none is configured).&lt;/para&gt;</span></div><div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;<span class="comment">            &lt;/enum&gt;</span></div><div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;<span class="comment">            &lt;enum name=&quot;ptemplate&quot;&gt;</span></div><div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;<span class="comment">               &lt;para&gt;Pager template for account (default template if none is configured).&lt;/para&gt;</span></div><div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;<span class="comment">            &lt;/enum&gt;</span></div><div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;<span class="comment">            &lt;enum name=&quot;accountcode&quot;&gt;</span></div><div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;<span class="comment">               &lt;para&gt;Account code for the voicemail account.&lt;/para&gt;</span></div><div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;<span class="comment">            &lt;/enum&gt;</span></div><div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;<span class="comment">            &lt;enum name=&quot;pincode&quot;&gt;</span></div><div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;<span class="comment">               &lt;para&gt;Pin code for voicemail account.&lt;/para&gt;</span></div><div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;<span class="comment">            &lt;/enum&gt;</span></div><div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;<span class="comment">            &lt;enum name=&quot;timezone&quot;&gt;</span></div><div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;<span class="comment">               &lt;para&gt;Time zone for voicemail account.&lt;/para&gt;</span></div><div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;<span class="comment">            &lt;/enum&gt;</span></div><div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;<span class="comment">            &lt;enum name=&quot;language&quot;&gt;</span></div><div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;<span class="comment">               &lt;para&gt;Language for voicemail account.&lt;/para&gt;</span></div><div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;<span class="comment">            &lt;/enum&gt;</span></div><div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;<span class="comment">            &lt;enum name=&quot;&amp;lt;channel variable name&amp;gt;&quot;&gt;</span></div><div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;<span class="comment">               &lt;para&gt;Channel variable value (set in configuration for account).&lt;/para&gt;</span></div><div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;<span class="comment">            &lt;/enum&gt;</span></div><div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;<span class="comment">         &lt;/enumlist&gt;</span></div><div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;<span class="comment">      &lt;/parameter&gt;</span></div><div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;<span class="comment">   &lt;/syntax&gt;</span></div><div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;<span class="comment">   &lt;description&gt;</span></div><div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;<span class="comment">      &lt;para /&gt;</span></div><div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;<span class="comment">   &lt;/description&gt;</span></div><div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;<span class="comment">   &lt;see-also&gt;</span></div><div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;<span class="comment">      &lt;ref type=&quot;application&quot;&gt;MinivmRecord&lt;/ref&gt;</span></div><div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;<span class="comment">      &lt;ref type=&quot;application&quot;&gt;MinivmGreet&lt;/ref&gt;</span></div><div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;<span class="comment">      &lt;ref type=&quot;application&quot;&gt;MinivmNotify&lt;/ref&gt;</span></div><div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;<span class="comment">      &lt;ref type=&quot;application&quot;&gt;MinivmDelete&lt;/ref&gt;</span></div><div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;<span class="comment">      &lt;ref type=&quot;application&quot;&gt;MinivmAccMess&lt;/ref&gt;</span></div><div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;<span class="comment">      &lt;ref type=&quot;application&quot;&gt;MinivmMWI&lt;/ref&gt;</span></div><div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;<span class="comment">      &lt;ref type=&quot;function&quot;&gt;MINIVMCOUNTER&lt;/ref&gt;</span></div><div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;<span class="comment">   &lt;/see-also&gt;</span></div><div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;<span class="comment">&lt;/function&gt;</span></div><div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;<span class="comment">   &lt;managerEvent language=&quot;en_US&quot; name=&quot;MiniVoiceMail&quot;&gt;</span></div><div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;<span class="comment">      &lt;managerEventInstance class=&quot;EVENT_FLAG_CALL&quot;&gt;</span></div><div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;<span class="comment">         &lt;synopsis&gt;Raised when a notification is sent out by a MiniVoiceMail application&lt;/synopsis&gt;</span></div><div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;<span class="comment">         &lt;syntax&gt;</span></div><div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;<span class="comment">            &lt;channel_snapshot/&gt;</span></div><div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;<span class="comment">            &lt;parameter name=&quot;Action&quot;&gt;</span></div><div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;<span class="comment">               &lt;para&gt;What action was taken. Currently, this will always be &lt;literal&gt;SentNotification&lt;/literal&gt;&lt;/para&gt;</span></div><div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;<span class="comment">            &lt;/parameter&gt;</span></div><div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;<span class="comment">            &lt;parameter name=&quot;Mailbox&quot;&gt;</span></div><div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;<span class="comment">               &lt;para&gt;The mailbox that the notification was about, specified as &lt;literal&gt;mailbox&lt;/literal&gt;@&lt;literal&gt;context&lt;/literal&gt;&lt;/para&gt;</span></div><div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;<span class="comment">            &lt;/parameter&gt;</span></div><div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;<span class="comment">            &lt;parameter name=&quot;Counter&quot;&gt;</span></div><div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;<span class="comment">               &lt;para&gt;A message counter derived from the &lt;literal&gt;MVM_COUNTER&lt;/literal&gt; channel variable.&lt;/para&gt;</span></div><div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;<span class="comment">            &lt;/parameter&gt;</span></div><div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;<span class="comment">         &lt;/syntax&gt;</span></div><div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;<span class="comment">      &lt;/managerEventInstance&gt;</span></div><div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;<span class="comment">   &lt;/managerEvent&gt;</span></div><div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;<span class="comment">***/</span></div><div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;</div><div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;<span class="preprocessor">#ifndef TRUE</span></div><div class="line"><a name="l00518"></a><span class="lineno"><a class="line" href="../../de/dfe/app__minivm_8c.html#aa8cecfc5c5c054d2875c03e77b7be15d">  518</a></span>&#160;<span class="preprocessor">#define TRUE 1</span></div><div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;<span class="preprocessor">#ifndef FALSE</span></div><div class="line"><a name="l00521"></a><span class="lineno"><a class="line" href="../../de/dfe/app__minivm_8c.html#aa93f0eb578d23995850d61f7d61c55c1">  521</a></span>&#160;<span class="preprocessor">#define FALSE 0</span></div><div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;</div><div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;</div><div class="line"><a name="l00525"></a><span class="lineno"><a class="line" href="../../de/dfe/app__minivm_8c.html#a251b3dd38bf79c9b6d4fdc86ef63f0a8">  525</a></span>&#160;<span class="preprocessor">#define MVM_REVIEW      (1 &lt;&lt; 0) </span><span class="comment">/*!&lt; Review message */</span><span class="preprocessor"></span></div><div class="line"><a name="l00526"></a><span class="lineno"><a class="line" href="../../de/dfe/app__minivm_8c.html#ac06da19dda21a4bac4970057bf72497a">  526</a></span>&#160;<span class="preprocessor">#define MVM_OPERATOR    (1 &lt;&lt; 1) </span><span class="comment">/*!&lt; Operator exit during voicemail recording */</span><span class="preprocessor"></span></div><div class="line"><a name="l00527"></a><span class="lineno"><a class="line" href="../../de/dfe/app__minivm_8c.html#a89126ccf2eb7366aa186b298441d66d6">  527</a></span>&#160;<span class="preprocessor">#define MVM_REALTIME    (1 &lt;&lt; 2) </span><span class="comment">/*!&lt; This user is a realtime account */</span><span class="preprocessor"></span></div><div class="line"><a name="l00528"></a><span class="lineno"><a class="line" href="../../de/dfe/app__minivm_8c.html#adf6a6bb7098154a1533f42fa7daa3e4e">  528</a></span>&#160;<span class="preprocessor">#define MVM_SVMAIL      (1 &lt;&lt; 3)</span></div><div class="line"><a name="l00529"></a><span class="lineno"><a class="line" href="../../de/dfe/app__minivm_8c.html#a34a90999bf33d04d3d775b4e729ef4c3">  529</a></span>&#160;<span class="preprocessor">#define MVM_ENVELOPE    (1 &lt;&lt; 4)</span></div><div class="line"><a name="l00530"></a><span class="lineno"><a class="line" href="../../de/dfe/app__minivm_8c.html#ab6cd66f20c51e9013c3afde616b6bdee">  530</a></span>&#160;<span class="preprocessor">#define MVM_PBXSKIP     (1 &lt;&lt; 9)</span></div><div class="line"><a name="l00531"></a><span class="lineno"><a class="line" href="../../de/dfe/app__minivm_8c.html#ac1976490b5dd7e2dae38667d5d21fe4a">  531</a></span>&#160;<span class="preprocessor">#define MVM_ALLOCED     (1 &lt;&lt; 13)</span></div><div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;<span class="comment">/*! \brief Default mail command to mail voicemail. Change it with the</span></div><div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;<span class="comment">    mailcmd= command in voicemail.conf */</span></div><div class="line"><a name="l00535"></a><span class="lineno"><a class="line" href="../../de/dfe/app__minivm_8c.html#a92d8fb2d08cf9220d520ae9691b5e6c4">  535</a></span>&#160;<span class="preprocessor">#define SENDMAIL &quot;/usr/sbin/sendmail -t&quot;</span></div><div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;</div><div class="line"><a name="l00537"></a><span class="lineno"><a class="line" href="../../de/dfe/app__minivm_8c.html#a8bd4261fe6c6d6807f032fc0b9eebfa3">  537</a></span>&#160;<span class="preprocessor">#define SOUND_INTRO     &quot;vm-intro&quot;</span></div><div class="line"><a name="l00538"></a><span class="lineno"><a class="line" href="../../de/dfe/app__minivm_8c.html#aa2a036ff88290149ea425ecea1d4eaf9">  538</a></span>&#160;<span class="preprocessor">#define B64_BASEMAXINLINE  256   </span><span class="comment">/*!&lt; Buffer size for Base 64 attachment encoding */</span><span class="preprocessor"></span></div><div class="line"><a name="l00539"></a><span class="lineno"><a class="line" href="../../de/dfe/app__minivm_8c.html#a26130f4cea34db8b2bd022f12615ba33">  539</a></span>&#160;<span class="preprocessor">#define B64_BASELINELEN    72 </span><span class="comment">/*!&lt; Line length for Base 64 endoded messages */</span><span class="preprocessor"></span></div><div class="line"><a name="l00540"></a><span class="lineno"><a class="line" href="../../de/dfe/app__minivm_8c.html#a4e67e9429d48a2ba8f833ee3b1dceb5d">  540</a></span>&#160;<span class="preprocessor">#define EOL       &quot;\r\n&quot;</span></div><div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;</div><div class="line"><a name="l00542"></a><span class="lineno"><a class="line" href="../../de/dfe/app__minivm_8c.html#ad76c4e7e27885ab5ae9cd4652bf0f95a">  542</a></span>&#160;<span class="preprocessor">#define MAX_DATETIME_FORMAT   512</span></div><div class="line"><a name="l00543"></a><span class="lineno"><a class="line" href="../../de/dfe/app__minivm_8c.html#aab88842146c214975db358115d86c726">  543</a></span>&#160;<span class="preprocessor">#define MAX_NUM_CID_CONTEXTS  10</span></div><div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;</div><div class="line"><a name="l00545"></a><span class="lineno"><a class="line" href="../../de/dfe/app__minivm_8c.html#a207c95b6a18096172f7278b3af01f96d">  545</a></span>&#160;<span class="preprocessor">#define ERROR_LOCK_PATH    -100</span></div><div class="line"><a name="l00546"></a><span class="lineno"><a class="line" href="../../de/dfe/app__minivm_8c.html#a158fef5d62bdc9b70bcf52e13c6a76c1">  546</a></span>&#160;<span class="preprocessor">#define  VOICEMAIL_DIR_MODE   0700</span></div><div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;</div><div class="line"><a name="l00548"></a><span class="lineno"><a class="line" href="../../de/dfe/app__minivm_8c.html#a62e6fabd28e7d7a9941945c7fde3bda6">  548</a></span>&#160;<span class="preprocessor">#define VOICEMAIL_CONFIG &quot;minivm.conf&quot;</span></div><div class="line"><a name="l00549"></a><span class="lineno"><a class="line" href="../../de/dfe/app__minivm_8c.html#a5e790f0ee1dbde79705c49bf33a1060d">  549</a></span>&#160;<span class="preprocessor">#define ASTERISK_USERNAME &quot;asterisk&quot;   </span><span class="comment">/*!&lt; Default username for sending mail is asterisk\@localhost */</span><span class="preprocessor"></span></div><div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;<span class="comment">/*! \brief Message types for notification */</span></div><div class="line"><a name="l00552"></a><span class="lineno"><a class="line" href="../../de/dfe/app__minivm_8c.html#abcec5c16680dc75cdf051552d6908042">  552</a></span>&#160;<span class="keyword">enum</span> <a class="code" href="../../de/dfe/app__minivm_8c.html#abcec5c16680dc75cdf051552d6908042">mvm_messagetype</a> {</div><div class="line"><a name="l00553"></a><span class="lineno"><a class="line" href="../../de/dfe/app__minivm_8c.html#abcec5c16680dc75cdf051552d6908042a0097c80109786c14718655071a22e0e8">  553</a></span>&#160;   <a class="code" href="../../de/dfe/app__minivm_8c.html#abcec5c16680dc75cdf051552d6908042a0097c80109786c14718655071a22e0e8">MVM_MESSAGE_EMAIL</a>,</div><div class="line"><a name="l00554"></a><span class="lineno"><a class="line" href="../../de/dfe/app__minivm_8c.html#abcec5c16680dc75cdf051552d6908042ae7f36447ba359572f25032860eebaeb4">  554</a></span>&#160;   <a class="code" href="../../de/dfe/app__minivm_8c.html#abcec5c16680dc75cdf051552d6908042ae7f36447ba359572f25032860eebaeb4">MVM_MESSAGE_PAGE</a></div><div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;   <span class="comment">/* For trunk: MVM_MESSAGE_JABBER, */</span></div><div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;};</div><div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;</div><div class="line"><a name="l00558"></a><span class="lineno"><a class="line" href="../../de/dfe/app__minivm_8c.html#ab94d2ef3acf22b2bf9410c48462c7cb1">  558</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">char</span> <a class="code" href="../../de/dfe/app__minivm_8c.html#ab94d2ef3acf22b2bf9410c48462c7cb1">MVM_SPOOL_DIR</a>[<a class="code" href="../../db/db2/asterisk_8h.html#ae688d728e1acdfe5988c7db45d6f0166">PATH_MAX</a>];</div><div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;</div><div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;<span class="comment">/* Module declarations */</span></div><div class="line"><a name="l00561"></a><span class="lineno"><a class="line" href="../../de/dfe/app__minivm_8c.html#abcbed0b94b212f947f3acdfcd6fa82ba">  561</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">char</span> *<a class="code" href="../../de/dfe/app__minivm_8c.html#abcbed0b94b212f947f3acdfcd6fa82ba">app_minivm_record</a> = <span class="stringliteral">&quot;MinivmRecord&quot;</span>;   <span class="comment">/* Leave a message */</span></div><div class="line"><a name="l00562"></a><span class="lineno"><a class="line" href="../../de/dfe/app__minivm_8c.html#a32fdccfe778fa730f0e0cb1e57299064">  562</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">char</span> *<a class="code" href="../../de/dfe/app__minivm_8c.html#a32fdccfe778fa730f0e0cb1e57299064">app_minivm_greet</a> = <span class="stringliteral">&quot;MinivmGreet&quot;</span>;     <span class="comment">/* Play voicemail prompts */</span></div><div class="line"><a name="l00563"></a><span class="lineno"><a class="line" href="../../de/dfe/app__minivm_8c.html#aa4ee01c44f3a162c943125869e95bcca">  563</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">char</span> *<a class="code" href="../../de/dfe/app__minivm_8c.html#aa4ee01c44f3a162c943125869e95bcca">app_minivm_notify</a> = <span class="stringliteral">&quot;MinivmNotify&quot;</span>;   <span class="comment">/* Notify about voicemail by using one of several methods */</span></div><div class="line"><a name="l00564"></a><span class="lineno"><a class="line" href="../../de/dfe/app__minivm_8c.html#a2e550cc7a2a2a5a8f72f567caa072844">  564</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">char</span> *<a class="code" href="../../de/dfe/app__minivm_8c.html#a2e550cc7a2a2a5a8f72f567caa072844">app_minivm_delete</a> = <span class="stringliteral">&quot;MinivmDelete&quot;</span>;   <span class="comment">/* Notify about voicemail by using one of several methods */</span></div><div class="line"><a name="l00565"></a><span class="lineno"><a class="line" href="../../de/dfe/app__minivm_8c.html#ac0439b6869f845808de3ac7e0d37e1c4">  565</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">char</span> *<a class="code" href="../../de/dfe/app__minivm_8c.html#ac0439b6869f845808de3ac7e0d37e1c4">app_minivm_accmess</a> = <span class="stringliteral">&quot;MinivmAccMess&quot;</span>; <span class="comment">/* Record personal voicemail messages */</span></div><div class="line"><a name="l00566"></a><span class="lineno"><a class="line" href="../../de/dfe/app__minivm_8c.html#af8b65ae2fa0c59765887e094566196bf">  566</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">char</span> *<a class="code" href="../../de/dfe/app__minivm_8c.html#af8b65ae2fa0c59765887e094566196bf">app_minivm_mwi</a> = <span class="stringliteral">&quot;MinivmMWI&quot;</span>;</div><div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;</div><div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;</div><div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;</div><div class="line"><a name="l00570"></a><span class="lineno"><a class="line" href="../../de/dfe/app__minivm_8c.html#a4aeda8b39c8ab166c538157d05591922">  570</a></span>&#160;<span class="keyword">enum</span> <a class="code" href="../../de/dfe/app__minivm_8c.html#a4aeda8b39c8ab166c538157d05591922">minivm_option_flags</a> {</div><div class="line"><a name="l00571"></a><span class="lineno"><a class="line" href="../../de/dfe/app__minivm_8c.html#a4aeda8b39c8ab166c538157d05591922a9c6a0359498684912cb0a3810e03138d">  571</a></span>&#160;   <a class="code" href="../../de/dfe/app__minivm_8c.html#a4aeda8b39c8ab166c538157d05591922a9c6a0359498684912cb0a3810e03138d">OPT_SILENT</a> =      (1 &lt;&lt; 0),</div><div class="line"><a name="l00572"></a><span class="lineno"><a class="line" href="../../de/dfe/app__minivm_8c.html#a4aeda8b39c8ab166c538157d05591922a6021f80ddb5561e6e07a285ea47b086e">  572</a></span>&#160;   <a class="code" href="../../de/dfe/app__minivm_8c.html#a4aeda8b39c8ab166c538157d05591922a6021f80ddb5561e6e07a285ea47b086e">OPT_BUSY_GREETING</a> =    (1 &lt;&lt; 1),</div><div class="line"><a name="l00573"></a><span class="lineno"><a class="line" href="../../de/dfe/app__minivm_8c.html#a4aeda8b39c8ab166c538157d05591922a96240d093eacd367dd06de745d12e559">  573</a></span>&#160;   <a class="code" href="../../de/dfe/app__minivm_8c.html#a4aeda8b39c8ab166c538157d05591922a96240d093eacd367dd06de745d12e559">OPT_UNAVAIL_GREETING</a> = (1 &lt;&lt; 2),</div><div class="line"><a name="l00574"></a><span class="lineno"><a class="line" href="../../de/dfe/app__minivm_8c.html#a4aeda8b39c8ab166c538157d05591922a46635c9bf224edd14121694d949250be">  574</a></span>&#160;   <a class="code" href="../../de/dfe/app__minivm_8c.html#a4aeda8b39c8ab166c538157d05591922a46635c9bf224edd14121694d949250be">OPT_TEMP_GREETING</a> = (1 &lt;&lt; 3),</div><div class="line"><a name="l00575"></a><span class="lineno"><a class="line" href="../../de/dfe/app__minivm_8c.html#a4aeda8b39c8ab166c538157d05591922a3ccbdb01bd64716cf0762f2d1f95d124">  575</a></span>&#160;   <a class="code" href="../../de/dfe/app__minivm_8c.html#a4aeda8b39c8ab166c538157d05591922a3ccbdb01bd64716cf0762f2d1f95d124">OPT_NAME_GREETING</a> = (1 &lt;&lt; 4),</div><div class="line"><a name="l00576"></a><span class="lineno"><a class="line" href="../../de/dfe/app__minivm_8c.html#a4aeda8b39c8ab166c538157d05591922a6f62412bc497c9dd7db876c7ea4f9cfd">  576</a></span>&#160;   <a class="code" href="../../de/dfe/app__minivm_8c.html#a4aeda8b39c8ab166c538157d05591922a6f62412bc497c9dd7db876c7ea4f9cfd">OPT_RECORDGAIN</a> =  (1 &lt;&lt; 5),</div><div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;};</div><div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;</div><div class="line"><a name="l00579"></a><span class="lineno"><a class="line" href="../../de/dfe/app__minivm_8c.html#a94a4fdd9ccddad3436c2c6f165ea5214">  579</a></span>&#160;<span class="keyword">enum</span> <a class="code" href="../../de/dfe/app__minivm_8c.html#a94a4fdd9ccddad3436c2c6f165ea5214">minivm_option_args</a> {</div><div class="line"><a name="l00580"></a><span class="lineno"><a class="line" href="../../de/dfe/app__minivm_8c.html#a94a4fdd9ccddad3436c2c6f165ea5214a0ba3410dc4adff3119e1a4007cf90a7d">  580</a></span>&#160;   <a class="code" href="../../de/dfe/app__minivm_8c.html#a94a4fdd9ccddad3436c2c6f165ea5214a0ba3410dc4adff3119e1a4007cf90a7d">OPT_ARG_RECORDGAIN</a> = 0,</div><div class="line"><a name="l00581"></a><span class="lineno"><a class="line" href="../../de/dfe/app__minivm_8c.html#a94a4fdd9ccddad3436c2c6f165ea5214aec7326f60e7edad15d96ff935e5616d6">  581</a></span>&#160;   <a class="code" href="../../de/dfe/app__minivm_8c.html#a94a4fdd9ccddad3436c2c6f165ea5214aec7326f60e7edad15d96ff935e5616d6">OPT_ARG_ARRAY_SIZE</a> = 1,</div><div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;};</div><div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;</div><div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;<a class="code" href="../../d3/d93/include_2asterisk_2app_8h.html#a520a3c6b7d57903d9a616051da1a019d">AST_APP_OPTIONS</a>(<a class="code" href="../../de/dfe/app__minivm_8c.html#aca4c8605b97cb5e7cfc963a88ae76621">minivm_app_options</a>, {</div><div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;   <a class="code" href="../../d3/d93/include_2asterisk_2app_8h.html#aca036489931bf5571e2472331c8ac80b">AST_APP_OPTION</a>(<span class="charliteral">&#39;s&#39;</span>, <a class="code" href="../../de/dfe/app__minivm_8c.html#a4aeda8b39c8ab166c538157d05591922a9c6a0359498684912cb0a3810e03138d">OPT_SILENT</a>),</div><div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;   <a class="code" href="../../d3/d93/include_2asterisk_2app_8h.html#aca036489931bf5571e2472331c8ac80b">AST_APP_OPTION</a>(<span class="charliteral">&#39;b&#39;</span>, <a class="code" href="../../de/dfe/app__minivm_8c.html#a4aeda8b39c8ab166c538157d05591922a6021f80ddb5561e6e07a285ea47b086e">OPT_BUSY_GREETING</a>),</div><div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;   <a class="code" href="../../d3/d93/include_2asterisk_2app_8h.html#aca036489931bf5571e2472331c8ac80b">AST_APP_OPTION</a>(<span class="charliteral">&#39;u&#39;</span>, <a class="code" href="../../de/dfe/app__minivm_8c.html#a4aeda8b39c8ab166c538157d05591922a96240d093eacd367dd06de745d12e559">OPT_UNAVAIL_GREETING</a>),</div><div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;   <a class="code" href="../../d3/d93/include_2asterisk_2app_8h.html#a7549377df87038be737e8cae73acaa9d">AST_APP_OPTION_ARG</a>(<span class="charliteral">&#39;g&#39;</span>, <a class="code" href="../../de/dfe/app__minivm_8c.html#a4aeda8b39c8ab166c538157d05591922a6f62412bc497c9dd7db876c7ea4f9cfd">OPT_RECORDGAIN</a>, <a class="code" href="../../de/dfe/app__minivm_8c.html#a94a4fdd9ccddad3436c2c6f165ea5214a0ba3410dc4adff3119e1a4007cf90a7d">OPT_ARG_RECORDGAIN</a>),</div><div class="line"><a name="l00589"></a><span class="lineno"><a class="line" href="../../de/dfe/app__minivm_8c.html#aca4c8605b97cb5e7cfc963a88ae76621">  589</a></span>&#160;});</div><div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;</div><div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;<a class="code" href="../../d3/d93/include_2asterisk_2app_8h.html#a520a3c6b7d57903d9a616051da1a019d">AST_APP_OPTIONS</a>(<a class="code" href="../../de/dfe/app__minivm_8c.html#a9037a3cda0a3779450ce6cba1041b70f">minivm_accmess_options</a>, {</div><div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;   <a class="code" href="../../d3/d93/include_2asterisk_2app_8h.html#aca036489931bf5571e2472331c8ac80b">AST_APP_OPTION</a>(<span class="charliteral">&#39;b&#39;</span>, <a class="code" href="../../de/dfe/app__minivm_8c.html#a4aeda8b39c8ab166c538157d05591922a6021f80ddb5561e6e07a285ea47b086e">OPT_BUSY_GREETING</a>),</div><div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;   <a class="code" href="../../d3/d93/include_2asterisk_2app_8h.html#aca036489931bf5571e2472331c8ac80b">AST_APP_OPTION</a>(<span class="charliteral">&#39;u&#39;</span>, <a class="code" href="../../de/dfe/app__minivm_8c.html#a4aeda8b39c8ab166c538157d05591922a96240d093eacd367dd06de745d12e559">OPT_UNAVAIL_GREETING</a>),</div><div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;   <a class="code" href="../../d3/d93/include_2asterisk_2app_8h.html#aca036489931bf5571e2472331c8ac80b">AST_APP_OPTION</a>(<span class="charliteral">&#39;t&#39;</span>, <a class="code" href="../../de/dfe/app__minivm_8c.html#a4aeda8b39c8ab166c538157d05591922a46635c9bf224edd14121694d949250be">OPT_TEMP_GREETING</a>),</div><div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;   <a class="code" href="../../d3/d93/include_2asterisk_2app_8h.html#aca036489931bf5571e2472331c8ac80b">AST_APP_OPTION</a>(<span class="charliteral">&#39;n&#39;</span>, <a class="code" href="../../de/dfe/app__minivm_8c.html#a4aeda8b39c8ab166c538157d05591922a3ccbdb01bd64716cf0762f2d1f95d124">OPT_NAME_GREETING</a>),</div><div class="line"><a name="l00596"></a><span class="lineno"><a class="line" href="../../de/dfe/app__minivm_8c.html#a9037a3cda0a3779450ce6cba1041b70f">  596</a></span>&#160;});</div><div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;<span class="comment">/*!\internal</span></div><div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;<span class="comment"> * \brief Structure for linked list of Mini-Voicemail users: \ref minivm_accounts */</span></div><div class="line"><a name="l00600"></a><span class="lineno"><a class="line" href="../../dc/d7b/structminivm__account.html">  600</a></span>&#160;<span class="keyword">struct </span><a class="code" href="../../dc/d7b/structminivm__account.html">minivm_account</a> {</div><div class="line"><a name="l00601"></a><span class="lineno"><a class="line" href="../../dc/d7b/structminivm__account.html#a4b30874d24514b5ef6ff5276e8c12ed4">  601</a></span>&#160;   <span class="keywordtype">char</span> <a class="code" href="../../dc/d7b/structminivm__account.html#a4b30874d24514b5ef6ff5276e8c12ed4">username</a>[<a class="code" href="../../d5/d7b/channel_8h.html#abcf1aea85b924e9cd605040b86241e2a">AST_MAX_CONTEXT</a>];  <span class="comment">/*!&lt; Mailbox username */</span></div><div class="line"><a name="l00602"></a><span class="lineno"><a class="line" href="../../dc/d7b/structminivm__account.html#ae43ea5d0335f149f0920d33e46b61c33">  602</a></span>&#160;   <span class="keywordtype">char</span> <a class="code" href="../../dd/dac/structdomain.html">domain</a>[<a class="code" href="../../d5/d7b/channel_8h.html#abcf1aea85b924e9cd605040b86241e2a">AST_MAX_CONTEXT</a>]; <span class="comment">/*!&lt; Voicemail domain */</span></div><div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;</div><div class="line"><a name="l00604"></a><span class="lineno"><a class="line" href="../../dc/d7b/structminivm__account.html#ae120a3d8aeb5d880fba30d84a560efae">  604</a></span>&#160;   <span class="keywordtype">char</span> <a class="code" href="../../dc/d7b/structminivm__account.html#ae120a3d8aeb5d880fba30d84a560efae">pincode</a>[10];    <span class="comment">/*!&lt; Secret pin code, numbers only */</span></div><div class="line"><a name="l00605"></a><span class="lineno"><a class="line" href="../../dc/d7b/structminivm__account.html#ab5845627664c59054dd8e5f01829d4f3">  605</a></span>&#160;   <span class="keywordtype">char</span> <a class="code" href="../../dc/d7b/structminivm__account.html#ab5845627664c59054dd8e5f01829d4f3">fullname</a>[120];     <span class="comment">/*!&lt; Full name, for directory app */</span></div><div class="line"><a name="l00606"></a><span class="lineno"><a class="line" href="../../dc/d7b/structminivm__account.html#aadd75c09e15efa9061997f033b3f224b">  606</a></span>&#160;   <span class="keywordtype">char</span> <a class="code" href="../../dc/d7b/structminivm__account.html#aadd75c09e15efa9061997f033b3f224b">email</a>[80];         <span class="comment">/*!&lt; E-mail address - override */</span></div><div class="line"><a name="l00607"></a><span class="lineno"><a class="line" href="../../dc/d7b/structminivm__account.html#a29b9b126bac9cc5f1cc334f140f39e8d">  607</a></span>&#160;   <span class="keywordtype">char</span> <a class="code" href="../../dc/d7b/structminivm__account.html#a29b9b126bac9cc5f1cc334f140f39e8d">pager</a>[80];         <span class="comment">/*!&lt; E-mail address to pager (no attachment) */</span></div><div class="line"><a name="l00608"></a><span class="lineno"><a class="line" href="../../dc/d7b/structminivm__account.html#adfee50d07a98645d4d20b896ce03785a">  608</a></span>&#160;   <span class="keywordtype">char</span> <a class="code" href="../../dc/d7b/structminivm__account.html#adfee50d07a98645d4d20b896ce03785a">accountcode</a>[<a class="code" href="../../d5/d7b/channel_8h.html#aa5a0589e78ac9e010524872ca0a3cf49">AST_MAX_ACCOUNT_CODE</a>];   <span class="comment">/*!&lt; Voicemail account account code */</span></div><div class="line"><a name="l00609"></a><span class="lineno"><a class="line" href="../../dc/d7b/structminivm__account.html#a0d189d088982b574837ebaee7cd4ccbd">  609</a></span>&#160;   <span class="keywordtype">char</span> <a class="code" href="../../dc/d7b/structminivm__account.html#a0d189d088982b574837ebaee7cd4ccbd">serveremail</a>[80];      <span class="comment">/*!&lt; From: Mail address */</span></div><div class="line"><a name="l00610"></a><span class="lineno"><a class="line" href="../../dc/d7b/structminivm__account.html#aa2f937e69f79fbfcbf13a8ca51adcce0">  610</a></span>&#160;   <span class="keywordtype">char</span> <a class="code" href="../../dc/d7b/structminivm__account.html#aa2f937e69f79fbfcbf13a8ca51adcce0">externnotify</a>[160];    <span class="comment">/*!&lt; Configurable notification command */</span></div><div class="line"><a name="l00611"></a><span class="lineno"><a class="line" href="../../dc/d7b/structminivm__account.html#adf416dc058363e2fd5750c77e2d78bee">  611</a></span>&#160;   <span class="keywordtype">char</span> <a class="code" href="../../dc/d7b/structminivm__account.html#adf416dc058363e2fd5750c77e2d78bee">language</a>[<a class="code" href="../../d5/d7b/channel_8h.html#a9238c3318ae8d3bea2cbbe1d1e459eb7">MAX_LANGUAGE</a>];    <span class="comment">/*!&lt; Config: Language setting */</span></div><div class="line"><a name="l00612"></a><span class="lineno"><a class="line" href="../../dc/d7b/structminivm__account.html#a4a081db7653645ce9fce8fd72e5a7bf1">  612</a></span>&#160;   <span class="keywordtype">char</span> <a class="code" href="../../dc/d7b/structminivm__account.html#a4a081db7653645ce9fce8fd72e5a7bf1">zonetag</a>[80];    <span class="comment">/*!&lt; Time zone */</span></div><div class="line"><a name="l00613"></a><span class="lineno"><a class="line" href="../../dc/d7b/structminivm__account.html#a06a75ac3b083fdd79d2947ca4aa77842">  613</a></span>&#160;   <span class="keywordtype">char</span> <a class="code" href="../../dc/d7b/structminivm__account.html#a06a75ac3b083fdd79d2947ca4aa77842">uniqueid</a>[20];      <span class="comment">/*!&lt; Unique integer identifier */</span></div><div class="line"><a name="l00614"></a><span class="lineno"><a class="line" href="../../dc/d7b/structminivm__account.html#aa9d4a76241ab2a75118261777526e04b">  614</a></span>&#160;   <span class="keywordtype">char</span> <a class="code" href="../../dc/d7b/structminivm__account.html#aa9d4a76241ab2a75118261777526e04b">exit</a>[80];       <span class="comment">/*!&lt; Options for exiting from voicemail() */</span></div><div class="line"><a name="l00615"></a><span class="lineno"><a class="line" href="../../dc/d7b/structminivm__account.html#ae80eeef848853cf42dc025b36f0de488">  615</a></span>&#160;   <span class="keywordtype">char</span> <a class="code" href="../../dc/d7b/structminivm__account.html#ae80eeef848853cf42dc025b36f0de488">attachfmt</a>[80];     <span class="comment">/*!&lt; Format for voicemail audio file attachment */</span></div><div class="line"><a name="l00616"></a><span class="lineno"><a class="line" href="../../dc/d7b/structminivm__account.html#ad48036454496b4bfb945139d1ae878c4">  616</a></span>&#160;   <span class="keywordtype">char</span> <a class="code" href="../../dc/d7b/structminivm__account.html#ad48036454496b4bfb945139d1ae878c4">etemplate</a>[80];     <span class="comment">/*!&lt; Pager template */</span></div><div class="line"><a name="l00617"></a><span class="lineno"><a class="line" href="../../dc/d7b/structminivm__account.html#a6e9b30710047deee4fb3e4f38c8e7cc2">  617</a></span>&#160;   <span class="keywordtype">char</span> <a class="code" href="../../dc/d7b/structminivm__account.html#a6e9b30710047deee4fb3e4f38c8e7cc2">ptemplate</a>[80];     <span class="comment">/*!&lt; Voicemail format */</span></div><div class="line"><a name="l00618"></a><span class="lineno"><a class="line" href="../../dc/d7b/structminivm__account.html#ac92588540e8c1d014a08cd8a45462b19">  618</a></span>&#160;   <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="../../dc/d7b/structminivm__account.html#ac92588540e8c1d014a08cd8a45462b19">flags</a>;     <span class="comment">/*!&lt; MVM_ flags */</span></div><div class="line"><a name="l00619"></a><span class="lineno"><a class="line" href="../../dc/d7b/structminivm__account.html#a06c0918fa1a1aac3d386fca59b12327c">  619</a></span>&#160;   <span class="keyword">struct </span><a class="code" href="../../dd/d02/structast__variable.html">ast_variable</a> *<a class="code" href="../../dc/d7b/structminivm__account.html#a06c0918fa1a1aac3d386fca59b12327c">chanvars</a>;   <span class="comment">/*!&lt; Variables for e-mail template */</span></div><div class="line"><a name="l00620"></a><span class="lineno"><a class="line" href="../../dc/d7b/structminivm__account.html#a97d0f923218857a92e83d94dcbfe0263">  620</a></span>&#160;   <span class="keywordtype">double</span> <a class="code" href="../../dc/d7b/structminivm__account.html#a97d0f923218857a92e83d94dcbfe0263">volgain</a>;         <span class="comment">/*!&lt; Volume gain for voicemails sent via e-mail */</span></div><div class="line"><a name="l00621"></a><span class="lineno"><a class="line" href="../../dc/d7b/structminivm__account.html#a3cfd4c7807b9aabd25b2ec4840123fda">  621</a></span>&#160;   <a class="code" href="../../df/d90/linkedlists_8h.html#a67508a613c8f337732e35d9367b43ae7">AST_LIST_ENTRY</a>(<a class="code" href="../../dc/d7b/structminivm__account.html">minivm_account</a>) <a class="code" href="../../dc/d7b/structminivm__account.html#a571e7afb397f412b54fd1f776dab778f">list</a>;</div><div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;};</div><div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;<span class="comment">/*!\internal</span></div><div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160;<span class="comment"> * \brief The list of e-mail accounts */</span></div><div class="line"><a name="l00626"></a><span class="lineno"><a class="line" href="../../d2/d1d/structminivm__accounts.html#adf04f66344e3fb0a6f6a69bf39d19902">  626</a></span>&#160;<span class="keyword">static</span> <a class="code" href="../../df/d90/linkedlists_8h.html#a10f9ed9242a397abf76de1ed1fa33c3b">AST_LIST_HEAD_STATIC</a>(<a class="code" href="../../d2/d1d/structminivm__accounts.html">minivm_accounts</a>, <a class="code" href="../../dc/d7b/structminivm__account.html">minivm_account</a>);</div><div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;<span class="comment">/*!\internal</span></div><div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160;<span class="comment"> * \brief Linked list of e-mail templates in various languages</span></div><div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;<span class="comment"> * These are used as templates for e-mails, pager messages and jabber messages</span></div><div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160;<span class="comment"> * \ref message_templates</span></div><div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160;<span class="comment">*/</span></div><div class="line"><a name="l00633"></a><span class="lineno"><a class="line" href="../../dc/d31/structminivm__template.html">  633</a></span>&#160;<span class="keyword">struct </span><a class="code" href="../../dc/d31/structminivm__template.html">minivm_template</a> {</div><div class="line"><a name="l00634"></a><span class="lineno"><a class="line" href="../../dc/d31/structminivm__template.html#a3777dbae63a15da001b2baa317a25149">  634</a></span>&#160;   <span class="keywordtype">char</span>  <a class="code" href="../../d0/d29/cdr__mysql_8c.html#a0980a105ccb863d8008eb6201a51da52">name</a>[80];      <span class="comment">/*!&lt; Template name */</span></div><div class="line"><a name="l00635"></a><span class="lineno"><a class="line" href="../../dc/d31/structminivm__template.html#a15ab326eb76ae067ffbf0e770b14350e">  635</a></span>&#160;   <span class="keywordtype">char</span>  *<a class="code" href="../../dc/d31/structminivm__template.html#a15ab326eb76ae067ffbf0e770b14350e">body</a>;         <span class="comment">/*!&lt; Body of this template */</span></div><div class="line"><a name="l00636"></a><span class="lineno"><a class="line" href="../../dc/d31/structminivm__template.html#a379df094ccf146582aa943eed05c2801">  636</a></span>&#160;   <span class="keywordtype">char</span>  fromaddress[100]; <span class="comment">/*!&lt; Who&#39;s sending the e-mail? */</span></div><div class="line"><a name="l00637"></a><span class="lineno"><a class="line" href="../../dc/d31/structminivm__template.html#a0d189d088982b574837ebaee7cd4ccbd">  637</a></span>&#160;   <span class="keywordtype">char</span>  <a class="code" href="../../dc/d7b/structminivm__account.html#a0d189d088982b574837ebaee7cd4ccbd">serveremail</a>[80];  <span class="comment">/*!&lt; From: Mail address */</span></div><div class="line"><a name="l00638"></a><span class="lineno"><a class="line" href="../../dc/d31/structminivm__template.html#aa57deff3f94ae5db41850dfe0042543f">  638</a></span>&#160;   <span class="keywordtype">char</span>  subject[100];     <span class="comment">/*!&lt; Subject line */</span></div><div class="line"><a name="l00639"></a><span class="lineno"><a class="line" href="../../dc/d31/structminivm__template.html#ac457ea24c7a0e5a913dba2b65abe24a5">  639</a></span>&#160;   <span class="keywordtype">char</span>  <a class="code" href="../../d1/d6d/chan__unistim_8c.html#a8bd4accafd4e712317ed9a471738a971">charset</a>[32];      <span class="comment">/*!&lt; Default character set for this template */</span></div><div class="line"><a name="l00640"></a><span class="lineno"><a class="line" href="../../dc/d31/structminivm__template.html#ad4786cc0738d237b7697e5448da7d22e">  640</a></span>&#160;   <span class="keywordtype">char</span>  <a class="code" href="../../dc/df4/app__voicemail_8c.html#ad4786cc0738d237b7697e5448da7d22e">locale</a>[20];    <span class="comment">/*!&lt; Locale for setlocale() */</span></div><div class="line"><a name="l00641"></a><span class="lineno"><a class="line" href="../../dc/d31/structminivm__template.html#a68c29ae64f92600e8e1622016c4a3f20">  641</a></span>&#160;   <span class="keywordtype">char</span>  <a class="code" href="../../d1/d22/logger_8c.html#a2057dec53731af6bb6881015b58936ba">dateformat</a>[80];      <span class="comment">/*!&lt; Date format to use in this attachment */</span></div><div class="line"><a name="l00642"></a><span class="lineno"><a class="line" href="../../dc/d31/structminivm__template.html#a2f8ccdb6d4cf2698360e28ee28e70cb3">  642</a></span>&#160;   <span class="keywordtype">int</span>   <a class="code" href="../../dc/d31/structminivm__template.html#a2f8ccdb6d4cf2698360e28ee28e70cb3">attachment</a>;    <span class="comment">/*!&lt; Attachment of media yes/no - no for pager messages */</span></div><div class="line"><a name="l00643"></a><span class="lineno"><a class="line" href="../../dc/d31/structminivm__template.html#aac5006a1db67263aa597985dfbacd845">  643</a></span>&#160;   <a class="code" href="../../df/d90/linkedlists_8h.html#a67508a613c8f337732e35d9367b43ae7">AST_LIST_ENTRY</a>(<a class="code" href="../../dc/d31/structminivm__template.html">minivm_template</a>) <a class="code" href="../../dc/d7b/structminivm__account.html#a571e7afb397f412b54fd1f776dab778f">list</a>;  <span class="comment">/*!&lt; List mechanics */</span></div><div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160;};</div><div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00646"></a><span class="lineno">  646</span>&#160;<span class="comment">/*! \brief The list of e-mail templates */</span></div><div class="line"><a name="l00647"></a><span class="lineno"><a class="line" href="../../d1/dd2/structmessage__templates.html#adf04f66344e3fb0a6f6a69bf39d19902">  647</a></span>&#160;<span class="keyword">static</span> <a class="code" href="../../df/d90/linkedlists_8h.html#a10f9ed9242a397abf76de1ed1fa33c3b">AST_LIST_HEAD_STATIC</a>(<a class="code" href="../../d1/dd2/structmessage__templates.html">message_templates</a>, <a class="code" href="../../dc/d31/structminivm__template.html">minivm_template</a>);</div><div class="line"><a name="l00648"></a><span class="lineno">  648</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00649"></a><span class="lineno">  649</span>&#160;<span class="comment">/*! \brief Options for leaving voicemail with the voicemail() application */</span></div><div class="line"><a name="l00650"></a><span class="lineno"><a class="line" href="../../dd/df7/structleave__vm__options.html">  650</a></span>&#160;<span class="keyword">struct </span><a class="code" href="../../dd/df7/structleave__vm__options.html">leave_vm_options</a> {</div><div class="line"><a name="l00651"></a><span class="lineno"><a class="line" href="../../dd/df7/structleave__vm__options.html#ac92588540e8c1d014a08cd8a45462b19">  651</a></span>&#160;   <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="../../dd/df7/structleave__vm__options.html#ac92588540e8c1d014a08cd8a45462b19">flags</a>;</div><div class="line"><a name="l00652"></a><span class="lineno"><a class="line" href="../../dd/df7/structleave__vm__options.html#a809cc53dfc8e9f1204c67c26aabaa322">  652</a></span>&#160;   <span class="keywordtype">signed</span> <span class="keywordtype">char</span> <a class="code" href="../../dd/df7/structleave__vm__options.html#a809cc53dfc8e9f1204c67c26aabaa322">record_gain</a>;</div><div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160;};</div><div class="line"><a name="l00654"></a><span class="lineno">  654</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00655"></a><span class="lineno">  655</span>&#160;<span class="comment">/*! \brief Structure for base64 encoding */</span></div><div class="line"><a name="l00656"></a><span class="lineno"><a class="line" href="../../de/d5d/structb64__baseio.html">  656</a></span>&#160;<span class="keyword">struct </span><a class="code" href="../../de/d5d/structb64__baseio.html">b64_baseio</a> {</div><div class="line"><a name="l00657"></a><span class="lineno"><a class="line" href="../../de/d5d/structb64__baseio.html#aaa24cfd3a54978c05a8d852aa7e77ec5">  657</a></span>&#160;   <span class="keywordtype">int</span> <a class="code" href="../../de/d5d/structb64__baseio.html#aaa24cfd3a54978c05a8d852aa7e77ec5">iocp</a>;</div><div class="line"><a name="l00658"></a><span class="lineno"><a class="line" href="../../de/d5d/structb64__baseio.html#a3e47346bcad694f3bfc4099f56531cee">  658</a></span>&#160;   <span class="keywordtype">int</span> <a class="code" href="../../de/d5d/structb64__baseio.html#a3e47346bcad694f3bfc4099f56531cee">iolen</a>;</div><div class="line"><a name="l00659"></a><span class="lineno"><a class="line" href="../../de/d5d/structb64__baseio.html#a4cd390d771f962d39585708c848317e5">  659</a></span>&#160;   <span class="keywordtype">int</span> <a class="code" href="../../de/d5d/structb64__baseio.html#a4cd390d771f962d39585708c848317e5">linelength</a>;</div><div class="line"><a name="l00660"></a><span class="lineno"><a class="line" href="../../de/d5d/structb64__baseio.html#aa3cbb055ee45b46498457488c3df39d8">  660</a></span>&#160;   <span class="keywordtype">int</span> <a class="code" href="../../de/d5d/structb64__baseio.html#aa3cbb055ee45b46498457488c3df39d8">ateof</a>;</div><div class="line"><a name="l00661"></a><span class="lineno"><a class="line" href="../../de/d5d/structb64__baseio.html#a316bf829c0f058fa97c89eb595b5a3a9">  661</a></span>&#160;   <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> iobuf[<a class="code" href="../../de/dfe/app__minivm_8c.html#aa2a036ff88290149ea425ecea1d4eaf9">B64_BASEMAXINLINE</a>];</div><div class="line"><a name="l00662"></a><span class="lineno">  662</span>&#160;};</div><div class="line"><a name="l00663"></a><span class="lineno">  663</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00664"></a><span class="lineno">  664</span>&#160;<span class="comment">/*! \brief Voicemail time zones */</span></div><div class="line"><a name="l00665"></a><span class="lineno"><a class="line" href="../../d4/d09/structminivm__zone.html">  665</a></span>&#160;<span class="keyword">struct </span><a class="code" href="../../d4/d09/structminivm__zone.html">minivm_zone</a> {</div><div class="line"><a name="l00666"></a><span class="lineno"><a class="line" href="../../d4/d09/structminivm__zone.html#a3777dbae63a15da001b2baa317a25149">  666</a></span>&#160;   <span class="keywordtype">char</span> <a class="code" href="../../d0/d29/cdr__mysql_8c.html#a0980a105ccb863d8008eb6201a51da52">name</a>[80];          <span class="comment">/*!&lt; Name of this time zone */</span></div><div class="line"><a name="l00667"></a><span class="lineno"><a class="line" href="../../d4/d09/structminivm__zone.html#aad16c37028f0efbc3cf8c9186b770ab8">  667</a></span>&#160;   <span class="keywordtype">char</span> timezone[80];         <span class="comment">/*!&lt; Timezone definition */</span></div><div class="line"><a name="l00668"></a><span class="lineno"><a class="line" href="../../d4/d09/structminivm__zone.html#a2c72a3f1a42813cfe7e2c79ef3fa9e6c">  668</a></span>&#160;   <span class="keywordtype">char</span> msg_format[BUFSIZ];      <span class="comment">/*!&lt; Not used in minivm ...yet */</span></div><div class="line"><a name="l00669"></a><span class="lineno"><a class="line" href="../../d4/d09/structminivm__zone.html#a361428c2db7c8849876cd2bce54a7e6a">  669</a></span>&#160;   <a class="code" href="../../df/d90/linkedlists_8h.html#a67508a613c8f337732e35d9367b43ae7">AST_LIST_ENTRY</a>(<a class="code" href="../../d4/d09/structminivm__zone.html">minivm_zone</a>) <a class="code" href="../../dc/d7b/structminivm__account.html#a571e7afb397f412b54fd1f776dab778f">list</a>;   <span class="comment">/*!&lt; List mechanics */</span></div><div class="line"><a name="l00670"></a><span class="lineno">  670</span>&#160;};</div><div class="line"><a name="l00671"></a><span class="lineno">  671</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00672"></a><span class="lineno">  672</span>&#160;<span class="comment">/*! \brief The list of e-mail time zones */</span></div><div class="line"><a name="l00673"></a><span class="lineno"><a class="line" href="../../db/dce/structminivm__zones.html#adf04f66344e3fb0a6f6a69bf39d19902">  673</a></span>&#160;<span class="keyword">static</span> <a class="code" href="../../df/d90/linkedlists_8h.html#a10f9ed9242a397abf76de1ed1fa33c3b">AST_LIST_HEAD_STATIC</a>(<a class="code" href="../../db/dce/structminivm__zones.html">minivm_zones</a>, <a class="code" href="../../d4/d09/structminivm__zone.html">minivm_zone</a>);</div><div class="line"><a name="l00674"></a><span class="lineno">  674</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00675"></a><span class="lineno">  675</span>&#160;<span class="comment">/*! \brief Structure for gathering statistics */</span></div><div class="line"><a name="l00676"></a><span class="lineno"><a class="line" href="../../d6/dee/structminivm__stats.html">  676</a></span>&#160;<span class="keyword">struct </span><a class="code" href="../../d6/dee/structminivm__stats.html">minivm_stats</a> {</div><div class="line"><a name="l00677"></a><span class="lineno"><a class="line" href="../../d6/dee/structminivm__stats.html#a90ef6fe584f0712a6dfe1e90038da6bf">  677</a></span>&#160;   <span class="keywordtype">int</span> <a class="code" href="../../d6/dee/structminivm__stats.html#a90ef6fe584f0712a6dfe1e90038da6bf">voicemailaccounts</a>;     <span class="comment">/*!&lt; Number of static accounts */</span></div><div class="line"><a name="l00678"></a><span class="lineno"><a class="line" href="../../d6/dee/structminivm__stats.html#ae86e86585a988ba3e05e4f4a92ad6b75">  678</a></span>&#160;   <span class="keywordtype">int</span> <a class="code" href="../../d6/dee/structminivm__stats.html#ae86e86585a988ba3e05e4f4a92ad6b75">timezones</a>;       <span class="comment">/*!&lt; Number of time zones */</span></div><div class="line"><a name="l00679"></a><span class="lineno"><a class="line" href="../../d6/dee/structminivm__stats.html#a92b59b721b40f396592d78dc1fedfbb0">  679</a></span>&#160;   <span class="keywordtype">int</span> <a class="code" href="../../d6/dee/structminivm__stats.html#a92b59b721b40f396592d78dc1fedfbb0">templates</a>;       <span class="comment">/*!&lt; Number of templates */</span></div><div class="line"><a name="l00680"></a><span class="lineno">  680</span>&#160;</div><div class="line"><a name="l00681"></a><span class="lineno"><a class="line" href="../../d6/dee/structminivm__stats.html#a739fde63c6d1cf2099ad3703aabb5433">  681</a></span>&#160;   <span class="keyword">struct </span>timeval reset;         <span class="comment">/*!&lt; Time for last reset */</span></div><div class="line"><a name="l00682"></a><span class="lineno"><a class="line" href="../../d6/dee/structminivm__stats.html#a6e076e5da3ca4090f6072b01a7e0a05c">  682</a></span>&#160;   <span class="keywordtype">int</span> <a class="code" href="../../d6/dee/structminivm__stats.html#a6e076e5da3ca4090f6072b01a7e0a05c">receivedmessages</a>;      <span class="comment">/*!&lt; Number of received messages since reset */</span></div><div class="line"><a name="l00683"></a><span class="lineno"><a class="line" href="../../d6/dee/structminivm__stats.html#a5787090892a375d9cfd599710d971b63">  683</a></span>&#160;   <span class="keyword">struct </span>timeval lastreceived;     <span class="comment">/*!&lt; Time for last voicemail sent */</span></div><div class="line"><a name="l00684"></a><span class="lineno">  684</span>&#160;};</div><div class="line"><a name="l00685"></a><span class="lineno">  685</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00686"></a><span class="lineno">  686</span>&#160;<span class="comment">/*! \brief Statistics for voicemail */</span></div><div class="line"><a name="l00687"></a><span class="lineno"><a class="line" href="../../de/dfe/app__minivm_8c.html#afb3339bdf5d1db127a88fc3be1dbcb1c">  687</a></span>&#160;<span class="keyword">static</span> <span class="keyword">struct </span><a class="code" href="../../d6/dee/structminivm__stats.html">minivm_stats</a> <a class="code" href="../../de/dfe/app__minivm_8c.html#afb3339bdf5d1db127a88fc3be1dbcb1c">global_stats</a>;</div><div class="line"><a name="l00688"></a><span class="lineno">  688</span>&#160;</div><div class="line"><a name="l00689"></a><span class="lineno"><a class="line" href="../../de/dfe/app__minivm_8c.html#ac50dec9d4a43a4e81ca2895e7ac7be2d">  689</a></span>&#160;<a class="code" href="../../dd/d42/lock_8h.html#ac840092853644cea0a186efdc58985f5">AST_MUTEX_DEFINE_STATIC</a>(<a class="code" href="../../de/dfe/app__minivm_8c.html#ac50dec9d4a43a4e81ca2895e7ac7be2d">minivmlock</a>);   <span class="comment">/*!&lt; Lock to protect voicemail system */</span></div><div class="line"><a name="l00690"></a><span class="lineno"><a class="line" href="../../de/dfe/app__minivm_8c.html#a44b4ef79fbbffd154a9398d0d12124a3">  690</a></span>&#160;<a class="code" href="../../dd/d42/lock_8h.html#ac840092853644cea0a186efdc58985f5">AST_MUTEX_DEFINE_STATIC</a>(<a class="code" href="../../de/dfe/app__minivm_8c.html#a44b4ef79fbbffd154a9398d0d12124a3">minivmloglock</a>);   <span class="comment">/*!&lt; Lock to protect voicemail system log file */</span></div><div class="line"><a name="l00691"></a><span class="lineno">  691</span>&#160;</div><div class="line"><a name="l00692"></a><span class="lineno"><a class="line" href="../../de/dfe/app__minivm_8c.html#a08a7003915f9def80dc85f09114aa1da">  692</a></span>&#160;<span class="keyword">static</span> FILE *<a class="code" href="../../de/dfe/app__minivm_8c.html#a08a7003915f9def80dc85f09114aa1da">minivmlogfile</a>;      <span class="comment">/*!&lt; The minivm log file */</span></div><div class="line"><a name="l00693"></a><span class="lineno">  693</span>&#160;</div><div class="line"><a name="l00694"></a><span class="lineno"><a class="line" href="../../de/dfe/app__minivm_8c.html#add014d9459f2a5a1d3d0043bf89a8067">  694</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../de/dfe/app__minivm_8c.html#add014d9459f2a5a1d3d0043bf89a8067">global_vmminmessage</a>;     <span class="comment">/*!&lt; Minimum duration of messages */</span></div><div class="line"><a name="l00695"></a><span class="lineno"><a class="line" href="../../de/dfe/app__minivm_8c.html#a7489f858d557c4f3db7ed7620a9e7643">  695</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../de/dfe/app__minivm_8c.html#a7489f858d557c4f3db7ed7620a9e7643">global_vmmaxmessage</a>;     <span class="comment">/*!&lt; Maximum duration of message */</span></div><div class="line"><a name="l00696"></a><span class="lineno"><a class="line" href="../../de/dfe/app__minivm_8c.html#a0442dc13ea144464c2b3f9aa6e2d6417">  696</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../de/dfe/app__minivm_8c.html#a0442dc13ea144464c2b3f9aa6e2d6417">global_maxsilence</a>;    <span class="comment">/*!&lt; Maximum silence during recording */</span></div><div class="line"><a name="l00697"></a><span class="lineno"><a class="line" href="../../de/dfe/app__minivm_8c.html#a73e33efd05bd512aa9674f73c578c0db">  697</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../de/dfe/app__minivm_8c.html#a73e33efd05bd512aa9674f73c578c0db">global_maxgreet</a>;      <span class="comment">/*!&lt; Maximum length of prompts  */</span></div><div class="line"><a name="l00698"></a><span class="lineno"><a class="line" href="../../de/dfe/app__minivm_8c.html#aa480711168f1f90a260496a1877397dd">  698</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../de/dfe/app__minivm_8c.html#aa480711168f1f90a260496a1877397dd">global_silencethreshold</a> = 128;</div><div class="line"><a name="l00699"></a><span class="lineno"><a class="line" href="../../de/dfe/app__minivm_8c.html#a88b50a14c4d1ed9c31d66ae39d11c5c1">  699</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">char</span> <a class="code" href="../../de/dfe/app__minivm_8c.html#a88b50a14c4d1ed9c31d66ae39d11c5c1">global_mailcmd</a>[160]; <span class="comment">/*!&lt; Configurable mail cmd */</span></div><div class="line"><a name="l00700"></a><span class="lineno"><a class="line" href="../../de/dfe/app__minivm_8c.html#ac95efb91330674db4cf67d25cde8ff3e">  700</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">char</span> <a class="code" href="../../de/dfe/app__minivm_8c.html#ac95efb91330674db4cf67d25cde8ff3e">global_externnotify</a>[160];  <span class="comment">/*!&lt; External notification application */</span></div><div class="line"><a name="l00701"></a><span class="lineno"><a class="line" href="../../de/dfe/app__minivm_8c.html#ae53cc00d8e92280628c59ed0b0a6857c">  701</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">char</span> <a class="code" href="../../de/dfe/app__minivm_8c.html#ae53cc00d8e92280628c59ed0b0a6857c">global_logfile</a>[<a class="code" href="../../db/db2/asterisk_8h.html#ae688d728e1acdfe5988c7db45d6f0166">PATH_MAX</a>];  <span class="comment">/*!&lt; Global log file for messages */</span></div><div class="line"><a name="l00702"></a><span class="lineno"><a class="line" href="../../de/dfe/app__minivm_8c.html#a2123bebd3dd82a1f29ad87ff972eb31e">  702</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">char</span> <a class="code" href="../../de/dfe/app__minivm_8c.html#a2123bebd3dd82a1f29ad87ff972eb31e">default_vmformat</a>[80];</div><div class="line"><a name="l00703"></a><span class="lineno">  703</span>&#160;</div><div class="line"><a name="l00704"></a><span class="lineno"><a class="line" href="../../de/dfe/app__minivm_8c.html#a3888fe259904a2eb18b173cbf56bfa86">  704</a></span>&#160;<span class="keyword">static</span> <span class="keyword">struct </span><a class="code" href="../../dc/dac/structast__flags.html">ast_flags</a> <a class="code" href="../../de/dfe/app__minivm_8c.html#a3888fe259904a2eb18b173cbf56bfa86">globalflags</a> = {0};   <span class="comment">/*!&lt; Global voicemail flags */</span></div><div class="line"><a name="l00705"></a><span class="lineno"><a class="line" href="../../de/dfe/app__minivm_8c.html#aa7201009c7bbfdaf680e6194aaed27ab">  705</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../de/dfe/app__minivm_8c.html#aa7201009c7bbfdaf680e6194aaed27ab">global_saydurationminfo</a>;</div><div class="line"><a name="l00706"></a><span class="lineno">  706</span>&#160;</div><div class="line"><a name="l00707"></a><span class="lineno"><a class="line" href="../../de/dfe/app__minivm_8c.html#ab341e61c475ac36a8896ce244ac1d691">  707</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">double</span> <a class="code" href="../../de/dfe/app__minivm_8c.html#ab341e61c475ac36a8896ce244ac1d691">global_volgain</a>; <span class="comment">/*!&lt; Volume gain for voicmemail via e-mail */</span></div><div class="line"><a name="l00708"></a><span class="lineno">  708</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00709"></a><span class="lineno">  709</span>&#160;<span class="comment">/*!\internal</span></div><div class="line"><a name="l00710"></a><span class="lineno">  710</span>&#160;<span class="comment"> * \brief Default dateformat, can be overridden in configuration file */</span></div><div class="line"><a name="l00711"></a><span class="lineno"><a class="line" href="../../de/dfe/app__minivm_8c.html#a062d3b248b3244aff7b2525014aede4b">  711</a></span>&#160;<span class="preprocessor">#define DEFAULT_DATEFORMAT    &quot;%A, %B %d, %Y at %r&quot;</span></div><div class="line"><a name="l00712"></a><span class="lineno"><a class="line" href="../../de/dfe/app__minivm_8c.html#a68d5c7aefed3c23982c7cde54c84fb10">  712</a></span>&#160;<span class="preprocessor">#define DEFAULT_CHARSET    &quot;ISO-8859-1&quot;</span></div><div class="line"><a name="l00713"></a><span class="lineno">  713</span>&#160;</div><div class="line"><a name="l00714"></a><span class="lineno">  714</span>&#160;<span class="comment">/* Forward declarations */</span></div><div class="line"><a name="l00715"></a><span class="lineno">  715</span>&#160;<span class="keyword">static</span> <span class="keywordtype">char</span> *<a class="code" href="../../de/dfe/app__minivm_8c.html#a35b1cb78eff65cbd1cda43ce934918cf">message_template_parse_filebody</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *filename);</div><div class="line"><a name="l00716"></a><span class="lineno">  716</span>&#160;<span class="keyword">static</span> <span class="keywordtype">char</span> *<a class="code" href="../../de/dfe/app__minivm_8c.html#a6d414e863f3534b892d3cd56fbb238f3">message_template_parse_emailbody</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *body);</div><div class="line"><a name="l00717"></a><span class="lineno">  717</span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../de/dfe/app__minivm_8c.html#a0cb40730dc4102d3171993e6e479a09c">create_vmaccount</a>(<span class="keywordtype">char</span> *<a class="code" href="../../d0/d29/cdr__mysql_8c.html#a0980a105ccb863d8008eb6201a51da52">name</a>, <span class="keyword">struct</span> <a class="code" href="../../dd/d02/structast__variable.html">ast_variable</a> *<a class="code" href="../../dc/df2/ast__expr2f_8c.html#a1b0936415a643c88ce543099c10e0d7f">var</a>, <span class="keywordtype">int</span> realtime);</div><div class="line"><a name="l00718"></a><span class="lineno">  718</span>&#160;<span class="keyword">static</span> <span class="keyword">struct </span><a class="code" href="../../dc/d7b/structminivm__account.html">minivm_account</a> *<a class="code" href="../../de/dfe/app__minivm_8c.html#af80b2bf6748bd7206069ff08addb3bb2">find_user_realtime</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="../../dd/dac/structdomain.html">domain</a>, <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="../../dc/d7b/structminivm__account.html#a4b30874d24514b5ef6ff5276e8c12ed4">username</a>);</div><div class="line"><a name="l00719"></a><span class="lineno">  719</span>&#160;<span class="keyword">static</span> <span class="keywordtype">char</span> *<a class="code" href="../../de/dfe/app__minivm_8c.html#a7515f8088d13c05182c54d43de777547">handle_minivm_reload</a>(<span class="keyword">struct</span> <a class="code" href="../../d8/d07/structast__cli__entry.html">ast_cli_entry</a> *e, <span class="keywordtype">int</span> cmd, <span class="keyword">struct</span> <a class="code" href="../../d3/dad/structast__cli__args.html">ast_cli_args</a> *<a class="code" href="../../d7/d6f/test__linkedlists_8c.html#a13dd15487fee89a002d17ef3aff62d02">a</a>);</div><div class="line"><a name="l00720"></a><span class="lineno">  720</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00721"></a><span class="lineno">  721</span>&#160;<span class="comment">/*!\internal</span></div><div class="line"><a name="l00722"></a><span class="lineno">  722</span>&#160;<span class="comment"> * \brief Create message template */</span></div><div class="line"><a name="l00723"></a><span class="lineno"><a class="line" href="../../de/dfe/app__minivm_8c.html#a9a72c400794fa62f66515ec4ca7fedea">  723</a></span>&#160;<span class="keyword">static</span> <span class="keyword">struct </span><a class="code" href="../../dc/d31/structminivm__template.html">minivm_template</a> *<a class="code" href="../../de/dfe/app__minivm_8c.html#a9a72c400794fa62f66515ec4ca7fedea">message_template_create</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="../../d0/d29/cdr__mysql_8c.html#a0980a105ccb863d8008eb6201a51da52">name</a>)</div><div class="line"><a name="l00724"></a><span class="lineno">  724</span>&#160;{</div><div class="line"><a name="l00725"></a><span class="lineno">  725</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../dc/d31/structminivm__template.html">minivm_template</a> *<span class="keyword">template</span>;</div><div class="line"><a name="l00726"></a><span class="lineno">  726</span>&#160;</div><div class="line"><a name="l00727"></a><span class="lineno">  727</span>&#160;   <span class="keyword">template</span> = <a class="code" href="../../d8/d8a/astmm_8h.html#ae0cd4c5524b01287ab19cbe233d9cebb">ast_calloc</a>(1, <span class="keyword">sizeof</span>(*<span class="keyword">template</span>));</div><div class="line"><a name="l00728"></a><span class="lineno">  728</span>&#160;   <span class="keywordflow">if</span> (!<span class="keyword">template</span>)</div><div class="line"><a name="l00729"></a><span class="lineno">  729</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l00730"></a><span class="lineno">  730</span>&#160;</div><div class="line"><a name="l00731"></a><span class="lineno">  731</span>&#160;   <span class="comment">/* Set some defaults for templates */</span></div><div class="line"><a name="l00732"></a><span class="lineno">  732</span>&#160;   <a class="code" href="../../d6/d90/strings_8h.html#ac4040268f7b6ed77dfc49c7767626369">ast_copy_string</a>(template-&gt;name, name, <span class="keyword">sizeof</span>(template-&gt;name));</div><div class="line"><a name="l00733"></a><span class="lineno">  733</span>&#160;   <a class="code" href="../../d6/d90/strings_8h.html#ac4040268f7b6ed77dfc49c7767626369">ast_copy_string</a>(template-&gt;dateformat, <a class="code" href="../../de/dfe/app__minivm_8c.html#a062d3b248b3244aff7b2525014aede4b">DEFAULT_DATEFORMAT</a>, <span class="keyword">sizeof</span>(template-&gt;dateformat));</div><div class="line"><a name="l00734"></a><span class="lineno">  734</span>&#160;   <a class="code" href="../../d6/d90/strings_8h.html#ac4040268f7b6ed77dfc49c7767626369">ast_copy_string</a>(template-&gt;charset, <a class="code" href="../../de/dfe/app__minivm_8c.html#a68d5c7aefed3c23982c7cde54c84fb10">DEFAULT_CHARSET</a>, <span class="keyword">sizeof</span>(template-&gt;charset));</div><div class="line"><a name="l00735"></a><span class="lineno">  735</span>&#160;   <a class="code" href="../../d6/d90/strings_8h.html#ac4040268f7b6ed77dfc49c7767626369">ast_copy_string</a>(template-&gt;subject, <span class="stringliteral">&quot;New message in mailbox ${MVM_USERNAME}@${MVM_DOMAIN}&quot;</span>, <span class="keyword">sizeof</span>(template-&gt;subject));</div><div class="line"><a name="l00736"></a><span class="lineno">  736</span>&#160;   <span class="keyword">template</span>-&gt;attachment = <a class="code" href="../../de/dfe/app__minivm_8c.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;</div><div class="line"><a name="l00737"></a><span class="lineno">  737</span>&#160;</div><div class="line"><a name="l00738"></a><span class="lineno">  738</span>&#160;   <span class="keywordflow">return</span> <span class="keyword">template</span>;</div><div class="line"><a name="l00739"></a><span class="lineno">  739</span>&#160;}</div><div class="line"><a name="l00740"></a><span class="lineno">  740</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00741"></a><span class="lineno">  741</span>&#160;<span class="comment">/*!\internal</span></div><div class="line"><a name="l00742"></a><span class="lineno">  742</span>&#160;<span class="comment"> * \brief Release memory allocated by message template */</span></div><div class="line"><a name="l00743"></a><span class="lineno"><a class="line" href="../../de/dfe/app__minivm_8c.html#a7b0f59d39384ea96ce987b3f14e616c7">  743</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../de/dfe/app__minivm_8c.html#a7b0f59d39384ea96ce987b3f14e616c7">message_template_free</a>(<span class="keyword">struct</span> <a class="code" href="../../dc/d31/structminivm__template.html">minivm_template</a> *<span class="keyword">template</span>)</div><div class="line"><a name="l00744"></a><span class="lineno">  744</span>&#160;{</div><div class="line"><a name="l00745"></a><span class="lineno">  745</span>&#160;   <span class="keywordflow">if</span> (template-&gt;body)</div><div class="line"><a name="l00746"></a><span class="lineno">  746</span>&#160;      <a class="code" href="../../d8/d8a/astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(template-&gt;body);</div><div class="line"><a name="l00747"></a><span class="lineno">  747</span>&#160;</div><div class="line"><a name="l00748"></a><span class="lineno">  748</span>&#160;   <a class="code" href="../../d8/d8a/astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a> (<span class="keyword">template</span>);</div><div class="line"><a name="l00749"></a><span class="lineno">  749</span>&#160;}</div><div class="line"><a name="l00750"></a><span class="lineno">  750</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00751"></a><span class="lineno">  751</span>&#160;<span class="comment">/*!\internal</span></div><div class="line"><a name="l00752"></a><span class="lineno">  752</span>&#160;<span class="comment"> * \brief Build message template from configuration */</span></div><div class="line"><a name="l00753"></a><span class="lineno"><a class="line" href="../../de/dfe/app__minivm_8c.html#a8690b029ca446ef1d49c1b012d261759">  753</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../de/dfe/app__minivm_8c.html#a8690b029ca446ef1d49c1b012d261759">message_template_build</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="../../d0/d29/cdr__mysql_8c.html#a0980a105ccb863d8008eb6201a51da52">name</a>, <span class="keyword">struct</span> <a class="code" href="../../dd/d02/structast__variable.html">ast_variable</a> *<a class="code" href="../../dc/df2/ast__expr2f_8c.html#a1b0936415a643c88ce543099c10e0d7f">var</a>)</div><div class="line"><a name="l00754"></a><span class="lineno">  754</span>&#160;{</div><div class="line"><a name="l00755"></a><span class="lineno">  755</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../dc/d31/structminivm__template.html">minivm_template</a> *<span class="keyword">template</span>;</div><div class="line"><a name="l00756"></a><span class="lineno">  756</span>&#160;   <span class="keywordtype">int</span> <a class="code" href="../../d6/d47/utils_2frame_8c.html#a4a9391ee88e57361b613c4c2fd2bf4aa">error</a> = 0;</div><div class="line"><a name="l00757"></a><span class="lineno">  757</span>&#160;</div><div class="line"><a name="l00758"></a><span class="lineno">  758</span>&#160;   <span class="keyword">template</span> = <a class="code" href="../../de/dfe/app__minivm_8c.html#a9a72c400794fa62f66515ec4ca7fedea">message_template_create</a>(name);</div><div class="line"><a name="l00759"></a><span class="lineno">  759</span>&#160;   <span class="keywordflow">if</span> (!<span class="keyword">template</span>) {</div><div class="line"><a name="l00760"></a><span class="lineno">  760</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Out of memory, can&#39;t allocate message template object %s.\n&quot;</span>, name);</div><div class="line"><a name="l00761"></a><span class="lineno">  761</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l00762"></a><span class="lineno">  762</span>&#160;   }</div><div class="line"><a name="l00763"></a><span class="lineno">  763</span>&#160;</div><div class="line"><a name="l00764"></a><span class="lineno">  764</span>&#160;   <span class="keywordflow">while</span> (var) {</div><div class="line"><a name="l00765"></a><span class="lineno">  765</span>&#160;      <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(3, <span class="stringliteral">&quot;Configuring template option %s = \&quot;%s\&quot; for template %s\n&quot;</span>, var-&gt;<a class="code" href="../../dd/d02/structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, var-&gt;<a class="code" href="../../dd/d02/structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, name);</div><div class="line"><a name="l00766"></a><span class="lineno">  766</span>&#160;      <span class="keywordflow">if</span> (!strcasecmp(var-&gt;<a class="code" href="../../dd/d02/structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;fromaddress&quot;</span>)) {</div><div class="line"><a name="l00767"></a><span class="lineno">  767</span>&#160;         <a class="code" href="../../d6/d90/strings_8h.html#ac4040268f7b6ed77dfc49c7767626369">ast_copy_string</a>(template-&gt;fromaddress, var-&gt;<a class="code" href="../../dd/d02/structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, <span class="keyword">sizeof</span>(template-&gt;fromaddress));</div><div class="line"><a name="l00768"></a><span class="lineno">  768</span>&#160;      } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(var-&gt;<a class="code" href="../../dd/d02/structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;fromemail&quot;</span>)) {</div><div class="line"><a name="l00769"></a><span class="lineno">  769</span>&#160;         <a class="code" href="../../d6/d90/strings_8h.html#ac4040268f7b6ed77dfc49c7767626369">ast_copy_string</a>(template-&gt;serveremail, var-&gt;<a class="code" href="../../dd/d02/structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, <span class="keyword">sizeof</span>(template-&gt;serveremail));</div><div class="line"><a name="l00770"></a><span class="lineno">  770</span>&#160;      } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(var-&gt;<a class="code" href="../../dd/d02/structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;subject&quot;</span>)) {</div><div class="line"><a name="l00771"></a><span class="lineno">  771</span>&#160;         <a class="code" href="../../d6/d90/strings_8h.html#ac4040268f7b6ed77dfc49c7767626369">ast_copy_string</a>(template-&gt;subject, var-&gt;<a class="code" href="../../dd/d02/structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, <span class="keyword">sizeof</span>(template-&gt;subject));</div><div class="line"><a name="l00772"></a><span class="lineno">  772</span>&#160;      } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(var-&gt;<a class="code" href="../../dd/d02/structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;locale&quot;</span>)) {</div><div class="line"><a name="l00773"></a><span class="lineno">  773</span>&#160;         <a class="code" href="../../d6/d90/strings_8h.html#ac4040268f7b6ed77dfc49c7767626369">ast_copy_string</a>(template-&gt;locale, var-&gt;<a class="code" href="../../dd/d02/structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, <span class="keyword">sizeof</span>(template-&gt;locale));</div><div class="line"><a name="l00774"></a><span class="lineno">  774</span>&#160;      } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(var-&gt;<a class="code" href="../../dd/d02/structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;attachmedia&quot;</span>)) {</div><div class="line"><a name="l00775"></a><span class="lineno">  775</span>&#160;         <span class="keyword">template</span>-&gt;attachment = <a class="code" href="../../d6/d90/strings_8h.html#a387a69b3871ca31061566a73f45d20f4">ast_true</a>(var-&gt;<a class="code" href="../../dd/d02/structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>);</div><div class="line"><a name="l00776"></a><span class="lineno">  776</span>&#160;      } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(var-&gt;<a class="code" href="../../dd/d02/structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;dateformat&quot;</span>)) {</div><div class="line"><a name="l00777"></a><span class="lineno">  777</span>&#160;         <a class="code" href="../../d6/d90/strings_8h.html#ac4040268f7b6ed77dfc49c7767626369">ast_copy_string</a>(template-&gt;dateformat, var-&gt;<a class="code" href="../../dd/d02/structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, <span class="keyword">sizeof</span>(template-&gt;dateformat));</div><div class="line"><a name="l00778"></a><span class="lineno">  778</span>&#160;      } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(var-&gt;<a class="code" href="../../dd/d02/structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;charset&quot;</span>)) {</div><div class="line"><a name="l00779"></a><span class="lineno">  779</span>&#160;         <a class="code" href="../../d6/d90/strings_8h.html#ac4040268f7b6ed77dfc49c7767626369">ast_copy_string</a>(template-&gt;charset, var-&gt;<a class="code" href="../../dd/d02/structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, <span class="keyword">sizeof</span>(template-&gt;charset));</div><div class="line"><a name="l00780"></a><span class="lineno">  780</span>&#160;      } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(var-&gt;<a class="code" href="../../dd/d02/structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;templatefile&quot;</span>)) {</div><div class="line"><a name="l00781"></a><span class="lineno">  781</span>&#160;         <span class="keywordflow">if</span> (template-&gt;body)</div><div class="line"><a name="l00782"></a><span class="lineno">  782</span>&#160;            <a class="code" href="../../d8/d8a/astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(template-&gt;body);</div><div class="line"><a name="l00783"></a><span class="lineno">  783</span>&#160;         <span class="keyword">template</span>-&gt;body = <a class="code" href="../../de/dfe/app__minivm_8c.html#a35b1cb78eff65cbd1cda43ce934918cf">message_template_parse_filebody</a>(var-&gt;<a class="code" href="../../dd/d02/structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>);</div><div class="line"><a name="l00784"></a><span class="lineno">  784</span>&#160;         <span class="keywordflow">if</span> (!template-&gt;body) {</div><div class="line"><a name="l00785"></a><span class="lineno">  785</span>&#160;            <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Error reading message body definition file %s\n&quot;</span>, var-&gt;<a class="code" href="../../dd/d02/structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>);</div><div class="line"><a name="l00786"></a><span class="lineno">  786</span>&#160;            error++;</div><div class="line"><a name="l00787"></a><span class="lineno">  787</span>&#160;         }</div><div class="line"><a name="l00788"></a><span class="lineno">  788</span>&#160;      } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(var-&gt;<a class="code" href="../../dd/d02/structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;messagebody&quot;</span>)) {</div><div class="line"><a name="l00789"></a><span class="lineno">  789</span>&#160;         <span class="keywordflow">if</span> (template-&gt;body)</div><div class="line"><a name="l00790"></a><span class="lineno">  790</span>&#160;            <a class="code" href="../../d8/d8a/astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(template-&gt;body);</div><div class="line"><a name="l00791"></a><span class="lineno">  791</span>&#160;         <span class="keyword">template</span>-&gt;body = <a class="code" href="../../de/dfe/app__minivm_8c.html#a6d414e863f3534b892d3cd56fbb238f3">message_template_parse_emailbody</a>(var-&gt;<a class="code" href="../../dd/d02/structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>);</div><div class="line"><a name="l00792"></a><span class="lineno">  792</span>&#160;         <span class="keywordflow">if</span> (!template-&gt;body) {</div><div class="line"><a name="l00793"></a><span class="lineno">  793</span>&#160;            <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Error parsing message body definition:\n          %s\n&quot;</span>, var-&gt;<a class="code" href="../../dd/d02/structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>);</div><div class="line"><a name="l00794"></a><span class="lineno">  794</span>&#160;            error++;</div><div class="line"><a name="l00795"></a><span class="lineno">  795</span>&#160;         }</div><div class="line"><a name="l00796"></a><span class="lineno">  796</span>&#160;      } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00797"></a><span class="lineno">  797</span>&#160;         <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Unknown message template configuration option \&quot;%s=%s\&quot;\n&quot;</span>, var-&gt;<a class="code" href="../../dd/d02/structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, var-&gt;<a class="code" href="../../dd/d02/structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>);</div><div class="line"><a name="l00798"></a><span class="lineno">  798</span>&#160;         error++;</div><div class="line"><a name="l00799"></a><span class="lineno">  799</span>&#160;      }</div><div class="line"><a name="l00800"></a><span class="lineno">  800</span>&#160;      var = var-&gt;<a class="code" href="../../dd/d02/structast__variable.html#afaaf66cc5029a563bd0bb9df076ea14b">next</a>;</div><div class="line"><a name="l00801"></a><span class="lineno">  801</span>&#160;   }</div><div class="line"><a name="l00802"></a><span class="lineno">  802</span>&#160;   <span class="keywordflow">if</span> (error)</div><div class="line"><a name="l00803"></a><span class="lineno">  803</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;-- %d errors found parsing message template definition %s\n&quot;</span>, error, name);</div><div class="line"><a name="l00804"></a><span class="lineno">  804</span>&#160;</div><div class="line"><a name="l00805"></a><span class="lineno">  805</span>&#160;   <a class="code" href="../../df/d90/linkedlists_8h.html#a9140a4e4d781264fa9469c52b1adae40">AST_LIST_LOCK</a>(&amp;<a class="code" href="../../d1/dd2/structmessage__templates.html">message_templates</a>);</div><div class="line"><a name="l00806"></a><span class="lineno">  806</span>&#160;   <a class="code" href="../../df/d90/linkedlists_8h.html#a4d258b4525e63c435d7de579d3f46960">AST_LIST_INSERT_TAIL</a>(&amp;<a class="code" href="../../d1/dd2/structmessage__templates.html">message_templates</a>, <span class="keyword">template</span>, <a class="code" href="../../dc/d7b/structminivm__account.html#a571e7afb397f412b54fd1f776dab778f">list</a>);</div><div class="line"><a name="l00807"></a><span class="lineno">  807</span>&#160;   <a class="code" href="../../df/d90/linkedlists_8h.html#ab48cb9e1e612dd486b747ba1c5d68d01">AST_LIST_UNLOCK</a>(&amp;<a class="code" href="../../d1/dd2/structmessage__templates.html">message_templates</a>);</div><div class="line"><a name="l00808"></a><span class="lineno">  808</span>&#160;</div><div class="line"><a name="l00809"></a><span class="lineno">  809</span>&#160;   <a class="code" href="../../de/dfe/app__minivm_8c.html#afb3339bdf5d1db127a88fc3be1dbcb1c">global_stats</a>.<a class="code" href="../../d6/dee/structminivm__stats.html#a92b59b721b40f396592d78dc1fedfbb0">templates</a>++;</div><div class="line"><a name="l00810"></a><span class="lineno">  810</span>&#160;</div><div class="line"><a name="l00811"></a><span class="lineno">  811</span>&#160;   <span class="keywordflow">return</span> <a class="code" href="../../d6/d47/utils_2frame_8c.html#a4a9391ee88e57361b613c4c2fd2bf4aa">error</a>;</div><div class="line"><a name="l00812"></a><span class="lineno">  812</span>&#160;}</div><div class="line"><a name="l00813"></a><span class="lineno">  813</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00814"></a><span class="lineno">  814</span>&#160;<span class="comment">/*!\internal</span></div><div class="line"><a name="l00815"></a><span class="lineno">  815</span>&#160;<span class="comment"> * \brief Find named template */</span></div><div class="line"><a name="l00816"></a><span class="lineno"><a class="line" href="../../de/dfe/app__minivm_8c.html#a2ba33f7f6225ee09bff35cfde87c08d7">  816</a></span>&#160;<span class="keyword">static</span> <span class="keyword">struct </span><a class="code" href="../../dc/d31/structminivm__template.html">minivm_template</a> *<a class="code" href="../../de/dfe/app__minivm_8c.html#a2ba33f7f6225ee09bff35cfde87c08d7">message_template_find</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="../../d0/d29/cdr__mysql_8c.html#a0980a105ccb863d8008eb6201a51da52">name</a>)</div><div class="line"><a name="l00817"></a><span class="lineno">  817</span>&#160;{</div><div class="line"><a name="l00818"></a><span class="lineno">  818</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../dc/d31/structminivm__template.html">minivm_template</a> *<span class="keyword">this</span>, *res = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l00819"></a><span class="lineno">  819</span>&#160;</div><div class="line"><a name="l00820"></a><span class="lineno">  820</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a>(name))</div><div class="line"><a name="l00821"></a><span class="lineno">  821</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l00822"></a><span class="lineno">  822</span>&#160;</div><div class="line"><a name="l00823"></a><span class="lineno">  823</span>&#160;   <a class="code" href="../../df/d90/linkedlists_8h.html#a9140a4e4d781264fa9469c52b1adae40">AST_LIST_LOCK</a>(&amp;<a class="code" href="../../d1/dd2/structmessage__templates.html">message_templates</a>);</div><div class="line"><a name="l00824"></a><span class="lineno">  824</span>&#160;   <a class="code" href="../../df/d90/linkedlists_8h.html#a3008b2f4f236b72d8bcfb80e346324ef">AST_LIST_TRAVERSE</a>(&amp;<a class="code" href="../../d1/dd2/structmessage__templates.html">message_templates</a>, <span class="keyword">this</span>, <a class="code" href="../../dc/d7b/structminivm__account.html#a571e7afb397f412b54fd1f776dab778f">list</a>) {</div><div class="line"><a name="l00825"></a><span class="lineno">  825</span>&#160;      <span class="keywordflow">if</span> (!strcasecmp(this-&gt;name, name)) {</div><div class="line"><a name="l00826"></a><span class="lineno">  826</span>&#160;         res = <span class="keyword">this</span>;</div><div class="line"><a name="l00827"></a><span class="lineno">  827</span>&#160;         <span class="keywordflow">break</span>;</div><div class="line"><a name="l00828"></a><span class="lineno">  828</span>&#160;      }</div><div class="line"><a name="l00829"></a><span class="lineno">  829</span>&#160;   }</div><div class="line"><a name="l00830"></a><span class="lineno">  830</span>&#160;   <a class="code" href="../../df/d90/linkedlists_8h.html#ab48cb9e1e612dd486b747ba1c5d68d01">AST_LIST_UNLOCK</a>(&amp;<a class="code" href="../../d1/dd2/structmessage__templates.html">message_templates</a>);</div><div class="line"><a name="l00831"></a><span class="lineno">  831</span>&#160;</div><div class="line"><a name="l00832"></a><span class="lineno">  832</span>&#160;   <span class="keywordflow">return</span> res;</div><div class="line"><a name="l00833"></a><span class="lineno">  833</span>&#160;}</div><div class="line"><a name="l00834"></a><span class="lineno">  834</span>&#160;</div><div class="line"><a name="l00835"></a><span class="lineno">  835</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00836"></a><span class="lineno">  836</span>&#160;<span class="comment">/*!\internal</span></div><div class="line"><a name="l00837"></a><span class="lineno">  837</span>&#160;<span class="comment"> * \brief Clear list of templates */</span></div><div class="line"><a name="l00838"></a><span class="lineno"><a class="line" href="../../de/dfe/app__minivm_8c.html#a0d7a1f3e3456c97d999bc5586878d15e">  838</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../de/dfe/app__minivm_8c.html#a0d7a1f3e3456c97d999bc5586878d15e">message_destroy_list</a>(<span class="keywordtype">void</span>)</div><div class="line"><a name="l00839"></a><span class="lineno">  839</span>&#160;{</div><div class="line"><a name="l00840"></a><span class="lineno">  840</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../dc/d31/structminivm__template.html">minivm_template</a> *<span class="keyword">this</span>;</div><div class="line"><a name="l00841"></a><span class="lineno">  841</span>&#160;   <a class="code" href="../../df/d90/linkedlists_8h.html#a9140a4e4d781264fa9469c52b1adae40">AST_LIST_LOCK</a>(&amp;<a class="code" href="../../d1/dd2/structmessage__templates.html">message_templates</a>);</div><div class="line"><a name="l00842"></a><span class="lineno">  842</span>&#160;   <span class="keywordflow">while</span> ((<span class="keyword">this</span> = <a class="code" href="../../df/d90/linkedlists_8h.html#aadfe2a69fbba4f27c201266a2ca5f989">AST_LIST_REMOVE_HEAD</a>(&amp;<a class="code" href="../../d1/dd2/structmessage__templates.html">message_templates</a>, <a class="code" href="../../dc/d7b/structminivm__account.html#a571e7afb397f412b54fd1f776dab778f">list</a>))) {</div><div class="line"><a name="l00843"></a><span class="lineno">  843</span>&#160;      <a class="code" href="../../de/dfe/app__minivm_8c.html#a7b0f59d39384ea96ce987b3f14e616c7">message_template_free</a>(<span class="keyword">this</span>);</div><div class="line"><a name="l00844"></a><span class="lineno">  844</span>&#160;   }</div><div class="line"><a name="l00845"></a><span class="lineno">  845</span>&#160;</div><div class="line"><a name="l00846"></a><span class="lineno">  846</span>&#160;   <a class="code" href="../../df/d90/linkedlists_8h.html#ab48cb9e1e612dd486b747ba1c5d68d01">AST_LIST_UNLOCK</a>(&amp;<a class="code" href="../../d1/dd2/structmessage__templates.html">message_templates</a>);</div><div class="line"><a name="l00847"></a><span class="lineno">  847</span>&#160;}</div><div class="line"><a name="l00848"></a><span class="lineno">  848</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00849"></a><span class="lineno">  849</span>&#160;<span class="comment">/*!\internal</span></div><div class="line"><a name="l00850"></a><span class="lineno">  850</span>&#160;<span class="comment"> * \brief read buffer from file (base64 conversion) */</span></div><div class="line"><a name="l00851"></a><span class="lineno"><a class="line" href="../../de/dfe/app__minivm_8c.html#a748e8337ba1b9ac0de883141e4b85602">  851</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../de/dfe/app__minivm_8c.html#a748e8337ba1b9ac0de883141e4b85602">b64_inbuf</a>(<span class="keyword">struct</span> <a class="code" href="../../de/d5d/structb64__baseio.html">b64_baseio</a> *bio, FILE *fi)</div><div class="line"><a name="l00852"></a><span class="lineno">  852</span>&#160;{</div><div class="line"><a name="l00853"></a><span class="lineno">  853</span>&#160;   <span class="keywordtype">int</span> l;</div><div class="line"><a name="l00854"></a><span class="lineno">  854</span>&#160;</div><div class="line"><a name="l00855"></a><span class="lineno">  855</span>&#160;   <span class="keywordflow">if</span> (bio-&gt;<a class="code" href="../../de/d5d/structb64__baseio.html#aa3cbb055ee45b46498457488c3df39d8">ateof</a>)</div><div class="line"><a name="l00856"></a><span class="lineno">  856</span>&#160;      <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00857"></a><span class="lineno">  857</span>&#160;</div><div class="line"><a name="l00858"></a><span class="lineno">  858</span>&#160;   <span class="keywordflow">if</span> ((l = fread(bio-&gt;<a class="code" href="../../de/d5d/structb64__baseio.html#a316bf829c0f058fa97c89eb595b5a3a9">iobuf</a>, 1, <a class="code" href="../../de/dfe/app__minivm_8c.html#aa2a036ff88290149ea425ecea1d4eaf9">B64_BASEMAXINLINE</a>, fi)) != <a class="code" href="../../de/dfe/app__minivm_8c.html#aa2a036ff88290149ea425ecea1d4eaf9">B64_BASEMAXINLINE</a>) {</div><div class="line"><a name="l00859"></a><span class="lineno">  859</span>&#160;      bio-&gt;<a class="code" href="../../de/d5d/structb64__baseio.html#aa3cbb055ee45b46498457488c3df39d8">ateof</a> = 1;</div><div class="line"><a name="l00860"></a><span class="lineno">  860</span>&#160;      <span class="keywordflow">if</span> (l == 0) {</div><div class="line"><a name="l00861"></a><span class="lineno">  861</span>&#160;         <span class="comment">/* Assume EOF */</span></div><div class="line"><a name="l00862"></a><span class="lineno">  862</span>&#160;         <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00863"></a><span class="lineno">  863</span>&#160;      }</div><div class="line"><a name="l00864"></a><span class="lineno">  864</span>&#160;   }</div><div class="line"><a name="l00865"></a><span class="lineno">  865</span>&#160;</div><div class="line"><a name="l00866"></a><span class="lineno">  866</span>&#160;   bio-&gt;<a class="code" href="../../de/d5d/structb64__baseio.html#a3e47346bcad694f3bfc4099f56531cee">iolen</a> = l;</div><div class="line"><a name="l00867"></a><span class="lineno">  867</span>&#160;   bio-&gt;<a class="code" href="../../de/d5d/structb64__baseio.html#aaa24cfd3a54978c05a8d852aa7e77ec5">iocp</a> = 0;</div><div class="line"><a name="l00868"></a><span class="lineno">  868</span>&#160;</div><div class="line"><a name="l00869"></a><span class="lineno">  869</span>&#160;   <span class="keywordflow">return</span> 1;</div><div class="line"><a name="l00870"></a><span class="lineno">  870</span>&#160;}</div><div class="line"><a name="l00871"></a><span class="lineno">  871</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00872"></a><span class="lineno">  872</span>&#160;<span class="comment">/*!\internal</span></div><div class="line"><a name="l00873"></a><span class="lineno">  873</span>&#160;<span class="comment"> * \brief read character from file to buffer (base64 conversion) */</span></div><div class="line"><a name="l00874"></a><span class="lineno"><a class="line" href="../../de/dfe/app__minivm_8c.html#a839f0e97aafd99c9771542f337a74ec6">  874</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../de/dfe/app__minivm_8c.html#a839f0e97aafd99c9771542f337a74ec6">b64_inchar</a>(<span class="keyword">struct</span> <a class="code" href="../../de/d5d/structb64__baseio.html">b64_baseio</a> *bio, FILE *fi)</div><div class="line"><a name="l00875"></a><span class="lineno">  875</span>&#160;{</div><div class="line"><a name="l00876"></a><span class="lineno">  876</span>&#160;   <span class="keywordflow">if</span> (bio-&gt;<a class="code" href="../../de/d5d/structb64__baseio.html#aaa24cfd3a54978c05a8d852aa7e77ec5">iocp</a> &gt;= bio-&gt;<a class="code" href="../../de/d5d/structb64__baseio.html#a3e47346bcad694f3bfc4099f56531cee">iolen</a>) {</div><div class="line"><a name="l00877"></a><span class="lineno">  877</span>&#160;      <span class="keywordflow">if</span> (!<a class="code" href="../../de/dfe/app__minivm_8c.html#a748e8337ba1b9ac0de883141e4b85602">b64_inbuf</a>(bio, fi))</div><div class="line"><a name="l00878"></a><span class="lineno">  878</span>&#160;         <span class="keywordflow">return</span> EOF;</div><div class="line"><a name="l00879"></a><span class="lineno">  879</span>&#160;   }</div><div class="line"><a name="l00880"></a><span class="lineno">  880</span>&#160;</div><div class="line"><a name="l00881"></a><span class="lineno">  881</span>&#160;   <span class="keywordflow">return</span> bio-&gt;<a class="code" href="../../de/d5d/structb64__baseio.html#a316bf829c0f058fa97c89eb595b5a3a9">iobuf</a>[bio-&gt;<a class="code" href="../../de/d5d/structb64__baseio.html#aaa24cfd3a54978c05a8d852aa7e77ec5">iocp</a>++];</div><div class="line"><a name="l00882"></a><span class="lineno">  882</span>&#160;}</div><div class="line"><a name="l00883"></a><span class="lineno">  883</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00884"></a><span class="lineno">  884</span>&#160;<span class="comment">/*!\internal</span></div><div class="line"><a name="l00885"></a><span class="lineno">  885</span>&#160;<span class="comment"> * \brief write buffer to file (base64 conversion) */</span></div><div class="line"><a name="l00886"></a><span class="lineno"><a class="line" href="../../de/dfe/app__minivm_8c.html#af0d420dc6a4cf41d9421d78d8fbf8c2f">  886</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../de/dfe/app__minivm_8c.html#af0d420dc6a4cf41d9421d78d8fbf8c2f">b64_ochar</a>(<span class="keyword">struct</span> <a class="code" href="../../de/d5d/structb64__baseio.html">b64_baseio</a> *bio, <span class="keywordtype">int</span> <a class="code" href="../../d7/d6f/test__linkedlists_8c.html#acd9db00336027462cfb25b97b5356883">c</a>, FILE *so)</div><div class="line"><a name="l00887"></a><span class="lineno">  887</span>&#160;{</div><div class="line"><a name="l00888"></a><span class="lineno">  888</span>&#160;   <span class="keywordflow">if</span> (bio-&gt;<a class="code" href="../../de/d5d/structb64__baseio.html#a4cd390d771f962d39585708c848317e5">linelength</a> &gt;= <a class="code" href="../../de/dfe/app__minivm_8c.html#a26130f4cea34db8b2bd022f12615ba33">B64_BASELINELEN</a>) {</div><div class="line"><a name="l00889"></a><span class="lineno">  889</span>&#160;      <span class="keywordflow">if</span> (fputs(<a class="code" href="../../de/dfe/app__minivm_8c.html#a4e67e9429d48a2ba8f833ee3b1dceb5d">EOL</a>,so) == EOF)</div><div class="line"><a name="l00890"></a><span class="lineno">  890</span>&#160;         <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l00891"></a><span class="lineno">  891</span>&#160;</div><div class="line"><a name="l00892"></a><span class="lineno">  892</span>&#160;      bio-&gt;<a class="code" href="../../de/d5d/structb64__baseio.html#a4cd390d771f962d39585708c848317e5">linelength</a>= 0;</div><div class="line"><a name="l00893"></a><span class="lineno">  893</span>&#160;   }</div><div class="line"><a name="l00894"></a><span class="lineno">  894</span>&#160;</div><div class="line"><a name="l00895"></a><span class="lineno">  895</span>&#160;   <span class="keywordflow">if</span> (putc(((<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>) c), so) == EOF)</div><div class="line"><a name="l00896"></a><span class="lineno">  896</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l00897"></a><span class="lineno">  897</span>&#160;</div><div class="line"><a name="l00898"></a><span class="lineno">  898</span>&#160;   bio-&gt;<a class="code" href="../../de/d5d/structb64__baseio.html#a4cd390d771f962d39585708c848317e5">linelength</a>++;</div><div class="line"><a name="l00899"></a><span class="lineno">  899</span>&#160;</div><div class="line"><a name="l00900"></a><span class="lineno">  900</span>&#160;   <span class="keywordflow">return</span> 1;</div><div class="line"><a name="l00901"></a><span class="lineno">  901</span>&#160;}</div><div class="line"><a name="l00902"></a><span class="lineno">  902</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00903"></a><span class="lineno">  903</span>&#160;<span class="comment">/*!\internal</span></div><div class="line"><a name="l00904"></a><span class="lineno">  904</span>&#160;<span class="comment"> * \brief Encode file to base64 encoding for email attachment (base64 conversion) */</span></div><div class="line"><a name="l00905"></a><span class="lineno"><a class="line" href="../../de/dfe/app__minivm_8c.html#a47ff5177c51504731acbd567efea2b17">  905</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../de/dfe/app__minivm_8c.html#a47ff5177c51504731acbd567efea2b17">base_encode</a>(<span class="keywordtype">char</span> *filename, FILE *so)</div><div class="line"><a name="l00906"></a><span class="lineno">  906</span>&#160;{</div><div class="line"><a name="l00907"></a><span class="lineno">  907</span>&#160;   <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> dtable[<a class="code" href="../../de/dfe/app__minivm_8c.html#aa2a036ff88290149ea425ecea1d4eaf9">B64_BASEMAXINLINE</a>];</div><div class="line"><a name="l00908"></a><span class="lineno">  908</span>&#160;   <span class="keywordtype">int</span> i,hiteof= 0;</div><div class="line"><a name="l00909"></a><span class="lineno">  909</span>&#160;   FILE *fi;</div><div class="line"><a name="l00910"></a><span class="lineno">  910</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../de/d5d/structb64__baseio.html">b64_baseio</a> bio;</div><div class="line"><a name="l00911"></a><span class="lineno">  911</span>&#160;</div><div class="line"><a name="l00912"></a><span class="lineno">  912</span>&#160;   memset(&amp;bio, 0, <span class="keyword">sizeof</span>(bio));</div><div class="line"><a name="l00913"></a><span class="lineno">  913</span>&#160;   bio.<a class="code" href="../../de/d5d/structb64__baseio.html#aaa24cfd3a54978c05a8d852aa7e77ec5">iocp</a> = <a class="code" href="../../de/dfe/app__minivm_8c.html#aa2a036ff88290149ea425ecea1d4eaf9">B64_BASEMAXINLINE</a>;</div><div class="line"><a name="l00914"></a><span class="lineno">  914</span>&#160;</div><div class="line"><a name="l00915"></a><span class="lineno">  915</span>&#160;   <span class="keywordflow">if</span> (!(fi = fopen(filename, <span class="stringliteral">&quot;rb&quot;</span>))) {</div><div class="line"><a name="l00916"></a><span class="lineno">  916</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Failed to open file: %s: %s\n&quot;</span>, filename, strerror(<a class="code" href="../../d1/d6e/main_2stdtime_2private_8h.html#ad65a8842cc674e3ddf69355898c0ecbf">errno</a>));</div><div class="line"><a name="l00917"></a><span class="lineno">  917</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l00918"></a><span class="lineno">  918</span>&#160;   }</div><div class="line"><a name="l00919"></a><span class="lineno">  919</span>&#160;</div><div class="line"><a name="l00920"></a><span class="lineno">  920</span>&#160;   <span class="keywordflow">for</span> (i= 0; i&lt;9; i++) {</div><div class="line"><a name="l00921"></a><span class="lineno">  921</span>&#160;      dtable[i]= <span class="charliteral">&#39;A&#39;</span>+i;</div><div class="line"><a name="l00922"></a><span class="lineno">  922</span>&#160;      dtable[i+9]= <span class="charliteral">&#39;J&#39;</span>+i;</div><div class="line"><a name="l00923"></a><span class="lineno">  923</span>&#160;      dtable[26+i]= <span class="charliteral">&#39;a&#39;</span>+i;</div><div class="line"><a name="l00924"></a><span class="lineno">  924</span>&#160;      dtable[26+i+9]= <span class="charliteral">&#39;j&#39;</span>+i;</div><div class="line"><a name="l00925"></a><span class="lineno">  925</span>&#160;   }</div><div class="line"><a name="l00926"></a><span class="lineno">  926</span>&#160;   <span class="keywordflow">for</span> (i= 0; i &lt; 8; i++) {</div><div class="line"><a name="l00927"></a><span class="lineno">  927</span>&#160;      dtable[i+18]= <span class="charliteral">&#39;S&#39;</span>+i;</div><div class="line"><a name="l00928"></a><span class="lineno">  928</span>&#160;      dtable[26+i+18]= <span class="charliteral">&#39;s&#39;</span>+i;</div><div class="line"><a name="l00929"></a><span class="lineno">  929</span>&#160;   }</div><div class="line"><a name="l00930"></a><span class="lineno">  930</span>&#160;   <span class="keywordflow">for</span> (i= 0; i &lt; 10; i++) {</div><div class="line"><a name="l00931"></a><span class="lineno">  931</span>&#160;      dtable[52+i]= <span class="charliteral">&#39;0&#39;</span>+i;</div><div class="line"><a name="l00932"></a><span class="lineno">  932</span>&#160;   }</div><div class="line"><a name="l00933"></a><span class="lineno">  933</span>&#160;   dtable[62]= <span class="charliteral">&#39;+&#39;</span>;</div><div class="line"><a name="l00934"></a><span class="lineno">  934</span>&#160;   dtable[63]= <span class="charliteral">&#39;/&#39;</span>;</div><div class="line"><a name="l00935"></a><span class="lineno">  935</span>&#160;</div><div class="line"><a name="l00936"></a><span class="lineno">  936</span>&#160;   <span class="keywordflow">while</span> (!hiteof){</div><div class="line"><a name="l00937"></a><span class="lineno">  937</span>&#160;      <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> igroup[3], ogroup[4];</div><div class="line"><a name="l00938"></a><span class="lineno">  938</span>&#160;      <span class="keywordtype">int</span> <a class="code" href="../../d7/d6f/test__linkedlists_8c.html#acd9db00336027462cfb25b97b5356883">c</a>,n;</div><div class="line"><a name="l00939"></a><span class="lineno">  939</span>&#160;</div><div class="line"><a name="l00940"></a><span class="lineno">  940</span>&#160;      igroup[0]= igroup[1]= igroup[2]= 0;</div><div class="line"><a name="l00941"></a><span class="lineno">  941</span>&#160;</div><div class="line"><a name="l00942"></a><span class="lineno">  942</span>&#160;      <span class="keywordflow">for</span> (n= 0; n &lt; 3; n++) {</div><div class="line"><a name="l00943"></a><span class="lineno">  943</span>&#160;         <span class="keywordflow">if</span> ((c = <a class="code" href="../../de/dfe/app__minivm_8c.html#a839f0e97aafd99c9771542f337a74ec6">b64_inchar</a>(&amp;bio, fi)) == EOF) {</div><div class="line"><a name="l00944"></a><span class="lineno">  944</span>&#160;            hiteof= 1;</div><div class="line"><a name="l00945"></a><span class="lineno">  945</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l00946"></a><span class="lineno">  946</span>&#160;         }</div><div class="line"><a name="l00947"></a><span class="lineno">  947</span>&#160;         igroup[n]= (<span class="keywordtype">unsigned</span> char)c;</div><div class="line"><a name="l00948"></a><span class="lineno">  948</span>&#160;      }</div><div class="line"><a name="l00949"></a><span class="lineno">  949</span>&#160;</div><div class="line"><a name="l00950"></a><span class="lineno">  950</span>&#160;      <span class="keywordflow">if</span> (n&gt; 0) {</div><div class="line"><a name="l00951"></a><span class="lineno">  951</span>&#160;         ogroup[0]= dtable[igroup[0]&gt;&gt;2];</div><div class="line"><a name="l00952"></a><span class="lineno">  952</span>&#160;         ogroup[1]= dtable[((igroup[0]&amp;3)&lt;&lt;4) | (igroup[1]&gt;&gt;4)];</div><div class="line"><a name="l00953"></a><span class="lineno">  953</span>&#160;         ogroup[2]= dtable[((igroup[1]&amp;0xF)&lt;&lt;2) | (igroup[2]&gt;&gt;6)];</div><div class="line"><a name="l00954"></a><span class="lineno">  954</span>&#160;         ogroup[3]= dtable[igroup[2]&amp;0x3F];</div><div class="line"><a name="l00955"></a><span class="lineno">  955</span>&#160;</div><div class="line"><a name="l00956"></a><span class="lineno">  956</span>&#160;         <span class="keywordflow">if</span> (n&lt;3) {</div><div class="line"><a name="l00957"></a><span class="lineno">  957</span>&#160;            ogroup[3]= <span class="charliteral">&#39;=&#39;</span>;</div><div class="line"><a name="l00958"></a><span class="lineno">  958</span>&#160;</div><div class="line"><a name="l00959"></a><span class="lineno">  959</span>&#160;            <span class="keywordflow">if</span> (n&lt;2)</div><div class="line"><a name="l00960"></a><span class="lineno">  960</span>&#160;               ogroup[2]= <span class="charliteral">&#39;=&#39;</span>;</div><div class="line"><a name="l00961"></a><span class="lineno">  961</span>&#160;         }</div><div class="line"><a name="l00962"></a><span class="lineno">  962</span>&#160;</div><div class="line"><a name="l00963"></a><span class="lineno">  963</span>&#160;         <span class="keywordflow">for</span> (i= 0;i&lt;4;i++)</div><div class="line"><a name="l00964"></a><span class="lineno">  964</span>&#160;            <a class="code" href="../../de/dfe/app__minivm_8c.html#af0d420dc6a4cf41d9421d78d8fbf8c2f">b64_ochar</a>(&amp;bio, ogroup[i], so);</div><div class="line"><a name="l00965"></a><span class="lineno">  965</span>&#160;      }</div><div class="line"><a name="l00966"></a><span class="lineno">  966</span>&#160;   }</div><div class="line"><a name="l00967"></a><span class="lineno">  967</span>&#160;</div><div class="line"><a name="l00968"></a><span class="lineno">  968</span>&#160;   <span class="comment">/* Put end of line - line feed */</span></div><div class="line"><a name="l00969"></a><span class="lineno">  969</span>&#160;   <span class="keywordflow">if</span> (fputs(<a class="code" href="../../de/dfe/app__minivm_8c.html#a4e67e9429d48a2ba8f833ee3b1dceb5d">EOL</a>, so) == EOF)</div><div class="line"><a name="l00970"></a><span class="lineno">  970</span>&#160;      <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00971"></a><span class="lineno">  971</span>&#160;</div><div class="line"><a name="l00972"></a><span class="lineno">  972</span>&#160;   fclose(fi);</div><div class="line"><a name="l00973"></a><span class="lineno">  973</span>&#160;</div><div class="line"><a name="l00974"></a><span class="lineno">  974</span>&#160;   <span class="keywordflow">return</span> 1;</div><div class="line"><a name="l00975"></a><span class="lineno">  975</span>&#160;}</div><div class="line"><a name="l00976"></a><span class="lineno">  976</span>&#160;</div><div class="line"><a name="l00977"></a><span class="lineno"><a class="line" href="../../de/dfe/app__minivm_8c.html#aec217dce71a357d4890727f2a1a0a271">  977</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../de/dfe/app__minivm_8c.html#aec217dce71a357d4890727f2a1a0a271">get_date</a>(<span class="keywordtype">char</span> *s, <span class="keywordtype">int</span> <a class="code" href="../../d9/d1e/func__strings_8c.html#af24e73aaf92f3000fda15d285e66df24">len</a>)</div><div class="line"><a name="l00978"></a><span class="lineno">  978</span>&#160;{</div><div class="line"><a name="l00979"></a><span class="lineno">  979</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d5/d84/structast__tm.html">ast_tm</a> tm;</div><div class="line"><a name="l00980"></a><span class="lineno">  980</span>&#160;   <span class="keyword">struct </span>timeval now = <a class="code" href="../../de/df7/time_8h.html#ad3899efb6f0e348556ef69f5b16aa7f7">ast_tvnow</a>();</div><div class="line"><a name="l00981"></a><span class="lineno">  981</span>&#160;</div><div class="line"><a name="l00982"></a><span class="lineno">  982</span>&#160;   <a class="code" href="../../d5/deb/localtime_8h.html#ae9fbda728350a9a5b9c09b29214d718e">ast_localtime</a>(&amp;now, &amp;tm, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div><div class="line"><a name="l00983"></a><span class="lineno">  983</span>&#160;   <span class="keywordflow">return</span> <a class="code" href="../../d5/deb/localtime_8h.html#aa8e63928b14a347bd3973d680b885f93">ast_strftime</a>(s, len, <span class="stringliteral">&quot;%a %b %e %r %Z %Y&quot;</span>, &amp;tm);</div><div class="line"><a name="l00984"></a><span class="lineno">  984</span>&#160;}</div><div class="line"><a name="l00985"></a><span class="lineno">  985</span>&#160;</div><div class="line"><a name="l00986"></a><span class="lineno">  986</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00987"></a><span class="lineno">  987</span>&#160;<span class="comment">/*!\internal</span></div><div class="line"><a name="l00988"></a><span class="lineno">  988</span>&#160;<span class="comment"> * \brief Free user structure - if it&#39;s allocated */</span></div><div class="line"><a name="l00989"></a><span class="lineno"><a class="line" href="../../de/dfe/app__minivm_8c.html#a1c42a258925cbbb46952152ec3785bfd">  989</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../de/dfe/app__minivm_8c.html#a1c42a258925cbbb46952152ec3785bfd">free_user</a>(<span class="keyword">struct</span> <a class="code" href="../../dc/d7b/structminivm__account.html">minivm_account</a> *vmu)</div><div class="line"><a name="l00990"></a><span class="lineno">  990</span>&#160;{</div><div class="line"><a name="l00991"></a><span class="lineno">  991</span>&#160;   <span class="keywordflow">if</span> (vmu-&gt;<a class="code" href="../../dc/d7b/structminivm__account.html#a06c0918fa1a1aac3d386fca59b12327c">chanvars</a>)</div><div class="line"><a name="l00992"></a><span class="lineno">  992</span>&#160;      <a class="code" href="../../d3/de6/include_2asterisk_2config_8h.html#adea5390496e5477192d86f340d512d04">ast_variables_destroy</a>(vmu-&gt;<a class="code" href="../../dc/d7b/structminivm__account.html#a06c0918fa1a1aac3d386fca59b12327c">chanvars</a>);</div><div class="line"><a name="l00993"></a><span class="lineno">  993</span>&#160;   <a class="code" href="../../d8/d8a/astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(vmu);</div><div class="line"><a name="l00994"></a><span class="lineno">  994</span>&#160;}</div><div class="line"><a name="l00995"></a><span class="lineno">  995</span>&#160;</div><div class="line"><a name="l00996"></a><span class="lineno">  996</span>&#160;</div><div class="line"><a name="l00997"></a><span class="lineno">  997</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00998"></a><span class="lineno">  998</span>&#160;<span class="comment">/*!\internal</span></div><div class="line"><a name="l00999"></a><span class="lineno">  999</span>&#160;<span class="comment"> * \brief Prepare for voicemail template by adding channel variables</span></div><div class="line"><a name="l01000"></a><span class="lineno"> 1000</span>&#160;<span class="comment"> * to the channel</span></div><div class="line"><a name="l01001"></a><span class="lineno"> 1001</span>&#160;<span class="comment">*/</span></div><div class="line"><a name="l01002"></a><span class="lineno"><a class="line" href="../../de/dfe/app__minivm_8c.html#a0d31e4343dc402a9d86f380c15d7cb8c"> 1002</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../de/dfe/app__minivm_8c.html#a0d31e4343dc402a9d86f380c15d7cb8c">prep_email_sub_vars</a>(<span class="keyword">struct</span> <a class="code" href="../../df/d3c/structast__channel.html">ast_channel</a> *<a class="code" href="../../d4/d84/structchannel.html">channel</a>, <span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="../../dc/d7b/structminivm__account.html">minivm_account</a> *vmu, <span class="keyword">const</span> <span class="keywordtype">char</span> *cidnum, <span class="keyword">const</span> <span class="keywordtype">char</span> *cidname, <span class="keyword">const</span> <span class="keywordtype">char</span> *dur, <span class="keyword">const</span> <span class="keywordtype">char</span> *date, <span class="keyword">const</span> <span class="keywordtype">char</span> *counter)</div><div class="line"><a name="l01003"></a><span class="lineno"> 1003</span>&#160;{</div><div class="line"><a name="l01004"></a><span class="lineno"> 1004</span>&#160;   <span class="keywordtype">char</span> callerid[256];</div><div class="line"><a name="l01005"></a><span class="lineno"> 1005</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../dd/d02/structast__variable.html">ast_variable</a> *<a class="code" href="../../dc/df2/ast__expr2f_8c.html#a1b0936415a643c88ce543099c10e0d7f">var</a>;</div><div class="line"><a name="l01006"></a><span class="lineno"> 1006</span>&#160;</div><div class="line"><a name="l01007"></a><span class="lineno"> 1007</span>&#160;   <span class="keywordflow">if</span> (!channel) {</div><div class="line"><a name="l01008"></a><span class="lineno"> 1008</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;No allocated channel, giving up...\n&quot;</span>);</div><div class="line"><a name="l01009"></a><span class="lineno"> 1009</span>&#160;      <span class="keywordflow">return</span>;</div><div class="line"><a name="l01010"></a><span class="lineno"> 1010</span>&#160;   }</div><div class="line"><a name="l01011"></a><span class="lineno"> 1011</span>&#160;</div><div class="line"><a name="l01012"></a><span class="lineno"> 1012</span>&#160;   <span class="keywordflow">for</span> (var = vmu-&gt;<a class="code" href="../../dc/d7b/structminivm__account.html#a06c0918fa1a1aac3d386fca59b12327c">chanvars</a> ; var ; var = var-&gt;<a class="code" href="../../dd/d02/structast__variable.html#afaaf66cc5029a563bd0bb9df076ea14b">next</a>) {</div><div class="line"><a name="l01013"></a><span class="lineno"> 1013</span>&#160;      <a class="code" href="../../db/de0/pbx_8h.html#a6e5b90edb84d216267148dddcffe9b9a">pbx_builtin_setvar_helper</a>(channel, var-&gt;<a class="code" href="../../dd/d02/structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, var-&gt;<a class="code" href="../../dd/d02/structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>);</div><div class="line"><a name="l01014"></a><span class="lineno"> 1014</span>&#160;   }</div><div class="line"><a name="l01015"></a><span class="lineno"> 1015</span>&#160;</div><div class="line"><a name="l01016"></a><span class="lineno"> 1016</span>&#160;   <span class="comment">/* Prepare variables for substition in email body and subject */</span></div><div class="line"><a name="l01017"></a><span class="lineno"> 1017</span>&#160;   <a class="code" href="../../db/de0/pbx_8h.html#a6e5b90edb84d216267148dddcffe9b9a">pbx_builtin_setvar_helper</a>(channel, <span class="stringliteral">&quot;MVM_NAME&quot;</span>, vmu-&gt;<a class="code" href="../../dc/d7b/structminivm__account.html#ab5845627664c59054dd8e5f01829d4f3">fullname</a>);</div><div class="line"><a name="l01018"></a><span class="lineno"> 1018</span>&#160;   <a class="code" href="../../db/de0/pbx_8h.html#a6e5b90edb84d216267148dddcffe9b9a">pbx_builtin_setvar_helper</a>(channel, <span class="stringliteral">&quot;MVM_DUR&quot;</span>, dur);</div><div class="line"><a name="l01019"></a><span class="lineno"> 1019</span>&#160;   <a class="code" href="../../db/de0/pbx_8h.html#a6e5b90edb84d216267148dddcffe9b9a">pbx_builtin_setvar_helper</a>(channel, <span class="stringliteral">&quot;MVM_DOMAIN&quot;</span>, vmu-&gt;<a class="code" href="../../dc/d7b/structminivm__account.html#ae43ea5d0335f149f0920d33e46b61c33">domain</a>);</div><div class="line"><a name="l01020"></a><span class="lineno"> 1020</span>&#160;   <a class="code" href="../../db/de0/pbx_8h.html#a6e5b90edb84d216267148dddcffe9b9a">pbx_builtin_setvar_helper</a>(channel, <span class="stringliteral">&quot;MVM_USERNAME&quot;</span>, vmu-&gt;<a class="code" href="../../dc/d7b/structminivm__account.html#a4b30874d24514b5ef6ff5276e8c12ed4">username</a>);</div><div class="line"><a name="l01021"></a><span class="lineno"> 1021</span>&#160;   <a class="code" href="../../db/de0/pbx_8h.html#a6e5b90edb84d216267148dddcffe9b9a">pbx_builtin_setvar_helper</a>(channel, <span class="stringliteral">&quot;MVM_CALLERID&quot;</span>, <a class="code" href="../../de/d47/callerid_8h.html#a1c25633b1ed63682c95ec613d7cbe559">ast_callerid_merge</a>(callerid, <span class="keyword">sizeof</span>(callerid), cidname, cidnum, <span class="stringliteral">&quot;Unknown Caller&quot;</span>));</div><div class="line"><a name="l01022"></a><span class="lineno"> 1022</span>&#160;   <a class="code" href="../../db/de0/pbx_8h.html#a6e5b90edb84d216267148dddcffe9b9a">pbx_builtin_setvar_helper</a>(channel, <span class="stringliteral">&quot;MVM_CIDNAME&quot;</span>, (cidname ? cidname : <span class="stringliteral">&quot;an unknown caller&quot;</span>));</div><div class="line"><a name="l01023"></a><span class="lineno"> 1023</span>&#160;   <a class="code" href="../../db/de0/pbx_8h.html#a6e5b90edb84d216267148dddcffe9b9a">pbx_builtin_setvar_helper</a>(channel, <span class="stringliteral">&quot;MVM_CIDNUM&quot;</span>, (cidnum ? cidnum : <span class="stringliteral">&quot;an unknown caller&quot;</span>));</div><div class="line"><a name="l01024"></a><span class="lineno"> 1024</span>&#160;   <a class="code" href="../../db/de0/pbx_8h.html#a6e5b90edb84d216267148dddcffe9b9a">pbx_builtin_setvar_helper</a>(channel, <span class="stringliteral">&quot;MVM_DATE&quot;</span>, date);</div><div class="line"><a name="l01025"></a><span class="lineno"> 1025</span>&#160;   <span class="keywordflow">if</span> (!<a class="code" href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a>(counter))</div><div class="line"><a name="l01026"></a><span class="lineno"> 1026</span>&#160;      <a class="code" href="../../db/de0/pbx_8h.html#a6e5b90edb84d216267148dddcffe9b9a">pbx_builtin_setvar_helper</a>(channel, <span class="stringliteral">&quot;MVM_COUNTER&quot;</span>, counter);</div><div class="line"><a name="l01027"></a><span class="lineno"> 1027</span>&#160;}</div><div class="line"><a name="l01028"></a><span class="lineno"> 1028</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01029"></a><span class="lineno"> 1029</span>&#160;<span class="comment">/*!\internal</span></div><div class="line"><a name="l01030"></a><span class="lineno"> 1030</span>&#160;<span class="comment"> * \brief Set default values for Mini-Voicemail users */</span></div><div class="line"><a name="l01031"></a><span class="lineno"><a class="line" href="../../de/dfe/app__minivm_8c.html#a2a7aec9f0ee827ff0e3863d6bb2fe277"> 1031</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../de/dfe/app__minivm_8c.html#a2a7aec9f0ee827ff0e3863d6bb2fe277">populate_defaults</a>(<span class="keyword">struct</span> <a class="code" href="../../dc/d7b/structminivm__account.html">minivm_account</a> *vmu)</div><div class="line"><a name="l01032"></a><span class="lineno"> 1032</span>&#160;{</div><div class="line"><a name="l01033"></a><span class="lineno"> 1033</span>&#160;   <a class="code" href="../../d5/d60/utils_8h.html#ab9da1c7265610eff83ed6146f104dc6f">ast_copy_flags</a>(vmu, (&amp;globalflags), <a class="code" href="../../d5/d60/utils_8h.html#afb8683b4d96960d7a82a86a974a57599">AST_FLAGS_ALL</a>);</div><div class="line"><a name="l01034"></a><span class="lineno"> 1034</span>&#160;   <a class="code" href="../../d6/d90/strings_8h.html#ac4040268f7b6ed77dfc49c7767626369">ast_copy_string</a>(vmu-&gt;<a class="code" href="../../dc/d7b/structminivm__account.html#ae80eeef848853cf42dc025b36f0de488">attachfmt</a>, default_vmformat, <span class="keyword">sizeof</span>(vmu-&gt;<a class="code" href="../../dc/d7b/structminivm__account.html#ae80eeef848853cf42dc025b36f0de488">attachfmt</a>));</div><div class="line"><a name="l01035"></a><span class="lineno"> 1035</span>&#160;   vmu-&gt;<a class="code" href="../../dc/d7b/structminivm__account.html#a97d0f923218857a92e83d94dcbfe0263">volgain</a> = <a class="code" href="../../de/dfe/app__minivm_8c.html#ab341e61c475ac36a8896ce244ac1d691">global_volgain</a>;</div><div class="line"><a name="l01036"></a><span class="lineno"> 1036</span>&#160;}</div><div class="line"><a name="l01037"></a><span class="lineno"> 1037</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01038"></a><span class="lineno"> 1038</span>&#160;<span class="comment">/*!\internal</span></div><div class="line"><a name="l01039"></a><span class="lineno"> 1039</span>&#160;<span class="comment"> * \brief Allocate new vm user and set default values */</span></div><div class="line"><a name="l01040"></a><span class="lineno"><a class="line" href="../../de/dfe/app__minivm_8c.html#aa7d6976536ff844492de44d3c0099622"> 1040</a></span>&#160;<span class="keyword">static</span> <span class="keyword">struct </span><a class="code" href="../../dc/d7b/structminivm__account.html">minivm_account</a> *<a class="code" href="../../de/dfe/app__minivm_8c.html#aa7d6976536ff844492de44d3c0099622">mvm_user_alloc</a>(<span class="keywordtype">void</span>)</div><div class="line"><a name="l01041"></a><span class="lineno"> 1041</span>&#160;{</div><div class="line"><a name="l01042"></a><span class="lineno"> 1042</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../dc/d7b/structminivm__account.html">minivm_account</a> *<span class="keyword">new</span>;</div><div class="line"><a name="l01043"></a><span class="lineno"> 1043</span>&#160;</div><div class="line"><a name="l01044"></a><span class="lineno"> 1044</span>&#160;   <span class="keyword">new</span> = <a class="code" href="../../d8/d8a/astmm_8h.html#ae0cd4c5524b01287ab19cbe233d9cebb">ast_calloc</a>(1, <span class="keyword">sizeof</span>(*<span class="keyword">new</span>));</div><div class="line"><a name="l01045"></a><span class="lineno"> 1045</span>&#160;   <span class="keywordflow">if</span> (!<span class="keyword">new</span>)</div><div class="line"><a name="l01046"></a><span class="lineno"> 1046</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l01047"></a><span class="lineno"> 1047</span>&#160;   <a class="code" href="../../de/dfe/app__minivm_8c.html#a2a7aec9f0ee827ff0e3863d6bb2fe277">populate_defaults</a>(<span class="keyword">new</span>);</div><div class="line"><a name="l01048"></a><span class="lineno"> 1048</span>&#160;</div><div class="line"><a name="l01049"></a><span class="lineno"> 1049</span>&#160;   <span class="keywordflow">return</span> <span class="keyword">new</span>;</div><div class="line"><a name="l01050"></a><span class="lineno"> 1050</span>&#160;}</div><div class="line"><a name="l01051"></a><span class="lineno"> 1051</span>&#160;</div><div class="line"><a name="l01052"></a><span class="lineno"> 1052</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01053"></a><span class="lineno"> 1053</span>&#160;<span class="comment">/*!\internal</span></div><div class="line"><a name="l01054"></a><span class="lineno"> 1054</span>&#160;<span class="comment"> * \brief Clear list of users */</span></div><div class="line"><a name="l01055"></a><span class="lineno"><a class="line" href="../../de/dfe/app__minivm_8c.html#a967b9e2acf79f774a1649eb1630c89a5"> 1055</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../de/dfe/app__minivm_8c.html#a967b9e2acf79f774a1649eb1630c89a5">vmaccounts_destroy_list</a>(<span class="keywordtype">void</span>)</div><div class="line"><a name="l01056"></a><span class="lineno"> 1056</span>&#160;{</div><div class="line"><a name="l01057"></a><span class="lineno"> 1057</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../dc/d7b/structminivm__account.html">minivm_account</a> *<span class="keyword">this</span>;</div><div class="line"><a name="l01058"></a><span class="lineno"> 1058</span>&#160;   <a class="code" href="../../df/d90/linkedlists_8h.html#a9140a4e4d781264fa9469c52b1adae40">AST_LIST_LOCK</a>(&amp;<a class="code" href="../../d2/d1d/structminivm__accounts.html">minivm_accounts</a>);</div><div class="line"><a name="l01059"></a><span class="lineno"> 1059</span>&#160;   <span class="keywordflow">while</span> ((<span class="keyword">this</span> = <a class="code" href="../../df/d90/linkedlists_8h.html#aadfe2a69fbba4f27c201266a2ca5f989">AST_LIST_REMOVE_HEAD</a>(&amp;<a class="code" href="../../d2/d1d/structminivm__accounts.html">minivm_accounts</a>, <a class="code" href="../../dc/d7b/structminivm__account.html#a571e7afb397f412b54fd1f776dab778f">list</a>)))</div><div class="line"><a name="l01060"></a><span class="lineno"> 1060</span>&#160;      <a class="code" href="../../d8/d8a/astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(<span class="keyword">this</span>);</div><div class="line"><a name="l01061"></a><span class="lineno"> 1061</span>&#160;   <a class="code" href="../../df/d90/linkedlists_8h.html#ab48cb9e1e612dd486b747ba1c5d68d01">AST_LIST_UNLOCK</a>(&amp;<a class="code" href="../../d2/d1d/structminivm__accounts.html">minivm_accounts</a>);</div><div class="line"><a name="l01062"></a><span class="lineno"> 1062</span>&#160;}</div><div class="line"><a name="l01063"></a><span class="lineno"> 1063</span>&#160;</div><div class="line"><a name="l01064"></a><span class="lineno"> 1064</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01065"></a><span class="lineno"> 1065</span>&#160;<span class="comment">/*!\internal</span></div><div class="line"><a name="l01066"></a><span class="lineno"> 1066</span>&#160;<span class="comment"> * \brief Find user from static memory object list */</span></div><div class="line"><a name="l01067"></a><span class="lineno"><a class="line" href="../../de/dfe/app__minivm_8c.html#ac26055cad7a69cbfb6692d273f025a40"> 1067</a></span>&#160;<span class="keyword">static</span> <span class="keyword">struct </span><a class="code" href="../../dc/d7b/structminivm__account.html">minivm_account</a> *<a class="code" href="../../de/dfe/app__minivm_8c.html#ac26055cad7a69cbfb6692d273f025a40">find_account</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="../../dd/dac/structdomain.html">domain</a>, <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="../../dc/d7b/structminivm__account.html#a4b30874d24514b5ef6ff5276e8c12ed4">username</a>, <span class="keywordtype">int</span> createtemp)</div><div class="line"><a name="l01068"></a><span class="lineno"> 1068</span>&#160;{</div><div class="line"><a name="l01069"></a><span class="lineno"> 1069</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../dc/d7b/structminivm__account.html">minivm_account</a> *vmu = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, *cur;</div><div class="line"><a name="l01070"></a><span class="lineno"> 1070</span>&#160;</div><div class="line"><a name="l01071"></a><span class="lineno"> 1071</span>&#160;</div><div class="line"><a name="l01072"></a><span class="lineno"> 1072</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a>(domain) || <a class="code" href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a>(username)) {</div><div class="line"><a name="l01073"></a><span class="lineno"> 1073</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#ad89ee324d180cdcd7defcc709ff9ca42">LOG_NOTICE</a>, <span class="stringliteral">&quot;No username or domain? \n&quot;</span>);</div><div class="line"><a name="l01074"></a><span class="lineno"> 1074</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l01075"></a><span class="lineno"> 1075</span>&#160;   }</div><div class="line"><a name="l01076"></a><span class="lineno"> 1076</span>&#160;   <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(3, <span class="stringliteral">&quot;Looking for voicemail user %s in domain %s\n&quot;</span>, username, domain);</div><div class="line"><a name="l01077"></a><span class="lineno"> 1077</span>&#160;</div><div class="line"><a name="l01078"></a><span class="lineno"> 1078</span>&#160;   <a class="code" href="../../df/d90/linkedlists_8h.html#a9140a4e4d781264fa9469c52b1adae40">AST_LIST_LOCK</a>(&amp;<a class="code" href="../../d2/d1d/structminivm__accounts.html">minivm_accounts</a>);</div><div class="line"><a name="l01079"></a><span class="lineno"> 1079</span>&#160;   <a class="code" href="../../df/d90/linkedlists_8h.html#a3008b2f4f236b72d8bcfb80e346324ef">AST_LIST_TRAVERSE</a>(&amp;<a class="code" href="../../d2/d1d/structminivm__accounts.html">minivm_accounts</a>, cur, <a class="code" href="../../dc/d7b/structminivm__account.html#a571e7afb397f412b54fd1f776dab778f">list</a>) {</div><div class="line"><a name="l01080"></a><span class="lineno"> 1080</span>&#160;      <span class="comment">/* Is this the voicemail account we&#39;re looking for? */</span></div><div class="line"><a name="l01081"></a><span class="lineno"> 1081</span>&#160;      <span class="keywordflow">if</span> (!strcasecmp(domain, cur-&gt;domain) &amp;&amp; !strcasecmp(username, cur-&gt;username))</div><div class="line"><a name="l01082"></a><span class="lineno"> 1082</span>&#160;         <span class="keywordflow">break</span>;</div><div class="line"><a name="l01083"></a><span class="lineno"> 1083</span>&#160;   }</div><div class="line"><a name="l01084"></a><span class="lineno"> 1084</span>&#160;   <a class="code" href="../../df/d90/linkedlists_8h.html#ab48cb9e1e612dd486b747ba1c5d68d01">AST_LIST_UNLOCK</a>(&amp;<a class="code" href="../../d2/d1d/structminivm__accounts.html">minivm_accounts</a>);</div><div class="line"><a name="l01085"></a><span class="lineno"> 1085</span>&#160;</div><div class="line"><a name="l01086"></a><span class="lineno"> 1086</span>&#160;   <span class="keywordflow">if</span> (cur) {</div><div class="line"><a name="l01087"></a><span class="lineno"> 1087</span>&#160;      <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(3, <span class="stringliteral">&quot;Found account for %s@%s\n&quot;</span>, username, domain);</div><div class="line"><a name="l01088"></a><span class="lineno"> 1088</span>&#160;      vmu = cur;</div><div class="line"><a name="l01089"></a><span class="lineno"> 1089</span>&#160;</div><div class="line"><a name="l01090"></a><span class="lineno"> 1090</span>&#160;   } <span class="keywordflow">else</span></div><div class="line"><a name="l01091"></a><span class="lineno"> 1091</span>&#160;      vmu = <a class="code" href="../../de/dfe/app__minivm_8c.html#af80b2bf6748bd7206069ff08addb3bb2">find_user_realtime</a>(domain, username);</div><div class="line"><a name="l01092"></a><span class="lineno"> 1092</span>&#160;</div><div class="line"><a name="l01093"></a><span class="lineno"> 1093</span>&#160;   <span class="keywordflow">if</span> (createtemp &amp;&amp; !vmu) {</div><div class="line"><a name="l01094"></a><span class="lineno"> 1094</span>&#160;      <span class="comment">/* Create a temporary user, send e-mail and be gone */</span></div><div class="line"><a name="l01095"></a><span class="lineno"> 1095</span>&#160;      vmu = <a class="code" href="../../de/dfe/app__minivm_8c.html#aa7d6976536ff844492de44d3c0099622">mvm_user_alloc</a>();</div><div class="line"><a name="l01096"></a><span class="lineno"> 1096</span>&#160;      <a class="code" href="../../d5/d60/utils_8h.html#a67b6713ff86cf82aaed821e9a87d1c21">ast_set2_flag</a>(vmu, <a class="code" href="../../de/dfe/app__minivm_8c.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>, <a class="code" href="../../de/dfe/app__minivm_8c.html#ac1976490b5dd7e2dae38667d5d21fe4a">MVM_ALLOCED</a>);</div><div class="line"><a name="l01097"></a><span class="lineno"> 1097</span>&#160;      <span class="keywordflow">if</span> (vmu) {</div><div class="line"><a name="l01098"></a><span class="lineno"> 1098</span>&#160;         <a class="code" href="../../d6/d90/strings_8h.html#ac4040268f7b6ed77dfc49c7767626369">ast_copy_string</a>(vmu-&gt;<a class="code" href="../../dc/d7b/structminivm__account.html#a4b30874d24514b5ef6ff5276e8c12ed4">username</a>, username, <span class="keyword">sizeof</span>(vmu-&gt;<a class="code" href="../../dc/d7b/structminivm__account.html#a4b30874d24514b5ef6ff5276e8c12ed4">username</a>));</div><div class="line"><a name="l01099"></a><span class="lineno"> 1099</span>&#160;         <a class="code" href="../../d6/d90/strings_8h.html#ac4040268f7b6ed77dfc49c7767626369">ast_copy_string</a>(vmu-&gt;<a class="code" href="../../dc/d7b/structminivm__account.html#ae43ea5d0335f149f0920d33e46b61c33">domain</a>, domain, <span class="keyword">sizeof</span>(vmu-&gt;<a class="code" href="../../dc/d7b/structminivm__account.html#ae43ea5d0335f149f0920d33e46b61c33">domain</a>));</div><div class="line"><a name="l01100"></a><span class="lineno"> 1100</span>&#160;         <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(1, <span class="stringliteral">&quot;Created temporary account\n&quot;</span>);</div><div class="line"><a name="l01101"></a><span class="lineno"> 1101</span>&#160;      }</div><div class="line"><a name="l01102"></a><span class="lineno"> 1102</span>&#160;</div><div class="line"><a name="l01103"></a><span class="lineno"> 1103</span>&#160;   }</div><div class="line"><a name="l01104"></a><span class="lineno"> 1104</span>&#160;   <span class="keywordflow">return</span> vmu;</div><div class="line"><a name="l01105"></a><span class="lineno"> 1105</span>&#160;}</div><div class="line"><a name="l01106"></a><span class="lineno"> 1106</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01107"></a><span class="lineno"> 1107</span>&#160;<span class="comment">/*!\internal</span></div><div class="line"><a name="l01108"></a><span class="lineno"> 1108</span>&#160;<span class="comment"> * \brief Find user in realtime storage</span></div><div class="line"><a name="l01109"></a><span class="lineno"> 1109</span>&#160;<span class="comment"> * \return pointer to minivm_account structure</span></div><div class="line"><a name="l01110"></a><span class="lineno"> 1110</span>&#160;<span class="comment">*/</span></div><div class="line"><a name="l01111"></a><span class="lineno"><a class="line" href="../../de/dfe/app__minivm_8c.html#af80b2bf6748bd7206069ff08addb3bb2"> 1111</a></span>&#160;<span class="keyword">static</span> <span class="keyword">struct </span><a class="code" href="../../dc/d7b/structminivm__account.html">minivm_account</a> *<a class="code" href="../../de/dfe/app__minivm_8c.html#af80b2bf6748bd7206069ff08addb3bb2">find_user_realtime</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="../../dd/dac/structdomain.html">domain</a>, <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="../../dc/d7b/structminivm__account.html#a4b30874d24514b5ef6ff5276e8c12ed4">username</a>)</div><div class="line"><a name="l01112"></a><span class="lineno"> 1112</span>&#160;{</div><div class="line"><a name="l01113"></a><span class="lineno"> 1113</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../dd/d02/structast__variable.html">ast_variable</a> *<a class="code" href="../../dc/df2/ast__expr2f_8c.html#a1b0936415a643c88ce543099c10e0d7f">var</a>;</div><div class="line"><a name="l01114"></a><span class="lineno"> 1114</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../dc/d7b/structminivm__account.html">minivm_account</a> *<a class="code" href="../../db/d37/hsearch_8c.html#ad0f0f85b3cab490a81baa02c4b9edf45">retval</a>;</div><div class="line"><a name="l01115"></a><span class="lineno"> 1115</span>&#160;   <span class="keywordtype">char</span> <a class="code" href="../../d0/d29/cdr__mysql_8c.html#a0980a105ccb863d8008eb6201a51da52">name</a>[<a class="code" href="../../d9/d94/network_8h.html#afd80ecbe3170ca4fc85b65cda8659f82">MAXHOSTNAMELEN</a>];</div><div class="line"><a name="l01116"></a><span class="lineno"> 1116</span>&#160;</div><div class="line"><a name="l01117"></a><span class="lineno"> 1117</span>&#160;   retval = <a class="code" href="../../de/dfe/app__minivm_8c.html#aa7d6976536ff844492de44d3c0099622">mvm_user_alloc</a>();</div><div class="line"><a name="l01118"></a><span class="lineno"> 1118</span>&#160;   <span class="keywordflow">if</span> (!retval)</div><div class="line"><a name="l01119"></a><span class="lineno"> 1119</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l01120"></a><span class="lineno"> 1120</span>&#160;</div><div class="line"><a name="l01121"></a><span class="lineno"> 1121</span>&#160;   <span class="keywordflow">if</span> (username)</div><div class="line"><a name="l01122"></a><span class="lineno"> 1122</span>&#160;      <a class="code" href="../../d6/d90/strings_8h.html#ac4040268f7b6ed77dfc49c7767626369">ast_copy_string</a>(retval-&gt;<a class="code" href="../../dc/d7b/structminivm__account.html#a4b30874d24514b5ef6ff5276e8c12ed4">username</a>, username, <span class="keyword">sizeof</span>(retval-&gt;<a class="code" href="../../dc/d7b/structminivm__account.html#a4b30874d24514b5ef6ff5276e8c12ed4">username</a>));</div><div class="line"><a name="l01123"></a><span class="lineno"> 1123</span>&#160;</div><div class="line"><a name="l01124"></a><span class="lineno"> 1124</span>&#160;   <a class="code" href="../../de/dfe/app__minivm_8c.html#a2a7aec9f0ee827ff0e3863d6bb2fe277">populate_defaults</a>(retval);</div><div class="line"><a name="l01125"></a><span class="lineno"> 1125</span>&#160;   var = <a class="code" href="../../d3/de6/include_2asterisk_2config_8h.html#a1a03993603e2bc2463153857836645bb">ast_load_realtime</a>(<span class="stringliteral">&quot;minivm&quot;</span>, <span class="stringliteral">&quot;username&quot;</span>, username, <span class="stringliteral">&quot;domain&quot;</span>, domain, <a class="code" href="../../d4/dd1/compiler_8h.html#af2af475b85aef66019c417d8ded1c435">SENTINEL</a>);</div><div class="line"><a name="l01126"></a><span class="lineno"> 1126</span>&#160;</div><div class="line"><a name="l01127"></a><span class="lineno"> 1127</span>&#160;   <span class="keywordflow">if</span> (!var) {</div><div class="line"><a name="l01128"></a><span class="lineno"> 1128</span>&#160;      <a class="code" href="../../d8/d8a/astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(retval);</div><div class="line"><a name="l01129"></a><span class="lineno"> 1129</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l01130"></a><span class="lineno"> 1130</span>&#160;   }</div><div class="line"><a name="l01131"></a><span class="lineno"> 1131</span>&#160;</div><div class="line"><a name="l01132"></a><span class="lineno"> 1132</span>&#160;   snprintf(name, <span class="keyword">sizeof</span>(name), <span class="stringliteral">&quot;%s@%s&quot;</span>, username, domain);</div><div class="line"><a name="l01133"></a><span class="lineno"> 1133</span>&#160;   <a class="code" href="../../de/dfe/app__minivm_8c.html#a0cb40730dc4102d3171993e6e479a09c">create_vmaccount</a>(name, var, <a class="code" href="../../de/dfe/app__minivm_8c.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>);</div><div class="line"><a name="l01134"></a><span class="lineno"> 1134</span>&#160;</div><div class="line"><a name="l01135"></a><span class="lineno"> 1135</span>&#160;   <a class="code" href="../../d3/de6/include_2asterisk_2config_8h.html#adea5390496e5477192d86f340d512d04">ast_variables_destroy</a>(var);</div><div class="line"><a name="l01136"></a><span class="lineno"> 1136</span>&#160;   <span class="keywordflow">return</span> <a class="code" href="../../db/d37/hsearch_8c.html#ad0f0f85b3cab490a81baa02c4b9edf45">retval</a>;</div><div class="line"><a name="l01137"></a><span class="lineno"> 1137</span>&#160;}</div><div class="line"><a name="l01138"></a><span class="lineno"> 1138</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01139"></a><span class="lineno"> 1139</span>&#160;<span class="comment">/*!\internal</span></div><div class="line"><a name="l01140"></a><span class="lineno"> 1140</span>&#160;<span class="comment"> * \brief Check if the string would need encoding within the MIME standard, to</span></div><div class="line"><a name="l01141"></a><span class="lineno"> 1141</span>&#160;<span class="comment"> * avoid confusing certain mail software that expects messages to be 7-bit</span></div><div class="line"><a name="l01142"></a><span class="lineno"> 1142</span>&#160;<span class="comment"> * clean.</span></div><div class="line"><a name="l01143"></a><span class="lineno"> 1143</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l01144"></a><span class="lineno"><a class="line" href="../../de/dfe/app__minivm_8c.html#a42eb1cc1b531f7e8f240fbe0eb6ad1bb"> 1144</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../de/dfe/app__minivm_8c.html#a42eb1cc1b531f7e8f240fbe0eb6ad1bb">check_mime</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="../../de/dcd/app__jack_8c.html#af25d6dc49269fa2003ac7c7fa6f13915">str</a>)</div><div class="line"><a name="l01145"></a><span class="lineno"> 1145</span>&#160;{</div><div class="line"><a name="l01146"></a><span class="lineno"> 1146</span>&#160;   <span class="keywordflow">for</span> (; *<a class="code" href="../../de/dcd/app__jack_8c.html#af25d6dc49269fa2003ac7c7fa6f13915">str</a>; str++) {</div><div class="line"><a name="l01147"></a><span class="lineno"> 1147</span>&#160;      <span class="keywordflow">if</span> (*str &gt; 126 || *str &lt; 32 || strchr(<span class="stringliteral">&quot;()&lt;&gt;@,:;/\&quot;[]?.=&quot;</span>, *str)) {</div><div class="line"><a name="l01148"></a><span class="lineno"> 1148</span>&#160;         <span class="keywordflow">return</span> 1;</div><div class="line"><a name="l01149"></a><span class="lineno"> 1149</span>&#160;      }</div><div class="line"><a name="l01150"></a><span class="lineno"> 1150</span>&#160;   }</div><div class="line"><a name="l01151"></a><span class="lineno"> 1151</span>&#160;   <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l01152"></a><span class="lineno"> 1152</span>&#160;}</div><div class="line"><a name="l01153"></a><span class="lineno"> 1153</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01154"></a><span class="lineno"> 1154</span>&#160;<span class="comment">/*!\internal</span></div><div class="line"><a name="l01155"></a><span class="lineno"> 1155</span>&#160;<span class="comment"> * \brief Encode a string according to the MIME rules for encoding strings</span></div><div class="line"><a name="l01156"></a><span class="lineno"> 1156</span>&#160;<span class="comment"> * that are not 7-bit clean or contain control characters.</span></div><div class="line"><a name="l01157"></a><span class="lineno"> 1157</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l01158"></a><span class="lineno"> 1158</span>&#160;<span class="comment"> * Additionally, if the encoded string would exceed the MIME limit of 76</span></div><div class="line"><a name="l01159"></a><span class="lineno"> 1159</span>&#160;<span class="comment"> * characters per line, then the encoding will be broken up into multiple</span></div><div class="line"><a name="l01160"></a><span class="lineno"> 1160</span>&#160;<span class="comment"> * sections, separated by a space character, in order to facilitate</span></div><div class="line"><a name="l01161"></a><span class="lineno"> 1161</span>&#160;<span class="comment"> * breaking up the associated header across multiple lines.</span></div><div class="line"><a name="l01162"></a><span class="lineno"> 1162</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l01163"></a><span class="lineno"> 1163</span>&#160;<span class="comment"> * \param end An expandable buffer for holding the result</span></div><div class="line"><a name="l01164"></a><span class="lineno"> 1164</span>&#160;<span class="comment"> * \param maxlen \see ast_str</span></div><div class="line"><a name="l01165"></a><span class="lineno"> 1165</span>&#160;<span class="comment"> * \param charset Character set in which the result should be encoded</span></div><div class="line"><a name="l01166"></a><span class="lineno"> 1166</span>&#160;<span class="comment"> * \param start A string to be encoded</span></div><div class="line"><a name="l01167"></a><span class="lineno"> 1167</span>&#160;<span class="comment"> * \param preamble The length of the first line already used for this string,</span></div><div class="line"><a name="l01168"></a><span class="lineno"> 1168</span>&#160;<span class="comment"> * to ensure that each line maintains a maximum length of 76 chars.</span></div><div class="line"><a name="l01169"></a><span class="lineno"> 1169</span>&#160;<span class="comment"> * \param postamble the length of any additional characters appended to the</span></div><div class="line"><a name="l01170"></a><span class="lineno"> 1170</span>&#160;<span class="comment"> * line, used to ensure proper field wrapping.</span></div><div class="line"><a name="l01171"></a><span class="lineno"> 1171</span>&#160;<span class="comment"> * \return The encoded string.</span></div><div class="line"><a name="l01172"></a><span class="lineno"> 1172</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l01173"></a><span class="lineno"><a class="line" href="../../de/dfe/app__minivm_8c.html#ab0d4d1fc60708f1a0b2bf99c59a610f0"> 1173</a></span>&#160;<span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="../../de/dfe/app__minivm_8c.html#ab0d4d1fc60708f1a0b2bf99c59a610f0">ast_str_encode_mime</a>(<span class="keyword">struct</span> <a class="code" href="../../dd/da2/structast__str.html">ast_str</a> **<a class="code" href="../../dd/d7c/eagi__proxy_8c.html#a8fd806ad19b8f5513a4cf18cbf77532c">end</a>, ssize_t maxlen, <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="../../d1/d6d/chan__unistim_8c.html#a8bd4accafd4e712317ed9a471738a971">charset</a>, <span class="keyword">const</span> <span class="keywordtype">char</span> *start, <span class="keywordtype">size_t</span> preamble, <span class="keywordtype">size_t</span> postamble)</div><div class="line"><a name="l01174"></a><span class="lineno"> 1174</span>&#160;{</div><div class="line"><a name="l01175"></a><span class="lineno"> 1175</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../dd/da2/structast__str.html">ast_str</a> *<a class="code" href="../../de/d1e/bt__open_8c.html#a1cdd2bb1a9a71d3e1120100229315d67">tmp</a> = <a class="code" href="../../d6/d90/strings_8h.html#a7fc844c12b769ccded05e7514036e241">ast_str_alloca</a>(80);</div><div class="line"><a name="l01176"></a><span class="lineno"> 1176</span>&#160;   <span class="keywordtype">int</span> first_section = 1;</div><div class="line"><a name="l01177"></a><span class="lineno"> 1177</span>&#160;</div><div class="line"><a name="l01178"></a><span class="lineno"> 1178</span>&#160;   <a class="code" href="../../d6/d90/strings_8h.html#a8239b9ad10367bfc936e9b60ff7706a8">ast_str_reset</a>(*end);</div><div class="line"><a name="l01179"></a><span class="lineno"> 1179</span>&#160;   <a class="code" href="../../d6/d90/strings_8h.html#aa3341f35cedca29e60bb7f3927204283">ast_str_set</a>(&amp;tmp, -1, <span class="stringliteral">&quot;=?%s?Q?&quot;</span>, charset);</div><div class="line"><a name="l01180"></a><span class="lineno"> 1180</span>&#160;   <span class="keywordflow">for</span> (; *start; start++) {</div><div class="line"><a name="l01181"></a><span class="lineno"> 1181</span>&#160;      <span class="keywordtype">int</span> need_encoding = 0;</div><div class="line"><a name="l01182"></a><span class="lineno"> 1182</span>&#160;      <span class="keywordflow">if</span> (*start &lt; 33 || *start &gt; 126 || strchr(<span class="stringliteral">&quot;()&lt;&gt;@,:;/\&quot;[]?.=_&quot;</span>, *start)) {</div><div class="line"><a name="l01183"></a><span class="lineno"> 1183</span>&#160;         need_encoding = 1;</div><div class="line"><a name="l01184"></a><span class="lineno"> 1184</span>&#160;      }</div><div class="line"><a name="l01185"></a><span class="lineno"> 1185</span>&#160;      <span class="keywordflow">if</span> ((first_section &amp;&amp; need_encoding &amp;&amp; preamble + <a class="code" href="../../d6/d90/strings_8h.html#aabc005bd1c7e249e8f8659d57d4500b6">ast_str_strlen</a>(tmp) &gt; 70) ||</div><div class="line"><a name="l01186"></a><span class="lineno"> 1186</span>&#160;         (first_section &amp;&amp; !need_encoding &amp;&amp; preamble + <a class="code" href="../../d6/d90/strings_8h.html#aabc005bd1c7e249e8f8659d57d4500b6">ast_str_strlen</a>(tmp) &gt; 72) ||</div><div class="line"><a name="l01187"></a><span class="lineno"> 1187</span>&#160;         (!first_section &amp;&amp; need_encoding &amp;&amp; <a class="code" href="../../d6/d90/strings_8h.html#aabc005bd1c7e249e8f8659d57d4500b6">ast_str_strlen</a>(tmp) &gt; 70) ||</div><div class="line"><a name="l01188"></a><span class="lineno"> 1188</span>&#160;         (!first_section &amp;&amp; !need_encoding &amp;&amp; <a class="code" href="../../d6/d90/strings_8h.html#aabc005bd1c7e249e8f8659d57d4500b6">ast_str_strlen</a>(tmp) &gt; 72)) {</div><div class="line"><a name="l01189"></a><span class="lineno"> 1189</span>&#160;         <span class="comment">/* Start new line */</span></div><div class="line"><a name="l01190"></a><span class="lineno"> 1190</span>&#160;         <a class="code" href="../../d6/d90/strings_8h.html#a1088afdd862a49b0fce34ebe02df8ca1">ast_str_append</a>(end, maxlen, <span class="stringliteral">&quot;%s%s?=&quot;</span>, first_section ? <span class="stringliteral">&quot;&quot;</span> : <span class="stringliteral">&quot; &quot;</span>, <a class="code" href="../../d6/d90/strings_8h.html#a1ef7e2644ca7258070db316fdc0a465b">ast_str_buffer</a>(tmp));</div><div class="line"><a name="l01191"></a><span class="lineno"> 1191</span>&#160;         <a class="code" href="../../d6/d90/strings_8h.html#aa3341f35cedca29e60bb7f3927204283">ast_str_set</a>(&amp;tmp, -1, <span class="stringliteral">&quot;=?%s?Q?&quot;</span>, charset);</div><div class="line"><a name="l01192"></a><span class="lineno"> 1192</span>&#160;         first_section = 0;</div><div class="line"><a name="l01193"></a><span class="lineno"> 1193</span>&#160;      }</div><div class="line"><a name="l01194"></a><span class="lineno"> 1194</span>&#160;      <span class="keywordflow">if</span> (need_encoding &amp;&amp; *start == <span class="charliteral">&#39; &#39;</span>) {</div><div class="line"><a name="l01195"></a><span class="lineno"> 1195</span>&#160;         <a class="code" href="../../d6/d90/strings_8h.html#a1088afdd862a49b0fce34ebe02df8ca1">ast_str_append</a>(&amp;tmp, -1, <span class="stringliteral">&quot;_&quot;</span>);</div><div class="line"><a name="l01196"></a><span class="lineno"> 1196</span>&#160;      } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (need_encoding) {</div><div class="line"><a name="l01197"></a><span class="lineno"> 1197</span>&#160;         <a class="code" href="../../d6/d90/strings_8h.html#a1088afdd862a49b0fce34ebe02df8ca1">ast_str_append</a>(&amp;tmp, -1, <span class="stringliteral">&quot;=%hhX&quot;</span>, *start);</div><div class="line"><a name="l01198"></a><span class="lineno"> 1198</span>&#160;      } <span class="keywordflow">else</span> {</div><div class="line"><a name="l01199"></a><span class="lineno"> 1199</span>&#160;         <a class="code" href="../../d6/d90/strings_8h.html#a1088afdd862a49b0fce34ebe02df8ca1">ast_str_append</a>(&amp;tmp, -1, <span class="stringliteral">&quot;%c&quot;</span>, *start);</div><div class="line"><a name="l01200"></a><span class="lineno"> 1200</span>&#160;      }</div><div class="line"><a name="l01201"></a><span class="lineno"> 1201</span>&#160;   }</div><div class="line"><a name="l01202"></a><span class="lineno"> 1202</span>&#160;   <a class="code" href="../../d6/d90/strings_8h.html#a1088afdd862a49b0fce34ebe02df8ca1">ast_str_append</a>(end, maxlen, <span class="stringliteral">&quot;%s%s?=%s&quot;</span>, first_section ? <span class="stringliteral">&quot;&quot;</span> : <span class="stringliteral">&quot; &quot;</span>, <a class="code" href="../../d6/d90/strings_8h.html#a1ef7e2644ca7258070db316fdc0a465b">ast_str_buffer</a>(tmp), <a class="code" href="../../d6/d90/strings_8h.html#aabc005bd1c7e249e8f8659d57d4500b6">ast_str_strlen</a>(tmp) + postamble &gt; 74 ? <span class="stringliteral">&quot; &quot;</span> : <span class="stringliteral">&quot;&quot;</span>);</div><div class="line"><a name="l01203"></a><span class="lineno"> 1203</span>&#160;   <span class="keywordflow">return</span> <a class="code" href="../../d6/d90/strings_8h.html#a1ef7e2644ca7258070db316fdc0a465b">ast_str_buffer</a>(*end);</div><div class="line"><a name="l01204"></a><span class="lineno"> 1204</span>&#160;}</div><div class="line"><a name="l01205"></a><span class="lineno"> 1205</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01206"></a><span class="lineno"> 1206</span>&#160;<span class="comment">/*!\internal</span></div><div class="line"><a name="l01207"></a><span class="lineno"> 1207</span>&#160;<span class="comment"> * \brief Wraps a character sequence in double quotes, escaping occurences of quotes within the string.</span></div><div class="line"><a name="l01208"></a><span class="lineno"> 1208</span>&#160;<span class="comment"> * \param from The string to work with.</span></div><div class="line"><a name="l01209"></a><span class="lineno"> 1209</span>&#160;<span class="comment"> * \param buf The destination buffer to write the modified quoted string.</span></div><div class="line"><a name="l01210"></a><span class="lineno"> 1210</span>&#160;<span class="comment"> * \param maxlen Always zero.  \see ast_str</span></div><div class="line"><a name="l01211"></a><span class="lineno"> 1211</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l01212"></a><span class="lineno"> 1212</span>&#160;<span class="comment"> * \return The destination string with quotes wrapped on it (the to field).</span></div><div class="line"><a name="l01213"></a><span class="lineno"> 1213</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l01214"></a><span class="lineno"><a class="line" href="../../de/dfe/app__minivm_8c.html#aa3e1184e10a123c4ed53c5918da34258"> 1214</a></span>&#160;<span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="../../de/dfe/app__minivm_8c.html#aa3e1184e10a123c4ed53c5918da34258">ast_str_quote</a>(<span class="keyword">struct</span> <a class="code" href="../../dd/da2/structast__str.html">ast_str</a> **<a class="code" href="../../dd/d7c/eagi__proxy_8c.html#ac95651d79c608a3148973b5b1fc9e525">buf</a>, ssize_t maxlen, <span class="keyword">const</span> <span class="keywordtype">char</span> *from)</div><div class="line"><a name="l01215"></a><span class="lineno"> 1215</span>&#160;{</div><div class="line"><a name="l01216"></a><span class="lineno"> 1216</span>&#160;   <span class="keyword">const</span> <span class="keywordtype">char</span> *ptr;</div><div class="line"><a name="l01217"></a><span class="lineno"> 1217</span>&#160;</div><div class="line"><a name="l01218"></a><span class="lineno"> 1218</span>&#160;   <span class="comment">/* We&#39;re only ever passing 0 to maxlen, so short output isn&#39;t possible */</span></div><div class="line"><a name="l01219"></a><span class="lineno"> 1219</span>&#160;   <a class="code" href="../../d6/d90/strings_8h.html#aa3341f35cedca29e60bb7f3927204283">ast_str_set</a>(buf, maxlen, <span class="stringliteral">&quot;\&quot;&quot;</span>);</div><div class="line"><a name="l01220"></a><span class="lineno"> 1220</span>&#160;   <span class="keywordflow">for</span> (ptr = from; *ptr; ptr++) {</div><div class="line"><a name="l01221"></a><span class="lineno"> 1221</span>&#160;      <span class="keywordflow">if</span> (*ptr == <span class="charliteral">&#39;&quot;&#39;</span> || *ptr == <span class="charliteral">&#39;\\&#39;</span>) {</div><div class="line"><a name="l01222"></a><span class="lineno"> 1222</span>&#160;         <a class="code" href="../../d6/d90/strings_8h.html#a1088afdd862a49b0fce34ebe02df8ca1">ast_str_append</a>(buf, maxlen, <span class="stringliteral">&quot;\\%c&quot;</span>, *ptr);</div><div class="line"><a name="l01223"></a><span class="lineno"> 1223</span>&#160;      } <span class="keywordflow">else</span> {</div><div class="line"><a name="l01224"></a><span class="lineno"> 1224</span>&#160;         <a class="code" href="../../d6/d90/strings_8h.html#a1088afdd862a49b0fce34ebe02df8ca1">ast_str_append</a>(buf, maxlen, <span class="stringliteral">&quot;%c&quot;</span>, *ptr);</div><div class="line"><a name="l01225"></a><span class="lineno"> 1225</span>&#160;      }</div><div class="line"><a name="l01226"></a><span class="lineno"> 1226</span>&#160;   }</div><div class="line"><a name="l01227"></a><span class="lineno"> 1227</span>&#160;   <a class="code" href="../../d6/d90/strings_8h.html#a1088afdd862a49b0fce34ebe02df8ca1">ast_str_append</a>(buf, maxlen, <span class="stringliteral">&quot;\&quot;&quot;</span>);</div><div class="line"><a name="l01228"></a><span class="lineno"> 1228</span>&#160;</div><div class="line"><a name="l01229"></a><span class="lineno"> 1229</span>&#160;   <span class="keywordflow">return</span> <a class="code" href="../../d6/d90/strings_8h.html#a1ef7e2644ca7258070db316fdc0a465b">ast_str_buffer</a>(*buf);</div><div class="line"><a name="l01230"></a><span class="lineno"> 1230</span>&#160;}</div><div class="line"><a name="l01231"></a><span class="lineno"> 1231</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01232"></a><span class="lineno"> 1232</span>&#160;<span class="comment">/*!\internal</span></div><div class="line"><a name="l01233"></a><span class="lineno"> 1233</span>&#160;<span class="comment"> * \brief Send voicemail with audio file as an attachment */</span></div><div class="line"><a name="l01234"></a><span class="lineno"><a class="line" href="../../de/dfe/app__minivm_8c.html#ac7e81a2c8a348c7369525f63242d6a66"> 1234</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../de/dfe/app__minivm_8c.html#ac7e81a2c8a348c7369525f63242d6a66">sendmail</a>(<span class="keyword">struct</span> <a class="code" href="../../dc/d31/structminivm__template.html">minivm_template</a> *<span class="keyword">template</span>, <span class="keyword">struct</span> <a class="code" href="../../dc/d7b/structminivm__account.html">minivm_account</a> *vmu, <span class="keywordtype">char</span> *cidnum, <span class="keywordtype">char</span> *cidname, <span class="keyword">const</span> <span class="keywordtype">char</span> *filename, <span class="keywordtype">char</span> *<a class="code" href="../../da/d45/chan__alsa_8c.html#a98f5e70e98f6dc48e3c5ba316066d540">format</a>, <span class="keywordtype">int</span> duration, <span class="keywordtype">int</span> attach_user_voicemail, <span class="keyword">enum</span> <a class="code" href="../../de/dfe/app__minivm_8c.html#abcec5c16680dc75cdf051552d6908042">mvm_messagetype</a> <a class="code" href="../../d7/d49/chan__ooh323_8c.html#a4d63fdfe5451ec2248c16a2739190c56">type</a>, <span class="keyword">const</span> <span class="keywordtype">char</span> *counter)</div><div class="line"><a name="l01235"></a><span class="lineno"> 1235</span>&#160;{</div><div class="line"><a name="l01236"></a><span class="lineno"> 1236</span>&#160;   <a class="code" href="../../d5/d60/utils_8h.html#a1604b4d72144dd3d9f7da668e90337e9">RAII_VAR</a>(<span class="keyword">struct</span> <a class="code" href="../../dd/da2/structast__str.html">ast_str</a> *, str1, <a class="code" href="../../d6/d90/strings_8h.html#a9c34c6c6b8daaba24c0406270f3cf697">ast_str_create</a>(16), <a class="code" href="../../d8/d8a/astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>);</div><div class="line"><a name="l01237"></a><span class="lineno"> 1237</span>&#160;   <a class="code" href="../../d5/d60/utils_8h.html#a1604b4d72144dd3d9f7da668e90337e9">RAII_VAR</a>(<span class="keyword">struct</span> <a class="code" href="../../dd/da2/structast__str.html">ast_str</a> *, str2, <a class="code" href="../../d6/d90/strings_8h.html#a9c34c6c6b8daaba24c0406270f3cf697">ast_str_create</a>(16), <a class="code" href="../../d8/d8a/astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>);</div><div class="line"><a name="l01238"></a><span class="lineno"> 1238</span>&#160;   FILE *p = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l01239"></a><span class="lineno"> 1239</span>&#160;   <span class="keywordtype">int</span> pfd;</div><div class="line"><a name="l01240"></a><span class="lineno"> 1240</span>&#160;   <span class="keywordtype">char</span> <a class="code" href="../../dc/d7b/structminivm__account.html#aadd75c09e15efa9061997f033b3f224b">email</a>[256] = <span class="stringliteral">&quot;&quot;</span>;</div><div class="line"><a name="l01241"></a><span class="lineno"> 1241</span>&#160;   <span class="keywordtype">char</span> who[256] = <span class="stringliteral">&quot;&quot;</span>;</div><div class="line"><a name="l01242"></a><span class="lineno"> 1242</span>&#160;   <span class="keywordtype">char</span> date[256];</div><div class="line"><a name="l01243"></a><span class="lineno"> 1243</span>&#160;   <span class="keywordtype">char</span> bound[256];</div><div class="line"><a name="l01244"></a><span class="lineno"> 1244</span>&#160;   <span class="keywordtype">char</span> fname[<a class="code" href="../../db/db2/asterisk_8h.html#ae688d728e1acdfe5988c7db45d6f0166">PATH_MAX</a>];</div><div class="line"><a name="l01245"></a><span class="lineno"> 1245</span>&#160;   <span class="keywordtype">char</span> dur[<a class="code" href="../../db/db2/asterisk_8h.html#ae688d728e1acdfe5988c7db45d6f0166">PATH_MAX</a>];</div><div class="line"><a name="l01246"></a><span class="lineno"> 1246</span>&#160;   <span class="keywordtype">char</span> <a class="code" href="../../de/d1e/bt__open_8c.html#a1cdd2bb1a9a71d3e1120100229315d67">tmp</a>[80] = <span class="stringliteral">&quot;/tmp/astmail-XXXXXX&quot;</span>;</div><div class="line"><a name="l01247"></a><span class="lineno"> 1247</span>&#160;   <span class="keywordtype">char</span> mail_cmd_buffer[<a class="code" href="../../db/db2/asterisk_8h.html#ae688d728e1acdfe5988c7db45d6f0166">PATH_MAX</a>];</div><div class="line"><a name="l01248"></a><span class="lineno"> 1248</span>&#160;   <span class="keywordtype">char</span> sox_gain_tmpdir[<a class="code" href="../../db/db2/asterisk_8h.html#ae688d728e1acdfe5988c7db45d6f0166">PATH_MAX</a>] = <span class="stringliteral">&quot;&quot;</span>; <span class="comment">/* Only used with volgain */</span></div><div class="line"><a name="l01249"></a><span class="lineno"> 1249</span>&#160;   <span class="keywordtype">char</span> *file_to_delete = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, *dir_to_delete = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l01250"></a><span class="lineno"> 1250</span>&#160;   <span class="keyword">struct </span>timeval now;</div><div class="line"><a name="l01251"></a><span class="lineno"> 1251</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d5/d84/structast__tm.html">ast_tm</a> tm;</div><div class="line"><a name="l01252"></a><span class="lineno"> 1252</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d4/d09/structminivm__zone.html">minivm_zone</a> *the_zone = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l01253"></a><span class="lineno"> 1253</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../df/d3c/structast__channel.html">ast_channel</a> *chan = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l01254"></a><span class="lineno"> 1254</span>&#160;   <span class="keywordtype">char</span> *fromaddress;</div><div class="line"><a name="l01255"></a><span class="lineno"> 1255</span>&#160;   <span class="keywordtype">char</span> *fromemail;</div><div class="line"><a name="l01256"></a><span class="lineno"> 1256</span>&#160;   <span class="keywordtype">int</span> res = -1;</div><div class="line"><a name="l01257"></a><span class="lineno"> 1257</span>&#160;</div><div class="line"><a name="l01258"></a><span class="lineno"> 1258</span>&#160;   <span class="keywordflow">if</span> (!str1 || !str2) {</div><div class="line"><a name="l01259"></a><span class="lineno"> 1259</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l01260"></a><span class="lineno"> 1260</span>&#160;   }</div><div class="line"><a name="l01261"></a><span class="lineno"> 1261</span>&#160;</div><div class="line"><a name="l01262"></a><span class="lineno"> 1262</span>&#160;   <span class="keywordflow">if</span> (type == <a class="code" href="../../de/dfe/app__minivm_8c.html#abcec5c16680dc75cdf051552d6908042a0097c80109786c14718655071a22e0e8">MVM_MESSAGE_EMAIL</a>) {</div><div class="line"><a name="l01263"></a><span class="lineno"> 1263</span>&#160;      <span class="keywordflow">if</span> (vmu &amp;&amp; !<a class="code" href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a>(vmu-&gt;<a class="code" href="../../dc/d7b/structminivm__account.html#aadd75c09e15efa9061997f033b3f224b">email</a>)) {</div><div class="line"><a name="l01264"></a><span class="lineno"> 1264</span>&#160;         <a class="code" href="../../d6/d90/strings_8h.html#ac4040268f7b6ed77dfc49c7767626369">ast_copy_string</a>(email, vmu-&gt;<a class="code" href="../../dc/d7b/structminivm__account.html#aadd75c09e15efa9061997f033b3f224b">email</a>, <span class="keyword">sizeof</span>(email));</div><div class="line"><a name="l01265"></a><span class="lineno"> 1265</span>&#160;      } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!<a class="code" href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a>(vmu-&gt;<a class="code" href="../../dc/d7b/structminivm__account.html#a4b30874d24514b5ef6ff5276e8c12ed4">username</a>) &amp;&amp; !<a class="code" href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a>(vmu-&gt;<a class="code" href="../../dc/d7b/structminivm__account.html#ae43ea5d0335f149f0920d33e46b61c33">domain</a>))</div><div class="line"><a name="l01266"></a><span class="lineno"> 1266</span>&#160;         snprintf(email, <span class="keyword">sizeof</span>(email), <span class="stringliteral">&quot;%s@%s&quot;</span>, vmu-&gt;<a class="code" href="../../dc/d7b/structminivm__account.html#a4b30874d24514b5ef6ff5276e8c12ed4">username</a>, vmu-&gt;<a class="code" href="../../dc/d7b/structminivm__account.html#ae43ea5d0335f149f0920d33e46b61c33">domain</a>);</div><div class="line"><a name="l01267"></a><span class="lineno"> 1267</span>&#160;   } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (type == <a class="code" href="../../de/dfe/app__minivm_8c.html#abcec5c16680dc75cdf051552d6908042ae7f36447ba359572f25032860eebaeb4">MVM_MESSAGE_PAGE</a>) {</div><div class="line"><a name="l01268"></a><span class="lineno"> 1268</span>&#160;      <a class="code" href="../../d6/d90/strings_8h.html#ac4040268f7b6ed77dfc49c7767626369">ast_copy_string</a>(email, vmu-&gt;<a class="code" href="../../dc/d7b/structminivm__account.html#a29b9b126bac9cc5f1cc334f140f39e8d">pager</a>, <span class="keyword">sizeof</span>(email));</div><div class="line"><a name="l01269"></a><span class="lineno"> 1269</span>&#160;   }</div><div class="line"><a name="l01270"></a><span class="lineno"> 1270</span>&#160;</div><div class="line"><a name="l01271"></a><span class="lineno"> 1271</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a>(email)) {</div><div class="line"><a name="l01272"></a><span class="lineno"> 1272</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;No address to send message to.\n&quot;</span>);</div><div class="line"><a name="l01273"></a><span class="lineno"> 1273</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l01274"></a><span class="lineno"> 1274</span>&#160;   }</div><div class="line"><a name="l01275"></a><span class="lineno"> 1275</span>&#160;</div><div class="line"><a name="l01276"></a><span class="lineno"> 1276</span>&#160;   <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(3, <span class="stringliteral">&quot;Sending mail to %s@%s - Using template %s\n&quot;</span>, vmu-&gt;<a class="code" href="../../dc/d7b/structminivm__account.html#a4b30874d24514b5ef6ff5276e8c12ed4">username</a>, vmu-&gt;<a class="code" href="../../dc/d7b/structminivm__account.html#ae43ea5d0335f149f0920d33e46b61c33">domain</a>, template-&gt;name);</div><div class="line"><a name="l01277"></a><span class="lineno"> 1277</span>&#160;</div><div class="line"><a name="l01278"></a><span class="lineno"> 1278</span>&#160;   <span class="keywordflow">if</span> (!strcmp(format, <span class="stringliteral">&quot;wav49&quot;</span>))</div><div class="line"><a name="l01279"></a><span class="lineno"> 1279</span>&#160;      format = <span class="stringliteral">&quot;WAV&quot;</span>;</div><div class="line"><a name="l01280"></a><span class="lineno"> 1280</span>&#160;</div><div class="line"><a name="l01281"></a><span class="lineno"> 1281</span>&#160;   <span class="comment">/* If we have a gain option, process it now with sox */</span></div><div class="line"><a name="l01282"></a><span class="lineno"> 1282</span>&#160;   <span class="keywordflow">if</span> (type == <a class="code" href="../../de/dfe/app__minivm_8c.html#abcec5c16680dc75cdf051552d6908042a0097c80109786c14718655071a22e0e8">MVM_MESSAGE_EMAIL</a> &amp;&amp; (vmu-&gt;<a class="code" href="../../dc/d7b/structminivm__account.html#a97d0f923218857a92e83d94dcbfe0263">volgain</a> &lt; -.001 || vmu-&gt;<a class="code" href="../../dc/d7b/structminivm__account.html#a97d0f923218857a92e83d94dcbfe0263">volgain</a> &gt; .001) ) {</div><div class="line"><a name="l01283"></a><span class="lineno"> 1283</span>&#160;      <span class="keywordtype">char</span> sox_gain_cmd[<a class="code" href="../../db/db2/asterisk_8h.html#ae688d728e1acdfe5988c7db45d6f0166">PATH_MAX</a>];</div><div class="line"><a name="l01284"></a><span class="lineno"> 1284</span>&#160;</div><div class="line"><a name="l01285"></a><span class="lineno"> 1285</span>&#160;      <a class="code" href="../../d6/d90/strings_8h.html#ac4040268f7b6ed77dfc49c7767626369">ast_copy_string</a>(sox_gain_tmpdir, <span class="stringliteral">&quot;/tmp/minivm-gain-XXXXXX&quot;</span>, <span class="keyword">sizeof</span>(sox_gain_tmpdir));</div><div class="line"><a name="l01286"></a><span class="lineno"> 1286</span>&#160;      <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(3, <span class="stringliteral">&quot;sox_gain_tmpdir: %s\n&quot;</span>, sox_gain_tmpdir);</div><div class="line"><a name="l01287"></a><span class="lineno"> 1287</span>&#160;      <span class="keywordflow">if</span> (!<a class="code" href="../../de/da3/include_2asterisk_2compat_8h.html#a09c40bd781f93eb20cdd2eedf34eadeb">mkdtemp</a>(sox_gain_tmpdir)) {</div><div class="line"><a name="l01288"></a><span class="lineno"> 1288</span>&#160;         <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Failed to create temporary directory for volgain: %d\n&quot;</span>, <a class="code" href="../../d1/d6e/main_2stdtime_2private_8h.html#ad65a8842cc674e3ddf69355898c0ecbf">errno</a>);</div><div class="line"><a name="l01289"></a><span class="lineno"> 1289</span>&#160;         <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l01290"></a><span class="lineno"> 1290</span>&#160;      }</div><div class="line"><a name="l01291"></a><span class="lineno"> 1291</span>&#160;      snprintf(fname, <span class="keyword">sizeof</span>(fname), <span class="stringliteral">&quot;%s/output.%s&quot;</span>, sox_gain_tmpdir, format);</div><div class="line"><a name="l01292"></a><span class="lineno"> 1292</span>&#160;      snprintf(sox_gain_cmd, <span class="keyword">sizeof</span>(sox_gain_cmd), <span class="stringliteral">&quot;sox -v %.4f %s.%s %s&quot;</span>, vmu-&gt;<a class="code" href="../../dc/d7b/structminivm__account.html#a97d0f923218857a92e83d94dcbfe0263">volgain</a>, filename, format, fname);</div><div class="line"><a name="l01293"></a><span class="lineno"> 1293</span>&#160;      <a class="code" href="../../d3/d93/include_2asterisk_2app_8h.html#a9fb5cf0385848033ee3e98625e5f9784">ast_safe_system</a>(sox_gain_cmd);</div><div class="line"><a name="l01294"></a><span class="lineno"> 1294</span>&#160;      <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(3, <span class="stringliteral">&quot;VOLGAIN: Stored at: %s.%s - Level: %.4f - Mailbox: %s\n&quot;</span>, filename, format, vmu-&gt;<a class="code" href="../../dc/d7b/structminivm__account.html#a97d0f923218857a92e83d94dcbfe0263">volgain</a>, vmu-&gt;<a class="code" href="../../dc/d7b/structminivm__account.html#a4b30874d24514b5ef6ff5276e8c12ed4">username</a>);</div><div class="line"><a name="l01295"></a><span class="lineno"> 1295</span>&#160;</div><div class="line"><a name="l01296"></a><span class="lineno"> 1296</span>&#160;      <span class="comment">/* Mark some things for deletion */</span></div><div class="line"><a name="l01297"></a><span class="lineno"> 1297</span>&#160;      file_to_delete = fname;</div><div class="line"><a name="l01298"></a><span class="lineno"> 1298</span>&#160;      dir_to_delete = sox_gain_tmpdir;</div><div class="line"><a name="l01299"></a><span class="lineno"> 1299</span>&#160;   } <span class="keywordflow">else</span> {</div><div class="line"><a name="l01300"></a><span class="lineno"> 1300</span>&#160;      snprintf(fname, <span class="keyword">sizeof</span>(fname), <span class="stringliteral">&quot;%s.%s&quot;</span>, filename, format);</div><div class="line"><a name="l01301"></a><span class="lineno"> 1301</span>&#160;   }</div><div class="line"><a name="l01302"></a><span class="lineno"> 1302</span>&#160;</div><div class="line"><a name="l01303"></a><span class="lineno"> 1303</span>&#160;   <span class="keywordflow">if</span> (template-&gt;attachment)</div><div class="line"><a name="l01304"></a><span class="lineno"> 1304</span>&#160;      <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(1, <span class="stringliteral">&quot;Attaching file &#39;%s&#39;, format &#39;%s&#39;, uservm is &#39;%d&#39;\n&quot;</span>, fname, format, attach_user_voicemail);</div><div class="line"><a name="l01305"></a><span class="lineno"> 1305</span>&#160;</div><div class="line"><a name="l01306"></a><span class="lineno"> 1306</span>&#160;   <span class="comment">/* Make a temporary file instead of piping directly to sendmail, in case the mail</span></div><div class="line"><a name="l01307"></a><span class="lineno"> 1307</span>&#160;<span class="comment">      command hangs */</span></div><div class="line"><a name="l01308"></a><span class="lineno"> 1308</span>&#160;   pfd = mkstemp(tmp);</div><div class="line"><a name="l01309"></a><span class="lineno"> 1309</span>&#160;   <span class="keywordflow">if</span> (pfd &gt; -1) {</div><div class="line"><a name="l01310"></a><span class="lineno"> 1310</span>&#160;      p = fdopen(pfd, <span class="stringliteral">&quot;w&quot;</span>);</div><div class="line"><a name="l01311"></a><span class="lineno"> 1311</span>&#160;      <span class="keywordflow">if</span> (!p) {</div><div class="line"><a name="l01312"></a><span class="lineno"> 1312</span>&#160;         close(pfd);</div><div class="line"><a name="l01313"></a><span class="lineno"> 1313</span>&#160;         pfd = -1;</div><div class="line"><a name="l01314"></a><span class="lineno"> 1314</span>&#160;      }</div><div class="line"><a name="l01315"></a><span class="lineno"> 1315</span>&#160;      <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(1, <span class="stringliteral">&quot;Opening temp file for e-mail: %s\n&quot;</span>, tmp);</div><div class="line"><a name="l01316"></a><span class="lineno"> 1316</span>&#160;   }</div><div class="line"><a name="l01317"></a><span class="lineno"> 1317</span>&#160;   <span class="keywordflow">if</span> (!p) {</div><div class="line"><a name="l01318"></a><span class="lineno"> 1318</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Unable to open temporary file &#39;%s&#39;\n&quot;</span>, tmp);</div><div class="line"><a name="l01319"></a><span class="lineno"> 1319</span>&#160;      <span class="keywordflow">goto</span> <a class="code" href="../../d6/d47/utils_2frame_8c.html#a48bc11919b2752df9d14ce89557cfb25">out</a>;</div><div class="line"><a name="l01320"></a><span class="lineno"> 1320</span>&#160;   }</div><div class="line"><a name="l01321"></a><span class="lineno"> 1321</span>&#160;   <span class="comment">/* Allocate channel used for chanvar substitution */</span></div><div class="line"><a name="l01322"></a><span class="lineno"> 1322</span>&#160;   chan = <a class="code" href="../../d5/d7b/channel_8h.html#acc0ae2c008f4157736ef290e9ca62572">ast_dummy_channel_alloc</a>();</div><div class="line"><a name="l01323"></a><span class="lineno"> 1323</span>&#160;   <span class="keywordflow">if</span> (!chan) {</div><div class="line"><a name="l01324"></a><span class="lineno"> 1324</span>&#160;      <span class="keywordflow">goto</span> <a class="code" href="../../d6/d47/utils_2frame_8c.html#a48bc11919b2752df9d14ce89557cfb25">out</a>;</div><div class="line"><a name="l01325"></a><span class="lineno"> 1325</span>&#160;   }</div><div class="line"><a name="l01326"></a><span class="lineno"> 1326</span>&#160;</div><div class="line"><a name="l01327"></a><span class="lineno"> 1327</span>&#160;   snprintf(dur, <span class="keyword">sizeof</span>(dur), <span class="stringliteral">&quot;%d:%02d&quot;</span>, duration / 60, duration % 60);</div><div class="line"><a name="l01328"></a><span class="lineno"> 1328</span>&#160;</div><div class="line"><a name="l01329"></a><span class="lineno"> 1329</span>&#160;   <span class="comment">/* Does this user have a timezone specified? */</span></div><div class="line"><a name="l01330"></a><span class="lineno"> 1330</span>&#160;   <span class="keywordflow">if</span> (!<a class="code" href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a>(vmu-&gt;<a class="code" href="../../dc/d7b/structminivm__account.html#a4a081db7653645ce9fce8fd72e5a7bf1">zonetag</a>)) {</div><div class="line"><a name="l01331"></a><span class="lineno"> 1331</span>&#160;      <span class="comment">/* Find the zone in the list */</span></div><div class="line"><a name="l01332"></a><span class="lineno"> 1332</span>&#160;      <span class="keyword">struct </span><a class="code" href="../../d4/d09/structminivm__zone.html">minivm_zone</a> *z;</div><div class="line"><a name="l01333"></a><span class="lineno"> 1333</span>&#160;      <a class="code" href="../../df/d90/linkedlists_8h.html#a9140a4e4d781264fa9469c52b1adae40">AST_LIST_LOCK</a>(&amp;<a class="code" href="../../db/dce/structminivm__zones.html">minivm_zones</a>);</div><div class="line"><a name="l01334"></a><span class="lineno"> 1334</span>&#160;      <a class="code" href="../../df/d90/linkedlists_8h.html#a3008b2f4f236b72d8bcfb80e346324ef">AST_LIST_TRAVERSE</a>(&amp;<a class="code" href="../../db/dce/structminivm__zones.html">minivm_zones</a>, z, <a class="code" href="../../dc/d7b/structminivm__account.html#a571e7afb397f412b54fd1f776dab778f">list</a>) {</div><div class="line"><a name="l01335"></a><span class="lineno"> 1335</span>&#160;         <span class="keywordflow">if</span> (strcmp(z-&gt;<a class="code" href="../../d4/d09/structminivm__zone.html#a3777dbae63a15da001b2baa317a25149">name</a>, vmu-&gt;<a class="code" href="../../dc/d7b/structminivm__account.html#a4a081db7653645ce9fce8fd72e5a7bf1">zonetag</a>))</div><div class="line"><a name="l01336"></a><span class="lineno"> 1336</span>&#160;            <span class="keywordflow">continue</span>;</div><div class="line"><a name="l01337"></a><span class="lineno"> 1337</span>&#160;         the_zone = z;</div><div class="line"><a name="l01338"></a><span class="lineno"> 1338</span>&#160;      }</div><div class="line"><a name="l01339"></a><span class="lineno"> 1339</span>&#160;      <a class="code" href="../../df/d90/linkedlists_8h.html#ab48cb9e1e612dd486b747ba1c5d68d01">AST_LIST_UNLOCK</a>(&amp;<a class="code" href="../../db/dce/structminivm__zones.html">minivm_zones</a>);</div><div class="line"><a name="l01340"></a><span class="lineno"> 1340</span>&#160;   }</div><div class="line"><a name="l01341"></a><span class="lineno"> 1341</span>&#160;</div><div class="line"><a name="l01342"></a><span class="lineno"> 1342</span>&#160;   now = <a class="code" href="../../de/df7/time_8h.html#ad3899efb6f0e348556ef69f5b16aa7f7">ast_tvnow</a>();</div><div class="line"><a name="l01343"></a><span class="lineno"> 1343</span>&#160;   <a class="code" href="../../d5/deb/localtime_8h.html#ae9fbda728350a9a5b9c09b29214d718e">ast_localtime</a>(&amp;now, &amp;tm, the_zone ? the_zone-&gt;<a class="code" href="../../d4/d09/structminivm__zone.html#aad16c37028f0efbc3cf8c9186b770ab8">timezone</a> : <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div><div class="line"><a name="l01344"></a><span class="lineno"> 1344</span>&#160;   <a class="code" href="../../d5/deb/localtime_8h.html#aa8e63928b14a347bd3973d680b885f93">ast_strftime</a>(date, <span class="keyword">sizeof</span>(date), <span class="stringliteral">&quot;%a, %d %b %Y %H:%M:%S %z&quot;</span>, &amp;tm);</div><div class="line"><a name="l01345"></a><span class="lineno"> 1345</span>&#160;</div><div class="line"><a name="l01346"></a><span class="lineno"> 1346</span>&#160;   <span class="comment">/* Start printing the email to the temporary file */</span></div><div class="line"><a name="l01347"></a><span class="lineno"> 1347</span>&#160;   fprintf(p, <span class="stringliteral">&quot;Date: %s\n&quot;</span>, date);</div><div class="line"><a name="l01348"></a><span class="lineno"> 1348</span>&#160;</div><div class="line"><a name="l01349"></a><span class="lineno"> 1349</span>&#160;   <span class="comment">/* Set date format for voicemail mail */</span></div><div class="line"><a name="l01350"></a><span class="lineno"> 1350</span>&#160;   <a class="code" href="../../d5/deb/localtime_8h.html#aa8e63928b14a347bd3973d680b885f93">ast_strftime</a>(date, <span class="keyword">sizeof</span>(date), template-&gt;dateformat, &amp;tm);</div><div class="line"><a name="l01351"></a><span class="lineno"> 1351</span>&#160;</div><div class="line"><a name="l01352"></a><span class="lineno"> 1352</span>&#160;   <span class="comment">/* Populate channel with channel variables for substitution */</span></div><div class="line"><a name="l01353"></a><span class="lineno"> 1353</span>&#160;   <a class="code" href="../../de/dfe/app__minivm_8c.html#a0d31e4343dc402a9d86f380c15d7cb8c">prep_email_sub_vars</a>(chan, vmu, cidnum, cidname, dur, date, counter);</div><div class="line"><a name="l01354"></a><span class="lineno"> 1354</span>&#160;</div><div class="line"><a name="l01355"></a><span class="lineno"> 1355</span>&#160;   <span class="comment">/* Find email address to use */</span></div><div class="line"><a name="l01356"></a><span class="lineno"> 1356</span>&#160;   <span class="comment">/* If there&#39;s a server e-mail address in the account, use that, otherwise template */</span></div><div class="line"><a name="l01357"></a><span class="lineno"> 1357</span>&#160;   fromemail = <a class="code" href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a>(vmu-&gt;<a class="code" href="../../dc/d7b/structminivm__account.html#a0d189d088982b574837ebaee7cd4ccbd">serveremail</a>) ?  <span class="keyword">template</span>-&gt;serveremail : vmu-&gt;<a class="code" href="../../dc/d7b/structminivm__account.html#a0d189d088982b574837ebaee7cd4ccbd">serveremail</a>;</div><div class="line"><a name="l01358"></a><span class="lineno"> 1358</span>&#160;</div><div class="line"><a name="l01359"></a><span class="lineno"> 1359</span>&#160;   <span class="comment">/* Find name to user for server e-mail */</span></div><div class="line"><a name="l01360"></a><span class="lineno"> 1360</span>&#160;   fromaddress = <a class="code" href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a>(template-&gt;fromaddress) ? <span class="stringliteral">&quot;&quot;</span> : <span class="keyword">template</span>-&gt;fromaddress;</div><div class="line"><a name="l01361"></a><span class="lineno"> 1361</span>&#160;</div><div class="line"><a name="l01362"></a><span class="lineno"> 1362</span>&#160;   <span class="comment">/* If needed, add hostname as domain */</span></div><div class="line"><a name="l01363"></a><span class="lineno"> 1363</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a>(fromemail))</div><div class="line"><a name="l01364"></a><span class="lineno"> 1364</span>&#160;      fromemail = <span class="stringliteral">&quot;asterisk&quot;</span>;</div><div class="line"><a name="l01365"></a><span class="lineno"> 1365</span>&#160;</div><div class="line"><a name="l01366"></a><span class="lineno"> 1366</span>&#160;   <span class="keywordflow">if</span> (strchr(fromemail, <span class="charliteral">&#39;@&#39;</span>))</div><div class="line"><a name="l01367"></a><span class="lineno"> 1367</span>&#160;      <a class="code" href="../../d6/d90/strings_8h.html#ac4040268f7b6ed77dfc49c7767626369">ast_copy_string</a>(who, fromemail, <span class="keyword">sizeof</span>(who));</div><div class="line"><a name="l01368"></a><span class="lineno"> 1368</span>&#160;   <span class="keywordflow">else</span>  {</div><div class="line"><a name="l01369"></a><span class="lineno"> 1369</span>&#160;      <span class="keywordtype">char</span> <a class="code" href="../../d0/d8a/muted_8c.html#a41c3a180b50c6b2ddcc1b6843a48f205">host</a>[<a class="code" href="../../d9/d94/network_8h.html#afd80ecbe3170ca4fc85b65cda8659f82">MAXHOSTNAMELEN</a>];</div><div class="line"><a name="l01370"></a><span class="lineno"> 1370</span>&#160;      gethostname(host, <span class="keyword">sizeof</span>(host)-1);</div><div class="line"><a name="l01371"></a><span class="lineno"> 1371</span>&#160;      snprintf(who, <span class="keyword">sizeof</span>(who), <span class="stringliteral">&quot;%s@%s&quot;</span>, fromemail, host);</div><div class="line"><a name="l01372"></a><span class="lineno"> 1372</span>&#160;   }</div><div class="line"><a name="l01373"></a><span class="lineno"> 1373</span>&#160;</div><div class="line"><a name="l01374"></a><span class="lineno"> 1374</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a>(fromaddress)) {</div><div class="line"><a name="l01375"></a><span class="lineno"> 1375</span>&#160;      fprintf(p, <span class="stringliteral">&quot;From: Asterisk PBX &lt;%s&gt;\n&quot;</span>, who);</div><div class="line"><a name="l01376"></a><span class="lineno"> 1376</span>&#160;   } <span class="keywordflow">else</span> {</div><div class="line"><a name="l01377"></a><span class="lineno"> 1377</span>&#160;      <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(4, <span class="stringliteral">&quot;Fromaddress template: %s\n&quot;</span>, fromaddress);</div><div class="line"><a name="l01378"></a><span class="lineno"> 1378</span>&#160;      <a class="code" href="../../db/de0/pbx_8h.html#a556749361c7b9109134c8d00ab4ef6bf">ast_str_substitute_variables</a>(&amp;str1, 0, chan, fromaddress);</div><div class="line"><a name="l01379"></a><span class="lineno"> 1379</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="../../de/dfe/app__minivm_8c.html#a42eb1cc1b531f7e8f240fbe0eb6ad1bb">check_mime</a>(<a class="code" href="../../d6/d90/strings_8h.html#a1ef7e2644ca7258070db316fdc0a465b">ast_str_buffer</a>(str1))) {</div><div class="line"><a name="l01380"></a><span class="lineno"> 1380</span>&#160;         <span class="keywordtype">int</span> first_line = 1;</div><div class="line"><a name="l01381"></a><span class="lineno"> 1381</span>&#160;         <span class="keywordtype">char</span> *ptr;</div><div class="line"><a name="l01382"></a><span class="lineno"> 1382</span>&#160;         <a class="code" href="../../de/dfe/app__minivm_8c.html#ab0d4d1fc60708f1a0b2bf99c59a610f0">ast_str_encode_mime</a>(&amp;str2, 0, template-&gt;charset, <a class="code" href="../../d6/d90/strings_8h.html#a1ef7e2644ca7258070db316fdc0a465b">ast_str_buffer</a>(str1), strlen(<span class="stringliteral">&quot;From: &quot;</span>), strlen(who) + 3);</div><div class="line"><a name="l01383"></a><span class="lineno"> 1383</span>&#160;         <span class="keywordflow">while</span> ((ptr = strchr(<a class="code" href="../../d6/d90/strings_8h.html#a1ef7e2644ca7258070db316fdc0a465b">ast_str_buffer</a>(str2), <span class="charliteral">&#39; &#39;</span>))) {</div><div class="line"><a name="l01384"></a><span class="lineno"> 1384</span>&#160;            *ptr = <span class="charliteral">&#39;\0&#39;</span>;</div><div class="line"><a name="l01385"></a><span class="lineno"> 1385</span>&#160;            fprintf(p, <span class="stringliteral">&quot;%s %s\n&quot;</span>, first_line ? <span class="stringliteral">&quot;From:&quot;</span> : <span class="stringliteral">&quot;&quot;</span>, <a class="code" href="../../d6/d90/strings_8h.html#a1ef7e2644ca7258070db316fdc0a465b">ast_str_buffer</a>(str2));</div><div class="line"><a name="l01386"></a><span class="lineno"> 1386</span>&#160;            first_line = 0;</div><div class="line"><a name="l01387"></a><span class="lineno"> 1387</span>&#160;            <span class="comment">/* Substring is smaller, so this will never grow */</span></div><div class="line"><a name="l01388"></a><span class="lineno"> 1388</span>&#160;            <a class="code" href="../../d6/d90/strings_8h.html#aa3341f35cedca29e60bb7f3927204283">ast_str_set</a>(&amp;str2, 0, <span class="stringliteral">&quot;%s&quot;</span>, ptr + 1);</div><div class="line"><a name="l01389"></a><span class="lineno"> 1389</span>&#160;         }</div><div class="line"><a name="l01390"></a><span class="lineno"> 1390</span>&#160;         fprintf(p, <span class="stringliteral">&quot;%s %s &lt;%s&gt;\n&quot;</span>, first_line ? <span class="stringliteral">&quot;From:&quot;</span> : <span class="stringliteral">&quot;&quot;</span>, <a class="code" href="../../d6/d90/strings_8h.html#a1ef7e2644ca7258070db316fdc0a465b">ast_str_buffer</a>(str2), who);</div><div class="line"><a name="l01391"></a><span class="lineno"> 1391</span>&#160;      } <span class="keywordflow">else</span> {</div><div class="line"><a name="l01392"></a><span class="lineno"> 1392</span>&#160;         fprintf(p, <span class="stringliteral">&quot;From: %s &lt;%s&gt;\n&quot;</span>, <a class="code" href="../../de/dfe/app__minivm_8c.html#aa3e1184e10a123c4ed53c5918da34258">ast_str_quote</a>(&amp;str2, 0, <a class="code" href="../../d6/d90/strings_8h.html#a1ef7e2644ca7258070db316fdc0a465b">ast_str_buffer</a>(str1)), who);</div><div class="line"><a name="l01393"></a><span class="lineno"> 1393</span>&#160;      }</div><div class="line"><a name="l01394"></a><span class="lineno"> 1394</span>&#160;   }</div><div class="line"><a name="l01395"></a><span class="lineno"> 1395</span>&#160;</div><div class="line"><a name="l01396"></a><span class="lineno"> 1396</span>&#160;   fprintf(p, <span class="stringliteral">&quot;Message-ID: &lt;Asterisk-%u-%s-%d-%s&gt;\n&quot;</span>, (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>)<a class="code" href="../../d5/d60/utils_8h.html#a7b4f10b070e95ba413e258a3e4b03c20">ast_random</a>(), vmu-&gt;<a class="code" href="../../dc/d7b/structminivm__account.html#a4b30874d24514b5ef6ff5276e8c12ed4">username</a>, (<span class="keywordtype">int</span>)getpid(), who);</div><div class="line"><a name="l01397"></a><span class="lineno"> 1397</span>&#160;</div><div class="line"><a name="l01398"></a><span class="lineno"> 1398</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a>(vmu-&gt;<a class="code" href="../../dc/d7b/structminivm__account.html#aadd75c09e15efa9061997f033b3f224b">email</a>)) {</div><div class="line"><a name="l01399"></a><span class="lineno"> 1399</span>&#160;      snprintf(email, <span class="keyword">sizeof</span>(email), <span class="stringliteral">&quot;%s@%s&quot;</span>, vmu-&gt;<a class="code" href="../../dc/d7b/structminivm__account.html#a4b30874d24514b5ef6ff5276e8c12ed4">username</a>, vmu-&gt;<a class="code" href="../../dc/d7b/structminivm__account.html#ae43ea5d0335f149f0920d33e46b61c33">domain</a>);</div><div class="line"><a name="l01400"></a><span class="lineno"> 1400</span>&#160;   } <span class="keywordflow">else</span> {</div><div class="line"><a name="l01401"></a><span class="lineno"> 1401</span>&#160;      <a class="code" href="../../d6/d90/strings_8h.html#ac4040268f7b6ed77dfc49c7767626369">ast_copy_string</a>(email, vmu-&gt;<a class="code" href="../../dc/d7b/structminivm__account.html#aadd75c09e15efa9061997f033b3f224b">email</a>, <span class="keyword">sizeof</span>(email));</div><div class="line"><a name="l01402"></a><span class="lineno"> 1402</span>&#160;   }</div><div class="line"><a name="l01403"></a><span class="lineno"> 1403</span>&#160;</div><div class="line"><a name="l01404"></a><span class="lineno"> 1404</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../de/dfe/app__minivm_8c.html#a42eb1cc1b531f7e8f240fbe0eb6ad1bb">check_mime</a>(vmu-&gt;<a class="code" href="../../dc/d7b/structminivm__account.html#ab5845627664c59054dd8e5f01829d4f3">fullname</a>)) {</div><div class="line"><a name="l01405"></a><span class="lineno"> 1405</span>&#160;      <span class="keywordtype">int</span> first_line = 1;</div><div class="line"><a name="l01406"></a><span class="lineno"> 1406</span>&#160;      <span class="keywordtype">char</span> *ptr;</div><div class="line"><a name="l01407"></a><span class="lineno"> 1407</span>&#160;      <a class="code" href="../../de/dfe/app__minivm_8c.html#ab0d4d1fc60708f1a0b2bf99c59a610f0">ast_str_encode_mime</a>(&amp;str2, 0, template-&gt;charset, vmu-&gt;<a class="code" href="../../dc/d7b/structminivm__account.html#ab5845627664c59054dd8e5f01829d4f3">fullname</a>, strlen(<span class="stringliteral">&quot;To: &quot;</span>), strlen(email) + 3);</div><div class="line"><a name="l01408"></a><span class="lineno"> 1408</span>&#160;      <span class="keywordflow">while</span> ((ptr = strchr(<a class="code" href="../../d6/d90/strings_8h.html#a1ef7e2644ca7258070db316fdc0a465b">ast_str_buffer</a>(str2), <span class="charliteral">&#39; &#39;</span>))) {</div><div class="line"><a name="l01409"></a><span class="lineno"> 1409</span>&#160;         *ptr = <span class="charliteral">&#39;\0&#39;</span>;</div><div class="line"><a name="l01410"></a><span class="lineno"> 1410</span>&#160;         fprintf(p, <span class="stringliteral">&quot;%s %s\n&quot;</span>, first_line ? <span class="stringliteral">&quot;To:&quot;</span> : <span class="stringliteral">&quot;&quot;</span>, <a class="code" href="../../d6/d90/strings_8h.html#a1ef7e2644ca7258070db316fdc0a465b">ast_str_buffer</a>(str2));</div><div class="line"><a name="l01411"></a><span class="lineno"> 1411</span>&#160;         first_line = 0;</div><div class="line"><a name="l01412"></a><span class="lineno"> 1412</span>&#160;         <span class="comment">/* Substring is smaller, so this will never grow */</span></div><div class="line"><a name="l01413"></a><span class="lineno"> 1413</span>&#160;         <a class="code" href="../../d6/d90/strings_8h.html#aa3341f35cedca29e60bb7f3927204283">ast_str_set</a>(&amp;str2, 0, <span class="stringliteral">&quot;%s&quot;</span>, ptr + 1);</div><div class="line"><a name="l01414"></a><span class="lineno"> 1414</span>&#160;      }</div><div class="line"><a name="l01415"></a><span class="lineno"> 1415</span>&#160;      fprintf(p, <span class="stringliteral">&quot;%s %s &lt;%s&gt;\n&quot;</span>, first_line ? <span class="stringliteral">&quot;To:&quot;</span> : <span class="stringliteral">&quot;&quot;</span>, <a class="code" href="../../d6/d90/strings_8h.html#a1ef7e2644ca7258070db316fdc0a465b">ast_str_buffer</a>(str2), email);</div><div class="line"><a name="l01416"></a><span class="lineno"> 1416</span>&#160;   } <span class="keywordflow">else</span> {</div><div class="line"><a name="l01417"></a><span class="lineno"> 1417</span>&#160;      fprintf(p, <span class="stringliteral">&quot;To: %s &lt;%s&gt;\n&quot;</span>, <a class="code" href="../../de/dfe/app__minivm_8c.html#aa3e1184e10a123c4ed53c5918da34258">ast_str_quote</a>(&amp;str2, 0, vmu-&gt;<a class="code" href="../../dc/d7b/structminivm__account.html#ab5845627664c59054dd8e5f01829d4f3">fullname</a>), email);</div><div class="line"><a name="l01418"></a><span class="lineno"> 1418</span>&#160;   }</div><div class="line"><a name="l01419"></a><span class="lineno"> 1419</span>&#160;</div><div class="line"><a name="l01420"></a><span class="lineno"> 1420</span>&#160;   <span class="keywordflow">if</span> (!<a class="code" href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a>(template-&gt;subject)) {</div><div class="line"><a name="l01421"></a><span class="lineno"> 1421</span>&#160;      <a class="code" href="../../db/de0/pbx_8h.html#a556749361c7b9109134c8d00ab4ef6bf">ast_str_substitute_variables</a>(&amp;str1, 0, chan, template-&gt;subject);</div><div class="line"><a name="l01422"></a><span class="lineno"> 1422</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="../../de/dfe/app__minivm_8c.html#a42eb1cc1b531f7e8f240fbe0eb6ad1bb">check_mime</a>(<a class="code" href="../../d6/d90/strings_8h.html#a1ef7e2644ca7258070db316fdc0a465b">ast_str_buffer</a>(str1))) {</div><div class="line"><a name="l01423"></a><span class="lineno"> 1423</span>&#160;         <span class="keywordtype">int</span> first_line = 1;</div><div class="line"><a name="l01424"></a><span class="lineno"> 1424</span>&#160;         <span class="keywordtype">char</span> *ptr;</div><div class="line"><a name="l01425"></a><span class="lineno"> 1425</span>&#160;         <a class="code" href="../../de/dfe/app__minivm_8c.html#ab0d4d1fc60708f1a0b2bf99c59a610f0">ast_str_encode_mime</a>(&amp;str2, 0, template-&gt;charset, <a class="code" href="../../d6/d90/strings_8h.html#a1ef7e2644ca7258070db316fdc0a465b">ast_str_buffer</a>(str1), strlen(<span class="stringliteral">&quot;Subject: &quot;</span>), 0);</div><div class="line"><a name="l01426"></a><span class="lineno"> 1426</span>&#160;         <span class="keywordflow">while</span> ((ptr = strchr(<a class="code" href="../../d6/d90/strings_8h.html#a1ef7e2644ca7258070db316fdc0a465b">ast_str_buffer</a>(str2), <span class="charliteral">&#39; &#39;</span>))) {</div><div class="line"><a name="l01427"></a><span class="lineno"> 1427</span>&#160;            *ptr = <span class="charliteral">&#39;\0&#39;</span>;</div><div class="line"><a name="l01428"></a><span class="lineno"> 1428</span>&#160;            fprintf(p, <span class="stringliteral">&quot;%s %s\n&quot;</span>, first_line ? <span class="stringliteral">&quot;Subject:&quot;</span> : <span class="stringliteral">&quot;&quot;</span>, <a class="code" href="../../d6/d90/strings_8h.html#a1ef7e2644ca7258070db316fdc0a465b">ast_str_buffer</a>(str2));</div><div class="line"><a name="l01429"></a><span class="lineno"> 1429</span>&#160;            first_line = 0;</div><div class="line"><a name="l01430"></a><span class="lineno"> 1430</span>&#160;            <span class="comment">/* Substring is smaller, so this will never grow */</span></div><div class="line"><a name="l01431"></a><span class="lineno"> 1431</span>&#160;            <a class="code" href="../../d6/d90/strings_8h.html#aa3341f35cedca29e60bb7f3927204283">ast_str_set</a>(&amp;str2, 0, <span class="stringliteral">&quot;%s&quot;</span>, ptr + 1);</div><div class="line"><a name="l01432"></a><span class="lineno"> 1432</span>&#160;         }</div><div class="line"><a name="l01433"></a><span class="lineno"> 1433</span>&#160;         fprintf(p, <span class="stringliteral">&quot;%s %s\n&quot;</span>, first_line ? <span class="stringliteral">&quot;Subject:&quot;</span> : <span class="stringliteral">&quot;&quot;</span>, <a class="code" href="../../d6/d90/strings_8h.html#a1ef7e2644ca7258070db316fdc0a465b">ast_str_buffer</a>(str2));</div><div class="line"><a name="l01434"></a><span class="lineno"> 1434</span>&#160;      } <span class="keywordflow">else</span> {</div><div class="line"><a name="l01435"></a><span class="lineno"> 1435</span>&#160;         fprintf(p, <span class="stringliteral">&quot;Subject: %s\n&quot;</span>, <a class="code" href="../../d6/d90/strings_8h.html#a1ef7e2644ca7258070db316fdc0a465b">ast_str_buffer</a>(str1));</div><div class="line"><a name="l01436"></a><span class="lineno"> 1436</span>&#160;      }</div><div class="line"><a name="l01437"></a><span class="lineno"> 1437</span>&#160;   } <span class="keywordflow">else</span> {</div><div class="line"><a name="l01438"></a><span class="lineno"> 1438</span>&#160;      fprintf(p, <span class="stringliteral">&quot;Subject: New message in mailbox %s@%s\n&quot;</span>, vmu-&gt;<a class="code" href="../../dc/d7b/structminivm__account.html#a4b30874d24514b5ef6ff5276e8c12ed4">username</a>, vmu-&gt;<a class="code" href="../../dc/d7b/structminivm__account.html#ae43ea5d0335f149f0920d33e46b61c33">domain</a>);</div><div class="line"><a name="l01439"></a><span class="lineno"> 1439</span>&#160;      <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(1, <span class="stringliteral">&quot;Using default subject for this email \n&quot;</span>);</div><div class="line"><a name="l01440"></a><span class="lineno"> 1440</span>&#160;   }</div><div class="line"><a name="l01441"></a><span class="lineno"> 1441</span>&#160;</div><div class="line"><a name="l01442"></a><span class="lineno"> 1442</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d1/d8c/logger_8h.html#a33f6031de4ab6d1406465a7a3ee18e86">DEBUG_ATLEAST</a>(3))</div><div class="line"><a name="l01443"></a><span class="lineno"> 1443</span>&#160;      fprintf(p, <span class="stringliteral">&quot;X-Asterisk-debug: template %s user account %s@%s\n&quot;</span>, template-&gt;name, vmu-&gt;<a class="code" href="../../dc/d7b/structminivm__account.html#a4b30874d24514b5ef6ff5276e8c12ed4">username</a>, vmu-&gt;<a class="code" href="../../dc/d7b/structminivm__account.html#ae43ea5d0335f149f0920d33e46b61c33">domain</a>);</div><div class="line"><a name="l01444"></a><span class="lineno"> 1444</span>&#160;   fprintf(p, <span class="stringliteral">&quot;MIME-Version: 1.0\n&quot;</span>);</div><div class="line"><a name="l01445"></a><span class="lineno"> 1445</span>&#160;</div><div class="line"><a name="l01446"></a><span class="lineno"> 1446</span>&#160;   <span class="comment">/* Something unique. */</span></div><div class="line"><a name="l01447"></a><span class="lineno"> 1447</span>&#160;   snprintf(bound, <span class="keyword">sizeof</span>(bound), <span class="stringliteral">&quot;voicemail_%s%d%u&quot;</span>, vmu-&gt;<a class="code" href="../../dc/d7b/structminivm__account.html#a4b30874d24514b5ef6ff5276e8c12ed4">username</a>, (<span class="keywordtype">int</span>)getpid(), (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>)<a class="code" href="../../d5/d60/utils_8h.html#a7b4f10b070e95ba413e258a3e4b03c20">ast_random</a>());</div><div class="line"><a name="l01448"></a><span class="lineno"> 1448</span>&#160;</div><div class="line"><a name="l01449"></a><span class="lineno"> 1449</span>&#160;   fprintf(p, <span class="stringliteral">&quot;Content-Type: multipart/mixed; boundary=\&quot;%s\&quot;\n\n\n&quot;</span>, bound);</div><div class="line"><a name="l01450"></a><span class="lineno"> 1450</span>&#160;</div><div class="line"><a name="l01451"></a><span class="lineno"> 1451</span>&#160;   fprintf(p, <span class="stringliteral">&quot;--%s\n&quot;</span>, bound);</div><div class="line"><a name="l01452"></a><span class="lineno"> 1452</span>&#160;   fprintf(p, <span class="stringliteral">&quot;Content-Type: text/plain; charset=%s\nContent-Transfer-Encoding: 8bit\n\n&quot;</span>, template-&gt;charset);</div><div class="line"><a name="l01453"></a><span class="lineno"> 1453</span>&#160;   <span class="keywordflow">if</span> (!<a class="code" href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a>(template-&gt;body)) {</div><div class="line"><a name="l01454"></a><span class="lineno"> 1454</span>&#160;      <a class="code" href="../../db/de0/pbx_8h.html#a556749361c7b9109134c8d00ab4ef6bf">ast_str_substitute_variables</a>(&amp;str1, 0, chan, template-&gt;body);</div><div class="line"><a name="l01455"></a><span class="lineno"> 1455</span>&#160;      <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(3, <span class="stringliteral">&quot;Message now: %s\n-----\n&quot;</span>, <a class="code" href="../../d6/d90/strings_8h.html#a1ef7e2644ca7258070db316fdc0a465b">ast_str_buffer</a>(str1));</div><div class="line"><a name="l01456"></a><span class="lineno"> 1456</span>&#160;      fprintf(p, <span class="stringliteral">&quot;%s\n&quot;</span>, <a class="code" href="../../d6/d90/strings_8h.html#a1ef7e2644ca7258070db316fdc0a465b">ast_str_buffer</a>(str1));</div><div class="line"><a name="l01457"></a><span class="lineno"> 1457</span>&#160;   } <span class="keywordflow">else</span> {</div><div class="line"><a name="l01458"></a><span class="lineno"> 1458</span>&#160;      fprintf(p, <span class="stringliteral">&quot;Dear %s:\n\n\tJust wanted to let you know you were just left a %s long message \n&quot;</span></div><div class="line"><a name="l01459"></a><span class="lineno"> 1459</span>&#160;         <span class="stringliteral">&quot;in mailbox %s from %s, on %s so you might\n&quot;</span></div><div class="line"><a name="l01460"></a><span class="lineno"> 1460</span>&#160;         <span class="stringliteral">&quot;want to check it when you get a chance.  Thanks!\n\n\t\t\t\t--Asterisk\n\n&quot;</span>, vmu-&gt;<a class="code" href="../../dc/d7b/structminivm__account.html#ab5845627664c59054dd8e5f01829d4f3">fullname</a>,</div><div class="line"><a name="l01461"></a><span class="lineno"> 1461</span>&#160;         dur,  vmu-&gt;<a class="code" href="../../dc/d7b/structminivm__account.html#a4b30874d24514b5ef6ff5276e8c12ed4">username</a>, (cidname ? cidname : (cidnum ? cidnum : <span class="stringliteral">&quot;an unknown caller&quot;</span>)), date);</div><div class="line"><a name="l01462"></a><span class="lineno"> 1462</span>&#160;      <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(3, <span class="stringliteral">&quot;Using default message body (no template)\n-----\n&quot;</span>);</div><div class="line"><a name="l01463"></a><span class="lineno"> 1463</span>&#160;   }</div><div class="line"><a name="l01464"></a><span class="lineno"> 1464</span>&#160;   <span class="comment">/* Eww. We want formats to tell us their own MIME type */</span></div><div class="line"><a name="l01465"></a><span class="lineno"> 1465</span>&#160;   <span class="keywordflow">if</span> (template-&gt;attachment) {</div><div class="line"><a name="l01466"></a><span class="lineno"> 1466</span>&#160;      <span class="keywordtype">char</span> *ctype = <span class="stringliteral">&quot;audio/x-&quot;</span>;</div><div class="line"><a name="l01467"></a><span class="lineno"> 1467</span>&#160;      <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(3, <span class="stringliteral">&quot;Attaching file to message: %s\n&quot;</span>, fname);</div><div class="line"><a name="l01468"></a><span class="lineno"> 1468</span>&#160;      <span class="keywordflow">if</span> (!strcasecmp(format, <span class="stringliteral">&quot;ogg&quot;</span>))</div><div class="line"><a name="l01469"></a><span class="lineno"> 1469</span>&#160;         ctype = <span class="stringliteral">&quot;application/&quot;</span>;</div><div class="line"><a name="l01470"></a><span class="lineno"> 1470</span>&#160;</div><div class="line"><a name="l01471"></a><span class="lineno"> 1471</span>&#160;      fprintf(p, <span class="stringliteral">&quot;--%s\n&quot;</span>, bound);</div><div class="line"><a name="l01472"></a><span class="lineno"> 1472</span>&#160;      fprintf(p, <span class="stringliteral">&quot;Content-Type: %s%s; name=\&quot;voicemailmsg.%s\&quot;\n&quot;</span>, ctype, format, format);</div><div class="line"><a name="l01473"></a><span class="lineno"> 1473</span>&#160;      fprintf(p, <span class="stringliteral">&quot;Content-Transfer-Encoding: base64\n&quot;</span>);</div><div class="line"><a name="l01474"></a><span class="lineno"> 1474</span>&#160;      fprintf(p, <span class="stringliteral">&quot;Content-Description: Voicemail sound attachment.\n&quot;</span>);</div><div class="line"><a name="l01475"></a><span class="lineno"> 1475</span>&#160;      fprintf(p, <span class="stringliteral">&quot;Content-Disposition: attachment; filename=\&quot;voicemail%s.%s\&quot;\n\n&quot;</span>, counter ? counter : <span class="stringliteral">&quot;&quot;</span>, format);</div><div class="line"><a name="l01476"></a><span class="lineno"> 1476</span>&#160;</div><div class="line"><a name="l01477"></a><span class="lineno"> 1477</span>&#160;      <a class="code" href="../../de/dfe/app__minivm_8c.html#a47ff5177c51504731acbd567efea2b17">base_encode</a>(fname, p);</div><div class="line"><a name="l01478"></a><span class="lineno"> 1478</span>&#160;      fprintf(p, <span class="stringliteral">&quot;\n\n--%s--\n.\n&quot;</span>, bound);</div><div class="line"><a name="l01479"></a><span class="lineno"> 1479</span>&#160;   }</div><div class="line"><a name="l01480"></a><span class="lineno"> 1480</span>&#160;   fclose(p);</div><div class="line"><a name="l01481"></a><span class="lineno"> 1481</span>&#160;</div><div class="line"><a name="l01482"></a><span class="lineno"> 1482</span>&#160;   chan = <a class="code" href="../../d5/d7b/channel_8h.html#ab733a7825810b895a89b629e0ea89380">ast_channel_unref</a>(chan);</div><div class="line"><a name="l01483"></a><span class="lineno"> 1483</span>&#160;</div><div class="line"><a name="l01484"></a><span class="lineno"> 1484</span>&#160;   <span class="keywordflow">if</span> (file_to_delete &amp;&amp; dir_to_delete) {</div><div class="line"><a name="l01485"></a><span class="lineno"> 1485</span>&#160;      <span class="comment">/* We can&#39;t delete these files ourselves because the mail command will execute in</span></div><div class="line"><a name="l01486"></a><span class="lineno"> 1486</span>&#160;<span class="comment">         the background and we&#39;ll end up deleting them out from under it. */</span></div><div class="line"><a name="l01487"></a><span class="lineno"> 1487</span>&#160;      res = snprintf(mail_cmd_buffer, <span class="keyword">sizeof</span>(mail_cmd_buffer),</div><div class="line"><a name="l01488"></a><span class="lineno"> 1488</span>&#160;                  <span class="stringliteral">&quot;( %s &lt; %s ; rm -f %s %s ; rmdir %s ) &amp;&quot;</span>,</div><div class="line"><a name="l01489"></a><span class="lineno"> 1489</span>&#160;                  global_mailcmd, tmp, tmp, file_to_delete, dir_to_delete);</div><div class="line"><a name="l01490"></a><span class="lineno"> 1490</span>&#160;   } <span class="keywordflow">else</span> {</div><div class="line"><a name="l01491"></a><span class="lineno"> 1491</span>&#160;      res = snprintf(mail_cmd_buffer, <span class="keyword">sizeof</span>(mail_cmd_buffer),</div><div class="line"><a name="l01492"></a><span class="lineno"> 1492</span>&#160;                  <span class="stringliteral">&quot;( %s &lt; %s ; rm -f %s ) &amp;&quot;</span>,</div><div class="line"><a name="l01493"></a><span class="lineno"> 1493</span>&#160;                  global_mailcmd, tmp, tmp);</div><div class="line"><a name="l01494"></a><span class="lineno"> 1494</span>&#160;   }</div><div class="line"><a name="l01495"></a><span class="lineno"> 1495</span>&#160;</div><div class="line"><a name="l01496"></a><span class="lineno"> 1496</span>&#160;   <span class="keywordflow">if</span> (res &lt; <span class="keyword">sizeof</span>(mail_cmd_buffer)) {</div><div class="line"><a name="l01497"></a><span class="lineno"> 1497</span>&#160;      file_to_delete = dir_to_delete = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l01498"></a><span class="lineno"> 1498</span>&#160;   } <span class="keywordflow">else</span> {</div><div class="line"><a name="l01499"></a><span class="lineno"> 1499</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Could not send message, command line too long\n&quot;</span>);</div><div class="line"><a name="l01500"></a><span class="lineno"> 1500</span>&#160;      res = -1;</div><div class="line"><a name="l01501"></a><span class="lineno"> 1501</span>&#160;      <span class="keywordflow">goto</span> <a class="code" href="../../d6/d47/utils_2frame_8c.html#a48bc11919b2752df9d14ce89557cfb25">out</a>;</div><div class="line"><a name="l01502"></a><span class="lineno"> 1502</span>&#160;   }</div><div class="line"><a name="l01503"></a><span class="lineno"> 1503</span>&#160;</div><div class="line"><a name="l01504"></a><span class="lineno"> 1504</span>&#160;   <a class="code" href="../../d3/d93/include_2asterisk_2app_8h.html#a9fb5cf0385848033ee3e98625e5f9784">ast_safe_system</a>(mail_cmd_buffer);</div><div class="line"><a name="l01505"></a><span class="lineno"> 1505</span>&#160;   <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(1, <span class="stringliteral">&quot;Sent message to %s with command &#39;%s&#39;%s\n&quot;</span>, vmu-&gt;<a class="code" href="../../dc/d7b/structminivm__account.html#aadd75c09e15efa9061997f033b3f224b">email</a>, global_mailcmd, template-&gt;attachment ? <span class="stringliteral">&quot; - (media attachment)&quot;</span> : <span class="stringliteral">&quot;&quot;</span>);</div><div class="line"><a name="l01506"></a><span class="lineno"> 1506</span>&#160;   <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(3, <span class="stringliteral">&quot;Actual command used: %s\n&quot;</span>, mail_cmd_buffer);</div><div class="line"><a name="l01507"></a><span class="lineno"> 1507</span>&#160;</div><div class="line"><a name="l01508"></a><span class="lineno"> 1508</span>&#160;   res = 0;</div><div class="line"><a name="l01509"></a><span class="lineno"> 1509</span>&#160;</div><div class="line"><a name="l01510"></a><span class="lineno"> 1510</span>&#160;<a class="code" href="../../d6/d47/utils_2frame_8c.html#a48bc11919b2752df9d14ce89557cfb25">out</a>:</div><div class="line"><a name="l01511"></a><span class="lineno"> 1511</span>&#160;   <span class="keywordflow">if</span> (file_to_delete) {</div><div class="line"><a name="l01512"></a><span class="lineno"> 1512</span>&#160;      unlink(file_to_delete);</div><div class="line"><a name="l01513"></a><span class="lineno"> 1513</span>&#160;   }</div><div class="line"><a name="l01514"></a><span class="lineno"> 1514</span>&#160;</div><div class="line"><a name="l01515"></a><span class="lineno"> 1515</span>&#160;   <span class="keywordflow">if</span> (dir_to_delete) {</div><div class="line"><a name="l01516"></a><span class="lineno"> 1516</span>&#160;      rmdir(dir_to_delete);</div><div class="line"><a name="l01517"></a><span class="lineno"> 1517</span>&#160;   }</div><div class="line"><a name="l01518"></a><span class="lineno"> 1518</span>&#160;</div><div class="line"><a name="l01519"></a><span class="lineno"> 1519</span>&#160;   <span class="keywordflow">return</span> res;</div><div class="line"><a name="l01520"></a><span class="lineno"> 1520</span>&#160;}</div><div class="line"><a name="l01521"></a><span class="lineno"> 1521</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01522"></a><span class="lineno"> 1522</span>&#160;<span class="comment">/*!\internal</span></div><div class="line"><a name="l01523"></a><span class="lineno"> 1523</span>&#160;<span class="comment"> * \brief Create directory based on components */</span></div><div class="line"><a name="l01524"></a><span class="lineno"><a class="line" href="../../de/dfe/app__minivm_8c.html#a16dc4d46dd4562436ebbb02bb0f4073a"> 1524</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../de/dfe/app__minivm_8c.html#a16dc4d46dd4562436ebbb02bb0f4073a">make_dir</a>(<span class="keywordtype">char</span> *dest, <span class="keywordtype">int</span> <a class="code" href="../../d9/d1e/func__strings_8c.html#af24e73aaf92f3000fda15d285e66df24">len</a>, <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="../../dd/dac/structdomain.html">domain</a>, <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="../../dc/d7b/structminivm__account.html#a4b30874d24514b5ef6ff5276e8c12ed4">username</a>, <span class="keyword">const</span> <span class="keywordtype">char</span> *folder)</div><div class="line"><a name="l01525"></a><span class="lineno"> 1525</span>&#160;{</div><div class="line"><a name="l01526"></a><span class="lineno"> 1526</span>&#160;   <span class="keywordflow">return</span> snprintf(dest, len, <span class="stringliteral">&quot;%s%s/%s%s%s&quot;</span>, <a class="code" href="../../de/dfe/app__minivm_8c.html#ab94d2ef3acf22b2bf9410c48462c7cb1">MVM_SPOOL_DIR</a>, domain, username, <a class="code" href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a>(folder) ? <span class="stringliteral">&quot;&quot;</span> : <span class="stringliteral">&quot;/&quot;</span>, folder ? folder : <span class="stringliteral">&quot;&quot;</span>);</div><div class="line"><a name="l01527"></a><span class="lineno"> 1527</span>&#160;}</div><div class="line"><a name="l01528"></a><span class="lineno"> 1528</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01529"></a><span class="lineno"> 1529</span>&#160;<span class="comment">/*!\internal</span></div><div class="line"><a name="l01530"></a><span class="lineno"> 1530</span>&#160;<span class="comment"> * \brief Checks if directory exists. Does not create directory, but builds string in dest</span></div><div class="line"><a name="l01531"></a><span class="lineno"> 1531</span>&#160;<span class="comment"> * \param dest    String. base directory.</span></div><div class="line"><a name="l01532"></a><span class="lineno"> 1532</span>&#160;<span class="comment"> * \param len    Int. Length base directory string.</span></div><div class="line"><a name="l01533"></a><span class="lineno"> 1533</span>&#160;<span class="comment"> * \param domain String. Ignored if is null or empty string.</span></div><div class="line"><a name="l01534"></a><span class="lineno"> 1534</span>&#160;<span class="comment"> * \param username String. Ignored if is null or empty string.</span></div><div class="line"><a name="l01535"></a><span class="lineno"> 1535</span>&#160;<span class="comment"> * \param folder  String. Ignored if is null or empty string.</span></div><div class="line"><a name="l01536"></a><span class="lineno"> 1536</span>&#160;<span class="comment"> * \return 0 on failure, 1 on success.</span></div><div class="line"><a name="l01537"></a><span class="lineno"> 1537</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l01538"></a><span class="lineno"><a class="line" href="../../de/dfe/app__minivm_8c.html#a9a335978d2517b553066af1f10a4d07f"> 1538</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../de/dfe/app__minivm_8c.html#a9a335978d2517b553066af1f10a4d07f">check_dirpath</a>(<span class="keywordtype">char</span> *dest, <span class="keywordtype">int</span> <a class="code" href="../../d9/d1e/func__strings_8c.html#af24e73aaf92f3000fda15d285e66df24">len</a>, <span class="keywordtype">char</span> *<a class="code" href="../../dd/dac/structdomain.html">domain</a>, <span class="keywordtype">char</span> *<a class="code" href="../../dc/d7b/structminivm__account.html#a4b30874d24514b5ef6ff5276e8c12ed4">username</a>, <span class="keywordtype">char</span> *folder)</div><div class="line"><a name="l01539"></a><span class="lineno"> 1539</span>&#160;{</div><div class="line"><a name="l01540"></a><span class="lineno"> 1540</span>&#160;   <span class="keyword">struct </span>stat filestat;</div><div class="line"><a name="l01541"></a><span class="lineno"> 1541</span>&#160;   <a class="code" href="../../de/dfe/app__minivm_8c.html#a16dc4d46dd4562436ebbb02bb0f4073a">make_dir</a>(dest, len, domain, username, folder ? folder : <span class="stringliteral">&quot;&quot;</span>);</div><div class="line"><a name="l01542"></a><span class="lineno"> 1542</span>&#160;   <span class="keywordflow">if</span> (stat(dest, &amp;filestat)== -1)</div><div class="line"><a name="l01543"></a><span class="lineno"> 1543</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../de/dfe/app__minivm_8c.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;</div><div class="line"><a name="l01544"></a><span class="lineno"> 1544</span>&#160;   <span class="keywordflow">else</span></div><div class="line"><a name="l01545"></a><span class="lineno"> 1545</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../de/dfe/app__minivm_8c.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;</div><div class="line"><a name="l01546"></a><span class="lineno"> 1546</span>&#160;}</div><div class="line"><a name="l01547"></a><span class="lineno"> 1547</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01548"></a><span class="lineno"> 1548</span>&#160;<span class="comment">/*!\internal</span></div><div class="line"><a name="l01549"></a><span class="lineno"> 1549</span>&#160;<span class="comment"> * \brief basically mkdir -p $dest/$domain/$username/$folder</span></div><div class="line"><a name="l01550"></a><span class="lineno"> 1550</span>&#160;<span class="comment"> * \param dest    String. base directory.</span></div><div class="line"><a name="l01551"></a><span class="lineno"> 1551</span>&#160;<span class="comment"> * \param len     Length of directory string</span></div><div class="line"><a name="l01552"></a><span class="lineno"> 1552</span>&#160;<span class="comment"> * \param domain  String. Ignored if is null or empty string.</span></div><div class="line"><a name="l01553"></a><span class="lineno"> 1553</span>&#160;<span class="comment"> * \param folder  String. Ignored if is null or empty string.</span></div><div class="line"><a name="l01554"></a><span class="lineno"> 1554</span>&#160;<span class="comment"> * \param username  String. Ignored if is null or empty string.</span></div><div class="line"><a name="l01555"></a><span class="lineno"> 1555</span>&#160;<span class="comment"> * \return -1 on failure, 0 on success.</span></div><div class="line"><a name="l01556"></a><span class="lineno"> 1556</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l01557"></a><span class="lineno"><a class="line" href="../../de/dfe/app__minivm_8c.html#ac6ccbdf4443ab9722a13578d17b1f7da"> 1557</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../de/dfe/app__minivm_8c.html#ac6ccbdf4443ab9722a13578d17b1f7da">create_dirpath</a>(<span class="keywordtype">char</span> *dest, <span class="keywordtype">int</span> <a class="code" href="../../d9/d1e/func__strings_8c.html#af24e73aaf92f3000fda15d285e66df24">len</a>, <span class="keywordtype">char</span> *<a class="code" href="../../dd/dac/structdomain.html">domain</a>, <span class="keywordtype">char</span> *<a class="code" href="../../dc/d7b/structminivm__account.html#a4b30874d24514b5ef6ff5276e8c12ed4">username</a>, <span class="keywordtype">char</span> *folder)</div><div class="line"><a name="l01558"></a><span class="lineno"> 1558</span>&#160;{</div><div class="line"><a name="l01559"></a><span class="lineno"> 1559</span>&#160;   <span class="keywordtype">int</span> res;</div><div class="line"><a name="l01560"></a><span class="lineno"> 1560</span>&#160;   <a class="code" href="../../de/dfe/app__minivm_8c.html#a16dc4d46dd4562436ebbb02bb0f4073a">make_dir</a>(dest, len, domain, username, folder);</div><div class="line"><a name="l01561"></a><span class="lineno"> 1561</span>&#160;   <span class="keywordflow">if</span> ((res = <a class="code" href="../../d5/d60/utils_8h.html#a7c38859ed90e96df2b0a0fdf843769d0">ast_mkdir</a>(dest, 0777))) {</div><div class="line"><a name="l01562"></a><span class="lineno"> 1562</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;ast_mkdir &#39;%s&#39; failed: %s\n&quot;</span>, dest, strerror(res));</div><div class="line"><a name="l01563"></a><span class="lineno"> 1563</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l01564"></a><span class="lineno"> 1564</span>&#160;   }</div><div class="line"><a name="l01565"></a><span class="lineno"> 1565</span>&#160;   <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(2, <span class="stringliteral">&quot;Creating directory for %s@%s folder %s : %s\n&quot;</span>, username, domain, folder, dest);</div><div class="line"><a name="l01566"></a><span class="lineno"> 1566</span>&#160;   <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l01567"></a><span class="lineno"> 1567</span>&#160;}</div><div class="line"><a name="l01568"></a><span class="lineno"> 1568</span>&#160;</div><div class="line"><a name="l01569"></a><span class="lineno"> 1569</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01570"></a><span class="lineno"> 1570</span>&#160;<span class="comment">/*!\internal</span></div><div class="line"><a name="l01571"></a><span class="lineno"> 1571</span>&#160;<span class="comment"> * \brief Play intro message before recording voicemail</span></div><div class="line"><a name="l01572"></a><span class="lineno"> 1572</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l01573"></a><span class="lineno"><a class="line" href="../../de/dfe/app__minivm_8c.html#ab05c8faac94f3e02ace2458247075f21"> 1573</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../de/dfe/app__minivm_8c.html#ab05c8faac94f3e02ace2458247075f21">invent_message</a>(<span class="keyword">struct</span> <a class="code" href="../../df/d3c/structast__channel.html">ast_channel</a> *chan, <span class="keywordtype">char</span> *<a class="code" href="../../dd/dac/structdomain.html">domain</a>, <span class="keywordtype">char</span> *<a class="code" href="../../dc/d7b/structminivm__account.html#a4b30874d24514b5ef6ff5276e8c12ed4">username</a>, <span class="keywordtype">int</span> busy, <span class="keywordtype">char</span> *ecodes)</div><div class="line"><a name="l01574"></a><span class="lineno"> 1574</span>&#160;{</div><div class="line"><a name="l01575"></a><span class="lineno"> 1575</span>&#160;   <span class="keywordtype">int</span> res;</div><div class="line"><a name="l01576"></a><span class="lineno"> 1576</span>&#160;   <span class="keywordtype">char</span> fn[<a class="code" href="../../db/db2/asterisk_8h.html#ae688d728e1acdfe5988c7db45d6f0166">PATH_MAX</a>];</div><div class="line"><a name="l01577"></a><span class="lineno"> 1577</span>&#160;</div><div class="line"><a name="l01578"></a><span class="lineno"> 1578</span>&#160;   <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(2, <span class="stringliteral">&quot;Still preparing to play message ...\n&quot;</span>);</div><div class="line"><a name="l01579"></a><span class="lineno"> 1579</span>&#160;</div><div class="line"><a name="l01580"></a><span class="lineno"> 1580</span>&#160;   snprintf(fn, <span class="keyword">sizeof</span>(fn), <span class="stringliteral">&quot;%s%s/%s/greet&quot;</span>, <a class="code" href="../../de/dfe/app__minivm_8c.html#ab94d2ef3acf22b2bf9410c48462c7cb1">MVM_SPOOL_DIR</a>, domain, username);</div><div class="line"><a name="l01581"></a><span class="lineno"> 1581</span>&#160;</div><div class="line"><a name="l01582"></a><span class="lineno"> 1582</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d2/d4d/file_8h.html#ab9b8ab8e5ee34c9b4da25779255cafde">ast_fileexists</a>(fn, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) &gt; 0) {</div><div class="line"><a name="l01583"></a><span class="lineno"> 1583</span>&#160;      res = <a class="code" href="../../d2/d4d/file_8h.html#a67c7e271b4ca70aca6d48fd48d121857">ast_streamfile</a>(chan, fn, <a class="code" href="../../d5/d7b/channel_8h.html#a9abe31fe40dcd03cd2957e5309e32ac6">ast_channel_language</a>(chan));</div><div class="line"><a name="l01584"></a><span class="lineno"> 1584</span>&#160;      <span class="keywordflow">if</span> (res)</div><div class="line"><a name="l01585"></a><span class="lineno"> 1585</span>&#160;         <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l01586"></a><span class="lineno"> 1586</span>&#160;      res = <a class="code" href="../../d2/d4d/file_8h.html#affc21cb57c6bf72a2cb7ec8a379b2137">ast_waitstream</a>(chan, ecodes);</div><div class="line"><a name="l01587"></a><span class="lineno"> 1587</span>&#160;      <span class="keywordflow">if</span> (res)</div><div class="line"><a name="l01588"></a><span class="lineno"> 1588</span>&#160;         <span class="keywordflow">return</span> res;</div><div class="line"><a name="l01589"></a><span class="lineno"> 1589</span>&#160;   } <span class="keywordflow">else</span> {</div><div class="line"><a name="l01590"></a><span class="lineno"> 1590</span>&#160;      <span class="keywordtype">int</span> numericusername = 1;</div><div class="line"><a name="l01591"></a><span class="lineno"> 1591</span>&#160;      <span class="keywordtype">char</span> *i = <a class="code" href="../../dc/d7b/structminivm__account.html#a4b30874d24514b5ef6ff5276e8c12ed4">username</a>;</div><div class="line"><a name="l01592"></a><span class="lineno"> 1592</span>&#160;</div><div class="line"><a name="l01593"></a><span class="lineno"> 1593</span>&#160;      <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(2, <span class="stringliteral">&quot;No personal prompts. Using default prompt set for language\n&quot;</span>);</div><div class="line"><a name="l01594"></a><span class="lineno"> 1594</span>&#160;</div><div class="line"><a name="l01595"></a><span class="lineno"> 1595</span>&#160;      <span class="keywordflow">while</span> (*i)  {</div><div class="line"><a name="l01596"></a><span class="lineno"> 1596</span>&#160;         <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(2, <span class="stringliteral">&quot;Numeric? Checking %c\n&quot;</span>, *i);</div><div class="line"><a name="l01597"></a><span class="lineno"> 1597</span>&#160;         <span class="keywordflow">if</span> (!isdigit(*i)) {</div><div class="line"><a name="l01598"></a><span class="lineno"> 1598</span>&#160;            numericusername = <a class="code" href="../../de/dfe/app__minivm_8c.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;</div><div class="line"><a name="l01599"></a><span class="lineno"> 1599</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l01600"></a><span class="lineno"> 1600</span>&#160;         }</div><div class="line"><a name="l01601"></a><span class="lineno"> 1601</span>&#160;         i++;</div><div class="line"><a name="l01602"></a><span class="lineno"> 1602</span>&#160;      }</div><div class="line"><a name="l01603"></a><span class="lineno"> 1603</span>&#160;</div><div class="line"><a name="l01604"></a><span class="lineno"> 1604</span>&#160;      <span class="keywordflow">if</span> (numericusername) {</div><div class="line"><a name="l01605"></a><span class="lineno"> 1605</span>&#160;         <span class="keywordflow">if</span> (<a class="code" href="../../d2/d4d/file_8h.html#a67c7e271b4ca70aca6d48fd48d121857">ast_streamfile</a>(chan, <span class="stringliteral">&quot;vm-theperson&quot;</span>, <a class="code" href="../../d5/d7b/channel_8h.html#a9abe31fe40dcd03cd2957e5309e32ac6">ast_channel_language</a>(chan)))</div><div class="line"><a name="l01606"></a><span class="lineno"> 1606</span>&#160;            <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l01607"></a><span class="lineno"> 1607</span>&#160;         <span class="keywordflow">if</span> ((res = <a class="code" href="../../d2/d4d/file_8h.html#affc21cb57c6bf72a2cb7ec8a379b2137">ast_waitstream</a>(chan, ecodes)))</div><div class="line"><a name="l01608"></a><span class="lineno"> 1608</span>&#160;            <span class="keywordflow">return</span> res;</div><div class="line"><a name="l01609"></a><span class="lineno"> 1609</span>&#160;</div><div class="line"><a name="l01610"></a><span class="lineno"> 1610</span>&#160;         res = <a class="code" href="../../db/dce/say_8h.html#ac8bd6c34b6aa664adb9ebfab68a500ce">ast_say_digit_str</a>(chan, username, ecodes, <a class="code" href="../../d5/d7b/channel_8h.html#a9abe31fe40dcd03cd2957e5309e32ac6">ast_channel_language</a>(chan));</div><div class="line"><a name="l01611"></a><span class="lineno"> 1611</span>&#160;         <span class="keywordflow">if</span> (res)</div><div class="line"><a name="l01612"></a><span class="lineno"> 1612</span>&#160;            <span class="keywordflow">return</span> res;</div><div class="line"><a name="l01613"></a><span class="lineno"> 1613</span>&#160;      } <span class="keywordflow">else</span> {</div><div class="line"><a name="l01614"></a><span class="lineno"> 1614</span>&#160;         <span class="keywordflow">if</span> (<a class="code" href="../../d2/d4d/file_8h.html#a67c7e271b4ca70aca6d48fd48d121857">ast_streamfile</a>(chan, <span class="stringliteral">&quot;vm-theextensionis&quot;</span>, <a class="code" href="../../d5/d7b/channel_8h.html#a9abe31fe40dcd03cd2957e5309e32ac6">ast_channel_language</a>(chan)))</div><div class="line"><a name="l01615"></a><span class="lineno"> 1615</span>&#160;            <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l01616"></a><span class="lineno"> 1616</span>&#160;         <span class="keywordflow">if</span> ((res = <a class="code" href="../../d2/d4d/file_8h.html#affc21cb57c6bf72a2cb7ec8a379b2137">ast_waitstream</a>(chan, ecodes)))</div><div class="line"><a name="l01617"></a><span class="lineno"> 1617</span>&#160;            <span class="keywordflow">return</span> res;</div><div class="line"><a name="l01618"></a><span class="lineno"> 1618</span>&#160;      }</div><div class="line"><a name="l01619"></a><span class="lineno"> 1619</span>&#160;   }</div><div class="line"><a name="l01620"></a><span class="lineno"> 1620</span>&#160;</div><div class="line"><a name="l01621"></a><span class="lineno"> 1621</span>&#160;   res = <a class="code" href="../../d2/d4d/file_8h.html#a67c7e271b4ca70aca6d48fd48d121857">ast_streamfile</a>(chan, busy ? <span class="stringliteral">&quot;vm-isonphone&quot;</span> : <span class="stringliteral">&quot;vm-isunavail&quot;</span>, <a class="code" href="../../d5/d7b/channel_8h.html#a9abe31fe40dcd03cd2957e5309e32ac6">ast_channel_language</a>(chan));</div><div class="line"><a name="l01622"></a><span class="lineno"> 1622</span>&#160;   <span class="keywordflow">if</span> (res)</div><div class="line"><a name="l01623"></a><span class="lineno"> 1623</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l01624"></a><span class="lineno"> 1624</span>&#160;   res = <a class="code" href="../../d2/d4d/file_8h.html#affc21cb57c6bf72a2cb7ec8a379b2137">ast_waitstream</a>(chan, ecodes);</div><div class="line"><a name="l01625"></a><span class="lineno"> 1625</span>&#160;   <span class="keywordflow">return</span> res;</div><div class="line"><a name="l01626"></a><span class="lineno"> 1626</span>&#160;}</div><div class="line"><a name="l01627"></a><span class="lineno"> 1627</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01628"></a><span class="lineno"> 1628</span>&#160;<span class="comment">/*!\internal</span></div><div class="line"><a name="l01629"></a><span class="lineno"> 1629</span>&#160;<span class="comment"> * \brief Delete media files and attribute file */</span></div><div class="line"><a name="l01630"></a><span class="lineno"><a class="line" href="../../de/dfe/app__minivm_8c.html#a1efddf47b6f25c6e1b97e064e35c214e"> 1630</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../de/dfe/app__minivm_8c.html#a1efddf47b6f25c6e1b97e064e35c214e">vm_delete</a>(<span class="keywordtype">char</span> *<a class="code" href="../../d2/dc8/namespacemake__ari__stubs.html#a40a5d58ffa6e88aa578d6683ac413105">file</a>)</div><div class="line"><a name="l01631"></a><span class="lineno"> 1631</span>&#160;{</div><div class="line"><a name="l01632"></a><span class="lineno"> 1632</span>&#160;   <span class="keywordtype">int</span> res;</div><div class="line"><a name="l01633"></a><span class="lineno"> 1633</span>&#160;</div><div class="line"><a name="l01634"></a><span class="lineno"> 1634</span>&#160;   <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(1, <span class="stringliteral">&quot;Deleting voicemail file %s\n&quot;</span>, file);</div><div class="line"><a name="l01635"></a><span class="lineno"> 1635</span>&#160;</div><div class="line"><a name="l01636"></a><span class="lineno"> 1636</span>&#160;   res = unlink(file);  <span class="comment">/* Remove the meta data file */</span></div><div class="line"><a name="l01637"></a><span class="lineno"> 1637</span>&#160;   res |=  <a class="code" href="../../d2/d4d/file_8h.html#adb15d6efecc1a13b8835bee6d3562ddb">ast_filedelete</a>(file, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>); <span class="comment">/* remove the media file */</span></div><div class="line"><a name="l01638"></a><span class="lineno"> 1638</span>&#160;   <span class="keywordflow">return</span> res;</div><div class="line"><a name="l01639"></a><span class="lineno"> 1639</span>&#160;}</div><div class="line"><a name="l01640"></a><span class="lineno"> 1640</span>&#160;</div><div class="line"><a name="l01641"></a><span class="lineno"> 1641</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01642"></a><span class="lineno"> 1642</span>&#160;<span class="comment">/*!\internal</span></div><div class="line"><a name="l01643"></a><span class="lineno"> 1643</span>&#160;<span class="comment"> * \brief Record voicemail message &amp; let caller review or re-record it, or set options if applicable */</span></div><div class="line"><a name="l01644"></a><span class="lineno"><a class="line" href="../../de/dfe/app__minivm_8c.html#a9900bfa7d5724fe84c74fec928f49052"> 1644</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../de/dfe/app__minivm_8c.html#a9900bfa7d5724fe84c74fec928f49052">play_record_review</a>(<span class="keyword">struct</span> <a class="code" href="../../df/d3c/structast__channel.html">ast_channel</a> *chan, <span class="keywordtype">char</span> *playfile, <span class="keywordtype">char</span> *recordfile, <span class="keywordtype">int</span> maxtime, <span class="keywordtype">char</span> *fmt,</div><div class="line"><a name="l01645"></a><span class="lineno"> 1645</span>&#160;               <span class="keywordtype">int</span> outsidecaller, <span class="keyword">struct</span> <a class="code" href="../../dc/d7b/structminivm__account.html">minivm_account</a> *vmu, <span class="keywordtype">int</span> *duration, <span class="keywordtype">int</span> *sound_duration, <span class="keyword">const</span> <span class="keywordtype">char</span> *unlockdir,</div><div class="line"><a name="l01646"></a><span class="lineno"> 1646</span>&#160;               <span class="keywordtype">signed</span> <span class="keywordtype">char</span> record_gain)</div><div class="line"><a name="l01647"></a><span class="lineno"> 1647</span>&#160;{</div><div class="line"><a name="l01648"></a><span class="lineno"> 1648</span>&#160;   <span class="keywordtype">int</span> cmd = 0;</div><div class="line"><a name="l01649"></a><span class="lineno"> 1649</span>&#160;   <span class="keywordtype">int</span> max_attempts = 3;</div><div class="line"><a name="l01650"></a><span class="lineno"> 1650</span>&#160;   <span class="keywordtype">int</span> attempts = 0;</div><div class="line"><a name="l01651"></a><span class="lineno"> 1651</span>&#160;   <span class="keywordtype">int</span> recorded = 0;</div><div class="line"><a name="l01652"></a><span class="lineno"> 1652</span>&#160;   <span class="keywordtype">int</span> message_exists = 0;</div><div class="line"><a name="l01653"></a><span class="lineno"> 1653</span>&#160;   <span class="keywordtype">signed</span> <span class="keywordtype">char</span> zero_gain = 0;</div><div class="line"><a name="l01654"></a><span class="lineno"> 1654</span>&#160;   <span class="keywordtype">char</span> *acceptdtmf = <span class="stringliteral">&quot;#&quot;</span>;</div><div class="line"><a name="l01655"></a><span class="lineno"> 1655</span>&#160;   <span class="keywordtype">char</span> *canceldtmf = <span class="stringliteral">&quot;&quot;</span>;</div><div class="line"><a name="l01656"></a><span class="lineno"> 1656</span>&#160;</div><div class="line"><a name="l01657"></a><span class="lineno"> 1657</span>&#160;   <span class="comment">/* Note that urgent and private are for flagging messages as such in the future */</span></div><div class="line"><a name="l01658"></a><span class="lineno"> 1658</span>&#160;</div><div class="line"><a name="l01659"></a><span class="lineno"> 1659</span>&#160;   <span class="comment">/* barf if no pointer passed to store duration in */</span></div><div class="line"><a name="l01660"></a><span class="lineno"> 1660</span>&#160;   <span class="keywordflow">if</span> (duration == <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {</div><div class="line"><a name="l01661"></a><span class="lineno"> 1661</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Error play_record_review called without duration pointer\n&quot;</span>);</div><div class="line"><a name="l01662"></a><span class="lineno"> 1662</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l01663"></a><span class="lineno"> 1663</span>&#160;   }</div><div class="line"><a name="l01664"></a><span class="lineno"> 1664</span>&#160;</div><div class="line"><a name="l01665"></a><span class="lineno"> 1665</span>&#160;   cmd = <span class="charliteral">&#39;3&#39;</span>;   <span class="comment">/* Want to start by recording */</span></div><div class="line"><a name="l01666"></a><span class="lineno"> 1666</span>&#160;</div><div class="line"><a name="l01667"></a><span class="lineno"> 1667</span>&#160;   <span class="keywordflow">while</span> ((cmd &gt;= 0) &amp;&amp; (cmd != <span class="charliteral">&#39;t&#39;</span>)) {</div><div class="line"><a name="l01668"></a><span class="lineno"> 1668</span>&#160;      <span class="keywordflow">switch</span> (cmd) {</div><div class="line"><a name="l01669"></a><span class="lineno"> 1669</span>&#160;      <span class="keywordflow">case</span> <span class="charliteral">&#39;1&#39;</span>:</div><div class="line"><a name="l01670"></a><span class="lineno"> 1670</span>&#160;         <a class="code" href="../../d1/d8c/logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(3, <span class="stringliteral">&quot;Saving message as is\n&quot;</span>);</div><div class="line"><a name="l01671"></a><span class="lineno"> 1671</span>&#160;         <a class="code" href="../../d2/d4d/file_8h.html#a95b94a020720147325a486e210b36775">ast_stream_and_wait</a>(chan, <span class="stringliteral">&quot;vm-msgsaved&quot;</span>, <span class="stringliteral">&quot;&quot;</span>);</div><div class="line"><a name="l01672"></a><span class="lineno"> 1672</span>&#160;         cmd = <span class="charliteral">&#39;t&#39;</span>;</div><div class="line"><a name="l01673"></a><span class="lineno"> 1673</span>&#160;         <span class="keywordflow">break</span>;</div><div class="line"><a name="l01674"></a><span class="lineno"> 1674</span>&#160;      <span class="keywordflow">case</span> <span class="charliteral">&#39;2&#39;</span>:</div><div class="line"><a name="l01675"></a><span class="lineno"> 1675</span>&#160;         <span class="comment">/* Review */</span></div><div class="line"><a name="l01676"></a><span class="lineno"> 1676</span>&#160;         <a class="code" href="../../d1/d8c/logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(3, <span class="stringliteral">&quot;Reviewing the message\n&quot;</span>);</div><div class="line"><a name="l01677"></a><span class="lineno"> 1677</span>&#160;         <a class="code" href="../../d2/d4d/file_8h.html#a67c7e271b4ca70aca6d48fd48d121857">ast_streamfile</a>(chan, recordfile, <a class="code" href="../../d5/d7b/channel_8h.html#a9abe31fe40dcd03cd2957e5309e32ac6">ast_channel_language</a>(chan));</div><div class="line"><a name="l01678"></a><span class="lineno"> 1678</span>&#160;         cmd = <a class="code" href="../../d2/d4d/file_8h.html#affc21cb57c6bf72a2cb7ec8a379b2137">ast_waitstream</a>(chan, <a class="code" href="../../d2/d4d/file_8h.html#afa92b0106fb7a918ea994c2867ac0a04">AST_DIGIT_ANY</a>);</div><div class="line"><a name="l01679"></a><span class="lineno"> 1679</span>&#160;         <span class="keywordflow">break</span>;</div><div class="line"><a name="l01680"></a><span class="lineno"> 1680</span>&#160;      <span class="keywordflow">case</span> <span class="charliteral">&#39;3&#39;</span>:</div><div class="line"><a name="l01681"></a><span class="lineno"> 1681</span>&#160;         message_exists = 0;</div><div class="line"><a name="l01682"></a><span class="lineno"> 1682</span>&#160;         <span class="comment">/* Record */</span></div><div class="line"><a name="l01683"></a><span class="lineno"> 1683</span>&#160;         <span class="keywordflow">if</span> (recorded == 1)</div><div class="line"><a name="l01684"></a><span class="lineno"> 1684</span>&#160;            <a class="code" href="../../d1/d8c/logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(3, <span class="stringliteral">&quot;Re-recording the message\n&quot;</span>);</div><div class="line"><a name="l01685"></a><span class="lineno"> 1685</span>&#160;         <span class="keywordflow">else</span></div><div class="line"><a name="l01686"></a><span class="lineno"> 1686</span>&#160;            <a class="code" href="../../d1/d8c/logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(3, <span class="stringliteral">&quot;Recording the message\n&quot;</span>);</div><div class="line"><a name="l01687"></a><span class="lineno"> 1687</span>&#160;         <span class="keywordflow">if</span> (recorded &amp;&amp; outsidecaller)</div><div class="line"><a name="l01688"></a><span class="lineno"> 1688</span>&#160;            cmd = <a class="code" href="../../d3/d93/include_2asterisk_2app_8h.html#abbbec6ab9a303e865a1d1a261152540d">ast_play_and_wait</a>(chan, <span class="stringliteral">&quot;beep&quot;</span>);</div><div class="line"><a name="l01689"></a><span class="lineno"> 1689</span>&#160;         recorded = 1;</div><div class="line"><a name="l01690"></a><span class="lineno"> 1690</span>&#160;         <span class="comment">/* After an attempt has been made to record message, we have to take care of INTRO and beep for incoming messages, but not for greetings */</span></div><div class="line"><a name="l01691"></a><span class="lineno"> 1691</span>&#160;         <span class="keywordflow">if</span> (record_gain)</div><div class="line"><a name="l01692"></a><span class="lineno"> 1692</span>&#160;            <a class="code" href="../../d5/d7b/channel_8h.html#adcfd8d241b6de48068ead143ac29978d">ast_channel_setoption</a>(chan, <a class="code" href="../../d6/d66/include_2asterisk_2frame_8h.html#a3e9274bcddca58b613f4e676b9943c03">AST_OPTION_RXGAIN</a>, &amp;record_gain, <span class="keyword">sizeof</span>(record_gain), 0);</div><div class="line"><a name="l01693"></a><span class="lineno"> 1693</span>&#160;         <span class="keywordflow">if</span> (<a class="code" href="../../d5/d60/utils_8h.html#a00d4c9254c9827d6fa44f17a326744a5">ast_test_flag</a>(vmu, <a class="code" href="../../de/dfe/app__minivm_8c.html#ac06da19dda21a4bac4970057bf72497a">MVM_OPERATOR</a>))</div><div class="line"><a name="l01694"></a><span class="lineno"> 1694</span>&#160;            canceldtmf = <span class="stringliteral">&quot;0&quot;</span>;</div><div class="line"><a name="l01695"></a><span class="lineno"> 1695</span>&#160;         cmd = <a class="code" href="../../d3/d93/include_2asterisk_2app_8h.html#a13a3ff0da2d7d40198b3eafbde0464a0">ast_play_and_record_full</a>(chan, playfile, recordfile, maxtime, fmt, duration, sound_duration, 0, global_silencethreshold, global_maxsilence, unlockdir, acceptdtmf, canceldtmf, 0, <a class="code" href="../../d3/d93/include_2asterisk_2app_8h.html#ac665722c9bfe6d9b506df95184aa236da8022c0ca0ab8535428aed27423a40e2c">AST_RECORD_IF_EXISTS_OVERWRITE</a>);</div><div class="line"><a name="l01696"></a><span class="lineno"> 1696</span>&#160;         <span class="keywordflow">if</span> (record_gain)</div><div class="line"><a name="l01697"></a><span class="lineno"> 1697</span>&#160;            <a class="code" href="../../d5/d7b/channel_8h.html#adcfd8d241b6de48068ead143ac29978d">ast_channel_setoption</a>(chan, <a class="code" href="../../d6/d66/include_2asterisk_2frame_8h.html#a3e9274bcddca58b613f4e676b9943c03">AST_OPTION_RXGAIN</a>, &amp;zero_gain, <span class="keyword">sizeof</span>(zero_gain), 0);</div><div class="line"><a name="l01698"></a><span class="lineno"> 1698</span>&#160;         <span class="keywordflow">if</span> (cmd == -1) <span class="comment">/* User has hung up, no options to give */</span></div><div class="line"><a name="l01699"></a><span class="lineno"> 1699</span>&#160;            <span class="keywordflow">return</span> cmd;</div><div class="line"><a name="l01700"></a><span class="lineno"> 1700</span>&#160;         <span class="keywordflow">if</span> (cmd == <span class="charliteral">&#39;0&#39;</span>)</div><div class="line"><a name="l01701"></a><span class="lineno"> 1701</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l01702"></a><span class="lineno"> 1702</span>&#160;         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (cmd == <span class="charliteral">&#39;*&#39;</span>)</div><div class="line"><a name="l01703"></a><span class="lineno"> 1703</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l01704"></a><span class="lineno"> 1704</span>&#160;         <span class="keywordflow">else</span> {</div><div class="line"><a name="l01705"></a><span class="lineno"> 1705</span>&#160;            <span class="comment">/* If all is well, a message exists */</span></div><div class="line"><a name="l01706"></a><span class="lineno"> 1706</span>&#160;            message_exists = 1;</div><div class="line"><a name="l01707"></a><span class="lineno"> 1707</span>&#160;            cmd = 0;</div><div class="line"><a name="l01708"></a><span class="lineno"> 1708</span>&#160;         }</div><div class="line"><a name="l01709"></a><span class="lineno"> 1709</span>&#160;         <span class="keywordflow">break</span>;</div><div class="line"><a name="l01710"></a><span class="lineno"> 1710</span>&#160;      <span class="keywordflow">case</span> <span class="charliteral">&#39;4&#39;</span>:</div><div class="line"><a name="l01711"></a><span class="lineno"> 1711</span>&#160;      <span class="keywordflow">case</span> <span class="charliteral">&#39;5&#39;</span>:</div><div class="line"><a name="l01712"></a><span class="lineno"> 1712</span>&#160;      <span class="keywordflow">case</span> <span class="charliteral">&#39;6&#39;</span>:</div><div class="line"><a name="l01713"></a><span class="lineno"> 1713</span>&#160;      <span class="keywordflow">case</span> <span class="charliteral">&#39;7&#39;</span>:</div><div class="line"><a name="l01714"></a><span class="lineno"> 1714</span>&#160;      <span class="keywordflow">case</span> <span class="charliteral">&#39;8&#39;</span>:</div><div class="line"><a name="l01715"></a><span class="lineno"> 1715</span>&#160;      <span class="keywordflow">case</span> <span class="charliteral">&#39;9&#39;</span>:</div><div class="line"><a name="l01716"></a><span class="lineno"> 1716</span>&#160;      <span class="keywordflow">case</span> <span class="charliteral">&#39;*&#39;</span>:</div><div class="line"><a name="l01717"></a><span class="lineno"> 1717</span>&#160;      <span class="keywordflow">case</span> <span class="charliteral">&#39;#&#39;</span>:</div><div class="line"><a name="l01718"></a><span class="lineno"> 1718</span>&#160;         cmd = <a class="code" href="../../d3/d93/include_2asterisk_2app_8h.html#abbbec6ab9a303e865a1d1a261152540d">ast_play_and_wait</a>(chan, <span class="stringliteral">&quot;vm-sorry&quot;</span>);</div><div class="line"><a name="l01719"></a><span class="lineno"> 1719</span>&#160;         <span class="keywordflow">break</span>;</div><div class="line"><a name="l01720"></a><span class="lineno"> 1720</span>&#160;      <span class="keywordflow">case</span> <span class="charliteral">&#39;0&#39;</span>:</div><div class="line"><a name="l01721"></a><span class="lineno"> 1721</span>&#160;         <span class="keywordflow">if</span>(!<a class="code" href="../../d5/d60/utils_8h.html#a00d4c9254c9827d6fa44f17a326744a5">ast_test_flag</a>(vmu, <a class="code" href="../../de/dfe/app__minivm_8c.html#ac06da19dda21a4bac4970057bf72497a">MVM_OPERATOR</a>)) {</div><div class="line"><a name="l01722"></a><span class="lineno"> 1722</span>&#160;            cmd = <a class="code" href="../../d3/d93/include_2asterisk_2app_8h.html#abbbec6ab9a303e865a1d1a261152540d">ast_play_and_wait</a>(chan, <span class="stringliteral">&quot;vm-sorry&quot;</span>);</div><div class="line"><a name="l01723"></a><span class="lineno"> 1723</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l01724"></a><span class="lineno"> 1724</span>&#160;         }</div><div class="line"><a name="l01725"></a><span class="lineno"> 1725</span>&#160;         <span class="keywordflow">if</span> (message_exists || recorded) {</div><div class="line"><a name="l01726"></a><span class="lineno"> 1726</span>&#160;            cmd = <a class="code" href="../../d3/d93/include_2asterisk_2app_8h.html#abbbec6ab9a303e865a1d1a261152540d">ast_play_and_wait</a>(chan, <span class="stringliteral">&quot;vm-saveoper&quot;</span>);</div><div class="line"><a name="l01727"></a><span class="lineno"> 1727</span>&#160;            <span class="keywordflow">if</span> (!cmd)</div><div class="line"><a name="l01728"></a><span class="lineno"> 1728</span>&#160;               cmd = <a class="code" href="../../d5/d7b/channel_8h.html#a050bec9a4abc1a599b6573a6091b080c">ast_waitfordigit</a>(chan, 3000);</div><div class="line"><a name="l01729"></a><span class="lineno"> 1729</span>&#160;            <span class="keywordflow">if</span> (cmd == <span class="charliteral">&#39;1&#39;</span>) {</div><div class="line"><a name="l01730"></a><span class="lineno"> 1730</span>&#160;               <a class="code" href="../../d3/d93/include_2asterisk_2app_8h.html#abbbec6ab9a303e865a1d1a261152540d">ast_play_and_wait</a>(chan, <span class="stringliteral">&quot;vm-msgsaved&quot;</span>);</div><div class="line"><a name="l01731"></a><span class="lineno"> 1731</span>&#160;               cmd = <span class="charliteral">&#39;0&#39;</span>;</div><div class="line"><a name="l01732"></a><span class="lineno"> 1732</span>&#160;            } <span class="keywordflow">else</span> {</div><div class="line"><a name="l01733"></a><span class="lineno"> 1733</span>&#160;               <a class="code" href="../../d3/d93/include_2asterisk_2app_8h.html#abbbec6ab9a303e865a1d1a261152540d">ast_play_and_wait</a>(chan, <span class="stringliteral">&quot;vm-deleted&quot;</span>);</div><div class="line"><a name="l01734"></a><span class="lineno"> 1734</span>&#160;               <a class="code" href="../../de/dfe/app__minivm_8c.html#a1efddf47b6f25c6e1b97e064e35c214e">vm_delete</a>(recordfile);</div><div class="line"><a name="l01735"></a><span class="lineno"> 1735</span>&#160;               cmd = <span class="charliteral">&#39;0&#39;</span>;</div><div class="line"><a name="l01736"></a><span class="lineno"> 1736</span>&#160;            }</div><div class="line"><a name="l01737"></a><span class="lineno"> 1737</span>&#160;         }</div><div class="line"><a name="l01738"></a><span class="lineno"> 1738</span>&#160;         <span class="keywordflow">return</span> cmd;</div><div class="line"><a name="l01739"></a><span class="lineno"> 1739</span>&#160;      <span class="keywordflow">default</span>:</div><div class="line"><a name="l01740"></a><span class="lineno"> 1740</span>&#160;         <span class="comment">/* If the caller is an ouside caller, and the review option is enabled,</span></div><div class="line"><a name="l01741"></a><span class="lineno"> 1741</span>&#160;<span class="comment">            allow them to review the message, but let the owner of the box review</span></div><div class="line"><a name="l01742"></a><span class="lineno"> 1742</span>&#160;<span class="comment">            their OGM&#39;s */</span></div><div class="line"><a name="l01743"></a><span class="lineno"> 1743</span>&#160;         <span class="keywordflow">if</span> (outsidecaller &amp;&amp; !<a class="code" href="../../d5/d60/utils_8h.html#a00d4c9254c9827d6fa44f17a326744a5">ast_test_flag</a>(vmu, <a class="code" href="../../de/dfe/app__minivm_8c.html#a251b3dd38bf79c9b6d4fdc86ef63f0a8">MVM_REVIEW</a>))</div><div class="line"><a name="l01744"></a><span class="lineno"> 1744</span>&#160;            <span class="keywordflow">return</span> cmd;</div><div class="line"><a name="l01745"></a><span class="lineno"> 1745</span>&#160;         <span class="keywordflow">if</span> (message_exists) {</div><div class="line"><a name="l01746"></a><span class="lineno"> 1746</span>&#160;            cmd = <a class="code" href="../../d3/d93/include_2asterisk_2app_8h.html#abbbec6ab9a303e865a1d1a261152540d">ast_play_and_wait</a>(chan, <span class="stringliteral">&quot;vm-review&quot;</span>);</div><div class="line"><a name="l01747"></a><span class="lineno"> 1747</span>&#160;         } <span class="keywordflow">else</span> {</div><div class="line"><a name="l01748"></a><span class="lineno"> 1748</span>&#160;            cmd = <a class="code" href="../../d3/d93/include_2asterisk_2app_8h.html#abbbec6ab9a303e865a1d1a261152540d">ast_play_and_wait</a>(chan, <span class="stringliteral">&quot;vm-torerecord&quot;</span>);</div><div class="line"><a name="l01749"></a><span class="lineno"> 1749</span>&#160;            <span class="keywordflow">if</span> (!cmd)</div><div class="line"><a name="l01750"></a><span class="lineno"> 1750</span>&#160;               cmd = <a class="code" href="../../d5/d7b/channel_8h.html#a050bec9a4abc1a599b6573a6091b080c">ast_waitfordigit</a>(chan, 600);</div><div class="line"><a name="l01751"></a><span class="lineno"> 1751</span>&#160;         }</div><div class="line"><a name="l01752"></a><span class="lineno"> 1752</span>&#160;</div><div class="line"><a name="l01753"></a><span class="lineno"> 1753</span>&#160;         <span class="keywordflow">if</span> (!cmd &amp;&amp; outsidecaller &amp;&amp; <a class="code" href="../../d5/d60/utils_8h.html#a00d4c9254c9827d6fa44f17a326744a5">ast_test_flag</a>(vmu, <a class="code" href="../../de/dfe/app__minivm_8c.html#ac06da19dda21a4bac4970057bf72497a">MVM_OPERATOR</a>)) {</div><div class="line"><a name="l01754"></a><span class="lineno"> 1754</span>&#160;            cmd = <a class="code" href="../../d3/d93/include_2asterisk_2app_8h.html#abbbec6ab9a303e865a1d1a261152540d">ast_play_and_wait</a>(chan, <span class="stringliteral">&quot;vm-reachoper&quot;</span>);</div><div class="line"><a name="l01755"></a><span class="lineno"> 1755</span>&#160;            <span class="keywordflow">if</span> (!cmd)</div><div class="line"><a name="l01756"></a><span class="lineno"> 1756</span>&#160;               cmd = <a class="code" href="../../d5/d7b/channel_8h.html#a050bec9a4abc1a599b6573a6091b080c">ast_waitfordigit</a>(chan, 600);</div><div class="line"><a name="l01757"></a><span class="lineno"> 1757</span>&#160;         }</div><div class="line"><a name="l01758"></a><span class="lineno"> 1758</span>&#160;         <span class="keywordflow">if</span> (!cmd)</div><div class="line"><a name="l01759"></a><span class="lineno"> 1759</span>&#160;            cmd = <a class="code" href="../../d5/d7b/channel_8h.html#a050bec9a4abc1a599b6573a6091b080c">ast_waitfordigit</a>(chan, 6000);</div><div class="line"><a name="l01760"></a><span class="lineno"> 1760</span>&#160;         <span class="keywordflow">if</span> (!cmd) {</div><div class="line"><a name="l01761"></a><span class="lineno"> 1761</span>&#160;            attempts++;</div><div class="line"><a name="l01762"></a><span class="lineno"> 1762</span>&#160;         }</div><div class="line"><a name="l01763"></a><span class="lineno"> 1763</span>&#160;         <span class="keywordflow">if</span> (attempts &gt; max_attempts) {</div><div class="line"><a name="l01764"></a><span class="lineno"> 1764</span>&#160;            cmd = <span class="charliteral">&#39;t&#39;</span>;</div><div class="line"><a name="l01765"></a><span class="lineno"> 1765</span>&#160;         }</div><div class="line"><a name="l01766"></a><span class="lineno"> 1766</span>&#160;      }</div><div class="line"><a name="l01767"></a><span class="lineno"> 1767</span>&#160;   }</div><div class="line"><a name="l01768"></a><span class="lineno"> 1768</span>&#160;   <span class="keywordflow">if</span> (outsidecaller)</div><div class="line"><a name="l01769"></a><span class="lineno"> 1769</span>&#160;      <a class="code" href="../../d3/d93/include_2asterisk_2app_8h.html#abbbec6ab9a303e865a1d1a261152540d">ast_play_and_wait</a>(chan, <span class="stringliteral">&quot;vm-goodbye&quot;</span>);</div><div class="line"><a name="l01770"></a><span class="lineno"> 1770</span>&#160;   <span class="keywordflow">if</span> (cmd == <span class="charliteral">&#39;t&#39;</span>)</div><div class="line"><a name="l01771"></a><span class="lineno"> 1771</span>&#160;      cmd = 0;</div><div class="line"><a name="l01772"></a><span class="lineno"> 1772</span>&#160;   <span class="keywordflow">return</span> cmd;</div><div class="line"><a name="l01773"></a><span class="lineno"> 1773</span>&#160;}</div><div class="line"><a name="l01774"></a><span class="lineno"> 1774</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01775"></a><span class="lineno"> 1775</span>&#160;<span class="comment">/*! \brief Run external notification for voicemail message */</span></div><div class="line"><a name="l01776"></a><span class="lineno"><a class="line" href="../../de/dfe/app__minivm_8c.html#ad0499410b27e24fe126fcb124713c239"> 1776</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../de/dfe/app__minivm_8c.html#ad0499410b27e24fe126fcb124713c239">run_externnotify</a>(<span class="keyword">struct</span> <a class="code" href="../../df/d3c/structast__channel.html">ast_channel</a> *chan, <span class="keyword">struct</span> <a class="code" href="../../dc/d7b/structminivm__account.html">minivm_account</a> *vmu)</div><div class="line"><a name="l01777"></a><span class="lineno"> 1777</span>&#160;{</div><div class="line"><a name="l01778"></a><span class="lineno"> 1778</span>&#160;   <span class="keywordtype">char</span> fquser[<a class="code" href="../../d5/d7b/channel_8h.html#abcf1aea85b924e9cd605040b86241e2a">AST_MAX_CONTEXT</a> * 2];</div><div class="line"><a name="l01779"></a><span class="lineno"> 1779</span>&#160;   <span class="keywordtype">char</span> *argv[5] = { <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a> };</div><div class="line"><a name="l01780"></a><span class="lineno"> 1780</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d4/d77/structast__party__caller.html">ast_party_caller</a> *caller;</div><div class="line"><a name="l01781"></a><span class="lineno"> 1781</span>&#160;   <span class="keywordtype">char</span> *cid;</div><div class="line"><a name="l01782"></a><span class="lineno"> 1782</span>&#160;   <span class="keywordtype">int</span> idx;</div><div class="line"><a name="l01783"></a><span class="lineno"> 1783</span>&#160;</div><div class="line"><a name="l01784"></a><span class="lineno"> 1784</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a>(vmu-&gt;<a class="code" href="../../dc/d7b/structminivm__account.html#aa2f937e69f79fbfcbf13a8ca51adcce0">externnotify</a>) &amp;&amp; <a class="code" href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a>(global_externnotify)) {</div><div class="line"><a name="l01785"></a><span class="lineno"> 1785</span>&#160;      <span class="keywordflow">return</span>;</div><div class="line"><a name="l01786"></a><span class="lineno"> 1786</span>&#160;   }</div><div class="line"><a name="l01787"></a><span class="lineno"> 1787</span>&#160;</div><div class="line"><a name="l01788"></a><span class="lineno"> 1788</span>&#160;   snprintf(fquser, <span class="keyword">sizeof</span>(fquser), <span class="stringliteral">&quot;%s@%s&quot;</span>, vmu-&gt;<a class="code" href="../../dc/d7b/structminivm__account.html#a4b30874d24514b5ef6ff5276e8c12ed4">username</a>, vmu-&gt;<a class="code" href="../../dc/d7b/structminivm__account.html#ae43ea5d0335f149f0920d33e46b61c33">domain</a>);</div><div class="line"><a name="l01789"></a><span class="lineno"> 1789</span>&#160;</div><div class="line"><a name="l01790"></a><span class="lineno"> 1790</span>&#160;   caller = <a class="code" href="../../d5/d7b/channel_8h.html#ac2dc872b606534943c98304aed841b34">ast_channel_caller</a>(chan);</div><div class="line"><a name="l01791"></a><span class="lineno"> 1791</span>&#160;   idx = 0;</div><div class="line"><a name="l01792"></a><span class="lineno"> 1792</span>&#160;   argv[idx++] = <a class="code" href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a>(vmu-&gt;<a class="code" href="../../dc/d7b/structminivm__account.html#aa2f937e69f79fbfcbf13a8ca51adcce0">externnotify</a>) ? <a class="code" href="../../de/dfe/app__minivm_8c.html#ac95efb91330674db4cf67d25cde8ff3e">global_externnotify</a> : vmu-&gt;<a class="code" href="../../dc/d7b/structminivm__account.html#aa2f937e69f79fbfcbf13a8ca51adcce0">externnotify</a>;</div><div class="line"><a name="l01793"></a><span class="lineno"> 1793</span>&#160;   argv[idx++] = fquser;</div><div class="line"><a name="l01794"></a><span class="lineno"> 1794</span>&#160;   cid = <a class="code" href="../../d6/d90/strings_8h.html#a38a896048b2ca84076864505f0aa8f01">S_COR</a>(caller-&gt;<a class="code" href="../../d4/d77/structast__party__caller.html#a8791d240f8a9c2dc271a1c8542cfe8cc">id</a>.<a class="code" href="../../d1/dcb/structast__party__id.html#aab4036618469f3fa9ab26a22726ba2db">name</a>.<a class="code" href="../../d8/d6f/structast__party__name.html#aaa04218f9e3a9065afa8be2491da8904">valid</a>, caller-&gt;<a class="code" href="../../d4/d77/structast__party__caller.html#a8791d240f8a9c2dc271a1c8542cfe8cc">id</a>.<a class="code" href="../../d1/dcb/structast__party__id.html#aab4036618469f3fa9ab26a22726ba2db">name</a>.<a class="code" href="../../d8/d6f/structast__party__name.html#ab50d783982593ef993ea0b68f7ad8b80">str</a>, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div><div class="line"><a name="l01795"></a><span class="lineno"> 1795</span>&#160;   <span class="keywordflow">if</span> (cid) {</div><div class="line"><a name="l01796"></a><span class="lineno"> 1796</span>&#160;      argv[idx++] = cid;</div><div class="line"><a name="l01797"></a><span class="lineno"> 1797</span>&#160;   }</div><div class="line"><a name="l01798"></a><span class="lineno"> 1798</span>&#160;   cid = <a class="code" href="../../d6/d90/strings_8h.html#a38a896048b2ca84076864505f0aa8f01">S_COR</a>(caller-&gt;<a class="code" href="../../d4/d77/structast__party__caller.html#a8791d240f8a9c2dc271a1c8542cfe8cc">id</a>.<a class="code" href="../../d1/dcb/structast__party__id.html#aca2d7de6c89f201dc8bd0a2642d2a352">number</a>.<a class="code" href="../../d6/dbb/structast__party__number.html#aaa04218f9e3a9065afa8be2491da8904">valid</a>, caller-&gt;<a class="code" href="../../d4/d77/structast__party__caller.html#a8791d240f8a9c2dc271a1c8542cfe8cc">id</a>.<a class="code" href="../../d1/dcb/structast__party__id.html#aca2d7de6c89f201dc8bd0a2642d2a352">number</a>.<a class="code" href="../../d6/dbb/structast__party__number.html#ab50d783982593ef993ea0b68f7ad8b80">str</a>, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div><div class="line"><a name="l01799"></a><span class="lineno"> 1799</span>&#160;   <span class="keywordflow">if</span> (cid) {</div><div class="line"><a name="l01800"></a><span class="lineno"> 1800</span>&#160;      argv[idx++] = cid;</div><div class="line"><a name="l01801"></a><span class="lineno"> 1801</span>&#160;   }</div><div class="line"><a name="l01802"></a><span class="lineno"> 1802</span>&#160;   argv[idx] = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l01803"></a><span class="lineno"> 1803</span>&#160;</div><div class="line"><a name="l01804"></a><span class="lineno"> 1804</span>&#160;   <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(1, <span class="stringliteral">&quot;Executing: %s %s %s %s\n&quot;</span>,</div><div class="line"><a name="l01805"></a><span class="lineno"> 1805</span>&#160;      argv[0], argv[1], argv[2] ?: <span class="stringliteral">&quot;&quot;</span>, argv[3] ?: <span class="stringliteral">&quot;&quot;</span>);</div><div class="line"><a name="l01806"></a><span class="lineno"> 1806</span>&#160;   <a class="code" href="../../d3/d93/include_2asterisk_2app_8h.html#a410801e106c09f15f766d98f27b2852d">ast_safe_execvp</a>(1, argv[0], argv);</div><div class="line"><a name="l01807"></a><span class="lineno"> 1807</span>&#160;}</div><div class="line"><a name="l01808"></a><span class="lineno"> 1808</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01809"></a><span class="lineno"> 1809</span>&#160;<span class="comment">/*!\internal</span></div><div class="line"><a name="l01810"></a><span class="lineno"> 1810</span>&#160;<span class="comment"> * \brief Send message to voicemail account owner */</span></div><div class="line"><a name="l01811"></a><span class="lineno"><a class="line" href="../../de/dfe/app__minivm_8c.html#a922e4ae6e4c3f8a0ce361b0d3264ca54"> 1811</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../de/dfe/app__minivm_8c.html#a922e4ae6e4c3f8a0ce361b0d3264ca54">notify_new_message</a>(<span class="keyword">struct</span> <a class="code" href="../../df/d3c/structast__channel.html">ast_channel</a> *chan, <span class="keyword">const</span> <span class="keywordtype">char</span> *templatename, <span class="keyword">struct</span> <a class="code" href="../../dc/d7b/structminivm__account.html">minivm_account</a> *vmu, <span class="keyword">const</span> <span class="keywordtype">char</span> *filename, <span class="keywordtype">long</span> duration, <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="../../da/d45/chan__alsa_8c.html#a98f5e70e98f6dc48e3c5ba316066d540">format</a>, <span class="keywordtype">char</span> *cidnum, <span class="keywordtype">char</span> *cidname)</div><div class="line"><a name="l01812"></a><span class="lineno"> 1812</span>&#160;{</div><div class="line"><a name="l01813"></a><span class="lineno"> 1813</span>&#160;   <a class="code" href="../../d5/d60/utils_8h.html#a1604b4d72144dd3d9f7da668e90337e9">RAII_VAR</a>(<span class="keyword">struct</span> <a class="code" href="../../d1/da1/structast__json.html">ast_json</a> *, json_object, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../d4/d05/json_8h.html#a33bcd9181e613a659eefe411ec42c87c">ast_json_unref</a>);</div><div class="line"><a name="l01814"></a><span class="lineno"> 1814</span>&#160;   <a class="code" href="../../d5/d60/utils_8h.html#a1604b4d72144dd3d9f7da668e90337e9">RAII_VAR</a>(<span class="keyword">struct</span> <a class="code" href="../../d7/d55/structstasis__message.html">stasis_message</a> *, <a class="code" href="../../d8/d9e/structmessage.html">message</a>, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../d5/da5/astobj2_8h.html#a6321ee982370c55ab3c24c72c562cbdd">ao2_cleanup</a>);</div><div class="line"><a name="l01815"></a><span class="lineno"> 1815</span>&#160;   <a class="code" href="../../d5/d60/utils_8h.html#a1604b4d72144dd3d9f7da668e90337e9">RAII_VAR</a>(<span class="keyword">struct</span> <a class="code" href="../../d6/d45/structast__mwi__state.html">ast_mwi_state</a> *, mwi_state, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../d5/da5/astobj2_8h.html#a6321ee982370c55ab3c24c72c562cbdd">ao2_cleanup</a>);</div><div class="line"><a name="l01816"></a><span class="lineno"> 1816</span>&#160;   <span class="keywordtype">char</span> *stringp;</div><div class="line"><a name="l01817"></a><span class="lineno"> 1817</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../dc/d31/structminivm__template.html">minivm_template</a> *<a class="code" href="../../dc/d7b/structminivm__account.html#ad48036454496b4bfb945139d1ae878c4">etemplate</a>;</div><div class="line"><a name="l01818"></a><span class="lineno"> 1818</span>&#160;   <span class="keywordtype">char</span> *messageformat;</div><div class="line"><a name="l01819"></a><span class="lineno"> 1819</span>&#160;   <span class="keywordtype">int</span> res = 0;</div><div class="line"><a name="l01820"></a><span class="lineno"> 1820</span>&#160;   <span class="keywordtype">char</span> oldlocale[100];</div><div class="line"><a name="l01821"></a><span class="lineno"> 1821</span>&#160;   <span class="keyword">const</span> <span class="keywordtype">char</span> *counter;</div><div class="line"><a name="l01822"></a><span class="lineno"> 1822</span>&#160;</div><div class="line"><a name="l01823"></a><span class="lineno"> 1823</span>&#160;   <span class="keywordflow">if</span> (!<a class="code" href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a>(vmu-&gt;<a class="code" href="../../dc/d7b/structminivm__account.html#ae80eeef848853cf42dc025b36f0de488">attachfmt</a>)) {</div><div class="line"><a name="l01824"></a><span class="lineno"> 1824</span>&#160;      <span class="keywordflow">if</span> (strstr(format, vmu-&gt;<a class="code" href="../../dc/d7b/structminivm__account.html#ae80eeef848853cf42dc025b36f0de488">attachfmt</a>)) {</div><div class="line"><a name="l01825"></a><span class="lineno"> 1825</span>&#160;         format = vmu-&gt;<a class="code" href="../../dc/d7b/structminivm__account.html#ae80eeef848853cf42dc025b36f0de488">attachfmt</a>;</div><div class="line"><a name="l01826"></a><span class="lineno"> 1826</span>&#160;      } <span class="keywordflow">else</span> {</div><div class="line"><a name="l01827"></a><span class="lineno"> 1827</span>&#160;         <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Attachment format &#39;%s&#39; is not one of the recorded formats &#39;%s&#39;.  Falling back to default format for &#39;%s@%s&#39;.\n&quot;</span>, vmu-&gt;<a class="code" href="../../dc/d7b/structminivm__account.html#ae80eeef848853cf42dc025b36f0de488">attachfmt</a>, format, vmu-&gt;<a class="code" href="../../dc/d7b/structminivm__account.html#a4b30874d24514b5ef6ff5276e8c12ed4">username</a>, vmu-&gt;<a class="code" href="../../dc/d7b/structminivm__account.html#ae43ea5d0335f149f0920d33e46b61c33">domain</a>);</div><div class="line"><a name="l01828"></a><span class="lineno"> 1828</span>&#160;      }</div><div class="line"><a name="l01829"></a><span class="lineno"> 1829</span>&#160;   }</div><div class="line"><a name="l01830"></a><span class="lineno"> 1830</span>&#160;</div><div class="line"><a name="l01831"></a><span class="lineno"> 1831</span>&#160;   etemplate = <a class="code" href="../../de/dfe/app__minivm_8c.html#a2ba33f7f6225ee09bff35cfde87c08d7">message_template_find</a>(vmu-&gt;<a class="code" href="../../dc/d7b/structminivm__account.html#ad48036454496b4bfb945139d1ae878c4">etemplate</a>);</div><div class="line"><a name="l01832"></a><span class="lineno"> 1832</span>&#160;   <span class="keywordflow">if</span> (!etemplate)</div><div class="line"><a name="l01833"></a><span class="lineno"> 1833</span>&#160;      etemplate = <a class="code" href="../../de/dfe/app__minivm_8c.html#a2ba33f7f6225ee09bff35cfde87c08d7">message_template_find</a>(templatename);</div><div class="line"><a name="l01834"></a><span class="lineno"> 1834</span>&#160;   <span class="keywordflow">if</span> (!etemplate)</div><div class="line"><a name="l01835"></a><span class="lineno"> 1835</span>&#160;      etemplate = <a class="code" href="../../de/dfe/app__minivm_8c.html#a2ba33f7f6225ee09bff35cfde87c08d7">message_template_find</a>(<span class="stringliteral">&quot;email-default&quot;</span>);</div><div class="line"><a name="l01836"></a><span class="lineno"> 1836</span>&#160;</div><div class="line"><a name="l01837"></a><span class="lineno"> 1837</span>&#160;   <span class="comment">/* Attach only the first format */</span></div><div class="line"><a name="l01838"></a><span class="lineno"> 1838</span>&#160;   stringp = messageformat = <a class="code" href="../../d8/d8a/astmm_8h.html#ab5f0750cc80ba337fdcbddea2d3a1ee6">ast_strdupa</a>(format);</div><div class="line"><a name="l01839"></a><span class="lineno"> 1839</span>&#160;   <a class="code" href="../../de/da3/include_2asterisk_2compat_8h.html#a40eca58273c74a20a17f137d18ba826c">strsep</a>(&amp;stringp, <span class="stringliteral">&quot;|&quot;</span>);</div><div class="line"><a name="l01840"></a><span class="lineno"> 1840</span>&#160;</div><div class="line"><a name="l01841"></a><span class="lineno"> 1841</span>&#160;   <span class="keywordflow">if</span> (!<a class="code" href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a>(etemplate-&gt;<a class="code" href="../../dc/d31/structminivm__template.html#ad4786cc0738d237b7697e5448da7d22e">locale</a>)) {</div><div class="line"><a name="l01842"></a><span class="lineno"> 1842</span>&#160;      <span class="keywordtype">char</span> *new_locale;</div><div class="line"><a name="l01843"></a><span class="lineno"> 1843</span>&#160;      <a class="code" href="../../d6/d90/strings_8h.html#ac4040268f7b6ed77dfc49c7767626369">ast_copy_string</a>(oldlocale, setlocale(LC_TIME, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>), <span class="keyword">sizeof</span>(oldlocale));</div><div class="line"><a name="l01844"></a><span class="lineno"> 1844</span>&#160;      <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(2, <span class="stringliteral">&quot;Changing locale from %s to %s\n&quot;</span>, oldlocale, etemplate-&gt;<a class="code" href="../../dc/d31/structminivm__template.html#ad4786cc0738d237b7697e5448da7d22e">locale</a>);</div><div class="line"><a name="l01845"></a><span class="lineno"> 1845</span>&#160;      new_locale = setlocale(LC_TIME, etemplate-&gt;<a class="code" href="../../dc/d31/structminivm__template.html#ad4786cc0738d237b7697e5448da7d22e">locale</a>);</div><div class="line"><a name="l01846"></a><span class="lineno"> 1846</span>&#160;      <span class="keywordflow">if</span> (new_locale == <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {</div><div class="line"><a name="l01847"></a><span class="lineno"> 1847</span>&#160;         <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;-_-_- Changing to new locale did not work. Locale: %s\n&quot;</span>, etemplate-&gt;<a class="code" href="../../dc/d31/structminivm__template.html#ad4786cc0738d237b7697e5448da7d22e">locale</a>);</div><div class="line"><a name="l01848"></a><span class="lineno"> 1848</span>&#160;      }</div><div class="line"><a name="l01849"></a><span class="lineno"> 1849</span>&#160;   }</div><div class="line"><a name="l01850"></a><span class="lineno"> 1850</span>&#160;</div><div class="line"><a name="l01851"></a><span class="lineno"> 1851</span>&#160;</div><div class="line"><a name="l01852"></a><span class="lineno"> 1852</span>&#160;</div><div class="line"><a name="l01853"></a><span class="lineno"> 1853</span>&#160;   <span class="comment">/* Read counter if available */</span></div><div class="line"><a name="l01854"></a><span class="lineno"> 1854</span>&#160;   <a class="code" href="../../d5/d7b/channel_8h.html#a493bdebe876caafb8ee535853310364a">ast_channel_lock</a>(chan);</div><div class="line"><a name="l01855"></a><span class="lineno"> 1855</span>&#160;   <span class="keywordflow">if</span> ((counter = <a class="code" href="../../db/de0/pbx_8h.html#a98c5425b90ec7c5e136a40f529170b1b">pbx_builtin_getvar_helper</a>(chan, <span class="stringliteral">&quot;MVM_COUNTER&quot;</span>))) {</div><div class="line"><a name="l01856"></a><span class="lineno"> 1856</span>&#160;      counter = <a class="code" href="../../d8/d8a/astmm_8h.html#ab5f0750cc80ba337fdcbddea2d3a1ee6">ast_strdupa</a>(counter);</div><div class="line"><a name="l01857"></a><span class="lineno"> 1857</span>&#160;   }</div><div class="line"><a name="l01858"></a><span class="lineno"> 1858</span>&#160;   <a class="code" href="../../d5/d7b/channel_8h.html#af476c537b29be3f29240489032f9db39">ast_channel_unlock</a>(chan);</div><div class="line"><a name="l01859"></a><span class="lineno"> 1859</span>&#160;</div><div class="line"><a name="l01860"></a><span class="lineno"> 1860</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a>(counter)) {</div><div class="line"><a name="l01861"></a><span class="lineno"> 1861</span>&#160;      <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(2, <span class="stringliteral">&quot;MVM_COUNTER not found\n&quot;</span>);</div><div class="line"><a name="l01862"></a><span class="lineno"> 1862</span>&#160;   } <span class="keywordflow">else</span> {</div><div class="line"><a name="l01863"></a><span class="lineno"> 1863</span>&#160;      <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(2, <span class="stringliteral">&quot;MVM_COUNTER found - will use it with value %s\n&quot;</span>, counter);</div><div class="line"><a name="l01864"></a><span class="lineno"> 1864</span>&#160;   }</div><div class="line"><a name="l01865"></a><span class="lineno"> 1865</span>&#160;</div><div class="line"><a name="l01866"></a><span class="lineno"> 1866</span>&#160;   res = <a class="code" href="../../de/dfe/app__minivm_8c.html#ac7e81a2c8a348c7369525f63242d6a66">sendmail</a>(etemplate, vmu, cidnum, cidname, filename, messageformat, duration, etemplate-&gt;<a class="code" href="../../dc/d31/structminivm__template.html#a2f8ccdb6d4cf2698360e28ee28e70cb3">attachment</a>, <a class="code" href="../../de/dfe/app__minivm_8c.html#abcec5c16680dc75cdf051552d6908042a0097c80109786c14718655071a22e0e8">MVM_MESSAGE_EMAIL</a>, counter);</div><div class="line"><a name="l01867"></a><span class="lineno"> 1867</span>&#160;</div><div class="line"><a name="l01868"></a><span class="lineno"> 1868</span>&#160;   <span class="keywordflow">if</span> (res == 0 &amp;&amp; !<a class="code" href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a>(vmu-&gt;<a class="code" href="../../dc/d7b/structminivm__account.html#a29b9b126bac9cc5f1cc334f140f39e8d">pager</a>))  {</div><div class="line"><a name="l01869"></a><span class="lineno"> 1869</span>&#160;      <span class="comment">/* Find template for paging */</span></div><div class="line"><a name="l01870"></a><span class="lineno"> 1870</span>&#160;      etemplate = <a class="code" href="../../de/dfe/app__minivm_8c.html#a2ba33f7f6225ee09bff35cfde87c08d7">message_template_find</a>(vmu-&gt;<a class="code" href="../../dc/d7b/structminivm__account.html#a6e9b30710047deee4fb3e4f38c8e7cc2">ptemplate</a>);</div><div class="line"><a name="l01871"></a><span class="lineno"> 1871</span>&#160;      <span class="keywordflow">if</span> (!etemplate)</div><div class="line"><a name="l01872"></a><span class="lineno"> 1872</span>&#160;         etemplate = <a class="code" href="../../de/dfe/app__minivm_8c.html#a2ba33f7f6225ee09bff35cfde87c08d7">message_template_find</a>(<span class="stringliteral">&quot;pager-default&quot;</span>);</div><div class="line"><a name="l01873"></a><span class="lineno"> 1873</span>&#160;</div><div class="line"><a name="l01874"></a><span class="lineno"> 1874</span>&#160;      <span class="keywordflow">if</span> (!<a class="code" href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a>(etemplate-&gt;<a class="code" href="../../dc/d31/structminivm__template.html#ad4786cc0738d237b7697e5448da7d22e">locale</a>)) {</div><div class="line"><a name="l01875"></a><span class="lineno"> 1875</span>&#160;         <a class="code" href="../../d6/d90/strings_8h.html#ac4040268f7b6ed77dfc49c7767626369">ast_copy_string</a>(oldlocale, setlocale(LC_TIME, <span class="stringliteral">&quot;&quot;</span>), <span class="keyword">sizeof</span>(oldlocale));</div><div class="line"><a name="l01876"></a><span class="lineno"> 1876</span>&#160;         setlocale(LC_TIME, etemplate-&gt;<a class="code" href="../../dc/d31/structminivm__template.html#ad4786cc0738d237b7697e5448da7d22e">locale</a>);</div><div class="line"><a name="l01877"></a><span class="lineno"> 1877</span>&#160;      }</div><div class="line"><a name="l01878"></a><span class="lineno"> 1878</span>&#160;</div><div class="line"><a name="l01879"></a><span class="lineno"> 1879</span>&#160;      res = <a class="code" href="../../de/dfe/app__minivm_8c.html#ac7e81a2c8a348c7369525f63242d6a66">sendmail</a>(etemplate, vmu, cidnum, cidname, filename, messageformat, duration, etemplate-&gt;<a class="code" href="../../dc/d31/structminivm__template.html#a2f8ccdb6d4cf2698360e28ee28e70cb3">attachment</a>, <a class="code" href="../../de/dfe/app__minivm_8c.html#abcec5c16680dc75cdf051552d6908042ae7f36447ba359572f25032860eebaeb4">MVM_MESSAGE_PAGE</a>, counter);</div><div class="line"><a name="l01880"></a><span class="lineno"> 1880</span>&#160;   }</div><div class="line"><a name="l01881"></a><span class="lineno"> 1881</span>&#160;</div><div class="line"><a name="l01882"></a><span class="lineno"> 1882</span>&#160;   mwi_state = <a class="code" href="../../df/deb/group__StasisTopicsAndMessages.html#ga2f9639be7fcd922d0609b4ba82fc79c8">ast_mwi_create</a>(vmu-&gt;<a class="code" href="../../dc/d7b/structminivm__account.html#a4b30874d24514b5ef6ff5276e8c12ed4">username</a>, vmu-&gt;<a class="code" href="../../dc/d7b/structminivm__account.html#ae43ea5d0335f149f0920d33e46b61c33">domain</a>);</div><div class="line"><a name="l01883"></a><span class="lineno"> 1883</span>&#160;   <span class="keywordflow">if</span> (!mwi_state) {</div><div class="line"><a name="l01884"></a><span class="lineno"> 1884</span>&#160;      <span class="keywordflow">goto</span> notify_cleanup;</div><div class="line"><a name="l01885"></a><span class="lineno"> 1885</span>&#160;   }</div><div class="line"><a name="l01886"></a><span class="lineno"> 1886</span>&#160;   mwi_state-&gt;snapshot = <a class="code" href="../../df/deb/group__StasisTopicsAndMessages.html#ga68c55b443ba97dc157b493aafd05c876">ast_channel_snapshot_get_latest</a>(<a class="code" href="../../d5/d7b/channel_8h.html#a3b6254f6d3832ef928f0a727113b1c63">ast_channel_uniqueid</a>(chan));</div><div class="line"><a name="l01887"></a><span class="lineno"> 1887</span>&#160;</div><div class="line"><a name="l01888"></a><span class="lineno"> 1888</span>&#160;   json_object = <a class="code" href="../../d4/d05/json_8h.html#a99715667e822b2ad409b34ca041e535d">ast_json_pack</a>(<span class="stringliteral">&quot;{s: s, s: s, s: s}&quot;</span>,</div><div class="line"><a name="l01889"></a><span class="lineno"> 1889</span>&#160;      <span class="stringliteral">&quot;Event&quot;</span>, <span class="stringliteral">&quot;MiniVoiceMail&quot;</span>,</div><div class="line"><a name="l01890"></a><span class="lineno"> 1890</span>&#160;      <span class="stringliteral">&quot;Action&quot;</span>, <span class="stringliteral">&quot;SentNotification&quot;</span>,</div><div class="line"><a name="l01891"></a><span class="lineno"> 1891</span>&#160;      <span class="stringliteral">&quot;Counter&quot;</span>, counter ?: <span class="stringliteral">&quot;&quot;</span>);</div><div class="line"><a name="l01892"></a><span class="lineno"> 1892</span>&#160;   <span class="keywordflow">if</span> (!json_object) {</div><div class="line"><a name="l01893"></a><span class="lineno"> 1893</span>&#160;      <span class="keywordflow">goto</span> notify_cleanup;</div><div class="line"><a name="l01894"></a><span class="lineno"> 1894</span>&#160;   }</div><div class="line"><a name="l01895"></a><span class="lineno"> 1895</span>&#160;   <a class="code" href="../../d8/d9e/structmessage.html">message</a> = <a class="code" href="../../df/deb/group__StasisTopicsAndMessages.html#ga728789c28cb77fc6cbf3254aefc7c67a">ast_mwi_blob_create</a>(mwi_state, <a class="code" href="../../df/deb/group__StasisTopicsAndMessages.html#ga03bf52a37253e9ecdc4fadf9747a3497">ast_mwi_vm_app_type</a>(), json_object);</div><div class="line"><a name="l01896"></a><span class="lineno"> 1896</span>&#160;   <span class="keywordflow">if</span> (!<a class="code" href="../../d8/d9e/structmessage.html">message</a>) {</div><div class="line"><a name="l01897"></a><span class="lineno"> 1897</span>&#160;      <span class="keywordflow">goto</span> notify_cleanup;</div><div class="line"><a name="l01898"></a><span class="lineno"> 1898</span>&#160;   }</div><div class="line"><a name="l01899"></a><span class="lineno"> 1899</span>&#160;   <a class="code" href="../../dd/d79/stasis_8h.html#ac43d0a33d111e9f34b441b285c166cfc">stasis_publish</a>(<a class="code" href="../../df/deb/group__StasisTopicsAndMessages.html#gae43ba258ce7f2b5838edbed6bf7dbd8c">ast_mwi_topic</a>(mwi_state-&gt;uniqueid), <a class="code" href="../../d8/d9e/structmessage.html">message</a>);</div><div class="line"><a name="l01900"></a><span class="lineno"> 1900</span>&#160;</div><div class="line"><a name="l01901"></a><span class="lineno"> 1901</span>&#160;notify_cleanup:</div><div class="line"><a name="l01902"></a><span class="lineno"> 1902</span>&#160;   <a class="code" href="../../de/dfe/app__minivm_8c.html#ad0499410b27e24fe126fcb124713c239">run_externnotify</a>(chan, vmu);     <span class="comment">/* Run external notification */</span></div><div class="line"><a name="l01903"></a><span class="lineno"> 1903</span>&#160;   <span class="keywordflow">if</span> (!<a class="code" href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a>(etemplate-&gt;<a class="code" href="../../dc/d31/structminivm__template.html#ad4786cc0738d237b7697e5448da7d22e">locale</a>)) {</div><div class="line"><a name="l01904"></a><span class="lineno"> 1904</span>&#160;      setlocale(LC_TIME, oldlocale);   <span class="comment">/* Reset to old locale */</span></div><div class="line"><a name="l01905"></a><span class="lineno"> 1905</span>&#160;   }</div><div class="line"><a name="l01906"></a><span class="lineno"> 1906</span>&#160;   <span class="keywordflow">return</span> res;</div><div class="line"><a name="l01907"></a><span class="lineno"> 1907</span>&#160;}</div><div class="line"><a name="l01908"></a><span class="lineno"> 1908</span>&#160;</div><div class="line"><a name="l01909"></a><span class="lineno"> 1909</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01910"></a><span class="lineno"> 1910</span>&#160;<span class="comment">/*!\internal</span></div><div class="line"><a name="l01911"></a><span class="lineno"> 1911</span>&#160;<span class="comment"> * \brief Record voicemail message, store into file prepared for sending e-mail */</span></div><div class="line"><a name="l01912"></a><span class="lineno"><a class="line" href="../../de/dfe/app__minivm_8c.html#ab708636c14961682ea0d718b97f12234"> 1912</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../de/dfe/app__minivm_8c.html#ab708636c14961682ea0d718b97f12234">leave_voicemail</a>(<span class="keyword">struct</span> <a class="code" href="../../df/d3c/structast__channel.html">ast_channel</a> *chan, <span class="keywordtype">char</span> *<a class="code" href="../../dc/d7b/structminivm__account.html#a4b30874d24514b5ef6ff5276e8c12ed4">username</a>, <span class="keyword">struct</span> <a class="code" href="../../dd/df7/structleave__vm__options.html">leave_vm_options</a> *<a class="code" href="../../d4/d45/test__http__media__cache_8c.html#a80c8e3ae5087d90d422675d034eeebc7">options</a>)</div><div class="line"><a name="l01913"></a><span class="lineno"> 1913</span>&#160;{</div><div class="line"><a name="l01914"></a><span class="lineno"> 1914</span>&#160;   <span class="keywordtype">char</span> tmptxtfile[<a class="code" href="../../db/db2/asterisk_8h.html#ae688d728e1acdfe5988c7db45d6f0166">PATH_MAX</a>];</div><div class="line"><a name="l01915"></a><span class="lineno"> 1915</span>&#160;   <span class="keywordtype">char</span> callerid[256];</div><div class="line"><a name="l01916"></a><span class="lineno"> 1916</span>&#160;   FILE *txt;</div><div class="line"><a name="l01917"></a><span class="lineno"> 1917</span>&#160;   <span class="keywordtype">int</span> res = 0, txtdes;</div><div class="line"><a name="l01918"></a><span class="lineno"> 1918</span>&#160;   <span class="keywordtype">int</span> duration = 0;</div><div class="line"><a name="l01919"></a><span class="lineno"> 1919</span>&#160;   <span class="keywordtype">int</span> sound_duration = 0;</div><div class="line"><a name="l01920"></a><span class="lineno"> 1920</span>&#160;   <span class="keywordtype">char</span> date[256];</div><div class="line"><a name="l01921"></a><span class="lineno"> 1921</span>&#160;   <span class="keywordtype">char</span> tmpdir[<a class="code" href="../../db/db2/asterisk_8h.html#ae688d728e1acdfe5988c7db45d6f0166">PATH_MAX</a>];</div><div class="line"><a name="l01922"></a><span class="lineno"> 1922</span>&#160;   <span class="keywordtype">char</span> ext_context[256] = <span class="stringliteral">&quot;&quot;</span>;</div><div class="line"><a name="l01923"></a><span class="lineno"> 1923</span>&#160;   <span class="keywordtype">char</span> fmt[80];</div><div class="line"><a name="l01924"></a><span class="lineno"> 1924</span>&#160;   <span class="keywordtype">char</span> *<a class="code" href="../../dc/d7b/structminivm__account.html#ae43ea5d0335f149f0920d33e46b61c33">domain</a>;</div><div class="line"><a name="l01925"></a><span class="lineno"> 1925</span>&#160;   <span class="keywordtype">char</span> <a class="code" href="../../de/d1e/bt__open_8c.html#a1cdd2bb1a9a71d3e1120100229315d67">tmp</a>[256] = <span class="stringliteral">&quot;&quot;</span>;</div><div class="line"><a name="l01926"></a><span class="lineno"> 1926</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../dc/d7b/structminivm__account.html">minivm_account</a> *vmu;</div><div class="line"><a name="l01927"></a><span class="lineno"> 1927</span>&#160;   <span class="keywordtype">int</span> userdir;</div><div class="line"><a name="l01928"></a><span class="lineno"> 1928</span>&#160;</div><div class="line"><a name="l01929"></a><span class="lineno"> 1929</span>&#160;   <a class="code" href="../../d6/d90/strings_8h.html#ac4040268f7b6ed77dfc49c7767626369">ast_copy_string</a>(tmp, username, <span class="keyword">sizeof</span>(tmp));</div><div class="line"><a name="l01930"></a><span class="lineno"> 1930</span>&#160;   username = <a class="code" href="../../de/d1e/bt__open_8c.html#a1cdd2bb1a9a71d3e1120100229315d67">tmp</a>;</div><div class="line"><a name="l01931"></a><span class="lineno"> 1931</span>&#160;   domain = strchr(tmp, <span class="charliteral">&#39;@&#39;</span>);</div><div class="line"><a name="l01932"></a><span class="lineno"> 1932</span>&#160;   <span class="keywordflow">if</span> (domain) {</div><div class="line"><a name="l01933"></a><span class="lineno"> 1933</span>&#160;      *domain = <span class="charliteral">&#39;\0&#39;</span>;</div><div class="line"><a name="l01934"></a><span class="lineno"> 1934</span>&#160;      domain++;</div><div class="line"><a name="l01935"></a><span class="lineno"> 1935</span>&#160;   }</div><div class="line"><a name="l01936"></a><span class="lineno"> 1936</span>&#160;</div><div class="line"><a name="l01937"></a><span class="lineno"> 1937</span>&#160;   <span class="keywordflow">if</span> (!(vmu = <a class="code" href="../../de/dfe/app__minivm_8c.html#ac26055cad7a69cbfb6692d273f025a40">find_account</a>(domain, username, <a class="code" href="../../de/dfe/app__minivm_8c.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>))) {</div><div class="line"><a name="l01938"></a><span class="lineno"> 1938</span>&#160;      <span class="comment">/* We could not find user, let&#39;s exit */</span></div><div class="line"><a name="l01939"></a><span class="lineno"> 1939</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Can&#39;t allocate temporary account for &#39;%s@%s&#39;\n&quot;</span>, username, domain);</div><div class="line"><a name="l01940"></a><span class="lineno"> 1940</span>&#160;      <a class="code" href="../../db/de0/pbx_8h.html#a6e5b90edb84d216267148dddcffe9b9a">pbx_builtin_setvar_helper</a>(chan, <span class="stringliteral">&quot;MVM_RECORD_STATUS&quot;</span>, <span class="stringliteral">&quot;FAILED&quot;</span>);</div><div class="line"><a name="l01941"></a><span class="lineno"> 1941</span>&#160;      <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l01942"></a><span class="lineno"> 1942</span>&#160;   }</div><div class="line"><a name="l01943"></a><span class="lineno"> 1943</span>&#160;</div><div class="line"><a name="l01944"></a><span class="lineno"> 1944</span>&#160;   <span class="comment">/* Setup pre-file if appropriate */</span></div><div class="line"><a name="l01945"></a><span class="lineno"> 1945</span>&#160;   <span class="keywordflow">if</span> (strcmp(vmu-&gt;<a class="code" href="../../dc/d7b/structminivm__account.html#ae43ea5d0335f149f0920d33e46b61c33">domain</a>, <span class="stringliteral">&quot;localhost&quot;</span>))</div><div class="line"><a name="l01946"></a><span class="lineno"> 1946</span>&#160;      snprintf(ext_context, <span class="keyword">sizeof</span>(ext_context), <span class="stringliteral">&quot;%s@%s&quot;</span>, username, vmu-&gt;<a class="code" href="../../dc/d7b/structminivm__account.html#ae43ea5d0335f149f0920d33e46b61c33">domain</a>);</div><div class="line"><a name="l01947"></a><span class="lineno"> 1947</span>&#160;   <span class="keywordflow">else</span></div><div class="line"><a name="l01948"></a><span class="lineno"> 1948</span>&#160;      <a class="code" href="../../d6/d90/strings_8h.html#ac4040268f7b6ed77dfc49c7767626369">ast_copy_string</a>(ext_context, vmu-&gt;<a class="code" href="../../dc/d7b/structminivm__account.html#ae43ea5d0335f149f0920d33e46b61c33">domain</a>, <span class="keyword">sizeof</span>(ext_context));</div><div class="line"><a name="l01949"></a><span class="lineno"> 1949</span>&#160;</div><div class="line"><a name="l01950"></a><span class="lineno"> 1950</span>&#160;   <span class="comment">/* The meat of recording the message...  All the announcements and beeps have been played*/</span></div><div class="line"><a name="l01951"></a><span class="lineno"> 1951</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a>(vmu-&gt;<a class="code" href="../../dc/d7b/structminivm__account.html#ae80eeef848853cf42dc025b36f0de488">attachfmt</a>))</div><div class="line"><a name="l01952"></a><span class="lineno"> 1952</span>&#160;      <a class="code" href="../../d6/d90/strings_8h.html#ac4040268f7b6ed77dfc49c7767626369">ast_copy_string</a>(fmt, default_vmformat, <span class="keyword">sizeof</span>(fmt));</div><div class="line"><a name="l01953"></a><span class="lineno"> 1953</span>&#160;   <span class="keywordflow">else</span></div><div class="line"><a name="l01954"></a><span class="lineno"> 1954</span>&#160;      <a class="code" href="../../d6/d90/strings_8h.html#ac4040268f7b6ed77dfc49c7767626369">ast_copy_string</a>(fmt, vmu-&gt;<a class="code" href="../../dc/d7b/structminivm__account.html#ae80eeef848853cf42dc025b36f0de488">attachfmt</a>, <span class="keyword">sizeof</span>(fmt));</div><div class="line"><a name="l01955"></a><span class="lineno"> 1955</span>&#160;</div><div class="line"><a name="l01956"></a><span class="lineno"> 1956</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a>(fmt)) {</div><div class="line"><a name="l01957"></a><span class="lineno"> 1957</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;No format for saving voicemail? Default %s\n&quot;</span>, default_vmformat);</div><div class="line"><a name="l01958"></a><span class="lineno"> 1958</span>&#160;      <a class="code" href="../../db/de0/pbx_8h.html#a6e5b90edb84d216267148dddcffe9b9a">pbx_builtin_setvar_helper</a>(chan, <span class="stringliteral">&quot;MVM_RECORD_STATUS&quot;</span>, <span class="stringliteral">&quot;FAILED&quot;</span>);</div><div class="line"><a name="l01959"></a><span class="lineno"> 1959</span>&#160;      <span class="keywordflow">return</span> res;</div><div class="line"><a name="l01960"></a><span class="lineno"> 1960</span>&#160;   }</div><div class="line"><a name="l01961"></a><span class="lineno"> 1961</span>&#160;</div><div class="line"><a name="l01962"></a><span class="lineno"> 1962</span>&#160;   userdir = <a class="code" href="../../de/dfe/app__minivm_8c.html#a9a335978d2517b553066af1f10a4d07f">check_dirpath</a>(tmpdir, <span class="keyword">sizeof</span>(tmpdir), vmu-&gt;<a class="code" href="../../dc/d7b/structminivm__account.html#ae43ea5d0335f149f0920d33e46b61c33">domain</a>, username, <span class="stringliteral">&quot;tmp&quot;</span>);</div><div class="line"><a name="l01963"></a><span class="lineno"> 1963</span>&#160;</div><div class="line"><a name="l01964"></a><span class="lineno"> 1964</span>&#160;   <span class="comment">/* If we have no user directory, use generic temporary directory */</span></div><div class="line"><a name="l01965"></a><span class="lineno"> 1965</span>&#160;   <span class="keywordflow">if</span> (!userdir) {</div><div class="line"><a name="l01966"></a><span class="lineno"> 1966</span>&#160;      <a class="code" href="../../de/dfe/app__minivm_8c.html#ac6ccbdf4443ab9722a13578d17b1f7da">create_dirpath</a>(tmpdir, <span class="keyword">sizeof</span>(tmpdir), <span class="stringliteral">&quot;0000_minivm_temp&quot;</span>, <span class="stringliteral">&quot;mediafiles&quot;</span>, <span class="stringliteral">&quot;&quot;</span>);</div><div class="line"><a name="l01967"></a><span class="lineno"> 1967</span>&#160;      <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(3, <span class="stringliteral">&quot;Creating temporary directory %s\n&quot;</span>, tmpdir);</div><div class="line"><a name="l01968"></a><span class="lineno"> 1968</span>&#160;   }</div><div class="line"><a name="l01969"></a><span class="lineno"> 1969</span>&#160;</div><div class="line"><a name="l01970"></a><span class="lineno"> 1970</span>&#160;</div><div class="line"><a name="l01971"></a><span class="lineno"> 1971</span>&#160;   snprintf(tmptxtfile, <span class="keyword">sizeof</span>(tmptxtfile), <span class="stringliteral">&quot;%s/XXXXXX&quot;</span>, tmpdir);</div><div class="line"><a name="l01972"></a><span class="lineno"> 1972</span>&#160;</div><div class="line"><a name="l01973"></a><span class="lineno"> 1973</span>&#160;   <span class="comment">/* XXX This file needs to be in temp directory */</span></div><div class="line"><a name="l01974"></a><span class="lineno"> 1974</span>&#160;   txtdes = mkstemp(tmptxtfile);</div><div class="line"><a name="l01975"></a><span class="lineno"> 1975</span>&#160;   <span class="keywordflow">if</span> (txtdes &lt; 0) {</div><div class="line"><a name="l01976"></a><span class="lineno"> 1976</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Unable to create message file %s: %s\n&quot;</span>, tmptxtfile, strerror(<a class="code" href="../../d1/d6e/main_2stdtime_2private_8h.html#ad65a8842cc674e3ddf69355898c0ecbf">errno</a>));</div><div class="line"><a name="l01977"></a><span class="lineno"> 1977</span>&#160;      res = <a class="code" href="../../d2/d4d/file_8h.html#a67c7e271b4ca70aca6d48fd48d121857">ast_streamfile</a>(chan, <span class="stringliteral">&quot;vm-mailboxfull&quot;</span>, <a class="code" href="../../d5/d7b/channel_8h.html#a9abe31fe40dcd03cd2957e5309e32ac6">ast_channel_language</a>(chan));</div><div class="line"><a name="l01978"></a><span class="lineno"> 1978</span>&#160;      <span class="keywordflow">if</span> (!res)</div><div class="line"><a name="l01979"></a><span class="lineno"> 1979</span>&#160;         res = <a class="code" href="../../d2/d4d/file_8h.html#affc21cb57c6bf72a2cb7ec8a379b2137">ast_waitstream</a>(chan, <span class="stringliteral">&quot;&quot;</span>);</div><div class="line"><a name="l01980"></a><span class="lineno"> 1980</span>&#160;      <a class="code" href="../../db/de0/pbx_8h.html#a6e5b90edb84d216267148dddcffe9b9a">pbx_builtin_setvar_helper</a>(chan, <span class="stringliteral">&quot;MVM_RECORD_STATUS&quot;</span>, <span class="stringliteral">&quot;FAILED&quot;</span>);</div><div class="line"><a name="l01981"></a><span class="lineno"> 1981</span>&#160;      <span class="keywordflow">return</span> res;</div><div class="line"><a name="l01982"></a><span class="lineno"> 1982</span>&#160;   }</div><div class="line"><a name="l01983"></a><span class="lineno"> 1983</span>&#160;</div><div class="line"><a name="l01984"></a><span class="lineno"> 1984</span>&#160;   <span class="keywordflow">if</span> (res &gt;= 0) {</div><div class="line"><a name="l01985"></a><span class="lineno"> 1985</span>&#160;      <span class="comment">/* Unless we&#39;re *really* silent, try to send the beep */</span></div><div class="line"><a name="l01986"></a><span class="lineno"> 1986</span>&#160;      res = <a class="code" href="../../d2/d4d/file_8h.html#a67c7e271b4ca70aca6d48fd48d121857">ast_streamfile</a>(chan, <span class="stringliteral">&quot;beep&quot;</span>, <a class="code" href="../../d5/d7b/channel_8h.html#a9abe31fe40dcd03cd2957e5309e32ac6">ast_channel_language</a>(chan));</div><div class="line"><a name="l01987"></a><span class="lineno"> 1987</span>&#160;      <span class="keywordflow">if</span> (!res)</div><div class="line"><a name="l01988"></a><span class="lineno"> 1988</span>&#160;         res = <a class="code" href="../../d2/d4d/file_8h.html#affc21cb57c6bf72a2cb7ec8a379b2137">ast_waitstream</a>(chan, <span class="stringliteral">&quot;&quot;</span>);</div><div class="line"><a name="l01989"></a><span class="lineno"> 1989</span>&#160;   }</div><div class="line"><a name="l01990"></a><span class="lineno"> 1990</span>&#160;</div><div class="line"><a name="l01991"></a><span class="lineno"> 1991</span>&#160;   <span class="comment">/* OEJ XXX Maybe this can be turned into a log file? Hmm. */</span></div><div class="line"><a name="l01992"></a><span class="lineno"> 1992</span>&#160;   <span class="comment">/* Store information */</span></div><div class="line"><a name="l01993"></a><span class="lineno"> 1993</span>&#160;   <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(2, <span class="stringliteral">&quot;Open file for metadata: %s\n&quot;</span>, tmptxtfile);</div><div class="line"><a name="l01994"></a><span class="lineno"> 1994</span>&#160;</div><div class="line"><a name="l01995"></a><span class="lineno"> 1995</span>&#160;   res = <a class="code" href="../../de/dfe/app__minivm_8c.html#a9900bfa7d5724fe84c74fec928f49052">play_record_review</a>(chan, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, tmptxtfile, global_vmmaxmessage, fmt, 1, vmu, &amp;duration, &amp;sound_duration, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, options-&gt;<a class="code" href="../../dd/df7/structleave__vm__options.html#a809cc53dfc8e9f1204c67c26aabaa322">record_gain</a>);</div><div class="line"><a name="l01996"></a><span class="lineno"> 1996</span>&#160;</div><div class="line"><a name="l01997"></a><span class="lineno"> 1997</span>&#160;   txt = fdopen(txtdes, <span class="stringliteral">&quot;w+&quot;</span>);</div><div class="line"><a name="l01998"></a><span class="lineno"> 1998</span>&#160;   <span class="keywordflow">if</span> (!txt) {</div><div class="line"><a name="l01999"></a><span class="lineno"> 1999</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Error opening text file for output\n&quot;</span>);</div><div class="line"><a name="l02000"></a><span class="lineno"> 2000</span>&#160;   } <span class="keywordflow">else</span> {</div><div class="line"><a name="l02001"></a><span class="lineno"> 2001</span>&#160;      <span class="keyword">struct </span><a class="code" href="../../d5/d84/structast__tm.html">ast_tm</a> tm;</div><div class="line"><a name="l02002"></a><span class="lineno"> 2002</span>&#160;      <span class="keyword">struct </span>timeval now = <a class="code" href="../../de/df7/time_8h.html#ad3899efb6f0e348556ef69f5b16aa7f7">ast_tvnow</a>();</div><div class="line"><a name="l02003"></a><span class="lineno"> 2003</span>&#160;      <span class="keywordtype">char</span> timebuf[30];</div><div class="line"><a name="l02004"></a><span class="lineno"> 2004</span>&#160;      <span class="keywordtype">char</span> logbuf[BUFSIZ];</div><div class="line"><a name="l02005"></a><span class="lineno"> 2005</span>&#160;      <a class="code" href="../../de/dfe/app__minivm_8c.html#aec217dce71a357d4890727f2a1a0a271">get_date</a>(date, <span class="keyword">sizeof</span>(date));</div><div class="line"><a name="l02006"></a><span class="lineno"> 2006</span>&#160;      <a class="code" href="../../d5/deb/localtime_8h.html#ae9fbda728350a9a5b9c09b29214d718e">ast_localtime</a>(&amp;now, &amp;tm, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div><div class="line"><a name="l02007"></a><span class="lineno"> 2007</span>&#160;      <a class="code" href="../../d5/deb/localtime_8h.html#aa8e63928b14a347bd3973d680b885f93">ast_strftime</a>(timebuf, <span class="keyword">sizeof</span>(timebuf), <span class="stringliteral">&quot;%H:%M:%S&quot;</span>, &amp;tm);</div><div class="line"><a name="l02008"></a><span class="lineno"> 2008</span>&#160;</div><div class="line"><a name="l02009"></a><span class="lineno"> 2009</span>&#160;      <a class="code" href="../../de/d47/callerid_8h.html#a1c25633b1ed63682c95ec613d7cbe559">ast_callerid_merge</a>(callerid, <span class="keyword">sizeof</span>(callerid),</div><div class="line"><a name="l02010"></a><span class="lineno"> 2010</span>&#160;         <a class="code" href="../../d6/d90/strings_8h.html#a38a896048b2ca84076864505f0aa8f01">S_COR</a>(<a class="code" href="../../d5/d7b/channel_8h.html#ac2dc872b606534943c98304aed841b34">ast_channel_caller</a>(chan)-&gt;<span class="keywordtype">id</span>.<a class="code" href="../../d0/d29/cdr__mysql_8c.html#a0980a105ccb863d8008eb6201a51da52">name</a>.valid, <a class="code" href="../../d5/d7b/channel_8h.html#ac2dc872b606534943c98304aed841b34">ast_channel_caller</a>(chan)-&gt;<span class="keywordtype">id</span>.<a class="code" href="../../d0/d29/cdr__mysql_8c.html#a0980a105ccb863d8008eb6201a51da52">name</a>.str, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>),</div><div class="line"><a name="l02011"></a><span class="lineno"> 2011</span>&#160;         <a class="code" href="../../d6/d90/strings_8h.html#a38a896048b2ca84076864505f0aa8f01">S_COR</a>(<a class="code" href="../../d5/d7b/channel_8h.html#ac2dc872b606534943c98304aed841b34">ast_channel_caller</a>(chan)-&gt;<span class="keywordtype">id</span>.<a class="code" href="../../d6/d49/structnumber.html">number</a>.valid, <a class="code" href="../../d5/d7b/channel_8h.html#ac2dc872b606534943c98304aed841b34">ast_channel_caller</a>(chan)-&gt;<span class="keywordtype">id</span>.<a class="code" href="../../d6/d49/structnumber.html">number</a>.str, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>),</div><div class="line"><a name="l02012"></a><span class="lineno"> 2012</span>&#160;         <span class="stringliteral">&quot;Unknown&quot;</span>);</div><div class="line"><a name="l02013"></a><span class="lineno"> 2013</span>&#160;      snprintf(logbuf, <span class="keyword">sizeof</span>(logbuf),</div><div class="line"><a name="l02014"></a><span class="lineno"> 2014</span>&#160;         <span class="comment">/* &quot;Mailbox:domain:macrocontext:exten:priority:callerchan:callerid:origdate:origtime:duration:durationstatus:accountcode&quot; */</span></div><div class="line"><a name="l02015"></a><span class="lineno"> 2015</span>&#160;         <span class="stringliteral">&quot;%s:%s:%s:%s:%d:%s:%s:%s:%s:%d:%s:%s\n&quot;</span>,</div><div class="line"><a name="l02016"></a><span class="lineno"> 2016</span>&#160;         username,</div><div class="line"><a name="l02017"></a><span class="lineno"> 2017</span>&#160;         <a class="code" href="../../d5/d7b/channel_8h.html#a582dee4d5ea9b2ff6f309f0c5239f6bd">ast_channel_context</a>(chan),</div><div class="line"><a name="l02018"></a><span class="lineno"> 2018</span>&#160;         <a class="code" href="../../d5/d7b/channel_8h.html#adf593d68a333075c1fcae8a73b68c069">ast_channel_macrocontext</a>(chan),</div><div class="line"><a name="l02019"></a><span class="lineno"> 2019</span>&#160;         <a class="code" href="../../d5/d7b/channel_8h.html#aa8b52fbc8168e939bc5553502367d46a">ast_channel_exten</a>(chan),</div><div class="line"><a name="l02020"></a><span class="lineno"> 2020</span>&#160;         <a class="code" href="../../d5/d7b/channel_8h.html#a6610c8171ced0a69738622c11736ff5e">ast_channel_priority</a>(chan),</div><div class="line"><a name="l02021"></a><span class="lineno"> 2021</span>&#160;         <a class="code" href="../../d5/d7b/channel_8h.html#a7ca2fda13b129a55c251b56729de285b">ast_channel_name</a>(chan),</div><div class="line"><a name="l02022"></a><span class="lineno"> 2022</span>&#160;         callerid,</div><div class="line"><a name="l02023"></a><span class="lineno"> 2023</span>&#160;         date,</div><div class="line"><a name="l02024"></a><span class="lineno"> 2024</span>&#160;         timebuf,</div><div class="line"><a name="l02025"></a><span class="lineno"> 2025</span>&#160;         duration,</div><div class="line"><a name="l02026"></a><span class="lineno"> 2026</span>&#160;         duration &lt; global_vmminmessage ? <span class="stringliteral">&quot;IGNORED&quot;</span> : <span class="stringliteral">&quot;OK&quot;</span>,</div><div class="line"><a name="l02027"></a><span class="lineno"> 2027</span>&#160;         vmu-&gt;<a class="code" href="../../dc/d7b/structminivm__account.html#adfee50d07a98645d4d20b896ce03785a">accountcode</a></div><div class="line"><a name="l02028"></a><span class="lineno"> 2028</span>&#160;      );</div><div class="line"><a name="l02029"></a><span class="lineno"> 2029</span>&#160;      fprintf(txt, <span class="stringliteral">&quot;%s&quot;</span>, logbuf);</div><div class="line"><a name="l02030"></a><span class="lineno"> 2030</span>&#160;      <span class="keywordflow">if</span> (minivmlogfile) {</div><div class="line"><a name="l02031"></a><span class="lineno"> 2031</span>&#160;         <a class="code" href="../../dd/d42/lock_8h.html#ac5e13c7fe64d3b271a52028b0a78b92b">ast_mutex_lock</a>(&amp;<a class="code" href="../../de/dfe/app__minivm_8c.html#a44b4ef79fbbffd154a9398d0d12124a3">minivmloglock</a>);</div><div class="line"><a name="l02032"></a><span class="lineno"> 2032</span>&#160;         fprintf(minivmlogfile, <span class="stringliteral">&quot;%s&quot;</span>, logbuf);</div><div class="line"><a name="l02033"></a><span class="lineno"> 2033</span>&#160;         <a class="code" href="../../dd/d42/lock_8h.html#a873f9ce8c6287a32d48c83133e124418">ast_mutex_unlock</a>(&amp;<a class="code" href="../../de/dfe/app__minivm_8c.html#a44b4ef79fbbffd154a9398d0d12124a3">minivmloglock</a>);</div><div class="line"><a name="l02034"></a><span class="lineno"> 2034</span>&#160;      }</div><div class="line"><a name="l02035"></a><span class="lineno"> 2035</span>&#160;</div><div class="line"><a name="l02036"></a><span class="lineno"> 2036</span>&#160;      <span class="keywordflow">if</span> (sound_duration &lt; global_vmminmessage) {</div><div class="line"><a name="l02037"></a><span class="lineno"> 2037</span>&#160;         <a class="code" href="../../d1/d8c/logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(3, <span class="stringliteral">&quot;Recording was %d seconds long but needs to be at least %d - abandoning\n&quot;</span>, sound_duration, global_vmminmessage);</div><div class="line"><a name="l02038"></a><span class="lineno"> 2038</span>&#160;         fclose(txt);</div><div class="line"><a name="l02039"></a><span class="lineno"> 2039</span>&#160;         <a class="code" href="../../d2/d4d/file_8h.html#adb15d6efecc1a13b8835bee6d3562ddb">ast_filedelete</a>(tmptxtfile, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div><div class="line"><a name="l02040"></a><span class="lineno"> 2040</span>&#160;         unlink(tmptxtfile);</div><div class="line"><a name="l02041"></a><span class="lineno"> 2041</span>&#160;         <a class="code" href="../../db/de0/pbx_8h.html#a6e5b90edb84d216267148dddcffe9b9a">pbx_builtin_setvar_helper</a>(chan, <span class="stringliteral">&quot;MVM_RECORD_STATUS&quot;</span>, <span class="stringliteral">&quot;FAILED&quot;</span>);</div><div class="line"><a name="l02042"></a><span class="lineno"> 2042</span>&#160;         <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l02043"></a><span class="lineno"> 2043</span>&#160;      }</div><div class="line"><a name="l02044"></a><span class="lineno"> 2044</span>&#160;      fclose(txt); <span class="comment">/* Close log file */</span></div><div class="line"><a name="l02045"></a><span class="lineno"> 2045</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="../../d2/d4d/file_8h.html#ab9b8ab8e5ee34c9b4da25779255cafde">ast_fileexists</a>(tmptxtfile, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) &lt;= 0) {</div><div class="line"><a name="l02046"></a><span class="lineno"> 2046</span>&#160;         <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(1, <span class="stringliteral">&quot;The recorded media file is gone, so we should remove the .txt file too!\n&quot;</span>);</div><div class="line"><a name="l02047"></a><span class="lineno"> 2047</span>&#160;         unlink(tmptxtfile);</div><div class="line"><a name="l02048"></a><span class="lineno"> 2048</span>&#160;         <a class="code" href="../../db/de0/pbx_8h.html#a6e5b90edb84d216267148dddcffe9b9a">pbx_builtin_setvar_helper</a>(chan, <span class="stringliteral">&quot;MVM_RECORD_STATUS&quot;</span>, <span class="stringliteral">&quot;FAILED&quot;</span>);</div><div class="line"><a name="l02049"></a><span class="lineno"> 2049</span>&#160;         <span class="keywordflow">if</span>(<a class="code" href="../../d5/d60/utils_8h.html#a00d4c9254c9827d6fa44f17a326744a5">ast_test_flag</a>(vmu, <a class="code" href="../../de/dfe/app__minivm_8c.html#ac1976490b5dd7e2dae38667d5d21fe4a">MVM_ALLOCED</a>))</div><div class="line"><a name="l02050"></a><span class="lineno"> 2050</span>&#160;            <a class="code" href="../../de/dfe/app__minivm_8c.html#a1c42a258925cbbb46952152ec3785bfd">free_user</a>(vmu);</div><div class="line"><a name="l02051"></a><span class="lineno"> 2051</span>&#160;         <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l02052"></a><span class="lineno"> 2052</span>&#160;      }</div><div class="line"><a name="l02053"></a><span class="lineno"> 2053</span>&#160;</div><div class="line"><a name="l02054"></a><span class="lineno"> 2054</span>&#160;      <span class="comment">/* Set channel variables for the notify application */</span></div><div class="line"><a name="l02055"></a><span class="lineno"> 2055</span>&#160;      <a class="code" href="../../db/de0/pbx_8h.html#a6e5b90edb84d216267148dddcffe9b9a">pbx_builtin_setvar_helper</a>(chan, <span class="stringliteral">&quot;MVM_FILENAME&quot;</span>, tmptxtfile);</div><div class="line"><a name="l02056"></a><span class="lineno"> 2056</span>&#160;      snprintf(timebuf, <span class="keyword">sizeof</span>(timebuf), <span class="stringliteral">&quot;%d&quot;</span>, duration);</div><div class="line"><a name="l02057"></a><span class="lineno"> 2057</span>&#160;      <a class="code" href="../../db/de0/pbx_8h.html#a6e5b90edb84d216267148dddcffe9b9a">pbx_builtin_setvar_helper</a>(chan, <span class="stringliteral">&quot;MVM_DURATION&quot;</span>, timebuf);</div><div class="line"><a name="l02058"></a><span class="lineno"> 2058</span>&#160;      <a class="code" href="../../db/de0/pbx_8h.html#a6e5b90edb84d216267148dddcffe9b9a">pbx_builtin_setvar_helper</a>(chan, <span class="stringliteral">&quot;MVM_FORMAT&quot;</span>, fmt);</div><div class="line"><a name="l02059"></a><span class="lineno"> 2059</span>&#160;</div><div class="line"><a name="l02060"></a><span class="lineno"> 2060</span>&#160;   }</div><div class="line"><a name="l02061"></a><span class="lineno"> 2061</span>&#160;   <a class="code" href="../../de/dfe/app__minivm_8c.html#afb3339bdf5d1db127a88fc3be1dbcb1c">global_stats</a>.<a class="code" href="../../d6/dee/structminivm__stats.html#a5787090892a375d9cfd599710d971b63">lastreceived</a> = <a class="code" href="../../de/df7/time_8h.html#ad3899efb6f0e348556ef69f5b16aa7f7">ast_tvnow</a>();</div><div class="line"><a name="l02062"></a><span class="lineno"> 2062</span>&#160;   <a class="code" href="../../de/dfe/app__minivm_8c.html#afb3339bdf5d1db127a88fc3be1dbcb1c">global_stats</a>.<a class="code" href="../../d6/dee/structminivm__stats.html#a6e076e5da3ca4090f6072b01a7e0a05c">receivedmessages</a>++;</div><div class="line"><a name="l02063"></a><span class="lineno"> 2063</span>&#160;<span class="preprocessor">#if 0</span></div><div class="line"><a name="l02064"></a><span class="lineno"> 2064</span>&#160;   <span class="comment">/* Go ahead and delete audio files from system, they&#39;re not needed any more */</span></div><div class="line"><a name="l02065"></a><span class="lineno"> 2065</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d2/d4d/file_8h.html#ab9b8ab8e5ee34c9b4da25779255cafde">ast_fileexists</a>(tmptxtfile, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) &lt;= 0) {</div><div class="line"><a name="l02066"></a><span class="lineno"> 2066</span>&#160;      <a class="code" href="../../d2/d4d/file_8h.html#adb15d6efecc1a13b8835bee6d3562ddb">ast_filedelete</a>(tmptxtfile, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div><div class="line"><a name="l02067"></a><span class="lineno"> 2067</span>&#160;       <span class="comment">/* Even not being used at the moment, it&#39;s better to convert ast_log to ast_debug anyway */</span></div><div class="line"><a name="l02068"></a><span class="lineno"> 2068</span>&#160;      <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(2, <span class="stringliteral">&quot;-_-_- Deleted audio file after notification :: %s \n&quot;</span>, tmptxtfile);</div><div class="line"><a name="l02069"></a><span class="lineno"> 2069</span>&#160;   }</div><div class="line"><a name="l02070"></a><span class="lineno"> 2070</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l02071"></a><span class="lineno"> 2071</span>&#160;</div><div class="line"><a name="l02072"></a><span class="lineno"> 2072</span>&#160;   <span class="keywordflow">if</span> (res &gt; 0)</div><div class="line"><a name="l02073"></a><span class="lineno"> 2073</span>&#160;      res = 0;</div><div class="line"><a name="l02074"></a><span class="lineno"> 2074</span>&#160;</div><div class="line"><a name="l02075"></a><span class="lineno"> 2075</span>&#160;   <span class="keywordflow">if</span>(<a class="code" href="../../d5/d60/utils_8h.html#a00d4c9254c9827d6fa44f17a326744a5">ast_test_flag</a>(vmu, <a class="code" href="../../de/dfe/app__minivm_8c.html#ac1976490b5dd7e2dae38667d5d21fe4a">MVM_ALLOCED</a>))</div><div class="line"><a name="l02076"></a><span class="lineno"> 2076</span>&#160;      <a class="code" href="../../de/dfe/app__minivm_8c.html#a1c42a258925cbbb46952152ec3785bfd">free_user</a>(vmu);</div><div class="line"><a name="l02077"></a><span class="lineno"> 2077</span>&#160;</div><div class="line"><a name="l02078"></a><span class="lineno"> 2078</span>&#160;   <a class="code" href="../../db/de0/pbx_8h.html#a6e5b90edb84d216267148dddcffe9b9a">pbx_builtin_setvar_helper</a>(chan, <span class="stringliteral">&quot;MVM_RECORD_STATUS&quot;</span>, <span class="stringliteral">&quot;SUCCESS&quot;</span>);</div><div class="line"><a name="l02079"></a><span class="lineno"> 2079</span>&#160;   <span class="keywordflow">return</span> res;</div><div class="line"><a name="l02080"></a><span class="lineno"> 2080</span>&#160;}</div><div class="line"><a name="l02081"></a><span class="lineno"> 2081</span>&#160;<span class="comment"></span></div><div class="line"><a name="l02082"></a><span class="lineno"> 2082</span>&#160;<span class="comment">/*!\internal</span></div><div class="line"><a name="l02083"></a><span class="lineno"> 2083</span>&#160;<span class="comment"> * \brief Queue a message waiting event */</span></div><div class="line"><a name="l02084"></a><span class="lineno"><a class="line" href="../../de/dfe/app__minivm_8c.html#a239c1ca765fe47411d50c5697a6f84a2"> 2084</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../de/dfe/app__minivm_8c.html#a239c1ca765fe47411d50c5697a6f84a2">queue_mwi_event</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *channel_id, <span class="keyword">const</span> <span class="keywordtype">char</span> *mbx, <span class="keyword">const</span> <span class="keywordtype">char</span> *ctx, <span class="keywordtype">int</span> urgent, <span class="keywordtype">int</span> <span class="keyword">new</span>, <span class="keywordtype">int</span> old)</div><div class="line"><a name="l02085"></a><span class="lineno"> 2085</span>&#160;{</div><div class="line"><a name="l02086"></a><span class="lineno"> 2086</span>&#160;   <span class="keywordtype">char</span> *<a class="code" href="../../d0/dd6/chan__mgcp_8c.html#a6b49cafa2a3d359a2e865992f551874a">mailbox</a>, *<a class="code" href="../../da/d45/chan__alsa_8c.html#ac25ea00ee3f082df06e0cf468cbde240">context</a>;</div><div class="line"><a name="l02087"></a><span class="lineno"> 2087</span>&#160;</div><div class="line"><a name="l02088"></a><span class="lineno"> 2088</span>&#160;   mailbox = <a class="code" href="../../d8/d8a/astmm_8h.html#ab5f0750cc80ba337fdcbddea2d3a1ee6">ast_strdupa</a>(mbx);</div><div class="line"><a name="l02089"></a><span class="lineno"> 2089</span>&#160;   context = <a class="code" href="../../d8/d8a/astmm_8h.html#ab5f0750cc80ba337fdcbddea2d3a1ee6">ast_strdupa</a>(ctx);</div><div class="line"><a name="l02090"></a><span class="lineno"> 2090</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a>(context)) {</div><div class="line"><a name="l02091"></a><span class="lineno"> 2091</span>&#160;      context = <span class="stringliteral">&quot;default&quot;</span>;</div><div class="line"><a name="l02092"></a><span class="lineno"> 2092</span>&#160;   }</div><div class="line"><a name="l02093"></a><span class="lineno"> 2093</span>&#160;</div><div class="line"><a name="l02094"></a><span class="lineno"> 2094</span>&#160;   <a class="code" href="../../dc/d33/mwi_8h.html#a3cbb94b9d65cd0a9beb2276292946a61">ast_publish_mwi_state_channel</a>(mailbox, context, <span class="keyword">new</span> + urgent, old, channel_id);</div><div class="line"><a name="l02095"></a><span class="lineno"> 2095</span>&#160;}</div><div class="line"><a name="l02096"></a><span class="lineno"> 2096</span>&#160;<span class="comment"></span></div><div class="line"><a name="l02097"></a><span class="lineno"> 2097</span>&#160;<span class="comment">/*!\internal</span></div><div class="line"><a name="l02098"></a><span class="lineno"> 2098</span>&#160;<span class="comment"> * \brief Send MWI using interal Asterisk event subsystem */</span></div><div class="line"><a name="l02099"></a><span class="lineno"><a class="line" href="../../de/dfe/app__minivm_8c.html#a699f6a5bd7a67eb7b46ad192873e3c73"> 2099</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../de/dfe/app__minivm_8c.html#a699f6a5bd7a67eb7b46ad192873e3c73">minivm_mwi_exec</a>(<span class="keyword">struct</span> <a class="code" href="../../df/d3c/structast__channel.html">ast_channel</a> *chan, <span class="keyword">const</span> <span class="keywordtype">char</span> *data)</div><div class="line"><a name="l02100"></a><span class="lineno"> 2100</span>&#160;{</div><div class="line"><a name="l02101"></a><span class="lineno"> 2101</span>&#160;   <span class="keywordtype">int</span> argc;</div><div class="line"><a name="l02102"></a><span class="lineno"> 2102</span>&#160;   <span class="keywordtype">char</span> *argv[4];</div><div class="line"><a name="l02103"></a><span class="lineno"> 2103</span>&#160;   <span class="keywordtype">int</span> res = 0;</div><div class="line"><a name="l02104"></a><span class="lineno"> 2104</span>&#160;   <span class="keywordtype">char</span> *tmpptr;</div><div class="line"><a name="l02105"></a><span class="lineno"> 2105</span>&#160;   <span class="keywordtype">char</span> <a class="code" href="../../de/d1e/bt__open_8c.html#a1cdd2bb1a9a71d3e1120100229315d67">tmp</a>[<a class="code" href="../../db/db2/asterisk_8h.html#ae688d728e1acdfe5988c7db45d6f0166">PATH_MAX</a>];</div><div class="line"><a name="l02106"></a><span class="lineno"> 2106</span>&#160;   <span class="keywordtype">char</span> *<a class="code" href="../../d0/dd6/chan__mgcp_8c.html#a6b49cafa2a3d359a2e865992f551874a">mailbox</a>;</div><div class="line"><a name="l02107"></a><span class="lineno"> 2107</span>&#160;   <span class="keywordtype">char</span> *<a class="code" href="../../dc/d7b/structminivm__account.html#ae43ea5d0335f149f0920d33e46b61c33">domain</a>;</div><div class="line"><a name="l02108"></a><span class="lineno"> 2108</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a>(data))  {</div><div class="line"><a name="l02109"></a><span class="lineno"> 2109</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Minivm needs at least an account argument \n&quot;</span>);</div><div class="line"><a name="l02110"></a><span class="lineno"> 2110</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l02111"></a><span class="lineno"> 2111</span>&#160;   }</div><div class="line"><a name="l02112"></a><span class="lineno"> 2112</span>&#160;   tmpptr = <a class="code" href="../../d8/d8a/astmm_8h.html#ab5f0750cc80ba337fdcbddea2d3a1ee6">ast_strdupa</a>((<span class="keywordtype">char</span> *)data);</div><div class="line"><a name="l02113"></a><span class="lineno"> 2113</span>&#160;   argc = <a class="code" href="../../d3/d93/include_2asterisk_2app_8h.html#a588ed7395623b8493efcf229024af9c5">ast_app_separate_args</a>(tmpptr, <span class="charliteral">&#39;,&#39;</span>, argv, <a class="code" href="../../de/dfe/isdn__lib_8c.html#ab9129b977a587b50ea801daac75e178f">ARRAY_LEN</a>(argv));</div><div class="line"><a name="l02114"></a><span class="lineno"> 2114</span>&#160;   <span class="keywordflow">if</span> (argc &lt; 4) {</div><div class="line"><a name="l02115"></a><span class="lineno"> 2115</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;%d arguments passed to MiniVM_MWI, need 4.\n&quot;</span>, argc);</div><div class="line"><a name="l02116"></a><span class="lineno"> 2116</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l02117"></a><span class="lineno"> 2117</span>&#160;   }</div><div class="line"><a name="l02118"></a><span class="lineno"> 2118</span>&#160;   <a class="code" href="../../d6/d90/strings_8h.html#ac4040268f7b6ed77dfc49c7767626369">ast_copy_string</a>(tmp, argv[0], <span class="keyword">sizeof</span>(tmp));</div><div class="line"><a name="l02119"></a><span class="lineno"> 2119</span>&#160;   mailbox = <a class="code" href="../../de/d1e/bt__open_8c.html#a1cdd2bb1a9a71d3e1120100229315d67">tmp</a>;</div><div class="line"><a name="l02120"></a><span class="lineno"> 2120</span>&#160;   domain = strchr(tmp, <span class="charliteral">&#39;@&#39;</span>);</div><div class="line"><a name="l02121"></a><span class="lineno"> 2121</span>&#160;   <span class="keywordflow">if</span> (domain) {</div><div class="line"><a name="l02122"></a><span class="lineno"> 2122</span>&#160;      *domain = <span class="charliteral">&#39;\0&#39;</span>;</div><div class="line"><a name="l02123"></a><span class="lineno"> 2123</span>&#160;      domain++;</div><div class="line"><a name="l02124"></a><span class="lineno"> 2124</span>&#160;   }</div><div class="line"><a name="l02125"></a><span class="lineno"> 2125</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a>(domain) || <a class="code" href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a>(mailbox)) {</div><div class="line"><a name="l02126"></a><span class="lineno"> 2126</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Need mailbox@context as argument. Sorry. Argument 0 %s\n&quot;</span>, argv[0]);</div><div class="line"><a name="l02127"></a><span class="lineno"> 2127</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l02128"></a><span class="lineno"> 2128</span>&#160;   }</div><div class="line"><a name="l02129"></a><span class="lineno"> 2129</span>&#160;   <a class="code" href="../../de/dfe/app__minivm_8c.html#a239c1ca765fe47411d50c5697a6f84a2">queue_mwi_event</a>(<a class="code" href="../../d5/d7b/channel_8h.html#a3b6254f6d3832ef928f0a727113b1c63">ast_channel_uniqueid</a>(chan), mailbox, domain, atoi(argv[1]), atoi(argv[2]), atoi(argv[3]));</div><div class="line"><a name="l02130"></a><span class="lineno"> 2130</span>&#160;</div><div class="line"><a name="l02131"></a><span class="lineno"> 2131</span>&#160;   <span class="keywordflow">return</span> res;</div><div class="line"><a name="l02132"></a><span class="lineno"> 2132</span>&#160;}</div><div class="line"><a name="l02133"></a><span class="lineno"> 2133</span>&#160;</div><div class="line"><a name="l02134"></a><span class="lineno"> 2134</span>&#160;<span class="comment"></span></div><div class="line"><a name="l02135"></a><span class="lineno"> 2135</span>&#160;<span class="comment">/*!\internal</span></div><div class="line"><a name="l02136"></a><span class="lineno"> 2136</span>&#160;<span class="comment"> * \brief Notify voicemail account owners - either generic template or user specific */</span></div><div class="line"><a name="l02137"></a><span class="lineno"><a class="line" href="../../de/dfe/app__minivm_8c.html#a273c55efb0bbc772f28cddd2d4bb97c7"> 2137</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../de/dfe/app__minivm_8c.html#a273c55efb0bbc772f28cddd2d4bb97c7">minivm_notify_exec</a>(<span class="keyword">struct</span> <a class="code" href="../../df/d3c/structast__channel.html">ast_channel</a> *chan, <span class="keyword">const</span> <span class="keywordtype">char</span> *data)</div><div class="line"><a name="l02138"></a><span class="lineno"> 2138</span>&#160;{</div><div class="line"><a name="l02139"></a><span class="lineno"> 2139</span>&#160;   <span class="keywordtype">int</span> argc;</div><div class="line"><a name="l02140"></a><span class="lineno"> 2140</span>&#160;   <span class="keywordtype">char</span> *argv[2];</div><div class="line"><a name="l02141"></a><span class="lineno"> 2141</span>&#160;   <span class="keywordtype">int</span> res = 0;</div><div class="line"><a name="l02142"></a><span class="lineno"> 2142</span>&#160;   <span class="keywordtype">char</span> <a class="code" href="../../de/d1e/bt__open_8c.html#a1cdd2bb1a9a71d3e1120100229315d67">tmp</a>[<a class="code" href="../../db/db2/asterisk_8h.html#ae688d728e1acdfe5988c7db45d6f0166">PATH_MAX</a>];</div><div class="line"><a name="l02143"></a><span class="lineno"> 2143</span>&#160;   <span class="keywordtype">char</span> *<a class="code" href="../../dc/d7b/structminivm__account.html#ae43ea5d0335f149f0920d33e46b61c33">domain</a>;</div><div class="line"><a name="l02144"></a><span class="lineno"> 2144</span>&#160;   <span class="keywordtype">char</span> *tmpptr;</div><div class="line"><a name="l02145"></a><span class="lineno"> 2145</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../dc/d7b/structminivm__account.html">minivm_account</a> *vmu;</div><div class="line"><a name="l02146"></a><span class="lineno"> 2146</span>&#160;   <span class="keywordtype">char</span> *<a class="code" href="../../dc/d7b/structminivm__account.html#a4b30874d24514b5ef6ff5276e8c12ed4">username</a>;</div><div class="line"><a name="l02147"></a><span class="lineno"> 2147</span>&#160;   <span class="keyword">const</span> <span class="keywordtype">char</span> *<span class="keyword">template</span> = <span class="stringliteral">&quot;&quot;</span>;</div><div class="line"><a name="l02148"></a><span class="lineno"> 2148</span>&#160;   <span class="keyword">const</span> <span class="keywordtype">char</span> *filename;</div><div class="line"><a name="l02149"></a><span class="lineno"> 2149</span>&#160;   <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="../../da/d45/chan__alsa_8c.html#a98f5e70e98f6dc48e3c5ba316066d540">format</a>;</div><div class="line"><a name="l02150"></a><span class="lineno"> 2150</span>&#160;   <span class="keyword">const</span> <span class="keywordtype">char</span> *duration_string;</div><div class="line"><a name="l02151"></a><span class="lineno"> 2151</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a>(data))  {</div><div class="line"><a name="l02152"></a><span class="lineno"> 2152</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Minivm needs at least an account argument \n&quot;</span>);</div><div class="line"><a name="l02153"></a><span class="lineno"> 2153</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l02154"></a><span class="lineno"> 2154</span>&#160;   }</div><div class="line"><a name="l02155"></a><span class="lineno"> 2155</span>&#160;   tmpptr = <a class="code" href="../../d8/d8a/astmm_8h.html#ab5f0750cc80ba337fdcbddea2d3a1ee6">ast_strdupa</a>((<span class="keywordtype">char</span> *)data);</div><div class="line"><a name="l02156"></a><span class="lineno"> 2156</span>&#160;   argc = <a class="code" href="../../d3/d93/include_2asterisk_2app_8h.html#a588ed7395623b8493efcf229024af9c5">ast_app_separate_args</a>(tmpptr, <span class="charliteral">&#39;,&#39;</span>, argv, <a class="code" href="../../de/dfe/isdn__lib_8c.html#ab9129b977a587b50ea801daac75e178f">ARRAY_LEN</a>(argv));</div><div class="line"><a name="l02157"></a><span class="lineno"> 2157</span>&#160;</div><div class="line"><a name="l02158"></a><span class="lineno"> 2158</span>&#160;   <span class="keywordflow">if</span> (argc == 2 &amp;&amp; !<a class="code" href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a>(argv[1]))</div><div class="line"><a name="l02159"></a><span class="lineno"> 2159</span>&#160;      <span class="keyword">template</span> = argv[1];</div><div class="line"><a name="l02160"></a><span class="lineno"> 2160</span>&#160;</div><div class="line"><a name="l02161"></a><span class="lineno"> 2161</span>&#160;   <a class="code" href="../../d6/d90/strings_8h.html#ac4040268f7b6ed77dfc49c7767626369">ast_copy_string</a>(tmp, argv[0], <span class="keyword">sizeof</span>(tmp));</div><div class="line"><a name="l02162"></a><span class="lineno"> 2162</span>&#160;   username = <a class="code" href="../../de/d1e/bt__open_8c.html#a1cdd2bb1a9a71d3e1120100229315d67">tmp</a>;</div><div class="line"><a name="l02163"></a><span class="lineno"> 2163</span>&#160;   domain = strchr(tmp, <span class="charliteral">&#39;@&#39;</span>);</div><div class="line"><a name="l02164"></a><span class="lineno"> 2164</span>&#160;   <span class="keywordflow">if</span> (domain) {</div><div class="line"><a name="l02165"></a><span class="lineno"> 2165</span>&#160;      *domain = <span class="charliteral">&#39;\0&#39;</span>;</div><div class="line"><a name="l02166"></a><span class="lineno"> 2166</span>&#160;      domain++;</div><div class="line"><a name="l02167"></a><span class="lineno"> 2167</span>&#160;   }</div><div class="line"><a name="l02168"></a><span class="lineno"> 2168</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a>(domain) || <a class="code" href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a>(username)) {</div><div class="line"><a name="l02169"></a><span class="lineno"> 2169</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Need username@domain as argument. Sorry. Argument 0 %s\n&quot;</span>, argv[0]);</div><div class="line"><a name="l02170"></a><span class="lineno"> 2170</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l02171"></a><span class="lineno"> 2171</span>&#160;   }</div><div class="line"><a name="l02172"></a><span class="lineno"> 2172</span>&#160;</div><div class="line"><a name="l02173"></a><span class="lineno"> 2173</span>&#160;   <span class="keywordflow">if</span>(!(vmu = <a class="code" href="../../de/dfe/app__minivm_8c.html#ac26055cad7a69cbfb6692d273f025a40">find_account</a>(domain, username, <a class="code" href="../../de/dfe/app__minivm_8c.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>))) {</div><div class="line"><a name="l02174"></a><span class="lineno"> 2174</span>&#160;      <span class="comment">/* We could not find user, let&#39;s exit */</span></div><div class="line"><a name="l02175"></a><span class="lineno"> 2175</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Could not allocate temporary memory for &#39;%s@%s&#39;\n&quot;</span>, username, domain);</div><div class="line"><a name="l02176"></a><span class="lineno"> 2176</span>&#160;      <a class="code" href="../../db/de0/pbx_8h.html#a6e5b90edb84d216267148dddcffe9b9a">pbx_builtin_setvar_helper</a>(chan, <span class="stringliteral">&quot;MVM_NOTIFY_STATUS&quot;</span>, <span class="stringliteral">&quot;FAILED&quot;</span>);</div><div class="line"><a name="l02177"></a><span class="lineno"> 2177</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l02178"></a><span class="lineno"> 2178</span>&#160;   }</div><div class="line"><a name="l02179"></a><span class="lineno"> 2179</span>&#160;</div><div class="line"><a name="l02180"></a><span class="lineno"> 2180</span>&#160;   <a class="code" href="../../d5/d7b/channel_8h.html#a493bdebe876caafb8ee535853310364a">ast_channel_lock</a>(chan);</div><div class="line"><a name="l02181"></a><span class="lineno"> 2181</span>&#160;   <span class="keywordflow">if</span> ((filename = <a class="code" href="../../db/de0/pbx_8h.html#a98c5425b90ec7c5e136a40f529170b1b">pbx_builtin_getvar_helper</a>(chan, <span class="stringliteral">&quot;MVM_FILENAME&quot;</span>))) {</div><div class="line"><a name="l02182"></a><span class="lineno"> 2182</span>&#160;      filename = <a class="code" href="../../d8/d8a/astmm_8h.html#ab5f0750cc80ba337fdcbddea2d3a1ee6">ast_strdupa</a>(filename);</div><div class="line"><a name="l02183"></a><span class="lineno"> 2183</span>&#160;   }</div><div class="line"><a name="l02184"></a><span class="lineno"> 2184</span>&#160;   <a class="code" href="../../d5/d7b/channel_8h.html#af476c537b29be3f29240489032f9db39">ast_channel_unlock</a>(chan);</div><div class="line"><a name="l02185"></a><span class="lineno"> 2185</span>&#160;   <span class="comment">/* Notify of new message to e-mail and pager */</span></div><div class="line"><a name="l02186"></a><span class="lineno"> 2186</span>&#160;   <span class="keywordflow">if</span> (!<a class="code" href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a>(filename)) {</div><div class="line"><a name="l02187"></a><span class="lineno"> 2187</span>&#160;      <a class="code" href="../../d5/d7b/channel_8h.html#a493bdebe876caafb8ee535853310364a">ast_channel_lock</a>(chan);</div><div class="line"><a name="l02188"></a><span class="lineno"> 2188</span>&#160;      <span class="keywordflow">if</span> ((format = <a class="code" href="../../db/de0/pbx_8h.html#a98c5425b90ec7c5e136a40f529170b1b">pbx_builtin_getvar_helper</a>(chan, <span class="stringliteral">&quot;MVM_FORMAT&quot;</span>))) {</div><div class="line"><a name="l02189"></a><span class="lineno"> 2189</span>&#160;         format = <a class="code" href="../../d8/d8a/astmm_8h.html#ab5f0750cc80ba337fdcbddea2d3a1ee6">ast_strdupa</a>(format);</div><div class="line"><a name="l02190"></a><span class="lineno"> 2190</span>&#160;      }</div><div class="line"><a name="l02191"></a><span class="lineno"> 2191</span>&#160;      <span class="keywordflow">if</span> ((duration_string = <a class="code" href="../../db/de0/pbx_8h.html#a98c5425b90ec7c5e136a40f529170b1b">pbx_builtin_getvar_helper</a>(chan, <span class="stringliteral">&quot;MVM_DURATION&quot;</span>))) {</div><div class="line"><a name="l02192"></a><span class="lineno"> 2192</span>&#160;         duration_string = <a class="code" href="../../d8/d8a/astmm_8h.html#ab5f0750cc80ba337fdcbddea2d3a1ee6">ast_strdupa</a>(duration_string);</div><div class="line"><a name="l02193"></a><span class="lineno"> 2193</span>&#160;      }</div><div class="line"><a name="l02194"></a><span class="lineno"> 2194</span>&#160;      <a class="code" href="../../d5/d7b/channel_8h.html#af476c537b29be3f29240489032f9db39">ast_channel_unlock</a>(chan);</div><div class="line"><a name="l02195"></a><span class="lineno"> 2195</span>&#160;      res = <a class="code" href="../../de/dfe/app__minivm_8c.html#a922e4ae6e4c3f8a0ce361b0d3264ca54">notify_new_message</a>(chan, <span class="keyword">template</span>, vmu, filename, atoi(duration_string),</div><div class="line"><a name="l02196"></a><span class="lineno"> 2196</span>&#160;         format,</div><div class="line"><a name="l02197"></a><span class="lineno"> 2197</span>&#160;         <a class="code" href="../../d6/d90/strings_8h.html#a38a896048b2ca84076864505f0aa8f01">S_COR</a>(<a class="code" href="../../d5/d7b/channel_8h.html#ac2dc872b606534943c98304aed841b34">ast_channel_caller</a>(chan)-&gt;<span class="keywordtype">id</span>.<a class="code" href="../../d6/d49/structnumber.html">number</a>.valid, <a class="code" href="../../d5/d7b/channel_8h.html#ac2dc872b606534943c98304aed841b34">ast_channel_caller</a>(chan)-&gt;<span class="keywordtype">id</span>.<a class="code" href="../../d6/d49/structnumber.html">number</a>.str, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>),</div><div class="line"><a name="l02198"></a><span class="lineno"> 2198</span>&#160;         <a class="code" href="../../d6/d90/strings_8h.html#a38a896048b2ca84076864505f0aa8f01">S_COR</a>(<a class="code" href="../../d5/d7b/channel_8h.html#ac2dc872b606534943c98304aed841b34">ast_channel_caller</a>(chan)-&gt;<span class="keywordtype">id</span>.<a class="code" href="../../d0/d29/cdr__mysql_8c.html#a0980a105ccb863d8008eb6201a51da52">name</a>.valid, <a class="code" href="../../d5/d7b/channel_8h.html#ac2dc872b606534943c98304aed841b34">ast_channel_caller</a>(chan)-&gt;<span class="keywordtype">id</span>.<a class="code" href="../../d0/d29/cdr__mysql_8c.html#a0980a105ccb863d8008eb6201a51da52">name</a>.str, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>));</div><div class="line"><a name="l02199"></a><span class="lineno"> 2199</span>&#160;   }</div><div class="line"><a name="l02200"></a><span class="lineno"> 2200</span>&#160;</div><div class="line"><a name="l02201"></a><span class="lineno"> 2201</span>&#160;   <a class="code" href="../../db/de0/pbx_8h.html#a6e5b90edb84d216267148dddcffe9b9a">pbx_builtin_setvar_helper</a>(chan, <span class="stringliteral">&quot;MVM_NOTIFY_STATUS&quot;</span>, res == 0 ? <span class="stringliteral">&quot;SUCCESS&quot;</span> : <span class="stringliteral">&quot;FAILED&quot;</span>);</div><div class="line"><a name="l02202"></a><span class="lineno"> 2202</span>&#160;</div><div class="line"><a name="l02203"></a><span class="lineno"> 2203</span>&#160;</div><div class="line"><a name="l02204"></a><span class="lineno"> 2204</span>&#160;   <span class="keywordflow">if</span>(<a class="code" href="../../d5/d60/utils_8h.html#a00d4c9254c9827d6fa44f17a326744a5">ast_test_flag</a>(vmu, <a class="code" href="../../de/dfe/app__minivm_8c.html#ac1976490b5dd7e2dae38667d5d21fe4a">MVM_ALLOCED</a>))</div><div class="line"><a name="l02205"></a><span class="lineno"> 2205</span>&#160;      <a class="code" href="../../de/dfe/app__minivm_8c.html#a1c42a258925cbbb46952152ec3785bfd">free_user</a>(vmu);</div><div class="line"><a name="l02206"></a><span class="lineno"> 2206</span>&#160;</div><div class="line"><a name="l02207"></a><span class="lineno"> 2207</span>&#160;   <span class="comment">/* Ok, we&#39;re ready to rock and roll. Return to dialplan */</span></div><div class="line"><a name="l02208"></a><span class="lineno"> 2208</span>&#160;</div><div class="line"><a name="l02209"></a><span class="lineno"> 2209</span>&#160;   <span class="keywordflow">return</span> res;</div><div class="line"><a name="l02210"></a><span class="lineno"> 2210</span>&#160;</div><div class="line"><a name="l02211"></a><span class="lineno"> 2211</span>&#160;}</div><div class="line"><a name="l02212"></a><span class="lineno"> 2212</span>&#160;<span class="comment"></span></div><div class="line"><a name="l02213"></a><span class="lineno"> 2213</span>&#160;<span class="comment">/*!\internal</span></div><div class="line"><a name="l02214"></a><span class="lineno"> 2214</span>&#160;<span class="comment"> * \brief Dialplan function to record voicemail */</span></div><div class="line"><a name="l02215"></a><span class="lineno"><a class="line" href="../../de/dfe/app__minivm_8c.html#a26e1aa3cbc892fb673e775c75bb67fe3"> 2215</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../de/dfe/app__minivm_8c.html#a26e1aa3cbc892fb673e775c75bb67fe3">minivm_record_exec</a>(<span class="keyword">struct</span> <a class="code" href="../../df/d3c/structast__channel.html">ast_channel</a> *chan, <span class="keyword">const</span> <span class="keywordtype">char</span> *data)</div><div class="line"><a name="l02216"></a><span class="lineno"> 2216</span>&#160;{</div><div class="line"><a name="l02217"></a><span class="lineno"> 2217</span>&#160;   <span class="keywordtype">int</span> res = 0;</div><div class="line"><a name="l02218"></a><span class="lineno"> 2218</span>&#160;   <span class="keywordtype">char</span> *<a class="code" href="../../de/d1e/bt__open_8c.html#a1cdd2bb1a9a71d3e1120100229315d67">tmp</a>;</div><div class="line"><a name="l02219"></a><span class="lineno"> 2219</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../dd/df7/structleave__vm__options.html">leave_vm_options</a> leave_options;</div><div class="line"><a name="l02220"></a><span class="lineno"> 2220</span>&#160;   <span class="keywordtype">int</span> argc;</div><div class="line"><a name="l02221"></a><span class="lineno"> 2221</span>&#160;   <span class="keywordtype">char</span> *argv[2];</div><div class="line"><a name="l02222"></a><span class="lineno"> 2222</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../dc/dac/structast__flags.html">ast_flags</a> <a class="code" href="../../dc/d7b/structminivm__account.html#ac92588540e8c1d014a08cd8a45462b19">flags</a> = { 0 };</div><div class="line"><a name="l02223"></a><span class="lineno"> 2223</span>&#160;   <span class="keywordtype">char</span> *opts[<a class="code" href="../../de/dfe/app__minivm_8c.html#a94a4fdd9ccddad3436c2c6f165ea5214aec7326f60e7edad15d96ff935e5616d6">OPT_ARG_ARRAY_SIZE</a>];</div><div class="line"><a name="l02224"></a><span class="lineno"> 2224</span>&#160;</div><div class="line"><a name="l02225"></a><span class="lineno"> 2225</span>&#160;   memset(&amp;leave_options, 0, <span class="keyword">sizeof</span>(leave_options));</div><div class="line"><a name="l02226"></a><span class="lineno"> 2226</span>&#160;</div><div class="line"><a name="l02227"></a><span class="lineno"> 2227</span>&#160;   <span class="comment">/* Answer channel if it&#39;s not already answered */</span></div><div class="line"><a name="l02228"></a><span class="lineno"> 2228</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d9/d95/channelstate_8h.html#a03585bc87e5bbd0f4d11bc789734c660">ast_channel_state</a>(chan) != <a class="code" href="../../d9/d95/channelstate_8h.html#a03585bc87e5bbd0f4d11bc789734c660aa8ab4bcda7378ccc17c39dfd880cba3d">AST_STATE_UP</a>)</div><div class="line"><a name="l02229"></a><span class="lineno"> 2229</span>&#160;      <a class="code" href="../../d5/d7b/channel_8h.html#aec583a3e25358ee552a4f3df53914cd0">ast_answer</a>(chan);</div><div class="line"><a name="l02230"></a><span class="lineno"> 2230</span>&#160;</div><div class="line"><a name="l02231"></a><span class="lineno"> 2231</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a>(data))  {</div><div class="line"><a name="l02232"></a><span class="lineno"> 2232</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Minivm needs at least an account argument \n&quot;</span>);</div><div class="line"><a name="l02233"></a><span class="lineno"> 2233</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l02234"></a><span class="lineno"> 2234</span>&#160;   }</div><div class="line"><a name="l02235"></a><span class="lineno"> 2235</span>&#160;   tmp = <a class="code" href="../../d8/d8a/astmm_8h.html#ab5f0750cc80ba337fdcbddea2d3a1ee6">ast_strdupa</a>((<span class="keywordtype">char</span> *)data);</div><div class="line"><a name="l02236"></a><span class="lineno"> 2236</span>&#160;   argc = <a class="code" href="../../d3/d93/include_2asterisk_2app_8h.html#a588ed7395623b8493efcf229024af9c5">ast_app_separate_args</a>(tmp, <span class="charliteral">&#39;,&#39;</span>, argv, <a class="code" href="../../de/dfe/isdn__lib_8c.html#ab9129b977a587b50ea801daac75e178f">ARRAY_LEN</a>(argv));</div><div class="line"><a name="l02237"></a><span class="lineno"> 2237</span>&#160;   <span class="keywordflow">if</span> (argc == 2) {</div><div class="line"><a name="l02238"></a><span class="lineno"> 2238</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="../../d3/d93/include_2asterisk_2app_8h.html#af40039f1c49c16d0f6fa33fe9c43a0cb">ast_app_parse_options</a>(<a class="code" href="../../de/dfe/app__minivm_8c.html#aca4c8605b97cb5e7cfc963a88ae76621">minivm_app_options</a>, &amp;flags, opts, argv[1])) {</div><div class="line"><a name="l02239"></a><span class="lineno"> 2239</span>&#160;         <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l02240"></a><span class="lineno"> 2240</span>&#160;      }</div><div class="line"><a name="l02241"></a><span class="lineno"> 2241</span>&#160;      <a class="code" href="../../d5/d60/utils_8h.html#ab9da1c7265610eff83ed6146f104dc6f">ast_copy_flags</a>(&amp;leave_options, &amp;flags, <a class="code" href="../../de/dfe/app__minivm_8c.html#a4aeda8b39c8ab166c538157d05591922a9c6a0359498684912cb0a3810e03138d">OPT_SILENT</a> | <a class="code" href="../../de/dfe/app__minivm_8c.html#a4aeda8b39c8ab166c538157d05591922a6021f80ddb5561e6e07a285ea47b086e">OPT_BUSY_GREETING</a> | <a class="code" href="../../de/dfe/app__minivm_8c.html#a4aeda8b39c8ab166c538157d05591922a96240d093eacd367dd06de745d12e559">OPT_UNAVAIL_GREETING</a> );</div><div class="line"><a name="l02242"></a><span class="lineno"> 2242</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="../../d5/d60/utils_8h.html#a00d4c9254c9827d6fa44f17a326744a5">ast_test_flag</a>(&amp;flags, <a class="code" href="../../de/dfe/app__minivm_8c.html#a4aeda8b39c8ab166c538157d05591922a6f62412bc497c9dd7db876c7ea4f9cfd">OPT_RECORDGAIN</a>)) {</div><div class="line"><a name="l02243"></a><span class="lineno"> 2243</span>&#160;         <span class="keywordtype">int</span> gain;</div><div class="line"><a name="l02244"></a><span class="lineno"> 2244</span>&#160;</div><div class="line"><a name="l02245"></a><span class="lineno"> 2245</span>&#160;         <span class="keywordflow">if</span> (sscanf(opts[<a class="code" href="../../de/dfe/app__minivm_8c.html#a94a4fdd9ccddad3436c2c6f165ea5214a0ba3410dc4adff3119e1a4007cf90a7d">OPT_ARG_RECORDGAIN</a>], <span class="stringliteral">&quot;%30d&quot;</span>, &amp;gain) != 1) {</div><div class="line"><a name="l02246"></a><span class="lineno"> 2246</span>&#160;            <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Invalid value &#39;%s&#39; provided for record gain option\n&quot;</span>, opts[OPT_ARG_RECORDGAIN]);</div><div class="line"><a name="l02247"></a><span class="lineno"> 2247</span>&#160;            <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l02248"></a><span class="lineno"> 2248</span>&#160;         } <span class="keywordflow">else</span></div><div class="line"><a name="l02249"></a><span class="lineno"> 2249</span>&#160;            leave_options.<a class="code" href="../../dd/df7/structleave__vm__options.html#a809cc53dfc8e9f1204c67c26aabaa322">record_gain</a> = (<span class="keywordtype">signed</span> char) gain;</div><div class="line"><a name="l02250"></a><span class="lineno"> 2250</span>&#160;      }</div><div class="line"><a name="l02251"></a><span class="lineno"> 2251</span>&#160;   }</div><div class="line"><a name="l02252"></a><span class="lineno"> 2252</span>&#160;</div><div class="line"><a name="l02253"></a><span class="lineno"> 2253</span>&#160;   <span class="comment">/* Now run the appliation and good luck to you! */</span></div><div class="line"><a name="l02254"></a><span class="lineno"> 2254</span>&#160;   res = <a class="code" href="../../de/dfe/app__minivm_8c.html#ab708636c14961682ea0d718b97f12234">leave_voicemail</a>(chan, argv[0], &amp;leave_options);</div><div class="line"><a name="l02255"></a><span class="lineno"> 2255</span>&#160;</div><div class="line"><a name="l02256"></a><span class="lineno"> 2256</span>&#160;   <span class="keywordflow">if</span> (res == <a class="code" href="../../de/dfe/app__minivm_8c.html#a207c95b6a18096172f7278b3af01f96d">ERROR_LOCK_PATH</a>) {</div><div class="line"><a name="l02257"></a><span class="lineno"> 2257</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Could not leave voicemail. The path is already locked.\n&quot;</span>);</div><div class="line"><a name="l02258"></a><span class="lineno"> 2258</span>&#160;      <a class="code" href="../../db/de0/pbx_8h.html#a6e5b90edb84d216267148dddcffe9b9a">pbx_builtin_setvar_helper</a>(chan, <span class="stringliteral">&quot;MVM_RECORD_STATUS&quot;</span>, <span class="stringliteral">&quot;FAILED&quot;</span>);</div><div class="line"><a name="l02259"></a><span class="lineno"> 2259</span>&#160;      res = 0;</div><div class="line"><a name="l02260"></a><span class="lineno"> 2260</span>&#160;   }</div><div class="line"><a name="l02261"></a><span class="lineno"> 2261</span>&#160;   <a class="code" href="../../db/de0/pbx_8h.html#a6e5b90edb84d216267148dddcffe9b9a">pbx_builtin_setvar_helper</a>(chan, <span class="stringliteral">&quot;MVM_RECORD_STATUS&quot;</span>, <span class="stringliteral">&quot;SUCCESS&quot;</span>);</div><div class="line"><a name="l02262"></a><span class="lineno"> 2262</span>&#160;</div><div class="line"><a name="l02263"></a><span class="lineno"> 2263</span>&#160;   <span class="keywordflow">return</span> res;</div><div class="line"><a name="l02264"></a><span class="lineno"> 2264</span>&#160;}</div><div class="line"><a name="l02265"></a><span class="lineno"> 2265</span>&#160;<span class="comment"></span></div><div class="line"><a name="l02266"></a><span class="lineno"> 2266</span>&#160;<span class="comment">/*!\internal</span></div><div class="line"><a name="l02267"></a><span class="lineno"> 2267</span>&#160;<span class="comment"> * \brief Play voicemail prompts - either generic or user specific */</span></div><div class="line"><a name="l02268"></a><span class="lineno"><a class="line" href="../../de/dfe/app__minivm_8c.html#ad0721ec90e8e85dd4d3a4741df493dc3"> 2268</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../de/dfe/app__minivm_8c.html#ad0721ec90e8e85dd4d3a4741df493dc3">minivm_greet_exec</a>(<span class="keyword">struct</span> <a class="code" href="../../df/d3c/structast__channel.html">ast_channel</a> *chan, <span class="keyword">const</span> <span class="keywordtype">char</span> *data)</div><div class="line"><a name="l02269"></a><span class="lineno"> 2269</span>&#160;{</div><div class="line"><a name="l02270"></a><span class="lineno"> 2270</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../dd/df7/structleave__vm__options.html">leave_vm_options</a> leave_options = { 0, <span class="charliteral">&#39;\0&#39;</span>};</div><div class="line"><a name="l02271"></a><span class="lineno"> 2271</span>&#160;   <span class="keywordtype">int</span> argc;</div><div class="line"><a name="l02272"></a><span class="lineno"> 2272</span>&#160;   <span class="keywordtype">char</span> *argv[2];</div><div class="line"><a name="l02273"></a><span class="lineno"> 2273</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../dc/dac/structast__flags.html">ast_flags</a> <a class="code" href="../../dc/d7b/structminivm__account.html#ac92588540e8c1d014a08cd8a45462b19">flags</a> = { 0 };</div><div class="line"><a name="l02274"></a><span class="lineno"> 2274</span>&#160;   <span class="keywordtype">char</span> *opts[<a class="code" href="../../de/dfe/app__minivm_8c.html#a94a4fdd9ccddad3436c2c6f165ea5214aec7326f60e7edad15d96ff935e5616d6">OPT_ARG_ARRAY_SIZE</a>];</div><div class="line"><a name="l02275"></a><span class="lineno"> 2275</span>&#160;   <span class="keywordtype">int</span> res = 0;</div><div class="line"><a name="l02276"></a><span class="lineno"> 2276</span>&#160;   <span class="keywordtype">int</span> ausemacro = 0;</div><div class="line"><a name="l02277"></a><span class="lineno"> 2277</span>&#160;   <span class="keywordtype">int</span> ousemacro = 0;</div><div class="line"><a name="l02278"></a><span class="lineno"> 2278</span>&#160;   <span class="keywordtype">int</span> ouseexten = 0;</div><div class="line"><a name="l02279"></a><span class="lineno"> 2279</span>&#160;   <span class="keywordtype">char</span> <a class="code" href="../../de/d1e/bt__open_8c.html#a1cdd2bb1a9a71d3e1120100229315d67">tmp</a>[<a class="code" href="../../db/db2/asterisk_8h.html#ae688d728e1acdfe5988c7db45d6f0166">PATH_MAX</a>];</div><div class="line"><a name="l02280"></a><span class="lineno"> 2280</span>&#160;   <span class="keywordtype">char</span> dest[<a class="code" href="../../db/db2/asterisk_8h.html#ae688d728e1acdfe5988c7db45d6f0166">PATH_MAX</a>];</div><div class="line"><a name="l02281"></a><span class="lineno"> 2281</span>&#160;   <span class="keywordtype">char</span> prefile[<a class="code" href="../../db/db2/asterisk_8h.html#ae688d728e1acdfe5988c7db45d6f0166">PATH_MAX</a>] = <span class="stringliteral">&quot;&quot;</span>;</div><div class="line"><a name="l02282"></a><span class="lineno"> 2282</span>&#160;   <span class="keywordtype">char</span> tempfile[<a class="code" href="../../db/db2/asterisk_8h.html#ae688d728e1acdfe5988c7db45d6f0166">PATH_MAX</a>] = <span class="stringliteral">&quot;&quot;</span>;</div><div class="line"><a name="l02283"></a><span class="lineno"> 2283</span>&#160;   <span class="keywordtype">char</span> ext_context[256] = <span class="stringliteral">&quot;&quot;</span>;</div><div class="line"><a name="l02284"></a><span class="lineno"> 2284</span>&#160;   <span class="keywordtype">char</span> *<a class="code" href="../../dc/d7b/structminivm__account.html#ae43ea5d0335f149f0920d33e46b61c33">domain</a>;</div><div class="line"><a name="l02285"></a><span class="lineno"> 2285</span>&#160;   <span class="keywordtype">char</span> ecodes[16] = <span class="stringliteral">&quot;#&quot;</span>;</div><div class="line"><a name="l02286"></a><span class="lineno"> 2286</span>&#160;   <span class="keywordtype">char</span> *tmpptr;</div><div class="line"><a name="l02287"></a><span class="lineno"> 2287</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../dc/d7b/structminivm__account.html">minivm_account</a> *vmu;</div><div class="line"><a name="l02288"></a><span class="lineno"> 2288</span>&#160;   <span class="keywordtype">char</span> *<a class="code" href="../../dc/d7b/structminivm__account.html#a4b30874d24514b5ef6ff5276e8c12ed4">username</a>;</div><div class="line"><a name="l02289"></a><span class="lineno"> 2289</span>&#160;</div><div class="line"><a name="l02290"></a><span class="lineno"> 2290</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a>(data))  {</div><div class="line"><a name="l02291"></a><span class="lineno"> 2291</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Minivm needs at least an account argument \n&quot;</span>);</div><div class="line"><a name="l02292"></a><span class="lineno"> 2292</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l02293"></a><span class="lineno"> 2293</span>&#160;   }</div><div class="line"><a name="l02294"></a><span class="lineno"> 2294</span>&#160;   tmpptr = <a class="code" href="../../d8/d8a/astmm_8h.html#ab5f0750cc80ba337fdcbddea2d3a1ee6">ast_strdupa</a>((<span class="keywordtype">char</span> *)data);</div><div class="line"><a name="l02295"></a><span class="lineno"> 2295</span>&#160;   argc = <a class="code" href="../../d3/d93/include_2asterisk_2app_8h.html#a588ed7395623b8493efcf229024af9c5">ast_app_separate_args</a>(tmpptr, <span class="charliteral">&#39;,&#39;</span>, argv, <a class="code" href="../../de/dfe/isdn__lib_8c.html#ab9129b977a587b50ea801daac75e178f">ARRAY_LEN</a>(argv));</div><div class="line"><a name="l02296"></a><span class="lineno"> 2296</span>&#160;</div><div class="line"><a name="l02297"></a><span class="lineno"> 2297</span>&#160;   <span class="keywordflow">if</span> (argc == 2) {</div><div class="line"><a name="l02298"></a><span class="lineno"> 2298</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="../../d3/d93/include_2asterisk_2app_8h.html#af40039f1c49c16d0f6fa33fe9c43a0cb">ast_app_parse_options</a>(<a class="code" href="../../de/dfe/app__minivm_8c.html#aca4c8605b97cb5e7cfc963a88ae76621">minivm_app_options</a>, &amp;flags, opts, argv[1]))</div><div class="line"><a name="l02299"></a><span class="lineno"> 2299</span>&#160;         <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l02300"></a><span class="lineno"> 2300</span>&#160;      <a class="code" href="../../d5/d60/utils_8h.html#ab9da1c7265610eff83ed6146f104dc6f">ast_copy_flags</a>(&amp;leave_options, &amp;flags, <a class="code" href="../../de/dfe/app__minivm_8c.html#a4aeda8b39c8ab166c538157d05591922a9c6a0359498684912cb0a3810e03138d">OPT_SILENT</a> | <a class="code" href="../../de/dfe/app__minivm_8c.html#a4aeda8b39c8ab166c538157d05591922a6021f80ddb5561e6e07a285ea47b086e">OPT_BUSY_GREETING</a> | <a class="code" href="../../de/dfe/app__minivm_8c.html#a4aeda8b39c8ab166c538157d05591922a96240d093eacd367dd06de745d12e559">OPT_UNAVAIL_GREETING</a> );</div><div class="line"><a name="l02301"></a><span class="lineno"> 2301</span>&#160;   }</div><div class="line"><a name="l02302"></a><span class="lineno"> 2302</span>&#160;</div><div class="line"><a name="l02303"></a><span class="lineno"> 2303</span>&#160;   <a class="code" href="../../d6/d90/strings_8h.html#ac4040268f7b6ed77dfc49c7767626369">ast_copy_string</a>(tmp, argv[0], <span class="keyword">sizeof</span>(tmp));</div><div class="line"><a name="l02304"></a><span class="lineno"> 2304</span>&#160;   username = <a class="code" href="../../de/d1e/bt__open_8c.html#a1cdd2bb1a9a71d3e1120100229315d67">tmp</a>;</div><div class="line"><a name="l02305"></a><span class="lineno"> 2305</span>&#160;   domain = strchr(tmp, <span class="charliteral">&#39;@&#39;</span>);</div><div class="line"><a name="l02306"></a><span class="lineno"> 2306</span>&#160;   <span class="keywordflow">if</span> (domain) {</div><div class="line"><a name="l02307"></a><span class="lineno"> 2307</span>&#160;      *domain = <span class="charliteral">&#39;\0&#39;</span>;</div><div class="line"><a name="l02308"></a><span class="lineno"> 2308</span>&#160;      domain++;</div><div class="line"><a name="l02309"></a><span class="lineno"> 2309</span>&#160;   }</div><div class="line"><a name="l02310"></a><span class="lineno"> 2310</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a>(domain) || <a class="code" href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a>(username)) {</div><div class="line"><a name="l02311"></a><span class="lineno"> 2311</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Need username@domain as argument. Sorry. Argument:  %s\n&quot;</span>, argv[0]);</div><div class="line"><a name="l02312"></a><span class="lineno"> 2312</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l02313"></a><span class="lineno"> 2313</span>&#160;   }</div><div class="line"><a name="l02314"></a><span class="lineno"> 2314</span>&#160;   <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(1, <span class="stringliteral">&quot;Trying to find configuration for user %s in domain %s\n&quot;</span>, username, domain);</div><div class="line"><a name="l02315"></a><span class="lineno"> 2315</span>&#160;</div><div class="line"><a name="l02316"></a><span class="lineno"> 2316</span>&#160;   <span class="keywordflow">if</span> (!(vmu = <a class="code" href="../../de/dfe/app__minivm_8c.html#ac26055cad7a69cbfb6692d273f025a40">find_account</a>(domain, username, <a class="code" href="../../de/dfe/app__minivm_8c.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>))) {</div><div class="line"><a name="l02317"></a><span class="lineno"> 2317</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Could not allocate memory. \n&quot;</span>);</div><div class="line"><a name="l02318"></a><span class="lineno"> 2318</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l02319"></a><span class="lineno"> 2319</span>&#160;   }</div><div class="line"><a name="l02320"></a><span class="lineno"> 2320</span>&#160;</div><div class="line"><a name="l02321"></a><span class="lineno"> 2321</span>&#160;   <span class="comment">/* Answer channel if it&#39;s not already answered */</span></div><div class="line"><a name="l02322"></a><span class="lineno"> 2322</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d9/d95/channelstate_8h.html#a03585bc87e5bbd0f4d11bc789734c660">ast_channel_state</a>(chan) != <a class="code" href="../../d9/d95/channelstate_8h.html#a03585bc87e5bbd0f4d11bc789734c660aa8ab4bcda7378ccc17c39dfd880cba3d">AST_STATE_UP</a>)</div><div class="line"><a name="l02323"></a><span class="lineno"> 2323</span>&#160;      <a class="code" href="../../d5/d7b/channel_8h.html#aec583a3e25358ee552a4f3df53914cd0">ast_answer</a>(chan);</div><div class="line"><a name="l02324"></a><span class="lineno"> 2324</span>&#160;</div><div class="line"><a name="l02325"></a><span class="lineno"> 2325</span>&#160;   <span class="comment">/* Setup pre-file if appropriate */</span></div><div class="line"><a name="l02326"></a><span class="lineno"> 2326</span>&#160;   <span class="keywordflow">if</span> (strcmp(vmu-&gt;<a class="code" href="../../dc/d7b/structminivm__account.html#ae43ea5d0335f149f0920d33e46b61c33">domain</a>, <span class="stringliteral">&quot;localhost&quot;</span>))</div><div class="line"><a name="l02327"></a><span class="lineno"> 2327</span>&#160;      snprintf(ext_context, <span class="keyword">sizeof</span>(ext_context), <span class="stringliteral">&quot;%s@%s&quot;</span>, username, vmu-&gt;<a class="code" href="../../dc/d7b/structminivm__account.html#ae43ea5d0335f149f0920d33e46b61c33">domain</a>);</div><div class="line"><a name="l02328"></a><span class="lineno"> 2328</span>&#160;   <span class="keywordflow">else</span></div><div class="line"><a name="l02329"></a><span class="lineno"> 2329</span>&#160;      <a class="code" href="../../d6/d90/strings_8h.html#ac4040268f7b6ed77dfc49c7767626369">ast_copy_string</a>(ext_context, vmu-&gt;<a class="code" href="../../dc/d7b/structminivm__account.html#ae43ea5d0335f149f0920d33e46b61c33">domain</a>, <span class="keyword">sizeof</span>(ext_context));</div><div class="line"><a name="l02330"></a><span class="lineno"> 2330</span>&#160;</div><div class="line"><a name="l02331"></a><span class="lineno"> 2331</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d5/d60/utils_8h.html#a00d4c9254c9827d6fa44f17a326744a5">ast_test_flag</a>(&amp;leave_options, <a class="code" href="../../de/dfe/app__minivm_8c.html#a4aeda8b39c8ab166c538157d05591922a6021f80ddb5561e6e07a285ea47b086e">OPT_BUSY_GREETING</a>)) {</div><div class="line"><a name="l02332"></a><span class="lineno"> 2332</span>&#160;      res = <a class="code" href="../../de/dfe/app__minivm_8c.html#a9a335978d2517b553066af1f10a4d07f">check_dirpath</a>(dest, <span class="keyword">sizeof</span>(dest), vmu-&gt;<a class="code" href="../../dc/d7b/structminivm__account.html#ae43ea5d0335f149f0920d33e46b61c33">domain</a>, username, <span class="stringliteral">&quot;busy&quot;</span>);</div><div class="line"><a name="l02333"></a><span class="lineno"> 2333</span>&#160;      <span class="keywordflow">if</span> (res)</div><div class="line"><a name="l02334"></a><span class="lineno"> 2334</span>&#160;         snprintf(prefile, <span class="keyword">sizeof</span>(prefile), <span class="stringliteral">&quot;%s%s/%s/busy&quot;</span>, <a class="code" href="../../de/dfe/app__minivm_8c.html#ab94d2ef3acf22b2bf9410c48462c7cb1">MVM_SPOOL_DIR</a>, vmu-&gt;<a class="code" href="../../dc/d7b/structminivm__account.html#ae43ea5d0335f149f0920d33e46b61c33">domain</a>, username);</div><div class="line"><a name="l02335"></a><span class="lineno"> 2335</span>&#160;   } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="../../d5/d60/utils_8h.html#a00d4c9254c9827d6fa44f17a326744a5">ast_test_flag</a>(&amp;leave_options, <a class="code" href="../../de/dfe/app__minivm_8c.html#a4aeda8b39c8ab166c538157d05591922a96240d093eacd367dd06de745d12e559">OPT_UNAVAIL_GREETING</a>)) {</div><div class="line"><a name="l02336"></a><span class="lineno"> 2336</span>&#160;      res = <a class="code" href="../../de/dfe/app__minivm_8c.html#a9a335978d2517b553066af1f10a4d07f">check_dirpath</a>(dest, <span class="keyword">sizeof</span>(dest), vmu-&gt;<a class="code" href="../../dc/d7b/structminivm__account.html#ae43ea5d0335f149f0920d33e46b61c33">domain</a>, username, <span class="stringliteral">&quot;unavail&quot;</span>);</div><div class="line"><a name="l02337"></a><span class="lineno"> 2337</span>&#160;      <span class="keywordflow">if</span> (res)</div><div class="line"><a name="l02338"></a><span class="lineno"> 2338</span>&#160;         snprintf(prefile, <span class="keyword">sizeof</span>(prefile), <span class="stringliteral">&quot;%s%s/%s/unavail&quot;</span>, <a class="code" href="../../de/dfe/app__minivm_8c.html#ab94d2ef3acf22b2bf9410c48462c7cb1">MVM_SPOOL_DIR</a>, vmu-&gt;<a class="code" href="../../dc/d7b/structminivm__account.html#ae43ea5d0335f149f0920d33e46b61c33">domain</a>, username);</div><div class="line"><a name="l02339"></a><span class="lineno"> 2339</span>&#160;   }</div><div class="line"><a name="l02340"></a><span class="lineno"> 2340</span>&#160;   <span class="comment">/* Check for temporary greeting - it overrides busy and unavail */</span></div><div class="line"><a name="l02341"></a><span class="lineno"> 2341</span>&#160;   snprintf(tempfile, <span class="keyword">sizeof</span>(tempfile), <span class="stringliteral">&quot;%s%s/%s/temp&quot;</span>, <a class="code" href="../../de/dfe/app__minivm_8c.html#ab94d2ef3acf22b2bf9410c48462c7cb1">MVM_SPOOL_DIR</a>, vmu-&gt;<a class="code" href="../../dc/d7b/structminivm__account.html#ae43ea5d0335f149f0920d33e46b61c33">domain</a>, username);</div><div class="line"><a name="l02342"></a><span class="lineno"> 2342</span>&#160;   <span class="keywordflow">if</span> (!(res = <a class="code" href="../../de/dfe/app__minivm_8c.html#a9a335978d2517b553066af1f10a4d07f">check_dirpath</a>(dest, <span class="keyword">sizeof</span>(dest), vmu-&gt;<a class="code" href="../../dc/d7b/structminivm__account.html#ae43ea5d0335f149f0920d33e46b61c33">domain</a>, username, <span class="stringliteral">&quot;temp&quot;</span>))) {</div><div class="line"><a name="l02343"></a><span class="lineno"> 2343</span>&#160;      <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(2, <span class="stringliteral">&quot;Temporary message directory does not exist, using default (%s)\n&quot;</span>, tempfile);</div><div class="line"><a name="l02344"></a><span class="lineno"> 2344</span>&#160;      <a class="code" href="../../d6/d90/strings_8h.html#ac4040268f7b6ed77dfc49c7767626369">ast_copy_string</a>(prefile, tempfile, <span class="keyword">sizeof</span>(prefile));</div><div class="line"><a name="l02345"></a><span class="lineno"> 2345</span>&#160;   }</div><div class="line"><a name="l02346"></a><span class="lineno"> 2346</span>&#160;   <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(2, <span class="stringliteral">&quot;Preparing to play message ...\n&quot;</span>);</div><div class="line"><a name="l02347"></a><span class="lineno"> 2347</span>&#160;</div><div class="line"><a name="l02348"></a><span class="lineno"> 2348</span>&#160;   <span class="comment">/* Check current or macro-calling context for special extensions */</span></div><div class="line"><a name="l02349"></a><span class="lineno"> 2349</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d5/d60/utils_8h.html#a00d4c9254c9827d6fa44f17a326744a5">ast_test_flag</a>(vmu, <a class="code" href="../../de/dfe/app__minivm_8c.html#ac06da19dda21a4bac4970057bf72497a">MVM_OPERATOR</a>)) {</div><div class="line"><a name="l02350"></a><span class="lineno"> 2350</span>&#160;      <span class="keywordflow">if</span> (!<a class="code" href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a>(vmu-&gt;<a class="code" href="../../dc/d7b/structminivm__account.html#aa9d4a76241ab2a75118261777526e04b">exit</a>)) {</div><div class="line"><a name="l02351"></a><span class="lineno"> 2351</span>&#160;         <span class="keywordflow">if</span> (<a class="code" href="../../db/de0/pbx_8h.html#a64a5b8fdc919806135ad427aca9e71b7">ast_exists_extension</a>(chan, vmu-&gt;<a class="code" href="../../dc/d7b/structminivm__account.html#aa9d4a76241ab2a75118261777526e04b">exit</a>, <span class="stringliteral">&quot;o&quot;</span>, 1,</div><div class="line"><a name="l02352"></a><span class="lineno"> 2352</span>&#160;            <a class="code" href="../../d6/d90/strings_8h.html#a38a896048b2ca84076864505f0aa8f01">S_COR</a>(<a class="code" href="../../d5/d7b/channel_8h.html#ac2dc872b606534943c98304aed841b34">ast_channel_caller</a>(chan)-&gt;<span class="keywordtype">id</span>.<a class="code" href="../../d6/d49/structnumber.html">number</a>.valid, <a class="code" href="../../d5/d7b/channel_8h.html#ac2dc872b606534943c98304aed841b34">ast_channel_caller</a>(chan)-&gt;<span class="keywordtype">id</span>.<a class="code" href="../../d6/d49/structnumber.html">number</a>.str, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>))) {</div><div class="line"><a name="l02353"></a><span class="lineno"> 2353</span>&#160;            strncat(ecodes, <span class="stringliteral">&quot;0&quot;</span>, <span class="keyword">sizeof</span>(ecodes) - strlen(ecodes) - 1);</div><div class="line"><a name="l02354"></a><span class="lineno"> 2354</span>&#160;            ouseexten = 1;</div><div class="line"><a name="l02355"></a><span class="lineno"> 2355</span>&#160;         }</div><div class="line"><a name="l02356"></a><span class="lineno"> 2356</span>&#160;      } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="../../db/de0/pbx_8h.html#a64a5b8fdc919806135ad427aca9e71b7">ast_exists_extension</a>(chan, <a class="code" href="../../d5/d7b/channel_8h.html#a582dee4d5ea9b2ff6f309f0c5239f6bd">ast_channel_context</a>(chan), <span class="stringliteral">&quot;o&quot;</span>, 1,</div><div class="line"><a name="l02357"></a><span class="lineno"> 2357</span>&#160;         <a class="code" href="../../d6/d90/strings_8h.html#a38a896048b2ca84076864505f0aa8f01">S_COR</a>(<a class="code" href="../../d5/d7b/channel_8h.html#ac2dc872b606534943c98304aed841b34">ast_channel_caller</a>(chan)-&gt;<span class="keywordtype">id</span>.<a class="code" href="../../d6/d49/structnumber.html">number</a>.valid, <a class="code" href="../../d5/d7b/channel_8h.html#ac2dc872b606534943c98304aed841b34">ast_channel_caller</a>(chan)-&gt;<span class="keywordtype">id</span>.<a class="code" href="../../d6/d49/structnumber.html">number</a>.str, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>))) {</div><div class="line"><a name="l02358"></a><span class="lineno"> 2358</span>&#160;         strncat(ecodes, <span class="stringliteral">&quot;0&quot;</span>, <span class="keyword">sizeof</span>(ecodes) - strlen(ecodes) - 1);</div><div class="line"><a name="l02359"></a><span class="lineno"> 2359</span>&#160;         ouseexten = 1;</div><div class="line"><a name="l02360"></a><span class="lineno"> 2360</span>&#160;      }</div><div class="line"><a name="l02361"></a><span class="lineno"> 2361</span>&#160;      <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!<a class="code" href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a>(<a class="code" href="../../d5/d7b/channel_8h.html#adf593d68a333075c1fcae8a73b68c069">ast_channel_macrocontext</a>(chan))</div><div class="line"><a name="l02362"></a><span class="lineno"> 2362</span>&#160;         &amp;&amp; <a class="code" href="../../db/de0/pbx_8h.html#a64a5b8fdc919806135ad427aca9e71b7">ast_exists_extension</a>(chan, <a class="code" href="../../d5/d7b/channel_8h.html#adf593d68a333075c1fcae8a73b68c069">ast_channel_macrocontext</a>(chan), <span class="stringliteral">&quot;o&quot;</span>, 1,</div><div class="line"><a name="l02363"></a><span class="lineno"> 2363</span>&#160;            <a class="code" href="../../d6/d90/strings_8h.html#a38a896048b2ca84076864505f0aa8f01">S_COR</a>(<a class="code" href="../../d5/d7b/channel_8h.html#ac2dc872b606534943c98304aed841b34">ast_channel_caller</a>(chan)-&gt;<span class="keywordtype">id</span>.<a class="code" href="../../d6/d49/structnumber.html">number</a>.valid, <a class="code" href="../../d5/d7b/channel_8h.html#ac2dc872b606534943c98304aed841b34">ast_channel_caller</a>(chan)-&gt;<span class="keywordtype">id</span>.<a class="code" href="../../d6/d49/structnumber.html">number</a>.str, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>))) {</div><div class="line"><a name="l02364"></a><span class="lineno"> 2364</span>&#160;         strncat(ecodes, <span class="stringliteral">&quot;0&quot;</span>, <span class="keyword">sizeof</span>(ecodes) - strlen(ecodes) - 1);</div><div class="line"><a name="l02365"></a><span class="lineno"> 2365</span>&#160;         ousemacro = 1;</div><div class="line"><a name="l02366"></a><span class="lineno"> 2366</span>&#160;      }</div><div class="line"><a name="l02367"></a><span class="lineno"> 2367</span>&#160;   }</div><div class="line"><a name="l02368"></a><span class="lineno"> 2368</span>&#160;</div><div class="line"><a name="l02369"></a><span class="lineno"> 2369</span>&#160;   <span class="keywordflow">if</span> (!<a class="code" href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a>(vmu-&gt;<a class="code" href="../../dc/d7b/structminivm__account.html#aa9d4a76241ab2a75118261777526e04b">exit</a>)) {</div><div class="line"><a name="l02370"></a><span class="lineno"> 2370</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="../../db/de0/pbx_8h.html#a64a5b8fdc919806135ad427aca9e71b7">ast_exists_extension</a>(chan, vmu-&gt;<a class="code" href="../../dc/d7b/structminivm__account.html#aa9d4a76241ab2a75118261777526e04b">exit</a>, <span class="stringliteral">&quot;a&quot;</span>, 1,</div><div class="line"><a name="l02371"></a><span class="lineno"> 2371</span>&#160;         <a class="code" href="../../d6/d90/strings_8h.html#a38a896048b2ca84076864505f0aa8f01">S_COR</a>(<a class="code" href="../../d5/d7b/channel_8h.html#ac2dc872b606534943c98304aed841b34">ast_channel_caller</a>(chan)-&gt;<span class="keywordtype">id</span>.<a class="code" href="../../d6/d49/structnumber.html">number</a>.valid, <a class="code" href="../../d5/d7b/channel_8h.html#ac2dc872b606534943c98304aed841b34">ast_channel_caller</a>(chan)-&gt;<span class="keywordtype">id</span>.<a class="code" href="../../d6/d49/structnumber.html">number</a>.str, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>))) {</div><div class="line"><a name="l02372"></a><span class="lineno"> 2372</span>&#160;         strncat(ecodes, <span class="stringliteral">&quot;*&quot;</span>, <span class="keyword">sizeof</span>(ecodes) -  strlen(ecodes) - 1);</div><div class="line"><a name="l02373"></a><span class="lineno"> 2373</span>&#160;      }</div><div class="line"><a name="l02374"></a><span class="lineno"> 2374</span>&#160;   } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="../../db/de0/pbx_8h.html#a64a5b8fdc919806135ad427aca9e71b7">ast_exists_extension</a>(chan, <a class="code" href="../../d5/d7b/channel_8h.html#a582dee4d5ea9b2ff6f309f0c5239f6bd">ast_channel_context</a>(chan), <span class="stringliteral">&quot;a&quot;</span>, 1,</div><div class="line"><a name="l02375"></a><span class="lineno"> 2375</span>&#160;      <a class="code" href="../../d6/d90/strings_8h.html#a38a896048b2ca84076864505f0aa8f01">S_COR</a>(<a class="code" href="../../d5/d7b/channel_8h.html#ac2dc872b606534943c98304aed841b34">ast_channel_caller</a>(chan)-&gt;<span class="keywordtype">id</span>.<a class="code" href="../../d6/d49/structnumber.html">number</a>.valid, <a class="code" href="../../d5/d7b/channel_8h.html#ac2dc872b606534943c98304aed841b34">ast_channel_caller</a>(chan)-&gt;<span class="keywordtype">id</span>.<a class="code" href="../../d6/d49/structnumber.html">number</a>.str, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>))) {</div><div class="line"><a name="l02376"></a><span class="lineno"> 2376</span>&#160;      strncat(ecodes, <span class="stringliteral">&quot;*&quot;</span>, <span class="keyword">sizeof</span>(ecodes) -  strlen(ecodes) - 1);</div><div class="line"><a name="l02377"></a><span class="lineno"> 2377</span>&#160;   } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!<a class="code" href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a>(<a class="code" href="../../d5/d7b/channel_8h.html#adf593d68a333075c1fcae8a73b68c069">ast_channel_macrocontext</a>(chan))</div><div class="line"><a name="l02378"></a><span class="lineno"> 2378</span>&#160;      &amp;&amp; <a class="code" href="../../db/de0/pbx_8h.html#a64a5b8fdc919806135ad427aca9e71b7">ast_exists_extension</a>(chan, <a class="code" href="../../d5/d7b/channel_8h.html#adf593d68a333075c1fcae8a73b68c069">ast_channel_macrocontext</a>(chan), <span class="stringliteral">&quot;a&quot;</span>, 1,</div><div class="line"><a name="l02379"></a><span class="lineno"> 2379</span>&#160;         <a class="code" href="../../d6/d90/strings_8h.html#a38a896048b2ca84076864505f0aa8f01">S_COR</a>(<a class="code" href="../../d5/d7b/channel_8h.html#ac2dc872b606534943c98304aed841b34">ast_channel_caller</a>(chan)-&gt;<span class="keywordtype">id</span>.<a class="code" href="../../d6/d49/structnumber.html">number</a>.valid, <a class="code" href="../../d5/d7b/channel_8h.html#ac2dc872b606534943c98304aed841b34">ast_channel_caller</a>(chan)-&gt;<span class="keywordtype">id</span>.<a class="code" href="../../d6/d49/structnumber.html">number</a>.str, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>))) {</div><div class="line"><a name="l02380"></a><span class="lineno"> 2380</span>&#160;      strncat(ecodes, <span class="stringliteral">&quot;*&quot;</span>, <span class="keyword">sizeof</span>(ecodes) -  strlen(ecodes) - 1);</div><div class="line"><a name="l02381"></a><span class="lineno"> 2381</span>&#160;      ausemacro = 1;</div><div class="line"><a name="l02382"></a><span class="lineno"> 2382</span>&#160;   }</div><div class="line"><a name="l02383"></a><span class="lineno"> 2383</span>&#160;</div><div class="line"><a name="l02384"></a><span class="lineno"> 2384</span>&#160;   res = 0; <span class="comment">/* Reset */</span></div><div class="line"><a name="l02385"></a><span class="lineno"> 2385</span>&#160;   <span class="comment">/* Play the beginning intro if desired */</span></div><div class="line"><a name="l02386"></a><span class="lineno"> 2386</span>&#160;   <span class="keywordflow">if</span> (!<a class="code" href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a>(prefile)) {</div><div class="line"><a name="l02387"></a><span class="lineno"> 2387</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="../../d2/d4d/file_8h.html#a67c7e271b4ca70aca6d48fd48d121857">ast_streamfile</a>(chan, prefile, <a class="code" href="../../d5/d7b/channel_8h.html#a9abe31fe40dcd03cd2957e5309e32ac6">ast_channel_language</a>(chan)) &gt; -1)</div><div class="line"><a name="l02388"></a><span class="lineno"> 2388</span>&#160;         res = <a class="code" href="../../d2/d4d/file_8h.html#affc21cb57c6bf72a2cb7ec8a379b2137">ast_waitstream</a>(chan, ecodes);</div><div class="line"><a name="l02389"></a><span class="lineno"> 2389</span>&#160;   } <span class="keywordflow">else</span> {</div><div class="line"><a name="l02390"></a><span class="lineno"> 2390</span>&#160;      <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(2, <span class="stringliteral">&quot;%s doesn&#39;t exist, doing what we can\n&quot;</span>, prefile);</div><div class="line"><a name="l02391"></a><span class="lineno"> 2391</span>&#160;      res = <a class="code" href="../../de/dfe/app__minivm_8c.html#ab05c8faac94f3e02ace2458247075f21">invent_message</a>(chan, vmu-&gt;<a class="code" href="../../dc/d7b/structminivm__account.html#ae43ea5d0335f149f0920d33e46b61c33">domain</a>, username, <a class="code" href="../../d5/d60/utils_8h.html#a00d4c9254c9827d6fa44f17a326744a5">ast_test_flag</a>(&amp;leave_options, <a class="code" href="../../de/dfe/app__minivm_8c.html#a4aeda8b39c8ab166c538157d05591922a6021f80ddb5561e6e07a285ea47b086e">OPT_BUSY_GREETING</a>), ecodes);</div><div class="line"><a name="l02392"></a><span class="lineno"> 2392</span>&#160;   }</div><div class="line"><a name="l02393"></a><span class="lineno"> 2393</span>&#160;   <span class="keywordflow">if</span> (res &lt; 0) {</div><div class="line"><a name="l02394"></a><span class="lineno"> 2394</span>&#160;      <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(2, <span class="stringliteral">&quot;Hang up during prefile playback\n&quot;</span>);</div><div class="line"><a name="l02395"></a><span class="lineno"> 2395</span>&#160;      <a class="code" href="../../db/de0/pbx_8h.html#a6e5b90edb84d216267148dddcffe9b9a">pbx_builtin_setvar_helper</a>(chan, <span class="stringliteral">&quot;MVM_GREET_STATUS&quot;</span>, <span class="stringliteral">&quot;FAILED&quot;</span>);</div><div class="line"><a name="l02396"></a><span class="lineno"> 2396</span>&#160;      <span class="keywordflow">if</span>(<a class="code" href="../../d5/d60/utils_8h.html#a00d4c9254c9827d6fa44f17a326744a5">ast_test_flag</a>(vmu, <a class="code" href="../../de/dfe/app__minivm_8c.html#ac1976490b5dd7e2dae38667d5d21fe4a">MVM_ALLOCED</a>))</div><div class="line"><a name="l02397"></a><span class="lineno"> 2397</span>&#160;         <a class="code" href="../../de/dfe/app__minivm_8c.html#a1c42a258925cbbb46952152ec3785bfd">free_user</a>(vmu);</div><div class="line"><a name="l02398"></a><span class="lineno"> 2398</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l02399"></a><span class="lineno"> 2399</span>&#160;   }</div><div class="line"><a name="l02400"></a><span class="lineno"> 2400</span>&#160;   <span class="keywordflow">if</span> (res == <span class="charliteral">&#39;#&#39;</span>) {</div><div class="line"><a name="l02401"></a><span class="lineno"> 2401</span>&#160;      <span class="comment">/* On a &#39;#&#39; we skip the instructions */</span></div><div class="line"><a name="l02402"></a><span class="lineno"> 2402</span>&#160;      <a class="code" href="../../d5/d60/utils_8h.html#ab5033a1f3d781d45e7ccc27598114510">ast_set_flag</a>(&amp;leave_options, <a class="code" href="../../de/dfe/app__minivm_8c.html#a4aeda8b39c8ab166c538157d05591922a9c6a0359498684912cb0a3810e03138d">OPT_SILENT</a>);</div><div class="line"><a name="l02403"></a><span class="lineno"> 2403</span>&#160;      res = 0;</div><div class="line"><a name="l02404"></a><span class="lineno"> 2404</span>&#160;   }</div><div class="line"><a name="l02405"></a><span class="lineno"> 2405</span>&#160;   <span class="keywordflow">if</span> (!res &amp;&amp; !<a class="code" href="../../d5/d60/utils_8h.html#a00d4c9254c9827d6fa44f17a326744a5">ast_test_flag</a>(&amp;leave_options, <a class="code" href="../../de/dfe/app__minivm_8c.html#a4aeda8b39c8ab166c538157d05591922a9c6a0359498684912cb0a3810e03138d">OPT_SILENT</a>)) {</div><div class="line"><a name="l02406"></a><span class="lineno"> 2406</span>&#160;      res = <a class="code" href="../../d2/d4d/file_8h.html#a67c7e271b4ca70aca6d48fd48d121857">ast_streamfile</a>(chan, <a class="code" href="../../de/dfe/app__minivm_8c.html#a8bd4261fe6c6d6807f032fc0b9eebfa3">SOUND_INTRO</a>, <a class="code" href="../../d5/d7b/channel_8h.html#a9abe31fe40dcd03cd2957e5309e32ac6">ast_channel_language</a>(chan));</div><div class="line"><a name="l02407"></a><span class="lineno"> 2407</span>&#160;      <span class="keywordflow">if</span> (!res)</div><div class="line"><a name="l02408"></a><span class="lineno"> 2408</span>&#160;         res = <a class="code" href="../../d2/d4d/file_8h.html#affc21cb57c6bf72a2cb7ec8a379b2137">ast_waitstream</a>(chan, ecodes);</div><div class="line"><a name="l02409"></a><span class="lineno"> 2409</span>&#160;      <span class="keywordflow">if</span> (res == <span class="charliteral">&#39;#&#39;</span>) {</div><div class="line"><a name="l02410"></a><span class="lineno"> 2410</span>&#160;         <a class="code" href="../../d5/d60/utils_8h.html#ab5033a1f3d781d45e7ccc27598114510">ast_set_flag</a>(&amp;leave_options, <a class="code" href="../../de/dfe/app__minivm_8c.html#a4aeda8b39c8ab166c538157d05591922a9c6a0359498684912cb0a3810e03138d">OPT_SILENT</a>);</div><div class="line"><a name="l02411"></a><span class="lineno"> 2411</span>&#160;         res = 0;</div><div class="line"><a name="l02412"></a><span class="lineno"> 2412</span>&#160;      }</div><div class="line"><a name="l02413"></a><span class="lineno"> 2413</span>&#160;   }</div><div class="line"><a name="l02414"></a><span class="lineno"> 2414</span>&#160;   <span class="keywordflow">if</span> (res &gt; 0)</div><div class="line"><a name="l02415"></a><span class="lineno"> 2415</span>&#160;      <a class="code" href="../../d2/d4d/file_8h.html#a3092bf11d4bba66f646562759608b1bc">ast_stopstream</a>(chan);</div><div class="line"><a name="l02416"></a><span class="lineno"> 2416</span>&#160;   <span class="comment">/* Check for a &#39;*&#39; here in case the caller wants to escape from voicemail to something</span></div><div class="line"><a name="l02417"></a><span class="lineno"> 2417</span>&#160;<span class="comment">      other than the operator -- an automated attendant or mailbox login for example */</span></div><div class="line"><a name="l02418"></a><span class="lineno"> 2418</span>&#160;   <span class="keywordflow">if</span> (res == <span class="charliteral">&#39;*&#39;</span>) {</div><div class="line"><a name="l02419"></a><span class="lineno"> 2419</span>&#160;      <a class="code" href="../../d5/d7b/channel_8h.html#a018b7a29cef2d62074dc46e9aaad0d1a">ast_channel_exten_set</a>(chan, <span class="stringliteral">&quot;a&quot;</span>);</div><div class="line"><a name="l02420"></a><span class="lineno"> 2420</span>&#160;      <span class="keywordflow">if</span> (!<a class="code" href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a>(vmu-&gt;<a class="code" href="../../dc/d7b/structminivm__account.html#aa9d4a76241ab2a75118261777526e04b">exit</a>)) {</div><div class="line"><a name="l02421"></a><span class="lineno"> 2421</span>&#160;         <a class="code" href="../../d5/d7b/channel_8h.html#aca211972dac7b8f3f08a283bfe0aa8bf">ast_channel_context_set</a>(chan, vmu-&gt;<a class="code" href="../../dc/d7b/structminivm__account.html#aa9d4a76241ab2a75118261777526e04b">exit</a>);</div><div class="line"><a name="l02422"></a><span class="lineno"> 2422</span>&#160;      } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (ausemacro &amp;&amp; !<a class="code" href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a>(<a class="code" href="../../d5/d7b/channel_8h.html#adf593d68a333075c1fcae8a73b68c069">ast_channel_macrocontext</a>(chan))) {</div><div class="line"><a name="l02423"></a><span class="lineno"> 2423</span>&#160;         <a class="code" href="../../d5/d7b/channel_8h.html#aca211972dac7b8f3f08a283bfe0aa8bf">ast_channel_context_set</a>(chan, <a class="code" href="../../d5/d7b/channel_8h.html#adf593d68a333075c1fcae8a73b68c069">ast_channel_macrocontext</a>(chan));</div><div class="line"><a name="l02424"></a><span class="lineno"> 2424</span>&#160;      }</div><div class="line"><a name="l02425"></a><span class="lineno"> 2425</span>&#160;      <a class="code" href="../../d5/d7b/channel_8h.html#ae56cab679c0cda6436b930bc74297895">ast_channel_priority_set</a>(chan, 0);</div><div class="line"><a name="l02426"></a><span class="lineno"> 2426</span>&#160;      <a class="code" href="../../db/de0/pbx_8h.html#a6e5b90edb84d216267148dddcffe9b9a">pbx_builtin_setvar_helper</a>(chan, <span class="stringliteral">&quot;MVM_GREET_STATUS&quot;</span>, <span class="stringliteral">&quot;USEREXIT&quot;</span>);</div><div class="line"><a name="l02427"></a><span class="lineno"> 2427</span>&#160;      res = 0;</div><div class="line"><a name="l02428"></a><span class="lineno"> 2428</span>&#160;   } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (res == <span class="charliteral">&#39;0&#39;</span>) { <span class="comment">/* Check for a &#39;0&#39; here */</span></div><div class="line"><a name="l02429"></a><span class="lineno"> 2429</span>&#160;      <span class="keywordflow">if</span>(ouseexten || ousemacro) {</div><div class="line"><a name="l02430"></a><span class="lineno"> 2430</span>&#160;         <a class="code" href="../../d5/d7b/channel_8h.html#a018b7a29cef2d62074dc46e9aaad0d1a">ast_channel_exten_set</a>(chan, <span class="stringliteral">&quot;o&quot;</span>);</div><div class="line"><a name="l02431"></a><span class="lineno"> 2431</span>&#160;         <span class="keywordflow">if</span> (!<a class="code" href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a>(vmu-&gt;<a class="code" href="../../dc/d7b/structminivm__account.html#aa9d4a76241ab2a75118261777526e04b">exit</a>)) {</div><div class="line"><a name="l02432"></a><span class="lineno"> 2432</span>&#160;            <a class="code" href="../../d5/d7b/channel_8h.html#aca211972dac7b8f3f08a283bfe0aa8bf">ast_channel_context_set</a>(chan, vmu-&gt;<a class="code" href="../../dc/d7b/structminivm__account.html#aa9d4a76241ab2a75118261777526e04b">exit</a>);</div><div class="line"><a name="l02433"></a><span class="lineno"> 2433</span>&#160;         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (ousemacro &amp;&amp; !<a class="code" href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a>(<a class="code" href="../../d5/d7b/channel_8h.html#adf593d68a333075c1fcae8a73b68c069">ast_channel_macrocontext</a>(chan))) {</div><div class="line"><a name="l02434"></a><span class="lineno"> 2434</span>&#160;            <a class="code" href="../../d5/d7b/channel_8h.html#aca211972dac7b8f3f08a283bfe0aa8bf">ast_channel_context_set</a>(chan, <a class="code" href="../../d5/d7b/channel_8h.html#adf593d68a333075c1fcae8a73b68c069">ast_channel_macrocontext</a>(chan));</div><div class="line"><a name="l02435"></a><span class="lineno"> 2435</span>&#160;         }</div><div class="line"><a name="l02436"></a><span class="lineno"> 2436</span>&#160;         <a class="code" href="../../d3/d93/include_2asterisk_2app_8h.html#abbbec6ab9a303e865a1d1a261152540d">ast_play_and_wait</a>(chan, <span class="stringliteral">&quot;transfer&quot;</span>);</div><div class="line"><a name="l02437"></a><span class="lineno"> 2437</span>&#160;         <a class="code" href="../../d5/d7b/channel_8h.html#ae56cab679c0cda6436b930bc74297895">ast_channel_priority_set</a>(chan, 0);</div><div class="line"><a name="l02438"></a><span class="lineno"> 2438</span>&#160;         <a class="code" href="../../db/de0/pbx_8h.html#a6e5b90edb84d216267148dddcffe9b9a">pbx_builtin_setvar_helper</a>(chan, <span class="stringliteral">&quot;MVM_GREET_STATUS&quot;</span>, <span class="stringliteral">&quot;USEREXIT&quot;</span>);</div><div class="line"><a name="l02439"></a><span class="lineno"> 2439</span>&#160;      }</div><div class="line"><a name="l02440"></a><span class="lineno"> 2440</span>&#160;      res =  0;</div><div class="line"><a name="l02441"></a><span class="lineno"> 2441</span>&#160;   } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (res &lt; 0) {</div><div class="line"><a name="l02442"></a><span class="lineno"> 2442</span>&#160;      <a class="code" href="../../db/de0/pbx_8h.html#a6e5b90edb84d216267148dddcffe9b9a">pbx_builtin_setvar_helper</a>(chan, <span class="stringliteral">&quot;MVM_GREET_STATUS&quot;</span>, <span class="stringliteral">&quot;FAILED&quot;</span>);</div><div class="line"><a name="l02443"></a><span class="lineno"> 2443</span>&#160;      res = -1;</div><div class="line"><a name="l02444"></a><span class="lineno"> 2444</span>&#160;   } <span class="keywordflow">else</span></div><div class="line"><a name="l02445"></a><span class="lineno"> 2445</span>&#160;      <a class="code" href="../../db/de0/pbx_8h.html#a6e5b90edb84d216267148dddcffe9b9a">pbx_builtin_setvar_helper</a>(chan, <span class="stringliteral">&quot;MVM_GREET_STATUS&quot;</span>, <span class="stringliteral">&quot;SUCCESS&quot;</span>);</div><div class="line"><a name="l02446"></a><span class="lineno"> 2446</span>&#160;</div><div class="line"><a name="l02447"></a><span class="lineno"> 2447</span>&#160;   <span class="keywordflow">if</span>(<a class="code" href="../../d5/d60/utils_8h.html#a00d4c9254c9827d6fa44f17a326744a5">ast_test_flag</a>(vmu, <a class="code" href="../../de/dfe/app__minivm_8c.html#ac1976490b5dd7e2dae38667d5d21fe4a">MVM_ALLOCED</a>))</div><div class="line"><a name="l02448"></a><span class="lineno"> 2448</span>&#160;      <a class="code" href="../../de/dfe/app__minivm_8c.html#a1c42a258925cbbb46952152ec3785bfd">free_user</a>(vmu);</div><div class="line"><a name="l02449"></a><span class="lineno"> 2449</span>&#160;</div><div class="line"><a name="l02450"></a><span class="lineno"> 2450</span>&#160;</div><div class="line"><a name="l02451"></a><span class="lineno"> 2451</span>&#160;   <span class="comment">/* Ok, we&#39;re ready to rock and roll. Return to dialplan */</span></div><div class="line"><a name="l02452"></a><span class="lineno"> 2452</span>&#160;   <span class="keywordflow">return</span> res;</div><div class="line"><a name="l02453"></a><span class="lineno"> 2453</span>&#160;</div><div class="line"><a name="l02454"></a><span class="lineno"> 2454</span>&#160;}</div><div class="line"><a name="l02455"></a><span class="lineno"> 2455</span>&#160;<span class="comment"></span></div><div class="line"><a name="l02456"></a><span class="lineno"> 2456</span>&#160;<span class="comment">/*!\internal</span></div><div class="line"><a name="l02457"></a><span class="lineno"> 2457</span>&#160;<span class="comment"> * \brief Dialplan application to delete voicemail */</span></div><div class="line"><a name="l02458"></a><span class="lineno"><a class="line" href="../../de/dfe/app__minivm_8c.html#a59d95e558fe740e7070d090fc299f50d"> 2458</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../de/dfe/app__minivm_8c.html#a59d95e558fe740e7070d090fc299f50d">minivm_delete_exec</a>(<span class="keyword">struct</span> <a class="code" href="../../df/d3c/structast__channel.html">ast_channel</a> *chan, <span class="keyword">const</span> <span class="keywordtype">char</span> *data)</div><div class="line"><a name="l02459"></a><span class="lineno"> 2459</span>&#160;{</div><div class="line"><a name="l02460"></a><span class="lineno"> 2460</span>&#160;   <span class="keywordtype">int</span> res = 0;</div><div class="line"><a name="l02461"></a><span class="lineno"> 2461</span>&#160;   <span class="keywordtype">char</span> filename[BUFSIZ];</div><div class="line"><a name="l02462"></a><span class="lineno"> 2462</span>&#160;</div><div class="line"><a name="l02463"></a><span class="lineno"> 2463</span>&#160;   <span class="keywordflow">if</span> (!<a class="code" href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a>(data)) {</div><div class="line"><a name="l02464"></a><span class="lineno"> 2464</span>&#160;      <a class="code" href="../../d6/d90/strings_8h.html#ac4040268f7b6ed77dfc49c7767626369">ast_copy_string</a>(filename, (<span class="keywordtype">char</span> *) data, <span class="keyword">sizeof</span>(filename));</div><div class="line"><a name="l02465"></a><span class="lineno"> 2465</span>&#160;   } <span class="keywordflow">else</span> {</div><div class="line"><a name="l02466"></a><span class="lineno"> 2466</span>&#160;      <a class="code" href="../../d5/d7b/channel_8h.html#a493bdebe876caafb8ee535853310364a">ast_channel_lock</a>(chan);</div><div class="line"><a name="l02467"></a><span class="lineno"> 2467</span>&#160;      <a class="code" href="../../d6/d90/strings_8h.html#ac4040268f7b6ed77dfc49c7767626369">ast_copy_string</a>(filename, <a class="code" href="../../db/de0/pbx_8h.html#a98c5425b90ec7c5e136a40f529170b1b">pbx_builtin_getvar_helper</a>(chan, <span class="stringliteral">&quot;MVM_FILENAME&quot;</span>), <span class="keyword">sizeof</span>(filename));</div><div class="line"><a name="l02468"></a><span class="lineno"> 2468</span>&#160;      <a class="code" href="../../d5/d7b/channel_8h.html#af476c537b29be3f29240489032f9db39">ast_channel_unlock</a>(chan);</div><div class="line"><a name="l02469"></a><span class="lineno"> 2469</span>&#160;   }</div><div class="line"><a name="l02470"></a><span class="lineno"> 2470</span>&#160;</div><div class="line"><a name="l02471"></a><span class="lineno"> 2471</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a>(filename)) {</div><div class="line"><a name="l02472"></a><span class="lineno"> 2472</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;No filename given in application arguments or channel variable MVM_FILENAME\n&quot;</span>);</div><div class="line"><a name="l02473"></a><span class="lineno"> 2473</span>&#160;      <span class="keywordflow">return</span> res;</div><div class="line"><a name="l02474"></a><span class="lineno"> 2474</span>&#160;   }</div><div class="line"><a name="l02475"></a><span class="lineno"> 2475</span>&#160;</div><div class="line"><a name="l02476"></a><span class="lineno"> 2476</span>&#160;   <span class="comment">/* Go ahead and delete audio files from system, they&#39;re not needed any more */</span></div><div class="line"><a name="l02477"></a><span class="lineno"> 2477</span>&#160;   <span class="comment">/* We should look for both audio and text files here */</span></div><div class="line"><a name="l02478"></a><span class="lineno"> 2478</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d2/d4d/file_8h.html#ab9b8ab8e5ee34c9b4da25779255cafde">ast_fileexists</a>(filename, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) &gt; 0) {</div><div class="line"><a name="l02479"></a><span class="lineno"> 2479</span>&#160;      res = <a class="code" href="../../de/dfe/app__minivm_8c.html#a1efddf47b6f25c6e1b97e064e35c214e">vm_delete</a>(filename);</div><div class="line"><a name="l02480"></a><span class="lineno"> 2480</span>&#160;      <span class="keywordflow">if</span> (res) {</div><div class="line"><a name="l02481"></a><span class="lineno"> 2481</span>&#160;         <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(2, <span class="stringliteral">&quot;Can&#39;t delete file: %s\n&quot;</span>, filename);</div><div class="line"><a name="l02482"></a><span class="lineno"> 2482</span>&#160;         <a class="code" href="../../db/de0/pbx_8h.html#a6e5b90edb84d216267148dddcffe9b9a">pbx_builtin_setvar_helper</a>(chan, <span class="stringliteral">&quot;MVM_DELETE_STATUS&quot;</span>, <span class="stringliteral">&quot;FAILED&quot;</span>);</div><div class="line"><a name="l02483"></a><span class="lineno"> 2483</span>&#160;      } <span class="keywordflow">else</span> {</div><div class="line"><a name="l02484"></a><span class="lineno"> 2484</span>&#160;         <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(2, <span class="stringliteral">&quot;Deleted voicemail file :: %s \n&quot;</span>, filename);</div><div class="line"><a name="l02485"></a><span class="lineno"> 2485</span>&#160;         <a class="code" href="../../db/de0/pbx_8h.html#a6e5b90edb84d216267148dddcffe9b9a">pbx_builtin_setvar_helper</a>(chan, <span class="stringliteral">&quot;MVM_DELETE_STATUS&quot;</span>, <span class="stringliteral">&quot;SUCCESS&quot;</span>);</div><div class="line"><a name="l02486"></a><span class="lineno"> 2486</span>&#160;      }</div><div class="line"><a name="l02487"></a><span class="lineno"> 2487</span>&#160;   } <span class="keywordflow">else</span> {</div><div class="line"><a name="l02488"></a><span class="lineno"> 2488</span>&#160;      <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(2, <span class="stringliteral">&quot;Filename does not exist: %s\n&quot;</span>, filename);</div><div class="line"><a name="l02489"></a><span class="lineno"> 2489</span>&#160;      <a class="code" href="../../db/de0/pbx_8h.html#a6e5b90edb84d216267148dddcffe9b9a">pbx_builtin_setvar_helper</a>(chan, <span class="stringliteral">&quot;MVM_DELETE_STATUS&quot;</span>, <span class="stringliteral">&quot;FAILED&quot;</span>);</div><div class="line"><a name="l02490"></a><span class="lineno"> 2490</span>&#160;   }</div><div class="line"><a name="l02491"></a><span class="lineno"> 2491</span>&#160;</div><div class="line"><a name="l02492"></a><span class="lineno"> 2492</span>&#160;   <span class="keywordflow">return</span> res;</div><div class="line"><a name="l02493"></a><span class="lineno"> 2493</span>&#160;}</div><div class="line"><a name="l02494"></a><span class="lineno"> 2494</span>&#160;<span class="comment"></span></div><div class="line"><a name="l02495"></a><span class="lineno"> 2495</span>&#160;<span class="comment">/*! \brief Record specific messages for voicemail account */</span></div><div class="line"><a name="l02496"></a><span class="lineno"><a class="line" href="../../de/dfe/app__minivm_8c.html#a7ef5e4ff24ab0c8d72e5c464022ee95a"> 2496</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../de/dfe/app__minivm_8c.html#a7ef5e4ff24ab0c8d72e5c464022ee95a">minivm_accmess_exec</a>(<span class="keyword">struct</span> <a class="code" href="../../df/d3c/structast__channel.html">ast_channel</a> *chan, <span class="keyword">const</span> <span class="keywordtype">char</span> *data)</div><div class="line"><a name="l02497"></a><span class="lineno"> 2497</span>&#160;{</div><div class="line"><a name="l02498"></a><span class="lineno"> 2498</span>&#160;   <span class="keywordtype">int</span> argc = 0;</div><div class="line"><a name="l02499"></a><span class="lineno"> 2499</span>&#160;   <span class="keywordtype">char</span> *argv[2];</div><div class="line"><a name="l02500"></a><span class="lineno"> 2500</span>&#160;   <span class="keywordtype">char</span> filename[<a class="code" href="../../db/db2/asterisk_8h.html#ae688d728e1acdfe5988c7db45d6f0166">PATH_MAX</a>];</div><div class="line"><a name="l02501"></a><span class="lineno"> 2501</span>&#160;   <span class="keywordtype">char</span> <a class="code" href="../../de/d1e/bt__open_8c.html#a1cdd2bb1a9a71d3e1120100229315d67">tmp</a>[<a class="code" href="../../db/db2/asterisk_8h.html#ae688d728e1acdfe5988c7db45d6f0166">PATH_MAX</a>];</div><div class="line"><a name="l02502"></a><span class="lineno"> 2502</span>&#160;   <span class="keywordtype">char</span> *<a class="code" href="../../dc/d7b/structminivm__account.html#ae43ea5d0335f149f0920d33e46b61c33">domain</a>;</div><div class="line"><a name="l02503"></a><span class="lineno"> 2503</span>&#160;   <span class="keywordtype">char</span> *tmpptr = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l02504"></a><span class="lineno"> 2504</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../dc/d7b/structminivm__account.html">minivm_account</a> *vmu;</div><div class="line"><a name="l02505"></a><span class="lineno"> 2505</span>&#160;   <span class="keywordtype">char</span> *<a class="code" href="../../dc/d7b/structminivm__account.html#a4b30874d24514b5ef6ff5276e8c12ed4">username</a>;</div><div class="line"><a name="l02506"></a><span class="lineno"> 2506</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../dc/dac/structast__flags.html">ast_flags</a> <a class="code" href="../../dc/d7b/structminivm__account.html#ac92588540e8c1d014a08cd8a45462b19">flags</a> = { 0 };</div><div class="line"><a name="l02507"></a><span class="lineno"> 2507</span>&#160;   <span class="keywordtype">char</span> *opts[<a class="code" href="../../de/dfe/app__minivm_8c.html#a94a4fdd9ccddad3436c2c6f165ea5214aec7326f60e7edad15d96ff935e5616d6">OPT_ARG_ARRAY_SIZE</a>];</div><div class="line"><a name="l02508"></a><span class="lineno"> 2508</span>&#160;   <span class="keywordtype">int</span> <a class="code" href="../../d6/d47/utils_2frame_8c.html#a4a9391ee88e57361b613c4c2fd2bf4aa">error</a> = <a class="code" href="../../de/dfe/app__minivm_8c.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;</div><div class="line"><a name="l02509"></a><span class="lineno"> 2509</span>&#160;   <span class="keywordtype">char</span> *<a class="code" href="../../d8/d9e/structmessage.html">message</a> = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l02510"></a><span class="lineno"> 2510</span>&#160;   <span class="keywordtype">char</span> *<a class="code" href="../../d5/d03/asterisk_8c.html#a299365a3d8977a6c410c6cd924e33136">prompt</a> = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l02511"></a><span class="lineno"> 2511</span>&#160;   <span class="keywordtype">int</span> duration;</div><div class="line"><a name="l02512"></a><span class="lineno"> 2512</span>&#160;</div><div class="line"><a name="l02513"></a><span class="lineno"> 2513</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a>(data))  {</div><div class="line"><a name="l02514"></a><span class="lineno"> 2514</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;MinivmAccmess needs at least two arguments: account and option\n&quot;</span>);</div><div class="line"><a name="l02515"></a><span class="lineno"> 2515</span>&#160;      error = <a class="code" href="../../de/dfe/app__minivm_8c.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;</div><div class="line"><a name="l02516"></a><span class="lineno"> 2516</span>&#160;   } <span class="keywordflow">else</span> {</div><div class="line"><a name="l02517"></a><span class="lineno"> 2517</span>&#160;      tmpptr = <a class="code" href="../../d8/d8a/astmm_8h.html#ab5f0750cc80ba337fdcbddea2d3a1ee6">ast_strdupa</a>((<span class="keywordtype">char</span> *)data);</div><div class="line"><a name="l02518"></a><span class="lineno"> 2518</span>&#160;      argc = <a class="code" href="../../d3/d93/include_2asterisk_2app_8h.html#a588ed7395623b8493efcf229024af9c5">ast_app_separate_args</a>(tmpptr, <span class="charliteral">&#39;,&#39;</span>, argv, <a class="code" href="../../de/dfe/isdn__lib_8c.html#ab9129b977a587b50ea801daac75e178f">ARRAY_LEN</a>(argv));</div><div class="line"><a name="l02519"></a><span class="lineno"> 2519</span>&#160;   }</div><div class="line"><a name="l02520"></a><span class="lineno"> 2520</span>&#160;</div><div class="line"><a name="l02521"></a><span class="lineno"> 2521</span>&#160;   <span class="keywordflow">if</span> (argc &lt;=1) {</div><div class="line"><a name="l02522"></a><span class="lineno"> 2522</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;MinivmAccmess needs at least two arguments: account and option\n&quot;</span>);</div><div class="line"><a name="l02523"></a><span class="lineno"> 2523</span>&#160;      error = <a class="code" href="../../de/dfe/app__minivm_8c.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;</div><div class="line"><a name="l02524"></a><span class="lineno"> 2524</span>&#160;   }</div><div class="line"><a name="l02525"></a><span class="lineno"> 2525</span>&#160;   <span class="keywordflow">if</span> (!error &amp;&amp; strlen(argv[1]) &gt; 1) {</div><div class="line"><a name="l02526"></a><span class="lineno"> 2526</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;MinivmAccmess can only handle one option at a time. Bad option string: %s\n&quot;</span>, argv[1]);</div><div class="line"><a name="l02527"></a><span class="lineno"> 2527</span>&#160;      error = <a class="code" href="../../de/dfe/app__minivm_8c.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;</div><div class="line"><a name="l02528"></a><span class="lineno"> 2528</span>&#160;   }</div><div class="line"><a name="l02529"></a><span class="lineno"> 2529</span>&#160;</div><div class="line"><a name="l02530"></a><span class="lineno"> 2530</span>&#160;   <span class="keywordflow">if</span> (!error &amp;&amp; <a class="code" href="../../d3/d93/include_2asterisk_2app_8h.html#af40039f1c49c16d0f6fa33fe9c43a0cb">ast_app_parse_options</a>(<a class="code" href="../../de/dfe/app__minivm_8c.html#a9037a3cda0a3779450ce6cba1041b70f">minivm_accmess_options</a>, &amp;flags, opts, argv[1])) {</div><div class="line"><a name="l02531"></a><span class="lineno"> 2531</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Can&#39;t parse option %s\n&quot;</span>, argv[1]);</div><div class="line"><a name="l02532"></a><span class="lineno"> 2532</span>&#160;      error = <a class="code" href="../../de/dfe/app__minivm_8c.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;</div><div class="line"><a name="l02533"></a><span class="lineno"> 2533</span>&#160;   }</div><div class="line"><a name="l02534"></a><span class="lineno"> 2534</span>&#160;</div><div class="line"><a name="l02535"></a><span class="lineno"> 2535</span>&#160;   <span class="keywordflow">if</span> (error) {</div><div class="line"><a name="l02536"></a><span class="lineno"> 2536</span>&#160;      <a class="code" href="../../db/de0/pbx_8h.html#a6e5b90edb84d216267148dddcffe9b9a">pbx_builtin_setvar_helper</a>(chan, <span class="stringliteral">&quot;MVM_ACCMESS_STATUS&quot;</span>, <span class="stringliteral">&quot;FAILED&quot;</span>);</div><div class="line"><a name="l02537"></a><span class="lineno"> 2537</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l02538"></a><span class="lineno"> 2538</span>&#160;   }</div><div class="line"><a name="l02539"></a><span class="lineno"> 2539</span>&#160;</div><div class="line"><a name="l02540"></a><span class="lineno"> 2540</span>&#160;   <a class="code" href="../../d6/d90/strings_8h.html#ac4040268f7b6ed77dfc49c7767626369">ast_copy_string</a>(tmp, argv[0], <span class="keyword">sizeof</span>(tmp));</div><div class="line"><a name="l02541"></a><span class="lineno"> 2541</span>&#160;   username = <a class="code" href="../../de/d1e/bt__open_8c.html#a1cdd2bb1a9a71d3e1120100229315d67">tmp</a>;</div><div class="line"><a name="l02542"></a><span class="lineno"> 2542</span>&#160;   domain = strchr(tmp, <span class="charliteral">&#39;@&#39;</span>);</div><div class="line"><a name="l02543"></a><span class="lineno"> 2543</span>&#160;   <span class="keywordflow">if</span> (domain) {</div><div class="line"><a name="l02544"></a><span class="lineno"> 2544</span>&#160;      *domain = <span class="charliteral">&#39;\0&#39;</span>;</div><div class="line"><a name="l02545"></a><span class="lineno"> 2545</span>&#160;      domain++;</div><div class="line"><a name="l02546"></a><span class="lineno"> 2546</span>&#160;   }</div><div class="line"><a name="l02547"></a><span class="lineno"> 2547</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a>(domain) || <a class="code" href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a>(username)) {</div><div class="line"><a name="l02548"></a><span class="lineno"> 2548</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Need username@domain as argument. Sorry. Argument 0 %s\n&quot;</span>, argv[0]);</div><div class="line"><a name="l02549"></a><span class="lineno"> 2549</span>&#160;      <a class="code" href="../../db/de0/pbx_8h.html#a6e5b90edb84d216267148dddcffe9b9a">pbx_builtin_setvar_helper</a>(chan, <span class="stringliteral">&quot;MVM_ACCMESS_STATUS&quot;</span>, <span class="stringliteral">&quot;FAILED&quot;</span>);</div><div class="line"><a name="l02550"></a><span class="lineno"> 2550</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l02551"></a><span class="lineno"> 2551</span>&#160;   }</div><div class="line"><a name="l02552"></a><span class="lineno"> 2552</span>&#160;</div><div class="line"><a name="l02553"></a><span class="lineno"> 2553</span>&#160;   <span class="keywordflow">if</span>(!(vmu = <a class="code" href="../../de/dfe/app__minivm_8c.html#ac26055cad7a69cbfb6692d273f025a40">find_account</a>(domain, username, <a class="code" href="../../de/dfe/app__minivm_8c.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>))) {</div><div class="line"><a name="l02554"></a><span class="lineno"> 2554</span>&#160;      <span class="comment">/* We could not find user, let&#39;s exit */</span></div><div class="line"><a name="l02555"></a><span class="lineno"> 2555</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Could not allocate temporary memory for &#39;%s@%s&#39;\n&quot;</span>, username, domain);</div><div class="line"><a name="l02556"></a><span class="lineno"> 2556</span>&#160;      <a class="code" href="../../db/de0/pbx_8h.html#a6e5b90edb84d216267148dddcffe9b9a">pbx_builtin_setvar_helper</a>(chan, <span class="stringliteral">&quot;MVM_ACCMESS_STATUS&quot;</span>, <span class="stringliteral">&quot;FAILED&quot;</span>);</div><div class="line"><a name="l02557"></a><span class="lineno"> 2557</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l02558"></a><span class="lineno"> 2558</span>&#160;   }</div><div class="line"><a name="l02559"></a><span class="lineno"> 2559</span>&#160;</div><div class="line"><a name="l02560"></a><span class="lineno"> 2560</span>&#160;   <span class="comment">/* Answer channel if it&#39;s not already answered */</span></div><div class="line"><a name="l02561"></a><span class="lineno"> 2561</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d9/d95/channelstate_8h.html#a03585bc87e5bbd0f4d11bc789734c660">ast_channel_state</a>(chan) != <a class="code" href="../../d9/d95/channelstate_8h.html#a03585bc87e5bbd0f4d11bc789734c660aa8ab4bcda7378ccc17c39dfd880cba3d">AST_STATE_UP</a>)</div><div class="line"><a name="l02562"></a><span class="lineno"> 2562</span>&#160;      <a class="code" href="../../d5/d7b/channel_8h.html#aec583a3e25358ee552a4f3df53914cd0">ast_answer</a>(chan);</div><div class="line"><a name="l02563"></a><span class="lineno"> 2563</span>&#160;</div><div class="line"><a name="l02564"></a><span class="lineno"> 2564</span>&#160;   <span class="comment">/* Here&#39;s where the action is */</span></div><div class="line"><a name="l02565"></a><span class="lineno"> 2565</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d5/d60/utils_8h.html#a00d4c9254c9827d6fa44f17a326744a5">ast_test_flag</a>(&amp;flags, <a class="code" href="../../de/dfe/app__minivm_8c.html#a4aeda8b39c8ab166c538157d05591922a6021f80ddb5561e6e07a285ea47b086e">OPT_BUSY_GREETING</a>)) {</div><div class="line"><a name="l02566"></a><span class="lineno"> 2566</span>&#160;      message = <span class="stringliteral">&quot;busy&quot;</span>;</div><div class="line"><a name="l02567"></a><span class="lineno"> 2567</span>&#160;      prompt = <span class="stringliteral">&quot;vm-rec-busy&quot;</span>;</div><div class="line"><a name="l02568"></a><span class="lineno"> 2568</span>&#160;   } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="../../d5/d60/utils_8h.html#a00d4c9254c9827d6fa44f17a326744a5">ast_test_flag</a>(&amp;flags, <a class="code" href="../../de/dfe/app__minivm_8c.html#a4aeda8b39c8ab166c538157d05591922a96240d093eacd367dd06de745d12e559">OPT_UNAVAIL_GREETING</a>)) {</div><div class="line"><a name="l02569"></a><span class="lineno"> 2569</span>&#160;      message = <span class="stringliteral">&quot;unavailable&quot;</span>;</div><div class="line"><a name="l02570"></a><span class="lineno"> 2570</span>&#160;      prompt = <span class="stringliteral">&quot;vm-rec-unv&quot;</span>;</div><div class="line"><a name="l02571"></a><span class="lineno"> 2571</span>&#160;   } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="../../d5/d60/utils_8h.html#a00d4c9254c9827d6fa44f17a326744a5">ast_test_flag</a>(&amp;flags, <a class="code" href="../../de/dfe/app__minivm_8c.html#a4aeda8b39c8ab166c538157d05591922a46635c9bf224edd14121694d949250be">OPT_TEMP_GREETING</a>)) {</div><div class="line"><a name="l02572"></a><span class="lineno"> 2572</span>&#160;      message = <span class="stringliteral">&quot;temp&quot;</span>;</div><div class="line"><a name="l02573"></a><span class="lineno"> 2573</span>&#160;      prompt = <span class="stringliteral">&quot;vm-rec-temp&quot;</span>;</div><div class="line"><a name="l02574"></a><span class="lineno"> 2574</span>&#160;   } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="../../d5/d60/utils_8h.html#a00d4c9254c9827d6fa44f17a326744a5">ast_test_flag</a>(&amp;flags, <a class="code" href="../../de/dfe/app__minivm_8c.html#a4aeda8b39c8ab166c538157d05591922a3ccbdb01bd64716cf0762f2d1f95d124">OPT_NAME_GREETING</a>)) {</div><div class="line"><a name="l02575"></a><span class="lineno"> 2575</span>&#160;      message = <span class="stringliteral">&quot;greet&quot;</span>;</div><div class="line"><a name="l02576"></a><span class="lineno"> 2576</span>&#160;      prompt = <span class="stringliteral">&quot;vm-rec-name&quot;</span>;</div><div class="line"><a name="l02577"></a><span class="lineno"> 2577</span>&#160;   }</div><div class="line"><a name="l02578"></a><span class="lineno"> 2578</span>&#160;   snprintf(filename,<span class="keyword">sizeof</span>(filename), <span class="stringliteral">&quot;%s%s/%s/%s&quot;</span>, <a class="code" href="../../de/dfe/app__minivm_8c.html#ab94d2ef3acf22b2bf9410c48462c7cb1">MVM_SPOOL_DIR</a>, vmu-&gt;<a class="code" href="../../dc/d7b/structminivm__account.html#ae43ea5d0335f149f0920d33e46b61c33">domain</a>, vmu-&gt;<a class="code" href="../../dc/d7b/structminivm__account.html#a4b30874d24514b5ef6ff5276e8c12ed4">username</a>, message);</div><div class="line"><a name="l02579"></a><span class="lineno"> 2579</span>&#160;   <span class="comment">/* Maybe we should check the result of play_record_review ? */</span></div><div class="line"><a name="l02580"></a><span class="lineno"> 2580</span>&#160;   <a class="code" href="../../de/dfe/app__minivm_8c.html#a9900bfa7d5724fe84c74fec928f49052">play_record_review</a>(chan, prompt, filename, global_maxgreet, default_vmformat, 0, vmu, &amp;duration, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../de/dfe/app__minivm_8c.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>);</div><div class="line"><a name="l02581"></a><span class="lineno"> 2581</span>&#160;</div><div class="line"><a name="l02582"></a><span class="lineno"> 2582</span>&#160;   <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(1, <span class="stringliteral">&quot;Recorded new %s message in %s (duration %d)\n&quot;</span>, message, filename, duration);</div><div class="line"><a name="l02583"></a><span class="lineno"> 2583</span>&#160;</div><div class="line"><a name="l02584"></a><span class="lineno"> 2584</span>&#160;   <span class="keywordflow">if</span>(<a class="code" href="../../d5/d60/utils_8h.html#a00d4c9254c9827d6fa44f17a326744a5">ast_test_flag</a>(vmu, <a class="code" href="../../de/dfe/app__minivm_8c.html#ac1976490b5dd7e2dae38667d5d21fe4a">MVM_ALLOCED</a>))</div><div class="line"><a name="l02585"></a><span class="lineno"> 2585</span>&#160;      <a class="code" href="../../de/dfe/app__minivm_8c.html#a1c42a258925cbbb46952152ec3785bfd">free_user</a>(vmu);</div><div class="line"><a name="l02586"></a><span class="lineno"> 2586</span>&#160;</div><div class="line"><a name="l02587"></a><span class="lineno"> 2587</span>&#160;   <a class="code" href="../../db/de0/pbx_8h.html#a6e5b90edb84d216267148dddcffe9b9a">pbx_builtin_setvar_helper</a>(chan, <span class="stringliteral">&quot;MVM_ACCMESS_STATUS&quot;</span>, <span class="stringliteral">&quot;SUCCESS&quot;</span>);</div><div class="line"><a name="l02588"></a><span class="lineno"> 2588</span>&#160;</div><div class="line"><a name="l02589"></a><span class="lineno"> 2589</span>&#160;   <span class="comment">/* Ok, we&#39;re ready to rock and roll. Return to dialplan */</span></div><div class="line"><a name="l02590"></a><span class="lineno"> 2590</span>&#160;   <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l02591"></a><span class="lineno"> 2591</span>&#160;}</div><div class="line"><a name="l02592"></a><span class="lineno"> 2592</span>&#160;<span class="comment"></span></div><div class="line"><a name="l02593"></a><span class="lineno"> 2593</span>&#160;<span class="comment">/*! \brief Append new mailbox to mailbox list from configuration file */</span></div><div class="line"><a name="l02594"></a><span class="lineno"><a class="line" href="../../de/dfe/app__minivm_8c.html#a0cb40730dc4102d3171993e6e479a09c"> 2594</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../de/dfe/app__minivm_8c.html#a0cb40730dc4102d3171993e6e479a09c">create_vmaccount</a>(<span class="keywordtype">char</span> *<a class="code" href="../../d0/d29/cdr__mysql_8c.html#a0980a105ccb863d8008eb6201a51da52">name</a>, <span class="keyword">struct</span> <a class="code" href="../../dd/d02/structast__variable.html">ast_variable</a> *<a class="code" href="../../dc/df2/ast__expr2f_8c.html#a1b0936415a643c88ce543099c10e0d7f">var</a>, <span class="keywordtype">int</span> realtime)</div><div class="line"><a name="l02595"></a><span class="lineno"> 2595</span>&#160;{</div><div class="line"><a name="l02596"></a><span class="lineno"> 2596</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../dc/d7b/structminivm__account.html">minivm_account</a> *vmu;</div><div class="line"><a name="l02597"></a><span class="lineno"> 2597</span>&#160;   <span class="keywordtype">char</span> *<a class="code" href="../../dc/d7b/structminivm__account.html#ae43ea5d0335f149f0920d33e46b61c33">domain</a>;</div><div class="line"><a name="l02598"></a><span class="lineno"> 2598</span>&#160;   <span class="keywordtype">char</span> *<a class="code" href="../../dc/d7b/structminivm__account.html#a4b30874d24514b5ef6ff5276e8c12ed4">username</a>;</div><div class="line"><a name="l02599"></a><span class="lineno"> 2599</span>&#160;   <span class="keywordtype">char</span> accbuf[BUFSIZ];</div><div class="line"><a name="l02600"></a><span class="lineno"> 2600</span>&#160;</div><div class="line"><a name="l02601"></a><span class="lineno"> 2601</span>&#160;   <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(3, <span class="stringliteral">&quot;Creating %s account for [%s]\n&quot;</span>, realtime ? <span class="stringliteral">&quot;realtime&quot;</span> : <span class="stringliteral">&quot;static&quot;</span>, name);</div><div class="line"><a name="l02602"></a><span class="lineno"> 2602</span>&#160;</div><div class="line"><a name="l02603"></a><span class="lineno"> 2603</span>&#160;   <a class="code" href="../../d6/d90/strings_8h.html#ac4040268f7b6ed77dfc49c7767626369">ast_copy_string</a>(accbuf, name, <span class="keyword">sizeof</span>(accbuf));</div><div class="line"><a name="l02604"></a><span class="lineno"> 2604</span>&#160;   username = accbuf;</div><div class="line"><a name="l02605"></a><span class="lineno"> 2605</span>&#160;   domain = strchr(accbuf, <span class="charliteral">&#39;@&#39;</span>);</div><div class="line"><a name="l02606"></a><span class="lineno"> 2606</span>&#160;   <span class="keywordflow">if</span> (domain) {</div><div class="line"><a name="l02607"></a><span class="lineno"> 2607</span>&#160;      *domain = <span class="charliteral">&#39;\0&#39;</span>;</div><div class="line"><a name="l02608"></a><span class="lineno"> 2608</span>&#160;      domain++;</div><div class="line"><a name="l02609"></a><span class="lineno"> 2609</span>&#160;   }</div><div class="line"><a name="l02610"></a><span class="lineno"> 2610</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a>(domain)) {</div><div class="line"><a name="l02611"></a><span class="lineno"> 2611</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;No domain given for mini-voicemail account %s. Not configured.\n&quot;</span>, name);</div><div class="line"><a name="l02612"></a><span class="lineno"> 2612</span>&#160;      <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l02613"></a><span class="lineno"> 2613</span>&#160;   }</div><div class="line"><a name="l02614"></a><span class="lineno"> 2614</span>&#160;</div><div class="line"><a name="l02615"></a><span class="lineno"> 2615</span>&#160;   <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(3, <span class="stringliteral">&quot;Creating static account for user %s domain %s\n&quot;</span>, username, domain);</div><div class="line"><a name="l02616"></a><span class="lineno"> 2616</span>&#160;</div><div class="line"><a name="l02617"></a><span class="lineno"> 2617</span>&#160;   <span class="comment">/* Allocate user account */</span></div><div class="line"><a name="l02618"></a><span class="lineno"> 2618</span>&#160;   vmu = <a class="code" href="../../d8/d8a/astmm_8h.html#ae0cd4c5524b01287ab19cbe233d9cebb">ast_calloc</a>(1, <span class="keyword">sizeof</span>(*vmu));</div><div class="line"><a name="l02619"></a><span class="lineno"> 2619</span>&#160;   <span class="keywordflow">if</span> (!vmu)</div><div class="line"><a name="l02620"></a><span class="lineno"> 2620</span>&#160;      <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l02621"></a><span class="lineno"> 2621</span>&#160;</div><div class="line"><a name="l02622"></a><span class="lineno"> 2622</span>&#160;   <a class="code" href="../../d6/d90/strings_8h.html#ac4040268f7b6ed77dfc49c7767626369">ast_copy_string</a>(vmu-&gt;<a class="code" href="../../dc/d7b/structminivm__account.html#ae43ea5d0335f149f0920d33e46b61c33">domain</a>, domain, <span class="keyword">sizeof</span>(vmu-&gt;<a class="code" href="../../dc/d7b/structminivm__account.html#ae43ea5d0335f149f0920d33e46b61c33">domain</a>));</div><div class="line"><a name="l02623"></a><span class="lineno"> 2623</span>&#160;   <a class="code" href="../../d6/d90/strings_8h.html#ac4040268f7b6ed77dfc49c7767626369">ast_copy_string</a>(vmu-&gt;<a class="code" href="../../dc/d7b/structminivm__account.html#a4b30874d24514b5ef6ff5276e8c12ed4">username</a>, username, <span class="keyword">sizeof</span>(vmu-&gt;<a class="code" href="../../dc/d7b/structminivm__account.html#a4b30874d24514b5ef6ff5276e8c12ed4">username</a>));</div><div class="line"><a name="l02624"></a><span class="lineno"> 2624</span>&#160;</div><div class="line"><a name="l02625"></a><span class="lineno"> 2625</span>&#160;   <a class="code" href="../../de/dfe/app__minivm_8c.html#a2a7aec9f0ee827ff0e3863d6bb2fe277">populate_defaults</a>(vmu);</div><div class="line"><a name="l02626"></a><span class="lineno"> 2626</span>&#160;</div><div class="line"><a name="l02627"></a><span class="lineno"> 2627</span>&#160;   <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(3, <span class="stringliteral">&quot;...Configuring account %s\n&quot;</span>, name);</div><div class="line"><a name="l02628"></a><span class="lineno"> 2628</span>&#160;</div><div class="line"><a name="l02629"></a><span class="lineno"> 2629</span>&#160;   <span class="keywordflow">while</span> (var) {</div><div class="line"><a name="l02630"></a><span class="lineno"> 2630</span>&#160;      <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(3, <span class="stringliteral">&quot;Configuring %s = \&quot;%s\&quot; for account %s\n&quot;</span>, var-&gt;<a class="code" href="../../dd/d02/structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, var-&gt;<a class="code" href="../../dd/d02/structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, name);</div><div class="line"><a name="l02631"></a><span class="lineno"> 2631</span>&#160;      <span class="keywordflow">if</span> (!strcasecmp(var-&gt;<a class="code" href="../../dd/d02/structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;serveremail&quot;</span>)) {</div><div class="line"><a name="l02632"></a><span class="lineno"> 2632</span>&#160;         <a class="code" href="../../d6/d90/strings_8h.html#ac4040268f7b6ed77dfc49c7767626369">ast_copy_string</a>(vmu-&gt;<a class="code" href="../../dc/d7b/structminivm__account.html#a0d189d088982b574837ebaee7cd4ccbd">serveremail</a>, var-&gt;<a class="code" href="../../dd/d02/structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, <span class="keyword">sizeof</span>(vmu-&gt;<a class="code" href="../../dc/d7b/structminivm__account.html#a0d189d088982b574837ebaee7cd4ccbd">serveremail</a>));</div><div class="line"><a name="l02633"></a><span class="lineno"> 2633</span>&#160;      } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(var-&gt;<a class="code" href="../../dd/d02/structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;email&quot;</span>)) {</div><div class="line"><a name="l02634"></a><span class="lineno"> 2634</span>&#160;         <a class="code" href="../../d6/d90/strings_8h.html#ac4040268f7b6ed77dfc49c7767626369">ast_copy_string</a>(vmu-&gt;<a class="code" href="../../dc/d7b/structminivm__account.html#aadd75c09e15efa9061997f033b3f224b">email</a>, var-&gt;<a class="code" href="../../dd/d02/structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, <span class="keyword">sizeof</span>(vmu-&gt;<a class="code" href="../../dc/d7b/structminivm__account.html#aadd75c09e15efa9061997f033b3f224b">email</a>));</div><div class="line"><a name="l02635"></a><span class="lineno"> 2635</span>&#160;      } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(var-&gt;<a class="code" href="../../dd/d02/structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;accountcode&quot;</span>)) {</div><div class="line"><a name="l02636"></a><span class="lineno"> 2636</span>&#160;         <a class="code" href="../../d6/d90/strings_8h.html#ac4040268f7b6ed77dfc49c7767626369">ast_copy_string</a>(vmu-&gt;<a class="code" href="../../dc/d7b/structminivm__account.html#adfee50d07a98645d4d20b896ce03785a">accountcode</a>, var-&gt;<a class="code" href="../../dd/d02/structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, <span class="keyword">sizeof</span>(vmu-&gt;<a class="code" href="../../dc/d7b/structminivm__account.html#adfee50d07a98645d4d20b896ce03785a">accountcode</a>));</div><div class="line"><a name="l02637"></a><span class="lineno"> 2637</span>&#160;      } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(var-&gt;<a class="code" href="../../dd/d02/structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;pincode&quot;</span>)) {</div><div class="line"><a name="l02638"></a><span class="lineno"> 2638</span>&#160;         <a class="code" href="../../d6/d90/strings_8h.html#ac4040268f7b6ed77dfc49c7767626369">ast_copy_string</a>(vmu-&gt;<a class="code" href="../../dc/d7b/structminivm__account.html#ae120a3d8aeb5d880fba30d84a560efae">pincode</a>, var-&gt;<a class="code" href="../../dd/d02/structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, <span class="keyword">sizeof</span>(vmu-&gt;<a class="code" href="../../dc/d7b/structminivm__account.html#ae120a3d8aeb5d880fba30d84a560efae">pincode</a>));</div><div class="line"><a name="l02639"></a><span class="lineno"> 2639</span>&#160;      } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(var-&gt;<a class="code" href="../../dd/d02/structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;domain&quot;</span>)) {</div><div class="line"><a name="l02640"></a><span class="lineno"> 2640</span>&#160;         <a class="code" href="../../d6/d90/strings_8h.html#ac4040268f7b6ed77dfc49c7767626369">ast_copy_string</a>(vmu-&gt;<a class="code" href="../../dc/d7b/structminivm__account.html#ae43ea5d0335f149f0920d33e46b61c33">domain</a>, var-&gt;<a class="code" href="../../dd/d02/structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, <span class="keyword">sizeof</span>(vmu-&gt;<a class="code" href="../../dc/d7b/structminivm__account.html#ae43ea5d0335f149f0920d33e46b61c33">domain</a>));</div><div class="line"><a name="l02641"></a><span class="lineno"> 2641</span>&#160;      } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(var-&gt;<a class="code" href="../../dd/d02/structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;language&quot;</span>)) {</div><div class="line"><a name="l02642"></a><span class="lineno"> 2642</span>&#160;         <a class="code" href="../../d6/d90/strings_8h.html#ac4040268f7b6ed77dfc49c7767626369">ast_copy_string</a>(vmu-&gt;<a class="code" href="../../dc/d7b/structminivm__account.html#adf416dc058363e2fd5750c77e2d78bee">language</a>, var-&gt;<a class="code" href="../../dd/d02/structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, <span class="keyword">sizeof</span>(vmu-&gt;<a class="code" href="../../dc/d7b/structminivm__account.html#adf416dc058363e2fd5750c77e2d78bee">language</a>));</div><div class="line"><a name="l02643"></a><span class="lineno"> 2643</span>&#160;      } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(var-&gt;<a class="code" href="../../dd/d02/structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;timezone&quot;</span>)) {</div><div class="line"><a name="l02644"></a><span class="lineno"> 2644</span>&#160;         <a class="code" href="../../d6/d90/strings_8h.html#ac4040268f7b6ed77dfc49c7767626369">ast_copy_string</a>(vmu-&gt;<a class="code" href="../../dc/d7b/structminivm__account.html#a4a081db7653645ce9fce8fd72e5a7bf1">zonetag</a>, var-&gt;<a class="code" href="../../dd/d02/structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, <span class="keyword">sizeof</span>(vmu-&gt;<a class="code" href="../../dc/d7b/structminivm__account.html#a4a081db7653645ce9fce8fd72e5a7bf1">zonetag</a>));</div><div class="line"><a name="l02645"></a><span class="lineno"> 2645</span>&#160;      } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(var-&gt;<a class="code" href="../../dd/d02/structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;externnotify&quot;</span>)) {</div><div class="line"><a name="l02646"></a><span class="lineno"> 2646</span>&#160;         <a class="code" href="../../d6/d90/strings_8h.html#ac4040268f7b6ed77dfc49c7767626369">ast_copy_string</a>(vmu-&gt;<a class="code" href="../../dc/d7b/structminivm__account.html#aa2f937e69f79fbfcbf13a8ca51adcce0">externnotify</a>, var-&gt;<a class="code" href="../../dd/d02/structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, <span class="keyword">sizeof</span>(vmu-&gt;<a class="code" href="../../dc/d7b/structminivm__account.html#aa2f937e69f79fbfcbf13a8ca51adcce0">externnotify</a>));</div><div class="line"><a name="l02647"></a><span class="lineno"> 2647</span>&#160;      } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(var-&gt;<a class="code" href="../../dd/d02/structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;etemplate&quot;</span>)) {</div><div class="line"><a name="l02648"></a><span class="lineno"> 2648</span>&#160;         <a class="code" href="../../d6/d90/strings_8h.html#ac4040268f7b6ed77dfc49c7767626369">ast_copy_string</a>(vmu-&gt;<a class="code" href="../../dc/d7b/structminivm__account.html#ad48036454496b4bfb945139d1ae878c4">etemplate</a>, var-&gt;<a class="code" href="../../dd/d02/structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, <span class="keyword">sizeof</span>(vmu-&gt;<a class="code" href="../../dc/d7b/structminivm__account.html#ad48036454496b4bfb945139d1ae878c4">etemplate</a>));</div><div class="line"><a name="l02649"></a><span class="lineno"> 2649</span>&#160;      } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(var-&gt;<a class="code" href="../../dd/d02/structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;ptemplate&quot;</span>)) {</div><div class="line"><a name="l02650"></a><span class="lineno"> 2650</span>&#160;         <a class="code" href="../../d6/d90/strings_8h.html#ac4040268f7b6ed77dfc49c7767626369">ast_copy_string</a>(vmu-&gt;<a class="code" href="../../dc/d7b/structminivm__account.html#a6e9b30710047deee4fb3e4f38c8e7cc2">ptemplate</a>, var-&gt;<a class="code" href="../../dd/d02/structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, <span class="keyword">sizeof</span>(vmu-&gt;<a class="code" href="../../dc/d7b/structminivm__account.html#a6e9b30710047deee4fb3e4f38c8e7cc2">ptemplate</a>));</div><div class="line"><a name="l02651"></a><span class="lineno"> 2651</span>&#160;      } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(var-&gt;<a class="code" href="../../dd/d02/structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;fullname&quot;</span>)) {</div><div class="line"><a name="l02652"></a><span class="lineno"> 2652</span>&#160;         <a class="code" href="../../d6/d90/strings_8h.html#ac4040268f7b6ed77dfc49c7767626369">ast_copy_string</a>(vmu-&gt;<a class="code" href="../../dc/d7b/structminivm__account.html#ab5845627664c59054dd8e5f01829d4f3">fullname</a>, var-&gt;<a class="code" href="../../dd/d02/structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, <span class="keyword">sizeof</span>(vmu-&gt;<a class="code" href="../../dc/d7b/structminivm__account.html#ab5845627664c59054dd8e5f01829d4f3">fullname</a>));</div><div class="line"><a name="l02653"></a><span class="lineno"> 2653</span>&#160;      } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(var-&gt;<a class="code" href="../../dd/d02/structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;setvar&quot;</span>)) {</div><div class="line"><a name="l02654"></a><span class="lineno"> 2654</span>&#160;         <span class="keywordtype">char</span> *varval;</div><div class="line"><a name="l02655"></a><span class="lineno"> 2655</span>&#160;         <span class="keywordtype">char</span> varname[strlen(var-&gt;<a class="code" href="../../dd/d02/structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>) + 1];</div><div class="line"><a name="l02656"></a><span class="lineno"> 2656</span>&#160;         <span class="keyword">struct </span><a class="code" href="../../dd/d02/structast__variable.html">ast_variable</a> *tmpvar;</div><div class="line"><a name="l02657"></a><span class="lineno"> 2657</span>&#160;</div><div class="line"><a name="l02658"></a><span class="lineno"> 2658</span>&#160;         strcpy(varname, var-&gt;<a class="code" href="../../dd/d02/structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>); <span class="comment">/* safe */</span></div><div class="line"><a name="l02659"></a><span class="lineno"> 2659</span>&#160;         <span class="keywordflow">if</span> ((varval = strchr(varname, <span class="charliteral">&#39;=&#39;</span>))) {</div><div class="line"><a name="l02660"></a><span class="lineno"> 2660</span>&#160;            *varval = <span class="charliteral">&#39;\0&#39;</span>;</div><div class="line"><a name="l02661"></a><span class="lineno"> 2661</span>&#160;            varval++;</div><div class="line"><a name="l02662"></a><span class="lineno"> 2662</span>&#160;            <span class="keywordflow">if</span> ((tmpvar = <a class="code" href="../../d3/de6/include_2asterisk_2config_8h.html#a66581086d34dfe7ea86b0644bacef239">ast_variable_new</a>(varname, varval, <span class="stringliteral">&quot;&quot;</span>))) {</div><div class="line"><a name="l02663"></a><span class="lineno"> 2663</span>&#160;               tmpvar-&gt;<a class="code" href="../../dd/d02/structast__variable.html#afaaf66cc5029a563bd0bb9df076ea14b">next</a> = vmu-&gt;<a class="code" href="../../dc/d7b/structminivm__account.html#a06c0918fa1a1aac3d386fca59b12327c">chanvars</a>;</div><div class="line"><a name="l02664"></a><span class="lineno"> 2664</span>&#160;               vmu-&gt;<a class="code" href="../../dc/d7b/structminivm__account.html#a06c0918fa1a1aac3d386fca59b12327c">chanvars</a> = tmpvar;</div><div class="line"><a name="l02665"></a><span class="lineno"> 2665</span>&#160;            }</div><div class="line"><a name="l02666"></a><span class="lineno"> 2666</span>&#160;         }</div><div class="line"><a name="l02667"></a><span class="lineno"> 2667</span>&#160;      } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(var-&gt;<a class="code" href="../../dd/d02/structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;pager&quot;</span>)) {</div><div class="line"><a name="l02668"></a><span class="lineno"> 2668</span>&#160;         <a class="code" href="../../d6/d90/strings_8h.html#ac4040268f7b6ed77dfc49c7767626369">ast_copy_string</a>(vmu-&gt;<a class="code" href="../../dc/d7b/structminivm__account.html#a29b9b126bac9cc5f1cc334f140f39e8d">pager</a>, var-&gt;<a class="code" href="../../dd/d02/structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, <span class="keyword">sizeof</span>(vmu-&gt;<a class="code" href="../../dc/d7b/structminivm__account.html#a29b9b126bac9cc5f1cc334f140f39e8d">pager</a>));</div><div class="line"><a name="l02669"></a><span class="lineno"> 2669</span>&#160;      } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(var-&gt;<a class="code" href="../../dd/d02/structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;volgain&quot;</span>)) {</div><div class="line"><a name="l02670"></a><span class="lineno"> 2670</span>&#160;         sscanf(var-&gt;<a class="code" href="../../dd/d02/structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, <span class="stringliteral">&quot;%30lf&quot;</span>, &amp;vmu-&gt;<a class="code" href="../../dc/d7b/structminivm__account.html#a97d0f923218857a92e83d94dcbfe0263">volgain</a>);</div><div class="line"><a name="l02671"></a><span class="lineno"> 2671</span>&#160;      } <span class="keywordflow">else</span> {</div><div class="line"><a name="l02672"></a><span class="lineno"> 2672</span>&#160;         <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Unknown configuration option for minivm account %s : %s\n&quot;</span>, name, var-&gt;<a class="code" href="../../dd/d02/structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>);</div><div class="line"><a name="l02673"></a><span class="lineno"> 2673</span>&#160;      }</div><div class="line"><a name="l02674"></a><span class="lineno"> 2674</span>&#160;      var = var-&gt;<a class="code" href="../../dd/d02/structast__variable.html#afaaf66cc5029a563bd0bb9df076ea14b">next</a>;</div><div class="line"><a name="l02675"></a><span class="lineno"> 2675</span>&#160;   }</div><div class="line"><a name="l02676"></a><span class="lineno"> 2676</span>&#160;   <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(3, <span class="stringliteral">&quot;...Linking account %s\n&quot;</span>, name);</div><div class="line"><a name="l02677"></a><span class="lineno"> 2677</span>&#160;</div><div class="line"><a name="l02678"></a><span class="lineno"> 2678</span>&#160;   <a class="code" href="../../df/d90/linkedlists_8h.html#a9140a4e4d781264fa9469c52b1adae40">AST_LIST_LOCK</a>(&amp;<a class="code" href="../../d2/d1d/structminivm__accounts.html">minivm_accounts</a>);</div><div class="line"><a name="l02679"></a><span class="lineno"> 2679</span>&#160;   <a class="code" href="../../df/d90/linkedlists_8h.html#a4d258b4525e63c435d7de579d3f46960">AST_LIST_INSERT_TAIL</a>(&amp;<a class="code" href="../../d2/d1d/structminivm__accounts.html">minivm_accounts</a>, vmu, <a class="code" href="../../dc/d7b/structminivm__account.html#a571e7afb397f412b54fd1f776dab778f">list</a>);</div><div class="line"><a name="l02680"></a><span class="lineno"> 2680</span>&#160;   <a class="code" href="../../df/d90/linkedlists_8h.html#ab48cb9e1e612dd486b747ba1c5d68d01">AST_LIST_UNLOCK</a>(&amp;<a class="code" href="../../d2/d1d/structminivm__accounts.html">minivm_accounts</a>);</div><div class="line"><a name="l02681"></a><span class="lineno"> 2681</span>&#160;</div><div class="line"><a name="l02682"></a><span class="lineno"> 2682</span>&#160;   <a class="code" href="../../de/dfe/app__minivm_8c.html#afb3339bdf5d1db127a88fc3be1dbcb1c">global_stats</a>.<a class="code" href="../../d6/dee/structminivm__stats.html#a90ef6fe584f0712a6dfe1e90038da6bf">voicemailaccounts</a>++;</div><div class="line"><a name="l02683"></a><span class="lineno"> 2683</span>&#160;</div><div class="line"><a name="l02684"></a><span class="lineno"> 2684</span>&#160;   <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(2, <span class="stringliteral">&quot;MVM :: Created account %s@%s - tz %s etemplate %s %s\n&quot;</span>, username, domain, <a class="code" href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a>(vmu-&gt;<a class="code" href="../../dc/d7b/structminivm__account.html#a4a081db7653645ce9fce8fd72e5a7bf1">zonetag</a>) ? <span class="stringliteral">&quot;&quot;</span> : vmu-&gt;<a class="code" href="../../dc/d7b/structminivm__account.html#a4a081db7653645ce9fce8fd72e5a7bf1">zonetag</a>, <a class="code" href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a>(vmu-&gt;<a class="code" href="../../dc/d7b/structminivm__account.html#ad48036454496b4bfb945139d1ae878c4">etemplate</a>) ? <span class="stringliteral">&quot;&quot;</span> : vmu-&gt;<a class="code" href="../../dc/d7b/structminivm__account.html#ad48036454496b4bfb945139d1ae878c4">etemplate</a>, realtime ? <span class="stringliteral">&quot;(realtime)&quot;</span> : <span class="stringliteral">&quot;&quot;</span>);</div><div class="line"><a name="l02685"></a><span class="lineno"> 2685</span>&#160;   <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l02686"></a><span class="lineno"> 2686</span>&#160;}</div><div class="line"><a name="l02687"></a><span class="lineno"> 2687</span>&#160;<span class="comment"></span></div><div class="line"><a name="l02688"></a><span class="lineno"> 2688</span>&#160;<span class="comment">/*! \brief Free Mini Voicemail timezone */</span></div><div class="line"><a name="l02689"></a><span class="lineno"><a class="line" href="../../de/dfe/app__minivm_8c.html#a8b15b63639515446b3217dd1d3613d1b"> 2689</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../de/dfe/app__minivm_8c.html#a8b15b63639515446b3217dd1d3613d1b">free_zone</a>(<span class="keyword">struct</span> <a class="code" href="../../d4/d09/structminivm__zone.html">minivm_zone</a> *z)</div><div class="line"><a name="l02690"></a><span class="lineno"> 2690</span>&#160;{</div><div class="line"><a name="l02691"></a><span class="lineno"> 2691</span>&#160;   <a class="code" href="../../d8/d8a/astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(z);</div><div class="line"><a name="l02692"></a><span class="lineno"> 2692</span>&#160;}</div><div class="line"><a name="l02693"></a><span class="lineno"> 2693</span>&#160;<span class="comment"></span></div><div class="line"><a name="l02694"></a><span class="lineno"> 2694</span>&#160;<span class="comment">/*! \brief Clear list of timezones */</span></div><div class="line"><a name="l02695"></a><span class="lineno"><a class="line" href="../../de/dfe/app__minivm_8c.html#a437f2bbc010293e475569ccb2e7643b6"> 2695</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../de/dfe/app__minivm_8c.html#a437f2bbc010293e475569ccb2e7643b6">timezone_destroy_list</a>(<span class="keywordtype">void</span>)</div><div class="line"><a name="l02696"></a><span class="lineno"> 2696</span>&#160;{</div><div class="line"><a name="l02697"></a><span class="lineno"> 2697</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d4/d09/structminivm__zone.html">minivm_zone</a> *<span class="keyword">this</span>;</div><div class="line"><a name="l02698"></a><span class="lineno"> 2698</span>&#160;</div><div class="line"><a name="l02699"></a><span class="lineno"> 2699</span>&#160;   <a class="code" href="../../df/d90/linkedlists_8h.html#a9140a4e4d781264fa9469c52b1adae40">AST_LIST_LOCK</a>(&amp;<a class="code" href="../../db/dce/structminivm__zones.html">minivm_zones</a>);</div><div class="line"><a name="l02700"></a><span class="lineno"> 2700</span>&#160;   <span class="keywordflow">while</span> ((<span class="keyword">this</span> = <a class="code" href="../../df/d90/linkedlists_8h.html#aadfe2a69fbba4f27c201266a2ca5f989">AST_LIST_REMOVE_HEAD</a>(&amp;<a class="code" href="../../db/dce/structminivm__zones.html">minivm_zones</a>, <a class="code" href="../../dc/d7b/structminivm__account.html#a571e7afb397f412b54fd1f776dab778f">list</a>)))</div><div class="line"><a name="l02701"></a><span class="lineno"> 2701</span>&#160;      <a class="code" href="../../de/dfe/app__minivm_8c.html#a8b15b63639515446b3217dd1d3613d1b">free_zone</a>(<span class="keyword">this</span>);</div><div class="line"><a name="l02702"></a><span class="lineno"> 2702</span>&#160;</div><div class="line"><a name="l02703"></a><span class="lineno"> 2703</span>&#160;   <a class="code" href="../../df/d90/linkedlists_8h.html#ab48cb9e1e612dd486b747ba1c5d68d01">AST_LIST_UNLOCK</a>(&amp;<a class="code" href="../../db/dce/structminivm__zones.html">minivm_zones</a>);</div><div class="line"><a name="l02704"></a><span class="lineno"> 2704</span>&#160;}</div><div class="line"><a name="l02705"></a><span class="lineno"> 2705</span>&#160;<span class="comment"></span></div><div class="line"><a name="l02706"></a><span class="lineno"> 2706</span>&#160;<span class="comment">/*! \brief Add time zone to memory list */</span></div><div class="line"><a name="l02707"></a><span class="lineno"><a class="line" href="../../de/dfe/app__minivm_8c.html#a54c59989081dfa2f9fa311f8cdbb767d"> 2707</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../de/dfe/app__minivm_8c.html#a54c59989081dfa2f9fa311f8cdbb767d">timezone_add</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *zonename, <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="../../de/dcc/conf2ael_8c.html#a74bb62276efdf39dd94048e007fca05b">config</a>)</div><div class="line"><a name="l02708"></a><span class="lineno"> 2708</span>&#160;{</div><div class="line"><a name="l02709"></a><span class="lineno"> 2709</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d4/d09/structminivm__zone.html">minivm_zone</a> *newzone;</div><div class="line"><a name="l02710"></a><span class="lineno"> 2710</span>&#160;   <span class="keywordtype">char</span> *<a class="code" href="../../d4/d09/structminivm__zone.html#a2c72a3f1a42813cfe7e2c79ef3fa9e6c">msg_format</a>, *timezone_str;</div><div class="line"><a name="l02711"></a><span class="lineno"> 2711</span>&#160;</div><div class="line"><a name="l02712"></a><span class="lineno"> 2712</span>&#160;   newzone = <a class="code" href="../../d8/d8a/astmm_8h.html#ae0cd4c5524b01287ab19cbe233d9cebb">ast_calloc</a>(1, <span class="keyword">sizeof</span>(*newzone));</div><div class="line"><a name="l02713"></a><span class="lineno"> 2713</span>&#160;   <span class="keywordflow">if</span> (newzone == <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)</div><div class="line"><a name="l02714"></a><span class="lineno"> 2714</span>&#160;      <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l02715"></a><span class="lineno"> 2715</span>&#160;</div><div class="line"><a name="l02716"></a><span class="lineno"> 2716</span>&#160;   msg_format = <a class="code" href="../../d8/d8a/astmm_8h.html#ab5f0750cc80ba337fdcbddea2d3a1ee6">ast_strdupa</a>(config);</div><div class="line"><a name="l02717"></a><span class="lineno"> 2717</span>&#160;</div><div class="line"><a name="l02718"></a><span class="lineno"> 2718</span>&#160;   timezone_str = <a class="code" href="../../de/da3/include_2asterisk_2compat_8h.html#a40eca58273c74a20a17f137d18ba826c">strsep</a>(&amp;msg_format, <span class="stringliteral">&quot;|&quot;</span>);</div><div class="line"><a name="l02719"></a><span class="lineno"> 2719</span>&#160;   <span class="keywordflow">if</span> (!msg_format) {</div><div class="line"><a name="l02720"></a><span class="lineno"> 2720</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Invalid timezone definition : %s\n&quot;</span>, zonename);</div><div class="line"><a name="l02721"></a><span class="lineno"> 2721</span>&#160;      <a class="code" href="../../d8/d8a/astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(newzone);</div><div class="line"><a name="l02722"></a><span class="lineno"> 2722</span>&#160;      <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l02723"></a><span class="lineno"> 2723</span>&#160;   }</div><div class="line"><a name="l02724"></a><span class="lineno"> 2724</span>&#160;</div><div class="line"><a name="l02725"></a><span class="lineno"> 2725</span>&#160;   <a class="code" href="../../d6/d90/strings_8h.html#ac4040268f7b6ed77dfc49c7767626369">ast_copy_string</a>(newzone-&gt;<a class="code" href="../../d4/d09/structminivm__zone.html#a3777dbae63a15da001b2baa317a25149">name</a>, zonename, <span class="keyword">sizeof</span>(newzone-&gt;<a class="code" href="../../d4/d09/structminivm__zone.html#a3777dbae63a15da001b2baa317a25149">name</a>));</div><div class="line"><a name="l02726"></a><span class="lineno"> 2726</span>&#160;   <a class="code" href="../../d6/d90/strings_8h.html#ac4040268f7b6ed77dfc49c7767626369">ast_copy_string</a>(newzone-&gt;<a class="code" href="../../d4/d09/structminivm__zone.html#aad16c37028f0efbc3cf8c9186b770ab8">timezone</a>, timezone_str, <span class="keyword">sizeof</span>(newzone-&gt;<a class="code" href="../../d4/d09/structminivm__zone.html#aad16c37028f0efbc3cf8c9186b770ab8">timezone</a>));</div><div class="line"><a name="l02727"></a><span class="lineno"> 2727</span>&#160;   <a class="code" href="../../d6/d90/strings_8h.html#ac4040268f7b6ed77dfc49c7767626369">ast_copy_string</a>(newzone-&gt;<a class="code" href="../../d4/d09/structminivm__zone.html#a2c72a3f1a42813cfe7e2c79ef3fa9e6c">msg_format</a>, msg_format, <span class="keyword">sizeof</span>(newzone-&gt;<a class="code" href="../../d4/d09/structminivm__zone.html#a2c72a3f1a42813cfe7e2c79ef3fa9e6c">msg_format</a>));</div><div class="line"><a name="l02728"></a><span class="lineno"> 2728</span>&#160;</div><div class="line"><a name="l02729"></a><span class="lineno"> 2729</span>&#160;   <a class="code" href="../../df/d90/linkedlists_8h.html#a9140a4e4d781264fa9469c52b1adae40">AST_LIST_LOCK</a>(&amp;<a class="code" href="../../db/dce/structminivm__zones.html">minivm_zones</a>);</div><div class="line"><a name="l02730"></a><span class="lineno"> 2730</span>&#160;   <a class="code" href="../../df/d90/linkedlists_8h.html#a4d258b4525e63c435d7de579d3f46960">AST_LIST_INSERT_TAIL</a>(&amp;<a class="code" href="../../db/dce/structminivm__zones.html">minivm_zones</a>, newzone, <a class="code" href="../../dc/d7b/structminivm__account.html#a571e7afb397f412b54fd1f776dab778f">list</a>);</div><div class="line"><a name="l02731"></a><span class="lineno"> 2731</span>&#160;   <a class="code" href="../../df/d90/linkedlists_8h.html#ab48cb9e1e612dd486b747ba1c5d68d01">AST_LIST_UNLOCK</a>(&amp;<a class="code" href="../../db/dce/structminivm__zones.html">minivm_zones</a>);</div><div class="line"><a name="l02732"></a><span class="lineno"> 2732</span>&#160;</div><div class="line"><a name="l02733"></a><span class="lineno"> 2733</span>&#160;   <a class="code" href="../../de/dfe/app__minivm_8c.html#afb3339bdf5d1db127a88fc3be1dbcb1c">global_stats</a>.<a class="code" href="../../d6/dee/structminivm__stats.html#ae86e86585a988ba3e05e4f4a92ad6b75">timezones</a>++;</div><div class="line"><a name="l02734"></a><span class="lineno"> 2734</span>&#160;</div><div class="line"><a name="l02735"></a><span class="lineno"> 2735</span>&#160;   <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l02736"></a><span class="lineno"> 2736</span>&#160;}</div><div class="line"><a name="l02737"></a><span class="lineno"> 2737</span>&#160;<span class="comment"></span></div><div class="line"><a name="l02738"></a><span class="lineno"> 2738</span>&#160;<span class="comment">/*! \brief Read message template from file */</span></div><div class="line"><a name="l02739"></a><span class="lineno"><a class="line" href="../../de/dfe/app__minivm_8c.html#a35b1cb78eff65cbd1cda43ce934918cf"> 2739</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">char</span> *<a class="code" href="../../de/dfe/app__minivm_8c.html#a35b1cb78eff65cbd1cda43ce934918cf">message_template_parse_filebody</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *filename) {</div><div class="line"><a name="l02740"></a><span class="lineno"> 2740</span>&#160;   <span class="keywordtype">char</span> <a class="code" href="../../dd/d7c/eagi__proxy_8c.html#ac95651d79c608a3148973b5b1fc9e525">buf</a>[BUFSIZ * 6];</div><div class="line"><a name="l02741"></a><span class="lineno"> 2741</span>&#160;   <span class="keywordtype">char</span> readbuf[BUFSIZ];</div><div class="line"><a name="l02742"></a><span class="lineno"> 2742</span>&#160;   <span class="keywordtype">char</span> filenamebuf[BUFSIZ];</div><div class="line"><a name="l02743"></a><span class="lineno"> 2743</span>&#160;   <span class="keywordtype">char</span> *writepos;</div><div class="line"><a name="l02744"></a><span class="lineno"> 2744</span>&#160;   <span class="keywordtype">char</span> *messagebody;</div><div class="line"><a name="l02745"></a><span class="lineno"> 2745</span>&#160;   FILE *fi;</div><div class="line"><a name="l02746"></a><span class="lineno"> 2746</span>&#160;   <span class="keywordtype">int</span> <a class="code" href="../../df/d58/structlines.html">lines</a> = 0;</div><div class="line"><a name="l02747"></a><span class="lineno"> 2747</span>&#160;</div><div class="line"><a name="l02748"></a><span class="lineno"> 2748</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a>(filename))</div><div class="line"><a name="l02749"></a><span class="lineno"> 2749</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l02750"></a><span class="lineno"> 2750</span>&#160;   <span class="keywordflow">if</span> (*filename == <span class="charliteral">&#39;/&#39;</span>)</div><div class="line"><a name="l02751"></a><span class="lineno"> 2751</span>&#160;      <a class="code" href="../../d6/d90/strings_8h.html#ac4040268f7b6ed77dfc49c7767626369">ast_copy_string</a>(filenamebuf, filename, <span class="keyword">sizeof</span>(filenamebuf));</div><div class="line"><a name="l02752"></a><span class="lineno"> 2752</span>&#160;   <span class="keywordflow">else</span></div><div class="line"><a name="l02753"></a><span class="lineno"> 2753</span>&#160;      snprintf(filenamebuf, <span class="keyword">sizeof</span>(filenamebuf), <span class="stringliteral">&quot;%s/%s&quot;</span>, <a class="code" href="../../dd/df2/paths_8h.html#a7d3836e5581e433c9f5edd30300cc187">ast_config_AST_CONFIG_DIR</a>, filename);</div><div class="line"><a name="l02754"></a><span class="lineno"> 2754</span>&#160;</div><div class="line"><a name="l02755"></a><span class="lineno"> 2755</span>&#160;   <span class="keywordflow">if</span> (!(fi = fopen(filenamebuf, <span class="stringliteral">&quot;r&quot;</span>))) {</div><div class="line"><a name="l02756"></a><span class="lineno"> 2756</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Can&#39;t read message template from file: %s\n&quot;</span>, filenamebuf);</div><div class="line"><a name="l02757"></a><span class="lineno"> 2757</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l02758"></a><span class="lineno"> 2758</span>&#160;   }</div><div class="line"><a name="l02759"></a><span class="lineno"> 2759</span>&#160;   writepos = <a class="code" href="../../dd/d7c/eagi__proxy_8c.html#ac95651d79c608a3148973b5b1fc9e525">buf</a>;</div><div class="line"><a name="l02760"></a><span class="lineno"> 2760</span>&#160;   <span class="keywordflow">while</span> (fgets(readbuf, <span class="keyword">sizeof</span>(readbuf), fi)) {</div><div class="line"><a name="l02761"></a><span class="lineno"> 2761</span>&#160;      lines ++;</div><div class="line"><a name="l02762"></a><span class="lineno"> 2762</span>&#160;      <span class="keywordflow">if</span> (writepos != buf) {</div><div class="line"><a name="l02763"></a><span class="lineno"> 2763</span>&#160;         *writepos = <span class="charliteral">&#39;\n&#39;</span>;    <span class="comment">/* Replace EOL with new line */</span></div><div class="line"><a name="l02764"></a><span class="lineno"> 2764</span>&#160;         writepos++;</div><div class="line"><a name="l02765"></a><span class="lineno"> 2765</span>&#160;      }</div><div class="line"><a name="l02766"></a><span class="lineno"> 2766</span>&#160;      <a class="code" href="../../d6/d90/strings_8h.html#ac4040268f7b6ed77dfc49c7767626369">ast_copy_string</a>(writepos, readbuf, <span class="keyword">sizeof</span>(buf) - (writepos - buf));</div><div class="line"><a name="l02767"></a><span class="lineno"> 2767</span>&#160;      writepos += strlen(readbuf) - 1;</div><div class="line"><a name="l02768"></a><span class="lineno"> 2768</span>&#160;   }</div><div class="line"><a name="l02769"></a><span class="lineno"> 2769</span>&#160;   fclose(fi);</div><div class="line"><a name="l02770"></a><span class="lineno"> 2770</span>&#160;   messagebody = <a class="code" href="../../d8/d8a/astmm_8h.html#ae0cd4c5524b01287ab19cbe233d9cebb">ast_calloc</a>(1, strlen(buf + 1));</div><div class="line"><a name="l02771"></a><span class="lineno"> 2771</span>&#160;   <a class="code" href="../../d6/d90/strings_8h.html#ac4040268f7b6ed77dfc49c7767626369">ast_copy_string</a>(messagebody, buf, strlen(buf) + 1);</div><div class="line"><a name="l02772"></a><span class="lineno"> 2772</span>&#160;   <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(4, <span class="stringliteral">&quot;---&gt; Size of allocation %d\n&quot;</span>, (<span class="keywordtype">int</span>) strlen(buf + 1) );</div><div class="line"><a name="l02773"></a><span class="lineno"> 2773</span>&#160;   <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(4, <span class="stringliteral">&quot;---&gt; Done reading message template : \n%s\n---- END message template--- \n&quot;</span>, messagebody);</div><div class="line"><a name="l02774"></a><span class="lineno"> 2774</span>&#160;</div><div class="line"><a name="l02775"></a><span class="lineno"> 2775</span>&#160;   <span class="keywordflow">return</span> messagebody;</div><div class="line"><a name="l02776"></a><span class="lineno"> 2776</span>&#160;}</div><div class="line"><a name="l02777"></a><span class="lineno"> 2777</span>&#160;<span class="comment"></span></div><div class="line"><a name="l02778"></a><span class="lineno"> 2778</span>&#160;<span class="comment">/*! \brief Parse emailbody template from configuration file */</span></div><div class="line"><a name="l02779"></a><span class="lineno"><a class="line" href="../../de/dfe/app__minivm_8c.html#a6d414e863f3534b892d3cd56fbb238f3"> 2779</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">char</span> *<a class="code" href="../../de/dfe/app__minivm_8c.html#a6d414e863f3534b892d3cd56fbb238f3">message_template_parse_emailbody</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *configuration)</div><div class="line"><a name="l02780"></a><span class="lineno"> 2780</span>&#160;{</div><div class="line"><a name="l02781"></a><span class="lineno"> 2781</span>&#160;   <span class="keywordtype">char</span> *tmpread, *tmpwrite;</div><div class="line"><a name="l02782"></a><span class="lineno"> 2782</span>&#160;   <span class="keywordtype">char</span> *<a class="code" href="../../dc/df4/app__voicemail_8c.html#ab89d128ff0a8b3ceab1ec2590bb98b2f">emailbody</a> = <a class="code" href="../../d8/d8a/astmm_8h.html#ab263849d03fb892847be4986db759737">ast_strdup</a>(configuration);</div><div class="line"><a name="l02783"></a><span class="lineno"> 2783</span>&#160;</div><div class="line"><a name="l02784"></a><span class="lineno"> 2784</span>&#160;   <span class="comment">/* substitute strings \t and \n into the apropriate characters */</span></div><div class="line"><a name="l02785"></a><span class="lineno"> 2785</span>&#160;   tmpread = tmpwrite = <a class="code" href="../../dc/df4/app__voicemail_8c.html#ab89d128ff0a8b3ceab1ec2590bb98b2f">emailbody</a>;</div><div class="line"><a name="l02786"></a><span class="lineno"> 2786</span>&#160;   <span class="keywordflow">while</span> ((tmpwrite = strchr(tmpread,<span class="charliteral">&#39;\\&#39;</span>))) {</div><div class="line"><a name="l02787"></a><span class="lineno"> 2787</span>&#160;          <span class="keywordtype">int</span> <a class="code" href="../../d9/d1e/func__strings_8c.html#af24e73aaf92f3000fda15d285e66df24">len</a> = strlen(<span class="stringliteral">&quot;\n&quot;</span>);</div><div class="line"><a name="l02788"></a><span class="lineno"> 2788</span>&#160;          <span class="keywordflow">switch</span> (tmpwrite[1]) {</div><div class="line"><a name="l02789"></a><span class="lineno"> 2789</span>&#160;          <span class="keywordflow">case</span> <span class="charliteral">&#39;n&#39;</span>:</div><div class="line"><a name="l02790"></a><span class="lineno"> 2790</span>&#160;            memmove(tmpwrite + len, tmpwrite + 2, strlen(tmpwrite + 2) + 1);</div><div class="line"><a name="l02791"></a><span class="lineno"> 2791</span>&#160;            tmpwrite[0] = <span class="charliteral">&#39;\n&#39;</span>;</div><div class="line"><a name="l02792"></a><span class="lineno"> 2792</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l02793"></a><span class="lineno"> 2793</span>&#160;          <span class="keywordflow">case</span> <span class="charliteral">&#39;t&#39;</span>:</div><div class="line"><a name="l02794"></a><span class="lineno"> 2794</span>&#160;            memmove(tmpwrite + len, tmpwrite + 2, strlen(tmpwrite + 2) + 1);</div><div class="line"><a name="l02795"></a><span class="lineno"> 2795</span>&#160;            tmpwrite[0] = <span class="charliteral">&#39;\t&#39;</span>;</div><div class="line"><a name="l02796"></a><span class="lineno"> 2796</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l02797"></a><span class="lineno"> 2797</span>&#160;          <span class="keywordflow">default</span>:</div><div class="line"><a name="l02798"></a><span class="lineno"> 2798</span>&#160;            <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#ad89ee324d180cdcd7defcc709ff9ca42">LOG_NOTICE</a>, <span class="stringliteral">&quot;Substitution routine does not support this character: %c\n&quot;</span>, tmpwrite[1]);</div><div class="line"><a name="l02799"></a><span class="lineno"> 2799</span>&#160;          }</div><div class="line"><a name="l02800"></a><span class="lineno"> 2800</span>&#160;          tmpread = tmpwrite + <a class="code" href="../../d9/d1e/func__strings_8c.html#af24e73aaf92f3000fda15d285e66df24">len</a>;</div><div class="line"><a name="l02801"></a><span class="lineno"> 2801</span>&#160;   }</div><div class="line"><a name="l02802"></a><span class="lineno"> 2802</span>&#160;   <span class="keywordflow">return</span> <a class="code" href="../../dc/df4/app__voicemail_8c.html#ab89d128ff0a8b3ceab1ec2590bb98b2f">emailbody</a>;</div><div class="line"><a name="l02803"></a><span class="lineno"> 2803</span>&#160;}</div><div class="line"><a name="l02804"></a><span class="lineno"> 2804</span>&#160;<span class="comment"></span></div><div class="line"><a name="l02805"></a><span class="lineno"> 2805</span>&#160;<span class="comment">/*! \brief Apply general configuration options */</span></div><div class="line"><a name="l02806"></a><span class="lineno"><a class="line" href="../../de/dfe/app__minivm_8c.html#a380fbb314d06d7a3e037975f2f65da50"> 2806</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../de/dfe/app__minivm_8c.html#a380fbb314d06d7a3e037975f2f65da50">apply_general_options</a>(<span class="keyword">struct</span> <a class="code" href="../../dd/d02/structast__variable.html">ast_variable</a> *<a class="code" href="../../dc/df2/ast__expr2f_8c.html#a1b0936415a643c88ce543099c10e0d7f">var</a>)</div><div class="line"><a name="l02807"></a><span class="lineno"> 2807</span>&#160;{</div><div class="line"><a name="l02808"></a><span class="lineno"> 2808</span>&#160;   <span class="keywordtype">int</span> <a class="code" href="../../d6/d47/utils_2frame_8c.html#a4a9391ee88e57361b613c4c2fd2bf4aa">error</a> = 0;</div><div class="line"><a name="l02809"></a><span class="lineno"> 2809</span>&#160;</div><div class="line"><a name="l02810"></a><span class="lineno"> 2810</span>&#160;   <span class="keywordflow">while</span> (var) {</div><div class="line"><a name="l02811"></a><span class="lineno"> 2811</span>&#160;      <span class="comment">/* Mail command */</span></div><div class="line"><a name="l02812"></a><span class="lineno"> 2812</span>&#160;      <span class="keywordflow">if</span> (!strcmp(var-&gt;<a class="code" href="../../dd/d02/structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;mailcmd&quot;</span>)) {</div><div class="line"><a name="l02813"></a><span class="lineno"> 2813</span>&#160;         <a class="code" href="../../d6/d90/strings_8h.html#ac4040268f7b6ed77dfc49c7767626369">ast_copy_string</a>(global_mailcmd, var-&gt;<a class="code" href="../../dd/d02/structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, <span class="keyword">sizeof</span>(global_mailcmd)); <span class="comment">/* User setting */</span></div><div class="line"><a name="l02814"></a><span class="lineno"> 2814</span>&#160;      } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcmp(var-&gt;<a class="code" href="../../dd/d02/structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;maxgreet&quot;</span>)) {</div><div class="line"><a name="l02815"></a><span class="lineno"> 2815</span>&#160;         global_maxgreet = atoi(var-&gt;<a class="code" href="../../dd/d02/structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>);</div><div class="line"><a name="l02816"></a><span class="lineno"> 2816</span>&#160;      } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcmp(var-&gt;<a class="code" href="../../dd/d02/structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;maxsilence&quot;</span>)) {</div><div class="line"><a name="l02817"></a><span class="lineno"> 2817</span>&#160;         global_maxsilence = atoi(var-&gt;<a class="code" href="../../dd/d02/structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>);</div><div class="line"><a name="l02818"></a><span class="lineno"> 2818</span>&#160;         <span class="keywordflow">if</span> (global_maxsilence &gt; 0)</div><div class="line"><a name="l02819"></a><span class="lineno"> 2819</span>&#160;            global_maxsilence *= 1000;</div><div class="line"><a name="l02820"></a><span class="lineno"> 2820</span>&#160;      } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcmp(var-&gt;<a class="code" href="../../dd/d02/structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;logfile&quot;</span>)) {</div><div class="line"><a name="l02821"></a><span class="lineno"> 2821</span>&#160;         <span class="keywordflow">if</span> (!<a class="code" href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a>(var-&gt;<a class="code" href="../../dd/d02/structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>) ) {</div><div class="line"><a name="l02822"></a><span class="lineno"> 2822</span>&#160;            <span class="keywordflow">if</span>(*(var-&gt;<a class="code" href="../../dd/d02/structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>) == <span class="charliteral">&#39;/&#39;</span>)</div><div class="line"><a name="l02823"></a><span class="lineno"> 2823</span>&#160;               <a class="code" href="../../d6/d90/strings_8h.html#ac4040268f7b6ed77dfc49c7767626369">ast_copy_string</a>(global_logfile, var-&gt;<a class="code" href="../../dd/d02/structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, <span class="keyword">sizeof</span>(global_logfile));</div><div class="line"><a name="l02824"></a><span class="lineno"> 2824</span>&#160;            <span class="keywordflow">else</span></div><div class="line"><a name="l02825"></a><span class="lineno"> 2825</span>&#160;               snprintf(global_logfile, <span class="keyword">sizeof</span>(global_logfile), <span class="stringliteral">&quot;%s/%s&quot;</span>, <a class="code" href="../../dd/df2/paths_8h.html#aea5e16ca2517e2093fdfa0e7fd112f0f">ast_config_AST_LOG_DIR</a>, var-&gt;<a class="code" href="../../dd/d02/structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>);</div><div class="line"><a name="l02826"></a><span class="lineno"> 2826</span>&#160;         }</div><div class="line"><a name="l02827"></a><span class="lineno"> 2827</span>&#160;      } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcmp(var-&gt;<a class="code" href="../../dd/d02/structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;externnotify&quot;</span>)) {</div><div class="line"><a name="l02828"></a><span class="lineno"> 2828</span>&#160;         <span class="comment">/* External voicemail notify application */</span></div><div class="line"><a name="l02829"></a><span class="lineno"> 2829</span>&#160;         <a class="code" href="../../d6/d90/strings_8h.html#ac4040268f7b6ed77dfc49c7767626369">ast_copy_string</a>(global_externnotify, var-&gt;<a class="code" href="../../dd/d02/structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, <span class="keyword">sizeof</span>(global_externnotify));</div><div class="line"><a name="l02830"></a><span class="lineno"> 2830</span>&#160;      } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcmp(var-&gt;<a class="code" href="../../dd/d02/structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;silencetreshold&quot;</span>)) {</div><div class="line"><a name="l02831"></a><span class="lineno"> 2831</span>&#160;         <span class="comment">/* Silence treshold */</span></div><div class="line"><a name="l02832"></a><span class="lineno"> 2832</span>&#160;         global_silencethreshold = atoi(var-&gt;<a class="code" href="../../dd/d02/structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>);</div><div class="line"><a name="l02833"></a><span class="lineno"> 2833</span>&#160;      } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcmp(var-&gt;<a class="code" href="../../dd/d02/structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;maxmessage&quot;</span>)) {</div><div class="line"><a name="l02834"></a><span class="lineno"> 2834</span>&#160;         <span class="keywordtype">int</span> x;</div><div class="line"><a name="l02835"></a><span class="lineno"> 2835</span>&#160;         <span class="keywordflow">if</span> (sscanf(var-&gt;<a class="code" href="../../dd/d02/structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, <span class="stringliteral">&quot;%30d&quot;</span>, &amp;x) == 1) {</div><div class="line"><a name="l02836"></a><span class="lineno"> 2836</span>&#160;            global_vmmaxmessage = x;</div><div class="line"><a name="l02837"></a><span class="lineno"> 2837</span>&#160;         } <span class="keywordflow">else</span> {</div><div class="line"><a name="l02838"></a><span class="lineno"> 2838</span>&#160;            error ++;</div><div class="line"><a name="l02839"></a><span class="lineno"> 2839</span>&#160;            <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Invalid max message time length\n&quot;</span>);</div><div class="line"><a name="l02840"></a><span class="lineno"> 2840</span>&#160;         }</div><div class="line"><a name="l02841"></a><span class="lineno"> 2841</span>&#160;      } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcmp(var-&gt;<a class="code" href="../../dd/d02/structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;minmessage&quot;</span>)) {</div><div class="line"><a name="l02842"></a><span class="lineno"> 2842</span>&#160;         <span class="keywordtype">int</span> x;</div><div class="line"><a name="l02843"></a><span class="lineno"> 2843</span>&#160;         <span class="keywordflow">if</span> (sscanf(var-&gt;<a class="code" href="../../dd/d02/structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, <span class="stringliteral">&quot;%30d&quot;</span>, &amp;x) == 1) {</div><div class="line"><a name="l02844"></a><span class="lineno"> 2844</span>&#160;            global_vmminmessage = x;</div><div class="line"><a name="l02845"></a><span class="lineno"> 2845</span>&#160;            <span class="keywordflow">if</span> (global_maxsilence &lt;= global_vmminmessage)</div><div class="line"><a name="l02846"></a><span class="lineno"> 2846</span>&#160;               <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;maxsilence should be less than minmessage or you may get empty messages\n&quot;</span>);</div><div class="line"><a name="l02847"></a><span class="lineno"> 2847</span>&#160;         } <span class="keywordflow">else</span> {</div><div class="line"><a name="l02848"></a><span class="lineno"> 2848</span>&#160;            error ++;</div><div class="line"><a name="l02849"></a><span class="lineno"> 2849</span>&#160;            <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Invalid min message time length\n&quot;</span>);</div><div class="line"><a name="l02850"></a><span class="lineno"> 2850</span>&#160;         }</div><div class="line"><a name="l02851"></a><span class="lineno"> 2851</span>&#160;      } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcmp(var-&gt;<a class="code" href="../../dd/d02/structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;format&quot;</span>)) {</div><div class="line"><a name="l02852"></a><span class="lineno"> 2852</span>&#160;         <a class="code" href="../../d6/d90/strings_8h.html#ac4040268f7b6ed77dfc49c7767626369">ast_copy_string</a>(default_vmformat, var-&gt;<a class="code" href="../../dd/d02/structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, <span class="keyword">sizeof</span>(default_vmformat));</div><div class="line"><a name="l02853"></a><span class="lineno"> 2853</span>&#160;      } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcmp(var-&gt;<a class="code" href="../../dd/d02/structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;review&quot;</span>)) {</div><div class="line"><a name="l02854"></a><span class="lineno"> 2854</span>&#160;         <a class="code" href="../../d5/d60/utils_8h.html#a67b6713ff86cf82aaed821e9a87d1c21">ast_set2_flag</a>((&amp;globalflags), <a class="code" href="../../d6/d90/strings_8h.html#a387a69b3871ca31061566a73f45d20f4">ast_true</a>(var-&gt;<a class="code" href="../../dd/d02/structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>), <a class="code" href="../../de/dfe/app__minivm_8c.html#a251b3dd38bf79c9b6d4fdc86ef63f0a8">MVM_REVIEW</a>);</div><div class="line"><a name="l02855"></a><span class="lineno"> 2855</span>&#160;      } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcmp(var-&gt;<a class="code" href="../../dd/d02/structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;operator&quot;</span>)) {</div><div class="line"><a name="l02856"></a><span class="lineno"> 2856</span>&#160;         <a class="code" href="../../d5/d60/utils_8h.html#a67b6713ff86cf82aaed821e9a87d1c21">ast_set2_flag</a>((&amp;globalflags), <a class="code" href="../../d6/d90/strings_8h.html#a387a69b3871ca31061566a73f45d20f4">ast_true</a>(var-&gt;<a class="code" href="../../dd/d02/structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>), <a class="code" href="../../de/dfe/app__minivm_8c.html#ac06da19dda21a4bac4970057bf72497a">MVM_OPERATOR</a>);</div><div class="line"><a name="l02857"></a><span class="lineno"> 2857</span>&#160;      }</div><div class="line"><a name="l02858"></a><span class="lineno"> 2858</span>&#160;      var = var-&gt;<a class="code" href="../../dd/d02/structast__variable.html#afaaf66cc5029a563bd0bb9df076ea14b">next</a>;</div><div class="line"><a name="l02859"></a><span class="lineno"> 2859</span>&#160;   }</div><div class="line"><a name="l02860"></a><span class="lineno"> 2860</span>&#160;   <span class="keywordflow">return</span> <a class="code" href="../../d6/d47/utils_2frame_8c.html#a4a9391ee88e57361b613c4c2fd2bf4aa">error</a>;</div><div class="line"><a name="l02861"></a><span class="lineno"> 2861</span>&#160;}</div><div class="line"><a name="l02862"></a><span class="lineno"> 2862</span>&#160;<span class="comment"></span></div><div class="line"><a name="l02863"></a><span class="lineno"> 2863</span>&#160;<span class="comment">/*! \brief Load minivoicemail configuration */</span></div><div class="line"><a name="l02864"></a><span class="lineno"><a class="line" href="../../de/dfe/app__minivm_8c.html#ad0f6114d9cab58a8ec3d9555cb466534"> 2864</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../de/dfe/app__minivm_8c.html#ad0f6114d9cab58a8ec3d9555cb466534">load_config</a>(<span class="keywordtype">int</span> <a class="code" href="../../de/dfe/app__minivm_8c.html#ad1982509765f4870f1f63412a53ea668">reload</a>)</div><div class="line"><a name="l02865"></a><span class="lineno"> 2865</span>&#160;{</div><div class="line"><a name="l02866"></a><span class="lineno"> 2866</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../dd/d18/structast__config.html">ast_config</a> *cfg;</div><div class="line"><a name="l02867"></a><span class="lineno"> 2867</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../dd/d02/structast__variable.html">ast_variable</a> *<a class="code" href="../../dc/df2/ast__expr2f_8c.html#a1b0936415a643c88ce543099c10e0d7f">var</a>;</div><div class="line"><a name="l02868"></a><span class="lineno"> 2868</span>&#160;   <span class="keywordtype">char</span> *cat;</div><div class="line"><a name="l02869"></a><span class="lineno"> 2869</span>&#160;   <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="../../d8/d40/app__system_8c.html#adbef7f80c92b734e2eb8b48d975b695d">chanvar</a>;</div><div class="line"><a name="l02870"></a><span class="lineno"> 2870</span>&#160;   <span class="keywordtype">int</span> <a class="code" href="../../d6/d47/utils_2frame_8c.html#a4a9391ee88e57361b613c4c2fd2bf4aa">error</a> = 0;</div><div class="line"><a name="l02871"></a><span class="lineno"> 2871</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../dc/d31/structminivm__template.html">minivm_template</a> *<span class="keyword">template</span>;</div><div class="line"><a name="l02872"></a><span class="lineno"> 2872</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../dc/dac/structast__flags.html">ast_flags</a> config_flags = { reload ? <a class="code" href="../../d3/de6/include_2asterisk_2config_8h.html#a103e76ed4bd42f776f7f260080b98b3fafa887389dc380bbdcffb65fec379f037">CONFIG_FLAG_FILEUNCHANGED</a> : 0 };</div><div class="line"><a name="l02873"></a><span class="lineno"> 2873</span>&#160;</div><div class="line"><a name="l02874"></a><span class="lineno"> 2874</span>&#160;   cfg = <a class="code" href="../../d3/de6/include_2asterisk_2config_8h.html#a0a07ddd6bbcf44485e01c14c96109482">ast_config_load</a>(<a class="code" href="../../de/dfe/app__minivm_8c.html#a62e6fabd28e7d7a9941945c7fde3bda6">VOICEMAIL_CONFIG</a>, config_flags);</div><div class="line"><a name="l02875"></a><span class="lineno"> 2875</span>&#160;   <span class="keywordflow">if</span> (cfg == <a class="code" href="../../d3/de6/include_2asterisk_2config_8h.html#a846844eb2c4eb44554445936b3770711">CONFIG_STATUS_FILEUNCHANGED</a>) {</div><div class="line"><a name="l02876"></a><span class="lineno"> 2876</span>&#160;      <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l02877"></a><span class="lineno"> 2877</span>&#160;   } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (cfg == <a class="code" href="../../d3/de6/include_2asterisk_2config_8h.html#a8d1a63cdf2c7aff22a77b6e75d93b377">CONFIG_STATUS_FILEINVALID</a>) {</div><div class="line"><a name="l02878"></a><span class="lineno"> 2878</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Config file &quot;</span> <a class="code" href="../../de/dfe/app__minivm_8c.html#a62e6fabd28e7d7a9941945c7fde3bda6">VOICEMAIL_CONFIG</a> <span class="stringliteral">&quot; is in an invalid format.  Aborting.\n&quot;</span>);</div><div class="line"><a name="l02879"></a><span class="lineno"> 2879</span>&#160;      <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l02880"></a><span class="lineno"> 2880</span>&#160;   }</div><div class="line"><a name="l02881"></a><span class="lineno"> 2881</span>&#160;</div><div class="line"><a name="l02882"></a><span class="lineno"> 2882</span>&#160;   <a class="code" href="../../dd/d42/lock_8h.html#ac5e13c7fe64d3b271a52028b0a78b92b">ast_mutex_lock</a>(&amp;<a class="code" href="../../de/dfe/app__minivm_8c.html#ac50dec9d4a43a4e81ca2895e7ac7be2d">minivmlock</a>);</div><div class="line"><a name="l02883"></a><span class="lineno"> 2883</span>&#160;</div><div class="line"><a name="l02884"></a><span class="lineno"> 2884</span>&#160;   <span class="comment">/* Destroy lists to reconfigure */</span></div><div class="line"><a name="l02885"></a><span class="lineno"> 2885</span>&#160;   <a class="code" href="../../de/dfe/app__minivm_8c.html#a0d7a1f3e3456c97d999bc5586878d15e">message_destroy_list</a>();    <span class="comment">/* Destroy list of voicemail message templates */</span></div><div class="line"><a name="l02886"></a><span class="lineno"> 2886</span>&#160;   <a class="code" href="../../de/dfe/app__minivm_8c.html#a437f2bbc010293e475569ccb2e7643b6">timezone_destroy_list</a>();   <span class="comment">/* Destroy list of timezones */</span></div><div class="line"><a name="l02887"></a><span class="lineno"> 2887</span>&#160;   <a class="code" href="../../de/dfe/app__minivm_8c.html#a967b9e2acf79f774a1649eb1630c89a5">vmaccounts_destroy_list</a>(); <span class="comment">/* Destroy list of voicemail accounts */</span></div><div class="line"><a name="l02888"></a><span class="lineno"> 2888</span>&#160;   <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(2, <span class="stringliteral">&quot;Destroyed memory objects...\n&quot;</span>);</div><div class="line"><a name="l02889"></a><span class="lineno"> 2889</span>&#160;</div><div class="line"><a name="l02890"></a><span class="lineno"> 2890</span>&#160;   <span class="comment">/* First, set some default settings */</span></div><div class="line"><a name="l02891"></a><span class="lineno"> 2891</span>&#160;   global_externnotify[0] = <span class="charliteral">&#39;\0&#39;</span>;</div><div class="line"><a name="l02892"></a><span class="lineno"> 2892</span>&#160;   global_logfile[0] = <span class="charliteral">&#39;\0&#39;</span>;</div><div class="line"><a name="l02893"></a><span class="lineno"> 2893</span>&#160;   global_vmmaxmessage = 2000;</div><div class="line"><a name="l02894"></a><span class="lineno"> 2894</span>&#160;   global_maxgreet = 2000;</div><div class="line"><a name="l02895"></a><span class="lineno"> 2895</span>&#160;   global_vmminmessage = 0;</div><div class="line"><a name="l02896"></a><span class="lineno"> 2896</span>&#160;   strcpy(global_mailcmd, <a class="code" href="../../de/dfe/app__minivm_8c.html#a92d8fb2d08cf9220d520ae9691b5e6c4">SENDMAIL</a>);</div><div class="line"><a name="l02897"></a><span class="lineno"> 2897</span>&#160;   global_maxsilence = 0;</div><div class="line"><a name="l02898"></a><span class="lineno"> 2898</span>&#160;   global_saydurationminfo = 2;</div><div class="line"><a name="l02899"></a><span class="lineno"> 2899</span>&#160;   <a class="code" href="../../d6/d90/strings_8h.html#ac4040268f7b6ed77dfc49c7767626369">ast_copy_string</a>(default_vmformat, <span class="stringliteral">&quot;wav&quot;</span>, <span class="keyword">sizeof</span>(default_vmformat));</div><div class="line"><a name="l02900"></a><span class="lineno"> 2900</span>&#160;   <a class="code" href="../../d5/d60/utils_8h.html#a67b6713ff86cf82aaed821e9a87d1c21">ast_set2_flag</a>((&amp;globalflags), <a class="code" href="../../de/dfe/app__minivm_8c.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>, <a class="code" href="../../de/dfe/app__minivm_8c.html#a251b3dd38bf79c9b6d4fdc86ef63f0a8">MVM_REVIEW</a>);</div><div class="line"><a name="l02901"></a><span class="lineno"> 2901</span>&#160;   <a class="code" href="../../d5/d60/utils_8h.html#a67b6713ff86cf82aaed821e9a87d1c21">ast_set2_flag</a>((&amp;globalflags), <a class="code" href="../../de/dfe/app__minivm_8c.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>, <a class="code" href="../../de/dfe/app__minivm_8c.html#ac06da19dda21a4bac4970057bf72497a">MVM_OPERATOR</a>);</div><div class="line"><a name="l02902"></a><span class="lineno"> 2902</span>&#160;   <span class="comment">/* Reset statistics */</span></div><div class="line"><a name="l02903"></a><span class="lineno"> 2903</span>&#160;   memset(&amp;<a class="code" href="../../de/dfe/app__minivm_8c.html#afb3339bdf5d1db127a88fc3be1dbcb1c">global_stats</a>, 0, <span class="keyword">sizeof</span>(<a class="code" href="../../de/dfe/app__minivm_8c.html#afb3339bdf5d1db127a88fc3be1dbcb1c">global_stats</a>));</div><div class="line"><a name="l02904"></a><span class="lineno"> 2904</span>&#160;   <a class="code" href="../../de/dfe/app__minivm_8c.html#afb3339bdf5d1db127a88fc3be1dbcb1c">global_stats</a>.<a class="code" href="../../d6/dee/structminivm__stats.html#a739fde63c6d1cf2099ad3703aabb5433">reset</a> = <a class="code" href="../../de/df7/time_8h.html#ad3899efb6f0e348556ef69f5b16aa7f7">ast_tvnow</a>();</div><div class="line"><a name="l02905"></a><span class="lineno"> 2905</span>&#160;</div><div class="line"><a name="l02906"></a><span class="lineno"> 2906</span>&#160;   global_silencethreshold = <a class="code" href="../../d3/d08/dsp_8h.html#aab28c68838eaed4e0c89460a4e554cca">ast_dsp_get_threshold_from_settings</a>(<a class="code" href="../../d3/d08/dsp_8h.html#a11a8ce2b7eba2230cab37aad708d9abfa40278495f8621707b864e57e1110d20f">THRESHOLD_SILENCE</a>);</div><div class="line"><a name="l02907"></a><span class="lineno"> 2907</span>&#160;</div><div class="line"><a name="l02908"></a><span class="lineno"> 2908</span>&#160;   <span class="comment">/* Make sure we could load configuration file */</span></div><div class="line"><a name="l02909"></a><span class="lineno"> 2909</span>&#160;   <span class="keywordflow">if</span> (!cfg) {</div><div class="line"><a name="l02910"></a><span class="lineno"> 2910</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Failed to load configuration file. Module activated with default settings.\n&quot;</span>);</div><div class="line"><a name="l02911"></a><span class="lineno"> 2911</span>&#160;      <a class="code" href="../../dd/d42/lock_8h.html#a873f9ce8c6287a32d48c83133e124418">ast_mutex_unlock</a>(&amp;<a class="code" href="../../de/dfe/app__minivm_8c.html#ac50dec9d4a43a4e81ca2895e7ac7be2d">minivmlock</a>);</div><div class="line"><a name="l02912"></a><span class="lineno"> 2912</span>&#160;      <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l02913"></a><span class="lineno"> 2913</span>&#160;   }</div><div class="line"><a name="l02914"></a><span class="lineno"> 2914</span>&#160;</div><div class="line"><a name="l02915"></a><span class="lineno"> 2915</span>&#160;   <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(2, <span class="stringliteral">&quot;Loaded configuration file, now parsing\n&quot;</span>);</div><div class="line"><a name="l02916"></a><span class="lineno"> 2916</span>&#160;</div><div class="line"><a name="l02917"></a><span class="lineno"> 2917</span>&#160;   <span class="comment">/* General settings */</span></div><div class="line"><a name="l02918"></a><span class="lineno"> 2918</span>&#160;</div><div class="line"><a name="l02919"></a><span class="lineno"> 2919</span>&#160;   cat = <a class="code" href="../../d3/de6/include_2asterisk_2config_8h.html#a1e5e3d08eff5e2357e75c01e127e7922">ast_category_browse</a>(cfg, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div><div class="line"><a name="l02920"></a><span class="lineno"> 2920</span>&#160;   <span class="keywordflow">while</span> (cat) {</div><div class="line"><a name="l02921"></a><span class="lineno"> 2921</span>&#160;      <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(3, <span class="stringliteral">&quot;Found configuration section [%s]\n&quot;</span>, cat);</div><div class="line"><a name="l02922"></a><span class="lineno"> 2922</span>&#160;      <span class="keywordflow">if</span> (!strcasecmp(cat, <span class="stringliteral">&quot;general&quot;</span>)) {</div><div class="line"><a name="l02923"></a><span class="lineno"> 2923</span>&#160;         <span class="comment">/* Nothing right now */</span></div><div class="line"><a name="l02924"></a><span class="lineno"> 2924</span>&#160;         error += <a class="code" href="../../de/dfe/app__minivm_8c.html#a380fbb314d06d7a3e037975f2f65da50">apply_general_options</a>(<a class="code" href="../../d3/de6/include_2asterisk_2config_8h.html#aef636ed2f3d33f4c7a1ba67eb7c4d052">ast_variable_browse</a>(cfg, cat));</div><div class="line"><a name="l02925"></a><span class="lineno"> 2925</span>&#160;      } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strncasecmp(cat, <span class="stringliteral">&quot;template-&quot;</span>, 9))  {</div><div class="line"><a name="l02926"></a><span class="lineno"> 2926</span>&#160;         <span class="comment">/* Template */</span></div><div class="line"><a name="l02927"></a><span class="lineno"> 2927</span>&#160;         <span class="keywordtype">char</span> *<a class="code" href="../../d0/d29/cdr__mysql_8c.html#a0980a105ccb863d8008eb6201a51da52">name</a> = cat + 9;</div><div class="line"><a name="l02928"></a><span class="lineno"> 2928</span>&#160;</div><div class="line"><a name="l02929"></a><span class="lineno"> 2929</span>&#160;         <span class="comment">/* Now build and link template to list */</span></div><div class="line"><a name="l02930"></a><span class="lineno"> 2930</span>&#160;         error += <a class="code" href="../../de/dfe/app__minivm_8c.html#a8690b029ca446ef1d49c1b012d261759">message_template_build</a>(name, <a class="code" href="../../d3/de6/include_2asterisk_2config_8h.html#aef636ed2f3d33f4c7a1ba67eb7c4d052">ast_variable_browse</a>(cfg, cat));</div><div class="line"><a name="l02931"></a><span class="lineno"> 2931</span>&#160;      } <span class="keywordflow">else</span> {</div><div class="line"><a name="l02932"></a><span class="lineno"> 2932</span>&#160;         var = <a class="code" href="../../d3/de6/include_2asterisk_2config_8h.html#aef636ed2f3d33f4c7a1ba67eb7c4d052">ast_variable_browse</a>(cfg, cat);</div><div class="line"><a name="l02933"></a><span class="lineno"> 2933</span>&#160;         <span class="keywordflow">if</span> (!strcasecmp(cat, <span class="stringliteral">&quot;zonemessages&quot;</span>)) {</div><div class="line"><a name="l02934"></a><span class="lineno"> 2934</span>&#160;            <span class="comment">/* Timezones in this context */</span></div><div class="line"><a name="l02935"></a><span class="lineno"> 2935</span>&#160;            <span class="keywordflow">while</span> (var) {</div><div class="line"><a name="l02936"></a><span class="lineno"> 2936</span>&#160;               <a class="code" href="../../de/dfe/app__minivm_8c.html#a54c59989081dfa2f9fa311f8cdbb767d">timezone_add</a>(var-&gt;<a class="code" href="../../dd/d02/structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, var-&gt;<a class="code" href="../../dd/d02/structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>);</div><div class="line"><a name="l02937"></a><span class="lineno"> 2937</span>&#160;               var = var-&gt;<a class="code" href="../../dd/d02/structast__variable.html#afaaf66cc5029a563bd0bb9df076ea14b">next</a>;</div><div class="line"><a name="l02938"></a><span class="lineno"> 2938</span>&#160;            }</div><div class="line"><a name="l02939"></a><span class="lineno"> 2939</span>&#160;         } <span class="keywordflow">else</span> {</div><div class="line"><a name="l02940"></a><span class="lineno"> 2940</span>&#160;            <span class="comment">/* Create mailbox from this */</span></div><div class="line"><a name="l02941"></a><span class="lineno"> 2941</span>&#160;            error += <a class="code" href="../../de/dfe/app__minivm_8c.html#a0cb40730dc4102d3171993e6e479a09c">create_vmaccount</a>(cat, var, <a class="code" href="../../de/dfe/app__minivm_8c.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>);</div><div class="line"><a name="l02942"></a><span class="lineno"> 2942</span>&#160;         }</div><div class="line"><a name="l02943"></a><span class="lineno"> 2943</span>&#160;      }</div><div class="line"><a name="l02944"></a><span class="lineno"> 2944</span>&#160;      <span class="comment">/* Find next section in configuration file */</span></div><div class="line"><a name="l02945"></a><span class="lineno"> 2945</span>&#160;      cat = <a class="code" href="../../d3/de6/include_2asterisk_2config_8h.html#a1e5e3d08eff5e2357e75c01e127e7922">ast_category_browse</a>(cfg, cat);</div><div class="line"><a name="l02946"></a><span class="lineno"> 2946</span>&#160;   }</div><div class="line"><a name="l02947"></a><span class="lineno"> 2947</span>&#160;</div><div class="line"><a name="l02948"></a><span class="lineno"> 2948</span>&#160;   <span class="comment">/* Configure the default email template */</span></div><div class="line"><a name="l02949"></a><span class="lineno"> 2949</span>&#160;   <a class="code" href="../../de/dfe/app__minivm_8c.html#a8690b029ca446ef1d49c1b012d261759">message_template_build</a>(<span class="stringliteral">&quot;email-default&quot;</span>, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div><div class="line"><a name="l02950"></a><span class="lineno"> 2950</span>&#160;   <span class="keyword">template</span> = <a class="code" href="../../de/dfe/app__minivm_8c.html#a2ba33f7f6225ee09bff35cfde87c08d7">message_template_find</a>(<span class="stringliteral">&quot;email-default&quot;</span>);</div><div class="line"><a name="l02951"></a><span class="lineno"> 2951</span>&#160;</div><div class="line"><a name="l02952"></a><span class="lineno"> 2952</span>&#160;   <span class="comment">/* Load date format config for voicemail mail */</span></div><div class="line"><a name="l02953"></a><span class="lineno"> 2953</span>&#160;   <span class="keywordflow">if</span> ((chanvar = <a class="code" href="../../d3/de6/include_2asterisk_2config_8h.html#a9ff7aa27ae5f1a980bcf81f91cd6e470">ast_variable_retrieve</a>(cfg, <span class="stringliteral">&quot;general&quot;</span>, <span class="stringliteral">&quot;emaildateformat&quot;</span>)))</div><div class="line"><a name="l02954"></a><span class="lineno"> 2954</span>&#160;      <a class="code" href="../../d6/d90/strings_8h.html#ac4040268f7b6ed77dfc49c7767626369">ast_copy_string</a>(template-&gt;dateformat, chanvar, <span class="keyword">sizeof</span>(template-&gt;dateformat));</div><div class="line"><a name="l02955"></a><span class="lineno"> 2955</span>&#160;   <span class="keywordflow">if</span> ((chanvar = <a class="code" href="../../d3/de6/include_2asterisk_2config_8h.html#a9ff7aa27ae5f1a980bcf81f91cd6e470">ast_variable_retrieve</a>(cfg, <span class="stringliteral">&quot;general&quot;</span>, <span class="stringliteral">&quot;emailfromstring&quot;</span>)))</div><div class="line"><a name="l02956"></a><span class="lineno"> 2956</span>&#160;      <a class="code" href="../../d6/d90/strings_8h.html#ac4040268f7b6ed77dfc49c7767626369">ast_copy_string</a>(template-&gt;fromaddress, chanvar, <span class="keyword">sizeof</span>(template-&gt;fromaddress));</div><div class="line"><a name="l02957"></a><span class="lineno"> 2957</span>&#160;   <span class="keywordflow">if</span> ((chanvar = <a class="code" href="../../d3/de6/include_2asterisk_2config_8h.html#a9ff7aa27ae5f1a980bcf81f91cd6e470">ast_variable_retrieve</a>(cfg, <span class="stringliteral">&quot;general&quot;</span>, <span class="stringliteral">&quot;emailaaddress&quot;</span>)))</div><div class="line"><a name="l02958"></a><span class="lineno"> 2958</span>&#160;      <a class="code" href="../../d6/d90/strings_8h.html#ac4040268f7b6ed77dfc49c7767626369">ast_copy_string</a>(template-&gt;serveremail, chanvar, <span class="keyword">sizeof</span>(template-&gt;serveremail));</div><div class="line"><a name="l02959"></a><span class="lineno"> 2959</span>&#160;   <span class="keywordflow">if</span> ((chanvar = <a class="code" href="../../d3/de6/include_2asterisk_2config_8h.html#a9ff7aa27ae5f1a980bcf81f91cd6e470">ast_variable_retrieve</a>(cfg, <span class="stringliteral">&quot;general&quot;</span>, <span class="stringliteral">&quot;emailcharset&quot;</span>)))</div><div class="line"><a name="l02960"></a><span class="lineno"> 2960</span>&#160;      <a class="code" href="../../d6/d90/strings_8h.html#ac4040268f7b6ed77dfc49c7767626369">ast_copy_string</a>(template-&gt;charset, chanvar, <span class="keyword">sizeof</span>(template-&gt;charset));</div><div class="line"><a name="l02961"></a><span class="lineno"> 2961</span>&#160;   <span class="keywordflow">if</span> ((chanvar = <a class="code" href="../../d3/de6/include_2asterisk_2config_8h.html#a9ff7aa27ae5f1a980bcf81f91cd6e470">ast_variable_retrieve</a>(cfg, <span class="stringliteral">&quot;general&quot;</span>, <span class="stringliteral">&quot;emailsubject&quot;</span>)))</div><div class="line"><a name="l02962"></a><span class="lineno"> 2962</span>&#160;      <a class="code" href="../../d6/d90/strings_8h.html#ac4040268f7b6ed77dfc49c7767626369">ast_copy_string</a>(template-&gt;subject, chanvar, <span class="keyword">sizeof</span>(template-&gt;subject));</div><div class="line"><a name="l02963"></a><span class="lineno"> 2963</span>&#160;   <span class="keywordflow">if</span> ((chanvar = <a class="code" href="../../d3/de6/include_2asterisk_2config_8h.html#a9ff7aa27ae5f1a980bcf81f91cd6e470">ast_variable_retrieve</a>(cfg, <span class="stringliteral">&quot;general&quot;</span>, <span class="stringliteral">&quot;emailbody&quot;</span>)))</div><div class="line"><a name="l02964"></a><span class="lineno"> 2964</span>&#160;      <span class="keyword">template</span>-&gt;body = <a class="code" href="../../de/dfe/app__minivm_8c.html#a6d414e863f3534b892d3cd56fbb238f3">message_template_parse_emailbody</a>(chanvar);</div><div class="line"><a name="l02965"></a><span class="lineno"> 2965</span>&#160;   <span class="keyword">template</span>-&gt;attachment = <a class="code" href="../../de/dfe/app__minivm_8c.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;</div><div class="line"><a name="l02966"></a><span class="lineno"> 2966</span>&#160;</div><div class="line"><a name="l02967"></a><span class="lineno"> 2967</span>&#160;   <a class="code" href="../../de/dfe/app__minivm_8c.html#a8690b029ca446ef1d49c1b012d261759">message_template_build</a>(<span class="stringliteral">&quot;pager-default&quot;</span>, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div><div class="line"><a name="l02968"></a><span class="lineno"> 2968</span>&#160;   <span class="keyword">template</span> = <a class="code" href="../../de/dfe/app__minivm_8c.html#a2ba33f7f6225ee09bff35cfde87c08d7">message_template_find</a>(<span class="stringliteral">&quot;pager-default&quot;</span>);</div><div class="line"><a name="l02969"></a><span class="lineno"> 2969</span>&#160;   <span class="keywordflow">if</span> ((chanvar = <a class="code" href="../../d3/de6/include_2asterisk_2config_8h.html#a9ff7aa27ae5f1a980bcf81f91cd6e470">ast_variable_retrieve</a>(cfg, <span class="stringliteral">&quot;general&quot;</span>, <span class="stringliteral">&quot;pagerfromstring&quot;</span>)))</div><div class="line"><a name="l02970"></a><span class="lineno"> 2970</span>&#160;      <a class="code" href="../../d6/d90/strings_8h.html#ac4040268f7b6ed77dfc49c7767626369">ast_copy_string</a>(template-&gt;fromaddress, chanvar, <span class="keyword">sizeof</span>(template-&gt;fromaddress));</div><div class="line"><a name="l02971"></a><span class="lineno"> 2971</span>&#160;   <span class="keywordflow">if</span> ((chanvar = <a class="code" href="../../d3/de6/include_2asterisk_2config_8h.html#a9ff7aa27ae5f1a980bcf81f91cd6e470">ast_variable_retrieve</a>(cfg, <span class="stringliteral">&quot;general&quot;</span>, <span class="stringliteral">&quot;pageraddress&quot;</span>)))</div><div class="line"><a name="l02972"></a><span class="lineno"> 2972</span>&#160;      <a class="code" href="../../d6/d90/strings_8h.html#ac4040268f7b6ed77dfc49c7767626369">ast_copy_string</a>(template-&gt;serveremail, chanvar, <span class="keyword">sizeof</span>(template-&gt;serveremail));</div><div class="line"><a name="l02973"></a><span class="lineno"> 2973</span>&#160;   <span class="keywordflow">if</span> ((chanvar = <a class="code" href="../../d3/de6/include_2asterisk_2config_8h.html#a9ff7aa27ae5f1a980bcf81f91cd6e470">ast_variable_retrieve</a>(cfg, <span class="stringliteral">&quot;general&quot;</span>, <span class="stringliteral">&quot;pagercharset&quot;</span>)))</div><div class="line"><a name="l02974"></a><span class="lineno"> 2974</span>&#160;      <a class="code" href="../../d6/d90/strings_8h.html#ac4040268f7b6ed77dfc49c7767626369">ast_copy_string</a>(template-&gt;charset, chanvar, <span class="keyword">sizeof</span>(template-&gt;charset));</div><div class="line"><a name="l02975"></a><span class="lineno"> 2975</span>&#160;   <span class="keywordflow">if</span> ((chanvar = <a class="code" href="../../d3/de6/include_2asterisk_2config_8h.html#a9ff7aa27ae5f1a980bcf81f91cd6e470">ast_variable_retrieve</a>(cfg, <span class="stringliteral">&quot;general&quot;</span>, <span class="stringliteral">&quot;pagersubject&quot;</span>)))</div><div class="line"><a name="l02976"></a><span class="lineno"> 2976</span>&#160;      <a class="code" href="../../d6/d90/strings_8h.html#ac4040268f7b6ed77dfc49c7767626369">ast_copy_string</a>(template-&gt;subject, chanvar,<span class="keyword">sizeof</span>(template-&gt;subject));</div><div class="line"><a name="l02977"></a><span class="lineno"> 2977</span>&#160;   <span class="keywordflow">if</span> ((chanvar = <a class="code" href="../../d3/de6/include_2asterisk_2config_8h.html#a9ff7aa27ae5f1a980bcf81f91cd6e470">ast_variable_retrieve</a>(cfg, <span class="stringliteral">&quot;general&quot;</span>, <span class="stringliteral">&quot;pagerbody&quot;</span>)))</div><div class="line"><a name="l02978"></a><span class="lineno"> 2978</span>&#160;      <span class="keyword">template</span>-&gt;body = <a class="code" href="../../de/dfe/app__minivm_8c.html#a6d414e863f3534b892d3cd56fbb238f3">message_template_parse_emailbody</a>(chanvar);</div><div class="line"><a name="l02979"></a><span class="lineno"> 2979</span>&#160;   <span class="keyword">template</span>-&gt;attachment = <a class="code" href="../../de/dfe/app__minivm_8c.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;</div><div class="line"><a name="l02980"></a><span class="lineno"> 2980</span>&#160;</div><div class="line"><a name="l02981"></a><span class="lineno"> 2981</span>&#160;   <span class="keywordflow">if</span> (error)</div><div class="line"><a name="l02982"></a><span class="lineno"> 2982</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;--- A total of %d errors found in mini-voicemail configuration\n&quot;</span>, error);</div><div class="line"><a name="l02983"></a><span class="lineno"> 2983</span>&#160;</div><div class="line"><a name="l02984"></a><span class="lineno"> 2984</span>&#160;   <a class="code" href="../../dd/d42/lock_8h.html#a873f9ce8c6287a32d48c83133e124418">ast_mutex_unlock</a>(&amp;<a class="code" href="../../de/dfe/app__minivm_8c.html#ac50dec9d4a43a4e81ca2895e7ac7be2d">minivmlock</a>);</div><div class="line"><a name="l02985"></a><span class="lineno"> 2985</span>&#160;   <a class="code" href="../../d3/de6/include_2asterisk_2config_8h.html#a6b4d4d929013de7812fbba4e58353078">ast_config_destroy</a>(cfg);</div><div class="line"><a name="l02986"></a><span class="lineno"> 2986</span>&#160;</div><div class="line"><a name="l02987"></a><span class="lineno"> 2987</span>&#160;   <span class="comment">/* Close log file if it&#39;s open and disabled */</span></div><div class="line"><a name="l02988"></a><span class="lineno"> 2988</span>&#160;   <span class="keywordflow">if</span>(minivmlogfile)</div><div class="line"><a name="l02989"></a><span class="lineno"> 2989</span>&#160;      fclose(minivmlogfile);</div><div class="line"><a name="l02990"></a><span class="lineno"> 2990</span>&#160;</div><div class="line"><a name="l02991"></a><span class="lineno"> 2991</span>&#160;   <span class="comment">/* Open log file if it&#39;s enabled */</span></div><div class="line"><a name="l02992"></a><span class="lineno"> 2992</span>&#160;   <span class="keywordflow">if</span>(!<a class="code" href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a>(global_logfile)) {</div><div class="line"><a name="l02993"></a><span class="lineno"> 2993</span>&#160;      minivmlogfile = fopen(global_logfile, <span class="stringliteral">&quot;a&quot;</span>);</div><div class="line"><a name="l02994"></a><span class="lineno"> 2994</span>&#160;      <span class="keywordflow">if</span>(!minivmlogfile)</div><div class="line"><a name="l02995"></a><span class="lineno"> 2995</span>&#160;         <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Failed to open minivm log file %s : %s\n&quot;</span>, global_logfile, strerror(<a class="code" href="../../d1/d6e/main_2stdtime_2private_8h.html#ad65a8842cc674e3ddf69355898c0ecbf">errno</a>));</div><div class="line"><a name="l02996"></a><span class="lineno"> 2996</span>&#160;      <span class="keywordflow">if</span> (minivmlogfile)</div><div class="line"><a name="l02997"></a><span class="lineno"> 2997</span>&#160;         <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(3, <span class="stringliteral">&quot;Opened log file %s \n&quot;</span>, global_logfile);</div><div class="line"><a name="l02998"></a><span class="lineno"> 2998</span>&#160;   }</div><div class="line"><a name="l02999"></a><span class="lineno"> 2999</span>&#160;</div><div class="line"><a name="l03000"></a><span class="lineno"> 3000</span>&#160;   <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l03001"></a><span class="lineno"> 3001</span>&#160;}</div><div class="line"><a name="l03002"></a><span class="lineno"> 3002</span>&#160;<span class="comment"></span></div><div class="line"><a name="l03003"></a><span class="lineno"> 3003</span>&#160;<span class="comment">/*! \brief CLI routine for listing templates */</span></div><div class="line"><a name="l03004"></a><span class="lineno"><a class="line" href="../../de/dfe/app__minivm_8c.html#a6d1e86507023ca3f6dd4ad1dfb4ff96e"> 3004</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">char</span> *<a class="code" href="../../de/dfe/app__minivm_8c.html#a6d1e86507023ca3f6dd4ad1dfb4ff96e">handle_minivm_list_templates</a>(<span class="keyword">struct</span> <a class="code" href="../../d8/d07/structast__cli__entry.html">ast_cli_entry</a> *e, <span class="keywordtype">int</span> cmd, <span class="keyword">struct</span> <a class="code" href="../../d3/dad/structast__cli__args.html">ast_cli_args</a> *<a class="code" href="../../d7/d6f/test__linkedlists_8c.html#a13dd15487fee89a002d17ef3aff62d02">a</a>)</div><div class="line"><a name="l03005"></a><span class="lineno"> 3005</span>&#160;{</div><div class="line"><a name="l03006"></a><span class="lineno"> 3006</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../dc/d31/structminivm__template.html">minivm_template</a> *<span class="keyword">this</span>;</div><div class="line"><a name="l03007"></a><span class="lineno"> 3007</span>&#160;<span class="preprocessor">#define HVLT_OUTPUT_FORMAT &quot;%-15s %-10s %-10s %-15.15s %-50s\n&quot;</span></div><div class="line"><a name="l03008"></a><span class="lineno"> 3008</span>&#160;   <span class="keywordtype">int</span> count = 0;</div><div class="line"><a name="l03009"></a><span class="lineno"> 3009</span>&#160;</div><div class="line"><a name="l03010"></a><span class="lineno"> 3010</span>&#160;   <span class="keywordflow">switch</span> (cmd) {</div><div class="line"><a name="l03011"></a><span class="lineno"> 3011</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="../../dc/db0/cli_8h.html#ab33e5350a923c3a8cedbeb496cd88ec9a71745eb63dd093f560a1add3e430d2a9">CLI_INIT</a>:</div><div class="line"><a name="l03012"></a><span class="lineno"> 3012</span>&#160;      e-&gt;<a class="code" href="../../d8/d07/structast__cli__entry.html#ade9cba72805fe52685a1deea307a8e82">command</a> = <span class="stringliteral">&quot;minivm list templates&quot;</span>;</div><div class="line"><a name="l03013"></a><span class="lineno"> 3013</span>&#160;      e-&gt;<a class="code" href="../../d8/d07/structast__cli__entry.html#aef1bd6ad890a110b466cb0e8088507a2">usage</a> =</div><div class="line"><a name="l03014"></a><span class="lineno"> 3014</span>&#160;         <span class="stringliteral">&quot;Usage: minivm list templates\n&quot;</span></div><div class="line"><a name="l03015"></a><span class="lineno"> 3015</span>&#160;         <span class="stringliteral">&quot;       Lists message templates for e-mail, paging and IM\n&quot;</span>;</div><div class="line"><a name="l03016"></a><span class="lineno"> 3016</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l03017"></a><span class="lineno"> 3017</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="../../dc/db0/cli_8h.html#ab33e5350a923c3a8cedbeb496cd88ec9a76bf33139279b03ec1691f2be2d1be40">CLI_GENERATE</a>:</div><div class="line"><a name="l03018"></a><span class="lineno"> 3018</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l03019"></a><span class="lineno"> 3019</span>&#160;   }</div><div class="line"><a name="l03020"></a><span class="lineno"> 3020</span>&#160;</div><div class="line"><a name="l03021"></a><span class="lineno"> 3021</span>&#160;   <span class="keywordflow">if</span> (a-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#a98e1d8441ca58834f11f7367be4b3345">argc</a> &gt; 3)</div><div class="line"><a name="l03022"></a><span class="lineno"> 3022</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/db0/cli_8h.html#a0873456096960dab21fff0ce68c95acb">CLI_SHOWUSAGE</a>;</div><div class="line"><a name="l03023"></a><span class="lineno"> 3023</span>&#160;</div><div class="line"><a name="l03024"></a><span class="lineno"> 3024</span>&#160;   <a class="code" href="../../df/d90/linkedlists_8h.html#a9140a4e4d781264fa9469c52b1adae40">AST_LIST_LOCK</a>(&amp;<a class="code" href="../../d1/dd2/structmessage__templates.html">message_templates</a>);</div><div class="line"><a name="l03025"></a><span class="lineno"> 3025</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../df/d90/linkedlists_8h.html#a4a1884cde93e53bef32ca85c194a1d05">AST_LIST_EMPTY</a>(&amp;<a class="code" href="../../d1/dd2/structmessage__templates.html">message_templates</a>)) {</div><div class="line"><a name="l03026"></a><span class="lineno"> 3026</span>&#160;      <a class="code" href="../../dc/db0/cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#acf64f219885421479997667d2ed3f08a">fd</a>, <span class="stringliteral">&quot;There are no message templates defined\n&quot;</span>);</div><div class="line"><a name="l03027"></a><span class="lineno"> 3027</span>&#160;      <a class="code" href="../../df/d90/linkedlists_8h.html#ab48cb9e1e612dd486b747ba1c5d68d01">AST_LIST_UNLOCK</a>(&amp;<a class="code" href="../../d1/dd2/structmessage__templates.html">message_templates</a>);</div><div class="line"><a name="l03028"></a><span class="lineno"> 3028</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/db0/cli_8h.html#ae47751901c430ebb833e59291a5e0b3f">CLI_FAILURE</a>;</div><div class="line"><a name="l03029"></a><span class="lineno"> 3029</span>&#160;   }</div><div class="line"><a name="l03030"></a><span class="lineno"> 3030</span>&#160;   <a class="code" href="../../dc/db0/cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#acf64f219885421479997667d2ed3f08a">fd</a>, <a class="code" href="../../de/dfe/app__minivm_8c.html#a7f32248ee8cfb732460df9a4656688b2">HVLT_OUTPUT_FORMAT</a>, <span class="stringliteral">&quot;Template name&quot;</span>, <span class="stringliteral">&quot;Charset&quot;</span>, <span class="stringliteral">&quot;Locale&quot;</span>, <span class="stringliteral">&quot;Attach media&quot;</span>, <span class="stringliteral">&quot;Subject&quot;</span>);</div><div class="line"><a name="l03031"></a><span class="lineno"> 3031</span>&#160;   <a class="code" href="../../dc/db0/cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#acf64f219885421479997667d2ed3f08a">fd</a>, <a class="code" href="../../de/dfe/app__minivm_8c.html#a7f32248ee8cfb732460df9a4656688b2">HVLT_OUTPUT_FORMAT</a>, <span class="stringliteral">&quot;-------------&quot;</span>, <span class="stringliteral">&quot;-------&quot;</span>, <span class="stringliteral">&quot;------&quot;</span>, <span class="stringliteral">&quot;------------&quot;</span>, <span class="stringliteral">&quot;-------&quot;</span>);</div><div class="line"><a name="l03032"></a><span class="lineno"> 3032</span>&#160;   <a class="code" href="../../df/d90/linkedlists_8h.html#a3008b2f4f236b72d8bcfb80e346324ef">AST_LIST_TRAVERSE</a>(&amp;<a class="code" href="../../d1/dd2/structmessage__templates.html">message_templates</a>, <span class="keyword">this</span>, <a class="code" href="../../dc/d7b/structminivm__account.html#a571e7afb397f412b54fd1f776dab778f">list</a>) {</div><div class="line"><a name="l03033"></a><span class="lineno"> 3033</span>&#160;      <a class="code" href="../../dc/db0/cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#acf64f219885421479997667d2ed3f08a">fd</a>, <a class="code" href="../../de/dfe/app__minivm_8c.html#a7f32248ee8cfb732460df9a4656688b2">HVLT_OUTPUT_FORMAT</a>, this-&gt;name,</div><div class="line"><a name="l03034"></a><span class="lineno"> 3034</span>&#160;         <a class="code" href="../../d6/d90/strings_8h.html#a2faaa16929951bfd2802b7829a100ba2">S_OR</a>(this-&gt;<a class="code" href="../../d1/d6d/chan__unistim_8c.html#a8bd4accafd4e712317ed9a471738a971">charset</a>, <span class="stringliteral">&quot;-&quot;</span>),</div><div class="line"><a name="l03035"></a><span class="lineno"> 3035</span>&#160;         <a class="code" href="../../d6/d90/strings_8h.html#a2faaa16929951bfd2802b7829a100ba2">S_OR</a>(this-&gt;<a class="code" href="../../dc/df4/app__voicemail_8c.html#ad4786cc0738d237b7697e5448da7d22e">locale</a>, <span class="stringliteral">&quot;-&quot;</span>),</div><div class="line"><a name="l03036"></a><span class="lineno"> 3036</span>&#160;         this-&gt;attachment ? <span class="stringliteral">&quot;Yes&quot;</span> : <span class="stringliteral">&quot;No&quot;</span>,</div><div class="line"><a name="l03037"></a><span class="lineno"> 3037</span>&#160;         <a class="code" href="../../d6/d90/strings_8h.html#a2faaa16929951bfd2802b7829a100ba2">S_OR</a>(this-&gt;subject, <span class="stringliteral">&quot;-&quot;</span>));</div><div class="line"><a name="l03038"></a><span class="lineno"> 3038</span>&#160;      count++;</div><div class="line"><a name="l03039"></a><span class="lineno"> 3039</span>&#160;   }</div><div class="line"><a name="l03040"></a><span class="lineno"> 3040</span>&#160;   <a class="code" href="../../df/d90/linkedlists_8h.html#ab48cb9e1e612dd486b747ba1c5d68d01">AST_LIST_UNLOCK</a>(&amp;<a class="code" href="../../d1/dd2/structmessage__templates.html">message_templates</a>);</div><div class="line"><a name="l03041"></a><span class="lineno"> 3041</span>&#160;   <a class="code" href="../../dc/db0/cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#acf64f219885421479997667d2ed3f08a">fd</a>, <span class="stringliteral">&quot;\n * Total: %d minivoicemail message templates\n&quot;</span>, count);</div><div class="line"><a name="l03042"></a><span class="lineno"> 3042</span>&#160;   <span class="keywordflow">return</span> <a class="code" href="../../dc/db0/cli_8h.html#a50989f00b32eeb2516a3803cb2ffb766">CLI_SUCCESS</a>;</div><div class="line"><a name="l03043"></a><span class="lineno"> 3043</span>&#160;}</div><div class="line"><a name="l03044"></a><span class="lineno"> 3044</span>&#160;</div><div class="line"><a name="l03045"></a><span class="lineno"><a class="line" href="../../de/dfe/app__minivm_8c.html#a570bd183017b9d995580f6b56b4b2c8f"> 3045</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">char</span> *<a class="code" href="../../de/dfe/app__minivm_8c.html#a570bd183017b9d995580f6b56b4b2c8f">complete_minivm_show_users</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *line, <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="../../d6/da0/codecs_2gsm_2inc_2private_8h.html#a0b023cbb2bf7d034c2269d58d7455ac8">word</a>, <span class="keywordtype">int</span> pos, <span class="keywordtype">int</span> <a class="code" href="../../d4/d88/structstate.html">state</a>)</div><div class="line"><a name="l03046"></a><span class="lineno"> 3046</span>&#160;{</div><div class="line"><a name="l03047"></a><span class="lineno"> 3047</span>&#160;   <span class="keywordtype">int</span> which = 0;</div><div class="line"><a name="l03048"></a><span class="lineno"> 3048</span>&#160;   <span class="keywordtype">int</span> wordlen;</div><div class="line"><a name="l03049"></a><span class="lineno"> 3049</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../dc/d7b/structminivm__account.html">minivm_account</a> *vmu;</div><div class="line"><a name="l03050"></a><span class="lineno"> 3050</span>&#160;   <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="../../dd/dac/structdomain.html">domain</a> = <span class="stringliteral">&quot;&quot;</span>;</div><div class="line"><a name="l03051"></a><span class="lineno"> 3051</span>&#160;</div><div class="line"><a name="l03052"></a><span class="lineno"> 3052</span>&#160;   <span class="comment">/* 0 - minivm; 1 - list; 2 - accounts; 3 - for; 4 - &lt;domain&gt; */</span></div><div class="line"><a name="l03053"></a><span class="lineno"> 3053</span>&#160;   <span class="keywordflow">if</span> (pos &gt; 4)</div><div class="line"><a name="l03054"></a><span class="lineno"> 3054</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l03055"></a><span class="lineno"> 3055</span>&#160;   wordlen = strlen(word);</div><div class="line"><a name="l03056"></a><span class="lineno"> 3056</span>&#160;   <a class="code" href="../../df/d90/linkedlists_8h.html#a3008b2f4f236b72d8bcfb80e346324ef">AST_LIST_TRAVERSE</a>(&amp;<a class="code" href="../../d2/d1d/structminivm__accounts.html">minivm_accounts</a>, vmu, <a class="code" href="../../dc/d7b/structminivm__account.html#a571e7afb397f412b54fd1f776dab778f">list</a>) {</div><div class="line"><a name="l03057"></a><span class="lineno"> 3057</span>&#160;      <span class="keywordflow">if</span> (!strncasecmp(word, vmu-&gt;<a class="code" href="../../dc/d7b/structminivm__account.html#ae43ea5d0335f149f0920d33e46b61c33">domain</a>, wordlen)) {</div><div class="line"><a name="l03058"></a><span class="lineno"> 3058</span>&#160;         <span class="keywordflow">if</span> (domain &amp;&amp; strcmp(domain, vmu-&gt;<a class="code" href="../../dc/d7b/structminivm__account.html#ae43ea5d0335f149f0920d33e46b61c33">domain</a>) &amp;&amp; ++which &gt; state)</div><div class="line"><a name="l03059"></a><span class="lineno"> 3059</span>&#160;            <span class="keywordflow">return</span> <a class="code" href="../../d8/d8a/astmm_8h.html#ab263849d03fb892847be4986db759737">ast_strdup</a>(vmu-&gt;<a class="code" href="../../dc/d7b/structminivm__account.html#ae43ea5d0335f149f0920d33e46b61c33">domain</a>);</div><div class="line"><a name="l03060"></a><span class="lineno"> 3060</span>&#160;         <span class="comment">/* ignore repeated domains ? */</span></div><div class="line"><a name="l03061"></a><span class="lineno"> 3061</span>&#160;         domain = vmu-&gt;<a class="code" href="../../dc/d7b/structminivm__account.html#ae43ea5d0335f149f0920d33e46b61c33">domain</a>;</div><div class="line"><a name="l03062"></a><span class="lineno"> 3062</span>&#160;      }</div><div class="line"><a name="l03063"></a><span class="lineno"> 3063</span>&#160;   }</div><div class="line"><a name="l03064"></a><span class="lineno"> 3064</span>&#160;   <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l03065"></a><span class="lineno"> 3065</span>&#160;}</div><div class="line"><a name="l03066"></a><span class="lineno"> 3066</span>&#160;<span class="comment"></span></div><div class="line"><a name="l03067"></a><span class="lineno"> 3067</span>&#160;<span class="comment">/*! \brief CLI command to list voicemail accounts */</span></div><div class="line"><a name="l03068"></a><span class="lineno"><a class="line" href="../../de/dfe/app__minivm_8c.html#a0146ffac26c0f9881220edd88adcdc0a"> 3068</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">char</span> *<a class="code" href="../../de/dfe/app__minivm_8c.html#a0146ffac26c0f9881220edd88adcdc0a">handle_minivm_show_users</a>(<span class="keyword">struct</span> <a class="code" href="../../d8/d07/structast__cli__entry.html">ast_cli_entry</a> *e, <span class="keywordtype">int</span> cmd, <span class="keyword">struct</span> <a class="code" href="../../d3/dad/structast__cli__args.html">ast_cli_args</a> *<a class="code" href="../../d7/d6f/test__linkedlists_8c.html#a13dd15487fee89a002d17ef3aff62d02">a</a>)</div><div class="line"><a name="l03069"></a><span class="lineno"> 3069</span>&#160;{</div><div class="line"><a name="l03070"></a><span class="lineno"> 3070</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../dc/d7b/structminivm__account.html">minivm_account</a> *vmu;</div><div class="line"><a name="l03071"></a><span class="lineno"> 3071</span>&#160;<span class="preprocessor">#define HMSU_OUTPUT_FORMAT &quot;%-23s %-15s %-15s %-10s %-10s %-50s\n&quot;</span></div><div class="line"><a name="l03072"></a><span class="lineno"> 3072</span>&#160;   <span class="keywordtype">int</span> count = 0;</div><div class="line"><a name="l03073"></a><span class="lineno"> 3073</span>&#160;</div><div class="line"><a name="l03074"></a><span class="lineno"> 3074</span>&#160;   <span class="keywordflow">switch</span> (cmd) {</div><div class="line"><a name="l03075"></a><span class="lineno"> 3075</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="../../dc/db0/cli_8h.html#ab33e5350a923c3a8cedbeb496cd88ec9a71745eb63dd093f560a1add3e430d2a9">CLI_INIT</a>:</div><div class="line"><a name="l03076"></a><span class="lineno"> 3076</span>&#160;      e-&gt;<a class="code" href="../../d8/d07/structast__cli__entry.html#ade9cba72805fe52685a1deea307a8e82">command</a> = <span class="stringliteral">&quot;minivm list accounts [for]&quot;</span>;</div><div class="line"><a name="l03077"></a><span class="lineno"> 3077</span>&#160;      e-&gt;<a class="code" href="../../d8/d07/structast__cli__entry.html#aef1bd6ad890a110b466cb0e8088507a2">usage</a> =</div><div class="line"><a name="l03078"></a><span class="lineno"> 3078</span>&#160;         <span class="stringliteral">&quot;Usage: minivm list accounts [for &lt;domain&gt;]\n&quot;</span></div><div class="line"><a name="l03079"></a><span class="lineno"> 3079</span>&#160;         <span class="stringliteral">&quot;       Lists all mailboxes currently set up\n&quot;</span>;</div><div class="line"><a name="l03080"></a><span class="lineno"> 3080</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l03081"></a><span class="lineno"> 3081</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="../../dc/db0/cli_8h.html#ab33e5350a923c3a8cedbeb496cd88ec9a76bf33139279b03ec1691f2be2d1be40">CLI_GENERATE</a>:</div><div class="line"><a name="l03082"></a><span class="lineno"> 3082</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../de/dfe/app__minivm_8c.html#a570bd183017b9d995580f6b56b4b2c8f">complete_minivm_show_users</a>(a-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#a2a7a1aa13a4f14075411123a4495593c">line</a>, a-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#adc1f34651f7bbfa3ba5af27db5f53817">word</a>, a-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#a4b911d12699acbbb5a8b62355b35bae8">pos</a>, a-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#acfc02ec89670db29251fda6a66602ce2">n</a>);</div><div class="line"><a name="l03083"></a><span class="lineno"> 3083</span>&#160;   }</div><div class="line"><a name="l03084"></a><span class="lineno"> 3084</span>&#160;</div><div class="line"><a name="l03085"></a><span class="lineno"> 3085</span>&#160;   <span class="keywordflow">if</span> ((a-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#a98e1d8441ca58834f11f7367be4b3345">argc</a> &lt; 3) || (a-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#a98e1d8441ca58834f11f7367be4b3345">argc</a> &gt; 5) || (a-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#a98e1d8441ca58834f11f7367be4b3345">argc</a> == 4))</div><div class="line"><a name="l03086"></a><span class="lineno"> 3086</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/db0/cli_8h.html#a0873456096960dab21fff0ce68c95acb">CLI_SHOWUSAGE</a>;</div><div class="line"><a name="l03087"></a><span class="lineno"> 3087</span>&#160;   <span class="keywordflow">if</span> ((a-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#a98e1d8441ca58834f11f7367be4b3345">argc</a> == 5) &amp;&amp; strcmp(a-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#ad0a19c4d63698f9e9cfd5653e8851452">argv</a>[3],<span class="stringliteral">&quot;for&quot;</span>))</div><div class="line"><a name="l03088"></a><span class="lineno"> 3088</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/db0/cli_8h.html#a0873456096960dab21fff0ce68c95acb">CLI_SHOWUSAGE</a>;</div><div class="line"><a name="l03089"></a><span class="lineno"> 3089</span>&#160;</div><div class="line"><a name="l03090"></a><span class="lineno"> 3090</span>&#160;   <a class="code" href="../../df/d90/linkedlists_8h.html#a9140a4e4d781264fa9469c52b1adae40">AST_LIST_LOCK</a>(&amp;<a class="code" href="../../d2/d1d/structminivm__accounts.html">minivm_accounts</a>);</div><div class="line"><a name="l03091"></a><span class="lineno"> 3091</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../df/d90/linkedlists_8h.html#a4a1884cde93e53bef32ca85c194a1d05">AST_LIST_EMPTY</a>(&amp;<a class="code" href="../../d2/d1d/structminivm__accounts.html">minivm_accounts</a>)) {</div><div class="line"><a name="l03092"></a><span class="lineno"> 3092</span>&#160;      <a class="code" href="../../dc/db0/cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#acf64f219885421479997667d2ed3f08a">fd</a>, <span class="stringliteral">&quot;There are no voicemail users currently defined\n&quot;</span>);</div><div class="line"><a name="l03093"></a><span class="lineno"> 3093</span>&#160;      <a class="code" href="../../df/d90/linkedlists_8h.html#ab48cb9e1e612dd486b747ba1c5d68d01">AST_LIST_UNLOCK</a>(&amp;<a class="code" href="../../d2/d1d/structminivm__accounts.html">minivm_accounts</a>);</div><div class="line"><a name="l03094"></a><span class="lineno"> 3094</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/db0/cli_8h.html#ae47751901c430ebb833e59291a5e0b3f">CLI_FAILURE</a>;</div><div class="line"><a name="l03095"></a><span class="lineno"> 3095</span>&#160;   }</div><div class="line"><a name="l03096"></a><span class="lineno"> 3096</span>&#160;   <a class="code" href="../../dc/db0/cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#acf64f219885421479997667d2ed3f08a">fd</a>, <a class="code" href="../../de/dfe/app__minivm_8c.html#a20788f21f34287a8ac8a96a8c9cec8e4">HMSU_OUTPUT_FORMAT</a>, <span class="stringliteral">&quot;User&quot;</span>, <span class="stringliteral">&quot;E-Template&quot;</span>, <span class="stringliteral">&quot;P-template&quot;</span>, <span class="stringliteral">&quot;Zone&quot;</span>, <span class="stringliteral">&quot;Format&quot;</span>, <span class="stringliteral">&quot;Full name&quot;</span>);</div><div class="line"><a name="l03097"></a><span class="lineno"> 3097</span>&#160;   <a class="code" href="../../dc/db0/cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#acf64f219885421479997667d2ed3f08a">fd</a>, <a class="code" href="../../de/dfe/app__minivm_8c.html#a20788f21f34287a8ac8a96a8c9cec8e4">HMSU_OUTPUT_FORMAT</a>, <span class="stringliteral">&quot;----&quot;</span>, <span class="stringliteral">&quot;----------&quot;</span>, <span class="stringliteral">&quot;----------&quot;</span>, <span class="stringliteral">&quot;----&quot;</span>, <span class="stringliteral">&quot;------&quot;</span>, <span class="stringliteral">&quot;---------&quot;</span>);</div><div class="line"><a name="l03098"></a><span class="lineno"> 3098</span>&#160;   <a class="code" href="../../df/d90/linkedlists_8h.html#a3008b2f4f236b72d8bcfb80e346324ef">AST_LIST_TRAVERSE</a>(&amp;<a class="code" href="../../d2/d1d/structminivm__accounts.html">minivm_accounts</a>, vmu, <a class="code" href="../../dc/d7b/structminivm__account.html#a571e7afb397f412b54fd1f776dab778f">list</a>) {</div><div class="line"><a name="l03099"></a><span class="lineno"> 3099</span>&#160;      <span class="keywordtype">char</span> <a class="code" href="../../de/d1e/bt__open_8c.html#a1cdd2bb1a9a71d3e1120100229315d67">tmp</a>[256] = <span class="stringliteral">&quot;&quot;</span>;</div><div class="line"><a name="l03100"></a><span class="lineno"> 3100</span>&#160;      <span class="keywordflow">if</span> ((a-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#a98e1d8441ca58834f11f7367be4b3345">argc</a> == 3) || ((a-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#a98e1d8441ca58834f11f7367be4b3345">argc</a> == 5) &amp;&amp; !strcmp(a-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#ad0a19c4d63698f9e9cfd5653e8851452">argv</a>[4], vmu-&gt;<a class="code" href="../../dc/d7b/structminivm__account.html#ae43ea5d0335f149f0920d33e46b61c33">domain</a>))) {</div><div class="line"><a name="l03101"></a><span class="lineno"> 3101</span>&#160;         count++;</div><div class="line"><a name="l03102"></a><span class="lineno"> 3102</span>&#160;         snprintf(tmp, <span class="keyword">sizeof</span>(tmp), <span class="stringliteral">&quot;%s@%s&quot;</span>, vmu-&gt;<a class="code" href="../../dc/d7b/structminivm__account.html#a4b30874d24514b5ef6ff5276e8c12ed4">username</a>, vmu-&gt;<a class="code" href="../../dc/d7b/structminivm__account.html#ae43ea5d0335f149f0920d33e46b61c33">domain</a>);</div><div class="line"><a name="l03103"></a><span class="lineno"> 3103</span>&#160;         <a class="code" href="../../dc/db0/cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#acf64f219885421479997667d2ed3f08a">fd</a>, <a class="code" href="../../de/dfe/app__minivm_8c.html#a20788f21f34287a8ac8a96a8c9cec8e4">HMSU_OUTPUT_FORMAT</a>, tmp, <a class="code" href="../../d6/d90/strings_8h.html#a2faaa16929951bfd2802b7829a100ba2">S_OR</a>(vmu-&gt;<a class="code" href="../../dc/d7b/structminivm__account.html#ad48036454496b4bfb945139d1ae878c4">etemplate</a>, <span class="stringliteral">&quot;-&quot;</span>),</div><div class="line"><a name="l03104"></a><span class="lineno"> 3104</span>&#160;            <a class="code" href="../../d6/d90/strings_8h.html#a2faaa16929951bfd2802b7829a100ba2">S_OR</a>(vmu-&gt;<a class="code" href="../../dc/d7b/structminivm__account.html#a6e9b30710047deee4fb3e4f38c8e7cc2">ptemplate</a>, <span class="stringliteral">&quot;-&quot;</span>),</div><div class="line"><a name="l03105"></a><span class="lineno"> 3105</span>&#160;            <a class="code" href="../../d6/d90/strings_8h.html#a2faaa16929951bfd2802b7829a100ba2">S_OR</a>(vmu-&gt;<a class="code" href="../../dc/d7b/structminivm__account.html#a4a081db7653645ce9fce8fd72e5a7bf1">zonetag</a>, <span class="stringliteral">&quot;-&quot;</span>),</div><div class="line"><a name="l03106"></a><span class="lineno"> 3106</span>&#160;            <a class="code" href="../../d6/d90/strings_8h.html#a2faaa16929951bfd2802b7829a100ba2">S_OR</a>(vmu-&gt;<a class="code" href="../../dc/d7b/structminivm__account.html#ae80eeef848853cf42dc025b36f0de488">attachfmt</a>, <span class="stringliteral">&quot;-&quot;</span>),</div><div class="line"><a name="l03107"></a><span class="lineno"> 3107</span>&#160;            vmu-&gt;<a class="code" href="../../dc/d7b/structminivm__account.html#ab5845627664c59054dd8e5f01829d4f3">fullname</a>);</div><div class="line"><a name="l03108"></a><span class="lineno"> 3108</span>&#160;      }</div><div class="line"><a name="l03109"></a><span class="lineno"> 3109</span>&#160;   }</div><div class="line"><a name="l03110"></a><span class="lineno"> 3110</span>&#160;   <a class="code" href="../../df/d90/linkedlists_8h.html#ab48cb9e1e612dd486b747ba1c5d68d01">AST_LIST_UNLOCK</a>(&amp;<a class="code" href="../../d2/d1d/structminivm__accounts.html">minivm_accounts</a>);</div><div class="line"><a name="l03111"></a><span class="lineno"> 3111</span>&#160;   <a class="code" href="../../dc/db0/cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#acf64f219885421479997667d2ed3f08a">fd</a>, <span class="stringliteral">&quot;\n * Total: %d minivoicemail accounts\n&quot;</span>, count);</div><div class="line"><a name="l03112"></a><span class="lineno"> 3112</span>&#160;   <span class="keywordflow">return</span> <a class="code" href="../../dc/db0/cli_8h.html#a50989f00b32eeb2516a3803cb2ffb766">CLI_SUCCESS</a>;</div><div class="line"><a name="l03113"></a><span class="lineno"> 3113</span>&#160;}</div><div class="line"><a name="l03114"></a><span class="lineno"> 3114</span>&#160;<span class="comment"></span></div><div class="line"><a name="l03115"></a><span class="lineno"> 3115</span>&#160;<span class="comment">/*! \brief Show a list of voicemail zones in the CLI */</span></div><div class="line"><a name="l03116"></a><span class="lineno"><a class="line" href="../../de/dfe/app__minivm_8c.html#a9e4e37c5e52de40a691334edf1f7d759"> 3116</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">char</span> *<a class="code" href="../../de/dfe/app__minivm_8c.html#a9e4e37c5e52de40a691334edf1f7d759">handle_minivm_show_zones</a>(<span class="keyword">struct</span> <a class="code" href="../../d8/d07/structast__cli__entry.html">ast_cli_entry</a> *e, <span class="keywordtype">int</span> cmd, <span class="keyword">struct</span> <a class="code" href="../../d3/dad/structast__cli__args.html">ast_cli_args</a> *<a class="code" href="../../d7/d6f/test__linkedlists_8c.html#a13dd15487fee89a002d17ef3aff62d02">a</a>)</div><div class="line"><a name="l03117"></a><span class="lineno"> 3117</span>&#160;{</div><div class="line"><a name="l03118"></a><span class="lineno"> 3118</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d4/d09/structminivm__zone.html">minivm_zone</a> *zone;</div><div class="line"><a name="l03119"></a><span class="lineno"> 3119</span>&#160;<span class="preprocessor">#define HMSZ_OUTPUT_FORMAT &quot;%-15s %-20s %-45s\n&quot;</span></div><div class="line"><a name="l03120"></a><span class="lineno"> 3120</span>&#160;   <span class="keywordtype">char</span> *res = <a class="code" href="../../dc/db0/cli_8h.html#a50989f00b32eeb2516a3803cb2ffb766">CLI_SUCCESS</a>;</div><div class="line"><a name="l03121"></a><span class="lineno"> 3121</span>&#160;</div><div class="line"><a name="l03122"></a><span class="lineno"> 3122</span>&#160;   <span class="keywordflow">switch</span> (cmd) {</div><div class="line"><a name="l03123"></a><span class="lineno"> 3123</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="../../dc/db0/cli_8h.html#ab33e5350a923c3a8cedbeb496cd88ec9a71745eb63dd093f560a1add3e430d2a9">CLI_INIT</a>:</div><div class="line"><a name="l03124"></a><span class="lineno"> 3124</span>&#160;      e-&gt;<a class="code" href="../../d8/d07/structast__cli__entry.html#ade9cba72805fe52685a1deea307a8e82">command</a> = <span class="stringliteral">&quot;minivm list zones&quot;</span>;</div><div class="line"><a name="l03125"></a><span class="lineno"> 3125</span>&#160;      e-&gt;<a class="code" href="../../d8/d07/structast__cli__entry.html#aef1bd6ad890a110b466cb0e8088507a2">usage</a> =</div><div class="line"><a name="l03126"></a><span class="lineno"> 3126</span>&#160;         <span class="stringliteral">&quot;Usage: minivm list zones\n&quot;</span></div><div class="line"><a name="l03127"></a><span class="lineno"> 3127</span>&#160;         <span class="stringliteral">&quot;       Lists zone message formats\n&quot;</span>;</div><div class="line"><a name="l03128"></a><span class="lineno"> 3128</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l03129"></a><span class="lineno"> 3129</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="../../dc/db0/cli_8h.html#ab33e5350a923c3a8cedbeb496cd88ec9a76bf33139279b03ec1691f2be2d1be40">CLI_GENERATE</a>:</div><div class="line"><a name="l03130"></a><span class="lineno"> 3130</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l03131"></a><span class="lineno"> 3131</span>&#160;   }</div><div class="line"><a name="l03132"></a><span class="lineno"> 3132</span>&#160;</div><div class="line"><a name="l03133"></a><span class="lineno"> 3133</span>&#160;   <span class="keywordflow">if</span> (a-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#a98e1d8441ca58834f11f7367be4b3345">argc</a> != e-&gt;<a class="code" href="../../d8/d07/structast__cli__entry.html#a1bd7a8575ca2650132d636d65dcda2f6">args</a>)</div><div class="line"><a name="l03134"></a><span class="lineno"> 3134</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/db0/cli_8h.html#a0873456096960dab21fff0ce68c95acb">CLI_SHOWUSAGE</a>;</div><div class="line"><a name="l03135"></a><span class="lineno"> 3135</span>&#160;</div><div class="line"><a name="l03136"></a><span class="lineno"> 3136</span>&#160;   <a class="code" href="../../df/d90/linkedlists_8h.html#a9140a4e4d781264fa9469c52b1adae40">AST_LIST_LOCK</a>(&amp;<a class="code" href="../../db/dce/structminivm__zones.html">minivm_zones</a>);</div><div class="line"><a name="l03137"></a><span class="lineno"> 3137</span>&#160;   <span class="keywordflow">if</span> (!<a class="code" href="../../df/d90/linkedlists_8h.html#a4a1884cde93e53bef32ca85c194a1d05">AST_LIST_EMPTY</a>(&amp;<a class="code" href="../../db/dce/structminivm__zones.html">minivm_zones</a>)) {</div><div class="line"><a name="l03138"></a><span class="lineno"> 3138</span>&#160;      <a class="code" href="../../dc/db0/cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#acf64f219885421479997667d2ed3f08a">fd</a>, <a class="code" href="../../de/dfe/app__minivm_8c.html#aabc4f6848e55b853556bff4ccf48de37">HMSZ_OUTPUT_FORMAT</a>, <span class="stringliteral">&quot;Zone&quot;</span>, <span class="stringliteral">&quot;Timezone&quot;</span>, <span class="stringliteral">&quot;Message Format&quot;</span>);</div><div class="line"><a name="l03139"></a><span class="lineno"> 3139</span>&#160;      <a class="code" href="../../dc/db0/cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#acf64f219885421479997667d2ed3f08a">fd</a>, <a class="code" href="../../de/dfe/app__minivm_8c.html#aabc4f6848e55b853556bff4ccf48de37">HMSZ_OUTPUT_FORMAT</a>, <span class="stringliteral">&quot;----&quot;</span>, <span class="stringliteral">&quot;--------&quot;</span>, <span class="stringliteral">&quot;--------------&quot;</span>);</div><div class="line"><a name="l03140"></a><span class="lineno"> 3140</span>&#160;      <a class="code" href="../../df/d90/linkedlists_8h.html#a3008b2f4f236b72d8bcfb80e346324ef">AST_LIST_TRAVERSE</a>(&amp;<a class="code" href="../../db/dce/structminivm__zones.html">minivm_zones</a>, zone, <a class="code" href="../../dc/d7b/structminivm__account.html#a571e7afb397f412b54fd1f776dab778f">list</a>) {</div><div class="line"><a name="l03141"></a><span class="lineno"> 3141</span>&#160;         <a class="code" href="../../dc/db0/cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#acf64f219885421479997667d2ed3f08a">fd</a>, <a class="code" href="../../de/dfe/app__minivm_8c.html#aabc4f6848e55b853556bff4ccf48de37">HMSZ_OUTPUT_FORMAT</a>, zone-&gt;<a class="code" href="../../d4/d09/structminivm__zone.html#a3777dbae63a15da001b2baa317a25149">name</a>, zone-&gt;<a class="code" href="../../d4/d09/structminivm__zone.html#aad16c37028f0efbc3cf8c9186b770ab8">timezone</a>, zone-&gt;<a class="code" href="../../d4/d09/structminivm__zone.html#a2c72a3f1a42813cfe7e2c79ef3fa9e6c">msg_format</a>);</div><div class="line"><a name="l03142"></a><span class="lineno"> 3142</span>&#160;      }</div><div class="line"><a name="l03143"></a><span class="lineno"> 3143</span>&#160;   } <span class="keywordflow">else</span> {</div><div class="line"><a name="l03144"></a><span class="lineno"> 3144</span>&#160;      <a class="code" href="../../dc/db0/cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#acf64f219885421479997667d2ed3f08a">fd</a>, <span class="stringliteral">&quot;There are no voicemail zones currently defined\n&quot;</span>);</div><div class="line"><a name="l03145"></a><span class="lineno"> 3145</span>&#160;      res = <a class="code" href="../../dc/db0/cli_8h.html#ae47751901c430ebb833e59291a5e0b3f">CLI_FAILURE</a>;</div><div class="line"><a name="l03146"></a><span class="lineno"> 3146</span>&#160;   }</div><div class="line"><a name="l03147"></a><span class="lineno"> 3147</span>&#160;   <a class="code" href="../../df/d90/linkedlists_8h.html#ab48cb9e1e612dd486b747ba1c5d68d01">AST_LIST_UNLOCK</a>(&amp;<a class="code" href="../../db/dce/structminivm__zones.html">minivm_zones</a>);</div><div class="line"><a name="l03148"></a><span class="lineno"> 3148</span>&#160;</div><div class="line"><a name="l03149"></a><span class="lineno"> 3149</span>&#160;   <span class="keywordflow">return</span> res;</div><div class="line"><a name="l03150"></a><span class="lineno"> 3150</span>&#160;}</div><div class="line"><a name="l03151"></a><span class="lineno"> 3151</span>&#160;<span class="comment"></span></div><div class="line"><a name="l03152"></a><span class="lineno"> 3152</span>&#160;<span class="comment">/*! \brief CLI Show settings */</span></div><div class="line"><a name="l03153"></a><span class="lineno"><a class="line" href="../../de/dfe/app__minivm_8c.html#adbac9975e6eca260a8cf807a604d8e8b"> 3153</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">char</span> *<a class="code" href="../../de/dfe/app__minivm_8c.html#adbac9975e6eca260a8cf807a604d8e8b">handle_minivm_show_settings</a>(<span class="keyword">struct</span> <a class="code" href="../../d8/d07/structast__cli__entry.html">ast_cli_entry</a> *e, <span class="keywordtype">int</span> cmd, <span class="keyword">struct</span> <a class="code" href="../../d3/dad/structast__cli__args.html">ast_cli_args</a> *<a class="code" href="../../d7/d6f/test__linkedlists_8c.html#a13dd15487fee89a002d17ef3aff62d02">a</a>)</div><div class="line"><a name="l03154"></a><span class="lineno"> 3154</span>&#160;{</div><div class="line"><a name="l03155"></a><span class="lineno"> 3155</span>&#160;   <span class="keywordflow">switch</span> (cmd) {</div><div class="line"><a name="l03156"></a><span class="lineno"> 3156</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="../../dc/db0/cli_8h.html#ab33e5350a923c3a8cedbeb496cd88ec9a71745eb63dd093f560a1add3e430d2a9">CLI_INIT</a>:</div><div class="line"><a name="l03157"></a><span class="lineno"> 3157</span>&#160;      e-&gt;<a class="code" href="../../d8/d07/structast__cli__entry.html#ade9cba72805fe52685a1deea307a8e82">command</a> = <span class="stringliteral">&quot;minivm show settings&quot;</span>;</div><div class="line"><a name="l03158"></a><span class="lineno"> 3158</span>&#160;      e-&gt;<a class="code" href="../../d8/d07/structast__cli__entry.html#aef1bd6ad890a110b466cb0e8088507a2">usage</a> =</div><div class="line"><a name="l03159"></a><span class="lineno"> 3159</span>&#160;         <span class="stringliteral">&quot;Usage: minivm show settings\n&quot;</span></div><div class="line"><a name="l03160"></a><span class="lineno"> 3160</span>&#160;         <span class="stringliteral">&quot;       Display Mini-Voicemail general settings\n&quot;</span>;</div><div class="line"><a name="l03161"></a><span class="lineno"> 3161</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l03162"></a><span class="lineno"> 3162</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="../../dc/db0/cli_8h.html#ab33e5350a923c3a8cedbeb496cd88ec9a76bf33139279b03ec1691f2be2d1be40">CLI_GENERATE</a>:</div><div class="line"><a name="l03163"></a><span class="lineno"> 3163</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l03164"></a><span class="lineno"> 3164</span>&#160;   }</div><div class="line"><a name="l03165"></a><span class="lineno"> 3165</span>&#160;</div><div class="line"><a name="l03166"></a><span class="lineno"> 3166</span>&#160;   <a class="code" href="../../dc/db0/cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#acf64f219885421479997667d2ed3f08a">fd</a>, <span class="stringliteral">&quot;* Mini-Voicemail general settings\n&quot;</span>);</div><div class="line"><a name="l03167"></a><span class="lineno"> 3167</span>&#160;   <a class="code" href="../../dc/db0/cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#acf64f219885421479997667d2ed3f08a">fd</a>, <span class="stringliteral">&quot;  -------------------------------\n&quot;</span>);</div><div class="line"><a name="l03168"></a><span class="lineno"> 3168</span>&#160;   <a class="code" href="../../dc/db0/cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#acf64f219885421479997667d2ed3f08a">fd</a>, <span class="stringliteral">&quot;\n&quot;</span>);</div><div class="line"><a name="l03169"></a><span class="lineno"> 3169</span>&#160;   <a class="code" href="../../dc/db0/cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#acf64f219885421479997667d2ed3f08a">fd</a>, <span class="stringliteral">&quot;  Mail command (shell):               %s\n&quot;</span>, global_mailcmd);</div><div class="line"><a name="l03170"></a><span class="lineno"> 3170</span>&#160;   <a class="code" href="../../dc/db0/cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#acf64f219885421479997667d2ed3f08a">fd</a>, <span class="stringliteral">&quot;  Max silence:                        %d\n&quot;</span>, global_maxsilence);</div><div class="line"><a name="l03171"></a><span class="lineno"> 3171</span>&#160;   <a class="code" href="../../dc/db0/cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#acf64f219885421479997667d2ed3f08a">fd</a>, <span class="stringliteral">&quot;  Silence threshold:                  %d\n&quot;</span>, global_silencethreshold);</div><div class="line"><a name="l03172"></a><span class="lineno"> 3172</span>&#160;   <a class="code" href="../../dc/db0/cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#acf64f219885421479997667d2ed3f08a">fd</a>, <span class="stringliteral">&quot;  Max message length (secs):          %d\n&quot;</span>, global_vmmaxmessage);</div><div class="line"><a name="l03173"></a><span class="lineno"> 3173</span>&#160;   <a class="code" href="../../dc/db0/cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#acf64f219885421479997667d2ed3f08a">fd</a>, <span class="stringliteral">&quot;  Min message length (secs):          %d\n&quot;</span>, global_vmminmessage);</div><div class="line"><a name="l03174"></a><span class="lineno"> 3174</span>&#160;   <a class="code" href="../../dc/db0/cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#acf64f219885421479997667d2ed3f08a">fd</a>, <span class="stringliteral">&quot;  Default format:                     %s\n&quot;</span>, default_vmformat);</div><div class="line"><a name="l03175"></a><span class="lineno"> 3175</span>&#160;   <a class="code" href="../../dc/db0/cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#acf64f219885421479997667d2ed3f08a">fd</a>, <span class="stringliteral">&quot;  Extern notify (shell):              %s\n&quot;</span>, global_externnotify);</div><div class="line"><a name="l03176"></a><span class="lineno"> 3176</span>&#160;   <a class="code" href="../../dc/db0/cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#acf64f219885421479997667d2ed3f08a">fd</a>, <span class="stringliteral">&quot;  Logfile:                            %s\n&quot;</span>, global_logfile[0] ? global_logfile : <span class="stringliteral">&quot;&lt;disabled&gt;&quot;</span>);</div><div class="line"><a name="l03177"></a><span class="lineno"> 3177</span>&#160;   <a class="code" href="../../dc/db0/cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#acf64f219885421479997667d2ed3f08a">fd</a>, <span class="stringliteral">&quot;  Operator exit:                      %s\n&quot;</span>, <a class="code" href="../../d5/d60/utils_8h.html#a00d4c9254c9827d6fa44f17a326744a5">ast_test_flag</a>(&amp;globalflags, <a class="code" href="../../de/dfe/app__minivm_8c.html#ac06da19dda21a4bac4970057bf72497a">MVM_OPERATOR</a>) ? <span class="stringliteral">&quot;Yes&quot;</span> : <span class="stringliteral">&quot;No&quot;</span>);</div><div class="line"><a name="l03178"></a><span class="lineno"> 3178</span>&#160;   <a class="code" href="../../dc/db0/cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#acf64f219885421479997667d2ed3f08a">fd</a>, <span class="stringliteral">&quot;  Message review:                     %s\n&quot;</span>, <a class="code" href="../../d5/d60/utils_8h.html#a00d4c9254c9827d6fa44f17a326744a5">ast_test_flag</a>(&amp;globalflags, <a class="code" href="../../de/dfe/app__minivm_8c.html#a251b3dd38bf79c9b6d4fdc86ef63f0a8">MVM_REVIEW</a>) ? <span class="stringliteral">&quot;Yes&quot;</span> : <span class="stringliteral">&quot;No&quot;</span>);</div><div class="line"><a name="l03179"></a><span class="lineno"> 3179</span>&#160;</div><div class="line"><a name="l03180"></a><span class="lineno"> 3180</span>&#160;   <a class="code" href="../../dc/db0/cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#acf64f219885421479997667d2ed3f08a">fd</a>, <span class="stringliteral">&quot;\n&quot;</span>);</div><div class="line"><a name="l03181"></a><span class="lineno"> 3181</span>&#160;   <span class="keywordflow">return</span> <a class="code" href="../../dc/db0/cli_8h.html#a50989f00b32eeb2516a3803cb2ffb766">CLI_SUCCESS</a>;</div><div class="line"><a name="l03182"></a><span class="lineno"> 3182</span>&#160;}</div><div class="line"><a name="l03183"></a><span class="lineno"> 3183</span>&#160;<span class="comment"></span></div><div class="line"><a name="l03184"></a><span class="lineno"> 3184</span>&#160;<span class="comment">/*! \brief Show stats */</span></div><div class="line"><a name="l03185"></a><span class="lineno"><a class="line" href="../../de/dfe/app__minivm_8c.html#a2091dc4ee24682aee893c0633da31eca"> 3185</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">char</span> *<a class="code" href="../../de/dfe/app__minivm_8c.html#a2091dc4ee24682aee893c0633da31eca">handle_minivm_show_stats</a>(<span class="keyword">struct</span> <a class="code" href="../../d8/d07/structast__cli__entry.html">ast_cli_entry</a> *e, <span class="keywordtype">int</span> cmd, <span class="keyword">struct</span> <a class="code" href="../../d3/dad/structast__cli__args.html">ast_cli_args</a> *<a class="code" href="../../d7/d6f/test__linkedlists_8c.html#a13dd15487fee89a002d17ef3aff62d02">a</a>)</div><div class="line"><a name="l03186"></a><span class="lineno"> 3186</span>&#160;{</div><div class="line"><a name="l03187"></a><span class="lineno"> 3187</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d5/d84/structast__tm.html">ast_tm</a> timebuf;</div><div class="line"><a name="l03188"></a><span class="lineno"> 3188</span>&#160;   <span class="keywordtype">char</span> <a class="code" href="../../dd/d7c/eagi__proxy_8c.html#ac95651d79c608a3148973b5b1fc9e525">buf</a>[BUFSIZ];</div><div class="line"><a name="l03189"></a><span class="lineno"> 3189</span>&#160;</div><div class="line"><a name="l03190"></a><span class="lineno"> 3190</span>&#160;   <span class="keywordflow">switch</span> (cmd) {</div><div class="line"><a name="l03191"></a><span class="lineno"> 3191</span>&#160;</div><div class="line"><a name="l03192"></a><span class="lineno"> 3192</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="../../dc/db0/cli_8h.html#ab33e5350a923c3a8cedbeb496cd88ec9a71745eb63dd093f560a1add3e430d2a9">CLI_INIT</a>:</div><div class="line"><a name="l03193"></a><span class="lineno"> 3193</span>&#160;      e-&gt;<a class="code" href="../../d8/d07/structast__cli__entry.html#ade9cba72805fe52685a1deea307a8e82">command</a> = <span class="stringliteral">&quot;minivm show stats&quot;</span>;</div><div class="line"><a name="l03194"></a><span class="lineno"> 3194</span>&#160;      e-&gt;<a class="code" href="../../d8/d07/structast__cli__entry.html#aef1bd6ad890a110b466cb0e8088507a2">usage</a> =</div><div class="line"><a name="l03195"></a><span class="lineno"> 3195</span>&#160;         <span class="stringliteral">&quot;Usage: minivm show stats\n&quot;</span></div><div class="line"><a name="l03196"></a><span class="lineno"> 3196</span>&#160;         <span class="stringliteral">&quot;       Display Mini-Voicemail counters\n&quot;</span>;</div><div class="line"><a name="l03197"></a><span class="lineno"> 3197</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l03198"></a><span class="lineno"> 3198</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="../../dc/db0/cli_8h.html#ab33e5350a923c3a8cedbeb496cd88ec9a76bf33139279b03ec1691f2be2d1be40">CLI_GENERATE</a>:</div><div class="line"><a name="l03199"></a><span class="lineno"> 3199</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l03200"></a><span class="lineno"> 3200</span>&#160;   }</div><div class="line"><a name="l03201"></a><span class="lineno"> 3201</span>&#160;</div><div class="line"><a name="l03202"></a><span class="lineno"> 3202</span>&#160;   <a class="code" href="../../dc/db0/cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#acf64f219885421479997667d2ed3f08a">fd</a>, <span class="stringliteral">&quot;* Mini-Voicemail statistics\n&quot;</span>);</div><div class="line"><a name="l03203"></a><span class="lineno"> 3203</span>&#160;   <a class="code" href="../../dc/db0/cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#acf64f219885421479997667d2ed3f08a">fd</a>, <span class="stringliteral">&quot;  -------------------------\n&quot;</span>);</div><div class="line"><a name="l03204"></a><span class="lineno"> 3204</span>&#160;   <a class="code" href="../../dc/db0/cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#acf64f219885421479997667d2ed3f08a">fd</a>, <span class="stringliteral">&quot;\n&quot;</span>);</div><div class="line"><a name="l03205"></a><span class="lineno"> 3205</span>&#160;   <a class="code" href="../../dc/db0/cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#acf64f219885421479997667d2ed3f08a">fd</a>, <span class="stringliteral">&quot;  Voicemail accounts:                  %5d\n&quot;</span>, <a class="code" href="../../de/dfe/app__minivm_8c.html#afb3339bdf5d1db127a88fc3be1dbcb1c">global_stats</a>.<a class="code" href="../../d6/dee/structminivm__stats.html#a90ef6fe584f0712a6dfe1e90038da6bf">voicemailaccounts</a>);</div><div class="line"><a name="l03206"></a><span class="lineno"> 3206</span>&#160;   <a class="code" href="../../dc/db0/cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#acf64f219885421479997667d2ed3f08a">fd</a>, <span class="stringliteral">&quot;  Templates:                           %5d\n&quot;</span>, <a class="code" href="../../de/dfe/app__minivm_8c.html#afb3339bdf5d1db127a88fc3be1dbcb1c">global_stats</a>.<a class="code" href="../../d6/dee/structminivm__stats.html#a92b59b721b40f396592d78dc1fedfbb0">templates</a>);</div><div class="line"><a name="l03207"></a><span class="lineno"> 3207</span>&#160;   <a class="code" href="../../dc/db0/cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#acf64f219885421479997667d2ed3f08a">fd</a>, <span class="stringliteral">&quot;  Timezones:                           %5d\n&quot;</span>, <a class="code" href="../../de/dfe/app__minivm_8c.html#afb3339bdf5d1db127a88fc3be1dbcb1c">global_stats</a>.<a class="code" href="../../d6/dee/structminivm__stats.html#ae86e86585a988ba3e05e4f4a92ad6b75">timezones</a>);</div><div class="line"><a name="l03208"></a><span class="lineno"> 3208</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../de/dfe/app__minivm_8c.html#afb3339bdf5d1db127a88fc3be1dbcb1c">global_stats</a>.<a class="code" href="../../d6/dee/structminivm__stats.html#a6e076e5da3ca4090f6072b01a7e0a05c">receivedmessages</a> == 0) {</div><div class="line"><a name="l03209"></a><span class="lineno"> 3209</span>&#160;      <a class="code" href="../../dc/db0/cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#acf64f219885421479997667d2ed3f08a">fd</a>, <span class="stringliteral">&quot;  Received messages since last reset:  &lt;none&gt;\n&quot;</span>);</div><div class="line"><a name="l03210"></a><span class="lineno"> 3210</span>&#160;   } <span class="keywordflow">else</span> {</div><div class="line"><a name="l03211"></a><span class="lineno"> 3211</span>&#160;      <a class="code" href="../../dc/db0/cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#acf64f219885421479997667d2ed3f08a">fd</a>, <span class="stringliteral">&quot;  Received messages since last reset:  %d\n&quot;</span>, <a class="code" href="../../de/dfe/app__minivm_8c.html#afb3339bdf5d1db127a88fc3be1dbcb1c">global_stats</a>.<a class="code" href="../../d6/dee/structminivm__stats.html#a6e076e5da3ca4090f6072b01a7e0a05c">receivedmessages</a>);</div><div class="line"><a name="l03212"></a><span class="lineno"> 3212</span>&#160;      <a class="code" href="../../d5/deb/localtime_8h.html#ae9fbda728350a9a5b9c09b29214d718e">ast_localtime</a>(&amp;<a class="code" href="../../de/dfe/app__minivm_8c.html#afb3339bdf5d1db127a88fc3be1dbcb1c">global_stats</a>.<a class="code" href="../../d6/dee/structminivm__stats.html#a5787090892a375d9cfd599710d971b63">lastreceived</a>, &amp;timebuf, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div><div class="line"><a name="l03213"></a><span class="lineno"> 3213</span>&#160;      <a class="code" href="../../d5/deb/localtime_8h.html#aa8e63928b14a347bd3973d680b885f93">ast_strftime</a>(buf, <span class="keyword">sizeof</span>(buf), <span class="stringliteral">&quot;%a %b %e %r %Z %Y&quot;</span>, &amp;timebuf);</div><div class="line"><a name="l03214"></a><span class="lineno"> 3214</span>&#160;      <a class="code" href="../../dc/db0/cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#acf64f219885421479997667d2ed3f08a">fd</a>, <span class="stringliteral">&quot;  Last received voicemail:             %s\n&quot;</span>, buf);</div><div class="line"><a name="l03215"></a><span class="lineno"> 3215</span>&#160;   }</div><div class="line"><a name="l03216"></a><span class="lineno"> 3216</span>&#160;   <a class="code" href="../../d5/deb/localtime_8h.html#ae9fbda728350a9a5b9c09b29214d718e">ast_localtime</a>(&amp;<a class="code" href="../../de/dfe/app__minivm_8c.html#afb3339bdf5d1db127a88fc3be1dbcb1c">global_stats</a>.<a class="code" href="../../d6/dee/structminivm__stats.html#a739fde63c6d1cf2099ad3703aabb5433">reset</a>, &amp;timebuf, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div><div class="line"><a name="l03217"></a><span class="lineno"> 3217</span>&#160;   <a class="code" href="../../d5/deb/localtime_8h.html#aa8e63928b14a347bd3973d680b885f93">ast_strftime</a>(buf, <span class="keyword">sizeof</span>(buf), <span class="stringliteral">&quot;%a %b %e %r %Z %Y&quot;</span>, &amp;timebuf);</div><div class="line"><a name="l03218"></a><span class="lineno"> 3218</span>&#160;   <a class="code" href="../../dc/db0/cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#acf64f219885421479997667d2ed3f08a">fd</a>, <span class="stringliteral">&quot;  Last reset:                          %s\n&quot;</span>, buf);</div><div class="line"><a name="l03219"></a><span class="lineno"> 3219</span>&#160;</div><div class="line"><a name="l03220"></a><span class="lineno"> 3220</span>&#160;   <a class="code" href="../../dc/db0/cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#acf64f219885421479997667d2ed3f08a">fd</a>, <span class="stringliteral">&quot;\n&quot;</span>);</div><div class="line"><a name="l03221"></a><span class="lineno"> 3221</span>&#160;   <span class="keywordflow">return</span> <a class="code" href="../../dc/db0/cli_8h.html#a50989f00b32eeb2516a3803cb2ffb766">CLI_SUCCESS</a>;</div><div class="line"><a name="l03222"></a><span class="lineno"> 3222</span>&#160;}</div><div class="line"><a name="l03223"></a><span class="lineno"> 3223</span>&#160;<span class="comment"></span></div><div class="line"><a name="l03224"></a><span class="lineno"> 3224</span>&#160;<span class="comment">/*! \brief  ${MINIVMACCOUNT()} Dialplan function - reads account data */</span></div><div class="line"><a name="l03225"></a><span class="lineno"><a class="line" href="../../de/dfe/app__minivm_8c.html#a42e341d5d3dd48f5afc05b9f5045467d"> 3225</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../de/dfe/app__minivm_8c.html#a42e341d5d3dd48f5afc05b9f5045467d">minivm_account_func_read</a>(<span class="keyword">struct</span> <a class="code" href="../../df/d3c/structast__channel.html">ast_channel</a> *chan, <span class="keyword">const</span> <span class="keywordtype">char</span> *cmd, <span class="keywordtype">char</span> *data, <span class="keywordtype">char</span> *<a class="code" href="../../dd/d7c/eagi__proxy_8c.html#ac95651d79c608a3148973b5b1fc9e525">buf</a>, <span class="keywordtype">size_t</span> <a class="code" href="../../d9/d1e/func__strings_8c.html#af24e73aaf92f3000fda15d285e66df24">len</a>)</div><div class="line"><a name="l03226"></a><span class="lineno"> 3226</span>&#160;{</div><div class="line"><a name="l03227"></a><span class="lineno"> 3227</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../dc/d7b/structminivm__account.html">minivm_account</a> *vmu;</div><div class="line"><a name="l03228"></a><span class="lineno"> 3228</span>&#160;   <span class="keywordtype">char</span> *<a class="code" href="../../dc/d7b/structminivm__account.html#a4b30874d24514b5ef6ff5276e8c12ed4">username</a>, *<a class="code" href="../../dc/d7b/structminivm__account.html#ae43ea5d0335f149f0920d33e46b61c33">domain</a>, *colname;</div><div class="line"><a name="l03229"></a><span class="lineno"> 3229</span>&#160;</div><div class="line"><a name="l03230"></a><span class="lineno"> 3230</span>&#160;   username = <a class="code" href="../../d8/d8a/astmm_8h.html#ab5f0750cc80ba337fdcbddea2d3a1ee6">ast_strdupa</a>(data);</div><div class="line"><a name="l03231"></a><span class="lineno"> 3231</span>&#160;</div><div class="line"><a name="l03232"></a><span class="lineno"> 3232</span>&#160;   <span class="keywordflow">if</span> ((colname = strchr(username, <span class="charliteral">&#39;:&#39;</span>))) {</div><div class="line"><a name="l03233"></a><span class="lineno"> 3233</span>&#160;      *colname = <span class="charliteral">&#39;\0&#39;</span>;</div><div class="line"><a name="l03234"></a><span class="lineno"> 3234</span>&#160;      colname++;</div><div class="line"><a name="l03235"></a><span class="lineno"> 3235</span>&#160;   } <span class="keywordflow">else</span> {</div><div class="line"><a name="l03236"></a><span class="lineno"> 3236</span>&#160;      colname = <span class="stringliteral">&quot;path&quot;</span>;</div><div class="line"><a name="l03237"></a><span class="lineno"> 3237</span>&#160;   }</div><div class="line"><a name="l03238"></a><span class="lineno"> 3238</span>&#160;   <span class="keywordflow">if</span> ((domain = strchr(username, <span class="charliteral">&#39;@&#39;</span>))) {</div><div class="line"><a name="l03239"></a><span class="lineno"> 3239</span>&#160;      *domain = <span class="charliteral">&#39;\0&#39;</span>;</div><div class="line"><a name="l03240"></a><span class="lineno"> 3240</span>&#160;      domain++;</div><div class="line"><a name="l03241"></a><span class="lineno"> 3241</span>&#160;   }</div><div class="line"><a name="l03242"></a><span class="lineno"> 3242</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a>(username) || <a class="code" href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a>(domain)) {</div><div class="line"><a name="l03243"></a><span class="lineno"> 3243</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;This function needs a username and a domain: username@domain\n&quot;</span>);</div><div class="line"><a name="l03244"></a><span class="lineno"> 3244</span>&#160;      <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l03245"></a><span class="lineno"> 3245</span>&#160;   }</div><div class="line"><a name="l03246"></a><span class="lineno"> 3246</span>&#160;</div><div class="line"><a name="l03247"></a><span class="lineno"> 3247</span>&#160;   <span class="keywordflow">if</span> (!(vmu = <a class="code" href="../../de/dfe/app__minivm_8c.html#ac26055cad7a69cbfb6692d273f025a40">find_account</a>(domain, username, <a class="code" href="../../de/dfe/app__minivm_8c.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>)))</div><div class="line"><a name="l03248"></a><span class="lineno"> 3248</span>&#160;      <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l03249"></a><span class="lineno"> 3249</span>&#160;</div><div class="line"><a name="l03250"></a><span class="lineno"> 3250</span>&#160;   <span class="keywordflow">if</span> (!strcasecmp(colname, <span class="stringliteral">&quot;hasaccount&quot;</span>)) {</div><div class="line"><a name="l03251"></a><span class="lineno"> 3251</span>&#160;      <a class="code" href="../../d6/d90/strings_8h.html#ac4040268f7b6ed77dfc49c7767626369">ast_copy_string</a>(buf, (<a class="code" href="../../d5/d60/utils_8h.html#a00d4c9254c9827d6fa44f17a326744a5">ast_test_flag</a>(vmu, <a class="code" href="../../de/dfe/app__minivm_8c.html#ac1976490b5dd7e2dae38667d5d21fe4a">MVM_ALLOCED</a>) ? <span class="stringliteral">&quot;0&quot;</span> : <span class="stringliteral">&quot;1&quot;</span>), len);</div><div class="line"><a name="l03252"></a><span class="lineno"> 3252</span>&#160;   } <span class="keywordflow">else</span>  <span class="keywordflow">if</span> (!strcasecmp(colname, <span class="stringliteral">&quot;fullname&quot;</span>)) {</div><div class="line"><a name="l03253"></a><span class="lineno"> 3253</span>&#160;      <a class="code" href="../../d6/d90/strings_8h.html#ac4040268f7b6ed77dfc49c7767626369">ast_copy_string</a>(buf, vmu-&gt;<a class="code" href="../../dc/d7b/structminivm__account.html#ab5845627664c59054dd8e5f01829d4f3">fullname</a>, len);</div><div class="line"><a name="l03254"></a><span class="lineno"> 3254</span>&#160;   } <span class="keywordflow">else</span>  <span class="keywordflow">if</span> (!strcasecmp(colname, <span class="stringliteral">&quot;email&quot;</span>)) {</div><div class="line"><a name="l03255"></a><span class="lineno"> 3255</span>&#160;      <span class="keywordflow">if</span> (!<a class="code" href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a>(vmu-&gt;<a class="code" href="../../dc/d7b/structminivm__account.html#aadd75c09e15efa9061997f033b3f224b">email</a>))</div><div class="line"><a name="l03256"></a><span class="lineno"> 3256</span>&#160;         <a class="code" href="../../d6/d90/strings_8h.html#ac4040268f7b6ed77dfc49c7767626369">ast_copy_string</a>(buf, vmu-&gt;<a class="code" href="../../dc/d7b/structminivm__account.html#aadd75c09e15efa9061997f033b3f224b">email</a>, len);</div><div class="line"><a name="l03257"></a><span class="lineno"> 3257</span>&#160;      <span class="keywordflow">else</span></div><div class="line"><a name="l03258"></a><span class="lineno"> 3258</span>&#160;         snprintf(buf, len, <span class="stringliteral">&quot;%s@%s&quot;</span>, vmu-&gt;<a class="code" href="../../dc/d7b/structminivm__account.html#a4b30874d24514b5ef6ff5276e8c12ed4">username</a>, vmu-&gt;<a class="code" href="../../dc/d7b/structminivm__account.html#ae43ea5d0335f149f0920d33e46b61c33">domain</a>);</div><div class="line"><a name="l03259"></a><span class="lineno"> 3259</span>&#160;   } <span class="keywordflow">else</span>  <span class="keywordflow">if</span> (!strcasecmp(colname, <span class="stringliteral">&quot;pager&quot;</span>)) {</div><div class="line"><a name="l03260"></a><span class="lineno"> 3260</span>&#160;      <a class="code" href="../../d6/d90/strings_8h.html#ac4040268f7b6ed77dfc49c7767626369">ast_copy_string</a>(buf, vmu-&gt;<a class="code" href="../../dc/d7b/structminivm__account.html#a29b9b126bac9cc5f1cc334f140f39e8d">pager</a>, len);</div><div class="line"><a name="l03261"></a><span class="lineno"> 3261</span>&#160;   } <span class="keywordflow">else</span>  <span class="keywordflow">if</span> (!strcasecmp(colname, <span class="stringliteral">&quot;etemplate&quot;</span>)) {</div><div class="line"><a name="l03262"></a><span class="lineno"> 3262</span>&#160;      <span class="keywordflow">if</span> (!<a class="code" href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a>(vmu-&gt;<a class="code" href="../../dc/d7b/structminivm__account.html#ad48036454496b4bfb945139d1ae878c4">etemplate</a>))</div><div class="line"><a name="l03263"></a><span class="lineno"> 3263</span>&#160;         <a class="code" href="../../d6/d90/strings_8h.html#ac4040268f7b6ed77dfc49c7767626369">ast_copy_string</a>(buf, vmu-&gt;<a class="code" href="../../dc/d7b/structminivm__account.html#ad48036454496b4bfb945139d1ae878c4">etemplate</a>, len);</div><div class="line"><a name="l03264"></a><span class="lineno"> 3264</span>&#160;      <span class="keywordflow">else</span></div><div class="line"><a name="l03265"></a><span class="lineno"> 3265</span>&#160;         <a class="code" href="../../d6/d90/strings_8h.html#ac4040268f7b6ed77dfc49c7767626369">ast_copy_string</a>(buf, <span class="stringliteral">&quot;email-default&quot;</span>, len);</div><div class="line"><a name="l03266"></a><span class="lineno"> 3266</span>&#160;   } <span class="keywordflow">else</span>  <span class="keywordflow">if</span> (!strcasecmp(colname, <span class="stringliteral">&quot;language&quot;</span>)) {</div><div class="line"><a name="l03267"></a><span class="lineno"> 3267</span>&#160;      <a class="code" href="../../d6/d90/strings_8h.html#ac4040268f7b6ed77dfc49c7767626369">ast_copy_string</a>(buf, vmu-&gt;<a class="code" href="../../dc/d7b/structminivm__account.html#adf416dc058363e2fd5750c77e2d78bee">language</a>, len);</div><div class="line"><a name="l03268"></a><span class="lineno"> 3268</span>&#160;   } <span class="keywordflow">else</span>  <span class="keywordflow">if</span> (!strcasecmp(colname, <span class="stringliteral">&quot;timezone&quot;</span>)) {</div><div class="line"><a name="l03269"></a><span class="lineno"> 3269</span>&#160;      <a class="code" href="../../d6/d90/strings_8h.html#ac4040268f7b6ed77dfc49c7767626369">ast_copy_string</a>(buf, vmu-&gt;<a class="code" href="../../dc/d7b/structminivm__account.html#a4a081db7653645ce9fce8fd72e5a7bf1">zonetag</a>, len);</div><div class="line"><a name="l03270"></a><span class="lineno"> 3270</span>&#160;   } <span class="keywordflow">else</span>  <span class="keywordflow">if</span> (!strcasecmp(colname, <span class="stringliteral">&quot;ptemplate&quot;</span>)) {</div><div class="line"><a name="l03271"></a><span class="lineno"> 3271</span>&#160;      <span class="keywordflow">if</span> (!<a class="code" href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a>(vmu-&gt;<a class="code" href="../../dc/d7b/structminivm__account.html#a6e9b30710047deee4fb3e4f38c8e7cc2">ptemplate</a>))</div><div class="line"><a name="l03272"></a><span class="lineno"> 3272</span>&#160;         <a class="code" href="../../d6/d90/strings_8h.html#ac4040268f7b6ed77dfc49c7767626369">ast_copy_string</a>(buf, vmu-&gt;<a class="code" href="../../dc/d7b/structminivm__account.html#a6e9b30710047deee4fb3e4f38c8e7cc2">ptemplate</a>, len);</div><div class="line"><a name="l03273"></a><span class="lineno"> 3273</span>&#160;      <span class="keywordflow">else</span></div><div class="line"><a name="l03274"></a><span class="lineno"> 3274</span>&#160;         <a class="code" href="../../d6/d90/strings_8h.html#ac4040268f7b6ed77dfc49c7767626369">ast_copy_string</a>(buf, <span class="stringliteral">&quot;email-default&quot;</span>, len);</div><div class="line"><a name="l03275"></a><span class="lineno"> 3275</span>&#160;   } <span class="keywordflow">else</span>  <span class="keywordflow">if</span> (!strcasecmp(colname, <span class="stringliteral">&quot;accountcode&quot;</span>)) {</div><div class="line"><a name="l03276"></a><span class="lineno"> 3276</span>&#160;      <a class="code" href="../../d6/d90/strings_8h.html#ac4040268f7b6ed77dfc49c7767626369">ast_copy_string</a>(buf, vmu-&gt;<a class="code" href="../../dc/d7b/structminivm__account.html#adfee50d07a98645d4d20b896ce03785a">accountcode</a>, len);</div><div class="line"><a name="l03277"></a><span class="lineno"> 3277</span>&#160;   } <span class="keywordflow">else</span>  <span class="keywordflow">if</span> (!strcasecmp(colname, <span class="stringliteral">&quot;pincode&quot;</span>)) {</div><div class="line"><a name="l03278"></a><span class="lineno"> 3278</span>&#160;      <a class="code" href="../../d6/d90/strings_8h.html#ac4040268f7b6ed77dfc49c7767626369">ast_copy_string</a>(buf, vmu-&gt;<a class="code" href="../../dc/d7b/structminivm__account.html#ae120a3d8aeb5d880fba30d84a560efae">pincode</a>, len);</div><div class="line"><a name="l03279"></a><span class="lineno"> 3279</span>&#160;   } <span class="keywordflow">else</span>  <span class="keywordflow">if</span> (!strcasecmp(colname, <span class="stringliteral">&quot;path&quot;</span>)) {</div><div class="line"><a name="l03280"></a><span class="lineno"> 3280</span>&#160;      <a class="code" href="../../de/dfe/app__minivm_8c.html#a9a335978d2517b553066af1f10a4d07f">check_dirpath</a>(buf, len, vmu-&gt;<a class="code" href="../../dc/d7b/structminivm__account.html#ae43ea5d0335f149f0920d33e46b61c33">domain</a>, vmu-&gt;<a class="code" href="../../dc/d7b/structminivm__account.html#a4b30874d24514b5ef6ff5276e8c12ed4">username</a>, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div><div class="line"><a name="l03281"></a><span class="lineno"> 3281</span>&#160;   } <span class="keywordflow">else</span> { <span class="comment">/* Look in channel variables */</span></div><div class="line"><a name="l03282"></a><span class="lineno"> 3282</span>&#160;      <span class="keyword">struct </span><a class="code" href="../../dd/d02/structast__variable.html">ast_variable</a> *<a class="code" href="../../dc/df2/ast__expr2f_8c.html#a1b0936415a643c88ce543099c10e0d7f">var</a>;</div><div class="line"><a name="l03283"></a><span class="lineno"> 3283</span>&#160;</div><div class="line"><a name="l03284"></a><span class="lineno"> 3284</span>&#160;      <span class="keywordflow">for</span> (var = vmu-&gt;<a class="code" href="../../dc/d7b/structminivm__account.html#a06c0918fa1a1aac3d386fca59b12327c">chanvars</a> ; var ; var = var-&gt;<a class="code" href="../../dd/d02/structast__variable.html#afaaf66cc5029a563bd0bb9df076ea14b">next</a>)</div><div class="line"><a name="l03285"></a><span class="lineno"> 3285</span>&#160;         <span class="keywordflow">if</span> (!strcmp(var-&gt;<a class="code" href="../../dd/d02/structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, colname)) {</div><div class="line"><a name="l03286"></a><span class="lineno"> 3286</span>&#160;            <a class="code" href="../../d6/d90/strings_8h.html#ac4040268f7b6ed77dfc49c7767626369">ast_copy_string</a>(buf, var-&gt;<a class="code" href="../../dd/d02/structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, len);</div><div class="line"><a name="l03287"></a><span class="lineno"> 3287</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l03288"></a><span class="lineno"> 3288</span>&#160;         }</div><div class="line"><a name="l03289"></a><span class="lineno"> 3289</span>&#160;   }</div><div class="line"><a name="l03290"></a><span class="lineno"> 3290</span>&#160;</div><div class="line"><a name="l03291"></a><span class="lineno"> 3291</span>&#160;   <span class="keywordflow">if</span>(<a class="code" href="../../d5/d60/utils_8h.html#a00d4c9254c9827d6fa44f17a326744a5">ast_test_flag</a>(vmu, <a class="code" href="../../de/dfe/app__minivm_8c.html#ac1976490b5dd7e2dae38667d5d21fe4a">MVM_ALLOCED</a>))</div><div class="line"><a name="l03292"></a><span class="lineno"> 3292</span>&#160;      <a class="code" href="../../de/dfe/app__minivm_8c.html#a1c42a258925cbbb46952152ec3785bfd">free_user</a>(vmu);</div><div class="line"><a name="l03293"></a><span class="lineno"> 3293</span>&#160;</div><div class="line"><a name="l03294"></a><span class="lineno"> 3294</span>&#160;   <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l03295"></a><span class="lineno"> 3295</span>&#160;}</div><div class="line"><a name="l03296"></a><span class="lineno"> 3296</span>&#160;<span class="comment"></span></div><div class="line"><a name="l03297"></a><span class="lineno"> 3297</span>&#160;<span class="comment">/*! \brief lock directory</span></div><div class="line"><a name="l03298"></a><span class="lineno"> 3298</span>&#160;<span class="comment"></span></div><div class="line"><a name="l03299"></a><span class="lineno"> 3299</span>&#160;<span class="comment">   only return failure if ast_lock_path returns &#39;timeout&#39;,</span></div><div class="line"><a name="l03300"></a><span class="lineno"> 3300</span>&#160;<span class="comment">   not if the path does not exist or any other reason</span></div><div class="line"><a name="l03301"></a><span class="lineno"> 3301</span>&#160;<span class="comment">*/</span></div><div class="line"><a name="l03302"></a><span class="lineno"><a class="line" href="../../de/dfe/app__minivm_8c.html#a7b7715fe7d49edf843394ee1232f7de1"> 3302</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../de/dfe/app__minivm_8c.html#a7b7715fe7d49edf843394ee1232f7de1">vm_lock_path</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *path)</div><div class="line"><a name="l03303"></a><span class="lineno"> 3303</span>&#160;{</div><div class="line"><a name="l03304"></a><span class="lineno"> 3304</span>&#160;   <span class="keywordflow">switch</span> (<a class="code" href="../../d3/d93/include_2asterisk_2app_8h.html#a74c57b5a842dcbc15cc991a31f679a13">ast_lock_path</a>(path)) {</div><div class="line"><a name="l03305"></a><span class="lineno"> 3305</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="../../d3/d93/include_2asterisk_2app_8h.html#a382bf96f47f0b7fa86ae5ed0644b3f8ca9c0f41302de02bb0130a92669d17333d">AST_LOCK_TIMEOUT</a>:</div><div class="line"><a name="l03306"></a><span class="lineno"> 3306</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l03307"></a><span class="lineno"> 3307</span>&#160;   <span class="keywordflow">default</span>:</div><div class="line"><a name="l03308"></a><span class="lineno"> 3308</span>&#160;      <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l03309"></a><span class="lineno"> 3309</span>&#160;   }</div><div class="line"><a name="l03310"></a><span class="lineno"> 3310</span>&#160;}</div><div class="line"><a name="l03311"></a><span class="lineno"> 3311</span>&#160;<span class="comment"></span></div><div class="line"><a name="l03312"></a><span class="lineno"> 3312</span>&#160;<span class="comment">/*! \brief Access counter file, lock directory, read and possibly write it again changed</span></div><div class="line"><a name="l03313"></a><span class="lineno"> 3313</span>&#160;<span class="comment">   \param directory  Directory to crate file in</span></div><div class="line"><a name="l03314"></a><span class="lineno"> 3314</span>&#160;<span class="comment">   \param countername   filename</span></div><div class="line"><a name="l03315"></a><span class="lineno"> 3315</span>&#160;<span class="comment">   \param value      If set to zero, we only read the variable</span></div><div class="line"><a name="l03316"></a><span class="lineno"> 3316</span>&#160;<span class="comment">   \param operand    0 to read, 1 to set new value, 2 to change</span></div><div class="line"><a name="l03317"></a><span class="lineno"> 3317</span>&#160;<span class="comment">   \return -1 on error, otherwise counter value</span></div><div class="line"><a name="l03318"></a><span class="lineno"> 3318</span>&#160;<span class="comment">*/</span></div><div class="line"><a name="l03319"></a><span class="lineno"><a class="line" href="../../de/dfe/app__minivm_8c.html#af02d84a63641abcd8bfd43897789a156"> 3319</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../de/dfe/app__minivm_8c.html#af02d84a63641abcd8bfd43897789a156">access_counter_file</a>(<span class="keywordtype">char</span> *directory, <span class="keywordtype">char</span> *countername, <span class="keywordtype">int</span> <a class="code" href="../../d4/d2f/syslog_8c.html#ac4f474c82e82cbb89ca7c36dd52be0ed">value</a>, <span class="keywordtype">int</span> operand)</div><div class="line"><a name="l03320"></a><span class="lineno"> 3320</span>&#160;{</div><div class="line"><a name="l03321"></a><span class="lineno"> 3321</span>&#160;   <span class="keywordtype">char</span> filename[BUFSIZ];</div><div class="line"><a name="l03322"></a><span class="lineno"> 3322</span>&#160;   <span class="keywordtype">char</span> readbuf[BUFSIZ];</div><div class="line"><a name="l03323"></a><span class="lineno"> 3323</span>&#160;   FILE *counterfile;</div><div class="line"><a name="l03324"></a><span class="lineno"> 3324</span>&#160;   <span class="keywordtype">int</span> old = 0, counter = 0;</div><div class="line"><a name="l03325"></a><span class="lineno"> 3325</span>&#160;</div><div class="line"><a name="l03326"></a><span class="lineno"> 3326</span>&#160;   <span class="comment">/* Lock directory */</span></div><div class="line"><a name="l03327"></a><span class="lineno"> 3327</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../de/dfe/app__minivm_8c.html#a7b7715fe7d49edf843394ee1232f7de1">vm_lock_path</a>(directory)) {</div><div class="line"><a name="l03328"></a><span class="lineno"> 3328</span>&#160;      <span class="keywordflow">return</span> -1;  <span class="comment">/* Could not lock directory */</span></div><div class="line"><a name="l03329"></a><span class="lineno"> 3329</span>&#160;   }</div><div class="line"><a name="l03330"></a><span class="lineno"> 3330</span>&#160;   snprintf(filename, <span class="keyword">sizeof</span>(filename), <span class="stringliteral">&quot;%s/%s.counter&quot;</span>, directory, countername);</div><div class="line"><a name="l03331"></a><span class="lineno"> 3331</span>&#160;   <span class="keywordflow">if</span> (operand != 1) {</div><div class="line"><a name="l03332"></a><span class="lineno"> 3332</span>&#160;      counterfile = fopen(filename, <span class="stringliteral">&quot;r&quot;</span>);</div><div class="line"><a name="l03333"></a><span class="lineno"> 3333</span>&#160;      <span class="keywordflow">if</span> (counterfile) {</div><div class="line"><a name="l03334"></a><span class="lineno"> 3334</span>&#160;         <span class="keywordflow">if</span>(fgets(readbuf, <span class="keyword">sizeof</span>(readbuf), counterfile)) {</div><div class="line"><a name="l03335"></a><span class="lineno"> 3335</span>&#160;            <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(3, <span class="stringliteral">&quot;Read this string from counter file: %s\n&quot;</span>, readbuf);</div><div class="line"><a name="l03336"></a><span class="lineno"> 3336</span>&#160;            old = counter = atoi(readbuf);</div><div class="line"><a name="l03337"></a><span class="lineno"> 3337</span>&#160;         }</div><div class="line"><a name="l03338"></a><span class="lineno"> 3338</span>&#160;         fclose(counterfile);</div><div class="line"><a name="l03339"></a><span class="lineno"> 3339</span>&#160;      }</div><div class="line"><a name="l03340"></a><span class="lineno"> 3340</span>&#160;   }</div><div class="line"><a name="l03341"></a><span class="lineno"> 3341</span>&#160;   <span class="keywordflow">switch</span> (operand) {</div><div class="line"><a name="l03342"></a><span class="lineno"> 3342</span>&#160;   <span class="keywordflow">case</span> 0:  <span class="comment">/* Read only */</span></div><div class="line"><a name="l03343"></a><span class="lineno"> 3343</span>&#160;      <a class="code" href="../../d3/d93/include_2asterisk_2app_8h.html#af6428878db94a4adf8136850e6a654f5">ast_unlock_path</a>(directory);</div><div class="line"><a name="l03344"></a><span class="lineno"> 3344</span>&#160;      <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(2, <span class="stringliteral">&quot;MINIVM Counter %s/%s: Value %d\n&quot;</span>, directory, countername, counter);</div><div class="line"><a name="l03345"></a><span class="lineno"> 3345</span>&#160;      <span class="keywordflow">return</span> counter;</div><div class="line"><a name="l03346"></a><span class="lineno"> 3346</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l03347"></a><span class="lineno"> 3347</span>&#160;   <span class="keywordflow">case</span> 1: <span class="comment">/* Set new value */</span></div><div class="line"><a name="l03348"></a><span class="lineno"> 3348</span>&#160;      counter = <a class="code" href="../../d4/d2f/syslog_8c.html#ac4f474c82e82cbb89ca7c36dd52be0ed">value</a>;</div><div class="line"><a name="l03349"></a><span class="lineno"> 3349</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l03350"></a><span class="lineno"> 3350</span>&#160;   <span class="keywordflow">case</span> 2: <span class="comment">/* Change value */</span></div><div class="line"><a name="l03351"></a><span class="lineno"> 3351</span>&#160;      counter += <a class="code" href="../../d4/d2f/syslog_8c.html#ac4f474c82e82cbb89ca7c36dd52be0ed">value</a>;</div><div class="line"><a name="l03352"></a><span class="lineno"> 3352</span>&#160;      <span class="keywordflow">if</span> (counter &lt; 0)  <span class="comment">/* Don&#39;t allow counters to fall below zero */</span></div><div class="line"><a name="l03353"></a><span class="lineno"> 3353</span>&#160;         counter = 0;</div><div class="line"><a name="l03354"></a><span class="lineno"> 3354</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l03355"></a><span class="lineno"> 3355</span>&#160;   }</div><div class="line"><a name="l03356"></a><span class="lineno"> 3356</span>&#160;</div><div class="line"><a name="l03357"></a><span class="lineno"> 3357</span>&#160;   <span class="comment">/* Now, write the new value to the file */</span></div><div class="line"><a name="l03358"></a><span class="lineno"> 3358</span>&#160;   counterfile = fopen(filename, <span class="stringliteral">&quot;w&quot;</span>);</div><div class="line"><a name="l03359"></a><span class="lineno"> 3359</span>&#160;   <span class="keywordflow">if</span> (!counterfile) {</div><div class="line"><a name="l03360"></a><span class="lineno"> 3360</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Could not open counter file for writing : %s - %s\n&quot;</span>, filename, strerror(<a class="code" href="../../d1/d6e/main_2stdtime_2private_8h.html#ad65a8842cc674e3ddf69355898c0ecbf">errno</a>));</div><div class="line"><a name="l03361"></a><span class="lineno"> 3361</span>&#160;      <a class="code" href="../../d3/d93/include_2asterisk_2app_8h.html#af6428878db94a4adf8136850e6a654f5">ast_unlock_path</a>(directory);</div><div class="line"><a name="l03362"></a><span class="lineno"> 3362</span>&#160;      <span class="keywordflow">return</span> -1;  <span class="comment">/* Could not open file for writing */</span></div><div class="line"><a name="l03363"></a><span class="lineno"> 3363</span>&#160;   }</div><div class="line"><a name="l03364"></a><span class="lineno"> 3364</span>&#160;   fprintf(counterfile, <span class="stringliteral">&quot;%d\n\n&quot;</span>, counter);</div><div class="line"><a name="l03365"></a><span class="lineno"> 3365</span>&#160;   fclose(counterfile);</div><div class="line"><a name="l03366"></a><span class="lineno"> 3366</span>&#160;   <a class="code" href="../../d3/d93/include_2asterisk_2app_8h.html#af6428878db94a4adf8136850e6a654f5">ast_unlock_path</a>(directory);</div><div class="line"><a name="l03367"></a><span class="lineno"> 3367</span>&#160;   <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(2, <span class="stringliteral">&quot;MINIVM Counter %s/%s: Old value %d New value %d\n&quot;</span>, directory, countername, old, counter);</div><div class="line"><a name="l03368"></a><span class="lineno"> 3368</span>&#160;   <span class="keywordflow">return</span> counter;</div><div class="line"><a name="l03369"></a><span class="lineno"> 3369</span>&#160;}</div><div class="line"><a name="l03370"></a><span class="lineno"> 3370</span>&#160;<span class="comment"></span></div><div class="line"><a name="l03371"></a><span class="lineno"> 3371</span>&#160;<span class="comment">/*! \brief  ${MINIVMCOUNTER()} Dialplan function - read counters */</span></div><div class="line"><a name="l03372"></a><span class="lineno"><a class="line" href="../../de/dfe/app__minivm_8c.html#a5119f16369105e022da7c1f72f328abc"> 3372</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../de/dfe/app__minivm_8c.html#a5119f16369105e022da7c1f72f328abc">minivm_counter_func_read</a>(<span class="keyword">struct</span> <a class="code" href="../../df/d3c/structast__channel.html">ast_channel</a> *chan, <span class="keyword">const</span> <span class="keywordtype">char</span> *cmd, <span class="keywordtype">char</span> *data, <span class="keywordtype">char</span> *<a class="code" href="../../dd/d7c/eagi__proxy_8c.html#ac95651d79c608a3148973b5b1fc9e525">buf</a>, <span class="keywordtype">size_t</span> <a class="code" href="../../d9/d1e/func__strings_8c.html#af24e73aaf92f3000fda15d285e66df24">len</a>)</div><div class="line"><a name="l03373"></a><span class="lineno"> 3373</span>&#160;{</div><div class="line"><a name="l03374"></a><span class="lineno"> 3374</span>&#160;   <span class="keywordtype">char</span> *<a class="code" href="../../dc/d7b/structminivm__account.html#a4b30874d24514b5ef6ff5276e8c12ed4">username</a>, *<a class="code" href="../../dc/d7b/structminivm__account.html#ae43ea5d0335f149f0920d33e46b61c33">domain</a>, *countername;</div><div class="line"><a name="l03375"></a><span class="lineno"> 3375</span>&#160;   <span class="keywordtype">char</span> userpath[BUFSIZ];</div><div class="line"><a name="l03376"></a><span class="lineno"> 3376</span>&#160;   <span class="keywordtype">int</span> res;</div><div class="line"><a name="l03377"></a><span class="lineno"> 3377</span>&#160;</div><div class="line"><a name="l03378"></a><span class="lineno"> 3378</span>&#160;   *buf = <span class="charliteral">&#39;\0&#39;</span>;</div><div class="line"><a name="l03379"></a><span class="lineno"> 3379</span>&#160;</div><div class="line"><a name="l03380"></a><span class="lineno"> 3380</span>&#160;   username = <a class="code" href="../../d8/d8a/astmm_8h.html#ab5f0750cc80ba337fdcbddea2d3a1ee6">ast_strdupa</a>(data);</div><div class="line"><a name="l03381"></a><span class="lineno"> 3381</span>&#160;</div><div class="line"><a name="l03382"></a><span class="lineno"> 3382</span>&#160;   <span class="keywordflow">if</span> ((countername = strchr(username, <span class="charliteral">&#39;:&#39;</span>))) {</div><div class="line"><a name="l03383"></a><span class="lineno"> 3383</span>&#160;      *countername = <span class="charliteral">&#39;\0&#39;</span>;</div><div class="line"><a name="l03384"></a><span class="lineno"> 3384</span>&#160;      countername++;</div><div class="line"><a name="l03385"></a><span class="lineno"> 3385</span>&#160;   }</div><div class="line"><a name="l03386"></a><span class="lineno"> 3386</span>&#160;</div><div class="line"><a name="l03387"></a><span class="lineno"> 3387</span>&#160;   <span class="keywordflow">if</span> ((domain = strchr(username, <span class="charliteral">&#39;@&#39;</span>))) {</div><div class="line"><a name="l03388"></a><span class="lineno"> 3388</span>&#160;      *domain = <span class="charliteral">&#39;\0&#39;</span>;</div><div class="line"><a name="l03389"></a><span class="lineno"> 3389</span>&#160;      domain++;</div><div class="line"><a name="l03390"></a><span class="lineno"> 3390</span>&#160;   }</div><div class="line"><a name="l03391"></a><span class="lineno"> 3391</span>&#160;</div><div class="line"><a name="l03392"></a><span class="lineno"> 3392</span>&#160;   <span class="comment">/* If we have neither username nor domain now, let&#39;s give up */</span></div><div class="line"><a name="l03393"></a><span class="lineno"> 3393</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a>(username) &amp;&amp; <a class="code" href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a>(domain)) {</div><div class="line"><a name="l03394"></a><span class="lineno"> 3394</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;No account given\n&quot;</span>);</div><div class="line"><a name="l03395"></a><span class="lineno"> 3395</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l03396"></a><span class="lineno"> 3396</span>&#160;   }</div><div class="line"><a name="l03397"></a><span class="lineno"> 3397</span>&#160;</div><div class="line"><a name="l03398"></a><span class="lineno"> 3398</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a>(countername)) {</div><div class="line"><a name="l03399"></a><span class="lineno"> 3399</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;This function needs two arguments: Account:countername\n&quot;</span>);</div><div class="line"><a name="l03400"></a><span class="lineno"> 3400</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l03401"></a><span class="lineno"> 3401</span>&#160;   }</div><div class="line"><a name="l03402"></a><span class="lineno"> 3402</span>&#160;</div><div class="line"><a name="l03403"></a><span class="lineno"> 3403</span>&#160;   <span class="comment">/* We only have a domain, no username */</span></div><div class="line"><a name="l03404"></a><span class="lineno"> 3404</span>&#160;   <span class="keywordflow">if</span> (!<a class="code" href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a>(username) &amp;&amp; <a class="code" href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a>(domain)) {</div><div class="line"><a name="l03405"></a><span class="lineno"> 3405</span>&#160;      domain = <a class="code" href="../../dc/d7b/structminivm__account.html#a4b30874d24514b5ef6ff5276e8c12ed4">username</a>;</div><div class="line"><a name="l03406"></a><span class="lineno"> 3406</span>&#160;      username = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l03407"></a><span class="lineno"> 3407</span>&#160;   }</div><div class="line"><a name="l03408"></a><span class="lineno"> 3408</span>&#160;</div><div class="line"><a name="l03409"></a><span class="lineno"> 3409</span>&#160;   <span class="comment">/* If we can&#39;t find account or if the account is temporary, return. */</span></div><div class="line"><a name="l03410"></a><span class="lineno"> 3410</span>&#160;   <span class="keywordflow">if</span> (!<a class="code" href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a>(username) &amp;&amp; !<a class="code" href="../../de/dfe/app__minivm_8c.html#ac26055cad7a69cbfb6692d273f025a40">find_account</a>(domain, username, <a class="code" href="../../de/dfe/app__minivm_8c.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>)) {</div><div class="line"><a name="l03411"></a><span class="lineno"> 3411</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Minivm account does not exist: %s@%s\n&quot;</span>, username, domain);</div><div class="line"><a name="l03412"></a><span class="lineno"> 3412</span>&#160;      <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l03413"></a><span class="lineno"> 3413</span>&#160;   }</div><div class="line"><a name="l03414"></a><span class="lineno"> 3414</span>&#160;</div><div class="line"><a name="l03415"></a><span class="lineno"> 3415</span>&#160;   <a class="code" href="../../de/dfe/app__minivm_8c.html#ac6ccbdf4443ab9722a13578d17b1f7da">create_dirpath</a>(userpath, <span class="keyword">sizeof</span>(userpath), domain, username, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div><div class="line"><a name="l03416"></a><span class="lineno"> 3416</span>&#160;</div><div class="line"><a name="l03417"></a><span class="lineno"> 3417</span>&#160;   <span class="comment">/* We have the path, now read the counter file */</span></div><div class="line"><a name="l03418"></a><span class="lineno"> 3418</span>&#160;   res = <a class="code" href="../../de/dfe/app__minivm_8c.html#af02d84a63641abcd8bfd43897789a156">access_counter_file</a>(userpath, countername, 0, 0);</div><div class="line"><a name="l03419"></a><span class="lineno"> 3419</span>&#160;   <span class="keywordflow">if</span> (res &gt;= 0)</div><div class="line"><a name="l03420"></a><span class="lineno"> 3420</span>&#160;      snprintf(buf, len, <span class="stringliteral">&quot;%d&quot;</span>, res);</div><div class="line"><a name="l03421"></a><span class="lineno"> 3421</span>&#160;   <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l03422"></a><span class="lineno"> 3422</span>&#160;}</div><div class="line"><a name="l03423"></a><span class="lineno"> 3423</span>&#160;<span class="comment"></span></div><div class="line"><a name="l03424"></a><span class="lineno"> 3424</span>&#160;<span class="comment">/*! \brief  ${MINIVMCOUNTER()} Dialplan function - changes counter data */</span></div><div class="line"><a name="l03425"></a><span class="lineno"><a class="line" href="../../de/dfe/app__minivm_8c.html#ae6f6a409b48dabe35f6faa711d246224"> 3425</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../de/dfe/app__minivm_8c.html#ae6f6a409b48dabe35f6faa711d246224">minivm_counter_func_write</a>(<span class="keyword">struct</span> <a class="code" href="../../df/d3c/structast__channel.html">ast_channel</a> *chan, <span class="keyword">const</span> <span class="keywordtype">char</span> *cmd, <span class="keywordtype">char</span> *data, <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="../../d4/d2f/syslog_8c.html#ac4f474c82e82cbb89ca7c36dd52be0ed">value</a>)</div><div class="line"><a name="l03426"></a><span class="lineno"> 3426</span>&#160;{</div><div class="line"><a name="l03427"></a><span class="lineno"> 3427</span>&#160;   <span class="keywordtype">char</span> *<a class="code" href="../../dc/d7b/structminivm__account.html#a4b30874d24514b5ef6ff5276e8c12ed4">username</a>, *<a class="code" href="../../dc/d7b/structminivm__account.html#ae43ea5d0335f149f0920d33e46b61c33">domain</a>, *countername, *operand;</div><div class="line"><a name="l03428"></a><span class="lineno"> 3428</span>&#160;   <span class="keywordtype">char</span> userpath[BUFSIZ];</div><div class="line"><a name="l03429"></a><span class="lineno"> 3429</span>&#160;   <span class="keywordtype">int</span> change = 0;</div><div class="line"><a name="l03430"></a><span class="lineno"> 3430</span>&#160;   <span class="keywordtype">int</span> operation = 0;</div><div class="line"><a name="l03431"></a><span class="lineno"> 3431</span>&#160;</div><div class="line"><a name="l03432"></a><span class="lineno"> 3432</span>&#160;   <span class="keywordflow">if</span>(!value)</div><div class="line"><a name="l03433"></a><span class="lineno"> 3433</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l03434"></a><span class="lineno"> 3434</span>&#160;   change = atoi(value);</div><div class="line"><a name="l03435"></a><span class="lineno"> 3435</span>&#160;</div><div class="line"><a name="l03436"></a><span class="lineno"> 3436</span>&#160;   username = <a class="code" href="../../d8/d8a/astmm_8h.html#ab5f0750cc80ba337fdcbddea2d3a1ee6">ast_strdupa</a>(data);</div><div class="line"><a name="l03437"></a><span class="lineno"> 3437</span>&#160;</div><div class="line"><a name="l03438"></a><span class="lineno"> 3438</span>&#160;   <span class="keywordflow">if</span> ((countername = strchr(username, <span class="charliteral">&#39;:&#39;</span>))) {</div><div class="line"><a name="l03439"></a><span class="lineno"> 3439</span>&#160;      *countername = <span class="charliteral">&#39;\0&#39;</span>;</div><div class="line"><a name="l03440"></a><span class="lineno"> 3440</span>&#160;      countername++;</div><div class="line"><a name="l03441"></a><span class="lineno"> 3441</span>&#160;   }</div><div class="line"><a name="l03442"></a><span class="lineno"> 3442</span>&#160;   <span class="keywordflow">if</span> ((operand = strchr(countername, <span class="charliteral">&#39;:&#39;</span>))) {</div><div class="line"><a name="l03443"></a><span class="lineno"> 3443</span>&#160;      *operand = <span class="charliteral">&#39;\0&#39;</span>;</div><div class="line"><a name="l03444"></a><span class="lineno"> 3444</span>&#160;      operand++;</div><div class="line"><a name="l03445"></a><span class="lineno"> 3445</span>&#160;   }</div><div class="line"><a name="l03446"></a><span class="lineno"> 3446</span>&#160;</div><div class="line"><a name="l03447"></a><span class="lineno"> 3447</span>&#160;   <span class="keywordflow">if</span> ((domain = strchr(username, <span class="charliteral">&#39;@&#39;</span>))) {</div><div class="line"><a name="l03448"></a><span class="lineno"> 3448</span>&#160;      *domain = <span class="charliteral">&#39;\0&#39;</span>;</div><div class="line"><a name="l03449"></a><span class="lineno"> 3449</span>&#160;      domain++;</div><div class="line"><a name="l03450"></a><span class="lineno"> 3450</span>&#160;   }</div><div class="line"><a name="l03451"></a><span class="lineno"> 3451</span>&#160;</div><div class="line"><a name="l03452"></a><span class="lineno"> 3452</span>&#160;   <span class="comment">/* If we have neither username nor domain now, let&#39;s give up */</span></div><div class="line"><a name="l03453"></a><span class="lineno"> 3453</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a>(username) &amp;&amp; <a class="code" href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a>(domain)) {</div><div class="line"><a name="l03454"></a><span class="lineno"> 3454</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;No account given\n&quot;</span>);</div><div class="line"><a name="l03455"></a><span class="lineno"> 3455</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l03456"></a><span class="lineno"> 3456</span>&#160;   }</div><div class="line"><a name="l03457"></a><span class="lineno"> 3457</span>&#160;</div><div class="line"><a name="l03458"></a><span class="lineno"> 3458</span>&#160;   <span class="comment">/* We only have a domain, no username */</span></div><div class="line"><a name="l03459"></a><span class="lineno"> 3459</span>&#160;   <span class="keywordflow">if</span> (!<a class="code" href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a>(username) &amp;&amp; <a class="code" href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a>(domain)) {</div><div class="line"><a name="l03460"></a><span class="lineno"> 3460</span>&#160;      domain = <a class="code" href="../../dc/d7b/structminivm__account.html#a4b30874d24514b5ef6ff5276e8c12ed4">username</a>;</div><div class="line"><a name="l03461"></a><span class="lineno"> 3461</span>&#160;      username = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l03462"></a><span class="lineno"> 3462</span>&#160;   }</div><div class="line"><a name="l03463"></a><span class="lineno"> 3463</span>&#160;</div><div class="line"><a name="l03464"></a><span class="lineno"> 3464</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a>(operand) || <a class="code" href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a>(countername)) {</div><div class="line"><a name="l03465"></a><span class="lineno"> 3465</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Writing to this function requires three arguments: Account:countername:operand\n&quot;</span>);</div><div class="line"><a name="l03466"></a><span class="lineno"> 3466</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l03467"></a><span class="lineno"> 3467</span>&#160;   }</div><div class="line"><a name="l03468"></a><span class="lineno"> 3468</span>&#160;</div><div class="line"><a name="l03469"></a><span class="lineno"> 3469</span>&#160;   <span class="comment">/* If we can&#39;t find account or if the account is temporary, return. */</span></div><div class="line"><a name="l03470"></a><span class="lineno"> 3470</span>&#160;   <span class="keywordflow">if</span> (!<a class="code" href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a>(username) &amp;&amp; !<a class="code" href="../../de/dfe/app__minivm_8c.html#ac26055cad7a69cbfb6692d273f025a40">find_account</a>(domain, username, <a class="code" href="../../de/dfe/app__minivm_8c.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>)) {</div><div class="line"><a name="l03471"></a><span class="lineno"> 3471</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Minivm account does not exist: %s@%s\n&quot;</span>, username, domain);</div><div class="line"><a name="l03472"></a><span class="lineno"> 3472</span>&#160;      <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l03473"></a><span class="lineno"> 3473</span>&#160;   }</div><div class="line"><a name="l03474"></a><span class="lineno"> 3474</span>&#160;</div><div class="line"><a name="l03475"></a><span class="lineno"> 3475</span>&#160;   <a class="code" href="../../de/dfe/app__minivm_8c.html#ac6ccbdf4443ab9722a13578d17b1f7da">create_dirpath</a>(userpath, <span class="keyword">sizeof</span>(userpath), domain, username, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div><div class="line"><a name="l03476"></a><span class="lineno"> 3476</span>&#160;   <span class="comment">/* Now, find out our operator */</span></div><div class="line"><a name="l03477"></a><span class="lineno"> 3477</span>&#160;   <span class="keywordflow">if</span> (*operand == <span class="charliteral">&#39;i&#39;</span>) <span class="comment">/* Increment */</span></div><div class="line"><a name="l03478"></a><span class="lineno"> 3478</span>&#160;      operation = 2;</div><div class="line"><a name="l03479"></a><span class="lineno"> 3479</span>&#160;   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (*operand == <span class="charliteral">&#39;d&#39;</span>) {</div><div class="line"><a name="l03480"></a><span class="lineno"> 3480</span>&#160;      change = change * -1;</div><div class="line"><a name="l03481"></a><span class="lineno"> 3481</span>&#160;      operation = 2;</div><div class="line"><a name="l03482"></a><span class="lineno"> 3482</span>&#160;   } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (*operand == <span class="charliteral">&#39;s&#39;</span>)</div><div class="line"><a name="l03483"></a><span class="lineno"> 3483</span>&#160;      operation = 1;</div><div class="line"><a name="l03484"></a><span class="lineno"> 3484</span>&#160;   <span class="keywordflow">else</span> {</div><div class="line"><a name="l03485"></a><span class="lineno"> 3485</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Unknown operator: %s\n&quot;</span>, operand);</div><div class="line"><a name="l03486"></a><span class="lineno"> 3486</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l03487"></a><span class="lineno"> 3487</span>&#160;   }</div><div class="line"><a name="l03488"></a><span class="lineno"> 3488</span>&#160;</div><div class="line"><a name="l03489"></a><span class="lineno"> 3489</span>&#160;   <span class="comment">/* We have the path, now read the counter file */</span></div><div class="line"><a name="l03490"></a><span class="lineno"> 3490</span>&#160;   <a class="code" href="../../de/dfe/app__minivm_8c.html#af02d84a63641abcd8bfd43897789a156">access_counter_file</a>(userpath, countername, change, operation);</div><div class="line"><a name="l03491"></a><span class="lineno"> 3491</span>&#160;   <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l03492"></a><span class="lineno"> 3492</span>&#160;}</div><div class="line"><a name="l03493"></a><span class="lineno"> 3493</span>&#160;</div><div class="line"><a name="l03494"></a><span class="lineno"> 3494</span>&#160;<span class="comment"></span></div><div class="line"><a name="l03495"></a><span class="lineno"> 3495</span>&#160;<span class="comment">/*! \brief CLI commands for Mini-voicemail */</span></div><div class="line"><a name="l03496"></a><span class="lineno"><a class="line" href="../../de/dfe/app__minivm_8c.html#abb1f2fda603b171867df08ff617507c5"> 3496</a></span>&#160;<span class="keyword">static</span> <span class="keyword">struct </span><a class="code" href="../../d8/d07/structast__cli__entry.html">ast_cli_entry</a> <a class="code" href="../../de/dfe/app__minivm_8c.html#abb1f2fda603b171867df08ff617507c5">cli_minivm</a>[] = {</div><div class="line"><a name="l03497"></a><span class="lineno"> 3497</span>&#160;   <a class="code" href="../../dc/db0/cli_8h.html#a5c4130cf8f1e93acfdd84416cebf1aef">AST_CLI_DEFINE</a>(<a class="code" href="../../de/dfe/app__minivm_8c.html#a0146ffac26c0f9881220edd88adcdc0a">handle_minivm_show_users</a>, <span class="stringliteral">&quot;List defined mini-voicemail boxes&quot;</span>),</div><div class="line"><a name="l03498"></a><span class="lineno"> 3498</span>&#160;   <a class="code" href="../../dc/db0/cli_8h.html#a5c4130cf8f1e93acfdd84416cebf1aef">AST_CLI_DEFINE</a>(<a class="code" href="../../de/dfe/app__minivm_8c.html#a9e4e37c5e52de40a691334edf1f7d759">handle_minivm_show_zones</a>, <span class="stringliteral">&quot;List zone message formats&quot;</span>),</div><div class="line"><a name="l03499"></a><span class="lineno"> 3499</span>&#160;   <a class="code" href="../../dc/db0/cli_8h.html#a5c4130cf8f1e93acfdd84416cebf1aef">AST_CLI_DEFINE</a>(<a class="code" href="../../de/dfe/app__minivm_8c.html#a6d1e86507023ca3f6dd4ad1dfb4ff96e">handle_minivm_list_templates</a>, <span class="stringliteral">&quot;List message templates&quot;</span>),</div><div class="line"><a name="l03500"></a><span class="lineno"> 3500</span>&#160;   <a class="code" href="../../dc/db0/cli_8h.html#a5c4130cf8f1e93acfdd84416cebf1aef">AST_CLI_DEFINE</a>(<a class="code" href="../../de/dfe/app__minivm_8c.html#a7515f8088d13c05182c54d43de777547">handle_minivm_reload</a>, <span class="stringliteral">&quot;Reload Mini-voicemail configuration&quot;</span>),</div><div class="line"><a name="l03501"></a><span class="lineno"> 3501</span>&#160;   <a class="code" href="../../dc/db0/cli_8h.html#a5c4130cf8f1e93acfdd84416cebf1aef">AST_CLI_DEFINE</a>(<a class="code" href="../../de/dfe/app__minivm_8c.html#a2091dc4ee24682aee893c0633da31eca">handle_minivm_show_stats</a>, <span class="stringliteral">&quot;Show some mini-voicemail statistics&quot;</span>),</div><div class="line"><a name="l03502"></a><span class="lineno"> 3502</span>&#160;   <a class="code" href="../../dc/db0/cli_8h.html#a5c4130cf8f1e93acfdd84416cebf1aef">AST_CLI_DEFINE</a>(<a class="code" href="../../de/dfe/app__minivm_8c.html#adbac9975e6eca260a8cf807a604d8e8b">handle_minivm_show_settings</a>, <span class="stringliteral">&quot;Show mini-voicemail general settings&quot;</span>),</div><div class="line"><a name="l03503"></a><span class="lineno"> 3503</span>&#160;};</div><div class="line"><a name="l03504"></a><span class="lineno"> 3504</span>&#160;</div><div class="line"><a name="l03505"></a><span class="lineno"><a class="line" href="../../de/dfe/app__minivm_8c.html#adff16a51cb3b033013640db28e98ef95"> 3505</a></span>&#160;<span class="keyword">static</span> <span class="keyword">struct </span><a class="code" href="../../db/dc0/structast__custom__function.html">ast_custom_function</a> <a class="code" href="../../de/dfe/app__minivm_8c.html#adff16a51cb3b033013640db28e98ef95">minivm_counter_function</a> = {</div><div class="line"><a name="l03506"></a><span class="lineno"> 3506</span>&#160;   .<a class="code" href="../../db/dc0/structast__custom__function.html#afcd1706c9144e6d6eee6127661ae3be2">name</a> = <span class="stringliteral">&quot;MINIVMCOUNTER&quot;</span>,</div><div class="line"><a name="l03507"></a><span class="lineno"> 3507</span>&#160;   .read = <a class="code" href="../../de/dfe/app__minivm_8c.html#a5119f16369105e022da7c1f72f328abc">minivm_counter_func_read</a>,</div><div class="line"><a name="l03508"></a><span class="lineno"> 3508</span>&#160;   .write = <a class="code" href="../../de/dfe/app__minivm_8c.html#ae6f6a409b48dabe35f6faa711d246224">minivm_counter_func_write</a>,</div><div class="line"><a name="l03509"></a><span class="lineno"> 3509</span>&#160;};</div><div class="line"><a name="l03510"></a><span class="lineno"> 3510</span>&#160;</div><div class="line"><a name="l03511"></a><span class="lineno"><a class="line" href="../../de/dfe/app__minivm_8c.html#a43122a9830eb2a7234cf0994c3dc9627"> 3511</a></span>&#160;<span class="keyword">static</span> <span class="keyword">struct </span><a class="code" href="../../db/dc0/structast__custom__function.html">ast_custom_function</a> <a class="code" href="../../de/dfe/app__minivm_8c.html#a43122a9830eb2a7234cf0994c3dc9627">minivm_account_function</a> = {</div><div class="line"><a name="l03512"></a><span class="lineno"> 3512</span>&#160;   .<a class="code" href="../../db/dc0/structast__custom__function.html#afcd1706c9144e6d6eee6127661ae3be2">name</a> = <span class="stringliteral">&quot;MINIVMACCOUNT&quot;</span>,</div><div class="line"><a name="l03513"></a><span class="lineno"> 3513</span>&#160;   .read = <a class="code" href="../../de/dfe/app__minivm_8c.html#a42e341d5d3dd48f5afc05b9f5045467d">minivm_account_func_read</a>,</div><div class="line"><a name="l03514"></a><span class="lineno"> 3514</span>&#160;};</div><div class="line"><a name="l03515"></a><span class="lineno"> 3515</span>&#160;<span class="comment"></span></div><div class="line"><a name="l03516"></a><span class="lineno"> 3516</span>&#160;<span class="comment">/*! \brief Load mini voicemail module */</span></div><div class="line"><a name="l03517"></a><span class="lineno"><a class="line" href="../../de/dfe/app__minivm_8c.html#ac3382bf6da54c56b37069bd76bbdf4f9"> 3517</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../de/dfe/app__minivm_8c.html#ac3382bf6da54c56b37069bd76bbdf4f9">load_module</a>(<span class="keywordtype">void</span>)</div><div class="line"><a name="l03518"></a><span class="lineno"> 3518</span>&#160;{</div><div class="line"><a name="l03519"></a><span class="lineno"> 3519</span>&#160;   <span class="keywordtype">int</span> res;</div><div class="line"><a name="l03520"></a><span class="lineno"> 3520</span>&#160;</div><div class="line"><a name="l03521"></a><span class="lineno"> 3521</span>&#160;   res = <a class="code" href="../../d5/d16/module_8h.html#afba4eb7a910b10969041ae4cd488729d">ast_register_application_xml</a>(<a class="code" href="../../de/dfe/app__minivm_8c.html#abcbed0b94b212f947f3acdfcd6fa82ba">app_minivm_record</a>, <a class="code" href="../../de/dfe/app__minivm_8c.html#a26e1aa3cbc892fb673e775c75bb67fe3">minivm_record_exec</a>);</div><div class="line"><a name="l03522"></a><span class="lineno"> 3522</span>&#160;   res = <a class="code" href="../../d5/d16/module_8h.html#afba4eb7a910b10969041ae4cd488729d">ast_register_application_xml</a>(<a class="code" href="../../de/dfe/app__minivm_8c.html#a32fdccfe778fa730f0e0cb1e57299064">app_minivm_greet</a>, <a class="code" href="../../de/dfe/app__minivm_8c.html#ad0721ec90e8e85dd4d3a4741df493dc3">minivm_greet_exec</a>);</div><div class="line"><a name="l03523"></a><span class="lineno"> 3523</span>&#160;   res = <a class="code" href="../../d5/d16/module_8h.html#afba4eb7a910b10969041ae4cd488729d">ast_register_application_xml</a>(<a class="code" href="../../de/dfe/app__minivm_8c.html#aa4ee01c44f3a162c943125869e95bcca">app_minivm_notify</a>, <a class="code" href="../../de/dfe/app__minivm_8c.html#a273c55efb0bbc772f28cddd2d4bb97c7">minivm_notify_exec</a>);</div><div class="line"><a name="l03524"></a><span class="lineno"> 3524</span>&#160;   res = <a class="code" href="../../d5/d16/module_8h.html#afba4eb7a910b10969041ae4cd488729d">ast_register_application_xml</a>(<a class="code" href="../../de/dfe/app__minivm_8c.html#a2e550cc7a2a2a5a8f72f567caa072844">app_minivm_delete</a>, <a class="code" href="../../de/dfe/app__minivm_8c.html#a59d95e558fe740e7070d090fc299f50d">minivm_delete_exec</a>);</div><div class="line"><a name="l03525"></a><span class="lineno"> 3525</span>&#160;   res = <a class="code" href="../../d5/d16/module_8h.html#afba4eb7a910b10969041ae4cd488729d">ast_register_application_xml</a>(<a class="code" href="../../de/dfe/app__minivm_8c.html#ac0439b6869f845808de3ac7e0d37e1c4">app_minivm_accmess</a>, <a class="code" href="../../de/dfe/app__minivm_8c.html#a7ef5e4ff24ab0c8d72e5c464022ee95a">minivm_accmess_exec</a>);</div><div class="line"><a name="l03526"></a><span class="lineno"> 3526</span>&#160;   res = <a class="code" href="../../d5/d16/module_8h.html#afba4eb7a910b10969041ae4cd488729d">ast_register_application_xml</a>(<a class="code" href="../../de/dfe/app__minivm_8c.html#af8b65ae2fa0c59765887e094566196bf">app_minivm_mwi</a>, <a class="code" href="../../de/dfe/app__minivm_8c.html#a699f6a5bd7a67eb7b46ad192873e3c73">minivm_mwi_exec</a>);</div><div class="line"><a name="l03527"></a><span class="lineno"> 3527</span>&#160;</div><div class="line"><a name="l03528"></a><span class="lineno"> 3528</span>&#160;   <a class="code" href="../../db/de0/pbx_8h.html#a8af0e93442a9e468425f63cc52b0ac7b">ast_custom_function_register</a>(&amp;minivm_account_function);</div><div class="line"><a name="l03529"></a><span class="lineno"> 3529</span>&#160;   <a class="code" href="../../db/de0/pbx_8h.html#a8af0e93442a9e468425f63cc52b0ac7b">ast_custom_function_register</a>(&amp;minivm_counter_function);</div><div class="line"><a name="l03530"></a><span class="lineno"> 3530</span>&#160;   <span class="keywordflow">if</span> (res)</div><div class="line"><a name="l03531"></a><span class="lineno"> 3531</span>&#160;      <span class="keywordflow">return</span>(res);</div><div class="line"><a name="l03532"></a><span class="lineno"> 3532</span>&#160;</div><div class="line"><a name="l03533"></a><span class="lineno"> 3533</span>&#160;   <span class="keywordflow">if</span> ((res = <a class="code" href="../../de/dfe/app__minivm_8c.html#ad0f6114d9cab58a8ec3d9555cb466534">load_config</a>(0)))</div><div class="line"><a name="l03534"></a><span class="lineno"> 3534</span>&#160;      <span class="keywordflow">return</span>(res);</div><div class="line"><a name="l03535"></a><span class="lineno"> 3535</span>&#160;</div><div class="line"><a name="l03536"></a><span class="lineno"> 3536</span>&#160;   <a class="code" href="../../dc/db0/cli_8h.html#aea8910ed9e301e7f741f87942c244eac">ast_cli_register_multiple</a>(cli_minivm, <a class="code" href="../../de/dfe/isdn__lib_8c.html#ab9129b977a587b50ea801daac75e178f">ARRAY_LEN</a>(cli_minivm));</div><div class="line"><a name="l03537"></a><span class="lineno"> 3537</span>&#160;</div><div class="line"><a name="l03538"></a><span class="lineno"> 3538</span>&#160;   <span class="comment">/* compute the location of the voicemail spool directory */</span></div><div class="line"><a name="l03539"></a><span class="lineno"> 3539</span>&#160;   snprintf(<a class="code" href="../../de/dfe/app__minivm_8c.html#ab94d2ef3acf22b2bf9410c48462c7cb1">MVM_SPOOL_DIR</a>, <span class="keyword">sizeof</span>(<a class="code" href="../../de/dfe/app__minivm_8c.html#ab94d2ef3acf22b2bf9410c48462c7cb1">MVM_SPOOL_DIR</a>), <span class="stringliteral">&quot;%s/voicemail/&quot;</span>, <a class="code" href="../../dd/df2/paths_8h.html#a95c5b4ffe620dc96d1ea9311b35c4d4f">ast_config_AST_SPOOL_DIR</a>);</div><div class="line"><a name="l03540"></a><span class="lineno"> 3540</span>&#160;</div><div class="line"><a name="l03541"></a><span class="lineno"> 3541</span>&#160;   <span class="keywordflow">return</span> res;</div><div class="line"><a name="l03542"></a><span class="lineno"> 3542</span>&#160;}</div><div class="line"><a name="l03543"></a><span class="lineno"> 3543</span>&#160;<span class="comment"></span></div><div class="line"><a name="l03544"></a><span class="lineno"> 3544</span>&#160;<span class="comment">/*! \brief Reload mini voicemail module */</span></div><div class="line"><a name="l03545"></a><span class="lineno"><a class="line" href="../../de/dfe/app__minivm_8c.html#ad1982509765f4870f1f63412a53ea668"> 3545</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../de/dfe/app__minivm_8c.html#ad1982509765f4870f1f63412a53ea668">reload</a>(<span class="keywordtype">void</span>)</div><div class="line"><a name="l03546"></a><span class="lineno"> 3546</span>&#160;{</div><div class="line"><a name="l03547"></a><span class="lineno"> 3547</span>&#160;   <span class="keywordflow">return</span>(<a class="code" href="../../de/dfe/app__minivm_8c.html#ad0f6114d9cab58a8ec3d9555cb466534">load_config</a>(1));</div><div class="line"><a name="l03548"></a><span class="lineno"> 3548</span>&#160;}</div><div class="line"><a name="l03549"></a><span class="lineno"> 3549</span>&#160;<span class="comment"></span></div><div class="line"><a name="l03550"></a><span class="lineno"> 3550</span>&#160;<span class="comment">/*! \brief Reload cofiguration */</span></div><div class="line"><a name="l03551"></a><span class="lineno"><a class="line" href="../../de/dfe/app__minivm_8c.html#a7515f8088d13c05182c54d43de777547"> 3551</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">char</span> *<a class="code" href="../../de/dfe/app__minivm_8c.html#a7515f8088d13c05182c54d43de777547">handle_minivm_reload</a>(<span class="keyword">struct</span> <a class="code" href="../../d8/d07/structast__cli__entry.html">ast_cli_entry</a> *e, <span class="keywordtype">int</span> cmd, <span class="keyword">struct</span> <a class="code" href="../../d3/dad/structast__cli__args.html">ast_cli_args</a> *<a class="code" href="../../d7/d6f/test__linkedlists_8c.html#a13dd15487fee89a002d17ef3aff62d02">a</a>)</div><div class="line"><a name="l03552"></a><span class="lineno"> 3552</span>&#160;{</div><div class="line"><a name="l03553"></a><span class="lineno"> 3553</span>&#160;</div><div class="line"><a name="l03554"></a><span class="lineno"> 3554</span>&#160;   <span class="keywordflow">switch</span> (cmd) {</div><div class="line"><a name="l03555"></a><span class="lineno"> 3555</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="../../dc/db0/cli_8h.html#ab33e5350a923c3a8cedbeb496cd88ec9a71745eb63dd093f560a1add3e430d2a9">CLI_INIT</a>:</div><div class="line"><a name="l03556"></a><span class="lineno"> 3556</span>&#160;      e-&gt;<a class="code" href="../../d8/d07/structast__cli__entry.html#ade9cba72805fe52685a1deea307a8e82">command</a> = <span class="stringliteral">&quot;minivm reload&quot;</span>;</div><div class="line"><a name="l03557"></a><span class="lineno"> 3557</span>&#160;      e-&gt;<a class="code" href="../../d8/d07/structast__cli__entry.html#aef1bd6ad890a110b466cb0e8088507a2">usage</a> =</div><div class="line"><a name="l03558"></a><span class="lineno"> 3558</span>&#160;         <span class="stringliteral">&quot;Usage: minivm reload\n&quot;</span></div><div class="line"><a name="l03559"></a><span class="lineno"> 3559</span>&#160;         <span class="stringliteral">&quot;       Reload mini-voicemail configuration and reset statistics\n&quot;</span>;</div><div class="line"><a name="l03560"></a><span class="lineno"> 3560</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l03561"></a><span class="lineno"> 3561</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="../../dc/db0/cli_8h.html#ab33e5350a923c3a8cedbeb496cd88ec9a76bf33139279b03ec1691f2be2d1be40">CLI_GENERATE</a>:</div><div class="line"><a name="l03562"></a><span class="lineno"> 3562</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l03563"></a><span class="lineno"> 3563</span>&#160;   }</div><div class="line"><a name="l03564"></a><span class="lineno"> 3564</span>&#160;</div><div class="line"><a name="l03565"></a><span class="lineno"> 3565</span>&#160;   <a class="code" href="../../de/dfe/app__minivm_8c.html#ad1982509765f4870f1f63412a53ea668">reload</a>();</div><div class="line"><a name="l03566"></a><span class="lineno"> 3566</span>&#160;   <a class="code" href="../../dc/db0/cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#acf64f219885421479997667d2ed3f08a">fd</a>, <span class="stringliteral">&quot;\n-- Mini voicemail re-configured \n&quot;</span>);</div><div class="line"><a name="l03567"></a><span class="lineno"> 3567</span>&#160;   <span class="keywordflow">return</span> <a class="code" href="../../dc/db0/cli_8h.html#a50989f00b32eeb2516a3803cb2ffb766">CLI_SUCCESS</a>;</div><div class="line"><a name="l03568"></a><span class="lineno"> 3568</span>&#160;}</div><div class="line"><a name="l03569"></a><span class="lineno"> 3569</span>&#160;<span class="comment"></span></div><div class="line"><a name="l03570"></a><span class="lineno"> 3570</span>&#160;<span class="comment">/*! \brief Unload mini voicemail module */</span></div><div class="line"><a name="l03571"></a><span class="lineno"><a class="line" href="../../de/dfe/app__minivm_8c.html#ad09fa931f468002152a3cc2d5ce25eae"> 3571</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../de/dfe/app__minivm_8c.html#ad09fa931f468002152a3cc2d5ce25eae">unload_module</a>(<span class="keywordtype">void</span>)</div><div class="line"><a name="l03572"></a><span class="lineno"> 3572</span>&#160;{</div><div class="line"><a name="l03573"></a><span class="lineno"> 3573</span>&#160;   <span class="keywordtype">int</span> res;</div><div class="line"><a name="l03574"></a><span class="lineno"> 3574</span>&#160;</div><div class="line"><a name="l03575"></a><span class="lineno"> 3575</span>&#160;   res = <a class="code" href="../../d5/d16/module_8h.html#ad2ca15621101154f29748cf1dac3c3cf">ast_unregister_application</a>(<a class="code" href="../../de/dfe/app__minivm_8c.html#abcbed0b94b212f947f3acdfcd6fa82ba">app_minivm_record</a>);</div><div class="line"><a name="l03576"></a><span class="lineno"> 3576</span>&#160;   res |= <a class="code" href="../../d5/d16/module_8h.html#ad2ca15621101154f29748cf1dac3c3cf">ast_unregister_application</a>(<a class="code" href="../../de/dfe/app__minivm_8c.html#a32fdccfe778fa730f0e0cb1e57299064">app_minivm_greet</a>);</div><div class="line"><a name="l03577"></a><span class="lineno"> 3577</span>&#160;   res |= <a class="code" href="../../d5/d16/module_8h.html#ad2ca15621101154f29748cf1dac3c3cf">ast_unregister_application</a>(<a class="code" href="../../de/dfe/app__minivm_8c.html#aa4ee01c44f3a162c943125869e95bcca">app_minivm_notify</a>);</div><div class="line"><a name="l03578"></a><span class="lineno"> 3578</span>&#160;   res |= <a class="code" href="../../d5/d16/module_8h.html#ad2ca15621101154f29748cf1dac3c3cf">ast_unregister_application</a>(<a class="code" href="../../de/dfe/app__minivm_8c.html#a2e550cc7a2a2a5a8f72f567caa072844">app_minivm_delete</a>);</div><div class="line"><a name="l03579"></a><span class="lineno"> 3579</span>&#160;   res |= <a class="code" href="../../d5/d16/module_8h.html#ad2ca15621101154f29748cf1dac3c3cf">ast_unregister_application</a>(<a class="code" href="../../de/dfe/app__minivm_8c.html#ac0439b6869f845808de3ac7e0d37e1c4">app_minivm_accmess</a>);</div><div class="line"><a name="l03580"></a><span class="lineno"> 3580</span>&#160;   res |= <a class="code" href="../../d5/d16/module_8h.html#ad2ca15621101154f29748cf1dac3c3cf">ast_unregister_application</a>(<a class="code" href="../../de/dfe/app__minivm_8c.html#af8b65ae2fa0c59765887e094566196bf">app_minivm_mwi</a>);</div><div class="line"><a name="l03581"></a><span class="lineno"> 3581</span>&#160;</div><div class="line"><a name="l03582"></a><span class="lineno"> 3582</span>&#160;   <a class="code" href="../../dc/db0/cli_8h.html#a56b6b59ee2eaa994597a5b0f4e9f9d09">ast_cli_unregister_multiple</a>(cli_minivm, <a class="code" href="../../de/dfe/isdn__lib_8c.html#ab9129b977a587b50ea801daac75e178f">ARRAY_LEN</a>(cli_minivm));</div><div class="line"><a name="l03583"></a><span class="lineno"> 3583</span>&#160;   <a class="code" href="../../db/de0/pbx_8h.html#a965977ea9a3144bc203e0ce7a64680a1">ast_custom_function_unregister</a>(&amp;minivm_account_function);</div><div class="line"><a name="l03584"></a><span class="lineno"> 3584</span>&#160;   <a class="code" href="../../db/de0/pbx_8h.html#a965977ea9a3144bc203e0ce7a64680a1">ast_custom_function_unregister</a>(&amp;minivm_counter_function);</div><div class="line"><a name="l03585"></a><span class="lineno"> 3585</span>&#160;</div><div class="line"><a name="l03586"></a><span class="lineno"> 3586</span>&#160;   <a class="code" href="../../de/dfe/app__minivm_8c.html#a0d7a1f3e3456c97d999bc5586878d15e">message_destroy_list</a>();    <span class="comment">/* Destroy list of voicemail message templates */</span></div><div class="line"><a name="l03587"></a><span class="lineno"> 3587</span>&#160;   <a class="code" href="../../de/dfe/app__minivm_8c.html#a437f2bbc010293e475569ccb2e7643b6">timezone_destroy_list</a>();   <span class="comment">/* Destroy list of timezones */</span></div><div class="line"><a name="l03588"></a><span class="lineno"> 3588</span>&#160;   <a class="code" href="../../de/dfe/app__minivm_8c.html#a967b9e2acf79f774a1649eb1630c89a5">vmaccounts_destroy_list</a>(); <span class="comment">/* Destroy list of voicemail accounts */</span></div><div class="line"><a name="l03589"></a><span class="lineno"> 3589</span>&#160;</div><div class="line"><a name="l03590"></a><span class="lineno"> 3590</span>&#160;   <span class="keywordflow">return</span> res;</div><div class="line"><a name="l03591"></a><span class="lineno"> 3591</span>&#160;}</div><div class="line"><a name="l03592"></a><span class="lineno"> 3592</span>&#160;</div><div class="line"><a name="l03593"></a><span class="lineno"> 3593</span>&#160;</div><div class="line"><a name="l03594"></a><span class="lineno"> 3594</span>&#160;<a class="code" href="../../d9/de9/res__phoneprov_8c.html#addaa208b0ed785225e24490fb9f28a80">AST_MODULE_INFO</a>(<a class="code" href="../../d5/d16/module_8h.html#aba2c8d4be709a254658b21a834f8294a">ASTERISK_GPL_KEY</a>, <a class="code" href="../../d5/d16/module_8h.html#a155a0df9c59e04e305d4a2fa3e35f843a54af2a9b29d140908cc9dffd0618951b">AST_MODFLAG_DEFAULT</a>, <span class="stringliteral">&quot;Mini VoiceMail (A minimal Voicemail e-mail System)&quot;</span>,</div><div class="line"><a name="l03595"></a><span class="lineno"> 3595</span>&#160;   .support_level = <a class="code" href="../../d5/d16/module_8h.html#ab35bc4efd9f79706300965c9d36a0ce5a9f8870a5687abe3d9a6b0b3fbc89a800">AST_MODULE_SUPPORT_EXTENDED</a>,</div><div class="line"><a name="l03596"></a><span class="lineno"> 3596</span>&#160;   .load = <a class="code" href="../../de/dfe/app__minivm_8c.html#ac3382bf6da54c56b37069bd76bbdf4f9">load_module</a>,</div><div class="line"><a name="l03597"></a><span class="lineno"> 3597</span>&#160;   .unload = <a class="code" href="../../de/dfe/app__minivm_8c.html#ad09fa931f468002152a3cc2d5ce25eae">unload_module</a>,</div><div class="line"><a name="l03598"></a><span class="lineno"> 3598</span>&#160;   .<a class="code" href="../../de/dfe/app__minivm_8c.html#ad1982509765f4870f1f63412a53ea668">reload</a> = <a class="code" href="../../de/dfe/app__minivm_8c.html#ad1982509765f4870f1f63412a53ea668">reload</a>,</div><div class="line"><a name="l03599"></a><span class="lineno"><a class="line" href="../../de/dfe/app__minivm_8c.html#a4fb0aca9bbcdb9709fa52a70aded6cae"> 3599</a></span>&#160;);</div><div class="ttc" id="structast__custom__function_html_afcd1706c9144e6d6eee6127661ae3be2"><div class="ttname"><a href="../../db/dc0/structast__custom__function.html#afcd1706c9144e6d6eee6127661ae3be2">ast_custom_function::name</a></div><div class="ttdeci">const char * name</div><div class="ttdef"><b>Definition:</b> <a href="../../db/de0/pbx_8h_source.html#l00119">pbx.h:119</a></div></div>
<div class="ttc" id="app__minivm_8c_html_a062d3b248b3244aff7b2525014aede4b"><div class="ttname"><a href="../../de/dfe/app__minivm_8c.html#a062d3b248b3244aff7b2525014aede4b">DEFAULT_DATEFORMAT</a></div><div class="ttdeci">#define DEFAULT_DATEFORMAT</div><div class="ttdef"><b>Definition:</b> <a href="../../de/dfe/app__minivm_8c_source.html#l00711">app_minivm.c:711</a></div></div>
<div class="ttc" id="channel_8h_html_ac2dc872b606534943c98304aed841b34"><div class="ttname"><a href="../../d5/d7b/channel_8h.html#ac2dc872b606534943c98304aed841b34">ast_channel_caller</a></div><div class="ttdeci">struct ast_party_caller * ast_channel_caller(struct ast_channel *chan)</div><div class="ttdef"><b>Definition:</b> <a href="../../db/de2/channel__internal__api_8c_source.html#l00888">channel_internal_api.c:888</a></div></div>
<div class="ttc" id="include_2asterisk_2config_8h_html_a1a03993603e2bc2463153857836645bb"><div class="ttname"><a href="../../d3/de6/include_2asterisk_2config_8h.html#a1a03993603e2bc2463153857836645bb">ast_load_realtime</a></div><div class="ttdeci">struct ast_variable * ast_load_realtime(const char *family,...) attribute_sentinel</div><div class="ttdef"><b>Definition:</b> <a href="../../d2/d9d/main_2config_8c_source.html#l03339">main/config.c:3339</a></div></div>
<div class="ttc" id="app__minivm_8c_html_a2ba33f7f6225ee09bff35cfde87c08d7"><div class="ttname"><a href="../../de/dfe/app__minivm_8c.html#a2ba33f7f6225ee09bff35cfde87c08d7">message_template_find</a></div><div class="ttdeci">static struct minivm_template * message_template_find(const char *name)</div><div class="ttdef"><b>Definition:</b> <a href="../../de/dfe/app__minivm_8c_source.html#l00816">app_minivm.c:816</a></div></div>
<div class="ttc" id="structast__variable_html_afaaf66cc5029a563bd0bb9df076ea14b"><div class="ttname"><a href="../../dd/d02/structast__variable.html#afaaf66cc5029a563bd0bb9df076ea14b">ast_variable::next</a></div><div class="ttdeci">struct ast_variable * next</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/de6/include_2asterisk_2config_8h_source.html#l00090">include/asterisk/config.h:90</a></div></div>
<div class="ttc" id="structb64__baseio_html_a3e47346bcad694f3bfc4099f56531cee"><div class="ttname"><a href="../../de/d5d/structb64__baseio.html#a3e47346bcad694f3bfc4099f56531cee">b64_baseio::iolen</a></div><div class="ttdeci">int iolen</div><div class="ttdef"><b>Definition:</b> <a href="../../de/dfe/app__minivm_8c_source.html#l00658">app_minivm.c:658</a></div></div>
<div class="ttc" id="chan__ooh323_8c_html_a4d63fdfe5451ec2248c16a2739190c56"><div class="ttname"><a href="../../d7/d49/chan__ooh323_8c.html#a4d63fdfe5451ec2248c16a2739190c56">type</a></div><div class="ttdeci">static const char type[]</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d49/chan__ooh323_8c_source.html#l00109">chan_ooh323.c:109</a></div></div>
<div class="ttc" id="structminivm__account_html_ae80eeef848853cf42dc025b36f0de488"><div class="ttname"><a href="../../dc/d7b/structminivm__account.html#ae80eeef848853cf42dc025b36f0de488">minivm_account::attachfmt</a></div><div class="ttdeci">char attachfmt[80]</div><div class="ttdef"><b>Definition:</b> <a href="../../de/dfe/app__minivm_8c_source.html#l00615">app_minivm.c:615</a></div></div>
<div class="ttc" id="app__minivm_8c_html_ad1982509765f4870f1f63412a53ea668"><div class="ttname"><a href="../../de/dfe/app__minivm_8c.html#ad1982509765f4870f1f63412a53ea668">reload</a></div><div class="ttdeci">static int reload(void)</div><div class="ttdoc">Reload mini voicemail module. </div><div class="ttdef"><b>Definition:</b> <a href="../../de/dfe/app__minivm_8c_source.html#l03545">app_minivm.c:3545</a></div></div>
<div class="ttc" id="app__minivm_8c_html_aec217dce71a357d4890727f2a1a0a271"><div class="ttname"><a href="../../de/dfe/app__minivm_8c.html#aec217dce71a357d4890727f2a1a0a271">get_date</a></div><div class="ttdeci">static int get_date(char *s, int len)</div><div class="ttdef"><b>Definition:</b> <a href="../../de/dfe/app__minivm_8c_source.html#l00977">app_minivm.c:977</a></div></div>
<div class="ttc" id="channel_8h_html_a493bdebe876caafb8ee535853310364a"><div class="ttname"><a href="../../d5/d7b/channel_8h.html#a493bdebe876caafb8ee535853310364a">ast_channel_lock</a></div><div class="ttdeci">#define ast_channel_lock(chan)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d7b/channel_8h_source.html#l02945">channel.h:2945</a></div></div>
<div class="ttc" id="structast__channel_html"><div class="ttname"><a href="../../df/d3c/structast__channel.html">ast_channel</a></div><div class="ttdoc">Main Channel structure associated with a channel. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/de2/channel__internal__api_8c_source.html#l00073">channel_internal_api.c:73</a></div></div>
<div class="ttc" id="structminivm__stats_html_a739fde63c6d1cf2099ad3703aabb5433"><div class="ttname"><a href="../../d6/dee/structminivm__stats.html#a739fde63c6d1cf2099ad3703aabb5433">minivm_stats::reset</a></div><div class="ttdeci">struct timeval reset</div><div class="ttdef"><b>Definition:</b> <a href="../../de/dfe/app__minivm_8c_source.html#l00681">app_minivm.c:681</a></div></div>
<div class="ttc" id="app__minivm_8c_html_a1efddf47b6f25c6e1b97e064e35c214e"><div class="ttname"><a href="../../de/dfe/app__minivm_8c.html#a1efddf47b6f25c6e1b97e064e35c214e">vm_delete</a></div><div class="ttdeci">static int vm_delete(char *file)</div><div class="ttdef"><b>Definition:</b> <a href="../../de/dfe/app__minivm_8c_source.html#l01630">app_minivm.c:1630</a></div></div>
<div class="ttc" id="cli_8h_html_a5c4130cf8f1e93acfdd84416cebf1aef"><div class="ttname"><a href="../../dc/db0/cli_8h.html#a5c4130cf8f1e93acfdd84416cebf1aef">AST_CLI_DEFINE</a></div><div class="ttdeci">#define AST_CLI_DEFINE(fn, txt,...)</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/db0/cli_8h_source.html#l00197">cli.h:197</a></div></div>
<div class="ttc" id="app__minivm_8c_html_a94a4fdd9ccddad3436c2c6f165ea5214"><div class="ttname"><a href="../../de/dfe/app__minivm_8c.html#a94a4fdd9ccddad3436c2c6f165ea5214">minivm_option_args</a></div><div class="ttdeci">minivm_option_args</div><div class="ttdef"><b>Definition:</b> <a href="../../de/dfe/app__minivm_8c_source.html#l00579">app_minivm.c:579</a></div></div>
<div class="ttc" id="structast__party__number_html_ab50d783982593ef993ea0b68f7ad8b80"><div class="ttname"><a href="../../d6/dbb/structast__party__number.html#ab50d783982593ef993ea0b68f7ad8b80">ast_party_number::str</a></div><div class="ttdeci">char * str</div><div class="ttdoc">Subscriber phone number (Malloced) </div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d7b/channel_8h_source.html#l00292">channel.h:292</a></div></div>
<div class="ttc" id="structmessage_html"><div class="ttname"><a href="../../d8/d9e/structmessage.html">message</a></div><div class="ttdef"><b>Definition:</b> <a href="../../db/d45/manager_8h_source.html#l00144">manager.h:144</a></div></div>
<div class="ttc" id="app__minivm_8c_html_a4aeda8b39c8ab166c538157d05591922a6f62412bc497c9dd7db876c7ea4f9cfd"><div class="ttname"><a href="../../de/dfe/app__minivm_8c.html#a4aeda8b39c8ab166c538157d05591922a6f62412bc497c9dd7db876c7ea4f9cfd">OPT_RECORDGAIN</a></div><div class="ttdef"><b>Definition:</b> <a href="../../de/dfe/app__minivm_8c_source.html#l00576">app_minivm.c:576</a></div></div>
<div class="ttc" id="file_8h_html_a67c7e271b4ca70aca6d48fd48d121857"><div class="ttname"><a href="../../d2/d4d/file_8h.html#a67c7e271b4ca70aca6d48fd48d121857">ast_streamfile</a></div><div class="ttdeci">int ast_streamfile(struct ast_channel *c, const char *filename, const char *preflang)</div><div class="ttdoc">Streams a file. </div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d13/file_8c_source.html#l01250">file.c:1250</a></div></div>
<div class="ttc" id="linkedlists_8h_html_a9140a4e4d781264fa9469c52b1adae40"><div class="ttname"><a href="../../df/d90/linkedlists_8h.html#a9140a4e4d781264fa9469c52b1adae40">AST_LIST_LOCK</a></div><div class="ttdeci">#define AST_LIST_LOCK(head)</div><div class="ttdoc">Locks a list. </div><div class="ttdef"><b>Definition:</b> <a href="../../df/d90/linkedlists_8h_source.html#l00039">linkedlists.h:39</a></div></div>
<div class="ttc" id="lock_8h_html"><div class="ttname"><a href="../../dd/d42/lock_8h.html">lock.h</a></div><div class="ttdoc">Asterisk locking-related definitions: </div></div>
<div class="ttc" id="stasis__channels_8h_html"><div class="ttname"><a href="../../d9/d4a/stasis__channels_8h.html">stasis_channels.h</a></div></div>
<div class="ttc" id="asterisk_8h_html"><div class="ttname"><a href="../../db/db2/asterisk_8h.html">asterisk.h</a></div><div class="ttdoc">Asterisk main include file. File version handling, generic pbx functions. </div></div>
<div class="ttc" id="app__minivm_8c_html_a0146ffac26c0f9881220edd88adcdc0a"><div class="ttname"><a href="../../de/dfe/app__minivm_8c.html#a0146ffac26c0f9881220edd88adcdc0a">handle_minivm_show_users</a></div><div class="ttdeci">static char * handle_minivm_show_users(struct ast_cli_entry *e, int cmd, struct ast_cli_args *a)</div><div class="ttdoc">CLI command to list voicemail accounts. </div><div class="ttdef"><b>Definition:</b> <a href="../../de/dfe/app__minivm_8c_source.html#l03068">app_minivm.c:3068</a></div></div>
<div class="ttc" id="app__minivm_8c_html_aa93f0eb578d23995850d61f7d61c55c1"><div class="ttname"><a href="../../de/dfe/app__minivm_8c.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a></div><div class="ttdeci">#define FALSE</div><div class="ttdef"><b>Definition:</b> <a href="../../de/dfe/app__minivm_8c_source.html#l00521">app_minivm.c:521</a></div></div>
<div class="ttc" id="isdn__lib_8c_html_ab9129b977a587b50ea801daac75e178f"><div class="ttname"><a href="../../de/dfe/isdn__lib_8c.html#ab9129b977a587b50ea801daac75e178f">ARRAY_LEN</a></div><div class="ttdeci">#define ARRAY_LEN(a)</div><div class="ttdef"><b>Definition:</b> <a href="../../de/dfe/isdn__lib_8c_source.html#l00042">isdn_lib.c:42</a></div></div>
<div class="ttc" id="app__minivm_8c_html_af80b2bf6748bd7206069ff08addb3bb2"><div class="ttname"><a href="../../de/dfe/app__minivm_8c.html#af80b2bf6748bd7206069ff08addb3bb2">find_user_realtime</a></div><div class="ttdeci">static struct minivm_account * find_user_realtime(const char *domain, const char *username)</div><div class="ttdef"><b>Definition:</b> <a href="../../de/dfe/app__minivm_8c_source.html#l01111">app_minivm.c:1111</a></div></div>
<div class="ttc" id="json_8h_html_a99715667e822b2ad409b34ca041e535d"><div class="ttname"><a href="../../d4/d05/json_8h.html#a99715667e822b2ad409b34ca041e535d">ast_json_pack</a></div><div class="ttdeci">struct ast_json * ast_json_pack(char const *format,...)</div><div class="ttdoc">Helper for creating complex JSON values. </div><div class="ttdef"><b>Definition:</b> <a href="../../df/d98/json_8c_source.html#l00591">json.c:591</a></div></div>
<div class="ttc" id="app__minivm_8c_html_a94a4fdd9ccddad3436c2c6f165ea5214aec7326f60e7edad15d96ff935e5616d6"><div class="ttname"><a href="../../de/dfe/app__minivm_8c.html#a94a4fdd9ccddad3436c2c6f165ea5214aec7326f60e7edad15d96ff935e5616d6">OPT_ARG_ARRAY_SIZE</a></div><div class="ttdef"><b>Definition:</b> <a href="../../de/dfe/app__minivm_8c_source.html#l00581">app_minivm.c:581</a></div></div>
<div class="ttc" id="app__minivm_8c_html_a251b3dd38bf79c9b6d4fdc86ef63f0a8"><div class="ttname"><a href="../../de/dfe/app__minivm_8c.html#a251b3dd38bf79c9b6d4fdc86ef63f0a8">MVM_REVIEW</a></div><div class="ttdeci">#define MVM_REVIEW</div><div class="ttdef"><b>Definition:</b> <a href="../../de/dfe/app__minivm_8c_source.html#l00525">app_minivm.c:525</a></div></div>
<div class="ttc" id="app__minivm_8c_html_a0cb40730dc4102d3171993e6e479a09c"><div class="ttname"><a href="../../de/dfe/app__minivm_8c.html#a0cb40730dc4102d3171993e6e479a09c">create_vmaccount</a></div><div class="ttdeci">static int create_vmaccount(char *name, struct ast_variable *var, int realtime)</div><div class="ttdoc">Append new mailbox to mailbox list from configuration file. </div><div class="ttdef"><b>Definition:</b> <a href="../../de/dfe/app__minivm_8c_source.html#l02594">app_minivm.c:2594</a></div></div>
<div class="ttc" id="structminivm__account_html_ad48036454496b4bfb945139d1ae878c4"><div class="ttname"><a href="../../dc/d7b/structminivm__account.html#ad48036454496b4bfb945139d1ae878c4">minivm_account::etemplate</a></div><div class="ttdeci">char etemplate[80]</div><div class="ttdef"><b>Definition:</b> <a href="../../de/dfe/app__minivm_8c_source.html#l00616">app_minivm.c:616</a></div></div>
<div class="ttc" id="structleave__vm__options_html_ac92588540e8c1d014a08cd8a45462b19"><div class="ttname"><a href="../../dd/df7/structleave__vm__options.html#ac92588540e8c1d014a08cd8a45462b19">leave_vm_options::flags</a></div><div class="ttdeci">unsigned int flags</div><div class="ttdef"><b>Definition:</b> <a href="../../de/dfe/app__minivm_8c_source.html#l00651">app_minivm.c:651</a></div></div>
<div class="ttc" id="callerid_8h_html"><div class="ttname"><a href="../../de/d47/callerid_8h.html">callerid.h</a></div><div class="ttdoc">CallerID (and other GR30) management and generation Includes code and algorithms from the Zapata libr...</div></div>
<div class="ttc" id="include_2asterisk_2config_8h_html_adea5390496e5477192d86f340d512d04"><div class="ttname"><a href="../../d3/de6/include_2asterisk_2config_8h.html#adea5390496e5477192d86f340d512d04">ast_variables_destroy</a></div><div class="ttdeci">void ast_variables_destroy(struct ast_variable *var)</div><div class="ttdoc">Free variable list. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/dc5/extconf_8c_source.html#l01263">extconf.c:1263</a></div></div>
<div class="ttc" id="structminivm__zone_html_a3777dbae63a15da001b2baa317a25149"><div class="ttname"><a href="../../d4/d09/structminivm__zone.html#a3777dbae63a15da001b2baa317a25149">minivm_zone::name</a></div><div class="ttdeci">char name[80]</div><div class="ttdef"><b>Definition:</b> <a href="../../de/dfe/app__minivm_8c_source.html#l00666">app_minivm.c:666</a></div></div>
<div class="ttc" id="conf2ael_8c_html_a74bb62276efdf39dd94048e007fca05b"><div class="ttname"><a href="../../de/dcc/conf2ael_8c.html#a74bb62276efdf39dd94048e007fca05b">config</a></div><div class="ttdeci">char * config</div><div class="ttdef"><b>Definition:</b> <a href="../../de/dcc/conf2ael_8c_source.html#l00066">conf2ael.c:66</a></div></div>
<div class="ttc" id="app__minivm_8c_html_ac1976490b5dd7e2dae38667d5d21fe4a"><div class="ttname"><a href="../../de/dfe/app__minivm_8c.html#ac1976490b5dd7e2dae38667d5d21fe4a">MVM_ALLOCED</a></div><div class="ttdeci">#define MVM_ALLOCED</div><div class="ttdef"><b>Definition:</b> <a href="../../de/dfe/app__minivm_8c_source.html#l00531">app_minivm.c:531</a></div></div>
<div class="ttc" id="app__minivm_8c_html_adff16a51cb3b033013640db28e98ef95"><div class="ttname"><a href="../../de/dfe/app__minivm_8c.html#adff16a51cb3b033013640db28e98ef95">minivm_counter_function</a></div><div class="ttdeci">static struct ast_custom_function minivm_counter_function</div><div class="ttdef"><b>Definition:</b> <a href="../../de/dfe/app__minivm_8c_source.html#l03505">app_minivm.c:3505</a></div></div>
<div class="ttc" id="file_8h_html_afa92b0106fb7a918ea994c2867ac0a04"><div class="ttname"><a href="../../d2/d4d/file_8h.html#afa92b0106fb7a918ea994c2867ac0a04">AST_DIGIT_ANY</a></div><div class="ttdeci">#define AST_DIGIT_ANY</div><div class="ttdef"><b>Definition:</b> <a href="../../d2/d4d/file_8h_source.html#l00048">file.h:48</a></div></div>
<div class="ttc" id="cli_8h_html_a56b6b59ee2eaa994597a5b0f4e9f9d09"><div class="ttname"><a href="../../dc/db0/cli_8h.html#a56b6b59ee2eaa994597a5b0f4e9f9d09">ast_cli_unregister_multiple</a></div><div class="ttdeci">int ast_cli_unregister_multiple(struct ast_cli_entry *e, int len)</div><div class="ttdoc">Unregister multiple commands. </div><div class="ttdef"><b>Definition:</b> <a href="../../da/d4d/clicompat_8c_source.html#l00030">clicompat.c:30</a></div></div>
<div class="ttc" id="app__minivm_8c_html_a839f0e97aafd99c9771542f337a74ec6"><div class="ttname"><a href="../../de/dfe/app__minivm_8c.html#a839f0e97aafd99c9771542f337a74ec6">b64_inchar</a></div><div class="ttdeci">static int b64_inchar(struct b64_baseio *bio, FILE *fi)</div><div class="ttdef"><b>Definition:</b> <a href="../../de/dfe/app__minivm_8c_source.html#l00874">app_minivm.c:874</a></div></div>
<div class="ttc" id="module_8h_html_ab35bc4efd9f79706300965c9d36a0ce5a9f8870a5687abe3d9a6b0b3fbc89a800"><div class="ttname"><a href="../../d5/d16/module_8h.html#ab35bc4efd9f79706300965c9d36a0ce5a9f8870a5687abe3d9a6b0b3fbc89a800">AST_MODULE_SUPPORT_EXTENDED</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d16/module_8h_source.html#l00122">module.h:122</a></div></div>
<div class="ttc" id="channel_8h_html_ab733a7825810b895a89b629e0ea89380"><div class="ttname"><a href="../../d5/d7b/channel_8h.html#ab733a7825810b895a89b629e0ea89380">ast_channel_unref</a></div><div class="ttdeci">#define ast_channel_unref(c)</div><div class="ttdoc">Decrease channel reference count. </div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d7b/channel_8h_source.html#l02981">channel.h:2981</a></div></div>
<div class="ttc" id="app__minivm_8c_html_a6d1e86507023ca3f6dd4ad1dfb4ff96e"><div class="ttname"><a href="../../de/dfe/app__minivm_8c.html#a6d1e86507023ca3f6dd4ad1dfb4ff96e">handle_minivm_list_templates</a></div><div class="ttdeci">static char * handle_minivm_list_templates(struct ast_cli_entry *e, int cmd, struct ast_cli_args *a)</div><div class="ttdoc">CLI routine for listing templates. </div><div class="ttdef"><b>Definition:</b> <a href="../../de/dfe/app__minivm_8c_source.html#l03004">app_minivm.c:3004</a></div></div>
<div class="ttc" id="app__minivm_8c_html_a8690b029ca446ef1d49c1b012d261759"><div class="ttname"><a href="../../de/dfe/app__minivm_8c.html#a8690b029ca446ef1d49c1b012d261759">message_template_build</a></div><div class="ttdeci">static int message_template_build(const char *name, struct ast_variable *var)</div><div class="ttdef"><b>Definition:</b> <a href="../../de/dfe/app__minivm_8c_source.html#l00753">app_minivm.c:753</a></div></div>
<div class="ttc" id="utils_8h_html_a67b6713ff86cf82aaed821e9a87d1c21"><div class="ttname"><a href="../../d5/d60/utils_8h.html#a67b6713ff86cf82aaed821e9a87d1c21">ast_set2_flag</a></div><div class="ttdeci">#define ast_set2_flag(p, value, flag)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d60/utils_8h_source.html#l00094">utils.h:94</a></div></div>
<div class="ttc" id="utils_8h_html_a00d4c9254c9827d6fa44f17a326744a5"><div class="ttname"><a href="../../d5/d60/utils_8h.html#a00d4c9254c9827d6fa44f17a326744a5">ast_test_flag</a></div><div class="ttdeci">#define ast_test_flag(p, flag)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d60/utils_8h_source.html#l00063">utils.h:63</a></div></div>
<div class="ttc" id="include_2asterisk_2config_8h_html_aef636ed2f3d33f4c7a1ba67eb7c4d052"><div class="ttname"><a href="../../d3/de6/include_2asterisk_2config_8h.html#aef636ed2f3d33f4c7a1ba67eb7c4d052">ast_variable_browse</a></div><div class="ttdeci">struct ast_variable * ast_variable_browse(const struct ast_config *config, const char *category_name)</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/dc5/extconf_8c_source.html#l01216">extconf.c:1216</a></div></div>
<div class="ttc" id="time_8h_html"><div class="ttname"><a href="../../de/df7/time_8h.html">time.h</a></div><div class="ttdoc">Time-related functions and macros. </div></div>
<div class="ttc" id="json_8h_html_a33bcd9181e613a659eefe411ec42c87c"><div class="ttname"><a href="../../d4/d05/json_8h.html#a33bcd9181e613a659eefe411ec42c87c">ast_json_unref</a></div><div class="ttdeci">void ast_json_unref(struct ast_json *value)</div><div class="ttdoc">Decrease refcount on value. If refcount reaches zero, value is freed. </div><div class="ttdef"><b>Definition:</b> <a href="../../df/d98/json_8c_source.html#l00073">json.c:73</a></div></div>
<div class="ttc" id="structast__party__id_html_aab4036618469f3fa9ab26a22726ba2db"><div class="ttname"><a href="../../d1/dcb/structast__party__id.html#aab4036618469f3fa9ab26a22726ba2db">ast_party_id::name</a></div><div class="ttdeci">struct ast_party_name name</div><div class="ttdoc">Subscriber name. </div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d7b/channel_8h_source.html#l00341">channel.h:341</a></div></div>
<div class="ttc" id="eagi__proxy_8c_html_ac95651d79c608a3148973b5b1fc9e525"><div class="ttname"><a href="../../dd/d7c/eagi__proxy_8c.html#ac95651d79c608a3148973b5b1fc9e525">buf</a></div><div class="ttdeci">char buf[BUFSIZE]</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d7c/eagi__proxy_8c_source.html#l00066">eagi_proxy.c:66</a></div></div>
<div class="ttc" id="namespacemake__ari__stubs_html_a40a5d58ffa6e88aa578d6683ac413105"><div class="ttname"><a href="../../d2/dc8/namespacemake__ari__stubs.html#a40a5d58ffa6e88aa578d6683ac413105">make_ari_stubs.file</a></div><div class="ttdeci">file</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d28/make__ari__stubs_8py_source.html#l00025">make_ari_stubs.py:25</a></div></div>
<div class="ttc" id="app__minivm_8c_html_a94a4fdd9ccddad3436c2c6f165ea5214a0ba3410dc4adff3119e1a4007cf90a7d"><div class="ttname"><a href="../../de/dfe/app__minivm_8c.html#a94a4fdd9ccddad3436c2c6f165ea5214a0ba3410dc4adff3119e1a4007cf90a7d">OPT_ARG_RECORDGAIN</a></div><div class="ttdef"><b>Definition:</b> <a href="../../de/dfe/app__minivm_8c_source.html#l00580">app_minivm.c:580</a></div></div>
<div class="ttc" id="dsp_8h_html"><div class="ttname"><a href="../../d3/d08/dsp_8h.html">dsp.h</a></div><div class="ttdoc">Convenient Signal Processing routines. </div></div>
<div class="ttc" id="app__minivm_8c_html_add014d9459f2a5a1d3d0043bf89a8067"><div class="ttname"><a href="../../de/dfe/app__minivm_8c.html#add014d9459f2a5a1d3d0043bf89a8067">global_vmminmessage</a></div><div class="ttdeci">static int global_vmminmessage</div><div class="ttdef"><b>Definition:</b> <a href="../../de/dfe/app__minivm_8c_source.html#l00694">app_minivm.c:694</a></div></div>
<div class="ttc" id="utils_8h_html_ab5033a1f3d781d45e7ccc27598114510"><div class="ttname"><a href="../../d5/d60/utils_8h.html#ab5033a1f3d781d45e7ccc27598114510">ast_set_flag</a></div><div class="ttdeci">#define ast_set_flag(p, flag)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d60/utils_8h_source.html#l00070">utils.h:70</a></div></div>
<div class="ttc" id="group__StasisTopicsAndMessages_html_ga2f9639be7fcd922d0609b4ba82fc79c8"><div class="ttname"><a href="../../df/deb/group__StasisTopicsAndMessages.html#ga2f9639be7fcd922d0609b4ba82fc79c8">ast_mwi_create</a></div><div class="ttdeci">struct ast_mwi_state * ast_mwi_create(const char *mailbox, const char *context)</div><div class="ttdoc">Create a ast_mwi_state object. </div><div class="ttdef"><b>Definition:</b> <a href="../../d6/db4/mwi_8c_source.html#l00148">mwi.c:148</a></div></div>
<div class="ttc" id="stasis_8h_html"><div class="ttname"><a href="../../dd/d79/stasis_8h.html">stasis.h</a></div><div class="ttdoc">Stasis Message Bus API. See Stasis Message Bus API for detailed documentation. </div></div>
<div class="ttc" id="structast__cli__entry_html"><div class="ttname"><a href="../../d8/d07/structast__cli__entry.html">ast_cli_entry</a></div><div class="ttdoc">descriptor for a cli entry. </div><div class="ttdef"><b>Definition:</b> <a href="../../dc/db0/cli_8h_source.html#l00171">cli.h:171</a></div></div>
<div class="ttc" id="app__minivm_8c_html_a20788f21f34287a8ac8a96a8c9cec8e4"><div class="ttname"><a href="../../de/dfe/app__minivm_8c.html#a20788f21f34287a8ac8a96a8c9cec8e4">HMSU_OUTPUT_FORMAT</a></div><div class="ttdeci">#define HMSU_OUTPUT_FORMAT</div></div>
<div class="ttc" id="structast__cli__args_html_a98e1d8441ca58834f11f7367be4b3345"><div class="ttname"><a href="../../d3/dad/structast__cli__args.html#a98e1d8441ca58834f11f7367be4b3345">ast_cli_args::argc</a></div><div class="ttdeci">const int argc</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/db0/cli_8h_source.html#l00160">cli.h:160</a></div></div>
<div class="ttc" id="logger_8h_html_adf4476a6a4ea6c74231c826e899d7189"><div class="ttname"><a href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a></div><div class="ttdeci">#define LOG_WARNING</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d8c/logger_8h_source.html#l00274">logger.h:274</a></div></div>
<div class="ttc" id="app__minivm_8c_html_a7515f8088d13c05182c54d43de777547"><div class="ttname"><a href="../../de/dfe/app__minivm_8c.html#a7515f8088d13c05182c54d43de777547">handle_minivm_reload</a></div><div class="ttdeci">static char * handle_minivm_reload(struct ast_cli_entry *e, int cmd, struct ast_cli_args *a)</div><div class="ttdoc">Reload cofiguration. </div><div class="ttdef"><b>Definition:</b> <a href="../../de/dfe/app__minivm_8c_source.html#l03551">app_minivm.c:3551</a></div></div>
<div class="ttc" id="linkedlists_8h_html_ab48cb9e1e612dd486b747ba1c5d68d01"><div class="ttname"><a href="../../df/d90/linkedlists_8h.html#ab48cb9e1e612dd486b747ba1c5d68d01">AST_LIST_UNLOCK</a></div><div class="ttdeci">#define AST_LIST_UNLOCK(head)</div><div class="ttdoc">Attempts to unlock a list. </div><div class="ttdef"><b>Definition:</b> <a href="../../df/d90/linkedlists_8h_source.html#l00139">linkedlists.h:139</a></div></div>
<div class="ttc" id="group__StasisTopicsAndMessages_html_ga728789c28cb77fc6cbf3254aefc7c67a"><div class="ttname"><a href="../../df/deb/group__StasisTopicsAndMessages.html#ga728789c28cb77fc6cbf3254aefc7c67a">ast_mwi_blob_create</a></div><div class="ttdeci">struct stasis_message * ast_mwi_blob_create(struct ast_mwi_state *mwi_state, struct stasis_message_type *message_type, struct ast_json *blob)</div><div class="ttdoc">Creates a ast_mwi_blob message. </div><div class="ttdef"><b>Definition:</b> <a href="../../d6/db4/mwi_8c_source.html#l00462">mwi.c:462</a></div></div>
<div class="ttc" id="app__minivm_8c_html_a9900bfa7d5724fe84c74fec928f49052"><div class="ttname"><a href="../../de/dfe/app__minivm_8c.html#a9900bfa7d5724fe84c74fec928f49052">play_record_review</a></div><div class="ttdeci">static int play_record_review(struct ast_channel *chan, char *playfile, char *recordfile, int maxtime, char *fmt, int outsidecaller, struct minivm_account *vmu, int *duration, int *sound_duration, const char *unlockdir, signed char record_gain)</div><div class="ttdef"><b>Definition:</b> <a href="../../de/dfe/app__minivm_8c_source.html#l01644">app_minivm.c:1644</a></div></div>
<div class="ttc" id="app__minivm_8c_html_a5119f16369105e022da7c1f72f328abc"><div class="ttname"><a href="../../de/dfe/app__minivm_8c.html#a5119f16369105e022da7c1f72f328abc">minivm_counter_func_read</a></div><div class="ttdeci">static int minivm_counter_func_read(struct ast_channel *chan, const char *cmd, char *data, char *buf, size_t len)</div><div class="ttdoc">${MINIVMCOUNTER()} Dialplan function - read counters </div><div class="ttdef"><b>Definition:</b> <a href="../../de/dfe/app__minivm_8c_source.html#l03372">app_minivm.c:3372</a></div></div>
<div class="ttc" id="strings_8h_html_a1ef7e2644ca7258070db316fdc0a465b"><div class="ttname"><a href="../../d6/d90/strings_8h.html#a1ef7e2644ca7258070db316fdc0a465b">ast_str_buffer</a></div><div class="ttdeci">char * ast_str_buffer(const struct ast_str *buf)</div><div class="ttdoc">Returns the string buffer within the ast_str buf. </div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d90/strings_8h_source.html#l00714">strings.h:714</a></div></div>
<div class="ttc" id="include_2asterisk_2config_8h_html_a8d1a63cdf2c7aff22a77b6e75d93b377"><div class="ttname"><a href="../../d3/de6/include_2asterisk_2config_8h.html#a8d1a63cdf2c7aff22a77b6e75d93b377">CONFIG_STATUS_FILEINVALID</a></div><div class="ttdeci">#define CONFIG_STATUS_FILEINVALID</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/de6/include_2asterisk_2config_8h_source.html#l00060">include/asterisk/config.h:60</a></div></div>
<div class="ttc" id="app__minivm_8c_html_a1c42a258925cbbb46952152ec3785bfd"><div class="ttname"><a href="../../de/dfe/app__minivm_8c.html#a1c42a258925cbbb46952152ec3785bfd">free_user</a></div><div class="ttdeci">static void free_user(struct minivm_account *vmu)</div><div class="ttdef"><b>Definition:</b> <a href="../../de/dfe/app__minivm_8c_source.html#l00989">app_minivm.c:989</a></div></div>
<div class="ttc" id="structminivm__account_html_adf416dc058363e2fd5750c77e2d78bee"><div class="ttname"><a href="../../dc/d7b/structminivm__account.html#adf416dc058363e2fd5750c77e2d78bee">minivm_account::language</a></div><div class="ttdeci">char language[MAX_LANGUAGE]</div><div class="ttdef"><b>Definition:</b> <a href="../../de/dfe/app__minivm_8c_source.html#l00611">app_minivm.c:611</a></div></div>
<div class="ttc" id="structminivm__accounts_html"><div class="ttname"><a href="../../d2/d1d/structminivm__accounts.html">minivm_accounts</a></div><div class="ttdef"><b>Definition:</b> <a href="../../de/dfe/app__minivm_8c_source.html#l00626">app_minivm.c:626</a></div></div>
<div class="ttc" id="bt__open_8c_html_a1cdd2bb1a9a71d3e1120100229315d67"><div class="ttname"><a href="../../de/d1e/bt__open_8c.html#a1cdd2bb1a9a71d3e1120100229315d67">tmp</a></div><div class="ttdeci">static int tmp()</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d1e/bt__open_8c_source.html#l00389">bt_open.c:389</a></div></div>
<div class="ttc" id="localtime_8h_html_ae9fbda728350a9a5b9c09b29214d718e"><div class="ttname"><a href="../../d5/deb/localtime_8h.html#ae9fbda728350a9a5b9c09b29214d718e">ast_localtime</a></div><div class="ttdeci">struct ast_tm * ast_localtime(const struct timeval *timep, struct ast_tm *p_tm, const char *zone)</div><div class="ttdoc">Timezone-independent version of localtime_r(3). </div><div class="ttdef"><b>Definition:</b> <a href="../../d9/df8/localtime_8c_source.html#l01739">localtime.c:1739</a></div></div>
<div class="ttc" id="app__minivm_8c_html_a9037a3cda0a3779450ce6cba1041b70f"><div class="ttname"><a href="../../de/dfe/app__minivm_8c.html#a9037a3cda0a3779450ce6cba1041b70f">minivm_accmess_options</a></div><div class="ttdeci">static const struct ast_app_option minivm_accmess_options[128]</div><div class="ttdef"><b>Definition:</b> <a href="../../de/dfe/app__minivm_8c_source.html#l00596">app_minivm.c:596</a></div></div>
<div class="ttc" id="app__minivm_8c_html_abcec5c16680dc75cdf051552d6908042"><div class="ttname"><a href="../../de/dfe/app__minivm_8c.html#abcec5c16680dc75cdf051552d6908042">mvm_messagetype</a></div><div class="ttdeci">mvm_messagetype</div><div class="ttdoc">Message types for notification. </div><div class="ttdef"><b>Definition:</b> <a href="../../de/dfe/app__minivm_8c_source.html#l00552">app_minivm.c:552</a></div></div>
<div class="ttc" id="structast__variable_html"><div class="ttname"><a href="../../dd/d02/structast__variable.html">ast_variable</a></div><div class="ttdoc">Structure for variables, used for configurations and for channel variables. </div><div class="ttdef"><b>Definition:</b> <a href="../../d3/de6/include_2asterisk_2config_8h_source.html#l00083">include/asterisk/config.h:83</a></div></div>
<div class="ttc" id="ast__expr2f_8c_html_a1b0936415a643c88ce543099c10e0d7f"><div class="ttname"><a href="../../dc/df2/ast__expr2f_8c.html#a1b0936415a643c88ce543099c10e0d7f">var</a></div><div class="ttdeci">#define var</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/df2/ast__expr2f_8c_source.html#l00614">ast_expr2f.c:614</a></div></div>
<div class="ttc" id="app__minivm_8c_html_aa4ee01c44f3a162c943125869e95bcca"><div class="ttname"><a href="../../de/dfe/app__minivm_8c.html#aa4ee01c44f3a162c943125869e95bcca">app_minivm_notify</a></div><div class="ttdeci">static char * app_minivm_notify</div><div class="ttdef"><b>Definition:</b> <a href="../../de/dfe/app__minivm_8c_source.html#l00563">app_minivm.c:563</a></div></div>
<div class="ttc" id="structminivm__account_html_a4b30874d24514b5ef6ff5276e8c12ed4"><div class="ttname"><a href="../../dc/d7b/structminivm__account.html#a4b30874d24514b5ef6ff5276e8c12ed4">minivm_account::username</a></div><div class="ttdeci">char username[AST_MAX_CONTEXT]</div><div class="ttdef"><b>Definition:</b> <a href="../../de/dfe/app__minivm_8c_source.html#l00601">app_minivm.c:601</a></div></div>
<div class="ttc" id="include_2asterisk_2app_8h_html_a382bf96f47f0b7fa86ae5ed0644b3f8ca9c0f41302de02bb0130a92669d17333d"><div class="ttname"><a href="../../d3/d93/include_2asterisk_2app_8h.html#a382bf96f47f0b7fa86ae5ed0644b3f8ca9c0f41302de02bb0130a92669d17333d">AST_LOCK_TIMEOUT</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d93/include_2asterisk_2app_8h_source.html#l01166">include/asterisk/app.h:1166</a></div></div>
<div class="ttc" id="app__minivm_8c_html_a54c59989081dfa2f9fa311f8cdbb767d"><div class="ttname"><a href="../../de/dfe/app__minivm_8c.html#a54c59989081dfa2f9fa311f8cdbb767d">timezone_add</a></div><div class="ttdeci">static int timezone_add(const char *zonename, const char *config)</div><div class="ttdoc">Add time zone to memory list. </div><div class="ttdef"><b>Definition:</b> <a href="../../de/dfe/app__minivm_8c_source.html#l02707">app_minivm.c:2707</a></div></div>
<div class="ttc" id="pbx_8h_html_a556749361c7b9109134c8d00ab4ef6bf"><div class="ttname"><a href="../../db/de0/pbx_8h.html#a556749361c7b9109134c8d00ab4ef6bf">ast_str_substitute_variables</a></div><div class="ttdeci">void ast_str_substitute_variables(struct ast_str **buf, ssize_t maxlen, struct ast_channel *chan, const char *templ)</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d8c/pbx__variables_8c_source.html#l00616">pbx_variables.c:616</a></div></div>
<div class="ttc" id="say_8h_html_ac8bd6c34b6aa664adb9ebfab68a500ce"><div class="ttname"><a href="../../db/dce/say_8h.html#ac8bd6c34b6aa664adb9ebfab68a500ce">ast_say_digit_str</a></div><div class="ttdeci">int ast_say_digit_str(struct ast_channel *chan, const char *num, const char *ints, const char *lang)</div><div class="ttdoc">says digits of a string </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d28/channel_8c_source.html#l08355">channel.c:8355</a></div></div>
<div class="ttc" id="app__minivm_8c_html_a967b9e2acf79f774a1649eb1630c89a5"><div class="ttname"><a href="../../de/dfe/app__minivm_8c.html#a967b9e2acf79f774a1649eb1630c89a5">vmaccounts_destroy_list</a></div><div class="ttdeci">static void vmaccounts_destroy_list(void)</div><div class="ttdef"><b>Definition:</b> <a href="../../de/dfe/app__minivm_8c_source.html#l01055">app_minivm.c:1055</a></div></div>
<div class="ttc" id="cli_8h_html_ab33e5350a923c3a8cedbeb496cd88ec9a71745eb63dd093f560a1add3e430d2a9"><div class="ttname"><a href="../../dc/db0/cli_8h.html#ab33e5350a923c3a8cedbeb496cd88ec9a71745eb63dd093f560a1add3e430d2a9">CLI_INIT</a></div><div class="ttdef"><b>Definition:</b> <a href="../../dc/db0/cli_8h_source.html#l00152">cli.h:152</a></div></div>
<div class="ttc" id="channelstate_8h_html_a03585bc87e5bbd0f4d11bc789734c660"><div class="ttname"><a href="../../d9/d95/channelstate_8h.html#a03585bc87e5bbd0f4d11bc789734c660">ast_channel_state</a></div><div class="ttdeci">ast_channel_state</div><div class="ttdoc">ast_channel states </div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d95/channelstate_8h_source.html#l00035">channelstate.h:35</a></div></div>
<div class="ttc" id="structast__party__name_html_ab50d783982593ef993ea0b68f7ad8b80"><div class="ttname"><a href="../../d8/d6f/structast__party__name.html#ab50d783982593ef993ea0b68f7ad8b80">ast_party_name::str</a></div><div class="ttdeci">char * str</div><div class="ttdoc">Subscriber name (Malloced) </div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d7b/channel_8h_source.html#l00265">channel.h:265</a></div></div>
<div class="ttc" id="app__minivm_8c_html_a8b15b63639515446b3217dd1d3613d1b"><div class="ttname"><a href="../../de/dfe/app__minivm_8c.html#a8b15b63639515446b3217dd1d3613d1b">free_zone</a></div><div class="ttdeci">static void free_zone(struct minivm_zone *z)</div><div class="ttdoc">Free Mini Voicemail timezone. </div><div class="ttdef"><b>Definition:</b> <a href="../../de/dfe/app__minivm_8c_source.html#l02689">app_minivm.c:2689</a></div></div>
<div class="ttc" id="structstasis__message_html"><div class="ttname"><a href="../../d7/d55/structstasis__message.html">stasis_message</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d2/db9/stasis__message_8c_source.html#l00121">stasis_message.c:121</a></div></div>
<div class="ttc" id="strings_8h_html_a1088afdd862a49b0fce34ebe02df8ca1"><div class="ttname"><a href="../../d6/d90/strings_8h.html#a1088afdd862a49b0fce34ebe02df8ca1">ast_str_append</a></div><div class="ttdeci">int ast_str_append(struct ast_str **buf, ssize_t max_len, const char *fmt,...)</div><div class="ttdoc">Append to a thread local dynamic string. </div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d90/strings_8h_source.html#l01091">strings.h:1091</a></div></div>
<div class="ttc" id="cli_8h_html_aea8910ed9e301e7f741f87942c244eac"><div class="ttname"><a href="../../dc/db0/cli_8h.html#aea8910ed9e301e7f741f87942c244eac">ast_cli_register_multiple</a></div><div class="ttdeci">#define ast_cli_register_multiple(e, len)</div><div class="ttdoc">Register multiple commands. </div><div class="ttdef"><b>Definition:</b> <a href="../../dc/db0/cli_8h_source.html#l00265">cli.h:265</a></div></div>
<div class="ttc" id="time_8h_html_ad3899efb6f0e348556ef69f5b16aa7f7"><div class="ttname"><a href="../../de/df7/time_8h.html#ad3899efb6f0e348556ef69f5b16aa7f7">ast_tvnow</a></div><div class="ttdeci">struct timeval ast_tvnow(void)</div><div class="ttdoc">Returns current timeval. Meant to replace calls to gettimeofday(). </div><div class="ttdef"><b>Definition:</b> <a href="../../de/df7/time_8h_source.html#l00150">time.h:150</a></div></div>
<div class="ttc" id="linkedlists_8h_html_a4a1884cde93e53bef32ca85c194a1d05"><div class="ttname"><a href="../../df/d90/linkedlists_8h.html#a4a1884cde93e53bef32ca85c194a1d05">AST_LIST_EMPTY</a></div><div class="ttdeci">#define AST_LIST_EMPTY(head)</div><div class="ttdoc">Checks whether the specified list contains any entries. </div><div class="ttdef"><b>Definition:</b> <a href="../../df/d90/linkedlists_8h_source.html#l00449">linkedlists.h:449</a></div></div>
<div class="ttc" id="app__voicemail_8c_html_ad4786cc0738d237b7697e5448da7d22e"><div class="ttname"><a href="../../dc/df4/app__voicemail_8c.html#ad4786cc0738d237b7697e5448da7d22e">locale</a></div><div class="ttdeci">static char locale[20]</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/df4/app__voicemail_8c_source.html#l00918">app_voicemail.c:918</a></div></div>
<div class="ttc" id="structminivm__stats_html_a92b59b721b40f396592d78dc1fedfbb0"><div class="ttname"><a href="../../d6/dee/structminivm__stats.html#a92b59b721b40f396592d78dc1fedfbb0">minivm_stats::templates</a></div><div class="ttdeci">int templates</div><div class="ttdef"><b>Definition:</b> <a href="../../de/dfe/app__minivm_8c_source.html#l00679">app_minivm.c:679</a></div></div>
<div class="ttc" id="app__minivm_8c_html_a7489f858d557c4f3db7ed7620a9e7643"><div class="ttname"><a href="../../de/dfe/app__minivm_8c.html#a7489f858d557c4f3db7ed7620a9e7643">global_vmmaxmessage</a></div><div class="ttdeci">static int global_vmmaxmessage</div><div class="ttdef"><b>Definition:</b> <a href="../../de/dfe/app__minivm_8c_source.html#l00695">app_minivm.c:695</a></div></div>
<div class="ttc" id="lock_8h_html_ac5e13c7fe64d3b271a52028b0a78b92b"><div class="ttname"><a href="../../dd/d42/lock_8h.html#ac5e13c7fe64d3b271a52028b0a78b92b">ast_mutex_lock</a></div><div class="ttdeci">#define ast_mutex_lock(a)</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d42/lock_8h_source.html#l00187">lock.h:187</a></div></div>
<div class="ttc" id="channelstate_8h_html_a03585bc87e5bbd0f4d11bc789734c660aa8ab4bcda7378ccc17c39dfd880cba3d"><div class="ttname"><a href="../../d9/d95/channelstate_8h.html#a03585bc87e5bbd0f4d11bc789734c660aa8ab4bcda7378ccc17c39dfd880cba3d">AST_STATE_UP</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d95/channelstate_8h_source.html#l00042">channelstate.h:42</a></div></div>
<div class="ttc" id="test__linkedlists_8c_html_acd9db00336027462cfb25b97b5356883"><div class="ttname"><a href="../../d7/d6f/test__linkedlists_8c.html#acd9db00336027462cfb25b97b5356883">c</a></div><div class="ttdeci">static struct test_val c</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d6f/test__linkedlists_8c_source.html#l00048">test_linkedlists.c:48</a></div></div>
<div class="ttc" id="structchannel_html"><div class="ttname"><a href="../../d4/d84/structchannel.html">channel</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d8a/muted_8c_source.html#l00095">muted.c:95</a></div></div>
<div class="ttc" id="utils_8h_html_ab9da1c7265610eff83ed6146f104dc6f"><div class="ttname"><a href="../../d5/d60/utils_8h.html#ab9da1c7265610eff83ed6146f104dc6f">ast_copy_flags</a></div><div class="ttdeci">#define ast_copy_flags(dest, src, flagz)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d60/utils_8h_source.html#l00084">utils.h:84</a></div></div>
<div class="ttc" id="strings_8h_html_a7fc844c12b769ccded05e7514036e241"><div class="ttname"><a href="../../d6/d90/strings_8h.html#a7fc844c12b769ccded05e7514036e241">ast_str_alloca</a></div><div class="ttdeci">#define ast_str_alloca(init_len)</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d90/strings_8h_source.html#l00800">strings.h:800</a></div></div>
<div class="ttc" id="app__minivm_8c_html_aa480711168f1f90a260496a1877397dd"><div class="ttname"><a href="../../de/dfe/app__minivm_8c.html#aa480711168f1f90a260496a1877397dd">global_silencethreshold</a></div><div class="ttdeci">static int global_silencethreshold</div><div class="ttdef"><b>Definition:</b> <a href="../../de/dfe/app__minivm_8c_source.html#l00698">app_minivm.c:698</a></div></div>
<div class="ttc" id="network_8h_html_afd80ecbe3170ca4fc85b65cda8659f82"><div class="ttname"><a href="../../d9/d94/network_8h.html#afd80ecbe3170ca4fc85b65cda8659f82">MAXHOSTNAMELEN</a></div><div class="ttdeci">#define MAXHOSTNAMELEN</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d94/network_8h_source.html#l00069">network.h:69</a></div></div>
<div class="ttc" id="astmm_8h_html_ab263849d03fb892847be4986db759737"><div class="ttname"><a href="../../d8/d8a/astmm_8h.html#ab263849d03fb892847be4986db759737">ast_strdup</a></div><div class="ttdeci">#define ast_strdup(str)</div><div class="ttdoc">A wrapper for strdup() </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d8a/astmm_8h_source.html#l00243">astmm.h:243</a></div></div>
<div class="ttc" id="app__minivm_8c_html_a88b50a14c4d1ed9c31d66ae39d11c5c1"><div class="ttname"><a href="../../de/dfe/app__minivm_8c.html#a88b50a14c4d1ed9c31d66ae39d11c5c1">global_mailcmd</a></div><div class="ttdeci">static char global_mailcmd[160]</div><div class="ttdef"><b>Definition:</b> <a href="../../de/dfe/app__minivm_8c_source.html#l00699">app_minivm.c:699</a></div></div>
<div class="ttc" id="structminivm__account_html_adfee50d07a98645d4d20b896ce03785a"><div class="ttname"><a href="../../dc/d7b/structminivm__account.html#adfee50d07a98645d4d20b896ce03785a">minivm_account::accountcode</a></div><div class="ttdeci">char accountcode[AST_MAX_ACCOUNT_CODE]</div><div class="ttdef"><b>Definition:</b> <a href="../../de/dfe/app__minivm_8c_source.html#l00608">app_minivm.c:608</a></div></div>
<div class="ttc" id="app__jack_8c_html_af25d6dc49269fa2003ac7c7fa6f13915"><div class="ttname"><a href="../../de/dcd/app__jack_8c.html#af25d6dc49269fa2003ac7c7fa6f13915">str</a></div><div class="ttdeci">const char * str</div><div class="ttdef"><b>Definition:</b> <a href="../../de/dcd/app__jack_8c_source.html#l00147">app_jack.c:147</a></div></div>
<div class="ttc" id="file_8h_html"><div class="ttname"><a href="../../d2/d4d/file_8h.html">file.h</a></div><div class="ttdoc">Generic File Format Support. Should be included by clients of the file handling routines. File service providers should instead include mod_format.h. </div></div>
<div class="ttc" id="include_2asterisk_2config_8h_html_a1e5e3d08eff5e2357e75c01e127e7922"><div class="ttname"><a href="../../d3/de6/include_2asterisk_2config_8h.html#a1e5e3d08eff5e2357e75c01e127e7922">ast_category_browse</a></div><div class="ttdeci">char * ast_category_browse(struct ast_config *config, const char *prev_name)</div><div class="ttdoc">Browse categories. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/dc5/extconf_8c_source.html#l03328">extconf.c:3328</a></div></div>
<div class="ttc" id="app__minivm_8c_html_a47ff5177c51504731acbd567efea2b17"><div class="ttname"><a href="../../de/dfe/app__minivm_8c.html#a47ff5177c51504731acbd567efea2b17">base_encode</a></div><div class="ttdeci">static int base_encode(char *filename, FILE *so)</div><div class="ttdef"><b>Definition:</b> <a href="../../de/dfe/app__minivm_8c_source.html#l00905">app_minivm.c:905</a></div></div>
<div class="ttc" id="include_2asterisk_2app_8h_html_af6428878db94a4adf8136850e6a654f5"><div class="ttname"><a href="../../d3/d93/include_2asterisk_2app_8h.html#af6428878db94a4adf8136850e6a654f5">ast_unlock_path</a></div><div class="ttdeci">int ast_unlock_path(const char *path)</div><div class="ttdoc">Unlock a path. </div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d83/main_2app_8c_source.html#l02473">main/app.c:2473</a></div></div>
<div class="ttc" id="resample_8c_html_a070d2ce7b6bb7e5c05602aa8c308d0c4"><div class="ttname"><a href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a></div><div class="ttdeci">#define NULL</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d7f/resample_8c_source.html#l00096">resample.c:96</a></div></div>
<div class="ttc" id="app__minivm_8c_html_a9e4e37c5e52de40a691334edf1f7d759"><div class="ttname"><a href="../../de/dfe/app__minivm_8c.html#a9e4e37c5e52de40a691334edf1f7d759">handle_minivm_show_zones</a></div><div class="ttdeci">static char * handle_minivm_show_zones(struct ast_cli_entry *e, int cmd, struct ast_cli_args *a)</div><div class="ttdoc">Show a list of voicemail zones in the CLI. </div><div class="ttdef"><b>Definition:</b> <a href="../../de/dfe/app__minivm_8c_source.html#l03116">app_minivm.c:3116</a></div></div>
<div class="ttc" id="structdomain_html"><div class="ttname"><a href="../../dd/dac/structdomain.html">domain</a></div><div class="ttdoc">Domain data structure. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d94/sip_8h_source.html#l00888">sip.h:888</a></div></div>
<div class="ttc" id="eagi__proxy_8c_html_a8fd806ad19b8f5513a4cf18cbf77532c"><div class="ttname"><a href="../../dd/d7c/eagi__proxy_8c.html#a8fd806ad19b8f5513a4cf18cbf77532c">end</a></div><div class="ttdeci">char * end</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d7c/eagi__proxy_8c_source.html#l00073">eagi_proxy.c:73</a></div></div>
<div class="ttc" id="app__minivm_8c_html_a699f6a5bd7a67eb7b46ad192873e3c73"><div class="ttname"><a href="../../de/dfe/app__minivm_8c.html#a699f6a5bd7a67eb7b46ad192873e3c73">minivm_mwi_exec</a></div><div class="ttdeci">static int minivm_mwi_exec(struct ast_channel *chan, const char *data)</div><div class="ttdef"><b>Definition:</b> <a href="../../de/dfe/app__minivm_8c_source.html#l02099">app_minivm.c:2099</a></div></div>
<div class="ttc" id="app__system_8c_html_adbef7f80c92b734e2eb8b48d975b695d"><div class="ttname"><a href="../../d8/d40/app__system_8c.html#adbef7f80c92b734e2eb8b48d975b695d">chanvar</a></div><div class="ttdeci">static char * chanvar</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d40/app__system_8c_source.html#l00113">app_system.c:113</a></div></div>
<div class="ttc" id="file_8h_html_adb15d6efecc1a13b8835bee6d3562ddb"><div class="ttname"><a href="../../d2/d4d/file_8h.html#adb15d6efecc1a13b8835bee6d3562ddb">ast_filedelete</a></div><div class="ttdeci">int ast_filedelete(const char *filename, const char *fmt)</div><div class="ttdoc">Deletes a file. </div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d13/file_8c_source.html#l01098">file.c:1098</a></div></div>
<div class="ttc" id="syslog_8c_html_ac4f474c82e82cbb89ca7c36dd52be0ed"><div class="ttname"><a href="../../d4/d2f/syslog_8c.html#ac4f474c82e82cbb89ca7c36dd52be0ed">value</a></div><div class="ttdeci">int value</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d2f/syslog_8c_source.html#l00037">syslog.c:37</a></div></div>
<div class="ttc" id="cli_8h_html_a791bf9f5637185bee5e8f0907c762130"><div class="ttname"><a href="../../dc/db0/cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a></div><div class="ttdeci">void ast_cli(int fd, const char *fmt,...)</div><div class="ttdef"><b>Definition:</b> <a href="../../da/d4d/clicompat_8c_source.html#l00006">clicompat.c:6</a></div></div>
<div class="ttc" id="app__minivm_8c_html_abcec5c16680dc75cdf051552d6908042a0097c80109786c14718655071a22e0e8"><div class="ttname"><a href="../../de/dfe/app__minivm_8c.html#abcec5c16680dc75cdf051552d6908042a0097c80109786c14718655071a22e0e8">MVM_MESSAGE_EMAIL</a></div><div class="ttdef"><b>Definition:</b> <a href="../../de/dfe/app__minivm_8c_source.html#l00553">app_minivm.c:553</a></div></div>
<div class="ttc" id="channel_8h_html_adcfd8d241b6de48068ead143ac29978d"><div class="ttname"><a href="../../d5/d7b/channel_8h.html#adcfd8d241b6de48068ead143ac29978d">ast_channel_setoption</a></div><div class="ttdeci">int ast_channel_setoption(struct ast_channel *channel, int option, void *data, int datalen, int block)</div><div class="ttdoc">Sets an option on a channel. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d28/channel_8c_source.html#l07522">channel.c:7522</a></div></div>
<div class="ttc" id="app__minivm_8c_html_a922e4ae6e4c3f8a0ce361b0d3264ca54"><div class="ttname"><a href="../../de/dfe/app__minivm_8c.html#a922e4ae6e4c3f8a0ce361b0d3264ca54">notify_new_message</a></div><div class="ttdeci">static int notify_new_message(struct ast_channel *chan, const char *templatename, struct minivm_account *vmu, const char *filename, long duration, const char *format, char *cidnum, char *cidname)</div><div class="ttdef"><b>Definition:</b> <a href="../../de/dfe/app__minivm_8c_source.html#l01811">app_minivm.c:1811</a></div></div>
<div class="ttc" id="structminivm__stats_html_a5787090892a375d9cfd599710d971b63"><div class="ttname"><a href="../../d6/dee/structminivm__stats.html#a5787090892a375d9cfd599710d971b63">minivm_stats::lastreceived</a></div><div class="ttdeci">struct timeval lastreceived</div><div class="ttdef"><b>Definition:</b> <a href="../../de/dfe/app__minivm_8c_source.html#l00683">app_minivm.c:683</a></div></div>
<div class="ttc" id="app__minivm_8c_html_ac6ccbdf4443ab9722a13578d17b1f7da"><div class="ttname"><a href="../../de/dfe/app__minivm_8c.html#ac6ccbdf4443ab9722a13578d17b1f7da">create_dirpath</a></div><div class="ttdeci">static int create_dirpath(char *dest, int len, char *domain, char *username, char *folder)</div><div class="ttdef"><b>Definition:</b> <a href="../../de/dfe/app__minivm_8c_source.html#l01557">app_minivm.c:1557</a></div></div>
<div class="ttc" id="module_8h_html_ad2ca15621101154f29748cf1dac3c3cf"><div class="ttname"><a href="../../d5/d16/module_8h.html#ad2ca15621101154f29748cf1dac3c3cf">ast_unregister_application</a></div><div class="ttdeci">int ast_unregister_application(const char *app)</div><div class="ttdoc">Unregister an application. </div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d16/pbx__app_8c_source.html#l00392">pbx_app.c:392</a></div></div>
<div class="ttc" id="app__minivm_8c_html_a4aeda8b39c8ab166c538157d05591922a6021f80ddb5561e6e07a285ea47b086e"><div class="ttname"><a href="../../de/dfe/app__minivm_8c.html#a4aeda8b39c8ab166c538157d05591922a6021f80ddb5561e6e07a285ea47b086e">OPT_BUSY_GREETING</a></div><div class="ttdef"><b>Definition:</b> <a href="../../de/dfe/app__minivm_8c_source.html#l00572">app_minivm.c:572</a></div></div>
<div class="ttc" id="channel_8h_html_a6610c8171ced0a69738622c11736ff5e"><div class="ttname"><a href="../../d5/d7b/channel_8h.html#a6610c8171ced0a69738622c11736ff5e">ast_channel_priority</a></div><div class="ttdeci">int ast_channel_priority(const struct ast_channel *chan)</div><div class="ttdef"><b>Definition:</b> <a href="../../db/de2/channel__internal__api_8c_source.html#l00444">channel_internal_api.c:444</a></div></div>
<div class="ttc" id="logger_8h_html_ad770f83c71e237e1f64163358ce4e13d"><div class="ttname"><a href="../../d1/d8c/logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a></div><div class="ttdeci">#define ast_verb(level,...)</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d8c/logger_8h_source.html#l00463">logger.h:463</a></div></div>
<div class="ttc" id="structminivm__account_html_ae43ea5d0335f149f0920d33e46b61c33"><div class="ttname"><a href="../../dc/d7b/structminivm__account.html#ae43ea5d0335f149f0920d33e46b61c33">minivm_account::domain</a></div><div class="ttdeci">char domain[AST_MAX_CONTEXT]</div><div class="ttdef"><b>Definition:</b> <a href="../../de/dfe/app__minivm_8c_source.html#l00602">app_minivm.c:602</a></div></div>
<div class="ttc" id="structast__cli__args_html_a2a7a1aa13a4f14075411123a4495593c"><div class="ttname"><a href="../../d3/dad/structast__cli__args.html#a2a7a1aa13a4f14075411123a4495593c">ast_cli_args::line</a></div><div class="ttdeci">const char * line</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/db0/cli_8h_source.html#l00162">cli.h:162</a></div></div>
<div class="ttc" id="pbx_8h_html_a965977ea9a3144bc203e0ce7a64680a1"><div class="ttname"><a href="../../db/de0/pbx_8h.html#a965977ea9a3144bc203e0ce7a64680a1">ast_custom_function_unregister</a></div><div class="ttdeci">int ast_custom_function_unregister(struct ast_custom_function *acf)</div><div class="ttdoc">Unregister a custom function. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/d70/pbx__functions_8c_source.html#l00273">pbx_functions.c:273</a></div></div>
<div class="ttc" id="structb64__baseio_html_aa3cbb055ee45b46498457488c3df39d8"><div class="ttname"><a href="../../de/d5d/structb64__baseio.html#aa3cbb055ee45b46498457488c3df39d8">b64_baseio::ateof</a></div><div class="ttdeci">int ateof</div><div class="ttdef"><b>Definition:</b> <a href="../../de/dfe/app__minivm_8c_source.html#l00660">app_minivm.c:660</a></div></div>
<div class="ttc" id="pbx_8h_html_a98c5425b90ec7c5e136a40f529170b1b"><div class="ttname"><a href="../../db/de0/pbx_8h.html#a98c5425b90ec7c5e136a40f529170b1b">pbx_builtin_getvar_helper</a></div><div class="ttdeci">const char * pbx_builtin_getvar_helper(struct ast_channel *chan, const char *name)</div><div class="ttdoc">Return a pointer to the value of the corresponding channel variable. </div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d8c/pbx__variables_8c_source.html#l01000">pbx_variables.c:1000</a></div></div>
<div class="ttc" id="channel_8h_html_a9238c3318ae8d3bea2cbbe1d1e459eb7"><div class="ttname"><a href="../../d5/d7b/channel_8h.html#a9238c3318ae8d3bea2cbbe1d1e459eb7">MAX_LANGUAGE</a></div><div class="ttdeci">#define MAX_LANGUAGE</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d7b/channel_8h_source.html#l00173">channel.h:173</a></div></div>
<div class="ttc" id="structminivm__template_html_a2f8ccdb6d4cf2698360e28ee28e70cb3"><div class="ttname"><a href="../../dc/d31/structminivm__template.html#a2f8ccdb6d4cf2698360e28ee28e70cb3">minivm_template::attachment</a></div><div class="ttdeci">int attachment</div><div class="ttdef"><b>Definition:</b> <a href="../../de/dfe/app__minivm_8c_source.html#l00642">app_minivm.c:642</a></div></div>
<div class="ttc" id="utils_8h_html"><div class="ttname"><a href="../../d5/d60/utils_8h.html">utils.h</a></div><div class="ttdoc">Utility functions. </div></div>
<div class="ttc" id="structast__cli__entry_html_a1bd7a8575ca2650132d636d65dcda2f6"><div class="ttname"><a href="../../d8/d07/structast__cli__entry.html#a1bd7a8575ca2650132d636d65dcda2f6">ast_cli_entry::args</a></div><div class="ttdeci">int args</div><div class="ttdoc">This gets set in ast_cli_register() </div><div class="ttdef"><b>Definition:</b> <a href="../../dc/db0/cli_8h_source.html#l00185">cli.h:185</a></div></div>
<div class="ttc" id="strings_8h_html_a372554b7a2d69a8bd3adac5157672036"><div class="ttname"><a href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a></div><div class="ttdeci">#define ast_strlen_zero(foo)</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d90/strings_8h_source.html#l00052">strings.h:52</a></div></div>
<div class="ttc" id="app__minivm_8c_html_ab708636c14961682ea0d718b97f12234"><div class="ttname"><a href="../../de/dfe/app__minivm_8c.html#ab708636c14961682ea0d718b97f12234">leave_voicemail</a></div><div class="ttdeci">static int leave_voicemail(struct ast_channel *chan, char *username, struct leave_vm_options *options)</div><div class="ttdef"><b>Definition:</b> <a href="../../de/dfe/app__minivm_8c_source.html#l01912">app_minivm.c:1912</a></div></div>
<div class="ttc" id="app__voicemail_8c_html_ab89d128ff0a8b3ceab1ec2590bb98b2f"><div class="ttname"><a href="../../dc/df4/app__voicemail_8c.html#ab89d128ff0a8b3ceab1ec2590bb98b2f">emailbody</a></div><div class="ttdeci">static char * emailbody</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/df4/app__voicemail_8c_source.html#l01016">app_voicemail.c:1016</a></div></div>
<div class="ttc" id="structminivm__stats_html_a90ef6fe584f0712a6dfe1e90038da6bf"><div class="ttname"><a href="../../d6/dee/structminivm__stats.html#a90ef6fe584f0712a6dfe1e90038da6bf">minivm_stats::voicemailaccounts</a></div><div class="ttdeci">int voicemailaccounts</div><div class="ttdef"><b>Definition:</b> <a href="../../de/dfe/app__minivm_8c_source.html#l00677">app_minivm.c:677</a></div></div>
<div class="ttc" id="app__minivm_8c_html_abcec5c16680dc75cdf051552d6908042ae7f36447ba359572f25032860eebaeb4"><div class="ttname"><a href="../../de/dfe/app__minivm_8c.html#abcec5c16680dc75cdf051552d6908042ae7f36447ba359572f25032860eebaeb4">MVM_MESSAGE_PAGE</a></div><div class="ttdef"><b>Definition:</b> <a href="../../de/dfe/app__minivm_8c_source.html#l00554">app_minivm.c:554</a></div></div>
<div class="ttc" id="include_2asterisk_2app_8h_html_a520a3c6b7d57903d9a616051da1a019d"><div class="ttname"><a href="../../d3/d93/include_2asterisk_2app_8h.html#a520a3c6b7d57903d9a616051da1a019d">AST_APP_OPTIONS</a></div><div class="ttdeci">#define AST_APP_OPTIONS(holder, options...)</div><div class="ttdoc">Declares an array of options for an application. </div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d93/include_2asterisk_2app_8h_source.html#l01393">include/asterisk/app.h:1393</a></div></div>
<div class="ttc" id="structminivm__account_html_ae120a3d8aeb5d880fba30d84a560efae"><div class="ttname"><a href="../../dc/d7b/structminivm__account.html#ae120a3d8aeb5d880fba30d84a560efae">minivm_account::pincode</a></div><div class="ttdeci">char pincode[10]</div><div class="ttdef"><b>Definition:</b> <a href="../../de/dfe/app__minivm_8c_source.html#l00604">app_minivm.c:604</a></div></div>
<div class="ttc" id="app__minivm_8c_html_a7b0f59d39384ea96ce987b3f14e616c7"><div class="ttname"><a href="../../de/dfe/app__minivm_8c.html#a7b0f59d39384ea96ce987b3f14e616c7">message_template_free</a></div><div class="ttdeci">static void message_template_free(struct minivm_template *template)</div><div class="ttdef"><b>Definition:</b> <a href="../../de/dfe/app__minivm_8c_source.html#l00743">app_minivm.c:743</a></div></div>
<div class="ttc" id="dsp_8h_html_a11a8ce2b7eba2230cab37aad708d9abfa40278495f8621707b864e57e1110d20f"><div class="ttname"><a href="../../d3/d08/dsp_8h.html#a11a8ce2b7eba2230cab37aad708d9abfa40278495f8621707b864e57e1110d20f">THRESHOLD_SILENCE</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d08/dsp_8h_source.html#l00073">dsp.h:73</a></div></div>
<div class="ttc" id="app__minivm_8c_html_af0d420dc6a4cf41d9421d78d8fbf8c2f"><div class="ttname"><a href="../../de/dfe/app__minivm_8c.html#af0d420dc6a4cf41d9421d78d8fbf8c2f">b64_ochar</a></div><div class="ttdeci">static int b64_ochar(struct b64_baseio *bio, int c, FILE *so)</div><div class="ttdef"><b>Definition:</b> <a href="../../de/dfe/app__minivm_8c_source.html#l00886">app_minivm.c:886</a></div></div>
<div class="ttc" id="structnumber_html"><div class="ttname"><a href="../../d6/d49/structnumber.html">number</a></div><div class="ttdoc">Number structure. </div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d55/app__followme_8c_source.html#l00154">app_followme.c:154</a></div></div>
<div class="ttc" id="channel_8h_html_aa5a0589e78ac9e010524872ca0a3cf49"><div class="ttname"><a href="../../d5/d7b/channel_8h.html#aa5a0589e78ac9e010524872ca0a3cf49">AST_MAX_ACCOUNT_CODE</a></div><div class="ttdeci">#define AST_MAX_ACCOUNT_CODE</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d7b/channel_8h_source.html#l00171">channel.h:171</a></div></div>
<div class="ttc" id="localtime_8h_html"><div class="ttname"><a href="../../d5/deb/localtime_8h.html">localtime.h</a></div><div class="ttdoc">Custom localtime functions for multiple timezones. </div></div>
<div class="ttc" id="strings_8h_html_aa3341f35cedca29e60bb7f3927204283"><div class="ttname"><a href="../../d6/d90/strings_8h.html#aa3341f35cedca29e60bb7f3927204283">ast_str_set</a></div><div class="ttdeci">int ast_str_set(struct ast_str **buf, ssize_t max_len, const char *fmt,...)</div><div class="ttdoc">Set a dynamic string using variable arguments. </div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d90/strings_8h_source.html#l01065">strings.h:1065</a></div></div>
<div class="ttc" id="app__minivm_8c_html_afb3339bdf5d1db127a88fc3be1dbcb1c"><div class="ttname"><a href="../../de/dfe/app__minivm_8c.html#afb3339bdf5d1db127a88fc3be1dbcb1c">global_stats</a></div><div class="ttdeci">static struct minivm_stats global_stats</div><div class="ttdoc">Statistics for voicemail. </div><div class="ttdef"><b>Definition:</b> <a href="../../de/dfe/app__minivm_8c_source.html#l00687">app_minivm.c:687</a></div></div>
<div class="ttc" id="structast__party__caller_html_a8791d240f8a9c2dc271a1c8542cfe8cc"><div class="ttname"><a href="../../d4/d77/structast__party__caller.html#a8791d240f8a9c2dc271a1c8542cfe8cc">ast_party_caller::id</a></div><div class="ttdeci">struct ast_party_id id</div><div class="ttdoc">Caller party ID. </div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d7b/channel_8h_source.html#l00421">channel.h:421</a></div></div>
<div class="ttc" id="structminivm__template_html_ad4786cc0738d237b7697e5448da7d22e"><div class="ttname"><a href="../../dc/d31/structminivm__template.html#ad4786cc0738d237b7697e5448da7d22e">minivm_template::locale</a></div><div class="ttdeci">char locale[20]</div><div class="ttdef"><b>Definition:</b> <a href="../../de/dfe/app__minivm_8c_source.html#l00640">app_minivm.c:640</a></div></div>
<div class="ttc" id="include_2asterisk_2app_8h_html_a74c57b5a842dcbc15cc991a31f679a13"><div class="ttname"><a href="../../d3/d93/include_2asterisk_2app_8h.html#a74c57b5a842dcbc15cc991a31f679a13">ast_lock_path</a></div><div class="ttdeci">enum AST_LOCK_RESULT ast_lock_path(const char *path)</div><div class="ttdoc">Lock a filesystem path. </div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d83/main_2app_8c_source.html#l02457">main/app.c:2457</a></div></div>
<div class="ttc" id="include_2asterisk_2config_8h_html"><div class="ttname"><a href="../../d3/de6/include_2asterisk_2config_8h.html">config.h</a></div><div class="ttdoc">Configuration File Parser. </div></div>
<div class="ttc" id="app__minivm_8c_html_a4aeda8b39c8ab166c538157d05591922a9c6a0359498684912cb0a3810e03138d"><div class="ttname"><a href="../../de/dfe/app__minivm_8c.html#a4aeda8b39c8ab166c538157d05591922a9c6a0359498684912cb0a3810e03138d">OPT_SILENT</a></div><div class="ttdef"><b>Definition:</b> <a href="../../de/dfe/app__minivm_8c_source.html#l00571">app_minivm.c:571</a></div></div>
<div class="ttc" id="chan__mgcp_8c_html_a6b49cafa2a3d359a2e865992f551874a"><div class="ttname"><a href="../../d0/dd6/chan__mgcp_8c.html#a6b49cafa2a3d359a2e865992f551874a">mailbox</a></div><div class="ttdeci">static char mailbox[AST_MAX_MAILBOX_UNIQUEID]</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/dd6/chan__mgcp_8c_source.html#l00204">chan_mgcp.c:204</a></div></div>
<div class="ttc" id="logger_8h_html_a3f248112c8d6ce7e3959aa723dade648"><div class="ttname"><a href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a></div><div class="ttdeci">#define ast_debug(level,...)</div><div class="ttdoc">Log a DEBUG message. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d8c/logger_8h_source.html#l00452">logger.h:452</a></div></div>
<div class="ttc" id="astobj2_8c_html_a96a00b3a518d7f32b6d51dc28f09bf9b"><div class="ttname"><a href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a></div><div class="ttdeci">#define ast_log</div><div class="ttdef"><b>Definition:</b> <a href="../../da/df7/astobj2_8c_source.html#l00042">astobj2.c:42</a></div></div>
<div class="ttc" id="app__minivm_8c_html_a9a335978d2517b553066af1f10a4d07f"><div class="ttname"><a href="../../de/dfe/app__minivm_8c.html#a9a335978d2517b553066af1f10a4d07f">check_dirpath</a></div><div class="ttdeci">static int check_dirpath(char *dest, int len, char *domain, char *username, char *folder)</div><div class="ttdef"><b>Definition:</b> <a href="../../de/dfe/app__minivm_8c_source.html#l01538">app_minivm.c:1538</a></div></div>
<div class="ttc" id="app__minivm_8c_html_a437f2bbc010293e475569ccb2e7643b6"><div class="ttname"><a href="../../de/dfe/app__minivm_8c.html#a437f2bbc010293e475569ccb2e7643b6">timezone_destroy_list</a></div><div class="ttdeci">static void timezone_destroy_list(void)</div><div class="ttdoc">Clear list of timezones. </div><div class="ttdef"><b>Definition:</b> <a href="../../de/dfe/app__minivm_8c_source.html#l02695">app_minivm.c:2695</a></div></div>
<div class="ttc" id="compiler_8h_html_af2af475b85aef66019c417d8ded1c435"><div class="ttname"><a href="../../d4/dd1/compiler_8h.html#af2af475b85aef66019c417d8ded1c435">SENTINEL</a></div><div class="ttdeci">#define SENTINEL</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/dd1/compiler_8h_source.html#l00087">compiler.h:87</a></div></div>
<div class="ttc" id="app__minivm_8c_html_ab05c8faac94f3e02ace2458247075f21"><div class="ttname"><a href="../../de/dfe/app__minivm_8c.html#ab05c8faac94f3e02ace2458247075f21">invent_message</a></div><div class="ttdeci">static int invent_message(struct ast_channel *chan, char *domain, char *username, int busy, char *ecodes)</div><div class="ttdef"><b>Definition:</b> <a href="../../de/dfe/app__minivm_8c_source.html#l01573">app_minivm.c:1573</a></div></div>
<div class="ttc" id="app__minivm_8c_html_abcbed0b94b212f947f3acdfcd6fa82ba"><div class="ttname"><a href="../../de/dfe/app__minivm_8c.html#abcbed0b94b212f947f3acdfcd6fa82ba">app_minivm_record</a></div><div class="ttdeci">static char * app_minivm_record</div><div class="ttdef"><b>Definition:</b> <a href="../../de/dfe/app__minivm_8c_source.html#l00561">app_minivm.c:561</a></div></div>
<div class="ttc" id="include_2asterisk_2config_8h_html_a0a07ddd6bbcf44485e01c14c96109482"><div class="ttname"><a href="../../d3/de6/include_2asterisk_2config_8h.html#a0a07ddd6bbcf44485e01c14c96109482">ast_config_load</a></div><div class="ttdeci">#define ast_config_load(filename, flags)</div><div class="ttdoc">Load a config file. </div><div class="ttdef"><b>Definition:</b> <a href="../../d3/de6/include_2asterisk_2config_8h_source.html#l00179">include/asterisk/config.h:179</a></div></div>
<div class="ttc" id="structast__variable_html_a8556878012feffc9e0beb86cd78f424d"><div class="ttname"><a href="../../dd/d02/structast__variable.html#a8556878012feffc9e0beb86cd78f424d">ast_variable::value</a></div><div class="ttdeci">const char * value</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/de6/include_2asterisk_2config_8h_source.html#l00087">include/asterisk/config.h:87</a></div></div>
<div class="ttc" id="structminivm__account_html_aa9d4a76241ab2a75118261777526e04b"><div class="ttname"><a href="../../dc/d7b/structminivm__account.html#aa9d4a76241ab2a75118261777526e04b">minivm_account::exit</a></div><div class="ttdeci">char exit[80]</div><div class="ttdef"><b>Definition:</b> <a href="../../de/dfe/app__minivm_8c_source.html#l00614">app_minivm.c:614</a></div></div>
<div class="ttc" id="muted_8c_html_a41c3a180b50c6b2ddcc1b6843a48f205"><div class="ttname"><a href="../../d0/d8a/muted_8c.html#a41c3a180b50c6b2ddcc1b6843a48f205">host</a></div><div class="ttdeci">static char host[256]</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d8a/muted_8c_source.html#l00077">muted.c:77</a></div></div>
<div class="ttc" id="structminivm__account_html_aadd75c09e15efa9061997f033b3f224b"><div class="ttname"><a href="../../dc/d7b/structminivm__account.html#aadd75c09e15efa9061997f033b3f224b">minivm_account::email</a></div><div class="ttdeci">char email[80]</div><div class="ttdef"><b>Definition:</b> <a href="../../de/dfe/app__minivm_8c_source.html#l00606">app_minivm.c:606</a></div></div>
<div class="ttc" id="callerid_8h_html_a1c25633b1ed63682c95ec613d7cbe559"><div class="ttname"><a href="../../de/d47/callerid_8h.html#a1c25633b1ed63682c95ec613d7cbe559">ast_callerid_merge</a></div><div class="ttdeci">char * ast_callerid_merge(char *buf, int bufsiz, const char *name, const char *num, const char *unknown)</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/dd5/callerid_8c_source.html#l01073">callerid.c:1073</a></div></div>
<div class="ttc" id="structminivm__account_html"><div class="ttname"><a href="../../dc/d7b/structminivm__account.html">minivm_account</a></div><div class="ttdef"><b>Definition:</b> <a href="../../de/dfe/app__minivm_8c_source.html#l00600">app_minivm.c:600</a></div></div>
<div class="ttc" id="channel_8h_html"><div class="ttname"><a href="../../d5/d7b/channel_8h.html">channel.h</a></div><div class="ttdoc">General Asterisk PBX channel definitions. </div></div>
<div class="ttc" id="json_8h_html"><div class="ttname"><a href="../../d4/d05/json_8h.html">json.h</a></div><div class="ttdoc">Asterisk JSON abstraction layer. </div></div>
<div class="ttc" id="structminivm__account_html_ac92588540e8c1d014a08cd8a45462b19"><div class="ttname"><a href="../../dc/d7b/structminivm__account.html#ac92588540e8c1d014a08cd8a45462b19">minivm_account::flags</a></div><div class="ttdeci">unsigned int flags</div><div class="ttdef"><b>Definition:</b> <a href="../../de/dfe/app__minivm_8c_source.html#l00618">app_minivm.c:618</a></div></div>
<div class="ttc" id="app__minivm_8c_html_a273c55efb0bbc772f28cddd2d4bb97c7"><div class="ttname"><a href="../../de/dfe/app__minivm_8c.html#a273c55efb0bbc772f28cddd2d4bb97c7">minivm_notify_exec</a></div><div class="ttdeci">static int minivm_notify_exec(struct ast_channel *chan, const char *data)</div><div class="ttdef"><b>Definition:</b> <a href="../../de/dfe/app__minivm_8c_source.html#l02137">app_minivm.c:2137</a></div></div>
<div class="ttc" id="paths_8h_html"><div class="ttname"><a href="../../dd/df2/paths_8h.html">paths.h</a></div><div class="ttdoc">Asterisk file paths, configured in asterisk.conf. </div></div>
<div class="ttc" id="app__minivm_8c_html_ac06da19dda21a4bac4970057bf72497a"><div class="ttname"><a href="../../de/dfe/app__minivm_8c.html#ac06da19dda21a4bac4970057bf72497a">MVM_OPERATOR</a></div><div class="ttdeci">#define MVM_OPERATOR</div><div class="ttdef"><b>Definition:</b> <a href="../../de/dfe/app__minivm_8c_source.html#l00526">app_minivm.c:526</a></div></div>
<div class="ttc" id="app__minivm_8c_html_aa2a036ff88290149ea425ecea1d4eaf9"><div class="ttname"><a href="../../de/dfe/app__minivm_8c.html#aa2a036ff88290149ea425ecea1d4eaf9">B64_BASEMAXINLINE</a></div><div class="ttdeci">#define B64_BASEMAXINLINE</div><div class="ttdef"><b>Definition:</b> <a href="../../de/dfe/app__minivm_8c_source.html#l00538">app_minivm.c:538</a></div></div>
<div class="ttc" id="utils_8h_html_a1604b4d72144dd3d9f7da668e90337e9"><div class="ttname"><a href="../../d5/d60/utils_8h.html#a1604b4d72144dd3d9f7da668e90337e9">RAII_VAR</a></div><div class="ttdeci">#define RAII_VAR(vartype, varname, initval, dtor)</div><div class="ttdoc">Declare a variable that will call a destructor function when it goes out of scope. </div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d60/utils_8h_source.html#l00911">utils.h:911</a></div></div>
<div class="ttc" id="structast__cli__args_html_acf64f219885421479997667d2ed3f08a"><div class="ttname"><a href="../../d3/dad/structast__cli__args.html#acf64f219885421479997667d2ed3f08a">ast_cli_args::fd</a></div><div class="ttdeci">const int fd</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/db0/cli_8h_source.html#l00159">cli.h:159</a></div></div>
<div class="ttc" id="app__minivm_8c_html_ad09fa931f468002152a3cc2d5ce25eae"><div class="ttname"><a href="../../de/dfe/app__minivm_8c.html#ad09fa931f468002152a3cc2d5ce25eae">unload_module</a></div><div class="ttdeci">static int unload_module(void)</div><div class="ttdoc">Unload mini voicemail module. </div><div class="ttdef"><b>Definition:</b> <a href="../../de/dfe/app__minivm_8c_source.html#l03571">app_minivm.c:3571</a></div></div>
<div class="ttc" id="app__minivm_8c_html_a26130f4cea34db8b2bd022f12615ba33"><div class="ttname"><a href="../../de/dfe/app__minivm_8c.html#a26130f4cea34db8b2bd022f12615ba33">B64_BASELINELEN</a></div><div class="ttdeci">#define B64_BASELINELEN</div><div class="ttdef"><b>Definition:</b> <a href="../../de/dfe/app__minivm_8c_source.html#l00539">app_minivm.c:539</a></div></div>
<div class="ttc" id="structast__cli__args_html_acfc02ec89670db29251fda6a66602ce2"><div class="ttname"><a href="../../d3/dad/structast__cli__args.html#acfc02ec89670db29251fda6a66602ce2">ast_cli_args::n</a></div><div class="ttdeci">const int n</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/db0/cli_8h_source.html#l00165">cli.h:165</a></div></div>
<div class="ttc" id="channel_8h_html_acc0ae2c008f4157736ef290e9ca62572"><div class="ttname"><a href="../../d5/d7b/channel_8h.html#acc0ae2c008f4157736ef290e9ca62572">ast_dummy_channel_alloc</a></div><div class="ttdeci">#define ast_dummy_channel_alloc()</div><div class="ttdoc">Create a fake channel structure. </div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d7b/channel_8h_source.html#l01283">channel.h:1283</a></div></div>
<div class="ttc" id="structminivm__account_html_a571e7afb397f412b54fd1f776dab778f"><div class="ttname"><a href="../../dc/d7b/structminivm__account.html#a571e7afb397f412b54fd1f776dab778f">minivm_account::list</a></div><div class="ttdeci">struct minivm_account::@54 list</div></div>
<div class="ttc" id="structast__custom__function_html"><div class="ttname"><a href="../../db/dc0/structast__custom__function.html">ast_custom_function</a></div><div class="ttdoc">Data structure associated with a custom dialplan function. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/de0/pbx_8h_source.html#l00118">pbx.h:118</a></div></div>
<div class="ttc" id="app__minivm_8c_html_a73e33efd05bd512aa9674f73c578c0db"><div class="ttname"><a href="../../de/dfe/app__minivm_8c.html#a73e33efd05bd512aa9674f73c578c0db">global_maxgreet</a></div><div class="ttdeci">static int global_maxgreet</div><div class="ttdef"><b>Definition:</b> <a href="../../de/dfe/app__minivm_8c_source.html#l00697">app_minivm.c:697</a></div></div>
<div class="ttc" id="structast__party__caller_html"><div class="ttname"><a href="../../d4/d77/structast__party__caller.html">ast_party_caller</a></div><div class="ttdoc">Caller Party information. </div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d7b/channel_8h_source.html#l00419">channel.h:419</a></div></div>
<div class="ttc" id="include_2asterisk_2app_8h_html_abbbec6ab9a303e865a1d1a261152540d"><div class="ttname"><a href="../../d3/d93/include_2asterisk_2app_8h.html#abbbec6ab9a303e865a1d1a261152540d">ast_play_and_wait</a></div><div class="ttdeci">int ast_play_and_wait(struct ast_channel *chan, const char *fn)</div><div class="ttdoc">Play a stream and wait for a digit, returning the digit that was pressed. </div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d83/main_2app_8c_source.html#l01470">main/app.c:1470</a></div></div>
<div class="ttc" id="strings_8h_html_a38a896048b2ca84076864505f0aa8f01"><div class="ttname"><a href="../../d6/d90/strings_8h.html#a38a896048b2ca84076864505f0aa8f01">S_COR</a></div><div class="ttdeci">#define S_COR(a, b, c)</div><div class="ttdoc">returns the equivalent of logic or for strings, with an additional boolean check: second one if not e...</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d90/strings_8h_source.html#l00085">strings.h:85</a></div></div>
<div class="ttc" id="structminivm__template_html_a15ab326eb76ae067ffbf0e770b14350e"><div class="ttname"><a href="../../dc/d31/structminivm__template.html#a15ab326eb76ae067ffbf0e770b14350e">minivm_template::body</a></div><div class="ttdeci">char * body</div><div class="ttdef"><b>Definition:</b> <a href="../../de/dfe/app__minivm_8c_source.html#l00635">app_minivm.c:635</a></div></div>
<div class="ttc" id="app__minivm_8c_html_abb1f2fda603b171867df08ff617507c5"><div class="ttname"><a href="../../de/dfe/app__minivm_8c.html#abb1f2fda603b171867df08ff617507c5">cli_minivm</a></div><div class="ttdeci">static struct ast_cli_entry cli_minivm[]</div><div class="ttdoc">CLI commands for Mini-voicemail. </div><div class="ttdef"><b>Definition:</b> <a href="../../de/dfe/app__minivm_8c_source.html#l03496">app_minivm.c:3496</a></div></div>
<div class="ttc" id="include_2asterisk_2app_8h_html_a13a3ff0da2d7d40198b3eafbde0464a0"><div class="ttname"><a href="../../d3/d93/include_2asterisk_2app_8h.html#a13a3ff0da2d7d40198b3eafbde0464a0">ast_play_and_record_full</a></div><div class="ttdeci">int ast_play_and_record_full(struct ast_channel *chan, const char *playfile, const char *recordfile, int maxtime_sec, const char *fmt, int *duration, int *sound_duration, int beep, int silencethreshold, int maxsilence_ms, const char *path, const char *acceptdtmf, const char *canceldtmf, int skip_confirmation_sound, enum ast_record_if_exists if_exists)</div><div class="ttdoc">Record a file based on input from a channel This function will play &quot;auth-thankyou&quot; upon successful r...</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d83/main_2app_8c_source.html#l01992">main/app.c:1992</a></div></div>
<div class="ttc" id="include_2asterisk_2config_8h_html_a6b4d4d929013de7812fbba4e58353078"><div class="ttname"><a href="../../d3/de6/include_2asterisk_2config_8h.html#a6b4d4d929013de7812fbba4e58353078">ast_config_destroy</a></div><div class="ttdeci">void ast_config_destroy(struct ast_config *config)</div><div class="ttdoc">Destroys a config. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/dc5/extconf_8c_source.html#l01290">extconf.c:1290</a></div></div>
<div class="ttc" id="utils_8h_html_a7b4f10b070e95ba413e258a3e4b03c20"><div class="ttname"><a href="../../d5/d60/utils_8h.html#a7b4f10b070e95ba413e258a3e4b03c20">ast_random</a></div><div class="ttdeci">long int ast_random(void)</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d1f/main_2utils_8c_source.html#l02064">main/utils.c:2064</a></div></div>
<div class="ttc" id="astmm_8h_html_ab5f0750cc80ba337fdcbddea2d3a1ee6"><div class="ttname"><a href="../../d8/d8a/astmm_8h.html#ab5f0750cc80ba337fdcbddea2d3a1ee6">ast_strdupa</a></div><div class="ttdeci">#define ast_strdupa(s)</div><div class="ttdoc">duplicate a string in memory from the stack </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d8a/astmm_8h_source.html#l00300">astmm.h:300</a></div></div>
<div class="ttc" id="structminivm__account_html_a4a081db7653645ce9fce8fd72e5a7bf1"><div class="ttname"><a href="../../dc/d7b/structminivm__account.html#a4a081db7653645ce9fce8fd72e5a7bf1">minivm_account::zonetag</a></div><div class="ttdeci">char zonetag[80]</div><div class="ttdef"><b>Definition:</b> <a href="../../de/dfe/app__minivm_8c_source.html#l00612">app_minivm.c:612</a></div></div>
<div class="ttc" id="structminivm__zone_html_aad16c37028f0efbc3cf8c9186b770ab8"><div class="ttname"><a href="../../d4/d09/structminivm__zone.html#aad16c37028f0efbc3cf8c9186b770ab8">minivm_zone::timezone</a></div><div class="ttdeci">char timezone[80]</div><div class="ttdef"><b>Definition:</b> <a href="../../de/dfe/app__minivm_8c_source.html#l00667">app_minivm.c:667</a></div></div>
<div class="ttc" id="linkedlists_8h_html"><div class="ttname"><a href="../../df/d90/linkedlists_8h.html">linkedlists.h</a></div><div class="ttdoc">A set of macros to manage forward-linked lists. </div></div>
<div class="ttc" id="structast__variable_html_a8f8f80d37794cde9472343e4487ba3eb"><div class="ttname"><a href="../../dd/d02/structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">ast_variable::name</a></div><div class="ttdeci">const char * name</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/de6/include_2asterisk_2config_8h_source.html#l00085">include/asterisk/config.h:85</a></div></div>
<div class="ttc" id="structb64__baseio_html_a4cd390d771f962d39585708c848317e5"><div class="ttname"><a href="../../de/d5d/structb64__baseio.html#a4cd390d771f962d39585708c848317e5">b64_baseio::linelength</a></div><div class="ttdeci">int linelength</div><div class="ttdef"><b>Definition:</b> <a href="../../de/dfe/app__minivm_8c_source.html#l00659">app_minivm.c:659</a></div></div>
<div class="ttc" id="app__minivm_8c_html_ac26055cad7a69cbfb6692d273f025a40"><div class="ttname"><a href="../../de/dfe/app__minivm_8c.html#ac26055cad7a69cbfb6692d273f025a40">find_account</a></div><div class="ttdeci">static struct minivm_account * find_account(const char *domain, const char *username, int createtemp)</div><div class="ttdef"><b>Definition:</b> <a href="../../de/dfe/app__minivm_8c_source.html#l01067">app_minivm.c:1067</a></div></div>
<div class="ttc" id="include_2asterisk_2config_8h_html_a66581086d34dfe7ea86b0644bacef239"><div class="ttname"><a href="../../d3/de6/include_2asterisk_2config_8h.html#a66581086d34dfe7ea86b0644bacef239">ast_variable_new</a></div><div class="ttdeci">#define ast_variable_new(name, value, filename)</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/de6/include_2asterisk_2config_8h_source.html#l00914">include/asterisk/config.h:914</a></div></div>
<div class="ttc" id="linkedlists_8h_html_aadfe2a69fbba4f27c201266a2ca5f989"><div class="ttname"><a href="../../df/d90/linkedlists_8h.html#aadfe2a69fbba4f27c201266a2ca5f989">AST_LIST_REMOVE_HEAD</a></div><div class="ttdeci">#define AST_LIST_REMOVE_HEAD(head, field)</div><div class="ttdoc">Removes and returns the head entry from a list. </div><div class="ttdef"><b>Definition:</b> <a href="../../df/d90/linkedlists_8h_source.html#l00832">linkedlists.h:832</a></div></div>
<div class="ttc" id="app__minivm_8c_html_adbac9975e6eca260a8cf807a604d8e8b"><div class="ttname"><a href="../../de/dfe/app__minivm_8c.html#adbac9975e6eca260a8cf807a604d8e8b">handle_minivm_show_settings</a></div><div class="ttdeci">static char * handle_minivm_show_settings(struct ast_cli_entry *e, int cmd, struct ast_cli_args *a)</div><div class="ttdoc">CLI Show settings. </div><div class="ttdef"><b>Definition:</b> <a href="../../de/dfe/app__minivm_8c_source.html#l03153">app_minivm.c:3153</a></div></div>
<div class="ttc" id="app__minivm_8c_html_aca4c8605b97cb5e7cfc963a88ae76621"><div class="ttname"><a href="../../de/dfe/app__minivm_8c.html#aca4c8605b97cb5e7cfc963a88ae76621">minivm_app_options</a></div><div class="ttdeci">static const struct ast_app_option minivm_app_options[128]</div><div class="ttdef"><b>Definition:</b> <a href="../../de/dfe/app__minivm_8c_source.html#l00589">app_minivm.c:589</a></div></div>
<div class="ttc" id="app__minivm_8c_html_a2a7aec9f0ee827ff0e3863d6bb2fe277"><div class="ttname"><a href="../../de/dfe/app__minivm_8c.html#a2a7aec9f0ee827ff0e3863d6bb2fe277">populate_defaults</a></div><div class="ttdeci">static void populate_defaults(struct minivm_account *vmu)</div><div class="ttdef"><b>Definition:</b> <a href="../../de/dfe/app__minivm_8c_source.html#l01031">app_minivm.c:1031</a></div></div>
<div class="ttc" id="app__minivm_8c_html_a35b1cb78eff65cbd1cda43ce934918cf"><div class="ttname"><a href="../../de/dfe/app__minivm_8c.html#a35b1cb78eff65cbd1cda43ce934918cf">message_template_parse_filebody</a></div><div class="ttdeci">static char * message_template_parse_filebody(const char *filename)</div><div class="ttdoc">Read message template from file. </div><div class="ttdef"><b>Definition:</b> <a href="../../de/dfe/app__minivm_8c_source.html#l02739">app_minivm.c:2739</a></div></div>
<div class="ttc" id="pbx_8h_html_a64a5b8fdc919806135ad427aca9e71b7"><div class="ttname"><a href="../../db/de0/pbx_8h.html#a64a5b8fdc919806135ad427aca9e71b7">ast_exists_extension</a></div><div class="ttdeci">int ast_exists_extension(struct ast_channel *c, const char *context, const char *exten, int priority, const char *callerid)</div><div class="ttdoc">Determine whether an extension exists. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l04179">pbx.c:4179</a></div></div>
<div class="ttc" id="app__minivm_8c_html_aa3e1184e10a123c4ed53c5918da34258"><div class="ttname"><a href="../../de/dfe/app__minivm_8c.html#aa3e1184e10a123c4ed53c5918da34258">ast_str_quote</a></div><div class="ttdeci">static const char * ast_str_quote(struct ast_str **buf, ssize_t maxlen, const char *from)</div><div class="ttdef"><b>Definition:</b> <a href="../../de/dfe/app__minivm_8c_source.html#l01214">app_minivm.c:1214</a></div></div>
<div class="ttc" id="include_2asterisk_2app_8h_html_af40039f1c49c16d0f6fa33fe9c43a0cb"><div class="ttname"><a href="../../d3/d93/include_2asterisk_2app_8h.html#af40039f1c49c16d0f6fa33fe9c43a0cb">ast_app_parse_options</a></div><div class="ttdeci">int ast_app_parse_options(const struct ast_app_option *options, struct ast_flags *flags, char **args, char *optstr)</div><div class="ttdoc">Parses a string containing application options and sets flags/arguments. </div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d83/main_2app_8c_source.html#l02906">main/app.c:2906</a></div></div>
<div class="ttc" id="structlines_html"><div class="ttname"><a href="../../df/d58/structlines.html">lines</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d80/chan__skinny_8c_source.html#l01499">chan_skinny.c:1499</a></div></div>
<div class="ttc" id="app__minivm_8c_html_a9a72c400794fa62f66515ec4ca7fedea"><div class="ttname"><a href="../../de/dfe/app__minivm_8c.html#a9a72c400794fa62f66515ec4ca7fedea">message_template_create</a></div><div class="ttdeci">static struct minivm_template * message_template_create(const char *name)</div><div class="ttdef"><b>Definition:</b> <a href="../../de/dfe/app__minivm_8c_source.html#l00723">app_minivm.c:723</a></div></div>
<div class="ttc" id="channel_8h_html_aa8b52fbc8168e939bc5553502367d46a"><div class="ttname"><a href="../../d5/d7b/channel_8h.html#aa8b52fbc8168e939bc5553502367d46a">ast_channel_exten</a></div><div class="ttdeci">const char * ast_channel_exten(const struct ast_channel *chan)</div><div class="ttdef"><b>Definition:</b> <a href="../../db/de2/channel__internal__api_8c_source.html#l00353">channel_internal_api.c:353</a></div></div>
<div class="ttc" id="pbx_8h_html"><div class="ttname"><a href="../../db/de0/pbx_8h.html">pbx.h</a></div><div class="ttdoc">Core PBX routines and definitions. </div></div>
<div class="ttc" id="app__minivm_8c_html_ac3382bf6da54c56b37069bd76bbdf4f9"><div class="ttname"><a href="../../de/dfe/app__minivm_8c.html#ac3382bf6da54c56b37069bd76bbdf4f9">load_module</a></div><div class="ttdeci">static int load_module(void)</div><div class="ttdoc">Load mini voicemail module. </div><div class="ttdef"><b>Definition:</b> <a href="../../de/dfe/app__minivm_8c_source.html#l03517">app_minivm.c:3517</a></div></div>
<div class="ttc" id="app__minivm_8c_html_a0442dc13ea144464c2b3f9aa6e2d6417"><div class="ttname"><a href="../../de/dfe/app__minivm_8c.html#a0442dc13ea144464c2b3f9aa6e2d6417">global_maxsilence</a></div><div class="ttdeci">static int global_maxsilence</div><div class="ttdef"><b>Definition:</b> <a href="../../de/dfe/app__minivm_8c_source.html#l00696">app_minivm.c:696</a></div></div>
<div class="ttc" id="include_2asterisk_2config_8h_html_a846844eb2c4eb44554445936b3770711"><div class="ttname"><a href="../../d3/de6/include_2asterisk_2config_8h.html#a846844eb2c4eb44554445936b3770711">CONFIG_STATUS_FILEUNCHANGED</a></div><div class="ttdeci">#define CONFIG_STATUS_FILEUNCHANGED</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/de6/include_2asterisk_2config_8h_source.html#l00059">include/asterisk/config.h:59</a></div></div>
<div class="ttc" id="linkedlists_8h_html_a10f9ed9242a397abf76de1ed1fa33c3b"><div class="ttname"><a href="../../df/d90/linkedlists_8h.html#a10f9ed9242a397abf76de1ed1fa33c3b">AST_LIST_HEAD_STATIC</a></div><div class="ttdeci">#define AST_LIST_HEAD_STATIC(name, type)</div><div class="ttdoc">Defines a structure to be used to hold a list of specified type, statically initialized. </div><div class="ttdef"><b>Definition:</b> <a href="../../df/d90/linkedlists_8h_source.html#l00290">linkedlists.h:290</a></div></div>
<div class="ttc" id="app__minivm_8c_html_aa7d6976536ff844492de44d3c0099622"><div class="ttname"><a href="../../de/dfe/app__minivm_8c.html#aa7d6976536ff844492de44d3c0099622">mvm_user_alloc</a></div><div class="ttdeci">static struct minivm_account * mvm_user_alloc(void)</div><div class="ttdef"><b>Definition:</b> <a href="../../de/dfe/app__minivm_8c_source.html#l01040">app_minivm.c:1040</a></div></div>
<div class="ttc" id="channel_8h_html_a3b6254f6d3832ef928f0a727113b1c63"><div class="ttname"><a href="../../d5/d7b/channel_8h.html#a3b6254f6d3832ef928f0a727113b1c63">ast_channel_uniqueid</a></div><div class="ttdeci">const char * ast_channel_uniqueid(const struct ast_channel *chan)</div><div class="ttdef"><b>Definition:</b> <a href="../../db/de2/channel__internal__api_8c_source.html#l00305">channel_internal_api.c:305</a></div></div>
<div class="ttc" id="structast__cli__args_html_ad0a19c4d63698f9e9cfd5653e8851452"><div class="ttname"><a href="../../d3/dad/structast__cli__args.html#ad0a19c4d63698f9e9cfd5653e8851452">ast_cli_args::argv</a></div><div class="ttdeci">const char *const  * argv</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/db0/cli_8h_source.html#l00161">cli.h:161</a></div></div>
<div class="ttc" id="app__minivm_8c_html_a08a7003915f9def80dc85f09114aa1da"><div class="ttname"><a href="../../de/dfe/app__minivm_8c.html#a08a7003915f9def80dc85f09114aa1da">minivmlogfile</a></div><div class="ttdeci">static FILE * minivmlogfile</div><div class="ttdef"><b>Definition:</b> <a href="../../de/dfe/app__minivm_8c_source.html#l00692">app_minivm.c:692</a></div></div>
<div class="ttc" id="structminivm__account_html_a97d0f923218857a92e83d94dcbfe0263"><div class="ttname"><a href="../../dc/d7b/structminivm__account.html#a97d0f923218857a92e83d94dcbfe0263">minivm_account::volgain</a></div><div class="ttdeci">double volgain</div><div class="ttdef"><b>Definition:</b> <a href="../../de/dfe/app__minivm_8c_source.html#l00620">app_minivm.c:620</a></div></div>
<div class="ttc" id="app__minivm_8c_html_a570bd183017b9d995580f6b56b4b2c8f"><div class="ttname"><a href="../../de/dfe/app__minivm_8c.html#a570bd183017b9d995580f6b56b4b2c8f">complete_minivm_show_users</a></div><div class="ttdeci">static char * complete_minivm_show_users(const char *line, const char *word, int pos, int state)</div><div class="ttdef"><b>Definition:</b> <a href="../../de/dfe/app__minivm_8c_source.html#l03045">app_minivm.c:3045</a></div></div>
<div class="ttc" id="app__minivm_8c_html_aabc4f6848e55b853556bff4ccf48de37"><div class="ttname"><a href="../../de/dfe/app__minivm_8c.html#aabc4f6848e55b853556bff4ccf48de37">HMSZ_OUTPUT_FORMAT</a></div><div class="ttdeci">#define HMSZ_OUTPUT_FORMAT</div></div>
<div class="ttc" id="app__minivm_8c_html_a2123bebd3dd82a1f29ad87ff972eb31e"><div class="ttname"><a href="../../de/dfe/app__minivm_8c.html#a2123bebd3dd82a1f29ad87ff972eb31e">default_vmformat</a></div><div class="ttdeci">static char default_vmformat[80]</div><div class="ttdef"><b>Definition:</b> <a href="../../de/dfe/app__minivm_8c_source.html#l00702">app_minivm.c:702</a></div></div>
<div class="ttc" id="app__minivm_8c_html_ac7e81a2c8a348c7369525f63242d6a66"><div class="ttname"><a href="../../de/dfe/app__minivm_8c.html#ac7e81a2c8a348c7369525f63242d6a66">sendmail</a></div><div class="ttdeci">static int sendmail(struct minivm_template *template, struct minivm_account *vmu, char *cidnum, char *cidname, const char *filename, char *format, int duration, int attach_user_voicemail, enum mvm_messagetype type, const char *counter)</div><div class="ttdef"><b>Definition:</b> <a href="../../de/dfe/app__minivm_8c_source.html#l01234">app_minivm.c:1234</a></div></div>
<div class="ttc" id="logger_8h_html_aced66975c154ea0e2a8ec3bc818b4e08"><div class="ttname"><a href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a></div><div class="ttdeci">#define LOG_ERROR</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d8c/logger_8h_source.html#l00285">logger.h:285</a></div></div>
<div class="ttc" id="linkedlists_8h_html_a4d258b4525e63c435d7de579d3f46960"><div class="ttname"><a href="../../df/d90/linkedlists_8h.html#a4d258b4525e63c435d7de579d3f46960">AST_LIST_INSERT_TAIL</a></div><div class="ttdeci">#define AST_LIST_INSERT_TAIL(head, elm, field)</div><div class="ttdoc">Appends a list entry to the tail of a list. </div><div class="ttdef"><b>Definition:</b> <a href="../../df/d90/linkedlists_8h_source.html#l00730">linkedlists.h:730</a></div></div>
<div class="ttc" id="structminivm__account_html_a06c0918fa1a1aac3d386fca59b12327c"><div class="ttname"><a href="../../dc/d7b/structminivm__account.html#a06c0918fa1a1aac3d386fca59b12327c">minivm_account::chanvars</a></div><div class="ttdeci">struct ast_variable * chanvars</div><div class="ttdef"><b>Definition:</b> <a href="../../de/dfe/app__minivm_8c_source.html#l00619">app_minivm.c:619</a></div></div>
<div class="ttc" id="app__minivm_8c_html_a42eb1cc1b531f7e8f240fbe0eb6ad1bb"><div class="ttname"><a href="../../de/dfe/app__minivm_8c.html#a42eb1cc1b531f7e8f240fbe0eb6ad1bb">check_mime</a></div><div class="ttdeci">static int check_mime(const char *str)</div><div class="ttdef"><b>Definition:</b> <a href="../../de/dfe/app__minivm_8c_source.html#l01144">app_minivm.c:1144</a></div></div>
<div class="ttc" id="app__minivm_8c_html_a2091dc4ee24682aee893c0633da31eca"><div class="ttname"><a href="../../de/dfe/app__minivm_8c.html#a2091dc4ee24682aee893c0633da31eca">handle_minivm_show_stats</a></div><div class="ttdeci">static char * handle_minivm_show_stats(struct ast_cli_entry *e, int cmd, struct ast_cli_args *a)</div><div class="ttdoc">Show stats. </div><div class="ttdef"><b>Definition:</b> <a href="../../de/dfe/app__minivm_8c_source.html#l03185">app_minivm.c:3185</a></div></div>
<div class="ttc" id="strings_8h_html_a387a69b3871ca31061566a73f45d20f4"><div class="ttname"><a href="../../d6/d90/strings_8h.html#a387a69b3871ca31061566a73f45d20f4">ast_true</a></div><div class="ttdeci">int attribute_pure ast_true(const char *val)</div><div class="ttdoc">Make sure something is true. Determine if a string containing a boolean value is &quot;true&quot;. This function checks to see whether a string passed to it is an indication of an &quot;true&quot; value. It checks to see if the string is &quot;yes&quot;, &quot;true&quot;, &quot;y&quot;, &quot;t&quot;, &quot;on&quot; or &quot;1&quot;. </div><div class="ttdef"><b>Definition:</b> <a href="../../de/d1f/main_2utils_8c_source.html#l01951">main/utils.c:1951</a></div></div>
<div class="ttc" id="structast__str_html"><div class="ttname"><a href="../../dd/da2/structast__str.html">ast_str</a></div><div class="ttdoc">The descriptor of a dynamic string XXX storage will be optimized later if needed We use the ts field ...</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d90/strings_8h_source.html#l00584">strings.h:584</a></div></div>
<div class="ttc" id="structb64__baseio_html_a316bf829c0f058fa97c89eb595b5a3a9"><div class="ttname"><a href="../../de/d5d/structb64__baseio.html#a316bf829c0f058fa97c89eb595b5a3a9">b64_baseio::iobuf</a></div><div class="ttdeci">unsigned char iobuf[B64_BASEMAXINLINE]</div><div class="ttdef"><b>Definition:</b> <a href="../../de/dfe/app__minivm_8c_source.html#l00661">app_minivm.c:661</a></div></div>
<div class="ttc" id="include_2asterisk_2app_8h_html_a9fb5cf0385848033ee3e98625e5f9784"><div class="ttname"><a href="../../d3/d93/include_2asterisk_2app_8h.html#a9fb5cf0385848033ee3e98625e5f9784">ast_safe_system</a></div><div class="ttdeci">int ast_safe_system(const char *s)</div><div class="ttdoc">Safely spawn an OS shell command while closing file descriptors. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/dc5/extconf_8c_source.html#l00829">extconf.c:829</a></div></div>
<div class="ttc" id="structminivm__account_html_a06a75ac3b083fdd79d2947ca4aa77842"><div class="ttname"><a href="../../dc/d7b/structminivm__account.html#a06a75ac3b083fdd79d2947ca4aa77842">minivm_account::uniqueid</a></div><div class="ttdeci">char uniqueid[20]</div><div class="ttdef"><b>Definition:</b> <a href="../../de/dfe/app__minivm_8c_source.html#l00613">app_minivm.c:613</a></div></div>
<div class="ttc" id="include_2asterisk_2frame_8h_html_a3e9274bcddca58b613f4e676b9943c03"><div class="ttname"><a href="../../d6/d66/include_2asterisk_2frame_8h.html#a3e9274bcddca58b613f4e676b9943c03">AST_OPTION_RXGAIN</a></div><div class="ttdeci">#define AST_OPTION_RXGAIN</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d66/include_2asterisk_2frame_8h_source.html#l00453">include/asterisk/frame.h:453</a></div></div>
<div class="ttc" id="include_2asterisk_2compat_8h_html_a09c40bd781f93eb20cdd2eedf34eadeb"><div class="ttname"><a href="../../de/da3/include_2asterisk_2compat_8h.html#a09c40bd781f93eb20cdd2eedf34eadeb">mkdtemp</a></div><div class="ttdeci">char * mkdtemp(char *template_s)</div></div>
<div class="ttc" id="include_2asterisk_2app_8h_html_a7549377df87038be737e8cae73acaa9d"><div class="ttname"><a href="../../d3/d93/include_2asterisk_2app_8h.html#a7549377df87038be737e8cae73acaa9d">AST_APP_OPTION_ARG</a></div><div class="ttdeci">#define AST_APP_OPTION_ARG(option, flagno, argno)</div><div class="ttdoc">Declares an application option that accepts an argument. </div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d93/include_2asterisk_2app_8h_source.html#l01413">include/asterisk/app.h:1413</a></div></div>
<div class="ttc" id="cli_8h_html_a0873456096960dab21fff0ce68c95acb"><div class="ttname"><a href="../../dc/db0/cli_8h.html#a0873456096960dab21fff0ce68c95acb">CLI_SHOWUSAGE</a></div><div class="ttdeci">#define CLI_SHOWUSAGE</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/db0/cli_8h_source.html#l00045">cli.h:45</a></div></div>
<div class="ttc" id="paths_8h_html_a7d3836e5581e433c9f5edd30300cc187"><div class="ttname"><a href="../../dd/df2/paths_8h.html#a7d3836e5581e433c9f5edd30300cc187">ast_config_AST_CONFIG_DIR</a></div><div class="ttdeci">const char * ast_config_AST_CONFIG_DIR</div><div class="ttdef"><b>Definition:</b> <a href="../../de/dc5/options_8c_source.html#l00151">options.c:151</a></div></div>
<div class="ttc" id="app__minivm_8c_html_a4aeda8b39c8ab166c538157d05591922a96240d093eacd367dd06de745d12e559"><div class="ttname"><a href="../../de/dfe/app__minivm_8c.html#a4aeda8b39c8ab166c538157d05591922a96240d093eacd367dd06de745d12e559">OPT_UNAVAIL_GREETING</a></div><div class="ttdef"><b>Definition:</b> <a href="../../de/dfe/app__minivm_8c_source.html#l00573">app_minivm.c:573</a></div></div>
<div class="ttc" id="func__strings_8c_html_af24e73aaf92f3000fda15d285e66df24"><div class="ttname"><a href="../../d9/d1e/func__strings_8c.html#af24e73aaf92f3000fda15d285e66df24">len</a></div><div class="ttdeci">static int len(struct ast_channel *chan, const char *cmd, char *data, char *buf, size_t buflen)</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d1e/func__strings_8c_source.html#l01344">func_strings.c:1344</a></div></div>
<div class="ttc" id="main_2stdtime_2private_8h_html_ad65a8842cc674e3ddf69355898c0ecbf"><div class="ttname"><a href="../../d1/d6e/main_2stdtime_2private_8h.html#ad65a8842cc674e3ddf69355898c0ecbf">errno</a></div><div class="ttdeci">int errno</div></div>
<div class="ttc" id="structminivm__zone_html_a2c72a3f1a42813cfe7e2c79ef3fa9e6c"><div class="ttname"><a href="../../d4/d09/structminivm__zone.html#a2c72a3f1a42813cfe7e2c79ef3fa9e6c">minivm_zone::msg_format</a></div><div class="ttdeci">char msg_format[BUFSIZ]</div><div class="ttdef"><b>Definition:</b> <a href="../../de/dfe/app__minivm_8c_source.html#l00668">app_minivm.c:668</a></div></div>
<div class="ttc" id="structminivm__zone_html"><div class="ttname"><a href="../../d4/d09/structminivm__zone.html">minivm_zone</a></div><div class="ttdoc">Voicemail time zones. </div><div class="ttdef"><b>Definition:</b> <a href="../../de/dfe/app__minivm_8c_source.html#l00665">app_minivm.c:665</a></div></div>
<div class="ttc" id="structminivm__stats_html_a6e076e5da3ca4090f6072b01a7e0a05c"><div class="ttname"><a href="../../d6/dee/structminivm__stats.html#a6e076e5da3ca4090f6072b01a7e0a05c">minivm_stats::receivedmessages</a></div><div class="ttdeci">int receivedmessages</div><div class="ttdef"><b>Definition:</b> <a href="../../de/dfe/app__minivm_8c_source.html#l00682">app_minivm.c:682</a></div></div>
<div class="ttc" id="structb64__baseio_html_aaa24cfd3a54978c05a8d852aa7e77ec5"><div class="ttname"><a href="../../de/d5d/structb64__baseio.html#aaa24cfd3a54978c05a8d852aa7e77ec5">b64_baseio::iocp</a></div><div class="ttdeci">int iocp</div><div class="ttdef"><b>Definition:</b> <a href="../../de/dfe/app__minivm_8c_source.html#l00657">app_minivm.c:657</a></div></div>
<div class="ttc" id="logger_8h_html_ad89ee324d180cdcd7defcc709ff9ca42"><div class="ttname"><a href="../../d1/d8c/logger_8h.html#ad89ee324d180cdcd7defcc709ff9ca42">LOG_NOTICE</a></div><div class="ttdeci">#define LOG_NOTICE</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d8c/logger_8h_source.html#l00263">logger.h:263</a></div></div>
<div class="ttc" id="structast__config_html"><div class="ttname"><a href="../../dd/d18/structast__config.html">ast_config</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d2/d9d/main_2config_8c_source.html#l00249">main/config.c:249</a></div></div>
<div class="ttc" id="paths_8h_html_aea5e16ca2517e2093fdfa0e7fd112f0f"><div class="ttname"><a href="../../dd/df2/paths_8h.html#aea5e16ca2517e2093fdfa0e7fd112f0f">ast_config_AST_LOG_DIR</a></div><div class="ttdeci">const char * ast_config_AST_LOG_DIR</div><div class="ttdef"><b>Definition:</b> <a href="../../de/dc5/options_8c_source.html#l00159">options.c:159</a></div></div>
<div class="ttc" id="app__minivm_8c_html_af8b65ae2fa0c59765887e094566196bf"><div class="ttname"><a href="../../de/dfe/app__minivm_8c.html#af8b65ae2fa0c59765887e094566196bf">app_minivm_mwi</a></div><div class="ttdeci">static char * app_minivm_mwi</div><div class="ttdef"><b>Definition:</b> <a href="../../de/dfe/app__minivm_8c_source.html#l00566">app_minivm.c:566</a></div></div>
<div class="ttc" id="linkedlists_8h_html_a3008b2f4f236b72d8bcfb80e346324ef"><div class="ttname"><a href="../../df/d90/linkedlists_8h.html#a3008b2f4f236b72d8bcfb80e346324ef">AST_LIST_TRAVERSE</a></div><div class="ttdeci">#define AST_LIST_TRAVERSE(head, var, field)</div><div class="ttdoc">Loops over (traverses) the entries in a list. </div><div class="ttdef"><b>Definition:</b> <a href="../../df/d90/linkedlists_8h_source.html#l00490">linkedlists.h:490</a></div></div>
<div class="ttc" id="linkedlists_8h_html_a67508a613c8f337732e35d9367b43ae7"><div class="ttname"><a href="../../df/d90/linkedlists_8h.html#a67508a613c8f337732e35d9367b43ae7">AST_LIST_ENTRY</a></div><div class="ttdeci">#define AST_LIST_ENTRY(type)</div><div class="ttdoc">Declare a forward link structure inside a list entry. </div><div class="ttdef"><b>Definition:</b> <a href="../../df/d90/linkedlists_8h_source.html#l00409">linkedlists.h:409</a></div></div>
<div class="ttc" id="channel_8h_html_af476c537b29be3f29240489032f9db39"><div class="ttname"><a href="../../d5/d7b/channel_8h.html#af476c537b29be3f29240489032f9db39">ast_channel_unlock</a></div><div class="ttdeci">#define ast_channel_unlock(chan)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d7b/channel_8h_source.html#l02946">channel.h:2946</a></div></div>
<div class="ttc" id="cli_8h_html_ae47751901c430ebb833e59291a5e0b3f"><div class="ttname"><a href="../../dc/db0/cli_8h.html#ae47751901c430ebb833e59291a5e0b3f">CLI_FAILURE</a></div><div class="ttdeci">#define CLI_FAILURE</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/db0/cli_8h_source.html#l00046">cli.h:46</a></div></div>
<div class="ttc" id="app__minivm_8c_html_aa7201009c7bbfdaf680e6194aaed27ab"><div class="ttname"><a href="../../de/dfe/app__minivm_8c.html#aa7201009c7bbfdaf680e6194aaed27ab">global_saydurationminfo</a></div><div class="ttdeci">static int global_saydurationminfo</div><div class="ttdef"><b>Definition:</b> <a href="../../de/dfe/app__minivm_8c_source.html#l00705">app_minivm.c:705</a></div></div>
<div class="ttc" id="stasis_8h_html_ac43d0a33d111e9f34b441b285c166cfc"><div class="ttname"><a href="../../dd/d79/stasis_8h.html#ac43d0a33d111e9f34b441b285c166cfc">stasis_publish</a></div><div class="ttdeci">void stasis_publish(struct stasis_topic *topic, struct stasis_message *message)</div><div class="ttdoc">Publish a message to a topic&amp;#39;s subscribers. </div><div class="ttdef"><b>Definition:</b> <a href="../../d0/df4/stasis_8c_source.html#l01511">stasis.c:1511</a></div></div>
<div class="ttc" id="app__minivm_8c_html_a44b4ef79fbbffd154a9398d0d12124a3"><div class="ttname"><a href="../../de/dfe/app__minivm_8c.html#a44b4ef79fbbffd154a9398d0d12124a3">minivmloglock</a></div><div class="ttdeci">static ast_mutex_t minivmloglock</div><div class="ttdef"><b>Definition:</b> <a href="../../de/dfe/app__minivm_8c_source.html#l00690">app_minivm.c:690</a></div></div>
<div class="ttc" id="channel_8h_html_abcf1aea85b924e9cd605040b86241e2a"><div class="ttname"><a href="../../d5/d7b/channel_8h.html#abcf1aea85b924e9cd605040b86241e2a">AST_MAX_CONTEXT</a></div><div class="ttdeci">#define AST_MAX_CONTEXT</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d7b/channel_8h_source.html#l00136">channel.h:136</a></div></div>
<div class="ttc" id="cdr__mysql_8c_html_a0980a105ccb863d8008eb6201a51da52"><div class="ttname"><a href="../../d0/d29/cdr__mysql_8c.html#a0980a105ccb863d8008eb6201a51da52">name</a></div><div class="ttdeci">static const char name[]</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d29/cdr__mysql_8c_source.html#l00074">cdr_mysql.c:74</a></div></div>
<div class="ttc" id="astmm_8h_html_a402072d6789f6ed9e3a81da27504127e"><div class="ttname"><a href="../../d8/d8a/astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a></div><div class="ttdeci">#define ast_free(a)</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d8a/astmm_8h_source.html#l00182">astmm.h:182</a></div></div>
<div class="ttc" id="structast__cli__entry_html_ade9cba72805fe52685a1deea307a8e82"><div class="ttname"><a href="../../d8/d07/structast__cli__entry.html#ade9cba72805fe52685a1deea307a8e82">ast_cli_entry::command</a></div><div class="ttdeci">char * command</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/db0/cli_8h_source.html#l00186">cli.h:186</a></div></div>
<div class="ttc" id="astmm_8h_html_ae0cd4c5524b01287ab19cbe233d9cebb"><div class="ttname"><a href="../../d8/d8a/astmm_8h.html#ae0cd4c5524b01287ab19cbe233d9cebb">ast_calloc</a></div><div class="ttdeci">#define ast_calloc(num, len)</div><div class="ttdoc">A wrapper for calloc() </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d8a/astmm_8h_source.html#l00204">astmm.h:204</a></div></div>
<div class="ttc" id="app__minivm_8c_html_a68d5c7aefed3c23982c7cde54c84fb10"><div class="ttname"><a href="../../de/dfe/app__minivm_8c.html#a68d5c7aefed3c23982c7cde54c84fb10">DEFAULT_CHARSET</a></div><div class="ttdeci">#define DEFAULT_CHARSET</div><div class="ttdef"><b>Definition:</b> <a href="../../de/dfe/app__minivm_8c_source.html#l00712">app_minivm.c:712</a></div></div>
<div class="ttc" id="app__minivm_8c_html_a4aeda8b39c8ab166c538157d05591922"><div class="ttname"><a href="../../de/dfe/app__minivm_8c.html#a4aeda8b39c8ab166c538157d05591922">minivm_option_flags</a></div><div class="ttdeci">minivm_option_flags</div><div class="ttdef"><b>Definition:</b> <a href="../../de/dfe/app__minivm_8c_source.html#l00570">app_minivm.c:570</a></div></div>
<div class="ttc" id="file_8h_html_a95b94a020720147325a486e210b36775"><div class="ttname"><a href="../../d2/d4d/file_8h.html#a95b94a020720147325a486e210b36775">ast_stream_and_wait</a></div><div class="ttdeci">int ast_stream_and_wait(struct ast_channel *chan, const char *file, const char *digits)</div><div class="ttdoc">stream file until digit If the file name is non-empty, try to play it. </div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d13/file_8c_source.html#l01814">file.c:1814</a></div></div>
<div class="ttc" id="utils_8h_html_afb8683b4d96960d7a82a86a974a57599"><div class="ttname"><a href="../../d5/d60/utils_8h.html#afb8683b4d96960d7a82a86a974a57599">AST_FLAGS_ALL</a></div><div class="ttdeci">#define AST_FLAGS_ALL</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d60/utils_8h_source.html#l00196">utils.h:196</a></div></div>
<div class="ttc" id="app__minivm_8c_html_a6d414e863f3534b892d3cd56fbb238f3"><div class="ttname"><a href="../../de/dfe/app__minivm_8c.html#a6d414e863f3534b892d3cd56fbb238f3">message_template_parse_emailbody</a></div><div class="ttdeci">static char * message_template_parse_emailbody(const char *body)</div><div class="ttdoc">Parse emailbody template from configuration file. </div><div class="ttdef"><b>Definition:</b> <a href="../../de/dfe/app__minivm_8c_source.html#l02779">app_minivm.c:2779</a></div></div>
<div class="ttc" id="structast__cli__args_html_adc1f34651f7bbfa3ba5af27db5f53817"><div class="ttname"><a href="../../d3/dad/structast__cli__args.html#adc1f34651f7bbfa3ba5af27db5f53817">ast_cli_args::word</a></div><div class="ttdeci">const char * word</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/db0/cli_8h_source.html#l00163">cli.h:163</a></div></div>
<div class="ttc" id="paths_8h_html_a95c5b4ffe620dc96d1ea9311b35c4d4f"><div class="ttname"><a href="../../dd/df2/paths_8h.html#a95c5b4ffe620dc96d1ea9311b35c4d4f">ast_config_AST_SPOOL_DIR</a></div><div class="ttdeci">const char * ast_config_AST_SPOOL_DIR</div><div class="ttdef"><b>Definition:</b> <a href="../../de/dc5/options_8c_source.html#l00154">options.c:154</a></div></div>
<div class="ttc" id="localtime_8h_html_aa8e63928b14a347bd3973d680b885f93"><div class="ttname"><a href="../../d5/deb/localtime_8h.html#aa8e63928b14a347bd3973d680b885f93">ast_strftime</a></div><div class="ttdeci">int ast_strftime(char *buf, size_t len, const char *format, const struct ast_tm *tm)</div><div class="ttdoc">Special version of strftime(3) that handles fractions of a second. Takes the same arguments as strfti...</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/df8/localtime_8c_source.html#l02524">localtime.c:2524</a></div></div>
<div class="ttc" id="mwi_8h_html_a3cbb94b9d65cd0a9beb2276292946a61"><div class="ttname"><a href="../../dc/d33/mwi_8h.html#a3cbb94b9d65cd0a9beb2276292946a61">ast_publish_mwi_state_channel</a></div><div class="ttdeci">#define ast_publish_mwi_state_channel(mailbox, context, new_msgs, old_msgs, channel_id)</div><div class="ttdoc">Publish a MWI state update associated with some channel. </div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d33/mwi_8h_source.html#l00397">mwi.h:397</a></div></div>
<div class="ttc" id="app__minivm_8c_html_ac95efb91330674db4cf67d25cde8ff3e"><div class="ttname"><a href="../../de/dfe/app__minivm_8c.html#ac95efb91330674db4cf67d25cde8ff3e">global_externnotify</a></div><div class="ttdeci">static char global_externnotify[160]</div><div class="ttdef"><b>Definition:</b> <a href="../../de/dfe/app__minivm_8c_source.html#l00700">app_minivm.c:700</a></div></div>
<div class="ttc" id="structstate_html"><div class="ttname"><a href="../../d4/d88/structstate.html">state</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d9/df8/localtime_8c_source.html#l00158">localtime.c:158</a></div></div>
<div class="ttc" id="chan__unistim_8c_html_a8bd4accafd4e712317ed9a471738a971"><div class="ttname"><a href="../../d1/d6d/chan__unistim_8c.html#a8bd4accafd4e712317ed9a471738a971">charset</a></div><div class="ttdeci">charset</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d6d/chan__unistim_8c_source.html#l00336">chan_unistim.c:336</a></div></div>
<div class="ttc" id="app__minivm_8c_html_ab341e61c475ac36a8896ce244ac1d691"><div class="ttname"><a href="../../de/dfe/app__minivm_8c.html#ab341e61c475ac36a8896ce244ac1d691">global_volgain</a></div><div class="ttdeci">static double global_volgain</div><div class="ttdef"><b>Definition:</b> <a href="../../de/dfe/app__minivm_8c_source.html#l00707">app_minivm.c:707</a></div></div>
<div class="ttc" id="structminivm__stats_html_ae86e86585a988ba3e05e4f4a92ad6b75"><div class="ttname"><a href="../../d6/dee/structminivm__stats.html#ae86e86585a988ba3e05e4f4a92ad6b75">minivm_stats::timezones</a></div><div class="ttdeci">int timezones</div><div class="ttdef"><b>Definition:</b> <a href="../../de/dfe/app__minivm_8c_source.html#l00678">app_minivm.c:678</a></div></div>
<div class="ttc" id="structast__flags_html"><div class="ttname"><a href="../../dc/dac/structast__flags.html">ast_flags</a></div><div class="ttdoc">Structure used to handle boolean flags. </div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d60/utils_8h_source.html#l00199">utils.h:199</a></div></div>
<div class="ttc" id="structminivm__zones_html"><div class="ttname"><a href="../../db/dce/structminivm__zones.html">minivm_zones</a></div><div class="ttdoc">The list of e-mail time zones. </div><div class="ttdef"><b>Definition:</b> <a href="../../de/dfe/app__minivm_8c_source.html#l00673">app_minivm.c:673</a></div></div>
<div class="ttc" id="res__phoneprov_8c_html_addaa208b0ed785225e24490fb9f28a80"><div class="ttname"><a href="../../d9/de9/res__phoneprov_8c.html#addaa208b0ed785225e24490fb9f28a80">AST_MODULE_INFO</a></div><div class="ttdeci">AST_MODULE_INFO(ASTERISK_GPL_KEY, AST_MODFLAG_GLOBAL_SYMBOLS|AST_MODFLAG_LOAD_ORDER, &quot;HTTP Phone Provisioning&quot;,.support_level=AST_MODULE_SUPPORT_EXTENDED,.load=load_module,.unload=unload_module,.reload=reload,.load_pri=AST_MODPRI_CHANNEL_DEPEND,.requires=&quot;http&quot;,)</div></div>
<div class="ttc" id="structminivm__account_html_ab5845627664c59054dd8e5f01829d4f3"><div class="ttname"><a href="../../dc/d7b/structminivm__account.html#ab5845627664c59054dd8e5f01829d4f3">minivm_account::fullname</a></div><div class="ttdeci">char fullname[120]</div><div class="ttdef"><b>Definition:</b> <a href="../../de/dfe/app__minivm_8c_source.html#l00605">app_minivm.c:605</a></div></div>
<div class="ttc" id="app__minivm_8c_html_a7b7715fe7d49edf843394ee1232f7de1"><div class="ttname"><a href="../../de/dfe/app__minivm_8c.html#a7b7715fe7d49edf843394ee1232f7de1">vm_lock_path</a></div><div class="ttdeci">static int vm_lock_path(const char *path)</div><div class="ttdoc">lock directory </div><div class="ttdef"><b>Definition:</b> <a href="../../de/dfe/app__minivm_8c_source.html#l03302">app_minivm.c:3302</a></div></div>
<div class="ttc" id="structleave__vm__options_html"><div class="ttname"><a href="../../dd/df7/structleave__vm__options.html">leave_vm_options</a></div><div class="ttdoc">Options for leaving voicemail with the voicemail() application. </div><div class="ttdef"><b>Definition:</b> <a href="../../de/dfe/app__minivm_8c_source.html#l00650">app_minivm.c:650</a></div></div>
<div class="ttc" id="module_8h_html_a155a0df9c59e04e305d4a2fa3e35f843a54af2a9b29d140908cc9dffd0618951b"><div class="ttname"><a href="../../d5/d16/module_8h.html#a155a0df9c59e04e305d4a2fa3e35f843a54af2a9b29d140908cc9dffd0618951b">AST_MODFLAG_DEFAULT</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d16/module_8h_source.html#l00315">module.h:315</a></div></div>
<div class="ttc" id="structast__cli__entry_html_aef1bd6ad890a110b466cb0e8088507a2"><div class="ttname"><a href="../../d8/d07/structast__cli__entry.html#aef1bd6ad890a110b466cb0e8088507a2">ast_cli_entry::usage</a></div><div class="ttdeci">const char * usage</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/db0/cli_8h_source.html#l00177">cli.h:177</a></div></div>
<div class="ttc" id="channel_8h_html_a018b7a29cef2d62074dc46e9aaad0d1a"><div class="ttname"><a href="../../d5/d7b/channel_8h.html#a018b7a29cef2d62074dc46e9aaad0d1a">ast_channel_exten_set</a></div><div class="ttdeci">void ast_channel_exten_set(struct ast_channel *chan, const char *value)</div><div class="ttdef"><b>Definition:</b> <a href="../../db/de2/channel__internal__api_8c_source.html#l00357">channel_internal_api.c:357</a></div></div>
<div class="ttc" id="structb64__baseio_html"><div class="ttname"><a href="../../de/d5d/structb64__baseio.html">b64_baseio</a></div><div class="ttdoc">Structure for base64 encoding. </div><div class="ttdef"><b>Definition:</b> <a href="../../de/dfe/app__minivm_8c_source.html#l00656">app_minivm.c:656</a></div></div>
<div class="ttc" id="pbx_8h_html_a6e5b90edb84d216267148dddcffe9b9a"><div class="ttname"><a href="../../db/de0/pbx_8h.html#a6e5b90edb84d216267148dddcffe9b9a">pbx_builtin_setvar_helper</a></div><div class="ttdeci">int pbx_builtin_setvar_helper(struct ast_channel *chan, const char *name, const char *value)</div><div class="ttdoc">Add a variable to the channel variable stack, removing the most recently set value for the same name...</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d8c/pbx__variables_8c_source.html#l01071">pbx_variables.c:1071</a></div></div>
<div class="ttc" id="app__minivm_8c_html_a92d8fb2d08cf9220d520ae9691b5e6c4"><div class="ttname"><a href="../../de/dfe/app__minivm_8c.html#a92d8fb2d08cf9220d520ae9691b5e6c4">SENDMAIL</a></div><div class="ttdeci">#define SENDMAIL</div><div class="ttdoc">Default mail command to mail voicemail. Change it with the mailcmd= command in voicemail.conf. </div><div class="ttdef"><b>Definition:</b> <a href="../../de/dfe/app__minivm_8c_source.html#l00535">app_minivm.c:535</a></div></div>
<div class="ttc" id="channel_8h_html_a050bec9a4abc1a599b6573a6091b080c"><div class="ttname"><a href="../../d5/d7b/channel_8h.html#a050bec9a4abc1a599b6573a6091b080c">ast_waitfordigit</a></div><div class="ttdeci">int ast_waitfordigit(struct ast_channel *c, int ms)</div><div class="ttdoc">Waits for a digit. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d28/channel_8c_source.html#l03184">channel.c:3184</a></div></div>
<div class="ttc" id="include_2asterisk_2app_8h_html_ac665722c9bfe6d9b506df95184aa236da8022c0ca0ab8535428aed27423a40e2c"><div class="ttname"><a href="../../d3/d93/include_2asterisk_2app_8h.html#ac665722c9bfe6d9b506df95184aa236da8022c0ca0ab8535428aed27423a40e2c">AST_RECORD_IF_EXISTS_OVERWRITE</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d93/include_2asterisk_2app_8h_source.html#l01078">include/asterisk/app.h:1078</a></div></div>
<div class="ttc" id="structmessage__templates_html"><div class="ttname"><a href="../../d1/dd2/structmessage__templates.html">message_templates</a></div><div class="ttdoc">The list of e-mail templates. </div><div class="ttdef"><b>Definition:</b> <a href="../../de/dfe/app__minivm_8c_source.html#l00647">app_minivm.c:647</a></div></div>
<div class="ttc" id="structleave__vm__options_html_a809cc53dfc8e9f1204c67c26aabaa322"><div class="ttname"><a href="../../dd/df7/structleave__vm__options.html#a809cc53dfc8e9f1204c67c26aabaa322">leave_vm_options::record_gain</a></div><div class="ttdeci">signed char record_gain</div><div class="ttdef"><b>Definition:</b> <a href="../../de/dfe/app__minivm_8c_source.html#l00652">app_minivm.c:652</a></div></div>
<div class="ttc" id="strings_8h_html_a8239b9ad10367bfc936e9b60ff7706a8"><div class="ttname"><a href="../../d6/d90/strings_8h.html#a8239b9ad10367bfc936e9b60ff7706a8">ast_str_reset</a></div><div class="ttdeci">void ast_str_reset(struct ast_str *buf)</div><div class="ttdoc">Reset the content of a dynamic string. Useful before a series of ast_str_append. </div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d90/strings_8h_source.html#l00653">strings.h:653</a></div></div>
<div class="ttc" id="cli_8h_html_a50989f00b32eeb2516a3803cb2ffb766"><div class="ttname"><a href="../../dc/db0/cli_8h.html#a50989f00b32eeb2516a3803cb2ffb766">CLI_SUCCESS</a></div><div class="ttdeci">#define CLI_SUCCESS</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/db0/cli_8h_source.html#l00044">cli.h:44</a></div></div>
<div class="ttc" id="include_2asterisk_2config_8h_html_a9ff7aa27ae5f1a980bcf81f91cd6e470"><div class="ttname"><a href="../../d3/de6/include_2asterisk_2config_8h.html#a9ff7aa27ae5f1a980bcf81f91cd6e470">ast_variable_retrieve</a></div><div class="ttdeci">const char * ast_variable_retrieve(struct ast_config *config, const char *category, const char *variable)</div><div class="ttdef"><b>Definition:</b> <a href="../../d2/d9d/main_2config_8c_source.html#l00694">main/config.c:694</a></div></div>
<div class="ttc" id="strings_8h_html_aabc005bd1c7e249e8f8659d57d4500b6"><div class="ttname"><a href="../../d6/d90/strings_8h.html#aabc005bd1c7e249e8f8659d57d4500b6">ast_str_strlen</a></div><div class="ttdeci">size_t ast_str_strlen(const struct ast_str *buf)</div><div class="ttdoc">Returns the current length of the string stored within buf. </div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d90/strings_8h_source.html#l00688">strings.h:688</a></div></div>
<div class="ttc" id="app__minivm_8c_html_a4e67e9429d48a2ba8f833ee3b1dceb5d"><div class="ttname"><a href="../../de/dfe/app__minivm_8c.html#a4e67e9429d48a2ba8f833ee3b1dceb5d">EOL</a></div><div class="ttdeci">#define EOL</div><div class="ttdef"><b>Definition:</b> <a href="../../de/dfe/app__minivm_8c_source.html#l00540">app_minivm.c:540</a></div></div>
<div class="ttc" id="app__minivm_8c_html_ae6f6a409b48dabe35f6faa711d246224"><div class="ttname"><a href="../../de/dfe/app__minivm_8c.html#ae6f6a409b48dabe35f6faa711d246224">minivm_counter_func_write</a></div><div class="ttdeci">static int minivm_counter_func_write(struct ast_channel *chan, const char *cmd, char *data, const char *value)</div><div class="ttdoc">${MINIVMCOUNTER()} Dialplan function - changes counter data </div><div class="ttdef"><b>Definition:</b> <a href="../../de/dfe/app__minivm_8c_source.html#l03425">app_minivm.c:3425</a></div></div>
<div class="ttc" id="cli_8h_html_ab33e5350a923c3a8cedbeb496cd88ec9a76bf33139279b03ec1691f2be2d1be40"><div class="ttname"><a href="../../dc/db0/cli_8h.html#ab33e5350a923c3a8cedbeb496cd88ec9a76bf33139279b03ec1691f2be2d1be40">CLI_GENERATE</a></div><div class="ttdef"><b>Definition:</b> <a href="../../dc/db0/cli_8h_source.html#l00153">cli.h:153</a></div></div>
<div class="ttc" id="structminivm__account_html_a6e9b30710047deee4fb3e4f38c8e7cc2"><div class="ttname"><a href="../../dc/d7b/structminivm__account.html#a6e9b30710047deee4fb3e4f38c8e7cc2">minivm_account::ptemplate</a></div><div class="ttdeci">char ptemplate[80]</div><div class="ttdef"><b>Definition:</b> <a href="../../de/dfe/app__minivm_8c_source.html#l00617">app_minivm.c:617</a></div></div>
<div class="ttc" id="logger_8c_html_a2057dec53731af6bb6881015b58936ba"><div class="ttname"><a href="../../d1/d22/logger_8c.html#a2057dec53731af6bb6881015b58936ba">dateformat</a></div><div class="ttdeci">static char dateformat[256]</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d22/logger_8c_source.html#l00079">logger.c:79</a></div></div>
<div class="ttc" id="include_2asterisk_2compat_8h_html_a40eca58273c74a20a17f137d18ba826c"><div class="ttname"><a href="../../de/da3/include_2asterisk_2compat_8h.html#a40eca58273c74a20a17f137d18ba826c">strsep</a></div><div class="ttdeci">char * strsep(char **str, const char *delims)</div></div>
<div class="ttc" id="utils_2frame_8c_html_a48bc11919b2752df9d14ce89557cfb25"><div class="ttname"><a href="../../d6/d47/utils_2frame_8c.html#a48bc11919b2752df9d14ce89557cfb25">out</a></div><div class="ttdeci">FILE * out</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d47/utils_2frame_8c_source.html#l00033">utils/frame.c:33</a></div></div>
<div class="ttc" id="structminivm__account_html_a29b9b126bac9cc5f1cc334f140f39e8d"><div class="ttname"><a href="../../dc/d7b/structminivm__account.html#a29b9b126bac9cc5f1cc334f140f39e8d">minivm_account::pager</a></div><div class="ttdeci">char pager[80]</div><div class="ttdef"><b>Definition:</b> <a href="../../de/dfe/app__minivm_8c_source.html#l00607">app_minivm.c:607</a></div></div>
<div class="ttc" id="group__StasisTopicsAndMessages_html_ga68c55b443ba97dc157b493aafd05c876"><div class="ttname"><a href="../../df/deb/group__StasisTopicsAndMessages.html#ga68c55b443ba97dc157b493aafd05c876">ast_channel_snapshot_get_latest</a></div><div class="ttdeci">struct ast_channel_snapshot * ast_channel_snapshot_get_latest(const char *uniqueid)</div><div class="ttdoc">Obtain the latest ast_channel_snapshot from the Stasis Message Bus API cache. This is an ao2 object...</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d2b/stasis__channels_8c_source.html#l00903">stasis_channels.c:903</a></div></div>
<div class="ttc" id="astobj2_8h_html_a6321ee982370c55ab3c24c72c562cbdd"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#a6321ee982370c55ab3c24c72c562cbdd">ao2_cleanup</a></div><div class="ttdeci">#define ao2_cleanup(obj)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l01958">astobj2.h:1958</a></div></div>
<div class="ttc" id="cli_8h_html"><div class="ttname"><a href="../../dc/db0/cli_8h.html">cli.h</a></div><div class="ttdoc">Standard Command Line Interface. </div></div>
<div class="ttc" id="app__minivm_8c_html_ad0f6114d9cab58a8ec3d9555cb466534"><div class="ttname"><a href="../../de/dfe/app__minivm_8c.html#ad0f6114d9cab58a8ec3d9555cb466534">load_config</a></div><div class="ttdeci">static int load_config(int reload)</div><div class="ttdoc">Load minivoicemail configuration. </div><div class="ttdef"><b>Definition:</b> <a href="../../de/dfe/app__minivm_8c_source.html#l02864">app_minivm.c:2864</a></div></div>
<div class="ttc" id="structminivm__template_html"><div class="ttname"><a href="../../dc/d31/structminivm__template.html">minivm_template</a></div><div class="ttdef"><b>Definition:</b> <a href="../../de/dfe/app__minivm_8c_source.html#l00633">app_minivm.c:633</a></div></div>
<div class="ttc" id="structminivm__account_html_aa2f937e69f79fbfcbf13a8ca51adcce0"><div class="ttname"><a href="../../dc/d7b/structminivm__account.html#aa2f937e69f79fbfcbf13a8ca51adcce0">minivm_account::externnotify</a></div><div class="ttdeci">char externnotify[160]</div><div class="ttdef"><b>Definition:</b> <a href="../../de/dfe/app__minivm_8c_source.html#l00610">app_minivm.c:610</a></div></div>
<div class="ttc" id="channel_8h_html_aca211972dac7b8f3f08a283bfe0aa8bf"><div class="ttname"><a href="../../d5/d7b/channel_8h.html#aca211972dac7b8f3f08a283bfe0aa8bf">ast_channel_context_set</a></div><div class="ttdeci">void ast_channel_context_set(struct ast_channel *chan, const char *value)</div><div class="ttdef"><b>Definition:</b> <a href="../../db/de2/channel__internal__api_8c_source.html#l00348">channel_internal_api.c:348</a></div></div>
<div class="ttc" id="app__minivm_8c_html_a207c95b6a18096172f7278b3af01f96d"><div class="ttname"><a href="../../de/dfe/app__minivm_8c.html#a207c95b6a18096172f7278b3af01f96d">ERROR_LOCK_PATH</a></div><div class="ttdeci">#define ERROR_LOCK_PATH</div><div class="ttdef"><b>Definition:</b> <a href="../../de/dfe/app__minivm_8c_source.html#l00545">app_minivm.c:545</a></div></div>
<div class="ttc" id="strings_8h_html_ac4040268f7b6ed77dfc49c7767626369"><div class="ttname"><a href="../../d6/d90/strings_8h.html#ac4040268f7b6ed77dfc49c7767626369">ast_copy_string</a></div><div class="ttdeci">void ast_copy_string(char *dst, const char *src, size_t size)</div><div class="ttdoc">Size-limited null-terminating string copy. </div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d90/strings_8h_source.html#l00401">strings.h:401</a></div></div>
<div class="ttc" id="strings_8h_html_a2faaa16929951bfd2802b7829a100ba2"><div class="ttname"><a href="../../d6/d90/strings_8h.html#a2faaa16929951bfd2802b7829a100ba2">S_OR</a></div><div class="ttdeci">#define S_OR(a, b)</div><div class="ttdoc">returns the equivalent of logic or for strings: first one if not empty, otherwise second one...</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d90/strings_8h_source.html#l00079">strings.h:79</a></div></div>
<div class="ttc" id="app__minivm_8c_html_a239c1ca765fe47411d50c5697a6f84a2"><div class="ttname"><a href="../../de/dfe/app__minivm_8c.html#a239c1ca765fe47411d50c5697a6f84a2">queue_mwi_event</a></div><div class="ttdeci">static void queue_mwi_event(const char *channel_id, const char *mbx, const char *ctx, int urgent, int new, int old)</div><div class="ttdef"><b>Definition:</b> <a href="../../de/dfe/app__minivm_8c_source.html#l02084">app_minivm.c:2084</a></div></div>
<div class="ttc" id="channel_8h_html_a7ca2fda13b129a55c251b56729de285b"><div class="ttname"><a href="../../d5/d7b/channel_8h.html#a7ca2fda13b129a55c251b56729de285b">ast_channel_name</a></div><div class="ttdeci">const char * ast_channel_name(const struct ast_channel *chan)</div></div>
<div class="ttc" id="structast__cli__args_html_a4b911d12699acbbb5a8b62355b35bae8"><div class="ttname"><a href="../../d3/dad/structast__cli__args.html#a4b911d12699acbbb5a8b62355b35bae8">ast_cli_args::pos</a></div><div class="ttdeci">const int pos</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/db0/cli_8h_source.html#l00164">cli.h:164</a></div></div>
<div class="ttc" id="app__minivm_8c_html_aa8cecfc5c5c054d2875c03e77b7be15d"><div class="ttname"><a href="../../de/dfe/app__minivm_8c.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a></div><div class="ttdeci">#define TRUE</div><div class="ttdef"><b>Definition:</b> <a href="../../de/dfe/app__minivm_8c_source.html#l00518">app_minivm.c:518</a></div></div>
<div class="ttc" id="app__minivm_8c_html_a42e341d5d3dd48f5afc05b9f5045467d"><div class="ttname"><a href="../../de/dfe/app__minivm_8c.html#a42e341d5d3dd48f5afc05b9f5045467d">minivm_account_func_read</a></div><div class="ttdeci">static int minivm_account_func_read(struct ast_channel *chan, const char *cmd, char *data, char *buf, size_t len)</div><div class="ttdoc">${MINIVMACCOUNT()} Dialplan function - reads account data </div><div class="ttdef"><b>Definition:</b> <a href="../../de/dfe/app__minivm_8c_source.html#l03225">app_minivm.c:3225</a></div></div>
<div class="ttc" id="file_8h_html_affc21cb57c6bf72a2cb7ec8a379b2137"><div class="ttname"><a href="../../d2/d4d/file_8h.html#affc21cb57c6bf72a2cb7ec8a379b2137">ast_waitstream</a></div><div class="ttdeci">int ast_waitstream(struct ast_channel *c, const char *breakon)</div><div class="ttdoc">Waits for a stream to stop or digit to be pressed. </div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d13/file_8c_source.html#l01776">file.c:1776</a></div></div>
<div class="ttc" id="file_8h_html_ab9b8ab8e5ee34c9b4da25779255cafde"><div class="ttname"><a href="../../d2/d4d/file_8h.html#ab9b8ab8e5ee34c9b4da25779255cafde">ast_fileexists</a></div><div class="ttdeci">int ast_fileexists(const char *filename, const char *fmt, const char *preflang)</div><div class="ttdoc">Checks for the existence of a given file. </div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d13/file_8c_source.html#l01086">file.c:1086</a></div></div>
<div class="ttc" id="mwi_8h_html"><div class="ttname"><a href="../../dc/d33/mwi_8h.html">mwi.h</a></div><div class="ttdoc">Asterisk MWI API. </div></div>
<div class="ttc" id="app__minivm_8c_html_a62e6fabd28e7d7a9941945c7fde3bda6"><div class="ttname"><a href="../../de/dfe/app__minivm_8c.html#a62e6fabd28e7d7a9941945c7fde3bda6">VOICEMAIL_CONFIG</a></div><div class="ttdeci">#define VOICEMAIL_CONFIG</div><div class="ttdef"><b>Definition:</b> <a href="../../de/dfe/app__minivm_8c_source.html#l00548">app_minivm.c:548</a></div></div>
<div class="ttc" id="hsearch_8c_html_ad0f0f85b3cab490a81baa02c4b9edf45"><div class="ttname"><a href="../../db/d37/hsearch_8c.html#ad0f0f85b3cab490a81baa02c4b9edf45">retval</a></div><div class="ttdeci">static ENTRY retval</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d37/hsearch_8c_source.html#l00050">hsearch.c:50</a></div></div>
<div class="ttc" id="channel_8h_html_aec583a3e25358ee552a4f3df53914cd0"><div class="ttname"><a href="../../d5/d7b/channel_8h.html#aec583a3e25358ee552a4f3df53914cd0">ast_answer</a></div><div class="ttdeci">int ast_answer(struct ast_channel *chan)</div><div class="ttdoc">Answer a channel. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d28/channel_8c_source.html#l02814">channel.c:2814</a></div></div>
<div class="ttc" id="app__minivm_8c_html_a7ef5e4ff24ab0c8d72e5c464022ee95a"><div class="ttname"><a href="../../de/dfe/app__minivm_8c.html#a7ef5e4ff24ab0c8d72e5c464022ee95a">minivm_accmess_exec</a></div><div class="ttdeci">static int minivm_accmess_exec(struct ast_channel *chan, const char *data)</div><div class="ttdoc">Record specific messages for voicemail account. </div><div class="ttdef"><b>Definition:</b> <a href="../../de/dfe/app__minivm_8c_source.html#l02496">app_minivm.c:2496</a></div></div>
<div class="ttc" id="app__minivm_8c_html_ac0439b6869f845808de3ac7e0d37e1c4"><div class="ttname"><a href="../../de/dfe/app__minivm_8c.html#ac0439b6869f845808de3ac7e0d37e1c4">app_minivm_accmess</a></div><div class="ttdeci">static char * app_minivm_accmess</div><div class="ttdef"><b>Definition:</b> <a href="../../de/dfe/app__minivm_8c_source.html#l00565">app_minivm.c:565</a></div></div>
<div class="ttc" id="channel_8h_html_a9abe31fe40dcd03cd2957e5309e32ac6"><div class="ttname"><a href="../../d5/d7b/channel_8h.html#a9abe31fe40dcd03cd2957e5309e32ac6">ast_channel_language</a></div><div class="ttdeci">const char * ast_channel_language(const struct ast_channel *chan)</div></div>
<div class="ttc" id="structast__json_html"><div class="ttname"><a href="../../d1/da1/structast__json.html">ast_json</a></div><div class="ttdoc">Abstract JSON element (object, array, string, int, ...). </div></div>
<div class="ttc" id="structast__cli__args_html"><div class="ttname"><a href="../../d3/dad/structast__cli__args.html">ast_cli_args</a></div><div class="ttdef"><b>Definition:</b> <a href="../../dc/db0/cli_8h_source.html#l00158">cli.h:158</a></div></div>
<div class="ttc" id="channel_8h_html_a582dee4d5ea9b2ff6f309f0c5239f6bd"><div class="ttname"><a href="../../d5/d7b/channel_8h.html#a582dee4d5ea9b2ff6f309f0c5239f6bd">ast_channel_context</a></div><div class="ttdeci">const char * ast_channel_context(const struct ast_channel *chan)</div><div class="ttdef"><b>Definition:</b> <a href="../../db/de2/channel__internal__api_8c_source.html#l00344">channel_internal_api.c:344</a></div></div>
<div class="ttc" id="utils_2frame_8c_html_a4a9391ee88e57361b613c4c2fd2bf4aa"><div class="ttname"><a href="../../d6/d47/utils_2frame_8c.html#a4a9391ee88e57361b613c4c2fd2bf4aa">error</a></div><div class="ttdeci">int error(const char *format,...)</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d47/utils_2frame_8c_source.html#l00999">utils/frame.c:999</a></div></div>
<div class="ttc" id="asterisk_8h_html_ae688d728e1acdfe5988c7db45d6f0166"><div class="ttname"><a href="../../db/db2/asterisk_8h.html#ae688d728e1acdfe5988c7db45d6f0166">PATH_MAX</a></div><div class="ttdeci">#define PATH_MAX</div><div class="ttdef"><b>Definition:</b> <a href="../../db/db2/asterisk_8h_source.html#l00040">asterisk.h:40</a></div></div>
<div class="ttc" id="app__minivm_8c_html_ab0d4d1fc60708f1a0b2bf99c59a610f0"><div class="ttname"><a href="../../de/dfe/app__minivm_8c.html#ab0d4d1fc60708f1a0b2bf99c59a610f0">ast_str_encode_mime</a></div><div class="ttdeci">static const char * ast_str_encode_mime(struct ast_str **end, ssize_t maxlen, const char *charset, const char *start, size_t preamble, size_t postamble)</div><div class="ttdef"><b>Definition:</b> <a href="../../de/dfe/app__minivm_8c_source.html#l01173">app_minivm.c:1173</a></div></div>
<div class="ttc" id="app__minivm_8c_html_af02d84a63641abcd8bfd43897789a156"><div class="ttname"><a href="../../de/dfe/app__minivm_8c.html#af02d84a63641abcd8bfd43897789a156">access_counter_file</a></div><div class="ttdeci">static int access_counter_file(char *directory, char *countername, int value, int operand)</div><div class="ttdoc">Access counter file, lock directory, read and possibly write it again changed. </div><div class="ttdef"><b>Definition:</b> <a href="../../de/dfe/app__minivm_8c_source.html#l03319">app_minivm.c:3319</a></div></div>
<div class="ttc" id="app__minivm_8c_html_ad0721ec90e8e85dd4d3a4741df493dc3"><div class="ttname"><a href="../../de/dfe/app__minivm_8c.html#ad0721ec90e8e85dd4d3a4741df493dc3">minivm_greet_exec</a></div><div class="ttdeci">static int minivm_greet_exec(struct ast_channel *chan, const char *data)</div><div class="ttdef"><b>Definition:</b> <a href="../../de/dfe/app__minivm_8c_source.html#l02268">app_minivm.c:2268</a></div></div>
<div class="ttc" id="structast__party__name_html_aaa04218f9e3a9065afa8be2491da8904"><div class="ttname"><a href="../../d8/d6f/structast__party__name.html#aaa04218f9e3a9065afa8be2491da8904">ast_party_name::valid</a></div><div class="ttdeci">unsigned char valid</div><div class="ttdoc">TRUE if the name information is valid/present. </div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d7b/channel_8h_source.html#l00280">channel.h:280</a></div></div>
<div class="ttc" id="test__http__media__cache_8c_html_a80c8e3ae5087d90d422675d034eeebc7"><div class="ttname"><a href="../../d4/d45/test__http__media__cache_8c.html#a80c8e3ae5087d90d422675d034eeebc7">options</a></div><div class="ttdeci">static struct test_options options</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d45/test__http__media__cache_8c_source.html#l00062">test_http_media_cache.c:62</a></div></div>
<div class="ttc" id="asterisk_8c_html_a299365a3d8977a6c410c6cd924e33136"><div class="ttname"><a href="../../d5/d03/asterisk_8c.html#a299365a3d8977a6c410c6cd924e33136">prompt</a></div><div class="ttdeci">static struct ast_str * prompt</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d03/asterisk_8c_source.html#l02725">asterisk.c:2725</a></div></div>
<div class="ttc" id="chan__alsa_8c_html_ac25ea00ee3f082df06e0cf468cbde240"><div class="ttname"><a href="../../da/d45/chan__alsa_8c.html#ac25ea00ee3f082df06e0cf468cbde240">context</a></div><div class="ttdeci">static char context[AST_MAX_CONTEXT]</div><div class="ttdef"><b>Definition:</b> <a href="../../da/d45/chan__alsa_8c_source.html#l00116">chan_alsa.c:116</a></div></div>
<div class="ttc" id="app__minivm_8c_html_a748e8337ba1b9ac0de883141e4b85602"><div class="ttname"><a href="../../de/dfe/app__minivm_8c.html#a748e8337ba1b9ac0de883141e4b85602">b64_inbuf</a></div><div class="ttdeci">static int b64_inbuf(struct b64_baseio *bio, FILE *fi)</div><div class="ttdef"><b>Definition:</b> <a href="../../de/dfe/app__minivm_8c_source.html#l00851">app_minivm.c:851</a></div></div>
<div class="ttc" id="include_2asterisk_2app_8h_html_aca036489931bf5571e2472331c8ac80b"><div class="ttname"><a href="../../d3/d93/include_2asterisk_2app_8h.html#aca036489931bf5571e2472331c8ac80b">AST_APP_OPTION</a></div><div class="ttdeci">#define AST_APP_OPTION(option, flagno)</div><div class="ttdoc">Declares an application option that does not accept an argument. </div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d93/include_2asterisk_2app_8h_source.html#l01402">include/asterisk/app.h:1402</a></div></div>
<div class="ttc" id="app__minivm_8c_html_a32fdccfe778fa730f0e0cb1e57299064"><div class="ttname"><a href="../../de/dfe/app__minivm_8c.html#a32fdccfe778fa730f0e0cb1e57299064">app_minivm_greet</a></div><div class="ttdeci">static char * app_minivm_greet</div><div class="ttdef"><b>Definition:</b> <a href="../../de/dfe/app__minivm_8c_source.html#l00562">app_minivm.c:562</a></div></div>
<div class="ttc" id="app__minivm_8c_html_a4aeda8b39c8ab166c538157d05591922a46635c9bf224edd14121694d949250be"><div class="ttname"><a href="../../de/dfe/app__minivm_8c.html#a4aeda8b39c8ab166c538157d05591922a46635c9bf224edd14121694d949250be">OPT_TEMP_GREETING</a></div><div class="ttdef"><b>Definition:</b> <a href="../../de/dfe/app__minivm_8c_source.html#l00574">app_minivm.c:574</a></div></div>
<div class="ttc" id="structminivm__stats_html"><div class="ttname"><a href="../../d6/dee/structminivm__stats.html">minivm_stats</a></div><div class="ttdoc">Structure for gathering statistics. </div><div class="ttdef"><b>Definition:</b> <a href="../../de/dfe/app__minivm_8c_source.html#l00676">app_minivm.c:676</a></div></div>
<div class="ttc" id="app__minivm_8c_html_ad0499410b27e24fe126fcb124713c239"><div class="ttname"><a href="../../de/dfe/app__minivm_8c.html#ad0499410b27e24fe126fcb124713c239">run_externnotify</a></div><div class="ttdeci">static void run_externnotify(struct ast_channel *chan, struct minivm_account *vmu)</div><div class="ttdoc">Run external notification for voicemail message. </div><div class="ttdef"><b>Definition:</b> <a href="../../de/dfe/app__minivm_8c_source.html#l01776">app_minivm.c:1776</a></div></div>
<div class="ttc" id="channel_8h_html_adf593d68a333075c1fcae8a73b68c069"><div class="ttname"><a href="../../d5/d7b/channel_8h.html#adf593d68a333075c1fcae8a73b68c069">ast_channel_macrocontext</a></div><div class="ttdeci">const char * ast_channel_macrocontext(const struct ast_channel *chan)</div><div class="ttdef"><b>Definition:</b> <a href="../../db/de2/channel__internal__api_8c_source.html#l00362">channel_internal_api.c:362</a></div></div>
<div class="ttc" id="app__minivm_8c_html_ac50dec9d4a43a4e81ca2895e7ac7be2d"><div class="ttname"><a href="../../de/dfe/app__minivm_8c.html#ac50dec9d4a43a4e81ca2895e7ac7be2d">minivmlock</a></div><div class="ttdeci">static ast_mutex_t minivmlock</div><div class="ttdef"><b>Definition:</b> <a href="../../de/dfe/app__minivm_8c_source.html#l00689">app_minivm.c:689</a></div></div>
<div class="ttc" id="app__minivm_8c_html_a16dc4d46dd4562436ebbb02bb0f4073a"><div class="ttname"><a href="../../de/dfe/app__minivm_8c.html#a16dc4d46dd4562436ebbb02bb0f4073a">make_dir</a></div><div class="ttdeci">static int make_dir(char *dest, int len, const char *domain, const char *username, const char *folder)</div><div class="ttdef"><b>Definition:</b> <a href="../../de/dfe/app__minivm_8c_source.html#l01524">app_minivm.c:1524</a></div></div>
<div class="ttc" id="structast__mwi__state_html"><div class="ttname"><a href="../../d6/d45/structast__mwi__state.html">ast_mwi_state</a></div><div class="ttdoc">The structure that contains MWI state. </div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d33/mwi_8h_source.html#l00457">mwi.h:457</a></div></div>
<div class="ttc" id="say_8h_html"><div class="ttname"><a href="../../db/dce/say_8h.html">say.h</a></div><div class="ttdoc">Say numbers and dates (maybe words one day too) </div></div>
<div class="ttc" id="group__StasisTopicsAndMessages_html_gae43ba258ce7f2b5838edbed6bf7dbd8c"><div class="ttname"><a href="../../df/deb/group__StasisTopicsAndMessages.html#gae43ba258ce7f2b5838edbed6bf7dbd8c">ast_mwi_topic</a></div><div class="ttdeci">struct stasis_topic * ast_mwi_topic(const char *uniqueid)</div><div class="ttdoc">Get the Stasis Message Bus API topic for MWI messages on a unique ID. </div><div class="ttdef"><b>Definition:</b> <a href="../../d6/db4/mwi_8c_source.html#l00100">mwi.c:100</a></div></div>
<div class="ttc" id="app__minivm_8c_html_a7f32248ee8cfb732460df9a4656688b2"><div class="ttname"><a href="../../de/dfe/app__minivm_8c.html#a7f32248ee8cfb732460df9a4656688b2">HVLT_OUTPUT_FORMAT</a></div><div class="ttdeci">#define HVLT_OUTPUT_FORMAT</div></div>
<div class="ttc" id="module_8h_html_aba2c8d4be709a254658b21a834f8294a"><div class="ttname"><a href="../../d5/d16/module_8h.html#aba2c8d4be709a254658b21a834f8294a">ASTERISK_GPL_KEY</a></div><div class="ttdeci">#define ASTERISK_GPL_KEY</div><div class="ttdoc">The text the key() function should return. </div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d16/module_8h_source.html#l00046">module.h:46</a></div></div>
<div class="ttc" id="logger_8h_html_a33f6031de4ab6d1406465a7a3ee18e86"><div class="ttname"><a href="../../d1/d8c/logger_8h.html#a33f6031de4ab6d1406465a7a3ee18e86">DEBUG_ATLEAST</a></div><div class="ttdeci">#define DEBUG_ATLEAST(level)</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d8c/logger_8h_source.html#l00441">logger.h:441</a></div></div>
<div class="ttc" id="channel_8h_html_ae56cab679c0cda6436b930bc74297895"><div class="ttname"><a href="../../d5/d7b/channel_8h.html#ae56cab679c0cda6436b930bc74297895">ast_channel_priority_set</a></div><div class="ttdeci">void ast_channel_priority_set(struct ast_channel *chan, int value)</div><div class="ttdef"><b>Definition:</b> <a href="../../db/de2/channel__internal__api_8c_source.html#l00448">channel_internal_api.c:448</a></div></div>
<div class="ttc" id="dsp_8h_html_aab28c68838eaed4e0c89460a4e554cca"><div class="ttname"><a href="../../d3/d08/dsp_8h.html#aab28c68838eaed4e0c89460a4e554cca">ast_dsp_get_threshold_from_settings</a></div><div class="ttdeci">int ast_dsp_get_threshold_from_settings(enum threshold which)</div><div class="ttdoc">Get silence threshold from dsp.conf. </div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d3b/dsp_8c_source.html#l01996">dsp.c:1996</a></div></div>
<div class="ttc" id="module_8h_html"><div class="ttname"><a href="../../d5/d16/module_8h.html">module.h</a></div><div class="ttdoc">Asterisk module definitions. </div></div>
<div class="ttc" id="app__minivm_8c_html_a8bd4261fe6c6d6807f032fc0b9eebfa3"><div class="ttname"><a href="../../de/dfe/app__minivm_8c.html#a8bd4261fe6c6d6807f032fc0b9eebfa3">SOUND_INTRO</a></div><div class="ttdeci">#define SOUND_INTRO</div><div class="ttdef"><b>Definition:</b> <a href="../../de/dfe/app__minivm_8c_source.html#l00537">app_minivm.c:537</a></div></div>
<div class="ttc" id="app__minivm_8c_html_a0d7a1f3e3456c97d999bc5586878d15e"><div class="ttname"><a href="../../de/dfe/app__minivm_8c.html#a0d7a1f3e3456c97d999bc5586878d15e">message_destroy_list</a></div><div class="ttdeci">static void message_destroy_list(void)</div><div class="ttdef"><b>Definition:</b> <a href="../../de/dfe/app__minivm_8c_source.html#l00838">app_minivm.c:838</a></div></div>
<div class="ttc" id="app__minivm_8c_html_a4aeda8b39c8ab166c538157d05591922a3ccbdb01bd64716cf0762f2d1f95d124"><div class="ttname"><a href="../../de/dfe/app__minivm_8c.html#a4aeda8b39c8ab166c538157d05591922a3ccbdb01bd64716cf0762f2d1f95d124">OPT_NAME_GREETING</a></div><div class="ttdef"><b>Definition:</b> <a href="../../de/dfe/app__minivm_8c_source.html#l00575">app_minivm.c:575</a></div></div>
<div class="ttc" id="chan__alsa_8c_html_a98f5e70e98f6dc48e3c5ba316066d540"><div class="ttname"><a href="../../da/d45/chan__alsa_8c.html#a98f5e70e98f6dc48e3c5ba316066d540">format</a></div><div class="ttdeci">static snd_pcm_format_t format</div><div class="ttdef"><b>Definition:</b> <a href="../../da/d45/chan__alsa_8c_source.html#l00102">chan_alsa.c:102</a></div></div>
<div class="ttc" id="app__minivm_8c_html_a3888fe259904a2eb18b173cbf56bfa86"><div class="ttname"><a href="../../de/dfe/app__minivm_8c.html#a3888fe259904a2eb18b173cbf56bfa86">globalflags</a></div><div class="ttdeci">static struct ast_flags globalflags</div><div class="ttdef"><b>Definition:</b> <a href="../../de/dfe/app__minivm_8c_source.html#l00704">app_minivm.c:704</a></div></div>
<div class="ttc" id="include_2asterisk_2app_8h_html_a410801e106c09f15f766d98f27b2852d"><div class="ttname"><a href="../../d3/d93/include_2asterisk_2app_8h.html#a410801e106c09f15f766d98f27b2852d">ast_safe_execvp</a></div><div class="ttdeci">int ast_safe_execvp(int dualfork, const char *file, char *const argv[])</div><div class="ttdoc">Safely spawn an external program while closing file descriptors. </div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d03/asterisk_8c_source.html#l01180">asterisk.c:1180</a></div></div>
<div class="ttc" id="include_2asterisk_2app_8h_html"><div class="ttname"><a href="../../d3/d93/include_2asterisk_2app_8h.html">app.h</a></div><div class="ttdoc">Application convenience functions, designed to give consistent look and feel to Asterisk apps...</div></div>
<div class="ttc" id="structast__party__number_html_aaa04218f9e3a9065afa8be2491da8904"><div class="ttname"><a href="../../d6/dbb/structast__party__number.html#aaa04218f9e3a9065afa8be2491da8904">ast_party_number::valid</a></div><div class="ttdeci">unsigned char valid</div><div class="ttdoc">TRUE if the number information is valid/present. </div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d7b/channel_8h_source.html#l00298">channel.h:298</a></div></div>
<div class="ttc" id="pbx_8h_html_a8af0e93442a9e468425f63cc52b0ac7b"><div class="ttname"><a href="../../db/de0/pbx_8h.html#a8af0e93442a9e468425f63cc52b0ac7b">ast_custom_function_register</a></div><div class="ttdeci">#define ast_custom_function_register(acf)</div><div class="ttdoc">Register a custom function. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/de0/pbx_8h_source.html#l01508">pbx.h:1508</a></div></div>
<div class="ttc" id="app__minivm_8c_html_a26e1aa3cbc892fb673e775c75bb67fe3"><div class="ttname"><a href="../../de/dfe/app__minivm_8c.html#a26e1aa3cbc892fb673e775c75bb67fe3">minivm_record_exec</a></div><div class="ttdeci">static int minivm_record_exec(struct ast_channel *chan, const char *data)</div><div class="ttdef"><b>Definition:</b> <a href="../../de/dfe/app__minivm_8c_source.html#l02215">app_minivm.c:2215</a></div></div>
<div class="ttc" id="app__minivm_8c_html_a0d31e4343dc402a9d86f380c15d7cb8c"><div class="ttname"><a href="../../de/dfe/app__minivm_8c.html#a0d31e4343dc402a9d86f380c15d7cb8c">prep_email_sub_vars</a></div><div class="ttdeci">static void prep_email_sub_vars(struct ast_channel *channel, const struct minivm_account *vmu, const char *cidnum, const char *cidname, const char *dur, const char *date, const char *counter)</div><div class="ttdef"><b>Definition:</b> <a href="../../de/dfe/app__minivm_8c_source.html#l01002">app_minivm.c:1002</a></div></div>
<div class="ttc" id="lock_8h_html_ac840092853644cea0a186efdc58985f5"><div class="ttname"><a href="../../dd/d42/lock_8h.html#ac840092853644cea0a186efdc58985f5">AST_MUTEX_DEFINE_STATIC</a></div><div class="ttdeci">#define AST_MUTEX_DEFINE_STATIC(mutex)</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d42/lock_8h_source.html#l00518">lock.h:518</a></div></div>
<div class="ttc" id="file_8h_html_a3092bf11d4bba66f646562759608b1bc"><div class="ttname"><a href="../../d2/d4d/file_8h.html#a3092bf11d4bba66f646562759608b1bc">ast_stopstream</a></div><div class="ttdeci">int ast_stopstream(struct ast_channel *c)</div><div class="ttdoc">Stops a stream. </div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d13/file_8c_source.html#l00187">file.c:187</a></div></div>
<div class="ttc" id="module_8h_html_afba4eb7a910b10969041ae4cd488729d"><div class="ttname"><a href="../../d5/d16/module_8h.html#afba4eb7a910b10969041ae4cd488729d">ast_register_application_xml</a></div><div class="ttdeci">#define ast_register_application_xml(app, execute)</div><div class="ttdoc">Register an application using XML documentation. </div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d16/module_8h_source.html#l00626">module.h:626</a></div></div>
<div class="ttc" id="app__minivm_8c_html_a2e550cc7a2a2a5a8f72f567caa072844"><div class="ttname"><a href="../../de/dfe/app__minivm_8c.html#a2e550cc7a2a2a5a8f72f567caa072844">app_minivm_delete</a></div><div class="ttdeci">static char * app_minivm_delete</div><div class="ttdef"><b>Definition:</b> <a href="../../de/dfe/app__minivm_8c_source.html#l00564">app_minivm.c:564</a></div></div>
<div class="ttc" id="app__minivm_8c_html_a380fbb314d06d7a3e037975f2f65da50"><div class="ttname"><a href="../../de/dfe/app__minivm_8c.html#a380fbb314d06d7a3e037975f2f65da50">apply_general_options</a></div><div class="ttdeci">static int apply_general_options(struct ast_variable *var)</div><div class="ttdoc">Apply general configuration options. </div><div class="ttdef"><b>Definition:</b> <a href="../../de/dfe/app__minivm_8c_source.html#l02806">app_minivm.c:2806</a></div></div>
<div class="ttc" id="structminivm__account_html_a0d189d088982b574837ebaee7cd4ccbd"><div class="ttname"><a href="../../dc/d7b/structminivm__account.html#a0d189d088982b574837ebaee7cd4ccbd">minivm_account::serveremail</a></div><div class="ttdeci">char serveremail[80]</div><div class="ttdef"><b>Definition:</b> <a href="../../de/dfe/app__minivm_8c_source.html#l00609">app_minivm.c:609</a></div></div>
<div class="ttc" id="include_2asterisk_2app_8h_html_a588ed7395623b8493efcf229024af9c5"><div class="ttname"><a href="../../d3/d93/include_2asterisk_2app_8h.html#a588ed7395623b8493efcf229024af9c5">ast_app_separate_args</a></div><div class="ttdeci">#define ast_app_separate_args(a, b, c, d)</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d93/include_2asterisk_2app_8h_source.html#l01321">include/asterisk/app.h:1321</a></div></div>
<div class="ttc" id="app__minivm_8c_html_a59d95e558fe740e7070d090fc299f50d"><div class="ttname"><a href="../../de/dfe/app__minivm_8c.html#a59d95e558fe740e7070d090fc299f50d">minivm_delete_exec</a></div><div class="ttdeci">static int minivm_delete_exec(struct ast_channel *chan, const char *data)</div><div class="ttdef"><b>Definition:</b> <a href="../../de/dfe/app__minivm_8c_source.html#l02458">app_minivm.c:2458</a></div></div>
<div class="ttc" id="app__minivm_8c_html_ae53cc00d8e92280628c59ed0b0a6857c"><div class="ttname"><a href="../../de/dfe/app__minivm_8c.html#ae53cc00d8e92280628c59ed0b0a6857c">global_logfile</a></div><div class="ttdeci">static char global_logfile[PATH_MAX]</div><div class="ttdef"><b>Definition:</b> <a href="../../de/dfe/app__minivm_8c_source.html#l00701">app_minivm.c:701</a></div></div>
<div class="ttc" id="strings_8h_html_a9c34c6c6b8daaba24c0406270f3cf697"><div class="ttname"><a href="../../d6/d90/strings_8h.html#a9c34c6c6b8daaba24c0406270f3cf697">ast_str_create</a></div><div class="ttdeci">#define ast_str_create(init_len)</div><div class="ttdoc">Create a malloc&amp;#39;ed dynamic length string. </div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d90/strings_8h_source.html#l00620">strings.h:620</a></div></div>
<div class="ttc" id="codecs_2gsm_2inc_2private_8h_html_a0b023cbb2bf7d034c2269d58d7455ac8"><div class="ttname"><a href="../../d6/da0/codecs_2gsm_2inc_2private_8h.html#a0b023cbb2bf7d034c2269d58d7455ac8">word</a></div><div class="ttdeci">short word</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/da0/codecs_2gsm_2inc_2private_8h_source.html#l00012">codecs/gsm/inc/private.h:12</a></div></div>
<div class="ttc" id="lock_8h_html_a873f9ce8c6287a32d48c83133e124418"><div class="ttname"><a href="../../dd/d42/lock_8h.html#a873f9ce8c6287a32d48c83133e124418">ast_mutex_unlock</a></div><div class="ttdeci">#define ast_mutex_unlock(a)</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d42/lock_8h_source.html#l00188">lock.h:188</a></div></div>
<div class="ttc" id="utils_8h_html_a7c38859ed90e96df2b0a0fdf843769d0"><div class="ttname"><a href="../../d5/d60/utils_8h.html#a7c38859ed90e96df2b0a0fdf843769d0">ast_mkdir</a></div><div class="ttdeci">int ast_mkdir(const char *path, int mode)</div><div class="ttdoc">Recursively create directory path. </div><div class="ttdef"><b>Definition:</b> <a href="../../de/d1f/main_2utils_8c_source.html#l02231">main/utils.c:2231</a></div></div>
<div class="ttc" id="structast__tm_html"><div class="ttname"><a href="../../d5/d84/structast__tm.html">ast_tm</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d5/deb/localtime_8h_source.html#l00035">localtime.h:35</a></div></div>
<div class="ttc" id="include_2asterisk_2config_8h_html_a103e76ed4bd42f776f7f260080b98b3fafa887389dc380bbdcffb65fec379f037"><div class="ttname"><a href="../../d3/de6/include_2asterisk_2config_8h.html#a103e76ed4bd42f776f7f260080b98b3fafa887389dc380bbdcffb65fec379f037">CONFIG_FLAG_FILEUNCHANGED</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d3/de6/include_2asterisk_2config_8h_source.html#l00043">include/asterisk/config.h:43</a></div></div>
<div class="ttc" id="test__linkedlists_8c_html_a13dd15487fee89a002d17ef3aff62d02"><div class="ttname"><a href="../../d7/d6f/test__linkedlists_8c.html#a13dd15487fee89a002d17ef3aff62d02">a</a></div><div class="ttdeci">static struct test_val a</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d6f/test__linkedlists_8c_source.html#l00046">test_linkedlists.c:46</a></div></div>
<div class="ttc" id="structast__party__id_html_aca2d7de6c89f201dc8bd0a2642d2a352"><div class="ttname"><a href="../../d1/dcb/structast__party__id.html#aca2d7de6c89f201dc8bd0a2642d2a352">ast_party_id::number</a></div><div class="ttdeci">struct ast_party_number number</div><div class="ttdoc">Subscriber phone number. </div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d7b/channel_8h_source.html#l00343">channel.h:343</a></div></div>
<div class="ttc" id="app__minivm_8c_html_a43122a9830eb2a7234cf0994c3dc9627"><div class="ttname"><a href="../../de/dfe/app__minivm_8c.html#a43122a9830eb2a7234cf0994c3dc9627">minivm_account_function</a></div><div class="ttdeci">static struct ast_custom_function minivm_account_function</div><div class="ttdef"><b>Definition:</b> <a href="../../de/dfe/app__minivm_8c_source.html#l03511">app_minivm.c:3511</a></div></div>
<div class="ttc" id="app__minivm_8c_html_ab94d2ef3acf22b2bf9410c48462c7cb1"><div class="ttname"><a href="../../de/dfe/app__minivm_8c.html#ab94d2ef3acf22b2bf9410c48462c7cb1">MVM_SPOOL_DIR</a></div><div class="ttdeci">static char MVM_SPOOL_DIR[PATH_MAX]</div><div class="ttdef"><b>Definition:</b> <a href="../../de/dfe/app__minivm_8c_source.html#l00558">app_minivm.c:558</a></div></div>
<div class="ttc" id="group__StasisTopicsAndMessages_html_ga03bf52a37253e9ecdc4fadf9747a3497"><div class="ttname"><a href="../../df/deb/group__StasisTopicsAndMessages.html#ga03bf52a37253e9ecdc4fadf9747a3497">ast_mwi_vm_app_type</a></div><div class="ttdeci">struct stasis_message_type * ast_mwi_vm_app_type(void)</div><div class="ttdoc">Get the Stasis Message Bus API message type for voicemail application specific messages. </div></div>
</div><!-- fragment --></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Sun Aug 8 2021 19:43:01 for Asterisk - The Open Source Telephony Project by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="../../doxygen.png" alt="doxygen"/>
</a> 1.8.13
</small></address>
</body>
</html>
