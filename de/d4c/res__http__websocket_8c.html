<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Asterisk - The Open Source Telephony Project: res_http_websocket.c File Reference</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Asterisk - The Open Source Telephony Project
   &#160;<span id="projectnumber">18.5.0</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "../../search",false,'Search');
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('../../',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="../../dir_7b47cca4d318623bb4270ab1fb592ef5.html">res</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#nested-classes">Data Structures</a> &#124;
<a href="#define-members">Macros</a> &#124;
<a href="#func-members">Functions</a> &#124;
<a href="#var-members">Variables</a>  </div>
  <div class="headertitle">
<div class="title">res_http_websocket.c File Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>WebSocket support for the Asterisk internal HTTP server.  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &quot;<a class="el" href="../../db/db2/asterisk_8h_source.html">asterisk.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="../../d5/d16/module_8h_source.html">asterisk/module.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="../../dd/d56/http_8h_source.html">asterisk/http.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="../../d5/da5/astobj2_8h_source.html">asterisk/astobj2.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="../../d6/d90/strings_8h_source.html">asterisk/strings.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="../../d2/d4d/file_8h_source.html">asterisk/file.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="../../d2/d1e/unaligned_8h_source.html">asterisk/unaligned.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="../../df/d49/uri_8h_source.html">asterisk/uri.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="../../dd/d1d/uuid_8h_source.html">asterisk/uuid.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="../../d0/d0c/http__websocket_8h_source.html">asterisk/http_websocket.h</a>&quot;</code><br />
</div><div class="textblock"><div class="dynheader">
Include dependency graph for res_http_websocket.c:</div>
<div class="dyncontent">
<div class="center"><img src="../../d9/d82/res__http__websocket_8c__incl.png" border="0" usemap="#res__http__websocket_8c" alt=""/></div>
<map name="res__http__websocket_8c" id="res__http__websocket_8c">
<area shape="rect" id="node2" href="../../db/db2/asterisk_8h.html" title="Asterisk main include file. File version handling, generic pbx functions. " alt="" coords="1083,379,1167,405"/>
<area shape="rect" id="node22" href="../../d5/d16/module_8h.html" title="Asterisk module definitions. " alt="" coords="1456,229,1592,256"/>
<area shape="rect" id="node33" href="../../d6/d90/strings_8h.html" title="String manipulation functions. " alt="" coords="1197,379,1328,405"/>
<area shape="rect" id="node34" href="../../d5/da5/astobj2_8h.html" title="asterisk/astobj2.h" alt="" coords="1635,453,1770,480"/>
<area shape="rect" id="node36" href="../../dd/d56/http_8h.html" title="Support for Private Asterisk HTTP Servers. " alt="" coords="1995,155,2109,181"/>
<area shape="rect" id="node41" href="../../d2/d4d/file_8h.html" title="Generic File Format Support. Should be included by clients of the file handling routines. File service providers should instead include mod_format.h. " alt="" coords="960,80,1067,107"/>
<area shape="rect" id="node44" href="../../d2/d1e/unaligned_8h.html" title="Handle unaligned data access. " alt="" coords="1607,80,1758,107"/>
<area shape="rect" id="node45" href="../../df/d49/uri_8h.html" title="asterisk/uri.h" alt="" coords="1783,80,1887,107"/>
<area shape="rect" id="node46" href="../../dd/d1d/uuid_8h.html" title="Universally unique identifier support. " alt="" coords="1911,80,2025,107"/>
<area shape="rect" id="node47" href="../../d0/d0c/http__websocket_8h.html" title="Support for WebSocket connections within the Asterisk HTTP server and client WebSocket connections to..." alt="" coords="1193,80,1381,107"/>
<area shape="rect" id="node3" href="../../d8/d20/autoconfig_8h.html" title="asterisk/autoconfig.h" alt="" coords="1281,752,1436,779"/>
<area shape="rect" id="node5" href="../../de/da3/include_2asterisk_2compat_8h.html" title="General Definitions for Asterisk top level program Included by asterisk.h to handle platform&#45;specific..." alt="" coords="774,528,911,555"/>
<area shape="rect" id="node21" href="../../d8/d8a/astmm_8h.html" title="Asterisk memory management routines. " alt="" coords="953,453,1087,480"/>
<area shape="rect" id="node4" href="../../dc/dba/buildopts_8h.html" title="asterisk/buildopts.h" alt="" coords="1285,827,1432,853"/>
<area shape="rect" id="node6" href="../../d4/dd1/compiler_8h.html" title="Compiler&#45;specific macros and other items. " alt="" coords="1306,677,1449,704"/>
<area shape="rect" id="node23" href="../../d5/d60/utils_8h.html" title="Utility functions. " alt="" coords="1467,304,1581,331"/>
<area shape="rect" id="node24" href="../../d9/d94/network_8h.html" title="Wrapper for network related headers, masking differences between various operating systems..." alt="" coords="1504,379,1643,405"/>
<area shape="rect" id="node25" href="../../de/df7/time_8h.html" title="Time&#45;related functions and macros. " alt="" coords="1473,677,1535,704"/>
<area shape="rect" id="node27" href="../../dd/d42/lock_8h.html" title="Asterisk locking&#45;related definitions: " alt="" coords="1719,603,1833,629"/>
<area shape="rect" id="node30" href="../../d1/d8c/logger_8h.html" title="Support for logging to various files, console and syslog Configuration in file logger.conf. " alt="" coords="1939,677,2066,704"/>
<area shape="rect" id="node31" href="../../d5/deb/localtime_8h.html" title="Custom localtime functions for multiple timezones. " alt="" coords="1667,379,1813,405"/>
<area shape="rect" id="node32" href="../../d1/d0f/stringfields_8h.html" title="asterisk/stringfields.h" alt="" coords="1453,453,1611,480"/>
<area shape="rect" id="node26" href="../../d5/d9d/inline__api_8h.html" title="Inlinable API function macro. " alt="" coords="1551,752,1697,779"/>
<area shape="rect" id="node35" href="../../df/d90/linkedlists_8h.html" title="A set of macros to manage forward&#45;linked lists. " alt="" coords="1713,528,1863,555"/>
<area shape="rect" id="node37" href="../../d3/de6/include_2asterisk_2config_8h.html" title="Configuration File Parser. " alt="" coords="2138,229,2265,256"/>
<area shape="rect" id="node38" href="../../d4/ddf/tcptls_8h.html" title="Generic support for tcp/tls servers in Asterisk. " alt="" coords="1991,229,2113,256"/>
<area shape="rect" id="node39" href="../../dd/d27/iostream_8h.html" title="Generic abstraction for input/output streams. " alt="" coords="1189,304,1334,331"/>
<area shape="rect" id="node40" href="../../db/df1/netsock2_8h.html" title="Network socket handling. " alt="" coords="2040,528,2187,555"/>
<area shape="rect" id="node48" href="../../df/d3c/optional__api_8h.html" title="Optional API function macros. " alt="" coords="1204,155,1369,181"/>
</map>
</div>
</div>
<p><a href="../../de/d4c/res__http__websocket_8c_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="nested-classes"></a>
Data Structures</h2></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../db/db6/structast__websocket.html">ast_websocket</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">Structure definition for session.  <a href="../../db/db6/structast__websocket.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../db/d66/structast__websocket__server.html">ast_websocket_server</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">Structure for a WebSocket server.  <a href="../../db/d66/structast__websocket__server.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d7/de7/structwebsocket__client.html">websocket_client</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="define-members"></a>
Macros</h2></td></tr>
<tr class="memitem:a805616595a796949ade4a78edc628f99"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../de/d4c/res__http__websocket_8c.html#a805616595a796949ade4a78edc628f99">AST_API_MODULE</a></td></tr>
<tr class="separator:a805616595a796949ade4a78edc628f99"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aba8a9af0a5e1e29151c407fafd517124"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../de/d4c/res__http__websocket_8c.html#aba8a9af0a5e1e29151c407fafd517124">CLIENT_KEY_SIZE</a>&#160;&#160;&#160;16</td></tr>
<tr class="memdesc:aba8a9af0a5e1e29151c407fafd517124"><td class="mdescLeft">&#160;</td><td class="mdescRight">Length of a websocket's client key.  <a href="#aba8a9af0a5e1e29151c407fafd517124">More...</a><br /></td></tr>
<tr class="separator:aba8a9af0a5e1e29151c407fafd517124"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7f0e6d73d21f7f256f229583f02e58ec"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../de/d4c/res__http__websocket_8c.html#a7f0e6d73d21f7f256f229583f02e58ec">DEFAULT_RECONSTRUCTION_CEILING</a>&#160;&#160;&#160;<a class="el" href="../../de/d4c/res__http__websocket_8c.html#a055ae5efdfd42a3c39b110e43e6a1ff1">MAXIMUM_FRAME_SIZE</a></td></tr>
<tr class="memdesc:a7f0e6d73d21f7f256f229583f02e58ec"><td class="mdescLeft">&#160;</td><td class="mdescRight">Default reconstruction size for multi-frame payload reconstruction. If exceeded the next frame will start a payload.  <a href="#a7f0e6d73d21f7f256f229583f02e58ec">More...</a><br /></td></tr>
<tr class="separator:a7f0e6d73d21f7f256f229583f02e58ec"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5be56ede9f12af5da13707860ec9ceb3"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../de/d4c/res__http__websocket_8c.html#a5be56ede9f12af5da13707860ec9ceb3">MAX_PROTOCOL_BUCKETS</a>&#160;&#160;&#160;7</td></tr>
<tr class="memdesc:a5be56ede9f12af5da13707860ec9ceb3"><td class="mdescLeft">&#160;</td><td class="mdescRight">Number of buckets for registered protocols.  <a href="#a5be56ede9f12af5da13707860ec9ceb3">More...</a><br /></td></tr>
<tr class="separator:a5be56ede9f12af5da13707860ec9ceb3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8a855079655422ace22e3763e1150def"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../de/d4c/res__http__websocket_8c.html#a8a855079655422ace22e3763e1150def">MAX_WS_HDR_SZ</a>&#160;&#160;&#160;14</td></tr>
<tr class="memdesc:a8a855079655422ace22e3763e1150def"><td class="mdescLeft">&#160;</td><td class="mdescRight">Maximum size of a websocket frame header 1 byte flags and opcode 1 byte mask flag + payload len 8 bytes max extended length 4 bytes optional masking key ... payload follows ...  <a href="#a8a855079655422ace22e3763e1150def">More...</a><br /></td></tr>
<tr class="separator:a8a855079655422ace22e3763e1150def"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a055ae5efdfd42a3c39b110e43e6a1ff1"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../de/d4c/res__http__websocket_8c.html#a055ae5efdfd42a3c39b110e43e6a1ff1">MAXIMUM_FRAME_SIZE</a>&#160;&#160;&#160;65535</td></tr>
<tr class="memdesc:a055ae5efdfd42a3c39b110e43e6a1ff1"><td class="mdescLeft">&#160;</td><td class="mdescRight">Size of the pre-determined buffer for WebSocket frames.  <a href="#a055ae5efdfd42a3c39b110e43e6a1ff1">More...</a><br /></td></tr>
<tr class="separator:a055ae5efdfd42a3c39b110e43e6a1ff1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:afeaf5a5b74a2ae7bcdb585b6d57be576"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../de/d4c/res__http__websocket_8c.html#afeaf5a5b74a2ae7bcdb585b6d57be576">MAXIMUM_RECONSTRUCTION_CEILING</a>&#160;&#160;&#160;<a class="el" href="../../de/d4c/res__http__websocket_8c.html#a055ae5efdfd42a3c39b110e43e6a1ff1">MAXIMUM_FRAME_SIZE</a></td></tr>
<tr class="memdesc:afeaf5a5b74a2ae7bcdb585b6d57be576"><td class="mdescLeft">&#160;</td><td class="mdescRight">Maximum reconstruction size for multi-frame payload reconstruction.  <a href="#afeaf5a5b74a2ae7bcdb585b6d57be576">More...</a><br /></td></tr>
<tr class="separator:afeaf5a5b74a2ae7bcdb585b6d57be576"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2eb05d1858816a59ef4a882df8a1df44"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../de/d4c/res__http__websocket_8c.html#a2eb05d1858816a59ef4a882df8a1df44">MIN_WS_HDR_SZ</a>&#160;&#160;&#160;2</td></tr>
<tr class="separator:a2eb05d1858816a59ef4a882df8a1df44"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad17237839833df7be4a5c256801fe51b"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../de/d4c/res__http__websocket_8c.html#ad17237839833df7be4a5c256801fe51b">WEBSOCKET_GUID</a>&#160;&#160;&#160;&quot;258EAFA5-E914-47DA-95CA-C5AB0DC85B11&quot;</td></tr>
<tr class="memdesc:ad17237839833df7be4a5c256801fe51b"><td class="mdescLeft">&#160;</td><td class="mdescRight">GUID used to compute the accept key, defined in the specifications.  <a href="#ad17237839833df7be4a5c256801fe51b">More...</a><br /></td></tr>
<tr class="separator:ad17237839833df7be4a5c256801fe51b"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a88b7c88fed6b80fd18f34f97757dfc04"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../de/d4c/res__http__websocket_8c.html#a88b7c88fed6b80fd18f34f97757dfc04">__reg_module</a> (void)</td></tr>
<tr class="separator:a88b7c88fed6b80fd18f34f97757dfc04"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:afeab1257bd17282b95875499393a147a"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../de/d4c/res__http__websocket_8c.html#afeab1257bd17282b95875499393a147a">__unreg_module</a> (void)</td></tr>
<tr class="separator:afeab1257bd17282b95875499393a147a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4fb0aca9bbcdb9709fa52a70aded6cae"><td class="memItemLeft" align="right" valign="top">struct <a class="el" href="../../d9/df5/structast__module.html">ast_module</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../de/d4c/res__http__websocket_8c.html#a4fb0aca9bbcdb9709fa52a70aded6cae">AST_MODULE_SELF_SYM</a> (void)</td></tr>
<tr class="separator:a4fb0aca9bbcdb9709fa52a70aded6cae"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a099ab917f200dce4bcb7d0aadb2fb52a"><td class="memItemLeft" align="right" valign="top">int <a class="el" href="../../df/d3c/optional__api_8h.html#abe6ec88934f99eb74444f6c4a92353ec">AST_OPTIONAL_API_NAME</a>()&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../de/d4c/res__http__websocket_8c.html#a099ab917f200dce4bcb7d0aadb2fb52a">ast_websocket_add_protocol</a> (const char *<a class="el" href="../../d1/da4/res__corosync_8c.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <a class="el" href="../../d0/d0c/http__websocket_8h.html#acc038aba3451ed958627359ea71f156a">ast_websocket_callback</a> callback)</td></tr>
<tr class="separator:a099ab917f200dce4bcb7d0aadb2fb52a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:afc5cddd8c4bcded1a738b02c821f405f"><td class="memItemLeft" align="right" valign="top">int <a class="el" href="../../df/d3c/optional__api_8h.html#abe6ec88934f99eb74444f6c4a92353ec">AST_OPTIONAL_API_NAME</a>()&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../de/d4c/res__http__websocket_8c.html#afc5cddd8c4bcded1a738b02c821f405f">ast_websocket_add_protocol2</a> (struct <a class="el" href="../../dc/dcf/structast__websocket__protocol.html">ast_websocket_protocol</a> *protocol)</td></tr>
<tr class="separator:afc5cddd8c4bcded1a738b02c821f405f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac90b53a1487eadb430df0ea19dc3ed3a"><td class="memItemLeft" align="right" valign="top">const char *<a class="el" href="../../df/d3c/optional__api_8h.html#abe6ec88934f99eb74444f6c4a92353ec">AST_OPTIONAL_API_NAME</a>()&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../de/d4c/res__http__websocket_8c.html#ac90b53a1487eadb430df0ea19dc3ed3a">ast_websocket_client_accept_protocol</a> (struct <a class="el" href="../../db/db6/structast__websocket.html">ast_websocket</a> *ws)</td></tr>
<tr class="separator:ac90b53a1487eadb430df0ea19dc3ed3a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a05fa115a5e141d55e01722a1f4d6f698"><td class="memItemLeft" align="right" valign="top">struct <a class="el" href="../../db/db6/structast__websocket.html">ast_websocket</a> *<a class="el" href="../../df/d3c/optional__api_8h.html#abe6ec88934f99eb74444f6c4a92353ec">AST_OPTIONAL_API_NAME</a>()&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../de/d4c/res__http__websocket_8c.html#a05fa115a5e141d55e01722a1f4d6f698">ast_websocket_client_create</a> (const char *uri, const char *protocols, struct <a class="el" href="../../d5/d90/structast__tls__config.html">ast_tls_config</a> *tls_cfg, enum <a class="el" href="../../d0/d0c/http__websocket_8h.html#a6341c1b69564f8a3342229c5102b0fe2">ast_websocket_result</a> *<a class="el" href="../../de/d1b/cel__pgsql_8c.html#ad6c487210772a9b4b0ca04b04b847d4c">result</a>)</td></tr>
<tr class="separator:a05fa115a5e141d55e01722a1f4d6f698"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae4851ff13b6e90c8b88d5717465644ea"><td class="memItemLeft" align="right" valign="top">int <a class="el" href="../../df/d3c/optional__api_8h.html#abe6ec88934f99eb74444f6c4a92353ec">AST_OPTIONAL_API_NAME</a>()&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../de/d4c/res__http__websocket_8c.html#ae4851ff13b6e90c8b88d5717465644ea">ast_websocket_close</a> (struct <a class="el" href="../../db/db6/structast__websocket.html">ast_websocket</a> *<a class="el" href="../../d2/d4d/astman_8c.html#ac4a6ae0400e4457f0b35beddec80c93d">session</a>, uint16_t reason)</td></tr>
<tr class="memdesc:ae4851ff13b6e90c8b88d5717465644ea"><td class="mdescLeft">&#160;</td><td class="mdescRight">Close function for websocket session.  <a href="#ae4851ff13b6e90c8b88d5717465644ea">More...</a><br /></td></tr>
<tr class="separator:ae4851ff13b6e90c8b88d5717465644ea"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a874ca6ebfa7b35e92557cc97af1d41be"><td class="memItemLeft" align="right" valign="top">int <a class="el" href="../../df/d3c/optional__api_8h.html#abe6ec88934f99eb74444f6c4a92353ec">AST_OPTIONAL_API_NAME</a>()&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../de/d4c/res__http__websocket_8c.html#a874ca6ebfa7b35e92557cc97af1d41be">ast_websocket_fd</a> (struct <a class="el" href="../../db/db6/structast__websocket.html">ast_websocket</a> *<a class="el" href="../../d2/d4d/astman_8c.html#ac4a6ae0400e4457f0b35beddec80c93d">session</a>)</td></tr>
<tr class="separator:a874ca6ebfa7b35e92557cc97af1d41be"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a638aea4c786e326ded80afaecb09745c"><td class="memItemLeft" align="right" valign="top">int <a class="el" href="../../df/d3c/optional__api_8h.html#abe6ec88934f99eb74444f6c4a92353ec">AST_OPTIONAL_API_NAME</a>()&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../de/d4c/res__http__websocket_8c.html#a638aea4c786e326ded80afaecb09745c">ast_websocket_is_secure</a> (struct <a class="el" href="../../db/db6/structast__websocket.html">ast_websocket</a> *<a class="el" href="../../d2/d4d/astman_8c.html#ac4a6ae0400e4457f0b35beddec80c93d">session</a>)</td></tr>
<tr class="separator:a638aea4c786e326ded80afaecb09745c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9e80e75c690108f7466085cf3f956244"><td class="memItemLeft" align="right" valign="top">struct <a class="el" href="../../d3/db3/structast__sockaddr.html">ast_sockaddr</a> *<a class="el" href="../../df/d3c/optional__api_8h.html#abe6ec88934f99eb74444f6c4a92353ec">AST_OPTIONAL_API_NAME</a>()&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../de/d4c/res__http__websocket_8c.html#a9e80e75c690108f7466085cf3f956244">ast_websocket_local_address</a> (struct <a class="el" href="../../db/db6/structast__websocket.html">ast_websocket</a> *<a class="el" href="../../d2/d4d/astman_8c.html#ac4a6ae0400e4457f0b35beddec80c93d">session</a>)</td></tr>
<tr class="separator:a9e80e75c690108f7466085cf3f956244"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae16416016e8876c9dc2bd937278dcc4e"><td class="memItemLeft" align="right" valign="top">int <a class="el" href="../../df/d3c/optional__api_8h.html#abe6ec88934f99eb74444f6c4a92353ec">AST_OPTIONAL_API_NAME</a>()&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../de/d4c/res__http__websocket_8c.html#ae16416016e8876c9dc2bd937278dcc4e">ast_websocket_read</a> (struct <a class="el" href="../../db/db6/structast__websocket.html">ast_websocket</a> *<a class="el" href="../../d2/d4d/astman_8c.html#ac4a6ae0400e4457f0b35beddec80c93d">session</a>, char **payload, uint64_t *payload_len, enum <a class="el" href="../../d0/d0c/http__websocket_8h.html#a8cb89d2edeb737bfc4efb15902cd19bc">ast_websocket_opcode</a> *opcode, int *fragmented)</td></tr>
<tr class="separator:ae16416016e8876c9dc2bd937278dcc4e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:afae0d72494ee51b8bda86278280406f7"><td class="memItemLeft" align="right" valign="top">int <a class="el" href="../../df/d3c/optional__api_8h.html#abe6ec88934f99eb74444f6c4a92353ec">AST_OPTIONAL_API_NAME</a>()&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../de/d4c/res__http__websocket_8c.html#afae0d72494ee51b8bda86278280406f7">ast_websocket_read_string</a> (struct <a class="el" href="../../db/db6/structast__websocket.html">ast_websocket</a> *ws, char **<a class="el" href="../../dd/d7c/eagi__proxy_8c.html#ac95651d79c608a3148973b5b1fc9e525">buf</a>)</td></tr>
<tr class="separator:afae0d72494ee51b8bda86278280406f7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a758d45d0bdc3f7f5335975dc1c107b29"><td class="memItemLeft" align="right" valign="top">void <a class="el" href="../../df/d3c/optional__api_8h.html#abe6ec88934f99eb74444f6c4a92353ec">AST_OPTIONAL_API_NAME</a>()&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../de/d4c/res__http__websocket_8c.html#a758d45d0bdc3f7f5335975dc1c107b29">ast_websocket_reconstruct_disable</a> (struct <a class="el" href="../../db/db6/structast__websocket.html">ast_websocket</a> *<a class="el" href="../../d2/d4d/astman_8c.html#ac4a6ae0400e4457f0b35beddec80c93d">session</a>)</td></tr>
<tr class="separator:a758d45d0bdc3f7f5335975dc1c107b29"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a27573aab975ea1367611f7edc085772f"><td class="memItemLeft" align="right" valign="top">void <a class="el" href="../../df/d3c/optional__api_8h.html#abe6ec88934f99eb74444f6c4a92353ec">AST_OPTIONAL_API_NAME</a>()&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../de/d4c/res__http__websocket_8c.html#a27573aab975ea1367611f7edc085772f">ast_websocket_reconstruct_enable</a> (struct <a class="el" href="../../db/db6/structast__websocket.html">ast_websocket</a> *<a class="el" href="../../d2/d4d/astman_8c.html#ac4a6ae0400e4457f0b35beddec80c93d">session</a>, size_t bytes)</td></tr>
<tr class="separator:a27573aab975ea1367611f7edc085772f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a050ca80ad7ca07b7643d5ffab2474473"><td class="memItemLeft" align="right" valign="top">void <a class="el" href="../../df/d3c/optional__api_8h.html#abe6ec88934f99eb74444f6c4a92353ec">AST_OPTIONAL_API_NAME</a>()&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../de/d4c/res__http__websocket_8c.html#a050ca80ad7ca07b7643d5ffab2474473">ast_websocket_ref</a> (struct <a class="el" href="../../db/db6/structast__websocket.html">ast_websocket</a> *<a class="el" href="../../d2/d4d/astman_8c.html#ac4a6ae0400e4457f0b35beddec80c93d">session</a>)</td></tr>
<tr class="separator:a050ca80ad7ca07b7643d5ffab2474473"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa854546175b8c60844ecdf14c33b6e97"><td class="memItemLeft" align="right" valign="top">struct <a class="el" href="../../d3/db3/structast__sockaddr.html">ast_sockaddr</a> *<a class="el" href="../../df/d3c/optional__api_8h.html#abe6ec88934f99eb74444f6c4a92353ec">AST_OPTIONAL_API_NAME</a>()&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../de/d4c/res__http__websocket_8c.html#aa854546175b8c60844ecdf14c33b6e97">ast_websocket_remote_address</a> (struct <a class="el" href="../../db/db6/structast__websocket.html">ast_websocket</a> *<a class="el" href="../../d2/d4d/astman_8c.html#ac4a6ae0400e4457f0b35beddec80c93d">session</a>)</td></tr>
<tr class="separator:aa854546175b8c60844ecdf14c33b6e97"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae810879a31a3cc6ef5ccd4b922e1e4ab"><td class="memItemLeft" align="right" valign="top">int <a class="el" href="../../df/d3c/optional__api_8h.html#abe6ec88934f99eb74444f6c4a92353ec">AST_OPTIONAL_API_NAME</a>()&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../de/d4c/res__http__websocket_8c.html#ae810879a31a3cc6ef5ccd4b922e1e4ab">ast_websocket_remove_protocol</a> (const char *<a class="el" href="../../d1/da4/res__corosync_8c.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <a class="el" href="../../d0/d0c/http__websocket_8h.html#acc038aba3451ed958627359ea71f156a">ast_websocket_callback</a> callback)</td></tr>
<tr class="separator:ae810879a31a3cc6ef5ccd4b922e1e4ab"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab9a7ca872780104e9155d8d15423cadd"><td class="memItemLeft" align="right" valign="top">int <a class="el" href="../../df/d3c/optional__api_8h.html#abe6ec88934f99eb74444f6c4a92353ec">AST_OPTIONAL_API_NAME</a>()&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../de/d4c/res__http__websocket_8c.html#ab9a7ca872780104e9155d8d15423cadd">ast_websocket_server_add_protocol</a> (struct <a class="el" href="../../db/d66/structast__websocket__server.html">ast_websocket_server</a> *server, const char *<a class="el" href="../../d1/da4/res__corosync_8c.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <a class="el" href="../../d0/d0c/http__websocket_8h.html#acc038aba3451ed958627359ea71f156a">ast_websocket_callback</a> callback)</td></tr>
<tr class="separator:ab9a7ca872780104e9155d8d15423cadd"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2568f59be0945091ec1778c0262297ff"><td class="memItemLeft" align="right" valign="top">int <a class="el" href="../../df/d3c/optional__api_8h.html#abe6ec88934f99eb74444f6c4a92353ec">AST_OPTIONAL_API_NAME</a>()&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../de/d4c/res__http__websocket_8c.html#a2568f59be0945091ec1778c0262297ff">ast_websocket_server_add_protocol2</a> (struct <a class="el" href="../../db/d66/structast__websocket__server.html">ast_websocket_server</a> *server, struct <a class="el" href="../../dc/dcf/structast__websocket__protocol.html">ast_websocket_protocol</a> *protocol)</td></tr>
<tr class="separator:a2568f59be0945091ec1778c0262297ff"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0fb7fcf9b9c1295cb52511a093d0108e"><td class="memItemLeft" align="right" valign="top">struct <a class="el" href="../../db/d66/structast__websocket__server.html">ast_websocket_server</a> *<a class="el" href="../../df/d3c/optional__api_8h.html#abe6ec88934f99eb74444f6c4a92353ec">AST_OPTIONAL_API_NAME</a>()&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../de/d4c/res__http__websocket_8c.html#a0fb7fcf9b9c1295cb52511a093d0108e">ast_websocket_server_create</a> (void)</td></tr>
<tr class="separator:a0fb7fcf9b9c1295cb52511a093d0108e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac90e98de467636091797a98a5f596b1d"><td class="memItemLeft" align="right" valign="top">int <a class="el" href="../../df/d3c/optional__api_8h.html#abe6ec88934f99eb74444f6c4a92353ec">AST_OPTIONAL_API_NAME</a>()&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../de/d4c/res__http__websocket_8c.html#ac90e98de467636091797a98a5f596b1d">ast_websocket_server_remove_protocol</a> (struct <a class="el" href="../../db/d66/structast__websocket__server.html">ast_websocket_server</a> *server, const char *<a class="el" href="../../d1/da4/res__corosync_8c.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <a class="el" href="../../d0/d0c/http__websocket_8h.html#acc038aba3451ed958627359ea71f156a">ast_websocket_callback</a> callback)</td></tr>
<tr class="separator:ac90e98de467636091797a98a5f596b1d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a74ad35149f76ef1aa536d8dbffa1796c"><td class="memItemLeft" align="right" valign="top">const char *<a class="el" href="../../df/d3c/optional__api_8h.html#abe6ec88934f99eb74444f6c4a92353ec">AST_OPTIONAL_API_NAME</a>()&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../de/d4c/res__http__websocket_8c.html#a74ad35149f76ef1aa536d8dbffa1796c">ast_websocket_session_id</a> (struct <a class="el" href="../../db/db6/structast__websocket.html">ast_websocket</a> *<a class="el" href="../../d2/d4d/astman_8c.html#ac4a6ae0400e4457f0b35beddec80c93d">session</a>)</td></tr>
<tr class="separator:a74ad35149f76ef1aa536d8dbffa1796c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab549e9a066a7c7738330e31b0b083177"><td class="memItemLeft" align="right" valign="top">int <a class="el" href="../../df/d3c/optional__api_8h.html#abe6ec88934f99eb74444f6c4a92353ec">AST_OPTIONAL_API_NAME</a>()&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../de/d4c/res__http__websocket_8c.html#ab549e9a066a7c7738330e31b0b083177">ast_websocket_set_nonblock</a> (struct <a class="el" href="../../db/db6/structast__websocket.html">ast_websocket</a> *<a class="el" href="../../d2/d4d/astman_8c.html#ac4a6ae0400e4457f0b35beddec80c93d">session</a>)</td></tr>
<tr class="separator:ab549e9a066a7c7738330e31b0b083177"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:adc1ab49fc86302e5de5b0c25308ad2da"><td class="memItemLeft" align="right" valign="top">int <a class="el" href="../../df/d3c/optional__api_8h.html#abe6ec88934f99eb74444f6c4a92353ec">AST_OPTIONAL_API_NAME</a>()&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../de/d4c/res__http__websocket_8c.html#adc1ab49fc86302e5de5b0c25308ad2da">ast_websocket_set_timeout</a> (struct <a class="el" href="../../db/db6/structast__websocket.html">ast_websocket</a> *<a class="el" href="../../d2/d4d/astman_8c.html#ac4a6ae0400e4457f0b35beddec80c93d">session</a>, int <a class="el" href="../../d0/d29/cdr__mysql_8c.html#a493b57f443cc38b3d3df9c1e584d9d82">timeout</a>)</td></tr>
<tr class="separator:adc1ab49fc86302e5de5b0c25308ad2da"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa9a722be9189021e49edc5f386e085e3"><td class="memItemLeft" align="right" valign="top">struct <a class="el" href="../../dc/dcf/structast__websocket__protocol.html">ast_websocket_protocol</a> *<a class="el" href="../../df/d3c/optional__api_8h.html#abe6ec88934f99eb74444f6c4a92353ec">AST_OPTIONAL_API_NAME</a>()&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../de/d4c/res__http__websocket_8c.html#aa9a722be9189021e49edc5f386e085e3">ast_websocket_sub_protocol_alloc</a> (const char *<a class="el" href="../../d1/da4/res__corosync_8c.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>)</td></tr>
<tr class="separator:aa9a722be9189021e49edc5f386e085e3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af03daa0a59002330aacdfcb44da59db9"><td class="memItemLeft" align="right" valign="top">void <a class="el" href="../../df/d3c/optional__api_8h.html#abe6ec88934f99eb74444f6c4a92353ec">AST_OPTIONAL_API_NAME</a>()&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../de/d4c/res__http__websocket_8c.html#af03daa0a59002330aacdfcb44da59db9">ast_websocket_unref</a> (struct <a class="el" href="../../db/db6/structast__websocket.html">ast_websocket</a> *<a class="el" href="../../d2/d4d/astman_8c.html#ac4a6ae0400e4457f0b35beddec80c93d">session</a>)</td></tr>
<tr class="separator:af03daa0a59002330aacdfcb44da59db9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a62e15263be35efd221046ddd8d7a93db"><td class="memItemLeft" align="right" valign="top">int <a class="el" href="../../df/d3c/optional__api_8h.html#abe6ec88934f99eb74444f6c4a92353ec">AST_OPTIONAL_API_NAME</a>()&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../de/d4c/res__http__websocket_8c.html#a62e15263be35efd221046ddd8d7a93db">ast_websocket_uri_cb</a> (struct <a class="el" href="../../d6/d49/structast__tcptls__session__instance.html">ast_tcptls_session_instance</a> *ser, const struct <a class="el" href="../../d0/d6c/structast__http__uri.html">ast_http_uri</a> *urih, const char *uri, enum <a class="el" href="../../dd/d56/http_8h.html#a16fb43ed7e6093a9dc96477ba37b80ef">ast_http_method</a> <a class="el" href="../../de/d96/res__pjsip_8c.html#a8b44a03925325ceaf2de7b079b1541a1">method</a>, struct <a class="el" href="../../dd/d02/structast__variable.html">ast_variable</a> *get_vars, struct <a class="el" href="../../dd/d02/structast__variable.html">ast_variable</a> *headers)</td></tr>
<tr class="separator:a62e15263be35efd221046ddd8d7a93db"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a838ccd8bed44b43d4b95025bc3bea4c8"><td class="memItemLeft" align="right" valign="top">int <a class="el" href="../../df/d3c/optional__api_8h.html#abe6ec88934f99eb74444f6c4a92353ec">AST_OPTIONAL_API_NAME</a>()&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../de/d4c/res__http__websocket_8c.html#a838ccd8bed44b43d4b95025bc3bea4c8">ast_websocket_wait_for_input</a> (struct <a class="el" href="../../db/db6/structast__websocket.html">ast_websocket</a> *<a class="el" href="../../d2/d4d/astman_8c.html#ac4a6ae0400e4457f0b35beddec80c93d">session</a>, int <a class="el" href="../../d0/d29/cdr__mysql_8c.html#a493b57f443cc38b3d3df9c1e584d9d82">timeout</a>)</td></tr>
<tr class="separator:a838ccd8bed44b43d4b95025bc3bea4c8"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1a6e44db94d8b4e8c06bf456bb0174ad"><td class="memItemLeft" align="right" valign="top">int <a class="el" href="../../df/d3c/optional__api_8h.html#abe6ec88934f99eb74444f6c4a92353ec">AST_OPTIONAL_API_NAME</a>()&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../de/d4c/res__http__websocket_8c.html#a1a6e44db94d8b4e8c06bf456bb0174ad">ast_websocket_write</a> (struct <a class="el" href="../../db/db6/structast__websocket.html">ast_websocket</a> *<a class="el" href="../../d2/d4d/astman_8c.html#ac4a6ae0400e4457f0b35beddec80c93d">session</a>, enum <a class="el" href="../../d0/d0c/http__websocket_8h.html#a8cb89d2edeb737bfc4efb15902cd19bc">ast_websocket_opcode</a> opcode, char *payload, uint64_t payload_size)</td></tr>
<tr class="memdesc:a1a6e44db94d8b4e8c06bf456bb0174ad"><td class="mdescLeft">&#160;</td><td class="mdescRight">Write function for websocket traffic.  <a href="#a1a6e44db94d8b4e8c06bf456bb0174ad">More...</a><br /></td></tr>
<tr class="separator:a1a6e44db94d8b4e8c06bf456bb0174ad"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a273d38d787b904025da601b751d91647"><td class="memItemLeft" align="right" valign="top">int <a class="el" href="../../df/d3c/optional__api_8h.html#abe6ec88934f99eb74444f6c4a92353ec">AST_OPTIONAL_API_NAME</a>()&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../de/d4c/res__http__websocket_8c.html#a273d38d787b904025da601b751d91647">ast_websocket_write_string</a> (struct <a class="el" href="../../db/db6/structast__websocket.html">ast_websocket</a> *ws, const char *<a class="el" href="../../dd/d7c/eagi__proxy_8c.html#ac95651d79c608a3148973b5b1fc9e525">buf</a>)</td></tr>
<tr class="separator:a273d38d787b904025da601b751d91647"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac3382bf6da54c56b37069bd76bbdf4f9"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../de/d4c/res__http__websocket_8c.html#ac3382bf6da54c56b37069bd76bbdf4f9">load_module</a> (void)</td></tr>
<tr class="separator:ac3382bf6da54c56b37069bd76bbdf4f9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a912dbb1619c0d406fb8451ae4f977a1b"><td class="memItemLeft" align="right" valign="top">static struct <a class="el" href="../../dc/dcf/structast__websocket__protocol.html">ast_websocket_protocol</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../de/d4c/res__http__websocket_8c.html#a912dbb1619c0d406fb8451ae4f977a1b">one_protocol</a> (struct <a class="el" href="../../db/d66/structast__websocket__server.html">ast_websocket_server</a> *server)</td></tr>
<tr class="memdesc:a912dbb1619c0d406fb8451ae4f977a1b"><td class="mdescLeft">&#160;</td><td class="mdescRight">If the server has exactly one configured protocol, return it.  <a href="#a912dbb1619c0d406fb8451ae4f977a1b">More...</a><br /></td></tr>
<tr class="separator:a912dbb1619c0d406fb8451ae4f977a1b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7e26998f99ba89e31a4ef2f2c899b758"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../de/d4c/res__http__websocket_8c.html#a7e26998f99ba89e31a4ef2f2c899b758">protocol_cmp_fn</a> (void *obj, void *arg, int flags)</td></tr>
<tr class="memdesc:a7e26998f99ba89e31a4ef2f2c899b758"><td class="mdescLeft">&#160;</td><td class="mdescRight">Comparison function for protocols.  <a href="#a7e26998f99ba89e31a4ef2f2c899b758">More...</a><br /></td></tr>
<tr class="separator:a7e26998f99ba89e31a4ef2f2c899b758"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8e476c76d070ad965d9f7cc6e6063cbf"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../de/d4c/res__http__websocket_8c.html#a8e476c76d070ad965d9f7cc6e6063cbf">protocol_destroy_fn</a> (void *obj)</td></tr>
<tr class="memdesc:a8e476c76d070ad965d9f7cc6e6063cbf"><td class="mdescLeft">&#160;</td><td class="mdescRight">Destructor function for protocols.  <a href="#a8e476c76d070ad965d9f7cc6e6063cbf">More...</a><br /></td></tr>
<tr class="separator:a8e476c76d070ad965d9f7cc6e6063cbf"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab1f7b44119d3a7df6f3517212a8f8e51"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../de/d4c/res__http__websocket_8c.html#ab1f7b44119d3a7df6f3517212a8f8e51">protocol_hash_fn</a> (const void *obj, const int flags)</td></tr>
<tr class="memdesc:ab1f7b44119d3a7df6f3517212a8f8e51"><td class="mdescLeft">&#160;</td><td class="mdescRight">Hashing function for protocols.  <a href="#ab1f7b44119d3a7df6f3517212a8f8e51">More...</a><br /></td></tr>
<tr class="separator:ab1f7b44119d3a7df6f3517212a8f8e51"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aed324e37497858b50c441fef9f636ccf"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../de/d4c/res__http__websocket_8c.html#aed324e37497858b50c441fef9f636ccf">session_destroy_fn</a> (void *obj)</td></tr>
<tr class="memdesc:aed324e37497858b50c441fef9f636ccf"><td class="mdescLeft">&#160;</td><td class="mdescRight">Destructor function for sessions.  <a href="#aed324e37497858b50c441fef9f636ccf">More...</a><br /></td></tr>
<tr class="separator:aed324e37497858b50c441fef9f636ccf"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad09fa931f468002152a3cc2d5ce25eae"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../de/d4c/res__http__websocket_8c.html#ad09fa931f468002152a3cc2d5ce25eae">unload_module</a> (void)</td></tr>
<tr class="separator:ad09fa931f468002152a3cc2d5ce25eae"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aba0a4f6f2ebf4ebff817aeae8d6d690f"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../de/d4c/res__http__websocket_8c.html#aba0a4f6f2ebf4ebff817aeae8d6d690f">websocket_add_protocol_internal</a> (const char *<a class="el" href="../../d1/da4/res__corosync_8c.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <a class="el" href="../../d0/d0c/http__websocket_8h.html#acc038aba3451ed958627359ea71f156a">ast_websocket_callback</a> callback)</td></tr>
<tr class="separator:aba0a4f6f2ebf4ebff817aeae8d6d690f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a22d1c731d15309d02fed2fd3e1b681f8"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../de/d4c/res__http__websocket_8c.html#a22d1c731d15309d02fed2fd3e1b681f8">websocket_bad_request</a> (struct <a class="el" href="../../d6/d49/structast__tcptls__session__instance.html">ast_tcptls_session_instance</a> *ser)</td></tr>
<tr class="separator:a22d1c731d15309d02fed2fd3e1b681f8"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:acf54fd38b47e3e4d0960010f7ae6e873"><td class="memItemLeft" align="right" valign="top">static struct <a class="el" href="../../da/d2b/structast__tcptls__session__args.html">ast_tcptls_session_args</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../de/d4c/res__http__websocket_8c.html#acf54fd38b47e3e4d0960010f7ae6e873">websocket_client_args_create</a> (const char *<a class="el" href="../../d0/d8a/muted_8c.html#a41c3a180b50c6b2ddcc1b6843a48f205">host</a>, struct <a class="el" href="../../d5/d90/structast__tls__config.html">ast_tls_config</a> *tls_cfg, enum <a class="el" href="../../d0/d0c/http__websocket_8h.html#a6341c1b69564f8a3342229c5102b0fe2">ast_websocket_result</a> *<a class="el" href="../../de/d1b/cel__pgsql_8c.html#ad6c487210772a9b4b0ca04b04b847d4c">result</a>)</td></tr>
<tr class="separator:acf54fd38b47e3e4d0960010f7ae6e873"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2fa89c00c48823e19f169f09b9cfbb3b"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../de/d4c/res__http__websocket_8c.html#a2fa89c00c48823e19f169f09b9cfbb3b">websocket_client_args_destroy</a> (void *obj)</td></tr>
<tr class="separator:a2fa89c00c48823e19f169f09b9cfbb3b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae6b78ddeb7585dc4c2d42b8de58ab7f9"><td class="memItemLeft" align="right" valign="top">static enum <a class="el" href="../../d0/d0c/http__websocket_8h.html#a6341c1b69564f8a3342229c5102b0fe2">ast_websocket_result</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../de/d4c/res__http__websocket_8c.html#ae6b78ddeb7585dc4c2d42b8de58ab7f9">websocket_client_connect</a> (struct <a class="el" href="../../db/db6/structast__websocket.html">ast_websocket</a> *ws)</td></tr>
<tr class="separator:ae6b78ddeb7585dc4c2d42b8de58ab7f9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a732e919813a7f9bf5d6cada291ad589c"><td class="memItemLeft" align="right" valign="top">static struct <a class="el" href="../../db/db6/structast__websocket.html">ast_websocket</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../de/d4c/res__http__websocket_8c.html#a732e919813a7f9bf5d6cada291ad589c">websocket_client_create</a> (const char *uri, const char *protocols, struct <a class="el" href="../../d5/d90/structast__tls__config.html">ast_tls_config</a> *tls_cfg, enum <a class="el" href="../../d0/d0c/http__websocket_8h.html#a6341c1b69564f8a3342229c5102b0fe2">ast_websocket_result</a> *<a class="el" href="../../de/d1b/cel__pgsql_8c.html#ad6c487210772a9b4b0ca04b04b847d4c">result</a>)</td></tr>
<tr class="separator:a732e919813a7f9bf5d6cada291ad589c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af684463c7d69d50e47bc96b968737280"><td class="memItemLeft" align="right" valign="top">static char *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../de/d4c/res__http__websocket_8c.html#af684463c7d69d50e47bc96b968737280">websocket_client_create_key</a> (void)</td></tr>
<tr class="separator:af684463c7d69d50e47bc96b968737280"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0c583fc9daf458f4a079bf3e129e7383"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../de/d4c/res__http__websocket_8c.html#a0c583fc9daf458f4a079bf3e129e7383">websocket_client_destroy</a> (void *obj)</td></tr>
<tr class="separator:a0c583fc9daf458f4a079bf3e129e7383"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0f1a25206f6099821e1e196107dbfa1d"><td class="memItemLeft" align="right" valign="top">static enum <a class="el" href="../../d0/d0c/http__websocket_8h.html#a6341c1b69564f8a3342229c5102b0fe2">ast_websocket_result</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../de/d4c/res__http__websocket_8c.html#a0f1a25206f6099821e1e196107dbfa1d">websocket_client_handle_response_code</a> (struct <a class="el" href="../../d7/de7/structwebsocket__client.html">websocket_client</a> *client, int response_code)</td></tr>
<tr class="separator:a0f1a25206f6099821e1e196107dbfa1d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a71181c85896291b79c1920cfedeaf998"><td class="memItemLeft" align="right" valign="top">static enum <a class="el" href="../../d0/d0c/http__websocket_8h.html#a6341c1b69564f8a3342229c5102b0fe2">ast_websocket_result</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../de/d4c/res__http__websocket_8c.html#a71181c85896291b79c1920cfedeaf998">websocket_client_handshake</a> (struct <a class="el" href="../../d7/de7/structwebsocket__client.html">websocket_client</a> *client)</td></tr>
<tr class="separator:a71181c85896291b79c1920cfedeaf998"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a29cbcfc66f08592db881eb452904aa39"><td class="memItemLeft" align="right" valign="top">static enum <a class="el" href="../../d0/d0c/http__websocket_8h.html#a6341c1b69564f8a3342229c5102b0fe2">ast_websocket_result</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../de/d4c/res__http__websocket_8c.html#a29cbcfc66f08592db881eb452904aa39">websocket_client_handshake_get_response</a> (struct <a class="el" href="../../d7/de7/structwebsocket__client.html">websocket_client</a> *client)</td></tr>
<tr class="separator:a29cbcfc66f08592db881eb452904aa39"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa29713a06d3e2971c2ca2c213d177762"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../de/d4c/res__http__websocket_8c.html#aa29713a06d3e2971c2ca2c213d177762">websocket_client_parse_uri</a> (const char *uri, char **<a class="el" href="../../d0/d8a/muted_8c.html#a41c3a180b50c6b2ddcc1b6843a48f205">host</a>, struct <a class="el" href="../../dd/da2/structast__str.html">ast_str</a> **path)</td></tr>
<tr class="memdesc:aa29713a06d3e2971c2ca2c213d177762"><td class="mdescLeft">&#160;</td><td class="mdescRight">Parse the given uri into a path and remote address.  <a href="#aa29713a06d3e2971c2ca2c213d177762">More...</a><br /></td></tr>
<tr class="separator:aa29713a06d3e2971c2ca2c213d177762"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac4661ddf40219eddd566cbdedee3ad37"><td class="memItemLeft" align="right" valign="top">static char *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../de/d4c/res__http__websocket_8c.html#ac4661ddf40219eddd566cbdedee3ad37">websocket_combine_key</a> (const char *key, char *res, int res_size)</td></tr>
<tr class="separator:ac4661ddf40219eddd566cbdedee3ad37"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a16179dccdf130e1ec1d0ff701fb5fe5d"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../de/d4c/res__http__websocket_8c.html#a16179dccdf130e1ec1d0ff701fb5fe5d">websocket_echo_callback</a> (struct <a class="el" href="../../db/db6/structast__websocket.html">ast_websocket</a> *<a class="el" href="../../d2/d4d/astman_8c.html#ac4a6ae0400e4457f0b35beddec80c93d">session</a>, struct <a class="el" href="../../dd/d02/structast__variable.html">ast_variable</a> *parameters, struct <a class="el" href="../../dd/d02/structast__variable.html">ast_variable</a> *headers)</td></tr>
<tr class="memdesc:a16179dccdf130e1ec1d0ff701fb5fe5d"><td class="mdescLeft">&#160;</td><td class="mdescRight">Simple echo implementation which echoes received text and binary frames.  <a href="#a16179dccdf130e1ec1d0ff701fb5fe5d">More...</a><br /></td></tr>
<tr class="separator:a16179dccdf130e1ec1d0ff701fb5fe5d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a724a006e8f51c16953462608c1eb6fcd"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../de/d4c/res__http__websocket_8c.html#a724a006e8f51c16953462608c1eb6fcd">websocket_mask_payload</a> (struct <a class="el" href="../../db/db6/structast__websocket.html">ast_websocket</a> *<a class="el" href="../../d2/d4d/astman_8c.html#ac4a6ae0400e4457f0b35beddec80c93d">session</a>, char *frame, char *payload, uint64_t payload_size)</td></tr>
<tr class="memdesc:a724a006e8f51c16953462608c1eb6fcd"><td class="mdescLeft">&#160;</td><td class="mdescRight">Perform payload masking for client sessions.  <a href="#a724a006e8f51c16953462608c1eb6fcd">More...</a><br /></td></tr>
<tr class="separator:a724a006e8f51c16953462608c1eb6fcd"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:abf1644d4ceb871c277d1aa1cfb7a9a15"><td class="memItemLeft" align="right" valign="top">static const char *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../de/d4c/res__http__websocket_8c.html#abf1644d4ceb871c277d1aa1cfb7a9a15">websocket_opcode2str</a> (enum <a class="el" href="../../d0/d0c/http__websocket_8h.html#a8cb89d2edeb737bfc4efb15902cd19bc">ast_websocket_opcode</a> opcode)</td></tr>
<tr class="separator:abf1644d4ceb871c277d1aa1cfb7a9a15"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a43e3b5d71764b9fb2b338fdf53c9c675"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../de/d4c/res__http__websocket_8c.html#a43e3b5d71764b9fb2b338fdf53c9c675">websocket_remove_protocol_internal</a> (const char *<a class="el" href="../../d1/da4/res__corosync_8c.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <a class="el" href="../../d0/d0c/http__websocket_8h.html#acc038aba3451ed958627359ea71f156a">ast_websocket_callback</a> callback)</td></tr>
<tr class="separator:a43e3b5d71764b9fb2b338fdf53c9c675"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa4a7f78738dfa70961e16bad55a9156e"><td class="memItemLeft" align="right" valign="top">static struct <a class="el" href="../../db/d66/structast__websocket__server.html">ast_websocket_server</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../de/d4c/res__http__websocket_8c.html#aa4a7f78738dfa70961e16bad55a9156e">websocket_server_create_impl</a> (void)</td></tr>
<tr class="separator:aa4a7f78738dfa70961e16bad55a9156e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a68f2ee4ab223f3c4f9719b6fd2cfdfef"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../de/d4c/res__http__websocket_8c.html#a68f2ee4ab223f3c4f9719b6fd2cfdfef">websocket_server_dtor</a> (void *obj)</td></tr>
<tr class="separator:a68f2ee4ab223f3c4f9719b6fd2cfdfef"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a90ad4f2355601e1464ef3004264c7afe"><td class="memItemLeft" align="right" valign="top">static struct <a class="el" href="../../db/d66/structast__websocket__server.html">ast_websocket_server</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../de/d4c/res__http__websocket_8c.html#a90ad4f2355601e1464ef3004264c7afe">websocket_server_internal_create</a> (void)</td></tr>
<tr class="separator:a90ad4f2355601e1464ef3004264c7afe"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a32088fabfd3e38aa97358a8833d59850"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../de/d4c/res__http__websocket_8c.html#a32088fabfd3e38aa97358a8833d59850">ws_safe_read</a> (struct <a class="el" href="../../db/db6/structast__websocket.html">ast_websocket</a> *<a class="el" href="../../d2/d4d/astman_8c.html#ac4a6ae0400e4457f0b35beddec80c93d">session</a>, char *<a class="el" href="../../dd/d7c/eagi__proxy_8c.html#ac95651d79c608a3148973b5b1fc9e525">buf</a>, size_t <a class="el" href="../../d9/d1e/func__strings_8c.html#af24e73aaf92f3000fda15d285e66df24">len</a>, enum <a class="el" href="../../d0/d0c/http__websocket_8h.html#a8cb89d2edeb737bfc4efb15902cd19bc">ast_websocket_opcode</a> *opcode)</td></tr>
<tr class="separator:a32088fabfd3e38aa97358a8833d59850"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="var-members"></a>
Variables</h2></td></tr>
<tr class="memitem:ab22f32016155f7f403e7178767163d7d"><td class="memItemLeft" align="right" valign="top">static struct <a class="el" href="../../dd/d5f/structast__module__info.html">ast_module_info</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../de/d4c/res__http__websocket_8c.html#ab22f32016155f7f403e7178767163d7d">__mod_info</a> = { .<a class="el" href="../../d1/da4/res__corosync_8c.html#a8f8f80d37794cde9472343e4487ba3eb">name</a> = <a class="el" href="../../da/ddd/named__acl_8c.html#aec23fc5034c3bb08140fc021f4955877">AST_MODULE</a>, .flags = <a class="el" href="../../d5/d16/module_8h.html#a155a0df9c59e04e305d4a2fa3e35f843a835b27a90d895a488e4e14cc3d2dee8c">AST_MODFLAG_GLOBAL_SYMBOLS</a> | <a class="el" href="../../d5/d16/module_8h.html#a155a0df9c59e04e305d4a2fa3e35f843a12c3f60dd7655dfa8d4430cbf04b1223">AST_MODFLAG_LOAD_ORDER</a> , .description = &quot;HTTP WebSocket Support&quot; , .key = &quot;This paragraph is copyright (<a class="el" href="../../d7/d6f/test__linkedlists_8c.html#acd9db00336027462cfb25b97b5356883">c</a>) 2006 by Digium, Inc. \In <a class="el" href="../../d5/d14/voicin_8c.html#aed7ca058008dc3e5ee131e575abed285">order</a> for your module to load, it must return this \key via <a class="el" href="../../d7/d6f/test__linkedlists_8c.html#a13dd15487fee89a002d17ef3aff62d02">a</a> function called \&quot;key\&quot;. Any code which \includes this paragraph must <a class="el" href="../../dd/d7c/eagi__proxy_8c.html#a39730e90126aad69cfc9ca4d6fcdb3a6">be</a> licensed under the GNU \General Public License <a class="el" href="../../da/d7c/utils_2frame_8h.html#a56abfaab87c46691c1ef3ad0df23e864">version</a> 2 or later (at your \option). In addition to Digium's general reservations \of rights, Digium expressly reserves the right to \allow other parties to license this paragraph under \different terms. Any use of Digium, Inc. trademarks or \logos (including \&quot;Asterisk\&quot; or \&quot;Digium\&quot;) without \express written <a class="el" href="../../d4/d4c/structpermission.html">permission</a> of Digium, Inc. is prohibited.\n&quot; , .buildopt_sum = &quot;30ef0c93b36035ec78c9cfd712d36d9b&quot; , .support_level = AST_MODULE_SUPPORT_CORE, .load = load_module, .unload = unload_module, .load_pri = AST_MODPRI_CHANNEL_DEPEND, .requires = &quot;http&quot;, }</td></tr>
<tr class="separator:ab22f32016155f7f403e7178767163d7d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad60e83b9aa660040fed4d5377966cc21"><td class="memItemLeft" align="right" valign="top">static const struct <a class="el" href="../../dd/d5f/structast__module__info.html">ast_module_info</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../de/d4c/res__http__websocket_8c.html#ad60e83b9aa660040fed4d5377966cc21">ast_module_info</a> = &amp;<a class="el" href="../../d6/d7a/test__xml__escape_8c.html#ab22f32016155f7f403e7178767163d7d">__mod_info</a></td></tr>
<tr class="separator:ad60e83b9aa660040fed4d5377966cc21"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af1d68c77bf046bd4cb80e8db01e97f1a"><td class="memItemLeft" align="right" valign="top">static const char *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../de/d4c/res__http__websocket_8c.html#af1d68c77bf046bd4cb80e8db01e97f1a">opcode_map</a> []</td></tr>
<tr class="separator:af1d68c77bf046bd4cb80e8db01e97f1a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a250d189c16de52a67daa3ab480eb8aa1"><td class="memItemLeft" align="right" valign="top">static struct <a class="el" href="../../d0/d6c/structast__http__uri.html">ast_http_uri</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../de/d4c/res__http__websocket_8c.html#a250d189c16de52a67daa3ab480eb8aa1">websocketuri</a></td></tr>
<tr class="separator:a250d189c16de52a67daa3ab480eb8aa1"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>WebSocket support for the Asterisk internal HTTP server. </p>
<dl class="section author"><dt>Author</dt><dd>Joshua Colp <a href="#" onclick="location.href='mai'+'lto:'+'jco'+'lp'+'@di'+'gi'+'um.'+'co'+'m'; return false;">jcolp<span style="display: none;">.nosp@m.</span>@dig<span style="display: none;">.nosp@m.</span>ium.c<span style="display: none;">.nosp@m.</span>om</a> </dd></dl>

<p class="definition">Definition in file <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html">res_http_websocket.c</a>.</p>
</div><h2 class="groupheader">Macro Definition Documentation</h2>
<a id="a805616595a796949ade4a78edc628f99"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a805616595a796949ade4a78edc628f99">&#9670;&nbsp;</a></span>AST_API_MODULE</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define AST_API_MODULE</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html#l00041">41</a> of file <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html">res_http_websocket.c</a>.</p>

</div>
</div>
<a id="aba8a9af0a5e1e29151c407fafd517124"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aba8a9af0a5e1e29151c407fafd517124">&#9670;&nbsp;</a></span>CLIENT_KEY_SIZE</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define CLIENT_KEY_SIZE&#160;&#160;&#160;16</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Length of a websocket's client key. </p>

<p class="definition">Definition at line <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html#l00048">48</a> of file <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html">res_http_websocket.c</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html#l01168">websocket_client_create_key()</a>.</p>

</div>
</div>
<a id="a7f0e6d73d21f7f256f229583f02e58ec"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a7f0e6d73d21f7f256f229583f02e58ec">&#9670;&nbsp;</a></span>DEFAULT_RECONSTRUCTION_CEILING</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define DEFAULT_RECONSTRUCTION_CEILING&#160;&#160;&#160;<a class="el" href="../../de/d4c/res__http__websocket_8c.html#a055ae5efdfd42a3c39b110e43e6a1ff1">MAXIMUM_FRAME_SIZE</a></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Default reconstruction size for multi-frame payload reconstruction. If exceeded the next frame will start a payload. </p>

<p class="definition">Definition at line <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html#l00071">71</a> of file <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html">res_http_websocket.c</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html#l00790">ast_websocket_uri_cb()</a>, and <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html#l01224">websocket_client_create()</a>.</p>

</div>
</div>
<a id="a5be56ede9f12af5da13707860ec9ceb3"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a5be56ede9f12af5da13707860ec9ceb3">&#9670;&nbsp;</a></span>MAX_PROTOCOL_BUCKETS</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define MAX_PROTOCOL_BUCKETS&#160;&#160;&#160;7</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Number of buckets for registered protocols. </p>

<p class="definition">Definition at line <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html#l00051">51</a> of file <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html">res_http_websocket.c</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html#l00143">websocket_server_create_impl()</a>.</p>

</div>
</div>
<a id="a8a855079655422ace22e3763e1150def"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8a855079655422ace22e3763e1150def">&#9670;&nbsp;</a></span>MAX_WS_HDR_SZ</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define MAX_WS_HDR_SZ&#160;&#160;&#160;14</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Maximum size of a websocket frame header 1 byte flags and opcode 1 byte mask flag + payload len 8 bytes max extended length 4 bytes optional masking key ... payload follows ... </p>

<p class="definition">Definition at line <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html#l00084">84</a> of file <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html">res_http_websocket.c</a>.</p>

</div>
</div>
<a id="a055ae5efdfd42a3c39b110e43e6a1ff1"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a055ae5efdfd42a3c39b110e43e6a1ff1">&#9670;&nbsp;</a></span>MAXIMUM_FRAME_SIZE</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define MAXIMUM_FRAME_SIZE&#160;&#160;&#160;65535</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Size of the pre-determined buffer for WebSocket frames. </p>

<p class="definition">Definition at line <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html#l00066">66</a> of file <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html">res_http_websocket.c</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html#l00602">ast_websocket_read()</a>.</p>

</div>
</div>
<a id="afeaf5a5b74a2ae7bcdb585b6d57be576"></a>
<h2 class="memtitle"><span class="permalink"><a href="#afeaf5a5b74a2ae7bcdb585b6d57be576">&#9670;&nbsp;</a></span>MAXIMUM_RECONSTRUCTION_CEILING</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define MAXIMUM_RECONSTRUCTION_CEILING&#160;&#160;&#160;<a class="el" href="../../de/d4c/res__http__websocket_8c.html#a055ae5efdfd42a3c39b110e43e6a1ff1">MAXIMUM_FRAME_SIZE</a></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Maximum reconstruction size for multi-frame payload reconstruction. </p>

<p class="definition">Definition at line <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html#l00074">74</a> of file <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html">res_http_websocket.c</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html#l00441">ast_websocket_reconstruct_enable()</a>.</p>

</div>
</div>
<a id="a2eb05d1858816a59ef4a882df8a1df44"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2eb05d1858816a59ef4a882df8a1df44">&#9670;&nbsp;</a></span>MIN_WS_HDR_SZ</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define MIN_WS_HDR_SZ&#160;&#160;&#160;2</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html#l00085">85</a> of file <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html">res_http_websocket.c</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html#l00602">ast_websocket_read()</a>.</p>

</div>
</div>
<a id="ad17237839833df7be4a5c256801fe51b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad17237839833df7be4a5c256801fe51b">&#9670;&nbsp;</a></span>WEBSOCKET_GUID</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define WEBSOCKET_GUID&#160;&#160;&#160;&quot;258EAFA5-E914-47DA-95CA-C5AB0DC85B11&quot;</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>GUID used to compute the accept key, defined in the specifications. </p>

<p class="definition">Definition at line <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html#l00045">45</a> of file <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html">res_http_websocket.c</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html#l00790">ast_websocket_uri_cb()</a>, and <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html#l00764">websocket_combine_key()</a>.</p>

</div>
</div>
<h2 class="groupheader">Function Documentation</h2>
<a id="a88b7c88fed6b80fd18f34f97757dfc04"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a88b7c88fed6b80fd18f34f97757dfc04">&#9670;&nbsp;</a></span>__reg_module()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void __reg_module </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html#l01529">1529</a> of file <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html">res_http_websocket.c</a>.</p>

</div>
</div>
<a id="afeab1257bd17282b95875499393a147a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#afeab1257bd17282b95875499393a147a">&#9670;&nbsp;</a></span>__unreg_module()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void __unreg_module </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html#l01529">1529</a> of file <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html">res_http_websocket.c</a>.</p>

</div>
</div>
<a id="a4fb0aca9bbcdb9709fa52a70aded6cae"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4fb0aca9bbcdb9709fa52a70aded6cae">&#9670;&nbsp;</a></span>AST_MODULE_SELF_SYM()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="../../d9/df5/structast__module.html">ast_module</a>* AST_MODULE_SELF_SYM </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html#l01529">1529</a> of file <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html">res_http_websocket.c</a>.</p>

</div>
</div>
<a id="a099ab917f200dce4bcb7d0aadb2fb52a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a099ab917f200dce4bcb7d0aadb2fb52a">&#9670;&nbsp;</a></span>ast_websocket_add_protocol()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="../../df/d3c/optional__api_8h.html#abe6ec88934f99eb74444f6c4a92353ec">AST_OPTIONAL_API_NAME</a>() ast_websocket_add_protocol </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>name</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../d0/d0c/http__websocket_8h.html#acc038aba3451ed958627359ea71f156a">ast_websocket_callback</a>&#160;</td>
          <td class="paramname"><em>callback</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html#l01052">1052</a> of file <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html">res_http_websocket.c</a>.</p>

<p class="reference">References <a class="el" href="../../d0/d29/cdr__mysql_8c_source.html#l00074">name</a>, and <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html#l01043">websocket_add_protocol_internal()</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../d5/dfe/chan__sip_8c_source.html#l35495">load_module()</a>, and <a class="el" href="../../d5/dfe/chan__sip_8c_source.html#l32514">reload_config()</a>.</p>
<div class="fragment"><div class="line"><a name="l01053"></a><span class="lineno"> 1053</span>&#160;{</div><div class="line"><a name="l01054"></a><span class="lineno"> 1054</span>&#160;   <span class="keywordflow">return</span> <a class="code" href="../../de/d4c/res__http__websocket_8c.html#aba0a4f6f2ebf4ebff817aeae8d6d690f">websocket_add_protocol_internal</a>(<a class="code" href="../../d0/d29/cdr__mysql_8c.html#a0980a105ccb863d8008eb6201a51da52">name</a>, callback);</div><div class="line"><a name="l01055"></a><span class="lineno"> 1055</span>&#160;}</div><div class="ttc" id="res__http__websocket_8c_html_aba0a4f6f2ebf4ebff817aeae8d6d690f"><div class="ttname"><a href="../../de/d4c/res__http__websocket_8c.html#aba0a4f6f2ebf4ebff817aeae8d6d690f">websocket_add_protocol_internal</a></div><div class="ttdeci">static int websocket_add_protocol_internal(const char *name, ast_websocket_callback callback)</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d4c/res__http__websocket_8c_source.html#l01043">res_http_websocket.c:1043</a></div></div>
<div class="ttc" id="cdr__mysql_8c_html_a0980a105ccb863d8008eb6201a51da52"><div class="ttname"><a href="../../d0/d29/cdr__mysql_8c.html#a0980a105ccb863d8008eb6201a51da52">name</a></div><div class="ttdeci">static const char name[]</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d29/cdr__mysql_8c_source.html#l00074">cdr_mysql.c:74</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="afc5cddd8c4bcded1a738b02c821f405f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#afc5cddd8c4bcded1a738b02c821f405f">&#9670;&nbsp;</a></span>ast_websocket_add_protocol2()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="../../df/d3c/optional__api_8h.html#abe6ec88934f99eb74444f6c4a92353ec">AST_OPTIONAL_API_NAME</a>() ast_websocket_add_protocol2 </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="../../dc/dcf/structast__websocket__protocol.html">ast_websocket_protocol</a> *&#160;</td>
          <td class="paramname"><em>protocol</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html#l01057">1057</a> of file <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html">res_http_websocket.c</a>.</p>

<p class="reference">References <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html#l00232">ast_websocket_server_add_protocol2()</a>, and <a class="el" href="../../dd/d56/http_8h_source.html#l00114">ast_http_uri::data</a>.</p>
<div class="fragment"><div class="line"><a name="l01058"></a><span class="lineno"> 1058</span>&#160;{</div><div class="line"><a name="l01059"></a><span class="lineno"> 1059</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../db/d66/structast__websocket__server.html">ast_websocket_server</a> *ws_server = <a class="code" href="../../de/d4c/res__http__websocket_8c.html#a250d189c16de52a67daa3ab480eb8aa1">websocketuri</a>.<a class="code" href="../../d0/d6c/structast__http__uri.html#a735984d41155bc1032e09bece8f8d66d">data</a>;</div><div class="line"><a name="l01060"></a><span class="lineno"> 1060</span>&#160;</div><div class="line"><a name="l01061"></a><span class="lineno"> 1061</span>&#160;   <span class="keywordflow">if</span> (!ws_server) {</div><div class="line"><a name="l01062"></a><span class="lineno"> 1062</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l01063"></a><span class="lineno"> 1063</span>&#160;   }</div><div class="line"><a name="l01064"></a><span class="lineno"> 1064</span>&#160;</div><div class="line"><a name="l01065"></a><span class="lineno"> 1065</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../de/d4c/res__http__websocket_8c.html#a2568f59be0945091ec1778c0262297ff">ast_websocket_server_add_protocol2</a>(ws_server, protocol)) {</div><div class="line"><a name="l01066"></a><span class="lineno"> 1066</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l01067"></a><span class="lineno"> 1067</span>&#160;   }</div><div class="line"><a name="l01068"></a><span class="lineno"> 1068</span>&#160;</div><div class="line"><a name="l01069"></a><span class="lineno"> 1069</span>&#160;   <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l01070"></a><span class="lineno"> 1070</span>&#160;}</div><div class="ttc" id="structast__websocket__server_html"><div class="ttname"><a href="../../db/d66/structast__websocket__server.html">ast_websocket_server</a></div><div class="ttdoc">Structure for a WebSocket server. </div><div class="ttdef"><b>Definition:</b> <a href="../../de/d4c/res__http__websocket_8c_source.html#l00132">res_http_websocket.c:132</a></div></div>
<div class="ttc" id="res__http__websocket_8c_html_a250d189c16de52a67daa3ab480eb8aa1"><div class="ttname"><a href="../../de/d4c/res__http__websocket_8c.html#a250d189c16de52a67daa3ab480eb8aa1">websocketuri</a></div><div class="ttdeci">static struct ast_http_uri websocketuri</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d4c/res__http__websocket_8c_source.html#l00997">res_http_websocket.c:997</a></div></div>
<div class="ttc" id="res__http__websocket_8c_html_a2568f59be0945091ec1778c0262297ff"><div class="ttname"><a href="../../de/d4c/res__http__websocket_8c.html#a2568f59be0945091ec1778c0262297ff">ast_websocket_server_add_protocol2</a></div><div class="ttdeci">int AST_OPTIONAL_API_NAME() ast_websocket_server_add_protocol2(struct ast_websocket_server *server, struct ast_websocket_protocol *protocol)</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d4c/res__http__websocket_8c_source.html#l00232">res_http_websocket.c:232</a></div></div>
<div class="ttc" id="structast__http__uri_html_a735984d41155bc1032e09bece8f8d66d"><div class="ttname"><a href="../../d0/d6c/structast__http__uri.html#a735984d41155bc1032e09bece8f8d66d">ast_http_uri::data</a></div><div class="ttdeci">void * data</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d56/http_8h_source.html#l00114">http.h:114</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="ac90b53a1487eadb430df0ea19dc3ed3a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac90b53a1487eadb430df0ea19dc3ed3a">&#9670;&nbsp;</a></span>ast_websocket_client_accept_protocol()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">const char* <a class="el" href="../../df/d3c/optional__api_8h.html#abe6ec88934f99eb74444f6c4a92353ec">AST_OPTIONAL_API_NAME</a>() ast_websocket_client_accept_protocol </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="../../db/db6/structast__websocket.html">ast_websocket</a> *&#160;</td>
          <td class="paramname"><em>ws</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html#l01270">1270</a> of file <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html">res_http_websocket.c</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../d0/d0c/http__websocket_8h_source.html#l00437">__stub__ast_websocket_client_create()</a>, and <a class="el" href="../../de/de9/test__websocket__client_8c_source.html#l00116">AST_TEST_DEFINE()</a>.</p>
<div class="fragment"><div class="line"><a name="l01271"></a><span class="lineno"> 1271</span>&#160;{</div><div class="line"><a name="l01272"></a><span class="lineno"> 1272</span>&#160;   <span class="keywordflow">return</span> ws-&gt;<a class="code" href="../../db/db6/structast__websocket.html#a58c585b74d6f77b0a24b7503ddf9d7e2">client</a>-&gt;<a class="code" href="../../d7/de7/structwebsocket__client.html#adae107229ce11e8bdf499a2bb06a4f62">accept_protocol</a>;</div><div class="line"><a name="l01273"></a><span class="lineno"> 1273</span>&#160;}</div><div class="ttc" id="structwebsocket__client_html_adae107229ce11e8bdf499a2bb06a4f62"><div class="ttname"><a href="../../d7/de7/structwebsocket__client.html#adae107229ce11e8bdf499a2bb06a4f62">websocket_client::accept_protocol</a></div><div class="ttdeci">char * accept_protocol</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d4c/res__http__websocket_8c_source.html#l01201">res_http_websocket.c:1201</a></div></div>
<div class="ttc" id="structast__websocket_html_a58c585b74d6f77b0a24b7503ddf9d7e2"><div class="ttname"><a href="../../db/db6/structast__websocket.html#a58c585b74d6f77b0a24b7503ddf9d7e2">ast_websocket::client</a></div><div class="ttdeci">struct websocket_client * client</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d4c/res__http__websocket_8c_source.html#l00100">res_http_websocket.c:100</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a05fa115a5e141d55e01722a1f4d6f698"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a05fa115a5e141d55e01722a1f4d6f698">&#9670;&nbsp;</a></span>ast_websocket_client_create()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="../../db/db6/structast__websocket.html">ast_websocket</a>* <a class="el" href="../../df/d3c/optional__api_8h.html#abe6ec88934f99eb74444f6c4a92353ec">AST_OPTIONAL_API_NAME</a>() ast_websocket_client_create </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>uri</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>protocols</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="../../d5/d90/structast__tls__config.html">ast_tls_config</a> *&#160;</td>
          <td class="paramname"><em>tls_cfg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">enum <a class="el" href="../../d0/d0c/http__websocket_8h.html#a6341c1b69564f8a3342229c5102b0fe2">ast_websocket_result</a> *&#160;</td>
          <td class="paramname"><em>result</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html#l01421">1421</a> of file <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html">res_http_websocket.c</a>.</p>

<p class="reference">References <a class="el" href="../../d5/da5/astobj2_8h_source.html#l00464">ao2_ref</a>, <a class="el" href="../../df/d3c/optional__api_8h_source.html#l00228">AST_OPTIONAL_API_NAME</a>, <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html#l01440">ast_websocket_read_string()</a>, <a class="el" href="../../dc/d7f/resample_8c_source.html#l00096">NULL</a>, <a class="el" href="../../de/d1b/cel__pgsql_8c_source.html#l00088">result</a>, <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html#l01397">websocket_client_connect()</a>, <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html#l01224">websocket_client_create()</a>, and <a class="el" href="../../d0/d0c/http__websocket_8h_source.html#l00397">WS_OK</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../de/de9/test__websocket__client_8c_source.html#l00044">AST_TEST_DEFINE()</a>, and <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html#l01397">websocket_client_connect()</a>.</p>
<div class="fragment"><div class="line"><a name="l01423"></a><span class="lineno"> 1423</span>&#160;{</div><div class="line"><a name="l01424"></a><span class="lineno"> 1424</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../db/db6/structast__websocket.html">ast_websocket</a> *ws = <a class="code" href="../../de/d4c/res__http__websocket_8c.html#a732e919813a7f9bf5d6cada291ad589c">websocket_client_create</a>(</div><div class="line"><a name="l01425"></a><span class="lineno"> 1425</span>&#160;      uri, protocols, tls_cfg, <a class="code" href="../../de/d1b/cel__pgsql_8c.html#ad6c487210772a9b4b0ca04b04b847d4c">result</a>);</div><div class="line"><a name="l01426"></a><span class="lineno"> 1426</span>&#160;</div><div class="line"><a name="l01427"></a><span class="lineno"> 1427</span>&#160;   <span class="keywordflow">if</span> (!ws) {</div><div class="line"><a name="l01428"></a><span class="lineno"> 1428</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l01429"></a><span class="lineno"> 1429</span>&#160;   }</div><div class="line"><a name="l01430"></a><span class="lineno"> 1430</span>&#160;</div><div class="line"><a name="l01431"></a><span class="lineno"> 1431</span>&#160;   <span class="keywordflow">if</span> ((*<a class="code" href="../../de/d1b/cel__pgsql_8c.html#ad6c487210772a9b4b0ca04b04b847d4c">result</a> = <a class="code" href="../../de/d4c/res__http__websocket_8c.html#ae6b78ddeb7585dc4c2d42b8de58ab7f9">websocket_client_connect</a>(ws)) != <a class="code" href="../../d0/d0c/http__websocket_8h.html#a6341c1b69564f8a3342229c5102b0fe2a8d6c24a81bab48a188c7f458bf6ecddb">WS_OK</a>) {</div><div class="line"><a name="l01432"></a><span class="lineno"> 1432</span>&#160;      <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(ws, -1);</div><div class="line"><a name="l01433"></a><span class="lineno"> 1433</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l01434"></a><span class="lineno"> 1434</span>&#160;   }</div><div class="line"><a name="l01435"></a><span class="lineno"> 1435</span>&#160;</div><div class="line"><a name="l01436"></a><span class="lineno"> 1436</span>&#160;   <span class="keywordflow">return</span> ws;</div><div class="line"><a name="l01437"></a><span class="lineno"> 1437</span>&#160;}</div><div class="ttc" id="resample_8c_html_a070d2ce7b6bb7e5c05602aa8c308d0c4"><div class="ttname"><a href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a></div><div class="ttdeci">#define NULL</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d7f/resample_8c_source.html#l00096">resample.c:96</a></div></div>
<div class="ttc" id="res__http__websocket_8c_html_ae6b78ddeb7585dc4c2d42b8de58ab7f9"><div class="ttname"><a href="../../de/d4c/res__http__websocket_8c.html#ae6b78ddeb7585dc4c2d42b8de58ab7f9">websocket_client_connect</a></div><div class="ttdeci">static enum ast_websocket_result websocket_client_connect(struct ast_websocket *ws)</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d4c/res__http__websocket_8c_source.html#l01397">res_http_websocket.c:1397</a></div></div>
<div class="ttc" id="res__http__websocket_8c_html_a732e919813a7f9bf5d6cada291ad589c"><div class="ttname"><a href="../../de/d4c/res__http__websocket_8c.html#a732e919813a7f9bf5d6cada291ad589c">websocket_client_create</a></div><div class="ttdeci">static struct ast_websocket * websocket_client_create(const char *uri, const char *protocols, struct ast_tls_config *tls_cfg, enum ast_websocket_result *result)</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d4c/res__http__websocket_8c_source.html#l01224">res_http_websocket.c:1224</a></div></div>
<div class="ttc" id="astobj2_8h_html_aaca5e8eac39a22f9da1c36fc6c922270"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a></div><div class="ttdeci">#define ao2_ref(o, delta)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l00464">astobj2.h:464</a></div></div>
<div class="ttc" id="structast__websocket_html"><div class="ttname"><a href="../../db/db6/structast__websocket.html">ast_websocket</a></div><div class="ttdoc">Structure definition for session. </div><div class="ttdef"><b>Definition:</b> <a href="../../de/d4c/res__http__websocket_8c_source.html#l00088">res_http_websocket.c:88</a></div></div>
<div class="ttc" id="http__websocket_8h_html_a6341c1b69564f8a3342229c5102b0fe2a8d6c24a81bab48a188c7f458bf6ecddb"><div class="ttname"><a href="../../d0/d0c/http__websocket_8h.html#a6341c1b69564f8a3342229c5102b0fe2a8d6c24a81bab48a188c7f458bf6ecddb">WS_OK</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d0c/http__websocket_8h_source.html#l00397">http_websocket.h:397</a></div></div>
<div class="ttc" id="cel__pgsql_8c_html_ad6c487210772a9b4b0ca04b04b847d4c"><div class="ttname"><a href="../../de/d1b/cel__pgsql_8c.html#ad6c487210772a9b4b0ca04b04b847d4c">result</a></div><div class="ttdeci">static PGresult * result</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d1b/cel__pgsql_8c_source.html#l00088">cel_pgsql.c:88</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="ae4851ff13b6e90c8b88d5717465644ea"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae4851ff13b6e90c8b88d5717465644ea">&#9670;&nbsp;</a></span>ast_websocket_close()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="../../df/d3c/optional__api_8h.html#abe6ec88934f99eb74444f6c4a92353ec">AST_OPTIONAL_API_NAME</a>() ast_websocket_close </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="../../db/db6/structast__websocket.html">ast_websocket</a> *&#160;</td>
          <td class="paramname"><em>session</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint16_t&#160;</td>
          <td class="paramname"><em>reason</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Close function for websocket session. </p>

<p class="definition">Definition at line <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html#l00308">308</a> of file <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html">res_http_websocket.c</a>.</p>

<p class="reference">References <a class="el" href="../../d5/da5/astobj2_8h_source.html#l00718">ao2_lock</a>, <a class="el" href="../../d5/da5/astobj2_8h_source.html#l00730">ao2_unlock</a>, <a class="el" href="../../d1/dc8/iostream_8c_source.html#l00528">ast_iostream_close()</a>, <a class="el" href="../../d1/dc8/iostream_8c_source.html#l00113">ast_iostream_set_timeout_disable()</a>, <a class="el" href="../../d1/dc8/iostream_8c_source.html#l00121">ast_iostream_set_timeout_inactivity()</a>, <a class="el" href="../../d1/dc8/iostream_8c_source.html#l00374">ast_iostream_write()</a>, <a class="el" href="../../db/df1/netsock2_8h_source.html#l00260">ast_sockaddr_stringify()</a>, <a class="el" href="../../d1/d8c/logger_8h_source.html#l00463">ast_verb</a>, <a class="el" href="../../d0/d0c/http__websocket_8h_source.html#l00055">AST_WEBSOCKET_OPCODE_CLOSE</a>, <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html#l00100">ast_websocket::client</a>, <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html#l00099">ast_websocket::close_sent</a>, <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html#l00098">ast_websocket::closing</a>, <a class="el" href="../../dc/d7f/resample_8c_source.html#l00096">NULL</a>, <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html#l00092">ast_websocket::opcode</a>, <a class="el" href="../../d2/d1e/unaligned_8h_source.html#l00065">put_unaligned_uint16()</a>, <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html#l00090">ast_websocket::remote_address</a>, <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html#l00089">ast_websocket::stream</a>, <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html#l00096">ast_websocket::timeout</a>, and <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html#l00288">websocket_mask_payload()</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html#l00602">ast_websocket_read()</a>, <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html#l00374">ast_websocket_write()</a>, <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html#l00173">session_destroy_fn()</a>, and <a class="el" href="../../d2/db8/res__pjsip__transport__websocket_8c_source.html#l00085">ws_destroy()</a>.</p>
<div class="fragment"><div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;{</div><div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;   <span class="keyword">enum</span> <a class="code" href="../../d0/d0c/http__websocket_8h.html#a8cb89d2edeb737bfc4efb15902cd19bc">ast_websocket_opcode</a> <a class="code" href="../../db/db6/structast__websocket.html#ac717220c65cf5cf274dc30d3af6f1ded">opcode</a> = <a class="code" href="../../d0/d0c/http__websocket_8h.html#a8cb89d2edeb737bfc4efb15902cd19bcacd58d1ec65c0e9e407972667603697af">AST_WEBSOCKET_OPCODE_CLOSE</a>;</div><div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;   <span class="comment">/* The header is either 2 or 6 bytes and the</span></div><div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;<span class="comment">    * reason code takes up another 2 bytes */</span></div><div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;   <span class="keywordtype">char</span> frame[8] = { 0, };</div><div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;   <span class="keywordtype">int</span> header_size, fsize, res;</div><div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;</div><div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;   <span class="keywordflow">if</span> (session-&gt;<a class="code" href="../../db/db6/structast__websocket.html#a09777cb315c399de85d3befe37e0276e">close_sent</a>) {</div><div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;      <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;   }</div><div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;</div><div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;   <span class="comment">/* clients need space for an additional 4 byte masking key */</span></div><div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;   header_size = session-&gt;<a class="code" href="../../db/db6/structast__websocket.html#a58c585b74d6f77b0a24b7503ddf9d7e2">client</a> ? 6 : 2;</div><div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;   fsize = header_size + 2;</div><div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;</div><div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;   frame[0] = opcode | 0x80;</div><div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;   frame[1] = 2; <span class="comment">/* The reason code is always 2 bytes */</span></div><div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;</div><div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;   <span class="comment">/* If no reason has been specified assume 1000 which is normal closure */</span></div><div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;   <a class="code" href="../../d2/d1e/unaligned_8h.html#a31285bcf21169ef487fa4431931b38d2">put_unaligned_uint16</a>(&amp;frame[header_size], htons(reason ? reason : 1000));</div><div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;</div><div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;   <a class="code" href="../../de/d4c/res__http__websocket_8c.html#a724a006e8f51c16953462608c1eb6fcd">websocket_mask_payload</a>(session, frame, &amp;frame[header_size], 2);</div><div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;</div><div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;   session-&gt;<a class="code" href="../../db/db6/structast__websocket.html#aa71fe3535b288c6e8f4e7f811b65fc3c">closing</a> = 1;</div><div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;   session-&gt;<a class="code" href="../../db/db6/structast__websocket.html#a09777cb315c399de85d3befe37e0276e">close_sent</a> = 1;</div><div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;</div><div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#aa9fdb5d0a6157a56060d9f7279fe6c49">ao2_lock</a>(session);</div><div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;   <a class="code" href="../../dd/d27/iostream_8h.html#a385d6e715173db6bc4b703afc05f45df">ast_iostream_set_timeout_inactivity</a>(session-&gt;<a class="code" href="../../db/db6/structast__websocket.html#a36ac2dd734607a43ed90acb7e9d81ac5">stream</a>, session-&gt;<a class="code" href="../../db/db6/structast__websocket.html#a493b57f443cc38b3d3df9c1e584d9d82">timeout</a>);</div><div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;   res = <a class="code" href="../../dd/d27/iostream_8h.html#a6e0bf2afcbc5b330b96378626f9ac5b3">ast_iostream_write</a>(session-&gt;<a class="code" href="../../db/db6/structast__websocket.html#a36ac2dd734607a43ed90acb7e9d81ac5">stream</a>, frame, fsize);</div><div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;   <a class="code" href="../../dd/d27/iostream_8h.html#ace332a00f395eb7d1c93d0ee00bdf6c2">ast_iostream_set_timeout_disable</a>(session-&gt;<a class="code" href="../../db/db6/structast__websocket.html#a36ac2dd734607a43ed90acb7e9d81ac5">stream</a>);</div><div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;</div><div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;   <span class="comment">/* If an error occurred when trying to close this connection explicitly terminate it now.</span></div><div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;<span class="comment">    * Doing so will cause the thread polling on it to wake up and terminate.</span></div><div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;<span class="comment">    */</span></div><div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;   <span class="keywordflow">if</span> (res != fsize) {</div><div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;      <a class="code" href="../../dd/d27/iostream_8h.html#ac0297067e6921ce6a2c5f3b3d0647d3a">ast_iostream_close</a>(session-&gt;<a class="code" href="../../db/db6/structast__websocket.html#a36ac2dd734607a43ed90acb7e9d81ac5">stream</a>);</div><div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;      session-&gt;<a class="code" href="../../db/db6/structast__websocket.html#a36ac2dd734607a43ed90acb7e9d81ac5">stream</a> = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;      <a class="code" href="../../d1/d8c/logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(2, <span class="stringliteral">&quot;WebSocket connection %s &#39;%s&#39; forcefully closed due to fatal write error\n&quot;</span>,</div><div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;         session-&gt;<a class="code" href="../../db/db6/structast__websocket.html#a58c585b74d6f77b0a24b7503ddf9d7e2">client</a> ? <span class="stringliteral">&quot;to&quot;</span> : <span class="stringliteral">&quot;from&quot;</span>, <a class="code" href="../../db/df1/netsock2_8h.html#aae9156c7fe6dff51463f29ed1c3b96c9">ast_sockaddr_stringify</a>(&amp;session-&gt;<a class="code" href="../../db/db6/structast__websocket.html#a9dfcf41ffc851689eea95be7bb1f849a">remote_address</a>));</div><div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;   }</div><div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;</div><div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#a9998bd156b936636a8780385e9a910b2">ao2_unlock</a>(session);</div><div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;   <span class="keywordflow">return</span> res == <span class="keyword">sizeof</span>(frame);</div><div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;}</div><div class="ttc" id="iostream_8h_html_a6e0bf2afcbc5b330b96378626f9ac5b3"><div class="ttname"><a href="../../dd/d27/iostream_8h.html#a6e0bf2afcbc5b330b96378626f9ac5b3">ast_iostream_write</a></div><div class="ttdeci">ssize_t ast_iostream_write(struct ast_iostream *stream, const void *buffer, size_t count)</div><div class="ttdoc">Write data to an iostream. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/dc8/iostream_8c_source.html#l00374">iostream.c:374</a></div></div>
<div class="ttc" id="unaligned_8h_html_a31285bcf21169ef487fa4431931b38d2"><div class="ttname"><a href="../../d2/d1e/unaligned_8h.html#a31285bcf21169ef487fa4431931b38d2">put_unaligned_uint16</a></div><div class="ttdeci">static void put_unaligned_uint16(void *p, unsigned short datum)</div><div class="ttdef"><b>Definition:</b> <a href="../../d2/d1e/unaligned_8h_source.html#l00065">unaligned.h:65</a></div></div>
<div class="ttc" id="iostream_8h_html_a385d6e715173db6bc4b703afc05f45df"><div class="ttname"><a href="../../dd/d27/iostream_8h.html#a385d6e715173db6bc4b703afc05f45df">ast_iostream_set_timeout_inactivity</a></div><div class="ttdeci">void ast_iostream_set_timeout_inactivity(struct ast_iostream *stream, int timeout)</div><div class="ttdoc">Set the iostream inactivity timeout timer. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/dc8/iostream_8c_source.html#l00121">iostream.c:121</a></div></div>
<div class="ttc" id="astobj2_8h_html_a9998bd156b936636a8780385e9a910b2"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#a9998bd156b936636a8780385e9a910b2">ao2_unlock</a></div><div class="ttdeci">#define ao2_unlock(a)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l00730">astobj2.h:730</a></div></div>
<div class="ttc" id="structast__websocket_html_a09777cb315c399de85d3befe37e0276e"><div class="ttname"><a href="../../db/db6/structast__websocket.html#a09777cb315c399de85d3befe37e0276e">ast_websocket::close_sent</a></div><div class="ttdeci">unsigned int close_sent</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d4c/res__http__websocket_8c_source.html#l00099">res_http_websocket.c:99</a></div></div>
<div class="ttc" id="resample_8c_html_a070d2ce7b6bb7e5c05602aa8c308d0c4"><div class="ttname"><a href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a></div><div class="ttdeci">#define NULL</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d7f/resample_8c_source.html#l00096">resample.c:96</a></div></div>
<div class="ttc" id="logger_8h_html_ad770f83c71e237e1f64163358ce4e13d"><div class="ttname"><a href="../../d1/d8c/logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a></div><div class="ttdeci">#define ast_verb(level,...)</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d8c/logger_8h_source.html#l00463">logger.h:463</a></div></div>
<div class="ttc" id="http__websocket_8h_html_a8cb89d2edeb737bfc4efb15902cd19bcacd58d1ec65c0e9e407972667603697af"><div class="ttname"><a href="../../d0/d0c/http__websocket_8h.html#a8cb89d2edeb737bfc4efb15902cd19bcacd58d1ec65c0e9e407972667603697af">AST_WEBSOCKET_OPCODE_CLOSE</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d0c/http__websocket_8h_source.html#l00055">http_websocket.h:55</a></div></div>
<div class="ttc" id="structast__websocket_html_ac717220c65cf5cf274dc30d3af6f1ded"><div class="ttname"><a href="../../db/db6/structast__websocket.html#ac717220c65cf5cf274dc30d3af6f1ded">ast_websocket::opcode</a></div><div class="ttdeci">enum ast_websocket_opcode opcode</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d4c/res__http__websocket_8c_source.html#l00092">res_http_websocket.c:92</a></div></div>
<div class="ttc" id="iostream_8h_html_ac0297067e6921ce6a2c5f3b3d0647d3a"><div class="ttname"><a href="../../dd/d27/iostream_8h.html#ac0297067e6921ce6a2c5f3b3d0647d3a">ast_iostream_close</a></div><div class="ttdeci">int ast_iostream_close(struct ast_iostream *stream)</div><div class="ttdoc">Close an iostream. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/dc8/iostream_8c_source.html#l00528">iostream.c:528</a></div></div>
<div class="ttc" id="astobj2_8h_html_aa9fdb5d0a6157a56060d9f7279fe6c49"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#aa9fdb5d0a6157a56060d9f7279fe6c49">ao2_lock</a></div><div class="ttdeci">#define ao2_lock(a)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l00718">astobj2.h:718</a></div></div>
<div class="ttc" id="structast__websocket_html_a58c585b74d6f77b0a24b7503ddf9d7e2"><div class="ttname"><a href="../../db/db6/structast__websocket.html#a58c585b74d6f77b0a24b7503ddf9d7e2">ast_websocket::client</a></div><div class="ttdeci">struct websocket_client * client</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d4c/res__http__websocket_8c_source.html#l00100">res_http_websocket.c:100</a></div></div>
<div class="ttc" id="res__http__websocket_8c_html_a724a006e8f51c16953462608c1eb6fcd"><div class="ttname"><a href="../../de/d4c/res__http__websocket_8c.html#a724a006e8f51c16953462608c1eb6fcd">websocket_mask_payload</a></div><div class="ttdeci">static void websocket_mask_payload(struct ast_websocket *session, char *frame, char *payload, uint64_t payload_size)</div><div class="ttdoc">Perform payload masking for client sessions. </div><div class="ttdef"><b>Definition:</b> <a href="../../de/d4c/res__http__websocket_8c_source.html#l00288">res_http_websocket.c:288</a></div></div>
<div class="ttc" id="iostream_8h_html_ace332a00f395eb7d1c93d0ee00bdf6c2"><div class="ttname"><a href="../../dd/d27/iostream_8h.html#ace332a00f395eb7d1c93d0ee00bdf6c2">ast_iostream_set_timeout_disable</a></div><div class="ttdeci">void ast_iostream_set_timeout_disable(struct ast_iostream *stream)</div><div class="ttdoc">Disable the iostream timeout timer. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/dc8/iostream_8c_source.html#l00113">iostream.c:113</a></div></div>
<div class="ttc" id="netsock2_8h_html_aae9156c7fe6dff51463f29ed1c3b96c9"><div class="ttname"><a href="../../db/df1/netsock2_8h.html#aae9156c7fe6dff51463f29ed1c3b96c9">ast_sockaddr_stringify</a></div><div class="ttdeci">static char * ast_sockaddr_stringify(const struct ast_sockaddr *addr)</div><div class="ttdoc">Wrapper around ast_sockaddr_stringify_fmt() with default format. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/df1/netsock2_8h_source.html#l00260">netsock2.h:260</a></div></div>
<div class="ttc" id="structast__websocket_html_aa71fe3535b288c6e8f4e7f811b65fc3c"><div class="ttname"><a href="../../db/db6/structast__websocket.html#aa71fe3535b288c6e8f4e7f811b65fc3c">ast_websocket::closing</a></div><div class="ttdeci">unsigned int closing</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d4c/res__http__websocket_8c_source.html#l00098">res_http_websocket.c:98</a></div></div>
<div class="ttc" id="structast__websocket_html_a9dfcf41ffc851689eea95be7bb1f849a"><div class="ttname"><a href="../../db/db6/structast__websocket.html#a9dfcf41ffc851689eea95be7bb1f849a">ast_websocket::remote_address</a></div><div class="ttdeci">struct ast_sockaddr remote_address</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d4c/res__http__websocket_8c_source.html#l00090">res_http_websocket.c:90</a></div></div>
<div class="ttc" id="structast__websocket_html_a36ac2dd734607a43ed90acb7e9d81ac5"><div class="ttname"><a href="../../db/db6/structast__websocket.html#a36ac2dd734607a43ed90acb7e9d81ac5">ast_websocket::stream</a></div><div class="ttdeci">struct ast_iostream * stream</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d4c/res__http__websocket_8c_source.html#l00089">res_http_websocket.c:89</a></div></div>
<div class="ttc" id="http__websocket_8h_html_a8cb89d2edeb737bfc4efb15902cd19bc"><div class="ttname"><a href="../../d0/d0c/http__websocket_8h.html#a8cb89d2edeb737bfc4efb15902cd19bc">ast_websocket_opcode</a></div><div class="ttdeci">ast_websocket_opcode</div><div class="ttdoc">WebSocket operation codes. </div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d0c/http__websocket_8h_source.html#l00050">http_websocket.h:50</a></div></div>
<div class="ttc" id="structast__websocket_html_a493b57f443cc38b3d3df9c1e584d9d82"><div class="ttname"><a href="../../db/db6/structast__websocket.html#a493b57f443cc38b3d3df9c1e584d9d82">ast_websocket::timeout</a></div><div class="ttdeci">int timeout</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d4c/res__http__websocket_8c_source.html#l00096">res_http_websocket.c:96</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a874ca6ebfa7b35e92557cc97af1d41be"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a874ca6ebfa7b35e92557cc97af1d41be">&#9670;&nbsp;</a></span>ast_websocket_fd()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="../../df/d3c/optional__api_8h.html#abe6ec88934f99eb74444f6c4a92353ec">AST_OPTIONAL_API_NAME</a>() ast_websocket_fd </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="../../db/db6/structast__websocket.html">ast_websocket</a> *&#160;</td>
          <td class="paramname"><em>session</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html#l00461">461</a> of file <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html">res_http_websocket.c</a>.</p>

<p class="reference">References <a class="el" href="../../d1/dc8/iostream_8c_source.html#l00084">ast_iostream_get_fd()</a>, <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html#l00098">ast_websocket::closing</a>, and <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html#l00089">ast_websocket::stream</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../d8/d44/ari__websockets_8c_source.html#l00097">ast_ari_websocket_session_read()</a>, <a class="el" href="../../d5/dfe/chan__sip_8c_source.html#l29578">sip_prepare_socket()</a>, <a class="el" href="../../d5/dfe/chan__sip_8c_source.html#l02678">sip_websocket_callback()</a>, <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html#l01007">websocket_echo_callback()</a>, and <a class="el" href="../../d2/db8/res__pjsip__transport__websocket_8c_source.html#l00085">ws_destroy()</a>.</p>
<div class="fragment"><div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;{</div><div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;   <span class="keywordflow">return</span> session-&gt;<a class="code" href="../../db/db6/structast__websocket.html#aa71fe3535b288c6e8f4e7f811b65fc3c">closing</a> ? -1 : <a class="code" href="../../dd/d27/iostream_8h.html#a6ebb2730257107d3535fe6cb1285f479">ast_iostream_get_fd</a>(session-&gt;<a class="code" href="../../db/db6/structast__websocket.html#a36ac2dd734607a43ed90acb7e9d81ac5">stream</a>);</div><div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;}</div><div class="ttc" id="iostream_8h_html_a6ebb2730257107d3535fe6cb1285f479"><div class="ttname"><a href="../../dd/d27/iostream_8h.html#a6ebb2730257107d3535fe6cb1285f479">ast_iostream_get_fd</a></div><div class="ttdeci">int ast_iostream_get_fd(struct ast_iostream *stream)</div><div class="ttdoc">Get an iostream&amp;#39;s file descriptor. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/dc8/iostream_8c_source.html#l00084">iostream.c:84</a></div></div>
<div class="ttc" id="structast__websocket_html_aa71fe3535b288c6e8f4e7f811b65fc3c"><div class="ttname"><a href="../../db/db6/structast__websocket.html#aa71fe3535b288c6e8f4e7f811b65fc3c">ast_websocket::closing</a></div><div class="ttdeci">unsigned int closing</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d4c/res__http__websocket_8c_source.html#l00098">res_http_websocket.c:98</a></div></div>
<div class="ttc" id="structast__websocket_html_a36ac2dd734607a43ed90acb7e9d81ac5"><div class="ttname"><a href="../../db/db6/structast__websocket.html#a36ac2dd734607a43ed90acb7e9d81ac5">ast_websocket::stream</a></div><div class="ttdeci">struct ast_iostream * stream</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d4c/res__http__websocket_8c_source.html#l00089">res_http_websocket.c:89</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a638aea4c786e326ded80afaecb09745c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a638aea4c786e326ded80afaecb09745c">&#9670;&nbsp;</a></span>ast_websocket_is_secure()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="../../df/d3c/optional__api_8h.html#abe6ec88934f99eb74444f6c4a92353ec">AST_OPTIONAL_API_NAME</a>() ast_websocket_is_secure </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="../../db/db6/structast__websocket.html">ast_websocket</a> *&#160;</td>
          <td class="paramname"><em>session</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html#l00481">481</a> of file <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html">res_http_websocket.c</a>.</p>

<p class="reference">References <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html#l00097">ast_websocket::secure</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../d5/dfe/chan__sip_8c_source.html#l02678">sip_websocket_callback()</a>, and <a class="el" href="../../d2/db8/res__pjsip__transport__websocket_8c_source.html#l00149">transport_create()</a>.</p>
<div class="fragment"><div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;{</div><div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;   <span class="keywordflow">return</span> session-&gt;<a class="code" href="../../db/db6/structast__websocket.html#abba77e678a34722d786f3faa53262f75">secure</a>;</div><div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;}</div><div class="ttc" id="structast__websocket_html_abba77e678a34722d786f3faa53262f75"><div class="ttname"><a href="../../db/db6/structast__websocket.html#abba77e678a34722d786f3faa53262f75">ast_websocket::secure</a></div><div class="ttdeci">unsigned int secure</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d4c/res__http__websocket_8c_source.html#l00097">res_http_websocket.c:97</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a9e80e75c690108f7466085cf3f956244"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a9e80e75c690108f7466085cf3f956244">&#9670;&nbsp;</a></span>ast_websocket_local_address()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="../../d3/db3/structast__sockaddr.html">ast_sockaddr</a>* <a class="el" href="../../df/d3c/optional__api_8h.html#abe6ec88934f99eb74444f6c4a92353ec">AST_OPTIONAL_API_NAME</a>() ast_websocket_local_address </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="../../db/db6/structast__websocket.html">ast_websocket</a> *&#160;</td>
          <td class="paramname"><em>session</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html#l00476">476</a> of file <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html">res_http_websocket.c</a>.</p>

<p class="reference">References <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html#l00091">ast_websocket::local_address</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../d2/db8/res__pjsip__transport__websocket_8c_source.html#l00149">transport_create()</a>.</p>
<div class="fragment"><div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;{</div><div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;   <span class="keywordflow">return</span> &amp;session-&gt;<a class="code" href="../../db/db6/structast__websocket.html#a6652499b3aff8f317d4c6d1a36c6c740">local_address</a>;</div><div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;}</div><div class="ttc" id="structast__websocket_html_a6652499b3aff8f317d4c6d1a36c6c740"><div class="ttname"><a href="../../db/db6/structast__websocket.html#a6652499b3aff8f317d4c6d1a36c6c740">ast_websocket::local_address</a></div><div class="ttdeci">struct ast_sockaddr local_address</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d4c/res__http__websocket_8c_source.html#l00091">res_http_websocket.c:91</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="ae16416016e8876c9dc2bd937278dcc4e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae16416016e8876c9dc2bd937278dcc4e">&#9670;&nbsp;</a></span>ast_websocket_read()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="../../df/d3c/optional__api_8h.html#abe6ec88934f99eb74444f6c4a92353ec">AST_OPTIONAL_API_NAME</a>() ast_websocket_read </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="../../db/db6/structast__websocket.html">ast_websocket</a> *&#160;</td>
          <td class="paramname"><em>session</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char **&#160;</td>
          <td class="paramname"><em>payload</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint64_t *&#160;</td>
          <td class="paramname"><em>payload_len</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">enum <a class="el" href="../../d0/d0c/http__websocket_8h.html#a8cb89d2edeb737bfc4efb15902cd19bc">ast_websocket_opcode</a> *&#160;</td>
          <td class="paramname"><em>opcode</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int *&#160;</td>
          <td class="paramname"><em>fragmented</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html#l00602">602</a> of file <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html">res_http_websocket.c</a>.</p>

<p class="reference">References <a class="el" href="../../d8/d8a/astmm_8h_source.html#l00182">ast_free</a>, <a class="el" href="../../da/df7/astobj2_8c_source.html#l00042">ast_log</a>, <a class="el" href="../../d8/d8a/astmm_8h_source.html#l00228">ast_realloc</a>, <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html#l00308">ast_websocket_close()</a>, <a class="el" href="../../d0/d0c/http__websocket_8h_source.html#l00052">AST_WEBSOCKET_OPCODE_BINARY</a>, <a class="el" href="../../d0/d0c/http__websocket_8h_source.html#l00055">AST_WEBSOCKET_OPCODE_CLOSE</a>, <a class="el" href="../../d0/d0c/http__websocket_8h_source.html#l00056">AST_WEBSOCKET_OPCODE_CONTINUATION</a>, <a class="el" href="../../d0/d0c/http__websocket_8h_source.html#l00053">AST_WEBSOCKET_OPCODE_PING</a>, <a class="el" href="../../d0/d0c/http__websocket_8h_source.html#l00054">AST_WEBSOCKET_OPCODE_PONG</a>, <a class="el" href="../../d0/d0c/http__websocket_8h_source.html#l00051">AST_WEBSOCKET_OPCODE_TEXT</a>, <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html#l00374">ast_websocket_write()</a>, <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html#l00103">ast_websocket::buf</a>, <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html#l00102">ast_websocket::close_status_code</a>, <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html#l00098">ast_websocket::closing</a>, <a class="el" href="../../d2/d97/format__g726_8c_source.html#l00052">frame_size</a>, <a class="el" href="../../d2/d1e/unaligned_8h_source.html#l00044">get_unaligned_uint16()</a>, <a class="el" href="../../d2/d1e/unaligned_8h_source.html#l00032">get_unaligned_uint64()</a>, <a class="el" href="../../d1/d8c/logger_8h_source.html#l00274">LOG_WARNING</a>, <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html#l00066">MAXIMUM_FRAME_SIZE</a>, <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html#l00085">MIN_WS_HDR_SZ</a>, <a class="el" href="../../d8/d1e/strcompat_8c_source.html#l00364">ntohll()</a>, <a class="el" href="../../dc/d7f/resample_8c_source.html#l00096">NULL</a>, <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html#l00092">ast_websocket::opcode</a>, <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html#l00094">ast_websocket::payload</a>, <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html#l00093">ast_websocket::payload_len</a>, <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html#l00095">ast_websocket::reconstruct</a>, and <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html#l00534">ws_safe_read()</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../d8/d44/ari__websockets_8c_source.html#l00097">ast_ari_websocket_session_read()</a>, <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html#l01440">ast_websocket_read_string()</a>, <a class="el" href="../../d5/dfe/chan__sip_8c_source.html#l02678">sip_websocket_callback()</a>, <a class="el" href="../../d2/db8/res__pjsip__transport__websocket_8c_source.html#l00360">websocket_cb()</a>, and <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html#l01007">websocket_echo_callback()</a>.</p>
<div class="fragment"><div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;{</div><div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;   <span class="keywordtype">int</span> fin = 0;</div><div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;   <span class="keywordtype">int</span> mask_present = 0;</div><div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;   <span class="keywordtype">char</span> *mask = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, *new_payload = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;   <span class="keywordtype">size_t</span> options_len = 0, <a class="code" href="../../d2/d97/format__g726_8c.html#ab9b9df9925ea7c54e551aa412bf0c59c">frame_size</a> = 0;</div><div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;</div><div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;   *<a class="code" href="../../db/db6/structast__websocket.html#a18f141cb2726073503afb9f1d6c85efb">payload</a> = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;   *<a class="code" href="../../db/db6/structast__websocket.html#a8149fce4e72dd1aac637ccd553996344">payload_len</a> = 0;</div><div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;   *fragmented = 0;</div><div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;</div><div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../de/d4c/res__http__websocket_8c.html#a32088fabfd3e38aa97358a8833d59850">ws_safe_read</a>(session, &amp;session-&gt;<a class="code" href="../../db/db6/structast__websocket.html#a073c52736110f5131b461d3adbef00e9">buf</a>[0], <a class="code" href="../../de/d4c/res__http__websocket_8c.html#a2eb05d1858816a59ef4a882df8a1df44">MIN_WS_HDR_SZ</a>, <a class="code" href="../../db/db6/structast__websocket.html#ac717220c65cf5cf274dc30d3af6f1ded">opcode</a>)) {</div><div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;   }</div><div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;   <a class="code" href="../../d2/d97/format__g726_8c.html#ab9b9df9925ea7c54e551aa412bf0c59c">frame_size</a> += <a class="code" href="../../de/d4c/res__http__websocket_8c.html#a2eb05d1858816a59ef4a882df8a1df44">MIN_WS_HDR_SZ</a>;</div><div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160;</div><div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160;   <span class="comment">/* ok, now we have the first 2 bytes, so we know some flags, opcode and payload length (or whether payload length extension will be required) */</span></div><div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160;   *<a class="code" href="../../db/db6/structast__websocket.html#ac717220c65cf5cf274dc30d3af6f1ded">opcode</a> = session-&gt;<a class="code" href="../../db/db6/structast__websocket.html#a073c52736110f5131b461d3adbef00e9">buf</a>[0] &amp; 0xf;</div><div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160;   *<a class="code" href="../../db/db6/structast__websocket.html#a8149fce4e72dd1aac637ccd553996344">payload_len</a> = session-&gt;<a class="code" href="../../db/db6/structast__websocket.html#a073c52736110f5131b461d3adbef00e9">buf</a>[1] &amp; 0x7f;</div><div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;   <span class="keywordflow">if</span> (*<a class="code" href="../../db/db6/structast__websocket.html#ac717220c65cf5cf274dc30d3af6f1ded">opcode</a> == <a class="code" href="../../d0/d0c/http__websocket_8h.html#a8cb89d2edeb737bfc4efb15902cd19bcaed1971e4feac2449c2db014b144d65a0">AST_WEBSOCKET_OPCODE_TEXT</a> || *<a class="code" href="../../db/db6/structast__websocket.html#ac717220c65cf5cf274dc30d3af6f1ded">opcode</a> == <a class="code" href="../../d0/d0c/http__websocket_8h.html#a8cb89d2edeb737bfc4efb15902cd19bca3c4b23cd6b0016f8683525e726b4a810">AST_WEBSOCKET_OPCODE_BINARY</a> || *<a class="code" href="../../db/db6/structast__websocket.html#ac717220c65cf5cf274dc30d3af6f1ded">opcode</a> == <a class="code" href="../../d0/d0c/http__websocket_8h.html#a8cb89d2edeb737bfc4efb15902cd19bca3bca61f5d957c1f62fb7dbec2bbf2db3">AST_WEBSOCKET_OPCODE_CONTINUATION</a> ||</div><div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;       *<a class="code" href="../../db/db6/structast__websocket.html#ac717220c65cf5cf274dc30d3af6f1ded">opcode</a> == <a class="code" href="../../d0/d0c/http__websocket_8h.html#a8cb89d2edeb737bfc4efb15902cd19bca29a4cd6349c34f5799bd88dd238d3ec7">AST_WEBSOCKET_OPCODE_PING</a> || *<a class="code" href="../../db/db6/structast__websocket.html#ac717220c65cf5cf274dc30d3af6f1ded">opcode</a> == <a class="code" href="../../d0/d0c/http__websocket_8h.html#a8cb89d2edeb737bfc4efb15902cd19bca2d0f797f65d34e2db66f978d571530de">AST_WEBSOCKET_OPCODE_PONG</a>  || *<a class="code" href="../../db/db6/structast__websocket.html#ac717220c65cf5cf274dc30d3af6f1ded">opcode</a> == <a class="code" href="../../d0/d0c/http__websocket_8h.html#a8cb89d2edeb737bfc4efb15902cd19bcacd58d1ec65c0e9e407972667603697af">AST_WEBSOCKET_OPCODE_CLOSE</a>) {</div><div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;      fin = (session-&gt;<a class="code" href="../../db/db6/structast__websocket.html#a073c52736110f5131b461d3adbef00e9">buf</a>[0] &gt;&gt; 7) &amp; 1;</div><div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;      mask_present = (session-&gt;<a class="code" href="../../db/db6/structast__websocket.html#a073c52736110f5131b461d3adbef00e9">buf</a>[1] &gt;&gt; 7) &amp; 1;</div><div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160;</div><div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160;      <span class="comment">/* Based on the mask flag and payload length, determine how much more we need to read before start parsing the rest of the header */</span></div><div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160;      options_len += mask_present ? 4 : 0;</div><div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;      options_len += (*<a class="code" href="../../db/db6/structast__websocket.html#a8149fce4e72dd1aac637ccd553996344">payload_len</a> == 126) ? 2 : (*<a class="code" href="../../db/db6/structast__websocket.html#a8149fce4e72dd1aac637ccd553996344">payload_len</a> == 127) ? 8 : 0;</div><div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160;      <span class="keywordflow">if</span> (options_len) {</div><div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;         <span class="comment">/* read the rest of the header options */</span></div><div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160;         <span class="keywordflow">if</span> (<a class="code" href="../../de/d4c/res__http__websocket_8c.html#a32088fabfd3e38aa97358a8833d59850">ws_safe_read</a>(session, &amp;session-&gt;<a class="code" href="../../db/db6/structast__websocket.html#a073c52736110f5131b461d3adbef00e9">buf</a>[<a class="code" href="../../d2/d97/format__g726_8c.html#ab9b9df9925ea7c54e551aa412bf0c59c">frame_size</a>], options_len, <a class="code" href="../../db/db6/structast__websocket.html#ac717220c65cf5cf274dc30d3af6f1ded">opcode</a>)) {</div><div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160;            <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160;         }</div><div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160;         <a class="code" href="../../d2/d97/format__g726_8c.html#ab9b9df9925ea7c54e551aa412bf0c59c">frame_size</a> += options_len;</div><div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160;      }</div><div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160;</div><div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160;      <span class="keywordflow">if</span> (*<a class="code" href="../../db/db6/structast__websocket.html#a8149fce4e72dd1aac637ccd553996344">payload_len</a> == 126) {</div><div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160;         <span class="comment">/* Grab the 2-byte payload length  */</span></div><div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160;         *<a class="code" href="../../db/db6/structast__websocket.html#a8149fce4e72dd1aac637ccd553996344">payload_len</a> = ntohs(<a class="code" href="../../d2/d1e/unaligned_8h.html#aa4e7c12e3e86ceccab7309f71c29f0ea">get_unaligned_uint16</a>(&amp;session-&gt;<a class="code" href="../../db/db6/structast__websocket.html#a073c52736110f5131b461d3adbef00e9">buf</a>[2]));</div><div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160;         mask = &amp;session-&gt;<a class="code" href="../../db/db6/structast__websocket.html#a073c52736110f5131b461d3adbef00e9">buf</a>[4];</div><div class="line"><a name="l00641"></a><span class="lineno">  641</span>&#160;      } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (*<a class="code" href="../../db/db6/structast__websocket.html#a8149fce4e72dd1aac637ccd553996344">payload_len</a> == 127) {</div><div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160;         <span class="comment">/* Grab the 8-byte payload length  */</span></div><div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160;         *<a class="code" href="../../db/db6/structast__websocket.html#a8149fce4e72dd1aac637ccd553996344">payload_len</a> = <a class="code" href="../../de/da3/include_2asterisk_2compat_8h.html#a86c08c7b27ef0cc72dc2cb52e0508812">ntohll</a>(<a class="code" href="../../d2/d1e/unaligned_8h.html#aed10925bdbb6cbd11f05528fba266d29">get_unaligned_uint64</a>(&amp;session-&gt;<a class="code" href="../../db/db6/structast__websocket.html#a073c52736110f5131b461d3adbef00e9">buf</a>[2]));</div><div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160;         mask = &amp;session-&gt;<a class="code" href="../../db/db6/structast__websocket.html#a073c52736110f5131b461d3adbef00e9">buf</a>[10];</div><div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160;      } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00646"></a><span class="lineno">  646</span>&#160;         <span class="comment">/* Just set the mask after the small 2-byte header */</span></div><div class="line"><a name="l00647"></a><span class="lineno">  647</span>&#160;         mask = &amp;session-&gt;<a class="code" href="../../db/db6/structast__websocket.html#a073c52736110f5131b461d3adbef00e9">buf</a>[2];</div><div class="line"><a name="l00648"></a><span class="lineno">  648</span>&#160;      }</div><div class="line"><a name="l00649"></a><span class="lineno">  649</span>&#160;</div><div class="line"><a name="l00650"></a><span class="lineno">  650</span>&#160;      <span class="comment">/* Now read the rest of the payload */</span></div><div class="line"><a name="l00651"></a><span class="lineno">  651</span>&#160;      *<a class="code" href="../../db/db6/structast__websocket.html#a18f141cb2726073503afb9f1d6c85efb">payload</a> = &amp;session-&gt;<a class="code" href="../../db/db6/structast__websocket.html#a073c52736110f5131b461d3adbef00e9">buf</a>[<a class="code" href="../../d2/d97/format__g726_8c.html#ab9b9df9925ea7c54e551aa412bf0c59c">frame_size</a>]; <span class="comment">/* payload will start here, at the end of the options, if any */</span></div><div class="line"><a name="l00652"></a><span class="lineno">  652</span>&#160;      <a class="code" href="../../d2/d97/format__g726_8c.html#ab9b9df9925ea7c54e551aa412bf0c59c">frame_size</a> = <a class="code" href="../../d2/d97/format__g726_8c.html#ab9b9df9925ea7c54e551aa412bf0c59c">frame_size</a> + (*payload_len); <span class="comment">/* final frame size is header + optional headers + payload data */</span></div><div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="../../d2/d97/format__g726_8c.html#ab9b9df9925ea7c54e551aa412bf0c59c">frame_size</a> &gt; <a class="code" href="../../de/d4c/res__http__websocket_8c.html#a055ae5efdfd42a3c39b110e43e6a1ff1">MAXIMUM_FRAME_SIZE</a>) {</div><div class="line"><a name="l00654"></a><span class="lineno">  654</span>&#160;         <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Cannot fit huge websocket frame of %zu bytes\n&quot;</span>, <a class="code" href="../../d2/d97/format__g726_8c.html#ab9b9df9925ea7c54e551aa412bf0c59c">frame_size</a>);</div><div class="line"><a name="l00655"></a><span class="lineno">  655</span>&#160;         <span class="comment">/* The frame won&#39;t fit :-( */</span></div><div class="line"><a name="l00656"></a><span class="lineno">  656</span>&#160;         <a class="code" href="../../de/d4c/res__http__websocket_8c.html#ae4851ff13b6e90c8b88d5717465644ea">ast_websocket_close</a>(session, 1009);</div><div class="line"><a name="l00657"></a><span class="lineno">  657</span>&#160;         <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l00658"></a><span class="lineno">  658</span>&#160;      }</div><div class="line"><a name="l00659"></a><span class="lineno">  659</span>&#160;</div><div class="line"><a name="l00660"></a><span class="lineno">  660</span>&#160;      <span class="keywordflow">if</span> (*payload_len) {</div><div class="line"><a name="l00661"></a><span class="lineno">  661</span>&#160;         <span class="keywordflow">if</span> (<a class="code" href="../../de/d4c/res__http__websocket_8c.html#a32088fabfd3e38aa97358a8833d59850">ws_safe_read</a>(session, *<a class="code" href="../../db/db6/structast__websocket.html#a18f141cb2726073503afb9f1d6c85efb">payload</a>, *payload_len, <a class="code" href="../../db/db6/structast__websocket.html#ac717220c65cf5cf274dc30d3af6f1ded">opcode</a>)) {</div><div class="line"><a name="l00662"></a><span class="lineno">  662</span>&#160;            <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l00663"></a><span class="lineno">  663</span>&#160;         }</div><div class="line"><a name="l00664"></a><span class="lineno">  664</span>&#160;      }</div><div class="line"><a name="l00665"></a><span class="lineno">  665</span>&#160;</div><div class="line"><a name="l00666"></a><span class="lineno">  666</span>&#160;      <span class="comment">/* If a mask is present unmask the payload */</span></div><div class="line"><a name="l00667"></a><span class="lineno">  667</span>&#160;      <span class="keywordflow">if</span> (mask_present) {</div><div class="line"><a name="l00668"></a><span class="lineno">  668</span>&#160;         <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> pos;</div><div class="line"><a name="l00669"></a><span class="lineno">  669</span>&#160;         <span class="keywordflow">for</span> (pos = 0; pos &lt; *<a class="code" href="../../db/db6/structast__websocket.html#a8149fce4e72dd1aac637ccd553996344">payload_len</a>; pos++) {</div><div class="line"><a name="l00670"></a><span class="lineno">  670</span>&#160;            (*payload)[pos] ^= mask[pos % 4];</div><div class="line"><a name="l00671"></a><span class="lineno">  671</span>&#160;         }</div><div class="line"><a name="l00672"></a><span class="lineno">  672</span>&#160;      }</div><div class="line"><a name="l00673"></a><span class="lineno">  673</span>&#160;</div><div class="line"><a name="l00674"></a><span class="lineno">  674</span>&#160;      <span class="comment">/* Per the RFC for PING we need to send back an opcode with the application data as received */</span></div><div class="line"><a name="l00675"></a><span class="lineno">  675</span>&#160;      <span class="keywordflow">if</span> (*<a class="code" href="../../db/db6/structast__websocket.html#ac717220c65cf5cf274dc30d3af6f1ded">opcode</a> == <a class="code" href="../../d0/d0c/http__websocket_8h.html#a8cb89d2edeb737bfc4efb15902cd19bca29a4cd6349c34f5799bd88dd238d3ec7">AST_WEBSOCKET_OPCODE_PING</a>) {</div><div class="line"><a name="l00676"></a><span class="lineno">  676</span>&#160;         <span class="keywordflow">if</span> (<a class="code" href="../../de/d4c/res__http__websocket_8c.html#a1a6e44db94d8b4e8c06bf456bb0174ad">ast_websocket_write</a>(session, <a class="code" href="../../d0/d0c/http__websocket_8h.html#a8cb89d2edeb737bfc4efb15902cd19bca2d0f797f65d34e2db66f978d571530de">AST_WEBSOCKET_OPCODE_PONG</a>, *<a class="code" href="../../db/db6/structast__websocket.html#a18f141cb2726073503afb9f1d6c85efb">payload</a>, *payload_len)) {</div><div class="line"><a name="l00677"></a><span class="lineno">  677</span>&#160;            <a class="code" href="../../de/d4c/res__http__websocket_8c.html#ae4851ff13b6e90c8b88d5717465644ea">ast_websocket_close</a>(session, 1009);</div><div class="line"><a name="l00678"></a><span class="lineno">  678</span>&#160;         }</div><div class="line"><a name="l00679"></a><span class="lineno">  679</span>&#160;         *payload_len = 0;</div><div class="line"><a name="l00680"></a><span class="lineno">  680</span>&#160;         <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00681"></a><span class="lineno">  681</span>&#160;      }</div><div class="line"><a name="l00682"></a><span class="lineno">  682</span>&#160;</div><div class="line"><a name="l00683"></a><span class="lineno">  683</span>&#160;      <span class="comment">/* Stop PONG processing here */</span></div><div class="line"><a name="l00684"></a><span class="lineno">  684</span>&#160;      <span class="keywordflow">if</span> (*<a class="code" href="../../db/db6/structast__websocket.html#ac717220c65cf5cf274dc30d3af6f1ded">opcode</a> == <a class="code" href="../../d0/d0c/http__websocket_8h.html#a8cb89d2edeb737bfc4efb15902cd19bca2d0f797f65d34e2db66f978d571530de">AST_WEBSOCKET_OPCODE_PONG</a>) {</div><div class="line"><a name="l00685"></a><span class="lineno">  685</span>&#160;         *payload_len = 0;</div><div class="line"><a name="l00686"></a><span class="lineno">  686</span>&#160;         <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00687"></a><span class="lineno">  687</span>&#160;      }</div><div class="line"><a name="l00688"></a><span class="lineno">  688</span>&#160;</div><div class="line"><a name="l00689"></a><span class="lineno">  689</span>&#160;      <span class="comment">/* Save the CLOSE status code which will be sent in our own CLOSE in the destructor */</span></div><div class="line"><a name="l00690"></a><span class="lineno">  690</span>&#160;      <span class="keywordflow">if</span> (*<a class="code" href="../../db/db6/structast__websocket.html#ac717220c65cf5cf274dc30d3af6f1ded">opcode</a> == <a class="code" href="../../d0/d0c/http__websocket_8h.html#a8cb89d2edeb737bfc4efb15902cd19bcacd58d1ec65c0e9e407972667603697af">AST_WEBSOCKET_OPCODE_CLOSE</a>) {</div><div class="line"><a name="l00691"></a><span class="lineno">  691</span>&#160;         session-&gt;<a class="code" href="../../db/db6/structast__websocket.html#aa71fe3535b288c6e8f4e7f811b65fc3c">closing</a> = 1;</div><div class="line"><a name="l00692"></a><span class="lineno">  692</span>&#160;         <span class="keywordflow">if</span> (*payload_len &gt;= 2) {</div><div class="line"><a name="l00693"></a><span class="lineno">  693</span>&#160;            session-&gt;<a class="code" href="../../db/db6/structast__websocket.html#a703e6acb6529d1dbabf148b897387f94">close_status_code</a> = ntohs(<a class="code" href="../../d2/d1e/unaligned_8h.html#aa4e7c12e3e86ceccab7309f71c29f0ea">get_unaligned_uint16</a>(*<a class="code" href="../../db/db6/structast__websocket.html#a18f141cb2726073503afb9f1d6c85efb">payload</a>));</div><div class="line"><a name="l00694"></a><span class="lineno">  694</span>&#160;         }</div><div class="line"><a name="l00695"></a><span class="lineno">  695</span>&#160;         *payload_len = 0;</div><div class="line"><a name="l00696"></a><span class="lineno">  696</span>&#160;         <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00697"></a><span class="lineno">  697</span>&#160;      }</div><div class="line"><a name="l00698"></a><span class="lineno">  698</span>&#160;</div><div class="line"><a name="l00699"></a><span class="lineno">  699</span>&#160;      <span class="comment">/* Below this point we are handling TEXT, BINARY or CONTINUATION opcodes */</span></div><div class="line"><a name="l00700"></a><span class="lineno">  700</span>&#160;      <span class="keywordflow">if</span> (*payload_len) {</div><div class="line"><a name="l00701"></a><span class="lineno">  701</span>&#160;         <span class="keywordflow">if</span> (!(new_payload = <a class="code" href="../../d8/d8a/astmm_8h.html#aa6bcdb74dc1508c22986f0adf171a0f2">ast_realloc</a>(session-&gt;<a class="code" href="../../db/db6/structast__websocket.html#a18f141cb2726073503afb9f1d6c85efb">payload</a>, (session-&gt;<a class="code" href="../../db/db6/structast__websocket.html#a8149fce4e72dd1aac637ccd553996344">payload_len</a> + *payload_len)))) {</div><div class="line"><a name="l00702"></a><span class="lineno">  702</span>&#160;            <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Failed allocation: %p, %zu, %&quot;</span>PRIu64<span class="stringliteral">&quot;\n&quot;</span>,</div><div class="line"><a name="l00703"></a><span class="lineno">  703</span>&#160;               session-&gt;<a class="code" href="../../db/db6/structast__websocket.html#a18f141cb2726073503afb9f1d6c85efb">payload</a>, session-&gt;<a class="code" href="../../db/db6/structast__websocket.html#a8149fce4e72dd1aac637ccd553996344">payload_len</a>, *payload_len);</div><div class="line"><a name="l00704"></a><span class="lineno">  704</span>&#160;            *payload_len = 0;</div><div class="line"><a name="l00705"></a><span class="lineno">  705</span>&#160;            <a class="code" href="../../de/d4c/res__http__websocket_8c.html#ae4851ff13b6e90c8b88d5717465644ea">ast_websocket_close</a>(session, 1009);</div><div class="line"><a name="l00706"></a><span class="lineno">  706</span>&#160;            <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l00707"></a><span class="lineno">  707</span>&#160;         }</div><div class="line"><a name="l00708"></a><span class="lineno">  708</span>&#160;</div><div class="line"><a name="l00709"></a><span class="lineno">  709</span>&#160;         session-&gt;<a class="code" href="../../db/db6/structast__websocket.html#a18f141cb2726073503afb9f1d6c85efb">payload</a> = new_payload;</div><div class="line"><a name="l00710"></a><span class="lineno">  710</span>&#160;         memcpy((session-&gt;<a class="code" href="../../db/db6/structast__websocket.html#a18f141cb2726073503afb9f1d6c85efb">payload</a> + session-&gt;<a class="code" href="../../db/db6/structast__websocket.html#a8149fce4e72dd1aac637ccd553996344">payload_len</a>), (*<a class="code" href="../../db/db6/structast__websocket.html#a18f141cb2726073503afb9f1d6c85efb">payload</a>), (*payload_len));</div><div class="line"><a name="l00711"></a><span class="lineno">  711</span>&#160;         session-&gt;<a class="code" href="../../db/db6/structast__websocket.html#a8149fce4e72dd1aac637ccd553996344">payload_len</a> += *<a class="code" href="../../db/db6/structast__websocket.html#a8149fce4e72dd1aac637ccd553996344">payload_len</a>;</div><div class="line"><a name="l00712"></a><span class="lineno">  712</span>&#160;      } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!session-&gt;<a class="code" href="../../db/db6/structast__websocket.html#a8149fce4e72dd1aac637ccd553996344">payload_len</a> &amp;&amp; session-&gt;<a class="code" href="../../db/db6/structast__websocket.html#a18f141cb2726073503afb9f1d6c85efb">payload</a>) {</div><div class="line"><a name="l00713"></a><span class="lineno">  713</span>&#160;         <a class="code" href="../../d8/d8a/astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(session-&gt;<a class="code" href="../../db/db6/structast__websocket.html#a18f141cb2726073503afb9f1d6c85efb">payload</a>);</div><div class="line"><a name="l00714"></a><span class="lineno">  714</span>&#160;         session-&gt;<a class="code" href="../../db/db6/structast__websocket.html#a18f141cb2726073503afb9f1d6c85efb">payload</a> = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l00715"></a><span class="lineno">  715</span>&#160;      }</div><div class="line"><a name="l00716"></a><span class="lineno">  716</span>&#160;</div><div class="line"><a name="l00717"></a><span class="lineno">  717</span>&#160;      <span class="keywordflow">if</span> (!fin &amp;&amp; session-&gt;<a class="code" href="../../db/db6/structast__websocket.html#ae2c11c04c7f747de8619a46a721bd63d">reconstruct</a> &amp;&amp; (session-&gt;<a class="code" href="../../db/db6/structast__websocket.html#a8149fce4e72dd1aac637ccd553996344">payload_len</a> &lt; session-&gt;<a class="code" href="../../db/db6/structast__websocket.html#ae2c11c04c7f747de8619a46a721bd63d">reconstruct</a>)) {</div><div class="line"><a name="l00718"></a><span class="lineno">  718</span>&#160;         <span class="comment">/* If this is not a final message we need to defer returning it until later */</span></div><div class="line"><a name="l00719"></a><span class="lineno">  719</span>&#160;         <span class="keywordflow">if</span> (*<a class="code" href="../../db/db6/structast__websocket.html#ac717220c65cf5cf274dc30d3af6f1ded">opcode</a> != <a class="code" href="../../d0/d0c/http__websocket_8h.html#a8cb89d2edeb737bfc4efb15902cd19bca3bca61f5d957c1f62fb7dbec2bbf2db3">AST_WEBSOCKET_OPCODE_CONTINUATION</a>) {</div><div class="line"><a name="l00720"></a><span class="lineno">  720</span>&#160;            session-&gt;<a class="code" href="../../db/db6/structast__websocket.html#ac717220c65cf5cf274dc30d3af6f1ded">opcode</a> = *<a class="code" href="../../db/db6/structast__websocket.html#ac717220c65cf5cf274dc30d3af6f1ded">opcode</a>;</div><div class="line"><a name="l00721"></a><span class="lineno">  721</span>&#160;         }</div><div class="line"><a name="l00722"></a><span class="lineno">  722</span>&#160;         *<a class="code" href="../../db/db6/structast__websocket.html#ac717220c65cf5cf274dc30d3af6f1ded">opcode</a> = <a class="code" href="../../d0/d0c/http__websocket_8h.html#a8cb89d2edeb737bfc4efb15902cd19bca3bca61f5d957c1f62fb7dbec2bbf2db3">AST_WEBSOCKET_OPCODE_CONTINUATION</a>;</div><div class="line"><a name="l00723"></a><span class="lineno">  723</span>&#160;         *payload_len = 0;</div><div class="line"><a name="l00724"></a><span class="lineno">  724</span>&#160;         *<a class="code" href="../../db/db6/structast__websocket.html#a18f141cb2726073503afb9f1d6c85efb">payload</a> = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l00725"></a><span class="lineno">  725</span>&#160;      } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00726"></a><span class="lineno">  726</span>&#160;         <span class="keywordflow">if</span> (*<a class="code" href="../../db/db6/structast__websocket.html#ac717220c65cf5cf274dc30d3af6f1ded">opcode</a> == <a class="code" href="../../d0/d0c/http__websocket_8h.html#a8cb89d2edeb737bfc4efb15902cd19bca3bca61f5d957c1f62fb7dbec2bbf2db3">AST_WEBSOCKET_OPCODE_CONTINUATION</a>) {</div><div class="line"><a name="l00727"></a><span class="lineno">  727</span>&#160;            <span class="keywordflow">if</span> (!fin) {</div><div class="line"><a name="l00728"></a><span class="lineno">  728</span>&#160;               <span class="comment">/* If this was not actually the final message tell the user it is fragmented so they can deal with it accordingly */</span></div><div class="line"><a name="l00729"></a><span class="lineno">  729</span>&#160;               *fragmented = 1;</div><div class="line"><a name="l00730"></a><span class="lineno">  730</span>&#160;            } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00731"></a><span class="lineno">  731</span>&#160;               <span class="comment">/* Final frame in multi-frame so push up the actual opcode */</span></div><div class="line"><a name="l00732"></a><span class="lineno">  732</span>&#160;               *<a class="code" href="../../db/db6/structast__websocket.html#ac717220c65cf5cf274dc30d3af6f1ded">opcode</a> = session-&gt;<a class="code" href="../../db/db6/structast__websocket.html#ac717220c65cf5cf274dc30d3af6f1ded">opcode</a>;</div><div class="line"><a name="l00733"></a><span class="lineno">  733</span>&#160;            }</div><div class="line"><a name="l00734"></a><span class="lineno">  734</span>&#160;         }</div><div class="line"><a name="l00735"></a><span class="lineno">  735</span>&#160;         *payload_len = session-&gt;<a class="code" href="../../db/db6/structast__websocket.html#a8149fce4e72dd1aac637ccd553996344">payload_len</a>;</div><div class="line"><a name="l00736"></a><span class="lineno">  736</span>&#160;         *<a class="code" href="../../db/db6/structast__websocket.html#a18f141cb2726073503afb9f1d6c85efb">payload</a> = session-&gt;<a class="code" href="../../db/db6/structast__websocket.html#a18f141cb2726073503afb9f1d6c85efb">payload</a>;</div><div class="line"><a name="l00737"></a><span class="lineno">  737</span>&#160;         session-&gt;<a class="code" href="../../db/db6/structast__websocket.html#a8149fce4e72dd1aac637ccd553996344">payload_len</a> = 0;</div><div class="line"><a name="l00738"></a><span class="lineno">  738</span>&#160;      }</div><div class="line"><a name="l00739"></a><span class="lineno">  739</span>&#160;   } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00740"></a><span class="lineno">  740</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;WebSocket unknown opcode %u\n&quot;</span>, *<a class="code" href="../../db/db6/structast__websocket.html#ac717220c65cf5cf274dc30d3af6f1ded">opcode</a>);</div><div class="line"><a name="l00741"></a><span class="lineno">  741</span>&#160;      <span class="comment">/* We received an opcode that we don&#39;t understand, the RFC states that 1003 is for a type of data that can&#39;t be accepted... opcodes</span></div><div class="line"><a name="l00742"></a><span class="lineno">  742</span>&#160;<span class="comment">       * fit that, I think. */</span></div><div class="line"><a name="l00743"></a><span class="lineno">  743</span>&#160;      <a class="code" href="../../de/d4c/res__http__websocket_8c.html#ae4851ff13b6e90c8b88d5717465644ea">ast_websocket_close</a>(session, 1003);</div><div class="line"><a name="l00744"></a><span class="lineno">  744</span>&#160;   }</div><div class="line"><a name="l00745"></a><span class="lineno">  745</span>&#160;</div><div class="line"><a name="l00746"></a><span class="lineno">  746</span>&#160;   <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00747"></a><span class="lineno">  747</span>&#160;}</div><div class="ttc" id="structast__websocket_html_a8149fce4e72dd1aac637ccd553996344"><div class="ttname"><a href="../../db/db6/structast__websocket.html#a8149fce4e72dd1aac637ccd553996344">ast_websocket::payload_len</a></div><div class="ttdeci">size_t payload_len</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d4c/res__http__websocket_8c_source.html#l00093">res_http_websocket.c:93</a></div></div>
<div class="ttc" id="astmm_8h_html_aa6bcdb74dc1508c22986f0adf171a0f2"><div class="ttname"><a href="../../d8/d8a/astmm_8h.html#aa6bcdb74dc1508c22986f0adf171a0f2">ast_realloc</a></div><div class="ttdeci">#define ast_realloc(p, len)</div><div class="ttdoc">A wrapper for realloc() </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d8a/astmm_8h_source.html#l00228">astmm.h:228</a></div></div>
<div class="ttc" id="structast__websocket_html_a18f141cb2726073503afb9f1d6c85efb"><div class="ttname"><a href="../../db/db6/structast__websocket.html#a18f141cb2726073503afb9f1d6c85efb">ast_websocket::payload</a></div><div class="ttdeci">char * payload</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d4c/res__http__websocket_8c_source.html#l00094">res_http_websocket.c:94</a></div></div>
<div class="ttc" id="structast__websocket_html_ae2c11c04c7f747de8619a46a721bd63d"><div class="ttname"><a href="../../db/db6/structast__websocket.html#ae2c11c04c7f747de8619a46a721bd63d">ast_websocket::reconstruct</a></div><div class="ttdeci">size_t reconstruct</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d4c/res__http__websocket_8c_source.html#l00095">res_http_websocket.c:95</a></div></div>
<div class="ttc" id="logger_8h_html_adf4476a6a4ea6c74231c826e899d7189"><div class="ttname"><a href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a></div><div class="ttdeci">#define LOG_WARNING</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d8c/logger_8h_source.html#l00274">logger.h:274</a></div></div>
<div class="ttc" id="res__http__websocket_8c_html_ae4851ff13b6e90c8b88d5717465644ea"><div class="ttname"><a href="../../de/d4c/res__http__websocket_8c.html#ae4851ff13b6e90c8b88d5717465644ea">ast_websocket_close</a></div><div class="ttdeci">int AST_OPTIONAL_API_NAME() ast_websocket_close(struct ast_websocket *session, uint16_t reason)</div><div class="ttdoc">Close function for websocket session. </div><div class="ttdef"><b>Definition:</b> <a href="../../de/d4c/res__http__websocket_8c_source.html#l00308">res_http_websocket.c:308</a></div></div>
<div class="ttc" id="resample_8c_html_a070d2ce7b6bb7e5c05602aa8c308d0c4"><div class="ttname"><a href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a></div><div class="ttdeci">#define NULL</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d7f/resample_8c_source.html#l00096">resample.c:96</a></div></div>
<div class="ttc" id="http__websocket_8h_html_a8cb89d2edeb737bfc4efb15902cd19bcacd58d1ec65c0e9e407972667603697af"><div class="ttname"><a href="../../d0/d0c/http__websocket_8h.html#a8cb89d2edeb737bfc4efb15902cd19bcacd58d1ec65c0e9e407972667603697af">AST_WEBSOCKET_OPCODE_CLOSE</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d0c/http__websocket_8h_source.html#l00055">http_websocket.h:55</a></div></div>
<div class="ttc" id="astobj2_8c_html_a96a00b3a518d7f32b6d51dc28f09bf9b"><div class="ttname"><a href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a></div><div class="ttdeci">#define ast_log</div><div class="ttdef"><b>Definition:</b> <a href="../../da/df7/astobj2_8c_source.html#l00042">astobj2.c:42</a></div></div>
<div class="ttc" id="structast__websocket_html_ac717220c65cf5cf274dc30d3af6f1ded"><div class="ttname"><a href="../../db/db6/structast__websocket.html#ac717220c65cf5cf274dc30d3af6f1ded">ast_websocket::opcode</a></div><div class="ttdeci">enum ast_websocket_opcode opcode</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d4c/res__http__websocket_8c_source.html#l00092">res_http_websocket.c:92</a></div></div>
<div class="ttc" id="res__http__websocket_8c_html_a32088fabfd3e38aa97358a8833d59850"><div class="ttname"><a href="../../de/d4c/res__http__websocket_8c.html#a32088fabfd3e38aa97358a8833d59850">ws_safe_read</a></div><div class="ttdeci">static int ws_safe_read(struct ast_websocket *session, char *buf, size_t len, enum ast_websocket_opcode *opcode)</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d4c/res__http__websocket_8c_source.html#l00534">res_http_websocket.c:534</a></div></div>
<div class="ttc" id="unaligned_8h_html_aa4e7c12e3e86ceccab7309f71c29f0ea"><div class="ttname"><a href="../../d2/d1e/unaligned_8h.html#aa4e7c12e3e86ceccab7309f71c29f0ea">get_unaligned_uint16</a></div><div class="ttdeci">static unsigned short get_unaligned_uint16(const void *p)</div><div class="ttdef"><b>Definition:</b> <a href="../../d2/d1e/unaligned_8h_source.html#l00044">unaligned.h:44</a></div></div>
<div class="ttc" id="structast__websocket_html_a703e6acb6529d1dbabf148b897387f94"><div class="ttname"><a href="../../db/db6/structast__websocket.html#a703e6acb6529d1dbabf148b897387f94">ast_websocket::close_status_code</a></div><div class="ttdeci">uint16_t close_status_code</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d4c/res__http__websocket_8c_source.html#l00102">res_http_websocket.c:102</a></div></div>
<div class="ttc" id="res__http__websocket_8c_html_a2eb05d1858816a59ef4a882df8a1df44"><div class="ttname"><a href="../../de/d4c/res__http__websocket_8c.html#a2eb05d1858816a59ef4a882df8a1df44">MIN_WS_HDR_SZ</a></div><div class="ttdeci">#define MIN_WS_HDR_SZ</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d4c/res__http__websocket_8c_source.html#l00085">res_http_websocket.c:85</a></div></div>
<div class="ttc" id="http__websocket_8h_html_a8cb89d2edeb737bfc4efb15902cd19bcaed1971e4feac2449c2db014b144d65a0"><div class="ttname"><a href="../../d0/d0c/http__websocket_8h.html#a8cb89d2edeb737bfc4efb15902cd19bcaed1971e4feac2449c2db014b144d65a0">AST_WEBSOCKET_OPCODE_TEXT</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d0c/http__websocket_8h_source.html#l00051">http_websocket.h:51</a></div></div>
<div class="ttc" id="res__http__websocket_8c_html_a055ae5efdfd42a3c39b110e43e6a1ff1"><div class="ttname"><a href="../../de/d4c/res__http__websocket_8c.html#a055ae5efdfd42a3c39b110e43e6a1ff1">MAXIMUM_FRAME_SIZE</a></div><div class="ttdeci">#define MAXIMUM_FRAME_SIZE</div><div class="ttdoc">Size of the pre-determined buffer for WebSocket frames. </div><div class="ttdef"><b>Definition:</b> <a href="../../de/d4c/res__http__websocket_8c_source.html#l00066">res_http_websocket.c:66</a></div></div>
<div class="ttc" id="include_2asterisk_2compat_8h_html_a86c08c7b27ef0cc72dc2cb52e0508812"><div class="ttname"><a href="../../de/da3/include_2asterisk_2compat_8h.html#a86c08c7b27ef0cc72dc2cb52e0508812">ntohll</a></div><div class="ttdeci">uint64_t ntohll(uint64_t net64)</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d1e/strcompat_8c_source.html#l00364">strcompat.c:364</a></div></div>
<div class="ttc" id="res__http__websocket_8c_html_a1a6e44db94d8b4e8c06bf456bb0174ad"><div class="ttname"><a href="../../de/d4c/res__http__websocket_8c.html#a1a6e44db94d8b4e8c06bf456bb0174ad">ast_websocket_write</a></div><div class="ttdeci">int AST_OPTIONAL_API_NAME() ast_websocket_write(struct ast_websocket *session, enum ast_websocket_opcode opcode, char *payload, uint64_t payload_size)</div><div class="ttdoc">Write function for websocket traffic. </div><div class="ttdef"><b>Definition:</b> <a href="../../de/d4c/res__http__websocket_8c_source.html#l00374">res_http_websocket.c:374</a></div></div>
<div class="ttc" id="astmm_8h_html_a402072d6789f6ed9e3a81da27504127e"><div class="ttname"><a href="../../d8/d8a/astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a></div><div class="ttdeci">#define ast_free(a)</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d8a/astmm_8h_source.html#l00182">astmm.h:182</a></div></div>
<div class="ttc" id="structast__websocket_html_aa71fe3535b288c6e8f4e7f811b65fc3c"><div class="ttname"><a href="../../db/db6/structast__websocket.html#aa71fe3535b288c6e8f4e7f811b65fc3c">ast_websocket::closing</a></div><div class="ttdeci">unsigned int closing</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d4c/res__http__websocket_8c_source.html#l00098">res_http_websocket.c:98</a></div></div>
<div class="ttc" id="http__websocket_8h_html_a8cb89d2edeb737bfc4efb15902cd19bca3c4b23cd6b0016f8683525e726b4a810"><div class="ttname"><a href="../../d0/d0c/http__websocket_8h.html#a8cb89d2edeb737bfc4efb15902cd19bca3c4b23cd6b0016f8683525e726b4a810">AST_WEBSOCKET_OPCODE_BINARY</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d0c/http__websocket_8h_source.html#l00052">http_websocket.h:52</a></div></div>
<div class="ttc" id="http__websocket_8h_html_a8cb89d2edeb737bfc4efb15902cd19bca2d0f797f65d34e2db66f978d571530de"><div class="ttname"><a href="../../d0/d0c/http__websocket_8h.html#a8cb89d2edeb737bfc4efb15902cd19bca2d0f797f65d34e2db66f978d571530de">AST_WEBSOCKET_OPCODE_PONG</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d0c/http__websocket_8h_source.html#l00054">http_websocket.h:54</a></div></div>
<div class="ttc" id="http__websocket_8h_html_a8cb89d2edeb737bfc4efb15902cd19bca3bca61f5d957c1f62fb7dbec2bbf2db3"><div class="ttname"><a href="../../d0/d0c/http__websocket_8h.html#a8cb89d2edeb737bfc4efb15902cd19bca3bca61f5d957c1f62fb7dbec2bbf2db3">AST_WEBSOCKET_OPCODE_CONTINUATION</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d0c/http__websocket_8h_source.html#l00056">http_websocket.h:56</a></div></div>
<div class="ttc" id="http__websocket_8h_html_a8cb89d2edeb737bfc4efb15902cd19bca29a4cd6349c34f5799bd88dd238d3ec7"><div class="ttname"><a href="../../d0/d0c/http__websocket_8h.html#a8cb89d2edeb737bfc4efb15902cd19bca29a4cd6349c34f5799bd88dd238d3ec7">AST_WEBSOCKET_OPCODE_PING</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d0c/http__websocket_8h_source.html#l00053">http_websocket.h:53</a></div></div>
<div class="ttc" id="unaligned_8h_html_aed10925bdbb6cbd11f05528fba266d29"><div class="ttname"><a href="../../d2/d1e/unaligned_8h.html#aed10925bdbb6cbd11f05528fba266d29">get_unaligned_uint64</a></div><div class="ttdeci">static uint64_t get_unaligned_uint64(const void *p)</div><div class="ttdef"><b>Definition:</b> <a href="../../d2/d1e/unaligned_8h_source.html#l00032">unaligned.h:32</a></div></div>
<div class="ttc" id="structast__websocket_html_a073c52736110f5131b461d3adbef00e9"><div class="ttname"><a href="../../db/db6/structast__websocket.html#a073c52736110f5131b461d3adbef00e9">ast_websocket::buf</a></div><div class="ttdeci">char buf[MAXIMUM_FRAME_SIZE]</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d4c/res__http__websocket_8c_source.html#l00103">res_http_websocket.c:103</a></div></div>
<div class="ttc" id="format__g726_8c_html_ab9b9df9925ea7c54e551aa412bf0c59c"><div class="ttname"><a href="../../d2/d97/format__g726_8c.html#ab9b9df9925ea7c54e551aa412bf0c59c">frame_size</a></div><div class="ttdeci">static int frame_size[4]</div><div class="ttdef"><b>Definition:</b> <a href="../../d2/d97/format__g726_8c_source.html#l00052">format_g726.c:52</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="afae0d72494ee51b8bda86278280406f7"></a>
<h2 class="memtitle"><span class="permalink"><a href="#afae0d72494ee51b8bda86278280406f7">&#9670;&nbsp;</a></span>ast_websocket_read_string()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="../../df/d3c/optional__api_8h.html#abe6ec88934f99eb74444f6c4a92353ec">AST_OPTIONAL_API_NAME</a>() ast_websocket_read_string </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="../../db/db6/structast__websocket.html">ast_websocket</a> *&#160;</td>
          <td class="paramname"><em>ws</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char **&#160;</td>
          <td class="paramname"><em>buf</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html#l01440">1440</a> of file <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html">res_http_websocket.c</a>.</p>

<p class="reference">References <a class="el" href="../../da/df7/astobj2_8c_source.html#l00042">ast_log</a>, <a class="el" href="../../df/d3c/optional__api_8h_source.html#l00228">AST_OPTIONAL_API_NAME</a>, <a class="el" href="../../d8/d8a/astmm_8h_source.html#l00258">ast_strndup</a>, <a class="el" href="../../d0/d0c/http__websocket_8h_source.html#l00055">AST_WEBSOCKET_OPCODE_CLOSE</a>, <a class="el" href="../../d0/d0c/http__websocket_8h_source.html#l00056">AST_WEBSOCKET_OPCODE_CONTINUATION</a>, <a class="el" href="../../d0/d0c/http__websocket_8h_source.html#l00053">AST_WEBSOCKET_OPCODE_PING</a>, <a class="el" href="../../d0/d0c/http__websocket_8h_source.html#l00051">AST_WEBSOCKET_OPCODE_TEXT</a>, <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html#l00602">ast_websocket_read()</a>, <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html#l01484">ast_websocket_write_string()</a>, <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html#l00103">ast_websocket::buf</a>, <a class="el" href="../../d1/d8c/logger_8h_source.html#l00285">LOG_ERROR</a>, <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html#l00092">ast_websocket::opcode</a>, <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html#l00094">ast_websocket::payload</a>, and <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html#l00093">ast_websocket::payload_len</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../d0/d0c/http__websocket_8h_source.html#l00245">__stub__ast_websocket_read()</a>, <a class="el" href="../../de/de9/test__websocket__client_8c_source.html#l00044">AST_TEST_DEFINE()</a>, and <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html#l01421">ast_websocket_client_create()</a>.</p>
<div class="fragment"><div class="line"><a name="l01441"></a><span class="lineno"> 1441</span>&#160;{</div><div class="line"><a name="l01442"></a><span class="lineno"> 1442</span>&#160;   <span class="keywordtype">char</span> *<a class="code" href="../../db/db6/structast__websocket.html#a18f141cb2726073503afb9f1d6c85efb">payload</a>;</div><div class="line"><a name="l01443"></a><span class="lineno"> 1443</span>&#160;   uint64_t <a class="code" href="../../db/db6/structast__websocket.html#a8149fce4e72dd1aac637ccd553996344">payload_len</a>;</div><div class="line"><a name="l01444"></a><span class="lineno"> 1444</span>&#160;   <span class="keyword">enum</span> <a class="code" href="../../d0/d0c/http__websocket_8h.html#a8cb89d2edeb737bfc4efb15902cd19bc">ast_websocket_opcode</a> <a class="code" href="../../db/db6/structast__websocket.html#ac717220c65cf5cf274dc30d3af6f1ded">opcode</a>;</div><div class="line"><a name="l01445"></a><span class="lineno"> 1445</span>&#160;   <span class="keywordtype">int</span> fragmented = 1;</div><div class="line"><a name="l01446"></a><span class="lineno"> 1446</span>&#160;</div><div class="line"><a name="l01447"></a><span class="lineno"> 1447</span>&#160;   <span class="keywordflow">while</span> (fragmented) {</div><div class="line"><a name="l01448"></a><span class="lineno"> 1448</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="../../de/d4c/res__http__websocket_8c.html#ae16416016e8876c9dc2bd937278dcc4e">ast_websocket_read</a>(ws, &amp;payload, &amp;payload_len,</div><div class="line"><a name="l01449"></a><span class="lineno"> 1449</span>&#160;                   &amp;opcode, &amp;fragmented)) {</div><div class="line"><a name="l01450"></a><span class="lineno"> 1450</span>&#160;         <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Client WebSocket string read - &quot;</span></div><div class="line"><a name="l01451"></a><span class="lineno"> 1451</span>&#160;            <span class="stringliteral">&quot;error reading string data\n&quot;</span>);</div><div class="line"><a name="l01452"></a><span class="lineno"> 1452</span>&#160;         <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l01453"></a><span class="lineno"> 1453</span>&#160;      }</div><div class="line"><a name="l01454"></a><span class="lineno"> 1454</span>&#160;</div><div class="line"><a name="l01455"></a><span class="lineno"> 1455</span>&#160;      <span class="keywordflow">if</span> (opcode == <a class="code" href="../../d0/d0c/http__websocket_8h.html#a8cb89d2edeb737bfc4efb15902cd19bca29a4cd6349c34f5799bd88dd238d3ec7">AST_WEBSOCKET_OPCODE_PING</a>) {</div><div class="line"><a name="l01456"></a><span class="lineno"> 1456</span>&#160;         <span class="comment">/* Try read again, we have sent pong already */</span></div><div class="line"><a name="l01457"></a><span class="lineno"> 1457</span>&#160;         fragmented = 1;</div><div class="line"><a name="l01458"></a><span class="lineno"> 1458</span>&#160;         <span class="keywordflow">continue</span>;</div><div class="line"><a name="l01459"></a><span class="lineno"> 1459</span>&#160;      }</div><div class="line"><a name="l01460"></a><span class="lineno"> 1460</span>&#160;</div><div class="line"><a name="l01461"></a><span class="lineno"> 1461</span>&#160;      <span class="keywordflow">if</span> (opcode == <a class="code" href="../../d0/d0c/http__websocket_8h.html#a8cb89d2edeb737bfc4efb15902cd19bca3bca61f5d957c1f62fb7dbec2bbf2db3">AST_WEBSOCKET_OPCODE_CONTINUATION</a>) {</div><div class="line"><a name="l01462"></a><span class="lineno"> 1462</span>&#160;         <span class="keywordflow">continue</span>;</div><div class="line"><a name="l01463"></a><span class="lineno"> 1463</span>&#160;      }</div><div class="line"><a name="l01464"></a><span class="lineno"> 1464</span>&#160;</div><div class="line"><a name="l01465"></a><span class="lineno"> 1465</span>&#160;      <span class="keywordflow">if</span> (opcode == <a class="code" href="../../d0/d0c/http__websocket_8h.html#a8cb89d2edeb737bfc4efb15902cd19bcacd58d1ec65c0e9e407972667603697af">AST_WEBSOCKET_OPCODE_CLOSE</a>) {</div><div class="line"><a name="l01466"></a><span class="lineno"> 1466</span>&#160;         <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l01467"></a><span class="lineno"> 1467</span>&#160;      }</div><div class="line"><a name="l01468"></a><span class="lineno"> 1468</span>&#160;</div><div class="line"><a name="l01469"></a><span class="lineno"> 1469</span>&#160;      <span class="keywordflow">if</span> (opcode != <a class="code" href="../../d0/d0c/http__websocket_8h.html#a8cb89d2edeb737bfc4efb15902cd19bcaed1971e4feac2449c2db014b144d65a0">AST_WEBSOCKET_OPCODE_TEXT</a>) {</div><div class="line"><a name="l01470"></a><span class="lineno"> 1470</span>&#160;         <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Client WebSocket string read - &quot;</span></div><div class="line"><a name="l01471"></a><span class="lineno"> 1471</span>&#160;            <span class="stringliteral">&quot;non string data received\n&quot;</span>);</div><div class="line"><a name="l01472"></a><span class="lineno"> 1472</span>&#160;         <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l01473"></a><span class="lineno"> 1473</span>&#160;      }</div><div class="line"><a name="l01474"></a><span class="lineno"> 1474</span>&#160;   }</div><div class="line"><a name="l01475"></a><span class="lineno"> 1475</span>&#160;</div><div class="line"><a name="l01476"></a><span class="lineno"> 1476</span>&#160;   <span class="keywordflow">if</span> (!(*<a class="code" href="../../dd/d7c/eagi__proxy_8c.html#ac95651d79c608a3148973b5b1fc9e525">buf</a> = <a class="code" href="../../d8/d8a/astmm_8h.html#aa1202a8277cd3013d22535bf5bfe85fc">ast_strndup</a>(payload, payload_len))) {</div><div class="line"><a name="l01477"></a><span class="lineno"> 1477</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l01478"></a><span class="lineno"> 1478</span>&#160;   }</div><div class="line"><a name="l01479"></a><span class="lineno"> 1479</span>&#160;</div><div class="line"><a name="l01480"></a><span class="lineno"> 1480</span>&#160;   <span class="keywordflow">return</span> payload_len + 1;</div><div class="line"><a name="l01481"></a><span class="lineno"> 1481</span>&#160;}</div><div class="ttc" id="res__http__websocket_8c_html_ae16416016e8876c9dc2bd937278dcc4e"><div class="ttname"><a href="../../de/d4c/res__http__websocket_8c.html#ae16416016e8876c9dc2bd937278dcc4e">ast_websocket_read</a></div><div class="ttdeci">int AST_OPTIONAL_API_NAME() ast_websocket_read(struct ast_websocket *session, char **payload, uint64_t *payload_len, enum ast_websocket_opcode *opcode, int *fragmented)</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d4c/res__http__websocket_8c_source.html#l00602">res_http_websocket.c:602</a></div></div>
<div class="ttc" id="structast__websocket_html_a8149fce4e72dd1aac637ccd553996344"><div class="ttname"><a href="../../db/db6/structast__websocket.html#a8149fce4e72dd1aac637ccd553996344">ast_websocket::payload_len</a></div><div class="ttdeci">size_t payload_len</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d4c/res__http__websocket_8c_source.html#l00093">res_http_websocket.c:93</a></div></div>
<div class="ttc" id="structast__websocket_html_a18f141cb2726073503afb9f1d6c85efb"><div class="ttname"><a href="../../db/db6/structast__websocket.html#a18f141cb2726073503afb9f1d6c85efb">ast_websocket::payload</a></div><div class="ttdeci">char * payload</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d4c/res__http__websocket_8c_source.html#l00094">res_http_websocket.c:94</a></div></div>
<div class="ttc" id="eagi__proxy_8c_html_ac95651d79c608a3148973b5b1fc9e525"><div class="ttname"><a href="../../dd/d7c/eagi__proxy_8c.html#ac95651d79c608a3148973b5b1fc9e525">buf</a></div><div class="ttdeci">char buf[BUFSIZE]</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d7c/eagi__proxy_8c_source.html#l00066">eagi_proxy.c:66</a></div></div>
<div class="ttc" id="http__websocket_8h_html_a8cb89d2edeb737bfc4efb15902cd19bcacd58d1ec65c0e9e407972667603697af"><div class="ttname"><a href="../../d0/d0c/http__websocket_8h.html#a8cb89d2edeb737bfc4efb15902cd19bcacd58d1ec65c0e9e407972667603697af">AST_WEBSOCKET_OPCODE_CLOSE</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d0c/http__websocket_8h_source.html#l00055">http_websocket.h:55</a></div></div>
<div class="ttc" id="astobj2_8c_html_a96a00b3a518d7f32b6d51dc28f09bf9b"><div class="ttname"><a href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a></div><div class="ttdeci">#define ast_log</div><div class="ttdef"><b>Definition:</b> <a href="../../da/df7/astobj2_8c_source.html#l00042">astobj2.c:42</a></div></div>
<div class="ttc" id="structast__websocket_html_ac717220c65cf5cf274dc30d3af6f1ded"><div class="ttname"><a href="../../db/db6/structast__websocket.html#ac717220c65cf5cf274dc30d3af6f1ded">ast_websocket::opcode</a></div><div class="ttdeci">enum ast_websocket_opcode opcode</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d4c/res__http__websocket_8c_source.html#l00092">res_http_websocket.c:92</a></div></div>
<div class="ttc" id="logger_8h_html_aced66975c154ea0e2a8ec3bc818b4e08"><div class="ttname"><a href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a></div><div class="ttdeci">#define LOG_ERROR</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d8c/logger_8h_source.html#l00285">logger.h:285</a></div></div>
<div class="ttc" id="http__websocket_8h_html_a8cb89d2edeb737bfc4efb15902cd19bcaed1971e4feac2449c2db014b144d65a0"><div class="ttname"><a href="../../d0/d0c/http__websocket_8h.html#a8cb89d2edeb737bfc4efb15902cd19bcaed1971e4feac2449c2db014b144d65a0">AST_WEBSOCKET_OPCODE_TEXT</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d0c/http__websocket_8h_source.html#l00051">http_websocket.h:51</a></div></div>
<div class="ttc" id="astmm_8h_html_aa1202a8277cd3013d22535bf5bfe85fc"><div class="ttname"><a href="../../d8/d8a/astmm_8h.html#aa1202a8277cd3013d22535bf5bfe85fc">ast_strndup</a></div><div class="ttdeci">#define ast_strndup(str, len)</div><div class="ttdoc">A wrapper for strndup() </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d8a/astmm_8h_source.html#l00258">astmm.h:258</a></div></div>
<div class="ttc" id="http__websocket_8h_html_a8cb89d2edeb737bfc4efb15902cd19bca3bca61f5d957c1f62fb7dbec2bbf2db3"><div class="ttname"><a href="../../d0/d0c/http__websocket_8h.html#a8cb89d2edeb737bfc4efb15902cd19bca3bca61f5d957c1f62fb7dbec2bbf2db3">AST_WEBSOCKET_OPCODE_CONTINUATION</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d0c/http__websocket_8h_source.html#l00056">http_websocket.h:56</a></div></div>
<div class="ttc" id="http__websocket_8h_html_a8cb89d2edeb737bfc4efb15902cd19bc"><div class="ttname"><a href="../../d0/d0c/http__websocket_8h.html#a8cb89d2edeb737bfc4efb15902cd19bc">ast_websocket_opcode</a></div><div class="ttdeci">ast_websocket_opcode</div><div class="ttdoc">WebSocket operation codes. </div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d0c/http__websocket_8h_source.html#l00050">http_websocket.h:50</a></div></div>
<div class="ttc" id="http__websocket_8h_html_a8cb89d2edeb737bfc4efb15902cd19bca29a4cd6349c34f5799bd88dd238d3ec7"><div class="ttname"><a href="../../d0/d0c/http__websocket_8h.html#a8cb89d2edeb737bfc4efb15902cd19bca29a4cd6349c34f5799bd88dd238d3ec7">AST_WEBSOCKET_OPCODE_PING</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d0c/http__websocket_8h_source.html#l00053">http_websocket.h:53</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a758d45d0bdc3f7f5335975dc1c107b29"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a758d45d0bdc3f7f5335975dc1c107b29">&#9670;&nbsp;</a></span>ast_websocket_reconstruct_disable()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="../../df/d3c/optional__api_8h.html#abe6ec88934f99eb74444f6c4a92353ec">AST_OPTIONAL_API_NAME</a>() ast_websocket_reconstruct_disable </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="../../db/db6/structast__websocket.html">ast_websocket</a> *&#160;</td>
          <td class="paramname"><em>session</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html#l00446">446</a> of file <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html">res_http_websocket.c</a>.</p>

<p class="reference">References <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html#l00095">ast_websocket::reconstruct</a>.</p>
<div class="fragment"><div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;{</div><div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;   session-&gt;<a class="code" href="../../db/db6/structast__websocket.html#ae2c11c04c7f747de8619a46a721bd63d">reconstruct</a> = 0;</div><div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;}</div><div class="ttc" id="structast__websocket_html_ae2c11c04c7f747de8619a46a721bd63d"><div class="ttname"><a href="../../db/db6/structast__websocket.html#ae2c11c04c7f747de8619a46a721bd63d">ast_websocket::reconstruct</a></div><div class="ttdeci">size_t reconstruct</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d4c/res__http__websocket_8c_source.html#l00095">res_http_websocket.c:95</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a27573aab975ea1367611f7edc085772f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a27573aab975ea1367611f7edc085772f">&#9670;&nbsp;</a></span>ast_websocket_reconstruct_enable()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="../../df/d3c/optional__api_8h.html#abe6ec88934f99eb74444f6c4a92353ec">AST_OPTIONAL_API_NAME</a>() ast_websocket_reconstruct_enable </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="../../db/db6/structast__websocket.html">ast_websocket</a> *&#160;</td>
          <td class="paramname"><em>session</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>bytes</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html#l00441">441</a> of file <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html">res_http_websocket.c</a>.</p>

<p class="reference">References <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html#l00074">MAXIMUM_RECONSTRUCTION_CEILING</a>, <a class="el" href="../../d5/d60/utils_8h_source.html#l00226">MIN</a>, and <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html#l00095">ast_websocket::reconstruct</a>.</p>
<div class="fragment"><div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;{</div><div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;   session-&gt;<a class="code" href="../../db/db6/structast__websocket.html#ae2c11c04c7f747de8619a46a721bd63d">reconstruct</a> = <a class="code" href="../../d5/d60/utils_8h.html#a3acffbd305ee72dcd4593c0d8af64a4f">MIN</a>(bytes, <a class="code" href="../../de/d4c/res__http__websocket_8c.html#afeaf5a5b74a2ae7bcdb585b6d57be576">MAXIMUM_RECONSTRUCTION_CEILING</a>);</div><div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;}</div><div class="ttc" id="structast__websocket_html_ae2c11c04c7f747de8619a46a721bd63d"><div class="ttname"><a href="../../db/db6/structast__websocket.html#ae2c11c04c7f747de8619a46a721bd63d">ast_websocket::reconstruct</a></div><div class="ttdeci">size_t reconstruct</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d4c/res__http__websocket_8c_source.html#l00095">res_http_websocket.c:95</a></div></div>
<div class="ttc" id="utils_8h_html_a3acffbd305ee72dcd4593c0d8af64a4f"><div class="ttname"><a href="../../d5/d60/utils_8h.html#a3acffbd305ee72dcd4593c0d8af64a4f">MIN</a></div><div class="ttdeci">#define MIN(a, b)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d60/utils_8h_source.html#l00226">utils.h:226</a></div></div>
<div class="ttc" id="res__http__websocket_8c_html_afeaf5a5b74a2ae7bcdb585b6d57be576"><div class="ttname"><a href="../../de/d4c/res__http__websocket_8c.html#afeaf5a5b74a2ae7bcdb585b6d57be576">MAXIMUM_RECONSTRUCTION_CEILING</a></div><div class="ttdeci">#define MAXIMUM_RECONSTRUCTION_CEILING</div><div class="ttdoc">Maximum reconstruction size for multi-frame payload reconstruction. </div><div class="ttdef"><b>Definition:</b> <a href="../../de/d4c/res__http__websocket_8c_source.html#l00074">res_http_websocket.c:74</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a050ca80ad7ca07b7643d5ffab2474473"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a050ca80ad7ca07b7643d5ffab2474473">&#9670;&nbsp;</a></span>ast_websocket_ref()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="../../df/d3c/optional__api_8h.html#abe6ec88934f99eb74444f6c4a92353ec">AST_OPTIONAL_API_NAME</a>() ast_websocket_ref </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="../../db/db6/structast__websocket.html">ast_websocket</a> *&#160;</td>
          <td class="paramname"><em>session</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html#l00451">451</a> of file <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html">res_http_websocket.c</a>.</p>

<p class="reference">References <a class="el" href="../../d5/da5/astobj2_8h_source.html#l00464">ao2_ref</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../d5/dfe/chan__sip_8c_source.html#l05952">copy_socket_data()</a>, and <a class="el" href="../../d2/db8/res__pjsip__transport__websocket_8c_source.html#l00149">transport_create()</a>.</p>
<div class="fragment"><div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;{</div><div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(session, +1);</div><div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;}</div><div class="ttc" id="astobj2_8h_html_aaca5e8eac39a22f9da1c36fc6c922270"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a></div><div class="ttdeci">#define ao2_ref(o, delta)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l00464">astobj2.h:464</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="aa854546175b8c60844ecdf14c33b6e97"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa854546175b8c60844ecdf14c33b6e97">&#9670;&nbsp;</a></span>ast_websocket_remote_address()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="../../d3/db3/structast__sockaddr.html">ast_sockaddr</a>* <a class="el" href="../../df/d3c/optional__api_8h.html#abe6ec88934f99eb74444f6c4a92353ec">AST_OPTIONAL_API_NAME</a>() ast_websocket_remote_address </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="../../db/db6/structast__websocket.html">ast_websocket</a> *&#160;</td>
          <td class="paramname"><em>session</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html#l00471">471</a> of file <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html">res_http_websocket.c</a>.</p>

<p class="reference">References <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html#l00090">ast_websocket::remote_address</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../d8/d44/ari__websockets_8c_source.html#l00185">ast_ari_websocket_session_get_remote_addr()</a>, <a class="el" href="../../d5/dfe/chan__sip_8c_source.html#l02678">sip_websocket_callback()</a>, <a class="el" href="../../d2/db8/res__pjsip__transport__websocket_8c_source.html#l00149">transport_create()</a>, and <a class="el" href="../../d2/db8/res__pjsip__transport__websocket_8c_source.html#l00280">transport_read()</a>.</p>
<div class="fragment"><div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;{</div><div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;   <span class="keywordflow">return</span> &amp;session-&gt;<a class="code" href="../../db/db6/structast__websocket.html#a9dfcf41ffc851689eea95be7bb1f849a">remote_address</a>;</div><div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;}</div><div class="ttc" id="structast__websocket_html_a9dfcf41ffc851689eea95be7bb1f849a"><div class="ttname"><a href="../../db/db6/structast__websocket.html#a9dfcf41ffc851689eea95be7bb1f849a">ast_websocket::remote_address</a></div><div class="ttdeci">struct ast_sockaddr remote_address</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d4c/res__http__websocket_8c_source.html#l00090">res_http_websocket.c:90</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="ae810879a31a3cc6ef5ccd4b922e1e4ab"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae810879a31a3cc6ef5ccd4b922e1e4ab">&#9670;&nbsp;</a></span>ast_websocket_remove_protocol()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="../../df/d3c/optional__api_8h.html#abe6ec88934f99eb74444f6c4a92353ec">AST_OPTIONAL_API_NAME</a>() ast_websocket_remove_protocol </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>name</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../d0/d0c/http__websocket_8h.html#acc038aba3451ed958627359ea71f156a">ast_websocket_callback</a>&#160;</td>
          <td class="paramname"><em>callback</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html#l01081">1081</a> of file <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html">res_http_websocket.c</a>.</p>

<p class="reference">References <a class="el" href="../../d0/d29/cdr__mysql_8c_source.html#l00074">name</a>, and <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html#l01072">websocket_remove_protocol_internal()</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../d5/dfe/chan__sip_8c_source.html#l32514">reload_config()</a>, and <a class="el" href="../../d5/dfe/chan__sip_8c_source.html#l35708">unload_module()</a>.</p>
<div class="fragment"><div class="line"><a name="l01082"></a><span class="lineno"> 1082</span>&#160;{</div><div class="line"><a name="l01083"></a><span class="lineno"> 1083</span>&#160;   <span class="keywordflow">return</span> <a class="code" href="../../de/d4c/res__http__websocket_8c.html#a43e3b5d71764b9fb2b338fdf53c9c675">websocket_remove_protocol_internal</a>(<a class="code" href="../../d0/d29/cdr__mysql_8c.html#a0980a105ccb863d8008eb6201a51da52">name</a>, callback);</div><div class="line"><a name="l01084"></a><span class="lineno"> 1084</span>&#160;}</div><div class="ttc" id="res__http__websocket_8c_html_a43e3b5d71764b9fb2b338fdf53c9c675"><div class="ttname"><a href="../../de/d4c/res__http__websocket_8c.html#a43e3b5d71764b9fb2b338fdf53c9c675">websocket_remove_protocol_internal</a></div><div class="ttdeci">static int websocket_remove_protocol_internal(const char *name, ast_websocket_callback callback)</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d4c/res__http__websocket_8c_source.html#l01072">res_http_websocket.c:1072</a></div></div>
<div class="ttc" id="cdr__mysql_8c_html_a0980a105ccb863d8008eb6201a51da52"><div class="ttname"><a href="../../d0/d29/cdr__mysql_8c.html#a0980a105ccb863d8008eb6201a51da52">name</a></div><div class="ttdeci">static const char name[]</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d29/cdr__mysql_8c_source.html#l00074">cdr_mysql.c:74</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="ab9a7ca872780104e9155d8d15423cadd"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab9a7ca872780104e9155d8d15423cadd">&#9670;&nbsp;</a></span>ast_websocket_server_add_protocol()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="../../df/d3c/optional__api_8h.html#abe6ec88934f99eb74444f6c4a92353ec">AST_OPTIONAL_API_NAME</a>() ast_websocket_server_add_protocol </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="../../db/d66/structast__websocket__server.html">ast_websocket_server</a> *&#160;</td>
          <td class="paramname"><em>server</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>name</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../d0/d0c/http__websocket_8h.html#acc038aba3451ed958627359ea71f156a">ast_websocket_callback</a>&#160;</td>
          <td class="paramname"><em>callback</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html#l00210">210</a> of file <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html">res_http_websocket.c</a>.</p>

<p class="reference">References <a class="el" href="../../d5/da5/astobj2_8h_source.html#l00464">ao2_ref</a>, <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html#l00232">ast_websocket_server_add_protocol2()</a>, <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html#l00191">ast_websocket_sub_protocol_alloc()</a>, <a class="el" href="../../d0/d29/cdr__mysql_8c_source.html#l00074">name</a>, <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html#l00133">ast_websocket_server::protocols</a>, and <a class="el" href="../../d0/d0c/http__websocket_8h_source.html#l00125">ast_websocket_protocol::session_established</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html#l01043">websocket_add_protocol_internal()</a>.</p>
<div class="fragment"><div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;{</div><div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../dc/dcf/structast__websocket__protocol.html">ast_websocket_protocol</a> *protocol;</div><div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;</div><div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;   <span class="keywordflow">if</span> (!server-&gt;<a class="code" href="../../db/d66/structast__websocket__server.html#a2a8b976c358cd42ed5b5af57499588d3">protocols</a>) {</div><div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;   }</div><div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;</div><div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;   protocol = <a class="code" href="../../de/d4c/res__http__websocket_8c.html#aa9a722be9189021e49edc5f386e085e3">ast_websocket_sub_protocol_alloc</a>(<a class="code" href="../../d0/d29/cdr__mysql_8c.html#a0980a105ccb863d8008eb6201a51da52">name</a>);</div><div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;   <span class="keywordflow">if</span> (!protocol) {</div><div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;   }</div><div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;   protocol-&gt;<a class="code" href="../../dc/dcf/structast__websocket__protocol.html#a28a8c4b888404298aebb5c1774ce1627">session_established</a> = callback;</div><div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;</div><div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../de/d4c/res__http__websocket_8c.html#a2568f59be0945091ec1778c0262297ff">ast_websocket_server_add_protocol2</a>(server, protocol)) {</div><div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;      <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(protocol, -1);</div><div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;   }</div><div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;</div><div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;   <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;}</div><div class="ttc" id="structast__websocket__protocol_html"><div class="ttname"><a href="../../dc/dcf/structast__websocket__protocol.html">ast_websocket_protocol</a></div><div class="ttdoc">A websocket protocol implementation. </div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d0c/http__websocket_8h_source.html#l00112">http_websocket.h:112</a></div></div>
<div class="ttc" id="structast__websocket__server_html_a2a8b976c358cd42ed5b5af57499588d3"><div class="ttname"><a href="../../db/d66/structast__websocket__server.html#a2a8b976c358cd42ed5b5af57499588d3">ast_websocket_server::protocols</a></div><div class="ttdeci">struct ao2_container * protocols</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d4c/res__http__websocket_8c_source.html#l00133">res_http_websocket.c:133</a></div></div>
<div class="ttc" id="astobj2_8h_html_aaca5e8eac39a22f9da1c36fc6c922270"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a></div><div class="ttdeci">#define ao2_ref(o, delta)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l00464">astobj2.h:464</a></div></div>
<div class="ttc" id="res__http__websocket_8c_html_a2568f59be0945091ec1778c0262297ff"><div class="ttname"><a href="../../de/d4c/res__http__websocket_8c.html#a2568f59be0945091ec1778c0262297ff">ast_websocket_server_add_protocol2</a></div><div class="ttdeci">int AST_OPTIONAL_API_NAME() ast_websocket_server_add_protocol2(struct ast_websocket_server *server, struct ast_websocket_protocol *protocol)</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d4c/res__http__websocket_8c_source.html#l00232">res_http_websocket.c:232</a></div></div>
<div class="ttc" id="cdr__mysql_8c_html_a0980a105ccb863d8008eb6201a51da52"><div class="ttname"><a href="../../d0/d29/cdr__mysql_8c.html#a0980a105ccb863d8008eb6201a51da52">name</a></div><div class="ttdeci">static const char name[]</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d29/cdr__mysql_8c_source.html#l00074">cdr_mysql.c:74</a></div></div>
<div class="ttc" id="structast__websocket__protocol_html_a28a8c4b888404298aebb5c1774ce1627"><div class="ttname"><a href="../../dc/dcf/structast__websocket__protocol.html#a28a8c4b888404298aebb5c1774ce1627">ast_websocket_protocol::session_established</a></div><div class="ttdeci">ast_websocket_callback session_established</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d0c/http__websocket_8h_source.html#l00125">http_websocket.h:125</a></div></div>
<div class="ttc" id="res__http__websocket_8c_html_aa9a722be9189021e49edc5f386e085e3"><div class="ttname"><a href="../../de/d4c/res__http__websocket_8c.html#aa9a722be9189021e49edc5f386e085e3">ast_websocket_sub_protocol_alloc</a></div><div class="ttdeci">struct ast_websocket_protocol *AST_OPTIONAL_API_NAME() ast_websocket_sub_protocol_alloc(const char *name)</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d4c/res__http__websocket_8c_source.html#l00191">res_http_websocket.c:191</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a2568f59be0945091ec1778c0262297ff"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2568f59be0945091ec1778c0262297ff">&#9670;&nbsp;</a></span>ast_websocket_server_add_protocol2()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="../../df/d3c/optional__api_8h.html#abe6ec88934f99eb74444f6c4a92353ec">AST_OPTIONAL_API_NAME</a>() ast_websocket_server_add_protocol2 </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="../../db/d66/structast__websocket__server.html">ast_websocket_server</a> *&#160;</td>
          <td class="paramname"><em>server</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="../../dc/dcf/structast__websocket__protocol.html">ast_websocket_protocol</a> *&#160;</td>
          <td class="paramname"><em>protocol</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html#l00232">232</a> of file <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html">res_http_websocket.c</a>.</p>

<p class="reference">References <a class="el" href="../../d5/da5/astobj2_8h_source.html#l01756">ao2_find</a>, <a class="el" href="../../d5/da5/astobj2_8h_source.html#l01572">ao2_link_flags</a>, <a class="el" href="../../d5/da5/astobj2_8h_source.html#l00718">ao2_lock</a>, <a class="el" href="../../d5/da5/astobj2_8h_source.html#l00464">ao2_ref</a>, <a class="el" href="../../d5/da5/astobj2_8h_source.html#l00730">ao2_unlock</a>, <a class="el" href="../../da/df7/astobj2_8c_source.html#l00042">ast_log</a>, <a class="el" href="../../d1/d8c/logger_8h_source.html#l00463">ast_verb</a>, <a class="el" href="../../d0/d0c/http__websocket_8h_source.html#l00119">AST_WEBSOCKET_PROTOCOL_VERSION</a>, <a class="el" href="../../d1/d8c/logger_8h_source.html#l00274">LOG_WARNING</a>, <a class="el" href="../../d5/da5/astobj2_8h_source.html#l01155">OBJ_KEY</a>, <a class="el" href="../../d5/da5/astobj2_8h_source.html#l01067">OBJ_NOLOCK</a>, and <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html#l00133">ast_websocket_server::protocols</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html#l01057">ast_websocket_add_protocol2()</a>, <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html#l00210">ast_websocket_server_add_protocol()</a>, and <a class="el" href="../../d6/d87/res__ari__events_8c_source.html#l00432">load_module()</a>.</p>
<div class="fragment"><div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;{</div><div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../dc/dcf/structast__websocket__protocol.html">ast_websocket_protocol</a> *existing;</div><div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;</div><div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;   <span class="keywordflow">if</span> (!server-&gt;<a class="code" href="../../db/d66/structast__websocket__server.html#a2a8b976c358cd42ed5b5af57499588d3">protocols</a>) {</div><div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;   }</div><div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;</div><div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;   <span class="keywordflow">if</span> (protocol-&gt;<a class="code" href="../../dc/dcf/structast__websocket__protocol.html#a5408ac5df4c170828874e1b10b4c35a0">version</a> != <a class="code" href="../../d0/d0c/http__websocket_8h.html#a5e3f504c5691f3504cb231ac99098f3a">AST_WEBSOCKET_PROTOCOL_VERSION</a>) {</div><div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;WebSocket could not register sub-protocol &#39;%s&#39;: &quot;</span></div><div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;         <span class="stringliteral">&quot;expected version &#39;%u&#39;, got version &#39;%u&#39;\n&quot;</span>,</div><div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;         protocol-&gt;<a class="code" href="../../dc/dcf/structast__websocket__protocol.html#a5ac083a645d964373f022d03df4849c8">name</a>, <a class="code" href="../../d0/d0c/http__websocket_8h.html#a5e3f504c5691f3504cb231ac99098f3a">AST_WEBSOCKET_PROTOCOL_VERSION</a>, protocol-&gt;<a class="code" href="../../dc/dcf/structast__websocket__protocol.html#a5408ac5df4c170828874e1b10b4c35a0">version</a>);</div><div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;   }</div><div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;</div><div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#aa9fdb5d0a6157a56060d9f7279fe6c49">ao2_lock</a>(server-&gt;<a class="code" href="../../db/d66/structast__websocket__server.html#a2a8b976c358cd42ed5b5af57499588d3">protocols</a>);</div><div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;</div><div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;   <span class="comment">/* Ensure a second protocol handler is not registered for the same protocol */</span></div><div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;   existing = <a class="code" href="../../d5/da5/astobj2_8h.html#a911e0703891a9a7aaf73978152092586">ao2_find</a>(server-&gt;<a class="code" href="../../db/d66/structast__websocket__server.html#a2a8b976c358cd42ed5b5af57499588d3">protocols</a>, protocol-&gt;<a class="code" href="../../dc/dcf/structast__websocket__protocol.html#a5ac083a645d964373f022d03df4849c8">name</a>, <a class="code" href="../../d5/da5/astobj2_8h.html#a22f40c733a085f259af94e864ebaa09a">OBJ_KEY</a> | <a class="code" href="../../d5/da5/astobj2_8h.html#ad9d009e87e737af900825b36db55a35ca52efdf13b66ae502e2e20a5f49f068de">OBJ_NOLOCK</a>);</div><div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;   <span class="keywordflow">if</span> (existing) {</div><div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;      <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(existing, -1);</div><div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;      <a class="code" href="../../d5/da5/astobj2_8h.html#a9998bd156b936636a8780385e9a910b2">ao2_unlock</a>(server-&gt;<a class="code" href="../../db/d66/structast__websocket__server.html#a2a8b976c358cd42ed5b5af57499588d3">protocols</a>);</div><div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;   }</div><div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;</div><div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#a7ce8563daf84a18540a86504d165b444">ao2_link_flags</a>(server-&gt;<a class="code" href="../../db/d66/structast__websocket__server.html#a2a8b976c358cd42ed5b5af57499588d3">protocols</a>, protocol, <a class="code" href="../../d5/da5/astobj2_8h.html#ad9d009e87e737af900825b36db55a35ca52efdf13b66ae502e2e20a5f49f068de">OBJ_NOLOCK</a>);</div><div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#a9998bd156b936636a8780385e9a910b2">ao2_unlock</a>(server-&gt;<a class="code" href="../../db/d66/structast__websocket__server.html#a2a8b976c358cd42ed5b5af57499588d3">protocols</a>);</div><div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;</div><div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;   <a class="code" href="../../d1/d8c/logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(2, <span class="stringliteral">&quot;WebSocket registered sub-protocol &#39;%s&#39;\n&quot;</span>, protocol-&gt;<a class="code" href="../../dc/dcf/structast__websocket__protocol.html#a5ac083a645d964373f022d03df4849c8">name</a>);</div><div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(protocol, -1);</div><div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;</div><div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;   <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;}</div><div class="ttc" id="structast__websocket__protocol_html"><div class="ttname"><a href="../../dc/dcf/structast__websocket__protocol.html">ast_websocket_protocol</a></div><div class="ttdoc">A websocket protocol implementation. </div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d0c/http__websocket_8h_source.html#l00112">http_websocket.h:112</a></div></div>
<div class="ttc" id="astobj2_8h_html_a22f40c733a085f259af94e864ebaa09a"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#a22f40c733a085f259af94e864ebaa09a">OBJ_KEY</a></div><div class="ttdeci">#define OBJ_KEY</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l01155">astobj2.h:1155</a></div></div>
<div class="ttc" id="logger_8h_html_adf4476a6a4ea6c74231c826e899d7189"><div class="ttname"><a href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a></div><div class="ttdeci">#define LOG_WARNING</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d8c/logger_8h_source.html#l00274">logger.h:274</a></div></div>
<div class="ttc" id="astobj2_8h_html_ad9d009e87e737af900825b36db55a35ca52efdf13b66ae502e2e20a5f49f068de"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#ad9d009e87e737af900825b36db55a35ca52efdf13b66ae502e2e20a5f49f068de">OBJ_NOLOCK</a></div><div class="ttdoc">Assume that the ao2_container is already locked. </div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l01067">astobj2.h:1067</a></div></div>
<div class="ttc" id="structast__websocket__server_html_a2a8b976c358cd42ed5b5af57499588d3"><div class="ttname"><a href="../../db/d66/structast__websocket__server.html#a2a8b976c358cd42ed5b5af57499588d3">ast_websocket_server::protocols</a></div><div class="ttdeci">struct ao2_container * protocols</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d4c/res__http__websocket_8c_source.html#l00133">res_http_websocket.c:133</a></div></div>
<div class="ttc" id="astobj2_8h_html_a7ce8563daf84a18540a86504d165b444"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#a7ce8563daf84a18540a86504d165b444">ao2_link_flags</a></div><div class="ttdeci">#define ao2_link_flags(container, obj, flags)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l01572">astobj2.h:1572</a></div></div>
<div class="ttc" id="astobj2_8h_html_a9998bd156b936636a8780385e9a910b2"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#a9998bd156b936636a8780385e9a910b2">ao2_unlock</a></div><div class="ttdeci">#define ao2_unlock(a)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l00730">astobj2.h:730</a></div></div>
<div class="ttc" id="logger_8h_html_ad770f83c71e237e1f64163358ce4e13d"><div class="ttname"><a href="../../d1/d8c/logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a></div><div class="ttdeci">#define ast_verb(level,...)</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d8c/logger_8h_source.html#l00463">logger.h:463</a></div></div>
<div class="ttc" id="astobj2_8c_html_a96a00b3a518d7f32b6d51dc28f09bf9b"><div class="ttname"><a href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a></div><div class="ttdeci">#define ast_log</div><div class="ttdef"><b>Definition:</b> <a href="../../da/df7/astobj2_8c_source.html#l00042">astobj2.c:42</a></div></div>
<div class="ttc" id="structast__websocket__protocol_html_a5ac083a645d964373f022d03df4849c8"><div class="ttname"><a href="../../dc/dcf/structast__websocket__protocol.html#a5ac083a645d964373f022d03df4849c8">ast_websocket_protocol::name</a></div><div class="ttdeci">char * name</div><div class="ttdoc">Name of the protocol. </div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d0c/http__websocket_8h_source.html#l00114">http_websocket.h:114</a></div></div>
<div class="ttc" id="astobj2_8h_html_aaca5e8eac39a22f9da1c36fc6c922270"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a></div><div class="ttdeci">#define ao2_ref(o, delta)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l00464">astobj2.h:464</a></div></div>
<div class="ttc" id="astobj2_8h_html_aa9fdb5d0a6157a56060d9f7279fe6c49"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#aa9fdb5d0a6157a56060d9f7279fe6c49">ao2_lock</a></div><div class="ttdeci">#define ao2_lock(a)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l00718">astobj2.h:718</a></div></div>
<div class="ttc" id="astobj2_8h_html_a911e0703891a9a7aaf73978152092586"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#a911e0703891a9a7aaf73978152092586">ao2_find</a></div><div class="ttdeci">#define ao2_find(container, arg, flags)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l01756">astobj2.h:1756</a></div></div>
<div class="ttc" id="http__websocket_8h_html_a5e3f504c5691f3504cb231ac99098f3a"><div class="ttname"><a href="../../d0/d0c/http__websocket_8h.html#a5e3f504c5691f3504cb231ac99098f3a">AST_WEBSOCKET_PROTOCOL_VERSION</a></div><div class="ttdeci">#define AST_WEBSOCKET_PROTOCOL_VERSION</div><div class="ttdoc">Protocol version. This prevents dynamically loadable modules from registering if this struct is chang...</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d0c/http__websocket_8h_source.html#l00119">http_websocket.h:119</a></div></div>
<div class="ttc" id="structast__websocket__protocol_html_a5408ac5df4c170828874e1b10b4c35a0"><div class="ttname"><a href="../../dc/dcf/structast__websocket__protocol.html#a5408ac5df4c170828874e1b10b4c35a0">ast_websocket_protocol::version</a></div><div class="ttdeci">unsigned int version</div><div class="ttdoc">Protocol version. Should be set to /ref AST_WEBSOCKET_PROTOCOL_VERSION. </div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d0c/http__websocket_8h_source.html#l00121">http_websocket.h:121</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a0fb7fcf9b9c1295cb52511a093d0108e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0fb7fcf9b9c1295cb52511a093d0108e">&#9670;&nbsp;</a></span>ast_websocket_server_create()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="../../db/d66/structast__websocket__server.html">ast_websocket_server</a>* <a class="el" href="../../df/d3c/optional__api_8h.html#abe6ec88934f99eb74444f6c4a92353ec">AST_OPTIONAL_API_NAME</a>() ast_websocket_server_create </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html#l00167">167</a> of file <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html">res_http_websocket.c</a>.</p>

<p class="reference">References <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html#l00143">websocket_server_create_impl()</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../d6/d87/res__ari__events_8c_source.html#l00432">load_module()</a>.</p>
<div class="fragment"><div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;{</div><div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;   <span class="keywordflow">return</span> <a class="code" href="../../de/d4c/res__http__websocket_8c.html#aa4a7f78738dfa70961e16bad55a9156e">websocket_server_create_impl</a>();</div><div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;}</div><div class="ttc" id="res__http__websocket_8c_html_aa4a7f78738dfa70961e16bad55a9156e"><div class="ttname"><a href="../../de/d4c/res__http__websocket_8c.html#aa4a7f78738dfa70961e16bad55a9156e">websocket_server_create_impl</a></div><div class="ttdeci">static struct ast_websocket_server * websocket_server_create_impl(void)</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d4c/res__http__websocket_8c_source.html#l00143">res_http_websocket.c:143</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="ac90e98de467636091797a98a5f596b1d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac90e98de467636091797a98a5f596b1d">&#9670;&nbsp;</a></span>ast_websocket_server_remove_protocol()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="../../df/d3c/optional__api_8h.html#abe6ec88934f99eb74444f6c4a92353ec">AST_OPTIONAL_API_NAME</a>() ast_websocket_server_remove_protocol </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="../../db/d66/structast__websocket__server.html">ast_websocket_server</a> *&#160;</td>
          <td class="paramname"><em>server</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>name</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../d0/d0c/http__websocket_8h.html#acc038aba3451ed958627359ea71f156a">ast_websocket_callback</a>&#160;</td>
          <td class="paramname"><em>callback</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html#l00266">266</a> of file <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html">res_http_websocket.c</a>.</p>

<p class="reference">References <a class="el" href="../../d5/da5/astobj2_8h_source.html#l01756">ao2_find</a>, <a class="el" href="../../d5/da5/astobj2_8h_source.html#l00464">ao2_ref</a>, <a class="el" href="../../d5/da5/astobj2_8h_source.html#l01598">ao2_unlink</a>, <a class="el" href="../../d1/d8c/logger_8h_source.html#l00463">ast_verb</a>, <a class="el" href="../../d0/d29/cdr__mysql_8c_source.html#l00074">name</a>, <a class="el" href="../../d5/da5/astobj2_8h_source.html#l01155">OBJ_KEY</a>, <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html#l00133">ast_websocket_server::protocols</a>, and <a class="el" href="../../d0/d0c/http__websocket_8h_source.html#l00125">ast_websocket_protocol::session_established</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html#l01072">websocket_remove_protocol_internal()</a>.</p>
<div class="fragment"><div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;{</div><div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../dc/dcf/structast__websocket__protocol.html">ast_websocket_protocol</a> *protocol;</div><div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;</div><div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;   <span class="keywordflow">if</span> (!(protocol = <a class="code" href="../../d5/da5/astobj2_8h.html#a911e0703891a9a7aaf73978152092586">ao2_find</a>(server-&gt;<a class="code" href="../../db/d66/structast__websocket__server.html#a2a8b976c358cd42ed5b5af57499588d3">protocols</a>, <a class="code" href="../../d0/d29/cdr__mysql_8c.html#a0980a105ccb863d8008eb6201a51da52">name</a>, <a class="code" href="../../d5/da5/astobj2_8h.html#a22f40c733a085f259af94e864ebaa09a">OBJ_KEY</a>))) {</div><div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;   }</div><div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;</div><div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;   <span class="keywordflow">if</span> (protocol-&gt;<a class="code" href="../../dc/dcf/structast__websocket__protocol.html#a28a8c4b888404298aebb5c1774ce1627">session_established</a> != callback) {</div><div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;      <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(protocol, -1);</div><div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;   }</div><div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;</div><div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#a64f51be4bee35c38dbe59b0a788b5ce8">ao2_unlink</a>(server-&gt;<a class="code" href="../../db/d66/structast__websocket__server.html#a2a8b976c358cd42ed5b5af57499588d3">protocols</a>, protocol);</div><div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(protocol, -1);</div><div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;</div><div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;   <a class="code" href="../../d1/d8c/logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(2, <span class="stringliteral">&quot;WebSocket unregistered sub-protocol &#39;%s&#39;\n&quot;</span>, <a class="code" href="../../d0/d29/cdr__mysql_8c.html#a0980a105ccb863d8008eb6201a51da52">name</a>);</div><div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;</div><div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;   <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;}</div><div class="ttc" id="structast__websocket__protocol_html"><div class="ttname"><a href="../../dc/dcf/structast__websocket__protocol.html">ast_websocket_protocol</a></div><div class="ttdoc">A websocket protocol implementation. </div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d0c/http__websocket_8h_source.html#l00112">http_websocket.h:112</a></div></div>
<div class="ttc" id="astobj2_8h_html_a22f40c733a085f259af94e864ebaa09a"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#a22f40c733a085f259af94e864ebaa09a">OBJ_KEY</a></div><div class="ttdeci">#define OBJ_KEY</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l01155">astobj2.h:1155</a></div></div>
<div class="ttc" id="structast__websocket__server_html_a2a8b976c358cd42ed5b5af57499588d3"><div class="ttname"><a href="../../db/d66/structast__websocket__server.html#a2a8b976c358cd42ed5b5af57499588d3">ast_websocket_server::protocols</a></div><div class="ttdeci">struct ao2_container * protocols</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d4c/res__http__websocket_8c_source.html#l00133">res_http_websocket.c:133</a></div></div>
<div class="ttc" id="logger_8h_html_ad770f83c71e237e1f64163358ce4e13d"><div class="ttname"><a href="../../d1/d8c/logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a></div><div class="ttdeci">#define ast_verb(level,...)</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d8c/logger_8h_source.html#l00463">logger.h:463</a></div></div>
<div class="ttc" id="astobj2_8h_html_aaca5e8eac39a22f9da1c36fc6c922270"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a></div><div class="ttdeci">#define ao2_ref(o, delta)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l00464">astobj2.h:464</a></div></div>
<div class="ttc" id="astobj2_8h_html_a64f51be4bee35c38dbe59b0a788b5ce8"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#a64f51be4bee35c38dbe59b0a788b5ce8">ao2_unlink</a></div><div class="ttdeci">#define ao2_unlink(container, obj)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l01598">astobj2.h:1598</a></div></div>
<div class="ttc" id="cdr__mysql_8c_html_a0980a105ccb863d8008eb6201a51da52"><div class="ttname"><a href="../../d0/d29/cdr__mysql_8c.html#a0980a105ccb863d8008eb6201a51da52">name</a></div><div class="ttdeci">static const char name[]</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d29/cdr__mysql_8c_source.html#l00074">cdr_mysql.c:74</a></div></div>
<div class="ttc" id="astobj2_8h_html_a911e0703891a9a7aaf73978152092586"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#a911e0703891a9a7aaf73978152092586">ao2_find</a></div><div class="ttdeci">#define ao2_find(container, arg, flags)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l01756">astobj2.h:1756</a></div></div>
<div class="ttc" id="structast__websocket__protocol_html_a28a8c4b888404298aebb5c1774ce1627"><div class="ttname"><a href="../../dc/dcf/structast__websocket__protocol.html#a28a8c4b888404298aebb5c1774ce1627">ast_websocket_protocol::session_established</a></div><div class="ttdeci">ast_websocket_callback session_established</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d0c/http__websocket_8h_source.html#l00125">http_websocket.h:125</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a74ad35149f76ef1aa536d8dbffa1796c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a74ad35149f76ef1aa536d8dbffa1796c">&#9670;&nbsp;</a></span>ast_websocket_session_id()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">const char* <a class="el" href="../../df/d3c/optional__api_8h.html#abe6ec88934f99eb74444f6c4a92353ec">AST_OPTIONAL_API_NAME</a>() ast_websocket_session_id </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="../../db/db6/structast__websocket.html">ast_websocket</a> *&#160;</td>
          <td class="paramname"><em>session</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html#l00500">500</a> of file <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html">res_http_websocket.c</a>.</p>

<p class="reference">References <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html#l00101">ast_websocket::session_id</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../d8/d44/ari__websockets_8c_source.html#l00203">ast_ari_websocket_session_id()</a>.</p>
<div class="fragment"><div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;{</div><div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;   <span class="keywordflow">return</span> session-&gt;<a class="code" href="../../db/db6/structast__websocket.html#ab37f08d108eaf01324ae3c01436cf687">session_id</a>;</div><div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;}</div><div class="ttc" id="structast__websocket_html_ab37f08d108eaf01324ae3c01436cf687"><div class="ttname"><a href="../../db/db6/structast__websocket.html#ab37f08d108eaf01324ae3c01436cf687">ast_websocket::session_id</a></div><div class="ttdeci">char session_id[AST_UUID_STR_LEN]</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d4c/res__http__websocket_8c_source.html#l00101">res_http_websocket.c:101</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="ab549e9a066a7c7738330e31b0b083177"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab549e9a066a7c7738330e31b0b083177">&#9670;&nbsp;</a></span>ast_websocket_set_nonblock()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="../../df/d3c/optional__api_8h.html#abe6ec88934f99eb74444f6c4a92353ec">AST_OPTIONAL_API_NAME</a>() ast_websocket_set_nonblock </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="../../db/db6/structast__websocket.html">ast_websocket</a> *&#160;</td>
          <td class="paramname"><em>session</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html#l00486">486</a> of file <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html">res_http_websocket.c</a>.</p>

<p class="reference">References <a class="el" href="../../d1/dc8/iostream_8c_source.html#l00103">ast_iostream_nonblock()</a>, <a class="el" href="../../d1/dc8/iostream_8c_source.html#l00148">ast_iostream_set_exclusive_input()</a>, and <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html#l00089">ast_websocket::stream</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../d8/d44/ari__websockets_8c_source.html#l00054">ast_ari_websocket_session_create()</a>, <a class="el" href="../../d5/dfe/chan__sip_8c_source.html#l02678">sip_websocket_callback()</a>, and <a class="el" href="../../d2/db8/res__pjsip__transport__websocket_8c_source.html#l00360">websocket_cb()</a>.</p>
<div class="fragment"><div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;{</div><div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;   <a class="code" href="../../dd/d27/iostream_8h.html#ab426c2063464fc2e2719f8edd9e03085">ast_iostream_nonblock</a>(session-&gt;<a class="code" href="../../db/db6/structast__websocket.html#a36ac2dd734607a43ed90acb7e9d81ac5">stream</a>);</div><div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;   <a class="code" href="../../dd/d27/iostream_8h.html#a7da9c8f9652decad87fdb8d39c4f06df">ast_iostream_set_exclusive_input</a>(session-&gt;<a class="code" href="../../db/db6/structast__websocket.html#a36ac2dd734607a43ed90acb7e9d81ac5">stream</a>, 0);</div><div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;   <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;}</div><div class="ttc" id="iostream_8h_html_a7da9c8f9652decad87fdb8d39c4f06df"><div class="ttname"><a href="../../dd/d27/iostream_8h.html#a7da9c8f9652decad87fdb8d39c4f06df">ast_iostream_set_exclusive_input</a></div><div class="ttdeci">void ast_iostream_set_exclusive_input(struct ast_iostream *stream, int exclusive_input)</div><div class="ttdoc">Set the iostream if it can exclusively depend upon the set timeouts. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/dc8/iostream_8c_source.html#l00148">iostream.c:148</a></div></div>
<div class="ttc" id="structast__websocket_html_a36ac2dd734607a43ed90acb7e9d81ac5"><div class="ttname"><a href="../../db/db6/structast__websocket.html#a36ac2dd734607a43ed90acb7e9d81ac5">ast_websocket::stream</a></div><div class="ttdeci">struct ast_iostream * stream</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d4c/res__http__websocket_8c_source.html#l00089">res_http_websocket.c:89</a></div></div>
<div class="ttc" id="iostream_8h_html_ab426c2063464fc2e2719f8edd9e03085"><div class="ttname"><a href="../../dd/d27/iostream_8h.html#ab426c2063464fc2e2719f8edd9e03085">ast_iostream_nonblock</a></div><div class="ttdeci">void ast_iostream_nonblock(struct ast_iostream *stream)</div><div class="ttdoc">Make an iostream non-blocking. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/dc8/iostream_8c_source.html#l00103">iostream.c:103</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="adc1ab49fc86302e5de5b0c25308ad2da"></a>
<h2 class="memtitle"><span class="permalink"><a href="#adc1ab49fc86302e5de5b0c25308ad2da">&#9670;&nbsp;</a></span>ast_websocket_set_timeout()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="../../df/d3c/optional__api_8h.html#abe6ec88934f99eb74444f6c4a92353ec">AST_OPTIONAL_API_NAME</a>() ast_websocket_set_timeout </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="../../db/db6/structast__websocket.html">ast_websocket</a> *&#160;</td>
          <td class="paramname"><em>session</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>timeout</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html#l00493">493</a> of file <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html">res_http_websocket.c</a>.</p>

<p class="reference">References <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html#l00096">ast_websocket::timeout</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../d8/d44/ari__websockets_8c_source.html#l00054">ast_ari_websocket_session_create()</a>, <a class="el" href="../../d5/dfe/chan__sip_8c_source.html#l02678">sip_websocket_callback()</a>, and <a class="el" href="../../d2/db8/res__pjsip__transport__websocket_8c_source.html#l00360">websocket_cb()</a>.</p>
<div class="fragment"><div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;{</div><div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;   session-&gt;<a class="code" href="../../db/db6/structast__websocket.html#a493b57f443cc38b3d3df9c1e584d9d82">timeout</a> = <a class="code" href="../../d0/d29/cdr__mysql_8c.html#a493b57f443cc38b3d3df9c1e584d9d82">timeout</a>;</div><div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;</div><div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;   <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;}</div><div class="ttc" id="cdr__mysql_8c_html_a493b57f443cc38b3d3df9c1e584d9d82"><div class="ttname"><a href="../../d0/d29/cdr__mysql_8c.html#a493b57f443cc38b3d3df9c1e584d9d82">timeout</a></div><div class="ttdeci">static int timeout</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d29/cdr__mysql_8c_source.html#l00086">cdr_mysql.c:86</a></div></div>
<div class="ttc" id="structast__websocket_html_a493b57f443cc38b3d3df9c1e584d9d82"><div class="ttname"><a href="../../db/db6/structast__websocket.html#a493b57f443cc38b3d3df9c1e584d9d82">ast_websocket::timeout</a></div><div class="ttdeci">int timeout</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d4c/res__http__websocket_8c_source.html#l00096">res_http_websocket.c:96</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="aa9a722be9189021e49edc5f386e085e3"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa9a722be9189021e49edc5f386e085e3">&#9670;&nbsp;</a></span>ast_websocket_sub_protocol_alloc()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="../../dc/dcf/structast__websocket__protocol.html">ast_websocket_protocol</a>* <a class="el" href="../../df/d3c/optional__api_8h.html#abe6ec88934f99eb74444f6c4a92353ec">AST_OPTIONAL_API_NAME</a>() ast_websocket_sub_protocol_alloc </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>name</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html#l00191">191</a> of file <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html">res_http_websocket.c</a>.</p>

<p class="reference">References <a class="el" href="../../d5/da5/astobj2_8h_source.html#l00411">ao2_alloc</a>, <a class="el" href="../../d5/da5/astobj2_8h_source.html#l00464">ao2_ref</a>, <a class="el" href="../../d8/d8a/astmm_8h_source.html#l00243">ast_strdup</a>, <a class="el" href="../../d0/d0c/http__websocket_8h_source.html#l00119">AST_WEBSOCKET_PROTOCOL_VERSION</a>, <a class="el" href="../../d0/d29/cdr__mysql_8c_source.html#l00074">name</a>, <a class="el" href="../../d0/d0c/http__websocket_8h_source.html#l00114">ast_websocket_protocol::name</a>, <a class="el" href="../../dc/d7f/resample_8c_source.html#l00096">NULL</a>, <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html#l00125">protocol_destroy_fn()</a>, and <a class="el" href="../../d0/d0c/http__websocket_8h_source.html#l00121">ast_websocket_protocol::version</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html#l00210">ast_websocket_server_add_protocol()</a>, and <a class="el" href="../../d6/d87/res__ari__events_8c_source.html#l00432">load_module()</a>.</p>
<div class="fragment"><div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;{</div><div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../dc/dcf/structast__websocket__protocol.html">ast_websocket_protocol</a> *protocol;</div><div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;</div><div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;   protocol = <a class="code" href="../../d5/da5/astobj2_8h.html#ae0422b60d8e25b6962b2d61ae4ddf724">ao2_alloc</a>(<span class="keyword">sizeof</span>(*protocol), <a class="code" href="../../de/d4c/res__http__websocket_8c.html#a8e476c76d070ad965d9f7cc6e6063cbf">protocol_destroy_fn</a>);</div><div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;   <span class="keywordflow">if</span> (!protocol) {</div><div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;   }</div><div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;</div><div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;   protocol-&gt;<a class="code" href="../../dc/dcf/structast__websocket__protocol.html#a5ac083a645d964373f022d03df4849c8">name</a> = <a class="code" href="../../d8/d8a/astmm_8h.html#ab263849d03fb892847be4986db759737">ast_strdup</a>(<a class="code" href="../../d0/d29/cdr__mysql_8c.html#a0980a105ccb863d8008eb6201a51da52">name</a>);</div><div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;   <span class="keywordflow">if</span> (!protocol-&gt;<a class="code" href="../../dc/dcf/structast__websocket__protocol.html#a5ac083a645d964373f022d03df4849c8">name</a>) {</div><div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;      <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(protocol, -1);</div><div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;   }</div><div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;   protocol-&gt;<a class="code" href="../../dc/dcf/structast__websocket__protocol.html#a5408ac5df4c170828874e1b10b4c35a0">version</a> = <a class="code" href="../../d0/d0c/http__websocket_8h.html#a5e3f504c5691f3504cb231ac99098f3a">AST_WEBSOCKET_PROTOCOL_VERSION</a>;</div><div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;</div><div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;   <span class="keywordflow">return</span> protocol;</div><div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;}</div><div class="ttc" id="structast__websocket__protocol_html"><div class="ttname"><a href="../../dc/dcf/structast__websocket__protocol.html">ast_websocket_protocol</a></div><div class="ttdoc">A websocket protocol implementation. </div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d0c/http__websocket_8h_source.html#l00112">http_websocket.h:112</a></div></div>
<div class="ttc" id="astmm_8h_html_ab263849d03fb892847be4986db759737"><div class="ttname"><a href="../../d8/d8a/astmm_8h.html#ab263849d03fb892847be4986db759737">ast_strdup</a></div><div class="ttdeci">#define ast_strdup(str)</div><div class="ttdoc">A wrapper for strdup() </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d8a/astmm_8h_source.html#l00243">astmm.h:243</a></div></div>
<div class="ttc" id="resample_8c_html_a070d2ce7b6bb7e5c05602aa8c308d0c4"><div class="ttname"><a href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a></div><div class="ttdeci">#define NULL</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d7f/resample_8c_source.html#l00096">resample.c:96</a></div></div>
<div class="ttc" id="structast__websocket__protocol_html_a5ac083a645d964373f022d03df4849c8"><div class="ttname"><a href="../../dc/dcf/structast__websocket__protocol.html#a5ac083a645d964373f022d03df4849c8">ast_websocket_protocol::name</a></div><div class="ttdeci">char * name</div><div class="ttdoc">Name of the protocol. </div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d0c/http__websocket_8h_source.html#l00114">http_websocket.h:114</a></div></div>
<div class="ttc" id="astobj2_8h_html_aaca5e8eac39a22f9da1c36fc6c922270"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a></div><div class="ttdeci">#define ao2_ref(o, delta)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l00464">astobj2.h:464</a></div></div>
<div class="ttc" id="astobj2_8h_html_ae0422b60d8e25b6962b2d61ae4ddf724"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#ae0422b60d8e25b6962b2d61ae4ddf724">ao2_alloc</a></div><div class="ttdeci">#define ao2_alloc(data_size, destructor_fn)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l00411">astobj2.h:411</a></div></div>
<div class="ttc" id="cdr__mysql_8c_html_a0980a105ccb863d8008eb6201a51da52"><div class="ttname"><a href="../../d0/d29/cdr__mysql_8c.html#a0980a105ccb863d8008eb6201a51da52">name</a></div><div class="ttdeci">static const char name[]</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d29/cdr__mysql_8c_source.html#l00074">cdr_mysql.c:74</a></div></div>
<div class="ttc" id="res__http__websocket_8c_html_a8e476c76d070ad965d9f7cc6e6063cbf"><div class="ttname"><a href="../../de/d4c/res__http__websocket_8c.html#a8e476c76d070ad965d9f7cc6e6063cbf">protocol_destroy_fn</a></div><div class="ttdeci">static void protocol_destroy_fn(void *obj)</div><div class="ttdoc">Destructor function for protocols. </div><div class="ttdef"><b>Definition:</b> <a href="../../de/d4c/res__http__websocket_8c_source.html#l00125">res_http_websocket.c:125</a></div></div>
<div class="ttc" id="http__websocket_8h_html_a5e3f504c5691f3504cb231ac99098f3a"><div class="ttname"><a href="../../d0/d0c/http__websocket_8h.html#a5e3f504c5691f3504cb231ac99098f3a">AST_WEBSOCKET_PROTOCOL_VERSION</a></div><div class="ttdeci">#define AST_WEBSOCKET_PROTOCOL_VERSION</div><div class="ttdoc">Protocol version. This prevents dynamically loadable modules from registering if this struct is chang...</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d0c/http__websocket_8h_source.html#l00119">http_websocket.h:119</a></div></div>
<div class="ttc" id="structast__websocket__protocol_html_a5408ac5df4c170828874e1b10b4c35a0"><div class="ttname"><a href="../../dc/dcf/structast__websocket__protocol.html#a5408ac5df4c170828874e1b10b4c35a0">ast_websocket_protocol::version</a></div><div class="ttdeci">unsigned int version</div><div class="ttdoc">Protocol version. Should be set to /ref AST_WEBSOCKET_PROTOCOL_VERSION. </div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d0c/http__websocket_8h_source.html#l00121">http_websocket.h:121</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="af03daa0a59002330aacdfcb44da59db9"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af03daa0a59002330aacdfcb44da59db9">&#9670;&nbsp;</a></span>ast_websocket_unref()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="../../df/d3c/optional__api_8h.html#abe6ec88934f99eb74444f6c4a92353ec">AST_OPTIONAL_API_NAME</a>() ast_websocket_unref </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="../../db/db6/structast__websocket.html">ast_websocket</a> *&#160;</td>
          <td class="paramname"><em>session</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html#l00456">456</a> of file <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html">res_http_websocket.c</a>.</p>

<p class="reference">References <a class="el" href="../../d5/da5/astobj2_8h_source.html#l01958">ao2_cleanup</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../d6/d87/res__ari__events_8c_source.html#l00144">ast_ari_events_event_websocket_ws_established_cb()</a>, <a class="el" href="../../d5/dfe/chan__sip_8c_source.html#l05952">copy_socket_data()</a>, <a class="el" href="../../d5/dfe/chan__sip_8c_source.html#l16646">expire_register()</a>, <a class="el" href="../../d5/dfe/chan__sip_8c_source.html#l23617">parse_moved_contact()</a>, <a class="el" href="../../d5/dfe/chan__sip_8c_source.html#l16629">set_socket_transport()</a>, <a class="el" href="../../d5/dfe/chan__sip_8c_source.html#l05309">sip_destroy_peer()</a>, <a class="el" href="../../d5/dfe/chan__sip_8c_source.html#l06673">sip_pvt_dtor()</a>, <a class="el" href="../../d5/dfe/chan__sip_8c_source.html#l02678">sip_websocket_callback()</a>, <a class="el" href="../../d2/db8/res__pjsip__transport__websocket_8c_source.html#l00100">transport_dtor()</a>, <a class="el" href="../../d2/db8/res__pjsip__transport__websocket_8c_source.html#l00360">websocket_cb()</a>, <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html#l01007">websocket_echo_callback()</a>, and <a class="el" href="../../d8/d44/ari__websockets_8c_source.html#l00038">websocket_session_dtor()</a>.</p>
<div class="fragment"><div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;{</div><div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#a6321ee982370c55ab3c24c72c562cbdd">ao2_cleanup</a>(session);</div><div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;}</div><div class="ttc" id="astobj2_8h_html_a6321ee982370c55ab3c24c72c562cbdd"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#a6321ee982370c55ab3c24c72c562cbdd">ao2_cleanup</a></div><div class="ttdeci">#define ao2_cleanup(obj)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l01958">astobj2.h:1958</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a62e15263be35efd221046ddd8d7a93db"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a62e15263be35efd221046ddd8d7a93db">&#9670;&nbsp;</a></span>ast_websocket_uri_cb()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="../../df/d3c/optional__api_8h.html#abe6ec88934f99eb74444f6c4a92353ec">AST_OPTIONAL_API_NAME</a>() ast_websocket_uri_cb </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="../../d6/d49/structast__tcptls__session__instance.html">ast_tcptls_session_instance</a> *&#160;</td>
          <td class="paramname"><em>ser</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const struct <a class="el" href="../../d0/d6c/structast__http__uri.html">ast_http_uri</a> *&#160;</td>
          <td class="paramname"><em>urih</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>uri</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">enum <a class="el" href="../../dd/d56/http_8h.html#a16fb43ed7e6093a9dc96477ba37b80ef">ast_http_method</a>&#160;</td>
          <td class="paramname"><em>method</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="../../dd/d02/structast__variable.html">ast_variable</a> *&#160;</td>
          <td class="paramname"><em>get_vars</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="../../dd/d02/structast__variable.html">ast_variable</a> *&#160;</td>
          <td class="paramname"><em>headers</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html#l00790">790</a> of file <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html">res_http_websocket.c</a>.</p>

<p class="reference">References <a class="el" href="../../d5/da5/astobj2_8h_source.html#l00411">ao2_alloc</a>, <a class="el" href="../../d5/da5/astobj2_8h_source.html#l01756">ao2_find</a>, <a class="el" href="../../d5/da5/astobj2_8h_source.html#l00464">ao2_ref</a>, <a class="el" href="../../d1/d8c/logger_8h_source.html#l00452">ast_debug</a>, <a class="el" href="../../d0/d0c/http__websocket_8h_source.html#l00028">AST_DEFAULT_WEBSOCKET_WRITE_TIMEOUT</a>, <a class="el" href="../../d4/d27/netsock2_8c_source.html#l00600">ast_getsockname()</a>, <a class="el" href="../../dd/d43/http_8c_source.html#l01120">ast_http_body_discard()</a>, <a class="el" href="../../dd/d43/http_8c_source.html#l00648">ast_http_error()</a>, <a class="el" href="../../dd/d56/http_8h_source.html#l00058">AST_HTTP_GET</a>, <a class="el" href="../../d1/dc8/iostream_8c_source.html#l00084">ast_iostream_get_fd()</a>, <a class="el" href="../../d1/dc8/iostream_8c_source.html#l00108">ast_iostream_get_ssl()</a>, <a class="el" href="../../d1/dc8/iostream_8c_source.html#l00491">ast_iostream_printf()</a>, <a class="el" href="../../d1/dc8/iostream_8c_source.html#l00148">ast_iostream_set_exclusive_input()</a>, <a class="el" href="../../da/df7/astobj2_8c_source.html#l00042">ast_log</a>, <a class="el" href="../../db/df1/netsock2_8h_source.html#l00171">ast_sockaddr_copy()</a>, <a class="el" href="../../db/df1/netsock2_8h_source.html#l00260">ast_sockaddr_stringify()</a>, <a class="el" href="../../d8/d8a/astmm_8h_source.html#l00300">ast_strdupa</a>, <a class="el" href="../../d6/d90/strings_8h_source.html#l00219">ast_strip()</a>, <a class="el" href="../../d6/d90/strings_8h_source.html#l00052">ast_strlen_zero</a>, <a class="el" href="../../df/da9/uuid_8c_source.html#l00143">ast_uuid_generate_str()</a>, <a class="el" href="../../dd/d1d/uuid_8h_source.html#l00027">AST_UUID_STR_LEN</a>, <a class="el" href="../../d1/d8c/logger_8h_source.html#l00463">ast_verb</a>, <a class="el" href="../../de/d1f/main_2utils_8c_source.html#l00078">base64</a>, <a class="el" href="../../dd/d56/http_8h_source.html#l00114">ast_http_uri::data</a>, <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html#l00071">DEFAULT_RECONSTRUCTION_CEILING</a>, <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html#l00091">ast_websocket::local_address</a>, <a class="el" href="../../d1/d8c/logger_8h_source.html#l00274">LOG_WARNING</a>, <a class="el" href="../../de/d96/res__pjsip_8c_source.html#l04335">method</a>, <a class="el" href="../../d3/de6/include_2asterisk_2config_8h_source.html#l00085">ast_variable::name</a>, <a class="el" href="../../d0/d0c/http__websocket_8h_source.html#l00114">ast_websocket_protocol::name</a>, <a class="el" href="../../d3/de6/include_2asterisk_2config_8h_source.html#l00090">ast_variable::next</a>, <a class="el" href="../../dc/d7f/resample_8c_source.html#l00096">NULL</a>, <a class="el" href="../../d5/da5/astobj2_8h_source.html#l01155">OBJ_KEY</a>, <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html#l00752">one_protocol()</a>, <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html#l00092">ast_websocket::opcode</a>, <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html#l00133">ast_websocket_server::protocols</a>, <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html#l00095">ast_websocket::reconstruct</a>, <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html#l00090">ast_websocket::remote_address</a>, <a class="el" href="../../d4/ddf/tcptls_8h_source.html#l00151">ast_tcptls_session_instance::remote_address</a>, <a class="el" href="../../d5/d16/module_8h_source.html#l00665">SCOPED_MODULE_USE</a>, <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html#l00097">ast_websocket::secure</a>, <a class="el" href="../../d5/d16/module_8h_source.html#l00342">ast_module_info::self</a>, <a class="el" href="../../d2/d4d/astman_8c.html#ac4a6ae0400e4457f0b35beddec80c93d">session</a>, <a class="el" href="../../d0/d0c/http__websocket_8h_source.html#l00123">ast_websocket_protocol::session_attempted</a>, <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html#l00173">session_destroy_fn()</a>, <a class="el" href="../../d0/d0c/http__websocket_8h_source.html#l00125">ast_websocket_protocol::session_established</a>, <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html#l00101">ast_websocket::session_id</a>, <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html#l00089">ast_websocket::stream</a>, <a class="el" href="../../d4/ddf/tcptls_8h_source.html#l00160">ast_tcptls_session_instance::stream</a>, <a class="el" href="../../de/da3/include_2asterisk_2compat_8h.html#a40eca58273c74a20a17f137d18ba826c">strsep()</a>, <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html#l00096">ast_websocket::timeout</a>, <a class="el" href="../../d2/d4e/210693f3123d__create__cdr__table_8py_source.html#l00035">210693f3123d_create_cdr_table::upgrade()</a>, <a class="el" href="../../d3/de6/include_2asterisk_2config_8h_source.html#l00087">ast_variable::value</a>, <a class="el" href="../../d7/d49/chan__ooh323_8c_source.html#l00391">version</a>, <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html#l00777">websocket_bad_request()</a>, <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html#l00764">websocket_combine_key()</a>, and <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html#l00045">WEBSOCKET_GUID</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../d8/d44/ari__websockets_8c_source.html#l00191">ari_handle_websocket()</a>.</p>
<div class="fragment"><div class="line"><a name="l00791"></a><span class="lineno">  791</span>&#160;{</div><div class="line"><a name="l00792"></a><span class="lineno">  792</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../dd/d02/structast__variable.html">ast_variable</a> *v;</div><div class="line"><a name="l00793"></a><span class="lineno">  793</span>&#160;   <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="../../da/dbd/namespace210693f3123d__create__cdr__table.html#a0a72b5f19c7dbcbdba704ca0722af707">upgrade</a> = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, *key = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, *key1 = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, *key2 = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, *protos = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l00794"></a><span class="lineno">  794</span>&#160;   <span class="keywordtype">char</span> *requested_protocols = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, *protocol = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l00795"></a><span class="lineno">  795</span>&#160;   <span class="keywordtype">int</span> <a class="code" href="../../d7/d49/chan__ooh323_8c.html#a81b4b1c3c855fb371e7723b473f1ee78">version</a> = 0, flags = 1;</div><div class="line"><a name="l00796"></a><span class="lineno">  796</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../dc/dcf/structast__websocket__protocol.html">ast_websocket_protocol</a> *protocol_handler = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l00797"></a><span class="lineno">  797</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../db/db6/structast__websocket.html">ast_websocket</a> *<a class="code" href="../../d2/d4d/astman_8c.html#ac4a6ae0400e4457f0b35beddec80c93d">session</a>;</div><div class="line"><a name="l00798"></a><span class="lineno">  798</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../db/d66/structast__websocket__server.html">ast_websocket_server</a> *server;</div><div class="line"><a name="l00799"></a><span class="lineno">  799</span>&#160;</div><div class="line"><a name="l00800"></a><span class="lineno">  800</span>&#160;   <a class="code" href="../../d5/d16/module_8h.html#a0fb39465480454778b4b070505a4eabb">SCOPED_MODULE_USE</a>(<a class="code" href="../../dd/d5f/structast__module__info.html">ast_module_info</a>-&gt;<a class="code" href="../../dd/d5f/structast__module__info.html#a1aff0615d43e1dfa5c72c1c7d1c6d709">self</a>);</div><div class="line"><a name="l00801"></a><span class="lineno">  801</span>&#160;</div><div class="line"><a name="l00802"></a><span class="lineno">  802</span>&#160;   <span class="comment">/* Upgrade requests are only permitted on GET methods */</span></div><div class="line"><a name="l00803"></a><span class="lineno">  803</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../de/d96/res__pjsip_8c.html#a8b44a03925325ceaf2de7b079b1541a1">method</a> != <a class="code" href="../../dd/d56/http_8h.html#a16fb43ed7e6093a9dc96477ba37b80efa74b1cb5c2ecb5e0bd9af5d46a7b78fd2">AST_HTTP_GET</a>) {</div><div class="line"><a name="l00804"></a><span class="lineno">  804</span>&#160;      <a class="code" href="../../dd/d56/http_8h.html#ab0f7966324a592e02d53f01e7bb9cc17">ast_http_error</a>(ser, 501, <span class="stringliteral">&quot;Not Implemented&quot;</span>, <span class="stringliteral">&quot;Attempt to use unimplemented / unsupported method&quot;</span>);</div><div class="line"><a name="l00805"></a><span class="lineno">  805</span>&#160;      <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00806"></a><span class="lineno">  806</span>&#160;   }</div><div class="line"><a name="l00807"></a><span class="lineno">  807</span>&#160;</div><div class="line"><a name="l00808"></a><span class="lineno">  808</span>&#160;   server = urih-&gt;<a class="code" href="../../d0/d6c/structast__http__uri.html#a735984d41155bc1032e09bece8f8d66d">data</a>;</div><div class="line"><a name="l00809"></a><span class="lineno">  809</span>&#160;</div><div class="line"><a name="l00810"></a><span class="lineno">  810</span>&#160;   <span class="comment">/* Get the minimum headers required to satisfy our needs */</span></div><div class="line"><a name="l00811"></a><span class="lineno">  811</span>&#160;   <span class="keywordflow">for</span> (v = headers; v; v = v-&gt;<a class="code" href="../../dd/d02/structast__variable.html#afaaf66cc5029a563bd0bb9df076ea14b">next</a>) {</div><div class="line"><a name="l00812"></a><span class="lineno">  812</span>&#160;      <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="../../dd/d02/structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;Upgrade&quot;</span>)) {</div><div class="line"><a name="l00813"></a><span class="lineno">  813</span>&#160;         upgrade = v-&gt;<a class="code" href="../../dd/d02/structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>;</div><div class="line"><a name="l00814"></a><span class="lineno">  814</span>&#160;      } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="../../dd/d02/structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;Sec-WebSocket-Key&quot;</span>)) {</div><div class="line"><a name="l00815"></a><span class="lineno">  815</span>&#160;         key = v-&gt;<a class="code" href="../../dd/d02/structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>;</div><div class="line"><a name="l00816"></a><span class="lineno">  816</span>&#160;      } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="../../dd/d02/structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;Sec-WebSocket-Key1&quot;</span>)) {</div><div class="line"><a name="l00817"></a><span class="lineno">  817</span>&#160;         key1 = v-&gt;<a class="code" href="../../dd/d02/structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>;</div><div class="line"><a name="l00818"></a><span class="lineno">  818</span>&#160;      } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="../../dd/d02/structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;Sec-WebSocket-Key2&quot;</span>)) {</div><div class="line"><a name="l00819"></a><span class="lineno">  819</span>&#160;         key2 = v-&gt;<a class="code" href="../../dd/d02/structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>;</div><div class="line"><a name="l00820"></a><span class="lineno">  820</span>&#160;      } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="../../dd/d02/structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;Sec-WebSocket-Protocol&quot;</span>)) {</div><div class="line"><a name="l00821"></a><span class="lineno">  821</span>&#160;         protos = v-&gt;<a class="code" href="../../dd/d02/structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>;</div><div class="line"><a name="l00822"></a><span class="lineno">  822</span>&#160;      } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="../../dd/d02/structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;Sec-WebSocket-Version&quot;</span>)) {</div><div class="line"><a name="l00823"></a><span class="lineno">  823</span>&#160;         <span class="keywordflow">if</span> (sscanf(v-&gt;<a class="code" href="../../dd/d02/structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, <span class="stringliteral">&quot;%30d&quot;</span>, &amp;version) != 1) {</div><div class="line"><a name="l00824"></a><span class="lineno">  824</span>&#160;            version = 0;</div><div class="line"><a name="l00825"></a><span class="lineno">  825</span>&#160;         }</div><div class="line"><a name="l00826"></a><span class="lineno">  826</span>&#160;      }</div><div class="line"><a name="l00827"></a><span class="lineno">  827</span>&#160;   }</div><div class="line"><a name="l00828"></a><span class="lineno">  828</span>&#160;</div><div class="line"><a name="l00829"></a><span class="lineno">  829</span>&#160;   <span class="comment">/* If this is not a websocket upgrade abort */</span></div><div class="line"><a name="l00830"></a><span class="lineno">  830</span>&#160;   <span class="keywordflow">if</span> (!upgrade || strcasecmp(upgrade, <span class="stringliteral">&quot;websocket&quot;</span>)) {</div><div class="line"><a name="l00831"></a><span class="lineno">  831</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;WebSocket connection from &#39;%s&#39; could not be accepted - did not request WebSocket\n&quot;</span>,</div><div class="line"><a name="l00832"></a><span class="lineno">  832</span>&#160;         <a class="code" href="../../db/df1/netsock2_8h.html#aae9156c7fe6dff51463f29ed1c3b96c9">ast_sockaddr_stringify</a>(&amp;ser-&gt;<a class="code" href="../../d6/d49/structast__tcptls__session__instance.html#a9dfcf41ffc851689eea95be7bb1f849a">remote_address</a>));</div><div class="line"><a name="l00833"></a><span class="lineno">  833</span>&#160;      <a class="code" href="../../dd/d56/http_8h.html#ab0f7966324a592e02d53f01e7bb9cc17">ast_http_error</a>(ser, 426, <span class="stringliteral">&quot;Upgrade Required&quot;</span>, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div><div class="line"><a name="l00834"></a><span class="lineno">  834</span>&#160;      <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00835"></a><span class="lineno">  835</span>&#160;   } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a>(protos)) {</div><div class="line"><a name="l00836"></a><span class="lineno">  836</span>&#160;      <span class="comment">/* If there&#39;s only a single protocol registered, and the</span></div><div class="line"><a name="l00837"></a><span class="lineno">  837</span>&#160;<span class="comment">       * client doesn&#39;t specify what protocol it&#39;s using, go ahead</span></div><div class="line"><a name="l00838"></a><span class="lineno">  838</span>&#160;<span class="comment">       * and accept the connection */</span></div><div class="line"><a name="l00839"></a><span class="lineno">  839</span>&#160;      protocol_handler = <a class="code" href="../../de/d4c/res__http__websocket_8c.html#a912dbb1619c0d406fb8451ae4f977a1b">one_protocol</a>(server);</div><div class="line"><a name="l00840"></a><span class="lineno">  840</span>&#160;      <span class="keywordflow">if</span> (!protocol_handler) {</div><div class="line"><a name="l00841"></a><span class="lineno">  841</span>&#160;         <span class="comment">/* Multiple registered subprotocols; client must specify */</span></div><div class="line"><a name="l00842"></a><span class="lineno">  842</span>&#160;         <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;WebSocket connection from &#39;%s&#39; could not be accepted - no protocols requested\n&quot;</span>,</div><div class="line"><a name="l00843"></a><span class="lineno">  843</span>&#160;            <a class="code" href="../../db/df1/netsock2_8h.html#aae9156c7fe6dff51463f29ed1c3b96c9">ast_sockaddr_stringify</a>(&amp;ser-&gt;<a class="code" href="../../d6/d49/structast__tcptls__session__instance.html#a9dfcf41ffc851689eea95be7bb1f849a">remote_address</a>));</div><div class="line"><a name="l00844"></a><span class="lineno">  844</span>&#160;         <a class="code" href="../../de/d4c/res__http__websocket_8c.html#a22d1c731d15309d02fed2fd3e1b681f8">websocket_bad_request</a>(ser);</div><div class="line"><a name="l00845"></a><span class="lineno">  845</span>&#160;         <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00846"></a><span class="lineno">  846</span>&#160;      }</div><div class="line"><a name="l00847"></a><span class="lineno">  847</span>&#160;   } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (key1 &amp;&amp; key2) {</div><div class="line"><a name="l00848"></a><span class="lineno">  848</span>&#160;      <span class="comment">/* Specification defined in http://tools.ietf.org/html/draft-hixie-thewebsocketprotocol-76 and</span></div><div class="line"><a name="l00849"></a><span class="lineno">  849</span>&#160;<span class="comment">       * http://tools.ietf.org/html/draft-ietf-hybi-thewebsocketprotocol-00 -- not currently supported*/</span></div><div class="line"><a name="l00850"></a><span class="lineno">  850</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;WebSocket connection from &#39;%s&#39; could not be accepted - unsupported version &#39;00/76&#39; chosen\n&quot;</span>,</div><div class="line"><a name="l00851"></a><span class="lineno">  851</span>&#160;         <a class="code" href="../../db/df1/netsock2_8h.html#aae9156c7fe6dff51463f29ed1c3b96c9">ast_sockaddr_stringify</a>(&amp;ser-&gt;<a class="code" href="../../d6/d49/structast__tcptls__session__instance.html#a9dfcf41ffc851689eea95be7bb1f849a">remote_address</a>));</div><div class="line"><a name="l00852"></a><span class="lineno">  852</span>&#160;      <a class="code" href="../../de/d4c/res__http__websocket_8c.html#a22d1c731d15309d02fed2fd3e1b681f8">websocket_bad_request</a>(ser);</div><div class="line"><a name="l00853"></a><span class="lineno">  853</span>&#160;      <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00854"></a><span class="lineno">  854</span>&#160;   }</div><div class="line"><a name="l00855"></a><span class="lineno">  855</span>&#160;</div><div class="line"><a name="l00856"></a><span class="lineno">  856</span>&#160;   <span class="keywordflow">if</span> (!protocol_handler &amp;&amp; protos) {</div><div class="line"><a name="l00857"></a><span class="lineno">  857</span>&#160;      requested_protocols = <a class="code" href="../../d8/d8a/astmm_8h.html#ab5f0750cc80ba337fdcbddea2d3a1ee6">ast_strdupa</a>(protos);</div><div class="line"><a name="l00858"></a><span class="lineno">  858</span>&#160;      <span class="comment">/* Iterate through the requested protocols trying to find one that we have a handler for */</span></div><div class="line"><a name="l00859"></a><span class="lineno">  859</span>&#160;      <span class="keywordflow">while</span> (!protocol_handler &amp;&amp; (protocol = <a class="code" href="../../de/da3/include_2asterisk_2compat_8h.html#a40eca58273c74a20a17f137d18ba826c">strsep</a>(&amp;requested_protocols, <span class="stringliteral">&quot;,&quot;</span>))) {</div><div class="line"><a name="l00860"></a><span class="lineno">  860</span>&#160;         protocol_handler = <a class="code" href="../../d5/da5/astobj2_8h.html#a911e0703891a9a7aaf73978152092586">ao2_find</a>(server-&gt;<a class="code" href="../../db/d66/structast__websocket__server.html#a2a8b976c358cd42ed5b5af57499588d3">protocols</a>, <a class="code" href="../../d6/d90/strings_8h.html#ac92713b8d07a45720b2664be70810e55">ast_strip</a>(protocol), <a class="code" href="../../d5/da5/astobj2_8h.html#a22f40c733a085f259af94e864ebaa09a">OBJ_KEY</a>);</div><div class="line"><a name="l00861"></a><span class="lineno">  861</span>&#160;      }</div><div class="line"><a name="l00862"></a><span class="lineno">  862</span>&#160;   }</div><div class="line"><a name="l00863"></a><span class="lineno">  863</span>&#160;</div><div class="line"><a name="l00864"></a><span class="lineno">  864</span>&#160;   <span class="comment">/* If no protocol handler exists bump this back to the requester */</span></div><div class="line"><a name="l00865"></a><span class="lineno">  865</span>&#160;   <span class="keywordflow">if</span> (!protocol_handler) {</div><div class="line"><a name="l00866"></a><span class="lineno">  866</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;WebSocket connection from &#39;%s&#39; could not be accepted - no protocols out of &#39;%s&#39; supported\n&quot;</span>,</div><div class="line"><a name="l00867"></a><span class="lineno">  867</span>&#160;         <a class="code" href="../../db/df1/netsock2_8h.html#aae9156c7fe6dff51463f29ed1c3b96c9">ast_sockaddr_stringify</a>(&amp;ser-&gt;<a class="code" href="../../d6/d49/structast__tcptls__session__instance.html#a9dfcf41ffc851689eea95be7bb1f849a">remote_address</a>), protos);</div><div class="line"><a name="l00868"></a><span class="lineno">  868</span>&#160;      <a class="code" href="../../de/d4c/res__http__websocket_8c.html#a22d1c731d15309d02fed2fd3e1b681f8">websocket_bad_request</a>(ser);</div><div class="line"><a name="l00869"></a><span class="lineno">  869</span>&#160;      <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00870"></a><span class="lineno">  870</span>&#160;   }</div><div class="line"><a name="l00871"></a><span class="lineno">  871</span>&#160;</div><div class="line"><a name="l00872"></a><span class="lineno">  872</span>&#160;   <span class="comment">/* Determine how to respond depending on the version */</span></div><div class="line"><a name="l00873"></a><span class="lineno">  873</span>&#160;   <span class="keywordflow">if</span> (version == 7 || version == 8 || version == 13) {</div><div class="line"><a name="l00874"></a><span class="lineno">  874</span>&#160;      <span class="keywordtype">char</span> <a class="code" href="../../de/d1f/main_2utils_8c.html#a094cd85754f67592588ab5a0636cf0ea">base64</a>[64];</div><div class="line"><a name="l00875"></a><span class="lineno">  875</span>&#160;</div><div class="line"><a name="l00876"></a><span class="lineno">  876</span>&#160;      <span class="keywordflow">if</span> (!key || strlen(key) + strlen(<a class="code" href="../../de/d4c/res__http__websocket_8c.html#ad17237839833df7be4a5c256801fe51b">WEBSOCKET_GUID</a>) + 1 &gt; 8192) { <span class="comment">/* no stack overflows please */</span></div><div class="line"><a name="l00877"></a><span class="lineno">  877</span>&#160;         <a class="code" href="../../de/d4c/res__http__websocket_8c.html#a22d1c731d15309d02fed2fd3e1b681f8">websocket_bad_request</a>(ser);</div><div class="line"><a name="l00878"></a><span class="lineno">  878</span>&#160;         <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(protocol_handler, -1);</div><div class="line"><a name="l00879"></a><span class="lineno">  879</span>&#160;         <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00880"></a><span class="lineno">  880</span>&#160;      }</div><div class="line"><a name="l00881"></a><span class="lineno">  881</span>&#160;</div><div class="line"><a name="l00882"></a><span class="lineno">  882</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="../../dd/d56/http_8h.html#a6158887813b6c700d9056b4daea05df0">ast_http_body_discard</a>(ser)) {</div><div class="line"><a name="l00883"></a><span class="lineno">  883</span>&#160;         <a class="code" href="../../de/d4c/res__http__websocket_8c.html#a22d1c731d15309d02fed2fd3e1b681f8">websocket_bad_request</a>(ser);</div><div class="line"><a name="l00884"></a><span class="lineno">  884</span>&#160;         <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(protocol_handler, -1);</div><div class="line"><a name="l00885"></a><span class="lineno">  885</span>&#160;         <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00886"></a><span class="lineno">  886</span>&#160;      }</div><div class="line"><a name="l00887"></a><span class="lineno">  887</span>&#160;</div><div class="line"><a name="l00888"></a><span class="lineno">  888</span>&#160;      <span class="keywordflow">if</span> (!(session = <a class="code" href="../../d5/da5/astobj2_8h.html#ae0422b60d8e25b6962b2d61ae4ddf724">ao2_alloc</a>(<span class="keyword">sizeof</span>(*session) + <a class="code" href="../../dd/d1d/uuid_8h.html#a127408e53d34dca0c589a099fabf1e13">AST_UUID_STR_LEN</a> + 1, <a class="code" href="../../de/d4c/res__http__websocket_8c.html#aed324e37497858b50c441fef9f636ccf">session_destroy_fn</a>))) {</div><div class="line"><a name="l00889"></a><span class="lineno">  889</span>&#160;         <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;WebSocket connection from &#39;%s&#39; could not be accepted\n&quot;</span>,</div><div class="line"><a name="l00890"></a><span class="lineno">  890</span>&#160;            <a class="code" href="../../db/df1/netsock2_8h.html#aae9156c7fe6dff51463f29ed1c3b96c9">ast_sockaddr_stringify</a>(&amp;ser-&gt;<a class="code" href="../../d6/d49/structast__tcptls__session__instance.html#a9dfcf41ffc851689eea95be7bb1f849a">remote_address</a>));</div><div class="line"><a name="l00891"></a><span class="lineno">  891</span>&#160;         <a class="code" href="../../de/d4c/res__http__websocket_8c.html#a22d1c731d15309d02fed2fd3e1b681f8">websocket_bad_request</a>(ser);</div><div class="line"><a name="l00892"></a><span class="lineno">  892</span>&#160;         <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(protocol_handler, -1);</div><div class="line"><a name="l00893"></a><span class="lineno">  893</span>&#160;         <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00894"></a><span class="lineno">  894</span>&#160;      }</div><div class="line"><a name="l00895"></a><span class="lineno">  895</span>&#160;      session-&gt;<a class="code" href="../../db/db6/structast__websocket.html#a493b57f443cc38b3d3df9c1e584d9d82">timeout</a> = <a class="code" href="../../d0/d0c/http__websocket_8h.html#a88147fdf589f09cb59e2687fbf74f835">AST_DEFAULT_WEBSOCKET_WRITE_TIMEOUT</a>;</div><div class="line"><a name="l00896"></a><span class="lineno">  896</span>&#160;</div><div class="line"><a name="l00897"></a><span class="lineno">  897</span>&#160;      <span class="comment">/* Generate the session id */</span></div><div class="line"><a name="l00898"></a><span class="lineno">  898</span>&#160;      <span class="keywordflow">if</span> (!<a class="code" href="../../dd/d1d/uuid_8h.html#abe6d0b550cd9a54964e7891960d1e5bc">ast_uuid_generate_str</a>(session-&gt;<a class="code" href="../../db/db6/structast__websocket.html#ab37f08d108eaf01324ae3c01436cf687">session_id</a>, <span class="keyword">sizeof</span>(session-&gt;<a class="code" href="../../db/db6/structast__websocket.html#ab37f08d108eaf01324ae3c01436cf687">session_id</a>))) {</div><div class="line"><a name="l00899"></a><span class="lineno">  899</span>&#160;         <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;WebSocket connection from &#39;%s&#39; could not be accepted - failed to generate a session id\n&quot;</span>,</div><div class="line"><a name="l00900"></a><span class="lineno">  900</span>&#160;            <a class="code" href="../../db/df1/netsock2_8h.html#aae9156c7fe6dff51463f29ed1c3b96c9">ast_sockaddr_stringify</a>(&amp;ser-&gt;<a class="code" href="../../d6/d49/structast__tcptls__session__instance.html#a9dfcf41ffc851689eea95be7bb1f849a">remote_address</a>));</div><div class="line"><a name="l00901"></a><span class="lineno">  901</span>&#160;         <a class="code" href="../../dd/d56/http_8h.html#ab0f7966324a592e02d53f01e7bb9cc17">ast_http_error</a>(ser, 500, <span class="stringliteral">&quot;Internal Server Error&quot;</span>, <span class="stringliteral">&quot;Allocation failed&quot;</span>);</div><div class="line"><a name="l00902"></a><span class="lineno">  902</span>&#160;         <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(protocol_handler, -1);</div><div class="line"><a name="l00903"></a><span class="lineno">  903</span>&#160;         <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00904"></a><span class="lineno">  904</span>&#160;      }</div><div class="line"><a name="l00905"></a><span class="lineno">  905</span>&#160;</div><div class="line"><a name="l00906"></a><span class="lineno">  906</span>&#160;      <span class="keywordflow">if</span> (protocol_handler-&gt;<a class="code" href="../../dc/dcf/structast__websocket__protocol.html#af4fc99952d388912b2b9c3c918a5414e">session_attempted</a></div><div class="line"><a name="l00907"></a><span class="lineno">  907</span>&#160;          &amp;&amp; protocol_handler-&gt;<a class="code" href="../../dc/dcf/structast__websocket__protocol.html#af4fc99952d388912b2b9c3c918a5414e">session_attempted</a>(ser, get_vars, headers, session-&gt;<a class="code" href="../../db/db6/structast__websocket.html#ab37f08d108eaf01324ae3c01436cf687">session_id</a>)) {</div><div class="line"><a name="l00908"></a><span class="lineno">  908</span>&#160;         <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(3, <span class="stringliteral">&quot;WebSocket connection from &#39;%s&#39; rejected by protocol handler &#39;%s&#39;\n&quot;</span>,</div><div class="line"><a name="l00909"></a><span class="lineno">  909</span>&#160;            <a class="code" href="../../db/df1/netsock2_8h.html#aae9156c7fe6dff51463f29ed1c3b96c9">ast_sockaddr_stringify</a>(&amp;ser-&gt;<a class="code" href="../../d6/d49/structast__tcptls__session__instance.html#a9dfcf41ffc851689eea95be7bb1f849a">remote_address</a>), protocol_handler-&gt;<a class="code" href="../../dc/dcf/structast__websocket__protocol.html#a5ac083a645d964373f022d03df4849c8">name</a>);</div><div class="line"><a name="l00910"></a><span class="lineno">  910</span>&#160;         <a class="code" href="../../de/d4c/res__http__websocket_8c.html#a22d1c731d15309d02fed2fd3e1b681f8">websocket_bad_request</a>(ser);</div><div class="line"><a name="l00911"></a><span class="lineno">  911</span>&#160;         <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(protocol_handler, -1);</div><div class="line"><a name="l00912"></a><span class="lineno">  912</span>&#160;         <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00913"></a><span class="lineno">  913</span>&#160;      }</div><div class="line"><a name="l00914"></a><span class="lineno">  914</span>&#160;</div><div class="line"><a name="l00915"></a><span class="lineno">  915</span>&#160;      <span class="comment">/* RFC 6455, Section 4.1:</span></div><div class="line"><a name="l00916"></a><span class="lineno">  916</span>&#160;<span class="comment">       *</span></div><div class="line"><a name="l00917"></a><span class="lineno">  917</span>&#160;<span class="comment">       * 6. If the response includes a |Sec-WebSocket-Protocol| header</span></div><div class="line"><a name="l00918"></a><span class="lineno">  918</span>&#160;<span class="comment">       *    field and this header field indicates the use of a</span></div><div class="line"><a name="l00919"></a><span class="lineno">  919</span>&#160;<span class="comment">       *    subprotocol that was not present in the client&#39;s handshake</span></div><div class="line"><a name="l00920"></a><span class="lineno">  920</span>&#160;<span class="comment">       *    (the server has indicated a subprotocol not requested by</span></div><div class="line"><a name="l00921"></a><span class="lineno">  921</span>&#160;<span class="comment">       *    the client), the client MUST _Fail the WebSocket</span></div><div class="line"><a name="l00922"></a><span class="lineno">  922</span>&#160;<span class="comment">       *    Connection_.</span></div><div class="line"><a name="l00923"></a><span class="lineno">  923</span>&#160;<span class="comment">       */</span></div><div class="line"><a name="l00924"></a><span class="lineno">  924</span>&#160;      <span class="keywordflow">if</span> (protocol) {</div><div class="line"><a name="l00925"></a><span class="lineno">  925</span>&#160;         <a class="code" href="../../dd/d27/iostream_8h.html#a23c05430f4b03eb5c72e1531f0716499">ast_iostream_printf</a>(ser-&gt;<a class="code" href="../../d6/d49/structast__tcptls__session__instance.html#a36ac2dd734607a43ed90acb7e9d81ac5">stream</a>,</div><div class="line"><a name="l00926"></a><span class="lineno">  926</span>&#160;            <span class="stringliteral">&quot;HTTP/1.1 101 Switching Protocols\r\n&quot;</span></div><div class="line"><a name="l00927"></a><span class="lineno">  927</span>&#160;            <span class="stringliteral">&quot;Upgrade: %s\r\n&quot;</span></div><div class="line"><a name="l00928"></a><span class="lineno">  928</span>&#160;            <span class="stringliteral">&quot;Connection: Upgrade\r\n&quot;</span></div><div class="line"><a name="l00929"></a><span class="lineno">  929</span>&#160;            <span class="stringliteral">&quot;Sec-WebSocket-Accept: %s\r\n&quot;</span></div><div class="line"><a name="l00930"></a><span class="lineno">  930</span>&#160;            <span class="stringliteral">&quot;Sec-WebSocket-Protocol: %s\r\n\r\n&quot;</span>,</div><div class="line"><a name="l00931"></a><span class="lineno">  931</span>&#160;            upgrade,</div><div class="line"><a name="l00932"></a><span class="lineno">  932</span>&#160;            <a class="code" href="../../de/d4c/res__http__websocket_8c.html#ac4661ddf40219eddd566cbdedee3ad37">websocket_combine_key</a>(key, base64, <span class="keyword">sizeof</span>(base64)),</div><div class="line"><a name="l00933"></a><span class="lineno">  933</span>&#160;            protocol);</div><div class="line"><a name="l00934"></a><span class="lineno">  934</span>&#160;      } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00935"></a><span class="lineno">  935</span>&#160;         <a class="code" href="../../dd/d27/iostream_8h.html#a23c05430f4b03eb5c72e1531f0716499">ast_iostream_printf</a>(ser-&gt;<a class="code" href="../../d6/d49/structast__tcptls__session__instance.html#a36ac2dd734607a43ed90acb7e9d81ac5">stream</a>,</div><div class="line"><a name="l00936"></a><span class="lineno">  936</span>&#160;            <span class="stringliteral">&quot;HTTP/1.1 101 Switching Protocols\r\n&quot;</span></div><div class="line"><a name="l00937"></a><span class="lineno">  937</span>&#160;            <span class="stringliteral">&quot;Upgrade: %s\r\n&quot;</span></div><div class="line"><a name="l00938"></a><span class="lineno">  938</span>&#160;            <span class="stringliteral">&quot;Connection: Upgrade\r\n&quot;</span></div><div class="line"><a name="l00939"></a><span class="lineno">  939</span>&#160;            <span class="stringliteral">&quot;Sec-WebSocket-Accept: %s\r\n\r\n&quot;</span>,</div><div class="line"><a name="l00940"></a><span class="lineno">  940</span>&#160;            upgrade,</div><div class="line"><a name="l00941"></a><span class="lineno">  941</span>&#160;            <a class="code" href="../../de/d4c/res__http__websocket_8c.html#ac4661ddf40219eddd566cbdedee3ad37">websocket_combine_key</a>(key, base64, <span class="keyword">sizeof</span>(base64)));</div><div class="line"><a name="l00942"></a><span class="lineno">  942</span>&#160;      }</div><div class="line"><a name="l00943"></a><span class="lineno">  943</span>&#160;   } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00944"></a><span class="lineno">  944</span>&#160;</div><div class="line"><a name="l00945"></a><span class="lineno">  945</span>&#160;      <span class="comment">/* Specification defined in http://tools.ietf.org/html/draft-hixie-thewebsocketprotocol-75 or completely unknown */</span></div><div class="line"><a name="l00946"></a><span class="lineno">  946</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;WebSocket connection from &#39;%s&#39; could not be accepted - unsupported version &#39;%d&#39; chosen\n&quot;</span>,</div><div class="line"><a name="l00947"></a><span class="lineno">  947</span>&#160;         <a class="code" href="../../db/df1/netsock2_8h.html#aae9156c7fe6dff51463f29ed1c3b96c9">ast_sockaddr_stringify</a>(&amp;ser-&gt;<a class="code" href="../../d6/d49/structast__tcptls__session__instance.html#a9dfcf41ffc851689eea95be7bb1f849a">remote_address</a>), version ? version : 75);</div><div class="line"><a name="l00948"></a><span class="lineno">  948</span>&#160;      <a class="code" href="../../de/d4c/res__http__websocket_8c.html#a22d1c731d15309d02fed2fd3e1b681f8">websocket_bad_request</a>(ser);</div><div class="line"><a name="l00949"></a><span class="lineno">  949</span>&#160;      <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(protocol_handler, -1);</div><div class="line"><a name="l00950"></a><span class="lineno">  950</span>&#160;      <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00951"></a><span class="lineno">  951</span>&#160;   }</div><div class="line"><a name="l00952"></a><span class="lineno">  952</span>&#160;</div><div class="line"><a name="l00953"></a><span class="lineno">  953</span>&#160;   <span class="comment">/* Enable keepalive on all sessions so the underlying user does not have to */</span></div><div class="line"><a name="l00954"></a><span class="lineno">  954</span>&#160;   <span class="keywordflow">if</span> (setsockopt(<a class="code" href="../../dd/d27/iostream_8h.html#a6ebb2730257107d3535fe6cb1285f479">ast_iostream_get_fd</a>(ser-&gt;<a class="code" href="../../d6/d49/structast__tcptls__session__instance.html#a36ac2dd734607a43ed90acb7e9d81ac5">stream</a>), SOL_SOCKET, SO_KEEPALIVE, &amp;flags, <span class="keyword">sizeof</span>(flags))) {</div><div class="line"><a name="l00955"></a><span class="lineno">  955</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;WebSocket connection from &#39;%s&#39; could not be accepted - failed to enable keepalive\n&quot;</span>,</div><div class="line"><a name="l00956"></a><span class="lineno">  956</span>&#160;         <a class="code" href="../../db/df1/netsock2_8h.html#aae9156c7fe6dff51463f29ed1c3b96c9">ast_sockaddr_stringify</a>(&amp;ser-&gt;<a class="code" href="../../d6/d49/structast__tcptls__session__instance.html#a9dfcf41ffc851689eea95be7bb1f849a">remote_address</a>));</div><div class="line"><a name="l00957"></a><span class="lineno">  957</span>&#160;      <a class="code" href="../../de/d4c/res__http__websocket_8c.html#a22d1c731d15309d02fed2fd3e1b681f8">websocket_bad_request</a>(ser);</div><div class="line"><a name="l00958"></a><span class="lineno">  958</span>&#160;      <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(session, -1);</div><div class="line"><a name="l00959"></a><span class="lineno">  959</span>&#160;      <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(protocol_handler, -1);</div><div class="line"><a name="l00960"></a><span class="lineno">  960</span>&#160;      <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00961"></a><span class="lineno">  961</span>&#160;   }</div><div class="line"><a name="l00962"></a><span class="lineno">  962</span>&#160;</div><div class="line"><a name="l00963"></a><span class="lineno">  963</span>&#160;   <span class="comment">/* Get our local address for the connected socket */</span></div><div class="line"><a name="l00964"></a><span class="lineno">  964</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../db/df1/netsock2_8h.html#a13c172d0480d5cfa48bfef5d38cb5091">ast_getsockname</a>(<a class="code" href="../../dd/d27/iostream_8h.html#a6ebb2730257107d3535fe6cb1285f479">ast_iostream_get_fd</a>(ser-&gt;<a class="code" href="../../d6/d49/structast__tcptls__session__instance.html#a36ac2dd734607a43ed90acb7e9d81ac5">stream</a>), &amp;session-&gt;<a class="code" href="../../db/db6/structast__websocket.html#a6652499b3aff8f317d4c6d1a36c6c740">local_address</a>)) {</div><div class="line"><a name="l00965"></a><span class="lineno">  965</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;WebSocket connection from &#39;%s&#39; could not be accepted - failed to get local address\n&quot;</span>,</div><div class="line"><a name="l00966"></a><span class="lineno">  966</span>&#160;         <a class="code" href="../../db/df1/netsock2_8h.html#aae9156c7fe6dff51463f29ed1c3b96c9">ast_sockaddr_stringify</a>(&amp;ser-&gt;<a class="code" href="../../d6/d49/structast__tcptls__session__instance.html#a9dfcf41ffc851689eea95be7bb1f849a">remote_address</a>));</div><div class="line"><a name="l00967"></a><span class="lineno">  967</span>&#160;      <a class="code" href="../../de/d4c/res__http__websocket_8c.html#a22d1c731d15309d02fed2fd3e1b681f8">websocket_bad_request</a>(ser);</div><div class="line"><a name="l00968"></a><span class="lineno">  968</span>&#160;      <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(session, -1);</div><div class="line"><a name="l00969"></a><span class="lineno">  969</span>&#160;      <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(protocol_handler, -1);</div><div class="line"><a name="l00970"></a><span class="lineno">  970</span>&#160;      <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00971"></a><span class="lineno">  971</span>&#160;   }</div><div class="line"><a name="l00972"></a><span class="lineno">  972</span>&#160;</div><div class="line"><a name="l00973"></a><span class="lineno">  973</span>&#160;   <a class="code" href="../../d1/d8c/logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(2, <span class="stringliteral">&quot;WebSocket connection from &#39;%s&#39; for protocol &#39;%s&#39; accepted using version &#39;%d&#39;\n&quot;</span>, <a class="code" href="../../db/df1/netsock2_8h.html#aae9156c7fe6dff51463f29ed1c3b96c9">ast_sockaddr_stringify</a>(&amp;ser-&gt;<a class="code" href="../../d6/d49/structast__tcptls__session__instance.html#a9dfcf41ffc851689eea95be7bb1f849a">remote_address</a>), protocol ? : <span class="stringliteral">&quot;&quot;</span>, version);</div><div class="line"><a name="l00974"></a><span class="lineno">  974</span>&#160;</div><div class="line"><a name="l00975"></a><span class="lineno">  975</span>&#160;   <span class="comment">/* Populate the session with all the needed details */</span></div><div class="line"><a name="l00976"></a><span class="lineno">  976</span>&#160;   session-&gt;<a class="code" href="../../db/db6/structast__websocket.html#a36ac2dd734607a43ed90acb7e9d81ac5">stream</a> = ser-&gt;<a class="code" href="../../d6/d49/structast__tcptls__session__instance.html#a36ac2dd734607a43ed90acb7e9d81ac5">stream</a>;</div><div class="line"><a name="l00977"></a><span class="lineno">  977</span>&#160;   <a class="code" href="../../db/df1/netsock2_8h.html#a56a46003c93bfd65111ea8ffc97af8f9">ast_sockaddr_copy</a>(&amp;session-&gt;<a class="code" href="../../db/db6/structast__websocket.html#a9dfcf41ffc851689eea95be7bb1f849a">remote_address</a>, &amp;ser-&gt;<a class="code" href="../../d6/d49/structast__tcptls__session__instance.html#a9dfcf41ffc851689eea95be7bb1f849a">remote_address</a>);</div><div class="line"><a name="l00978"></a><span class="lineno">  978</span>&#160;   session-&gt;<a class="code" href="../../db/db6/structast__websocket.html#ac717220c65cf5cf274dc30d3af6f1ded">opcode</a> = -1;</div><div class="line"><a name="l00979"></a><span class="lineno">  979</span>&#160;   session-&gt;<a class="code" href="../../db/db6/structast__websocket.html#ae2c11c04c7f747de8619a46a721bd63d">reconstruct</a> = <a class="code" href="../../de/d4c/res__http__websocket_8c.html#a7f0e6d73d21f7f256f229583f02e58ec">DEFAULT_RECONSTRUCTION_CEILING</a>;</div><div class="line"><a name="l00980"></a><span class="lineno">  980</span>&#160;   session-&gt;<a class="code" href="../../db/db6/structast__websocket.html#abba77e678a34722d786f3faa53262f75">secure</a> = <a class="code" href="../../dd/d27/iostream_8h.html#a405166f5185022bbe60f7b57f21cb483">ast_iostream_get_ssl</a>(ser-&gt;<a class="code" href="../../d6/d49/structast__tcptls__session__instance.html#a36ac2dd734607a43ed90acb7e9d81ac5">stream</a>) ? 1 : 0;</div><div class="line"><a name="l00981"></a><span class="lineno">  981</span>&#160;</div><div class="line"><a name="l00982"></a><span class="lineno">  982</span>&#160;   <span class="comment">/* Give up ownership of the socket and pass it to the protocol handler */</span></div><div class="line"><a name="l00983"></a><span class="lineno">  983</span>&#160;   <a class="code" href="../../dd/d27/iostream_8h.html#a7da9c8f9652decad87fdb8d39c4f06df">ast_iostream_set_exclusive_input</a>(session-&gt;<a class="code" href="../../db/db6/structast__websocket.html#a36ac2dd734607a43ed90acb7e9d81ac5">stream</a>, 0);</div><div class="line"><a name="l00984"></a><span class="lineno">  984</span>&#160;   protocol_handler-&gt;<a class="code" href="../../dc/dcf/structast__websocket__protocol.html#a28a8c4b888404298aebb5c1774ce1627">session_established</a>(session, get_vars, headers);</div><div class="line"><a name="l00985"></a><span class="lineno">  985</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(protocol_handler, -1);</div><div class="line"><a name="l00986"></a><span class="lineno">  986</span>&#160;</div><div class="line"><a name="l00987"></a><span class="lineno">  987</span>&#160;   <span class="comment">/*</span></div><div class="line"><a name="l00988"></a><span class="lineno">  988</span>&#160;<span class="comment">    * By dropping the stream from the session the connection</span></div><div class="line"><a name="l00989"></a><span class="lineno">  989</span>&#160;<span class="comment">    * won&#39;t get closed when the HTTP server cleans up because we</span></div><div class="line"><a name="l00990"></a><span class="lineno">  990</span>&#160;<span class="comment">    * passed the connection to the protocol handler.</span></div><div class="line"><a name="l00991"></a><span class="lineno">  991</span>&#160;<span class="comment">    */</span></div><div class="line"><a name="l00992"></a><span class="lineno">  992</span>&#160;   ser-&gt;<a class="code" href="../../d6/d49/structast__tcptls__session__instance.html#a36ac2dd734607a43ed90acb7e9d81ac5">stream</a> = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l00993"></a><span class="lineno">  993</span>&#160;</div><div class="line"><a name="l00994"></a><span class="lineno">  994</span>&#160;   <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00995"></a><span class="lineno">  995</span>&#160;}</div><div class="ttc" id="iostream_8h_html_a7da9c8f9652decad87fdb8d39c4f06df"><div class="ttname"><a href="../../dd/d27/iostream_8h.html#a7da9c8f9652decad87fdb8d39c4f06df">ast_iostream_set_exclusive_input</a></div><div class="ttdeci">void ast_iostream_set_exclusive_input(struct ast_iostream *stream, int exclusive_input)</div><div class="ttdoc">Set the iostream if it can exclusively depend upon the set timeouts. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/dc8/iostream_8c_source.html#l00148">iostream.c:148</a></div></div>
<div class="ttc" id="structast__variable_html_afaaf66cc5029a563bd0bb9df076ea14b"><div class="ttname"><a href="../../dd/d02/structast__variable.html#afaaf66cc5029a563bd0bb9df076ea14b">ast_variable::next</a></div><div class="ttdeci">struct ast_variable * next</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/de6/include_2asterisk_2config_8h_source.html#l00090">include/asterisk/config.h:90</a></div></div>
<div class="ttc" id="res__http__websocket_8c_html_a912dbb1619c0d406fb8451ae4f977a1b"><div class="ttname"><a href="../../de/d4c/res__http__websocket_8c.html#a912dbb1619c0d406fb8451ae4f977a1b">one_protocol</a></div><div class="ttdeci">static struct ast_websocket_protocol * one_protocol(struct ast_websocket_server *server)</div><div class="ttdoc">If the server has exactly one configured protocol, return it. </div><div class="ttdef"><b>Definition:</b> <a href="../../de/d4c/res__http__websocket_8c_source.html#l00752">res_http_websocket.c:752</a></div></div>
<div class="ttc" id="http_8h_html_ab0f7966324a592e02d53f01e7bb9cc17"><div class="ttname"><a href="../../dd/d56/http_8h.html#ab0f7966324a592e02d53f01e7bb9cc17">ast_http_error</a></div><div class="ttdeci">void ast_http_error(struct ast_tcptls_session_instance *ser, int status, const char *title, const char *text)</div><div class="ttdoc">Send HTTP error message and close socket. </div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d43/http_8c_source.html#l00648">http.c:648</a></div></div>
<div class="ttc" id="structast__websocket__protocol_html"><div class="ttname"><a href="../../dc/dcf/structast__websocket__protocol.html">ast_websocket_protocol</a></div><div class="ttdoc">A websocket protocol implementation. </div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d0c/http__websocket_8h_source.html#l00112">http_websocket.h:112</a></div></div>
<div class="ttc" id="uuid_8h_html_a127408e53d34dca0c589a099fabf1e13"><div class="ttname"><a href="../../dd/d1d/uuid_8h.html#a127408e53d34dca0c589a099fabf1e13">AST_UUID_STR_LEN</a></div><div class="ttdeci">#define AST_UUID_STR_LEN</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d1d/uuid_8h_source.html#l00027">uuid.h:27</a></div></div>
<div class="ttc" id="structast__websocket_html_ae2c11c04c7f747de8619a46a721bd63d"><div class="ttname"><a href="../../db/db6/structast__websocket.html#ae2c11c04c7f747de8619a46a721bd63d">ast_websocket::reconstruct</a></div><div class="ttdeci">size_t reconstruct</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d4c/res__http__websocket_8c_source.html#l00095">res_http_websocket.c:95</a></div></div>
<div class="ttc" id="res__http__websocket_8c_html_ad17237839833df7be4a5c256801fe51b"><div class="ttname"><a href="../../de/d4c/res__http__websocket_8c.html#ad17237839833df7be4a5c256801fe51b">WEBSOCKET_GUID</a></div><div class="ttdeci">#define WEBSOCKET_GUID</div><div class="ttdoc">GUID used to compute the accept key, defined in the specifications. </div><div class="ttdef"><b>Definition:</b> <a href="../../de/d4c/res__http__websocket_8c_source.html#l00045">res_http_websocket.c:45</a></div></div>
<div class="ttc" id="http_8h_html_a6158887813b6c700d9056b4daea05df0"><div class="ttname"><a href="../../dd/d56/http_8h.html#a6158887813b6c700d9056b4daea05df0">ast_http_body_discard</a></div><div class="ttdeci">int ast_http_body_discard(struct ast_tcptls_session_instance *ser)</div><div class="ttdoc">Read and discard any unread HTTP request body. </div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d43/http_8c_source.html#l01120">http.c:1120</a></div></div>
<div class="ttc" id="netsock2_8h_html_a56a46003c93bfd65111ea8ffc97af8f9"><div class="ttname"><a href="../../db/df1/netsock2_8h.html#a56a46003c93bfd65111ea8ffc97af8f9">ast_sockaddr_copy</a></div><div class="ttdeci">static void ast_sockaddr_copy(struct ast_sockaddr *dst, const struct ast_sockaddr *src)</div><div class="ttdoc">Copies the data from one ast_sockaddr to another. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/df1/netsock2_8h_source.html#l00171">netsock2.h:171</a></div></div>
<div class="ttc" id="astobj2_8h_html_a22f40c733a085f259af94e864ebaa09a"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#a22f40c733a085f259af94e864ebaa09a">OBJ_KEY</a></div><div class="ttdeci">#define OBJ_KEY</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l01155">astobj2.h:1155</a></div></div>
<div class="ttc" id="structast__module__info_html"><div class="ttname"><a href="../../dd/d5f/structast__module__info.html">ast_module_info</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d16/module_8h_source.html#l00336">module.h:336</a></div></div>
<div class="ttc" id="logger_8h_html_adf4476a6a4ea6c74231c826e899d7189"><div class="ttname"><a href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a></div><div class="ttdeci">#define LOG_WARNING</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d8c/logger_8h_source.html#l00274">logger.h:274</a></div></div>
<div class="ttc" id="structast__websocket__server_html"><div class="ttname"><a href="../../db/d66/structast__websocket__server.html">ast_websocket_server</a></div><div class="ttdoc">Structure for a WebSocket server. </div><div class="ttdef"><b>Definition:</b> <a href="../../de/d4c/res__http__websocket_8c_source.html#l00132">res_http_websocket.c:132</a></div></div>
<div class="ttc" id="structast__websocket__protocol_html_af4fc99952d388912b2b9c3c918a5414e"><div class="ttname"><a href="../../dc/dcf/structast__websocket__protocol.html#af4fc99952d388912b2b9c3c918a5414e">ast_websocket_protocol::session_attempted</a></div><div class="ttdeci">ast_websocket_pre_callback session_attempted</div><div class="ttdoc">Callback called when a new session is attempted. Optional. </div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d0c/http__websocket_8h_source.html#l00123">http_websocket.h:123</a></div></div>
<div class="ttc" id="structast__variable_html"><div class="ttname"><a href="../../dd/d02/structast__variable.html">ast_variable</a></div><div class="ttdoc">Structure for variables, used for configurations and for channel variables. </div><div class="ttdef"><b>Definition:</b> <a href="../../d3/de6/include_2asterisk_2config_8h_source.html#l00083">include/asterisk/config.h:83</a></div></div>
<div class="ttc" id="iostream_8h_html_a6ebb2730257107d3535fe6cb1285f479"><div class="ttname"><a href="../../dd/d27/iostream_8h.html#a6ebb2730257107d3535fe6cb1285f479">ast_iostream_get_fd</a></div><div class="ttdeci">int ast_iostream_get_fd(struct ast_iostream *stream)</div><div class="ttdoc">Get an iostream&amp;#39;s file descriptor. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/dc8/iostream_8c_source.html#l00084">iostream.c:84</a></div></div>
<div class="ttc" id="res__http__websocket_8c_html_a7f0e6d73d21f7f256f229583f02e58ec"><div class="ttname"><a href="../../de/d4c/res__http__websocket_8c.html#a7f0e6d73d21f7f256f229583f02e58ec">DEFAULT_RECONSTRUCTION_CEILING</a></div><div class="ttdeci">#define DEFAULT_RECONSTRUCTION_CEILING</div><div class="ttdoc">Default reconstruction size for multi-frame payload reconstruction. If exceeded the next frame will s...</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d4c/res__http__websocket_8c_source.html#l00071">res_http_websocket.c:71</a></div></div>
<div class="ttc" id="structast__websocket__server_html_a2a8b976c358cd42ed5b5af57499588d3"><div class="ttname"><a href="../../db/d66/structast__websocket__server.html#a2a8b976c358cd42ed5b5af57499588d3">ast_websocket_server::protocols</a></div><div class="ttdeci">struct ao2_container * protocols</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d4c/res__http__websocket_8c_source.html#l00133">res_http_websocket.c:133</a></div></div>
<div class="ttc" id="resample_8c_html_a070d2ce7b6bb7e5c05602aa8c308d0c4"><div class="ttname"><a href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a></div><div class="ttdeci">#define NULL</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d7f/resample_8c_source.html#l00096">resample.c:96</a></div></div>
<div class="ttc" id="logger_8h_html_ad770f83c71e237e1f64163358ce4e13d"><div class="ttname"><a href="../../d1/d8c/logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a></div><div class="ttdeci">#define ast_verb(level,...)</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d8c/logger_8h_source.html#l00463">logger.h:463</a></div></div>
<div class="ttc" id="strings_8h_html_a372554b7a2d69a8bd3adac5157672036"><div class="ttname"><a href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a></div><div class="ttdeci">#define ast_strlen_zero(foo)</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d90/strings_8h_source.html#l00052">strings.h:52</a></div></div>
<div class="ttc" id="iostream_8h_html_a405166f5185022bbe60f7b57f21cb483"><div class="ttname"><a href="../../dd/d27/iostream_8h.html#a405166f5185022bbe60f7b57f21cb483">ast_iostream_get_ssl</a></div><div class="ttdeci">SSL * ast_iostream_get_ssl(struct ast_iostream *stream)</div><div class="ttdoc">Get a pointer to an iostream&amp;#39;s OpenSSL SSL structure. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/dc8/iostream_8c_source.html#l00108">iostream.c:108</a></div></div>
<div class="ttc" id="logger_8h_html_a3f248112c8d6ce7e3959aa723dade648"><div class="ttname"><a href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a></div><div class="ttdeci">#define ast_debug(level,...)</div><div class="ttdoc">Log a DEBUG message. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d8c/logger_8h_source.html#l00452">logger.h:452</a></div></div>
<div class="ttc" id="astobj2_8c_html_a96a00b3a518d7f32b6d51dc28f09bf9b"><div class="ttname"><a href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a></div><div class="ttdeci">#define ast_log</div><div class="ttdef"><b>Definition:</b> <a href="../../da/df7/astobj2_8c_source.html#l00042">astobj2.c:42</a></div></div>
<div class="ttc" id="structast__variable_html_a8556878012feffc9e0beb86cd78f424d"><div class="ttname"><a href="../../dd/d02/structast__variable.html#a8556878012feffc9e0beb86cd78f424d">ast_variable::value</a></div><div class="ttdeci">const char * value</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/de6/include_2asterisk_2config_8h_source.html#l00087">include/asterisk/config.h:87</a></div></div>
<div class="ttc" id="structast__websocket_html_ac717220c65cf5cf274dc30d3af6f1ded"><div class="ttname"><a href="../../db/db6/structast__websocket.html#ac717220c65cf5cf274dc30d3af6f1ded">ast_websocket::opcode</a></div><div class="ttdeci">enum ast_websocket_opcode opcode</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d4c/res__http__websocket_8c_source.html#l00092">res_http_websocket.c:92</a></div></div>
<div class="ttc" id="structast__websocket__protocol_html_a5ac083a645d964373f022d03df4849c8"><div class="ttname"><a href="../../dc/dcf/structast__websocket__protocol.html#a5ac083a645d964373f022d03df4849c8">ast_websocket_protocol::name</a></div><div class="ttdeci">char * name</div><div class="ttdoc">Name of the protocol. </div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d0c/http__websocket_8h_source.html#l00114">http_websocket.h:114</a></div></div>
<div class="ttc" id="structast__module__info_html_a1aff0615d43e1dfa5c72c1c7d1c6d709"><div class="ttname"><a href="../../dd/d5f/structast__module__info.html#a1aff0615d43e1dfa5c72c1c7d1c6d709">ast_module_info::self</a></div><div class="ttdeci">struct ast_module * self</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d16/module_8h_source.html#l00342">module.h:342</a></div></div>
<div class="ttc" id="astman_8c_html_ac4a6ae0400e4457f0b35beddec80c93d"><div class="ttname"><a href="../../d2/d4d/astman_8c.html#ac4a6ae0400e4457f0b35beddec80c93d">session</a></div><div class="ttdeci">static struct ast_mansession session</div></div>
<div class="ttc" id="strings_8h_html_ac92713b8d07a45720b2664be70810e55"><div class="ttname"><a href="../../d6/d90/strings_8h.html#ac92713b8d07a45720b2664be70810e55">ast_strip</a></div><div class="ttdeci">char * ast_strip(char *s)</div><div class="ttdoc">Strip leading/trailing whitespace from a string. </div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d90/strings_8h_source.html#l00219">strings.h:219</a></div></div>
<div class="ttc" id="astobj2_8h_html_aaca5e8eac39a22f9da1c36fc6c922270"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a></div><div class="ttdeci">#define ao2_ref(o, delta)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l00464">astobj2.h:464</a></div></div>
<div class="ttc" id="astmm_8h_html_ab5f0750cc80ba337fdcbddea2d3a1ee6"><div class="ttname"><a href="../../d8/d8a/astmm_8h.html#ab5f0750cc80ba337fdcbddea2d3a1ee6">ast_strdupa</a></div><div class="ttdeci">#define ast_strdupa(s)</div><div class="ttdoc">duplicate a string in memory from the stack </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d8a/astmm_8h_source.html#l00300">astmm.h:300</a></div></div>
<div class="ttc" id="res__pjsip_8c_html_a8b44a03925325ceaf2de7b079b1541a1"><div class="ttname"><a href="../../de/d96/res__pjsip_8c.html#a8b44a03925325ceaf2de7b079b1541a1">method</a></div><div class="ttdeci">const char * method</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d96/res__pjsip_8c_source.html#l04335">res_pjsip.c:4335</a></div></div>
<div class="ttc" id="iostream_8h_html_a23c05430f4b03eb5c72e1531f0716499"><div class="ttname"><a href="../../dd/d27/iostream_8h.html#a23c05430f4b03eb5c72e1531f0716499">ast_iostream_printf</a></div><div class="ttdeci">ssize_t ast_iostream_printf(struct ast_iostream *stream, const char *format,...)</div><div class="ttdoc">Write a formatted string to an iostream. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/dc8/iostream_8c_source.html#l00491">iostream.c:491</a></div></div>
<div class="ttc" id="structast__variable_html_a8f8f80d37794cde9472343e4487ba3eb"><div class="ttname"><a href="../../dd/d02/structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">ast_variable::name</a></div><div class="ttdeci">const char * name</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/de6/include_2asterisk_2config_8h_source.html#l00085">include/asterisk/config.h:85</a></div></div>
<div class="ttc" id="structast__websocket_html_a6652499b3aff8f317d4c6d1a36c6c740"><div class="ttname"><a href="../../db/db6/structast__websocket.html#a6652499b3aff8f317d4c6d1a36c6c740">ast_websocket::local_address</a></div><div class="ttdeci">struct ast_sockaddr local_address</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d4c/res__http__websocket_8c_source.html#l00091">res_http_websocket.c:91</a></div></div>
<div class="ttc" id="http_8h_html_a16fb43ed7e6093a9dc96477ba37b80efa74b1cb5c2ecb5e0bd9af5d46a7b78fd2"><div class="ttname"><a href="../../dd/d56/http_8h.html#a16fb43ed7e6093a9dc96477ba37b80efa74b1cb5c2ecb5e0bd9af5d46a7b78fd2">AST_HTTP_GET</a></div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d56/http_8h_source.html#l00058">http.h:58</a></div></div>
<div class="ttc" id="structast__websocket_html_ab37f08d108eaf01324ae3c01436cf687"><div class="ttname"><a href="../../db/db6/structast__websocket.html#ab37f08d108eaf01324ae3c01436cf687">ast_websocket::session_id</a></div><div class="ttdeci">char session_id[AST_UUID_STR_LEN]</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d4c/res__http__websocket_8c_source.html#l00101">res_http_websocket.c:101</a></div></div>
<div class="ttc" id="http__websocket_8h_html_a88147fdf589f09cb59e2687fbf74f835"><div class="ttname"><a href="../../d0/d0c/http__websocket_8h.html#a88147fdf589f09cb59e2687fbf74f835">AST_DEFAULT_WEBSOCKET_WRITE_TIMEOUT</a></div><div class="ttdeci">#define AST_DEFAULT_WEBSOCKET_WRITE_TIMEOUT</div><div class="ttdoc">Default websocket write timeout, in ms. </div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d0c/http__websocket_8h_source.html#l00028">http_websocket.h:28</a></div></div>
<div class="ttc" id="namespace210693f3123d__create__cdr__table_html_a0a72b5f19c7dbcbdba704ca0722af707"><div class="ttname"><a href="../../da/dbd/namespace210693f3123d__create__cdr__table.html#a0a72b5f19c7dbcbdba704ca0722af707">210693f3123d_create_cdr_table.upgrade</a></div><div class="ttdeci">def upgrade()</div><div class="ttdef"><b>Definition:</b> <a href="../../d2/d4e/210693f3123d__create__cdr__table_8py_source.html#l00035">210693f3123d_create_cdr_table.py:35</a></div></div>
<div class="ttc" id="netsock2_8h_html_aae9156c7fe6dff51463f29ed1c3b96c9"><div class="ttname"><a href="../../db/df1/netsock2_8h.html#aae9156c7fe6dff51463f29ed1c3b96c9">ast_sockaddr_stringify</a></div><div class="ttdeci">static char * ast_sockaddr_stringify(const struct ast_sockaddr *addr)</div><div class="ttdoc">Wrapper around ast_sockaddr_stringify_fmt() with default format. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/df1/netsock2_8h_source.html#l00260">netsock2.h:260</a></div></div>
<div class="ttc" id="res__http__websocket_8c_html_aed324e37497858b50c441fef9f636ccf"><div class="ttname"><a href="../../de/d4c/res__http__websocket_8c.html#aed324e37497858b50c441fef9f636ccf">session_destroy_fn</a></div><div class="ttdeci">static void session_destroy_fn(void *obj)</div><div class="ttdoc">Destructor function for sessions. </div><div class="ttdef"><b>Definition:</b> <a href="../../de/d4c/res__http__websocket_8c_source.html#l00173">res_http_websocket.c:173</a></div></div>
<div class="ttc" id="astobj2_8h_html_ae0422b60d8e25b6962b2d61ae4ddf724"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#ae0422b60d8e25b6962b2d61ae4ddf724">ao2_alloc</a></div><div class="ttdeci">#define ao2_alloc(data_size, destructor_fn)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l00411">astobj2.h:411</a></div></div>
<div class="ttc" id="chan__ooh323_8c_html_a81b4b1c3c855fb371e7723b473f1ee78"><div class="ttname"><a href="../../d7/d49/chan__ooh323_8c.html#a81b4b1c3c855fb371e7723b473f1ee78">version</a></div><div class="ttdeci">static char version[AST_MAX_EXTENSION]</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d49/chan__ooh323_8c_source.html#l00391">chan_ooh323.c:391</a></div></div>
<div class="ttc" id="structast__websocket_html"><div class="ttname"><a href="../../db/db6/structast__websocket.html">ast_websocket</a></div><div class="ttdoc">Structure definition for session. </div><div class="ttdef"><b>Definition:</b> <a href="../../de/d4c/res__http__websocket_8c_source.html#l00088">res_http_websocket.c:88</a></div></div>
<div class="ttc" id="uuid_8h_html_abe6d0b550cd9a54964e7891960d1e5bc"><div class="ttname"><a href="../../dd/d1d/uuid_8h.html#abe6d0b550cd9a54964e7891960d1e5bc">ast_uuid_generate_str</a></div><div class="ttdeci">char * ast_uuid_generate_str(char *buf, size_t size)</div><div class="ttdoc">Generate a UUID string. </div><div class="ttdef"><b>Definition:</b> <a href="../../df/da9/uuid_8c_source.html#l00143">uuid.c:143</a></div></div>
<div class="ttc" id="astobj2_8h_html_a911e0703891a9a7aaf73978152092586"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#a911e0703891a9a7aaf73978152092586">ao2_find</a></div><div class="ttdeci">#define ao2_find(container, arg, flags)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l01756">astobj2.h:1756</a></div></div>
<div class="ttc" id="module_8h_html_a0fb39465480454778b4b070505a4eabb"><div class="ttname"><a href="../../d5/d16/module_8h.html#a0fb39465480454778b4b070505a4eabb">SCOPED_MODULE_USE</a></div><div class="ttdeci">#define SCOPED_MODULE_USE(module)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d16/module_8h_source.html#l00665">module.h:665</a></div></div>
<div class="ttc" id="structast__tcptls__session__instance_html_a36ac2dd734607a43ed90acb7e9d81ac5"><div class="ttname"><a href="../../d6/d49/structast__tcptls__session__instance.html#a36ac2dd734607a43ed90acb7e9d81ac5">ast_tcptls_session_instance::stream</a></div><div class="ttdeci">struct ast_iostream * stream</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/ddf/tcptls_8h_source.html#l00160">tcptls.h:160</a></div></div>
<div class="ttc" id="structast__websocket_html_abba77e678a34722d786f3faa53262f75"><div class="ttname"><a href="../../db/db6/structast__websocket.html#abba77e678a34722d786f3faa53262f75">ast_websocket::secure</a></div><div class="ttdeci">unsigned int secure</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d4c/res__http__websocket_8c_source.html#l00097">res_http_websocket.c:97</a></div></div>
<div class="ttc" id="structast__websocket_html_a9dfcf41ffc851689eea95be7bb1f849a"><div class="ttname"><a href="../../db/db6/structast__websocket.html#a9dfcf41ffc851689eea95be7bb1f849a">ast_websocket::remote_address</a></div><div class="ttdeci">struct ast_sockaddr remote_address</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d4c/res__http__websocket_8c_source.html#l00090">res_http_websocket.c:90</a></div></div>
<div class="ttc" id="include_2asterisk_2compat_8h_html_a40eca58273c74a20a17f137d18ba826c"><div class="ttname"><a href="../../de/da3/include_2asterisk_2compat_8h.html#a40eca58273c74a20a17f137d18ba826c">strsep</a></div><div class="ttdeci">char * strsep(char **str, const char *delims)</div></div>
<div class="ttc" id="res__http__websocket_8c_html_a22d1c731d15309d02fed2fd3e1b681f8"><div class="ttname"><a href="../../de/d4c/res__http__websocket_8c.html#a22d1c731d15309d02fed2fd3e1b681f8">websocket_bad_request</a></div><div class="ttdeci">static void websocket_bad_request(struct ast_tcptls_session_instance *ser)</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d4c/res__http__websocket_8c_source.html#l00777">res_http_websocket.c:777</a></div></div>
<div class="ttc" id="structast__websocket_html_a36ac2dd734607a43ed90acb7e9d81ac5"><div class="ttname"><a href="../../db/db6/structast__websocket.html#a36ac2dd734607a43ed90acb7e9d81ac5">ast_websocket::stream</a></div><div class="ttdeci">struct ast_iostream * stream</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d4c/res__http__websocket_8c_source.html#l00089">res_http_websocket.c:89</a></div></div>
<div class="ttc" id="structast__websocket__protocol_html_a28a8c4b888404298aebb5c1774ce1627"><div class="ttname"><a href="../../dc/dcf/structast__websocket__protocol.html#a28a8c4b888404298aebb5c1774ce1627">ast_websocket_protocol::session_established</a></div><div class="ttdeci">ast_websocket_callback session_established</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d0c/http__websocket_8h_source.html#l00125">http_websocket.h:125</a></div></div>
<div class="ttc" id="netsock2_8h_html_a13c172d0480d5cfa48bfef5d38cb5091"><div class="ttname"><a href="../../db/df1/netsock2_8h.html#a13c172d0480d5cfa48bfef5d38cb5091">ast_getsockname</a></div><div class="ttdeci">int ast_getsockname(int sockfd, struct ast_sockaddr *addr)</div><div class="ttdoc">Wrapper around getsockname(2) that uses struct ast_sockaddr. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d27/netsock2_8c_source.html#l00600">netsock2.c:600</a></div></div>
<div class="ttc" id="structast__websocket_html_a493b57f443cc38b3d3df9c1e584d9d82"><div class="ttname"><a href="../../db/db6/structast__websocket.html#a493b57f443cc38b3d3df9c1e584d9d82">ast_websocket::timeout</a></div><div class="ttdeci">int timeout</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d4c/res__http__websocket_8c_source.html#l00096">res_http_websocket.c:96</a></div></div>
<div class="ttc" id="structast__http__uri_html_a735984d41155bc1032e09bece8f8d66d"><div class="ttname"><a href="../../d0/d6c/structast__http__uri.html#a735984d41155bc1032e09bece8f8d66d">ast_http_uri::data</a></div><div class="ttdeci">void * data</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d56/http_8h_source.html#l00114">http.h:114</a></div></div>
<div class="ttc" id="res__http__websocket_8c_html_ac4661ddf40219eddd566cbdedee3ad37"><div class="ttname"><a href="../../de/d4c/res__http__websocket_8c.html#ac4661ddf40219eddd566cbdedee3ad37">websocket_combine_key</a></div><div class="ttdeci">static char * websocket_combine_key(const char *key, char *res, int res_size)</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d4c/res__http__websocket_8c_source.html#l00764">res_http_websocket.c:764</a></div></div>
<div class="ttc" id="main_2utils_8c_html_a094cd85754f67592588ab5a0636cf0ea"><div class="ttname"><a href="../../de/d1f/main_2utils_8c.html#a094cd85754f67592588ab5a0636cf0ea">base64</a></div><div class="ttdeci">static char base64[64]</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d1f/main_2utils_8c_source.html#l00078">main/utils.c:78</a></div></div>
<div class="ttc" id="structast__tcptls__session__instance_html_a9dfcf41ffc851689eea95be7bb1f849a"><div class="ttname"><a href="../../d6/d49/structast__tcptls__session__instance.html#a9dfcf41ffc851689eea95be7bb1f849a">ast_tcptls_session_instance::remote_address</a></div><div class="ttdeci">struct ast_sockaddr remote_address</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/ddf/tcptls_8h_source.html#l00151">tcptls.h:151</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a838ccd8bed44b43d4b95025bc3bea4c8"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a838ccd8bed44b43d4b95025bc3bea4c8">&#9670;&nbsp;</a></span>ast_websocket_wait_for_input()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="../../df/d3c/optional__api_8h.html#abe6ec88934f99eb74444f6c4a92353ec">AST_OPTIONAL_API_NAME</a>() ast_websocket_wait_for_input </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="../../db/db6/structast__websocket.html">ast_websocket</a> *&#160;</td>
          <td class="paramname"><em>session</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>timeout</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html#l00466">466</a> of file <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html">res_http_websocket.c</a>.</p>

<p class="reference">References <a class="el" href="../../d1/dc8/iostream_8c_source.html#l00089">ast_iostream_wait_for_input()</a>, <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html#l00098">ast_websocket::closing</a>, <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html#l00089">ast_websocket::stream</a>, and <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html#l00096">ast_websocket::timeout</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../d2/db8/res__pjsip__transport__websocket_8c_source.html#l00360">websocket_cb()</a>, and <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html#l01007">websocket_echo_callback()</a>.</p>
<div class="fragment"><div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;{</div><div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;   <span class="keywordflow">return</span> session-&gt;<a class="code" href="../../db/db6/structast__websocket.html#aa71fe3535b288c6e8f4e7f811b65fc3c">closing</a> ? -1 : <a class="code" href="../../dd/d27/iostream_8h.html#ad721332871f184269664be51e8393136">ast_iostream_wait_for_input</a>(session-&gt;<a class="code" href="../../db/db6/structast__websocket.html#a36ac2dd734607a43ed90acb7e9d81ac5">stream</a>, <a class="code" href="../../d0/d29/cdr__mysql_8c.html#a493b57f443cc38b3d3df9c1e584d9d82">timeout</a>);</div><div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;}</div><div class="ttc" id="iostream_8h_html_ad721332871f184269664be51e8393136"><div class="ttname"><a href="../../dd/d27/iostream_8h.html#ad721332871f184269664be51e8393136">ast_iostream_wait_for_input</a></div><div class="ttdeci">int ast_iostream_wait_for_input(struct ast_iostream *stream, int timeout)</div><div class="ttdoc">Wait for input on the iostream&amp;#39;s file descriptor. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/dc8/iostream_8c_source.html#l00089">iostream.c:89</a></div></div>
<div class="ttc" id="cdr__mysql_8c_html_a493b57f443cc38b3d3df9c1e584d9d82"><div class="ttname"><a href="../../d0/d29/cdr__mysql_8c.html#a493b57f443cc38b3d3df9c1e584d9d82">timeout</a></div><div class="ttdeci">static int timeout</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d29/cdr__mysql_8c_source.html#l00086">cdr_mysql.c:86</a></div></div>
<div class="ttc" id="structast__websocket_html_aa71fe3535b288c6e8f4e7f811b65fc3c"><div class="ttname"><a href="../../db/db6/structast__websocket.html#aa71fe3535b288c6e8f4e7f811b65fc3c">ast_websocket::closing</a></div><div class="ttdeci">unsigned int closing</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d4c/res__http__websocket_8c_source.html#l00098">res_http_websocket.c:98</a></div></div>
<div class="ttc" id="structast__websocket_html_a36ac2dd734607a43ed90acb7e9d81ac5"><div class="ttname"><a href="../../db/db6/structast__websocket.html#a36ac2dd734607a43ed90acb7e9d81ac5">ast_websocket::stream</a></div><div class="ttdeci">struct ast_iostream * stream</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d4c/res__http__websocket_8c_source.html#l00089">res_http_websocket.c:89</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a1a6e44db94d8b4e8c06bf456bb0174ad"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1a6e44db94d8b4e8c06bf456bb0174ad">&#9670;&nbsp;</a></span>ast_websocket_write()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="../../df/d3c/optional__api_8h.html#abe6ec88934f99eb74444f6c4a92353ec">AST_OPTIONAL_API_NAME</a>() ast_websocket_write </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="../../db/db6/structast__websocket.html">ast_websocket</a> *&#160;</td>
          <td class="paramname"><em>session</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">enum <a class="el" href="../../d0/d0c/http__websocket_8h.html#a8cb89d2edeb737bfc4efb15902cd19bc">ast_websocket_opcode</a>&#160;</td>
          <td class="paramname"><em>opcode</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>payload</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint64_t&#160;</td>
          <td class="paramname"><em>payload_size</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Write function for websocket traffic. </p>

<p class="definition">Definition at line <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html#l00374">374</a> of file <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html">res_http_websocket.c</a>.</p>

<p class="reference">References <a class="el" href="../../d5/da5/astobj2_8h_source.html#l00718">ao2_lock</a>, <a class="el" href="../../d5/da5/astobj2_8h_source.html#l00730">ao2_unlock</a>, <a class="el" href="../../d8/d8a/astmm_8h_source.html#l00290">ast_alloca</a>, <a class="el" href="../../d1/d8c/logger_8h_source.html#l00452">ast_debug</a>, <a class="el" href="../../d1/dc8/iostream_8c_source.html#l00113">ast_iostream_set_timeout_disable()</a>, <a class="el" href="../../d1/dc8/iostream_8c_source.html#l00139">ast_iostream_set_timeout_sequence()</a>, <a class="el" href="../../d1/dc8/iostream_8c_source.html#l00374">ast_iostream_write()</a>, <a class="el" href="../../de/df7/time_8h_source.html#l00150">ast_tvnow()</a>, <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html#l00308">ast_websocket_close()</a>, <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html#l00100">ast_websocket::client</a>, <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html#l00098">ast_websocket::closing</a>, <a class="el" href="../../d2/d97/format__g726_8c_source.html#l00052">frame_size</a>, <a class="el" href="../../d8/d1e/strcompat_8c_source.html#l00390">htonll()</a>, <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html#l00092">ast_websocket::opcode</a>, <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html#l00094">ast_websocket::payload</a>, <a class="el" href="../../d2/d1e/unaligned_8h_source.html#l00065">put_unaligned_uint16()</a>, <a class="el" href="../../d2/d1e/unaligned_8h_source.html#l00051">put_unaligned_uint64()</a>, <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html#l00089">ast_websocket::stream</a>, <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html#l00096">ast_websocket::timeout</a>, <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html#l00288">websocket_mask_payload()</a>, and <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html#l00363">websocket_opcode2str()</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../d6/d87/res__ari__events_8c_source.html#l00144">ast_ari_events_event_websocket_ws_established_cb()</a>, <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html#l00602">ast_websocket_read()</a>, <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html#l01484">ast_websocket_write_string()</a>, <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html#l01007">websocket_echo_callback()</a>, and <a class="el" href="../../d2/db8/res__pjsip__transport__websocket_8c_source.html#l00063">ws_send_msg()</a>.</p>
<div class="fragment"><div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;{</div><div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;   <span class="keywordtype">size_t</span> header_size = 2; <span class="comment">/* The minimum size of a websocket frame is 2 bytes */</span></div><div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;   <span class="keywordtype">char</span> *frame;</div><div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;   uint64_t length;</div><div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;   uint64_t <a class="code" href="../../d2/d97/format__g726_8c.html#ab9b9df9925ea7c54e551aa412bf0c59c">frame_size</a>;</div><div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;</div><div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;   <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(3, <span class="stringliteral">&quot;Writing websocket %s frame, length %&quot;</span> PRIu64 <span class="stringliteral">&quot;\n&quot;</span>,</div><div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;         <a class="code" href="../../de/d4c/res__http__websocket_8c.html#abf1644d4ceb871c277d1aa1cfb7a9a15">websocket_opcode2str</a>(opcode), payload_size);</div><div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;</div><div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;   <span class="keywordflow">if</span> (payload_size &lt; 126) {</div><div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;      length = payload_size;</div><div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;   } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (payload_size &lt; (1 &lt;&lt; 16)) {</div><div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;      length = 126;</div><div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;      <span class="comment">/* We need an additional 2 bytes to store the extended length */</span></div><div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;      header_size += 2;</div><div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;   } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;      length = 127;</div><div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;      <span class="comment">/* We need an additional 8 bytes to store the really really extended length */</span></div><div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;      header_size += 8;</div><div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;   }</div><div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;</div><div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;   <span class="keywordflow">if</span> (session-&gt;<a class="code" href="../../db/db6/structast__websocket.html#a58c585b74d6f77b0a24b7503ddf9d7e2">client</a>) {</div><div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;      <span class="comment">/* Additional 4 bytes for the client masking key */</span></div><div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;      header_size += 4;</div><div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;   }</div><div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;</div><div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;   frame_size = header_size + payload_size;</div><div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;</div><div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;   frame = <a class="code" href="../../d8/d8a/astmm_8h.html#a249282ecc7ba5a1a49fa75e9a33d1717">ast_alloca</a>(frame_size + 1);</div><div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;   memset(frame, 0, frame_size + 1);</div><div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;</div><div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;   frame[0] = opcode | 0x80;</div><div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;   frame[1] = length;</div><div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;</div><div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;   <span class="comment">/* Use the additional available bytes to store the length */</span></div><div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;   <span class="keywordflow">if</span> (length == 126) {</div><div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;      <a class="code" href="../../d2/d1e/unaligned_8h.html#a31285bcf21169ef487fa4431931b38d2">put_unaligned_uint16</a>(&amp;frame[2], htons(payload_size));</div><div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;   } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (length == 127) {</div><div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;      <a class="code" href="../../d2/d1e/unaligned_8h.html#aa6831c1ae2541740b10bb7a017a0cb27">put_unaligned_uint64</a>(&amp;frame[2], <a class="code" href="../../de/da3/include_2asterisk_2compat_8h.html#aebdb56d1e2558195c890a15f4146e3ce">htonll</a>(payload_size));</div><div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;   }</div><div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;</div><div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;   memcpy(&amp;frame[header_size], payload, payload_size);</div><div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;</div><div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;   <a class="code" href="../../de/d4c/res__http__websocket_8c.html#a724a006e8f51c16953462608c1eb6fcd">websocket_mask_payload</a>(session, frame, &amp;frame[header_size], payload_size);</div><div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;</div><div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#aa9fdb5d0a6157a56060d9f7279fe6c49">ao2_lock</a>(session);</div><div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;   <span class="keywordflow">if</span> (session-&gt;<a class="code" href="../../db/db6/structast__websocket.html#aa71fe3535b288c6e8f4e7f811b65fc3c">closing</a>) {</div><div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;      <a class="code" href="../../d5/da5/astobj2_8h.html#a9998bd156b936636a8780385e9a910b2">ao2_unlock</a>(session);</div><div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;   }</div><div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;</div><div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;   <a class="code" href="../../dd/d27/iostream_8h.html#aa8aec9f4431f3420f3ffa925e4dc306a">ast_iostream_set_timeout_sequence</a>(session-&gt;<a class="code" href="../../db/db6/structast__websocket.html#a36ac2dd734607a43ed90acb7e9d81ac5">stream</a>, <a class="code" href="../../de/df7/time_8h.html#ad3899efb6f0e348556ef69f5b16aa7f7">ast_tvnow</a>(), session-&gt;<a class="code" href="../../db/db6/structast__websocket.html#a493b57f443cc38b3d3df9c1e584d9d82">timeout</a>);</div><div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../dd/d27/iostream_8h.html#a6e0bf2afcbc5b330b96378626f9ac5b3">ast_iostream_write</a>(session-&gt;<a class="code" href="../../db/db6/structast__websocket.html#a36ac2dd734607a43ed90acb7e9d81ac5">stream</a>, frame, frame_size) != frame_size) {</div><div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;      <a class="code" href="../../d5/da5/astobj2_8h.html#a9998bd156b936636a8780385e9a910b2">ao2_unlock</a>(session);</div><div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;      <span class="comment">/* 1011 - server terminating connection due to not being able to fulfill the request */</span></div><div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;      <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(1, <span class="stringliteral">&quot;Closing WS with 1011 because we can&#39;t fulfill a write request\n&quot;</span>);</div><div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;      <a class="code" href="../../de/d4c/res__http__websocket_8c.html#ae4851ff13b6e90c8b88d5717465644ea">ast_websocket_close</a>(session, 1011);</div><div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;   }</div><div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;</div><div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;   <a class="code" href="../../dd/d27/iostream_8h.html#ace332a00f395eb7d1c93d0ee00bdf6c2">ast_iostream_set_timeout_disable</a>(session-&gt;<a class="code" href="../../db/db6/structast__websocket.html#a36ac2dd734607a43ed90acb7e9d81ac5">stream</a>);</div><div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#a9998bd156b936636a8780385e9a910b2">ao2_unlock</a>(session);</div><div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;</div><div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;   <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;}</div><div class="ttc" id="iostream_8h_html_a6e0bf2afcbc5b330b96378626f9ac5b3"><div class="ttname"><a href="../../dd/d27/iostream_8h.html#a6e0bf2afcbc5b330b96378626f9ac5b3">ast_iostream_write</a></div><div class="ttdeci">ssize_t ast_iostream_write(struct ast_iostream *stream, const void *buffer, size_t count)</div><div class="ttdoc">Write data to an iostream. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/dc8/iostream_8c_source.html#l00374">iostream.c:374</a></div></div>
<div class="ttc" id="res__http__websocket_8c_html_abf1644d4ceb871c277d1aa1cfb7a9a15"><div class="ttname"><a href="../../de/d4c/res__http__websocket_8c.html#abf1644d4ceb871c277d1aa1cfb7a9a15">websocket_opcode2str</a></div><div class="ttdeci">static const char * websocket_opcode2str(enum ast_websocket_opcode opcode)</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d4c/res__http__websocket_8c_source.html#l00363">res_http_websocket.c:363</a></div></div>
<div class="ttc" id="unaligned_8h_html_a31285bcf21169ef487fa4431931b38d2"><div class="ttname"><a href="../../d2/d1e/unaligned_8h.html#a31285bcf21169ef487fa4431931b38d2">put_unaligned_uint16</a></div><div class="ttdeci">static void put_unaligned_uint16(void *p, unsigned short datum)</div><div class="ttdef"><b>Definition:</b> <a href="../../d2/d1e/unaligned_8h_source.html#l00065">unaligned.h:65</a></div></div>
<div class="ttc" id="res__http__websocket_8c_html_ae4851ff13b6e90c8b88d5717465644ea"><div class="ttname"><a href="../../de/d4c/res__http__websocket_8c.html#ae4851ff13b6e90c8b88d5717465644ea">ast_websocket_close</a></div><div class="ttdeci">int AST_OPTIONAL_API_NAME() ast_websocket_close(struct ast_websocket *session, uint16_t reason)</div><div class="ttdoc">Close function for websocket session. </div><div class="ttdef"><b>Definition:</b> <a href="../../de/d4c/res__http__websocket_8c_source.html#l00308">res_http_websocket.c:308</a></div></div>
<div class="ttc" id="time_8h_html_ad3899efb6f0e348556ef69f5b16aa7f7"><div class="ttname"><a href="../../de/df7/time_8h.html#ad3899efb6f0e348556ef69f5b16aa7f7">ast_tvnow</a></div><div class="ttdeci">struct timeval ast_tvnow(void)</div><div class="ttdoc">Returns current timeval. Meant to replace calls to gettimeofday(). </div><div class="ttdef"><b>Definition:</b> <a href="../../de/df7/time_8h_source.html#l00150">time.h:150</a></div></div>
<div class="ttc" id="astobj2_8h_html_a9998bd156b936636a8780385e9a910b2"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#a9998bd156b936636a8780385e9a910b2">ao2_unlock</a></div><div class="ttdeci">#define ao2_unlock(a)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l00730">astobj2.h:730</a></div></div>
<div class="ttc" id="logger_8h_html_a3f248112c8d6ce7e3959aa723dade648"><div class="ttname"><a href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a></div><div class="ttdeci">#define ast_debug(level,...)</div><div class="ttdoc">Log a DEBUG message. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d8c/logger_8h_source.html#l00452">logger.h:452</a></div></div>
<div class="ttc" id="include_2asterisk_2compat_8h_html_aebdb56d1e2558195c890a15f4146e3ce"><div class="ttname"><a href="../../de/da3/include_2asterisk_2compat_8h.html#aebdb56d1e2558195c890a15f4146e3ce">htonll</a></div><div class="ttdeci">uint64_t htonll(uint64_t host64)</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d1e/strcompat_8c_source.html#l00390">strcompat.c:390</a></div></div>
<div class="ttc" id="astobj2_8h_html_aa9fdb5d0a6157a56060d9f7279fe6c49"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#aa9fdb5d0a6157a56060d9f7279fe6c49">ao2_lock</a></div><div class="ttdeci">#define ao2_lock(a)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l00718">astobj2.h:718</a></div></div>
<div class="ttc" id="structast__websocket_html_a58c585b74d6f77b0a24b7503ddf9d7e2"><div class="ttname"><a href="../../db/db6/structast__websocket.html#a58c585b74d6f77b0a24b7503ddf9d7e2">ast_websocket::client</a></div><div class="ttdeci">struct websocket_client * client</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d4c/res__http__websocket_8c_source.html#l00100">res_http_websocket.c:100</a></div></div>
<div class="ttc" id="res__http__websocket_8c_html_a724a006e8f51c16953462608c1eb6fcd"><div class="ttname"><a href="../../de/d4c/res__http__websocket_8c.html#a724a006e8f51c16953462608c1eb6fcd">websocket_mask_payload</a></div><div class="ttdeci">static void websocket_mask_payload(struct ast_websocket *session, char *frame, char *payload, uint64_t payload_size)</div><div class="ttdoc">Perform payload masking for client sessions. </div><div class="ttdef"><b>Definition:</b> <a href="../../de/d4c/res__http__websocket_8c_source.html#l00288">res_http_websocket.c:288</a></div></div>
<div class="ttc" id="astmm_8h_html_a249282ecc7ba5a1a49fa75e9a33d1717"><div class="ttname"><a href="../../d8/d8a/astmm_8h.html#a249282ecc7ba5a1a49fa75e9a33d1717">ast_alloca</a></div><div class="ttdeci">#define ast_alloca(size)</div><div class="ttdoc">call __builtin_alloca to ensure we get gcc builtin semantics </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d8a/astmm_8h_source.html#l00290">astmm.h:290</a></div></div>
<div class="ttc" id="iostream_8h_html_ace332a00f395eb7d1c93d0ee00bdf6c2"><div class="ttname"><a href="../../dd/d27/iostream_8h.html#ace332a00f395eb7d1c93d0ee00bdf6c2">ast_iostream_set_timeout_disable</a></div><div class="ttdeci">void ast_iostream_set_timeout_disable(struct ast_iostream *stream)</div><div class="ttdoc">Disable the iostream timeout timer. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/dc8/iostream_8c_source.html#l00113">iostream.c:113</a></div></div>
<div class="ttc" id="iostream_8h_html_aa8aec9f4431f3420f3ffa925e4dc306a"><div class="ttname"><a href="../../dd/d27/iostream_8h.html#aa8aec9f4431f3420f3ffa925e4dc306a">ast_iostream_set_timeout_sequence</a></div><div class="ttdeci">void ast_iostream_set_timeout_sequence(struct ast_iostream *stream, struct timeval start, int timeout)</div><div class="ttdoc">Set the iostream I/O sequence timeout timer. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/dc8/iostream_8c_source.html#l00139">iostream.c:139</a></div></div>
<div class="ttc" id="unaligned_8h_html_aa6831c1ae2541740b10bb7a017a0cb27"><div class="ttname"><a href="../../d2/d1e/unaligned_8h.html#aa6831c1ae2541740b10bb7a017a0cb27">put_unaligned_uint64</a></div><div class="ttdeci">static void put_unaligned_uint64(void *p, uint64_t datum)</div><div class="ttdef"><b>Definition:</b> <a href="../../d2/d1e/unaligned_8h_source.html#l00051">unaligned.h:51</a></div></div>
<div class="ttc" id="structast__websocket_html_aa71fe3535b288c6e8f4e7f811b65fc3c"><div class="ttname"><a href="../../db/db6/structast__websocket.html#aa71fe3535b288c6e8f4e7f811b65fc3c">ast_websocket::closing</a></div><div class="ttdeci">unsigned int closing</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d4c/res__http__websocket_8c_source.html#l00098">res_http_websocket.c:98</a></div></div>
<div class="ttc" id="structast__websocket_html_a36ac2dd734607a43ed90acb7e9d81ac5"><div class="ttname"><a href="../../db/db6/structast__websocket.html#a36ac2dd734607a43ed90acb7e9d81ac5">ast_websocket::stream</a></div><div class="ttdeci">struct ast_iostream * stream</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d4c/res__http__websocket_8c_source.html#l00089">res_http_websocket.c:89</a></div></div>
<div class="ttc" id="structast__websocket_html_a493b57f443cc38b3d3df9c1e584d9d82"><div class="ttname"><a href="../../db/db6/structast__websocket.html#a493b57f443cc38b3d3df9c1e584d9d82">ast_websocket::timeout</a></div><div class="ttdeci">int timeout</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d4c/res__http__websocket_8c_source.html#l00096">res_http_websocket.c:96</a></div></div>
<div class="ttc" id="format__g726_8c_html_ab9b9df9925ea7c54e551aa412bf0c59c"><div class="ttname"><a href="../../d2/d97/format__g726_8c.html#ab9b9df9925ea7c54e551aa412bf0c59c">frame_size</a></div><div class="ttdeci">static int frame_size[4]</div><div class="ttdef"><b>Definition:</b> <a href="../../d2/d97/format__g726_8c_source.html#l00052">format_g726.c:52</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a273d38d787b904025da601b751d91647"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a273d38d787b904025da601b751d91647">&#9670;&nbsp;</a></span>ast_websocket_write_string()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="../../df/d3c/optional__api_8h.html#abe6ec88934f99eb74444f6c4a92353ec">AST_OPTIONAL_API_NAME</a>() ast_websocket_write_string </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="../../db/db6/structast__websocket.html">ast_websocket</a> *&#160;</td>
          <td class="paramname"><em>ws</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>buf</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html#l01484">1484</a> of file <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html">res_http_websocket.c</a>.</p>

<p class="reference">References <a class="el" href="../../d1/d8c/logger_8h_source.html#l00452">ast_debug</a>, <a class="el" href="../../d0/d0c/http__websocket_8h_source.html#l00051">AST_WEBSOCKET_OPCODE_TEXT</a>, <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html#l00374">ast_websocket_write()</a>, <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html#l00103">ast_websocket::buf</a>, and <a class="el" href="../../d9/d1e/func__strings_8c_source.html#l01344">len()</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../d5/dfe/chan__sip_8c_source.html#l03801">__sip_xmit()</a>, <a class="el" href="../../d0/d0c/http__websocket_8h_source.html#l00274">__stub__ast_websocket_write()</a>, <a class="el" href="../../d8/d44/ari__websockets_8c_source.html#l00158">ast_ari_websocket_session_write()</a>, <a class="el" href="../../de/de9/test__websocket__client_8c_source.html#l00044">AST_TEST_DEFINE()</a>, and <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html#l01440">ast_websocket_read_string()</a>.</p>
<div class="fragment"><div class="line"><a name="l01485"></a><span class="lineno"> 1485</span>&#160;{</div><div class="line"><a name="l01486"></a><span class="lineno"> 1486</span>&#160;   uint64_t <a class="code" href="../../d9/d1e/func__strings_8c.html#af24e73aaf92f3000fda15d285e66df24">len</a> = strlen(<a class="code" href="../../dd/d7c/eagi__proxy_8c.html#ac95651d79c608a3148973b5b1fc9e525">buf</a>);</div><div class="line"><a name="l01487"></a><span class="lineno"> 1487</span>&#160;</div><div class="line"><a name="l01488"></a><span class="lineno"> 1488</span>&#160;   <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(3, <span class="stringliteral">&quot;Writing websocket string of length %&quot;</span> PRIu64 <span class="stringliteral">&quot;\n&quot;</span>, len);</div><div class="line"><a name="l01489"></a><span class="lineno"> 1489</span>&#160;</div><div class="line"><a name="l01490"></a><span class="lineno"> 1490</span>&#160;   <span class="comment">/* We do not pass strlen(buf) to ast_websocket_write() directly because the</span></div><div class="line"><a name="l01491"></a><span class="lineno"> 1491</span>&#160;<span class="comment">    * size_t returned by strlen() may not require the same storage size</span></div><div class="line"><a name="l01492"></a><span class="lineno"> 1492</span>&#160;<span class="comment">    * as the uint64_t that ast_websocket_write() uses. This normally</span></div><div class="line"><a name="l01493"></a><span class="lineno"> 1493</span>&#160;<span class="comment">    * would not cause a problem, but since ast_websocket_write() uses</span></div><div class="line"><a name="l01494"></a><span class="lineno"> 1494</span>&#160;<span class="comment">    * the optional API, this function call goes through a series of macros</span></div><div class="line"><a name="l01495"></a><span class="lineno"> 1495</span>&#160;<span class="comment">    * that may cause a 32-bit to 64-bit conversion to go awry.</span></div><div class="line"><a name="l01496"></a><span class="lineno"> 1496</span>&#160;<span class="comment">    */</span></div><div class="line"><a name="l01497"></a><span class="lineno"> 1497</span>&#160;   <span class="keywordflow">return</span> <a class="code" href="../../de/d4c/res__http__websocket_8c.html#a1a6e44db94d8b4e8c06bf456bb0174ad">ast_websocket_write</a>(ws, <a class="code" href="../../d0/d0c/http__websocket_8h.html#a8cb89d2edeb737bfc4efb15902cd19bcaed1971e4feac2449c2db014b144d65a0">AST_WEBSOCKET_OPCODE_TEXT</a>,</div><div class="line"><a name="l01498"></a><span class="lineno"> 1498</span>&#160;               (<span class="keywordtype">char</span> *)<a class="code" href="../../dd/d7c/eagi__proxy_8c.html#ac95651d79c608a3148973b5b1fc9e525">buf</a>, len);</div><div class="line"><a name="l01499"></a><span class="lineno"> 1499</span>&#160;}</div><div class="ttc" id="eagi__proxy_8c_html_ac95651d79c608a3148973b5b1fc9e525"><div class="ttname"><a href="../../dd/d7c/eagi__proxy_8c.html#ac95651d79c608a3148973b5b1fc9e525">buf</a></div><div class="ttdeci">char buf[BUFSIZE]</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d7c/eagi__proxy_8c_source.html#l00066">eagi_proxy.c:66</a></div></div>
<div class="ttc" id="logger_8h_html_a3f248112c8d6ce7e3959aa723dade648"><div class="ttname"><a href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a></div><div class="ttdeci">#define ast_debug(level,...)</div><div class="ttdoc">Log a DEBUG message. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d8c/logger_8h_source.html#l00452">logger.h:452</a></div></div>
<div class="ttc" id="http__websocket_8h_html_a8cb89d2edeb737bfc4efb15902cd19bcaed1971e4feac2449c2db014b144d65a0"><div class="ttname"><a href="../../d0/d0c/http__websocket_8h.html#a8cb89d2edeb737bfc4efb15902cd19bcaed1971e4feac2449c2db014b144d65a0">AST_WEBSOCKET_OPCODE_TEXT</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d0c/http__websocket_8h_source.html#l00051">http_websocket.h:51</a></div></div>
<div class="ttc" id="func__strings_8c_html_af24e73aaf92f3000fda15d285e66df24"><div class="ttname"><a href="../../d9/d1e/func__strings_8c.html#af24e73aaf92f3000fda15d285e66df24">len</a></div><div class="ttdeci">static int len(struct ast_channel *chan, const char *cmd, char *data, char *buf, size_t buflen)</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d1e/func__strings_8c_source.html#l01344">func_strings.c:1344</a></div></div>
<div class="ttc" id="res__http__websocket_8c_html_a1a6e44db94d8b4e8c06bf456bb0174ad"><div class="ttname"><a href="../../de/d4c/res__http__websocket_8c.html#a1a6e44db94d8b4e8c06bf456bb0174ad">ast_websocket_write</a></div><div class="ttdeci">int AST_OPTIONAL_API_NAME() ast_websocket_write(struct ast_websocket *session, enum ast_websocket_opcode opcode, char *payload, uint64_t payload_size)</div><div class="ttdoc">Write function for websocket traffic. </div><div class="ttdef"><b>Definition:</b> <a href="../../de/d4c/res__http__websocket_8c_source.html#l00374">res_http_websocket.c:374</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="ac3382bf6da54c56b37069bd76bbdf4f9"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac3382bf6da54c56b37069bd76bbdf4f9">&#9670;&nbsp;</a></span>load_module()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int load_module </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html#l01501">1501</a> of file <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html">res_http_websocket.c</a>.</p>

<p class="reference">References <a class="el" href="../../dd/d43/http_8c_source.html#l00673">ast_http_uri_link()</a>, <a class="el" href="../../d5/d16/module_8h_source.html#l00078">AST_MODULE_LOAD_DECLINE</a>, <a class="el" href="../../dd/d56/http_8h_source.html#l00114">ast_http_uri::data</a>, <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html#l01043">websocket_add_protocol_internal()</a>, <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html#l01007">websocket_echo_callback()</a>, and <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html#l00162">websocket_server_internal_create()</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html#l01513">unload_module()</a>.</p>
<div class="fragment"><div class="line"><a name="l01502"></a><span class="lineno"> 1502</span>&#160;{</div><div class="line"><a name="l01503"></a><span class="lineno"> 1503</span>&#160;   <a class="code" href="../../de/d4c/res__http__websocket_8c.html#a250d189c16de52a67daa3ab480eb8aa1">websocketuri</a>.<a class="code" href="../../d0/d6c/structast__http__uri.html#a735984d41155bc1032e09bece8f8d66d">data</a> = <a class="code" href="../../de/d4c/res__http__websocket_8c.html#a90ad4f2355601e1464ef3004264c7afe">websocket_server_internal_create</a>();</div><div class="line"><a name="l01504"></a><span class="lineno"> 1504</span>&#160;   <span class="keywordflow">if</span> (!<a class="code" href="../../de/d4c/res__http__websocket_8c.html#a250d189c16de52a67daa3ab480eb8aa1">websocketuri</a>.<a class="code" href="../../d0/d6c/structast__http__uri.html#a735984d41155bc1032e09bece8f8d66d">data</a>) {</div><div class="line"><a name="l01505"></a><span class="lineno"> 1505</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../d5/d16/module_8h.html#adc09474f0ff557e9925b722ee5b952dfac742921e9f9512d28f62c74ea2affe57">AST_MODULE_LOAD_DECLINE</a>;</div><div class="line"><a name="l01506"></a><span class="lineno"> 1506</span>&#160;   }</div><div class="line"><a name="l01507"></a><span class="lineno"> 1507</span>&#160;   <a class="code" href="../../dd/d56/http_8h.html#ac99d56925cf94f8cf3ed0acac52e2d75">ast_http_uri_link</a>(&amp;<a class="code" href="../../de/d4c/res__http__websocket_8c.html#a250d189c16de52a67daa3ab480eb8aa1">websocketuri</a>);</div><div class="line"><a name="l01508"></a><span class="lineno"> 1508</span>&#160;   <a class="code" href="../../de/d4c/res__http__websocket_8c.html#aba0a4f6f2ebf4ebff817aeae8d6d690f">websocket_add_protocol_internal</a>(<span class="stringliteral">&quot;echo&quot;</span>, <a class="code" href="../../de/d4c/res__http__websocket_8c.html#a16179dccdf130e1ec1d0ff701fb5fe5d">websocket_echo_callback</a>);</div><div class="line"><a name="l01509"></a><span class="lineno"> 1509</span>&#160;</div><div class="line"><a name="l01510"></a><span class="lineno"> 1510</span>&#160;   <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l01511"></a><span class="lineno"> 1511</span>&#160;}</div><div class="ttc" id="http_8h_html_ac99d56925cf94f8cf3ed0acac52e2d75"><div class="ttname"><a href="../../dd/d56/http_8h.html#ac99d56925cf94f8cf3ed0acac52e2d75">ast_http_uri_link</a></div><div class="ttdeci">int ast_http_uri_link(struct ast_http_uri *urihandler)</div><div class="ttdoc">Register a URI handler. </div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d43/http_8c_source.html#l00673">http.c:673</a></div></div>
<div class="ttc" id="res__http__websocket_8c_html_a16179dccdf130e1ec1d0ff701fb5fe5d"><div class="ttname"><a href="../../de/d4c/res__http__websocket_8c.html#a16179dccdf130e1ec1d0ff701fb5fe5d">websocket_echo_callback</a></div><div class="ttdeci">static void websocket_echo_callback(struct ast_websocket *session, struct ast_variable *parameters, struct ast_variable *headers)</div><div class="ttdoc">Simple echo implementation which echoes received text and binary frames. </div><div class="ttdef"><b>Definition:</b> <a href="../../de/d4c/res__http__websocket_8c_source.html#l01007">res_http_websocket.c:1007</a></div></div>
<div class="ttc" id="res__http__websocket_8c_html_a250d189c16de52a67daa3ab480eb8aa1"><div class="ttname"><a href="../../de/d4c/res__http__websocket_8c.html#a250d189c16de52a67daa3ab480eb8aa1">websocketuri</a></div><div class="ttdeci">static struct ast_http_uri websocketuri</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d4c/res__http__websocket_8c_source.html#l00997">res_http_websocket.c:997</a></div></div>
<div class="ttc" id="res__http__websocket_8c_html_aba0a4f6f2ebf4ebff817aeae8d6d690f"><div class="ttname"><a href="../../de/d4c/res__http__websocket_8c.html#aba0a4f6f2ebf4ebff817aeae8d6d690f">websocket_add_protocol_internal</a></div><div class="ttdeci">static int websocket_add_protocol_internal(const char *name, ast_websocket_callback callback)</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d4c/res__http__websocket_8c_source.html#l01043">res_http_websocket.c:1043</a></div></div>
<div class="ttc" id="module_8h_html_adc09474f0ff557e9925b722ee5b952dfac742921e9f9512d28f62c74ea2affe57"><div class="ttname"><a href="../../d5/d16/module_8h.html#adc09474f0ff557e9925b722ee5b952dfac742921e9f9512d28f62c74ea2affe57">AST_MODULE_LOAD_DECLINE</a></div><div class="ttdoc">Module has failed to load, may be in an inconsistent state. </div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d16/module_8h_source.html#l00078">module.h:78</a></div></div>
<div class="ttc" id="structast__http__uri_html_a735984d41155bc1032e09bece8f8d66d"><div class="ttname"><a href="../../d0/d6c/structast__http__uri.html#a735984d41155bc1032e09bece8f8d66d">ast_http_uri::data</a></div><div class="ttdeci">void * data</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d56/http_8h_source.html#l00114">http.h:114</a></div></div>
<div class="ttc" id="res__http__websocket_8c_html_a90ad4f2355601e1464ef3004264c7afe"><div class="ttname"><a href="../../de/d4c/res__http__websocket_8c.html#a90ad4f2355601e1464ef3004264c7afe">websocket_server_internal_create</a></div><div class="ttdeci">static struct ast_websocket_server * websocket_server_internal_create(void)</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d4c/res__http__websocket_8c_source.html#l00162">res_http_websocket.c:162</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a912dbb1619c0d406fb8451ae4f977a1b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a912dbb1619c0d406fb8451ae4f977a1b">&#9670;&nbsp;</a></span>one_protocol()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static struct <a class="el" href="../../dc/dcf/structast__websocket__protocol.html">ast_websocket_protocol</a>* one_protocol </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="../../db/d66/structast__websocket__server.html">ast_websocket_server</a> *&#160;</td>
          <td class="paramname"><em>server</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>If the server has exactly one configured protocol, return it. </p>

<p class="definition">Definition at line <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html#l00752">752</a> of file <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html">res_http_websocket.c</a>.</p>

<p class="reference">References <a class="el" href="../../d5/da5/astobj2_8h_source.html#l01716">ao2_callback</a>, <a class="el" href="../../d7/d22/astobj2__container_8c_source.html#l00034">ao2_container_count()</a>, <a class="el" href="../../df/d44/app__meetme_8c_source.html#l01091">lock</a>, <a class="el" href="../../dc/d7f/resample_8c_source.html#l00096">NULL</a>, <a class="el" href="../../d5/da5/astobj2_8h_source.html#l01067">OBJ_NOLOCK</a>, <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html#l00133">ast_websocket_server::protocols</a>, and <a class="el" href="../../dd/d42/lock_8h_source.html#l00602">SCOPED_AO2LOCK</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html#l00790">ast_websocket_uri_cb()</a>.</p>
<div class="fragment"><div class="line"><a name="l00754"></a><span class="lineno">  754</span>&#160;{</div><div class="line"><a name="l00755"></a><span class="lineno">  755</span>&#160;   <a class="code" href="../../dd/d42/lock_8h.html#a2cfb325ed371eb6e629446bac4676e9f">SCOPED_AO2LOCK</a>(<a class="code" href="../../df/d44/app__meetme_8c.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>, server-&gt;<a class="code" href="../../db/d66/structast__websocket__server.html#a2a8b976c358cd42ed5b5af57499588d3">protocols</a>);</div><div class="line"><a name="l00756"></a><span class="lineno">  756</span>&#160;</div><div class="line"><a name="l00757"></a><span class="lineno">  757</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d5/da5/astobj2_8h.html#a512cc40ce96c63b3d5c78040baa4c9cd">ao2_container_count</a>(server-&gt;<a class="code" href="../../db/d66/structast__websocket__server.html#a2a8b976c358cd42ed5b5af57499588d3">protocols</a>) != 1) {</div><div class="line"><a name="l00758"></a><span class="lineno">  758</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l00759"></a><span class="lineno">  759</span>&#160;   }</div><div class="line"><a name="l00760"></a><span class="lineno">  760</span>&#160;</div><div class="line"><a name="l00761"></a><span class="lineno">  761</span>&#160;   <span class="keywordflow">return</span> <a class="code" href="../../d5/da5/astobj2_8h.html#a47857055118a703ae87ea5ebaf4842ed">ao2_callback</a>(server-&gt;<a class="code" href="../../db/d66/structast__websocket__server.html#a2a8b976c358cd42ed5b5af57499588d3">protocols</a>, <a class="code" href="../../d5/da5/astobj2_8h.html#ad9d009e87e737af900825b36db55a35ca52efdf13b66ae502e2e20a5f49f068de">OBJ_NOLOCK</a>, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div><div class="line"><a name="l00762"></a><span class="lineno">  762</span>&#160;}</div><div class="ttc" id="astobj2_8h_html_a512cc40ce96c63b3d5c78040baa4c9cd"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#a512cc40ce96c63b3d5c78040baa4c9cd">ao2_container_count</a></div><div class="ttdeci">int ao2_container_count(struct ao2_container *c)</div><div class="ttdoc">Returns the number of elements in a container. </div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d22/astobj2__container_8c_source.html#l00034">astobj2_container.c:34</a></div></div>
<div class="ttc" id="astobj2_8h_html_a47857055118a703ae87ea5ebaf4842ed"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#a47857055118a703ae87ea5ebaf4842ed">ao2_callback</a></div><div class="ttdeci">#define ao2_callback(c, flags, cb_fn, arg)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l01716">astobj2.h:1716</a></div></div>
<div class="ttc" id="astobj2_8h_html_ad9d009e87e737af900825b36db55a35ca52efdf13b66ae502e2e20a5f49f068de"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#ad9d009e87e737af900825b36db55a35ca52efdf13b66ae502e2e20a5f49f068de">OBJ_NOLOCK</a></div><div class="ttdoc">Assume that the ao2_container is already locked. </div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l01067">astobj2.h:1067</a></div></div>
<div class="ttc" id="structast__websocket__server_html_a2a8b976c358cd42ed5b5af57499588d3"><div class="ttname"><a href="../../db/d66/structast__websocket__server.html#a2a8b976c358cd42ed5b5af57499588d3">ast_websocket_server::protocols</a></div><div class="ttdeci">struct ao2_container * protocols</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d4c/res__http__websocket_8c_source.html#l00133">res_http_websocket.c:133</a></div></div>
<div class="ttc" id="resample_8c_html_a070d2ce7b6bb7e5c05602aa8c308d0c4"><div class="ttname"><a href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a></div><div class="ttdeci">#define NULL</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d7f/resample_8c_source.html#l00096">resample.c:96</a></div></div>
<div class="ttc" id="app__meetme_8c_html_adf04f66344e3fb0a6f6a69bf39d19902"><div class="ttname"><a href="../../df/d44/app__meetme_8c.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a></div><div class="ttdeci">ast_mutex_t lock</div><div class="ttdef"><b>Definition:</b> <a href="../../df/d44/app__meetme_8c_source.html#l01091">app_meetme.c:1091</a></div></div>
<div class="ttc" id="lock_8h_html_a2cfb325ed371eb6e629446bac4676e9f"><div class="ttname"><a href="../../dd/d42/lock_8h.html#a2cfb325ed371eb6e629446bac4676e9f">SCOPED_AO2LOCK</a></div><div class="ttdeci">#define SCOPED_AO2LOCK(varname, obj)</div><div class="ttdoc">scoped lock specialization for ao2 mutexes. </div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d42/lock_8h_source.html#l00602">lock.h:602</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a7e26998f99ba89e31a4ef2f2c899b758"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a7e26998f99ba89e31a4ef2f2c899b758">&#9670;&nbsp;</a></span>protocol_cmp_fn()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int protocol_cmp_fn </td>
          <td>(</td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>obj</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>arg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>flags</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Comparison function for protocols. </p>

<p class="definition">Definition at line <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html#l00116">116</a> of file <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html">res_http_websocket.c</a>.</p>

<p class="reference">References <a class="el" href="../../d5/da5/astobj2_8h_source.html#l01031">CMP_MATCH</a>, <a class="el" href="../../d5/da5/astobj2_8h_source.html#l01032">CMP_STOP</a>, <a class="el" href="../../d0/d0c/http__websocket_8h_source.html#l00114">ast_websocket_protocol::name</a>, and <a class="el" href="../../d5/da5/astobj2_8h_source.html#l01155">OBJ_KEY</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html#l00143">websocket_server_create_impl()</a>.</p>
<div class="fragment"><div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;{</div><div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;   <span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="../../dc/dcf/structast__websocket__protocol.html">ast_websocket_protocol</a> *protocol1 = obj, *protocol2 = arg;</div><div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;   <span class="keyword">const</span> <span class="keywordtype">char</span> *protocol = arg;</div><div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;</div><div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;   <span class="keywordflow">return</span> !strcasecmp(protocol1-&gt;<a class="code" href="../../dc/dcf/structast__websocket__protocol.html#a5ac083a645d964373f022d03df4849c8">name</a>, flags &amp; <a class="code" href="../../d5/da5/astobj2_8h.html#a22f40c733a085f259af94e864ebaa09a">OBJ_KEY</a> ? protocol : protocol2-&gt;name) ? <a class="code" href="../../d5/da5/astobj2_8h.html#a1f8b41308be4c47de8ff89a3b9c7e7d1a1959468a3c5d6aecd2fa1272d8e30fbf">CMP_MATCH</a> | <a class="code" href="../../d5/da5/astobj2_8h.html#a1f8b41308be4c47de8ff89a3b9c7e7d1a75382dc9117cc118719edf6c3d2b71df">CMP_STOP</a> : 0;</div><div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;}</div><div class="ttc" id="structast__websocket__protocol_html"><div class="ttname"><a href="../../dc/dcf/structast__websocket__protocol.html">ast_websocket_protocol</a></div><div class="ttdoc">A websocket protocol implementation. </div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d0c/http__websocket_8h_source.html#l00112">http_websocket.h:112</a></div></div>
<div class="ttc" id="astobj2_8h_html_a22f40c733a085f259af94e864ebaa09a"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#a22f40c733a085f259af94e864ebaa09a">OBJ_KEY</a></div><div class="ttdeci">#define OBJ_KEY</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l01155">astobj2.h:1155</a></div></div>
<div class="ttc" id="astobj2_8h_html_a1f8b41308be4c47de8ff89a3b9c7e7d1a75382dc9117cc118719edf6c3d2b71df"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#a1f8b41308be4c47de8ff89a3b9c7e7d1a75382dc9117cc118719edf6c3d2b71df">CMP_STOP</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l01032">astobj2.h:1032</a></div></div>
<div class="ttc" id="structast__websocket__protocol_html_a5ac083a645d964373f022d03df4849c8"><div class="ttname"><a href="../../dc/dcf/structast__websocket__protocol.html#a5ac083a645d964373f022d03df4849c8">ast_websocket_protocol::name</a></div><div class="ttdeci">char * name</div><div class="ttdoc">Name of the protocol. </div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d0c/http__websocket_8h_source.html#l00114">http_websocket.h:114</a></div></div>
<div class="ttc" id="astobj2_8h_html_a1f8b41308be4c47de8ff89a3b9c7e7d1a1959468a3c5d6aecd2fa1272d8e30fbf"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#a1f8b41308be4c47de8ff89a3b9c7e7d1a1959468a3c5d6aecd2fa1272d8e30fbf">CMP_MATCH</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l01031">astobj2.h:1031</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a8e476c76d070ad965d9f7cc6e6063cbf"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8e476c76d070ad965d9f7cc6e6063cbf">&#9670;&nbsp;</a></span>protocol_destroy_fn()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void protocol_destroy_fn </td>
          <td>(</td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>obj</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Destructor function for protocols. </p>

<p class="definition">Definition at line <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html#l00125">125</a> of file <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html">res_http_websocket.c</a>.</p>

<p class="reference">References <a class="el" href="../../d8/d8a/astmm_8h_source.html#l00182">ast_free</a>, and <a class="el" href="../../d0/d0c/http__websocket_8h_source.html#l00114">ast_websocket_protocol::name</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html#l00191">ast_websocket_sub_protocol_alloc()</a>.</p>
<div class="fragment"><div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;{</div><div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../dc/dcf/structast__websocket__protocol.html">ast_websocket_protocol</a> *protocol = obj;</div><div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;   <a class="code" href="../../d8/d8a/astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(protocol-&gt;<a class="code" href="../../dc/dcf/structast__websocket__protocol.html#a5ac083a645d964373f022d03df4849c8">name</a>);</div><div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;}</div><div class="ttc" id="structast__websocket__protocol_html"><div class="ttname"><a href="../../dc/dcf/structast__websocket__protocol.html">ast_websocket_protocol</a></div><div class="ttdoc">A websocket protocol implementation. </div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d0c/http__websocket_8h_source.html#l00112">http_websocket.h:112</a></div></div>
<div class="ttc" id="structast__websocket__protocol_html_a5ac083a645d964373f022d03df4849c8"><div class="ttname"><a href="../../dc/dcf/structast__websocket__protocol.html#a5ac083a645d964373f022d03df4849c8">ast_websocket_protocol::name</a></div><div class="ttdeci">char * name</div><div class="ttdoc">Name of the protocol. </div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d0c/http__websocket_8h_source.html#l00114">http_websocket.h:114</a></div></div>
<div class="ttc" id="astmm_8h_html_a402072d6789f6ed9e3a81da27504127e"><div class="ttname"><a href="../../d8/d8a/astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a></div><div class="ttdeci">#define ast_free(a)</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d8a/astmm_8h_source.html#l00182">astmm.h:182</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="ab1f7b44119d3a7df6f3517212a8f8e51"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab1f7b44119d3a7df6f3517212a8f8e51">&#9670;&nbsp;</a></span>protocol_hash_fn()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int protocol_hash_fn </td>
          <td>(</td>
          <td class="paramtype">const void *&#160;</td>
          <td class="paramname"><em>obj</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const int&#160;</td>
          <td class="paramname"><em>flags</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Hashing function for protocols. </p>

<p class="definition">Definition at line <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html#l00107">107</a> of file <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html">res_http_websocket.c</a>.</p>

<p class="reference">References <a class="el" href="../../d6/d90/strings_8h_source.html#l01250">ast_str_case_hash()</a>, <a class="el" href="../../d0/d29/cdr__mysql_8c_source.html#l00074">name</a>, <a class="el" href="../../d0/d0c/http__websocket_8h_source.html#l00114">ast_websocket_protocol::name</a>, and <a class="el" href="../../d5/da5/astobj2_8h_source.html#l01155">OBJ_KEY</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html#l00143">websocket_server_create_impl()</a>.</p>
<div class="fragment"><div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;{</div><div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;   <span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="../../dc/dcf/structast__websocket__protocol.html">ast_websocket_protocol</a> *protocol = obj;</div><div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;   <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="../../d0/d29/cdr__mysql_8c.html#a0980a105ccb863d8008eb6201a51da52">name</a> = obj;</div><div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;</div><div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;   <span class="keywordflow">return</span> <a class="code" href="../../d6/d90/strings_8h.html#ab08f8db2a7258e538a0da7417f58db58">ast_str_case_hash</a>(flags &amp; <a class="code" href="../../d5/da5/astobj2_8h.html#a22f40c733a085f259af94e864ebaa09a">OBJ_KEY</a> ? name : protocol-&gt;<a class="code" href="../../dc/dcf/structast__websocket__protocol.html#a5ac083a645d964373f022d03df4849c8">name</a>);</div><div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;}</div><div class="ttc" id="structast__websocket__protocol_html"><div class="ttname"><a href="../../dc/dcf/structast__websocket__protocol.html">ast_websocket_protocol</a></div><div class="ttdoc">A websocket protocol implementation. </div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d0c/http__websocket_8h_source.html#l00112">http_websocket.h:112</a></div></div>
<div class="ttc" id="astobj2_8h_html_a22f40c733a085f259af94e864ebaa09a"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#a22f40c733a085f259af94e864ebaa09a">OBJ_KEY</a></div><div class="ttdeci">#define OBJ_KEY</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l01155">astobj2.h:1155</a></div></div>
<div class="ttc" id="structast__websocket__protocol_html_a5ac083a645d964373f022d03df4849c8"><div class="ttname"><a href="../../dc/dcf/structast__websocket__protocol.html#a5ac083a645d964373f022d03df4849c8">ast_websocket_protocol::name</a></div><div class="ttdeci">char * name</div><div class="ttdoc">Name of the protocol. </div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d0c/http__websocket_8h_source.html#l00114">http_websocket.h:114</a></div></div>
<div class="ttc" id="cdr__mysql_8c_html_a0980a105ccb863d8008eb6201a51da52"><div class="ttname"><a href="../../d0/d29/cdr__mysql_8c.html#a0980a105ccb863d8008eb6201a51da52">name</a></div><div class="ttdeci">static const char name[]</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d29/cdr__mysql_8c_source.html#l00074">cdr_mysql.c:74</a></div></div>
<div class="ttc" id="strings_8h_html_ab08f8db2a7258e538a0da7417f58db58"><div class="ttname"><a href="../../d6/d90/strings_8h.html#ab08f8db2a7258e538a0da7417f58db58">ast_str_case_hash</a></div><div class="ttdeci">static force_inline int attribute_pure ast_str_case_hash(const char *str)</div><div class="ttdoc">Compute a hash value on a case-insensitive string. </div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d90/strings_8h_source.html#l01250">strings.h:1250</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="aed324e37497858b50c441fef9f636ccf"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aed324e37497858b50c441fef9f636ccf">&#9670;&nbsp;</a></span>session_destroy_fn()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void session_destroy_fn </td>
          <td>(</td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>obj</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Destructor function for sessions. </p>

<p class="definition">Definition at line <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html#l00173">173</a> of file <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html">res_http_websocket.c</a>.</p>

<p class="reference">References <a class="el" href="../../d5/da5/astobj2_8h_source.html#l01958">ao2_cleanup</a>, <a class="el" href="../../d8/d8a/astmm_8h_source.html#l00182">ast_free</a>, <a class="el" href="../../d1/dc8/iostream_8c_source.html#l00528">ast_iostream_close()</a>, <a class="el" href="../../db/df1/netsock2_8h_source.html#l00260">ast_sockaddr_stringify()</a>, <a class="el" href="../../d1/d8c/logger_8h_source.html#l00463">ast_verb</a>, <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html#l00308">ast_websocket_close()</a>, <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html#l00100">ast_websocket::client</a>, <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html#l00102">ast_websocket::close_status_code</a>, <a class="el" href="../../dc/d7f/resample_8c_source.html#l00096">NULL</a>, <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html#l00094">ast_websocket::payload</a>, <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html#l00090">ast_websocket::remote_address</a>, <a class="el" href="../../d2/d4d/astman_8c.html#ac4a6ae0400e4457f0b35beddec80c93d">session</a>, and <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html#l00089">ast_websocket::stream</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html#l00790">ast_websocket_uri_cb()</a>, and <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html#l01224">websocket_client_create()</a>.</p>
<div class="fragment"><div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;{</div><div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../db/db6/structast__websocket.html">ast_websocket</a> *<a class="code" href="../../d2/d4d/astman_8c.html#ac4a6ae0400e4457f0b35beddec80c93d">session</a> = obj;</div><div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;</div><div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;   <span class="keywordflow">if</span> (session-&gt;<a class="code" href="../../db/db6/structast__websocket.html#a36ac2dd734607a43ed90acb7e9d81ac5">stream</a>) {</div><div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;      <a class="code" href="../../de/d4c/res__http__websocket_8c.html#ae4851ff13b6e90c8b88d5717465644ea">ast_websocket_close</a>(session, session-&gt;<a class="code" href="../../db/db6/structast__websocket.html#a703e6acb6529d1dbabf148b897387f94">close_status_code</a>);</div><div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;      <span class="keywordflow">if</span> (session-&gt;<a class="code" href="../../db/db6/structast__websocket.html#a36ac2dd734607a43ed90acb7e9d81ac5">stream</a>) {</div><div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;         <a class="code" href="../../dd/d27/iostream_8h.html#ac0297067e6921ce6a2c5f3b3d0647d3a">ast_iostream_close</a>(session-&gt;<a class="code" href="../../db/db6/structast__websocket.html#a36ac2dd734607a43ed90acb7e9d81ac5">stream</a>);</div><div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;         session-&gt;<a class="code" href="../../db/db6/structast__websocket.html#a36ac2dd734607a43ed90acb7e9d81ac5">stream</a> = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;         <a class="code" href="../../d1/d8c/logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(2, <span class="stringliteral">&quot;WebSocket connection %s &#39;%s&#39; closed\n&quot;</span>, session-&gt;<a class="code" href="../../db/db6/structast__websocket.html#a58c585b74d6f77b0a24b7503ddf9d7e2">client</a> ? <span class="stringliteral">&quot;to&quot;</span> : <span class="stringliteral">&quot;from&quot;</span>,</div><div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;            <a class="code" href="../../db/df1/netsock2_8h.html#aae9156c7fe6dff51463f29ed1c3b96c9">ast_sockaddr_stringify</a>(&amp;session-&gt;<a class="code" href="../../db/db6/structast__websocket.html#a9dfcf41ffc851689eea95be7bb1f849a">remote_address</a>));</div><div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;      }</div><div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;   }</div><div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;</div><div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#a6321ee982370c55ab3c24c72c562cbdd">ao2_cleanup</a>(session-&gt;<a class="code" href="../../db/db6/structast__websocket.html#a58c585b74d6f77b0a24b7503ddf9d7e2">client</a>);</div><div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;   <a class="code" href="../../d8/d8a/astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(session-&gt;<a class="code" href="../../db/db6/structast__websocket.html#a18f141cb2726073503afb9f1d6c85efb">payload</a>);</div><div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;}</div><div class="ttc" id="structast__websocket_html_a18f141cb2726073503afb9f1d6c85efb"><div class="ttname"><a href="../../db/db6/structast__websocket.html#a18f141cb2726073503afb9f1d6c85efb">ast_websocket::payload</a></div><div class="ttdeci">char * payload</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d4c/res__http__websocket_8c_source.html#l00094">res_http_websocket.c:94</a></div></div>
<div class="ttc" id="res__http__websocket_8c_html_ae4851ff13b6e90c8b88d5717465644ea"><div class="ttname"><a href="../../de/d4c/res__http__websocket_8c.html#ae4851ff13b6e90c8b88d5717465644ea">ast_websocket_close</a></div><div class="ttdeci">int AST_OPTIONAL_API_NAME() ast_websocket_close(struct ast_websocket *session, uint16_t reason)</div><div class="ttdoc">Close function for websocket session. </div><div class="ttdef"><b>Definition:</b> <a href="../../de/d4c/res__http__websocket_8c_source.html#l00308">res_http_websocket.c:308</a></div></div>
<div class="ttc" id="resample_8c_html_a070d2ce7b6bb7e5c05602aa8c308d0c4"><div class="ttname"><a href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a></div><div class="ttdeci">#define NULL</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d7f/resample_8c_source.html#l00096">resample.c:96</a></div></div>
<div class="ttc" id="logger_8h_html_ad770f83c71e237e1f64163358ce4e13d"><div class="ttname"><a href="../../d1/d8c/logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a></div><div class="ttdeci">#define ast_verb(level,...)</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d8c/logger_8h_source.html#l00463">logger.h:463</a></div></div>
<div class="ttc" id="iostream_8h_html_ac0297067e6921ce6a2c5f3b3d0647d3a"><div class="ttname"><a href="../../dd/d27/iostream_8h.html#ac0297067e6921ce6a2c5f3b3d0647d3a">ast_iostream_close</a></div><div class="ttdeci">int ast_iostream_close(struct ast_iostream *stream)</div><div class="ttdoc">Close an iostream. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/dc8/iostream_8c_source.html#l00528">iostream.c:528</a></div></div>
<div class="ttc" id="astman_8c_html_ac4a6ae0400e4457f0b35beddec80c93d"><div class="ttname"><a href="../../d2/d4d/astman_8c.html#ac4a6ae0400e4457f0b35beddec80c93d">session</a></div><div class="ttdeci">static struct ast_mansession session</div></div>
<div class="ttc" id="structast__websocket_html_a58c585b74d6f77b0a24b7503ddf9d7e2"><div class="ttname"><a href="../../db/db6/structast__websocket.html#a58c585b74d6f77b0a24b7503ddf9d7e2">ast_websocket::client</a></div><div class="ttdeci">struct websocket_client * client</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d4c/res__http__websocket_8c_source.html#l00100">res_http_websocket.c:100</a></div></div>
<div class="ttc" id="structast__websocket_html_a703e6acb6529d1dbabf148b897387f94"><div class="ttname"><a href="../../db/db6/structast__websocket.html#a703e6acb6529d1dbabf148b897387f94">ast_websocket::close_status_code</a></div><div class="ttdeci">uint16_t close_status_code</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d4c/res__http__websocket_8c_source.html#l00102">res_http_websocket.c:102</a></div></div>
<div class="ttc" id="netsock2_8h_html_aae9156c7fe6dff51463f29ed1c3b96c9"><div class="ttname"><a href="../../db/df1/netsock2_8h.html#aae9156c7fe6dff51463f29ed1c3b96c9">ast_sockaddr_stringify</a></div><div class="ttdeci">static char * ast_sockaddr_stringify(const struct ast_sockaddr *addr)</div><div class="ttdoc">Wrapper around ast_sockaddr_stringify_fmt() with default format. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/df1/netsock2_8h_source.html#l00260">netsock2.h:260</a></div></div>
<div class="ttc" id="astmm_8h_html_a402072d6789f6ed9e3a81da27504127e"><div class="ttname"><a href="../../d8/d8a/astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a></div><div class="ttdeci">#define ast_free(a)</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d8a/astmm_8h_source.html#l00182">astmm.h:182</a></div></div>
<div class="ttc" id="structast__websocket_html"><div class="ttname"><a href="../../db/db6/structast__websocket.html">ast_websocket</a></div><div class="ttdoc">Structure definition for session. </div><div class="ttdef"><b>Definition:</b> <a href="../../de/d4c/res__http__websocket_8c_source.html#l00088">res_http_websocket.c:88</a></div></div>
<div class="ttc" id="structast__websocket_html_a9dfcf41ffc851689eea95be7bb1f849a"><div class="ttname"><a href="../../db/db6/structast__websocket.html#a9dfcf41ffc851689eea95be7bb1f849a">ast_websocket::remote_address</a></div><div class="ttdeci">struct ast_sockaddr remote_address</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d4c/res__http__websocket_8c_source.html#l00090">res_http_websocket.c:90</a></div></div>
<div class="ttc" id="astobj2_8h_html_a6321ee982370c55ab3c24c72c562cbdd"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#a6321ee982370c55ab3c24c72c562cbdd">ao2_cleanup</a></div><div class="ttdeci">#define ao2_cleanup(obj)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l01958">astobj2.h:1958</a></div></div>
<div class="ttc" id="structast__websocket_html_a36ac2dd734607a43ed90acb7e9d81ac5"><div class="ttname"><a href="../../db/db6/structast__websocket.html#a36ac2dd734607a43ed90acb7e9d81ac5">ast_websocket::stream</a></div><div class="ttdeci">struct ast_iostream * stream</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d4c/res__http__websocket_8c_source.html#l00089">res_http_websocket.c:89</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="ad09fa931f468002152a3cc2d5ce25eae"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad09fa931f468002152a3cc2d5ce25eae">&#9670;&nbsp;</a></span>unload_module()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int unload_module </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html#l01513">1513</a> of file <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html">res_http_websocket.c</a>.</p>

<p class="reference">References <a class="el" href="../../d5/da5/astobj2_8h_source.html#l00464">ao2_ref</a>, <a class="el" href="../../dd/d43/http_8c_source.html#l00705">ast_http_uri_unlink()</a>, <a class="el" href="../../d5/d16/module_8h_source.html#l00316">AST_MODFLAG_GLOBAL_SYMBOLS</a>, <a class="el" href="../../d5/d16/module_8h_source.html#l00317">AST_MODFLAG_LOAD_ORDER</a>, <a class="el" href="../../d5/d16/module_8h_source.html#l00326">AST_MODPRI_CHANNEL_DEPEND</a>, <a class="el" href="../../d9/de9/res__phoneprov_8c.html#addaa208b0ed785225e24490fb9f28a80">AST_MODULE_INFO()</a>, <a class="el" href="../../d5/d16/module_8h_source.html#l00121">AST_MODULE_SUPPORT_CORE</a>, <a class="el" href="../../d5/d16/module_8h_source.html#l00046">ASTERISK_GPL_KEY</a>, <a class="el" href="../../dd/d56/http_8h_source.html#l00114">ast_http_uri::data</a>, <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html#l01501">load_module()</a>, <a class="el" href="../../dc/d7f/resample_8c_source.html#l00096">NULL</a>, <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html#l01007">websocket_echo_callback()</a>, and <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html#l01072">websocket_remove_protocol_internal()</a>.</p>
<div class="fragment"><div class="line"><a name="l01514"></a><span class="lineno"> 1514</span>&#160;{</div><div class="line"><a name="l01515"></a><span class="lineno"> 1515</span>&#160;   <a class="code" href="../../de/d4c/res__http__websocket_8c.html#a43e3b5d71764b9fb2b338fdf53c9c675">websocket_remove_protocol_internal</a>(<span class="stringliteral">&quot;echo&quot;</span>, <a class="code" href="../../de/d4c/res__http__websocket_8c.html#a16179dccdf130e1ec1d0ff701fb5fe5d">websocket_echo_callback</a>);</div><div class="line"><a name="l01516"></a><span class="lineno"> 1516</span>&#160;   <a class="code" href="../../dd/d56/http_8h.html#a33e436ed8aeb33287f1e6cb1c5288a14">ast_http_uri_unlink</a>(&amp;<a class="code" href="../../de/d4c/res__http__websocket_8c.html#a250d189c16de52a67daa3ab480eb8aa1">websocketuri</a>);</div><div class="line"><a name="l01517"></a><span class="lineno"> 1517</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(<a class="code" href="../../de/d4c/res__http__websocket_8c.html#a250d189c16de52a67daa3ab480eb8aa1">websocketuri</a>.<a class="code" href="../../d0/d6c/structast__http__uri.html#a735984d41155bc1032e09bece8f8d66d">data</a>, -1);</div><div class="line"><a name="l01518"></a><span class="lineno"> 1518</span>&#160;   <a class="code" href="../../de/d4c/res__http__websocket_8c.html#a250d189c16de52a67daa3ab480eb8aa1">websocketuri</a>.<a class="code" href="../../d0/d6c/structast__http__uri.html#a735984d41155bc1032e09bece8f8d66d">data</a> = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l01519"></a><span class="lineno"> 1519</span>&#160;</div><div class="line"><a name="l01520"></a><span class="lineno"> 1520</span>&#160;   <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l01521"></a><span class="lineno"> 1521</span>&#160;}</div><div class="ttc" id="http_8h_html_a33e436ed8aeb33287f1e6cb1c5288a14"><div class="ttname"><a href="../../dd/d56/http_8h.html#a33e436ed8aeb33287f1e6cb1c5288a14">ast_http_uri_unlink</a></div><div class="ttdeci">void ast_http_uri_unlink(struct ast_http_uri *urihandler)</div><div class="ttdoc">Unregister a URI handler. </div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d43/http_8c_source.html#l00705">http.c:705</a></div></div>
<div class="ttc" id="resample_8c_html_a070d2ce7b6bb7e5c05602aa8c308d0c4"><div class="ttname"><a href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a></div><div class="ttdeci">#define NULL</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d7f/resample_8c_source.html#l00096">resample.c:96</a></div></div>
<div class="ttc" id="res__http__websocket_8c_html_a16179dccdf130e1ec1d0ff701fb5fe5d"><div class="ttname"><a href="../../de/d4c/res__http__websocket_8c.html#a16179dccdf130e1ec1d0ff701fb5fe5d">websocket_echo_callback</a></div><div class="ttdeci">static void websocket_echo_callback(struct ast_websocket *session, struct ast_variable *parameters, struct ast_variable *headers)</div><div class="ttdoc">Simple echo implementation which echoes received text and binary frames. </div><div class="ttdef"><b>Definition:</b> <a href="../../de/d4c/res__http__websocket_8c_source.html#l01007">res_http_websocket.c:1007</a></div></div>
<div class="ttc" id="astobj2_8h_html_aaca5e8eac39a22f9da1c36fc6c922270"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a></div><div class="ttdeci">#define ao2_ref(o, delta)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l00464">astobj2.h:464</a></div></div>
<div class="ttc" id="res__http__websocket_8c_html_a43e3b5d71764b9fb2b338fdf53c9c675"><div class="ttname"><a href="../../de/d4c/res__http__websocket_8c.html#a43e3b5d71764b9fb2b338fdf53c9c675">websocket_remove_protocol_internal</a></div><div class="ttdeci">static int websocket_remove_protocol_internal(const char *name, ast_websocket_callback callback)</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d4c/res__http__websocket_8c_source.html#l01072">res_http_websocket.c:1072</a></div></div>
<div class="ttc" id="res__http__websocket_8c_html_a250d189c16de52a67daa3ab480eb8aa1"><div class="ttname"><a href="../../de/d4c/res__http__websocket_8c.html#a250d189c16de52a67daa3ab480eb8aa1">websocketuri</a></div><div class="ttdeci">static struct ast_http_uri websocketuri</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d4c/res__http__websocket_8c_source.html#l00997">res_http_websocket.c:997</a></div></div>
<div class="ttc" id="structast__http__uri_html_a735984d41155bc1032e09bece8f8d66d"><div class="ttname"><a href="../../d0/d6c/structast__http__uri.html#a735984d41155bc1032e09bece8f8d66d">ast_http_uri::data</a></div><div class="ttdeci">void * data</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d56/http_8h_source.html#l00114">http.h:114</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="aba0a4f6f2ebf4ebff817aeae8d6d690f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aba0a4f6f2ebf4ebff817aeae8d6d690f">&#9670;&nbsp;</a></span>websocket_add_protocol_internal()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int websocket_add_protocol_internal </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>name</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../d0/d0c/http__websocket_8h.html#acc038aba3451ed958627359ea71f156a">ast_websocket_callback</a>&#160;</td>
          <td class="paramname"><em>callback</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html#l01043">1043</a> of file <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html">res_http_websocket.c</a>.</p>

<p class="reference">References <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html#l00210">ast_websocket_server_add_protocol()</a>, and <a class="el" href="../../dd/d56/http_8h_source.html#l00114">ast_http_uri::data</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html#l01052">ast_websocket_add_protocol()</a>, and <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html#l01501">load_module()</a>.</p>
<div class="fragment"><div class="line"><a name="l01044"></a><span class="lineno"> 1044</span>&#160;{</div><div class="line"><a name="l01045"></a><span class="lineno"> 1045</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../db/d66/structast__websocket__server.html">ast_websocket_server</a> *ws_server = <a class="code" href="../../de/d4c/res__http__websocket_8c.html#a250d189c16de52a67daa3ab480eb8aa1">websocketuri</a>.<a class="code" href="../../d0/d6c/structast__http__uri.html#a735984d41155bc1032e09bece8f8d66d">data</a>;</div><div class="line"><a name="l01046"></a><span class="lineno"> 1046</span>&#160;   <span class="keywordflow">if</span> (!ws_server) {</div><div class="line"><a name="l01047"></a><span class="lineno"> 1047</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l01048"></a><span class="lineno"> 1048</span>&#160;   }</div><div class="line"><a name="l01049"></a><span class="lineno"> 1049</span>&#160;   <span class="keywordflow">return</span> <a class="code" href="../../de/d4c/res__http__websocket_8c.html#ab9a7ca872780104e9155d8d15423cadd">ast_websocket_server_add_protocol</a>(ws_server, <a class="code" href="../../d0/d29/cdr__mysql_8c.html#a0980a105ccb863d8008eb6201a51da52">name</a>, callback);</div><div class="line"><a name="l01050"></a><span class="lineno"> 1050</span>&#160;}</div><div class="ttc" id="structast__websocket__server_html"><div class="ttname"><a href="../../db/d66/structast__websocket__server.html">ast_websocket_server</a></div><div class="ttdoc">Structure for a WebSocket server. </div><div class="ttdef"><b>Definition:</b> <a href="../../de/d4c/res__http__websocket_8c_source.html#l00132">res_http_websocket.c:132</a></div></div>
<div class="ttc" id="res__http__websocket_8c_html_ab9a7ca872780104e9155d8d15423cadd"><div class="ttname"><a href="../../de/d4c/res__http__websocket_8c.html#ab9a7ca872780104e9155d8d15423cadd">ast_websocket_server_add_protocol</a></div><div class="ttdeci">int AST_OPTIONAL_API_NAME() ast_websocket_server_add_protocol(struct ast_websocket_server *server, const char *name, ast_websocket_callback callback)</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d4c/res__http__websocket_8c_source.html#l00210">res_http_websocket.c:210</a></div></div>
<div class="ttc" id="res__http__websocket_8c_html_a250d189c16de52a67daa3ab480eb8aa1"><div class="ttname"><a href="../../de/d4c/res__http__websocket_8c.html#a250d189c16de52a67daa3ab480eb8aa1">websocketuri</a></div><div class="ttdeci">static struct ast_http_uri websocketuri</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d4c/res__http__websocket_8c_source.html#l00997">res_http_websocket.c:997</a></div></div>
<div class="ttc" id="cdr__mysql_8c_html_a0980a105ccb863d8008eb6201a51da52"><div class="ttname"><a href="../../d0/d29/cdr__mysql_8c.html#a0980a105ccb863d8008eb6201a51da52">name</a></div><div class="ttdeci">static const char name[]</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d29/cdr__mysql_8c_source.html#l00074">cdr_mysql.c:74</a></div></div>
<div class="ttc" id="structast__http__uri_html_a735984d41155bc1032e09bece8f8d66d"><div class="ttname"><a href="../../d0/d6c/structast__http__uri.html#a735984d41155bc1032e09bece8f8d66d">ast_http_uri::data</a></div><div class="ttdeci">void * data</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d56/http_8h_source.html#l00114">http.h:114</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a22d1c731d15309d02fed2fd3e1b681f8"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a22d1c731d15309d02fed2fd3e1b681f8">&#9670;&nbsp;</a></span>websocket_bad_request()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void websocket_bad_request </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="../../d6/d49/structast__tcptls__session__instance.html">ast_tcptls_session_instance</a> *&#160;</td>
          <td class="paramname"><em>ser</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html#l00777">777</a> of file <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html">res_http_websocket.c</a>.</p>

<p class="reference">References <a class="el" href="../../dd/d43/http_8c_source.html#l00648">ast_http_error()</a>, <a class="el" href="../../dd/d43/http_8c_source.html#l00836">ast_http_request_close_on_completion()</a>, <a class="el" href="../../dd/d43/http_8c_source.html#l00456">ast_http_send()</a>, <a class="el" href="../../dd/d56/http_8h_source.html#l00057">AST_HTTP_UNKNOWN</a>, <a class="el" href="../../d6/d90/strings_8h_source.html#l00620">ast_str_create</a>, <a class="el" href="../../d6/d90/strings_8h_source.html#l01065">ast_str_set()</a>, and <a class="el" href="../../dc/d7f/resample_8c_source.html#l00096">NULL</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html#l00790">ast_websocket_uri_cb()</a>.</p>
<div class="fragment"><div class="line"><a name="l00778"></a><span class="lineno">  778</span>&#160;{</div><div class="line"><a name="l00779"></a><span class="lineno">  779</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../dd/da2/structast__str.html">ast_str</a> *http_header = <a class="code" href="../../d6/d90/strings_8h.html#a9c34c6c6b8daaba24c0406270f3cf697">ast_str_create</a>(64);</div><div class="line"><a name="l00780"></a><span class="lineno">  780</span>&#160;</div><div class="line"><a name="l00781"></a><span class="lineno">  781</span>&#160;   <span class="keywordflow">if</span> (!http_header) {</div><div class="line"><a name="l00782"></a><span class="lineno">  782</span>&#160;      <a class="code" href="../../dd/d56/http_8h.html#ab0286838ed2b93e0d77fe9d7af8a37b5">ast_http_request_close_on_completion</a>(ser);</div><div class="line"><a name="l00783"></a><span class="lineno">  783</span>&#160;      <a class="code" href="../../dd/d56/http_8h.html#ab0f7966324a592e02d53f01e7bb9cc17">ast_http_error</a>(ser, 500, <span class="stringliteral">&quot;Server Error&quot;</span>, <span class="stringliteral">&quot;Out of memory&quot;</span>);</div><div class="line"><a name="l00784"></a><span class="lineno">  784</span>&#160;      <span class="keywordflow">return</span>;</div><div class="line"><a name="l00785"></a><span class="lineno">  785</span>&#160;   }</div><div class="line"><a name="l00786"></a><span class="lineno">  786</span>&#160;   <a class="code" href="../../d6/d90/strings_8h.html#aa3341f35cedca29e60bb7f3927204283">ast_str_set</a>(&amp;http_header, 0, <span class="stringliteral">&quot;Sec-WebSocket-Version: 7, 8, 13\r\n&quot;</span>);</div><div class="line"><a name="l00787"></a><span class="lineno">  787</span>&#160;   <a class="code" href="../../dd/d56/http_8h.html#a0448c9f4a66b6ee7994870b187e185b4">ast_http_send</a>(ser, <a class="code" href="../../dd/d56/http_8h.html#a16fb43ed7e6093a9dc96477ba37b80efa8f6ca13b1fe4a9c235071bd548509ea7">AST_HTTP_UNKNOWN</a>, 400, <span class="stringliteral">&quot;Bad Request&quot;</span>, http_header, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, 0, 0);</div><div class="line"><a name="l00788"></a><span class="lineno">  788</span>&#160;}</div><div class="ttc" id="http_8h_html_ab0f7966324a592e02d53f01e7bb9cc17"><div class="ttname"><a href="../../dd/d56/http_8h.html#ab0f7966324a592e02d53f01e7bb9cc17">ast_http_error</a></div><div class="ttdeci">void ast_http_error(struct ast_tcptls_session_instance *ser, int status, const char *title, const char *text)</div><div class="ttdoc">Send HTTP error message and close socket. </div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d43/http_8c_source.html#l00648">http.c:648</a></div></div>
<div class="ttc" id="resample_8c_html_a070d2ce7b6bb7e5c05602aa8c308d0c4"><div class="ttname"><a href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a></div><div class="ttdeci">#define NULL</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d7f/resample_8c_source.html#l00096">resample.c:96</a></div></div>
<div class="ttc" id="http_8h_html_a0448c9f4a66b6ee7994870b187e185b4"><div class="ttname"><a href="../../dd/d56/http_8h.html#a0448c9f4a66b6ee7994870b187e185b4">ast_http_send</a></div><div class="ttdeci">void ast_http_send(struct ast_tcptls_session_instance *ser, enum ast_http_method method, int status_code, const char *status_title, struct ast_str *http_header, struct ast_str *out, int fd, unsigned int static_content)</div><div class="ttdoc">Generic function for sending HTTP/1.1 response. </div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d43/http_8c_source.html#l00456">http.c:456</a></div></div>
<div class="ttc" id="strings_8h_html_aa3341f35cedca29e60bb7f3927204283"><div class="ttname"><a href="../../d6/d90/strings_8h.html#aa3341f35cedca29e60bb7f3927204283">ast_str_set</a></div><div class="ttdeci">int ast_str_set(struct ast_str **buf, ssize_t max_len, const char *fmt,...)</div><div class="ttdoc">Set a dynamic string using variable arguments. </div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d90/strings_8h_source.html#l01065">strings.h:1065</a></div></div>
<div class="ttc" id="http_8h_html_a16fb43ed7e6093a9dc96477ba37b80efa8f6ca13b1fe4a9c235071bd548509ea7"><div class="ttname"><a href="../../dd/d56/http_8h.html#a16fb43ed7e6093a9dc96477ba37b80efa8f6ca13b1fe4a9c235071bd548509ea7">AST_HTTP_UNKNOWN</a></div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d56/http_8h_source.html#l00057">http.h:57</a></div></div>
<div class="ttc" id="structast__str_html"><div class="ttname"><a href="../../dd/da2/structast__str.html">ast_str</a></div><div class="ttdoc">The descriptor of a dynamic string XXX storage will be optimized later if needed We use the ts field ...</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d90/strings_8h_source.html#l00584">strings.h:584</a></div></div>
<div class="ttc" id="http_8h_html_ab0286838ed2b93e0d77fe9d7af8a37b5"><div class="ttname"><a href="../../dd/d56/http_8h.html#ab0286838ed2b93e0d77fe9d7af8a37b5">ast_http_request_close_on_completion</a></div><div class="ttdeci">void ast_http_request_close_on_completion(struct ast_tcptls_session_instance *ser)</div><div class="ttdoc">Request the HTTP connection be closed after this HTTP request. </div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d43/http_8c_source.html#l00836">http.c:836</a></div></div>
<div class="ttc" id="strings_8h_html_a9c34c6c6b8daaba24c0406270f3cf697"><div class="ttname"><a href="../../d6/d90/strings_8h.html#a9c34c6c6b8daaba24c0406270f3cf697">ast_str_create</a></div><div class="ttdeci">#define ast_str_create(init_len)</div><div class="ttdoc">Create a malloc&amp;#39;ed dynamic length string. </div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d90/strings_8h_source.html#l00620">strings.h:620</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="acf54fd38b47e3e4d0960010f7ae6e873"></a>
<h2 class="memtitle"><span class="permalink"><a href="#acf54fd38b47e3e4d0960010f7ae6e873">&#9670;&nbsp;</a></span>websocket_client_args_create()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static struct <a class="el" href="../../da/d2b/structast__tcptls__session__args.html">ast_tcptls_session_args</a>* websocket_client_args_create </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>host</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="../../d5/d90/structast__tls__config.html">ast_tls_config</a> *&#160;</td>
          <td class="paramname"><em>tls_cfg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">enum <a class="el" href="../../d0/d0c/http__websocket_8h.html#a6341c1b69564f8a3342229c5102b0fe2">ast_websocket_result</a> *&#160;</td>
          <td class="paramname"><em>result</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html#l01139">1139</a> of file <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html">res_http_websocket.c</a>.</p>

<p class="reference">References <a class="el" href="../../d4/ddf/tcptls_8h_source.html#l00135">ast_tcptls_session_args::accept_fd</a>, <a class="el" href="../../d5/da5/astobj2_8h_source.html#l00411">ao2_alloc</a>, <a class="el" href="../../d5/da5/astobj2_8h_source.html#l00464">ao2_ref</a>, <a class="el" href="../../d5/dde/test__func__file_8c_source.html#l00046">args</a>, <a class="el" href="../../d8/d8a/astmm_8h_source.html#l00182">ast_free</a>, <a class="el" href="../../da/df7/astobj2_8c_source.html#l00042">ast_log</a>, <a class="el" href="../../db/df1/netsock2_8h_source.html#l00171">ast_sockaddr_copy()</a>, <a class="el" href="../../d4/d27/netsock2_8c_source.html#l00280">ast_sockaddr_resolve()</a>, <a class="el" href="../../d1/d8c/logger_8h_source.html#l00285">LOG_ERROR</a>, <a class="el" href="../../d4/ddf/tcptls_8h_source.html#l00142">ast_tcptls_session_args::name</a>, <a class="el" href="../../dc/d7f/resample_8c_source.html#l00096">NULL</a>, <a class="el" href="../../d4/ddf/tcptls_8h_source.html#l00132">ast_tcptls_session_args::remote_address</a>, <a class="el" href="../../d4/ddf/tcptls_8h_source.html#l00134">ast_tcptls_session_args::tls_cfg</a>, <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html#l01123">websocket_client_args_destroy()</a>, <a class="el" href="../../d0/d0c/http__websocket_8h_source.html#l00398">WS_ALLOCATE_ERROR</a>, and <a class="el" href="../../d0/d0c/http__websocket_8h_source.html#l00401">WS_URI_RESOLVE_ERROR</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html#l01224">websocket_client_create()</a>.</p>
<div class="fragment"><div class="line"><a name="l01142"></a><span class="lineno"> 1142</span>&#160;{</div><div class="line"><a name="l01143"></a><span class="lineno"> 1143</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d3/db3/structast__sockaddr.html">ast_sockaddr</a> *addr;</div><div class="line"><a name="l01144"></a><span class="lineno"> 1144</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../da/d2b/structast__tcptls__session__args.html">ast_tcptls_session_args</a> *<a class="code" href="../../d5/dde/test__func__file_8c.html#a7df83d295429a2562396f1ec127a46c0">args</a> = <a class="code" href="../../d5/da5/astobj2_8h.html#ae0422b60d8e25b6962b2d61ae4ddf724">ao2_alloc</a>(</div><div class="line"><a name="l01145"></a><span class="lineno"> 1145</span>&#160;      <span class="keyword">sizeof</span>(*args), <a class="code" href="../../de/d4c/res__http__websocket_8c.html#a2fa89c00c48823e19f169f09b9cfbb3b">websocket_client_args_destroy</a>);</div><div class="line"><a name="l01146"></a><span class="lineno"> 1146</span>&#160;</div><div class="line"><a name="l01147"></a><span class="lineno"> 1147</span>&#160;   <span class="keywordflow">if</span> (!args) {</div><div class="line"><a name="l01148"></a><span class="lineno"> 1148</span>&#160;      *<a class="code" href="../../de/d1b/cel__pgsql_8c.html#ad6c487210772a9b4b0ca04b04b847d4c">result</a> = <a class="code" href="../../d0/d0c/http__websocket_8h.html#a6341c1b69564f8a3342229c5102b0fe2a71852cd5d07f9670965e98ee37e3239d">WS_ALLOCATE_ERROR</a>;</div><div class="line"><a name="l01149"></a><span class="lineno"> 1149</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l01150"></a><span class="lineno"> 1150</span>&#160;   }</div><div class="line"><a name="l01151"></a><span class="lineno"> 1151</span>&#160;</div><div class="line"><a name="l01152"></a><span class="lineno"> 1152</span>&#160;   args-&gt;<a class="code" href="../../da/d2b/structast__tcptls__session__args.html#ad6d7a8463d59a02084cf9d4360f46b79">accept_fd</a> = -1;</div><div class="line"><a name="l01153"></a><span class="lineno"> 1153</span>&#160;   args-&gt;<a class="code" href="../../da/d2b/structast__tcptls__session__args.html#aeb4a21e3ae033a326cc9dfd20a7ab074">tls_cfg</a> = <a class="code" href="../../da/d2b/structast__tcptls__session__args.html#aeb4a21e3ae033a326cc9dfd20a7ab074">tls_cfg</a>;</div><div class="line"><a name="l01154"></a><span class="lineno"> 1154</span>&#160;   args-&gt;<a class="code" href="../../da/d2b/structast__tcptls__session__args.html#a8f8f80d37794cde9472343e4487ba3eb">name</a> = <span class="stringliteral">&quot;websocket client&quot;</span>;</div><div class="line"><a name="l01155"></a><span class="lineno"> 1155</span>&#160;</div><div class="line"><a name="l01156"></a><span class="lineno"> 1156</span>&#160;   <span class="keywordflow">if</span> (!<a class="code" href="../../db/df1/netsock2_8h.html#a8ba6f5b5a9de09137dd18fe2d9592880">ast_sockaddr_resolve</a>(&amp;addr, <a class="code" href="../../d0/d8a/muted_8c.html#a41c3a180b50c6b2ddcc1b6843a48f205">host</a>, 0, 0)) {</div><div class="line"><a name="l01157"></a><span class="lineno"> 1157</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Unable to resolve address %s\n&quot;</span>,</div><div class="line"><a name="l01158"></a><span class="lineno"> 1158</span>&#160;         <a class="code" href="../../d0/d8a/muted_8c.html#a41c3a180b50c6b2ddcc1b6843a48f205">host</a>);</div><div class="line"><a name="l01159"></a><span class="lineno"> 1159</span>&#160;      <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(args, -1);</div><div class="line"><a name="l01160"></a><span class="lineno"> 1160</span>&#160;      *<a class="code" href="../../de/d1b/cel__pgsql_8c.html#ad6c487210772a9b4b0ca04b04b847d4c">result</a> = <a class="code" href="../../d0/d0c/http__websocket_8h.html#a6341c1b69564f8a3342229c5102b0fe2a89e654a4a4ac9d0105f7db694c007acc">WS_URI_RESOLVE_ERROR</a>;</div><div class="line"><a name="l01161"></a><span class="lineno"> 1161</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l01162"></a><span class="lineno"> 1162</span>&#160;   }</div><div class="line"><a name="l01163"></a><span class="lineno"> 1163</span>&#160;   <a class="code" href="../../db/df1/netsock2_8h.html#a56a46003c93bfd65111ea8ffc97af8f9">ast_sockaddr_copy</a>(&amp;args-&gt;<a class="code" href="../../da/d2b/structast__tcptls__session__args.html#a9dfcf41ffc851689eea95be7bb1f849a">remote_address</a>, addr);</div><div class="line"><a name="l01164"></a><span class="lineno"> 1164</span>&#160;   <a class="code" href="../../d8/d8a/astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(addr);</div><div class="line"><a name="l01165"></a><span class="lineno"> 1165</span>&#160;   <span class="keywordflow">return</span> <a class="code" href="../../d5/dde/test__func__file_8c.html#a7df83d295429a2562396f1ec127a46c0">args</a>;</div><div class="line"><a name="l01166"></a><span class="lineno"> 1166</span>&#160;}</div><div class="ttc" id="netsock2_8h_html_a56a46003c93bfd65111ea8ffc97af8f9"><div class="ttname"><a href="../../db/df1/netsock2_8h.html#a56a46003c93bfd65111ea8ffc97af8f9">ast_sockaddr_copy</a></div><div class="ttdeci">static void ast_sockaddr_copy(struct ast_sockaddr *dst, const struct ast_sockaddr *src)</div><div class="ttdoc">Copies the data from one ast_sockaddr to another. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/df1/netsock2_8h_source.html#l00171">netsock2.h:171</a></div></div>
<div class="ttc" id="http__websocket_8h_html_a6341c1b69564f8a3342229c5102b0fe2a71852cd5d07f9670965e98ee37e3239d"><div class="ttname"><a href="../../d0/d0c/http__websocket_8h.html#a6341c1b69564f8a3342229c5102b0fe2a71852cd5d07f9670965e98ee37e3239d">WS_ALLOCATE_ERROR</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d0c/http__websocket_8h_source.html#l00398">http_websocket.h:398</a></div></div>
<div class="ttc" id="res__http__websocket_8c_html_a2fa89c00c48823e19f169f09b9cfbb3b"><div class="ttname"><a href="../../de/d4c/res__http__websocket_8c.html#a2fa89c00c48823e19f169f09b9cfbb3b">websocket_client_args_destroy</a></div><div class="ttdeci">static void websocket_client_args_destroy(void *obj)</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d4c/res__http__websocket_8c_source.html#l01123">res_http_websocket.c:1123</a></div></div>
<div class="ttc" id="structast__tcptls__session__args_html"><div class="ttname"><a href="../../da/d2b/structast__tcptls__session__args.html">ast_tcptls_session_args</a></div><div class="ttdoc">arguments for the accepting thread </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/ddf/tcptls_8h_source.html#l00129">tcptls.h:129</a></div></div>
<div class="ttc" id="test__func__file_8c_html_a7df83d295429a2562396f1ec127a46c0"><div class="ttname"><a href="../../d5/dde/test__func__file_8c.html#a7df83d295429a2562396f1ec127a46c0">args</a></div><div class="ttdeci">const char * args</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/dde/test__func__file_8c_source.html#l00046">test_func_file.c:46</a></div></div>
<div class="ttc" id="resample_8c_html_a070d2ce7b6bb7e5c05602aa8c308d0c4"><div class="ttname"><a href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a></div><div class="ttdeci">#define NULL</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d7f/resample_8c_source.html#l00096">resample.c:96</a></div></div>
<div class="ttc" id="structast__sockaddr_html"><div class="ttname"><a href="../../d3/db3/structast__sockaddr.html">ast_sockaddr</a></div><div class="ttdoc">Socket address structure. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/df1/netsock2_8h_source.html#l00097">netsock2.h:97</a></div></div>
<div class="ttc" id="astobj2_8c_html_a96a00b3a518d7f32b6d51dc28f09bf9b"><div class="ttname"><a href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a></div><div class="ttdeci">#define ast_log</div><div class="ttdef"><b>Definition:</b> <a href="../../da/df7/astobj2_8c_source.html#l00042">astobj2.c:42</a></div></div>
<div class="ttc" id="muted_8c_html_a41c3a180b50c6b2ddcc1b6843a48f205"><div class="ttname"><a href="../../d0/d8a/muted_8c.html#a41c3a180b50c6b2ddcc1b6843a48f205">host</a></div><div class="ttdeci">static char host[256]</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d8a/muted_8c_source.html#l00077">muted.c:77</a></div></div>
<div class="ttc" id="structast__tcptls__session__args_html_a9dfcf41ffc851689eea95be7bb1f849a"><div class="ttname"><a href="../../da/d2b/structast__tcptls__session__args.html#a9dfcf41ffc851689eea95be7bb1f849a">ast_tcptls_session_args::remote_address</a></div><div class="ttdeci">struct ast_sockaddr remote_address</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/ddf/tcptls_8h_source.html#l00132">tcptls.h:132</a></div></div>
<div class="ttc" id="astobj2_8h_html_aaca5e8eac39a22f9da1c36fc6c922270"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a></div><div class="ttdeci">#define ao2_ref(o, delta)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l00464">astobj2.h:464</a></div></div>
<div class="ttc" id="logger_8h_html_aced66975c154ea0e2a8ec3bc818b4e08"><div class="ttname"><a href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a></div><div class="ttdeci">#define LOG_ERROR</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d8c/logger_8h_source.html#l00285">logger.h:285</a></div></div>
<div class="ttc" id="astobj2_8h_html_ae0422b60d8e25b6962b2d61ae4ddf724"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#ae0422b60d8e25b6962b2d61ae4ddf724">ao2_alloc</a></div><div class="ttdeci">#define ao2_alloc(data_size, destructor_fn)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l00411">astobj2.h:411</a></div></div>
<div class="ttc" id="astmm_8h_html_a402072d6789f6ed9e3a81da27504127e"><div class="ttname"><a href="../../d8/d8a/astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a></div><div class="ttdeci">#define ast_free(a)</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d8a/astmm_8h_source.html#l00182">astmm.h:182</a></div></div>
<div class="ttc" id="structast__tcptls__session__args_html_a8f8f80d37794cde9472343e4487ba3eb"><div class="ttname"><a href="../../da/d2b/structast__tcptls__session__args.html#a8f8f80d37794cde9472343e4487ba3eb">ast_tcptls_session_args::name</a></div><div class="ttdeci">const char * name</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/ddf/tcptls_8h_source.html#l00142">tcptls.h:142</a></div></div>
<div class="ttc" id="cel__pgsql_8c_html_ad6c487210772a9b4b0ca04b04b847d4c"><div class="ttname"><a href="../../de/d1b/cel__pgsql_8c.html#ad6c487210772a9b4b0ca04b04b847d4c">result</a></div><div class="ttdeci">static PGresult * result</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d1b/cel__pgsql_8c_source.html#l00088">cel_pgsql.c:88</a></div></div>
<div class="ttc" id="structast__tcptls__session__args_html_ad6d7a8463d59a02084cf9d4360f46b79"><div class="ttname"><a href="../../da/d2b/structast__tcptls__session__args.html#ad6d7a8463d59a02084cf9d4360f46b79">ast_tcptls_session_args::accept_fd</a></div><div class="ttdeci">int accept_fd</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/ddf/tcptls_8h_source.html#l00135">tcptls.h:135</a></div></div>
<div class="ttc" id="structast__tcptls__session__args_html_aeb4a21e3ae033a326cc9dfd20a7ab074"><div class="ttname"><a href="../../da/d2b/structast__tcptls__session__args.html#aeb4a21e3ae033a326cc9dfd20a7ab074">ast_tcptls_session_args::tls_cfg</a></div><div class="ttdeci">struct ast_tls_config * tls_cfg</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/ddf/tcptls_8h_source.html#l00134">tcptls.h:134</a></div></div>
<div class="ttc" id="http__websocket_8h_html_a6341c1b69564f8a3342229c5102b0fe2a89e654a4a4ac9d0105f7db694c007acc"><div class="ttname"><a href="../../d0/d0c/http__websocket_8h.html#a6341c1b69564f8a3342229c5102b0fe2a89e654a4a4ac9d0105f7db694c007acc">WS_URI_RESOLVE_ERROR</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d0c/http__websocket_8h_source.html#l00401">http_websocket.h:401</a></div></div>
<div class="ttc" id="netsock2_8h_html_a8ba6f5b5a9de09137dd18fe2d9592880"><div class="ttname"><a href="../../db/df1/netsock2_8h.html#a8ba6f5b5a9de09137dd18fe2d9592880">ast_sockaddr_resolve</a></div><div class="ttdeci">int ast_sockaddr_resolve(struct ast_sockaddr **addrs, const char *str, int flags, int family)</div><div class="ttdoc">Parses a string with an IPv4 or IPv6 address and place results into an array. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d27/netsock2_8c_source.html#l00280">netsock2.c:280</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a2fa89c00c48823e19f169f09b9cfbb3b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2fa89c00c48823e19f169f09b9cfbb3b">&#9670;&nbsp;</a></span>websocket_client_args_destroy()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void websocket_client_args_destroy </td>
          <td>(</td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>obj</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html#l01123">1123</a> of file <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html">res_http_websocket.c</a>.</p>

<p class="reference">References <a class="el" href="../../d5/dde/test__func__file_8c_source.html#l00046">args</a>, <a class="el" href="../../d8/d8a/astmm_8h_source.html#l00182">ast_free</a>, <a class="el" href="../../dc/d9b/tcptls_8c_source.html#l00575">ast_ssl_teardown()</a>, <a class="el" href="../../d4/ddf/tcptls_8h_source.html#l00092">ast_tls_config::cafile</a>, <a class="el" href="../../d4/ddf/tcptls_8h_source.html#l00093">ast_tls_config::capath</a>, <a class="el" href="../../d4/ddf/tcptls_8h_source.html#l00089">ast_tls_config::certfile</a>, <a class="el" href="../../d4/ddf/tcptls_8h_source.html#l00091">ast_tls_config::cipher</a>, <a class="el" href="../../d4/ddf/tcptls_8h_source.html#l00090">ast_tls_config::pvtfile</a>, and <a class="el" href="../../d4/ddf/tcptls_8h_source.html#l00134">ast_tcptls_session_args::tls_cfg</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html#l01139">websocket_client_args_create()</a>.</p>
<div class="fragment"><div class="line"><a name="l01124"></a><span class="lineno"> 1124</span>&#160;{</div><div class="line"><a name="l01125"></a><span class="lineno"> 1125</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../da/d2b/structast__tcptls__session__args.html">ast_tcptls_session_args</a> *<a class="code" href="../../d5/dde/test__func__file_8c.html#a7df83d295429a2562396f1ec127a46c0">args</a> = obj;</div><div class="line"><a name="l01126"></a><span class="lineno"> 1126</span>&#160;</div><div class="line"><a name="l01127"></a><span class="lineno"> 1127</span>&#160;   <span class="keywordflow">if</span> (args-&gt;<a class="code" href="../../da/d2b/structast__tcptls__session__args.html#aeb4a21e3ae033a326cc9dfd20a7ab074">tls_cfg</a>) {</div><div class="line"><a name="l01128"></a><span class="lineno"> 1128</span>&#160;      <a class="code" href="../../d8/d8a/astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(args-&gt;<a class="code" href="../../da/d2b/structast__tcptls__session__args.html#aeb4a21e3ae033a326cc9dfd20a7ab074">tls_cfg</a>-&gt;<a class="code" href="../../d5/d90/structast__tls__config.html#a333dffcec025fcdbee0676476f401685">certfile</a>);</div><div class="line"><a name="l01129"></a><span class="lineno"> 1129</span>&#160;      <a class="code" href="../../d8/d8a/astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(args-&gt;<a class="code" href="../../da/d2b/structast__tcptls__session__args.html#aeb4a21e3ae033a326cc9dfd20a7ab074">tls_cfg</a>-&gt;<a class="code" href="../../d5/d90/structast__tls__config.html#a6005f11af6a60f4169876fcd075595ca">pvtfile</a>);</div><div class="line"><a name="l01130"></a><span class="lineno"> 1130</span>&#160;      <a class="code" href="../../d8/d8a/astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(args-&gt;<a class="code" href="../../da/d2b/structast__tcptls__session__args.html#aeb4a21e3ae033a326cc9dfd20a7ab074">tls_cfg</a>-&gt;<a class="code" href="../../d5/d90/structast__tls__config.html#a3d12e13733aa5172b5cb091fbf8ea478">cipher</a>);</div><div class="line"><a name="l01131"></a><span class="lineno"> 1131</span>&#160;      <a class="code" href="../../d8/d8a/astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(args-&gt;<a class="code" href="../../da/d2b/structast__tcptls__session__args.html#aeb4a21e3ae033a326cc9dfd20a7ab074">tls_cfg</a>-&gt;<a class="code" href="../../d5/d90/structast__tls__config.html#a9ff8d56644bac1d41f8039f2fde5acf2">cafile</a>);</div><div class="line"><a name="l01132"></a><span class="lineno"> 1132</span>&#160;      <a class="code" href="../../d8/d8a/astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(args-&gt;<a class="code" href="../../da/d2b/structast__tcptls__session__args.html#aeb4a21e3ae033a326cc9dfd20a7ab074">tls_cfg</a>-&gt;<a class="code" href="../../d5/d90/structast__tls__config.html#a8331a8443119478cd6b1daeb707a94dc">capath</a>);</div><div class="line"><a name="l01133"></a><span class="lineno"> 1133</span>&#160;</div><div class="line"><a name="l01134"></a><span class="lineno"> 1134</span>&#160;      <a class="code" href="../../d4/ddf/tcptls_8h.html#a5a34250828700061832a29115f0aaf33">ast_ssl_teardown</a>(args-&gt;<a class="code" href="../../da/d2b/structast__tcptls__session__args.html#aeb4a21e3ae033a326cc9dfd20a7ab074">tls_cfg</a>);</div><div class="line"><a name="l01135"></a><span class="lineno"> 1135</span>&#160;   }</div><div class="line"><a name="l01136"></a><span class="lineno"> 1136</span>&#160;   <a class="code" href="../../d8/d8a/astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(args-&gt;<a class="code" href="../../da/d2b/structast__tcptls__session__args.html#aeb4a21e3ae033a326cc9dfd20a7ab074">tls_cfg</a>);</div><div class="line"><a name="l01137"></a><span class="lineno"> 1137</span>&#160;}</div><div class="ttc" id="structast__tls__config_html_a6005f11af6a60f4169876fcd075595ca"><div class="ttname"><a href="../../d5/d90/structast__tls__config.html#a6005f11af6a60f4169876fcd075595ca">ast_tls_config::pvtfile</a></div><div class="ttdeci">char * pvtfile</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/ddf/tcptls_8h_source.html#l00090">tcptls.h:90</a></div></div>
<div class="ttc" id="tcptls_8h_html_a5a34250828700061832a29115f0aaf33"><div class="ttname"><a href="../../d4/ddf/tcptls_8h.html#a5a34250828700061832a29115f0aaf33">ast_ssl_teardown</a></div><div class="ttdeci">void ast_ssl_teardown(struct ast_tls_config *cfg)</div><div class="ttdoc">free resources used by an SSL server </div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d9b/tcptls_8c_source.html#l00575">tcptls.c:575</a></div></div>
<div class="ttc" id="structast__tcptls__session__args_html"><div class="ttname"><a href="../../da/d2b/structast__tcptls__session__args.html">ast_tcptls_session_args</a></div><div class="ttdoc">arguments for the accepting thread </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/ddf/tcptls_8h_source.html#l00129">tcptls.h:129</a></div></div>
<div class="ttc" id="test__func__file_8c_html_a7df83d295429a2562396f1ec127a46c0"><div class="ttname"><a href="../../d5/dde/test__func__file_8c.html#a7df83d295429a2562396f1ec127a46c0">args</a></div><div class="ttdeci">const char * args</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/dde/test__func__file_8c_source.html#l00046">test_func_file.c:46</a></div></div>
<div class="ttc" id="structast__tls__config_html_a9ff8d56644bac1d41f8039f2fde5acf2"><div class="ttname"><a href="../../d5/d90/structast__tls__config.html#a9ff8d56644bac1d41f8039f2fde5acf2">ast_tls_config::cafile</a></div><div class="ttdeci">char * cafile</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/ddf/tcptls_8h_source.html#l00092">tcptls.h:92</a></div></div>
<div class="ttc" id="astmm_8h_html_a402072d6789f6ed9e3a81da27504127e"><div class="ttname"><a href="../../d8/d8a/astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a></div><div class="ttdeci">#define ast_free(a)</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d8a/astmm_8h_source.html#l00182">astmm.h:182</a></div></div>
<div class="ttc" id="structast__tls__config_html_a333dffcec025fcdbee0676476f401685"><div class="ttname"><a href="../../d5/d90/structast__tls__config.html#a333dffcec025fcdbee0676476f401685">ast_tls_config::certfile</a></div><div class="ttdeci">char * certfile</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/ddf/tcptls_8h_source.html#l00089">tcptls.h:89</a></div></div>
<div class="ttc" id="structast__tls__config_html_a8331a8443119478cd6b1daeb707a94dc"><div class="ttname"><a href="../../d5/d90/structast__tls__config.html#a8331a8443119478cd6b1daeb707a94dc">ast_tls_config::capath</a></div><div class="ttdeci">char * capath</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/ddf/tcptls_8h_source.html#l00093">tcptls.h:93</a></div></div>
<div class="ttc" id="structast__tcptls__session__args_html_aeb4a21e3ae033a326cc9dfd20a7ab074"><div class="ttname"><a href="../../da/d2b/structast__tcptls__session__args.html#aeb4a21e3ae033a326cc9dfd20a7ab074">ast_tcptls_session_args::tls_cfg</a></div><div class="ttdeci">struct ast_tls_config * tls_cfg</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/ddf/tcptls_8h_source.html#l00134">tcptls.h:134</a></div></div>
<div class="ttc" id="structast__tls__config_html_a3d12e13733aa5172b5cb091fbf8ea478"><div class="ttname"><a href="../../d5/d90/structast__tls__config.html#a3d12e13733aa5172b5cb091fbf8ea478">ast_tls_config::cipher</a></div><div class="ttdeci">char * cipher</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/ddf/tcptls_8h_source.html#l00091">tcptls.h:91</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="ae6b78ddeb7585dc4c2d42b8de58ab7f9"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae6b78ddeb7585dc4c2d42b8de58ab7f9">&#9670;&nbsp;</a></span>websocket_client_connect()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static enum <a class="el" href="../../d0/d0c/http__websocket_8h.html#a6341c1b69564f8a3342229c5102b0fe2">ast_websocket_result</a> websocket_client_connect </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="../../db/db6/structast__websocket.html">ast_websocket</a> *&#160;</td>
          <td class="paramname"><em>ws</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html#l01397">1397</a> of file <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html">res_http_websocket.c</a>.</p>

<p class="reference">References <a class="el" href="../../d5/da5/astobj2_8h_source.html#l00464">ao2_ref</a>, <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html#l01205">websocket_client::args</a>, <a class="el" href="../../d1/dc8/iostream_8c_source.html#l00108">ast_iostream_get_ssl()</a>, <a class="el" href="../../df/d3c/optional__api_8h_source.html#l00228">AST_OPTIONAL_API_NAME</a>, <a class="el" href="../../db/df1/netsock2_8h_source.html#l00171">ast_sockaddr_copy()</a>, <a class="el" href="../../dc/d9b/tcptls_8c_source.html#l00615">ast_tcptls_client_create()</a>, <a class="el" href="../../dc/d9b/tcptls_8c_source.html#l00585">ast_tcptls_client_start()</a>, <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html#l01421">ast_websocket_client_create()</a>, <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html#l00100">ast_websocket::client</a>, <a class="el" href="../../dc/d7f/resample_8c_source.html#l00096">NULL</a>, <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html#l00090">ast_websocket::remote_address</a>, <a class="el" href="../../d4/ddf/tcptls_8h_source.html#l00151">ast_tcptls_session_instance::remote_address</a>, <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html#l00097">ast_websocket::secure</a>, <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html#l01207">websocket_client::ser</a>, <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html#l00089">ast_websocket::stream</a>, <a class="el" href="../../d4/ddf/tcptls_8h_source.html#l00160">ast_tcptls_session_instance::stream</a>, <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html#l01367">websocket_client_handshake()</a>, <a class="el" href="../../d0/d0c/http__websocket_8h_source.html#l00410">WS_CLIENT_START_ERROR</a>, and <a class="el" href="../../d0/d0c/http__websocket_8h_source.html#l00397">WS_OK</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html#l01421">ast_websocket_client_create()</a>.</p>
<div class="fragment"><div class="line"><a name="l01398"></a><span class="lineno"> 1398</span>&#160;{</div><div class="line"><a name="l01399"></a><span class="lineno"> 1399</span>&#160;   <span class="keyword">enum</span> <a class="code" href="../../d0/d0c/http__websocket_8h.html#a6341c1b69564f8a3342229c5102b0fe2">ast_websocket_result</a> res;</div><div class="line"><a name="l01400"></a><span class="lineno"> 1400</span>&#160;   <span class="comment">/* create and connect the client - note client_start</span></div><div class="line"><a name="l01401"></a><span class="lineno"> 1401</span>&#160;<span class="comment">      releases the session instance on failure */</span></div><div class="line"><a name="l01402"></a><span class="lineno"> 1402</span>&#160;   <span class="keywordflow">if</span> (!(ws-&gt;<a class="code" href="../../db/db6/structast__websocket.html#a58c585b74d6f77b0a24b7503ddf9d7e2">client</a>-&gt;<a class="code" href="../../d7/de7/structwebsocket__client.html#ab65df483a962559e090b6c1c4c46f8f5">ser</a> = <a class="code" href="../../d4/ddf/tcptls_8h.html#afbdc75838c2b7c41b7cb4a7740f49851">ast_tcptls_client_start</a>(</div><div class="line"><a name="l01403"></a><span class="lineno"> 1403</span>&#160;            <a class="code" href="../../d4/ddf/tcptls_8h.html#a9bf6d5b9eb8b646983d127c2b1ac1822">ast_tcptls_client_create</a>(ws-&gt;<a class="code" href="../../db/db6/structast__websocket.html#a58c585b74d6f77b0a24b7503ddf9d7e2">client</a>-&gt;<a class="code" href="../../d7/de7/structwebsocket__client.html#a66814a7c3b377ff1395878e5b8755d48">args</a>)))) {</div><div class="line"><a name="l01404"></a><span class="lineno"> 1404</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../d0/d0c/http__websocket_8h.html#a6341c1b69564f8a3342229c5102b0fe2a259ff6e8ba5ba96b4b4e7a4c981bb0ec">WS_CLIENT_START_ERROR</a>;</div><div class="line"><a name="l01405"></a><span class="lineno"> 1405</span>&#160;   }</div><div class="line"><a name="l01406"></a><span class="lineno"> 1406</span>&#160;</div><div class="line"><a name="l01407"></a><span class="lineno"> 1407</span>&#160;   <span class="keywordflow">if</span> ((res = <a class="code" href="../../de/d4c/res__http__websocket_8c.html#a71181c85896291b79c1920cfedeaf998">websocket_client_handshake</a>(ws-&gt;<a class="code" href="../../db/db6/structast__websocket.html#a58c585b74d6f77b0a24b7503ddf9d7e2">client</a>)) != <a class="code" href="../../d0/d0c/http__websocket_8h.html#a6341c1b69564f8a3342229c5102b0fe2a8d6c24a81bab48a188c7f458bf6ecddb">WS_OK</a>) {</div><div class="line"><a name="l01408"></a><span class="lineno"> 1408</span>&#160;      <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(ws-&gt;<a class="code" href="../../db/db6/structast__websocket.html#a58c585b74d6f77b0a24b7503ddf9d7e2">client</a>-&gt;<a class="code" href="../../d7/de7/structwebsocket__client.html#ab65df483a962559e090b6c1c4c46f8f5">ser</a>, -1);</div><div class="line"><a name="l01409"></a><span class="lineno"> 1409</span>&#160;      ws-&gt;<a class="code" href="../../db/db6/structast__websocket.html#a58c585b74d6f77b0a24b7503ddf9d7e2">client</a>-&gt;<a class="code" href="../../d7/de7/structwebsocket__client.html#ab65df483a962559e090b6c1c4c46f8f5">ser</a> = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l01410"></a><span class="lineno"> 1410</span>&#160;      <span class="keywordflow">return</span> res;</div><div class="line"><a name="l01411"></a><span class="lineno"> 1411</span>&#160;   }</div><div class="line"><a name="l01412"></a><span class="lineno"> 1412</span>&#160;</div><div class="line"><a name="l01413"></a><span class="lineno"> 1413</span>&#160;   ws-&gt;<a class="code" href="../../db/db6/structast__websocket.html#a36ac2dd734607a43ed90acb7e9d81ac5">stream</a> = ws-&gt;<a class="code" href="../../db/db6/structast__websocket.html#a58c585b74d6f77b0a24b7503ddf9d7e2">client</a>-&gt;<a class="code" href="../../d7/de7/structwebsocket__client.html#ab65df483a962559e090b6c1c4c46f8f5">ser</a>-&gt;<a class="code" href="../../d6/d49/structast__tcptls__session__instance.html#a36ac2dd734607a43ed90acb7e9d81ac5">stream</a>;</div><div class="line"><a name="l01414"></a><span class="lineno"> 1414</span>&#160;   ws-&gt;<a class="code" href="../../db/db6/structast__websocket.html#abba77e678a34722d786f3faa53262f75">secure</a> = <a class="code" href="../../dd/d27/iostream_8h.html#a405166f5185022bbe60f7b57f21cb483">ast_iostream_get_ssl</a>(ws-&gt;<a class="code" href="../../db/db6/structast__websocket.html#a36ac2dd734607a43ed90acb7e9d81ac5">stream</a>) ? 1 : 0;</div><div class="line"><a name="l01415"></a><span class="lineno"> 1415</span>&#160;   ws-&gt;<a class="code" href="../../db/db6/structast__websocket.html#a58c585b74d6f77b0a24b7503ddf9d7e2">client</a>-&gt;<a class="code" href="../../d7/de7/structwebsocket__client.html#ab65df483a962559e090b6c1c4c46f8f5">ser</a>-&gt;<a class="code" href="../../d6/d49/structast__tcptls__session__instance.html#a36ac2dd734607a43ed90acb7e9d81ac5">stream</a> = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l01416"></a><span class="lineno"> 1416</span>&#160;   <a class="code" href="../../db/df1/netsock2_8h.html#a56a46003c93bfd65111ea8ffc97af8f9">ast_sockaddr_copy</a>(&amp;ws-&gt;<a class="code" href="../../db/db6/structast__websocket.html#a9dfcf41ffc851689eea95be7bb1f849a">remote_address</a>, &amp;ws-&gt;<a class="code" href="../../db/db6/structast__websocket.html#a58c585b74d6f77b0a24b7503ddf9d7e2">client</a>-&gt;<a class="code" href="../../d7/de7/structwebsocket__client.html#ab65df483a962559e090b6c1c4c46f8f5">ser</a>-&gt;<a class="code" href="../../d6/d49/structast__tcptls__session__instance.html#a9dfcf41ffc851689eea95be7bb1f849a">remote_address</a>);</div><div class="line"><a name="l01417"></a><span class="lineno"> 1417</span>&#160;   <span class="keywordflow">return</span> <a class="code" href="../../d0/d0c/http__websocket_8h.html#a6341c1b69564f8a3342229c5102b0fe2a8d6c24a81bab48a188c7f458bf6ecddb">WS_OK</a>;</div><div class="line"><a name="l01418"></a><span class="lineno"> 1418</span>&#160;}</div><div class="ttc" id="netsock2_8h_html_a56a46003c93bfd65111ea8ffc97af8f9"><div class="ttname"><a href="../../db/df1/netsock2_8h.html#a56a46003c93bfd65111ea8ffc97af8f9">ast_sockaddr_copy</a></div><div class="ttdeci">static void ast_sockaddr_copy(struct ast_sockaddr *dst, const struct ast_sockaddr *src)</div><div class="ttdoc">Copies the data from one ast_sockaddr to another. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/df1/netsock2_8h_source.html#l00171">netsock2.h:171</a></div></div>
<div class="ttc" id="http__websocket_8h_html_a6341c1b69564f8a3342229c5102b0fe2"><div class="ttname"><a href="../../d0/d0c/http__websocket_8h.html#a6341c1b69564f8a3342229c5102b0fe2">ast_websocket_result</a></div><div class="ttdeci">ast_websocket_result</div><div class="ttdoc">Result code for a websocket client. </div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d0c/http__websocket_8h_source.html#l00396">http_websocket.h:396</a></div></div>
<div class="ttc" id="structwebsocket__client_html_ab65df483a962559e090b6c1c4c46f8f5"><div class="ttname"><a href="../../d7/de7/structwebsocket__client.html#ab65df483a962559e090b6c1c4c46f8f5">websocket_client::ser</a></div><div class="ttdeci">struct ast_tcptls_session_instance * ser</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d4c/res__http__websocket_8c_source.html#l01207">res_http_websocket.c:1207</a></div></div>
<div class="ttc" id="res__http__websocket_8c_html_a71181c85896291b79c1920cfedeaf998"><div class="ttname"><a href="../../de/d4c/res__http__websocket_8c.html#a71181c85896291b79c1920cfedeaf998">websocket_client_handshake</a></div><div class="ttdeci">static enum ast_websocket_result websocket_client_handshake(struct websocket_client *client)</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d4c/res__http__websocket_8c_source.html#l01367">res_http_websocket.c:1367</a></div></div>
<div class="ttc" id="http__websocket_8h_html_a6341c1b69564f8a3342229c5102b0fe2a259ff6e8ba5ba96b4b4e7a4c981bb0ec"><div class="ttname"><a href="../../d0/d0c/http__websocket_8h.html#a6341c1b69564f8a3342229c5102b0fe2a259ff6e8ba5ba96b4b4e7a4c981bb0ec">WS_CLIENT_START_ERROR</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d0c/http__websocket_8h_source.html#l00410">http_websocket.h:410</a></div></div>
<div class="ttc" id="structwebsocket__client_html_a66814a7c3b377ff1395878e5b8755d48"><div class="ttname"><a href="../../d7/de7/structwebsocket__client.html#a66814a7c3b377ff1395878e5b8755d48">websocket_client::args</a></div><div class="ttdeci">struct ast_tcptls_session_args * args</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d4c/res__http__websocket_8c_source.html#l01205">res_http_websocket.c:1205</a></div></div>
<div class="ttc" id="resample_8c_html_a070d2ce7b6bb7e5c05602aa8c308d0c4"><div class="ttname"><a href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a></div><div class="ttdeci">#define NULL</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d7f/resample_8c_source.html#l00096">resample.c:96</a></div></div>
<div class="ttc" id="iostream_8h_html_a405166f5185022bbe60f7b57f21cb483"><div class="ttname"><a href="../../dd/d27/iostream_8h.html#a405166f5185022bbe60f7b57f21cb483">ast_iostream_get_ssl</a></div><div class="ttdeci">SSL * ast_iostream_get_ssl(struct ast_iostream *stream)</div><div class="ttdoc">Get a pointer to an iostream&amp;#39;s OpenSSL SSL structure. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/dc8/iostream_8c_source.html#l00108">iostream.c:108</a></div></div>
<div class="ttc" id="astobj2_8h_html_aaca5e8eac39a22f9da1c36fc6c922270"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a></div><div class="ttdeci">#define ao2_ref(o, delta)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l00464">astobj2.h:464</a></div></div>
<div class="ttc" id="structast__websocket_html_a58c585b74d6f77b0a24b7503ddf9d7e2"><div class="ttname"><a href="../../db/db6/structast__websocket.html#a58c585b74d6f77b0a24b7503ddf9d7e2">ast_websocket::client</a></div><div class="ttdeci">struct websocket_client * client</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d4c/res__http__websocket_8c_source.html#l00100">res_http_websocket.c:100</a></div></div>
<div class="ttc" id="structast__tcptls__session__instance_html_a36ac2dd734607a43ed90acb7e9d81ac5"><div class="ttname"><a href="../../d6/d49/structast__tcptls__session__instance.html#a36ac2dd734607a43ed90acb7e9d81ac5">ast_tcptls_session_instance::stream</a></div><div class="ttdeci">struct ast_iostream * stream</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/ddf/tcptls_8h_source.html#l00160">tcptls.h:160</a></div></div>
<div class="ttc" id="structast__websocket_html_abba77e678a34722d786f3faa53262f75"><div class="ttname"><a href="../../db/db6/structast__websocket.html#abba77e678a34722d786f3faa53262f75">ast_websocket::secure</a></div><div class="ttdeci">unsigned int secure</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d4c/res__http__websocket_8c_source.html#l00097">res_http_websocket.c:97</a></div></div>
<div class="ttc" id="structast__websocket_html_a9dfcf41ffc851689eea95be7bb1f849a"><div class="ttname"><a href="../../db/db6/structast__websocket.html#a9dfcf41ffc851689eea95be7bb1f849a">ast_websocket::remote_address</a></div><div class="ttdeci">struct ast_sockaddr remote_address</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d4c/res__http__websocket_8c_source.html#l00090">res_http_websocket.c:90</a></div></div>
<div class="ttc" id="http__websocket_8h_html_a6341c1b69564f8a3342229c5102b0fe2a8d6c24a81bab48a188c7f458bf6ecddb"><div class="ttname"><a href="../../d0/d0c/http__websocket_8h.html#a6341c1b69564f8a3342229c5102b0fe2a8d6c24a81bab48a188c7f458bf6ecddb">WS_OK</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d0c/http__websocket_8h_source.html#l00397">http_websocket.h:397</a></div></div>
<div class="ttc" id="tcptls_8h_html_a9bf6d5b9eb8b646983d127c2b1ac1822"><div class="ttname"><a href="../../d4/ddf/tcptls_8h.html#a9bf6d5b9eb8b646983d127c2b1ac1822">ast_tcptls_client_create</a></div><div class="ttdeci">struct ast_tcptls_session_instance * ast_tcptls_client_create(struct ast_tcptls_session_args *desc)</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d9b/tcptls_8c_source.html#l00615">tcptls.c:615</a></div></div>
<div class="ttc" id="structast__websocket_html_a36ac2dd734607a43ed90acb7e9d81ac5"><div class="ttname"><a href="../../db/db6/structast__websocket.html#a36ac2dd734607a43ed90acb7e9d81ac5">ast_websocket::stream</a></div><div class="ttdeci">struct ast_iostream * stream</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d4c/res__http__websocket_8c_source.html#l00089">res_http_websocket.c:89</a></div></div>
<div class="ttc" id="tcptls_8h_html_afbdc75838c2b7c41b7cb4a7740f49851"><div class="ttname"><a href="../../d4/ddf/tcptls_8h.html#afbdc75838c2b7c41b7cb4a7740f49851">ast_tcptls_client_start</a></div><div class="ttdeci">struct ast_tcptls_session_instance * ast_tcptls_client_start(struct ast_tcptls_session_instance *tcptls_session)</div><div class="ttdoc">attempts to connect and start tcptls session, on error the tcptls_session&amp;#39;s ref count is decremented...</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d9b/tcptls_8c_source.html#l00585">tcptls.c:585</a></div></div>
<div class="ttc" id="structast__tcptls__session__instance_html_a9dfcf41ffc851689eea95be7bb1f849a"><div class="ttname"><a href="../../d6/d49/structast__tcptls__session__instance.html#a9dfcf41ffc851689eea95be7bb1f849a">ast_tcptls_session_instance::remote_address</a></div><div class="ttdeci">struct ast_sockaddr remote_address</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/ddf/tcptls_8h_source.html#l00151">tcptls.h:151</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a732e919813a7f9bf5d6cada291ad589c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a732e919813a7f9bf5d6cada291ad589c">&#9670;&nbsp;</a></span>websocket_client_create()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static struct <a class="el" href="../../db/db6/structast__websocket.html">ast_websocket</a>* websocket_client_create </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>uri</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>protocols</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="../../d5/d90/structast__tls__config.html">ast_tls_config</a> *&#160;</td>
          <td class="paramname"><em>tls_cfg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">enum <a class="el" href="../../d0/d0c/http__websocket_8h.html#a6341c1b69564f8a3342229c5102b0fe2">ast_websocket_result</a> *&#160;</td>
          <td class="paramname"><em>result</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html#l01224">1224</a> of file <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html">res_http_websocket.c</a>.</p>

<p class="reference">References <a class="el" href="../../d5/da5/astobj2_8h_source.html#l00411">ao2_alloc</a>, <a class="el" href="../../d5/da5/astobj2_8h_source.html#l00464">ao2_ref</a>, <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html#l01205">websocket_client::args</a>, <a class="el" href="../../da/df7/astobj2_8c_source.html#l00042">ast_log</a>, <a class="el" href="../../df/d3c/optional__api_8h_source.html#l00228">AST_OPTIONAL_API_NAME</a>, <a class="el" href="../../d8/d8a/astmm_8h_source.html#l00243">ast_strdup</a>, <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html#l00100">ast_websocket::client</a>, <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html#l00071">DEFAULT_RECONSTRUCTION_CEILING</a>, <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html#l01193">websocket_client::host</a>, <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html#l01197">websocket_client::key</a>, <a class="el" href="../../d1/d8c/logger_8h_source.html#l00285">LOG_ERROR</a>, <a class="el" href="../../dc/d7f/resample_8c_source.html#l00096">NULL</a>, <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html#l00092">ast_websocket::opcode</a>, <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html#l01199">websocket_client::protocols</a>, <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html#l00095">ast_websocket::reconstruct</a>, <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html#l01195">websocket_client::resource_name</a>, <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html#l00173">session_destroy_fn()</a>, <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html#l01203">websocket_client::version</a>, <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html#l01139">websocket_client_args_create()</a>, <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html#l01168">websocket_client_create_key()</a>, <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html#l01210">websocket_client_destroy()</a>, <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html#l01093">websocket_client_parse_uri()</a>, <a class="el" href="../../d0/d0c/http__websocket_8h_source.html#l00398">WS_ALLOCATE_ERROR</a>, <a class="el" href="../../d0/d0c/http__websocket_8h_source.html#l00399">WS_KEY_ERROR</a>, and <a class="el" href="../../d0/d0c/http__websocket_8h_source.html#l00400">WS_URI_PARSE_ERROR</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html#l01421">ast_websocket_client_create()</a>.</p>
<div class="fragment"><div class="line"><a name="l01227"></a><span class="lineno"> 1227</span>&#160;{</div><div class="line"><a name="l01228"></a><span class="lineno"> 1228</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../db/db6/structast__websocket.html">ast_websocket</a> *ws = <a class="code" href="../../d5/da5/astobj2_8h.html#ae0422b60d8e25b6962b2d61ae4ddf724">ao2_alloc</a>(<span class="keyword">sizeof</span>(*ws), <a class="code" href="../../de/d4c/res__http__websocket_8c.html#aed324e37497858b50c441fef9f636ccf">session_destroy_fn</a>);</div><div class="line"><a name="l01229"></a><span class="lineno"> 1229</span>&#160;</div><div class="line"><a name="l01230"></a><span class="lineno"> 1230</span>&#160;   <span class="keywordflow">if</span> (!ws) {</div><div class="line"><a name="l01231"></a><span class="lineno"> 1231</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Unable to allocate websocket\n&quot;</span>);</div><div class="line"><a name="l01232"></a><span class="lineno"> 1232</span>&#160;      *<a class="code" href="../../de/d1b/cel__pgsql_8c.html#ad6c487210772a9b4b0ca04b04b847d4c">result</a> = <a class="code" href="../../d0/d0c/http__websocket_8h.html#a6341c1b69564f8a3342229c5102b0fe2a71852cd5d07f9670965e98ee37e3239d">WS_ALLOCATE_ERROR</a>;</div><div class="line"><a name="l01233"></a><span class="lineno"> 1233</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l01234"></a><span class="lineno"> 1234</span>&#160;   }</div><div class="line"><a name="l01235"></a><span class="lineno"> 1235</span>&#160;</div><div class="line"><a name="l01236"></a><span class="lineno"> 1236</span>&#160;   <span class="keywordflow">if</span> (!(ws-&gt;<a class="code" href="../../db/db6/structast__websocket.html#a58c585b74d6f77b0a24b7503ddf9d7e2">client</a> = <a class="code" href="../../d5/da5/astobj2_8h.html#ae0422b60d8e25b6962b2d61ae4ddf724">ao2_alloc</a>(</div><div class="line"><a name="l01237"></a><span class="lineno"> 1237</span>&#160;            <span class="keyword">sizeof</span>(*ws-&gt;<a class="code" href="../../db/db6/structast__websocket.html#a58c585b74d6f77b0a24b7503ddf9d7e2">client</a>), <a class="code" href="../../de/d4c/res__http__websocket_8c.html#a0c583fc9daf458f4a079bf3e129e7383">websocket_client_destroy</a>))) {</div><div class="line"><a name="l01238"></a><span class="lineno"> 1238</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Unable to allocate websocket client\n&quot;</span>);</div><div class="line"><a name="l01239"></a><span class="lineno"> 1239</span>&#160;      *<a class="code" href="../../de/d1b/cel__pgsql_8c.html#ad6c487210772a9b4b0ca04b04b847d4c">result</a> = <a class="code" href="../../d0/d0c/http__websocket_8h.html#a6341c1b69564f8a3342229c5102b0fe2a71852cd5d07f9670965e98ee37e3239d">WS_ALLOCATE_ERROR</a>;</div><div class="line"><a name="l01240"></a><span class="lineno"> 1240</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l01241"></a><span class="lineno"> 1241</span>&#160;   }</div><div class="line"><a name="l01242"></a><span class="lineno"> 1242</span>&#160;</div><div class="line"><a name="l01243"></a><span class="lineno"> 1243</span>&#160;   <span class="keywordflow">if</span> (!(ws-&gt;<a class="code" href="../../db/db6/structast__websocket.html#a58c585b74d6f77b0a24b7503ddf9d7e2">client</a>-&gt;<a class="code" href="../../d7/de7/structwebsocket__client.html#a5892a9181e6a332f84d27aecd41dcd12">key</a> = <a class="code" href="../../de/d4c/res__http__websocket_8c.html#af684463c7d69d50e47bc96b968737280">websocket_client_create_key</a>())) {</div><div class="line"><a name="l01244"></a><span class="lineno"> 1244</span>&#160;      <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(ws, -1);</div><div class="line"><a name="l01245"></a><span class="lineno"> 1245</span>&#160;      *<a class="code" href="../../de/d1b/cel__pgsql_8c.html#ad6c487210772a9b4b0ca04b04b847d4c">result</a> = <a class="code" href="../../d0/d0c/http__websocket_8h.html#a6341c1b69564f8a3342229c5102b0fe2a41a0f9007b2120226e9f98e054643941">WS_KEY_ERROR</a>;</div><div class="line"><a name="l01246"></a><span class="lineno"> 1246</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l01247"></a><span class="lineno"> 1247</span>&#160;   }</div><div class="line"><a name="l01248"></a><span class="lineno"> 1248</span>&#160;</div><div class="line"><a name="l01249"></a><span class="lineno"> 1249</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../de/d4c/res__http__websocket_8c.html#aa29713a06d3e2971c2ca2c213d177762">websocket_client_parse_uri</a>(</div><div class="line"><a name="l01250"></a><span class="lineno"> 1250</span>&#160;          uri, &amp;ws-&gt;<a class="code" href="../../db/db6/structast__websocket.html#a58c585b74d6f77b0a24b7503ddf9d7e2">client</a>-&gt;<a class="code" href="../../d7/de7/structwebsocket__client.html#a1c2046dcb30a629d6d9f45ff8f403f12">host</a>, &amp;ws-&gt;<a class="code" href="../../db/db6/structast__websocket.html#a58c585b74d6f77b0a24b7503ddf9d7e2">client</a>-&gt;<a class="code" href="../../d7/de7/structwebsocket__client.html#aea139a94a520535ed521664a882c539a">resource_name</a>)) {</div><div class="line"><a name="l01251"></a><span class="lineno"> 1251</span>&#160;      <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(ws, -1);</div><div class="line"><a name="l01252"></a><span class="lineno"> 1252</span>&#160;      *<a class="code" href="../../de/d1b/cel__pgsql_8c.html#ad6c487210772a9b4b0ca04b04b847d4c">result</a> = <a class="code" href="../../d0/d0c/http__websocket_8h.html#a6341c1b69564f8a3342229c5102b0fe2ab7f0f90def6762f9c4112fdc69399d19">WS_URI_PARSE_ERROR</a>;</div><div class="line"><a name="l01253"></a><span class="lineno"> 1253</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l01254"></a><span class="lineno"> 1254</span>&#160;   }</div><div class="line"><a name="l01255"></a><span class="lineno"> 1255</span>&#160;</div><div class="line"><a name="l01256"></a><span class="lineno"> 1256</span>&#160;   <span class="keywordflow">if</span> (!(ws-&gt;<a class="code" href="../../db/db6/structast__websocket.html#a58c585b74d6f77b0a24b7503ddf9d7e2">client</a>-&gt;<a class="code" href="../../d7/de7/structwebsocket__client.html#a66814a7c3b377ff1395878e5b8755d48">args</a> = <a class="code" href="../../de/d4c/res__http__websocket_8c.html#acf54fd38b47e3e4d0960010f7ae6e873">websocket_client_args_create</a>(</div><div class="line"><a name="l01257"></a><span class="lineno"> 1257</span>&#160;            ws-&gt;<a class="code" href="../../db/db6/structast__websocket.html#a58c585b74d6f77b0a24b7503ddf9d7e2">client</a>-&gt;<a class="code" href="../../d7/de7/structwebsocket__client.html#a1c2046dcb30a629d6d9f45ff8f403f12">host</a>, tls_cfg, <a class="code" href="../../de/d1b/cel__pgsql_8c.html#ad6c487210772a9b4b0ca04b04b847d4c">result</a>))) {</div><div class="line"><a name="l01258"></a><span class="lineno"> 1258</span>&#160;      <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(ws, -1);</div><div class="line"><a name="l01259"></a><span class="lineno"> 1259</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l01260"></a><span class="lineno"> 1260</span>&#160;   }</div><div class="line"><a name="l01261"></a><span class="lineno"> 1261</span>&#160;   ws-&gt;<a class="code" href="../../db/db6/structast__websocket.html#a58c585b74d6f77b0a24b7503ddf9d7e2">client</a>-&gt;<a class="code" href="../../d7/de7/structwebsocket__client.html#ae7799d7e9c180765a889a0a40b7ce4f9">protocols</a> = <a class="code" href="../../d8/d8a/astmm_8h.html#ab263849d03fb892847be4986db759737">ast_strdup</a>(protocols);</div><div class="line"><a name="l01262"></a><span class="lineno"> 1262</span>&#160;</div><div class="line"><a name="l01263"></a><span class="lineno"> 1263</span>&#160;   ws-&gt;<a class="code" href="../../db/db6/structast__websocket.html#a58c585b74d6f77b0a24b7503ddf9d7e2">client</a>-&gt;<a class="code" href="../../d7/de7/structwebsocket__client.html#aad880fc4455c253781e8968f2239d56f">version</a> = 13;</div><div class="line"><a name="l01264"></a><span class="lineno"> 1264</span>&#160;   ws-&gt;<a class="code" href="../../db/db6/structast__websocket.html#ac717220c65cf5cf274dc30d3af6f1ded">opcode</a> = -1;</div><div class="line"><a name="l01265"></a><span class="lineno"> 1265</span>&#160;   ws-&gt;<a class="code" href="../../db/db6/structast__websocket.html#ae2c11c04c7f747de8619a46a721bd63d">reconstruct</a> = <a class="code" href="../../de/d4c/res__http__websocket_8c.html#a7f0e6d73d21f7f256f229583f02e58ec">DEFAULT_RECONSTRUCTION_CEILING</a>;</div><div class="line"><a name="l01266"></a><span class="lineno"> 1266</span>&#160;   <span class="keywordflow">return</span> ws;</div><div class="line"><a name="l01267"></a><span class="lineno"> 1267</span>&#160;}</div><div class="ttc" id="structast__websocket_html_ae2c11c04c7f747de8619a46a721bd63d"><div class="ttname"><a href="../../db/db6/structast__websocket.html#ae2c11c04c7f747de8619a46a721bd63d">ast_websocket::reconstruct</a></div><div class="ttdeci">size_t reconstruct</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d4c/res__http__websocket_8c_source.html#l00095">res_http_websocket.c:95</a></div></div>
<div class="ttc" id="structwebsocket__client_html_a1c2046dcb30a629d6d9f45ff8f403f12"><div class="ttname"><a href="../../d7/de7/structwebsocket__client.html#a1c2046dcb30a629d6d9f45ff8f403f12">websocket_client::host</a></div><div class="ttdeci">char * host</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d4c/res__http__websocket_8c_source.html#l01193">res_http_websocket.c:1193</a></div></div>
<div class="ttc" id="res__http__websocket_8c_html_aa29713a06d3e2971c2ca2c213d177762"><div class="ttname"><a href="../../de/d4c/res__http__websocket_8c.html#aa29713a06d3e2971c2ca2c213d177762">websocket_client_parse_uri</a></div><div class="ttdeci">static int websocket_client_parse_uri(const char *uri, char **host, struct ast_str **path)</div><div class="ttdoc">Parse the given uri into a path and remote address. </div><div class="ttdef"><b>Definition:</b> <a href="../../de/d4c/res__http__websocket_8c_source.html#l01093">res_http_websocket.c:1093</a></div></div>
<div class="ttc" id="http__websocket_8h_html_a6341c1b69564f8a3342229c5102b0fe2a71852cd5d07f9670965e98ee37e3239d"><div class="ttname"><a href="../../d0/d0c/http__websocket_8h.html#a6341c1b69564f8a3342229c5102b0fe2a71852cd5d07f9670965e98ee37e3239d">WS_ALLOCATE_ERROR</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d0c/http__websocket_8h_source.html#l00398">http_websocket.h:398</a></div></div>
<div class="ttc" id="structwebsocket__client_html_a66814a7c3b377ff1395878e5b8755d48"><div class="ttname"><a href="../../d7/de7/structwebsocket__client.html#a66814a7c3b377ff1395878e5b8755d48">websocket_client::args</a></div><div class="ttdeci">struct ast_tcptls_session_args * args</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d4c/res__http__websocket_8c_source.html#l01205">res_http_websocket.c:1205</a></div></div>
<div class="ttc" id="res__http__websocket_8c_html_a7f0e6d73d21f7f256f229583f02e58ec"><div class="ttname"><a href="../../de/d4c/res__http__websocket_8c.html#a7f0e6d73d21f7f256f229583f02e58ec">DEFAULT_RECONSTRUCTION_CEILING</a></div><div class="ttdeci">#define DEFAULT_RECONSTRUCTION_CEILING</div><div class="ttdoc">Default reconstruction size for multi-frame payload reconstruction. If exceeded the next frame will s...</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d4c/res__http__websocket_8c_source.html#l00071">res_http_websocket.c:71</a></div></div>
<div class="ttc" id="astmm_8h_html_ab263849d03fb892847be4986db759737"><div class="ttname"><a href="../../d8/d8a/astmm_8h.html#ab263849d03fb892847be4986db759737">ast_strdup</a></div><div class="ttdeci">#define ast_strdup(str)</div><div class="ttdoc">A wrapper for strdup() </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d8a/astmm_8h_source.html#l00243">astmm.h:243</a></div></div>
<div class="ttc" id="resample_8c_html_a070d2ce7b6bb7e5c05602aa8c308d0c4"><div class="ttname"><a href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a></div><div class="ttdeci">#define NULL</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d7f/resample_8c_source.html#l00096">resample.c:96</a></div></div>
<div class="ttc" id="res__http__websocket_8c_html_af684463c7d69d50e47bc96b968737280"><div class="ttname"><a href="../../de/d4c/res__http__websocket_8c.html#af684463c7d69d50e47bc96b968737280">websocket_client_create_key</a></div><div class="ttdeci">static char * websocket_client_create_key(void)</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d4c/res__http__websocket_8c_source.html#l01168">res_http_websocket.c:1168</a></div></div>
<div class="ttc" id="structwebsocket__client_html_aad880fc4455c253781e8968f2239d56f"><div class="ttname"><a href="../../d7/de7/structwebsocket__client.html#aad880fc4455c253781e8968f2239d56f">websocket_client::version</a></div><div class="ttdeci">int version</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d4c/res__http__websocket_8c_source.html#l01203">res_http_websocket.c:1203</a></div></div>
<div class="ttc" id="structwebsocket__client_html_aea139a94a520535ed521664a882c539a"><div class="ttname"><a href="../../d7/de7/structwebsocket__client.html#aea139a94a520535ed521664a882c539a">websocket_client::resource_name</a></div><div class="ttdeci">struct ast_str * resource_name</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d4c/res__http__websocket_8c_source.html#l01195">res_http_websocket.c:1195</a></div></div>
<div class="ttc" id="astobj2_8c_html_a96a00b3a518d7f32b6d51dc28f09bf9b"><div class="ttname"><a href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a></div><div class="ttdeci">#define ast_log</div><div class="ttdef"><b>Definition:</b> <a href="../../da/df7/astobj2_8c_source.html#l00042">astobj2.c:42</a></div></div>
<div class="ttc" id="structast__websocket_html_ac717220c65cf5cf274dc30d3af6f1ded"><div class="ttname"><a href="../../db/db6/structast__websocket.html#ac717220c65cf5cf274dc30d3af6f1ded">ast_websocket::opcode</a></div><div class="ttdeci">enum ast_websocket_opcode opcode</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d4c/res__http__websocket_8c_source.html#l00092">res_http_websocket.c:92</a></div></div>
<div class="ttc" id="structwebsocket__client_html_a5892a9181e6a332f84d27aecd41dcd12"><div class="ttname"><a href="../../d7/de7/structwebsocket__client.html#a5892a9181e6a332f84d27aecd41dcd12">websocket_client::key</a></div><div class="ttdeci">char * key</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d4c/res__http__websocket_8c_source.html#l01197">res_http_websocket.c:1197</a></div></div>
<div class="ttc" id="astobj2_8h_html_aaca5e8eac39a22f9da1c36fc6c922270"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a></div><div class="ttdeci">#define ao2_ref(o, delta)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l00464">astobj2.h:464</a></div></div>
<div class="ttc" id="structast__websocket_html_a58c585b74d6f77b0a24b7503ddf9d7e2"><div class="ttname"><a href="../../db/db6/structast__websocket.html#a58c585b74d6f77b0a24b7503ddf9d7e2">ast_websocket::client</a></div><div class="ttdeci">struct websocket_client * client</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d4c/res__http__websocket_8c_source.html#l00100">res_http_websocket.c:100</a></div></div>
<div class="ttc" id="http__websocket_8h_html_a6341c1b69564f8a3342229c5102b0fe2a41a0f9007b2120226e9f98e054643941"><div class="ttname"><a href="../../d0/d0c/http__websocket_8h.html#a6341c1b69564f8a3342229c5102b0fe2a41a0f9007b2120226e9f98e054643941">WS_KEY_ERROR</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d0c/http__websocket_8h_source.html#l00399">http_websocket.h:399</a></div></div>
<div class="ttc" id="logger_8h_html_aced66975c154ea0e2a8ec3bc818b4e08"><div class="ttname"><a href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a></div><div class="ttdeci">#define LOG_ERROR</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d8c/logger_8h_source.html#l00285">logger.h:285</a></div></div>
<div class="ttc" id="res__http__websocket_8c_html_aed324e37497858b50c441fef9f636ccf"><div class="ttname"><a href="../../de/d4c/res__http__websocket_8c.html#aed324e37497858b50c441fef9f636ccf">session_destroy_fn</a></div><div class="ttdeci">static void session_destroy_fn(void *obj)</div><div class="ttdoc">Destructor function for sessions. </div><div class="ttdef"><b>Definition:</b> <a href="../../de/d4c/res__http__websocket_8c_source.html#l00173">res_http_websocket.c:173</a></div></div>
<div class="ttc" id="astobj2_8h_html_ae0422b60d8e25b6962b2d61ae4ddf724"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#ae0422b60d8e25b6962b2d61ae4ddf724">ao2_alloc</a></div><div class="ttdeci">#define ao2_alloc(data_size, destructor_fn)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l00411">astobj2.h:411</a></div></div>
<div class="ttc" id="structast__websocket_html"><div class="ttname"><a href="../../db/db6/structast__websocket.html">ast_websocket</a></div><div class="ttdoc">Structure definition for session. </div><div class="ttdef"><b>Definition:</b> <a href="../../de/d4c/res__http__websocket_8c_source.html#l00088">res_http_websocket.c:88</a></div></div>
<div class="ttc" id="structwebsocket__client_html_ae7799d7e9c180765a889a0a40b7ce4f9"><div class="ttname"><a href="../../d7/de7/structwebsocket__client.html#ae7799d7e9c180765a889a0a40b7ce4f9">websocket_client::protocols</a></div><div class="ttdeci">char * protocols</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d4c/res__http__websocket_8c_source.html#l01199">res_http_websocket.c:1199</a></div></div>
<div class="ttc" id="http__websocket_8h_html_a6341c1b69564f8a3342229c5102b0fe2ab7f0f90def6762f9c4112fdc69399d19"><div class="ttname"><a href="../../d0/d0c/http__websocket_8h.html#a6341c1b69564f8a3342229c5102b0fe2ab7f0f90def6762f9c4112fdc69399d19">WS_URI_PARSE_ERROR</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d0c/http__websocket_8h_source.html#l00400">http_websocket.h:400</a></div></div>
<div class="ttc" id="cel__pgsql_8c_html_ad6c487210772a9b4b0ca04b04b847d4c"><div class="ttname"><a href="../../de/d1b/cel__pgsql_8c.html#ad6c487210772a9b4b0ca04b04b847d4c">result</a></div><div class="ttdeci">static PGresult * result</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d1b/cel__pgsql_8c_source.html#l00088">cel_pgsql.c:88</a></div></div>
<div class="ttc" id="res__http__websocket_8c_html_a0c583fc9daf458f4a079bf3e129e7383"><div class="ttname"><a href="../../de/d4c/res__http__websocket_8c.html#a0c583fc9daf458f4a079bf3e129e7383">websocket_client_destroy</a></div><div class="ttdeci">static void websocket_client_destroy(void *obj)</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d4c/res__http__websocket_8c_source.html#l01210">res_http_websocket.c:1210</a></div></div>
<div class="ttc" id="res__http__websocket_8c_html_acf54fd38b47e3e4d0960010f7ae6e873"><div class="ttname"><a href="../../de/d4c/res__http__websocket_8c.html#acf54fd38b47e3e4d0960010f7ae6e873">websocket_client_args_create</a></div><div class="ttdeci">static struct ast_tcptls_session_args * websocket_client_args_create(const char *host, struct ast_tls_config *tls_cfg, enum ast_websocket_result *result)</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d4c/res__http__websocket_8c_source.html#l01139">res_http_websocket.c:1139</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="af684463c7d69d50e47bc96b968737280"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af684463c7d69d50e47bc96b968737280">&#9670;&nbsp;</a></span>websocket_client_create_key()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static char* websocket_client_create_key </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html#l01168">1168</a> of file <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html">res_http_websocket.c</a>.</p>

<p class="reference">References <a class="el" href="../../de/d1f/main_2utils_8c_source.html#l00404">ast_base64encode()</a>, <a class="el" href="../../da/df7/astobj2_8c_source.html#l00042">ast_log</a>, <a class="el" href="../../d8/d8a/astmm_8h_source.html#l00193">ast_malloc</a>, <a class="el" href="../../de/d1f/main_2utils_8c_source.html#l02064">ast_random()</a>, <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html#l00048">CLIENT_KEY_SIZE</a>, <a class="el" href="../../d1/d8c/logger_8h_source.html#l00285">LOG_ERROR</a>, and <a class="el" href="../../dc/d7f/resample_8c_source.html#l00096">NULL</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html#l01224">websocket_client_create()</a>.</p>
<div class="fragment"><div class="line"><a name="l01169"></a><span class="lineno"> 1169</span>&#160;{</div><div class="line"><a name="l01170"></a><span class="lineno"> 1170</span>&#160;   <span class="keyword">static</span> <span class="keywordtype">int</span> encoded_size = <a class="code" href="../../de/d4c/res__http__websocket_8c.html#aba8a9af0a5e1e29151c407fafd517124">CLIENT_KEY_SIZE</a> * 2 * <span class="keyword">sizeof</span>(char) + 1;</div><div class="line"><a name="l01171"></a><span class="lineno"> 1171</span>&#160;   <span class="comment">/* key is randomly selected 16-byte base64 encoded value */</span></div><div class="line"><a name="l01172"></a><span class="lineno"> 1172</span>&#160;   <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> key[<a class="code" href="../../de/d4c/res__http__websocket_8c.html#aba8a9af0a5e1e29151c407fafd517124">CLIENT_KEY_SIZE</a> + <span class="keyword">sizeof</span>(long) - 1];</div><div class="line"><a name="l01173"></a><span class="lineno"> 1173</span>&#160;   <span class="keywordtype">char</span> *encoded = <a class="code" href="../../d8/d8a/astmm_8h.html#ae63d4f486bcf6eac7c1593f867717d91">ast_malloc</a>(encoded_size);</div><div class="line"><a name="l01174"></a><span class="lineno"> 1174</span>&#160;   <span class="keywordtype">long</span> i = 0;</div><div class="line"><a name="l01175"></a><span class="lineno"> 1175</span>&#160;</div><div class="line"><a name="l01176"></a><span class="lineno"> 1176</span>&#160;   <span class="keywordflow">if</span> (!encoded) {</div><div class="line"><a name="l01177"></a><span class="lineno"> 1177</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Unable to allocate client websocket key\n&quot;</span>);</div><div class="line"><a name="l01178"></a><span class="lineno"> 1178</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l01179"></a><span class="lineno"> 1179</span>&#160;   }</div><div class="line"><a name="l01180"></a><span class="lineno"> 1180</span>&#160;</div><div class="line"><a name="l01181"></a><span class="lineno"> 1181</span>&#160;   <span class="keywordflow">while</span> (i &lt; <a class="code" href="../../de/d4c/res__http__websocket_8c.html#aba8a9af0a5e1e29151c407fafd517124">CLIENT_KEY_SIZE</a>) {</div><div class="line"><a name="l01182"></a><span class="lineno"> 1182</span>&#160;      <span class="keywordtype">long</span> num = <a class="code" href="../../d5/d60/utils_8h.html#a7b4f10b070e95ba413e258a3e4b03c20">ast_random</a>();</div><div class="line"><a name="l01183"></a><span class="lineno"> 1183</span>&#160;      memcpy(key + i, &amp;num, <span class="keyword">sizeof</span>(<span class="keywordtype">long</span>));</div><div class="line"><a name="l01184"></a><span class="lineno"> 1184</span>&#160;      i += <span class="keyword">sizeof</span>(long);</div><div class="line"><a name="l01185"></a><span class="lineno"> 1185</span>&#160;   }</div><div class="line"><a name="l01186"></a><span class="lineno"> 1186</span>&#160;</div><div class="line"><a name="l01187"></a><span class="lineno"> 1187</span>&#160;   <a class="code" href="../../d5/d60/utils_8h.html#a555dad1bd5b23acf01cf08f1affab879">ast_base64encode</a>(encoded, key, <a class="code" href="../../de/d4c/res__http__websocket_8c.html#aba8a9af0a5e1e29151c407fafd517124">CLIENT_KEY_SIZE</a>, encoded_size);</div><div class="line"><a name="l01188"></a><span class="lineno"> 1188</span>&#160;   <span class="keywordflow">return</span> encoded;</div><div class="line"><a name="l01189"></a><span class="lineno"> 1189</span>&#160;}</div><div class="ttc" id="resample_8c_html_a070d2ce7b6bb7e5c05602aa8c308d0c4"><div class="ttname"><a href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a></div><div class="ttdeci">#define NULL</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d7f/resample_8c_source.html#l00096">resample.c:96</a></div></div>
<div class="ttc" id="astobj2_8c_html_a96a00b3a518d7f32b6d51dc28f09bf9b"><div class="ttname"><a href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a></div><div class="ttdeci">#define ast_log</div><div class="ttdef"><b>Definition:</b> <a href="../../da/df7/astobj2_8c_source.html#l00042">astobj2.c:42</a></div></div>
<div class="ttc" id="utils_8h_html_a7b4f10b070e95ba413e258a3e4b03c20"><div class="ttname"><a href="../../d5/d60/utils_8h.html#a7b4f10b070e95ba413e258a3e4b03c20">ast_random</a></div><div class="ttdeci">long int ast_random(void)</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d1f/main_2utils_8c_source.html#l02064">main/utils.c:2064</a></div></div>
<div class="ttc" id="astmm_8h_html_ae63d4f486bcf6eac7c1593f867717d91"><div class="ttname"><a href="../../d8/d8a/astmm_8h.html#ae63d4f486bcf6eac7c1593f867717d91">ast_malloc</a></div><div class="ttdeci">#define ast_malloc(len)</div><div class="ttdoc">A wrapper for malloc() </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d8a/astmm_8h_source.html#l00193">astmm.h:193</a></div></div>
<div class="ttc" id="logger_8h_html_aced66975c154ea0e2a8ec3bc818b4e08"><div class="ttname"><a href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a></div><div class="ttdeci">#define LOG_ERROR</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d8c/logger_8h_source.html#l00285">logger.h:285</a></div></div>
<div class="ttc" id="utils_8h_html_a555dad1bd5b23acf01cf08f1affab879"><div class="ttname"><a href="../../d5/d60/utils_8h.html#a555dad1bd5b23acf01cf08f1affab879">ast_base64encode</a></div><div class="ttdeci">int ast_base64encode(char *dst, const unsigned char *src, int srclen, int max)</div><div class="ttdoc">Encode data in base64. </div><div class="ttdef"><b>Definition:</b> <a href="../../de/d1f/main_2utils_8c_source.html#l00404">main/utils.c:404</a></div></div>
<div class="ttc" id="res__http__websocket_8c_html_aba8a9af0a5e1e29151c407fafd517124"><div class="ttname"><a href="../../de/d4c/res__http__websocket_8c.html#aba8a9af0a5e1e29151c407fafd517124">CLIENT_KEY_SIZE</a></div><div class="ttdeci">#define CLIENT_KEY_SIZE</div><div class="ttdoc">Length of a websocket&amp;#39;s client key. </div><div class="ttdef"><b>Definition:</b> <a href="../../de/d4c/res__http__websocket_8c_source.html#l00048">res_http_websocket.c:48</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a0c583fc9daf458f4a079bf3e129e7383"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0c583fc9daf458f4a079bf3e129e7383">&#9670;&nbsp;</a></span>websocket_client_destroy()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void websocket_client_destroy </td>
          <td>(</td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>obj</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html#l01210">1210</a> of file <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html">res_http_websocket.c</a>.</p>

<p class="reference">References <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html#l01201">websocket_client::accept_protocol</a>, <a class="el" href="../../d5/da5/astobj2_8h_source.html#l01958">ao2_cleanup</a>, <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html#l01205">websocket_client::args</a>, <a class="el" href="../../d8/d8a/astmm_8h_source.html#l00182">ast_free</a>, <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html#l00100">ast_websocket::client</a>, <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html#l01193">websocket_client::host</a>, <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html#l01197">websocket_client::key</a>, <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html#l01199">websocket_client::protocols</a>, <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html#l01195">websocket_client::resource_name</a>, and <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html#l01207">websocket_client::ser</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html#l01224">websocket_client_create()</a>.</p>
<div class="fragment"><div class="line"><a name="l01211"></a><span class="lineno"> 1211</span>&#160;{</div><div class="line"><a name="l01212"></a><span class="lineno"> 1212</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d7/de7/structwebsocket__client.html">websocket_client</a> *client = obj;</div><div class="line"><a name="l01213"></a><span class="lineno"> 1213</span>&#160;</div><div class="line"><a name="l01214"></a><span class="lineno"> 1214</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#a6321ee982370c55ab3c24c72c562cbdd">ao2_cleanup</a>(client-&gt;<a class="code" href="../../d7/de7/structwebsocket__client.html#ab65df483a962559e090b6c1c4c46f8f5">ser</a>);</div><div class="line"><a name="l01215"></a><span class="lineno"> 1215</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#a6321ee982370c55ab3c24c72c562cbdd">ao2_cleanup</a>(client-&gt;<a class="code" href="../../d7/de7/structwebsocket__client.html#a66814a7c3b377ff1395878e5b8755d48">args</a>);</div><div class="line"><a name="l01216"></a><span class="lineno"> 1216</span>&#160;</div><div class="line"><a name="l01217"></a><span class="lineno"> 1217</span>&#160;   <a class="code" href="../../d8/d8a/astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(client-&gt;<a class="code" href="../../d7/de7/structwebsocket__client.html#adae107229ce11e8bdf499a2bb06a4f62">accept_protocol</a>);</div><div class="line"><a name="l01218"></a><span class="lineno"> 1218</span>&#160;   <a class="code" href="../../d8/d8a/astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(client-&gt;<a class="code" href="../../d7/de7/structwebsocket__client.html#ae7799d7e9c180765a889a0a40b7ce4f9">protocols</a>);</div><div class="line"><a name="l01219"></a><span class="lineno"> 1219</span>&#160;   <a class="code" href="../../d8/d8a/astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(client-&gt;<a class="code" href="../../d7/de7/structwebsocket__client.html#a5892a9181e6a332f84d27aecd41dcd12">key</a>);</div><div class="line"><a name="l01220"></a><span class="lineno"> 1220</span>&#160;   <a class="code" href="../../d8/d8a/astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(client-&gt;<a class="code" href="../../d7/de7/structwebsocket__client.html#aea139a94a520535ed521664a882c539a">resource_name</a>);</div><div class="line"><a name="l01221"></a><span class="lineno"> 1221</span>&#160;   <a class="code" href="../../d8/d8a/astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(client-&gt;<a class="code" href="../../d7/de7/structwebsocket__client.html#a1c2046dcb30a629d6d9f45ff8f403f12">host</a>);</div><div class="line"><a name="l01222"></a><span class="lineno"> 1222</span>&#160;}</div><div class="ttc" id="structwebsocket__client_html_adae107229ce11e8bdf499a2bb06a4f62"><div class="ttname"><a href="../../d7/de7/structwebsocket__client.html#adae107229ce11e8bdf499a2bb06a4f62">websocket_client::accept_protocol</a></div><div class="ttdeci">char * accept_protocol</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d4c/res__http__websocket_8c_source.html#l01201">res_http_websocket.c:1201</a></div></div>
<div class="ttc" id="structwebsocket__client_html_a1c2046dcb30a629d6d9f45ff8f403f12"><div class="ttname"><a href="../../d7/de7/structwebsocket__client.html#a1c2046dcb30a629d6d9f45ff8f403f12">websocket_client::host</a></div><div class="ttdeci">char * host</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d4c/res__http__websocket_8c_source.html#l01193">res_http_websocket.c:1193</a></div></div>
<div class="ttc" id="structwebsocket__client_html_ab65df483a962559e090b6c1c4c46f8f5"><div class="ttname"><a href="../../d7/de7/structwebsocket__client.html#ab65df483a962559e090b6c1c4c46f8f5">websocket_client::ser</a></div><div class="ttdeci">struct ast_tcptls_session_instance * ser</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d4c/res__http__websocket_8c_source.html#l01207">res_http_websocket.c:1207</a></div></div>
<div class="ttc" id="structwebsocket__client_html_a66814a7c3b377ff1395878e5b8755d48"><div class="ttname"><a href="../../d7/de7/structwebsocket__client.html#a66814a7c3b377ff1395878e5b8755d48">websocket_client::args</a></div><div class="ttdeci">struct ast_tcptls_session_args * args</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d4c/res__http__websocket_8c_source.html#l01205">res_http_websocket.c:1205</a></div></div>
<div class="ttc" id="structwebsocket__client_html_aea139a94a520535ed521664a882c539a"><div class="ttname"><a href="../../d7/de7/structwebsocket__client.html#aea139a94a520535ed521664a882c539a">websocket_client::resource_name</a></div><div class="ttdeci">struct ast_str * resource_name</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d4c/res__http__websocket_8c_source.html#l01195">res_http_websocket.c:1195</a></div></div>
<div class="ttc" id="structwebsocket__client_html_a5892a9181e6a332f84d27aecd41dcd12"><div class="ttname"><a href="../../d7/de7/structwebsocket__client.html#a5892a9181e6a332f84d27aecd41dcd12">websocket_client::key</a></div><div class="ttdeci">char * key</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d4c/res__http__websocket_8c_source.html#l01197">res_http_websocket.c:1197</a></div></div>
<div class="ttc" id="astmm_8h_html_a402072d6789f6ed9e3a81da27504127e"><div class="ttname"><a href="../../d8/d8a/astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a></div><div class="ttdeci">#define ast_free(a)</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d8a/astmm_8h_source.html#l00182">astmm.h:182</a></div></div>
<div class="ttc" id="structwebsocket__client_html_ae7799d7e9c180765a889a0a40b7ce4f9"><div class="ttname"><a href="../../d7/de7/structwebsocket__client.html#ae7799d7e9c180765a889a0a40b7ce4f9">websocket_client::protocols</a></div><div class="ttdeci">char * protocols</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d4c/res__http__websocket_8c_source.html#l01199">res_http_websocket.c:1199</a></div></div>
<div class="ttc" id="astobj2_8h_html_a6321ee982370c55ab3c24c72c562cbdd"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#a6321ee982370c55ab3c24c72c562cbdd">ao2_cleanup</a></div><div class="ttdeci">#define ao2_cleanup(obj)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l01958">astobj2.h:1958</a></div></div>
<div class="ttc" id="structwebsocket__client_html"><div class="ttname"><a href="../../d7/de7/structwebsocket__client.html">websocket_client</a></div><div class="ttdef"><b>Definition:</b> <a href="../../de/d4c/res__http__websocket_8c_source.html#l01191">res_http_websocket.c:1191</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a0f1a25206f6099821e1e196107dbfa1d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0f1a25206f6099821e1e196107dbfa1d">&#9670;&nbsp;</a></span>websocket_client_handle_response_code()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static enum <a class="el" href="../../d0/d0c/http__websocket_8h.html#a6341c1b69564f8a3342229c5102b0fe2">ast_websocket_result</a> websocket_client_handle_response_code </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="../../d7/de7/structwebsocket__client.html">websocket_client</a> *&#160;</td>
          <td class="paramname"><em>client</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>response_code</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html#l01275">1275</a> of file <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html">res_http_websocket.c</a>.</p>

<p class="reference">References <a class="el" href="../../da/df7/astobj2_8c_source.html#l00042">ast_log</a>, <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html#l01193">websocket_client::host</a>, <a class="el" href="../../d1/d8c/logger_8h_source.html#l00285">LOG_ERROR</a>, <a class="el" href="../../d0/d0c/http__websocket_8h_source.html#l00404">WS_BAD_REQUEST</a>, <a class="el" href="../../d0/d0c/http__websocket_8h_source.html#l00403">WS_INVALID_RESPONSE</a>, and <a class="el" href="../../d0/d0c/http__websocket_8h_source.html#l00405">WS_URL_NOT_FOUND</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html#l01300">websocket_client_handshake_get_response()</a>.</p>
<div class="fragment"><div class="line"><a name="l01277"></a><span class="lineno"> 1277</span>&#160;{</div><div class="line"><a name="l01278"></a><span class="lineno"> 1278</span>&#160;   <span class="keywordflow">if</span> (response_code &lt;= 0) {</div><div class="line"><a name="l01279"></a><span class="lineno"> 1279</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../d0/d0c/http__websocket_8h.html#a6341c1b69564f8a3342229c5102b0fe2aaa9948348602c9d008f5ddc3d5afbf37">WS_INVALID_RESPONSE</a>;</div><div class="line"><a name="l01280"></a><span class="lineno"> 1280</span>&#160;   }</div><div class="line"><a name="l01281"></a><span class="lineno"> 1281</span>&#160;</div><div class="line"><a name="l01282"></a><span class="lineno"> 1282</span>&#160;   <span class="keywordflow">switch</span> (response_code) {</div><div class="line"><a name="l01283"></a><span class="lineno"> 1283</span>&#160;   <span class="keywordflow">case</span> 101:</div><div class="line"><a name="l01284"></a><span class="lineno"> 1284</span>&#160;      <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l01285"></a><span class="lineno"> 1285</span>&#160;   <span class="keywordflow">case</span> 400:</div><div class="line"><a name="l01286"></a><span class="lineno"> 1286</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Received response 400 - Bad Request &quot;</span></div><div class="line"><a name="l01287"></a><span class="lineno"> 1287</span>&#160;         <span class="stringliteral">&quot;- from %s\n&quot;</span>, client-&gt;<a class="code" href="../../d7/de7/structwebsocket__client.html#a1c2046dcb30a629d6d9f45ff8f403f12">host</a>);</div><div class="line"><a name="l01288"></a><span class="lineno"> 1288</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../d0/d0c/http__websocket_8h.html#a6341c1b69564f8a3342229c5102b0fe2a018f7d6cb5dab684abb77b9500829267">WS_BAD_REQUEST</a>;</div><div class="line"><a name="l01289"></a><span class="lineno"> 1289</span>&#160;   <span class="keywordflow">case</span> 404:</div><div class="line"><a name="l01290"></a><span class="lineno"> 1290</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Received response 404 - Request URL not &quot;</span></div><div class="line"><a name="l01291"></a><span class="lineno"> 1291</span>&#160;         <span class="stringliteral">&quot;found - from %s\n&quot;</span>, client-&gt;<a class="code" href="../../d7/de7/structwebsocket__client.html#a1c2046dcb30a629d6d9f45ff8f403f12">host</a>);</div><div class="line"><a name="l01292"></a><span class="lineno"> 1292</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../d0/d0c/http__websocket_8h.html#a6341c1b69564f8a3342229c5102b0fe2a1961fef8fe770c325142480c15553e64">WS_URL_NOT_FOUND</a>;</div><div class="line"><a name="l01293"></a><span class="lineno"> 1293</span>&#160;   }</div><div class="line"><a name="l01294"></a><span class="lineno"> 1294</span>&#160;</div><div class="line"><a name="l01295"></a><span class="lineno"> 1295</span>&#160;   <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Invalid HTTP response code %d from %s\n&quot;</span>,</div><div class="line"><a name="l01296"></a><span class="lineno"> 1296</span>&#160;      response_code, client-&gt;<a class="code" href="../../d7/de7/structwebsocket__client.html#a1c2046dcb30a629d6d9f45ff8f403f12">host</a>);</div><div class="line"><a name="l01297"></a><span class="lineno"> 1297</span>&#160;   <span class="keywordflow">return</span> <a class="code" href="../../d0/d0c/http__websocket_8h.html#a6341c1b69564f8a3342229c5102b0fe2aaa9948348602c9d008f5ddc3d5afbf37">WS_INVALID_RESPONSE</a>;</div><div class="line"><a name="l01298"></a><span class="lineno"> 1298</span>&#160;}</div><div class="ttc" id="structwebsocket__client_html_a1c2046dcb30a629d6d9f45ff8f403f12"><div class="ttname"><a href="../../d7/de7/structwebsocket__client.html#a1c2046dcb30a629d6d9f45ff8f403f12">websocket_client::host</a></div><div class="ttdeci">char * host</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d4c/res__http__websocket_8c_source.html#l01193">res_http_websocket.c:1193</a></div></div>
<div class="ttc" id="http__websocket_8h_html_a6341c1b69564f8a3342229c5102b0fe2aaa9948348602c9d008f5ddc3d5afbf37"><div class="ttname"><a href="../../d0/d0c/http__websocket_8h.html#a6341c1b69564f8a3342229c5102b0fe2aaa9948348602c9d008f5ddc3d5afbf37">WS_INVALID_RESPONSE</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d0c/http__websocket_8h_source.html#l00403">http_websocket.h:403</a></div></div>
<div class="ttc" id="astobj2_8c_html_a96a00b3a518d7f32b6d51dc28f09bf9b"><div class="ttname"><a href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a></div><div class="ttdeci">#define ast_log</div><div class="ttdef"><b>Definition:</b> <a href="../../da/df7/astobj2_8c_source.html#l00042">astobj2.c:42</a></div></div>
<div class="ttc" id="logger_8h_html_aced66975c154ea0e2a8ec3bc818b4e08"><div class="ttname"><a href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a></div><div class="ttdeci">#define LOG_ERROR</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d8c/logger_8h_source.html#l00285">logger.h:285</a></div></div>
<div class="ttc" id="http__websocket_8h_html_a6341c1b69564f8a3342229c5102b0fe2a1961fef8fe770c325142480c15553e64"><div class="ttname"><a href="../../d0/d0c/http__websocket_8h.html#a6341c1b69564f8a3342229c5102b0fe2a1961fef8fe770c325142480c15553e64">WS_URL_NOT_FOUND</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d0c/http__websocket_8h_source.html#l00405">http_websocket.h:405</a></div></div>
<div class="ttc" id="http__websocket_8h_html_a6341c1b69564f8a3342229c5102b0fe2a018f7d6cb5dab684abb77b9500829267"><div class="ttname"><a href="../../d0/d0c/http__websocket_8h.html#a6341c1b69564f8a3342229c5102b0fe2a018f7d6cb5dab684abb77b9500829267">WS_BAD_REQUEST</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d0c/http__websocket_8h_source.html#l00404">http_websocket.h:404</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a71181c85896291b79c1920cfedeaf998"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a71181c85896291b79c1920cfedeaf998">&#9670;&nbsp;</a></span>websocket_client_handshake()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static enum <a class="el" href="../../d0/d0c/http__websocket_8h.html#a6341c1b69564f8a3342229c5102b0fe2">ast_websocket_result</a> websocket_client_handshake </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="../../d7/de7/structwebsocket__client.html">websocket_client</a> *&#160;</td>
          <td class="paramname"><em>client</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html#l01367">1367</a> of file <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html">res_http_websocket.c</a>.</p>

<p class="reference">References <a class="el" href="../../d1/dc8/iostream_8c_source.html#l00491">ast_iostream_printf()</a>, <a class="el" href="../../da/df7/astobj2_8c_source.html#l00042">ast_log</a>, <a class="el" href="../../d6/d90/strings_8h_source.html#l00714">ast_str_buffer()</a>, <a class="el" href="../../d6/d90/strings_8h_source.html#l00052">ast_strlen_zero</a>, <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html#l01193">websocket_client::host</a>, <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html#l01197">websocket_client::key</a>, <a class="el" href="../../d1/d8c/logger_8h_source.html#l00285">LOG_ERROR</a>, <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html#l01199">websocket_client::protocols</a>, <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html#l01195">websocket_client::resource_name</a>, <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html#l01207">websocket_client::ser</a>, <a class="el" href="../../d4/ddf/tcptls_8h_source.html#l00160">ast_tcptls_session_instance::stream</a>, <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html#l01203">websocket_client::version</a>, <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html#l01300">websocket_client_handshake_get_response()</a>, and <a class="el" href="../../d0/d0c/http__websocket_8h_source.html#l00409">WS_WRITE_ERROR</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html#l01397">websocket_client_connect()</a>.</p>
<div class="fragment"><div class="line"><a name="l01369"></a><span class="lineno"> 1369</span>&#160;{</div><div class="line"><a name="l01370"></a><span class="lineno"> 1370</span>&#160;   <span class="keywordtype">char</span> <a class="code" href="../../d7/de7/structwebsocket__client.html#ae7799d7e9c180765a889a0a40b7ce4f9">protocols</a>[100] = <span class="stringliteral">&quot;&quot;</span>;</div><div class="line"><a name="l01371"></a><span class="lineno"> 1371</span>&#160;</div><div class="line"><a name="l01372"></a><span class="lineno"> 1372</span>&#160;   <span class="keywordflow">if</span> (!<a class="code" href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a>(client-&gt;<a class="code" href="../../d7/de7/structwebsocket__client.html#ae7799d7e9c180765a889a0a40b7ce4f9">protocols</a>)) {</div><div class="line"><a name="l01373"></a><span class="lineno"> 1373</span>&#160;      sprintf(protocols, <span class="stringliteral">&quot;Sec-WebSocket-Protocol: %s\r\n&quot;</span>,</div><div class="line"><a name="l01374"></a><span class="lineno"> 1374</span>&#160;         client-&gt;<a class="code" href="../../d7/de7/structwebsocket__client.html#ae7799d7e9c180765a889a0a40b7ce4f9">protocols</a>);</div><div class="line"><a name="l01375"></a><span class="lineno"> 1375</span>&#160;   }</div><div class="line"><a name="l01376"></a><span class="lineno"> 1376</span>&#160;</div><div class="line"><a name="l01377"></a><span class="lineno"> 1377</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../dd/d27/iostream_8h.html#a23c05430f4b03eb5c72e1531f0716499">ast_iostream_printf</a>(client-&gt;<a class="code" href="../../d7/de7/structwebsocket__client.html#ab65df483a962559e090b6c1c4c46f8f5">ser</a>-&gt;<a class="code" href="../../d6/d49/structast__tcptls__session__instance.html#a36ac2dd734607a43ed90acb7e9d81ac5">stream</a>,</div><div class="line"><a name="l01378"></a><span class="lineno"> 1378</span>&#160;         <span class="stringliteral">&quot;GET /%s HTTP/1.1\r\n&quot;</span></div><div class="line"><a name="l01379"></a><span class="lineno"> 1379</span>&#160;         <span class="stringliteral">&quot;Sec-WebSocket-Version: %d\r\n&quot;</span></div><div class="line"><a name="l01380"></a><span class="lineno"> 1380</span>&#160;         <span class="stringliteral">&quot;Upgrade: websocket\r\n&quot;</span></div><div class="line"><a name="l01381"></a><span class="lineno"> 1381</span>&#160;         <span class="stringliteral">&quot;Connection: Upgrade\r\n&quot;</span></div><div class="line"><a name="l01382"></a><span class="lineno"> 1382</span>&#160;         <span class="stringliteral">&quot;Host: %s\r\n&quot;</span></div><div class="line"><a name="l01383"></a><span class="lineno"> 1383</span>&#160;         <span class="stringliteral">&quot;Sec-WebSocket-Key: %s\r\n&quot;</span></div><div class="line"><a name="l01384"></a><span class="lineno"> 1384</span>&#160;         <span class="stringliteral">&quot;%s\r\n&quot;</span>,</div><div class="line"><a name="l01385"></a><span class="lineno"> 1385</span>&#160;         client-&gt;<a class="code" href="../../d7/de7/structwebsocket__client.html#aea139a94a520535ed521664a882c539a">resource_name</a> ? <a class="code" href="../../d6/d90/strings_8h.html#a1ef7e2644ca7258070db316fdc0a465b">ast_str_buffer</a>(client-&gt;<a class="code" href="../../d7/de7/structwebsocket__client.html#aea139a94a520535ed521664a882c539a">resource_name</a>) : <span class="stringliteral">&quot;&quot;</span>,</div><div class="line"><a name="l01386"></a><span class="lineno"> 1386</span>&#160;         client-&gt;<a class="code" href="../../d7/de7/structwebsocket__client.html#aad880fc4455c253781e8968f2239d56f">version</a>,</div><div class="line"><a name="l01387"></a><span class="lineno"> 1387</span>&#160;         client-&gt;<a class="code" href="../../d7/de7/structwebsocket__client.html#a1c2046dcb30a629d6d9f45ff8f403f12">host</a>,</div><div class="line"><a name="l01388"></a><span class="lineno"> 1388</span>&#160;         client-&gt;<a class="code" href="../../d7/de7/structwebsocket__client.html#a5892a9181e6a332f84d27aecd41dcd12">key</a>,</div><div class="line"><a name="l01389"></a><span class="lineno"> 1389</span>&#160;         protocols) &lt; 0) {</div><div class="line"><a name="l01390"></a><span class="lineno"> 1390</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Failed to send handshake.\n&quot;</span>);</div><div class="line"><a name="l01391"></a><span class="lineno"> 1391</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../d0/d0c/http__websocket_8h.html#a6341c1b69564f8a3342229c5102b0fe2a7c1cd324885cef33b4cf2453e636f0ce">WS_WRITE_ERROR</a>;</div><div class="line"><a name="l01392"></a><span class="lineno"> 1392</span>&#160;   }</div><div class="line"><a name="l01393"></a><span class="lineno"> 1393</span>&#160;   <span class="comment">/* wait for a response before doing anything else */</span></div><div class="line"><a name="l01394"></a><span class="lineno"> 1394</span>&#160;   <span class="keywordflow">return</span> <a class="code" href="../../de/d4c/res__http__websocket_8c.html#a29cbcfc66f08592db881eb452904aa39">websocket_client_handshake_get_response</a>(client);</div><div class="line"><a name="l01395"></a><span class="lineno"> 1395</span>&#160;}</div><div class="ttc" id="res__http__websocket_8c_html_a29cbcfc66f08592db881eb452904aa39"><div class="ttname"><a href="../../de/d4c/res__http__websocket_8c.html#a29cbcfc66f08592db881eb452904aa39">websocket_client_handshake_get_response</a></div><div class="ttdeci">static enum ast_websocket_result websocket_client_handshake_get_response(struct websocket_client *client)</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d4c/res__http__websocket_8c_source.html#l01300">res_http_websocket.c:1300</a></div></div>
<div class="ttc" id="structwebsocket__client_html_a1c2046dcb30a629d6d9f45ff8f403f12"><div class="ttname"><a href="../../d7/de7/structwebsocket__client.html#a1c2046dcb30a629d6d9f45ff8f403f12">websocket_client::host</a></div><div class="ttdeci">char * host</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d4c/res__http__websocket_8c_source.html#l01193">res_http_websocket.c:1193</a></div></div>
<div class="ttc" id="structwebsocket__client_html_ab65df483a962559e090b6c1c4c46f8f5"><div class="ttname"><a href="../../d7/de7/structwebsocket__client.html#ab65df483a962559e090b6c1c4c46f8f5">websocket_client::ser</a></div><div class="ttdeci">struct ast_tcptls_session_instance * ser</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d4c/res__http__websocket_8c_source.html#l01207">res_http_websocket.c:1207</a></div></div>
<div class="ttc" id="strings_8h_html_a1ef7e2644ca7258070db316fdc0a465b"><div class="ttname"><a href="../../d6/d90/strings_8h.html#a1ef7e2644ca7258070db316fdc0a465b">ast_str_buffer</a></div><div class="ttdeci">char * ast_str_buffer(const struct ast_str *buf)</div><div class="ttdoc">Returns the string buffer within the ast_str buf. </div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d90/strings_8h_source.html#l00714">strings.h:714</a></div></div>
<div class="ttc" id="http__websocket_8h_html_a6341c1b69564f8a3342229c5102b0fe2a7c1cd324885cef33b4cf2453e636f0ce"><div class="ttname"><a href="../../d0/d0c/http__websocket_8h.html#a6341c1b69564f8a3342229c5102b0fe2a7c1cd324885cef33b4cf2453e636f0ce">WS_WRITE_ERROR</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d0c/http__websocket_8h_source.html#l00409">http_websocket.h:409</a></div></div>
<div class="ttc" id="structwebsocket__client_html_aad880fc4455c253781e8968f2239d56f"><div class="ttname"><a href="../../d7/de7/structwebsocket__client.html#aad880fc4455c253781e8968f2239d56f">websocket_client::version</a></div><div class="ttdeci">int version</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d4c/res__http__websocket_8c_source.html#l01203">res_http_websocket.c:1203</a></div></div>
<div class="ttc" id="structwebsocket__client_html_aea139a94a520535ed521664a882c539a"><div class="ttname"><a href="../../d7/de7/structwebsocket__client.html#aea139a94a520535ed521664a882c539a">websocket_client::resource_name</a></div><div class="ttdeci">struct ast_str * resource_name</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d4c/res__http__websocket_8c_source.html#l01195">res_http_websocket.c:1195</a></div></div>
<div class="ttc" id="strings_8h_html_a372554b7a2d69a8bd3adac5157672036"><div class="ttname"><a href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a></div><div class="ttdeci">#define ast_strlen_zero(foo)</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d90/strings_8h_source.html#l00052">strings.h:52</a></div></div>
<div class="ttc" id="astobj2_8c_html_a96a00b3a518d7f32b6d51dc28f09bf9b"><div class="ttname"><a href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a></div><div class="ttdeci">#define ast_log</div><div class="ttdef"><b>Definition:</b> <a href="../../da/df7/astobj2_8c_source.html#l00042">astobj2.c:42</a></div></div>
<div class="ttc" id="structwebsocket__client_html_a5892a9181e6a332f84d27aecd41dcd12"><div class="ttname"><a href="../../d7/de7/structwebsocket__client.html#a5892a9181e6a332f84d27aecd41dcd12">websocket_client::key</a></div><div class="ttdeci">char * key</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d4c/res__http__websocket_8c_source.html#l01197">res_http_websocket.c:1197</a></div></div>
<div class="ttc" id="iostream_8h_html_a23c05430f4b03eb5c72e1531f0716499"><div class="ttname"><a href="../../dd/d27/iostream_8h.html#a23c05430f4b03eb5c72e1531f0716499">ast_iostream_printf</a></div><div class="ttdeci">ssize_t ast_iostream_printf(struct ast_iostream *stream, const char *format,...)</div><div class="ttdoc">Write a formatted string to an iostream. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/dc8/iostream_8c_source.html#l00491">iostream.c:491</a></div></div>
<div class="ttc" id="logger_8h_html_aced66975c154ea0e2a8ec3bc818b4e08"><div class="ttname"><a href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a></div><div class="ttdeci">#define LOG_ERROR</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d8c/logger_8h_source.html#l00285">logger.h:285</a></div></div>
<div class="ttc" id="structast__tcptls__session__instance_html_a36ac2dd734607a43ed90acb7e9d81ac5"><div class="ttname"><a href="../../d6/d49/structast__tcptls__session__instance.html#a36ac2dd734607a43ed90acb7e9d81ac5">ast_tcptls_session_instance::stream</a></div><div class="ttdeci">struct ast_iostream * stream</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/ddf/tcptls_8h_source.html#l00160">tcptls.h:160</a></div></div>
<div class="ttc" id="structwebsocket__client_html_ae7799d7e9c180765a889a0a40b7ce4f9"><div class="ttname"><a href="../../d7/de7/structwebsocket__client.html#ae7799d7e9c180765a889a0a40b7ce4f9">websocket_client::protocols</a></div><div class="ttdeci">char * protocols</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d4c/res__http__websocket_8c_source.html#l01199">res_http_websocket.c:1199</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a29cbcfc66f08592db881eb452904aa39"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a29cbcfc66f08592db881eb452904aa39">&#9670;&nbsp;</a></span>websocket_client_handshake_get_response()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static enum <a class="el" href="../../d0/d0c/http__websocket_8h.html#a6341c1b69564f8a3342229c5102b0fe2">ast_websocket_result</a> websocket_client_handshake_get_response </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="../../d7/de7/structwebsocket__client.html">websocket_client</a> *&#160;</td>
          <td class="paramname"><em>client</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html#l01300">1300</a> of file <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html">res_http_websocket.c</a>.</p>

<p class="reference">References <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html#l01201">websocket_client::accept_protocol</a>, <a class="el" href="../../dd/d43/http_8c_source.html#l01710">ast_http_header_match()</a>, <a class="el" href="../../dd/d43/http_8c_source.html#l01726">ast_http_header_match_in()</a>, <a class="el" href="../../dd/d43/http_8c_source.html#l01688">ast_http_header_parse()</a>, <a class="el" href="../../dd/d43/http_8c_source.html#l01636">ast_http_response_status_line()</a>, <a class="el" href="../../d1/dc8/iostream_8c_source.html#l00300">ast_iostream_gets()</a>, <a class="el" href="../../da/df7/astobj2_8c_source.html#l00042">ast_log</a>, <a class="el" href="../../d8/d8a/astmm_8h_source.html#l00243">ast_strdup</a>, <a class="el" href="../../de/d1f/main_2utils_8c_source.html#l00078">base64</a>, <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html#l00103">ast_websocket::buf</a>, <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html#l01197">websocket_client::key</a>, <a class="el" href="../../d1/d8c/logger_8h_source.html#l00285">LOG_ERROR</a>, <a class="el" href="../../d0/d29/cdr__mysql_8c_source.html#l00074">name</a>, <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html#l01199">websocket_client::protocols</a>, <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html#l01207">websocket_client::ser</a>, <a class="el" href="../../d4/ddf/tcptls_8h_source.html#l00160">ast_tcptls_session_instance::stream</a>, <a class="el" href="../../d4/d2f/syslog_8c_source.html#l00037">value</a>, <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html#l01275">websocket_client_handle_response_code()</a>, <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html#l00764">websocket_combine_key()</a>, <a class="el" href="../../d0/d0c/http__websocket_8h_source.html#l00402">WS_BAD_STATUS</a>, <a class="el" href="../../d0/d0c/http__websocket_8h_source.html#l00406">WS_HEADER_MISMATCH</a>, <a class="el" href="../../d0/d0c/http__websocket_8h_source.html#l00407">WS_HEADER_MISSING</a>, <a class="el" href="../../d0/d0c/http__websocket_8h_source.html#l00408">WS_NOT_SUPPORTED</a>, and <a class="el" href="../../d0/d0c/http__websocket_8h_source.html#l00397">WS_OK</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html#l01367">websocket_client_handshake()</a>.</p>
<div class="fragment"><div class="line"><a name="l01302"></a><span class="lineno"> 1302</span>&#160;{</div><div class="line"><a name="l01303"></a><span class="lineno"> 1303</span>&#160;   <span class="keyword">enum</span> <a class="code" href="../../d0/d0c/http__websocket_8h.html#a6341c1b69564f8a3342229c5102b0fe2">ast_websocket_result</a> res;</div><div class="line"><a name="l01304"></a><span class="lineno"> 1304</span>&#160;   <span class="keywordtype">char</span> <a class="code" href="../../dd/d7c/eagi__proxy_8c.html#ac95651d79c608a3148973b5b1fc9e525">buf</a>[4096];</div><div class="line"><a name="l01305"></a><span class="lineno"> 1305</span>&#160;   <span class="keywordtype">char</span> <a class="code" href="../../de/d1f/main_2utils_8c.html#a094cd85754f67592588ab5a0636cf0ea">base64</a>[64];</div><div class="line"><a name="l01306"></a><span class="lineno"> 1306</span>&#160;   <span class="keywordtype">int</span> has_upgrade = 0;</div><div class="line"><a name="l01307"></a><span class="lineno"> 1307</span>&#160;   <span class="keywordtype">int</span> has_connection = 0;</div><div class="line"><a name="l01308"></a><span class="lineno"> 1308</span>&#160;   <span class="keywordtype">int</span> has_accept = 0;</div><div class="line"><a name="l01309"></a><span class="lineno"> 1309</span>&#160;   <span class="keywordtype">int</span> has_protocol = 0;</div><div class="line"><a name="l01310"></a><span class="lineno"> 1310</span>&#160;</div><div class="line"><a name="l01311"></a><span class="lineno"> 1311</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../dd/d27/iostream_8h.html#a2837e9ce1fee3102081db853e207fd2c">ast_iostream_gets</a>(client-&gt;<a class="code" href="../../d7/de7/structwebsocket__client.html#ab65df483a962559e090b6c1c4c46f8f5">ser</a>-&gt;<a class="code" href="../../d6/d49/structast__tcptls__session__instance.html#a36ac2dd734607a43ed90acb7e9d81ac5">stream</a>, buf, <span class="keyword">sizeof</span>(buf)) &lt;= 0) {</div><div class="line"><a name="l01312"></a><span class="lineno"> 1312</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Unable to retrieve HTTP status line.&quot;</span>);</div><div class="line"><a name="l01313"></a><span class="lineno"> 1313</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../d0/d0c/http__websocket_8h.html#a6341c1b69564f8a3342229c5102b0fe2aaff20c94a3a6d7f5260b23cb6c233a94">WS_BAD_STATUS</a>;</div><div class="line"><a name="l01314"></a><span class="lineno"> 1314</span>&#160;   }</div><div class="line"><a name="l01315"></a><span class="lineno"> 1315</span>&#160;</div><div class="line"><a name="l01316"></a><span class="lineno"> 1316</span>&#160;   <span class="keywordflow">if</span> ((res = <a class="code" href="../../de/d4c/res__http__websocket_8c.html#a0f1a25206f6099821e1e196107dbfa1d">websocket_client_handle_response_code</a>(client,</div><div class="line"><a name="l01317"></a><span class="lineno"> 1317</span>&#160;          <a class="code" href="../../dd/d56/http_8h.html#aaa042c9c6e2344db5e8a8d97683424b3">ast_http_response_status_line</a>(</div><div class="line"><a name="l01318"></a><span class="lineno"> 1318</span>&#160;             buf, <span class="stringliteral">&quot;HTTP/1.1&quot;</span>, 101))) != <a class="code" href="../../d0/d0c/http__websocket_8h.html#a6341c1b69564f8a3342229c5102b0fe2a8d6c24a81bab48a188c7f458bf6ecddb">WS_OK</a>) {</div><div class="line"><a name="l01319"></a><span class="lineno"> 1319</span>&#160;      <span class="keywordflow">return</span> res;</div><div class="line"><a name="l01320"></a><span class="lineno"> 1320</span>&#160;   }</div><div class="line"><a name="l01321"></a><span class="lineno"> 1321</span>&#160;</div><div class="line"><a name="l01322"></a><span class="lineno"> 1322</span>&#160;   <span class="comment">/* Ignoring line folding - assuming header field values are contained</span></div><div class="line"><a name="l01323"></a><span class="lineno"> 1323</span>&#160;<span class="comment">      within a single line */</span></div><div class="line"><a name="l01324"></a><span class="lineno"> 1324</span>&#160;   <span class="keywordflow">while</span> (<a class="code" href="../../dd/d27/iostream_8h.html#a2837e9ce1fee3102081db853e207fd2c">ast_iostream_gets</a>(client-&gt;<a class="code" href="../../d7/de7/structwebsocket__client.html#ab65df483a962559e090b6c1c4c46f8f5">ser</a>-&gt;<a class="code" href="../../d6/d49/structast__tcptls__session__instance.html#a36ac2dd734607a43ed90acb7e9d81ac5">stream</a>, buf, <span class="keyword">sizeof</span>(buf)) &gt; 0) {</div><div class="line"><a name="l01325"></a><span class="lineno"> 1325</span>&#160;      <span class="keywordtype">char</span> *<a class="code" href="../../d0/d29/cdr__mysql_8c.html#a0980a105ccb863d8008eb6201a51da52">name</a>, *<a class="code" href="../../d4/d2f/syslog_8c.html#ac4f474c82e82cbb89ca7c36dd52be0ed">value</a>;</div><div class="line"><a name="l01326"></a><span class="lineno"> 1326</span>&#160;      <span class="keywordtype">int</span> parsed = <a class="code" href="../../dd/d56/http_8h.html#a1b1e02f7f0b46b21d8b3750d40aff87b">ast_http_header_parse</a>(buf, &amp;name, &amp;value);</div><div class="line"><a name="l01327"></a><span class="lineno"> 1327</span>&#160;</div><div class="line"><a name="l01328"></a><span class="lineno"> 1328</span>&#160;      <span class="keywordflow">if</span> (parsed &lt; 0) {</div><div class="line"><a name="l01329"></a><span class="lineno"> 1329</span>&#160;         <span class="keywordflow">break</span>;</div><div class="line"><a name="l01330"></a><span class="lineno"> 1330</span>&#160;      }</div><div class="line"><a name="l01331"></a><span class="lineno"> 1331</span>&#160;</div><div class="line"><a name="l01332"></a><span class="lineno"> 1332</span>&#160;      <span class="keywordflow">if</span> (parsed &gt; 0) {</div><div class="line"><a name="l01333"></a><span class="lineno"> 1333</span>&#160;         <span class="keywordflow">continue</span>;</div><div class="line"><a name="l01334"></a><span class="lineno"> 1334</span>&#160;      }</div><div class="line"><a name="l01335"></a><span class="lineno"> 1335</span>&#160;</div><div class="line"><a name="l01336"></a><span class="lineno"> 1336</span>&#160;      <span class="keywordflow">if</span> (!has_upgrade &amp;&amp;</div><div class="line"><a name="l01337"></a><span class="lineno"> 1337</span>&#160;          (has_upgrade = <a class="code" href="../../dd/d56/http_8h.html#a927d764492a7c0d2341ebb35994d9e81">ast_http_header_match</a>(</div><div class="line"><a name="l01338"></a><span class="lineno"> 1338</span>&#160;             name, <span class="stringliteral">&quot;upgrade&quot;</span>, value, <span class="stringliteral">&quot;websocket&quot;</span>)) &lt; 0) {</div><div class="line"><a name="l01339"></a><span class="lineno"> 1339</span>&#160;         <span class="keywordflow">return</span> <a class="code" href="../../d0/d0c/http__websocket_8h.html#a6341c1b69564f8a3342229c5102b0fe2a77bc530944d3ca01e863558180aa6efe">WS_HEADER_MISMATCH</a>;</div><div class="line"><a name="l01340"></a><span class="lineno"> 1340</span>&#160;      } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!has_connection &amp;&amp;</div><div class="line"><a name="l01341"></a><span class="lineno"> 1341</span>&#160;            (has_connection = <a class="code" href="../../dd/d56/http_8h.html#a927d764492a7c0d2341ebb35994d9e81">ast_http_header_match</a>(</div><div class="line"><a name="l01342"></a><span class="lineno"> 1342</span>&#160;               name, <span class="stringliteral">&quot;connection&quot;</span>, value, <span class="stringliteral">&quot;upgrade&quot;</span>)) &lt; 0) {</div><div class="line"><a name="l01343"></a><span class="lineno"> 1343</span>&#160;         <span class="keywordflow">return</span> <a class="code" href="../../d0/d0c/http__websocket_8h.html#a6341c1b69564f8a3342229c5102b0fe2a77bc530944d3ca01e863558180aa6efe">WS_HEADER_MISMATCH</a>;</div><div class="line"><a name="l01344"></a><span class="lineno"> 1344</span>&#160;      } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!has_accept &amp;&amp;</div><div class="line"><a name="l01345"></a><span class="lineno"> 1345</span>&#160;            (has_accept = <a class="code" href="../../dd/d56/http_8h.html#a927d764492a7c0d2341ebb35994d9e81">ast_http_header_match</a>(</div><div class="line"><a name="l01346"></a><span class="lineno"> 1346</span>&#160;               name, <span class="stringliteral">&quot;sec-websocket-accept&quot;</span>, value,</div><div class="line"><a name="l01347"></a><span class="lineno"> 1347</span>&#160;             <a class="code" href="../../de/d4c/res__http__websocket_8c.html#ac4661ddf40219eddd566cbdedee3ad37">websocket_combine_key</a>(</div><div class="line"><a name="l01348"></a><span class="lineno"> 1348</span>&#160;                client-&gt;<a class="code" href="../../d7/de7/structwebsocket__client.html#a5892a9181e6a332f84d27aecd41dcd12">key</a>, base64, <span class="keyword">sizeof</span>(base64)))) &lt; 0) {</div><div class="line"><a name="l01349"></a><span class="lineno"> 1349</span>&#160;         <span class="keywordflow">return</span> <a class="code" href="../../d0/d0c/http__websocket_8h.html#a6341c1b69564f8a3342229c5102b0fe2a77bc530944d3ca01e863558180aa6efe">WS_HEADER_MISMATCH</a>;</div><div class="line"><a name="l01350"></a><span class="lineno"> 1350</span>&#160;      } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!has_protocol &amp;&amp;</div><div class="line"><a name="l01351"></a><span class="lineno"> 1351</span>&#160;            (has_protocol = <a class="code" href="../../dd/d56/http_8h.html#a20dc0ed36f151f2cfd588ee64b737011">ast_http_header_match_in</a>(</div><div class="line"><a name="l01352"></a><span class="lineno"> 1352</span>&#160;               name, <span class="stringliteral">&quot;sec-websocket-protocol&quot;</span>, value, client-&gt;<a class="code" href="../../d7/de7/structwebsocket__client.html#ae7799d7e9c180765a889a0a40b7ce4f9">protocols</a>))) {</div><div class="line"><a name="l01353"></a><span class="lineno"> 1353</span>&#160;         <span class="keywordflow">if</span> (has_protocol &lt; 0) {</div><div class="line"><a name="l01354"></a><span class="lineno"> 1354</span>&#160;            <span class="keywordflow">return</span> <a class="code" href="../../d0/d0c/http__websocket_8h.html#a6341c1b69564f8a3342229c5102b0fe2a77bc530944d3ca01e863558180aa6efe">WS_HEADER_MISMATCH</a>;</div><div class="line"><a name="l01355"></a><span class="lineno"> 1355</span>&#160;         }</div><div class="line"><a name="l01356"></a><span class="lineno"> 1356</span>&#160;         client-&gt;<a class="code" href="../../d7/de7/structwebsocket__client.html#adae107229ce11e8bdf499a2bb06a4f62">accept_protocol</a> = <a class="code" href="../../d8/d8a/astmm_8h.html#ab263849d03fb892847be4986db759737">ast_strdup</a>(value);</div><div class="line"><a name="l01357"></a><span class="lineno"> 1357</span>&#160;      } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(name, <span class="stringliteral">&quot;sec-websocket-extensions&quot;</span>)) {</div><div class="line"><a name="l01358"></a><span class="lineno"> 1358</span>&#160;         <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Extensions received, but not &quot;</span></div><div class="line"><a name="l01359"></a><span class="lineno"> 1359</span>&#160;            <span class="stringliteral">&quot;supported by client\n&quot;</span>);</div><div class="line"><a name="l01360"></a><span class="lineno"> 1360</span>&#160;         <span class="keywordflow">return</span> <a class="code" href="../../d0/d0c/http__websocket_8h.html#a6341c1b69564f8a3342229c5102b0fe2a60300aacd85bb3685fd17b57be9b254d">WS_NOT_SUPPORTED</a>;</div><div class="line"><a name="l01361"></a><span class="lineno"> 1361</span>&#160;      }</div><div class="line"><a name="l01362"></a><span class="lineno"> 1362</span>&#160;   }</div><div class="line"><a name="l01363"></a><span class="lineno"> 1363</span>&#160;   <span class="keywordflow">return</span> has_upgrade &amp;&amp; has_connection &amp;&amp; has_accept ?</div><div class="line"><a name="l01364"></a><span class="lineno"> 1364</span>&#160;      <a class="code" href="../../d0/d0c/http__websocket_8h.html#a6341c1b69564f8a3342229c5102b0fe2a8d6c24a81bab48a188c7f458bf6ecddb">WS_OK</a> : <a class="code" href="../../d0/d0c/http__websocket_8h.html#a6341c1b69564f8a3342229c5102b0fe2af2363e73ec5cbb2553417a5136dbebc3">WS_HEADER_MISSING</a>;</div><div class="line"><a name="l01365"></a><span class="lineno"> 1365</span>&#160;}</div><div class="ttc" id="http__websocket_8h_html_a6341c1b69564f8a3342229c5102b0fe2a60300aacd85bb3685fd17b57be9b254d"><div class="ttname"><a href="../../d0/d0c/http__websocket_8h.html#a6341c1b69564f8a3342229c5102b0fe2a60300aacd85bb3685fd17b57be9b254d">WS_NOT_SUPPORTED</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d0c/http__websocket_8h_source.html#l00408">http_websocket.h:408</a></div></div>
<div class="ttc" id="structwebsocket__client_html_adae107229ce11e8bdf499a2bb06a4f62"><div class="ttname"><a href="../../d7/de7/structwebsocket__client.html#adae107229ce11e8bdf499a2bb06a4f62">websocket_client::accept_protocol</a></div><div class="ttdeci">char * accept_protocol</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d4c/res__http__websocket_8c_source.html#l01201">res_http_websocket.c:1201</a></div></div>
<div class="ttc" id="http__websocket_8h_html_a6341c1b69564f8a3342229c5102b0fe2"><div class="ttname"><a href="../../d0/d0c/http__websocket_8h.html#a6341c1b69564f8a3342229c5102b0fe2">ast_websocket_result</a></div><div class="ttdeci">ast_websocket_result</div><div class="ttdoc">Result code for a websocket client. </div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d0c/http__websocket_8h_source.html#l00396">http_websocket.h:396</a></div></div>
<div class="ttc" id="eagi__proxy_8c_html_ac95651d79c608a3148973b5b1fc9e525"><div class="ttname"><a href="../../dd/d7c/eagi__proxy_8c.html#ac95651d79c608a3148973b5b1fc9e525">buf</a></div><div class="ttdeci">char buf[BUFSIZE]</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d7c/eagi__proxy_8c_source.html#l00066">eagi_proxy.c:66</a></div></div>
<div class="ttc" id="structwebsocket__client_html_ab65df483a962559e090b6c1c4c46f8f5"><div class="ttname"><a href="../../d7/de7/structwebsocket__client.html#ab65df483a962559e090b6c1c4c46f8f5">websocket_client::ser</a></div><div class="ttdeci">struct ast_tcptls_session_instance * ser</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d4c/res__http__websocket_8c_source.html#l01207">res_http_websocket.c:1207</a></div></div>
<div class="ttc" id="http__websocket_8h_html_a6341c1b69564f8a3342229c5102b0fe2aaff20c94a3a6d7f5260b23cb6c233a94"><div class="ttname"><a href="../../d0/d0c/http__websocket_8h.html#a6341c1b69564f8a3342229c5102b0fe2aaff20c94a3a6d7f5260b23cb6c233a94">WS_BAD_STATUS</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d0c/http__websocket_8h_source.html#l00402">http_websocket.h:402</a></div></div>
<div class="ttc" id="http__websocket_8h_html_a6341c1b69564f8a3342229c5102b0fe2af2363e73ec5cbb2553417a5136dbebc3"><div class="ttname"><a href="../../d0/d0c/http__websocket_8h.html#a6341c1b69564f8a3342229c5102b0fe2af2363e73ec5cbb2553417a5136dbebc3">WS_HEADER_MISSING</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d0c/http__websocket_8h_source.html#l00407">http_websocket.h:407</a></div></div>
<div class="ttc" id="astmm_8h_html_ab263849d03fb892847be4986db759737"><div class="ttname"><a href="../../d8/d8a/astmm_8h.html#ab263849d03fb892847be4986db759737">ast_strdup</a></div><div class="ttdeci">#define ast_strdup(str)</div><div class="ttdoc">A wrapper for strdup() </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d8a/astmm_8h_source.html#l00243">astmm.h:243</a></div></div>
<div class="ttc" id="syslog_8c_html_ac4f474c82e82cbb89ca7c36dd52be0ed"><div class="ttname"><a href="../../d4/d2f/syslog_8c.html#ac4f474c82e82cbb89ca7c36dd52be0ed">value</a></div><div class="ttdeci">int value</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d2f/syslog_8c_source.html#l00037">syslog.c:37</a></div></div>
<div class="ttc" id="http__websocket_8h_html_a6341c1b69564f8a3342229c5102b0fe2a77bc530944d3ca01e863558180aa6efe"><div class="ttname"><a href="../../d0/d0c/http__websocket_8h.html#a6341c1b69564f8a3342229c5102b0fe2a77bc530944d3ca01e863558180aa6efe">WS_HEADER_MISMATCH</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d0c/http__websocket_8h_source.html#l00406">http_websocket.h:406</a></div></div>
<div class="ttc" id="astobj2_8c_html_a96a00b3a518d7f32b6d51dc28f09bf9b"><div class="ttname"><a href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a></div><div class="ttdeci">#define ast_log</div><div class="ttdef"><b>Definition:</b> <a href="../../da/df7/astobj2_8c_source.html#l00042">astobj2.c:42</a></div></div>
<div class="ttc" id="structwebsocket__client_html_a5892a9181e6a332f84d27aecd41dcd12"><div class="ttname"><a href="../../d7/de7/structwebsocket__client.html#a5892a9181e6a332f84d27aecd41dcd12">websocket_client::key</a></div><div class="ttdeci">char * key</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d4c/res__http__websocket_8c_source.html#l01197">res_http_websocket.c:1197</a></div></div>
<div class="ttc" id="http_8h_html_a1b1e02f7f0b46b21d8b3750d40aff87b"><div class="ttname"><a href="../../dd/d56/http_8h.html#a1b1e02f7f0b46b21d8b3750d40aff87b">ast_http_header_parse</a></div><div class="ttdeci">int ast_http_header_parse(char *buf, char **name, char **value)</div><div class="ttdoc">Parse a header into the given name/value strings. </div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d43/http_8c_source.html#l01688">http.c:1688</a></div></div>
<div class="ttc" id="http_8h_html_a20dc0ed36f151f2cfd588ee64b737011"><div class="ttname"><a href="../../dd/d56/http_8h.html#a20dc0ed36f151f2cfd588ee64b737011">ast_http_header_match_in</a></div><div class="ttdeci">int ast_http_header_match_in(const char *name, const char *expected_name, const char *value, const char *expected_value)</div><div class="ttdoc">Check if the header name matches the expected header name. If so, then check to see if the value can ...</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d43/http_8c_source.html#l01726">http.c:1726</a></div></div>
<div class="ttc" id="logger_8h_html_aced66975c154ea0e2a8ec3bc818b4e08"><div class="ttname"><a href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a></div><div class="ttdeci">#define LOG_ERROR</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d8c/logger_8h_source.html#l00285">logger.h:285</a></div></div>
<div class="ttc" id="http_8h_html_a927d764492a7c0d2341ebb35994d9e81"><div class="ttname"><a href="../../dd/d56/http_8h.html#a927d764492a7c0d2341ebb35994d9e81">ast_http_header_match</a></div><div class="ttdeci">int ast_http_header_match(const char *name, const char *expected_name, const char *value, const char *expected_value)</div><div class="ttdoc">Check if the header and value match (case insensitive) their associated expected values. </div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d43/http_8c_source.html#l01710">http.c:1710</a></div></div>
<div class="ttc" id="cdr__mysql_8c_html_a0980a105ccb863d8008eb6201a51da52"><div class="ttname"><a href="../../d0/d29/cdr__mysql_8c.html#a0980a105ccb863d8008eb6201a51da52">name</a></div><div class="ttdeci">static const char name[]</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d29/cdr__mysql_8c_source.html#l00074">cdr_mysql.c:74</a></div></div>
<div class="ttc" id="res__http__websocket_8c_html_a0f1a25206f6099821e1e196107dbfa1d"><div class="ttname"><a href="../../de/d4c/res__http__websocket_8c.html#a0f1a25206f6099821e1e196107dbfa1d">websocket_client_handle_response_code</a></div><div class="ttdeci">static enum ast_websocket_result websocket_client_handle_response_code(struct websocket_client *client, int response_code)</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d4c/res__http__websocket_8c_source.html#l01275">res_http_websocket.c:1275</a></div></div>
<div class="ttc" id="structast__tcptls__session__instance_html_a36ac2dd734607a43ed90acb7e9d81ac5"><div class="ttname"><a href="../../d6/d49/structast__tcptls__session__instance.html#a36ac2dd734607a43ed90acb7e9d81ac5">ast_tcptls_session_instance::stream</a></div><div class="ttdeci">struct ast_iostream * stream</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/ddf/tcptls_8h_source.html#l00160">tcptls.h:160</a></div></div>
<div class="ttc" id="iostream_8h_html_a2837e9ce1fee3102081db853e207fd2c"><div class="ttname"><a href="../../dd/d27/iostream_8h.html#a2837e9ce1fee3102081db853e207fd2c">ast_iostream_gets</a></div><div class="ttdeci">ssize_t ast_iostream_gets(struct ast_iostream *stream, char *buffer, size_t size)</div><div class="ttdoc">Read a LF-terminated string from an iostream. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/dc8/iostream_8c_source.html#l00300">iostream.c:300</a></div></div>
<div class="ttc" id="structwebsocket__client_html_ae7799d7e9c180765a889a0a40b7ce4f9"><div class="ttname"><a href="../../d7/de7/structwebsocket__client.html#ae7799d7e9c180765a889a0a40b7ce4f9">websocket_client::protocols</a></div><div class="ttdeci">char * protocols</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d4c/res__http__websocket_8c_source.html#l01199">res_http_websocket.c:1199</a></div></div>
<div class="ttc" id="http__websocket_8h_html_a6341c1b69564f8a3342229c5102b0fe2a8d6c24a81bab48a188c7f458bf6ecddb"><div class="ttname"><a href="../../d0/d0c/http__websocket_8h.html#a6341c1b69564f8a3342229c5102b0fe2a8d6c24a81bab48a188c7f458bf6ecddb">WS_OK</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d0c/http__websocket_8h_source.html#l00397">http_websocket.h:397</a></div></div>
<div class="ttc" id="res__http__websocket_8c_html_ac4661ddf40219eddd566cbdedee3ad37"><div class="ttname"><a href="../../de/d4c/res__http__websocket_8c.html#ac4661ddf40219eddd566cbdedee3ad37">websocket_combine_key</a></div><div class="ttdeci">static char * websocket_combine_key(const char *key, char *res, int res_size)</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d4c/res__http__websocket_8c_source.html#l00764">res_http_websocket.c:764</a></div></div>
<div class="ttc" id="http_8h_html_aaa042c9c6e2344db5e8a8d97683424b3"><div class="ttname"><a href="../../dd/d56/http_8h.html#aaa042c9c6e2344db5e8a8d97683424b3">ast_http_response_status_line</a></div><div class="ttdeci">int ast_http_response_status_line(const char *buf, const char *version, int code)</div><div class="ttdoc">Parse the http response status line. </div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d43/http_8c_source.html#l01636">http.c:1636</a></div></div>
<div class="ttc" id="main_2utils_8c_html_a094cd85754f67592588ab5a0636cf0ea"><div class="ttname"><a href="../../de/d1f/main_2utils_8c.html#a094cd85754f67592588ab5a0636cf0ea">base64</a></div><div class="ttdeci">static char base64[64]</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d1f/main_2utils_8c_source.html#l00078">main/utils.c:78</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="aa29713a06d3e2971c2ca2c213d177762"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa29713a06d3e2971c2ca2c213d177762">&#9670;&nbsp;</a></span>websocket_client_parse_uri()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int websocket_client_parse_uri </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>uri</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char **&#160;</td>
          <td class="paramname"><em>host</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="../../dd/da2/structast__str.html">ast_str</a> **&#160;</td>
          <td class="paramname"><em>path</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Parse the given uri into a path and remote address. </p>
<p>Expected uri form: [ws[s]]://&lt;host&gt;[:port][/&lt;path&gt;]</p>
<p>The returned host will contain the address and optional port while path will contain everything after the address/port if included. </p>

<p class="definition">Definition at line <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html#l01093">1093</a> of file <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html">res_http_websocket.c</a>.</p>

<p class="reference">References <a class="el" href="../../d5/da5/astobj2_8h_source.html#l00464">ao2_ref</a>, <a class="el" href="../../d6/d90/strings_8h_source.html#l01091">ast_str_append()</a>, <a class="el" href="../../d6/d90/strings_8h_source.html#l00620">ast_str_create</a>, <a class="el" href="../../d6/d90/strings_8h_source.html#l01065">ast_str_set()</a>, <a class="el" href="../../d3/d13/uri_8c_source.html#l00300">ast_uri_make_host_with_port()</a>, <a class="el" href="../../d3/d13/uri_8c_source.html#l00295">ast_uri_parse_websocket()</a>, <a class="el" href="../../d3/d13/uri_8c_source.html#l00135">ast_uri_path()</a>, and <a class="el" href="../../d3/d13/uri_8c_source.html#l00140">ast_uri_query()</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html#l01224">websocket_client_create()</a>.</p>
<div class="fragment"><div class="line"><a name="l01094"></a><span class="lineno"> 1094</span>&#160;{</div><div class="line"><a name="l01095"></a><span class="lineno"> 1095</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d6/d84/structast__uri.html">ast_uri</a> *parsed_uri = <a class="code" href="../../df/d49/uri_8h.html#af3c91e36f7f6398df47634fdd5d3018b">ast_uri_parse_websocket</a>(<a class="code" href="../../d6/d84/structast__uri.html#a454beb28afaee578843f30f7ae765d28">uri</a>);</div><div class="line"><a name="l01096"></a><span class="lineno"> 1096</span>&#160;</div><div class="line"><a name="l01097"></a><span class="lineno"> 1097</span>&#160;   <span class="keywordflow">if</span> (!parsed_uri) {</div><div class="line"><a name="l01098"></a><span class="lineno"> 1098</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l01099"></a><span class="lineno"> 1099</span>&#160;   }</div><div class="line"><a name="l01100"></a><span class="lineno"> 1100</span>&#160;</div><div class="line"><a name="l01101"></a><span class="lineno"> 1101</span>&#160;   *<a class="code" href="../../d0/d8a/muted_8c.html#a41c3a180b50c6b2ddcc1b6843a48f205">host</a> = <a class="code" href="../../df/d49/uri_8h.html#a5bf570f8ab56d65adbe7c0206a7381b8">ast_uri_make_host_with_port</a>(parsed_uri);</div><div class="line"><a name="l01102"></a><span class="lineno"> 1102</span>&#160;</div><div class="line"><a name="l01103"></a><span class="lineno"> 1103</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../df/d49/uri_8h.html#a16ecb117da335d3f9a522f443514a405">ast_uri_path</a>(parsed_uri) || <a class="code" href="../../df/d49/uri_8h.html#a7ba202357f1b9392efe301b2293365d4">ast_uri_query</a>(parsed_uri)) {</div><div class="line"><a name="l01104"></a><span class="lineno"> 1104</span>&#160;      *path = <a class="code" href="../../d6/d90/strings_8h.html#a9c34c6c6b8daaba24c0406270f3cf697">ast_str_create</a>(64);</div><div class="line"><a name="l01105"></a><span class="lineno"> 1105</span>&#160;      <span class="keywordflow">if</span> (!*path) {</div><div class="line"><a name="l01106"></a><span class="lineno"> 1106</span>&#160;         <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(parsed_uri, -1);</div><div class="line"><a name="l01107"></a><span class="lineno"> 1107</span>&#160;         <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l01108"></a><span class="lineno"> 1108</span>&#160;      }</div><div class="line"><a name="l01109"></a><span class="lineno"> 1109</span>&#160;</div><div class="line"><a name="l01110"></a><span class="lineno"> 1110</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="../../df/d49/uri_8h.html#a16ecb117da335d3f9a522f443514a405">ast_uri_path</a>(parsed_uri)) {</div><div class="line"><a name="l01111"></a><span class="lineno"> 1111</span>&#160;         <a class="code" href="../../d6/d90/strings_8h.html#aa3341f35cedca29e60bb7f3927204283">ast_str_set</a>(path, 0, <span class="stringliteral">&quot;%s&quot;</span>, <a class="code" href="../../df/d49/uri_8h.html#a16ecb117da335d3f9a522f443514a405">ast_uri_path</a>(parsed_uri));</div><div class="line"><a name="l01112"></a><span class="lineno"> 1112</span>&#160;      }</div><div class="line"><a name="l01113"></a><span class="lineno"> 1113</span>&#160;</div><div class="line"><a name="l01114"></a><span class="lineno"> 1114</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="../../df/d49/uri_8h.html#a7ba202357f1b9392efe301b2293365d4">ast_uri_query</a>(parsed_uri)) {</div><div class="line"><a name="l01115"></a><span class="lineno"> 1115</span>&#160;         <a class="code" href="../../d6/d90/strings_8h.html#a1088afdd862a49b0fce34ebe02df8ca1">ast_str_append</a>(path, 0, <span class="stringliteral">&quot;?%s&quot;</span>, <a class="code" href="../../df/d49/uri_8h.html#a7ba202357f1b9392efe301b2293365d4">ast_uri_query</a>(parsed_uri));</div><div class="line"><a name="l01116"></a><span class="lineno"> 1116</span>&#160;      }</div><div class="line"><a name="l01117"></a><span class="lineno"> 1117</span>&#160;   }</div><div class="line"><a name="l01118"></a><span class="lineno"> 1118</span>&#160;</div><div class="line"><a name="l01119"></a><span class="lineno"> 1119</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(parsed_uri, -1);</div><div class="line"><a name="l01120"></a><span class="lineno"> 1120</span>&#160;   <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l01121"></a><span class="lineno"> 1121</span>&#160;}</div><div class="ttc" id="uri_8h_html_a16ecb117da335d3f9a522f443514a405"><div class="ttname"><a href="../../df/d49/uri_8h.html#a16ecb117da335d3f9a522f443514a405">ast_uri_path</a></div><div class="ttdeci">const char * ast_uri_path(const struct ast_uri *uri)</div><div class="ttdoc">Retrieve the uri path. </div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d13/uri_8c_source.html#l00135">uri.c:135</a></div></div>
<div class="ttc" id="structast__uri_html"><div class="ttname"><a href="../../d6/d84/structast__uri.html">ast_uri</a></div><div class="ttdoc">Stores parsed uri information. </div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d13/uri_8c_source.html#l00030">uri.c:30</a></div></div>
<div class="ttc" id="strings_8h_html_a1088afdd862a49b0fce34ebe02df8ca1"><div class="ttname"><a href="../../d6/d90/strings_8h.html#a1088afdd862a49b0fce34ebe02df8ca1">ast_str_append</a></div><div class="ttdeci">int ast_str_append(struct ast_str **buf, ssize_t max_len, const char *fmt,...)</div><div class="ttdoc">Append to a thread local dynamic string. </div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d90/strings_8h_source.html#l01091">strings.h:1091</a></div></div>
<div class="ttc" id="uri_8h_html_a7ba202357f1b9392efe301b2293365d4"><div class="ttname"><a href="../../df/d49/uri_8h.html#a7ba202357f1b9392efe301b2293365d4">ast_uri_query</a></div><div class="ttdeci">const char * ast_uri_query(const struct ast_uri *uri)</div><div class="ttdoc">Retrieve the uri query parameters. </div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d13/uri_8c_source.html#l00140">uri.c:140</a></div></div>
<div class="ttc" id="strings_8h_html_aa3341f35cedca29e60bb7f3927204283"><div class="ttname"><a href="../../d6/d90/strings_8h.html#aa3341f35cedca29e60bb7f3927204283">ast_str_set</a></div><div class="ttdeci">int ast_str_set(struct ast_str **buf, ssize_t max_len, const char *fmt,...)</div><div class="ttdoc">Set a dynamic string using variable arguments. </div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d90/strings_8h_source.html#l01065">strings.h:1065</a></div></div>
<div class="ttc" id="muted_8c_html_a41c3a180b50c6b2ddcc1b6843a48f205"><div class="ttname"><a href="../../d0/d8a/muted_8c.html#a41c3a180b50c6b2ddcc1b6843a48f205">host</a></div><div class="ttdeci">static char host[256]</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d8a/muted_8c_source.html#l00077">muted.c:77</a></div></div>
<div class="ttc" id="astobj2_8h_html_aaca5e8eac39a22f9da1c36fc6c922270"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a></div><div class="ttdeci">#define ao2_ref(o, delta)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l00464">astobj2.h:464</a></div></div>
<div class="ttc" id="uri_8h_html_a5bf570f8ab56d65adbe7c0206a7381b8"><div class="ttname"><a href="../../df/d49/uri_8h.html#a5bf570f8ab56d65adbe7c0206a7381b8">ast_uri_make_host_with_port</a></div><div class="ttdeci">char * ast_uri_make_host_with_port(const struct ast_uri *uri)</div><div class="ttdoc">Retrieve a string of the host and port. </div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d13/uri_8c_source.html#l00300">uri.c:300</a></div></div>
<div class="ttc" id="structast__uri_html_a454beb28afaee578843f30f7ae765d28"><div class="ttname"><a href="../../d6/d84/structast__uri.html#a454beb28afaee578843f30f7ae765d28">ast_uri::uri</a></div><div class="ttdeci">char uri[0]</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d13/uri_8c_source.html#l00044">uri.c:44</a></div></div>
<div class="ttc" id="uri_8h_html_af3c91e36f7f6398df47634fdd5d3018b"><div class="ttname"><a href="../../df/d49/uri_8h.html#af3c91e36f7f6398df47634fdd5d3018b">ast_uri_parse_websocket</a></div><div class="ttdeci">struct ast_uri * ast_uri_parse_websocket(const char *uri)</div><div class="ttdoc">Parse the given websocket uri into a structure. </div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d13/uri_8c_source.html#l00295">uri.c:295</a></div></div>
<div class="ttc" id="strings_8h_html_a9c34c6c6b8daaba24c0406270f3cf697"><div class="ttname"><a href="../../d6/d90/strings_8h.html#a9c34c6c6b8daaba24c0406270f3cf697">ast_str_create</a></div><div class="ttdeci">#define ast_str_create(init_len)</div><div class="ttdoc">Create a malloc&amp;#39;ed dynamic length string. </div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d90/strings_8h_source.html#l00620">strings.h:620</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="ac4661ddf40219eddd566cbdedee3ad37"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac4661ddf40219eddd566cbdedee3ad37">&#9670;&nbsp;</a></span>websocket_combine_key()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static char* websocket_combine_key </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>key</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>res</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>res_size</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html#l00764">764</a> of file <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html">res_http_websocket.c</a>.</p>

<p class="reference">References <a class="el" href="../../d8/d8a/astmm_8h_source.html#l00290">ast_alloca</a>, <a class="el" href="../../de/d1f/main_2utils_8c_source.html#l00404">ast_base64encode()</a>, <a class="el" href="../../de/d1f/main_2utils_8c_source.html#l00282">ast_sha1_hash_uint()</a>, and <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html#l00045">WEBSOCKET_GUID</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html#l00790">ast_websocket_uri_cb()</a>, and <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html#l01300">websocket_client_handshake_get_response()</a>.</p>
<div class="fragment"><div class="line"><a name="l00765"></a><span class="lineno">  765</span>&#160;{</div><div class="line"><a name="l00766"></a><span class="lineno">  766</span>&#160;   <span class="keywordtype">char</span> *combined;</div><div class="line"><a name="l00767"></a><span class="lineno">  767</span>&#160;   <span class="keywordtype">unsigned</span> combined_length = strlen(key) + strlen(<a class="code" href="../../de/d4c/res__http__websocket_8c.html#ad17237839833df7be4a5c256801fe51b">WEBSOCKET_GUID</a>) + 1;</div><div class="line"><a name="l00768"></a><span class="lineno">  768</span>&#160;   uint8_t sha[20];</div><div class="line"><a name="l00769"></a><span class="lineno">  769</span>&#160;</div><div class="line"><a name="l00770"></a><span class="lineno">  770</span>&#160;   combined = <a class="code" href="../../d8/d8a/astmm_8h.html#a249282ecc7ba5a1a49fa75e9a33d1717">ast_alloca</a>(combined_length);</div><div class="line"><a name="l00771"></a><span class="lineno">  771</span>&#160;   snprintf(combined, combined_length, <span class="stringliteral">&quot;%s%s&quot;</span>, key, <a class="code" href="../../de/d4c/res__http__websocket_8c.html#ad17237839833df7be4a5c256801fe51b">WEBSOCKET_GUID</a>);</div><div class="line"><a name="l00772"></a><span class="lineno">  772</span>&#160;   <a class="code" href="../../d5/d60/utils_8h.html#ac49517ab46be0ea328d21ac2e9b0da5f">ast_sha1_hash_uint</a>(sha, combined);</div><div class="line"><a name="l00773"></a><span class="lineno">  773</span>&#160;   <a class="code" href="../../d5/d60/utils_8h.html#a555dad1bd5b23acf01cf08f1affab879">ast_base64encode</a>(res, (<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>*)sha, 20, res_size);</div><div class="line"><a name="l00774"></a><span class="lineno">  774</span>&#160;   <span class="keywordflow">return</span> res;</div><div class="line"><a name="l00775"></a><span class="lineno">  775</span>&#160;}</div><div class="ttc" id="res__http__websocket_8c_html_ad17237839833df7be4a5c256801fe51b"><div class="ttname"><a href="../../de/d4c/res__http__websocket_8c.html#ad17237839833df7be4a5c256801fe51b">WEBSOCKET_GUID</a></div><div class="ttdeci">#define WEBSOCKET_GUID</div><div class="ttdoc">GUID used to compute the accept key, defined in the specifications. </div><div class="ttdef"><b>Definition:</b> <a href="../../de/d4c/res__http__websocket_8c_source.html#l00045">res_http_websocket.c:45</a></div></div>
<div class="ttc" id="utils_8h_html_ac49517ab46be0ea328d21ac2e9b0da5f"><div class="ttname"><a href="../../d5/d60/utils_8h.html#ac49517ab46be0ea328d21ac2e9b0da5f">ast_sha1_hash_uint</a></div><div class="ttdeci">void ast_sha1_hash_uint(uint8_t *digest, const char *input)</div><div class="ttdoc">Produces SHA1 hash based on input string, stored in uint8_t array. </div><div class="ttdef"><b>Definition:</b> <a href="../../de/d1f/main_2utils_8c_source.html#l00282">main/utils.c:282</a></div></div>
<div class="ttc" id="astmm_8h_html_a249282ecc7ba5a1a49fa75e9a33d1717"><div class="ttname"><a href="../../d8/d8a/astmm_8h.html#a249282ecc7ba5a1a49fa75e9a33d1717">ast_alloca</a></div><div class="ttdeci">#define ast_alloca(size)</div><div class="ttdoc">call __builtin_alloca to ensure we get gcc builtin semantics </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d8a/astmm_8h_source.html#l00290">astmm.h:290</a></div></div>
<div class="ttc" id="utils_8h_html_a555dad1bd5b23acf01cf08f1affab879"><div class="ttname"><a href="../../d5/d60/utils_8h.html#a555dad1bd5b23acf01cf08f1affab879">ast_base64encode</a></div><div class="ttdeci">int ast_base64encode(char *dst, const unsigned char *src, int srclen, int max)</div><div class="ttdoc">Encode data in base64. </div><div class="ttdef"><b>Definition:</b> <a href="../../de/d1f/main_2utils_8c_source.html#l00404">main/utils.c:404</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a16179dccdf130e1ec1d0ff701fb5fe5d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a16179dccdf130e1ec1d0ff701fb5fe5d">&#9670;&nbsp;</a></span>websocket_echo_callback()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void websocket_echo_callback </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="../../db/db6/structast__websocket.html">ast_websocket</a> *&#160;</td>
          <td class="paramname"><em>session</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="../../dd/d02/structast__variable.html">ast_variable</a> *&#160;</td>
          <td class="paramname"><em>parameters</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="../../dd/d02/structast__variable.html">ast_variable</a> *&#160;</td>
          <td class="paramname"><em>headers</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Simple echo implementation which echoes received text and binary frames. </p>

<p class="definition">Definition at line <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html#l01007">1007</a> of file <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html">res_http_websocket.c</a>.</p>

<p class="reference">References <a class="el" href="../../d1/d8c/logger_8h_source.html#l00452">ast_debug</a>, <a class="el" href="../../d5/d60/utils_8h_source.html#l01009">ast_fd_set_flags</a>, <a class="el" href="../../da/df7/astobj2_8c_source.html#l00042">ast_log</a>, <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html#l00461">ast_websocket_fd()</a>, <a class="el" href="../../d0/d0c/http__websocket_8h_source.html#l00052">AST_WEBSOCKET_OPCODE_BINARY</a>, <a class="el" href="../../d0/d0c/http__websocket_8h_source.html#l00055">AST_WEBSOCKET_OPCODE_CLOSE</a>, <a class="el" href="../../d0/d0c/http__websocket_8h_source.html#l00051">AST_WEBSOCKET_OPCODE_TEXT</a>, <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html#l00602">ast_websocket_read()</a>, <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html#l00456">ast_websocket_unref()</a>, <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html#l00466">ast_websocket_wait_for_input()</a>, <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html#l00374">ast_websocket_write()</a>, <a class="el" href="../../dd/d7c/eagi__proxy_8c_source.html#l00073">end</a>, <a class="el" href="../../d1/d8c/logger_8h_source.html#l00274">LOG_WARNING</a>, <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html#l00092">ast_websocket::opcode</a>, <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html#l00094">ast_websocket::payload</a>, and <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html#l00093">ast_websocket::payload_len</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html#l01501">load_module()</a>, and <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html#l01513">unload_module()</a>.</p>
<div class="fragment"><div class="line"><a name="l01008"></a><span class="lineno"> 1008</span>&#160;{</div><div class="line"><a name="l01009"></a><span class="lineno"> 1009</span>&#160;   <span class="keywordtype">int</span> res;</div><div class="line"><a name="l01010"></a><span class="lineno"> 1010</span>&#160;</div><div class="line"><a name="l01011"></a><span class="lineno"> 1011</span>&#160;   <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(1, <span class="stringliteral">&quot;Entering WebSocket echo loop\n&quot;</span>);</div><div class="line"><a name="l01012"></a><span class="lineno"> 1012</span>&#160;</div><div class="line"><a name="l01013"></a><span class="lineno"> 1013</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d5/d60/utils_8h.html#a85392708ff0d7ed6fb86ff83f0e714c3">ast_fd_set_flags</a>(<a class="code" href="../../de/d4c/res__http__websocket_8c.html#a874ca6ebfa7b35e92557cc97af1d41be">ast_websocket_fd</a>(session), O_NONBLOCK)) {</div><div class="line"><a name="l01014"></a><span class="lineno"> 1014</span>&#160;      <span class="keywordflow">goto</span> <a class="code" href="../../dd/d7c/eagi__proxy_8c.html#a8fd806ad19b8f5513a4cf18cbf77532c">end</a>;</div><div class="line"><a name="l01015"></a><span class="lineno"> 1015</span>&#160;   }</div><div class="line"><a name="l01016"></a><span class="lineno"> 1016</span>&#160;</div><div class="line"><a name="l01017"></a><span class="lineno"> 1017</span>&#160;   <span class="keywordflow">while</span> ((res = <a class="code" href="../../de/d4c/res__http__websocket_8c.html#a838ccd8bed44b43d4b95025bc3bea4c8">ast_websocket_wait_for_input</a>(session, -1)) &gt; 0) {</div><div class="line"><a name="l01018"></a><span class="lineno"> 1018</span>&#160;      <span class="keywordtype">char</span> *payload;</div><div class="line"><a name="l01019"></a><span class="lineno"> 1019</span>&#160;      uint64_t payload_len;</div><div class="line"><a name="l01020"></a><span class="lineno"> 1020</span>&#160;      <span class="keyword">enum</span> <a class="code" href="../../d0/d0c/http__websocket_8h.html#a8cb89d2edeb737bfc4efb15902cd19bc">ast_websocket_opcode</a> opcode;</div><div class="line"><a name="l01021"></a><span class="lineno"> 1021</span>&#160;      <span class="keywordtype">int</span> fragmented;</div><div class="line"><a name="l01022"></a><span class="lineno"> 1022</span>&#160;</div><div class="line"><a name="l01023"></a><span class="lineno"> 1023</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="../../de/d4c/res__http__websocket_8c.html#ae16416016e8876c9dc2bd937278dcc4e">ast_websocket_read</a>(session, &amp;payload, &amp;payload_len, &amp;opcode, &amp;fragmented)) {</div><div class="line"><a name="l01024"></a><span class="lineno"> 1024</span>&#160;         <span class="comment">/* We err on the side of caution and terminate the session if any error occurs */</span></div><div class="line"><a name="l01025"></a><span class="lineno"> 1025</span>&#160;         <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Read failure during WebSocket echo loop\n&quot;</span>);</div><div class="line"><a name="l01026"></a><span class="lineno"> 1026</span>&#160;         <span class="keywordflow">break</span>;</div><div class="line"><a name="l01027"></a><span class="lineno"> 1027</span>&#160;      }</div><div class="line"><a name="l01028"></a><span class="lineno"> 1028</span>&#160;</div><div class="line"><a name="l01029"></a><span class="lineno"> 1029</span>&#160;      <span class="keywordflow">if</span> (opcode == <a class="code" href="../../d0/d0c/http__websocket_8h.html#a8cb89d2edeb737bfc4efb15902cd19bcaed1971e4feac2449c2db014b144d65a0">AST_WEBSOCKET_OPCODE_TEXT</a> || opcode == <a class="code" href="../../d0/d0c/http__websocket_8h.html#a8cb89d2edeb737bfc4efb15902cd19bca3c4b23cd6b0016f8683525e726b4a810">AST_WEBSOCKET_OPCODE_BINARY</a>) {</div><div class="line"><a name="l01030"></a><span class="lineno"> 1030</span>&#160;         <a class="code" href="../../de/d4c/res__http__websocket_8c.html#a1a6e44db94d8b4e8c06bf456bb0174ad">ast_websocket_write</a>(session, opcode, payload, payload_len);</div><div class="line"><a name="l01031"></a><span class="lineno"> 1031</span>&#160;      } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (opcode == <a class="code" href="../../d0/d0c/http__websocket_8h.html#a8cb89d2edeb737bfc4efb15902cd19bcacd58d1ec65c0e9e407972667603697af">AST_WEBSOCKET_OPCODE_CLOSE</a>) {</div><div class="line"><a name="l01032"></a><span class="lineno"> 1032</span>&#160;         <span class="keywordflow">break</span>;</div><div class="line"><a name="l01033"></a><span class="lineno"> 1033</span>&#160;      } <span class="keywordflow">else</span> {</div><div class="line"><a name="l01034"></a><span class="lineno"> 1034</span>&#160;         <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(1, <span class="stringliteral">&quot;Ignored WebSocket opcode %u\n&quot;</span>, opcode);</div><div class="line"><a name="l01035"></a><span class="lineno"> 1035</span>&#160;      }</div><div class="line"><a name="l01036"></a><span class="lineno"> 1036</span>&#160;   }</div><div class="line"><a name="l01037"></a><span class="lineno"> 1037</span>&#160;</div><div class="line"><a name="l01038"></a><span class="lineno"> 1038</span>&#160;<a class="code" href="../../dd/d7c/eagi__proxy_8c.html#a8fd806ad19b8f5513a4cf18cbf77532c">end</a>:</div><div class="line"><a name="l01039"></a><span class="lineno"> 1039</span>&#160;   <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(1, <span class="stringliteral">&quot;Exiting WebSocket echo loop\n&quot;</span>);</div><div class="line"><a name="l01040"></a><span class="lineno"> 1040</span>&#160;   <a class="code" href="../../de/d4c/res__http__websocket_8c.html#af03daa0a59002330aacdfcb44da59db9">ast_websocket_unref</a>(session);</div><div class="line"><a name="l01041"></a><span class="lineno"> 1041</span>&#160;}</div><div class="ttc" id="res__http__websocket_8c_html_ae16416016e8876c9dc2bd937278dcc4e"><div class="ttname"><a href="../../de/d4c/res__http__websocket_8c.html#ae16416016e8876c9dc2bd937278dcc4e">ast_websocket_read</a></div><div class="ttdeci">int AST_OPTIONAL_API_NAME() ast_websocket_read(struct ast_websocket *session, char **payload, uint64_t *payload_len, enum ast_websocket_opcode *opcode, int *fragmented)</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d4c/res__http__websocket_8c_source.html#l00602">res_http_websocket.c:602</a></div></div>
<div class="ttc" id="logger_8h_html_adf4476a6a4ea6c74231c826e899d7189"><div class="ttname"><a href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a></div><div class="ttdeci">#define LOG_WARNING</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d8c/logger_8h_source.html#l00274">logger.h:274</a></div></div>
<div class="ttc" id="eagi__proxy_8c_html_a8fd806ad19b8f5513a4cf18cbf77532c"><div class="ttname"><a href="../../dd/d7c/eagi__proxy_8c.html#a8fd806ad19b8f5513a4cf18cbf77532c">end</a></div><div class="ttdeci">char * end</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d7c/eagi__proxy_8c_source.html#l00073">eagi_proxy.c:73</a></div></div>
<div class="ttc" id="res__http__websocket_8c_html_a874ca6ebfa7b35e92557cc97af1d41be"><div class="ttname"><a href="../../de/d4c/res__http__websocket_8c.html#a874ca6ebfa7b35e92557cc97af1d41be">ast_websocket_fd</a></div><div class="ttdeci">int AST_OPTIONAL_API_NAME() ast_websocket_fd(struct ast_websocket *session)</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d4c/res__http__websocket_8c_source.html#l00461">res_http_websocket.c:461</a></div></div>
<div class="ttc" id="http__websocket_8h_html_a8cb89d2edeb737bfc4efb15902cd19bcacd58d1ec65c0e9e407972667603697af"><div class="ttname"><a href="../../d0/d0c/http__websocket_8h.html#a8cb89d2edeb737bfc4efb15902cd19bcacd58d1ec65c0e9e407972667603697af">AST_WEBSOCKET_OPCODE_CLOSE</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d0c/http__websocket_8h_source.html#l00055">http_websocket.h:55</a></div></div>
<div class="ttc" id="utils_8h_html_a85392708ff0d7ed6fb86ff83f0e714c3"><div class="ttname"><a href="../../d5/d60/utils_8h.html#a85392708ff0d7ed6fb86ff83f0e714c3">ast_fd_set_flags</a></div><div class="ttdeci">#define ast_fd_set_flags(fd, flags)</div><div class="ttdoc">Set flags on the given file descriptor. </div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d60/utils_8h_source.html#l01009">utils.h:1009</a></div></div>
<div class="ttc" id="logger_8h_html_a3f248112c8d6ce7e3959aa723dade648"><div class="ttname"><a href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a></div><div class="ttdeci">#define ast_debug(level,...)</div><div class="ttdoc">Log a DEBUG message. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d8c/logger_8h_source.html#l00452">logger.h:452</a></div></div>
<div class="ttc" id="astobj2_8c_html_a96a00b3a518d7f32b6d51dc28f09bf9b"><div class="ttname"><a href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a></div><div class="ttdeci">#define ast_log</div><div class="ttdef"><b>Definition:</b> <a href="../../da/df7/astobj2_8c_source.html#l00042">astobj2.c:42</a></div></div>
<div class="ttc" id="http__websocket_8h_html_a8cb89d2edeb737bfc4efb15902cd19bcaed1971e4feac2449c2db014b144d65a0"><div class="ttname"><a href="../../d0/d0c/http__websocket_8h.html#a8cb89d2edeb737bfc4efb15902cd19bcaed1971e4feac2449c2db014b144d65a0">AST_WEBSOCKET_OPCODE_TEXT</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d0c/http__websocket_8h_source.html#l00051">http_websocket.h:51</a></div></div>
<div class="ttc" id="res__http__websocket_8c_html_a1a6e44db94d8b4e8c06bf456bb0174ad"><div class="ttname"><a href="../../de/d4c/res__http__websocket_8c.html#a1a6e44db94d8b4e8c06bf456bb0174ad">ast_websocket_write</a></div><div class="ttdeci">int AST_OPTIONAL_API_NAME() ast_websocket_write(struct ast_websocket *session, enum ast_websocket_opcode opcode, char *payload, uint64_t payload_size)</div><div class="ttdoc">Write function for websocket traffic. </div><div class="ttdef"><b>Definition:</b> <a href="../../de/d4c/res__http__websocket_8c_source.html#l00374">res_http_websocket.c:374</a></div></div>
<div class="ttc" id="http__websocket_8h_html_a8cb89d2edeb737bfc4efb15902cd19bca3c4b23cd6b0016f8683525e726b4a810"><div class="ttname"><a href="../../d0/d0c/http__websocket_8h.html#a8cb89d2edeb737bfc4efb15902cd19bca3c4b23cd6b0016f8683525e726b4a810">AST_WEBSOCKET_OPCODE_BINARY</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d0c/http__websocket_8h_source.html#l00052">http_websocket.h:52</a></div></div>
<div class="ttc" id="res__http__websocket_8c_html_a838ccd8bed44b43d4b95025bc3bea4c8"><div class="ttname"><a href="../../de/d4c/res__http__websocket_8c.html#a838ccd8bed44b43d4b95025bc3bea4c8">ast_websocket_wait_for_input</a></div><div class="ttdeci">int AST_OPTIONAL_API_NAME() ast_websocket_wait_for_input(struct ast_websocket *session, int timeout)</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d4c/res__http__websocket_8c_source.html#l00466">res_http_websocket.c:466</a></div></div>
<div class="ttc" id="res__http__websocket_8c_html_af03daa0a59002330aacdfcb44da59db9"><div class="ttname"><a href="../../de/d4c/res__http__websocket_8c.html#af03daa0a59002330aacdfcb44da59db9">ast_websocket_unref</a></div><div class="ttdeci">void AST_OPTIONAL_API_NAME() ast_websocket_unref(struct ast_websocket *session)</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d4c/res__http__websocket_8c_source.html#l00456">res_http_websocket.c:456</a></div></div>
<div class="ttc" id="http__websocket_8h_html_a8cb89d2edeb737bfc4efb15902cd19bc"><div class="ttname"><a href="../../d0/d0c/http__websocket_8h.html#a8cb89d2edeb737bfc4efb15902cd19bc">ast_websocket_opcode</a></div><div class="ttdeci">ast_websocket_opcode</div><div class="ttdoc">WebSocket operation codes. </div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d0c/http__websocket_8h_source.html#l00050">http_websocket.h:50</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a724a006e8f51c16953462608c1eb6fcd"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a724a006e8f51c16953462608c1eb6fcd">&#9670;&nbsp;</a></span>websocket_mask_payload()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void websocket_mask_payload </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="../../db/db6/structast__websocket.html">ast_websocket</a> *&#160;</td>
          <td class="paramname"><em>session</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>frame</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>payload</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint64_t&#160;</td>
          <td class="paramname"><em>payload_size</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Perform payload masking for client sessions. </p>

<p class="definition">Definition at line <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html#l00288">288</a> of file <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html">res_http_websocket.c</a>.</p>

<p class="reference">References <a class="el" href="../../de/d1f/main_2utils_8c_source.html#l02064">ast_random()</a>, <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html#l00100">ast_websocket::client</a>, and <a class="el" href="../../d2/d1e/unaligned_8h_source.html#l00058">put_unaligned_uint32()</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html#l00308">ast_websocket_close()</a>, and <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html#l00374">ast_websocket_write()</a>.</p>
<div class="fragment"><div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;{</div><div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;   <span class="comment">/* RFC 6455 5.1 - clients MUST mask frame data */</span></div><div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;   <span class="keywordflow">if</span> (session-&gt;<a class="code" href="../../db/db6/structast__websocket.html#a58c585b74d6f77b0a24b7503ddf9d7e2">client</a>) {</div><div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;      uint64_t i;</div><div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;      uint8_t mask_key_idx;</div><div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;      uint32_t mask_key = <a class="code" href="../../d5/d60/utils_8h.html#a7b4f10b070e95ba413e258a3e4b03c20">ast_random</a>();</div><div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;      uint8_t length = frame[1] &amp; 0x7f;</div><div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;      frame[1] |= 0x80; <span class="comment">/* set mask bit to 1 */</span></div><div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;      <span class="comment">/* The mask key octet position depends on the length */</span></div><div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;      mask_key_idx = length == 126 ? 4 : length == 127 ? 10 : 2;</div><div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;      <a class="code" href="../../d2/d1e/unaligned_8h.html#ae0b7823a3fab76dbec84f308adeb7f5a">put_unaligned_uint32</a>(&amp;frame[mask_key_idx], mask_key);</div><div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;      <span class="keywordflow">for</span> (i = 0; i &lt; payload_size; i++) {</div><div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;         payload[i] ^= ((<span class="keywordtype">char</span> *)&amp;mask_key)[i % 4];</div><div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;      }</div><div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;   }</div><div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;}</div><div class="ttc" id="unaligned_8h_html_ae0b7823a3fab76dbec84f308adeb7f5a"><div class="ttname"><a href="../../d2/d1e/unaligned_8h.html#ae0b7823a3fab76dbec84f308adeb7f5a">put_unaligned_uint32</a></div><div class="ttdeci">static void put_unaligned_uint32(void *p, unsigned int datum)</div><div class="ttdef"><b>Definition:</b> <a href="../../d2/d1e/unaligned_8h_source.html#l00058">unaligned.h:58</a></div></div>
<div class="ttc" id="utils_8h_html_a7b4f10b070e95ba413e258a3e4b03c20"><div class="ttname"><a href="../../d5/d60/utils_8h.html#a7b4f10b070e95ba413e258a3e4b03c20">ast_random</a></div><div class="ttdeci">long int ast_random(void)</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d1f/main_2utils_8c_source.html#l02064">main/utils.c:2064</a></div></div>
<div class="ttc" id="structast__websocket_html_a58c585b74d6f77b0a24b7503ddf9d7e2"><div class="ttname"><a href="../../db/db6/structast__websocket.html#a58c585b74d6f77b0a24b7503ddf9d7e2">ast_websocket::client</a></div><div class="ttdeci">struct websocket_client * client</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d4c/res__http__websocket_8c_source.html#l00100">res_http_websocket.c:100</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="abf1644d4ceb871c277d1aa1cfb7a9a15"></a>
<h2 class="memtitle"><span class="permalink"><a href="#abf1644d4ceb871c277d1aa1cfb7a9a15">&#9670;&nbsp;</a></span>websocket_opcode2str()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static const char* websocket_opcode2str </td>
          <td>(</td>
          <td class="paramtype">enum <a class="el" href="../../d0/d0c/http__websocket_8h.html#a8cb89d2edeb737bfc4efb15902cd19bc">ast_websocket_opcode</a>&#160;</td>
          <td class="paramname"><em>opcode</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html#l00363">363</a> of file <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html">res_http_websocket.c</a>.</p>

<p class="reference">References <a class="el" href="../../d0/d0c/http__websocket_8h_source.html#l00056">AST_WEBSOCKET_OPCODE_CONTINUATION</a>, <a class="el" href="../../d0/d0c/http__websocket_8h_source.html#l00054">AST_WEBSOCKET_OPCODE_PONG</a>, <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html#l00092">ast_websocket::opcode</a>, and <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html#l00354">opcode_map</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html#l00374">ast_websocket_write()</a>.</p>
<div class="fragment"><div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;{</div><div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;   <span class="keywordflow">if</span> (opcode &lt; <a class="code" href="../../d0/d0c/http__websocket_8h.html#a8cb89d2edeb737bfc4efb15902cd19bca3bca61f5d957c1f62fb7dbec2bbf2db3">AST_WEBSOCKET_OPCODE_CONTINUATION</a> ||</div><div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;         opcode &gt; <a class="code" href="../../d0/d0c/http__websocket_8h.html#a8cb89d2edeb737bfc4efb15902cd19bca2d0f797f65d34e2db66f978d571530de">AST_WEBSOCKET_OPCODE_PONG</a>) {</div><div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;      <span class="keywordflow">return</span> <span class="stringliteral">&quot;&lt;unknown&gt;&quot;</span>;</div><div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;   } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../de/d4c/res__http__websocket_8c.html#af1d68c77bf046bd4cb80e8db01e97f1a">opcode_map</a>[opcode];</div><div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;   }</div><div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;}</div><div class="ttc" id="http__websocket_8h_html_a8cb89d2edeb737bfc4efb15902cd19bca2d0f797f65d34e2db66f978d571530de"><div class="ttname"><a href="../../d0/d0c/http__websocket_8h.html#a8cb89d2edeb737bfc4efb15902cd19bca2d0f797f65d34e2db66f978d571530de">AST_WEBSOCKET_OPCODE_PONG</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d0c/http__websocket_8h_source.html#l00054">http_websocket.h:54</a></div></div>
<div class="ttc" id="http__websocket_8h_html_a8cb89d2edeb737bfc4efb15902cd19bca3bca61f5d957c1f62fb7dbec2bbf2db3"><div class="ttname"><a href="../../d0/d0c/http__websocket_8h.html#a8cb89d2edeb737bfc4efb15902cd19bca3bca61f5d957c1f62fb7dbec2bbf2db3">AST_WEBSOCKET_OPCODE_CONTINUATION</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d0c/http__websocket_8h_source.html#l00056">http_websocket.h:56</a></div></div>
<div class="ttc" id="res__http__websocket_8c_html_af1d68c77bf046bd4cb80e8db01e97f1a"><div class="ttname"><a href="../../de/d4c/res__http__websocket_8c.html#af1d68c77bf046bd4cb80e8db01e97f1a">opcode_map</a></div><div class="ttdeci">static const char * opcode_map[]</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d4c/res__http__websocket_8c_source.html#l00354">res_http_websocket.c:354</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a43e3b5d71764b9fb2b338fdf53c9c675"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a43e3b5d71764b9fb2b338fdf53c9c675">&#9670;&nbsp;</a></span>websocket_remove_protocol_internal()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int websocket_remove_protocol_internal </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>name</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../d0/d0c/http__websocket_8h.html#acc038aba3451ed958627359ea71f156a">ast_websocket_callback</a>&#160;</td>
          <td class="paramname"><em>callback</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html#l01072">1072</a> of file <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html">res_http_websocket.c</a>.</p>

<p class="reference">References <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html#l00266">ast_websocket_server_remove_protocol()</a>, and <a class="el" href="../../dd/d56/http_8h_source.html#l00114">ast_http_uri::data</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html#l01081">ast_websocket_remove_protocol()</a>, and <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html#l01513">unload_module()</a>.</p>
<div class="fragment"><div class="line"><a name="l01073"></a><span class="lineno"> 1073</span>&#160;{</div><div class="line"><a name="l01074"></a><span class="lineno"> 1074</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../db/d66/structast__websocket__server.html">ast_websocket_server</a> *ws_server = <a class="code" href="../../de/d4c/res__http__websocket_8c.html#a250d189c16de52a67daa3ab480eb8aa1">websocketuri</a>.<a class="code" href="../../d0/d6c/structast__http__uri.html#a735984d41155bc1032e09bece8f8d66d">data</a>;</div><div class="line"><a name="l01075"></a><span class="lineno"> 1075</span>&#160;   <span class="keywordflow">if</span> (!ws_server) {</div><div class="line"><a name="l01076"></a><span class="lineno"> 1076</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l01077"></a><span class="lineno"> 1077</span>&#160;   }</div><div class="line"><a name="l01078"></a><span class="lineno"> 1078</span>&#160;   <span class="keywordflow">return</span> <a class="code" href="../../de/d4c/res__http__websocket_8c.html#ac90e98de467636091797a98a5f596b1d">ast_websocket_server_remove_protocol</a>(ws_server, <a class="code" href="../../d0/d29/cdr__mysql_8c.html#a0980a105ccb863d8008eb6201a51da52">name</a>, callback);</div><div class="line"><a name="l01079"></a><span class="lineno"> 1079</span>&#160;}</div><div class="ttc" id="structast__websocket__server_html"><div class="ttname"><a href="../../db/d66/structast__websocket__server.html">ast_websocket_server</a></div><div class="ttdoc">Structure for a WebSocket server. </div><div class="ttdef"><b>Definition:</b> <a href="../../de/d4c/res__http__websocket_8c_source.html#l00132">res_http_websocket.c:132</a></div></div>
<div class="ttc" id="res__http__websocket_8c_html_a250d189c16de52a67daa3ab480eb8aa1"><div class="ttname"><a href="../../de/d4c/res__http__websocket_8c.html#a250d189c16de52a67daa3ab480eb8aa1">websocketuri</a></div><div class="ttdeci">static struct ast_http_uri websocketuri</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d4c/res__http__websocket_8c_source.html#l00997">res_http_websocket.c:997</a></div></div>
<div class="ttc" id="cdr__mysql_8c_html_a0980a105ccb863d8008eb6201a51da52"><div class="ttname"><a href="../../d0/d29/cdr__mysql_8c.html#a0980a105ccb863d8008eb6201a51da52">name</a></div><div class="ttdeci">static const char name[]</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d29/cdr__mysql_8c_source.html#l00074">cdr_mysql.c:74</a></div></div>
<div class="ttc" id="structast__http__uri_html_a735984d41155bc1032e09bece8f8d66d"><div class="ttname"><a href="../../d0/d6c/structast__http__uri.html#a735984d41155bc1032e09bece8f8d66d">ast_http_uri::data</a></div><div class="ttdeci">void * data</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d56/http_8h_source.html#l00114">http.h:114</a></div></div>
<div class="ttc" id="res__http__websocket_8c_html_ac90e98de467636091797a98a5f596b1d"><div class="ttname"><a href="../../de/d4c/res__http__websocket_8c.html#ac90e98de467636091797a98a5f596b1d">ast_websocket_server_remove_protocol</a></div><div class="ttdeci">int AST_OPTIONAL_API_NAME() ast_websocket_server_remove_protocol(struct ast_websocket_server *server, const char *name, ast_websocket_callback callback)</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d4c/res__http__websocket_8c_source.html#l00266">res_http_websocket.c:266</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="aa4a7f78738dfa70961e16bad55a9156e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa4a7f78738dfa70961e16bad55a9156e">&#9670;&nbsp;</a></span>websocket_server_create_impl()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static struct <a class="el" href="../../db/d66/structast__websocket__server.html">ast_websocket_server</a>* websocket_server_create_impl </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html#l00143">143</a> of file <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html">res_http_websocket.c</a>.</p>

<p class="reference">References <a class="el" href="../../d5/da5/astobj2_8h_source.html#l00411">ao2_alloc</a>, <a class="el" href="../../d5/da5/astobj2_8h_source.html#l00365">AO2_ALLOC_OPT_LOCK_MUTEX</a>, <a class="el" href="../../d5/da5/astobj2_8h_source.html#l01958">ao2_cleanup</a>, <a class="el" href="../../d5/da5/astobj2_8h_source.html#l01310">ao2_container_alloc_hash</a>, <a class="el" href="../../d5/da5/astobj2_8h_source.html#l00464">ao2_ref</a>, <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html#l00051">MAX_PROTOCOL_BUCKETS</a>, <a class="el" href="../../dc/d7f/resample_8c_source.html#l00096">NULL</a>, <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html#l00116">protocol_cmp_fn()</a>, <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html#l00107">protocol_hash_fn()</a>, <a class="el" href="../../d5/d60/utils_8h_source.html#l00911">RAII_VAR</a>, and <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html#l00136">websocket_server_dtor()</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html#l00167">ast_websocket_server_create()</a>, and <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html#l00162">websocket_server_internal_create()</a>.</p>
<div class="fragment"><div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;{</div><div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;   <a class="code" href="../../d5/d60/utils_8h.html#a1604b4d72144dd3d9f7da668e90337e9">RAII_VAR</a>(<span class="keyword">struct</span> <a class="code" href="../../db/d66/structast__websocket__server.html">ast_websocket_server</a> *, server, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../d5/da5/astobj2_8h.html#a6321ee982370c55ab3c24c72c562cbdd">ao2_cleanup</a>);</div><div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;</div><div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;   server = <a class="code" href="../../d5/da5/astobj2_8h.html#ae0422b60d8e25b6962b2d61ae4ddf724">ao2_alloc</a>(<span class="keyword">sizeof</span>(*server), <a class="code" href="../../de/d4c/res__http__websocket_8c.html#a68f2ee4ab223f3c4f9719b6fd2cfdfef">websocket_server_dtor</a>);</div><div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;   <span class="keywordflow">if</span> (!server) {</div><div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;   }</div><div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;</div><div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;   server-&gt;protocols = <a class="code" href="../../d5/da5/astobj2_8h.html#aefc16f8aa9087cbc5c55c70cf1dd41b2">ao2_container_alloc_hash</a>(<a class="code" href="../../d5/da5/astobj2_8h.html#a2cf7e3433f08351aafe3b0cd31edf7f8a8ccf751bd6749d062999469f0694e7ad">AO2_ALLOC_OPT_LOCK_MUTEX</a>, 0,</div><div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;      <a class="code" href="../../de/d4c/res__http__websocket_8c.html#a5be56ede9f12af5da13707860ec9ceb3">MAX_PROTOCOL_BUCKETS</a>, <a class="code" href="../../de/d4c/res__http__websocket_8c.html#ab1f7b44119d3a7df6f3517212a8f8e51">protocol_hash_fn</a>, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../de/d4c/res__http__websocket_8c.html#a7e26998f99ba89e31a4ef2f2c899b758">protocol_cmp_fn</a>);</div><div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;   <span class="keywordflow">if</span> (!server-&gt;protocols) {</div><div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;   }</div><div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;</div><div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(server, +1);</div><div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;   <span class="keywordflow">return</span> server;</div><div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;}</div><div class="ttc" id="structast__websocket__server_html"><div class="ttname"><a href="../../db/d66/structast__websocket__server.html">ast_websocket_server</a></div><div class="ttdoc">Structure for a WebSocket server. </div><div class="ttdef"><b>Definition:</b> <a href="../../de/d4c/res__http__websocket_8c_source.html#l00132">res_http_websocket.c:132</a></div></div>
<div class="ttc" id="resample_8c_html_a070d2ce7b6bb7e5c05602aa8c308d0c4"><div class="ttname"><a href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a></div><div class="ttdeci">#define NULL</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d7f/resample_8c_source.html#l00096">resample.c:96</a></div></div>
<div class="ttc" id="res__http__websocket_8c_html_a68f2ee4ab223f3c4f9719b6fd2cfdfef"><div class="ttname"><a href="../../de/d4c/res__http__websocket_8c.html#a68f2ee4ab223f3c4f9719b6fd2cfdfef">websocket_server_dtor</a></div><div class="ttdeci">static void websocket_server_dtor(void *obj)</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d4c/res__http__websocket_8c_source.html#l00136">res_http_websocket.c:136</a></div></div>
<div class="ttc" id="res__http__websocket_8c_html_ab1f7b44119d3a7df6f3517212a8f8e51"><div class="ttname"><a href="../../de/d4c/res__http__websocket_8c.html#ab1f7b44119d3a7df6f3517212a8f8e51">protocol_hash_fn</a></div><div class="ttdeci">static int protocol_hash_fn(const void *obj, const int flags)</div><div class="ttdoc">Hashing function for protocols. </div><div class="ttdef"><b>Definition:</b> <a href="../../de/d4c/res__http__websocket_8c_source.html#l00107">res_http_websocket.c:107</a></div></div>
<div class="ttc" id="res__http__websocket_8c_html_a5be56ede9f12af5da13707860ec9ceb3"><div class="ttname"><a href="../../de/d4c/res__http__websocket_8c.html#a5be56ede9f12af5da13707860ec9ceb3">MAX_PROTOCOL_BUCKETS</a></div><div class="ttdeci">#define MAX_PROTOCOL_BUCKETS</div><div class="ttdoc">Number of buckets for registered protocols. </div><div class="ttdef"><b>Definition:</b> <a href="../../de/d4c/res__http__websocket_8c_source.html#l00051">res_http_websocket.c:51</a></div></div>
<div class="ttc" id="utils_8h_html_a1604b4d72144dd3d9f7da668e90337e9"><div class="ttname"><a href="../../d5/d60/utils_8h.html#a1604b4d72144dd3d9f7da668e90337e9">RAII_VAR</a></div><div class="ttdeci">#define RAII_VAR(vartype, varname, initval, dtor)</div><div class="ttdoc">Declare a variable that will call a destructor function when it goes out of scope. </div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d60/utils_8h_source.html#l00911">utils.h:911</a></div></div>
<div class="ttc" id="astobj2_8h_html_aaca5e8eac39a22f9da1c36fc6c922270"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a></div><div class="ttdeci">#define ao2_ref(o, delta)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l00464">astobj2.h:464</a></div></div>
<div class="ttc" id="astobj2_8h_html_a2cf7e3433f08351aafe3b0cd31edf7f8a8ccf751bd6749d062999469f0694e7ad"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#a2cf7e3433f08351aafe3b0cd31edf7f8a8ccf751bd6749d062999469f0694e7ad">AO2_ALLOC_OPT_LOCK_MUTEX</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l00365">astobj2.h:365</a></div></div>
<div class="ttc" id="astobj2_8h_html_aefc16f8aa9087cbc5c55c70cf1dd41b2"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#aefc16f8aa9087cbc5c55c70cf1dd41b2">ao2_container_alloc_hash</a></div><div class="ttdeci">#define ao2_container_alloc_hash(ao2_options, container_options, n_buckets, hash_fn, sort_fn, cmp_fn)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l01310">astobj2.h:1310</a></div></div>
<div class="ttc" id="res__http__websocket_8c_html_a7e26998f99ba89e31a4ef2f2c899b758"><div class="ttname"><a href="../../de/d4c/res__http__websocket_8c.html#a7e26998f99ba89e31a4ef2f2c899b758">protocol_cmp_fn</a></div><div class="ttdeci">static int protocol_cmp_fn(void *obj, void *arg, int flags)</div><div class="ttdoc">Comparison function for protocols. </div><div class="ttdef"><b>Definition:</b> <a href="../../de/d4c/res__http__websocket_8c_source.html#l00116">res_http_websocket.c:116</a></div></div>
<div class="ttc" id="astobj2_8h_html_ae0422b60d8e25b6962b2d61ae4ddf724"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#ae0422b60d8e25b6962b2d61ae4ddf724">ao2_alloc</a></div><div class="ttdeci">#define ao2_alloc(data_size, destructor_fn)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l00411">astobj2.h:411</a></div></div>
<div class="ttc" id="astobj2_8h_html_a6321ee982370c55ab3c24c72c562cbdd"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#a6321ee982370c55ab3c24c72c562cbdd">ao2_cleanup</a></div><div class="ttdeci">#define ao2_cleanup(obj)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l01958">astobj2.h:1958</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a68f2ee4ab223f3c4f9719b6fd2cfdfef"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a68f2ee4ab223f3c4f9719b6fd2cfdfef">&#9670;&nbsp;</a></span>websocket_server_dtor()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void websocket_server_dtor </td>
          <td>(</td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>obj</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html#l00136">136</a> of file <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html">res_http_websocket.c</a>.</p>

<p class="reference">References <a class="el" href="../../d5/da5/astobj2_8h_source.html#l01958">ao2_cleanup</a>, <a class="el" href="../../dc/d7f/resample_8c_source.html#l00096">NULL</a>, and <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html#l00133">ast_websocket_server::protocols</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html#l00143">websocket_server_create_impl()</a>.</p>
<div class="fragment"><div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;{</div><div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../db/d66/structast__websocket__server.html">ast_websocket_server</a> *server = obj;</div><div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#a6321ee982370c55ab3c24c72c562cbdd">ao2_cleanup</a>(server-&gt;<a class="code" href="../../db/d66/structast__websocket__server.html#a2a8b976c358cd42ed5b5af57499588d3">protocols</a>);</div><div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;   server-&gt;<a class="code" href="../../db/d66/structast__websocket__server.html#a2a8b976c358cd42ed5b5af57499588d3">protocols</a> = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;}</div><div class="ttc" id="structast__websocket__server_html"><div class="ttname"><a href="../../db/d66/structast__websocket__server.html">ast_websocket_server</a></div><div class="ttdoc">Structure for a WebSocket server. </div><div class="ttdef"><b>Definition:</b> <a href="../../de/d4c/res__http__websocket_8c_source.html#l00132">res_http_websocket.c:132</a></div></div>
<div class="ttc" id="structast__websocket__server_html_a2a8b976c358cd42ed5b5af57499588d3"><div class="ttname"><a href="../../db/d66/structast__websocket__server.html#a2a8b976c358cd42ed5b5af57499588d3">ast_websocket_server::protocols</a></div><div class="ttdeci">struct ao2_container * protocols</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d4c/res__http__websocket_8c_source.html#l00133">res_http_websocket.c:133</a></div></div>
<div class="ttc" id="resample_8c_html_a070d2ce7b6bb7e5c05602aa8c308d0c4"><div class="ttname"><a href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a></div><div class="ttdeci">#define NULL</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d7f/resample_8c_source.html#l00096">resample.c:96</a></div></div>
<div class="ttc" id="astobj2_8h_html_a6321ee982370c55ab3c24c72c562cbdd"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#a6321ee982370c55ab3c24c72c562cbdd">ao2_cleanup</a></div><div class="ttdeci">#define ao2_cleanup(obj)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l01958">astobj2.h:1958</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a90ad4f2355601e1464ef3004264c7afe"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a90ad4f2355601e1464ef3004264c7afe">&#9670;&nbsp;</a></span>websocket_server_internal_create()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static struct <a class="el" href="../../db/d66/structast__websocket__server.html">ast_websocket_server</a>* websocket_server_internal_create </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html#l00162">162</a> of file <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html">res_http_websocket.c</a>.</p>

<p class="reference">References <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html#l00143">websocket_server_create_impl()</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html#l01501">load_module()</a>.</p>
<div class="fragment"><div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;{</div><div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;   <span class="keywordflow">return</span> <a class="code" href="../../de/d4c/res__http__websocket_8c.html#aa4a7f78738dfa70961e16bad55a9156e">websocket_server_create_impl</a>();</div><div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;}</div><div class="ttc" id="res__http__websocket_8c_html_aa4a7f78738dfa70961e16bad55a9156e"><div class="ttname"><a href="../../de/d4c/res__http__websocket_8c.html#aa4a7f78738dfa70961e16bad55a9156e">websocket_server_create_impl</a></div><div class="ttdeci">static struct ast_websocket_server * websocket_server_create_impl(void)</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d4c/res__http__websocket_8c_source.html#l00143">res_http_websocket.c:143</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a32088fabfd3e38aa97358a8833d59850"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a32088fabfd3e38aa97358a8833d59850">&#9670;&nbsp;</a></span>ws_safe_read()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int ws_safe_read </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="../../db/db6/structast__websocket.html">ast_websocket</a> *&#160;</td>
          <td class="paramname"><em>session</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>buf</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>len</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">enum <a class="el" href="../../d0/d0c/http__websocket_8h.html#a8cb89d2edeb737bfc4efb15902cd19bc">ast_websocket_opcode</a> *&#160;</td>
          <td class="paramname"><em>opcode</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html#l00534">534</a> of file <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html">res_http_websocket.c</a>.</p>

<p class="reference">References <a class="el" href="../../d5/da5/astobj2_8h_source.html#l00718">ao2_lock</a>, <a class="el" href="../../d5/da5/astobj2_8h_source.html#l00730">ao2_unlock</a>, <a class="el" href="../../d5/d60/utils_8h_source.html#l00695">ast_assert</a>, <a class="el" href="../../d1/dc8/iostream_8c_source.html#l00273">ast_iostream_read()</a>, <a class="el" href="../../d1/dc8/iostream_8c_source.html#l00089">ast_iostream_wait_for_input()</a>, <a class="el" href="../../da/df7/astobj2_8c_source.html#l00042">ast_log</a>, <a class="el" href="../../d0/d0c/http__websocket_8h_source.html#l00055">AST_WEBSOCKET_OPCODE_CLOSE</a>, <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html#l00103">ast_websocket::buf</a>, <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html#l00098">ast_websocket::closing</a>, <a class="el" href="../../d1/d6e/main_2stdtime_2private_8h.html#ad65a8842cc674e3ddf69355898c0ecbf">errno</a>, <a class="el" href="../../d9/d1e/func__strings_8c_source.html#l01344">len()</a>, <a class="el" href="../../d1/d8c/logger_8h_source.html#l00285">LOG_ERROR</a>, <a class="el" href="../../d1/d8c/logger_8h_source.html#l00274">LOG_WARNING</a>, and <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html#l00089">ast_websocket::stream</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html#l00602">ast_websocket_read()</a>.</p>
<div class="fragment"><div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;{</div><div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;   ssize_t rlen;</div><div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;   <span class="keywordtype">int</span> xlen = <a class="code" href="../../d9/d1e/func__strings_8c.html#af24e73aaf92f3000fda15d285e66df24">len</a>;</div><div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;   <span class="keywordtype">char</span> *rbuf = <a class="code" href="../../dd/d7c/eagi__proxy_8c.html#ac95651d79c608a3148973b5b1fc9e525">buf</a>;</div><div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;   <span class="keywordtype">int</span> sanity = 10;</div><div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;</div><div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;   <a class="code" href="../../d5/d60/utils_8h.html#a24374da24af1931d8a7ccde5b352bb2c">ast_assert</a>(<a class="code" href="../../d9/d1e/func__strings_8c.html#af24e73aaf92f3000fda15d285e66df24">len</a> &gt; 0);</div><div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;</div><div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;   <span class="keywordflow">if</span> (!<a class="code" href="../../d9/d1e/func__strings_8c.html#af24e73aaf92f3000fda15d285e66df24">len</a>) {</div><div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;      <a class="code" href="../../d1/d6e/main_2stdtime_2private_8h.html#ad65a8842cc674e3ddf69355898c0ecbf">errno</a> = EINVAL;</div><div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;   }</div><div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;</div><div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#aa9fdb5d0a6157a56060d9f7279fe6c49">ao2_lock</a>(session);</div><div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;   <span class="keywordflow">if</span> (!session-&gt;<a class="code" href="../../db/db6/structast__websocket.html#a36ac2dd734607a43ed90acb7e9d81ac5">stream</a>) {</div><div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;      <a class="code" href="../../d5/da5/astobj2_8h.html#a9998bd156b936636a8780385e9a910b2">ao2_unlock</a>(session);</div><div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;      <a class="code" href="../../d1/d6e/main_2stdtime_2private_8h.html#ad65a8842cc674e3ddf69355898c0ecbf">errno</a> = ECONNABORTED;</div><div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;   }</div><div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;</div><div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;   <span class="keywordflow">for</span> (;;) {</div><div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;      rlen = <a class="code" href="../../dd/d27/iostream_8h.html#aa009ff0c2d31892c5beb19114f47768b">ast_iostream_read</a>(session-&gt;<a class="code" href="../../db/db6/structast__websocket.html#a36ac2dd734607a43ed90acb7e9d81ac5">stream</a>, rbuf, xlen);</div><div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;      <span class="keywordflow">if</span> (rlen != xlen) {</div><div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;         <span class="keywordflow">if</span> (rlen == 0) {</div><div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;            <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Web socket closed abruptly\n&quot;</span>);</div><div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;            *opcode = <a class="code" href="../../d0/d0c/http__websocket_8h.html#a8cb89d2edeb737bfc4efb15902cd19bcacd58d1ec65c0e9e407972667603697af">AST_WEBSOCKET_OPCODE_CLOSE</a>;</div><div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;            session-&gt;<a class="code" href="../../db/db6/structast__websocket.html#aa71fe3535b288c6e8f4e7f811b65fc3c">closing</a> = 1;</div><div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;            <a class="code" href="../../d5/da5/astobj2_8h.html#a9998bd156b936636a8780385e9a910b2">ao2_unlock</a>(session);</div><div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;            <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;         }</div><div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;</div><div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;         <span class="keywordflow">if</span> (rlen &lt; 0 &amp;&amp; <a class="code" href="../../d1/d6e/main_2stdtime_2private_8h.html#ad65a8842cc674e3ddf69355898c0ecbf">errno</a> != EAGAIN) {</div><div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;            <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Error reading from web socket: %s\n&quot;</span>, strerror(<a class="code" href="../../d1/d6e/main_2stdtime_2private_8h.html#ad65a8842cc674e3ddf69355898c0ecbf">errno</a>));</div><div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;            *opcode = <a class="code" href="../../d0/d0c/http__websocket_8h.html#a8cb89d2edeb737bfc4efb15902cd19bcacd58d1ec65c0e9e407972667603697af">AST_WEBSOCKET_OPCODE_CLOSE</a>;</div><div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;            session-&gt;<a class="code" href="../../db/db6/structast__websocket.html#aa71fe3535b288c6e8f4e7f811b65fc3c">closing</a> = 1;</div><div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;            <a class="code" href="../../d5/da5/astobj2_8h.html#a9998bd156b936636a8780385e9a910b2">ao2_unlock</a>(session);</div><div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;            <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;         }</div><div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;</div><div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;         <span class="keywordflow">if</span> (!--sanity) {</div><div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;            <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Websocket seems unresponsive, disconnecting ...\n&quot;</span>);</div><div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;            *opcode = <a class="code" href="../../d0/d0c/http__websocket_8h.html#a8cb89d2edeb737bfc4efb15902cd19bcacd58d1ec65c0e9e407972667603697af">AST_WEBSOCKET_OPCODE_CLOSE</a>;</div><div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;            session-&gt;<a class="code" href="../../db/db6/structast__websocket.html#aa71fe3535b288c6e8f4e7f811b65fc3c">closing</a> = 1;</div><div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;            <a class="code" href="../../d5/da5/astobj2_8h.html#a9998bd156b936636a8780385e9a910b2">ao2_unlock</a>(session);</div><div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;            <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;         }</div><div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;      }</div><div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;      <span class="keywordflow">if</span> (rlen &gt; 0) {</div><div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;         xlen = xlen - rlen;</div><div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;         rbuf = rbuf + rlen;</div><div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;         <span class="keywordflow">if</span> (!xlen) {</div><div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;         }</div><div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;      }</div><div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="../../dd/d27/iostream_8h.html#ad721332871f184269664be51e8393136">ast_iostream_wait_for_input</a>(session-&gt;<a class="code" href="../../db/db6/structast__websocket.html#a36ac2dd734607a43ed90acb7e9d81ac5">stream</a>, 1000) &lt; 0) {</div><div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;         <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;ast_iostream_wait_for_input returned err: %s\n&quot;</span>, strerror(<a class="code" href="../../d1/d6e/main_2stdtime_2private_8h.html#ad65a8842cc674e3ddf69355898c0ecbf">errno</a>));</div><div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;         *opcode = <a class="code" href="../../d0/d0c/http__websocket_8h.html#a8cb89d2edeb737bfc4efb15902cd19bcacd58d1ec65c0e9e407972667603697af">AST_WEBSOCKET_OPCODE_CLOSE</a>;</div><div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;         session-&gt;<a class="code" href="../../db/db6/structast__websocket.html#aa71fe3535b288c6e8f4e7f811b65fc3c">closing</a> = 1;</div><div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;         <a class="code" href="../../d5/da5/astobj2_8h.html#a9998bd156b936636a8780385e9a910b2">ao2_unlock</a>(session);</div><div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;         <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;      }</div><div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;   }</div><div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;</div><div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#a9998bd156b936636a8780385e9a910b2">ao2_unlock</a>(session);</div><div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;   <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;}</div><div class="ttc" id="iostream_8h_html_ad721332871f184269664be51e8393136"><div class="ttname"><a href="../../dd/d27/iostream_8h.html#ad721332871f184269664be51e8393136">ast_iostream_wait_for_input</a></div><div class="ttdeci">int ast_iostream_wait_for_input(struct ast_iostream *stream, int timeout)</div><div class="ttdoc">Wait for input on the iostream&amp;#39;s file descriptor. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/dc8/iostream_8c_source.html#l00089">iostream.c:89</a></div></div>
<div class="ttc" id="eagi__proxy_8c_html_ac95651d79c608a3148973b5b1fc9e525"><div class="ttname"><a href="../../dd/d7c/eagi__proxy_8c.html#ac95651d79c608a3148973b5b1fc9e525">buf</a></div><div class="ttdeci">char buf[BUFSIZE]</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d7c/eagi__proxy_8c_source.html#l00066">eagi_proxy.c:66</a></div></div>
<div class="ttc" id="logger_8h_html_adf4476a6a4ea6c74231c826e899d7189"><div class="ttname"><a href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a></div><div class="ttdeci">#define LOG_WARNING</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d8c/logger_8h_source.html#l00274">logger.h:274</a></div></div>
<div class="ttc" id="utils_8h_html_a24374da24af1931d8a7ccde5b352bb2c"><div class="ttname"><a href="../../d5/d60/utils_8h.html#a24374da24af1931d8a7ccde5b352bb2c">ast_assert</a></div><div class="ttdeci">#define ast_assert(a)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d60/utils_8h_source.html#l00695">utils.h:695</a></div></div>
<div class="ttc" id="astobj2_8h_html_a9998bd156b936636a8780385e9a910b2"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#a9998bd156b936636a8780385e9a910b2">ao2_unlock</a></div><div class="ttdeci">#define ao2_unlock(a)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l00730">astobj2.h:730</a></div></div>
<div class="ttc" id="iostream_8h_html_aa009ff0c2d31892c5beb19114f47768b"><div class="ttname"><a href="../../dd/d27/iostream_8h.html#aa009ff0c2d31892c5beb19114f47768b">ast_iostream_read</a></div><div class="ttdeci">ssize_t ast_iostream_read(struct ast_iostream *stream, void *buffer, size_t count)</div><div class="ttdoc">Read data from an iostream. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/dc8/iostream_8c_source.html#l00273">iostream.c:273</a></div></div>
<div class="ttc" id="http__websocket_8h_html_a8cb89d2edeb737bfc4efb15902cd19bcacd58d1ec65c0e9e407972667603697af"><div class="ttname"><a href="../../d0/d0c/http__websocket_8h.html#a8cb89d2edeb737bfc4efb15902cd19bcacd58d1ec65c0e9e407972667603697af">AST_WEBSOCKET_OPCODE_CLOSE</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d0c/http__websocket_8h_source.html#l00055">http_websocket.h:55</a></div></div>
<div class="ttc" id="astobj2_8c_html_a96a00b3a518d7f32b6d51dc28f09bf9b"><div class="ttname"><a href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a></div><div class="ttdeci">#define ast_log</div><div class="ttdef"><b>Definition:</b> <a href="../../da/df7/astobj2_8c_source.html#l00042">astobj2.c:42</a></div></div>
<div class="ttc" id="astobj2_8h_html_aa9fdb5d0a6157a56060d9f7279fe6c49"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#aa9fdb5d0a6157a56060d9f7279fe6c49">ao2_lock</a></div><div class="ttdeci">#define ao2_lock(a)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l00718">astobj2.h:718</a></div></div>
<div class="ttc" id="logger_8h_html_aced66975c154ea0e2a8ec3bc818b4e08"><div class="ttname"><a href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a></div><div class="ttdeci">#define LOG_ERROR</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d8c/logger_8h_source.html#l00285">logger.h:285</a></div></div>
<div class="ttc" id="func__strings_8c_html_af24e73aaf92f3000fda15d285e66df24"><div class="ttname"><a href="../../d9/d1e/func__strings_8c.html#af24e73aaf92f3000fda15d285e66df24">len</a></div><div class="ttdeci">static int len(struct ast_channel *chan, const char *cmd, char *data, char *buf, size_t buflen)</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d1e/func__strings_8c_source.html#l01344">func_strings.c:1344</a></div></div>
<div class="ttc" id="main_2stdtime_2private_8h_html_ad65a8842cc674e3ddf69355898c0ecbf"><div class="ttname"><a href="../../d1/d6e/main_2stdtime_2private_8h.html#ad65a8842cc674e3ddf69355898c0ecbf">errno</a></div><div class="ttdeci">int errno</div></div>
<div class="ttc" id="structast__websocket_html_aa71fe3535b288c6e8f4e7f811b65fc3c"><div class="ttname"><a href="../../db/db6/structast__websocket.html#aa71fe3535b288c6e8f4e7f811b65fc3c">ast_websocket::closing</a></div><div class="ttdeci">unsigned int closing</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d4c/res__http__websocket_8c_source.html#l00098">res_http_websocket.c:98</a></div></div>
<div class="ttc" id="structast__websocket_html_a36ac2dd734607a43ed90acb7e9d81ac5"><div class="ttname"><a href="../../db/db6/structast__websocket.html#a36ac2dd734607a43ed90acb7e9d81ac5">ast_websocket::stream</a></div><div class="ttdeci">struct ast_iostream * stream</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d4c/res__http__websocket_8c_source.html#l00089">res_http_websocket.c:89</a></div></div>
</div><!-- fragment -->
</div>
</div>
<h2 class="groupheader">Variable Documentation</h2>
<a id="ab22f32016155f7f403e7178767163d7d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab22f32016155f7f403e7178767163d7d">&#9670;&nbsp;</a></span>__mod_info</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="../../dd/d5f/structast__module__info.html">ast_module_info</a> __mod_info = { .<a class="el" href="../../d1/da4/res__corosync_8c.html#a8f8f80d37794cde9472343e4487ba3eb">name</a> = <a class="el" href="../../da/ddd/named__acl_8c.html#aec23fc5034c3bb08140fc021f4955877">AST_MODULE</a>, .flags = <a class="el" href="../../d5/d16/module_8h.html#a155a0df9c59e04e305d4a2fa3e35f843a835b27a90d895a488e4e14cc3d2dee8c">AST_MODFLAG_GLOBAL_SYMBOLS</a> | <a class="el" href="../../d5/d16/module_8h.html#a155a0df9c59e04e305d4a2fa3e35f843a12c3f60dd7655dfa8d4430cbf04b1223">AST_MODFLAG_LOAD_ORDER</a> , .description = &quot;HTTP WebSocket Support&quot; , .key = &quot;This paragraph is copyright (<a class="el" href="../../d7/d6f/test__linkedlists_8c.html#acd9db00336027462cfb25b97b5356883">c</a>) 2006 by Digium, Inc. \In <a class="el" href="../../d5/d14/voicin_8c.html#aed7ca058008dc3e5ee131e575abed285">order</a> for your module to load, it must return this \key via <a class="el" href="../../d7/d6f/test__linkedlists_8c.html#a13dd15487fee89a002d17ef3aff62d02">a</a> function called \&quot;key\&quot;. Any code which \includes this paragraph must <a class="el" href="../../dd/d7c/eagi__proxy_8c.html#a39730e90126aad69cfc9ca4d6fcdb3a6">be</a> licensed under the GNU \General Public License <a class="el" href="../../da/d7c/utils_2frame_8h.html#a56abfaab87c46691c1ef3ad0df23e864">version</a> 2 or later (at your \option). In addition to Digium's general reservations \of rights, Digium expressly reserves the right to \allow other parties to license this paragraph under \different terms. Any use of Digium, Inc. trademarks or \logos (including \&quot;Asterisk\&quot; or \&quot;Digium\&quot;) without \express written <a class="el" href="../../d4/d4c/structpermission.html">permission</a> of Digium, Inc. is prohibited.\n&quot; , .buildopt_sum = &quot;30ef0c93b36035ec78c9cfd712d36d9b&quot; , .support_level = AST_MODULE_SUPPORT_CORE, .load = load_module, .unload = unload_module, .load_pri = AST_MODPRI_CHANNEL_DEPEND, .requires = &quot;http&quot;, }</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html#l01529">1529</a> of file <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html">res_http_websocket.c</a>.</p>

</div>
</div>
<a id="ad60e83b9aa660040fed4d5377966cc21"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad60e83b9aa660040fed4d5377966cc21">&#9670;&nbsp;</a></span>ast_module_info</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">const struct <a class="el" href="../../dd/d5f/structast__module__info.html">ast_module_info</a>* <a class="el" href="../../dd/d5f/structast__module__info.html">ast_module_info</a> = &amp;<a class="el" href="../../d6/d7a/test__xml__escape_8c.html#ab22f32016155f7f403e7178767163d7d">__mod_info</a></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html#l01529">1529</a> of file <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html">res_http_websocket.c</a>.</p>

</div>
</div>
<a id="af1d68c77bf046bd4cb80e8db01e97f1a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af1d68c77bf046bd4cb80e8db01e97f1a">&#9670;&nbsp;</a></span>opcode_map</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">const char* opcode_map[]</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html#l00354">354</a> of file <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html">res_http_websocket.c</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html#l00363">websocket_opcode2str()</a>.</p>

</div>
</div>
<a id="a250d189c16de52a67daa3ab480eb8aa1"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a250d189c16de52a67daa3ab480eb8aa1">&#9670;&nbsp;</a></span>websocketuri</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="../../d0/d6c/structast__http__uri.html">ast_http_uri</a> websocketuri</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html#l00997">997</a> of file <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html">res_http_websocket.c</a>.</p>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Sun Aug 8 2021 19:46:25 for Asterisk - The Open Source Telephony Project by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="../../doxygen.png" alt="doxygen"/>
</a> 1.8.13
</small></address>
</body>
</html>
