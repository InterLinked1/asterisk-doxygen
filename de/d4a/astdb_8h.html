<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Asterisk - The Open Source Telephony Project: astdb.h File Reference</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Asterisk - The Open Source Telephony Project
   &#160;<span id="projectnumber">18.5.0</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "../../search",false,'Search');
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('../../',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="../../dir_d44c64559bbebec7f509842c48db8b23.html">include</a></li><li class="navelem"><a class="el" href="../../dir_6d4b1cdb59e2db6ad82005b337288fef.html">asterisk</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#nested-classes">Data Structures</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">astdb.h File Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>Persistant data storage (akin to *doze registry)  
<a href="#details">More...</a></p>
<div class="textblock"><div class="dynheader">
This graph shows which files directly or indirectly include this file:</div>
<div class="dyncontent">
<div class="center"><img src="../../dd/d75/astdb_8h__dep__incl.png" border="0" usemap="#astdb_8hdep" alt=""/></div>
<map name="astdb_8hdep" id="astdb_8hdep">
<area shape="rect" id="node2" href="../../dc/d5c/app__alarmreceiver_8c.html" title="Central Station Alarm receiver for Ademco Contact ID. " alt="" coords="5,80,156,107"/>
<area shape="rect" id="node3" href="../../d6/d0f/app__authenticate_8c.html" title="Execute arbitrary authenticate commands. " alt="" coords="180,80,325,107"/>
<area shape="rect" id="node4" href="../../dc/dc4/app__db_8c.html" title="Database access functions. " alt="" coords="350,80,430,107"/>
<area shape="rect" id="node5" href="../../dd/d55/app__followme_8c.html" title="Find&#45;Me Follow&#45;Me application. " alt="" coords="454,80,574,107"/>
<area shape="rect" id="node6" href="../../da/dfb/app__queue_8c.html" title="True call queues with optional send URL on answer. " alt="" coords="598,80,702,107"/>
<area shape="rect" id="node7" href="../../d1/d97/chan__dahdi_8c.html" title="DAHDI for Pseudo TDM. " alt="" coords="726,80,833,107"/>
<area shape="rect" id="node8" href="../../d5/dff/chan__iax2_8c.html" title="Implementation of Inter&#45;Asterisk eXchange Version 2 as specified in RFC 5456. " alt="" coords="857,80,955,107"/>
<area shape="rect" id="node9" href="../../d0/dd6/chan__mgcp_8c.html" title="Implementation of Media Gateway Control Protocol. " alt="" coords="979,80,1086,107"/>
<area shape="rect" id="node10" href="../../d5/dfe/chan__sip_8c.html" title="Implementation of Session Initiation Protocol. " alt="" coords="1111,80,1200,107"/>
<area shape="rect" id="node11" href="../../d0/d80/chan__skinny_8c.html" title="Implementation of the Skinny protocol. " alt="" coords="1225,80,1334,107"/>
<area shape="rect" id="node12" href="../../d1/d6d/chan__unistim_8c.html" title="chan_unistim channel driver for Asterisk " alt="" coords="1359,80,1477,107"/>
<area shape="rect" id="node13" href="../../d8/d4f/provision_8c.html" title="IAX Provisioning Protocol. " alt="" coords="1502,80,1593,107"/>
<area shape="rect" id="node14" href="../../d2/d09/sig__analog_8c.html" title="Analog signaling module. " alt="" coords="1617,80,1718,107"/>
<area shape="rect" id="node15" href="../../d3/dfb/func__blacklist_8c.html" title="Function to lookup the callerid number, and see if it is blacklisted. " alt="" coords="1743,80,1861,107"/>
<area shape="rect" id="node16" href="../../d7/d48/func__db_8c.html" title="Functions for interaction with the Asterisk database. " alt="" coords="1885,80,1967,107"/>
<area shape="rect" id="node17" href="../../d7/d0b/func__devstate_8c.html" title="Manually controlled blinky lights. " alt="" coords="1991,80,2114,107"/>
<area shape="rect" id="node18" href="../../d9/d35/func__dialgroup_8c.html" title="Dial group dialplan function. " alt="" coords="2139,80,2265,107"/>
<area shape="rect" id="node19" href="../../d0/d81/func__presencestate_8c.html" title="Custom presence provider. " alt="" coords="2289,80,2448,107"/>
<area shape="rect" id="node20" href="../../d5/d03/asterisk_8c.html" title="Top level source file for Asterisk &#45; the Open Source PBX. Implementation of PBX core functions and CL..." alt="" coords="2473,80,2555,107"/>
<area shape="rect" id="node21" href="../../da/d21/main_2db_8c.html" title="ASTdb Management. " alt="" coords="2580,80,2629,107"/>
<area shape="rect" id="node22" href="../../df/dfb/media__cache_8c.html" title="An in&#45;memory media cache. " alt="" coords="2653,80,2772,107"/>
<area shape="rect" id="node23" href="../../da/de0/privacy_8c.html" title="Privacy Routines. " alt="" coords="2796,80,2872,107"/>
<area shape="rect" id="node24" href="../../d1/dc0/pbx__dundi_8c.html" title="Distributed Universal Number Discovery (DUNDi) " alt="" coords="2897,80,2995,107"/>
<area shape="rect" id="node25" href="../../d8/d48/pbx__loopback_8c.html" title="Loopback PBX Module. " alt="" coords="3019,80,3139,107"/>
<area shape="rect" id="node26" href="../../d2/d2c/pbx__realtime_8c.html" title="Realtime PBX Module. " alt="" coords="3164,80,3280,107"/>
<area shape="rect" id="node27" href="../../dd/de9/res__agi_8c.html" title="AGI &#45; the Asterisk Gateway Interface. " alt="" coords="3304,80,3383,107"/>
<area shape="rect" id="node28" href="../../d8/dce/res__sorcery__astdb_8c.html" title="Sorcery Astdb Object Wizard. " alt="" coords="3407,80,3557,107"/>
<area shape="rect" id="node29" href="../../dd/d71/res__stasis__device__state_8c.html" title="res_stasis_device_state.c" alt="" coords="3581,80,3767,107"/>
<area shape="rect" id="node30" href="../../d5/daa/res__stasis__mailbox_8c.html" title="res_stasis_mailbox.c" alt="" coords="3791,80,3946,107"/>
<area shape="rect" id="node31" href="../../d9/d2d/res__stir__shaken_8c.html" title="res_stir_shaken.c" alt="" coords="3970,80,4103,107"/>
<area shape="rect" id="node32" href="../../db/dbb/test__db_8c.html" title="AstDB Unit Tests. " alt="" coords="4128,80,4209,107"/>
<area shape="rect" id="node33" href="../../de/d6c/test__sorcery__astdb_8c.html" title="Sorcery Unit Tests. " alt="" coords="4234,80,4389,107"/>
<area shape="rect" id="node34" href="../../d8/d87/test__sorcery__realtime_8c.html" title="Sorcery Unit Tests. " alt="" coords="4413,80,4585,107"/>
</map>
</div>
</div>
<p><a href="../../de/d4a/astdb_8h_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="nested-classes"></a>
Data Structures</h2></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../da/d1d/structast__db__entry.html">ast_db_entry</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a71e8d5ab1757b184683a99125d1c8160"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../de/d4a/astdb_8h.html#a71e8d5ab1757b184683a99125d1c8160">ast_db_del</a> (const char *family, const char *key)</td></tr>
<tr class="memdesc:a71e8d5ab1757b184683a99125d1c8160"><td class="mdescLeft">&#160;</td><td class="mdescRight">Delete entry in astdb.  <a href="#a71e8d5ab1757b184683a99125d1c8160">More...</a><br /></td></tr>
<tr class="separator:a71e8d5ab1757b184683a99125d1c8160"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af251d986cfe884ffd5ca864531253f62"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../de/d4a/astdb_8h.html#af251d986cfe884ffd5ca864531253f62">ast_db_deltree</a> (const char *family, const char *keytree)</td></tr>
<tr class="memdesc:af251d986cfe884ffd5ca864531253f62"><td class="mdescLeft">&#160;</td><td class="mdescRight">Delete one or more entries in astdb.  <a href="#af251d986cfe884ffd5ca864531253f62">More...</a><br /></td></tr>
<tr class="separator:af251d986cfe884ffd5ca864531253f62"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af9ab454a70a91551b2bf6c55199fc514"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../de/d4a/astdb_8h.html#af9ab454a70a91551b2bf6c55199fc514">ast_db_freetree</a> (struct <a class="el" href="../../da/d1d/structast__db__entry.html">ast_db_entry</a> *<a class="el" href="../../d3/d96/structentry.html">entry</a>)</td></tr>
<tr class="memdesc:af9ab454a70a91551b2bf6c55199fc514"><td class="mdescLeft">&#160;</td><td class="mdescRight">Free structure created by <a class="el" href="../../de/d4a/astdb_8h.html#afeb9839f89da4fc24838de74739d181e" title="Get a list of values within the astdb tree. ">ast_db_gettree()</a>  <a href="#af9ab454a70a91551b2bf6c55199fc514">More...</a><br /></td></tr>
<tr class="separator:af9ab454a70a91551b2bf6c55199fc514"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6ab91701fa0db9fad7759fe42a581c17"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../de/d4a/astdb_8h.html#a6ab91701fa0db9fad7759fe42a581c17">ast_db_get</a> (const char *family, const char *key, char *<a class="el" href="../../d5/dde/test__func__file_8c.html#a8556878012feffc9e0beb86cd78f424d">value</a>, int valuelen)</td></tr>
<tr class="memdesc:a6ab91701fa0db9fad7759fe42a581c17"><td class="mdescLeft">&#160;</td><td class="mdescRight">Get key value specified by family/key.  <a href="#a6ab91701fa0db9fad7759fe42a581c17">More...</a><br /></td></tr>
<tr class="separator:a6ab91701fa0db9fad7759fe42a581c17"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a60488b5c3b6fd447d39d58e52172657e"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../de/d4a/astdb_8h.html#a60488b5c3b6fd447d39d58e52172657e">ast_db_get_allocated</a> (const char *family, const char *key, char **<a class="el" href="../../da/d7c/utils_2frame_8h.html#a48bc11919b2752df9d14ce89557cfb25">out</a>)</td></tr>
<tr class="memdesc:a60488b5c3b6fd447d39d58e52172657e"><td class="mdescLeft">&#160;</td><td class="mdescRight">Get key value specified by family/key as a heap allocated string.  <a href="#a60488b5c3b6fd447d39d58e52172657e">More...</a><br /></td></tr>
<tr class="separator:a60488b5c3b6fd447d39d58e52172657e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:afeb9839f89da4fc24838de74739d181e"><td class="memItemLeft" align="right" valign="top">struct <a class="el" href="../../da/d1d/structast__db__entry.html">ast_db_entry</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../de/d4a/astdb_8h.html#afeb9839f89da4fc24838de74739d181e">ast_db_gettree</a> (const char *family, const char *keytree)</td></tr>
<tr class="memdesc:afeb9839f89da4fc24838de74739d181e"><td class="mdescLeft">&#160;</td><td class="mdescRight">Get a list of values within the astdb tree.  <a href="#afeb9839f89da4fc24838de74739d181e">More...</a><br /></td></tr>
<tr class="separator:afeb9839f89da4fc24838de74739d181e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aadc9b80ccfd78701b69d004a09f55b08"><td class="memItemLeft" align="right" valign="top">struct <a class="el" href="../../da/d1d/structast__db__entry.html">ast_db_entry</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../de/d4a/astdb_8h.html#aadc9b80ccfd78701b69d004a09f55b08">ast_db_gettree_by_prefix</a> (const char *family, const char *key_prefix)</td></tr>
<tr class="memdesc:aadc9b80ccfd78701b69d004a09f55b08"><td class="mdescLeft">&#160;</td><td class="mdescRight">Get a list of values with the given key prefix.  <a href="#aadc9b80ccfd78701b69d004a09f55b08">More...</a><br /></td></tr>
<tr class="separator:aadc9b80ccfd78701b69d004a09f55b08"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0f14f6bff4f412c88b50aba34d3a5e35"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../de/d4a/astdb_8h.html#a0f14f6bff4f412c88b50aba34d3a5e35">ast_db_put</a> (const char *family, const char *key, const char *<a class="el" href="../../d5/dde/test__func__file_8c.html#a8556878012feffc9e0beb86cd78f424d">value</a>)</td></tr>
<tr class="memdesc:a0f14f6bff4f412c88b50aba34d3a5e35"><td class="mdescLeft">&#160;</td><td class="mdescRight">Store value addressed by family/key.  <a href="#a0f14f6bff4f412c88b50aba34d3a5e35">More...</a><br /></td></tr>
<tr class="separator:a0f14f6bff4f412c88b50aba34d3a5e35"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Persistant data storage (akin to *doze registry) </p>

<p class="definition">Definition in file <a class="el" href="../../de/d4a/astdb_8h_source.html">astdb.h</a>.</p>
</div><h2 class="groupheader">Function Documentation</h2>
<a id="a71e8d5ab1757b184683a99125d1c8160"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a71e8d5ab1757b184683a99125d1c8160">&#9670;&nbsp;</a></span>ast_db_del()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ast_db_del </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>family</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>key</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Delete entry in astdb. </p>

<p class="definition">Definition at line <a class="el" href="../../da/d21/main_2db_8c_source.html#l00429">429</a> of file <a class="el" href="../../da/d21/main_2db_8c_source.html">main/db.c</a>.</p>

<p class="reference">References <a class="el" href="../../d1/d8c/logger_8h_source.html#l00452">ast_debug</a>, <a class="el" href="../../da/df7/astobj2_8c_source.html#l00042">ast_log</a>, <a class="el" href="../../dd/d42/lock_8h_source.html#l00187">ast_mutex_lock</a>, <a class="el" href="../../dd/d42/lock_8h_source.html#l00188">ast_mutex_unlock</a>, <a class="el" href="../../da/d21/main_2db_8c_source.html#l00110">astdb</a>, <a class="el" href="../../da/d21/main_2db_8c_source.html#l01009">db_sync()</a>, <a class="el" href="../../da/d21/main_2db_8c_source.html#l00108">dblock</a>, <a class="el" href="../../d1/d8c/logger_8h_source.html#l00274">LOG_WARNING</a>, and <a class="el" href="../../da/d21/main_2db_8c_source.html#l00107">MAX_DB_FIELD</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../d5/dff/chan__iax2_8c_source.html#l08898">__expire_registry()</a>, <a class="el" href="../../da/de0/privacy_8c_source.html#l00082">ast_privacy_set()</a>, <a class="el" href="../../db/dbb/test__db_8c_source.html#l00049">AST_TEST_DEFINE()</a>, <a class="el" href="../../d6/d0f/app__authenticate_8c_source.html#l00116">auth_exec()</a>, <a class="el" href="../../d1/dc0/pbx__dundi_8c_source.html#l01170">cache_lookup_internal()</a>, <a class="el" href="../../d1/d97/chan__dahdi_8c_source.html#l13729">dahdi_cc_callback()</a>, <a class="el" href="../../d1/d97/chan__dahdi_8c_source.html#l05667">destroy_all_channels()</a>, <a class="el" href="../../d5/dfe/chan__sip_8c_source.html#l16613">destroy_association()</a>, <a class="el" href="../../d9/d35/func__dialgroup_8c_source.html#l00171">dialgroup_refreshdb()</a>, <a class="el" href="../../d1/dc0/pbx__dundi_8c_source.html#l01321">do_register_expire()</a>, <a class="el" href="../../da/dfb/app__queue_8c_source.html#l07269">dump_queue_members()</a>, <a class="el" href="../../d7/d48/func__db_8c_source.html#l00283">function_db_delete()</a>, <a class="el" href="../../da/d21/main_2db_8c_source.html#l00663">handle_cli_database_del()</a>, <a class="el" href="../../dd/de9/res__agi_8c_source.html#l03334">handle_dbdel()</a>, <a class="el" href="../../da/d21/main_2db_8c_source.html#l00950">manager_dbdel()</a>, <a class="el" href="../../df/dfb/media__cache_8c_source.html#l00114">media_cache_item_del_from_astdb()</a>, <a class="el" href="../../df/dfb/media__cache_8c_source.html#l00392">media_cache_remove_from_astdb()</a>, <a class="el" href="../../d1/d97/chan__dahdi_8c_source.html#l12095">mkintf()</a>, <a class="el" href="../../d0/d81/func__presencestate_8c_source.html#l00705">presence_change_common()</a>, <a class="el" href="../../d1/dc0/pbx__dundi_8c_source.html#l02228">process_clearcache()</a>, <a class="el" href="../../da/dfb/app__queue_8c_source.html#l07771">reload_queue_members()</a>, <a class="el" href="../../d9/d2d/res__stir__shaken_8c_source.html#l00471">remove_public_key_from_astdb()</a>, <a class="el" href="../../d8/dce/res__sorcery__astdb_8c_source.html#l00384">sorcery_astdb_delete()</a>, <a class="el" href="../../dd/d71/res__stasis__device__state_8c_source.html#l00244">stasis_app_device_state_delete()</a>, and <a class="el" href="../../d5/dff/chan__iax2_8c_source.html#l09002">update_registry()</a>.</p>
<div class="fragment"><div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;{</div><div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;   <span class="keywordtype">char</span> fullkey[<a class="code" href="../../da/d21/main_2db_8c.html#afe1f0caaa1c711f16bb23bfcc54ff386">MAX_DB_FIELD</a>];</div><div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;   <span class="keywordtype">size_t</span> fullkey_len;</div><div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;   <span class="keywordtype">int</span> res = 0;</div><div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;</div><div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;   <span class="keywordflow">if</span> (strlen(family) + strlen(key) + 2 &gt; <span class="keyword">sizeof</span>(fullkey) - 1) {</div><div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Family and key length must be less than %zu bytes\n&quot;</span>, <span class="keyword">sizeof</span>(fullkey) - 3);</div><div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;   }</div><div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;</div><div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;   fullkey_len = snprintf(fullkey, <span class="keyword">sizeof</span>(fullkey), <span class="stringliteral">&quot;/%s/%s&quot;</span>, family, key);</div><div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;</div><div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;   <a class="code" href="../../dd/d42/lock_8h.html#ac5e13c7fe64d3b271a52028b0a78b92b">ast_mutex_lock</a>(&amp;<a class="code" href="../../da/d21/main_2db_8c.html#a885611b04f0f81cde233f5648aa58b7c">dblock</a>);</div><div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;   <span class="keywordflow">if</span> (sqlite3_bind_text(del_stmt, 1, fullkey, fullkey_len, SQLITE_STATIC) != SQLITE_OK) {</div><div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Couldn&#39;t bind key to stmt: %s\n&quot;</span>, sqlite3_errmsg(<a class="code" href="../../da/d21/main_2db_8c.html#a59f6376a471012a10b27b3e902256be0">astdb</a>));</div><div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;      res = -1;</div><div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;   } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (sqlite3_step(del_stmt) != SQLITE_DONE) {</div><div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;      <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(1, <span class="stringliteral">&quot;Unable to find key &#39;%s&#39; in family &#39;%s&#39;\n&quot;</span>, key, family);</div><div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;      res = -1;</div><div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;   }</div><div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;   sqlite3_reset(del_stmt);</div><div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;   <a class="code" href="../../da/d21/main_2db_8c.html#a0a19fc05bc020876fec791200e169eb2">db_sync</a>();</div><div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;   <a class="code" href="../../dd/d42/lock_8h.html#a873f9ce8c6287a32d48c83133e124418">ast_mutex_unlock</a>(&amp;<a class="code" href="../../da/d21/main_2db_8c.html#a885611b04f0f81cde233f5648aa58b7c">dblock</a>);</div><div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;</div><div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;   <span class="keywordflow">return</span> res;</div><div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;}</div><div class="ttc" id="logger_8h_html_adf4476a6a4ea6c74231c826e899d7189"><div class="ttname"><a href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a></div><div class="ttdeci">#define LOG_WARNING</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d8c/logger_8h_source.html#l00274">logger.h:274</a></div></div>
<div class="ttc" id="lock_8h_html_ac5e13c7fe64d3b271a52028b0a78b92b"><div class="ttname"><a href="../../dd/d42/lock_8h.html#ac5e13c7fe64d3b271a52028b0a78b92b">ast_mutex_lock</a></div><div class="ttdeci">#define ast_mutex_lock(a)</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d42/lock_8h_source.html#l00187">lock.h:187</a></div></div>
<div class="ttc" id="main_2db_8c_html_a885611b04f0f81cde233f5648aa58b7c"><div class="ttname"><a href="../../da/d21/main_2db_8c.html#a885611b04f0f81cde233f5648aa58b7c">dblock</a></div><div class="ttdeci">static ast_mutex_t dblock</div><div class="ttdef"><b>Definition:</b> <a href="../../da/d21/main_2db_8c_source.html#l00108">main/db.c:108</a></div></div>
<div class="ttc" id="logger_8h_html_a3f248112c8d6ce7e3959aa723dade648"><div class="ttname"><a href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a></div><div class="ttdeci">#define ast_debug(level,...)</div><div class="ttdoc">Log a DEBUG message. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d8c/logger_8h_source.html#l00452">logger.h:452</a></div></div>
<div class="ttc" id="astobj2_8c_html_a96a00b3a518d7f32b6d51dc28f09bf9b"><div class="ttname"><a href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a></div><div class="ttdeci">#define ast_log</div><div class="ttdef"><b>Definition:</b> <a href="../../da/df7/astobj2_8c_source.html#l00042">astobj2.c:42</a></div></div>
<div class="ttc" id="main_2db_8c_html_afe1f0caaa1c711f16bb23bfcc54ff386"><div class="ttname"><a href="../../da/d21/main_2db_8c.html#afe1f0caaa1c711f16bb23bfcc54ff386">MAX_DB_FIELD</a></div><div class="ttdeci">#define MAX_DB_FIELD</div><div class="ttdef"><b>Definition:</b> <a href="../../da/d21/main_2db_8c_source.html#l00107">main/db.c:107</a></div></div>
<div class="ttc" id="main_2db_8c_html_a59f6376a471012a10b27b3e902256be0"><div class="ttname"><a href="../../da/d21/main_2db_8c.html#a59f6376a471012a10b27b3e902256be0">astdb</a></div><div class="ttdeci">static sqlite3 * astdb</div><div class="ttdef"><b>Definition:</b> <a href="../../da/d21/main_2db_8c_source.html#l00110">main/db.c:110</a></div></div>
<div class="ttc" id="main_2db_8c_html_a0a19fc05bc020876fec791200e169eb2"><div class="ttname"><a href="../../da/d21/main_2db_8c.html#a0a19fc05bc020876fec791200e169eb2">db_sync</a></div><div class="ttdeci">static void db_sync(void)</div><div class="ttdef"><b>Definition:</b> <a href="../../da/d21/main_2db_8c_source.html#l01009">main/db.c:1009</a></div></div>
<div class="ttc" id="lock_8h_html_a873f9ce8c6287a32d48c83133e124418"><div class="ttname"><a href="../../dd/d42/lock_8h.html#a873f9ce8c6287a32d48c83133e124418">ast_mutex_unlock</a></div><div class="ttdeci">#define ast_mutex_unlock(a)</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d42/lock_8h_source.html#l00188">lock.h:188</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="af251d986cfe884ffd5ca864531253f62"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af251d986cfe884ffd5ca864531253f62">&#9670;&nbsp;</a></span>ast_db_deltree()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ast_db_deltree </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>family</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>keytree</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Delete one or more entries in astdb. </p>
<p>If both parameters are NULL, the entire database will be purged. If only keytree is NULL, all entries within the family will be purged. It is an error for keytree to have a value when family is NULL.</p>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">-1</td><td>An error occurred </td></tr>
    <tr><td class="paramname">&gt;=</td><td>0 Number of records deleted </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="../../da/d21/main_2db_8c_source.html#l00457">457</a> of file <a class="el" href="../../da/d21/main_2db_8c_source.html">main/db.c</a>.</p>

<p class="reference">References <a class="el" href="../../da/df7/astobj2_8c_source.html#l00042">ast_log</a>, <a class="el" href="../../dd/d42/lock_8h_source.html#l00187">ast_mutex_lock</a>, <a class="el" href="../../dd/d42/lock_8h_source.html#l00188">ast_mutex_unlock</a>, <a class="el" href="../../d6/d90/strings_8h_source.html#l00052">ast_strlen_zero</a>, <a class="el" href="../../da/d21/main_2db_8c_source.html#l00110">astdb</a>, <a class="el" href="../../da/d21/main_2db_8c_source.html#l01009">db_sync()</a>, <a class="el" href="../../da/d21/main_2db_8c_source.html#l00108">dblock</a>, <a class="el" href="../../d1/d8c/logger_8h_source.html#l00274">LOG_WARNING</a>, <a class="el" href="../../da/d21/main_2db_8c_source.html#l00107">MAX_DB_FIELD</a>, and <a class="el" href="../../dd/d43/http_8c_source.html#l00141">prefix</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../da/de0/privacy_8c_source.html#l00075">ast_privacy_reset()</a>, <a class="el" href="../../db/dbb/test__db_8c_source.html#l00099">AST_TEST_DEFINE()</a>, <a class="el" href="../../de/d6c/test__sorcery__astdb_8c_source.html#l00073">deinitialize_sorcery()</a>, <a class="el" href="../../dc/dc4/app__db_8c_source.html#l00066">deltree_exec()</a>, <a class="el" href="../../d1/dc0/pbx__dundi_8c_source.html#l02357">dundi_flush()</a>, <a class="el" href="../../da/d21/main_2db_8c_source.html#l00690">handle_cli_database_deltree()</a>, <a class="el" href="../../dd/de9/res__agi_8c_source.html#l03345">handle_dbdeltree()</a>, <a class="el" href="../../d8/d4f/provision_8c_source.html#l00529">iax_provision_reload()</a>, <a class="el" href="../../da/d21/main_2db_8c_source.html#l00975">manager_dbdeltree()</a>, <a class="el" href="../../df/dfb/media__cache_8c_source.html#l00114">media_cache_item_del_from_astdb()</a>, <a class="el" href="../../df/dfb/media__cache_8c_source.html#l00392">media_cache_remove_from_astdb()</a>, and <a class="el" href="../../d9/d2d/res__stir__shaken_8c_source.html#l00471">remove_public_key_from_astdb()</a>.</p>
<div class="fragment"><div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;{</div><div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;   sqlite3_stmt *stmt = deltree_stmt;</div><div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;   <span class="keywordtype">char</span> <a class="code" href="../../dd/d43/http_8c.html#a6f25bc812d09fedb86bf394c01061c56">prefix</a>[<a class="code" href="../../da/d21/main_2db_8c.html#afe1f0caaa1c711f16bb23bfcc54ff386">MAX_DB_FIELD</a>];</div><div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;   <span class="keywordtype">int</span> res = 0;</div><div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;</div><div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;   <span class="keywordflow">if</span> (!<a class="code" href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a>(family)) {</div><div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;      <span class="keywordflow">if</span> (!<a class="code" href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a>(keytree)) {</div><div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;         <span class="comment">/* Family and key tree */</span></div><div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;         snprintf(prefix, <span class="keyword">sizeof</span>(prefix), <span class="stringliteral">&quot;/%s/%s&quot;</span>, family, keytree);</div><div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;      } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;         <span class="comment">/* Family only */</span></div><div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;         snprintf(prefix, <span class="keyword">sizeof</span>(prefix), <span class="stringliteral">&quot;/%s&quot;</span>, family);</div><div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;      }</div><div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;   } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;      prefix[0] = <span class="charliteral">&#39;\0&#39;</span>;</div><div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;      stmt = deltree_all_stmt;</div><div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;   }</div><div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;</div><div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;   <a class="code" href="../../dd/d42/lock_8h.html#ac5e13c7fe64d3b271a52028b0a78b92b">ast_mutex_lock</a>(&amp;<a class="code" href="../../da/d21/main_2db_8c.html#a885611b04f0f81cde233f5648aa58b7c">dblock</a>);</div><div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;   <span class="keywordflow">if</span> (!<a class="code" href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a>(prefix) &amp;&amp; (sqlite3_bind_text(stmt, 1, prefix, -1, SQLITE_STATIC) != SQLITE_OK)) {</div><div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Could bind %s to stmt: %s\n&quot;</span>, prefix, sqlite3_errmsg(<a class="code" href="../../da/d21/main_2db_8c.html#a59f6376a471012a10b27b3e902256be0">astdb</a>));</div><div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;      res = -1;</div><div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;   } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (sqlite3_step(stmt) != SQLITE_DONE) {</div><div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Couldn&#39;t execute stmt: %s\n&quot;</span>, sqlite3_errmsg(<a class="code" href="../../da/d21/main_2db_8c.html#a59f6376a471012a10b27b3e902256be0">astdb</a>));</div><div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;      res = -1;</div><div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;   }</div><div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;   res = sqlite3_changes(<a class="code" href="../../da/d21/main_2db_8c.html#a59f6376a471012a10b27b3e902256be0">astdb</a>);</div><div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;   sqlite3_reset(stmt);</div><div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;   <a class="code" href="../../da/d21/main_2db_8c.html#a0a19fc05bc020876fec791200e169eb2">db_sync</a>();</div><div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;   <a class="code" href="../../dd/d42/lock_8h.html#a873f9ce8c6287a32d48c83133e124418">ast_mutex_unlock</a>(&amp;<a class="code" href="../../da/d21/main_2db_8c.html#a885611b04f0f81cde233f5648aa58b7c">dblock</a>);</div><div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;</div><div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;   <span class="keywordflow">return</span> res;</div><div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;}</div><div class="ttc" id="logger_8h_html_adf4476a6a4ea6c74231c826e899d7189"><div class="ttname"><a href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a></div><div class="ttdeci">#define LOG_WARNING</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d8c/logger_8h_source.html#l00274">logger.h:274</a></div></div>
<div class="ttc" id="lock_8h_html_ac5e13c7fe64d3b271a52028b0a78b92b"><div class="ttname"><a href="../../dd/d42/lock_8h.html#ac5e13c7fe64d3b271a52028b0a78b92b">ast_mutex_lock</a></div><div class="ttdeci">#define ast_mutex_lock(a)</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d42/lock_8h_source.html#l00187">lock.h:187</a></div></div>
<div class="ttc" id="main_2db_8c_html_a885611b04f0f81cde233f5648aa58b7c"><div class="ttname"><a href="../../da/d21/main_2db_8c.html#a885611b04f0f81cde233f5648aa58b7c">dblock</a></div><div class="ttdeci">static ast_mutex_t dblock</div><div class="ttdef"><b>Definition:</b> <a href="../../da/d21/main_2db_8c_source.html#l00108">main/db.c:108</a></div></div>
<div class="ttc" id="strings_8h_html_a372554b7a2d69a8bd3adac5157672036"><div class="ttname"><a href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a></div><div class="ttdeci">#define ast_strlen_zero(foo)</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d90/strings_8h_source.html#l00052">strings.h:52</a></div></div>
<div class="ttc" id="astobj2_8c_html_a96a00b3a518d7f32b6d51dc28f09bf9b"><div class="ttname"><a href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a></div><div class="ttdeci">#define ast_log</div><div class="ttdef"><b>Definition:</b> <a href="../../da/df7/astobj2_8c_source.html#l00042">astobj2.c:42</a></div></div>
<div class="ttc" id="main_2db_8c_html_afe1f0caaa1c711f16bb23bfcc54ff386"><div class="ttname"><a href="../../da/d21/main_2db_8c.html#afe1f0caaa1c711f16bb23bfcc54ff386">MAX_DB_FIELD</a></div><div class="ttdeci">#define MAX_DB_FIELD</div><div class="ttdef"><b>Definition:</b> <a href="../../da/d21/main_2db_8c_source.html#l00107">main/db.c:107</a></div></div>
<div class="ttc" id="main_2db_8c_html_a59f6376a471012a10b27b3e902256be0"><div class="ttname"><a href="../../da/d21/main_2db_8c.html#a59f6376a471012a10b27b3e902256be0">astdb</a></div><div class="ttdeci">static sqlite3 * astdb</div><div class="ttdef"><b>Definition:</b> <a href="../../da/d21/main_2db_8c_source.html#l00110">main/db.c:110</a></div></div>
<div class="ttc" id="main_2db_8c_html_a0a19fc05bc020876fec791200e169eb2"><div class="ttname"><a href="../../da/d21/main_2db_8c.html#a0a19fc05bc020876fec791200e169eb2">db_sync</a></div><div class="ttdeci">static void db_sync(void)</div><div class="ttdef"><b>Definition:</b> <a href="../../da/d21/main_2db_8c_source.html#l01009">main/db.c:1009</a></div></div>
<div class="ttc" id="lock_8h_html_a873f9ce8c6287a32d48c83133e124418"><div class="ttname"><a href="../../dd/d42/lock_8h.html#a873f9ce8c6287a32d48c83133e124418">ast_mutex_unlock</a></div><div class="ttdeci">#define ast_mutex_unlock(a)</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d42/lock_8h_source.html#l00188">lock.h:188</a></div></div>
<div class="ttc" id="http_8c_html_a6f25bc812d09fedb86bf394c01061c56"><div class="ttname"><a href="../../dd/d43/http_8c.html#a6f25bc812d09fedb86bf394c01061c56">prefix</a></div><div class="ttdeci">static char prefix[MAX_PREFIX]</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d43/http_8c_source.html#l00141">http.c:141</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="af9ab454a70a91551b2bf6c55199fc514"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af9ab454a70a91551b2bf6c55199fc514">&#9670;&nbsp;</a></span>ast_db_freetree()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ast_db_freetree </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="../../da/d1d/structast__db__entry.html">ast_db_entry</a> *&#160;</td>
          <td class="paramname"><em>entry</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Free structure created by <a class="el" href="../../de/d4a/astdb_8h.html#afeb9839f89da4fc24838de74739d181e" title="Get a list of values within the astdb tree. ">ast_db_gettree()</a> </p>

<p class="definition">Definition at line <a class="el" href="../../da/d21/main_2db_8c_source.html#l00598">598</a> of file <a class="el" href="../../da/d21/main_2db_8c_source.html">main/db.c</a>.</p>

<p class="reference">References <a class="el" href="../../d8/d8a/astmm_8h_source.html#l00182">ast_free</a>, <a class="el" href="../../df/d44/app__meetme_8c_source.html#l01092">last</a>, and <a class="el" href="../../de/d4a/astdb_8h_source.html#l00032">ast_db_entry::next</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../db/dbb/test__db_8c_source.html#l00099">AST_TEST_DEFINE()</a>, <a class="el" href="../../d1/dc0/pbx__dundi_8c_source.html#l02955">dundi_show_cache()</a>, <a class="el" href="../../d1/dc0/pbx__dundi_8c_source.html#l03050">dundi_show_hints()</a>, <a class="el" href="../../d7/d48/func__db_8c_source.html#l00228">function_db_keys()</a>, <a class="el" href="../../d7/d0b/func__devstate_8c_source.html#l00194">handle_cli_devstate_list()</a>, <a class="el" href="../../d0/d81/func__presencestate_8c_source.html#l00295">handle_cli_presencestate_list()</a>, <a class="el" href="../../d7/d0b/func__devstate_8c_source.html#l00329">load_module()</a>, <a class="el" href="../../df/dfb/media__cache_8c_source.html#l00406">media_cache_item_populate_from_astdb()</a>, <a class="el" href="../../df/dfb/media__cache_8c_source.html#l00460">media_cache_populate_from_astdb()</a>, <a class="el" href="../../dd/d71/res__stasis__device__state_8c_source.html#l00275">populate_cache()</a>, <a class="el" href="../../d1/dc0/pbx__dundi_8c_source.html#l02228">process_clearcache()</a>, <a class="el" href="../../da/dfb/app__queue_8c_source.html#l07771">reload_queue_members()</a>, <a class="el" href="../../d8/dce/res__sorcery__astdb_8c_source.html#l00135">sorcery_astdb_retrieve_fields_common()</a>, <a class="el" href="../../d8/dce/res__sorcery__astdb_8c_source.html#l00332">sorcery_astdb_retrieve_prefix()</a>, <a class="el" href="../../d8/dce/res__sorcery__astdb_8c_source.html#l00278">sorcery_astdb_retrieve_regex()</a>, and <a class="el" href="../../dd/d71/res__stasis__device__state_8c_source.html#l00168">stasis_app_device_states_to_json()</a>.</p>
<div class="fragment"><div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;{</div><div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../da/d1d/structast__db__entry.html">ast_db_entry</a> *<a class="code" href="../../df/d44/app__meetme_8c.html#ae9dd6bdb4c5c0529195a03583d0d4a8d">last</a>;</div><div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;   <span class="keywordflow">while</span> (dbe) {</div><div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;      last = dbe;</div><div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;      dbe = dbe-&gt;<a class="code" href="../../da/d1d/structast__db__entry.html#a3fee4a0a4bff112e0262fb8d49f41b5e">next</a>;</div><div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;      <a class="code" href="../../d8/d8a/astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(last);</div><div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;   }</div><div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;}</div><div class="ttc" id="structast__db__entry_html_a3fee4a0a4bff112e0262fb8d49f41b5e"><div class="ttname"><a href="../../da/d1d/structast__db__entry.html#a3fee4a0a4bff112e0262fb8d49f41b5e">ast_db_entry::next</a></div><div class="ttdeci">struct ast_db_entry * next</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d4a/astdb_8h_source.html#l00032">astdb.h:32</a></div></div>
<div class="ttc" id="app__meetme_8c_html_ae9dd6bdb4c5c0529195a03583d0d4a8d"><div class="ttname"><a href="../../df/d44/app__meetme_8c.html#ae9dd6bdb4c5c0529195a03583d0d4a8d">last</a></div><div class="ttdeci">struct sla_ringing_trunk * last</div><div class="ttdef"><b>Definition:</b> <a href="../../df/d44/app__meetme_8c_source.html#l01092">app_meetme.c:1092</a></div></div>
<div class="ttc" id="structast__db__entry_html"><div class="ttname"><a href="../../da/d1d/structast__db__entry.html">ast_db_entry</a></div><div class="ttdef"><b>Definition:</b> <a href="../../de/d4a/astdb_8h_source.html#l00031">astdb.h:31</a></div></div>
<div class="ttc" id="astmm_8h_html_a402072d6789f6ed9e3a81da27504127e"><div class="ttname"><a href="../../d8/d8a/astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a></div><div class="ttdeci">#define ast_free(a)</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d8a/astmm_8h_source.html#l00182">astmm.h:182</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a6ab91701fa0db9fad7759fe42a581c17"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6ab91701fa0db9fad7759fe42a581c17">&#9670;&nbsp;</a></span>ast_db_get()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ast_db_get </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>family</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>key</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>value</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>valuelen</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Get key value specified by family/key. </p>

<p class="definition">Definition at line <a class="el" href="../../da/d21/main_2db_8c_source.html#l00412">412</a> of file <a class="el" href="../../da/d21/main_2db_8c_source.html">main/db.c</a>.</p>

<p class="reference">References <a class="el" href="../../d5/d60/utils_8h_source.html#l00695">ast_assert</a>, <a class="el" href="../../da/d21/main_2db_8c_source.html#l00373">db_get_common()</a>, and <a class="el" href="../../dc/d7f/resample_8c_source.html#l00096">NULL</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../d5/d03/asterisk_8c_source.html#l00934">ast_pbx_uuid_get()</a>, <a class="el" href="../../da/de0/privacy_8c_source.html#l00046">ast_privacy_check()</a>, <a class="el" href="../../db/dbb/test__db_8c_source.html#l00049">AST_TEST_DEFINE()</a>, <a class="el" href="../../d6/d0f/app__authenticate_8c_source.html#l00116">auth_exec()</a>, <a class="el" href="../../d3/dfb/func__blacklist_8c_source.html#l00057">blacklist_read()</a>, <a class="el" href="../../d1/dc0/pbx__dundi_8c_source.html#l01170">cache_lookup_internal()</a>, <a class="el" href="../../d5/dff/chan__iax2_8c_source.html#l07787">check_access()</a>, <a class="el" href="../../d5/dff/chan__iax2_8c_source.html#l04608">create_addr()</a>, <a class="el" href="../../d7/d0b/func__devstate_8c_source.html#l00184">custom_devstate_callback()</a>, <a class="el" href="../../d0/d81/func__presencestate_8c_source.html#l00248">custom_presence_callback()</a>, <a class="el" href="../../dc/d5c/app__alarmreceiver_8c_source.html#l00208">database_increment()</a>, <a class="el" href="../../d1/d97/chan__dahdi_8c_source.html#l05667">destroy_all_channels()</a>, <a class="el" href="../../d7/d48/func__db_8c_source.html#l00283">function_db_delete()</a>, <a class="el" href="../../d7/d48/func__db_8c_source.html#l00190">function_db_exists()</a>, <a class="el" href="../../d7/d48/func__db_8c_source.html#l00126">function_db_read()</a>, <a class="el" href="../../d9/d2d/res__stir__shaken_8c_source.html#l00434">get_path_to_public_key()</a>, <a class="el" href="../../da/d21/main_2db_8c_source.html#l00635">handle_cli_database_get()</a>, <a class="el" href="../../dd/de9/res__agi_8c_source.html#l03290">handle_dbget()</a>, <a class="el" href="../../d8/d4f/provision_8c_source.html#l00258">iax_provision_version()</a>, <a class="el" href="../../d1/dc0/pbx__dundi_8c_source.html#l02138">load_password()</a>, <a class="el" href="../../da/d21/main_2db_8c_source.html#l00908">manager_dbget()</a>, <a class="el" href="../../d1/d97/chan__dahdi_8c_source.html#l12095">mkintf()</a>, <a class="el" href="../../d1/dc0/pbx__dundi_8c_source.html#l04588">populate_addr()</a>, <a class="el" href="../../d9/d2d/res__stir__shaken_8c_source.html#l00405">public_key_is_expired()</a>, <a class="el" href="../../d1/d6d/chan__unistim_8c_source.html#l01321">refresh_all_favorite()</a>, <a class="el" href="../../d5/dff/chan__iax2_8c_source.html#l08948">reg_source_db()</a>, <a class="el" href="../../d9/d2d/res__stir__shaken_8c_source.html#l00471">remove_public_key_from_astdb()</a>, <a class="el" href="../../d8/dce/res__sorcery__astdb_8c_source.html#l00384">sorcery_astdb_delete()</a>, <a class="el" href="../../d8/dce/res__sorcery__astdb_8c_source.html#l00368">sorcery_astdb_update()</a>, and <a class="el" href="../../dd/d71/res__stasis__device__state_8c_source.html#l00292">stasis_device_state_cb()</a>.</p>
<div class="fragment"><div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;{</div><div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;   <a class="code" href="../../d5/d60/utils_8h.html#a24374da24af1931d8a7ccde5b352bb2c">ast_assert</a>(<a class="code" href="../../d4/d2f/syslog_8c.html#ac4f474c82e82cbb89ca7c36dd52be0ed">value</a> != <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div><div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;</div><div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;   <span class="comment">/* Make sure we initialize */</span></div><div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;   <a class="code" href="../../d4/d2f/syslog_8c.html#ac4f474c82e82cbb89ca7c36dd52be0ed">value</a>[0] = 0;</div><div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;</div><div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;   <span class="keywordflow">return</span> <a class="code" href="../../da/d21/main_2db_8c.html#ae6b28eed96c88f9a9848f9121608699d">db_get_common</a>(family, <a class="code" href="../../da/d1d/structast__db__entry.html#a5892a9181e6a332f84d27aecd41dcd12">key</a>, &amp;<a class="code" href="../../d4/d2f/syslog_8c.html#ac4f474c82e82cbb89ca7c36dd52be0ed">value</a>, valuelen);</div><div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;}</div><div class="ttc" id="main_2db_8c_html_ae6b28eed96c88f9a9848f9121608699d"><div class="ttname"><a href="../../da/d21/main_2db_8c.html#ae6b28eed96c88f9a9848f9121608699d">db_get_common</a></div><div class="ttdeci">static int db_get_common(const char *family, const char *key, char **buffer, int bufferlen)</div><div class="ttdef"><b>Definition:</b> <a href="../../da/d21/main_2db_8c_source.html#l00373">main/db.c:373</a></div></div>
<div class="ttc" id="utils_8h_html_a24374da24af1931d8a7ccde5b352bb2c"><div class="ttname"><a href="../../d5/d60/utils_8h.html#a24374da24af1931d8a7ccde5b352bb2c">ast_assert</a></div><div class="ttdeci">#define ast_assert(a)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d60/utils_8h_source.html#l00695">utils.h:695</a></div></div>
<div class="ttc" id="resample_8c_html_a070d2ce7b6bb7e5c05602aa8c308d0c4"><div class="ttname"><a href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a></div><div class="ttdeci">#define NULL</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d7f/resample_8c_source.html#l00096">resample.c:96</a></div></div>
<div class="ttc" id="syslog_8c_html_ac4f474c82e82cbb89ca7c36dd52be0ed"><div class="ttname"><a href="../../d4/d2f/syslog_8c.html#ac4f474c82e82cbb89ca7c36dd52be0ed">value</a></div><div class="ttdeci">int value</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d2f/syslog_8c_source.html#l00037">syslog.c:37</a></div></div>
<div class="ttc" id="structast__db__entry_html_a5892a9181e6a332f84d27aecd41dcd12"><div class="ttname"><a href="../../da/d1d/structast__db__entry.html#a5892a9181e6a332f84d27aecd41dcd12">ast_db_entry::key</a></div><div class="ttdeci">char * key</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d4a/astdb_8h_source.html#l00033">astdb.h:33</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a60488b5c3b6fd447d39d58e52172657e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a60488b5c3b6fd447d39d58e52172657e">&#9670;&nbsp;</a></span>ast_db_get_allocated()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ast_db_get_allocated </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>family</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>key</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char **&#160;</td>
          <td class="paramname"><em>out</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Get key value specified by family/key as a heap allocated string. </p>
<p>Given a <em>family</em> and <em>key</em>, sets <em>out</em> to a pointer to a heap allocated string. In the event of an error, <em>out</em> will be set to NULL. The string must be freed by calling <a class="el" href="../../d8/d8a/astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free()</a>.</p>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">-1</td><td>An error occurred </td></tr>
    <tr><td class="paramname">0</td><td>Success </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="../../da/d21/main_2db_8c_source.html#l00422">422</a> of file <a class="el" href="../../da/d21/main_2db_8c_source.html">main/db.c</a>.</p>

<p class="reference">References <a class="el" href="../../da/d21/main_2db_8c_source.html#l00373">db_get_common()</a>, and <a class="el" href="../../dc/d7f/resample_8c_source.html#l00096">NULL</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../db/dbb/test__db_8c_source.html#l00234">AST_TEST_DEFINE()</a>, <a class="el" href="../../df/dfb/media__cache_8c_source.html#l00114">media_cache_item_del_from_astdb()</a>, <a class="el" href="../../da/dfb/app__queue_8c_source.html#l07771">reload_queue_members()</a>, and <a class="el" href="../../d8/dce/res__sorcery__astdb_8c_source.html#l00191">sorcery_astdb_retrieve_id()</a>.</p>
<div class="fragment"><div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;{</div><div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;   *<a class="code" href="../../d6/d47/utils_2frame_8c.html#a48bc11919b2752df9d14ce89557cfb25">out</a> = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;</div><div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;   <span class="keywordflow">return</span> <a class="code" href="../../da/d21/main_2db_8c.html#ae6b28eed96c88f9a9848f9121608699d">db_get_common</a>(family, <a class="code" href="../../da/d1d/structast__db__entry.html#a5892a9181e6a332f84d27aecd41dcd12">key</a>, <a class="code" href="../../d6/d47/utils_2frame_8c.html#a48bc11919b2752df9d14ce89557cfb25">out</a>, -1);</div><div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;}</div><div class="ttc" id="main_2db_8c_html_ae6b28eed96c88f9a9848f9121608699d"><div class="ttname"><a href="../../da/d21/main_2db_8c.html#ae6b28eed96c88f9a9848f9121608699d">db_get_common</a></div><div class="ttdeci">static int db_get_common(const char *family, const char *key, char **buffer, int bufferlen)</div><div class="ttdef"><b>Definition:</b> <a href="../../da/d21/main_2db_8c_source.html#l00373">main/db.c:373</a></div></div>
<div class="ttc" id="resample_8c_html_a070d2ce7b6bb7e5c05602aa8c308d0c4"><div class="ttname"><a href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a></div><div class="ttdeci">#define NULL</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d7f/resample_8c_source.html#l00096">resample.c:96</a></div></div>
<div class="ttc" id="utils_2frame_8c_html_a48bc11919b2752df9d14ce89557cfb25"><div class="ttname"><a href="../../d6/d47/utils_2frame_8c.html#a48bc11919b2752df9d14ce89557cfb25">out</a></div><div class="ttdeci">FILE * out</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d47/utils_2frame_8c_source.html#l00033">utils/frame.c:33</a></div></div>
<div class="ttc" id="structast__db__entry_html_a5892a9181e6a332f84d27aecd41dcd12"><div class="ttname"><a href="../../da/d1d/structast__db__entry.html#a5892a9181e6a332f84d27aecd41dcd12">ast_db_entry::key</a></div><div class="ttdeci">char * key</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d4a/astdb_8h_source.html#l00033">astdb.h:33</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="afeb9839f89da4fc24838de74739d181e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#afeb9839f89da4fc24838de74739d181e">&#9670;&nbsp;</a></span>ast_db_gettree()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="../../da/d1d/structast__db__entry.html">ast_db_entry</a>* ast_db_gettree </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>family</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>keytree</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Get a list of values within the astdb tree. </p>
<p>If family is specified, only those keys will be returned. If keytree is specified, subkeys are expected to exist (separated from the key with a slash). If subkeys do not exist and keytree is specified, the tree will consist of either a single entry or NULL will be returned.</p>
<p>Resulting tree should be freed by passing the return value to <a class="el" href="../../de/d4a/astdb_8h.html#af9ab454a70a91551b2bf6c55199fc514" title="Free structure created by ast_db_gettree() ">ast_db_freetree()</a> when usage is concluded. </p>

<p class="definition">Definition at line <a class="el" href="../../da/d21/main_2db_8c_source.html#l00531">531</a> of file <a class="el" href="../../da/d21/main_2db_8c_source.html">main/db.c</a>.</p>

<p class="reference">References <a class="el" href="../../da/df7/astobj2_8c_source.html#l00042">ast_log</a>, <a class="el" href="../../dd/d42/lock_8h_source.html#l00187">ast_mutex_lock</a>, <a class="el" href="../../dd/d42/lock_8h_source.html#l00188">ast_mutex_unlock</a>, <a class="el" href="../../d6/d90/strings_8h_source.html#l00052">ast_strlen_zero</a>, <a class="el" href="../../da/d21/main_2db_8c_source.html#l00110">astdb</a>, <a class="el" href="../../da/d21/main_2db_8c_source.html#l00492">db_gettree_common()</a>, <a class="el" href="../../da/d21/main_2db_8c_source.html#l00108">dblock</a>, <a class="el" href="../../d1/d8c/logger_8h_source.html#l00274">LOG_WARNING</a>, <a class="el" href="../../da/d21/main_2db_8c_source.html#l00107">MAX_DB_FIELD</a>, <a class="el" href="../../dc/d7f/resample_8c_source.html#l00096">NULL</a>, and <a class="el" href="../../dd/d43/http_8c_source.html#l00141">prefix</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../db/dbb/test__db_8c_source.html#l00099">AST_TEST_DEFINE()</a>, <a class="el" href="../../d1/dc0/pbx__dundi_8c_source.html#l02955">dundi_show_cache()</a>, <a class="el" href="../../d1/dc0/pbx__dundi_8c_source.html#l03050">dundi_show_hints()</a>, <a class="el" href="../../d7/d48/func__db_8c_source.html#l00228">function_db_keys()</a>, <a class="el" href="../../d7/d0b/func__devstate_8c_source.html#l00194">handle_cli_devstate_list()</a>, <a class="el" href="../../d0/d81/func__presencestate_8c_source.html#l00295">handle_cli_presencestate_list()</a>, <a class="el" href="../../d7/d0b/func__devstate_8c_source.html#l00329">load_module()</a>, <a class="el" href="../../df/dfb/media__cache_8c_source.html#l00406">media_cache_item_populate_from_astdb()</a>, <a class="el" href="../../df/dfb/media__cache_8c_source.html#l00460">media_cache_populate_from_astdb()</a>, <a class="el" href="../../dd/d71/res__stasis__device__state_8c_source.html#l00275">populate_cache()</a>, <a class="el" href="../../d1/dc0/pbx__dundi_8c_source.html#l02228">process_clearcache()</a>, <a class="el" href="../../da/dfb/app__queue_8c_source.html#l07771">reload_queue_members()</a>, <a class="el" href="../../d8/dce/res__sorcery__astdb_8c_source.html#l00135">sorcery_astdb_retrieve_fields_common()</a>, <a class="el" href="../../d8/dce/res__sorcery__astdb_8c_source.html#l00278">sorcery_astdb_retrieve_regex()</a>, and <a class="el" href="../../dd/d71/res__stasis__device__state_8c_source.html#l00168">stasis_app_device_states_to_json()</a>.</p>
<div class="fragment"><div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;{</div><div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;   <span class="keywordtype">char</span> <a class="code" href="../../dd/d43/http_8c.html#a6f25bc812d09fedb86bf394c01061c56">prefix</a>[<a class="code" href="../../da/d21/main_2db_8c.html#afe1f0caaa1c711f16bb23bfcc54ff386">MAX_DB_FIELD</a>];</div><div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;   sqlite3_stmt *stmt = gettree_stmt;</div><div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;   <span class="keywordtype">size_t</span> res = 0;</div><div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../da/d1d/structast__db__entry.html">ast_db_entry</a> *ret;</div><div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;</div><div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;   <span class="keywordflow">if</span> (!<a class="code" href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a>(family)) {</div><div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;      <span class="keywordflow">if</span> (!<a class="code" href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a>(keytree)) {</div><div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;         <span class="comment">/* Family and key tree */</span></div><div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;         res = snprintf(prefix, <span class="keyword">sizeof</span>(prefix), <span class="stringliteral">&quot;/%s/%s&quot;</span>, family, keytree);</div><div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;      } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;         <span class="comment">/* Family only */</span></div><div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;         res = snprintf(prefix, <span class="keyword">sizeof</span>(prefix), <span class="stringliteral">&quot;/%s&quot;</span>, family);</div><div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;      }</div><div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;</div><div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;      <span class="keywordflow">if</span> (res &gt;= <span class="keyword">sizeof</span>(prefix)) {</div><div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;         <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Requested prefix is too long: %s\n&quot;</span>, keytree);</div><div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;         <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;      }</div><div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;   } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;      prefix[0] = <span class="charliteral">&#39;\0&#39;</span>;</div><div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;      stmt = gettree_all_stmt;</div><div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;   }</div><div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;</div><div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;   <a class="code" href="../../dd/d42/lock_8h.html#ac5e13c7fe64d3b271a52028b0a78b92b">ast_mutex_lock</a>(&amp;<a class="code" href="../../da/d21/main_2db_8c.html#a885611b04f0f81cde233f5648aa58b7c">dblock</a>);</div><div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;   <span class="keywordflow">if</span> (res &amp;&amp; (sqlite3_bind_text(stmt, 1, prefix, res, SQLITE_STATIC) != SQLITE_OK)) {</div><div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Could not bind %s to stmt: %s\n&quot;</span>, prefix, sqlite3_errmsg(<a class="code" href="../../da/d21/main_2db_8c.html#a59f6376a471012a10b27b3e902256be0">astdb</a>));</div><div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;      sqlite3_reset(stmt);</div><div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;      <a class="code" href="../../dd/d42/lock_8h.html#a873f9ce8c6287a32d48c83133e124418">ast_mutex_unlock</a>(&amp;<a class="code" href="../../da/d21/main_2db_8c.html#a885611b04f0f81cde233f5648aa58b7c">dblock</a>);</div><div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;   }</div><div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;</div><div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;   ret = <a class="code" href="../../da/d21/main_2db_8c.html#a332d50e70dcfd68a970533f20cdba278">db_gettree_common</a>(stmt);</div><div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;   sqlite3_reset(stmt);</div><div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;   <a class="code" href="../../dd/d42/lock_8h.html#a873f9ce8c6287a32d48c83133e124418">ast_mutex_unlock</a>(&amp;<a class="code" href="../../da/d21/main_2db_8c.html#a885611b04f0f81cde233f5648aa58b7c">dblock</a>);</div><div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;</div><div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;   <span class="keywordflow">return</span> ret;</div><div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;}</div><div class="ttc" id="logger_8h_html_adf4476a6a4ea6c74231c826e899d7189"><div class="ttname"><a href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a></div><div class="ttdeci">#define LOG_WARNING</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d8c/logger_8h_source.html#l00274">logger.h:274</a></div></div>
<div class="ttc" id="lock_8h_html_ac5e13c7fe64d3b271a52028b0a78b92b"><div class="ttname"><a href="../../dd/d42/lock_8h.html#ac5e13c7fe64d3b271a52028b0a78b92b">ast_mutex_lock</a></div><div class="ttdeci">#define ast_mutex_lock(a)</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d42/lock_8h_source.html#l00187">lock.h:187</a></div></div>
<div class="ttc" id="resample_8c_html_a070d2ce7b6bb7e5c05602aa8c308d0c4"><div class="ttname"><a href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a></div><div class="ttdeci">#define NULL</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d7f/resample_8c_source.html#l00096">resample.c:96</a></div></div>
<div class="ttc" id="main_2db_8c_html_a885611b04f0f81cde233f5648aa58b7c"><div class="ttname"><a href="../../da/d21/main_2db_8c.html#a885611b04f0f81cde233f5648aa58b7c">dblock</a></div><div class="ttdeci">static ast_mutex_t dblock</div><div class="ttdef"><b>Definition:</b> <a href="../../da/d21/main_2db_8c_source.html#l00108">main/db.c:108</a></div></div>
<div class="ttc" id="strings_8h_html_a372554b7a2d69a8bd3adac5157672036"><div class="ttname"><a href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a></div><div class="ttdeci">#define ast_strlen_zero(foo)</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d90/strings_8h_source.html#l00052">strings.h:52</a></div></div>
<div class="ttc" id="astobj2_8c_html_a96a00b3a518d7f32b6d51dc28f09bf9b"><div class="ttname"><a href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a></div><div class="ttdeci">#define ast_log</div><div class="ttdef"><b>Definition:</b> <a href="../../da/df7/astobj2_8c_source.html#l00042">astobj2.c:42</a></div></div>
<div class="ttc" id="main_2db_8c_html_a332d50e70dcfd68a970533f20cdba278"><div class="ttname"><a href="../../da/d21/main_2db_8c.html#a332d50e70dcfd68a970533f20cdba278">db_gettree_common</a></div><div class="ttdeci">static struct ast_db_entry * db_gettree_common(sqlite3_stmt *stmt)</div><div class="ttdef"><b>Definition:</b> <a href="../../da/d21/main_2db_8c_source.html#l00492">main/db.c:492</a></div></div>
<div class="ttc" id="main_2db_8c_html_afe1f0caaa1c711f16bb23bfcc54ff386"><div class="ttname"><a href="../../da/d21/main_2db_8c.html#afe1f0caaa1c711f16bb23bfcc54ff386">MAX_DB_FIELD</a></div><div class="ttdeci">#define MAX_DB_FIELD</div><div class="ttdef"><b>Definition:</b> <a href="../../da/d21/main_2db_8c_source.html#l00107">main/db.c:107</a></div></div>
<div class="ttc" id="structast__db__entry_html"><div class="ttname"><a href="../../da/d1d/structast__db__entry.html">ast_db_entry</a></div><div class="ttdef"><b>Definition:</b> <a href="../../de/d4a/astdb_8h_source.html#l00031">astdb.h:31</a></div></div>
<div class="ttc" id="main_2db_8c_html_a59f6376a471012a10b27b3e902256be0"><div class="ttname"><a href="../../da/d21/main_2db_8c.html#a59f6376a471012a10b27b3e902256be0">astdb</a></div><div class="ttdeci">static sqlite3 * astdb</div><div class="ttdef"><b>Definition:</b> <a href="../../da/d21/main_2db_8c_source.html#l00110">main/db.c:110</a></div></div>
<div class="ttc" id="lock_8h_html_a873f9ce8c6287a32d48c83133e124418"><div class="ttname"><a href="../../dd/d42/lock_8h.html#a873f9ce8c6287a32d48c83133e124418">ast_mutex_unlock</a></div><div class="ttdeci">#define ast_mutex_unlock(a)</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d42/lock_8h_source.html#l00188">lock.h:188</a></div></div>
<div class="ttc" id="http_8c_html_a6f25bc812d09fedb86bf394c01061c56"><div class="ttname"><a href="../../dd/d43/http_8c.html#a6f25bc812d09fedb86bf394c01061c56">prefix</a></div><div class="ttdeci">static char prefix[MAX_PREFIX]</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d43/http_8c_source.html#l00141">http.c:141</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="aadc9b80ccfd78701b69d004a09f55b08"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aadc9b80ccfd78701b69d004a09f55b08">&#9670;&nbsp;</a></span>ast_db_gettree_by_prefix()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="../../da/d1d/structast__db__entry.html">ast_db_entry</a>* ast_db_gettree_by_prefix </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>family</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>key_prefix</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Get a list of values with the given key prefix. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">family</td><td>The family to search under </td></tr>
    <tr><td class="paramname">key_prefix</td><td>The key prefix to search under</td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">NULL</td><td>An error occurred </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="../../da/d21/main_2db_8c_source.html#l00571">571</a> of file <a class="el" href="../../da/d21/main_2db_8c_source.html">main/db.c</a>.</p>

<p class="reference">References <a class="el" href="../../da/df7/astobj2_8c_source.html#l00042">ast_log</a>, <a class="el" href="../../dd/d42/lock_8h_source.html#l00187">ast_mutex_lock</a>, <a class="el" href="../../dd/d42/lock_8h_source.html#l00188">ast_mutex_unlock</a>, <a class="el" href="../../da/d21/main_2db_8c_source.html#l00110">astdb</a>, <a class="el" href="../../da/d21/main_2db_8c_source.html#l00492">db_gettree_common()</a>, <a class="el" href="../../da/d21/main_2db_8c_source.html#l00108">dblock</a>, <a class="el" href="../../d1/d8c/logger_8h_source.html#l00274">LOG_WARNING</a>, <a class="el" href="../../da/d21/main_2db_8c_source.html#l00107">MAX_DB_FIELD</a>, <a class="el" href="../../dc/d7f/resample_8c_source.html#l00096">NULL</a>, and <a class="el" href="../../dd/d43/http_8c_source.html#l00141">prefix</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../d8/dce/res__sorcery__astdb_8c_source.html#l00332">sorcery_astdb_retrieve_prefix()</a>.</p>
<div class="fragment"><div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;{</div><div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;   <span class="keywordtype">char</span> <a class="code" href="../../dd/d43/http_8c.html#a6f25bc812d09fedb86bf394c01061c56">prefix</a>[<a class="code" href="../../da/d21/main_2db_8c.html#afe1f0caaa1c711f16bb23bfcc54ff386">MAX_DB_FIELD</a>];</div><div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;   <span class="keywordtype">size_t</span> res;</div><div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../da/d1d/structast__db__entry.html">ast_db_entry</a> *ret;</div><div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;</div><div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;   res = snprintf(prefix, <span class="keyword">sizeof</span>(prefix), <span class="stringliteral">&quot;/%s/%s&quot;</span>, family, key_prefix);</div><div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;   <span class="keywordflow">if</span> (res &gt;= <span class="keyword">sizeof</span>(prefix)) {</div><div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Requested key prefix is too long: %s\n&quot;</span>, key_prefix);</div><div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;   }</div><div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;</div><div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;   <a class="code" href="../../dd/d42/lock_8h.html#ac5e13c7fe64d3b271a52028b0a78b92b">ast_mutex_lock</a>(&amp;<a class="code" href="../../da/d21/main_2db_8c.html#a885611b04f0f81cde233f5648aa58b7c">dblock</a>);</div><div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;   <span class="keywordflow">if</span> (sqlite3_bind_text(gettree_prefix_stmt, 1, prefix, res, SQLITE_STATIC) != SQLITE_OK) {</div><div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Could not bind %s to stmt: %s\n&quot;</span>, prefix, sqlite3_errmsg(<a class="code" href="../../da/d21/main_2db_8c.html#a59f6376a471012a10b27b3e902256be0">astdb</a>));</div><div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;      sqlite3_reset(gettree_prefix_stmt);</div><div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;      <a class="code" href="../../dd/d42/lock_8h.html#a873f9ce8c6287a32d48c83133e124418">ast_mutex_unlock</a>(&amp;<a class="code" href="../../da/d21/main_2db_8c.html#a885611b04f0f81cde233f5648aa58b7c">dblock</a>);</div><div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;   }</div><div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;</div><div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;   ret = <a class="code" href="../../da/d21/main_2db_8c.html#a332d50e70dcfd68a970533f20cdba278">db_gettree_common</a>(gettree_prefix_stmt);</div><div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;   sqlite3_reset(gettree_prefix_stmt);</div><div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;   <a class="code" href="../../dd/d42/lock_8h.html#a873f9ce8c6287a32d48c83133e124418">ast_mutex_unlock</a>(&amp;<a class="code" href="../../da/d21/main_2db_8c.html#a885611b04f0f81cde233f5648aa58b7c">dblock</a>);</div><div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;</div><div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;   <span class="keywordflow">return</span> ret;</div><div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;}</div><div class="ttc" id="logger_8h_html_adf4476a6a4ea6c74231c826e899d7189"><div class="ttname"><a href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a></div><div class="ttdeci">#define LOG_WARNING</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d8c/logger_8h_source.html#l00274">logger.h:274</a></div></div>
<div class="ttc" id="lock_8h_html_ac5e13c7fe64d3b271a52028b0a78b92b"><div class="ttname"><a href="../../dd/d42/lock_8h.html#ac5e13c7fe64d3b271a52028b0a78b92b">ast_mutex_lock</a></div><div class="ttdeci">#define ast_mutex_lock(a)</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d42/lock_8h_source.html#l00187">lock.h:187</a></div></div>
<div class="ttc" id="resample_8c_html_a070d2ce7b6bb7e5c05602aa8c308d0c4"><div class="ttname"><a href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a></div><div class="ttdeci">#define NULL</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d7f/resample_8c_source.html#l00096">resample.c:96</a></div></div>
<div class="ttc" id="main_2db_8c_html_a885611b04f0f81cde233f5648aa58b7c"><div class="ttname"><a href="../../da/d21/main_2db_8c.html#a885611b04f0f81cde233f5648aa58b7c">dblock</a></div><div class="ttdeci">static ast_mutex_t dblock</div><div class="ttdef"><b>Definition:</b> <a href="../../da/d21/main_2db_8c_source.html#l00108">main/db.c:108</a></div></div>
<div class="ttc" id="astobj2_8c_html_a96a00b3a518d7f32b6d51dc28f09bf9b"><div class="ttname"><a href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a></div><div class="ttdeci">#define ast_log</div><div class="ttdef"><b>Definition:</b> <a href="../../da/df7/astobj2_8c_source.html#l00042">astobj2.c:42</a></div></div>
<div class="ttc" id="main_2db_8c_html_a332d50e70dcfd68a970533f20cdba278"><div class="ttname"><a href="../../da/d21/main_2db_8c.html#a332d50e70dcfd68a970533f20cdba278">db_gettree_common</a></div><div class="ttdeci">static struct ast_db_entry * db_gettree_common(sqlite3_stmt *stmt)</div><div class="ttdef"><b>Definition:</b> <a href="../../da/d21/main_2db_8c_source.html#l00492">main/db.c:492</a></div></div>
<div class="ttc" id="main_2db_8c_html_afe1f0caaa1c711f16bb23bfcc54ff386"><div class="ttname"><a href="../../da/d21/main_2db_8c.html#afe1f0caaa1c711f16bb23bfcc54ff386">MAX_DB_FIELD</a></div><div class="ttdeci">#define MAX_DB_FIELD</div><div class="ttdef"><b>Definition:</b> <a href="../../da/d21/main_2db_8c_source.html#l00107">main/db.c:107</a></div></div>
<div class="ttc" id="structast__db__entry_html"><div class="ttname"><a href="../../da/d1d/structast__db__entry.html">ast_db_entry</a></div><div class="ttdef"><b>Definition:</b> <a href="../../de/d4a/astdb_8h_source.html#l00031">astdb.h:31</a></div></div>
<div class="ttc" id="main_2db_8c_html_a59f6376a471012a10b27b3e902256be0"><div class="ttname"><a href="../../da/d21/main_2db_8c.html#a59f6376a471012a10b27b3e902256be0">astdb</a></div><div class="ttdeci">static sqlite3 * astdb</div><div class="ttdef"><b>Definition:</b> <a href="../../da/d21/main_2db_8c_source.html#l00110">main/db.c:110</a></div></div>
<div class="ttc" id="lock_8h_html_a873f9ce8c6287a32d48c83133e124418"><div class="ttname"><a href="../../dd/d42/lock_8h.html#a873f9ce8c6287a32d48c83133e124418">ast_mutex_unlock</a></div><div class="ttdeci">#define ast_mutex_unlock(a)</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d42/lock_8h_source.html#l00188">lock.h:188</a></div></div>
<div class="ttc" id="http_8c_html_a6f25bc812d09fedb86bf394c01061c56"><div class="ttname"><a href="../../dd/d43/http_8c.html#a6f25bc812d09fedb86bf394c01061c56">prefix</a></div><div class="ttdeci">static char prefix[MAX_PREFIX]</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d43/http_8c_source.html#l00141">http.c:141</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a0f14f6bff4f412c88b50aba34d3a5e35"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0f14f6bff4f412c88b50aba34d3a5e35">&#9670;&nbsp;</a></span>ast_db_put()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ast_db_put </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>family</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>key</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>value</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Store value addressed by family/key. </p>

<p class="definition">Definition at line <a class="el" href="../../da/d21/main_2db_8c_source.html#l00327">327</a> of file <a class="el" href="../../da/d21/main_2db_8c_source.html">main/db.c</a>.</p>

<p class="reference">References <a class="el" href="../../da/df7/astobj2_8c_source.html#l00042">ast_log</a>, <a class="el" href="../../dd/d42/lock_8h_source.html#l00187">ast_mutex_lock</a>, <a class="el" href="../../dd/d42/lock_8h_source.html#l00188">ast_mutex_unlock</a>, <a class="el" href="../../da/d21/main_2db_8c_source.html#l00110">astdb</a>, <a class="el" href="../../da/d21/main_2db_8c_source.html#l01009">db_sync()</a>, <a class="el" href="../../da/d21/main_2db_8c_source.html#l00108">dblock</a>, <a class="el" href="../../d1/d8c/logger_8h_source.html#l00274">LOG_WARNING</a>, and <a class="el" href="../../da/d21/main_2db_8c_source.html#l00107">MAX_DB_FIELD</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../d2/d09/sig__analog_8c_source.html#l01711">__analog_ss_thread()</a>, <a class="el" href="../../d9/d2d/res__stir__shaken_8c_source.html#l00456">add_public_key_to_astdb()</a>, <a class="el" href="../../da/de0/privacy_8c_source.html#l00082">ast_privacy_set()</a>, <a class="el" href="../../db/dbb/test__db_8c_source.html#l00049">AST_TEST_DEFINE()</a>, <a class="el" href="../../d5/d03/asterisk_8c_source.html#l03947">asterisk_daemon()</a>, <a class="el" href="../../d1/dc0/pbx__dundi_8c_source.html#l00899">cache_save()</a>, <a class="el" href="../../d1/dc0/pbx__dundi_8c_source.html#l00864">cache_save_hint()</a>, <a class="el" href="../../d1/d97/chan__dahdi_8c_source.html#l13729">dahdi_cc_callback()</a>, <a class="el" href="../../dc/d5c/app__alarmreceiver_8c_source.html#l00208">database_increment()</a>, <a class="el" href="../../d7/d0b/func__devstate_8c_source.html#l00109">devstate_write()</a>, <a class="el" href="../../d9/d35/func__dialgroup_8c_source.html#l00171">dialgroup_refreshdb()</a>, <a class="el" href="../../da/dfb/app__queue_8c_source.html#l07269">dump_queue_members()</a>, <a class="el" href="../../d7/d48/func__db_8c_source.html#l00157">function_db_write()</a>, <a class="el" href="../../da/d21/main_2db_8c_source.html#l00608">handle_cli_database_put()</a>, <a class="el" href="../../d7/d0b/func__devstate_8c_source.html#l00238">handle_cli_devstate_change()</a>, <a class="el" href="../../d0/d81/func__presencestate_8c_source.html#l00366">handle_cli_presencestate_change()</a>, <a class="el" href="../../d1/dc0/pbx__dundi_8c_source.html#l01586">handle_command_response()</a>, <a class="el" href="../../dd/de9/res__agi_8c_source.html#l03323">handle_dbput()</a>, <a class="el" href="../../d8/d4f/provision_8c_source.html#l00209">iax_provision_build()</a>, <a class="el" href="../../da/d21/main_2db_8c_source.html#l00883">manager_dbput()</a>, <a class="el" href="../../df/dfb/media__cache_8c_source.html#l00096">media_cache_item_sync_to_astdb()</a>, <a class="el" href="../../df/dfb/media__cache_8c_source.html#l00081">metadata_sync_to_astdb()</a>, <a class="el" href="../../d0/dd6/chan__mgcp_8c_source.html#l03000">mgcp_ss()</a>, <a class="el" href="../../d5/dfe/chan__sip_8c_source.html#l16961">parse_register_contact()</a>, <a class="el" href="../../d0/d81/func__presencestate_8c_source.html#l00207">presence_write()</a>, <a class="el" href="../../d1/dc0/pbx__dundi_8c_source.html#l02125">save_secret()</a>, <a class="el" href="../../d9/d2d/res__stir__shaken_8c_source.html#l00352">set_public_key_expiration()</a>, <a class="el" href="../../d8/dce/res__sorcery__astdb_8c_source.html#l00066">sorcery_astdb_create()</a>, <a class="el" href="../../dd/d71/res__stasis__device__state_8c_source.html#l00211">stasis_app_device_state_update()</a>, <a class="el" href="../../d9/d2d/res__stir__shaken_8c_source.html#l01260">test_stir_shaken_add_fake_astdb_entry()</a>, and <a class="el" href="../../d5/dff/chan__iax2_8c_source.html#l09002">update_registry()</a>.</p>
<div class="fragment"><div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;{</div><div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;   <span class="keywordtype">char</span> fullkey[<a class="code" href="../../da/d21/main_2db_8c.html#afe1f0caaa1c711f16bb23bfcc54ff386">MAX_DB_FIELD</a>];</div><div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;   <span class="keywordtype">size_t</span> fullkey_len;</div><div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;   <span class="keywordtype">int</span> res = 0;</div><div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;</div><div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;   <span class="keywordflow">if</span> (strlen(family) + strlen(<a class="code" href="../../da/d1d/structast__db__entry.html#a5892a9181e6a332f84d27aecd41dcd12">key</a>) + 2 &gt; <span class="keyword">sizeof</span>(fullkey) - 1) {</div><div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Family and key length must be less than %zu bytes\n&quot;</span>, <span class="keyword">sizeof</span>(fullkey) - 3);</div><div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;   }</div><div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;</div><div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;   fullkey_len = snprintf(fullkey, <span class="keyword">sizeof</span>(fullkey), <span class="stringliteral">&quot;/%s/%s&quot;</span>, family, <a class="code" href="../../da/d1d/structast__db__entry.html#a5892a9181e6a332f84d27aecd41dcd12">key</a>);</div><div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;</div><div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;   <a class="code" href="../../dd/d42/lock_8h.html#ac5e13c7fe64d3b271a52028b0a78b92b">ast_mutex_lock</a>(&amp;<a class="code" href="../../da/d21/main_2db_8c.html#a885611b04f0f81cde233f5648aa58b7c">dblock</a>);</div><div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;   <span class="keywordflow">if</span> (sqlite3_bind_text(put_stmt, 1, fullkey, fullkey_len, SQLITE_STATIC) != SQLITE_OK) {</div><div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Couldn&#39;t bind key to stmt: %s\n&quot;</span>, sqlite3_errmsg(<a class="code" href="../../da/d21/main_2db_8c.html#a59f6376a471012a10b27b3e902256be0">astdb</a>));</div><div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;      res = -1;</div><div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;   } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (sqlite3_bind_text(put_stmt, 2, <a class="code" href="../../d4/d2f/syslog_8c.html#ac4f474c82e82cbb89ca7c36dd52be0ed">value</a>, -1, SQLITE_STATIC) != SQLITE_OK) {</div><div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Couldn&#39;t bind value to stmt: %s\n&quot;</span>, sqlite3_errmsg(<a class="code" href="../../da/d21/main_2db_8c.html#a59f6376a471012a10b27b3e902256be0">astdb</a>));</div><div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;      res = -1;</div><div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;   } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (sqlite3_step(put_stmt) != SQLITE_DONE) {</div><div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Couldn&#39;t execute statement: %s\n&quot;</span>, sqlite3_errmsg(<a class="code" href="../../da/d21/main_2db_8c.html#a59f6376a471012a10b27b3e902256be0">astdb</a>));</div><div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;      res = -1;</div><div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;   }</div><div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;</div><div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;   sqlite3_reset(put_stmt);</div><div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;   <a class="code" href="../../da/d21/main_2db_8c.html#a0a19fc05bc020876fec791200e169eb2">db_sync</a>();</div><div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;   <a class="code" href="../../dd/d42/lock_8h.html#a873f9ce8c6287a32d48c83133e124418">ast_mutex_unlock</a>(&amp;<a class="code" href="../../da/d21/main_2db_8c.html#a885611b04f0f81cde233f5648aa58b7c">dblock</a>);</div><div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;</div><div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;   <span class="keywordflow">return</span> res;</div><div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;}</div><div class="ttc" id="logger_8h_html_adf4476a6a4ea6c74231c826e899d7189"><div class="ttname"><a href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a></div><div class="ttdeci">#define LOG_WARNING</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d8c/logger_8h_source.html#l00274">logger.h:274</a></div></div>
<div class="ttc" id="lock_8h_html_ac5e13c7fe64d3b271a52028b0a78b92b"><div class="ttname"><a href="../../dd/d42/lock_8h.html#ac5e13c7fe64d3b271a52028b0a78b92b">ast_mutex_lock</a></div><div class="ttdeci">#define ast_mutex_lock(a)</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d42/lock_8h_source.html#l00187">lock.h:187</a></div></div>
<div class="ttc" id="syslog_8c_html_ac4f474c82e82cbb89ca7c36dd52be0ed"><div class="ttname"><a href="../../d4/d2f/syslog_8c.html#ac4f474c82e82cbb89ca7c36dd52be0ed">value</a></div><div class="ttdeci">int value</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d2f/syslog_8c_source.html#l00037">syslog.c:37</a></div></div>
<div class="ttc" id="main_2db_8c_html_a885611b04f0f81cde233f5648aa58b7c"><div class="ttname"><a href="../../da/d21/main_2db_8c.html#a885611b04f0f81cde233f5648aa58b7c">dblock</a></div><div class="ttdeci">static ast_mutex_t dblock</div><div class="ttdef"><b>Definition:</b> <a href="../../da/d21/main_2db_8c_source.html#l00108">main/db.c:108</a></div></div>
<div class="ttc" id="astobj2_8c_html_a96a00b3a518d7f32b6d51dc28f09bf9b"><div class="ttname"><a href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a></div><div class="ttdeci">#define ast_log</div><div class="ttdef"><b>Definition:</b> <a href="../../da/df7/astobj2_8c_source.html#l00042">astobj2.c:42</a></div></div>
<div class="ttc" id="main_2db_8c_html_afe1f0caaa1c711f16bb23bfcc54ff386"><div class="ttname"><a href="../../da/d21/main_2db_8c.html#afe1f0caaa1c711f16bb23bfcc54ff386">MAX_DB_FIELD</a></div><div class="ttdeci">#define MAX_DB_FIELD</div><div class="ttdef"><b>Definition:</b> <a href="../../da/d21/main_2db_8c_source.html#l00107">main/db.c:107</a></div></div>
<div class="ttc" id="main_2db_8c_html_a59f6376a471012a10b27b3e902256be0"><div class="ttname"><a href="../../da/d21/main_2db_8c.html#a59f6376a471012a10b27b3e902256be0">astdb</a></div><div class="ttdeci">static sqlite3 * astdb</div><div class="ttdef"><b>Definition:</b> <a href="../../da/d21/main_2db_8c_source.html#l00110">main/db.c:110</a></div></div>
<div class="ttc" id="main_2db_8c_html_a0a19fc05bc020876fec791200e169eb2"><div class="ttname"><a href="../../da/d21/main_2db_8c.html#a0a19fc05bc020876fec791200e169eb2">db_sync</a></div><div class="ttdeci">static void db_sync(void)</div><div class="ttdef"><b>Definition:</b> <a href="../../da/d21/main_2db_8c_source.html#l01009">main/db.c:1009</a></div></div>
<div class="ttc" id="lock_8h_html_a873f9ce8c6287a32d48c83133e124418"><div class="ttname"><a href="../../dd/d42/lock_8h.html#a873f9ce8c6287a32d48c83133e124418">ast_mutex_unlock</a></div><div class="ttdeci">#define ast_mutex_unlock(a)</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d42/lock_8h_source.html#l00188">lock.h:188</a></div></div>
<div class="ttc" id="structast__db__entry_html_a5892a9181e6a332f84d27aecd41dcd12"><div class="ttname"><a href="../../da/d1d/structast__db__entry.html#a5892a9181e6a332f84d27aecd41dcd12">ast_db_entry::key</a></div><div class="ttdeci">char * key</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d4a/astdb_8h_source.html#l00033">astdb.h:33</a></div></div>
</div><!-- fragment -->
</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Sun Aug 8 2021 19:44:46 for Asterisk - The Open Source Telephony Project by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="../../doxygen.png" alt="doxygen"/>
</a> 1.8.13
</small></address>
</body>
</html>
