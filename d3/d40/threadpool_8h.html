<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Asterisk - The Open Source Telephony Project: threadpool.h File Reference</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Asterisk - The Open Source Telephony Project
   &#160;<span id="projectnumber">18.5.0</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "../../search",false,'Search');
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('../../',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="../../dir_d44c64559bbebec7f509842c48db8b23.html">include</a></li><li class="navelem"><a class="el" href="../../dir_6d4b1cdb59e2db6ad82005b337288fef.html">asterisk</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#nested-classes">Data Structures</a> &#124;
<a href="#define-members">Macros</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">threadpool.h File Reference</div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><div class="dynheader">
This graph shows which files directly or indirectly include this file:</div>
<div class="dyncontent">
<div class="center"><img src="../../d6/d59/threadpool_8h__dep__incl.png" border="0" usemap="#threadpool_8hdep" alt=""/></div>
<map name="threadpool_8hdep" id="threadpool_8hdep">
<area shape="rect" id="node2" href="../../d6/dd3/serializer_8c.html" title="serializer.c" alt="" coords="5,87,95,114"/>
<area shape="rect" id="node3" href="../../d7/d69/sorcery_8c.html" title="Sorcery Data Access Layer API. " alt="" coords="119,87,197,114"/>
<area shape="rect" id="node4" href="../../d0/df4/stasis_8c.html" title="Stasis Message Bus API. " alt="" coords="221,87,292,114"/>
<area shape="rect" id="node5" href="../../d1/dc7/threadpool_8c.html" title="threadpool.c" alt="" coords="316,87,419,114"/>
<area shape="rect" id="node6" href="../../df/dfd/config__system_8c.html" title="config_system.c" alt="" coords="443,87,569,114"/>
<area shape="rect" id="node7" href="../../d7/dad/pjsip__distributor_8c.html" title="pjsip_distributor.c" alt="" coords="593,87,726,114"/>
<area shape="rect" id="node8" href="../../df/dda/pjsip__options_8c.html" title="pjsip_options.c" alt="" coords="751,87,867,114"/>
<area shape="rect" id="node9" href="../../d4/d43/pjsip__resolver_8c.html" title="pjsip_resolver.c" alt="" coords="891,87,1009,114"/>
<area shape="rect" id="node10" href="../../de/d96/res__pjsip_8c.html" title="res_pjsip.c" alt="" coords="1033,87,1123,114"/>
<area shape="rect" id="node11" href="../../df/d3a/res__pjsip__outbound__publish_8c.html" title="res_pjsip_outbound\l_publish.c" alt="" coords="1147,80,1294,121"/>
<area shape="rect" id="node12" href="../../d9/d96/res__pjsip__outbound__registration_8c.html" title="res_pjsip_outbound\l_registration.c" alt="" coords="1318,80,1465,121"/>
<area shape="rect" id="node13" href="../../da/d5c/res__pjsip__rfc3326_8c.html" title="res_pjsip_rfc3326.c" alt="" coords="1489,87,1633,114"/>
<area shape="rect" id="node14" href="../../df/df7/test__taskprocessor_8c.html" title="taskprocessor unit tests " alt="" coords="1657,87,1811,114"/>
<area shape="rect" id="node15" href="../../de/dec/test__threadpool_8c.html" title="threadpool unit tests " alt="" coords="1836,87,1971,114"/>
</map>
</div>
</div>
<p><a href="../../d3/d40/threadpool_8h_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="nested-classes"></a>
Data Structures</h2></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../df/d64/structast__threadpool__listener__callbacks.html">ast_threadpool_listener_callbacks</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../de/de6/structast__threadpool__options.html">ast_threadpool_options</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="define-members"></a>
Macros</h2></td></tr>
<tr class="memitem:ae95119c74a92ef5c17f55421b278a25c"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d3/d40/threadpool_8h.html#ae95119c74a92ef5c17f55421b278a25c">AST_THREADPOOL_OPTIONS_VERSION</a>&#160;&#160;&#160;1</td></tr>
<tr class="separator:ae95119c74a92ef5c17f55421b278a25c"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a26d6e398621cb8b8d2e1066b0393944a"><td class="memItemLeft" align="right" valign="top">struct <a class="el" href="../../dc/d82/structast__serializer__shutdown__group.html">ast_serializer_shutdown_group</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d3/d40/threadpool_8h.html#a26d6e398621cb8b8d2e1066b0393944a">ast_serializer_shutdown_group_alloc</a> (void)</td></tr>
<tr class="memdesc:a26d6e398621cb8b8d2e1066b0393944a"><td class="mdescLeft">&#160;</td><td class="mdescRight">Create a serializer group shutdown control object.  <a href="#a26d6e398621cb8b8d2e1066b0393944a">More...</a><br /></td></tr>
<tr class="separator:a26d6e398621cb8b8d2e1066b0393944a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab8cbf6d9f2f9964fc6225a73cc287441"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d3/d40/threadpool_8h.html#ab8cbf6d9f2f9964fc6225a73cc287441">ast_serializer_shutdown_group_join</a> (struct <a class="el" href="../../dc/d82/structast__serializer__shutdown__group.html">ast_serializer_shutdown_group</a> *<a class="el" href="../../d9/d96/res__pjsip__outbound__registration_8c.html#a2c3d0057b62bfa5b08fe977478749c24">shutdown_group</a>, int <a class="el" href="../../d0/d29/cdr__mysql_8c.html#a493b57f443cc38b3d3df9c1e584d9d82">timeout</a>)</td></tr>
<tr class="memdesc:ab8cbf6d9f2f9964fc6225a73cc287441"><td class="mdescLeft">&#160;</td><td class="mdescRight">Wait for the serializers in the group to shutdown with timeout.  <a href="#ab8cbf6d9f2f9964fc6225a73cc287441">More...</a><br /></td></tr>
<tr class="separator:ab8cbf6d9f2f9964fc6225a73cc287441"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:abf6fc4af30779217d37047cbb1fddd1a"><td class="memItemLeft" align="right" valign="top">struct <a class="el" href="../../d5/d10/structast__threadpool.html">ast_threadpool</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d3/d40/threadpool_8h.html#abf6fc4af30779217d37047cbb1fddd1a">ast_threadpool_create</a> (const char *<a class="el" href="../../d1/da4/res__corosync_8c.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, struct <a class="el" href="../../dd/d12/structast__threadpool__listener.html">ast_threadpool_listener</a> *<a class="el" href="../../d5/d03/asterisk_8c.html#adc01bca6281492dfec5ae217cf32fc34">listener</a>, const struct <a class="el" href="../../de/de6/structast__threadpool__options.html">ast_threadpool_options</a> *<a class="el" href="../../d4/d45/test__http__media__cache_8c.html#a80c8e3ae5087d90d422675d034eeebc7">options</a>)</td></tr>
<tr class="memdesc:abf6fc4af30779217d37047cbb1fddd1a"><td class="mdescLeft">&#160;</td><td class="mdescRight">Create a new threadpool.  <a href="#abf6fc4af30779217d37047cbb1fddd1a">More...</a><br /></td></tr>
<tr class="separator:abf6fc4af30779217d37047cbb1fddd1a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3e1d943184d2d6260b6718e5629bbc24"><td class="memItemLeft" align="right" valign="top">struct <a class="el" href="../../dd/d12/structast__threadpool__listener.html">ast_threadpool_listener</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d3/d40/threadpool_8h.html#a3e1d943184d2d6260b6718e5629bbc24">ast_threadpool_listener_alloc</a> (const struct <a class="el" href="../../df/d64/structast__threadpool__listener__callbacks.html">ast_threadpool_listener_callbacks</a> *callbacks, void *user_data)</td></tr>
<tr class="memdesc:a3e1d943184d2d6260b6718e5629bbc24"><td class="mdescLeft">&#160;</td><td class="mdescRight">Allocate a threadpool listener.  <a href="#a3e1d943184d2d6260b6718e5629bbc24">More...</a><br /></td></tr>
<tr class="separator:a3e1d943184d2d6260b6718e5629bbc24"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa9bee831e887eb53e72a7e161d5c19de"><td class="memItemLeft" align="right" valign="top">void *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d3/d40/threadpool_8h.html#aa9bee831e887eb53e72a7e161d5c19de">ast_threadpool_listener_get_user_data</a> (const struct <a class="el" href="../../dd/d12/structast__threadpool__listener.html">ast_threadpool_listener</a> *<a class="el" href="../../d5/d03/asterisk_8c.html#adc01bca6281492dfec5ae217cf32fc34">listener</a>)</td></tr>
<tr class="memdesc:aa9bee831e887eb53e72a7e161d5c19de"><td class="mdescLeft">&#160;</td><td class="mdescRight">Get the threadpool listener's user data.  <a href="#aa9bee831e887eb53e72a7e161d5c19de">More...</a><br /></td></tr>
<tr class="separator:aa9bee831e887eb53e72a7e161d5c19de"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6703b90076af2b709e18c532e702da76"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d3/d40/threadpool_8h.html#a6703b90076af2b709e18c532e702da76">ast_threadpool_push</a> (struct <a class="el" href="../../d5/d10/structast__threadpool.html">ast_threadpool</a> *<a class="el" href="../../d9/d21/res__rtp__asterisk_8c.html#a2e57658a5d3ef6c4ef2774c9d5868e7c">pool</a>, int(*<a class="el" href="../../df/df7/test__taskprocessor_8c.html#a07d08fd44ac4a9f8e1319ce270f5d56a">task</a>)(void *data), void *data) <a class="el" href="../../d4/dd1/compiler_8h.html#ab3b3fbf14bd20f49a667b208fee6a07a">attribute_warn_unused_result</a></td></tr>
<tr class="memdesc:a6703b90076af2b709e18c532e702da76"><td class="mdescLeft">&#160;</td><td class="mdescRight">Push a task to the threadpool.  <a href="#a6703b90076af2b709e18c532e702da76">More...</a><br /></td></tr>
<tr class="separator:a6703b90076af2b709e18c532e702da76"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6e65e5b2e17e83c008f74b1d93cee2b5"><td class="memItemLeft" align="right" valign="top">long&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d3/d40/threadpool_8h.html#a6e65e5b2e17e83c008f74b1d93cee2b5">ast_threadpool_queue_size</a> (struct <a class="el" href="../../d5/d10/structast__threadpool.html">ast_threadpool</a> *<a class="el" href="../../d9/d21/res__rtp__asterisk_8c.html#a2e57658a5d3ef6c4ef2774c9d5868e7c">pool</a>)</td></tr>
<tr class="memdesc:a6e65e5b2e17e83c008f74b1d93cee2b5"><td class="mdescLeft">&#160;</td><td class="mdescRight">Return the size of the threadpool's task queue.  <a href="#a6e65e5b2e17e83c008f74b1d93cee2b5">More...</a><br /></td></tr>
<tr class="separator:a6e65e5b2e17e83c008f74b1d93cee2b5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6e86f51d34ae17fd6f38b8379883bf87"><td class="memItemLeft" align="right" valign="top">struct <a class="el" href="../../db/d17/structast__taskprocessor.html">ast_taskprocessor</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d3/d40/threadpool_8h.html#a6e86f51d34ae17fd6f38b8379883bf87">ast_threadpool_serializer</a> (const char *<a class="el" href="../../d1/da4/res__corosync_8c.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, struct <a class="el" href="../../d5/d10/structast__threadpool.html">ast_threadpool</a> *<a class="el" href="../../d9/d21/res__rtp__asterisk_8c.html#a2e57658a5d3ef6c4ef2774c9d5868e7c">pool</a>)</td></tr>
<tr class="memdesc:a6e86f51d34ae17fd6f38b8379883bf87"><td class="mdescLeft">&#160;</td><td class="mdescRight">Serialized execution of tasks within a <a class="el" href="../../d5/d10/structast__threadpool.html">ast_threadpool</a>.  <a href="#a6e86f51d34ae17fd6f38b8379883bf87">More...</a><br /></td></tr>
<tr class="separator:a6e86f51d34ae17fd6f38b8379883bf87"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad8505fda5adce26c0e2e45de0a0dcb51"><td class="memItemLeft" align="right" valign="top">struct <a class="el" href="../../db/d17/structast__taskprocessor.html">ast_taskprocessor</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d3/d40/threadpool_8h.html#ad8505fda5adce26c0e2e45de0a0dcb51">ast_threadpool_serializer_get_current</a> (void)</td></tr>
<tr class="memdesc:ad8505fda5adce26c0e2e45de0a0dcb51"><td class="mdescLeft">&#160;</td><td class="mdescRight">Get the threadpool serializer currently associated with this thread.  <a href="#ad8505fda5adce26c0e2e45de0a0dcb51">More...</a><br /></td></tr>
<tr class="separator:ad8505fda5adce26c0e2e45de0a0dcb51"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a49b8fabf465ce8e4f325ceecda8ccd16"><td class="memItemLeft" align="right" valign="top">struct <a class="el" href="../../db/d17/structast__taskprocessor.html">ast_taskprocessor</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d3/d40/threadpool_8h.html#a49b8fabf465ce8e4f325ceecda8ccd16">ast_threadpool_serializer_group</a> (const char *<a class="el" href="../../d1/da4/res__corosync_8c.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, struct <a class="el" href="../../d5/d10/structast__threadpool.html">ast_threadpool</a> *<a class="el" href="../../d9/d21/res__rtp__asterisk_8c.html#a2e57658a5d3ef6c4ef2774c9d5868e7c">pool</a>, struct <a class="el" href="../../dc/d82/structast__serializer__shutdown__group.html">ast_serializer_shutdown_group</a> *<a class="el" href="../../d9/d96/res__pjsip__outbound__registration_8c.html#a2c3d0057b62bfa5b08fe977478749c24">shutdown_group</a>)</td></tr>
<tr class="memdesc:a49b8fabf465ce8e4f325ceecda8ccd16"><td class="mdescLeft">&#160;</td><td class="mdescRight">Serialized execution of tasks within a <a class="el" href="../../d5/d10/structast__threadpool.html">ast_threadpool</a>.  <a href="#a49b8fabf465ce8e4f325ceecda8ccd16">More...</a><br /></td></tr>
<tr class="separator:a49b8fabf465ce8e4f325ceecda8ccd16"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:acd7a437bf7aa6a7335cf1e96655258d1"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d3/d40/threadpool_8h.html#acd7a437bf7aa6a7335cf1e96655258d1">ast_threadpool_set_size</a> (struct <a class="el" href="../../d5/d10/structast__threadpool.html">ast_threadpool</a> *<a class="el" href="../../d0/df4/stasis_8c.html#a6dc11fc8f94173cc1af379b74a096abd">threadpool</a>, unsigned int size)</td></tr>
<tr class="memdesc:acd7a437bf7aa6a7335cf1e96655258d1"><td class="mdescLeft">&#160;</td><td class="mdescRight">Set the number of threads for the thread pool.  <a href="#acd7a437bf7aa6a7335cf1e96655258d1">More...</a><br /></td></tr>
<tr class="separator:acd7a437bf7aa6a7335cf1e96655258d1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a45bebfa26a1737c170f723ac86299bba"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d3/d40/threadpool_8h.html#a45bebfa26a1737c170f723ac86299bba">ast_threadpool_shutdown</a> (struct <a class="el" href="../../d5/d10/structast__threadpool.html">ast_threadpool</a> *<a class="el" href="../../d9/d21/res__rtp__asterisk_8c.html#a2e57658a5d3ef6c4ef2774c9d5868e7c">pool</a>)</td></tr>
<tr class="memdesc:a45bebfa26a1737c170f723ac86299bba"><td class="mdescLeft">&#160;</td><td class="mdescRight">Shut down a threadpool and destroy it.  <a href="#a45bebfa26a1737c170f723ac86299bba">More...</a><br /></td></tr>
<tr class="separator:a45bebfa26a1737c170f723ac86299bba"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<h2 class="groupheader">Macro Definition Documentation</h2>
<a id="ae95119c74a92ef5c17f55421b278a25c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae95119c74a92ef5c17f55421b278a25c">&#9670;&nbsp;</a></span>AST_THREADPOOL_OPTIONS_VERSION</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define AST_THREADPOOL_OPTIONS_VERSION&#160;&#160;&#160;1</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="../../d3/d40/threadpool_8h_source.html#l00071">71</a> of file <a class="el" href="../../d3/d40/threadpool_8h_source.html">threadpool.h</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../d7/d69/sorcery_8c_source.html#l00387">ast_sorcery_init()</a>, <a class="el" href="../../df/df7/test__taskprocessor_8c_source.html#l00901">AST_TEST_DEFINE()</a>, <a class="el" href="../../d1/dc7/threadpool_8c_source.html#l00915">ast_threadpool_create()</a>, and <a class="el" href="../../d0/df4/stasis_8c_source.html#l03061">stasis_init()</a>.</p>

</div>
</div>
<h2 class="groupheader">Function Documentation</h2>
<a id="a26d6e398621cb8b8d2e1066b0393944a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a26d6e398621cb8b8d2e1066b0393944a">&#9670;&nbsp;</a></span>ast_serializer_shutdown_group_alloc()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="../../dc/d82/structast__serializer__shutdown__group.html">ast_serializer_shutdown_group</a>* ast_serializer_shutdown_group_alloc </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Create a serializer group shutdown control object. </p>
<dl class="section since"><dt>Since</dt><dd>13.5.0</dd></dl>
<dl class="section return"><dt>Returns</dt><dd>ao2 object to control shutdown of a serializer group. </dd></dl>

<p class="definition">Definition at line <a class="el" href="../../d1/dc7/threadpool_8c_source.html#l01229">1229</a> of file <a class="el" href="../../d1/dc7/threadpool_8c_source.html">threadpool.c</a>.</p>

<p class="reference">References <a class="el" href="../../d5/da5/astobj2_8h_source.html#l00411">ao2_alloc</a>, <a class="el" href="../../dd/d42/lock_8h_source.html#l00199">ast_cond_init</a>, <a class="el" href="../../d1/dc7/threadpool_8c_source.html#l01217">ast_serializer_shutdown_group::cond</a>, <a class="el" href="../../dc/d7f/resample_8c_source.html#l00096">NULL</a>, <a class="el" href="../../d1/dc7/threadpool_8c_source.html#l01222">serializer_shutdown_group_dtor()</a>, and <a class="el" href="../../df/dda/pjsip__options_8c_source.html#l00129">shutdown_group</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../d6/dd3/serializer_8c_source.html#l00076">ast_serializer_pool_create()</a>, <a class="el" href="../../df/d3a/res__pjsip__outbound__publish_8c_source.html#l01647">load_module()</a>, and <a class="el" href="../../df/dda/pjsip__options_8c_source.html#l02885">sip_options_init_task()</a>.</p>
<div class="fragment"><div class="line"><a name="l01230"></a><span class="lineno"> 1230</span>&#160;{</div><div class="line"><a name="l01231"></a><span class="lineno"> 1231</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../dc/d82/structast__serializer__shutdown__group.html">ast_serializer_shutdown_group</a> *<a class="code" href="../../df/dda/pjsip__options_8c.html#a2c3d0057b62bfa5b08fe977478749c24">shutdown_group</a>;</div><div class="line"><a name="l01232"></a><span class="lineno"> 1232</span>&#160;</div><div class="line"><a name="l01233"></a><span class="lineno"> 1233</span>&#160;   shutdown_group = <a class="code" href="../../d5/da5/astobj2_8h.html#ae0422b60d8e25b6962b2d61ae4ddf724">ao2_alloc</a>(<span class="keyword">sizeof</span>(*shutdown_group), <a class="code" href="../../d1/dc7/threadpool_8c.html#a32f9d04cf2e48a22a1bf4c0c035ed8c1">serializer_shutdown_group_dtor</a>);</div><div class="line"><a name="l01234"></a><span class="lineno"> 1234</span>&#160;   <span class="keywordflow">if</span> (!shutdown_group) {</div><div class="line"><a name="l01235"></a><span class="lineno"> 1235</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l01236"></a><span class="lineno"> 1236</span>&#160;   }</div><div class="line"><a name="l01237"></a><span class="lineno"> 1237</span>&#160;   <a class="code" href="../../dd/d42/lock_8h.html#a69e9591803d36f5683eb9b084442be9b">ast_cond_init</a>(&amp;shutdown_group-&gt;<a class="code" href="../../dc/d82/structast__serializer__shutdown__group.html#a1c7181c39f99ee801943a0d0aa9872b9">cond</a>, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div><div class="line"><a name="l01238"></a><span class="lineno"> 1238</span>&#160;   <span class="keywordflow">return</span> <a class="code" href="../../df/dda/pjsip__options_8c.html#a2c3d0057b62bfa5b08fe977478749c24">shutdown_group</a>;</div><div class="line"><a name="l01239"></a><span class="lineno"> 1239</span>&#160;}</div><div class="ttc" id="structast__serializer__shutdown__group_html_a1c7181c39f99ee801943a0d0aa9872b9"><div class="ttname"><a href="../../dc/d82/structast__serializer__shutdown__group.html#a1c7181c39f99ee801943a0d0aa9872b9">ast_serializer_shutdown_group::cond</a></div><div class="ttdeci">ast_cond_t cond</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/dc7/threadpool_8c_source.html#l01217">threadpool.c:1217</a></div></div>
<div class="ttc" id="lock_8h_html_a69e9591803d36f5683eb9b084442be9b"><div class="ttname"><a href="../../dd/d42/lock_8h.html#a69e9591803d36f5683eb9b084442be9b">ast_cond_init</a></div><div class="ttdeci">#define ast_cond_init(cond, attr)</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d42/lock_8h_source.html#l00199">lock.h:199</a></div></div>
<div class="ttc" id="resample_8c_html_a070d2ce7b6bb7e5c05602aa8c308d0c4"><div class="ttname"><a href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a></div><div class="ttdeci">#define NULL</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d7f/resample_8c_source.html#l00096">resample.c:96</a></div></div>
<div class="ttc" id="astobj2_8h_html_ae0422b60d8e25b6962b2d61ae4ddf724"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#ae0422b60d8e25b6962b2d61ae4ddf724">ao2_alloc</a></div><div class="ttdeci">#define ao2_alloc(data_size, destructor_fn)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l00411">astobj2.h:411</a></div></div>
<div class="ttc" id="threadpool_8c_html_a32f9d04cf2e48a22a1bf4c0c035ed8c1"><div class="ttname"><a href="../../d1/dc7/threadpool_8c.html#a32f9d04cf2e48a22a1bf4c0c035ed8c1">serializer_shutdown_group_dtor</a></div><div class="ttdeci">static void serializer_shutdown_group_dtor(void *vdoomed)</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/dc7/threadpool_8c_source.html#l01222">threadpool.c:1222</a></div></div>
<div class="ttc" id="pjsip__options_8c_html_a2c3d0057b62bfa5b08fe977478749c24"><div class="ttname"><a href="../../df/dda/pjsip__options_8c.html#a2c3d0057b62bfa5b08fe977478749c24">shutdown_group</a></div><div class="ttdeci">static struct ast_serializer_shutdown_group * shutdown_group</div><div class="ttdoc">Shutdown group for options serializers. </div><div class="ttdef"><b>Definition:</b> <a href="../../df/dda/pjsip__options_8c_source.html#l00129">pjsip_options.c:129</a></div></div>
<div class="ttc" id="structast__serializer__shutdown__group_html"><div class="ttname"><a href="../../dc/d82/structast__serializer__shutdown__group.html">ast_serializer_shutdown_group</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d1/dc7/threadpool_8c_source.html#l01215">threadpool.c:1215</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="ab8cbf6d9f2f9964fc6225a73cc287441"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab8cbf6d9f2f9964fc6225a73cc287441">&#9670;&nbsp;</a></span>ast_serializer_shutdown_group_join()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ast_serializer_shutdown_group_join </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="../../dc/d82/structast__serializer__shutdown__group.html">ast_serializer_shutdown_group</a> *&#160;</td>
          <td class="paramname"><em>shutdown_group</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>timeout</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Wait for the serializers in the group to shutdown with timeout. </p>
<dl class="section since"><dt>Since</dt><dd>13.5.0</dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">shutdown_group</td><td>Group shutdown controller. (Returns 0 immediately if NULL) </td></tr>
    <tr><td class="paramname">timeout</td><td>Number of seconds to wait for the serializers in the group to shutdown. Zero if the timeout is disabled.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>Number of seriaizers that did not get shutdown within the timeout. </dd></dl>

<p class="definition">Definition at line <a class="el" href="../../d1/dc7/threadpool_8c_source.html#l01241">1241</a> of file <a class="el" href="../../d1/dc7/threadpool_8c_source.html">threadpool.c</a>.</p>

<p class="reference">References <a class="el" href="../../d5/da5/astobj2_8h_source.html#l00718">ao2_lock</a>, <a class="el" href="../../da/df7/astobj2_8c_source.html#l00476">ao2_object_get_lockaddr()</a>, <a class="el" href="../../d5/da5/astobj2_8h_source.html#l00730">ao2_unlock</a>, <a class="el" href="../../d5/d60/utils_8h_source.html#l00695">ast_assert</a>, <a class="el" href="../../dd/d42/lock_8h_source.html#l00204">ast_cond_timedwait</a>, <a class="el" href="../../dd/d42/lock_8h_source.html#l00203">ast_cond_wait</a>, <a class="el" href="../../de/df7/time_8h_source.html#l00150">ast_tvnow()</a>, <a class="el" href="../../d1/dc7/threadpool_8c_source.html#l01217">ast_serializer_shutdown_group::cond</a>, <a class="el" href="../../d1/dc7/threadpool_8c_source.html#l01219">ast_serializer_shutdown_group::count</a>, <a class="el" href="../../df/d44/app__meetme_8c_source.html#l01091">lock</a>, <a class="el" href="../../dc/d7f/resample_8c_source.html#l00096">NULL</a>, and <a class="el" href="../../d0/d29/cdr__mysql_8c_source.html#l00086">timeout</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../df/dda/pjsip__options_8c_source.html#l02835">ast_res_pjsip_cleanup_options_handling()</a>, <a class="el" href="../../d6/dd3/serializer_8c_source.html#l00039">ast_serializer_pool_destroy()</a>, and <a class="el" href="../../df/d3a/res__pjsip__outbound__publish_8c_source.html#l01622">unload_module()</a>.</p>
<div class="fragment"><div class="line"><a name="l01242"></a><span class="lineno"> 1242</span>&#160;{</div><div class="line"><a name="l01243"></a><span class="lineno"> 1243</span>&#160;   <span class="keywordtype">int</span> remaining;</div><div class="line"><a name="l01244"></a><span class="lineno"> 1244</span>&#160;   <a class="code" href="../../d8/dc5/structast__mutex__info.html">ast_mutex_t</a> *<a class="code" href="../../df/d44/app__meetme_8c.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>;</div><div class="line"><a name="l01245"></a><span class="lineno"> 1245</span>&#160;</div><div class="line"><a name="l01246"></a><span class="lineno"> 1246</span>&#160;   <span class="keywordflow">if</span> (!shutdown_group) {</div><div class="line"><a name="l01247"></a><span class="lineno"> 1247</span>&#160;      <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l01248"></a><span class="lineno"> 1248</span>&#160;   }</div><div class="line"><a name="l01249"></a><span class="lineno"> 1249</span>&#160;</div><div class="line"><a name="l01250"></a><span class="lineno"> 1250</span>&#160;   lock = <a class="code" href="../../d5/da5/astobj2_8h.html#a503b6c7ced96f9b56ec59c115cbeb29a">ao2_object_get_lockaddr</a>(shutdown_group);</div><div class="line"><a name="l01251"></a><span class="lineno"> 1251</span>&#160;   <a class="code" href="../../d5/d60/utils_8h.html#a24374da24af1931d8a7ccde5b352bb2c">ast_assert</a>(lock != <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div><div class="line"><a name="l01252"></a><span class="lineno"> 1252</span>&#160;</div><div class="line"><a name="l01253"></a><span class="lineno"> 1253</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#aa9fdb5d0a6157a56060d9f7279fe6c49">ao2_lock</a>(shutdown_group);</div><div class="line"><a name="l01254"></a><span class="lineno"> 1254</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d0/d29/cdr__mysql_8c.html#a493b57f443cc38b3d3df9c1e584d9d82">timeout</a>) {</div><div class="line"><a name="l01255"></a><span class="lineno"> 1255</span>&#160;      <span class="keyword">struct </span>timeval start;</div><div class="line"><a name="l01256"></a><span class="lineno"> 1256</span>&#160;      <span class="keyword">struct </span>timespec <a class="code" href="../../dd/d7c/eagi__proxy_8c.html#a8fd806ad19b8f5513a4cf18cbf77532c">end</a>;</div><div class="line"><a name="l01257"></a><span class="lineno"> 1257</span>&#160;</div><div class="line"><a name="l01258"></a><span class="lineno"> 1258</span>&#160;      start = <a class="code" href="../../de/df7/time_8h.html#ad3899efb6f0e348556ef69f5b16aa7f7">ast_tvnow</a>();</div><div class="line"><a name="l01259"></a><span class="lineno"> 1259</span>&#160;      <a class="code" href="../../dd/d7c/eagi__proxy_8c.html#a8fd806ad19b8f5513a4cf18cbf77532c">end</a>.tv_sec = start.tv_sec + <a class="code" href="../../d0/d29/cdr__mysql_8c.html#a493b57f443cc38b3d3df9c1e584d9d82">timeout</a>;</div><div class="line"><a name="l01260"></a><span class="lineno"> 1260</span>&#160;      <a class="code" href="../../dd/d7c/eagi__proxy_8c.html#a8fd806ad19b8f5513a4cf18cbf77532c">end</a>.tv_nsec = start.tv_usec * 1000;</div><div class="line"><a name="l01261"></a><span class="lineno"> 1261</span>&#160;      <span class="keywordflow">while</span> (shutdown_group-&gt;<a class="code" href="../../dc/d82/structast__serializer__shutdown__group.html#ad43c3812e6d13e0518d9f8b8f463ffcf">count</a>) {</div><div class="line"><a name="l01262"></a><span class="lineno"> 1262</span>&#160;         <span class="keywordflow">if</span> (<a class="code" href="../../dd/d42/lock_8h.html#a6add1f30b2d53ca9384b15529a6f126e">ast_cond_timedwait</a>(&amp;shutdown_group-&gt;<a class="code" href="../../dc/d82/structast__serializer__shutdown__group.html#a1c7181c39f99ee801943a0d0aa9872b9">cond</a>, lock, &amp;<a class="code" href="../../dd/d7c/eagi__proxy_8c.html#a8fd806ad19b8f5513a4cf18cbf77532c">end</a>)) {</div><div class="line"><a name="l01263"></a><span class="lineno"> 1263</span>&#160;            <span class="comment">/* Error or timed out waiting for the count to reach zero. */</span></div><div class="line"><a name="l01264"></a><span class="lineno"> 1264</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l01265"></a><span class="lineno"> 1265</span>&#160;         }</div><div class="line"><a name="l01266"></a><span class="lineno"> 1266</span>&#160;      }</div><div class="line"><a name="l01267"></a><span class="lineno"> 1267</span>&#160;   } <span class="keywordflow">else</span> {</div><div class="line"><a name="l01268"></a><span class="lineno"> 1268</span>&#160;      <span class="keywordflow">while</span> (shutdown_group-&gt;<a class="code" href="../../dc/d82/structast__serializer__shutdown__group.html#ad43c3812e6d13e0518d9f8b8f463ffcf">count</a>) {</div><div class="line"><a name="l01269"></a><span class="lineno"> 1269</span>&#160;         <span class="keywordflow">if</span> (<a class="code" href="../../dd/d42/lock_8h.html#a36233c5520173c095bf732a788356aee">ast_cond_wait</a>(&amp;shutdown_group-&gt;<a class="code" href="../../dc/d82/structast__serializer__shutdown__group.html#a1c7181c39f99ee801943a0d0aa9872b9">cond</a>, lock)) {</div><div class="line"><a name="l01270"></a><span class="lineno"> 1270</span>&#160;            <span class="comment">/* Error */</span></div><div class="line"><a name="l01271"></a><span class="lineno"> 1271</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l01272"></a><span class="lineno"> 1272</span>&#160;         }</div><div class="line"><a name="l01273"></a><span class="lineno"> 1273</span>&#160;      }</div><div class="line"><a name="l01274"></a><span class="lineno"> 1274</span>&#160;   }</div><div class="line"><a name="l01275"></a><span class="lineno"> 1275</span>&#160;   remaining = shutdown_group-&gt;<a class="code" href="../../dc/d82/structast__serializer__shutdown__group.html#ad43c3812e6d13e0518d9f8b8f463ffcf">count</a>;</div><div class="line"><a name="l01276"></a><span class="lineno"> 1276</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#a9998bd156b936636a8780385e9a910b2">ao2_unlock</a>(shutdown_group);</div><div class="line"><a name="l01277"></a><span class="lineno"> 1277</span>&#160;   <span class="keywordflow">return</span> remaining;</div><div class="line"><a name="l01278"></a><span class="lineno"> 1278</span>&#160;}</div><div class="ttc" id="structast__serializer__shutdown__group_html_ad43c3812e6d13e0518d9f8b8f463ffcf"><div class="ttname"><a href="../../dc/d82/structast__serializer__shutdown__group.html#ad43c3812e6d13e0518d9f8b8f463ffcf">ast_serializer_shutdown_group::count</a></div><div class="ttdeci">int count</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/dc7/threadpool_8c_source.html#l01219">threadpool.c:1219</a></div></div>
<div class="ttc" id="structast__serializer__shutdown__group_html_a1c7181c39f99ee801943a0d0aa9872b9"><div class="ttname"><a href="../../dc/d82/structast__serializer__shutdown__group.html#a1c7181c39f99ee801943a0d0aa9872b9">ast_serializer_shutdown_group::cond</a></div><div class="ttdeci">ast_cond_t cond</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/dc7/threadpool_8c_source.html#l01217">threadpool.c:1217</a></div></div>
<div class="ttc" id="cdr__mysql_8c_html_a493b57f443cc38b3d3df9c1e584d9d82"><div class="ttname"><a href="../../d0/d29/cdr__mysql_8c.html#a493b57f443cc38b3d3df9c1e584d9d82">timeout</a></div><div class="ttdeci">static int timeout</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d29/cdr__mysql_8c_source.html#l00086">cdr_mysql.c:86</a></div></div>
<div class="ttc" id="lock_8h_html_a36233c5520173c095bf732a788356aee"><div class="ttname"><a href="../../dd/d42/lock_8h.html#a36233c5520173c095bf732a788356aee">ast_cond_wait</a></div><div class="ttdeci">#define ast_cond_wait(cond, mutex)</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d42/lock_8h_source.html#l00203">lock.h:203</a></div></div>
<div class="ttc" id="time_8h_html_ad3899efb6f0e348556ef69f5b16aa7f7"><div class="ttname"><a href="../../de/df7/time_8h.html#ad3899efb6f0e348556ef69f5b16aa7f7">ast_tvnow</a></div><div class="ttdeci">struct timeval ast_tvnow(void)</div><div class="ttdoc">Returns current timeval. Meant to replace calls to gettimeofday(). </div><div class="ttdef"><b>Definition:</b> <a href="../../de/df7/time_8h_source.html#l00150">time.h:150</a></div></div>
<div class="ttc" id="utils_8h_html_a24374da24af1931d8a7ccde5b352bb2c"><div class="ttname"><a href="../../d5/d60/utils_8h.html#a24374da24af1931d8a7ccde5b352bb2c">ast_assert</a></div><div class="ttdeci">#define ast_assert(a)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d60/utils_8h_source.html#l00695">utils.h:695</a></div></div>
<div class="ttc" id="astobj2_8h_html_a9998bd156b936636a8780385e9a910b2"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#a9998bd156b936636a8780385e9a910b2">ao2_unlock</a></div><div class="ttdeci">#define ao2_unlock(a)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l00730">astobj2.h:730</a></div></div>
<div class="ttc" id="resample_8c_html_a070d2ce7b6bb7e5c05602aa8c308d0c4"><div class="ttname"><a href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a></div><div class="ttdeci">#define NULL</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d7f/resample_8c_source.html#l00096">resample.c:96</a></div></div>
<div class="ttc" id="eagi__proxy_8c_html_a8fd806ad19b8f5513a4cf18cbf77532c"><div class="ttname"><a href="../../dd/d7c/eagi__proxy_8c.html#a8fd806ad19b8f5513a4cf18cbf77532c">end</a></div><div class="ttdeci">char * end</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d7c/eagi__proxy_8c_source.html#l00073">eagi_proxy.c:73</a></div></div>
<div class="ttc" id="astobj2_8h_html_a503b6c7ced96f9b56ec59c115cbeb29a"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#a503b6c7ced96f9b56ec59c115cbeb29a">ao2_object_get_lockaddr</a></div><div class="ttdeci">void * ao2_object_get_lockaddr(void *obj)</div><div class="ttdoc">Return the mutex lock address of an object. </div><div class="ttdef"><b>Definition:</b> <a href="../../da/df7/astobj2_8c_source.html#l00476">astobj2.c:476</a></div></div>
<div class="ttc" id="app__meetme_8c_html_adf04f66344e3fb0a6f6a69bf39d19902"><div class="ttname"><a href="../../df/d44/app__meetme_8c.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a></div><div class="ttdeci">ast_mutex_t lock</div><div class="ttdef"><b>Definition:</b> <a href="../../df/d44/app__meetme_8c_source.html#l01091">app_meetme.c:1091</a></div></div>
<div class="ttc" id="astobj2_8h_html_aa9fdb5d0a6157a56060d9f7279fe6c49"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#aa9fdb5d0a6157a56060d9f7279fe6c49">ao2_lock</a></div><div class="ttdeci">#define ao2_lock(a)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l00718">astobj2.h:718</a></div></div>
<div class="ttc" id="lock_8h_html_a6add1f30b2d53ca9384b15529a6f126e"><div class="ttname"><a href="../../dd/d42/lock_8h.html#a6add1f30b2d53ca9384b15529a6f126e">ast_cond_timedwait</a></div><div class="ttdeci">#define ast_cond_timedwait(cond, mutex, time)</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d42/lock_8h_source.html#l00204">lock.h:204</a></div></div>
<div class="ttc" id="structast__mutex__info_html"><div class="ttname"><a href="../../d8/dc5/structast__mutex__info.html">ast_mutex_info</a></div><div class="ttdoc">Structure for mutex and tracking information. </div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d42/lock_8h_source.html#l00135">lock.h:135</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="abf6fc4af30779217d37047cbb1fddd1a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#abf6fc4af30779217d37047cbb1fddd1a">&#9670;&nbsp;</a></span>ast_threadpool_create()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="../../d5/d10/structast__threadpool.html">ast_threadpool</a>* ast_threadpool_create </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>name</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="../../dd/d12/structast__threadpool__listener.html">ast_threadpool_listener</a> *&#160;</td>
          <td class="paramname"><em>listener</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const struct <a class="el" href="../../de/de6/structast__threadpool__options.html">ast_threadpool_options</a> *&#160;</td>
          <td class="paramname"><em>options</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Create a new threadpool. </p>
<p>This function creates a threadpool. Tasks may be pushed onto this thread pool and will be automatically acted upon by threads within the pool.</p>
<p>Only a single threadpool with a given name may exist. This function will fail if a threadpool with the given name already exists.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">name</td><td>The unique name for the threadpool </td></tr>
    <tr><td class="paramname">listener</td><td>The listener the threadpool will notify of changes. Can be NULL. </td></tr>
    <tr><td class="paramname">options</td><td>The behavioral options for this threadpool </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">NULL</td><td>Failed to create the threadpool </td></tr>
    <tr><td class="paramname">non-NULL</td><td>The newly-created threadpool </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="../../d1/dc7/threadpool_8c_source.html#l00915">915</a> of file <a class="el" href="../../d1/dc7/threadpool_8c_source.html">threadpool.c</a>.</p>

<p class="reference">References <a class="el" href="../../d5/da5/astobj2_8h_source.html#l01958">ao2_cleanup</a>, <a class="el" href="../../d5/da5/astobj2_8h_source.html#l00464">ao2_ref</a>, <a class="el" href="../../d8/d8a/astmm_8h_source.html#l00290">ast_alloca</a>, <a class="el" href="../../da/df7/astobj2_8c_source.html#l00042">ast_log</a>, <a class="el" href="../../d4/deb/taskprocessor_8c_source.html#l01083">ast_taskprocessor_create_with_listener()</a>, <a class="el" href="../../d4/deb/taskprocessor_8c_source.html#l00930">ast_taskprocessor_listener_alloc()</a>, <a class="el" href="../../d3/d40/threadpool_8h_source.html#l00071">AST_THREADPOOL_OPTIONS_VERSION</a>, <a class="el" href="../../d1/dc7/threadpool_8c_source.html#l00874">ast_threadpool_set_size()</a>, <a class="el" href="../../d1/dc7/threadpool_8c_source.html#l00038">ast_threadpool::listener</a>, <a class="el" href="../../d1/d8c/logger_8h_source.html#l00274">LOG_WARNING</a>, <a class="el" href="../../dc/d7f/resample_8c_source.html#l00096">NULL</a>, <a class="el" href="../../d9/d21/res__rtp__asterisk_8c_source.html#l00236">pool</a>, <a class="el" href="../../d5/d60/utils_8h_source.html#l00911">RAII_VAR</a>, <a class="el" href="../../d1/dc7/threadpool_8c_source.html#l00404">threadpool_alloc()</a>, <a class="el" href="../../d1/dc7/threadpool_8c_source.html#l00067">ast_threadpool::tps</a>, and <a class="el" href="../../d3/d40/threadpool_8h_source.html#l00073">ast_threadpool_options::version</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../d7/d69/sorcery_8c_source.html#l00387">ast_sorcery_init()</a>, <a class="el" href="../../df/df7/test__taskprocessor_8c_source.html#l00901">AST_TEST_DEFINE()</a>, <a class="el" href="../../de/d96/res__pjsip_8c_source.html#l05810">load_module()</a>, and <a class="el" href="../../d0/df4/stasis_8c_source.html#l03061">stasis_init()</a>.</p>
<div class="fragment"><div class="line"><a name="l00918"></a><span class="lineno">  918</span>&#160;{</div><div class="line"><a name="l00919"></a><span class="lineno">  919</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../db/d17/structast__taskprocessor.html">ast_taskprocessor</a> *tps;</div><div class="line"><a name="l00920"></a><span class="lineno">  920</span>&#160;   <a class="code" href="../../d5/d60/utils_8h.html#a1604b4d72144dd3d9f7da668e90337e9">RAII_VAR</a>(<span class="keyword">struct</span> <a class="code" href="../../d7/d52/structast__taskprocessor__listener.html">ast_taskprocessor_listener</a> *, tps_listener, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../d5/da5/astobj2_8h.html#a6321ee982370c55ab3c24c72c562cbdd">ao2_cleanup</a>);</div><div class="line"><a name="l00921"></a><span class="lineno">  921</span>&#160;   <a class="code" href="../../d5/d60/utils_8h.html#a1604b4d72144dd3d9f7da668e90337e9">RAII_VAR</a>(<span class="keyword">struct</span> <a class="code" href="../../d5/d10/structast__threadpool.html">ast_threadpool</a> *, <a class="code" href="../../d9/d21/res__rtp__asterisk_8c.html#a2e57658a5d3ef6c4ef2774c9d5868e7c">pool</a>, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../d5/da5/astobj2_8h.html#a6321ee982370c55ab3c24c72c562cbdd">ao2_cleanup</a>);</div><div class="line"><a name="l00922"></a><span class="lineno">  922</span>&#160;   <span class="keywordtype">char</span> *fullname;</div><div class="line"><a name="l00923"></a><span class="lineno">  923</span>&#160;</div><div class="line"><a name="l00924"></a><span class="lineno">  924</span>&#160;   <a class="code" href="../../d9/d21/res__rtp__asterisk_8c.html#a2e57658a5d3ef6c4ef2774c9d5868e7c">pool</a> = <a class="code" href="../../d1/dc7/threadpool_8c.html#aff29105af0024d75406fe2d09017fa3d">threadpool_alloc</a>(<a class="code" href="../../d0/d29/cdr__mysql_8c.html#a0980a105ccb863d8008eb6201a51da52">name</a>, options);</div><div class="line"><a name="l00925"></a><span class="lineno">  925</span>&#160;   <span class="keywordflow">if</span> (!<a class="code" href="../../d9/d21/res__rtp__asterisk_8c.html#a2e57658a5d3ef6c4ef2774c9d5868e7c">pool</a>) {</div><div class="line"><a name="l00926"></a><span class="lineno">  926</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l00927"></a><span class="lineno">  927</span>&#160;   }</div><div class="line"><a name="l00928"></a><span class="lineno">  928</span>&#160;</div><div class="line"><a name="l00929"></a><span class="lineno">  929</span>&#160;   tps_listener = <a class="code" href="../../d0/d1e/taskprocessor_8h.html#ad7d5e40a1f7eac54dcad096b90d013bd">ast_taskprocessor_listener_alloc</a>(&amp;<a class="code" href="../../d1/dc7/threadpool_8c.html#a54b2045c1d47ecd3404aba214a0e0ab4">threadpool_tps_listener_callbacks</a>, <a class="code" href="../../d9/d21/res__rtp__asterisk_8c.html#a2e57658a5d3ef6c4ef2774c9d5868e7c">pool</a>);</div><div class="line"><a name="l00930"></a><span class="lineno">  930</span>&#160;   <span class="keywordflow">if</span> (!tps_listener) {</div><div class="line"><a name="l00931"></a><span class="lineno">  931</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l00932"></a><span class="lineno">  932</span>&#160;   }</div><div class="line"><a name="l00933"></a><span class="lineno">  933</span>&#160;</div><div class="line"><a name="l00934"></a><span class="lineno">  934</span>&#160;   <span class="keywordflow">if</span> (options-&gt;<a class="code" href="../../de/de6/structast__threadpool__options.html#aad880fc4455c253781e8968f2239d56f">version</a> != <a class="code" href="../../d3/d40/threadpool_8h.html#ae95119c74a92ef5c17f55421b278a25c">AST_THREADPOOL_OPTIONS_VERSION</a>) {</div><div class="line"><a name="l00935"></a><span class="lineno">  935</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Incompatible version of threadpool options in use.\n&quot;</span>);</div><div class="line"><a name="l00936"></a><span class="lineno">  936</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l00937"></a><span class="lineno">  937</span>&#160;   }</div><div class="line"><a name="l00938"></a><span class="lineno">  938</span>&#160;</div><div class="line"><a name="l00939"></a><span class="lineno">  939</span>&#160;   fullname = <a class="code" href="../../d8/d8a/astmm_8h.html#a249282ecc7ba5a1a49fa75e9a33d1717">ast_alloca</a>(strlen(<a class="code" href="../../d0/d29/cdr__mysql_8c.html#a0980a105ccb863d8008eb6201a51da52">name</a>) + strlen(<span class="stringliteral">&quot;/pool&quot;</span>) + 1);</div><div class="line"><a name="l00940"></a><span class="lineno">  940</span>&#160;   sprintf(fullname, <span class="stringliteral">&quot;%s/pool&quot;</span>, <a class="code" href="../../d0/d29/cdr__mysql_8c.html#a0980a105ccb863d8008eb6201a51da52">name</a>); <span class="comment">/* Safe */</span></div><div class="line"><a name="l00941"></a><span class="lineno">  941</span>&#160;   tps = <a class="code" href="../../d0/d1e/taskprocessor_8h.html#ab79575eb73e817bd3afe77c87308e8be">ast_taskprocessor_create_with_listener</a>(fullname, tps_listener);</div><div class="line"><a name="l00942"></a><span class="lineno">  942</span>&#160;   <span class="keywordflow">if</span> (!tps) {</div><div class="line"><a name="l00943"></a><span class="lineno">  943</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l00944"></a><span class="lineno">  944</span>&#160;   }</div><div class="line"><a name="l00945"></a><span class="lineno">  945</span>&#160;</div><div class="line"><a name="l00946"></a><span class="lineno">  946</span>&#160;   <a class="code" href="../../d9/d21/res__rtp__asterisk_8c.html#a2e57658a5d3ef6c4ef2774c9d5868e7c">pool</a>-&gt;tps = tps;</div><div class="line"><a name="l00947"></a><span class="lineno">  947</span>&#160;   <span class="keywordflow">if</span> (listener) {</div><div class="line"><a name="l00948"></a><span class="lineno">  948</span>&#160;      <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(listener, +1);</div><div class="line"><a name="l00949"></a><span class="lineno">  949</span>&#160;      <a class="code" href="../../d9/d21/res__rtp__asterisk_8c.html#a2e57658a5d3ef6c4ef2774c9d5868e7c">pool</a>-&gt;listener = <a class="code" href="../../d5/d03/asterisk_8c.html#adc01bca6281492dfec5ae217cf32fc34">listener</a>;</div><div class="line"><a name="l00950"></a><span class="lineno">  950</span>&#160;   }</div><div class="line"><a name="l00951"></a><span class="lineno">  951</span>&#160;   <a class="code" href="../../d1/dc7/threadpool_8c.html#a13fdc818d975e34cef105d44829a054b">ast_threadpool_set_size</a>(<a class="code" href="../../d9/d21/res__rtp__asterisk_8c.html#a2e57658a5d3ef6c4ef2774c9d5868e7c">pool</a>, <a class="code" href="../../d9/d21/res__rtp__asterisk_8c.html#a2e57658a5d3ef6c4ef2774c9d5868e7c">pool</a>-&gt;options.initial_size);</div><div class="line"><a name="l00952"></a><span class="lineno">  952</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(<a class="code" href="../../d9/d21/res__rtp__asterisk_8c.html#a2e57658a5d3ef6c4ef2774c9d5868e7c">pool</a>, +1);</div><div class="line"><a name="l00953"></a><span class="lineno">  953</span>&#160;   <span class="keywordflow">return</span> <a class="code" href="../../d9/d21/res__rtp__asterisk_8c.html#a2e57658a5d3ef6c4ef2774c9d5868e7c">pool</a>;</div><div class="line"><a name="l00954"></a><span class="lineno">  954</span>&#160;}</div><div class="ttc" id="structast__taskprocessor__listener_html"><div class="ttname"><a href="../../d7/d52/structast__taskprocessor__listener.html">ast_taskprocessor_listener</a></div><div class="ttdoc">A listener for taskprocessors. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/deb/taskprocessor_8c_source.html#l00110">taskprocessor.c:110</a></div></div>
<div class="ttc" id="threadpool_8c_html_a13fdc818d975e34cef105d44829a054b"><div class="ttname"><a href="../../d1/dc7/threadpool_8c.html#a13fdc818d975e34cef105d44829a054b">ast_threadpool_set_size</a></div><div class="ttdeci">void ast_threadpool_set_size(struct ast_threadpool *pool, unsigned int size)</div><div class="ttdoc">Set the number of threads for the thread pool. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/dc7/threadpool_8c_source.html#l00874">threadpool.c:874</a></div></div>
<div class="ttc" id="threadpool_8h_html_ae95119c74a92ef5c17f55421b278a25c"><div class="ttname"><a href="../../d3/d40/threadpool_8h.html#ae95119c74a92ef5c17f55421b278a25c">AST_THREADPOOL_OPTIONS_VERSION</a></div><div class="ttdeci">#define AST_THREADPOOL_OPTIONS_VERSION</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d40/threadpool_8h_source.html#l00071">threadpool.h:71</a></div></div>
<div class="ttc" id="logger_8h_html_adf4476a6a4ea6c74231c826e899d7189"><div class="ttname"><a href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a></div><div class="ttdeci">#define LOG_WARNING</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d8c/logger_8h_source.html#l00274">logger.h:274</a></div></div>
<div class="ttc" id="res__rtp__asterisk_8c_html_a2e57658a5d3ef6c4ef2774c9d5868e7c"><div class="ttname"><a href="../../d9/d21/res__rtp__asterisk_8c.html#a2e57658a5d3ef6c4ef2774c9d5868e7c">pool</a></div><div class="ttdeci">static pj_pool_t * pool</div><div class="ttdoc">Global memory pool for configuration and timers. </div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d21/res__rtp__asterisk_8c_source.html#l00236">res_rtp_asterisk.c:236</a></div></div>
<div class="ttc" id="threadpool_8c_html_aff29105af0024d75406fe2d09017fa3d"><div class="ttname"><a href="../../d1/dc7/threadpool_8c.html#aff29105af0024d75406fe2d09017fa3d">threadpool_alloc</a></div><div class="ttdeci">static struct ast_threadpool * threadpool_alloc(const char *name, const struct ast_threadpool_options *options)</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/dc7/threadpool_8c_source.html#l00404">threadpool.c:404</a></div></div>
<div class="ttc" id="resample_8c_html_a070d2ce7b6bb7e5c05602aa8c308d0c4"><div class="ttname"><a href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a></div><div class="ttdeci">#define NULL</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d7f/resample_8c_source.html#l00096">resample.c:96</a></div></div>
<div class="ttc" id="astobj2_8c_html_a96a00b3a518d7f32b6d51dc28f09bf9b"><div class="ttname"><a href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a></div><div class="ttdeci">#define ast_log</div><div class="ttdef"><b>Definition:</b> <a href="../../da/df7/astobj2_8c_source.html#l00042">astobj2.c:42</a></div></div>
<div class="ttc" id="asterisk_8c_html_adc01bca6281492dfec5ae217cf32fc34"><div class="ttname"><a href="../../d5/d03/asterisk_8c.html#adc01bca6281492dfec5ae217cf32fc34">listener</a></div><div class="ttdeci">static void * listener(void *unused)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d03/asterisk_8c_source.html#l01476">asterisk.c:1476</a></div></div>
<div class="ttc" id="threadpool_8c_html_a54b2045c1d47ecd3404aba214a0e0ab4"><div class="ttname"><a href="../../d1/dc7/threadpool_8c.html#a54b2045c1d47ecd3404aba214a0e0ab4">threadpool_tps_listener_callbacks</a></div><div class="ttdeci">static struct ast_taskprocessor_listener_callbacks threadpool_tps_listener_callbacks</div><div class="ttdoc">Table of taskprocessor listener callbacks for threadpool&amp;#39;s main taskprocessor. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/dc7/threadpool_8c_source.html#l00695">threadpool.c:695</a></div></div>
<div class="ttc" id="utils_8h_html_a1604b4d72144dd3d9f7da668e90337e9"><div class="ttname"><a href="../../d5/d60/utils_8h.html#a1604b4d72144dd3d9f7da668e90337e9">RAII_VAR</a></div><div class="ttdeci">#define RAII_VAR(vartype, varname, initval, dtor)</div><div class="ttdoc">Declare a variable that will call a destructor function when it goes out of scope. </div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d60/utils_8h_source.html#l00911">utils.h:911</a></div></div>
<div class="ttc" id="astobj2_8h_html_aaca5e8eac39a22f9da1c36fc6c922270"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a></div><div class="ttdeci">#define ao2_ref(o, delta)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l00464">astobj2.h:464</a></div></div>
<div class="ttc" id="astmm_8h_html_a249282ecc7ba5a1a49fa75e9a33d1717"><div class="ttname"><a href="../../d8/d8a/astmm_8h.html#a249282ecc7ba5a1a49fa75e9a33d1717">ast_alloca</a></div><div class="ttdeci">#define ast_alloca(size)</div><div class="ttdoc">call __builtin_alloca to ensure we get gcc builtin semantics </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d8a/astmm_8h_source.html#l00290">astmm.h:290</a></div></div>
<div class="ttc" id="cdr__mysql_8c_html_a0980a105ccb863d8008eb6201a51da52"><div class="ttname"><a href="../../d0/d29/cdr__mysql_8c.html#a0980a105ccb863d8008eb6201a51da52">name</a></div><div class="ttdeci">static const char name[]</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d29/cdr__mysql_8c_source.html#l00074">cdr_mysql.c:74</a></div></div>
<div class="ttc" id="structast__threadpool__options_html_aad880fc4455c253781e8968f2239d56f"><div class="ttname"><a href="../../de/de6/structast__threadpool__options.html#aad880fc4455c253781e8968f2239d56f">ast_threadpool_options::version</a></div><div class="ttdeci">int version</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d40/threadpool_8h_source.html#l00073">threadpool.h:73</a></div></div>
<div class="ttc" id="taskprocessor_8h_html_ad7d5e40a1f7eac54dcad096b90d013bd"><div class="ttname"><a href="../../d0/d1e/taskprocessor_8h.html#ad7d5e40a1f7eac54dcad096b90d013bd">ast_taskprocessor_listener_alloc</a></div><div class="ttdeci">struct ast_taskprocessor_listener * ast_taskprocessor_listener_alloc(const struct ast_taskprocessor_listener_callbacks *callbacks, void *user_data)</div><div class="ttdoc">Allocate a taskprocessor listener. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/deb/taskprocessor_8c_source.html#l00930">taskprocessor.c:930</a></div></div>
<div class="ttc" id="structast__taskprocessor_html"><div class="ttname"><a href="../../db/d17/structast__taskprocessor.html">ast_taskprocessor</a></div><div class="ttdoc">A ast_taskprocessor structure is a singleton by name. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/deb/taskprocessor_8c_source.html#l00069">taskprocessor.c:69</a></div></div>
<div class="ttc" id="astobj2_8h_html_a6321ee982370c55ab3c24c72c562cbdd"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#a6321ee982370c55ab3c24c72c562cbdd">ao2_cleanup</a></div><div class="ttdeci">#define ao2_cleanup(obj)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l01958">astobj2.h:1958</a></div></div>
<div class="ttc" id="structast__threadpool_html"><div class="ttname"><a href="../../d5/d10/structast__threadpool.html">ast_threadpool</a></div><div class="ttdoc">An opaque threadpool structure. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/dc7/threadpool_8c_source.html#l00036">threadpool.c:36</a></div></div>
<div class="ttc" id="taskprocessor_8h_html_ab79575eb73e817bd3afe77c87308e8be"><div class="ttname"><a href="../../d0/d1e/taskprocessor_8h.html#ab79575eb73e817bd3afe77c87308e8be">ast_taskprocessor_create_with_listener</a></div><div class="ttdeci">struct ast_taskprocessor * ast_taskprocessor_create_with_listener(const char *name, struct ast_taskprocessor_listener *listener)</div><div class="ttdoc">Create a taskprocessor with a custom listener. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/deb/taskprocessor_8c_source.html#l01083">taskprocessor.c:1083</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a3e1d943184d2d6260b6718e5629bbc24"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3e1d943184d2d6260b6718e5629bbc24">&#9670;&nbsp;</a></span>ast_threadpool_listener_alloc()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="../../dd/d12/structast__threadpool__listener.html">ast_threadpool_listener</a>* ast_threadpool_listener_alloc </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="../../df/d64/structast__threadpool__listener__callbacks.html">ast_threadpool_listener_callbacks</a> *&#160;</td>
          <td class="paramname"><em>callbacks</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>user_data</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Allocate a threadpool listener. </p>
<p>This function will call back into the alloc callback for the listener.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">callbacks</td><td>Listener callbacks to assign to the listener </td></tr>
    <tr><td class="paramname">user_data</td><td>User data to be stored in the threadpool listener </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">NULL</td><td>Failed to allocate the listener </td></tr>
    <tr><td class="paramname">non-NULL</td><td>The newly-created threadpool listener </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="../../d1/dc7/threadpool_8c_source.html#l00893">893</a> of file <a class="el" href="../../d1/dc7/threadpool_8c_source.html">threadpool.c</a>.</p>

<p class="reference">References <a class="el" href="../../d5/da5/astobj2_8h_source.html#l00411">ao2_alloc</a>, <a class="el" href="../../d1/dc7/threadpool_8c_source.html#l00112">ast_threadpool_listener::callbacks</a>, <a class="el" href="../../d1/dc7/threadpool_8c_source.html#l00038">ast_threadpool::listener</a>, <a class="el" href="../../dc/d7f/resample_8c_source.html#l00096">NULL</a>, and <a class="el" href="../../d1/dc7/threadpool_8c_source.html#l00114">ast_threadpool_listener::user_data</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../de/dec/test__threadpool_8c_source.html#l00288">AST_TEST_DEFINE()</a>.</p>
<div class="fragment"><div class="line"><a name="l00895"></a><span class="lineno">  895</span>&#160;{</div><div class="line"><a name="l00896"></a><span class="lineno">  896</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../dd/d12/structast__threadpool__listener.html">ast_threadpool_listener</a> *<a class="code" href="../../d5/d03/asterisk_8c.html#adc01bca6281492dfec5ae217cf32fc34">listener</a> = <a class="code" href="../../d5/da5/astobj2_8h.html#ae0422b60d8e25b6962b2d61ae4ddf724">ao2_alloc</a>(<span class="keyword">sizeof</span>(*listener), <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div><div class="line"><a name="l00897"></a><span class="lineno">  897</span>&#160;   <span class="keywordflow">if</span> (!listener) {</div><div class="line"><a name="l00898"></a><span class="lineno">  898</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l00899"></a><span class="lineno">  899</span>&#160;   }</div><div class="line"><a name="l00900"></a><span class="lineno">  900</span>&#160;   listener-&gt;<a class="code" href="../../dd/d12/structast__threadpool__listener.html#ae47947f47eb99da4337ce95cddd1d614">callbacks</a> = <a class="code" href="../../dd/d12/structast__threadpool__listener.html#ae47947f47eb99da4337ce95cddd1d614">callbacks</a>;</div><div class="line"><a name="l00901"></a><span class="lineno">  901</span>&#160;   listener-&gt;<a class="code" href="../../dd/d12/structast__threadpool__listener.html#a0f53d287ac7c064d1a49d4bd93ca1cb9">user_data</a> = <a class="code" href="../../dd/d12/structast__threadpool__listener.html#a0f53d287ac7c064d1a49d4bd93ca1cb9">user_data</a>;</div><div class="line"><a name="l00902"></a><span class="lineno">  902</span>&#160;   <span class="keywordflow">return</span> <a class="code" href="../../d5/d03/asterisk_8c.html#adc01bca6281492dfec5ae217cf32fc34">listener</a>;</div><div class="line"><a name="l00903"></a><span class="lineno">  903</span>&#160;}</div><div class="ttc" id="resample_8c_html_a070d2ce7b6bb7e5c05602aa8c308d0c4"><div class="ttname"><a href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a></div><div class="ttdeci">#define NULL</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d7f/resample_8c_source.html#l00096">resample.c:96</a></div></div>
<div class="ttc" id="structast__threadpool__listener_html_ae47947f47eb99da4337ce95cddd1d614"><div class="ttname"><a href="../../dd/d12/structast__threadpool__listener.html#ae47947f47eb99da4337ce95cddd1d614">ast_threadpool_listener::callbacks</a></div><div class="ttdeci">const struct ast_threadpool_listener_callbacks * callbacks</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/dc7/threadpool_8c_source.html#l00112">threadpool.c:112</a></div></div>
<div class="ttc" id="asterisk_8c_html_adc01bca6281492dfec5ae217cf32fc34"><div class="ttname"><a href="../../d5/d03/asterisk_8c.html#adc01bca6281492dfec5ae217cf32fc34">listener</a></div><div class="ttdeci">static void * listener(void *unused)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d03/asterisk_8c_source.html#l01476">asterisk.c:1476</a></div></div>
<div class="ttc" id="astobj2_8h_html_ae0422b60d8e25b6962b2d61ae4ddf724"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#ae0422b60d8e25b6962b2d61ae4ddf724">ao2_alloc</a></div><div class="ttdeci">#define ao2_alloc(data_size, destructor_fn)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l00411">astobj2.h:411</a></div></div>
<div class="ttc" id="structast__threadpool__listener_html_a0f53d287ac7c064d1a49d4bd93ca1cb9"><div class="ttname"><a href="../../dd/d12/structast__threadpool__listener.html#a0f53d287ac7c064d1a49d4bd93ca1cb9">ast_threadpool_listener::user_data</a></div><div class="ttdeci">void * user_data</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/dc7/threadpool_8c_source.html#l00114">threadpool.c:114</a></div></div>
<div class="ttc" id="structast__threadpool__listener_html"><div class="ttname"><a href="../../dd/d12/structast__threadpool__listener.html">ast_threadpool_listener</a></div><div class="ttdoc">listener for a threadpool </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/dc7/threadpool_8c_source.html#l00110">threadpool.c:110</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="aa9bee831e887eb53e72a7e161d5c19de"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa9bee831e887eb53e72a7e161d5c19de">&#9670;&nbsp;</a></span>ast_threadpool_listener_get_user_data()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void* ast_threadpool_listener_get_user_data </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="../../dd/d12/structast__threadpool__listener.html">ast_threadpool_listener</a> *&#160;</td>
          <td class="paramname"><em>listener</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Get the threadpool listener's user data. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">listener</td><td>The threadpool listener </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>The user data </dd></dl>

<p class="definition">Definition at line <a class="el" href="../../d1/dc7/threadpool_8c_source.html#l00905">905</a> of file <a class="el" href="../../d1/dc7/threadpool_8c_source.html">threadpool.c</a>.</p>

<p class="reference">References <a class="el" href="../../d1/dc7/threadpool_8c_source.html#l00114">ast_threadpool_listener::user_data</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../de/dec/test__threadpool_8c_source.html#l00241">listener_check()</a>, <a class="el" href="../../de/dec/test__threadpool_8c_source.html#l00089">test_emptied()</a>, <a class="el" href="../../de/dec/test__threadpool_8c_source.html#l00098">test_shutdown()</a>, <a class="el" href="../../de/dec/test__threadpool_8c_source.html#l00064">test_state_changed()</a>, <a class="el" href="../../de/dec/test__threadpool_8c_source.html#l00077">test_task_pushed()</a>, and <a class="el" href="../../de/dec/test__threadpool_8c_source.html#l00177">wait_for_task_pushed()</a>.</p>
<div class="fragment"><div class="line"><a name="l00906"></a><span class="lineno">  906</span>&#160;{</div><div class="line"><a name="l00907"></a><span class="lineno">  907</span>&#160;   <span class="keywordflow">return</span> listener-&gt;<a class="code" href="../../dd/d12/structast__threadpool__listener.html#a0f53d287ac7c064d1a49d4bd93ca1cb9">user_data</a>;</div><div class="line"><a name="l00908"></a><span class="lineno">  908</span>&#160;}</div><div class="ttc" id="structast__threadpool__listener_html_a0f53d287ac7c064d1a49d4bd93ca1cb9"><div class="ttname"><a href="../../dd/d12/structast__threadpool__listener.html#a0f53d287ac7c064d1a49d4bd93ca1cb9">ast_threadpool_listener::user_data</a></div><div class="ttdeci">void * user_data</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/dc7/threadpool_8c_source.html#l00114">threadpool.c:114</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a6703b90076af2b709e18c532e702da76"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6703b90076af2b709e18c532e702da76">&#9670;&nbsp;</a></span>ast_threadpool_push()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ast_threadpool_push </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="../../d5/d10/structast__threadpool.html">ast_threadpool</a> *&#160;</td>
          <td class="paramname"><em>pool</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int(*)(void *data)&#160;</td>
          <td class="paramname"><em>task</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>data</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Push a task to the threadpool. </p>
<p>Tasks pushed into the threadpool will be automatically taken by one of the threads within </p><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">pool</td><td>The threadpool to add the task to </td></tr>
    <tr><td class="paramname">task</td><td>The task to add </td></tr>
    <tr><td class="paramname">data</td><td>The parameter for the task </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">0</td><td>success </td></tr>
    <tr><td class="paramname">-1</td><td>failure </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="../../d1/dc7/threadpool_8c_source.html#l00956">956</a> of file <a class="el" href="../../d1/dc7/threadpool_8c_source.html">threadpool.c</a>.</p>

<p class="reference">References <a class="el" href="../../d4/deb/taskprocessor_8c_source.html#l01175">ast_taskprocessor_push()</a>, <a class="el" href="../../df/d44/app__meetme_8c_source.html#l01091">lock</a>, <a class="el" href="../../dd/d42/lock_8h_source.html#l00602">SCOPED_AO2LOCK</a>, <a class="el" href="../../d1/dc7/threadpool_8c_source.html#l00098">ast_threadpool::shutting_down</a>, <a class="el" href="../../df/df7/test__taskprocessor_8c_source.html#l00088">task()</a>, and <a class="el" href="../../d1/dc7/threadpool_8c_source.html#l00067">ast_threadpool::tps</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../de/dec/test__threadpool_8c_source.html#l00288">AST_TEST_DEFINE()</a>, and <a class="el" href="../../d1/dc7/threadpool_8c_source.html#l01363">serializer_task_pushed()</a>.</p>
<div class="fragment"><div class="line"><a name="l00957"></a><span class="lineno">  957</span>&#160;{</div><div class="line"><a name="l00958"></a><span class="lineno">  958</span>&#160;   <a class="code" href="../../dd/d42/lock_8h.html#a2cfb325ed371eb6e629446bac4676e9f">SCOPED_AO2LOCK</a>(<a class="code" href="../../df/d44/app__meetme_8c.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>, pool);</div><div class="line"><a name="l00959"></a><span class="lineno">  959</span>&#160;   <span class="keywordflow">if</span> (!pool-&gt;<a class="code" href="../../d5/d10/structast__threadpool.html#a7f68568851b9c7f9291f7bb63f932c18">shutting_down</a>) {</div><div class="line"><a name="l00960"></a><span class="lineno">  960</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../d0/d1e/taskprocessor_8h.html#a6b2508ba0a6b8f43ae6d3963f3189585">ast_taskprocessor_push</a>(pool-&gt;<a class="code" href="../../d5/d10/structast__threadpool.html#a4c381cb1b5cf198fa3f260212e716c9a">tps</a>, <a class="code" href="../../df/df7/test__taskprocessor_8c.html#a07d08fd44ac4a9f8e1319ce270f5d56a">task</a>, data);</div><div class="line"><a name="l00961"></a><span class="lineno">  961</span>&#160;   }</div><div class="line"><a name="l00962"></a><span class="lineno">  962</span>&#160;   <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l00963"></a><span class="lineno">  963</span>&#160;}</div><div class="ttc" id="structast__threadpool_html_a7f68568851b9c7f9291f7bb63f932c18"><div class="ttname"><a href="../../d5/d10/structast__threadpool.html#a7f68568851b9c7f9291f7bb63f932c18">ast_threadpool::shutting_down</a></div><div class="ttdeci">int shutting_down</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/dc7/threadpool_8c_source.html#l00098">threadpool.c:98</a></div></div>
<div class="ttc" id="test__taskprocessor_8c_html_a07d08fd44ac4a9f8e1319ce270f5d56a"><div class="ttname"><a href="../../df/df7/test__taskprocessor_8c.html#a07d08fd44ac4a9f8e1319ce270f5d56a">task</a></div><div class="ttdeci">static int task(void *data)</div><div class="ttdoc">Queued task for baseline test. </div><div class="ttdef"><b>Definition:</b> <a href="../../df/df7/test__taskprocessor_8c_source.html#l00088">test_taskprocessor.c:88</a></div></div>
<div class="ttc" id="app__meetme_8c_html_adf04f66344e3fb0a6f6a69bf39d19902"><div class="ttname"><a href="../../df/d44/app__meetme_8c.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a></div><div class="ttdeci">ast_mutex_t lock</div><div class="ttdef"><b>Definition:</b> <a href="../../df/d44/app__meetme_8c_source.html#l01091">app_meetme.c:1091</a></div></div>
<div class="ttc" id="structast__threadpool_html_a4c381cb1b5cf198fa3f260212e716c9a"><div class="ttname"><a href="../../d5/d10/structast__threadpool.html#a4c381cb1b5cf198fa3f260212e716c9a">ast_threadpool::tps</a></div><div class="ttdeci">struct ast_taskprocessor * tps</div><div class="ttdoc">The main taskprocessor. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/dc7/threadpool_8c_source.html#l00067">threadpool.c:67</a></div></div>
<div class="ttc" id="lock_8h_html_a2cfb325ed371eb6e629446bac4676e9f"><div class="ttname"><a href="../../dd/d42/lock_8h.html#a2cfb325ed371eb6e629446bac4676e9f">SCOPED_AO2LOCK</a></div><div class="ttdeci">#define SCOPED_AO2LOCK(varname, obj)</div><div class="ttdoc">scoped lock specialization for ao2 mutexes. </div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d42/lock_8h_source.html#l00602">lock.h:602</a></div></div>
<div class="ttc" id="taskprocessor_8h_html_a6b2508ba0a6b8f43ae6d3963f3189585"><div class="ttname"><a href="../../d0/d1e/taskprocessor_8h.html#a6b2508ba0a6b8f43ae6d3963f3189585">ast_taskprocessor_push</a></div><div class="ttdeci">int ast_taskprocessor_push(struct ast_taskprocessor *tps, int(*task_exe)(void *datap), void *datap) attribute_warn_unused_result</div><div class="ttdoc">Push a task into the specified taskprocessor queue and signal the taskprocessor thread. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/deb/taskprocessor_8c_source.html#l01175">taskprocessor.c:1175</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a6e65e5b2e17e83c008f74b1d93cee2b5"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6e65e5b2e17e83c008f74b1d93cee2b5">&#9670;&nbsp;</a></span>ast_threadpool_queue_size()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">long ast_threadpool_queue_size </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="../../d5/d10/structast__threadpool.html">ast_threadpool</a> *&#160;</td>
          <td class="paramname"><em>pool</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Return the size of the threadpool's task queue. </p>
<dl class="section since"><dt>Since</dt><dd>13.7.0 </dd></dl>

<p class="definition">Definition at line <a class="el" href="../../d1/dc7/threadpool_8c_source.html#l01437">1437</a> of file <a class="el" href="../../d1/dc7/threadpool_8c_source.html">threadpool.c</a>.</p>

<p class="reference">References <a class="el" href="../../d4/deb/taskprocessor_8c_source.html#l00900">ast_taskprocessor_size()</a>, and <a class="el" href="../../d1/dc7/threadpool_8c_source.html#l00067">ast_threadpool::tps</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../de/d96/res__pjsip_8c_source.html#l05625">ast_sip_threadpool_queue_size()</a>.</p>
<div class="fragment"><div class="line"><a name="l01438"></a><span class="lineno"> 1438</span>&#160;{</div><div class="line"><a name="l01439"></a><span class="lineno"> 1439</span>&#160;   <span class="keywordflow">return</span> <a class="code" href="../../d0/d1e/taskprocessor_8h.html#a83d09062fb3c84cf1c84a04174deb2bf">ast_taskprocessor_size</a>(pool-&gt;<a class="code" href="../../d5/d10/structast__threadpool.html#a4c381cb1b5cf198fa3f260212e716c9a">tps</a>);</div><div class="line"><a name="l01440"></a><span class="lineno"> 1440</span>&#160;}</div><div class="ttc" id="taskprocessor_8h_html_a83d09062fb3c84cf1c84a04174deb2bf"><div class="ttname"><a href="../../d0/d1e/taskprocessor_8h.html#a83d09062fb3c84cf1c84a04174deb2bf">ast_taskprocessor_size</a></div><div class="ttdeci">long ast_taskprocessor_size(struct ast_taskprocessor *tps)</div><div class="ttdoc">Return the current size of the taskprocessor queue. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/deb/taskprocessor_8c_source.html#l00900">taskprocessor.c:900</a></div></div>
<div class="ttc" id="structast__threadpool_html_a4c381cb1b5cf198fa3f260212e716c9a"><div class="ttname"><a href="../../d5/d10/structast__threadpool.html#a4c381cb1b5cf198fa3f260212e716c9a">ast_threadpool::tps</a></div><div class="ttdeci">struct ast_taskprocessor * tps</div><div class="ttdoc">The main taskprocessor. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/dc7/threadpool_8c_source.html#l00067">threadpool.c:67</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a6e86f51d34ae17fd6f38b8379883bf87"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6e86f51d34ae17fd6f38b8379883bf87">&#9670;&nbsp;</a></span>ast_threadpool_serializer()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="../../db/d17/structast__taskprocessor.html">ast_taskprocessor</a>* ast_threadpool_serializer </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>name</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="../../d5/d10/structast__threadpool.html">ast_threadpool</a> *&#160;</td>
          <td class="paramname"><em>pool</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Serialized execution of tasks within a <a class="el" href="../../d5/d10/structast__threadpool.html">ast_threadpool</a>. </p>
<dl class="section since"><dt>Since</dt><dd>12.0.0</dd></dl>
<p>A <a class="el" href="../../db/d17/structast__taskprocessor.html">ast_taskprocessor</a> with the same contract as a default taskprocessor (tasks execute serially) except instead of executing out of a dedicated thread, execution occurs in a thread from a <a class="el" href="../../d5/d10/structast__threadpool.html">ast_threadpool</a>. Think of it as a lightweight thread.</p>
<p>While it guarantees that each task will complete before executing the next, there is no guarantee as to which thread from the <code>pool</code> individual tasks will execute. This normally only matters if your code relys on thread specific information, such as thread locals.</p>
<p>Use <a class="el" href="../../d0/d1e/taskprocessor_8h.html#a32492eb2480cb8c46ad669622cff8556" title="Unreference the specified taskprocessor and its reference count will decrement. ">ast_taskprocessor_unreference()</a> to dispose of the returned <a class="el" href="../../db/d17/structast__taskprocessor.html">ast_taskprocessor</a>.</p>
<p>Only a single taskprocessor with a given name may exist. This function will fail if a taskprocessor with the given name already exists.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">name</td><td>Name of the serializer. (must be unique) </td></tr>
    <tr><td class="paramname">pool</td><td><a class="el" href="../../d5/d10/structast__threadpool.html">ast_threadpool</a> for execution.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd><a class="el" href="../../db/d17/structast__taskprocessor.html">ast_taskprocessor</a> for enqueuing work. </dd>
<dd>
<code>NULL</code> on error. </dd></dl>

<p class="definition">Definition at line <a class="el" href="../../d1/dc7/threadpool_8c_source.html#l01432">1432</a> of file <a class="el" href="../../d1/dc7/threadpool_8c_source.html">threadpool.c</a>.</p>

<p class="reference">References <a class="el" href="../../d1/dc7/threadpool_8c_source.html#l01402">ast_threadpool_serializer_group()</a>, and <a class="el" href="../../dc/d7f/resample_8c_source.html#l00096">NULL</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../de/dec/test__threadpool_8c_source.html#l01630">AST_TEST_DEFINE()</a>, <a class="el" href="../../d0/df4/stasis_8c_source.html#l00858">internal_stasis_subscribe()</a>, and <a class="el" href="../../d7/d69/sorcery_8c_source.html#l00700">sorcery_object_type_alloc()</a>.</p>
<div class="fragment"><div class="line"><a name="l01433"></a><span class="lineno"> 1433</span>&#160;{</div><div class="line"><a name="l01434"></a><span class="lineno"> 1434</span>&#160;   <span class="keywordflow">return</span> <a class="code" href="../../d1/dc7/threadpool_8c.html#a49b8fabf465ce8e4f325ceecda8ccd16">ast_threadpool_serializer_group</a>(<a class="code" href="../../d0/d29/cdr__mysql_8c.html#a0980a105ccb863d8008eb6201a51da52">name</a>, pool, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div><div class="line"><a name="l01435"></a><span class="lineno"> 1435</span>&#160;}</div><div class="ttc" id="threadpool_8c_html_a49b8fabf465ce8e4f325ceecda8ccd16"><div class="ttname"><a href="../../d1/dc7/threadpool_8c.html#a49b8fabf465ce8e4f325ceecda8ccd16">ast_threadpool_serializer_group</a></div><div class="ttdeci">struct ast_taskprocessor * ast_threadpool_serializer_group(const char *name, struct ast_threadpool *pool, struct ast_serializer_shutdown_group *shutdown_group)</div><div class="ttdoc">Serialized execution of tasks within a ast_threadpool. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/dc7/threadpool_8c_source.html#l01402">threadpool.c:1402</a></div></div>
<div class="ttc" id="resample_8c_html_a070d2ce7b6bb7e5c05602aa8c308d0c4"><div class="ttname"><a href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a></div><div class="ttdeci">#define NULL</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d7f/resample_8c_source.html#l00096">resample.c:96</a></div></div>
<div class="ttc" id="cdr__mysql_8c_html_a0980a105ccb863d8008eb6201a51da52"><div class="ttname"><a href="../../d0/d29/cdr__mysql_8c.html#a0980a105ccb863d8008eb6201a51da52">name</a></div><div class="ttdeci">static const char name[]</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d29/cdr__mysql_8c_source.html#l00074">cdr_mysql.c:74</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="ad8505fda5adce26c0e2e45de0a0dcb51"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad8505fda5adce26c0e2e45de0a0dcb51">&#9670;&nbsp;</a></span>ast_threadpool_serializer_get_current()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="../../db/d17/structast__taskprocessor.html">ast_taskprocessor</a>* ast_threadpool_serializer_get_current </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Get the threadpool serializer currently associated with this thread. </p>
<dl class="section since"><dt>Since</dt><dd>14.0.0</dd></dl>
<dl class="section note"><dt>Note</dt><dd>The returned pointer is valid while the serializer thread is running.</dd>
<dd>
Use <a class="el" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref()</a> on serializer if you are going to keep it for another thread. To unref it you must then use <a class="el" href="../../d0/d1e/taskprocessor_8h.html#a32492eb2480cb8c46ad669622cff8556" title="Unreference the specified taskprocessor and its reference count will decrement. ">ast_taskprocessor_unreference()</a>.</dd></dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">serializer</td><td>on success. </td></tr>
    <tr><td class="paramname">NULL</td><td>on error or no serializer associated with the thread. </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="../../d1/dc7/threadpool_8c_source.html#l01397">1397</a> of file <a class="el" href="../../d1/dc7/threadpool_8c_source.html">threadpool.c</a>.</p>

<p class="reference">References <a class="el" href="../../dc/d7d/threadstorage_8h_source.html#l00241">ast_threadstorage_get_ptr()</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../d7/dad/pjsip__distributor_8c_source.html#l00077">record_serializer()</a>, <a class="el" href="../../da/d5c/res__pjsip__rfc3326_8c_source.html#l00113">rfc3326_outgoing_request()</a>, <a class="el" href="../../da/d5c/res__pjsip__rfc3326_8c_source.html#l00130">rfc3326_outgoing_response()</a>, and <a class="el" href="../../d4/d43/pjsip__resolver_8c_source.html#l00468">sip_resolve()</a>.</p>
<div class="fragment"><div class="line"><a name="l01398"></a><span class="lineno"> 1398</span>&#160;{</div><div class="line"><a name="l01399"></a><span class="lineno"> 1399</span>&#160;   <span class="keywordflow">return</span> <a class="code" href="../../dc/d7d/threadstorage_8h.html#a273e9e038c879199c4192156b9349169">ast_threadstorage_get_ptr</a>(&amp;current_serializer);</div><div class="line"><a name="l01400"></a><span class="lineno"> 1400</span>&#160;}</div><div class="ttc" id="threadstorage_8h_html_a273e9e038c879199c4192156b9349169"><div class="ttname"><a href="../../dc/d7d/threadstorage_8h.html#a273e9e038c879199c4192156b9349169">ast_threadstorage_get_ptr</a></div><div class="ttdeci">void * ast_threadstorage_get_ptr(struct ast_threadstorage *ts)</div><div class="ttdoc">Retrieve a raw pointer from threadstorage. </div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d7d/threadstorage_8h_source.html#l00241">threadstorage.h:241</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a49b8fabf465ce8e4f325ceecda8ccd16"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a49b8fabf465ce8e4f325ceecda8ccd16">&#9670;&nbsp;</a></span>ast_threadpool_serializer_group()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="../../db/d17/structast__taskprocessor.html">ast_taskprocessor</a>* ast_threadpool_serializer_group </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>name</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="../../d5/d10/structast__threadpool.html">ast_threadpool</a> *&#160;</td>
          <td class="paramname"><em>pool</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="../../dc/d82/structast__serializer__shutdown__group.html">ast_serializer_shutdown_group</a> *&#160;</td>
          <td class="paramname"><em>shutdown_group</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Serialized execution of tasks within a <a class="el" href="../../d5/d10/structast__threadpool.html">ast_threadpool</a>. </p>
<dl class="section since"><dt>Since</dt><dd>13.5.0</dd></dl>
<p>A <a class="el" href="../../db/d17/structast__taskprocessor.html">ast_taskprocessor</a> with the same contract as a default taskprocessor (tasks execute serially) except instead of executing out of a dedicated thread, execution occurs in a thread from a <a class="el" href="../../d5/d10/structast__threadpool.html">ast_threadpool</a>. Think of it as a lightweight thread.</p>
<p>While it guarantees that each task will complete before executing the next, there is no guarantee as to which thread from the <code>pool</code> individual tasks will execute. This normally only matters if your code relys on thread specific information, such as thread locals.</p>
<p>Use <a class="el" href="../../d0/d1e/taskprocessor_8h.html#a32492eb2480cb8c46ad669622cff8556" title="Unreference the specified taskprocessor and its reference count will decrement. ">ast_taskprocessor_unreference()</a> to dispose of the returned <a class="el" href="../../db/d17/structast__taskprocessor.html">ast_taskprocessor</a>.</p>
<p>Only a single taskprocessor with a given name may exist. This function will fail if a taskprocessor with the given name already exists.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">name</td><td>Name of the serializer. (must be unique) </td></tr>
    <tr><td class="paramname">pool</td><td><a class="el" href="../../d5/d10/structast__threadpool.html">ast_threadpool</a> for execution. </td></tr>
    <tr><td class="paramname">shutdown_group</td><td>Group shutdown controller. (NULL if no group association)</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd><a class="el" href="../../db/d17/structast__taskprocessor.html">ast_taskprocessor</a> for enqueuing work. </dd>
<dd>
<code>NULL</code> on error. </dd></dl>

<p class="definition">Definition at line <a class="el" href="../../d1/dc7/threadpool_8c_source.html#l01402">1402</a> of file <a class="el" href="../../d1/dc7/threadpool_8c_source.html">threadpool.c</a>.</p>

<p class="reference">References <a class="el" href="../../d5/da5/astobj2_8h_source.html#l00464">ao2_ref</a>, <a class="el" href="../../d4/deb/taskprocessor_8c_source.html#l01083">ast_taskprocessor_create_with_listener()</a>, <a class="el" href="../../d4/deb/taskprocessor_8c_source.html#l00930">ast_taskprocessor_listener_alloc()</a>, <a class="el" href="../../d1/dc7/threadpool_8c_source.html#l00038">ast_threadpool::listener</a>, <a class="el" href="../../dc/d7f/resample_8c_source.html#l00096">NULL</a>, <a class="el" href="../../d1/dc7/threadpool_8c_source.html#l01332">serializer_create()</a>, <a class="el" href="../../d1/dc7/threadpool_8c_source.html#l01289">serializer_shutdown_group_inc()</a>, and <a class="el" href="../../d1/dc7/threadpool_8c_source.html#l00067">ast_threadpool::tps</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../d6/dd3/serializer_8c_source.html#l00076">ast_serializer_pool_create()</a>, <a class="el" href="../../de/d96/res__pjsip_8c_source.html#l05128">ast_sip_create_serializer_group()</a>, and <a class="el" href="../../d1/dc7/threadpool_8c_source.html#l01432">ast_threadpool_serializer()</a>.</p>
<div class="fragment"><div class="line"><a name="l01404"></a><span class="lineno"> 1404</span>&#160;{</div><div class="line"><a name="l01405"></a><span class="lineno"> 1405</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d9/d47/structserializer.html">serializer</a> *ser;</div><div class="line"><a name="l01406"></a><span class="lineno"> 1406</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d7/d52/structast__taskprocessor__listener.html">ast_taskprocessor_listener</a> *<a class="code" href="../../d5/d03/asterisk_8c.html#adc01bca6281492dfec5ae217cf32fc34">listener</a>;</div><div class="line"><a name="l01407"></a><span class="lineno"> 1407</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../db/d17/structast__taskprocessor.html">ast_taskprocessor</a> *tps;</div><div class="line"><a name="l01408"></a><span class="lineno"> 1408</span>&#160;</div><div class="line"><a name="l01409"></a><span class="lineno"> 1409</span>&#160;   ser = <a class="code" href="../../d1/dc7/threadpool_8c.html#a82e66b52e831016bdfc643992d2d25f4">serializer_create</a>(pool, shutdown_group);</div><div class="line"><a name="l01410"></a><span class="lineno"> 1410</span>&#160;   <span class="keywordflow">if</span> (!ser) {</div><div class="line"><a name="l01411"></a><span class="lineno"> 1411</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l01412"></a><span class="lineno"> 1412</span>&#160;   }</div><div class="line"><a name="l01413"></a><span class="lineno"> 1413</span>&#160;</div><div class="line"><a name="l01414"></a><span class="lineno"> 1414</span>&#160;   listener = <a class="code" href="../../d0/d1e/taskprocessor_8h.html#ad7d5e40a1f7eac54dcad096b90d013bd">ast_taskprocessor_listener_alloc</a>(&amp;<a class="code" href="../../d1/dc7/threadpool_8c.html#a1ffa8804dc56390ba80054d2bac56e11">serializer_tps_listener_callbacks</a>, ser);</div><div class="line"><a name="l01415"></a><span class="lineno"> 1415</span>&#160;   <span class="keywordflow">if</span> (!listener) {</div><div class="line"><a name="l01416"></a><span class="lineno"> 1416</span>&#160;      <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(ser, -1);</div><div class="line"><a name="l01417"></a><span class="lineno"> 1417</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l01418"></a><span class="lineno"> 1418</span>&#160;   }</div><div class="line"><a name="l01419"></a><span class="lineno"> 1419</span>&#160;</div><div class="line"><a name="l01420"></a><span class="lineno"> 1420</span>&#160;   tps = <a class="code" href="../../d0/d1e/taskprocessor_8h.html#ab79575eb73e817bd3afe77c87308e8be">ast_taskprocessor_create_with_listener</a>(<a class="code" href="../../d0/d29/cdr__mysql_8c.html#a0980a105ccb863d8008eb6201a51da52">name</a>, listener);</div><div class="line"><a name="l01421"></a><span class="lineno"> 1421</span>&#160;   <span class="keywordflow">if</span> (!tps) {</div><div class="line"><a name="l01422"></a><span class="lineno"> 1422</span>&#160;      <span class="comment">/* ser ref transferred to listener but not cleaned without tps */</span></div><div class="line"><a name="l01423"></a><span class="lineno"> 1423</span>&#160;      <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(ser, -1);</div><div class="line"><a name="l01424"></a><span class="lineno"> 1424</span>&#160;   } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (shutdown_group) {</div><div class="line"><a name="l01425"></a><span class="lineno"> 1425</span>&#160;      <a class="code" href="../../d1/dc7/threadpool_8c.html#a94999064773c19db7466b855530eb1b4">serializer_shutdown_group_inc</a>(shutdown_group);</div><div class="line"><a name="l01426"></a><span class="lineno"> 1426</span>&#160;   }</div><div class="line"><a name="l01427"></a><span class="lineno"> 1427</span>&#160;</div><div class="line"><a name="l01428"></a><span class="lineno"> 1428</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(listener, -1);</div><div class="line"><a name="l01429"></a><span class="lineno"> 1429</span>&#160;   <span class="keywordflow">return</span> tps;</div><div class="line"><a name="l01430"></a><span class="lineno"> 1430</span>&#160;}</div><div class="ttc" id="structast__taskprocessor__listener_html"><div class="ttname"><a href="../../d7/d52/structast__taskprocessor__listener.html">ast_taskprocessor_listener</a></div><div class="ttdoc">A listener for taskprocessors. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/deb/taskprocessor_8c_source.html#l00110">taskprocessor.c:110</a></div></div>
<div class="ttc" id="resample_8c_html_a070d2ce7b6bb7e5c05602aa8c308d0c4"><div class="ttname"><a href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a></div><div class="ttdeci">#define NULL</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d7f/resample_8c_source.html#l00096">resample.c:96</a></div></div>
<div class="ttc" id="asterisk_8c_html_adc01bca6281492dfec5ae217cf32fc34"><div class="ttname"><a href="../../d5/d03/asterisk_8c.html#adc01bca6281492dfec5ae217cf32fc34">listener</a></div><div class="ttdeci">static void * listener(void *unused)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d03/asterisk_8c_source.html#l01476">asterisk.c:1476</a></div></div>
<div class="ttc" id="threadpool_8c_html_a1ffa8804dc56390ba80054d2bac56e11"><div class="ttname"><a href="../../d1/dc7/threadpool_8c.html#a1ffa8804dc56390ba80054d2bac56e11">serializer_tps_listener_callbacks</a></div><div class="ttdeci">static struct ast_taskprocessor_listener_callbacks serializer_tps_listener_callbacks</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/dc7/threadpool_8c_source.html#l01391">threadpool.c:1391</a></div></div>
<div class="ttc" id="astobj2_8h_html_aaca5e8eac39a22f9da1c36fc6c922270"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a></div><div class="ttdeci">#define ao2_ref(o, delta)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l00464">astobj2.h:464</a></div></div>
<div class="ttc" id="threadpool_8c_html_a94999064773c19db7466b855530eb1b4"><div class="ttname"><a href="../../d1/dc7/threadpool_8c.html#a94999064773c19db7466b855530eb1b4">serializer_shutdown_group_inc</a></div><div class="ttdeci">static void serializer_shutdown_group_inc(struct ast_serializer_shutdown_group *shutdown_group)</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/dc7/threadpool_8c_source.html#l01289">threadpool.c:1289</a></div></div>
<div class="ttc" id="cdr__mysql_8c_html_a0980a105ccb863d8008eb6201a51da52"><div class="ttname"><a href="../../d0/d29/cdr__mysql_8c.html#a0980a105ccb863d8008eb6201a51da52">name</a></div><div class="ttdeci">static const char name[]</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d29/cdr__mysql_8c_source.html#l00074">cdr_mysql.c:74</a></div></div>
<div class="ttc" id="structserializer_html"><div class="ttname"><a href="../../d9/d47/structserializer.html">serializer</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d1/dc7/threadpool_8c_source.html#l01315">threadpool.c:1315</a></div></div>
<div class="ttc" id="taskprocessor_8h_html_ad7d5e40a1f7eac54dcad096b90d013bd"><div class="ttname"><a href="../../d0/d1e/taskprocessor_8h.html#ad7d5e40a1f7eac54dcad096b90d013bd">ast_taskprocessor_listener_alloc</a></div><div class="ttdeci">struct ast_taskprocessor_listener * ast_taskprocessor_listener_alloc(const struct ast_taskprocessor_listener_callbacks *callbacks, void *user_data)</div><div class="ttdoc">Allocate a taskprocessor listener. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/deb/taskprocessor_8c_source.html#l00930">taskprocessor.c:930</a></div></div>
<div class="ttc" id="structast__taskprocessor_html"><div class="ttname"><a href="../../db/d17/structast__taskprocessor.html">ast_taskprocessor</a></div><div class="ttdoc">A ast_taskprocessor structure is a singleton by name. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/deb/taskprocessor_8c_source.html#l00069">taskprocessor.c:69</a></div></div>
<div class="ttc" id="taskprocessor_8h_html_ab79575eb73e817bd3afe77c87308e8be"><div class="ttname"><a href="../../d0/d1e/taskprocessor_8h.html#ab79575eb73e817bd3afe77c87308e8be">ast_taskprocessor_create_with_listener</a></div><div class="ttdeci">struct ast_taskprocessor * ast_taskprocessor_create_with_listener(const char *name, struct ast_taskprocessor_listener *listener)</div><div class="ttdoc">Create a taskprocessor with a custom listener. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/deb/taskprocessor_8c_source.html#l01083">taskprocessor.c:1083</a></div></div>
<div class="ttc" id="threadpool_8c_html_a82e66b52e831016bdfc643992d2d25f4"><div class="ttname"><a href="../../d1/dc7/threadpool_8c.html#a82e66b52e831016bdfc643992d2d25f4">serializer_create</a></div><div class="ttdeci">static struct serializer * serializer_create(struct ast_threadpool *pool, struct ast_serializer_shutdown_group *shutdown_group)</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/dc7/threadpool_8c_source.html#l01332">threadpool.c:1332</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="acd7a437bf7aa6a7335cf1e96655258d1"></a>
<h2 class="memtitle"><span class="permalink"><a href="#acd7a437bf7aa6a7335cf1e96655258d1">&#9670;&nbsp;</a></span>ast_threadpool_set_size()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ast_threadpool_set_size </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="../../d5/d10/structast__threadpool.html">ast_threadpool</a> *&#160;</td>
          <td class="paramname"><em>threadpool</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned int&#160;</td>
          <td class="paramname"><em>size</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Set the number of threads for the thread pool. </p>
<p>This number may be more or less than the current number of threads in the threadpool.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">threadpool</td><td>The threadpool to adjust </td></tr>
    <tr><td class="paramname">size</td><td>The new desired size of the threadpool </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="../../d1/dc7/threadpool_8c_source.html#l00874">874</a> of file <a class="el" href="../../d1/dc7/threadpool_8c_source.html">threadpool.c</a>.</p>

<p class="reference">References <a class="el" href="../../d8/d8a/astmm_8h_source.html#l00182">ast_free</a>, <a class="el" href="../../d4/deb/taskprocessor_8c_source.html#l01175">ast_taskprocessor_push()</a>, <a class="el" href="../../d1/dc7/threadpool_8c_source.html#l00096">ast_threadpool::control_tps</a>, <a class="el" href="../../df/d44/app__meetme_8c_source.html#l01091">lock</a>, <a class="el" href="../../d1/dc7/threadpool_8c_source.html#l00838">queued_set_size()</a>, <a class="el" href="../../dd/d42/lock_8h_source.html#l00602">SCOPED_AO2LOCK</a>, <a class="el" href="../../d1/dc7/threadpool_8c_source.html#l00814">set_size_data_alloc()</a>, and <a class="el" href="../../d1/dc7/threadpool_8c_source.html#l00098">ast_threadpool::shutting_down</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../de/dec/test__threadpool_8c_source.html#l00402">AST_TEST_DEFINE()</a>, and <a class="el" href="../../d1/dc7/threadpool_8c_source.html#l00915">ast_threadpool_create()</a>.</p>
<div class="fragment"><div class="line"><a name="l00875"></a><span class="lineno">  875</span>&#160;{</div><div class="line"><a name="l00876"></a><span class="lineno">  876</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../dc/d28/structset__size__data.html">set_size_data</a> *ssd;</div><div class="line"><a name="l00877"></a><span class="lineno">  877</span>&#160;   <a class="code" href="../../dd/d42/lock_8h.html#a2cfb325ed371eb6e629446bac4676e9f">SCOPED_AO2LOCK</a>(<a class="code" href="../../df/d44/app__meetme_8c.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>, <a class="code" href="../../d9/d21/res__rtp__asterisk_8c.html#a2e57658a5d3ef6c4ef2774c9d5868e7c">pool</a>);</div><div class="line"><a name="l00878"></a><span class="lineno">  878</span>&#160;</div><div class="line"><a name="l00879"></a><span class="lineno">  879</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d9/d21/res__rtp__asterisk_8c.html#a2e57658a5d3ef6c4ef2774c9d5868e7c">pool</a>-&gt;shutting_down) {</div><div class="line"><a name="l00880"></a><span class="lineno">  880</span>&#160;      <span class="keywordflow">return</span>;</div><div class="line"><a name="l00881"></a><span class="lineno">  881</span>&#160;   }</div><div class="line"><a name="l00882"></a><span class="lineno">  882</span>&#160;</div><div class="line"><a name="l00883"></a><span class="lineno">  883</span>&#160;   ssd = <a class="code" href="../../d1/dc7/threadpool_8c.html#a3db89f7bce86946752e8247d4a0d3e55">set_size_data_alloc</a>(<a class="code" href="../../d9/d21/res__rtp__asterisk_8c.html#a2e57658a5d3ef6c4ef2774c9d5868e7c">pool</a>, <a class="code" href="../../dc/d28/structset__size__data.html#aac913b3a1f6ef005d66bf7a84428773e">size</a>);</div><div class="line"><a name="l00884"></a><span class="lineno">  884</span>&#160;   <span class="keywordflow">if</span> (!ssd) {</div><div class="line"><a name="l00885"></a><span class="lineno">  885</span>&#160;      <span class="keywordflow">return</span>;</div><div class="line"><a name="l00886"></a><span class="lineno">  886</span>&#160;   }</div><div class="line"><a name="l00887"></a><span class="lineno">  887</span>&#160;</div><div class="line"><a name="l00888"></a><span class="lineno">  888</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d0/d1e/taskprocessor_8h.html#a6b2508ba0a6b8f43ae6d3963f3189585">ast_taskprocessor_push</a>(<a class="code" href="../../d9/d21/res__rtp__asterisk_8c.html#a2e57658a5d3ef6c4ef2774c9d5868e7c">pool</a>-&gt;control_tps, <a class="code" href="../../d1/dc7/threadpool_8c.html#a6dcc947c4d1eb51eaf8feb2efab14635">queued_set_size</a>, ssd)) {</div><div class="line"><a name="l00889"></a><span class="lineno">  889</span>&#160;      <a class="code" href="../../d8/d8a/astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(ssd);</div><div class="line"><a name="l00890"></a><span class="lineno">  890</span>&#160;   }</div><div class="line"><a name="l00891"></a><span class="lineno">  891</span>&#160;}</div><div class="ttc" id="threadpool_8c_html_a3db89f7bce86946752e8247d4a0d3e55"><div class="ttname"><a href="../../d1/dc7/threadpool_8c.html#a3db89f7bce86946752e8247d4a0d3e55">set_size_data_alloc</a></div><div class="ttdeci">static struct set_size_data * set_size_data_alloc(struct ast_threadpool *pool, unsigned int size)</div><div class="ttdoc">Allocate and initialize a set_size_data. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/dc7/threadpool_8c_source.html#l00814">threadpool.c:814</a></div></div>
<div class="ttc" id="res__rtp__asterisk_8c_html_a2e57658a5d3ef6c4ef2774c9d5868e7c"><div class="ttname"><a href="../../d9/d21/res__rtp__asterisk_8c.html#a2e57658a5d3ef6c4ef2774c9d5868e7c">pool</a></div><div class="ttdeci">static pj_pool_t * pool</div><div class="ttdoc">Global memory pool for configuration and timers. </div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d21/res__rtp__asterisk_8c_source.html#l00236">res_rtp_asterisk.c:236</a></div></div>
<div class="ttc" id="structset__size__data_html"><div class="ttname"><a href="../../dc/d28/structset__size__data.html">set_size_data</a></div><div class="ttdoc">Helper struct used for queued operations that change the size of the threadpool. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/dc7/threadpool_8c_source.html#l00802">threadpool.c:802</a></div></div>
<div class="ttc" id="app__meetme_8c_html_adf04f66344e3fb0a6f6a69bf39d19902"><div class="ttname"><a href="../../df/d44/app__meetme_8c.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a></div><div class="ttdeci">ast_mutex_t lock</div><div class="ttdef"><b>Definition:</b> <a href="../../df/d44/app__meetme_8c_source.html#l01091">app_meetme.c:1091</a></div></div>
<div class="ttc" id="lock_8h_html_a2cfb325ed371eb6e629446bac4676e9f"><div class="ttname"><a href="../../dd/d42/lock_8h.html#a2cfb325ed371eb6e629446bac4676e9f">SCOPED_AO2LOCK</a></div><div class="ttdeci">#define SCOPED_AO2LOCK(varname, obj)</div><div class="ttdoc">scoped lock specialization for ao2 mutexes. </div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d42/lock_8h_source.html#l00602">lock.h:602</a></div></div>
<div class="ttc" id="astmm_8h_html_a402072d6789f6ed9e3a81da27504127e"><div class="ttname"><a href="../../d8/d8a/astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a></div><div class="ttdeci">#define ast_free(a)</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d8a/astmm_8h_source.html#l00182">astmm.h:182</a></div></div>
<div class="ttc" id="taskprocessor_8h_html_a6b2508ba0a6b8f43ae6d3963f3189585"><div class="ttname"><a href="../../d0/d1e/taskprocessor_8h.html#a6b2508ba0a6b8f43ae6d3963f3189585">ast_taskprocessor_push</a></div><div class="ttdeci">int ast_taskprocessor_push(struct ast_taskprocessor *tps, int(*task_exe)(void *datap), void *datap) attribute_warn_unused_result</div><div class="ttdoc">Push a task into the specified taskprocessor queue and signal the taskprocessor thread. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/deb/taskprocessor_8c_source.html#l01175">taskprocessor.c:1175</a></div></div>
<div class="ttc" id="threadpool_8c_html_a6dcc947c4d1eb51eaf8feb2efab14635"><div class="ttname"><a href="../../d1/dc7/threadpool_8c.html#a6dcc947c4d1eb51eaf8feb2efab14635">queued_set_size</a></div><div class="ttdeci">static int queued_set_size(void *data)</div><div class="ttdoc">Change the size of the threadpool. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/dc7/threadpool_8c_source.html#l00838">threadpool.c:838</a></div></div>
<div class="ttc" id="structset__size__data_html_aac913b3a1f6ef005d66bf7a84428773e"><div class="ttname"><a href="../../dc/d28/structset__size__data.html#aac913b3a1f6ef005d66bf7a84428773e">set_size_data::size</a></div><div class="ttdeci">unsigned int size</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/dc7/threadpool_8c_source.html#l00806">threadpool.c:806</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a45bebfa26a1737c170f723ac86299bba"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a45bebfa26a1737c170f723ac86299bba">&#9670;&nbsp;</a></span>ast_threadpool_shutdown()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ast_threadpool_shutdown </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="../../d5/d10/structast__threadpool.html">ast_threadpool</a> *&#160;</td>
          <td class="paramname"><em>pool</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Shut down a threadpool and destroy it. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">pool</td><td>The pool to shut down </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="../../d1/dc7/threadpool_8c_source.html#l00965">965</a> of file <a class="el" href="../../d1/dc7/threadpool_8c_source.html">threadpool.c</a>.</p>

<p class="reference">References <a class="el" href="../../d5/da5/astobj2_8h_source.html#l00718">ao2_lock</a>, <a class="el" href="../../d5/da5/astobj2_8h_source.html#l00730">ao2_unlock</a>, <a class="el" href="../../d4/deb/taskprocessor_8c_source.html#l01109">ast_taskprocessor_unreference()</a>, <a class="el" href="../../d1/dc7/threadpool_8c_source.html#l00096">ast_threadpool::control_tps</a>, <a class="el" href="../../d1/dc7/threadpool_8c_source.html#l00098">ast_threadpool::shutting_down</a>, and <a class="el" href="../../d1/dc7/threadpool_8c_source.html#l00067">ast_threadpool::tps</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../df/df7/test__taskprocessor_8c_source.html#l00901">AST_TEST_DEFINE()</a>, <a class="el" href="../../de/d96/res__pjsip_8c_source.html#l05810">load_module()</a>, <a class="el" href="../../d7/d69/sorcery_8c_source.html#l00369">sorcery_cleanup()</a>, <a class="el" href="../../d0/df4/stasis_8c_source.html#l03042">stasis_cleanup()</a>, and <a class="el" href="../../de/d96/res__pjsip_8c_source.html#l05937">unload_module()</a>.</p>
<div class="fragment"><div class="line"><a name="l00966"></a><span class="lineno">  966</span>&#160;{</div><div class="line"><a name="l00967"></a><span class="lineno">  967</span>&#160;   <span class="keywordflow">if</span> (!pool) {</div><div class="line"><a name="l00968"></a><span class="lineno">  968</span>&#160;      <span class="keywordflow">return</span>;</div><div class="line"><a name="l00969"></a><span class="lineno">  969</span>&#160;   }</div><div class="line"><a name="l00970"></a><span class="lineno">  970</span>&#160;   <span class="comment">/* Shut down the taskprocessors and everything else just</span></div><div class="line"><a name="l00971"></a><span class="lineno">  971</span>&#160;<span class="comment">    * takes care of itself via the taskprocessor callbacks</span></div><div class="line"><a name="l00972"></a><span class="lineno">  972</span>&#160;<span class="comment">    */</span></div><div class="line"><a name="l00973"></a><span class="lineno">  973</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#aa9fdb5d0a6157a56060d9f7279fe6c49">ao2_lock</a>(pool);</div><div class="line"><a name="l00974"></a><span class="lineno">  974</span>&#160;   pool-&gt;<a class="code" href="../../d5/d10/structast__threadpool.html#a7f68568851b9c7f9291f7bb63f932c18">shutting_down</a> = 1;</div><div class="line"><a name="l00975"></a><span class="lineno">  975</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#a9998bd156b936636a8780385e9a910b2">ao2_unlock</a>(pool);</div><div class="line"><a name="l00976"></a><span class="lineno">  976</span>&#160;   <a class="code" href="../../d0/d1e/taskprocessor_8h.html#a32492eb2480cb8c46ad669622cff8556">ast_taskprocessor_unreference</a>(pool-&gt;<a class="code" href="../../d5/d10/structast__threadpool.html#a566be46267682ab4ec66a8c25b673f8c">control_tps</a>);</div><div class="line"><a name="l00977"></a><span class="lineno">  977</span>&#160;   <a class="code" href="../../d0/d1e/taskprocessor_8h.html#a32492eb2480cb8c46ad669622cff8556">ast_taskprocessor_unreference</a>(pool-&gt;<a class="code" href="../../d5/d10/structast__threadpool.html#a4c381cb1b5cf198fa3f260212e716c9a">tps</a>);</div><div class="line"><a name="l00978"></a><span class="lineno">  978</span>&#160;}</div><div class="ttc" id="structast__threadpool_html_a7f68568851b9c7f9291f7bb63f932c18"><div class="ttname"><a href="../../d5/d10/structast__threadpool.html#a7f68568851b9c7f9291f7bb63f932c18">ast_threadpool::shutting_down</a></div><div class="ttdeci">int shutting_down</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/dc7/threadpool_8c_source.html#l00098">threadpool.c:98</a></div></div>
<div class="ttc" id="astobj2_8h_html_a9998bd156b936636a8780385e9a910b2"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#a9998bd156b936636a8780385e9a910b2">ao2_unlock</a></div><div class="ttdeci">#define ao2_unlock(a)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l00730">astobj2.h:730</a></div></div>
<div class="ttc" id="astobj2_8h_html_aa9fdb5d0a6157a56060d9f7279fe6c49"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#aa9fdb5d0a6157a56060d9f7279fe6c49">ao2_lock</a></div><div class="ttdeci">#define ao2_lock(a)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l00718">astobj2.h:718</a></div></div>
<div class="ttc" id="structast__threadpool_html_a4c381cb1b5cf198fa3f260212e716c9a"><div class="ttname"><a href="../../d5/d10/structast__threadpool.html#a4c381cb1b5cf198fa3f260212e716c9a">ast_threadpool::tps</a></div><div class="ttdeci">struct ast_taskprocessor * tps</div><div class="ttdoc">The main taskprocessor. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/dc7/threadpool_8c_source.html#l00067">threadpool.c:67</a></div></div>
<div class="ttc" id="taskprocessor_8h_html_a32492eb2480cb8c46ad669622cff8556"><div class="ttname"><a href="../../d0/d1e/taskprocessor_8h.html#a32492eb2480cb8c46ad669622cff8556">ast_taskprocessor_unreference</a></div><div class="ttdeci">void * ast_taskprocessor_unreference(struct ast_taskprocessor *tps)</div><div class="ttdoc">Unreference the specified taskprocessor and its reference count will decrement. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/deb/taskprocessor_8c_source.html#l01109">taskprocessor.c:1109</a></div></div>
<div class="ttc" id="structast__threadpool_html_a566be46267682ab4ec66a8c25b673f8c"><div class="ttname"><a href="../../d5/d10/structast__threadpool.html#a566be46267682ab4ec66a8c25b673f8c">ast_threadpool::control_tps</a></div><div class="ttdeci">struct ast_taskprocessor * control_tps</div><div class="ttdoc">The control taskprocessor. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/dc7/threadpool_8c_source.html#l00096">threadpool.c:96</a></div></div>
</div><!-- fragment -->
</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Sun Aug 8 2021 19:47:00 for Asterisk - The Open Source Telephony Project by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="../../doxygen.png" alt="doxygen"/>
</a> 1.8.13
</small></address>
</body>
</html>
