<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Asterisk - The Open Source Telephony Project: res_pjsip_registrar.c Source File</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Asterisk - The Open Source Telephony Project
   &#160;<span id="projectnumber">18.5.0</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "../../search",false,'Search');
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('../../',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="../../dir_7b47cca4d318623bb4270ab1fb592ef5.html">res</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">res_pjsip_registrar.c</div>  </div>
</div><!--header-->
<div class="contents">
<a href="../../d3/db0/res__pjsip__registrar_8c.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="comment">/*</span></div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="comment"> * Asterisk -- An open source telephony toolkit.</span></div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="comment"> * Copyright (C) 2013, Digium, Inc.</span></div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="comment"> * Joshua Colp &lt;jcolp@digium.com&gt;</span></div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="comment"> * See http://www.asterisk.org for more information about</span></div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="comment"> * the Asterisk project. Please do not directly contact</span></div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;<span class="comment"> * any of the maintainers of this project for assistance;</span></div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;<span class="comment"> * the project provides a web site, mailing lists and IRC</span></div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;<span class="comment"> * channels for your use.</span></div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;<span class="comment"> * This program is free software, distributed under the terms of</span></div><div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;<span class="comment"> * the GNU General Public License Version 2. See the LICENSE file</span></div><div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;<span class="comment"> * at the top of the source tree.</span></div><div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;</div><div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;<span class="comment">/*** MODULEINFO</span></div><div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;<span class="comment">   &lt;depend&gt;pjproject&lt;/depend&gt;</span></div><div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;<span class="comment">   &lt;depend&gt;res_pjproject&lt;/depend&gt;</span></div><div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;<span class="comment">   &lt;depend&gt;res_pjsip&lt;/depend&gt;</span></div><div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;<span class="comment">   &lt;support_level&gt;core&lt;/support_level&gt;</span></div><div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;<span class="comment"> ***/</span></div><div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;</div><div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../db/db2/asterisk_8h.html">asterisk.h</a>&quot;</span></div><div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;</div><div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;<span class="preprocessor">#include &lt;signal.h&gt;</span></div><div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;<span class="preprocessor">#include &lt;pjsip.h&gt;</span></div><div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;<span class="preprocessor">#include &lt;pjsip_ua.h&gt;</span></div><div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;</div><div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../d8/d8c/res__pjsip_8h.html">asterisk/res_pjsip.h</a>&quot;</span></div><div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../d5/d16/module_8h.html">asterisk/module.h</a>&quot;</span></div><div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../dd/df2/paths_8h.html">asterisk/paths.h</a>&quot;</span></div><div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../d2/ddc/test_8h.html">asterisk/test.h</a>&quot;</span></div><div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../d0/d1e/taskprocessor_8h.html">asterisk/taskprocessor.h</a>&quot;</span></div><div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../db/d45/manager_8h.html">asterisk/manager.h</a>&quot;</span></div><div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../d1/d32/named__locks_8h.html">asterisk/named_locks.h</a>&quot;</span></div><div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../df/dd5/res__pjproject_8h.html">asterisk/res_pjproject.h</a>&quot;</span></div><div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../d7/d5c/res__pjsip__private_8h.html">res_pjsip/include/res_pjsip_private.h</a>&quot;</span></div><div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;</div><div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;<span class="comment">/*** DOCUMENTATION</span></div><div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;<span class="comment">   &lt;manager name=&quot;PJSIPShowRegistrationsInbound&quot; language=&quot;en_US&quot;&gt;</span></div><div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;<span class="comment">      &lt;synopsis&gt;</span></div><div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;<span class="comment">         Lists PJSIP inbound registrations.</span></div><div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;<span class="comment">      &lt;/synopsis&gt;</span></div><div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;<span class="comment">      &lt;syntax /&gt;</span></div><div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;<span class="comment">      &lt;description&gt;</span></div><div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;<span class="comment">         &lt;para&gt;</span></div><div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;<span class="comment">         In response, &lt;literal&gt;InboundRegistrationDetail&lt;/literal&gt; events showing configuration</span></div><div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;<span class="comment">         and status information are raised for all contacts, static or dynamic.  Once all events</span></div><div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;<span class="comment">         are completed an &lt;literal&gt;InboundRegistrationDetailComplete&lt;/literal&gt; is issued.</span></div><div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;<span class="comment">         &lt;/para&gt;</span></div><div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;<span class="comment">         &lt;warning&gt;&lt;para&gt;</span></div><div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;<span class="comment">            This command just dumps all coonfigured AORs with contacts, even if the contact</span></div><div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;<span class="comment">            is a permanent one.  To really get just inbound registrations, use</span></div><div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;<span class="comment">            &lt;literal&gt;PJSIPShowRegistrationInboundContactStatuses&lt;/literal&gt;.</span></div><div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;<span class="comment">         &lt;/para&gt;</span></div><div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;<span class="comment">         &lt;/warning&gt;</span></div><div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;<span class="comment">      &lt;/description&gt;</span></div><div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;<span class="comment">      &lt;see-also&gt;</span></div><div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;<span class="comment">         &lt;ref type=&quot;manager&quot; module=&quot;res_pjsip_registrar&quot;&gt;PJSIPShowRegistrationInboundContactStatuses&lt;/ref&gt;</span></div><div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;<span class="comment">      &lt;/see-also&gt;</span></div><div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;<span class="comment">   &lt;/manager&gt;</span></div><div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;<span class="comment">   &lt;manager name=&quot;PJSIPShowRegistrationInboundContactStatuses&quot; language=&quot;en_US&quot;&gt;</span></div><div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;<span class="comment">      &lt;synopsis&gt;</span></div><div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;<span class="comment">         Lists ContactStatuses for PJSIP inbound registrations.</span></div><div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;<span class="comment">      &lt;/synopsis&gt;</span></div><div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;<span class="comment">      &lt;syntax /&gt;</span></div><div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;<span class="comment">      &lt;description&gt;</span></div><div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;<span class="comment">         &lt;para&gt;</span></div><div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;<span class="comment">         In response, &lt;literal&gt;ContactStatusDetail&lt;/literal&gt; events showing status information</span></div><div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;<span class="comment">         are raised for each inbound registration (dynamic contact) object.  Once all events</span></div><div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;<span class="comment">         are completed a &lt;literal&gt;ContactStatusDetailComplete&lt;/literal&gt; event is issued.</span></div><div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;<span class="comment">         &lt;/para&gt;</span></div><div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;<span class="comment">      &lt;/description&gt;</span></div><div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;<span class="comment">   &lt;/manager&gt;</span></div><div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;<span class="comment"> ***/</span></div><div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;</div><div class="line"><a name="l00080"></a><span class="lineno"><a class="line" href="../../d3/db0/res__pjsip__registrar_8c.html#aab22b4013d9535ae373964bf042881aa">   80</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d3/db0/res__pjsip__registrar_8c.html#aab22b4013d9535ae373964bf042881aa">pj_max_hostname</a> = PJ_MAX_HOSTNAME;</div><div class="line"><a name="l00081"></a><span class="lineno"><a class="line" href="../../d3/db0/res__pjsip__registrar_8c.html#a5712e22b675f8412b1a2e49acee9d5ff">   81</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d3/db0/res__pjsip__registrar_8c.html#a5712e22b675f8412b1a2e49acee9d5ff">pjsip_max_url_size</a> = PJSIP_MAX_URL_SIZE;</div><div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;<span class="comment">/*! \brief Internal function which returns the expiration time for a contact */</span></div><div class="line"><a name="l00084"></a><span class="lineno"><a class="line" href="../../d3/db0/res__pjsip__registrar_8c.html#a89a4d689c6439721eeb087591f4a97a3">   84</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="../../d3/db0/res__pjsip__registrar_8c.html#a89a4d689c6439721eeb087591f4a97a3">registrar_get_expiration</a>(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="../../d4/d03/structast__sip__aor.html">ast_sip_aor</a> *aor, <span class="keyword">const</span> pjsip_contact_hdr *<a class="code" href="../../d9/d03/structcontact.html">contact</a>, <span class="keyword">const</span> pjsip_rx_data *rdata)</div><div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;{</div><div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;   pjsip_expires_hdr *expires;</div><div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;   <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> expiration = aor-&gt;<a class="code" href="../../d4/d03/structast__sip__aor.html#a9d65f9738bd93befcc4478004c448722">default_expiration</a>;</div><div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;</div><div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;   <span class="keywordflow">if</span> (contact &amp;&amp; contact-&gt;expires != <a class="code" href="../../d8/d8c/res__pjsip_8h.html#acd4517938f2afe11a1c6f372e28090a5">PJSIP_EXPIRES_NOT_SPECIFIED</a>) {</div><div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;      <span class="comment">/* Expiration was provided with the contact itself */</span></div><div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;      expiration = contact-&gt;expires;</div><div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;   } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((expires = pjsip_msg_find_hdr(rdata-&gt;msg_info.msg, PJSIP_H_EXPIRES, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>))) {</div><div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;      <span class="comment">/* Expiration was provided using the Expires header */</span></div><div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;      expiration = expires-&gt;ivalue;</div><div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;   }</div><div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;</div><div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;   <span class="comment">/* If the value has explicitly been set to 0, do not enforce */</span></div><div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;   <span class="keywordflow">if</span> (!expiration) {</div><div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;      <span class="keywordflow">return</span> expiration;</div><div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;   }</div><div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;</div><div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;   <span class="comment">/* Enforce the range that we will allow for expiration */</span></div><div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;   <span class="keywordflow">if</span> (expiration &lt; aor-&gt;minimum_expiration) {</div><div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;      expiration = aor-&gt;<a class="code" href="../../d4/d03/structast__sip__aor.html#a1286019b2fe7ef6bb13d518294d7cec4">minimum_expiration</a>;</div><div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;   } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (expiration &gt; aor-&gt;<a class="code" href="../../d4/d03/structast__sip__aor.html#a8bc5997cae805a78e43cb40441c06ece">maximum_expiration</a>) {</div><div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;      expiration = aor-&gt;<a class="code" href="../../d4/d03/structast__sip__aor.html#a8bc5997cae805a78e43cb40441c06ece">maximum_expiration</a>;</div><div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;   }</div><div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;</div><div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;   <span class="keywordflow">return</span> expiration;</div><div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;}</div><div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;<span class="comment">/*! \brief Structure used for finding contact */</span></div><div class="line"><a name="l00113"></a><span class="lineno"><a class="line" href="../../d6/dcf/structregistrar__contact__details.html">  113</a></span>&#160;<span class="keyword">struct </span><a class="code" href="../../d6/dcf/structregistrar__contact__details.html">registrar_contact_details</a> {<span class="comment"></span></div><div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;<span class="comment">   /*! \brief Pool used for parsing URI */</span></div><div class="line"><a name="l00115"></a><span class="lineno"><a class="line" href="../../d6/dcf/structregistrar__contact__details.html#a2e57658a5d3ef6c4ef2774c9d5868e7c">  115</a></span>&#160;   pj_pool_t *<a class="code" href="../../d6/dcf/structregistrar__contact__details.html#a2e57658a5d3ef6c4ef2774c9d5868e7c">pool</a>;<span class="comment"></span></div><div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;<span class="comment">   /*! \brief URI being looked for */</span></div><div class="line"><a name="l00117"></a><span class="lineno"><a class="line" href="../../d6/dcf/structregistrar__contact__details.html#ac43e5728c2093e52e8a06774ab68afe2">  117</a></span>&#160;   pjsip_sip_uri *<a class="code" href="../../d6/dcf/structregistrar__contact__details.html#ac43e5728c2093e52e8a06774ab68afe2">uri</a>;</div><div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;};</div><div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;<span class="comment">/*! \brief Callback function for finding a contact */</span></div><div class="line"><a name="l00121"></a><span class="lineno"><a class="line" href="../../d3/db0/res__pjsip__registrar_8c.html#a600472167faf6e00d346580877861570">  121</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d3/db0/res__pjsip__registrar_8c.html#a600472167faf6e00d346580877861570">registrar_find_contact</a>(<span class="keywordtype">void</span> *obj, <span class="keywordtype">void</span> *arg, <span class="keywordtype">int</span> flags)</div><div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;{</div><div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d8/d8a/structast__sip__contact.html">ast_sip_contact</a> *<a class="code" href="../../d9/d03/structcontact.html">contact</a> = obj;</div><div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;   <span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="../../d6/dcf/structregistrar__contact__details.html">registrar_contact_details</a> *details = arg;</div><div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;   pjsip_uri *contact_uri;</div><div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;</div><div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../de/df7/time_8h.html#a4e7b3508884147c7991a68361ac781a2">ast_tvzero</a>(contact-&gt;<a class="code" href="../../d8/d8a/structast__sip__contact.html#a98ed99328ad621551cdfbee6b83754ae">expiration_time</a>)) {</div><div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;      <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;   }</div><div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;</div><div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;   contact_uri = pjsip_parse_uri(details-&gt;<a class="code" href="../../d6/dcf/structregistrar__contact__details.html#a2e57658a5d3ef6c4ef2774c9d5868e7c">pool</a>, (<span class="keywordtype">char</span>*)contact-&gt;<a class="code" href="../../d8/d8a/structast__sip__contact.html#a19ac71226fac09e87afe31acb4c99214">uri</a>, strlen(contact-&gt;<a class="code" href="../../d8/d8a/structast__sip__contact.html#a19ac71226fac09e87afe31acb4c99214">uri</a>), 0);</div><div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;   <span class="keywordflow">if</span> (!contact_uri) {</div><div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Unable to parse contact URI from &#39;%s&#39;.\n&quot;</span>, contact-&gt;<a class="code" href="../../d8/d8a/structast__sip__contact.html#a19ac71226fac09e87afe31acb4c99214">uri</a>);</div><div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;      <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;   }</div><div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;</div><div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;   <span class="keywordflow">return</span> (pjsip_uri_cmp(PJSIP_URI_IN_CONTACT_HDR, details-&gt;<a class="code" href="../../d6/dcf/structregistrar__contact__details.html#ac43e5728c2093e52e8a06774ab68afe2">uri</a>, contact_uri) == PJ_SUCCESS) ? <a class="code" href="../../d5/da5/astobj2_8h.html#a1f8b41308be4c47de8ff89a3b9c7e7d1a1959468a3c5d6aecd2fa1272d8e30fbf">CMP_MATCH</a> : 0;</div><div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;}</div><div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;<span class="comment">/*! \brief Internal function which validates provided Contact headers to confirm that they are acceptable, and returns number of contacts */</span></div><div class="line"><a name="l00141"></a><span class="lineno"><a class="line" href="../../d3/db0/res__pjsip__registrar_8c.html#ab620225c7d2d4b8fc85df23dc0912369">  141</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d3/db0/res__pjsip__registrar_8c.html#ab620225c7d2d4b8fc85df23dc0912369">registrar_validate_contacts</a>(<span class="keyword">const</span> pjsip_rx_data *rdata, pj_pool_t *<a class="code" href="../../d6/dcf/structregistrar__contact__details.html#a2e57658a5d3ef6c4ef2774c9d5868e7c">pool</a>, <span class="keyword">struct</span> <a class="code" href="../../d2/da9/structao2__container.html">ao2_container</a> *contacts,</div><div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;   <span class="keyword">struct</span> <a class="code" href="../../d4/d03/structast__sip__aor.html">ast_sip_aor</a> *aor, <span class="keywordtype">int</span> permanent, <span class="keywordtype">int</span> *added, <span class="keywordtype">int</span> *updated, <span class="keywordtype">int</span> *deleted)</div><div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;{</div><div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;   pjsip_contact_hdr *previous = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;   pjsip_contact_hdr *<a class="code" href="../../d9/d03/structcontact.html">contact</a> = (pjsip_contact_hdr *)&amp;rdata-&gt;msg_info.msg-&gt;hdr;</div><div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;   <span class="keyword">struct</span> <a class="code" href="../../d6/dcf/structregistrar__contact__details.html">registrar_contact_details</a> details = {</div><div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;      .<a class="code" href="../../d6/dcf/structregistrar__contact__details.html#a2e57658a5d3ef6c4ef2774c9d5868e7c">pool</a> = pool,</div><div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;   };</div><div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;</div><div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;   <span class="keywordflow">for</span> (; (<a class="code" href="../../d9/d03/structcontact.html">contact</a> = (pjsip_contact_hdr *) pjsip_msg_find_hdr(rdata-&gt;msg_info.msg, PJSIP_H_CONTACT, <a class="code" href="../../d9/d03/structcontact.html">contact</a>-&gt;next)); pj_pool_reset(<a class="code" href="../../d6/dcf/structregistrar__contact__details.html#a2e57658a5d3ef6c4ef2774c9d5868e7c">pool</a>)) {</div><div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;      <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> expiration = <a class="code" href="../../d3/db0/res__pjsip__registrar_8c.html#a89a4d689c6439721eeb087591f4a97a3">registrar_get_expiration</a>(aor, <a class="code" href="../../d9/d03/structcontact.html">contact</a>, rdata);</div><div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;      <span class="keyword">struct </span><a class="code" href="../../d8/d8a/structast__sip__contact.html">ast_sip_contact</a> *existing;</div><div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;      <span class="keywordtype">char</span> contact_uri[<a class="code" href="../../d3/db0/res__pjsip__registrar_8c.html#a5712e22b675f8412b1a2e49acee9d5ff">pjsip_max_url_size</a>];</div><div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;</div><div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="../../d9/d03/structcontact.html">contact</a>-&gt;star) {</div><div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;         <span class="comment">/* The expiration MUST be 0 when a &#39;*&#39; contact is used and there must be no other contact */</span></div><div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;         <span class="keywordflow">if</span> (expiration != 0 || previous) {</div><div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;            <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;         }</div><div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;         <span class="comment">/* Count all contacts to delete */</span></div><div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;         *deleted = <a class="code" href="../../d5/da5/astobj2_8h.html#a512cc40ce96c63b3d5c78040baa4c9cd">ao2_container_count</a>(contacts) - permanent;</div><div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;         previous = <a class="code" href="../../d9/d03/structcontact.html">contact</a>;</div><div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;         <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;      } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (previous &amp;&amp; previous-&gt;star) {</div><div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;         <span class="comment">/* If there is a previous contact and it is a &#39;*&#39; this is a deal breaker */</span></div><div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;         <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;      }</div><div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;      previous = <a class="code" href="../../d9/d03/structcontact.html">contact</a>;</div><div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;</div><div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;      <span class="keywordflow">if</span> (!PJSIP_URI_SCHEME_IS_SIP(<a class="code" href="../../d9/d03/structcontact.html">contact</a>-&gt;uri) &amp;&amp; !PJSIP_URI_SCHEME_IS_SIPS(<a class="code" href="../../d9/d03/structcontact.html">contact</a>-&gt;uri)) {</div><div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;         <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;      }</div><div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;</div><div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;      details.uri = pjsip_uri_get_uri(<a class="code" href="../../d9/d03/structcontact.html">contact</a>-&gt;uri);</div><div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;</div><div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;      <span class="comment">/* pjsip_uri_print returns -1 if there&#39;s not enough room in the buffer */</span></div><div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;      <span class="keywordflow">if</span> (pjsip_uri_print(PJSIP_URI_IN_CONTACT_HDR, details.uri, contact_uri, <span class="keyword">sizeof</span>(contact_uri)) &lt; 0) {</div><div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;         <span class="comment">/* If the total length of the uri is greater than pjproject can handle, go no further */</span></div><div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;         <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;      }</div><div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;</div><div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;      <span class="keywordflow">if</span> (details.uri-&gt;host.slen &gt;= <a class="code" href="../../d3/db0/res__pjsip__registrar_8c.html#aab22b4013d9535ae373964bf042881aa">pj_max_hostname</a>) {</div><div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;         <span class="comment">/* If the length of the hostname is greater than pjproject can handle, go no further */</span></div><div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;         <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;      }</div><div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;</div><div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;      <span class="comment">/* Determine if this is an add, update, or delete for policy enforcement purposes */</span></div><div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;      existing = <a class="code" href="../../d5/da5/astobj2_8h.html#a47857055118a703ae87ea5ebaf4842ed">ao2_callback</a>(contacts, 0, <a class="code" href="../../d3/db0/res__pjsip__registrar_8c.html#a600472167faf6e00d346580877861570">registrar_find_contact</a>, &amp;details);</div><div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;      <a class="code" href="../../d5/da5/astobj2_8h.html#a6321ee982370c55ab3c24c72c562cbdd">ao2_cleanup</a>(existing);</div><div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;      <span class="keywordflow">if</span> (!existing) {</div><div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;         <span class="keywordflow">if</span> (expiration) {</div><div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;            ++*added;</div><div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;         }</div><div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;      } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (expiration) {</div><div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;         ++*updated;</div><div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;      } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;         ++*deleted;</div><div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;      }</div><div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;   }</div><div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;</div><div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;   <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;}</div><div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;</div><div class="line"><a name="l00204"></a><span class="lineno"><a class="line" href="../../d3/db0/res__pjsip__registrar_8c.html#aa0b6ec2978c63b269ea90927f085c0d8">  204</a></span>&#160;<span class="keyword">enum</span> <a class="code" href="../../d3/db0/res__pjsip__registrar_8c.html#aa0b6ec2978c63b269ea90927f085c0d8">contact_delete_type</a> {</div><div class="line"><a name="l00205"></a><span class="lineno"><a class="line" href="../../d3/db0/res__pjsip__registrar_8c.html#aa0b6ec2978c63b269ea90927f085c0d8a50feb257eddbe7969373b856facc714d">  205</a></span>&#160;   <a class="code" href="../../d3/db0/res__pjsip__registrar_8c.html#aa0b6ec2978c63b269ea90927f085c0d8a50feb257eddbe7969373b856facc714d">CONTACT_DELETE_ERROR</a>,</div><div class="line"><a name="l00206"></a><span class="lineno"><a class="line" href="../../d3/db0/res__pjsip__registrar_8c.html#aa0b6ec2978c63b269ea90927f085c0d8a50f2fbc6b9c2a86ec4e05bd350e9f253">  206</a></span>&#160;   <a class="code" href="../../d3/db0/res__pjsip__registrar_8c.html#aa0b6ec2978c63b269ea90927f085c0d8a50f2fbc6b9c2a86ec4e05bd350e9f253">CONTACT_DELETE_EXISTING</a>,</div><div class="line"><a name="l00207"></a><span class="lineno"><a class="line" href="../../d3/db0/res__pjsip__registrar_8c.html#aa0b6ec2978c63b269ea90927f085c0d8ad88825ec6d3fcb67a681bd0c66e789eb">  207</a></span>&#160;   <a class="code" href="../../d3/db0/res__pjsip__registrar_8c.html#aa0b6ec2978c63b269ea90927f085c0d8ad88825ec6d3fcb67a681bd0c66e789eb">CONTACT_DELETE_EXPIRE</a>,</div><div class="line"><a name="l00208"></a><span class="lineno"><a class="line" href="../../d3/db0/res__pjsip__registrar_8c.html#aa0b6ec2978c63b269ea90927f085c0d8ab4f9fcf2f1d563fcb73a11daad67911a">  208</a></span>&#160;   <a class="code" href="../../d3/db0/res__pjsip__registrar_8c.html#aa0b6ec2978c63b269ea90927f085c0d8ab4f9fcf2f1d563fcb73a11daad67911a">CONTACT_DELETE_REQUEST</a>,</div><div class="line"><a name="l00209"></a><span class="lineno"><a class="line" href="../../d3/db0/res__pjsip__registrar_8c.html#aa0b6ec2978c63b269ea90927f085c0d8aa8f232bbece67893e0065f35b519a01b">  209</a></span>&#160;   <a class="code" href="../../d3/db0/res__pjsip__registrar_8c.html#aa0b6ec2978c63b269ea90927f085c0d8aa8f232bbece67893e0065f35b519a01b">CONTACT_DELETE_SHUTDOWN</a>,</div><div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;};</div><div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;</div><div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d3/db0/res__pjsip__registrar_8c.html#a10954918b2b79e996b17b94e5b6c6b62">registrar_contact_delete</a>(<span class="keyword">enum</span> <a class="code" href="../../d3/db0/res__pjsip__registrar_8c.html#aa0b6ec2978c63b269ea90927f085c0d8">contact_delete_type</a> <a class="code" href="../../d7/d49/chan__ooh323_8c.html#a4d63fdfe5451ec2248c16a2739190c56">type</a>, pjsip_transport *transport,</div><div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;   <span class="keyword">struct</span> <a class="code" href="../../d8/d8a/structast__sip__contact.html">ast_sip_contact</a> *<a class="code" href="../../d9/d03/structcontact.html">contact</a>, <span class="keyword">const</span> <span class="keywordtype">char</span> *aor_name);</div><div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;<span class="comment">/*! \brief Internal function used to delete a contact from an AOR */</span></div><div class="line"><a name="l00216"></a><span class="lineno"><a class="line" href="../../d3/db0/res__pjsip__registrar_8c.html#af0d1d79e501090634be170620bae20cf">  216</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d3/db0/res__pjsip__registrar_8c.html#af0d1d79e501090634be170620bae20cf">registrar_delete_contact</a>(<span class="keywordtype">void</span> *obj, <span class="keywordtype">void</span> *arg, <span class="keywordtype">int</span> flags)</div><div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;{</div><div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;   <span class="keywordflow">return</span> <a class="code" href="../../d3/db0/res__pjsip__registrar_8c.html#a10954918b2b79e996b17b94e5b6c6b62">registrar_contact_delete</a>(</div><div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;      <a class="code" href="../../d3/db0/res__pjsip__registrar_8c.html#aa0b6ec2978c63b269ea90927f085c0d8ab4f9fcf2f1d563fcb73a11daad67911a">CONTACT_DELETE_REQUEST</a>, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, obj, arg) ? 0 : <a class="code" href="../../d5/da5/astobj2_8h.html#a1f8b41308be4c47de8ff89a3b9c7e7d1a1959468a3c5d6aecd2fa1272d8e30fbf">CMP_MATCH</a>;</div><div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;}</div><div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;<span class="comment">/*! \brief Internal function which adds a contact to a response */</span></div><div class="line"><a name="l00223"></a><span class="lineno"><a class="line" href="../../d3/db0/res__pjsip__registrar_8c.html#a80bf48159f4cdd1d7005f1db04b2b080">  223</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d3/db0/res__pjsip__registrar_8c.html#a80bf48159f4cdd1d7005f1db04b2b080">registrar_add_contact</a>(<span class="keywordtype">void</span> *obj, <span class="keywordtype">void</span> *arg, <span class="keywordtype">int</span> flags)</div><div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;{</div><div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d8/d8a/structast__sip__contact.html">ast_sip_contact</a> *<a class="code" href="../../d9/d03/structcontact.html">contact</a> = obj;</div><div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;   pjsip_tx_data *tdata = arg;</div><div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;   pj_str_t <a class="code" href="../../d6/dcf/structregistrar__contact__details.html#ac43e5728c2093e52e8a06774ab68afe2">uri</a>;</div><div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;   pjsip_uri *parsed;</div><div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;</div><div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;   pj_strdup2_with_null(tdata-&gt;pool, &amp;uri, contact-&gt;<a class="code" href="../../d8/d8a/structast__sip__contact.html#a19ac71226fac09e87afe31acb4c99214">uri</a>);</div><div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;   parsed = pjsip_parse_uri(tdata-&gt;pool, uri.ptr, uri.slen, PJSIP_PARSE_URI_AS_NAMEADDR);</div><div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;</div><div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;   <span class="keywordflow">if</span> (parsed &amp;&amp; (PJSIP_URI_SCHEME_IS_SIP(parsed) || PJSIP_URI_SCHEME_IS_SIPS(parsed))) {</div><div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;      pjsip_contact_hdr *hdr = pjsip_contact_hdr_create(tdata-&gt;pool);</div><div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;      hdr-&gt;uri = parsed;</div><div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;      <span class="keywordflow">if</span> (!<a class="code" href="../../de/df7/time_8h.html#a4e7b3508884147c7991a68361ac781a2">ast_tvzero</a>(contact-&gt;<a class="code" href="../../d8/d8a/structast__sip__contact.html#a98ed99328ad621551cdfbee6b83754ae">expiration_time</a>)) {</div><div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;         hdr-&gt;expires = <a class="code" href="../../de/df7/time_8h.html#aca4ecdab7d8d3519062aad9a90fcb29d">ast_tvdiff_ms</a>(contact-&gt;<a class="code" href="../../d8/d8a/structast__sip__contact.html#a98ed99328ad621551cdfbee6b83754ae">expiration_time</a>, <a class="code" href="../../de/df7/time_8h.html#ad3899efb6f0e348556ef69f5b16aa7f7">ast_tvnow</a>()) / 1000;</div><div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;      } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;         hdr-&gt;expires = <a class="code" href="../../d8/d8c/res__pjsip_8h.html#acd4517938f2afe11a1c6f372e28090a5">PJSIP_EXPIRES_NOT_SPECIFIED</a>;</div><div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;      }</div><div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;      pjsip_msg_add_hdr(tdata-&gt;msg, (pjsip_hdr *) hdr);</div><div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;   } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Skipping invalid Contact URI \&quot;%.*s\&quot; for AOR %s\n&quot;</span>,</div><div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;         (<span class="keywordtype">int</span>) uri.slen, uri.ptr, contact-&gt;<a class="code" href="../../d8/d8a/structast__sip__contact.html#a7d6a7c1f176fb54d59dd27ea307f44e6">aor</a>);</div><div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;   }</div><div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;</div><div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;   <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;}</div><div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;</div><div class="line"><a name="l00250"></a><span class="lineno"><a class="line" href="../../d3/db0/res__pjsip__registrar_8c.html#ae1d1db7e95619ea0a412f1793402689e">  250</a></span>&#160;<span class="keyword">static</span> <span class="keyword">const</span> pj_str_t <a class="code" href="../../d3/db0/res__pjsip__registrar_8c.html#ae1d1db7e95619ea0a412f1793402689e">path_hdr_name</a> = { <span class="stringliteral">&quot;Path&quot;</span>, 4 };</div><div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;</div><div class="line"><a name="l00252"></a><span class="lineno"><a class="line" href="../../d3/db0/res__pjsip__registrar_8c.html#a3d722c6a391db4ea0d1e659467863b0e">  252</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d3/db0/res__pjsip__registrar_8c.html#a3d722c6a391db4ea0d1e659467863b0e">build_path_data</a>(pjsip_rx_data *rdata, <span class="keyword">struct</span> <a class="code" href="../../dd/da2/structast__str.html">ast_str</a> **path_str)</div><div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;{</div><div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;   pjsip_generic_string_hdr *path_hdr = pjsip_msg_find_hdr_by_name(rdata-&gt;msg_info.msg, &amp;path_hdr_name, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div><div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;</div><div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;   <span class="keywordflow">if</span> (!path_hdr) {</div><div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;      <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;   }</div><div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;</div><div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;   *path_str = <a class="code" href="../../d6/d90/strings_8h.html#a9c34c6c6b8daaba24c0406270f3cf697">ast_str_create</a>(64);</div><div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;   <span class="keywordflow">if</span> (!*path_str) {</div><div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;   }</div><div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;</div><div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;   <a class="code" href="../../d6/d90/strings_8h.html#aa3341f35cedca29e60bb7f3927204283">ast_str_set</a>(path_str, 0, <span class="stringliteral">&quot;%.*s&quot;</span>, (<span class="keywordtype">int</span>)path_hdr-&gt;hvalue.slen, path_hdr-&gt;hvalue.ptr);</div><div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;</div><div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;   <span class="keywordflow">while</span> ((path_hdr = (pjsip_generic_string_hdr *) pjsip_msg_find_hdr_by_name(rdata-&gt;msg_info.msg, &amp;path_hdr_name, path_hdr-&gt;next))) {</div><div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;      <a class="code" href="../../d6/d90/strings_8h.html#a1088afdd862a49b0fce34ebe02df8ca1">ast_str_append</a>(path_str, 0, <span class="stringliteral">&quot;,%.*s&quot;</span>, (<span class="keywordtype">int</span>)path_hdr-&gt;hvalue.slen, path_hdr-&gt;hvalue.ptr);</div><div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;   }</div><div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;</div><div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;   <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;}</div><div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;</div><div class="line"><a name="l00274"></a><span class="lineno"><a class="line" href="../../d3/db0/res__pjsip__registrar_8c.html#a29a64345e9cc1919bff949f0dcf293fe">  274</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d3/db0/res__pjsip__registrar_8c.html#a29a64345e9cc1919bff949f0dcf293fe">registrar_validate_path</a>(pjsip_rx_data *rdata, <span class="keyword">struct</span> <a class="code" href="../../d4/d03/structast__sip__aor.html">ast_sip_aor</a> *<a class="code" href="../../d8/d8a/structast__sip__contact.html#a7d6a7c1f176fb54d59dd27ea307f44e6">aor</a>, <span class="keyword">struct</span> <a class="code" href="../../dd/da2/structast__str.html">ast_str</a> **path_str)</div><div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;{</div><div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;   <span class="keyword">const</span> pj_str_t path_supported_name = { <span class="stringliteral">&quot;path&quot;</span>, 4 };</div><div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;   pjsip_supported_hdr *supported_hdr;</div><div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;   <span class="keywordtype">int</span> i;</div><div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;</div><div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;   <span class="keywordflow">if</span> (!aor-&gt;<a class="code" href="../../d4/d03/structast__sip__aor.html#a6e527f7843b00df547d2221a7d31ef60">support_path</a>) {</div><div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;      <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;   }</div><div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;</div><div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d3/db0/res__pjsip__registrar_8c.html#a3d722c6a391db4ea0d1e659467863b0e">build_path_data</a>(rdata, path_str)) {</div><div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;   }</div><div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;</div><div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;   <span class="keywordflow">if</span> (!*path_str) {</div><div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;      <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;   }</div><div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;</div><div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;   supported_hdr = pjsip_msg_find_hdr(rdata-&gt;msg_info.msg, PJSIP_H_SUPPORTED, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div><div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;   <span class="keywordflow">if</span> (!supported_hdr) {</div><div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;   }</div><div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;</div><div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;   <span class="comment">/* Find advertised path support */</span></div><div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;   <span class="keywordflow">for</span> (i = 0; i &lt; supported_hdr-&gt;count; i++) {</div><div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;      <span class="keywordflow">if</span> (!pj_stricmp(&amp;supported_hdr-&gt;values[i], &amp;path_supported_name)) {</div><div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;         <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;      }</div><div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;   }</div><div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;</div><div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;   <span class="comment">/* Path header present, but support not advertised */</span></div><div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;   <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;}</div><div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;<span class="comment">/*! Transport monitor for incoming REGISTER contacts */</span></div><div class="line"><a name="l00309"></a><span class="lineno"><a class="line" href="../../d6/d85/structcontact__transport__monitor.html">  309</a></span>&#160;<span class="keyword">struct </span><a class="code" href="../../d6/d85/structcontact__transport__monitor.html">contact_transport_monitor</a> {<span class="comment"></span></div><div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;<span class="comment">   /*!</span></div><div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;<span class="comment">    * \brief Sorcery contact name to remove on transport shutdown</span></div><div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;<span class="comment">    * \note Stored after aor_name in space reserved when struct allocated.</span></div><div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;<span class="comment">    */</span></div><div class="line"><a name="l00314"></a><span class="lineno"><a class="line" href="../../d6/d85/structcontact__transport__monitor.html#ae91e2c22bd603c6a8b982935d32f5ac1">  314</a></span>&#160;   <span class="keywordtype">char</span> *<a class="code" href="../../d6/d85/structcontact__transport__monitor.html#ae91e2c22bd603c6a8b982935d32f5ac1">contact_name</a>;<span class="comment"></span></div><div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;<span class="comment">   /*! Indicates that the monitor is in the process of removing a contact */</span></div><div class="line"><a name="l00316"></a><span class="lineno"><a class="line" href="../../d6/d85/structcontact__transport__monitor.html#a56fc3769484040bb16d0a0b8d79e190f">  316</a></span>&#160;   <span class="keywordtype">int</span> <a class="code" href="../../d6/d85/structcontact__transport__monitor.html#a56fc3769484040bb16d0a0b8d79e190f">removing</a>;<span class="comment"></span></div><div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;<span class="comment">   /*! AOR name the contact is associated */</span></div><div class="line"><a name="l00318"></a><span class="lineno"><a class="line" href="../../d6/d85/structcontact__transport__monitor.html#a692428c236d2054b1b889ba0b921ba87">  318</a></span>&#160;   <span class="keywordtype">char</span> aor_name[0];</div><div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;};</div><div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;</div><div class="line"><a name="l00321"></a><span class="lineno"><a class="line" href="../../d3/db0/res__pjsip__registrar_8c.html#adef72ee13873b9570a83cde69c1d8a37">  321</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d3/db0/res__pjsip__registrar_8c.html#adef72ee13873b9570a83cde69c1d8a37">contact_transport_monitor_matcher</a>(<span class="keywordtype">void</span> *<a class="code" href="../../d7/d6f/test__linkedlists_8c.html#a13dd15487fee89a002d17ef3aff62d02">a</a>, <span class="keywordtype">void</span> *<a class="code" href="../../d7/d6f/test__linkedlists_8c.html#a025ede890af287961d3a98d0e634a62b">b</a>)</div><div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;{</div><div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d6/d85/structcontact__transport__monitor.html">contact_transport_monitor</a> *ma = <a class="code" href="../../d7/d6f/test__linkedlists_8c.html#a13dd15487fee89a002d17ef3aff62d02">a</a>;</div><div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d6/d85/structcontact__transport__monitor.html">contact_transport_monitor</a> *mb = <a class="code" href="../../d7/d6f/test__linkedlists_8c.html#a025ede890af287961d3a98d0e634a62b">b</a>;</div><div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;</div><div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;   <span class="keywordflow">return</span> strcmp(ma-&gt;<a class="code" href="../../d6/d85/structcontact__transport__monitor.html#a692428c236d2054b1b889ba0b921ba87">aor_name</a>, mb-&gt;<a class="code" href="../../d6/d85/structcontact__transport__monitor.html#a692428c236d2054b1b889ba0b921ba87">aor_name</a>) == 0</div><div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;      &amp;&amp; strcmp(ma-&gt;<a class="code" href="../../d6/d85/structcontact__transport__monitor.html#ae91e2c22bd603c6a8b982935d32f5ac1">contact_name</a>, mb-&gt;<a class="code" href="../../d6/d85/structcontact__transport__monitor.html#ae91e2c22bd603c6a8b982935d32f5ac1">contact_name</a>) == 0;</div><div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;}</div><div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;</div><div class="line"><a name="l00330"></a><span class="lineno"><a class="line" href="../../d3/db0/res__pjsip__registrar_8c.html#a42d9e3e23494c2d8e6ad408907c2f168">  330</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d3/db0/res__pjsip__registrar_8c.html#a42d9e3e23494c2d8e6ad408907c2f168">register_contact_transport_remove_cb</a>(<span class="keywordtype">void</span> *data)</div><div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;{</div><div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d6/d85/structcontact__transport__monitor.html">contact_transport_monitor</a> *<a class="code" href="../../da/dde/chan__phone_8c.html#a4e40373706bcf5cdb9409dac3166d280">monitor</a> = data;</div><div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d8/d8a/structast__sip__contact.html">ast_sip_contact</a> *<a class="code" href="../../d9/d03/structcontact.html">contact</a>;</div><div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d4/d03/structast__sip__aor.html">ast_sip_aor</a> *aor;</div><div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;</div><div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;   aor = <a class="code" href="../../d8/d8c/res__pjsip_8h.html#a434c2d85dbd10a9453f6d409809330d5">ast_sip_location_retrieve_aor</a>(monitor-&gt;<a class="code" href="../../d6/d85/structcontact__transport__monitor.html#a692428c236d2054b1b889ba0b921ba87">aor_name</a>);</div><div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;   <span class="keywordflow">if</span> (!aor) {</div><div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;      <a class="code" href="../../d5/da5/astobj2_8h.html#aa9fdb5d0a6157a56060d9f7279fe6c49">ao2_lock</a>(monitor);</div><div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;      monitor-&gt;<a class="code" href="../../d6/d85/structcontact__transport__monitor.html#a56fc3769484040bb16d0a0b8d79e190f">removing</a> = 0;</div><div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;      <a class="code" href="../../d5/da5/astobj2_8h.html#a9998bd156b936636a8780385e9a910b2">ao2_unlock</a>(monitor);</div><div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;      <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(monitor, -1);</div><div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;      <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;   }</div><div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;</div><div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#aa9fdb5d0a6157a56060d9f7279fe6c49">ao2_lock</a>(aor);</div><div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;</div><div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;   contact = <a class="code" href="../../d8/d8c/res__pjsip_8h.html#a465c83962f7f1d9d1ee84fca764505a4">ast_sip_location_retrieve_contact</a>(monitor-&gt;<a class="code" href="../../d6/d85/structcontact__transport__monitor.html#ae91e2c22bd603c6a8b982935d32f5ac1">contact_name</a>);</div><div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;   <span class="keywordflow">if</span> (contact) {</div><div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;      <a class="code" href="../../d3/db0/res__pjsip__registrar_8c.html#a10954918b2b79e996b17b94e5b6c6b62">registrar_contact_delete</a>(<a class="code" href="../../d3/db0/res__pjsip__registrar_8c.html#aa0b6ec2978c63b269ea90927f085c0d8aa8f232bbece67893e0065f35b519a01b">CONTACT_DELETE_SHUTDOWN</a>, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, contact, monitor-&gt;<a class="code" href="../../d6/d85/structcontact__transport__monitor.html#a692428c236d2054b1b889ba0b921ba87">aor_name</a>);</div><div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;      <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(contact, -1);</div><div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;   }</div><div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#a9998bd156b936636a8780385e9a910b2">ao2_unlock</a>(aor);</div><div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(aor, -1);</div><div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;</div><div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(monitor, -1);</div><div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;   <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;}</div><div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;<span class="comment">/*!</span></div><div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;<span class="comment"> * \internal</span></div><div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;<span class="comment"> * \brief The reliable transport we registered as a contact has shutdown.</span></div><div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;<span class="comment"> * \param data What contact needs to be removed.</span></div><div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;<span class="comment"> * \note Normally executed by the pjsip monitor thread.</span></div><div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;<span class="comment"> * \return Nothing</span></div><div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00369"></a><span class="lineno"><a class="line" href="../../d3/db0/res__pjsip__registrar_8c.html#ac663f457fa4f4fed9b201e8a82a36eb2">  369</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d3/db0/res__pjsip__registrar_8c.html#ac663f457fa4f4fed9b201e8a82a36eb2">register_contact_transport_shutdown_cb</a>(<span class="keywordtype">void</span> *data)</div><div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;{</div><div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d6/d85/structcontact__transport__monitor.html">contact_transport_monitor</a> *<a class="code" href="../../da/dde/chan__phone_8c.html#a4e40373706bcf5cdb9409dac3166d280">monitor</a> = data;</div><div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;</div><div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;   <span class="comment">/*</span></div><div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;<span class="comment">    * It&#39;s possible for this shutdown handler to get called multiple times for the</span></div><div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;<span class="comment">    * same monitor from different threads. Only one of the calls needs to do the</span></div><div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;<span class="comment">    * actual removing of the contact, so if one is currently removing then any</span></div><div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;<span class="comment">    * subsequent calls can skip.</span></div><div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;<span class="comment">    */</span></div><div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#aa9fdb5d0a6157a56060d9f7279fe6c49">ao2_lock</a>(monitor);</div><div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;   <span class="keywordflow">if</span> (monitor-&gt;<a class="code" href="../../d6/d85/structcontact__transport__monitor.html#a56fc3769484040bb16d0a0b8d79e190f">removing</a>) {</div><div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;      <a class="code" href="../../d5/da5/astobj2_8h.html#a9998bd156b936636a8780385e9a910b2">ao2_unlock</a>(monitor);</div><div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;      <span class="keywordflow">return</span>;</div><div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;   }</div><div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;</div><div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;   monitor-&gt;<a class="code" href="../../d6/d85/structcontact__transport__monitor.html#a56fc3769484040bb16d0a0b8d79e190f">removing</a> = 1;</div><div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;</div><div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;   <span class="comment">/*</span></div><div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;<span class="comment">    * Push off to a default serializer.  This is in case sorcery</span></div><div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;<span class="comment">    * does database accesses for contacts.  Database accesses may</span></div><div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;<span class="comment">    * not be on this machine.  We don&#39;t want to tie up the pjsip</span></div><div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;<span class="comment">    * monitor thread with potentially long access times.</span></div><div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;<span class="comment">    */</span></div><div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(monitor, +1);</div><div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d7/dfa/group__pjsip__threading.html#ga4f0a0629fa2ca084812772356d8e3565">ast_sip_push_task</a>(<a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../d3/db0/res__pjsip__registrar_8c.html#a42d9e3e23494c2d8e6ad408907c2f168">register_contact_transport_remove_cb</a>, monitor)) {</div><div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;      monitor-&gt;<a class="code" href="../../d6/d85/structcontact__transport__monitor.html#a56fc3769484040bb16d0a0b8d79e190f">removing</a> = 0;</div><div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;      <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(monitor, -1);</div><div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;   }</div><div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;</div><div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#a9998bd156b936636a8780385e9a910b2">ao2_unlock</a>(monitor);</div><div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;}</div><div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;</div><div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;</div><div class="line"><a name="l00403"></a><span class="lineno"><a class="line" href="../../d3/db0/res__pjsip__registrar_8c.html#a10954918b2b79e996b17b94e5b6c6b62">  403</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d3/db0/res__pjsip__registrar_8c.html#a10954918b2b79e996b17b94e5b6c6b62">registrar_contact_delete</a>(<span class="keyword">enum</span> <a class="code" href="../../d3/db0/res__pjsip__registrar_8c.html#aa0b6ec2978c63b269ea90927f085c0d8">contact_delete_type</a> <a class="code" href="../../d7/d49/chan__ooh323_8c.html#a4d63fdfe5451ec2248c16a2739190c56">type</a>, pjsip_transport *transport,</div><div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;   <span class="keyword">struct</span> <a class="code" href="../../d8/d8a/structast__sip__contact.html">ast_sip_contact</a> *<a class="code" href="../../d9/d03/structcontact.html">contact</a>, <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="../../d6/d85/structcontact__transport__monitor.html#a692428c236d2054b1b889ba0b921ba87">aor_name</a>)</div><div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;{</div><div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;   <span class="keywordtype">int</span> aor_size;</div><div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;</div><div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;   <span class="comment">/* Permanent contacts can&#39;t be deleted */</span></div><div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../de/df7/time_8h.html#a4e7b3508884147c7991a68361ac781a2">ast_tvzero</a>(contact-&gt;<a class="code" href="../../d8/d8a/structast__sip__contact.html#a98ed99328ad621551cdfbee6b83754ae">expiration_time</a>)) {</div><div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;   }</div><div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;</div><div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;   aor_size = aor_name ? strlen(aor_name) : 0;</div><div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;   <span class="keywordflow">if</span> (contact-&gt;<a class="code" href="../../d8/d8a/structast__sip__contact.html#a08e0b4a94cab7d431f1717d53d619447">prune_on_boot</a> &amp;&amp; type != <a class="code" href="../../d3/db0/res__pjsip__registrar_8c.html#aa0b6ec2978c63b269ea90927f085c0d8aa8f232bbece67893e0065f35b519a01b">CONTACT_DELETE_SHUTDOWN</a> &amp;&amp; aor_size) {</div><div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;      <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="../../d6/d85/structcontact__transport__monitor.html#ae91e2c22bd603c6a8b982935d32f5ac1">contact_name</a> = <a class="code" href="../../d8/d25/sorcery_8h.html#a97706283a06cbb44e4f0f9620dd5cf07">ast_sorcery_object_get_id</a>(contact);</div><div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;      <span class="keywordtype">size_t</span> contact_name_len = strlen(contact_name) + 1;</div><div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;      <span class="keyword">struct </span><a class="code" href="../../d6/d85/structcontact__transport__monitor.html">contact_transport_monitor</a> *<a class="code" href="../../da/dde/chan__phone_8c.html#a4e40373706bcf5cdb9409dac3166d280">monitor</a> = <a class="code" href="../../d8/d8a/astmm_8h.html#a249282ecc7ba5a1a49fa75e9a33d1717">ast_alloca</a>(</div><div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;         <span class="keyword">sizeof</span>(*monitor) + 1 + aor_size + contact_name_len);</div><div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;</div><div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;      strcpy(monitor-&gt;<a class="code" href="../../d6/d85/structcontact__transport__monitor.html#a692428c236d2054b1b889ba0b921ba87">aor_name</a>, aor_name); <span class="comment">/* Safe */</span></div><div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;      monitor-&gt;<a class="code" href="../../d6/d85/structcontact__transport__monitor.html#ae91e2c22bd603c6a8b982935d32f5ac1">contact_name</a> = monitor-&gt;<a class="code" href="../../d6/d85/structcontact__transport__monitor.html#a692428c236d2054b1b889ba0b921ba87">aor_name</a> + aor_size + 1;</div><div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;      <a class="code" href="../../d6/d90/strings_8h.html#ac4040268f7b6ed77dfc49c7767626369">ast_copy_string</a>(monitor-&gt;<a class="code" href="../../d6/d85/structcontact__transport__monitor.html#ae91e2c22bd603c6a8b982935d32f5ac1">contact_name</a>, contact_name, contact_name_len); <span class="comment">/* Safe */</span></div><div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;</div><div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;      <span class="keywordflow">if</span> (transport) {</div><div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;         <a class="code" href="../../d8/d8c/res__pjsip_8h.html#a5d73e049fbced1da4e3041d1656e0aa6">ast_sip_transport_monitor_unregister</a>(transport,</div><div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;            <a class="code" href="../../d3/db0/res__pjsip__registrar_8c.html#ac663f457fa4f4fed9b201e8a82a36eb2">register_contact_transport_shutdown_cb</a>,   monitor,</div><div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;            <a class="code" href="../../d3/db0/res__pjsip__registrar_8c.html#adef72ee13873b9570a83cde69c1d8a37">contact_transport_monitor_matcher</a>);</div><div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;      } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;         <span class="comment">/*</span></div><div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;<span class="comment">          * If a specific transport is not supplied then unregister the matching</span></div><div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;<span class="comment">          * monitor from all reliable transports.</span></div><div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;<span class="comment">          */</span></div><div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;         <a class="code" href="../../d8/d8c/res__pjsip_8h.html#a7e419c29ebfb010ca04b7c189c207bbd">ast_sip_transport_monitor_unregister_all</a>(<a class="code" href="../../d3/db0/res__pjsip__registrar_8c.html#ac663f457fa4f4fed9b201e8a82a36eb2">register_contact_transport_shutdown_cb</a>,</div><div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;            monitor, <a class="code" href="../../d3/db0/res__pjsip__registrar_8c.html#adef72ee13873b9570a83cde69c1d8a37">contact_transport_monitor_matcher</a>);</div><div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;      }</div><div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;   }</div><div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;</div><div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;   <a class="code" href="../../d8/d8c/res__pjsip_8h.html#af7205a9dc0a18ef1dc14785099846ca3">ast_sip_location_delete_contact</a>(contact);</div><div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;</div><div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;   <span class="keywordflow">if</span> (aor_size) {</div><div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="../../d1/d8c/logger_8h.html#a7d52159deec8b3179d27fcb4d39c30d2">VERBOSITY_ATLEAST</a>(3)) {</div><div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;         <span class="keyword">const</span> <span class="keywordtype">char</span> *reason = <span class="stringliteral">&quot;none&quot;</span>;</div><div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;</div><div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;         <span class="keywordflow">switch</span> (type) {</div><div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;         <span class="keywordflow">case</span> <a class="code" href="../../d3/db0/res__pjsip__registrar_8c.html#aa0b6ec2978c63b269ea90927f085c0d8a50feb257eddbe7969373b856facc714d">CONTACT_DELETE_ERROR</a>:</div><div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;            reason = <span class="stringliteral">&quot;registration failure&quot;</span>;</div><div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;         <span class="keywordflow">case</span> <a class="code" href="../../d3/db0/res__pjsip__registrar_8c.html#aa0b6ec2978c63b269ea90927f085c0d8a50f2fbc6b9c2a86ec4e05bd350e9f253">CONTACT_DELETE_EXISTING</a>:</div><div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;            reason = <span class="stringliteral">&quot;remove existing&quot;</span>;</div><div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;         <span class="keywordflow">case</span> <a class="code" href="../../d3/db0/res__pjsip__registrar_8c.html#aa0b6ec2978c63b269ea90927f085c0d8ad88825ec6d3fcb67a681bd0c66e789eb">CONTACT_DELETE_EXPIRE</a>:</div><div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;            reason = <span class="stringliteral">&quot;expiration&quot;</span>;</div><div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;         <span class="keywordflow">case</span> <a class="code" href="../../d3/db0/res__pjsip__registrar_8c.html#aa0b6ec2978c63b269ea90927f085c0d8ab4f9fcf2f1d563fcb73a11daad67911a">CONTACT_DELETE_REQUEST</a>:</div><div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;            reason = <span class="stringliteral">&quot;request&quot;</span>;</div><div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;         <span class="keywordflow">case</span> <a class="code" href="../../d3/db0/res__pjsip__registrar_8c.html#aa0b6ec2978c63b269ea90927f085c0d8aa8f232bbece67893e0065f35b519a01b">CONTACT_DELETE_SHUTDOWN</a>:</div><div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;            reason = <span class="stringliteral">&quot;shutdown&quot;</span>;</div><div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;         }</div><div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;</div><div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;         <a class="code" href="../../d1/d8c/logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(3, <span class="stringliteral">&quot;Removed contact &#39;%s&#39; from AOR &#39;%s&#39; due to %s\n&quot;</span>,</div><div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;                contact-&gt;<a class="code" href="../../d8/d8a/structast__sip__contact.html#a19ac71226fac09e87afe31acb4c99214">uri</a>, aor_name, reason);</div><div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;      }</div><div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;</div><div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;      <a class="code" href="../../d2/ddc/test_8h.html#a9482d93ea3931853331bdbc745ce7cb4">ast_test_suite_event_notify</a>(<span class="stringliteral">&quot;AOR_CONTACT_REMOVED&quot;</span>,</div><div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;            <span class="stringliteral">&quot;Contact: %s\r\n&quot;</span></div><div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;            <span class="stringliteral">&quot;AOR: %s\r\n&quot;</span></div><div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;            <span class="stringliteral">&quot;UserAgent: %s&quot;</span>,</div><div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;            contact-&gt;<a class="code" href="../../d8/d8a/structast__sip__contact.html#a19ac71226fac09e87afe31acb4c99214">uri</a>,</div><div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;            aor_name,</div><div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;            contact-&gt;<a class="code" href="../../d8/d8a/structast__sip__contact.html#ad6233310a4cab812bbccf98b823aa039">user_agent</a>);</div><div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;   }</div><div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;</div><div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;   <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;}</div><div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;</div><div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;<a class="code" href="../../d3/db0/res__pjsip__registrar_8c.html#aab4e076fd9f059f6eed2ac6027807cb3">AST_VECTOR</a>(excess_contact_vector, <span class="keyword">struct</span> <a class="code" href="../../d8/d8a/structast__sip__contact.html">ast_sip_contact</a> *);</div><div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;</div><div class="line"><a name="l00480"></a><span class="lineno"><a class="line" href="../../d3/db0/res__pjsip__registrar_8c.html#a0b9632debb5437504806a0c988ff212d">  480</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d3/db0/res__pjsip__registrar_8c.html#a0b9632debb5437504806a0c988ff212d">vec_contact_cmp</a>(<span class="keyword">struct</span> <a class="code" href="../../d8/d8a/structast__sip__contact.html">ast_sip_contact</a> *left, <span class="keyword">struct</span> <a class="code" href="../../d8/d8a/structast__sip__contact.html">ast_sip_contact</a> *right)</div><div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;{</div><div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d8/d8a/structast__sip__contact.html">ast_sip_contact</a> *left_contact = left;</div><div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d8/d8a/structast__sip__contact.html">ast_sip_contact</a> *right_contact = right;</div><div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;</div><div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;   <span class="comment">/* Sort from soonest to expire to last to expire */</span></div><div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;   <span class="keywordflow">return</span> <a class="code" href="../../de/df7/time_8h.html#a6daa33e2052acd094bb63e78aba29733">ast_tvcmp</a>(left_contact-&gt;<a class="code" href="../../d8/d8a/structast__sip__contact.html#a98ed99328ad621551cdfbee6b83754ae">expiration_time</a>, right_contact-&gt;<a class="code" href="../../d8/d8a/structast__sip__contact.html#a98ed99328ad621551cdfbee6b83754ae">expiration_time</a>);</div><div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;}</div><div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;</div><div class="line"><a name="l00489"></a><span class="lineno"><a class="line" href="../../d3/db0/res__pjsip__registrar_8c.html#a8c6d34bc166948f300dea65defbc5c6e">  489</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d3/db0/res__pjsip__registrar_8c.html#a8c6d34bc166948f300dea65defbc5c6e">vec_contact_add</a>(<span class="keywordtype">void</span> *obj, <span class="keywordtype">void</span> *arg, <span class="keywordtype">int</span> flags)</div><div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;{</div><div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d8/d8a/structast__sip__contact.html">ast_sip_contact</a> *<a class="code" href="../../d9/d03/structcontact.html">contact</a> = obj;</div><div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;   <span class="keyword">struct </span>excess_contact_vector *contact_vec = arg;</div><div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;</div><div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;   <span class="comment">/*</span></div><div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;<span class="comment">    * Performance wise, an insertion sort is fine because we</span></div><div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;<span class="comment">    * shouldn&#39;t need to remove more than a handful of contacts.</span></div><div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;<span class="comment">    * I expect we&#39;ll typically be removing only one contact.</span></div><div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;<span class="comment">    */</span></div><div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;   <a class="code" href="../../d6/d68/vector_8h.html#a8418853c95c2093a85174233f0ef4827">AST_VECTOR_ADD_SORTED</a>(contact_vec, contact, <a class="code" href="../../d3/db0/res__pjsip__registrar_8c.html#a0b9632debb5437504806a0c988ff212d">vec_contact_cmp</a>);</div><div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d6/d68/vector_8h.html#a20b08af81cc9452fb721c9a698f81bdf">AST_VECTOR_SIZE</a>(contact_vec) == <a class="code" href="../../d6/d68/vector_8h.html#a6e7f18e9b5743289694fea16ba629174">AST_VECTOR_MAX_SIZE</a>(contact_vec)) {</div><div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;      <span class="comment">/*</span></div><div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;<span class="comment">       * We added a contact over the number we need to remove.</span></div><div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;<span class="comment">       * Remove the longest to expire contact from the vector</span></div><div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;<span class="comment">       * which is the last element in the vector.  It may be</span></div><div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;<span class="comment">       * the one we just added or the one we just added pushed</span></div><div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;<span class="comment">       * out an earlier contact from removal consideration.</span></div><div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;<span class="comment">       */</span></div><div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;      --<a class="code" href="../../d6/d68/vector_8h.html#a20b08af81cc9452fb721c9a698f81bdf">AST_VECTOR_SIZE</a>(contact_vec);</div><div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;   }</div><div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;   <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;}</div><div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;<span class="comment">/*!</span></div><div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;<span class="comment"> * \internal</span></div><div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;<span class="comment"> * \brief Remove excess existing contacts that expire the soonest.</span></div><div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;<span class="comment"> * \since 13.18.0</span></div><div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;<span class="comment"> * \param contacts Container of unmodified contacts that could remove.</span></div><div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;<span class="comment"> * \param to_remove Maximum number of contacts to remove.</span></div><div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;<span class="comment"> * \return Nothing</span></div><div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00523"></a><span class="lineno"><a class="line" href="../../d3/db0/res__pjsip__registrar_8c.html#a2ecd45d304041048628823fa87f43a90">  523</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d3/db0/res__pjsip__registrar_8c.html#a2ecd45d304041048628823fa87f43a90">remove_excess_contacts</a>(<span class="keyword">struct</span> <a class="code" href="../../d2/da9/structao2__container.html">ao2_container</a> *contacts, <span class="keyword">struct</span> <a class="code" href="../../d2/da9/structao2__container.html">ao2_container</a> *response_contacts,</div><div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;   <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> to_remove)</div><div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;{</div><div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;   <span class="keyword">struct </span>excess_contact_vector contact_vec;</div><div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;</div><div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;   <span class="comment">/*</span></div><div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;<span class="comment">    * Create a sorted vector to hold the to_remove soonest to</span></div><div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;<span class="comment">    * expire contacts.  The vector has an extra space to</span></div><div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;<span class="comment">    * temporarily hold the longest to expire contact that we</span></div><div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;<span class="comment">    * won&#39;t remove.</span></div><div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;<span class="comment">    */</span></div><div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d6/d68/vector_8h.html#ad9d555fa89da1bfc691181993499f785">AST_VECTOR_INIT</a>(&amp;contact_vec, to_remove + 1)) {</div><div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;      <span class="keywordflow">return</span>;</div><div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;   }</div><div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#a47857055118a703ae87ea5ebaf4842ed">ao2_callback</a>(contacts, <a class="code" href="../../d5/da5/astobj2_8h.html#ad9d009e87e737af900825b36db55a35ca5fc59b193d86a0a8ddfe866304be829d">OBJ_NODATA</a> | <a class="code" href="../../d5/da5/astobj2_8h.html#ad9d009e87e737af900825b36db55a35ca614744a4d36b3189d4ab5b02c8645d47">OBJ_MULTIPLE</a>, <a class="code" href="../../d3/db0/res__pjsip__registrar_8c.html#a8c6d34bc166948f300dea65defbc5c6e">vec_contact_add</a>, &amp;contact_vec);</div><div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;</div><div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;   <span class="comment">/*</span></div><div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;<span class="comment">    * The vector should always be populated with the number</span></div><div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;<span class="comment">    * of contacts we need to remove.  Just in case, we will</span></div><div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;<span class="comment">    * remove all contacts in the vector even if the contacts</span></div><div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;<span class="comment">    * container had fewer contacts than there should be.</span></div><div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;<span class="comment">    */</span></div><div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;   <a class="code" href="../../d5/d60/utils_8h.html#a24374da24af1931d8a7ccde5b352bb2c">ast_assert</a>(<a class="code" href="../../d6/d68/vector_8h.html#a20b08af81cc9452fb721c9a698f81bdf">AST_VECTOR_SIZE</a>(&amp;contact_vec) == to_remove);</div><div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;   to_remove = <a class="code" href="../../d6/d68/vector_8h.html#a20b08af81cc9452fb721c9a698f81bdf">AST_VECTOR_SIZE</a>(&amp;contact_vec);</div><div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;</div><div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;   <span class="comment">/* Remove the excess contacts that expire the soonest */</span></div><div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;   <span class="keywordflow">while</span> (to_remove--) {</div><div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;      <span class="keyword">struct </span><a class="code" href="../../d8/d8a/structast__sip__contact.html">ast_sip_contact</a> *<a class="code" href="../../d9/d03/structcontact.html">contact</a>;</div><div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;</div><div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;      contact = <a class="code" href="../../d6/d68/vector_8h.html#aef32ac52c3e8a530d16eb92cde22cacd">AST_VECTOR_GET</a>(&amp;contact_vec, to_remove);</div><div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;</div><div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;      <a class="code" href="../../d3/db0/res__pjsip__registrar_8c.html#a10954918b2b79e996b17b94e5b6c6b62">registrar_contact_delete</a>(<a class="code" href="../../d3/db0/res__pjsip__registrar_8c.html#aa0b6ec2978c63b269ea90927f085c0d8a50f2fbc6b9c2a86ec4e05bd350e9f253">CONTACT_DELETE_EXISTING</a>, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, contact, contact-&gt;<a class="code" href="../../d8/d8a/structast__sip__contact.html#a7d6a7c1f176fb54d59dd27ea307f44e6">aor</a>);</div><div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;</div><div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;      <a class="code" href="../../d5/da5/astobj2_8h.html#a64f51be4bee35c38dbe59b0a788b5ce8">ao2_unlink</a>(response_contacts, contact);</div><div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;   }</div><div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;</div><div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;   <a class="code" href="../../d6/d68/vector_8h.html#a66aaa4efda59c52384b03c38e781124d">AST_VECTOR_FREE</a>(&amp;contact_vec);</div><div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;}</div><div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;<span class="comment">/*! \brief Callback function which adds non-permanent contacts to a container */</span></div><div class="line"><a name="l00563"></a><span class="lineno"><a class="line" href="../../d3/db0/res__pjsip__registrar_8c.html#ac315187e196c9ec42b2cba439d633e43">  563</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d3/db0/res__pjsip__registrar_8c.html#ac315187e196c9ec42b2cba439d633e43">registrar_add_non_permanent</a>(<span class="keywordtype">void</span> *obj, <span class="keywordtype">void</span> *arg, <span class="keywordtype">int</span> flags)</div><div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;{</div><div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d8/d8a/structast__sip__contact.html">ast_sip_contact</a> *<a class="code" href="../../d9/d03/structcontact.html">contact</a> = obj;</div><div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d2/da9/structao2__container.html">ao2_container</a> *<a class="code" href="../../d0/d60/res__fax_8c.html#a7ea220e4d14b05876af4430e9832ce47">container</a> = arg;</div><div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;</div><div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../de/df7/time_8h.html#a4e7b3508884147c7991a68361ac781a2">ast_tvzero</a>(contact-&gt;<a class="code" href="../../d8/d8a/structast__sip__contact.html#a98ed99328ad621551cdfbee6b83754ae">expiration_time</a>)) {</div><div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;      <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;   }</div><div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;</div><div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#a1ad9f122bcae95a470639402faa3d2ee">ao2_link</a>(container, contact);</div><div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;</div><div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;   <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;}</div><div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;</div><div class="line"><a name="l00577"></a><span class="lineno"><a class="line" href="../../db/d19/structaor__core__response.html">  577</a></span>&#160;<span class="keyword">struct </span><a class="code" href="../../db/d19/structaor__core__response.html">aor_core_response</a> {<span class="comment"></span></div><div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;<span class="comment">   /*! Tx data to use for statefull response.  NULL for stateless response. */</span></div><div class="line"><a name="l00579"></a><span class="lineno"><a class="line" href="../../db/d19/structaor__core__response.html#a3753fea80c98c041cd89012ca2599cbd">  579</a></span>&#160;   pjsip_tx_data *<a class="code" href="../../db/d19/structaor__core__response.html#a3753fea80c98c041cd89012ca2599cbd">tdata</a>;<span class="comment"></span></div><div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;<span class="comment">   /*! SIP response code to send in stateless response */</span></div><div class="line"><a name="l00581"></a><span class="lineno"><a class="line" href="../../db/d19/structaor__core__response.html#a45a5b7c00a796a23f01673cef1dbe0a9">  581</a></span>&#160;   <span class="keywordtype">int</span> <a class="code" href="../../db/d19/structaor__core__response.html#a45a5b7c00a796a23f01673cef1dbe0a9">code</a>;</div><div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;};</div><div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;</div><div class="line"><a name="l00584"></a><span class="lineno"><a class="line" href="../../d3/db0/res__pjsip__registrar_8c.html#a72fcdc0d711444a70be3def7099fcd4b">  584</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d3/db0/res__pjsip__registrar_8c.html#a72fcdc0d711444a70be3def7099fcd4b">register_aor_core</a>(pjsip_rx_data *rdata,</div><div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;   <span class="keyword">struct</span> <a class="code" href="../../d3/d46/structast__sip__endpoint.html">ast_sip_endpoint</a> *endpoint,</div><div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;   <span class="keyword">struct</span> <a class="code" href="../../d4/d03/structast__sip__aor.html">ast_sip_aor</a> *aor,</div><div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;   <span class="keyword">const</span> <span class="keywordtype">char</span> *aor_name,</div><div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;   <span class="keyword">struct</span> <a class="code" href="../../d2/da9/structao2__container.html">ao2_container</a> *contacts,</div><div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;   <span class="keyword">struct</span> <a class="code" href="../../db/d19/structaor__core__response.html">aor_core_response</a> *response)</div><div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;{</div><div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;   <span class="keyword">static</span> <span class="keyword">const</span> pj_str_t USER_AGENT = { <span class="stringliteral">&quot;User-Agent&quot;</span>, 10 };</div><div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;</div><div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;   <span class="keywordtype">int</span> added = 0;</div><div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;   <span class="keywordtype">int</span> updated = 0;</div><div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;   <span class="keywordtype">int</span> deleted = 0;</div><div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;   <span class="keywordtype">int</span> permanent = 0;</div><div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;   <span class="keywordtype">int</span> contact_count;</div><div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d2/da9/structao2__container.html">ao2_container</a> *existing_contacts = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;   pjsip_contact_hdr *contact_hdr = (pjsip_contact_hdr *)&amp;rdata-&gt;msg_info.msg-&gt;hdr;</div><div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;   <span class="keyword">struct</span> <a class="code" href="../../d6/dcf/structregistrar__contact__details.html">registrar_contact_details</a> details = { 0, };</div><div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;   pjsip_tx_data *tdata;</div><div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;   <a class="code" href="../../d5/d60/utils_8h.html#a1604b4d72144dd3d9f7da668e90337e9">RAII_VAR</a>(<span class="keyword">struct</span> <a class="code" href="../../dd/da2/structast__str.html">ast_str</a> *, path_str, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../d8/d8a/astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>);</div><div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d8/d8a/structast__sip__contact.html">ast_sip_contact</a> *response_contact;</div><div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;   <span class="keywordtype">char</span> *<a class="code" href="../../d8/d8a/structast__sip__contact.html#ad6233310a4cab812bbccf98b823aa039">user_agent</a> = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;   pjsip_user_agent_hdr *user_agent_hdr;</div><div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;   pjsip_expires_hdr *expires_hdr;</div><div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;   pjsip_via_hdr *via_hdr;</div><div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;   pjsip_via_hdr *via_hdr_last;</div><div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;   <span class="keywordtype">char</span> *<a class="code" href="../../d8/d8a/structast__sip__contact.html#a526207204e5f599fb9a618d9f8001ca2">via_addr</a> = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;   <span class="keywordtype">int</span> <a class="code" href="../../d8/d8a/structast__sip__contact.html#ad3a98d512391e68d8473ad51e3fd2401">via_port</a> = 0;</div><div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;   pjsip_cid_hdr *call_id_hdr;</div><div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;   <span class="keywordtype">char</span> *<a class="code" href="../../d8/d8a/structast__sip__contact.html#a71e59257a329fbb031e9fc17eaca0922">call_id</a> = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160;   <span class="keywordtype">size_t</span> alloc_size;</div><div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;</div><div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;   <span class="comment">/* We create a single pool and use it throughout this function where we need one */</span></div><div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;   details.pool = pjsip_endpt_create_pool(<a class="code" href="../../d8/d8c/res__pjsip_8h.html#a785afb501e315c8a97ad476fb6a8be1d">ast_sip_get_pjsip_endpoint</a>(),</div><div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160;      <span class="stringliteral">&quot;Contact Comparison&quot;</span>, 1024, 256);</div><div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160;   <span class="keywordflow">if</span> (!details.pool) {</div><div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160;      response-&gt;code = 500;</div><div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160;      <span class="keywordflow">return</span>;</div><div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;   }</div><div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;</div><div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;   <span class="comment">/* If there are any permanent contacts configured on the AOR we need to take them</span></div><div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;<span class="comment">    * into account when counting contacts.</span></div><div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160;<span class="comment">    */</span></div><div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d8/d8a/structast__sip__contact.html#a7d6a7c1f176fb54d59dd27ea307f44e6">aor</a>-&gt;permanent_contacts) {</div><div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160;      permanent = <a class="code" href="../../d5/da5/astobj2_8h.html#a512cc40ce96c63b3d5c78040baa4c9cd">ao2_container_count</a>(<a class="code" href="../../d8/d8a/structast__sip__contact.html#a7d6a7c1f176fb54d59dd27ea307f44e6">aor</a>-&gt;permanent_contacts);</div><div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;   }</div><div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160;</div><div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d3/db0/res__pjsip__registrar_8c.html#ab620225c7d2d4b8fc85df23dc0912369">registrar_validate_contacts</a>(rdata, details.pool, contacts, <a class="code" href="../../d8/d8a/structast__sip__contact.html#a7d6a7c1f176fb54d59dd27ea307f44e6">aor</a>, permanent, &amp;added, &amp;updated, &amp;deleted)) {</div><div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160;      <span class="comment">/* The provided Contact headers do not conform to the specification */</span></div><div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160;      <a class="code" href="../../d8/d8c/res__pjsip_8h.html#afa522937191ad0d45711173590521d47">ast_sip_report_failed_acl</a>(<a class="code" href="../../d8/d8a/structast__sip__contact.html#a3960205b2a4e7e012dc9f0eae1855f01">endpoint</a>, rdata, <span class="stringliteral">&quot;registrar_invalid_contacts_provided&quot;</span>);</div><div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Failed to validate contacts in REGISTER request from &#39;%s&#39;\n&quot;</span>,</div><div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160;            <a class="code" href="../../d8/d25/sorcery_8h.html#a97706283a06cbb44e4f0f9620dd5cf07">ast_sorcery_object_get_id</a>(<a class="code" href="../../d8/d8a/structast__sip__contact.html#a3960205b2a4e7e012dc9f0eae1855f01">endpoint</a>));</div><div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160;      response-&gt;code = 400;</div><div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160;      pjsip_endpt_release_pool(<a class="code" href="../../d8/d8c/res__pjsip_8h.html#a785afb501e315c8a97ad476fb6a8be1d">ast_sip_get_pjsip_endpoint</a>(), details.pool);</div><div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160;      <span class="keywordflow">return</span>;</div><div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160;   }</div><div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160;</div><div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d3/db0/res__pjsip__registrar_8c.html#a29a64345e9cc1919bff949f0dcf293fe">registrar_validate_path</a>(rdata, <a class="code" href="../../d8/d8a/structast__sip__contact.html#a7d6a7c1f176fb54d59dd27ea307f44e6">aor</a>, &amp;path_str)) {</div><div class="line"><a name="l00641"></a><span class="lineno">  641</span>&#160;      <span class="comment">/* Ensure that intervening proxies did not make invalid modifications to the request */</span></div><div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Invalid modifications made to REGISTER request from &#39;%s&#39; by intervening proxy\n&quot;</span>,</div><div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160;            <a class="code" href="../../d8/d25/sorcery_8h.html#a97706283a06cbb44e4f0f9620dd5cf07">ast_sorcery_object_get_id</a>(<a class="code" href="../../d8/d8a/structast__sip__contact.html#a3960205b2a4e7e012dc9f0eae1855f01">endpoint</a>));</div><div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160;      response-&gt;code = 420;</div><div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160;      pjsip_endpt_release_pool(<a class="code" href="../../d8/d8c/res__pjsip_8h.html#a785afb501e315c8a97ad476fb6a8be1d">ast_sip_get_pjsip_endpoint</a>(), details.pool);</div><div class="line"><a name="l00646"></a><span class="lineno">  646</span>&#160;      <span class="keywordflow">return</span>;</div><div class="line"><a name="l00647"></a><span class="lineno">  647</span>&#160;   }</div><div class="line"><a name="l00648"></a><span class="lineno">  648</span>&#160;</div><div class="line"><a name="l00649"></a><span class="lineno">  649</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d8/d8a/structast__sip__contact.html#a7d6a7c1f176fb54d59dd27ea307f44e6">aor</a>-&gt;remove_existing) {</div><div class="line"><a name="l00650"></a><span class="lineno">  650</span>&#160;      <span class="comment">/* Cumulative number of contacts affected by this registration */</span></div><div class="line"><a name="l00651"></a><span class="lineno">  651</span>&#160;      contact_count = <a class="code" href="../../d5/d60/utils_8h.html#afa99ec4acc4ecb2dc3c2d05da15d0e3f">MAX</a>(updated + added - deleted,  0);</div><div class="line"><a name="l00652"></a><span class="lineno">  652</span>&#160;</div><div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160;      <span class="comment">/* We need to keep track of only existing contacts so we can later</span></div><div class="line"><a name="l00654"></a><span class="lineno">  654</span>&#160;<span class="comment">       * remove them if need be.</span></div><div class="line"><a name="l00655"></a><span class="lineno">  655</span>&#160;<span class="comment">       */</span></div><div class="line"><a name="l00656"></a><span class="lineno">  656</span>&#160;      existing_contacts = <a class="code" href="../../d5/da5/astobj2_8h.html#add41bd9979cb8642f81dd38aa2dfcd6d">ao2_container_alloc_list</a>(<a class="code" href="../../d5/da5/astobj2_8h.html#a2cf7e3433f08351aafe3b0cd31edf7f8a23b60f2636bcfbc4dfeea6cc21bf847b">AO2_ALLOC_OPT_LOCK_NOLOCK</a>, 0,</div><div class="line"><a name="l00657"></a><span class="lineno">  657</span>&#160;         <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../d8/d25/sorcery_8h.html#a83eba565782cb769634180b88db29d45">ast_sorcery_object_id_compare</a>);</div><div class="line"><a name="l00658"></a><span class="lineno">  658</span>&#160;      <span class="keywordflow">if</span> (!existing_contacts) {</div><div class="line"><a name="l00659"></a><span class="lineno">  659</span>&#160;         response-&gt;code = 500;</div><div class="line"><a name="l00660"></a><span class="lineno">  660</span>&#160;         pjsip_endpt_release_pool(<a class="code" href="../../d8/d8c/res__pjsip_8h.html#a785afb501e315c8a97ad476fb6a8be1d">ast_sip_get_pjsip_endpoint</a>(), details.pool);</div><div class="line"><a name="l00661"></a><span class="lineno">  661</span>&#160;         <span class="keywordflow">return</span>;</div><div class="line"><a name="l00662"></a><span class="lineno">  662</span>&#160;      }</div><div class="line"><a name="l00663"></a><span class="lineno">  663</span>&#160;</div><div class="line"><a name="l00664"></a><span class="lineno">  664</span>&#160;      <a class="code" href="../../d5/da5/astobj2_8h.html#a47857055118a703ae87ea5ebaf4842ed">ao2_callback</a>(contacts, <a class="code" href="../../d5/da5/astobj2_8h.html#ad9d009e87e737af900825b36db55a35ca5fc59b193d86a0a8ddfe866304be829d">OBJ_NODATA</a>, <a class="code" href="../../d3/db0/res__pjsip__registrar_8c.html#ac315187e196c9ec42b2cba439d633e43">registrar_add_non_permanent</a>, existing_contacts);</div><div class="line"><a name="l00665"></a><span class="lineno">  665</span>&#160;   } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00666"></a><span class="lineno">  666</span>&#160;      <span class="comment">/* Total contacts after this registration */</span></div><div class="line"><a name="l00667"></a><span class="lineno">  667</span>&#160;      contact_count = <a class="code" href="../../d5/da5/astobj2_8h.html#a512cc40ce96c63b3d5c78040baa4c9cd">ao2_container_count</a>(contacts) - permanent + added - deleted;</div><div class="line"><a name="l00668"></a><span class="lineno">  668</span>&#160;   }</div><div class="line"><a name="l00669"></a><span class="lineno">  669</span>&#160;   <span class="keywordflow">if</span> (contact_count &gt; <a class="code" href="../../d8/d8a/structast__sip__contact.html#a7d6a7c1f176fb54d59dd27ea307f44e6">aor</a>-&gt;max_contacts) {</div><div class="line"><a name="l00670"></a><span class="lineno">  670</span>&#160;      <span class="comment">/* Enforce the maximum number of contacts */</span></div><div class="line"><a name="l00671"></a><span class="lineno">  671</span>&#160;      <a class="code" href="../../d8/d8c/res__pjsip_8h.html#afa522937191ad0d45711173590521d47">ast_sip_report_failed_acl</a>(<a class="code" href="../../d8/d8a/structast__sip__contact.html#a3960205b2a4e7e012dc9f0eae1855f01">endpoint</a>, rdata, <span class="stringliteral">&quot;registrar_attempt_exceeds_maximum_configured_contacts&quot;</span>);</div><div class="line"><a name="l00672"></a><span class="lineno">  672</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Registration attempt from endpoint &#39;%s&#39; (%s:%d) to AOR &#39;%s&#39; will exceed max contacts of %u\n&quot;</span>,</div><div class="line"><a name="l00673"></a><span class="lineno">  673</span>&#160;            <a class="code" href="../../d8/d25/sorcery_8h.html#a97706283a06cbb44e4f0f9620dd5cf07">ast_sorcery_object_get_id</a>(<a class="code" href="../../d8/d8a/structast__sip__contact.html#a3960205b2a4e7e012dc9f0eae1855f01">endpoint</a>), rdata-&gt;pkt_info.src_name, rdata-&gt;pkt_info.src_port,</div><div class="line"><a name="l00674"></a><span class="lineno">  674</span>&#160;            aor_name, <a class="code" href="../../d8/d8a/structast__sip__contact.html#a7d6a7c1f176fb54d59dd27ea307f44e6">aor</a>-&gt;max_contacts);</div><div class="line"><a name="l00675"></a><span class="lineno">  675</span>&#160;      response-&gt;code = 403;</div><div class="line"><a name="l00676"></a><span class="lineno">  676</span>&#160;      pjsip_endpt_release_pool(<a class="code" href="../../d8/d8c/res__pjsip_8h.html#a785afb501e315c8a97ad476fb6a8be1d">ast_sip_get_pjsip_endpoint</a>(), details.pool);</div><div class="line"><a name="l00677"></a><span class="lineno">  677</span>&#160;      <a class="code" href="../../d5/da5/astobj2_8h.html#a6321ee982370c55ab3c24c72c562cbdd">ao2_cleanup</a>(existing_contacts);</div><div class="line"><a name="l00678"></a><span class="lineno">  678</span>&#160;      <span class="keywordflow">return</span>;</div><div class="line"><a name="l00679"></a><span class="lineno">  679</span>&#160;   }</div><div class="line"><a name="l00680"></a><span class="lineno">  680</span>&#160;</div><div class="line"><a name="l00681"></a><span class="lineno">  681</span>&#160;   user_agent_hdr = pjsip_msg_find_hdr_by_name(rdata-&gt;msg_info.msg, &amp;USER_AGENT, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div><div class="line"><a name="l00682"></a><span class="lineno">  682</span>&#160;   <span class="keywordflow">if</span> (user_agent_hdr) {</div><div class="line"><a name="l00683"></a><span class="lineno">  683</span>&#160;      alloc_size = pj_strlen(&amp;user_agent_hdr-&gt;hvalue) + 1;</div><div class="line"><a name="l00684"></a><span class="lineno">  684</span>&#160;      user_agent = <a class="code" href="../../d8/d8a/astmm_8h.html#a249282ecc7ba5a1a49fa75e9a33d1717">ast_alloca</a>(alloc_size);</div><div class="line"><a name="l00685"></a><span class="lineno">  685</span>&#160;      <a class="code" href="../../d8/d8c/res__pjsip_8h.html#a7da3e1f7ee3fcb77f29d41a76a7528fe">ast_copy_pj_str</a>(user_agent, &amp;user_agent_hdr-&gt;hvalue, alloc_size);</div><div class="line"><a name="l00686"></a><span class="lineno">  686</span>&#160;   }</div><div class="line"><a name="l00687"></a><span class="lineno">  687</span>&#160;</div><div class="line"><a name="l00688"></a><span class="lineno">  688</span>&#160;   <span class="comment">/* Find the first Via header */</span></div><div class="line"><a name="l00689"></a><span class="lineno">  689</span>&#160;   via_hdr = via_hdr_last = (pjsip_via_hdr*) pjsip_msg_find_hdr(rdata-&gt;msg_info.msg, PJSIP_H_VIA, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div><div class="line"><a name="l00690"></a><span class="lineno">  690</span>&#160;   <span class="keywordflow">if</span> (via_hdr) {</div><div class="line"><a name="l00691"></a><span class="lineno">  691</span>&#160;      <span class="comment">/* Find the last Via header */</span></div><div class="line"><a name="l00692"></a><span class="lineno">  692</span>&#160;      <span class="keywordflow">while</span> ( (via_hdr = (pjsip_via_hdr*) pjsip_msg_find_hdr(rdata-&gt;msg_info.msg,</div><div class="line"><a name="l00693"></a><span class="lineno">  693</span>&#160;            PJSIP_H_VIA, via_hdr-&gt;next)) != <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {</div><div class="line"><a name="l00694"></a><span class="lineno">  694</span>&#160;         via_hdr_last = via_hdr;</div><div class="line"><a name="l00695"></a><span class="lineno">  695</span>&#160;      }</div><div class="line"><a name="l00696"></a><span class="lineno">  696</span>&#160;      alloc_size = pj_strlen(&amp;via_hdr_last-&gt;sent_by.host) + 1;</div><div class="line"><a name="l00697"></a><span class="lineno">  697</span>&#160;      via_addr = <a class="code" href="../../d8/d8a/astmm_8h.html#a249282ecc7ba5a1a49fa75e9a33d1717">ast_alloca</a>(alloc_size);</div><div class="line"><a name="l00698"></a><span class="lineno">  698</span>&#160;      <a class="code" href="../../d8/d8c/res__pjsip_8h.html#a7da3e1f7ee3fcb77f29d41a76a7528fe">ast_copy_pj_str</a>(via_addr, &amp;via_hdr_last-&gt;sent_by.host, alloc_size);</div><div class="line"><a name="l00699"></a><span class="lineno">  699</span>&#160;      via_port=via_hdr_last-&gt;sent_by.port;</div><div class="line"><a name="l00700"></a><span class="lineno">  700</span>&#160;   }</div><div class="line"><a name="l00701"></a><span class="lineno">  701</span>&#160;</div><div class="line"><a name="l00702"></a><span class="lineno">  702</span>&#160;   call_id_hdr = (pjsip_cid_hdr*) pjsip_msg_find_hdr(rdata-&gt;msg_info.msg, PJSIP_H_CALL_ID, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div><div class="line"><a name="l00703"></a><span class="lineno">  703</span>&#160;   <span class="keywordflow">if</span> (call_id_hdr) {</div><div class="line"><a name="l00704"></a><span class="lineno">  704</span>&#160;      alloc_size = pj_strlen(&amp;call_id_hdr-&gt;id) + 1;</div><div class="line"><a name="l00705"></a><span class="lineno">  705</span>&#160;      call_id = <a class="code" href="../../d8/d8a/astmm_8h.html#a249282ecc7ba5a1a49fa75e9a33d1717">ast_alloca</a>(alloc_size);</div><div class="line"><a name="l00706"></a><span class="lineno">  706</span>&#160;      <a class="code" href="../../d8/d8c/res__pjsip_8h.html#a7da3e1f7ee3fcb77f29d41a76a7528fe">ast_copy_pj_str</a>(call_id, &amp;call_id_hdr-&gt;id, alloc_size);</div><div class="line"><a name="l00707"></a><span class="lineno">  707</span>&#160;   }</div><div class="line"><a name="l00708"></a><span class="lineno">  708</span>&#160;</div><div class="line"><a name="l00709"></a><span class="lineno">  709</span>&#160;   <span class="comment">/* Iterate each provided Contact header and add, update, or delete */</span></div><div class="line"><a name="l00710"></a><span class="lineno">  710</span>&#160;   <span class="keywordflow">for</span> (; (contact_hdr = (pjsip_contact_hdr *) pjsip_msg_find_hdr(rdata-&gt;msg_info.msg, PJSIP_H_CONTACT, contact_hdr-&gt;next)); pj_pool_reset(details.pool)) {</div><div class="line"><a name="l00711"></a><span class="lineno">  711</span>&#160;      <span class="keywordtype">int</span> expiration;</div><div class="line"><a name="l00712"></a><span class="lineno">  712</span>&#160;      <span class="keywordtype">char</span> contact_uri[<a class="code" href="../../d3/db0/res__pjsip__registrar_8c.html#a5712e22b675f8412b1a2e49acee9d5ff">pjsip_max_url_size</a>];</div><div class="line"><a name="l00713"></a><span class="lineno">  713</span>&#160;      <a class="code" href="../../d5/d60/utils_8h.html#a1604b4d72144dd3d9f7da668e90337e9">RAII_VAR</a>(<span class="keyword">struct</span> <a class="code" href="../../d8/d8a/structast__sip__contact.html">ast_sip_contact</a> *, <a class="code" href="../../d9/d03/structcontact.html">contact</a>, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../d5/da5/astobj2_8h.html#a6321ee982370c55ab3c24c72c562cbdd">ao2_cleanup</a>);</div><div class="line"><a name="l00714"></a><span class="lineno">  714</span>&#160;</div><div class="line"><a name="l00715"></a><span class="lineno">  715</span>&#160;      <span class="keywordflow">if</span> (contact_hdr-&gt;star) {</div><div class="line"><a name="l00716"></a><span class="lineno">  716</span>&#160;         <span class="comment">/* A star means to unregister everything, so do so for the possible contacts */</span></div><div class="line"><a name="l00717"></a><span class="lineno">  717</span>&#160;         <a class="code" href="../../d5/da5/astobj2_8h.html#a47857055118a703ae87ea5ebaf4842ed">ao2_callback</a>(contacts, <a class="code" href="../../d5/da5/astobj2_8h.html#ad9d009e87e737af900825b36db55a35ca5fc59b193d86a0a8ddfe866304be829d">OBJ_NODATA</a> | <a class="code" href="../../d5/da5/astobj2_8h.html#ad9d009e87e737af900825b36db55a35ca71f42ec6460e60eb6e10956c53329e45">OBJ_UNLINK</a> | <a class="code" href="../../d5/da5/astobj2_8h.html#ad9d009e87e737af900825b36db55a35ca614744a4d36b3189d4ab5b02c8645d47">OBJ_MULTIPLE</a>,</div><div class="line"><a name="l00718"></a><span class="lineno">  718</span>&#160;            <a class="code" href="../../d3/db0/res__pjsip__registrar_8c.html#af0d1d79e501090634be170620bae20cf">registrar_delete_contact</a>, (<span class="keywordtype">void</span> *)aor_name);</div><div class="line"><a name="l00719"></a><span class="lineno">  719</span>&#160;         <span class="comment">/* If we are keeping track of existing contacts for removal then, well, there is</span></div><div class="line"><a name="l00720"></a><span class="lineno">  720</span>&#160;<span class="comment">          * absolutely nothing left so no need to try to remove any.</span></div><div class="line"><a name="l00721"></a><span class="lineno">  721</span>&#160;<span class="comment">          */</span></div><div class="line"><a name="l00722"></a><span class="lineno">  722</span>&#160;         <span class="keywordflow">if</span> (existing_contacts) {</div><div class="line"><a name="l00723"></a><span class="lineno">  723</span>&#160;            <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(existing_contacts, -1);</div><div class="line"><a name="l00724"></a><span class="lineno">  724</span>&#160;            existing_contacts = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l00725"></a><span class="lineno">  725</span>&#160;         }</div><div class="line"><a name="l00726"></a><span class="lineno">  726</span>&#160;         <span class="keywordflow">break</span>;</div><div class="line"><a name="l00727"></a><span class="lineno">  727</span>&#160;      }</div><div class="line"><a name="l00728"></a><span class="lineno">  728</span>&#160;</div><div class="line"><a name="l00729"></a><span class="lineno">  729</span>&#160;      <span class="keywordflow">if</span> (!PJSIP_URI_SCHEME_IS_SIP(contact_hdr-&gt;uri) &amp;&amp; !PJSIP_URI_SCHEME_IS_SIPS(contact_hdr-&gt;uri)) {</div><div class="line"><a name="l00730"></a><span class="lineno">  730</span>&#160;         <span class="comment">/* This registrar only currently supports sip: and sips: URI schemes */</span></div><div class="line"><a name="l00731"></a><span class="lineno">  731</span>&#160;         <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00732"></a><span class="lineno">  732</span>&#160;      }</div><div class="line"><a name="l00733"></a><span class="lineno">  733</span>&#160;</div><div class="line"><a name="l00734"></a><span class="lineno">  734</span>&#160;      expiration = <a class="code" href="../../d3/db0/res__pjsip__registrar_8c.html#a89a4d689c6439721eeb087591f4a97a3">registrar_get_expiration</a>(<a class="code" href="../../d8/d8a/structast__sip__contact.html#a7d6a7c1f176fb54d59dd27ea307f44e6">aor</a>, contact_hdr, rdata);</div><div class="line"><a name="l00735"></a><span class="lineno">  735</span>&#160;      details.uri = pjsip_uri_get_uri(contact_hdr-&gt;uri);</div><div class="line"><a name="l00736"></a><span class="lineno">  736</span>&#160;      pjsip_uri_print(PJSIP_URI_IN_CONTACT_HDR, details.uri, contact_uri, <span class="keyword">sizeof</span>(contact_uri));</div><div class="line"><a name="l00737"></a><span class="lineno">  737</span>&#160;</div><div class="line"><a name="l00738"></a><span class="lineno">  738</span>&#160;      <a class="code" href="../../d9/d03/structcontact.html">contact</a> = <a class="code" href="../../d5/da5/astobj2_8h.html#a47857055118a703ae87ea5ebaf4842ed">ao2_callback</a>(contacts, <a class="code" href="../../d5/da5/astobj2_8h.html#ad9d009e87e737af900825b36db55a35ca71f42ec6460e60eb6e10956c53329e45">OBJ_UNLINK</a>, <a class="code" href="../../d3/db0/res__pjsip__registrar_8c.html#a600472167faf6e00d346580877861570">registrar_find_contact</a>, &amp;details);</div><div class="line"><a name="l00739"></a><span class="lineno">  739</span>&#160;</div><div class="line"><a name="l00740"></a><span class="lineno">  740</span>&#160;      <span class="comment">/* If a contact was returned and we need to keep track of existing contacts then it</span></div><div class="line"><a name="l00741"></a><span class="lineno">  741</span>&#160;<span class="comment">       * should be removed.</span></div><div class="line"><a name="l00742"></a><span class="lineno">  742</span>&#160;<span class="comment">       */</span></div><div class="line"><a name="l00743"></a><span class="lineno">  743</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="../../d9/d03/structcontact.html">contact</a> &amp;&amp; existing_contacts) {</div><div class="line"><a name="l00744"></a><span class="lineno">  744</span>&#160;         <a class="code" href="../../d5/da5/astobj2_8h.html#a64f51be4bee35c38dbe59b0a788b5ce8">ao2_unlink</a>(existing_contacts, <a class="code" href="../../d9/d03/structcontact.html">contact</a>);</div><div class="line"><a name="l00745"></a><span class="lineno">  745</span>&#160;      }</div><div class="line"><a name="l00746"></a><span class="lineno">  746</span>&#160;</div><div class="line"><a name="l00747"></a><span class="lineno">  747</span>&#160;      <span class="keywordflow">if</span> (!<a class="code" href="../../d9/d03/structcontact.html">contact</a>) {</div><div class="line"><a name="l00748"></a><span class="lineno">  748</span>&#160;         <span class="keywordtype">int</span> <a class="code" href="../../d8/d8a/structast__sip__contact.html#a08e0b4a94cab7d431f1717d53d619447">prune_on_boot</a>;</div><div class="line"><a name="l00749"></a><span class="lineno">  749</span>&#160;</div><div class="line"><a name="l00750"></a><span class="lineno">  750</span>&#160;         <span class="comment">/* If they are actually trying to delete a contact that does not exist... be forgiving */</span></div><div class="line"><a name="l00751"></a><span class="lineno">  751</span>&#160;         <span class="keywordflow">if</span> (!expiration) {</div><div class="line"><a name="l00752"></a><span class="lineno">  752</span>&#160;            <a class="code" href="../../d1/d8c/logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(3, <span class="stringliteral">&quot;Attempted to remove non-existent contact &#39;%s&#39; from AOR &#39;%s&#39; by request\n&quot;</span>,</div><div class="line"><a name="l00753"></a><span class="lineno">  753</span>&#160;               contact_uri, aor_name);</div><div class="line"><a name="l00754"></a><span class="lineno">  754</span>&#160;            <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00755"></a><span class="lineno">  755</span>&#160;         }</div><div class="line"><a name="l00756"></a><span class="lineno">  756</span>&#160;</div><div class="line"><a name="l00757"></a><span class="lineno">  757</span>&#160;         prune_on_boot = !<a class="code" href="../../d7/d5c/res__pjsip__private_8h.html#ac73444851015b8a7be33534e4a7d2878">ast_sip_will_uri_survive_restart</a>(details.uri, <a class="code" href="../../d8/d8a/structast__sip__contact.html#a3960205b2a4e7e012dc9f0eae1855f01">endpoint</a>, rdata);</div><div class="line"><a name="l00758"></a><span class="lineno">  758</span>&#160;</div><div class="line"><a name="l00759"></a><span class="lineno">  759</span>&#160;         <a class="code" href="../../d9/d03/structcontact.html">contact</a> = <a class="code" href="../../d8/d8c/res__pjsip_8h.html#a8af68d3a6a66cb6f1f7b9bd28690251b">ast_sip_location_create_contact</a>(<a class="code" href="../../d8/d8a/structast__sip__contact.html#a7d6a7c1f176fb54d59dd27ea307f44e6">aor</a>, contact_uri,</div><div class="line"><a name="l00760"></a><span class="lineno">  760</span>&#160;            <a class="code" href="../../de/df7/time_8h.html#a97e1bb8fbd7a103212789e87e7ed6073">ast_tvadd</a>(<a class="code" href="../../de/df7/time_8h.html#ad3899efb6f0e348556ef69f5b16aa7f7">ast_tvnow</a>(), <a class="code" href="../../de/df7/time_8h.html#a1d774df72e3dbb623475783e06ce4f61">ast_samp2tv</a>(expiration, 1)),</div><div class="line"><a name="l00761"></a><span class="lineno">  761</span>&#160;            path_str ? <a class="code" href="../../d6/d90/strings_8h.html#a1ef7e2644ca7258070db316fdc0a465b">ast_str_buffer</a>(path_str) : <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>,</div><div class="line"><a name="l00762"></a><span class="lineno">  762</span>&#160;            user_agent, via_addr, via_port, call_id, prune_on_boot, <a class="code" href="../../d8/d8a/structast__sip__contact.html#a3960205b2a4e7e012dc9f0eae1855f01">endpoint</a>);</div><div class="line"><a name="l00763"></a><span class="lineno">  763</span>&#160;         <span class="keywordflow">if</span> (!<a class="code" href="../../d9/d03/structcontact.html">contact</a>) {</div><div class="line"><a name="l00764"></a><span class="lineno">  764</span>&#160;            <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Unable to bind contact &#39;%s&#39; to AOR &#39;%s&#39;\n&quot;</span>,</div><div class="line"><a name="l00765"></a><span class="lineno">  765</span>&#160;               contact_uri, aor_name);</div><div class="line"><a name="l00766"></a><span class="lineno">  766</span>&#160;            <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00767"></a><span class="lineno">  767</span>&#160;         }</div><div class="line"><a name="l00768"></a><span class="lineno">  768</span>&#160;</div><div class="line"><a name="l00769"></a><span class="lineno">  769</span>&#160;         <span class="keywordflow">if</span> (prune_on_boot) {</div><div class="line"><a name="l00770"></a><span class="lineno">  770</span>&#160;            <span class="keywordtype">size_t</span> contact_name_len;</div><div class="line"><a name="l00771"></a><span class="lineno">  771</span>&#160;            <span class="keyword">const</span> <span class="keywordtype">char</span> *contact_name;</div><div class="line"><a name="l00772"></a><span class="lineno">  772</span>&#160;            <span class="keyword">struct </span><a class="code" href="../../d6/d85/structcontact__transport__monitor.html">contact_transport_monitor</a> *<a class="code" href="../../da/dde/chan__phone_8c.html#a4e40373706bcf5cdb9409dac3166d280">monitor</a>;</div><div class="line"><a name="l00773"></a><span class="lineno">  773</span>&#160;</div><div class="line"><a name="l00774"></a><span class="lineno">  774</span>&#160;            <span class="comment">/*</span></div><div class="line"><a name="l00775"></a><span class="lineno">  775</span>&#160;<span class="comment">             * Monitor the transport in case it gets disconnected because</span></div><div class="line"><a name="l00776"></a><span class="lineno">  776</span>&#160;<span class="comment">             * the contact won&#39;t be valid anymore if that happens.</span></div><div class="line"><a name="l00777"></a><span class="lineno">  777</span>&#160;<span class="comment">             */</span></div><div class="line"><a name="l00778"></a><span class="lineno">  778</span>&#160;            contact_name = <a class="code" href="../../d8/d25/sorcery_8h.html#a97706283a06cbb44e4f0f9620dd5cf07">ast_sorcery_object_get_id</a>(<a class="code" href="../../d9/d03/structcontact.html">contact</a>);</div><div class="line"><a name="l00779"></a><span class="lineno">  779</span>&#160;            contact_name_len = strlen(contact_name) + 1;</div><div class="line"><a name="l00780"></a><span class="lineno">  780</span>&#160;            monitor = <a class="code" href="../../d5/da5/astobj2_8h.html#ae0422b60d8e25b6962b2d61ae4ddf724">ao2_alloc</a>(<span class="keyword">sizeof</span>(*monitor) + 1 + strlen(<a class="code" href="../../d6/d85/structcontact__transport__monitor.html#a692428c236d2054b1b889ba0b921ba87">aor_name</a>)</div><div class="line"><a name="l00781"></a><span class="lineno">  781</span>&#160;               + contact_name_len, NULL);</div><div class="line"><a name="l00782"></a><span class="lineno">  782</span>&#160;            <span class="keywordflow">if</span> (monitor) {</div><div class="line"><a name="l00783"></a><span class="lineno">  783</span>&#160;               strcpy(monitor-&gt;<a class="code" href="../../d6/d85/structcontact__transport__monitor.html#a692428c236d2054b1b889ba0b921ba87">aor_name</a>, <a class="code" href="../../d6/d85/structcontact__transport__monitor.html#a692428c236d2054b1b889ba0b921ba87">aor_name</a>);<span class="comment">/* Safe */</span></div><div class="line"><a name="l00784"></a><span class="lineno">  784</span>&#160;               monitor-&gt;<a class="code" href="../../d6/d85/structcontact__transport__monitor.html#ae91e2c22bd603c6a8b982935d32f5ac1">contact_name</a> = monitor-&gt;<a class="code" href="../../d6/d85/structcontact__transport__monitor.html#a692428c236d2054b1b889ba0b921ba87">aor_name</a> + strlen(<a class="code" href="../../d6/d85/structcontact__transport__monitor.html#a692428c236d2054b1b889ba0b921ba87">aor_name</a>) + 1;</div><div class="line"><a name="l00785"></a><span class="lineno">  785</span>&#160;               <a class="code" href="../../d6/d90/strings_8h.html#ac4040268f7b6ed77dfc49c7767626369">ast_copy_string</a>(monitor-&gt;<a class="code" href="../../d6/d85/structcontact__transport__monitor.html#ae91e2c22bd603c6a8b982935d32f5ac1">contact_name</a>, contact_name, contact_name_len);<span class="comment">/* Safe */</span></div><div class="line"><a name="l00786"></a><span class="lineno">  786</span>&#160;</div><div class="line"><a name="l00787"></a><span class="lineno">  787</span>&#160;               <a class="code" href="../../d8/d8c/res__pjsip_8h.html#a5b7ab353d9342e09fcb0520d3da15376">ast_sip_transport_monitor_register_replace</a>(rdata-&gt;tp_info.transport,</div><div class="line"><a name="l00788"></a><span class="lineno">  788</span>&#160;                  <a class="code" href="../../d3/db0/res__pjsip__registrar_8c.html#ac663f457fa4f4fed9b201e8a82a36eb2">register_contact_transport_shutdown_cb</a>, monitor, <a class="code" href="../../d3/db0/res__pjsip__registrar_8c.html#adef72ee13873b9570a83cde69c1d8a37">contact_transport_monitor_matcher</a>);</div><div class="line"><a name="l00789"></a><span class="lineno">  789</span>&#160;               <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(monitor, -1);</div><div class="line"><a name="l00790"></a><span class="lineno">  790</span>&#160;            }</div><div class="line"><a name="l00791"></a><span class="lineno">  791</span>&#160;         }</div><div class="line"><a name="l00792"></a><span class="lineno">  792</span>&#160;</div><div class="line"><a name="l00793"></a><span class="lineno">  793</span>&#160;         <a class="code" href="../../d1/d8c/logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(3, <span class="stringliteral">&quot;Added contact &#39;%s&#39; to AOR &#39;%s&#39; with expiration of %d seconds\n&quot;</span>,</div><div class="line"><a name="l00794"></a><span class="lineno">  794</span>&#160;            contact_uri, <a class="code" href="../../d6/d85/structcontact__transport__monitor.html#a692428c236d2054b1b889ba0b921ba87">aor_name</a>, expiration);</div><div class="line"><a name="l00795"></a><span class="lineno">  795</span>&#160;         <a class="code" href="../../d2/ddc/test_8h.html#a9482d93ea3931853331bdbc745ce7cb4">ast_test_suite_event_notify</a>(<span class="stringliteral">&quot;AOR_CONTACT_ADDED&quot;</span>,</div><div class="line"><a name="l00796"></a><span class="lineno">  796</span>&#160;               <span class="stringliteral">&quot;Contact: %s\r\n&quot;</span></div><div class="line"><a name="l00797"></a><span class="lineno">  797</span>&#160;               <span class="stringliteral">&quot;AOR: %s\r\n&quot;</span></div><div class="line"><a name="l00798"></a><span class="lineno">  798</span>&#160;               <span class="stringliteral">&quot;Expiration: %d\r\n&quot;</span></div><div class="line"><a name="l00799"></a><span class="lineno">  799</span>&#160;               <span class="stringliteral">&quot;UserAgent: %s&quot;</span>,</div><div class="line"><a name="l00800"></a><span class="lineno">  800</span>&#160;               contact_uri,</div><div class="line"><a name="l00801"></a><span class="lineno">  801</span>&#160;               <a class="code" href="../../d6/d85/structcontact__transport__monitor.html#a692428c236d2054b1b889ba0b921ba87">aor_name</a>,</div><div class="line"><a name="l00802"></a><span class="lineno">  802</span>&#160;               expiration,</div><div class="line"><a name="l00803"></a><span class="lineno">  803</span>&#160;               user_agent);</div><div class="line"><a name="l00804"></a><span class="lineno">  804</span>&#160;</div><div class="line"><a name="l00805"></a><span class="lineno">  805</span>&#160;         <a class="code" href="../../d5/da5/astobj2_8h.html#a1ad9f122bcae95a470639402faa3d2ee">ao2_link</a>(contacts, <a class="code" href="../../d9/d03/structcontact.html">contact</a>);</div><div class="line"><a name="l00806"></a><span class="lineno">  806</span>&#160;      } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (expiration) {</div><div class="line"><a name="l00807"></a><span class="lineno">  807</span>&#160;         <span class="keyword">struct </span><a class="code" href="../../d8/d8a/structast__sip__contact.html">ast_sip_contact</a> *contact_update;</div><div class="line"><a name="l00808"></a><span class="lineno">  808</span>&#160;</div><div class="line"><a name="l00809"></a><span class="lineno">  809</span>&#160;         contact_update = <a class="code" href="../../d8/d25/sorcery_8h.html#acb3b46997c4a11e6da3ac21e7a38d96c">ast_sorcery_copy</a>(<a class="code" href="../../d8/d8c/res__pjsip_8h.html#a5572d52daf1a841b0f9308df901448c8">ast_sip_get_sorcery</a>(), <a class="code" href="../../d9/d03/structcontact.html">contact</a>);</div><div class="line"><a name="l00810"></a><span class="lineno">  810</span>&#160;         <span class="keywordflow">if</span> (!contact_update) {</div><div class="line"><a name="l00811"></a><span class="lineno">  811</span>&#160;            <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Failed to update contact &#39;%s&#39; expiration time to %d seconds.\n&quot;</span>,</div><div class="line"><a name="l00812"></a><span class="lineno">  812</span>&#160;               <a class="code" href="../../d9/d03/structcontact.html">contact</a>-&gt;uri, expiration);</div><div class="line"><a name="l00813"></a><span class="lineno">  813</span>&#160;            <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00814"></a><span class="lineno">  814</span>&#160;         }</div><div class="line"><a name="l00815"></a><span class="lineno">  815</span>&#160;</div><div class="line"><a name="l00816"></a><span class="lineno">  816</span>&#160;         contact_update-&gt;<a class="code" href="../../d8/d8a/structast__sip__contact.html#a98ed99328ad621551cdfbee6b83754ae">expiration_time</a> = <a class="code" href="../../de/df7/time_8h.html#a97e1bb8fbd7a103212789e87e7ed6073">ast_tvadd</a>(<a class="code" href="../../de/df7/time_8h.html#ad3899efb6f0e348556ef69f5b16aa7f7">ast_tvnow</a>(), <a class="code" href="../../de/df7/time_8h.html#a1d774df72e3dbb623475783e06ce4f61">ast_samp2tv</a>(expiration, 1));</div><div class="line"><a name="l00817"></a><span class="lineno">  817</span>&#160;         contact_update-&gt;<a class="code" href="../../d8/d8a/structast__sip__contact.html#afbb1dc2791b27417c95a4ff1693fa44b">qualify_frequency</a> = <a class="code" href="../../d8/d8a/structast__sip__contact.html#a7d6a7c1f176fb54d59dd27ea307f44e6">aor</a>-&gt;qualify_frequency;</div><div class="line"><a name="l00818"></a><span class="lineno">  818</span>&#160;         contact_update-&gt;<a class="code" href="../../d8/d8a/structast__sip__contact.html#aceb8cd1d19b9020476de70a5d9d38809">authenticate_qualify</a> = <a class="code" href="../../d8/d8a/structast__sip__contact.html#a7d6a7c1f176fb54d59dd27ea307f44e6">aor</a>-&gt;authenticate_qualify;</div><div class="line"><a name="l00819"></a><span class="lineno">  819</span>&#160;         <span class="keywordflow">if</span> (path_str) {</div><div class="line"><a name="l00820"></a><span class="lineno">  820</span>&#160;            <a class="code" href="../../d1/d0f/stringfields_8h.html#a653461abd6e0d16e4e3326ab90e0501d">ast_string_field_set</a>(contact_update, <a class="code" href="../../d8/d8a/structast__sip__contact.html#aaeae1324cdfad45634df796a27bb37ac">path</a>, <a class="code" href="../../d6/d90/strings_8h.html#a1ef7e2644ca7258070db316fdc0a465b">ast_str_buffer</a>(path_str));</div><div class="line"><a name="l00821"></a><span class="lineno">  821</span>&#160;         }</div><div class="line"><a name="l00822"></a><span class="lineno">  822</span>&#160;         <span class="keywordflow">if</span> (user_agent) {</div><div class="line"><a name="l00823"></a><span class="lineno">  823</span>&#160;            <a class="code" href="../../d1/d0f/stringfields_8h.html#a653461abd6e0d16e4e3326ab90e0501d">ast_string_field_set</a>(contact_update, user_agent, user_agent);</div><div class="line"><a name="l00824"></a><span class="lineno">  824</span>&#160;         }</div><div class="line"><a name="l00825"></a><span class="lineno">  825</span>&#160;         <span class="keywordflow">if</span> (!<a class="code" href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a>(<a class="code" href="../../dd/df2/paths_8h.html#ab9f9346c7a41bdf3720f7b1ed02ec703">ast_config_AST_SYSTEM_NAME</a>)) {</div><div class="line"><a name="l00826"></a><span class="lineno">  826</span>&#160;            <a class="code" href="../../d1/d0f/stringfields_8h.html#a653461abd6e0d16e4e3326ab90e0501d">ast_string_field_set</a>(contact_update, <a class="code" href="../../d8/d8a/structast__sip__contact.html#ad560d6e3eaa972115c360eeae000b25b">reg_server</a>, <a class="code" href="../../dd/df2/paths_8h.html#ab9f9346c7a41bdf3720f7b1ed02ec703">ast_config_AST_SYSTEM_NAME</a>);</div><div class="line"><a name="l00827"></a><span class="lineno">  827</span>&#160;         }</div><div class="line"><a name="l00828"></a><span class="lineno">  828</span>&#160;</div><div class="line"><a name="l00829"></a><span class="lineno">  829</span>&#160;         <span class="keywordflow">if</span> (<a class="code" href="../../d8/d8c/res__pjsip_8h.html#add251e9c14eb0f9791e60dc5c2a9e9b4">ast_sip_location_update_contact</a>(contact_update)) {</div><div class="line"><a name="l00830"></a><span class="lineno">  830</span>&#160;            <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Failed to update contact &#39;%s&#39; expiration time to %d seconds.\n&quot;</span>,</div><div class="line"><a name="l00831"></a><span class="lineno">  831</span>&#160;               <a class="code" href="../../d9/d03/structcontact.html">contact</a>-&gt;uri, expiration);</div><div class="line"><a name="l00832"></a><span class="lineno">  832</span>&#160;            <a class="code" href="../../d3/db0/res__pjsip__registrar_8c.html#a10954918b2b79e996b17b94e5b6c6b62">registrar_contact_delete</a>(<a class="code" href="../../d3/db0/res__pjsip__registrar_8c.html#aa0b6ec2978c63b269ea90927f085c0d8a50feb257eddbe7969373b856facc714d">CONTACT_DELETE_ERROR</a>, rdata-&gt;tp_info.transport,</div><div class="line"><a name="l00833"></a><span class="lineno">  833</span>&#160;               <a class="code" href="../../d9/d03/structcontact.html">contact</a>, aor_name);</div><div class="line"><a name="l00834"></a><span class="lineno">  834</span>&#160;            <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00835"></a><span class="lineno">  835</span>&#160;         }</div><div class="line"><a name="l00836"></a><span class="lineno">  836</span>&#160;         <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(3, <span class="stringliteral">&quot;Refreshed contact &#39;%s&#39; on AOR &#39;%s&#39; with new expiration of %d seconds\n&quot;</span>,</div><div class="line"><a name="l00837"></a><span class="lineno">  837</span>&#160;            contact_uri, aor_name, expiration);</div><div class="line"><a name="l00838"></a><span class="lineno">  838</span>&#160;         <a class="code" href="../../d2/ddc/test_8h.html#a9482d93ea3931853331bdbc745ce7cb4">ast_test_suite_event_notify</a>(<span class="stringliteral">&quot;AOR_CONTACT_REFRESHED&quot;</span>,</div><div class="line"><a name="l00839"></a><span class="lineno">  839</span>&#160;               <span class="stringliteral">&quot;Contact: %s\r\n&quot;</span></div><div class="line"><a name="l00840"></a><span class="lineno">  840</span>&#160;               <span class="stringliteral">&quot;AOR: %s\r\n&quot;</span></div><div class="line"><a name="l00841"></a><span class="lineno">  841</span>&#160;               <span class="stringliteral">&quot;Expiration: %d\r\n&quot;</span></div><div class="line"><a name="l00842"></a><span class="lineno">  842</span>&#160;               <span class="stringliteral">&quot;UserAgent: %s&quot;</span>,</div><div class="line"><a name="l00843"></a><span class="lineno">  843</span>&#160;               contact_uri,</div><div class="line"><a name="l00844"></a><span class="lineno">  844</span>&#160;               aor_name,</div><div class="line"><a name="l00845"></a><span class="lineno">  845</span>&#160;               expiration,</div><div class="line"><a name="l00846"></a><span class="lineno">  846</span>&#160;               contact_update-&gt;<a class="code" href="../../d8/d8a/structast__sip__contact.html#ad6233310a4cab812bbccf98b823aa039">user_agent</a>);</div><div class="line"><a name="l00847"></a><span class="lineno">  847</span>&#160;         <a class="code" href="../../d5/da5/astobj2_8h.html#a1ad9f122bcae95a470639402faa3d2ee">ao2_link</a>(contacts, contact_update);</div><div class="line"><a name="l00848"></a><span class="lineno">  848</span>&#160;         <a class="code" href="../../d5/da5/astobj2_8h.html#a6321ee982370c55ab3c24c72c562cbdd">ao2_cleanup</a>(contact_update);</div><div class="line"><a name="l00849"></a><span class="lineno">  849</span>&#160;      } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00850"></a><span class="lineno">  850</span>&#160;         <a class="code" href="../../d3/db0/res__pjsip__registrar_8c.html#a10954918b2b79e996b17b94e5b6c6b62">registrar_contact_delete</a>(<a class="code" href="../../d3/db0/res__pjsip__registrar_8c.html#aa0b6ec2978c63b269ea90927f085c0d8ab4f9fcf2f1d563fcb73a11daad67911a">CONTACT_DELETE_REQUEST</a>, rdata-&gt;tp_info.transport,</div><div class="line"><a name="l00851"></a><span class="lineno">  851</span>&#160;               <a class="code" href="../../d9/d03/structcontact.html">contact</a>, aor_name);</div><div class="line"><a name="l00852"></a><span class="lineno">  852</span>&#160;      }</div><div class="line"><a name="l00853"></a><span class="lineno">  853</span>&#160;   }</div><div class="line"><a name="l00854"></a><span class="lineno">  854</span>&#160;</div><div class="line"><a name="l00855"></a><span class="lineno">  855</span>&#160;   pjsip_endpt_release_pool(<a class="code" href="../../d8/d8c/res__pjsip_8h.html#a785afb501e315c8a97ad476fb6a8be1d">ast_sip_get_pjsip_endpoint</a>(), details.pool);</div><div class="line"><a name="l00856"></a><span class="lineno">  856</span>&#160;</div><div class="line"><a name="l00857"></a><span class="lineno">  857</span>&#160;   <span class="comment">/*</span></div><div class="line"><a name="l00858"></a><span class="lineno">  858</span>&#160;<span class="comment">    * If the AOR is configured to remove any contacts over max_contacts</span></div><div class="line"><a name="l00859"></a><span class="lineno">  859</span>&#160;<span class="comment">    * that have not been updated/added/deleted as a result of this</span></div><div class="line"><a name="l00860"></a><span class="lineno">  860</span>&#160;<span class="comment">    * REGISTER do so.</span></div><div class="line"><a name="l00861"></a><span class="lineno">  861</span>&#160;<span class="comment">    *</span></div><div class="line"><a name="l00862"></a><span class="lineno">  862</span>&#160;<span class="comment">    * The existing contacts container holds all contacts that were not</span></div><div class="line"><a name="l00863"></a><span class="lineno">  863</span>&#160;<span class="comment">    * involved in this REGISTER.</span></div><div class="line"><a name="l00864"></a><span class="lineno">  864</span>&#160;<span class="comment">    * The contacts container holds the current contacts of the AOR.</span></div><div class="line"><a name="l00865"></a><span class="lineno">  865</span>&#160;<span class="comment">    */</span></div><div class="line"><a name="l00866"></a><span class="lineno">  866</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d8/d8a/structast__sip__contact.html#a7d6a7c1f176fb54d59dd27ea307f44e6">aor</a>-&gt;remove_existing &amp;&amp; existing_contacts) {</div><div class="line"><a name="l00867"></a><span class="lineno">  867</span>&#160;      <span class="comment">/* Total contacts after this registration */</span></div><div class="line"><a name="l00868"></a><span class="lineno">  868</span>&#160;      contact_count = <a class="code" href="../../d5/da5/astobj2_8h.html#a512cc40ce96c63b3d5c78040baa4c9cd">ao2_container_count</a>(existing_contacts) + updated + added;</div><div class="line"><a name="l00869"></a><span class="lineno">  869</span>&#160;      <span class="keywordflow">if</span> (contact_count &gt; <a class="code" href="../../d8/d8a/structast__sip__contact.html#a7d6a7c1f176fb54d59dd27ea307f44e6">aor</a>-&gt;max_contacts) {</div><div class="line"><a name="l00870"></a><span class="lineno">  870</span>&#160;         <span class="comment">/* Remove excess existing contacts that expire the soonest */</span></div><div class="line"><a name="l00871"></a><span class="lineno">  871</span>&#160;         <a class="code" href="../../d3/db0/res__pjsip__registrar_8c.html#a2ecd45d304041048628823fa87f43a90">remove_excess_contacts</a>(existing_contacts, contacts, contact_count - <a class="code" href="../../d8/d8a/structast__sip__contact.html#a7d6a7c1f176fb54d59dd27ea307f44e6">aor</a>-&gt;max_contacts);</div><div class="line"><a name="l00872"></a><span class="lineno">  872</span>&#160;      }</div><div class="line"><a name="l00873"></a><span class="lineno">  873</span>&#160;      <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(existing_contacts, -1);</div><div class="line"><a name="l00874"></a><span class="lineno">  874</span>&#160;   }</div><div class="line"><a name="l00875"></a><span class="lineno">  875</span>&#160;</div><div class="line"><a name="l00876"></a><span class="lineno">  876</span>&#160;   response_contact = <a class="code" href="../../d5/da5/astobj2_8h.html#a47857055118a703ae87ea5ebaf4842ed">ao2_callback</a>(contacts, 0, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div><div class="line"><a name="l00877"></a><span class="lineno">  877</span>&#160;</div><div class="line"><a name="l00878"></a><span class="lineno">  878</span>&#160;   <span class="comment">/* Send a response containing all of the contacts (including static) that are present on this AOR */</span></div><div class="line"><a name="l00879"></a><span class="lineno">  879</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d8/d8c/res__pjsip_8h.html#a2d26a9ba468e7b251897c56032705447">ast_sip_create_response</a>(rdata, 200, response_contact, &amp;tdata) != PJ_SUCCESS) {</div><div class="line"><a name="l00880"></a><span class="lineno">  880</span>&#160;      <a class="code" href="../../d5/da5/astobj2_8h.html#a6321ee982370c55ab3c24c72c562cbdd">ao2_cleanup</a>(response_contact);</div><div class="line"><a name="l00881"></a><span class="lineno">  881</span>&#160;      <a class="code" href="../../d5/da5/astobj2_8h.html#a6321ee982370c55ab3c24c72c562cbdd">ao2_cleanup</a>(contacts);</div><div class="line"><a name="l00882"></a><span class="lineno">  882</span>&#160;      response-&gt;code = 500;</div><div class="line"><a name="l00883"></a><span class="lineno">  883</span>&#160;      <span class="keywordflow">return</span>;</div><div class="line"><a name="l00884"></a><span class="lineno">  884</span>&#160;   }</div><div class="line"><a name="l00885"></a><span class="lineno">  885</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#a6321ee982370c55ab3c24c72c562cbdd">ao2_cleanup</a>(response_contact);</div><div class="line"><a name="l00886"></a><span class="lineno">  886</span>&#160;</div><div class="line"><a name="l00887"></a><span class="lineno">  887</span>&#160;   <span class="comment">/* Add the date header to the response, some UAs use this to set their date and time */</span></div><div class="line"><a name="l00888"></a><span class="lineno">  888</span>&#160;   <a class="code" href="../../d8/d8c/res__pjsip_8h.html#a541e93ff798b3c8ce99a158831338718">ast_sip_add_date_header</a>(tdata);</div><div class="line"><a name="l00889"></a><span class="lineno">  889</span>&#160;</div><div class="line"><a name="l00890"></a><span class="lineno">  890</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#a47857055118a703ae87ea5ebaf4842ed">ao2_callback</a>(contacts, 0, <a class="code" href="../../d3/db0/res__pjsip__registrar_8c.html#a80bf48159f4cdd1d7005f1db04b2b080">registrar_add_contact</a>, tdata);</div><div class="line"><a name="l00891"></a><span class="lineno">  891</span>&#160;</div><div class="line"><a name="l00892"></a><span class="lineno">  892</span>&#160;   <span class="keywordflow">if</span> ((expires_hdr = pjsip_msg_find_hdr(rdata-&gt;msg_info.msg, PJSIP_H_EXPIRES, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>))) {</div><div class="line"><a name="l00893"></a><span class="lineno">  893</span>&#160;      expires_hdr = pjsip_expires_hdr_create(tdata-&gt;pool, <a class="code" href="../../d3/db0/res__pjsip__registrar_8c.html#a89a4d689c6439721eeb087591f4a97a3">registrar_get_expiration</a>(<a class="code" href="../../d8/d8a/structast__sip__contact.html#a7d6a7c1f176fb54d59dd27ea307f44e6">aor</a>, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, rdata));</div><div class="line"><a name="l00894"></a><span class="lineno">  894</span>&#160;      pjsip_msg_add_hdr(tdata-&gt;msg, (pjsip_hdr*)expires_hdr);</div><div class="line"><a name="l00895"></a><span class="lineno">  895</span>&#160;   }</div><div class="line"><a name="l00896"></a><span class="lineno">  896</span>&#160;</div><div class="line"><a name="l00897"></a><span class="lineno">  897</span>&#160;   response-&gt;tdata = tdata;</div><div class="line"><a name="l00898"></a><span class="lineno">  898</span>&#160;}</div><div class="line"><a name="l00899"></a><span class="lineno">  899</span>&#160;</div><div class="line"><a name="l00900"></a><span class="lineno"><a class="line" href="../../d3/db0/res__pjsip__registrar_8c.html#a93c22b96390b4c815ec199eebcbdc07e">  900</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d3/db0/res__pjsip__registrar_8c.html#a93c22b96390b4c815ec199eebcbdc07e">register_aor</a>(pjsip_rx_data *rdata,</div><div class="line"><a name="l00901"></a><span class="lineno">  901</span>&#160;   <span class="keyword">struct</span> <a class="code" href="../../d3/d46/structast__sip__endpoint.html">ast_sip_endpoint</a> *<a class="code" href="../../d8/d8a/structast__sip__contact.html#a3960205b2a4e7e012dc9f0eae1855f01">endpoint</a>,</div><div class="line"><a name="l00902"></a><span class="lineno">  902</span>&#160;   <span class="keyword">struct</span> <a class="code" href="../../d4/d03/structast__sip__aor.html">ast_sip_aor</a> *<a class="code" href="../../d8/d8a/structast__sip__contact.html#a7d6a7c1f176fb54d59dd27ea307f44e6">aor</a>,</div><div class="line"><a name="l00903"></a><span class="lineno">  903</span>&#160;   <span class="keyword">const</span> <span class="keywordtype">char</span> *aor_name)</div><div class="line"><a name="l00904"></a><span class="lineno">  904</span>&#160;{</div><div class="line"><a name="l00905"></a><span class="lineno">  905</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../db/d19/structaor__core__response.html">aor_core_response</a> response = {</div><div class="line"><a name="l00906"></a><span class="lineno">  906</span>&#160;      .<a class="code" href="../../db/d19/structaor__core__response.html#a45a5b7c00a796a23f01673cef1dbe0a9">code</a> = 500,</div><div class="line"><a name="l00907"></a><span class="lineno">  907</span>&#160;   };</div><div class="line"><a name="l00908"></a><span class="lineno">  908</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d2/da9/structao2__container.html">ao2_container</a> *contacts = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l00909"></a><span class="lineno">  909</span>&#160;</div><div class="line"><a name="l00910"></a><span class="lineno">  910</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#aa9fdb5d0a6157a56060d9f7279fe6c49">ao2_lock</a>(aor);</div><div class="line"><a name="l00911"></a><span class="lineno">  911</span>&#160;   contacts = <a class="code" href="../../d8/d8c/res__pjsip_8h.html#a5f4e724ff69a0fdf9f6c471ac888e204">ast_sip_location_retrieve_aor_contacts_nolock</a>(aor);</div><div class="line"><a name="l00912"></a><span class="lineno">  912</span>&#160;   <span class="keywordflow">if</span> (!contacts) {</div><div class="line"><a name="l00913"></a><span class="lineno">  913</span>&#160;      <a class="code" href="../../d5/da5/astobj2_8h.html#a9998bd156b936636a8780385e9a910b2">ao2_unlock</a>(aor);</div><div class="line"><a name="l00914"></a><span class="lineno">  914</span>&#160;      pjsip_endpt_respond_stateless(<a class="code" href="../../d8/d8c/res__pjsip_8h.html#a785afb501e315c8a97ad476fb6a8be1d">ast_sip_get_pjsip_endpoint</a>(),</div><div class="line"><a name="l00915"></a><span class="lineno">  915</span>&#160;         rdata, response.<a class="code" href="../../db/d19/structaor__core__response.html#a45a5b7c00a796a23f01673cef1dbe0a9">code</a>, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div><div class="line"><a name="l00916"></a><span class="lineno">  916</span>&#160;      <span class="keywordflow">return</span> PJ_TRUE;</div><div class="line"><a name="l00917"></a><span class="lineno">  917</span>&#160;   }</div><div class="line"><a name="l00918"></a><span class="lineno">  918</span>&#160;</div><div class="line"><a name="l00919"></a><span class="lineno">  919</span>&#160;   <a class="code" href="../../d3/db0/res__pjsip__registrar_8c.html#a72fcdc0d711444a70be3def7099fcd4b">register_aor_core</a>(rdata, endpoint, aor, aor_name, contacts, &amp;response);</div><div class="line"><a name="l00920"></a><span class="lineno">  920</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#a6321ee982370c55ab3c24c72c562cbdd">ao2_cleanup</a>(contacts);</div><div class="line"><a name="l00921"></a><span class="lineno">  921</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#a9998bd156b936636a8780385e9a910b2">ao2_unlock</a>(aor);</div><div class="line"><a name="l00922"></a><span class="lineno">  922</span>&#160;</div><div class="line"><a name="l00923"></a><span class="lineno">  923</span>&#160;   <span class="comment">/* Now send the REGISTER response to the peer */</span></div><div class="line"><a name="l00924"></a><span class="lineno">  924</span>&#160;   <span class="keywordflow">if</span> (response.<a class="code" href="../../db/d19/structaor__core__response.html#a3753fea80c98c041cd89012ca2599cbd">tdata</a>) {</div><div class="line"><a name="l00925"></a><span class="lineno">  925</span>&#160;      <a class="code" href="../../d8/d8c/res__pjsip_8h.html#ae207f7592aa7a69d0425a77bb8aa494d">ast_sip_send_stateful_response</a>(rdata, response.<a class="code" href="../../db/d19/structaor__core__response.html#a3753fea80c98c041cd89012ca2599cbd">tdata</a>, endpoint);</div><div class="line"><a name="l00926"></a><span class="lineno">  926</span>&#160;   } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00927"></a><span class="lineno">  927</span>&#160;      pjsip_endpt_respond_stateless(<a class="code" href="../../d8/d8c/res__pjsip_8h.html#a785afb501e315c8a97ad476fb6a8be1d">ast_sip_get_pjsip_endpoint</a>(),</div><div class="line"><a name="l00928"></a><span class="lineno">  928</span>&#160;         rdata, response.<a class="code" href="../../db/d19/structaor__core__response.html#a45a5b7c00a796a23f01673cef1dbe0a9">code</a>, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div><div class="line"><a name="l00929"></a><span class="lineno">  929</span>&#160;   }</div><div class="line"><a name="l00930"></a><span class="lineno">  930</span>&#160;   <span class="keywordflow">return</span> PJ_TRUE;</div><div class="line"><a name="l00931"></a><span class="lineno">  931</span>&#160;}</div><div class="line"><a name="l00932"></a><span class="lineno">  932</span>&#160;</div><div class="line"><a name="l00933"></a><span class="lineno"><a class="line" href="../../d3/db0/res__pjsip__registrar_8c.html#a2f0a330bc3afc51021a3b0d66e149f4d">  933</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d3/db0/res__pjsip__registrar_8c.html#a2f0a330bc3afc51021a3b0d66e149f4d">match_aor</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *aor_name, <span class="keyword">const</span> <span class="keywordtype">char</span> *<span class="keywordtype">id</span>)</div><div class="line"><a name="l00934"></a><span class="lineno">  934</span>&#160;{</div><div class="line"><a name="l00935"></a><span class="lineno">  935</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a>(aor_name)) {</div><div class="line"><a name="l00936"></a><span class="lineno">  936</span>&#160;      <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00937"></a><span class="lineno">  937</span>&#160;   }</div><div class="line"><a name="l00938"></a><span class="lineno">  938</span>&#160;</div><div class="line"><a name="l00939"></a><span class="lineno">  939</span>&#160;   <span class="keywordflow">if</span> (!strcmp(aor_name, <span class="keywordtype">id</span>)) {</div><div class="line"><a name="l00940"></a><span class="lineno">  940</span>&#160;      <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(3, <span class="stringliteral">&quot;Matched id &#39;%s&#39; to aor &#39;%s&#39;\n&quot;</span>, <span class="keywordtype">id</span>, aor_name);</div><div class="line"><a name="l00941"></a><span class="lineno">  941</span>&#160;      <span class="keywordflow">return</span> 1;</div><div class="line"><a name="l00942"></a><span class="lineno">  942</span>&#160;   }</div><div class="line"><a name="l00943"></a><span class="lineno">  943</span>&#160;</div><div class="line"><a name="l00944"></a><span class="lineno">  944</span>&#160;   <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00945"></a><span class="lineno">  945</span>&#160;}</div><div class="line"><a name="l00946"></a><span class="lineno">  946</span>&#160;</div><div class="line"><a name="l00947"></a><span class="lineno"><a class="line" href="../../d3/db0/res__pjsip__registrar_8c.html#a813499cc6957f3337adade576d82e5b0">  947</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">char</span> *<a class="code" href="../../d3/db0/res__pjsip__registrar_8c.html#a813499cc6957f3337adade576d82e5b0">find_aor_name</a>(<span class="keyword">const</span> pj_str_t *pj_username, <span class="keyword">const</span> pj_str_t *pj_domain, <span class="keyword">const</span> <span class="keywordtype">char</span> *aors)</div><div class="line"><a name="l00948"></a><span class="lineno">  948</span>&#160;{</div><div class="line"><a name="l00949"></a><span class="lineno">  949</span>&#160;   <span class="keywordtype">char</span> *configured_aors;</div><div class="line"><a name="l00950"></a><span class="lineno">  950</span>&#160;   <span class="keywordtype">char</span> *aors_buf;</div><div class="line"><a name="l00951"></a><span class="lineno">  951</span>&#160;   <span class="keywordtype">char</span> *aor_name;</div><div class="line"><a name="l00952"></a><span class="lineno">  952</span>&#160;   <span class="keywordtype">char</span> *id_domain;</div><div class="line"><a name="l00953"></a><span class="lineno">  953</span>&#160;   <span class="keywordtype">char</span> *username, *<a class="code" href="../../dd/dac/structdomain.html">domain</a>;</div><div class="line"><a name="l00954"></a><span class="lineno">  954</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../dc/d19/structast__sip__domain__alias.html">ast_sip_domain_alias</a> *alias;</div><div class="line"><a name="l00955"></a><span class="lineno">  955</span>&#160;</div><div class="line"><a name="l00956"></a><span class="lineno">  956</span>&#160;   <span class="comment">/* Turn these into C style strings for convenience */</span></div><div class="line"><a name="l00957"></a><span class="lineno">  957</span>&#160;   username = <a class="code" href="../../d8/d8a/astmm_8h.html#a249282ecc7ba5a1a49fa75e9a33d1717">ast_alloca</a>(pj_strlen(pj_username) + 1);</div><div class="line"><a name="l00958"></a><span class="lineno">  958</span>&#160;   <a class="code" href="../../d8/d8c/res__pjsip_8h.html#a7da3e1f7ee3fcb77f29d41a76a7528fe">ast_copy_pj_str</a>(username, pj_username, pj_strlen(pj_username) + 1);</div><div class="line"><a name="l00959"></a><span class="lineno">  959</span>&#160;   domain = <a class="code" href="../../d8/d8a/astmm_8h.html#a249282ecc7ba5a1a49fa75e9a33d1717">ast_alloca</a>(pj_strlen(pj_domain) + 1);</div><div class="line"><a name="l00960"></a><span class="lineno">  960</span>&#160;   <a class="code" href="../../d8/d8c/res__pjsip_8h.html#a7da3e1f7ee3fcb77f29d41a76a7528fe">ast_copy_pj_str</a>(domain, pj_domain, pj_strlen(pj_domain) + 1);</div><div class="line"><a name="l00961"></a><span class="lineno">  961</span>&#160;</div><div class="line"><a name="l00962"></a><span class="lineno">  962</span>&#160;   id_domain = <a class="code" href="../../d8/d8a/astmm_8h.html#a249282ecc7ba5a1a49fa75e9a33d1717">ast_alloca</a>(strlen(username) + strlen(domain) + 2);</div><div class="line"><a name="l00963"></a><span class="lineno">  963</span>&#160;   sprintf(id_domain, <span class="stringliteral">&quot;%s@%s&quot;</span>, username, domain);</div><div class="line"><a name="l00964"></a><span class="lineno">  964</span>&#160;</div><div class="line"><a name="l00965"></a><span class="lineno">  965</span>&#160;   aors_buf = <a class="code" href="../../d8/d8a/astmm_8h.html#ab5f0750cc80ba337fdcbddea2d3a1ee6">ast_strdupa</a>(aors);</div><div class="line"><a name="l00966"></a><span class="lineno">  966</span>&#160;</div><div class="line"><a name="l00967"></a><span class="lineno">  967</span>&#160;   <span class="comment">/* Look for exact match on username@domain */</span></div><div class="line"><a name="l00968"></a><span class="lineno">  968</span>&#160;   configured_aors = aors_buf;</div><div class="line"><a name="l00969"></a><span class="lineno">  969</span>&#160;   <span class="keywordflow">while</span> ((aor_name = <a class="code" href="../../d6/d90/strings_8h.html#ac92713b8d07a45720b2664be70810e55">ast_strip</a>(<a class="code" href="../../de/da3/include_2asterisk_2compat_8h.html#a40eca58273c74a20a17f137d18ba826c">strsep</a>(&amp;configured_aors, <span class="stringliteral">&quot;,&quot;</span>)))) {</div><div class="line"><a name="l00970"></a><span class="lineno">  970</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="../../d3/db0/res__pjsip__registrar_8c.html#a2f0a330bc3afc51021a3b0d66e149f4d">match_aor</a>(aor_name, id_domain)) {</div><div class="line"><a name="l00971"></a><span class="lineno">  971</span>&#160;         <span class="keywordflow">return</span> <a class="code" href="../../d8/d8a/astmm_8h.html#ab263849d03fb892847be4986db759737">ast_strdup</a>(aor_name);</div><div class="line"><a name="l00972"></a><span class="lineno">  972</span>&#160;      }</div><div class="line"><a name="l00973"></a><span class="lineno">  973</span>&#160;   }</div><div class="line"><a name="l00974"></a><span class="lineno">  974</span>&#160;</div><div class="line"><a name="l00975"></a><span class="lineno">  975</span>&#160;   <span class="comment">/* If there&#39;s a domain alias, look for exact match on username@domain_alias */</span></div><div class="line"><a name="l00976"></a><span class="lineno">  976</span>&#160;   alias = <a class="code" href="../../d8/d25/sorcery_8h.html#a100106a82d72aa59a66513ef3ad161c8">ast_sorcery_retrieve_by_id</a>(<a class="code" href="../../d8/d8c/res__pjsip_8h.html#a5572d52daf1a841b0f9308df901448c8">ast_sip_get_sorcery</a>(), <span class="stringliteral">&quot;domain_alias&quot;</span>, domain);</div><div class="line"><a name="l00977"></a><span class="lineno">  977</span>&#160;   <span class="keywordflow">if</span> (alias) {</div><div class="line"><a name="l00978"></a><span class="lineno">  978</span>&#160;      <span class="keywordtype">char</span> *id_domain_alias = <a class="code" href="../../d8/d8a/astmm_8h.html#a249282ecc7ba5a1a49fa75e9a33d1717">ast_alloca</a>(strlen(username) + strlen(alias-&gt;<a class="code" href="../../dc/d19/structast__sip__domain__alias.html#a3ec6db86c2d43dc986af427cdeb7bf0e">domain</a>) + 2);</div><div class="line"><a name="l00979"></a><span class="lineno">  979</span>&#160;</div><div class="line"><a name="l00980"></a><span class="lineno">  980</span>&#160;      sprintf(id_domain_alias, <span class="stringliteral">&quot;%s@%s&quot;</span>, username, alias-&gt;<a class="code" href="../../dc/d19/structast__sip__domain__alias.html#a3ec6db86c2d43dc986af427cdeb7bf0e">domain</a>);</div><div class="line"><a name="l00981"></a><span class="lineno">  981</span>&#160;      <a class="code" href="../../d5/da5/astobj2_8h.html#a6321ee982370c55ab3c24c72c562cbdd">ao2_cleanup</a>(alias);</div><div class="line"><a name="l00982"></a><span class="lineno">  982</span>&#160;</div><div class="line"><a name="l00983"></a><span class="lineno">  983</span>&#160;      configured_aors = strcpy(aors_buf, aors);<span class="comment">/* Safe */</span></div><div class="line"><a name="l00984"></a><span class="lineno">  984</span>&#160;      <span class="keywordflow">while</span> ((aor_name = <a class="code" href="../../d6/d90/strings_8h.html#ac92713b8d07a45720b2664be70810e55">ast_strip</a>(<a class="code" href="../../de/da3/include_2asterisk_2compat_8h.html#a40eca58273c74a20a17f137d18ba826c">strsep</a>(&amp;configured_aors, <span class="stringliteral">&quot;,&quot;</span>)))) {</div><div class="line"><a name="l00985"></a><span class="lineno">  985</span>&#160;         <span class="keywordflow">if</span> (<a class="code" href="../../d3/db0/res__pjsip__registrar_8c.html#a2f0a330bc3afc51021a3b0d66e149f4d">match_aor</a>(aor_name, id_domain_alias)) {</div><div class="line"><a name="l00986"></a><span class="lineno">  986</span>&#160;            <span class="keywordflow">return</span> <a class="code" href="../../d8/d8a/astmm_8h.html#ab263849d03fb892847be4986db759737">ast_strdup</a>(aor_name);</div><div class="line"><a name="l00987"></a><span class="lineno">  987</span>&#160;         }</div><div class="line"><a name="l00988"></a><span class="lineno">  988</span>&#160;      }</div><div class="line"><a name="l00989"></a><span class="lineno">  989</span>&#160;   }</div><div class="line"><a name="l00990"></a><span class="lineno">  990</span>&#160;</div><div class="line"><a name="l00991"></a><span class="lineno">  991</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a>(username)) {</div><div class="line"><a name="l00992"></a><span class="lineno">  992</span>&#160;      <span class="comment">/* No username, no match */</span></div><div class="line"><a name="l00993"></a><span class="lineno">  993</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l00994"></a><span class="lineno">  994</span>&#160;   }</div><div class="line"><a name="l00995"></a><span class="lineno">  995</span>&#160;</div><div class="line"><a name="l00996"></a><span class="lineno">  996</span>&#160;   <span class="comment">/* Look for exact match on username only */</span></div><div class="line"><a name="l00997"></a><span class="lineno">  997</span>&#160;   configured_aors = strcpy(aors_buf, aors);<span class="comment">/* Safe */</span></div><div class="line"><a name="l00998"></a><span class="lineno">  998</span>&#160;   <span class="keywordflow">while</span> ((aor_name = <a class="code" href="../../d6/d90/strings_8h.html#ac92713b8d07a45720b2664be70810e55">ast_strip</a>(<a class="code" href="../../de/da3/include_2asterisk_2compat_8h.html#a40eca58273c74a20a17f137d18ba826c">strsep</a>(&amp;configured_aors, <span class="stringliteral">&quot;,&quot;</span>)))) {</div><div class="line"><a name="l00999"></a><span class="lineno">  999</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="../../d3/db0/res__pjsip__registrar_8c.html#a2f0a330bc3afc51021a3b0d66e149f4d">match_aor</a>(aor_name, username)) {</div><div class="line"><a name="l01000"></a><span class="lineno"> 1000</span>&#160;         <span class="keywordflow">return</span> <a class="code" href="../../d8/d8a/astmm_8h.html#ab263849d03fb892847be4986db759737">ast_strdup</a>(aor_name);</div><div class="line"><a name="l01001"></a><span class="lineno"> 1001</span>&#160;      }</div><div class="line"><a name="l01002"></a><span class="lineno"> 1002</span>&#160;   }</div><div class="line"><a name="l01003"></a><span class="lineno"> 1003</span>&#160;</div><div class="line"><a name="l01004"></a><span class="lineno"> 1004</span>&#160;   <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l01005"></a><span class="lineno"> 1005</span>&#160;}</div><div class="line"><a name="l01006"></a><span class="lineno"> 1006</span>&#160;</div><div class="line"><a name="l01007"></a><span class="lineno"><a class="line" href="../../d3/db0/res__pjsip__registrar_8c.html#a1c1341bf634e6df2c66669574ffd4981"> 1007</a></span>&#160;<span class="keyword">static</span> <span class="keyword">struct </span><a class="code" href="../../d4/d03/structast__sip__aor.html">ast_sip_aor</a> *<a class="code" href="../../d3/db0/res__pjsip__registrar_8c.html#a1c1341bf634e6df2c66669574ffd4981">find_registrar_aor</a>(<span class="keyword">struct</span> pjsip_rx_data *rdata, <span class="keyword">struct</span> <a class="code" href="../../d3/d46/structast__sip__endpoint.html">ast_sip_endpoint</a> *endpoint)</div><div class="line"><a name="l01008"></a><span class="lineno"> 1008</span>&#160;{</div><div class="line"><a name="l01009"></a><span class="lineno"> 1009</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d4/d03/structast__sip__aor.html">ast_sip_aor</a> *aor = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l01010"></a><span class="lineno"> 1010</span>&#160;   <span class="keywordtype">char</span> *aor_name = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l01011"></a><span class="lineno"> 1011</span>&#160;   <span class="keywordtype">int</span> i;</div><div class="line"><a name="l01012"></a><span class="lineno"> 1012</span>&#160;</div><div class="line"><a name="l01013"></a><span class="lineno"> 1013</span>&#160;   <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="../../d6/d68/vector_8h.html#a20b08af81cc9452fb721c9a698f81bdf">AST_VECTOR_SIZE</a>(&amp;endpoint-&gt;<a class="code" href="../../d3/d46/structast__sip__endpoint.html#a681d685c47bd9fedb5527fabfd0454c1">ident_method_order</a>); ++i) {</div><div class="line"><a name="l01014"></a><span class="lineno"> 1014</span>&#160;      pj_str_t username;</div><div class="line"><a name="l01015"></a><span class="lineno"> 1015</span>&#160;      pjsip_sip_uri *<a class="code" href="../../d6/dcf/structregistrar__contact__details.html#ac43e5728c2093e52e8a06774ab68afe2">uri</a>;</div><div class="line"><a name="l01016"></a><span class="lineno"> 1016</span>&#160;      pjsip_authorization_hdr *<a class="code" href="../../d5/d65/structheader.html">header</a> = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l01017"></a><span class="lineno"> 1017</span>&#160;</div><div class="line"><a name="l01018"></a><span class="lineno"> 1018</span>&#160;      <span class="keywordflow">switch</span> (<a class="code" href="../../d6/d68/vector_8h.html#aef32ac52c3e8a530d16eb92cde22cacd">AST_VECTOR_GET</a>(&amp;endpoint-&gt;<a class="code" href="../../d3/d46/structast__sip__endpoint.html#a681d685c47bd9fedb5527fabfd0454c1">ident_method_order</a>, i)) {</div><div class="line"><a name="l01019"></a><span class="lineno"> 1019</span>&#160;      <span class="keywordflow">case</span> <a class="code" href="../../d8/d8c/res__pjsip_8h.html#a15f77bb3c5ec890ab41662c45a08f764abae64f41eb012cc76b0af79173298345">AST_SIP_ENDPOINT_IDENTIFY_BY_USERNAME</a>:</div><div class="line"><a name="l01020"></a><span class="lineno"> 1020</span>&#160;         uri = pjsip_uri_get_uri(rdata-&gt;msg_info.to-&gt;uri);</div><div class="line"><a name="l01021"></a><span class="lineno"> 1021</span>&#160;</div><div class="line"><a name="l01022"></a><span class="lineno"> 1022</span>&#160;         pj_strassign(&amp;username, &amp;uri-&gt;user);</div><div class="line"><a name="l01023"></a><span class="lineno"> 1023</span>&#160;</div><div class="line"><a name="l01024"></a><span class="lineno"> 1024</span>&#160;         <span class="comment">/*</span></div><div class="line"><a name="l01025"></a><span class="lineno"> 1025</span>&#160;<span class="comment">          * We may want to match without any user options getting</span></div><div class="line"><a name="l01026"></a><span class="lineno"> 1026</span>&#160;<span class="comment">          * in the way.</span></div><div class="line"><a name="l01027"></a><span class="lineno"> 1027</span>&#160;<span class="comment">          *</span></div><div class="line"><a name="l01028"></a><span class="lineno"> 1028</span>&#160;<span class="comment">          * Logic adapted from AST_SIP_USER_OPTIONS_TRUNCATE_CHECK for pj_str_t.</span></div><div class="line"><a name="l01029"></a><span class="lineno"> 1029</span>&#160;<span class="comment">          */</span></div><div class="line"><a name="l01030"></a><span class="lineno"> 1030</span>&#160;         <span class="keywordflow">if</span> (<a class="code" href="../../d8/d8c/res__pjsip_8h.html#aa93f25c991cf8d8abb179bece0f179a6">ast_sip_get_ignore_uri_user_options</a>()) {</div><div class="line"><a name="l01031"></a><span class="lineno"> 1031</span>&#160;            pj_ssize_t semi = pj_strcspn2(&amp;username, <span class="stringliteral">&quot;;&quot;</span>);</div><div class="line"><a name="l01032"></a><span class="lineno"> 1032</span>&#160;            <span class="keywordflow">if</span> (semi &lt; pj_strlen(&amp;username)) {</div><div class="line"><a name="l01033"></a><span class="lineno"> 1033</span>&#160;               username.slen = semi;</div><div class="line"><a name="l01034"></a><span class="lineno"> 1034</span>&#160;            }</div><div class="line"><a name="l01035"></a><span class="lineno"> 1035</span>&#160;         }</div><div class="line"><a name="l01036"></a><span class="lineno"> 1036</span>&#160;</div><div class="line"><a name="l01037"></a><span class="lineno"> 1037</span>&#160;         aor_name = <a class="code" href="../../d3/db0/res__pjsip__registrar_8c.html#a813499cc6957f3337adade576d82e5b0">find_aor_name</a>(&amp;username, &amp;uri-&gt;host, endpoint-&gt;<a class="code" href="../../d3/d46/structast__sip__endpoint.html#a50edbc089f02d537b9a487f1a62c889e">aors</a>);</div><div class="line"><a name="l01038"></a><span class="lineno"> 1038</span>&#160;         <span class="keywordflow">if</span> (aor_name) {</div><div class="line"><a name="l01039"></a><span class="lineno"> 1039</span>&#160;            <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(3, <span class="stringliteral">&quot;Matched aor &#39;%s&#39; by To username\n&quot;</span>, aor_name);</div><div class="line"><a name="l01040"></a><span class="lineno"> 1040</span>&#160;         }</div><div class="line"><a name="l01041"></a><span class="lineno"> 1041</span>&#160;         <span class="keywordflow">break</span>;</div><div class="line"><a name="l01042"></a><span class="lineno"> 1042</span>&#160;      <span class="keywordflow">case</span> <a class="code" href="../../d8/d8c/res__pjsip_8h.html#a15f77bb3c5ec890ab41662c45a08f764ad9cf563e8ed07f62531c5c7e89895839">AST_SIP_ENDPOINT_IDENTIFY_BY_AUTH_USERNAME</a>:</div><div class="line"><a name="l01043"></a><span class="lineno"> 1043</span>&#160;         <span class="keywordflow">while</span> ((header = pjsip_msg_find_hdr(rdata-&gt;msg_info.msg, PJSIP_H_AUTHORIZATION,</div><div class="line"><a name="l01044"></a><span class="lineno"> 1044</span>&#160;            header ? header-&gt;next : <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>))) {</div><div class="line"><a name="l01045"></a><span class="lineno"> 1045</span>&#160;            <span class="keywordflow">if</span> (header &amp;&amp; !pj_stricmp2(&amp;header-&gt;scheme, <span class="stringliteral">&quot;digest&quot;</span>)) {</div><div class="line"><a name="l01046"></a><span class="lineno"> 1046</span>&#160;               aor_name = <a class="code" href="../../d3/db0/res__pjsip__registrar_8c.html#a813499cc6957f3337adade576d82e5b0">find_aor_name</a>(&amp;header-&gt;credential.digest.username,</div><div class="line"><a name="l01047"></a><span class="lineno"> 1047</span>&#160;                  &amp;header-&gt;credential.digest.realm, endpoint-&gt;<a class="code" href="../../d3/d46/structast__sip__endpoint.html#a50edbc089f02d537b9a487f1a62c889e">aors</a>);</div><div class="line"><a name="l01048"></a><span class="lineno"> 1048</span>&#160;               <span class="keywordflow">if</span> (aor_name) {</div><div class="line"><a name="l01049"></a><span class="lineno"> 1049</span>&#160;                  <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(3, <span class="stringliteral">&quot;Matched aor &#39;%s&#39; by Authentication username\n&quot;</span>, aor_name);</div><div class="line"><a name="l01050"></a><span class="lineno"> 1050</span>&#160;                  <span class="keywordflow">break</span>;</div><div class="line"><a name="l01051"></a><span class="lineno"> 1051</span>&#160;               }</div><div class="line"><a name="l01052"></a><span class="lineno"> 1052</span>&#160;            }</div><div class="line"><a name="l01053"></a><span class="lineno"> 1053</span>&#160;         }</div><div class="line"><a name="l01054"></a><span class="lineno"> 1054</span>&#160;         <span class="keywordflow">break</span>;</div><div class="line"><a name="l01055"></a><span class="lineno"> 1055</span>&#160;      <span class="keywordflow">default</span>:</div><div class="line"><a name="l01056"></a><span class="lineno"> 1056</span>&#160;         <span class="keywordflow">continue</span>;</div><div class="line"><a name="l01057"></a><span class="lineno"> 1057</span>&#160;      }</div><div class="line"><a name="l01058"></a><span class="lineno"> 1058</span>&#160;</div><div class="line"><a name="l01059"></a><span class="lineno"> 1059</span>&#160;      <span class="keywordflow">if</span> (aor_name) {</div><div class="line"><a name="l01060"></a><span class="lineno"> 1060</span>&#160;         <span class="keywordflow">break</span>;</div><div class="line"><a name="l01061"></a><span class="lineno"> 1061</span>&#160;      }</div><div class="line"><a name="l01062"></a><span class="lineno"> 1062</span>&#160;   }</div><div class="line"><a name="l01063"></a><span class="lineno"> 1063</span>&#160;</div><div class="line"><a name="l01064"></a><span class="lineno"> 1064</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a>(aor_name) || !(aor = <a class="code" href="../../d8/d8c/res__pjsip_8h.html#a434c2d85dbd10a9453f6d409809330d5">ast_sip_location_retrieve_aor</a>(aor_name))) {</div><div class="line"><a name="l01065"></a><span class="lineno"> 1065</span>&#160;      <span class="comment">/* The provided AOR name was not found (be it within the configuration or sorcery itself) */</span></div><div class="line"><a name="l01066"></a><span class="lineno"> 1066</span>&#160;      pjsip_endpt_respond_stateless(<a class="code" href="../../d8/d8c/res__pjsip_8h.html#a785afb501e315c8a97ad476fb6a8be1d">ast_sip_get_pjsip_endpoint</a>(), rdata, 404, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div><div class="line"><a name="l01067"></a><span class="lineno"> 1067</span>&#160;      <a class="code" href="../../d8/d8c/res__pjsip_8h.html#a24ad1d4596f0644e856ff6e7ec2dd590">ast_sip_report_req_no_support</a>(endpoint, rdata, <span class="stringliteral">&quot;registrar_requested_aor_not_found&quot;</span>);</div><div class="line"><a name="l01068"></a><span class="lineno"> 1068</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;AOR &#39;%s&#39; not found for endpoint &#39;%s&#39; (%s:%d)\n&quot;</span>,</div><div class="line"><a name="l01069"></a><span class="lineno"> 1069</span>&#160;         aor_name ?: <span class="stringliteral">&quot;&quot;</span>, <a class="code" href="../../d8/d25/sorcery_8h.html#a97706283a06cbb44e4f0f9620dd5cf07">ast_sorcery_object_get_id</a>(endpoint),</div><div class="line"><a name="l01070"></a><span class="lineno"> 1070</span>&#160;         rdata-&gt;pkt_info.src_name, rdata-&gt;pkt_info.src_port);</div><div class="line"><a name="l01071"></a><span class="lineno"> 1071</span>&#160;   }</div><div class="line"><a name="l01072"></a><span class="lineno"> 1072</span>&#160;   <a class="code" href="../../d8/d8a/astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(aor_name);</div><div class="line"><a name="l01073"></a><span class="lineno"> 1073</span>&#160;   <span class="keywordflow">return</span> aor;</div><div class="line"><a name="l01074"></a><span class="lineno"> 1074</span>&#160;}</div><div class="line"><a name="l01075"></a><span class="lineno"> 1075</span>&#160;</div><div class="line"><a name="l01076"></a><span class="lineno"><a class="line" href="../../d3/db0/res__pjsip__registrar_8c.html#a88655efef49d2d5933795f840432084f"> 1076</a></span>&#160;<span class="keyword">static</span> pj_bool_t <a class="code" href="../../d3/db0/res__pjsip__registrar_8c.html#a88655efef49d2d5933795f840432084f">registrar_on_rx_request</a>(<span class="keyword">struct</span> pjsip_rx_data *rdata)</div><div class="line"><a name="l01077"></a><span class="lineno"> 1077</span>&#160;{</div><div class="line"><a name="l01078"></a><span class="lineno"> 1078</span>&#160;   <a class="code" href="../../d5/d60/utils_8h.html#a1604b4d72144dd3d9f7da668e90337e9">RAII_VAR</a>(<span class="keyword">struct</span> <a class="code" href="../../d3/d46/structast__sip__endpoint.html">ast_sip_endpoint</a> *, endpoint,</div><div class="line"><a name="l01079"></a><span class="lineno"> 1079</span>&#160;       <a class="code" href="../../d8/d8c/res__pjsip_8h.html#a0dc7590db76dcdc0105abc92072d1b06">ast_pjsip_rdata_get_endpoint</a>(rdata), <a class="code" href="../../d5/da5/astobj2_8h.html#a6321ee982370c55ab3c24c72c562cbdd">ao2_cleanup</a>);</div><div class="line"><a name="l01080"></a><span class="lineno"> 1080</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d4/d03/structast__sip__aor.html">ast_sip_aor</a> *aor;</div><div class="line"><a name="l01081"></a><span class="lineno"> 1081</span>&#160;   <span class="keyword">const</span> <span class="keywordtype">char</span> *aor_name;</div><div class="line"><a name="l01082"></a><span class="lineno"> 1082</span>&#160;</div><div class="line"><a name="l01083"></a><span class="lineno"> 1083</span>&#160;   <span class="keywordflow">if</span> (pjsip_method_cmp(&amp;rdata-&gt;msg_info.msg-&gt;line.req.method, &amp;pjsip_register_method) || !endpoint) {</div><div class="line"><a name="l01084"></a><span class="lineno"> 1084</span>&#160;      <span class="keywordflow">return</span> PJ_FALSE;</div><div class="line"><a name="l01085"></a><span class="lineno"> 1085</span>&#160;   }</div><div class="line"><a name="l01086"></a><span class="lineno"> 1086</span>&#160;</div><div class="line"><a name="l01087"></a><span class="lineno"> 1087</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a>(endpoint-&gt;aors)) {</div><div class="line"><a name="l01088"></a><span class="lineno"> 1088</span>&#160;      <span class="comment">/* Short circuit early if the endpoint has no AORs configured on it, which means no registration possible */</span></div><div class="line"><a name="l01089"></a><span class="lineno"> 1089</span>&#160;      pjsip_endpt_respond_stateless(<a class="code" href="../../d8/d8c/res__pjsip_8h.html#a785afb501e315c8a97ad476fb6a8be1d">ast_sip_get_pjsip_endpoint</a>(), rdata, 403, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div><div class="line"><a name="l01090"></a><span class="lineno"> 1090</span>&#160;      <a class="code" href="../../d8/d8c/res__pjsip_8h.html#afa522937191ad0d45711173590521d47">ast_sip_report_failed_acl</a>(endpoint, rdata, <span class="stringliteral">&quot;registrar_attempt_without_configured_aors&quot;</span>);</div><div class="line"><a name="l01091"></a><span class="lineno"> 1091</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Endpoint &#39;%s&#39; (%s:%d) has no configured AORs\n&quot;</span>, <a class="code" href="../../d8/d25/sorcery_8h.html#a97706283a06cbb44e4f0f9620dd5cf07">ast_sorcery_object_get_id</a>(endpoint),</div><div class="line"><a name="l01092"></a><span class="lineno"> 1092</span>&#160;         rdata-&gt;pkt_info.src_name, rdata-&gt;pkt_info.src_port);</div><div class="line"><a name="l01093"></a><span class="lineno"> 1093</span>&#160;      <span class="keywordflow">return</span> PJ_TRUE;</div><div class="line"><a name="l01094"></a><span class="lineno"> 1094</span>&#160;   }</div><div class="line"><a name="l01095"></a><span class="lineno"> 1095</span>&#160;</div><div class="line"><a name="l01096"></a><span class="lineno"> 1096</span>&#160;   <span class="keywordflow">if</span> (!PJSIP_URI_SCHEME_IS_SIP(rdata-&gt;msg_info.to-&gt;uri) &amp;&amp; !PJSIP_URI_SCHEME_IS_SIPS(rdata-&gt;msg_info.to-&gt;uri)) {</div><div class="line"><a name="l01097"></a><span class="lineno"> 1097</span>&#160;      pjsip_endpt_respond_stateless(<a class="code" href="../../d8/d8c/res__pjsip_8h.html#a785afb501e315c8a97ad476fb6a8be1d">ast_sip_get_pjsip_endpoint</a>(), rdata, 416, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div><div class="line"><a name="l01098"></a><span class="lineno"> 1098</span>&#160;      <a class="code" href="../../d8/d8c/res__pjsip_8h.html#afa522937191ad0d45711173590521d47">ast_sip_report_failed_acl</a>(endpoint, rdata, <span class="stringliteral">&quot;registrar_invalid_uri_in_to_received&quot;</span>);</div><div class="line"><a name="l01099"></a><span class="lineno"> 1099</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Endpoint &#39;%s&#39; (%s:%d) attempted to register to an AOR with a non-SIP URI\n&quot;</span>, <a class="code" href="../../d8/d25/sorcery_8h.html#a97706283a06cbb44e4f0f9620dd5cf07">ast_sorcery_object_get_id</a>(endpoint),</div><div class="line"><a name="l01100"></a><span class="lineno"> 1100</span>&#160;         rdata-&gt;pkt_info.src_name, rdata-&gt;pkt_info.src_port);</div><div class="line"><a name="l01101"></a><span class="lineno"> 1101</span>&#160;      <span class="keywordflow">return</span> PJ_TRUE;</div><div class="line"><a name="l01102"></a><span class="lineno"> 1102</span>&#160;   }</div><div class="line"><a name="l01103"></a><span class="lineno"> 1103</span>&#160;</div><div class="line"><a name="l01104"></a><span class="lineno"> 1104</span>&#160;   aor = <a class="code" href="../../d3/db0/res__pjsip__registrar_8c.html#a1c1341bf634e6df2c66669574ffd4981">find_registrar_aor</a>(rdata, endpoint);</div><div class="line"><a name="l01105"></a><span class="lineno"> 1105</span>&#160;   <span class="keywordflow">if</span> (!aor) {</div><div class="line"><a name="l01106"></a><span class="lineno"> 1106</span>&#160;      <span class="comment">/* We&#39;ve already responded about not finding an AOR. */</span></div><div class="line"><a name="l01107"></a><span class="lineno"> 1107</span>&#160;      <span class="keywordflow">return</span> PJ_TRUE;</div><div class="line"><a name="l01108"></a><span class="lineno"> 1108</span>&#160;   }</div><div class="line"><a name="l01109"></a><span class="lineno"> 1109</span>&#160;</div><div class="line"><a name="l01110"></a><span class="lineno"> 1110</span>&#160;   aor_name = <a class="code" href="../../d8/d25/sorcery_8h.html#a97706283a06cbb44e4f0f9620dd5cf07">ast_sorcery_object_get_id</a>(aor);</div><div class="line"><a name="l01111"></a><span class="lineno"> 1111</span>&#160;</div><div class="line"><a name="l01112"></a><span class="lineno"> 1112</span>&#160;   <span class="keywordflow">if</span> (!aor-&gt;<a class="code" href="../../d4/d03/structast__sip__aor.html#a3d1288cbe35da9b1ec246ce65c8a9707">max_contacts</a>) {</div><div class="line"><a name="l01113"></a><span class="lineno"> 1113</span>&#160;      <span class="comment">/* Registration is not permitted for this AOR */</span></div><div class="line"><a name="l01114"></a><span class="lineno"> 1114</span>&#160;      pjsip_endpt_respond_stateless(<a class="code" href="../../d8/d8c/res__pjsip_8h.html#a785afb501e315c8a97ad476fb6a8be1d">ast_sip_get_pjsip_endpoint</a>(), rdata, 403, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div><div class="line"><a name="l01115"></a><span class="lineno"> 1115</span>&#160;      <a class="code" href="../../d8/d8c/res__pjsip_8h.html#a24ad1d4596f0644e856ff6e7ec2dd590">ast_sip_report_req_no_support</a>(endpoint, rdata, <span class="stringliteral">&quot;registrar_attempt_without_registration_permitted&quot;</span>);</div><div class="line"><a name="l01116"></a><span class="lineno"> 1116</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;AOR &#39;%s&#39; has no configured max_contacts. Endpoint &#39;%s&#39; (%s:%d) unable to register\n&quot;</span>,</div><div class="line"><a name="l01117"></a><span class="lineno"> 1117</span>&#160;         aor_name, <a class="code" href="../../d8/d25/sorcery_8h.html#a97706283a06cbb44e4f0f9620dd5cf07">ast_sorcery_object_get_id</a>(endpoint),</div><div class="line"><a name="l01118"></a><span class="lineno"> 1118</span>&#160;         rdata-&gt;pkt_info.src_name, rdata-&gt;pkt_info.src_port);</div><div class="line"><a name="l01119"></a><span class="lineno"> 1119</span>&#160;   } <span class="keywordflow">else</span> {</div><div class="line"><a name="l01120"></a><span class="lineno"> 1120</span>&#160;      <a class="code" href="../../d3/db0/res__pjsip__registrar_8c.html#a93c22b96390b4c815ec199eebcbdc07e">register_aor</a>(rdata, endpoint, aor, aor_name);</div><div class="line"><a name="l01121"></a><span class="lineno"> 1121</span>&#160;   }</div><div class="line"><a name="l01122"></a><span class="lineno"> 1122</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(aor, -1);</div><div class="line"><a name="l01123"></a><span class="lineno"> 1123</span>&#160;   <span class="keywordflow">return</span> PJ_TRUE;</div><div class="line"><a name="l01124"></a><span class="lineno"> 1124</span>&#160;}</div><div class="line"><a name="l01125"></a><span class="lineno"> 1125</span>&#160;</div><div class="line"><a name="l01126"></a><span class="lineno"> 1126</span>&#160;<span class="comment">/* function pointer to callback needs to be within the module</span></div><div class="line"><a name="l01127"></a><span class="lineno"> 1127</span>&#160;<span class="comment">   in order to avoid problems with an undefined symbol */</span></div><div class="line"><a name="l01128"></a><span class="lineno"><a class="line" href="../../d3/db0/res__pjsip__registrar_8c.html#a4f4cf2512f3131d35e101df650231ded"> 1128</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d3/db0/res__pjsip__registrar_8c.html#a4f4cf2512f3131d35e101df650231ded">sip_contact_to_str</a>(<span class="keywordtype">void</span> *acp, <span class="keywordtype">void</span> *arg, <span class="keywordtype">int</span> flags)</div><div class="line"><a name="l01129"></a><span class="lineno"> 1129</span>&#160;{</div><div class="line"><a name="l01130"></a><span class="lineno"> 1130</span>&#160;   <span class="keywordflow">return</span> <a class="code" href="../../d8/d8c/res__pjsip_8h.html#ae72306865fa2a2ed587acdd916c874c8">ast_sip_contact_to_str</a>(acp, arg, flags);</div><div class="line"><a name="l01131"></a><span class="lineno"> 1131</span>&#160;}</div><div class="line"><a name="l01132"></a><span class="lineno"> 1132</span>&#160;</div><div class="line"><a name="l01133"></a><span class="lineno"><a class="line" href="../../d3/db0/res__pjsip__registrar_8c.html#a8f054c4d1c6264000a8b588fc529fbac"> 1133</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d3/db0/res__pjsip__registrar_8c.html#a8f054c4d1c6264000a8b588fc529fbac">ami_registrations_aor</a>(<span class="keywordtype">void</span> *obj, <span class="keywordtype">void</span> *arg, <span class="keywordtype">int</span> flags)</div><div class="line"><a name="l01134"></a><span class="lineno"> 1134</span>&#160;{</div><div class="line"><a name="l01135"></a><span class="lineno"> 1135</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d4/d03/structast__sip__aor.html">ast_sip_aor</a> *aor = obj;</div><div class="line"><a name="l01136"></a><span class="lineno"> 1136</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d4/d2f/structast__sip__ami.html">ast_sip_ami</a> *ami = <a class="code" href="../../d4/d2f/structast__sip__ami.html#a9ce2ec4812a92cb6ab39f6e81e9173a9">arg</a>;</div><div class="line"><a name="l01137"></a><span class="lineno"> 1137</span>&#160;   <span class="keywordtype">int</span> *<a class="code" href="../../d4/d2f/structast__sip__ami.html#ad43c3812e6d13e0518d9f8b8f463ffcf">count</a> = ami-&gt;<a class="code" href="../../d4/d2f/structast__sip__ami.html#a9ce2ec4812a92cb6ab39f6e81e9173a9">arg</a>;</div><div class="line"><a name="l01138"></a><span class="lineno"> 1138</span>&#160;   <a class="code" href="../../d5/d60/utils_8h.html#a1604b4d72144dd3d9f7da668e90337e9">RAII_VAR</a>(<span class="keyword">struct</span> <a class="code" href="../../dd/da2/structast__str.html">ast_str</a> *, <a class="code" href="../../dd/d7c/eagi__proxy_8c.html#ac95651d79c608a3148973b5b1fc9e525">buf</a>,</div><div class="line"><a name="l01139"></a><span class="lineno"> 1139</span>&#160;       <a class="code" href="../../d8/d8c/res__pjsip_8h.html#a5b63b1eceb879f2cf0e23f356040737a">ast_sip_create_ami_event</a>(<span class="stringliteral">&quot;InboundRegistrationDetail&quot;</span>, ami), <a class="code" href="../../d8/d8a/astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>);</div><div class="line"><a name="l01140"></a><span class="lineno"> 1140</span>&#160;</div><div class="line"><a name="l01141"></a><span class="lineno"> 1141</span>&#160;   <span class="keywordflow">if</span> (!<a class="code" href="../../dd/d7c/eagi__proxy_8c.html#ac95651d79c608a3148973b5b1fc9e525">buf</a>) {</div><div class="line"><a name="l01142"></a><span class="lineno"> 1142</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l01143"></a><span class="lineno"> 1143</span>&#160;   }</div><div class="line"><a name="l01144"></a><span class="lineno"> 1144</span>&#160;</div><div class="line"><a name="l01145"></a><span class="lineno"> 1145</span>&#160;   <a class="code" href="../../d8/d8c/res__pjsip_8h.html#ab105b4d8cca635ce7aeed34c4543ab54">ast_sip_sorcery_object_to_ami</a>(aor, &amp;<a class="code" href="../../dd/d7c/eagi__proxy_8c.html#ac95651d79c608a3148973b5b1fc9e525">buf</a>);</div><div class="line"><a name="l01146"></a><span class="lineno"> 1146</span>&#160;   <a class="code" href="../../d6/d90/strings_8h.html#a1088afdd862a49b0fce34ebe02df8ca1">ast_str_append</a>(&amp;<a class="code" href="../../dd/d7c/eagi__proxy_8c.html#ac95651d79c608a3148973b5b1fc9e525">buf</a>, 0, <span class="stringliteral">&quot;Contacts: &quot;</span>);</div><div class="line"><a name="l01147"></a><span class="lineno"> 1147</span>&#160;   <a class="code" href="../../d8/d8c/res__pjsip_8h.html#a4267a8bdd3aed1f82b2720c2c5ab61c1">ast_sip_for_each_contact</a>(aor, <a class="code" href="../../d3/db0/res__pjsip__registrar_8c.html#a4f4cf2512f3131d35e101df650231ded">sip_contact_to_str</a>, &amp;<a class="code" href="../../dd/d7c/eagi__proxy_8c.html#ac95651d79c608a3148973b5b1fc9e525">buf</a>);</div><div class="line"><a name="l01148"></a><span class="lineno"> 1148</span>&#160;   <a class="code" href="../../d6/d90/strings_8h.html#a1088afdd862a49b0fce34ebe02df8ca1">ast_str_append</a>(&amp;<a class="code" href="../../dd/d7c/eagi__proxy_8c.html#ac95651d79c608a3148973b5b1fc9e525">buf</a>, 0, <span class="stringliteral">&quot;\r\n&quot;</span>);</div><div class="line"><a name="l01149"></a><span class="lineno"> 1149</span>&#160;</div><div class="line"><a name="l01150"></a><span class="lineno"> 1150</span>&#160;   <a class="code" href="../../df/d72/group__Group__AMI.html#gac2d42f7be13c532b6a70d50f1b8983d2">astman_append</a>(ami-&gt;<a class="code" href="../../d4/d2f/structast__sip__ami.html#a38bed88f5fd00306683b620c6c90eef4">s</a>, <span class="stringliteral">&quot;%s\r\n&quot;</span>, <a class="code" href="../../d6/d90/strings_8h.html#a1ef7e2644ca7258070db316fdc0a465b">ast_str_buffer</a>(<a class="code" href="../../dd/d7c/eagi__proxy_8c.html#ac95651d79c608a3148973b5b1fc9e525">buf</a>));</div><div class="line"><a name="l01151"></a><span class="lineno"> 1151</span>&#160;   (*count)++;</div><div class="line"><a name="l01152"></a><span class="lineno"> 1152</span>&#160;   <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l01153"></a><span class="lineno"> 1153</span>&#160;}</div><div class="line"><a name="l01154"></a><span class="lineno"> 1154</span>&#160;</div><div class="line"><a name="l01155"></a><span class="lineno"><a class="line" href="../../d3/db0/res__pjsip__registrar_8c.html#a00b05e0e233ed8b8a24c4ce367c97843"> 1155</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d3/db0/res__pjsip__registrar_8c.html#a00b05e0e233ed8b8a24c4ce367c97843">ami_registrations_endpoint</a>(<span class="keywordtype">void</span> *obj, <span class="keywordtype">void</span> *<a class="code" href="../../d4/d2f/structast__sip__ami.html#a9ce2ec4812a92cb6ab39f6e81e9173a9">arg</a>, <span class="keywordtype">int</span> flags)</div><div class="line"><a name="l01156"></a><span class="lineno"> 1156</span>&#160;{</div><div class="line"><a name="l01157"></a><span class="lineno"> 1157</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d3/d46/structast__sip__endpoint.html">ast_sip_endpoint</a> *endpoint = obj;</div><div class="line"><a name="l01158"></a><span class="lineno"> 1158</span>&#160;   <span class="keywordflow">return</span> <a class="code" href="../../d8/d8c/res__pjsip_8h.html#a4a6f16128f131ec8feae5dc0f8545b2f">ast_sip_for_each_aor</a>(</div><div class="line"><a name="l01159"></a><span class="lineno"> 1159</span>&#160;      endpoint-&gt;<a class="code" href="../../d3/d46/structast__sip__endpoint.html#a50edbc089f02d537b9a487f1a62c889e">aors</a>, <a class="code" href="../../d3/db0/res__pjsip__registrar_8c.html#a8f054c4d1c6264000a8b588fc529fbac">ami_registrations_aor</a>, arg);</div><div class="line"><a name="l01160"></a><span class="lineno"> 1160</span>&#160;}</div><div class="line"><a name="l01161"></a><span class="lineno"> 1161</span>&#160;</div><div class="line"><a name="l01162"></a><span class="lineno"><a class="line" href="../../d3/db0/res__pjsip__registrar_8c.html#a409bbef1e0800ce705686551288fa4d1"> 1162</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d3/db0/res__pjsip__registrar_8c.html#a409bbef1e0800ce705686551288fa4d1">ami_registrations_endpoints</a>(<span class="keywordtype">void</span> *arg)</div><div class="line"><a name="l01163"></a><span class="lineno"> 1163</span>&#160;{</div><div class="line"><a name="l01164"></a><span class="lineno"> 1164</span>&#160;   <a class="code" href="../../d5/d60/utils_8h.html#a1604b4d72144dd3d9f7da668e90337e9">RAII_VAR</a>(<span class="keyword">struct</span> <a class="code" href="../../d2/da9/structao2__container.html">ao2_container</a> *, <a class="code" href="../../d7/d4b/main_2endpoints_8c.html#a0b6312c44448ff7ed80ac99b3077e438">endpoints</a>,</div><div class="line"><a name="l01165"></a><span class="lineno"> 1165</span>&#160;       <a class="code" href="../../d8/d8c/res__pjsip_8h.html#a26352a4b800eeb07efd4cb7b0a531af5">ast_sip_get_endpoints</a>(), <a class="code" href="../../d5/da5/astobj2_8h.html#a6321ee982370c55ab3c24c72c562cbdd">ao2_cleanup</a>);</div><div class="line"><a name="l01166"></a><span class="lineno"> 1166</span>&#160;</div><div class="line"><a name="l01167"></a><span class="lineno"> 1167</span>&#160;   <span class="keywordflow">if</span> (!<a class="code" href="../../d7/d4b/main_2endpoints_8c.html#a0b6312c44448ff7ed80ac99b3077e438">endpoints</a>) {</div><div class="line"><a name="l01168"></a><span class="lineno"> 1168</span>&#160;      <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l01169"></a><span class="lineno"> 1169</span>&#160;   }</div><div class="line"><a name="l01170"></a><span class="lineno"> 1170</span>&#160;</div><div class="line"><a name="l01171"></a><span class="lineno"> 1171</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#a47857055118a703ae87ea5ebaf4842ed">ao2_callback</a>(<a class="code" href="../../d7/d4b/main_2endpoints_8c.html#a0b6312c44448ff7ed80ac99b3077e438">endpoints</a>, <a class="code" href="../../d5/da5/astobj2_8h.html#ad9d009e87e737af900825b36db55a35ca5fc59b193d86a0a8ddfe866304be829d">OBJ_NODATA</a>, <a class="code" href="../../d3/db0/res__pjsip__registrar_8c.html#a00b05e0e233ed8b8a24c4ce367c97843">ami_registrations_endpoint</a>, arg);</div><div class="line"><a name="l01172"></a><span class="lineno"> 1172</span>&#160;   <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l01173"></a><span class="lineno"> 1173</span>&#160;}</div><div class="line"><a name="l01174"></a><span class="lineno"> 1174</span>&#160;</div><div class="line"><a name="l01175"></a><span class="lineno"><a class="line" href="../../d3/db0/res__pjsip__registrar_8c.html#aef91583c1a44bcbb095bfa1a7c64f26a"> 1175</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d3/db0/res__pjsip__registrar_8c.html#aef91583c1a44bcbb095bfa1a7c64f26a">ami_show_registrations</a>(<span class="keyword">struct</span> <a class="code" href="../../d2/d8a/structmansession.html">mansession</a> *s, <span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="../../d8/d9e/structmessage.html">message</a> *m)</div><div class="line"><a name="l01176"></a><span class="lineno"> 1176</span>&#160;{</div><div class="line"><a name="l01177"></a><span class="lineno"> 1177</span>&#160;   <span class="keywordtype">int</span> count = 0;</div><div class="line"><a name="l01178"></a><span class="lineno"> 1178</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d4/d2f/structast__sip__ami.html">ast_sip_ami</a> ami = { .<a class="code" href="../../d4/d2f/structast__sip__ami.html#a38bed88f5fd00306683b620c6c90eef4">s</a> = <a class="code" href="../../d4/d2f/structast__sip__ami.html#a38bed88f5fd00306683b620c6c90eef4">s</a>, .m = <a class="code" href="../../d4/d2f/structast__sip__ami.html#ac0506a88d121327118c7346baa303a9e">m</a>, .arg = &amp;<a class="code" href="../../d4/d2f/structast__sip__ami.html#ad43c3812e6d13e0518d9f8b8f463ffcf">count</a>, .action_id = <a class="code" href="../../df/d72/group__Group__AMI.html#gac6a9f3498f9afffecfd78c485af41556">astman_get_header</a>(m, <span class="stringliteral">&quot;ActionID&quot;</span>), };</div><div class="line"><a name="l01179"></a><span class="lineno"> 1179</span>&#160;</div><div class="line"><a name="l01180"></a><span class="lineno"> 1180</span>&#160;   <a class="code" href="../../df/d72/group__Group__AMI.html#ga0ee6ee1f4d200f711e2983bffe770a72">astman_send_listack</a>(s, m, <span class="stringliteral">&quot;Following are Events for each Inbound registration&quot;</span>,</div><div class="line"><a name="l01181"></a><span class="lineno"> 1181</span>&#160;      <span class="stringliteral">&quot;start&quot;</span>);</div><div class="line"><a name="l01182"></a><span class="lineno"> 1182</span>&#160;</div><div class="line"><a name="l01183"></a><span class="lineno"> 1183</span>&#160;   <a class="code" href="../../d3/db0/res__pjsip__registrar_8c.html#a409bbef1e0800ce705686551288fa4d1">ami_registrations_endpoints</a>(&amp;ami);</div><div class="line"><a name="l01184"></a><span class="lineno"> 1184</span>&#160;</div><div class="line"><a name="l01185"></a><span class="lineno"> 1185</span>&#160;   <a class="code" href="../../df/d72/group__Group__AMI.html#ga58c3e3da5d31739cafaee1df6ddf9342">astman_send_list_complete_start</a>(s, m, <span class="stringliteral">&quot;InboundRegistrationDetailComplete&quot;</span>, count);</div><div class="line"><a name="l01186"></a><span class="lineno"> 1186</span>&#160;   <a class="code" href="../../df/d72/group__Group__AMI.html#gabf7c909efbfc26d0d9c66786c83b8f69">astman_send_list_complete_end</a>(s);</div><div class="line"><a name="l01187"></a><span class="lineno"> 1187</span>&#160;   <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l01188"></a><span class="lineno"> 1188</span>&#160;}</div><div class="line"><a name="l01189"></a><span class="lineno"> 1189</span>&#160;</div><div class="line"><a name="l01190"></a><span class="lineno"><a class="line" href="../../d3/db0/res__pjsip__registrar_8c.html#a65525b2ea5b7969c74517c0c620418ad"> 1190</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d3/db0/res__pjsip__registrar_8c.html#a65525b2ea5b7969c74517c0c620418ad">ami_show_registration_contact_statuses</a>(<span class="keyword">struct</span> <a class="code" href="../../d2/d8a/structmansession.html">mansession</a> *<a class="code" href="../../d4/d2f/structast__sip__ami.html#a38bed88f5fd00306683b620c6c90eef4">s</a>, <span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="../../d8/d9e/structmessage.html">message</a> *<a class="code" href="../../d4/d2f/structast__sip__ami.html#ac0506a88d121327118c7346baa303a9e">m</a>)</div><div class="line"><a name="l01191"></a><span class="lineno"> 1191</span>&#160;{</div><div class="line"><a name="l01192"></a><span class="lineno"> 1192</span>&#160;   <span class="keywordtype">int</span> <a class="code" href="../../d4/d2f/structast__sip__ami.html#ad43c3812e6d13e0518d9f8b8f463ffcf">count</a> = 0;</div><div class="line"><a name="l01193"></a><span class="lineno"> 1193</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d4/d2f/structast__sip__ami.html">ast_sip_ami</a> ami = { .<a class="code" href="../../d4/d2f/structast__sip__ami.html#a38bed88f5fd00306683b620c6c90eef4">s</a> = <a class="code" href="../../d4/d2f/structast__sip__ami.html#a38bed88f5fd00306683b620c6c90eef4">s</a>, .m = <a class="code" href="../../d4/d2f/structast__sip__ami.html#ac0506a88d121327118c7346baa303a9e">m</a>, .arg = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, .action_id = <a class="code" href="../../df/d72/group__Group__AMI.html#gac6a9f3498f9afffecfd78c485af41556">astman_get_header</a>(m, <span class="stringliteral">&quot;ActionID&quot;</span>), };</div><div class="line"><a name="l01194"></a><span class="lineno"> 1194</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d2/da9/structao2__container.html">ao2_container</a> *contacts = <a class="code" href="../../d8/d25/sorcery_8h.html#aaa9cd237841a70862001f580b23212c9">ast_sorcery_retrieve_by_fields</a>(</div><div class="line"><a name="l01195"></a><span class="lineno"> 1195</span>&#160;      <a class="code" href="../../d8/d8c/res__pjsip_8h.html#a5572d52daf1a841b0f9308df901448c8">ast_sip_get_sorcery</a>(), <span class="stringliteral">&quot;contact&quot;</span>, <a class="code" href="../../d8/d25/sorcery_8h.html#a320e98591a38316a313a3ca83ea8df20a019a4a531b83f4ab0b35a3c788bf8d55">AST_RETRIEVE_FLAG_MULTIPLE</a> | <a class="code" href="../../d8/d25/sorcery_8h.html#a320e98591a38316a313a3ca83ea8df20a643c7c50af2691bb16052509d47b61cd">AST_RETRIEVE_FLAG_ALL</a>, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div><div class="line"><a name="l01196"></a><span class="lineno"> 1196</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d9/d97/structao2__iterator.html">ao2_iterator</a> i;</div><div class="line"><a name="l01197"></a><span class="lineno"> 1197</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d8/d8a/structast__sip__contact.html">ast_sip_contact</a> *<a class="code" href="../../d9/d03/structcontact.html">contact</a>;</div><div class="line"><a name="l01198"></a><span class="lineno"> 1198</span>&#160;</div><div class="line"><a name="l01199"></a><span class="lineno"> 1199</span>&#160;   <a class="code" href="../../df/d72/group__Group__AMI.html#ga0ee6ee1f4d200f711e2983bffe770a72">astman_send_listack</a>(s, m, <span class="stringliteral">&quot;Following are ContactStatusEvents for each Inbound &quot;</span></div><div class="line"><a name="l01200"></a><span class="lineno"> 1200</span>&#160;             <span class="stringliteral">&quot;registration&quot;</span>, <span class="stringliteral">&quot;start&quot;</span>);</div><div class="line"><a name="l01201"></a><span class="lineno"> 1201</span>&#160;</div><div class="line"><a name="l01202"></a><span class="lineno"> 1202</span>&#160;   <span class="keywordflow">if</span> (contacts) {</div><div class="line"><a name="l01203"></a><span class="lineno"> 1203</span>&#160;      i = <a class="code" href="../../d5/da5/astobj2_8h.html#a91d5d37d00874ae7a92d1a15c0a3b3a6">ao2_iterator_init</a>(contacts, 0);</div><div class="line"><a name="l01204"></a><span class="lineno"> 1204</span>&#160;      <span class="keywordflow">while</span> ((contact = <a class="code" href="../../d5/da5/astobj2_8h.html#a17990ea630db7dbd1252ef0132133a2b">ao2_iterator_next</a>(&amp;i))) {</div><div class="line"><a name="l01205"></a><span class="lineno"> 1205</span>&#160;         <span class="keyword">struct </span><a class="code" href="../../df/dd8/structast__sip__contact__wrapper.html">ast_sip_contact_wrapper</a> wrapper;</div><div class="line"><a name="l01206"></a><span class="lineno"> 1206</span>&#160;</div><div class="line"><a name="l01207"></a><span class="lineno"> 1207</span>&#160;         wrapper.<a class="code" href="../../df/dd8/structast__sip__contact__wrapper.html#aada96c4dcf837c70c990bed754148422">aor_id</a> = (<span class="keywordtype">char</span> *)contact-&gt;<a class="code" href="../../d8/d8a/structast__sip__contact.html#a7d6a7c1f176fb54d59dd27ea307f44e6">aor</a>;</div><div class="line"><a name="l01208"></a><span class="lineno"> 1208</span>&#160;         wrapper.<a class="code" href="../../df/dd8/structast__sip__contact__wrapper.html#a0181805d3b31d6f1859ef7784c67fcf2">contact</a> = contact;</div><div class="line"><a name="l01209"></a><span class="lineno"> 1209</span>&#160;         wrapper.<a class="code" href="../../df/dd8/structast__sip__contact__wrapper.html#a08490ce2b49a613ace5351f00c7c36ab">contact_id</a> = (<span class="keywordtype">char</span> *)<a class="code" href="../../d8/d25/sorcery_8h.html#a97706283a06cbb44e4f0f9620dd5cf07">ast_sorcery_object_get_id</a>(contact);</div><div class="line"><a name="l01210"></a><span class="lineno"> 1210</span>&#160;</div><div class="line"><a name="l01211"></a><span class="lineno"> 1211</span>&#160;         <a class="code" href="../../d8/d8c/res__pjsip_8h.html#a85b5bfa4330f0b5e0f86311139cc00f7">ast_sip_format_contact_ami</a>(&amp;wrapper, &amp;ami, 0);</div><div class="line"><a name="l01212"></a><span class="lineno"> 1212</span>&#160;         count++;</div><div class="line"><a name="l01213"></a><span class="lineno"> 1213</span>&#160;</div><div class="line"><a name="l01214"></a><span class="lineno"> 1214</span>&#160;         <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(contact, -1);</div><div class="line"><a name="l01215"></a><span class="lineno"> 1215</span>&#160;      }</div><div class="line"><a name="l01216"></a><span class="lineno"> 1216</span>&#160;      <a class="code" href="../../d5/da5/astobj2_8h.html#ad36841ab6daa3997f7ca7047ad2d033a">ao2_iterator_destroy</a>(&amp;i);</div><div class="line"><a name="l01217"></a><span class="lineno"> 1217</span>&#160;      <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(contacts, -1);</div><div class="line"><a name="l01218"></a><span class="lineno"> 1218</span>&#160;   }</div><div class="line"><a name="l01219"></a><span class="lineno"> 1219</span>&#160;</div><div class="line"><a name="l01220"></a><span class="lineno"> 1220</span>&#160;   <a class="code" href="../../df/d72/group__Group__AMI.html#ga58c3e3da5d31739cafaee1df6ddf9342">astman_send_list_complete_start</a>(s, m, <span class="stringliteral">&quot;ContactStatusDetailComplete&quot;</span>, count);</div><div class="line"><a name="l01221"></a><span class="lineno"> 1221</span>&#160;   <a class="code" href="../../df/d72/group__Group__AMI.html#gabf7c909efbfc26d0d9c66786c83b8f69">astman_send_list_complete_end</a>(s);</div><div class="line"><a name="l01222"></a><span class="lineno"> 1222</span>&#160;   <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l01223"></a><span class="lineno"> 1223</span>&#160;}</div><div class="line"><a name="l01224"></a><span class="lineno"> 1224</span>&#160;</div><div class="line"><a name="l01225"></a><span class="lineno"><a class="line" href="../../d3/db0/res__pjsip__registrar_8c.html#a5099f04cc6c837b05cc6f6e4db154ead"> 1225</a></span>&#160;<span class="preprocessor">#define AMI_SHOW_REGISTRATION_CONTACT_STATUSES &quot;PJSIPShowRegistrationInboundContactStatuses&quot;</span></div><div class="line"><a name="l01226"></a><span class="lineno"><a class="line" href="../../d3/db0/res__pjsip__registrar_8c.html#ac19bc2465164ac0a5beb5db3624d5c8e"> 1226</a></span>&#160;<span class="preprocessor">#define AMI_SHOW_REGISTRATIONS &quot;PJSIPShowRegistrationsInbound&quot;</span></div><div class="line"><a name="l01227"></a><span class="lineno"> 1227</span>&#160;</div><div class="line"><a name="l01228"></a><span class="lineno"><a class="line" href="../../d3/db0/res__pjsip__registrar_8c.html#abefd4a2f654e85e48024d3a3751f73d1"> 1228</a></span>&#160;<span class="keyword">static</span> pjsip_module <a class="code" href="../../d3/db0/res__pjsip__registrar_8c.html#abefd4a2f654e85e48024d3a3751f73d1">registrar_module</a> = {</div><div class="line"><a name="l01229"></a><span class="lineno"> 1229</span>&#160;   .name = { <span class="stringliteral">&quot;Registrar&quot;</span>, 9 },</div><div class="line"><a name="l01230"></a><span class="lineno"> 1230</span>&#160;   .id = -1,</div><div class="line"><a name="l01231"></a><span class="lineno"> 1231</span>&#160;   .priority = PJSIP_MOD_PRIORITY_APPLICATION,</div><div class="line"><a name="l01232"></a><span class="lineno"> 1232</span>&#160;   .on_rx_request = <a class="code" href="../../d3/db0/res__pjsip__registrar_8c.html#a88655efef49d2d5933795f840432084f">registrar_on_rx_request</a>,</div><div class="line"><a name="l01233"></a><span class="lineno"> 1233</span>&#160;};</div><div class="line"><a name="l01234"></a><span class="lineno"> 1234</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01235"></a><span class="lineno"> 1235</span>&#160;<span class="comment">/*! \brief Thread keeping things alive */</span></div><div class="line"><a name="l01236"></a><span class="lineno"><a class="line" href="../../d3/db0/res__pjsip__registrar_8c.html#a59440daf72ccd107300be15c516373bd"> 1236</a></span>&#160;<span class="keyword">static</span> pthread_t <a class="code" href="../../d3/db0/res__pjsip__registrar_8c.html#a59440daf72ccd107300be15c516373bd">check_thread</a> = <a class="code" href="../../dd/d42/lock_8h.html#a6009440c7a72f8e2e3b1ec97641ad160">AST_PTHREADT_NULL</a>;</div><div class="line"><a name="l01237"></a><span class="lineno"> 1237</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01238"></a><span class="lineno"> 1238</span>&#160;<span class="comment">/*! \brief The global interval at which to check for contact expiration */</span></div><div class="line"><a name="l01239"></a><span class="lineno"><a class="line" href="../../d3/db0/res__pjsip__registrar_8c.html#aac29a93b6cccde99e2eeb55575e692fa"> 1239</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="../../d3/db0/res__pjsip__registrar_8c.html#aac29a93b6cccde99e2eeb55575e692fa">check_interval</a>;</div><div class="line"><a name="l01240"></a><span class="lineno"> 1240</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01241"></a><span class="lineno"> 1241</span>&#160;<span class="comment">/*! \brief Callback function which deletes a contact */</span></div><div class="line"><a name="l01242"></a><span class="lineno"><a class="line" href="../../d3/db0/res__pjsip__registrar_8c.html#a8eaee453c1eff0bc83bb6ca5e4d561e0"> 1242</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d3/db0/res__pjsip__registrar_8c.html#a8eaee453c1eff0bc83bb6ca5e4d561e0">expire_contact</a>(<span class="keywordtype">void</span> *obj, <span class="keywordtype">void</span> *arg, <span class="keywordtype">int</span> flags)</div><div class="line"><a name="l01243"></a><span class="lineno"> 1243</span>&#160;{</div><div class="line"><a name="l01244"></a><span class="lineno"> 1244</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d8/d8a/structast__sip__contact.html">ast_sip_contact</a> *<a class="code" href="../../d9/d03/structcontact.html">contact</a> = obj;</div><div class="line"><a name="l01245"></a><span class="lineno"> 1245</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d0/d55/structast__named__lock.html">ast_named_lock</a> *<a class="code" href="../../df/d44/app__meetme_8c.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>;</div><div class="line"><a name="l01246"></a><span class="lineno"> 1246</span>&#160;</div><div class="line"><a name="l01247"></a><span class="lineno"> 1247</span>&#160;   lock = <a class="code" href="../../d0/db9/group__named__locks.html#ga2322f66e9b72ca5cc591a556c567d3e0">ast_named_lock_get</a>(<a class="code" href="../../d0/db9/group__named__locks.html#gga9536e506e987386496d90bb12f1da9c7a4320f5fc7cf75e313ebddce649562d83">AST_NAMED_LOCK_TYPE_MUTEX</a>, <span class="stringliteral">&quot;aor&quot;</span>, contact-&gt;<a class="code" href="../../d8/d8a/structast__sip__contact.html#a7d6a7c1f176fb54d59dd27ea307f44e6">aor</a>);</div><div class="line"><a name="l01248"></a><span class="lineno"> 1248</span>&#160;   <span class="keywordflow">if</span> (!lock) {</div><div class="line"><a name="l01249"></a><span class="lineno"> 1249</span>&#160;      <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l01250"></a><span class="lineno"> 1250</span>&#160;   }</div><div class="line"><a name="l01251"></a><span class="lineno"> 1251</span>&#160;</div><div class="line"><a name="l01252"></a><span class="lineno"> 1252</span>&#160;   <span class="comment">/*</span></div><div class="line"><a name="l01253"></a><span class="lineno"> 1253</span>&#160;<span class="comment">    * We need to check the expiration again with the aor lock held</span></div><div class="line"><a name="l01254"></a><span class="lineno"> 1254</span>&#160;<span class="comment">    * in case another thread is attempting to renew the contact.</span></div><div class="line"><a name="l01255"></a><span class="lineno"> 1255</span>&#160;<span class="comment">    */</span></div><div class="line"><a name="l01256"></a><span class="lineno"> 1256</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#aa9fdb5d0a6157a56060d9f7279fe6c49">ao2_lock</a>(lock);</div><div class="line"><a name="l01257"></a><span class="lineno"> 1257</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../de/df7/time_8h.html#aca4ecdab7d8d3519062aad9a90fcb29d">ast_tvdiff_ms</a>(<a class="code" href="../../de/df7/time_8h.html#ad3899efb6f0e348556ef69f5b16aa7f7">ast_tvnow</a>(), contact-&gt;<a class="code" href="../../d8/d8a/structast__sip__contact.html#a98ed99328ad621551cdfbee6b83754ae">expiration_time</a>) &gt; 0) {</div><div class="line"><a name="l01258"></a><span class="lineno"> 1258</span>&#160;      <a class="code" href="../../d3/db0/res__pjsip__registrar_8c.html#a10954918b2b79e996b17b94e5b6c6b62">registrar_contact_delete</a>(<a class="code" href="../../d3/db0/res__pjsip__registrar_8c.html#aa0b6ec2978c63b269ea90927f085c0d8ad88825ec6d3fcb67a681bd0c66e789eb">CONTACT_DELETE_EXPIRE</a>, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, contact, contact-&gt;<a class="code" href="../../d8/d8a/structast__sip__contact.html#a7d6a7c1f176fb54d59dd27ea307f44e6">aor</a>);</div><div class="line"><a name="l01259"></a><span class="lineno"> 1259</span>&#160;   }</div><div class="line"><a name="l01260"></a><span class="lineno"> 1260</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#a9998bd156b936636a8780385e9a910b2">ao2_unlock</a>(lock);</div><div class="line"><a name="l01261"></a><span class="lineno"> 1261</span>&#160;   <a class="code" href="../../d0/db9/group__named__locks.html#ga16b38cbe1bbd5caee828393d0299f463">ast_named_lock_put</a>(lock);</div><div class="line"><a name="l01262"></a><span class="lineno"> 1262</span>&#160;</div><div class="line"><a name="l01263"></a><span class="lineno"> 1263</span>&#160;   <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l01264"></a><span class="lineno"> 1264</span>&#160;}</div><div class="line"><a name="l01265"></a><span class="lineno"> 1265</span>&#160;</div><div class="line"><a name="l01266"></a><span class="lineno"><a class="line" href="../../d3/db0/res__pjsip__registrar_8c.html#a507c5e3db66e37573fbcb5b530841a9b"> 1266</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> *<a class="code" href="../../d3/db0/res__pjsip__registrar_8c.html#a507c5e3db66e37573fbcb5b530841a9b">check_expiration_thread</a>(<span class="keywordtype">void</span> *data)</div><div class="line"><a name="l01267"></a><span class="lineno"> 1267</span>&#160;{</div><div class="line"><a name="l01268"></a><span class="lineno"> 1268</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d2/da9/structao2__container.html">ao2_container</a> *contacts;</div><div class="line"><a name="l01269"></a><span class="lineno"> 1269</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../dd/d02/structast__variable.html">ast_variable</a> *<a class="code" href="../../dc/df2/ast__expr2f_8c.html#a1b0936415a643c88ce543099c10e0d7f">var</a>;</div><div class="line"><a name="l01270"></a><span class="lineno"> 1270</span>&#160;   <span class="keywordtype">char</span> *time = alloca(64);</div><div class="line"><a name="l01271"></a><span class="lineno"> 1271</span>&#160;</div><div class="line"><a name="l01272"></a><span class="lineno"> 1272</span>&#160;   <span class="keywordflow">while</span> (check_interval) {</div><div class="line"><a name="l01273"></a><span class="lineno"> 1273</span>&#160;      sleep(check_interval);</div><div class="line"><a name="l01274"></a><span class="lineno"> 1274</span>&#160;</div><div class="line"><a name="l01275"></a><span class="lineno"> 1275</span>&#160;      sprintf(time, <span class="stringliteral">&quot;%ld&quot;</span>, <a class="code" href="../../de/df7/time_8h.html#ad3899efb6f0e348556ef69f5b16aa7f7">ast_tvnow</a>().tv_sec);</div><div class="line"><a name="l01276"></a><span class="lineno"> 1276</span>&#160;      var = <a class="code" href="../../d3/de6/include_2asterisk_2config_8h.html#a66581086d34dfe7ea86b0644bacef239">ast_variable_new</a>(<span class="stringliteral">&quot;expiration_time &lt;=&quot;</span>, time, <span class="stringliteral">&quot;&quot;</span>);</div><div class="line"><a name="l01277"></a><span class="lineno"> 1277</span>&#160;</div><div class="line"><a name="l01278"></a><span class="lineno"> 1278</span>&#160;      <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(4, <span class="stringliteral">&quot;Woke up at %s  Interval: %d\n&quot;</span>, time, check_interval);</div><div class="line"><a name="l01279"></a><span class="lineno"> 1279</span>&#160;</div><div class="line"><a name="l01280"></a><span class="lineno"> 1280</span>&#160;      contacts = <a class="code" href="../../d8/d25/sorcery_8h.html#aaa9cd237841a70862001f580b23212c9">ast_sorcery_retrieve_by_fields</a>(<a class="code" href="../../d8/d8c/res__pjsip_8h.html#a5572d52daf1a841b0f9308df901448c8">ast_sip_get_sorcery</a>(), <span class="stringliteral">&quot;contact&quot;</span>,</div><div class="line"><a name="l01281"></a><span class="lineno"> 1281</span>&#160;         <a class="code" href="../../d8/d25/sorcery_8h.html#a320e98591a38316a313a3ca83ea8df20a019a4a531b83f4ab0b35a3c788bf8d55">AST_RETRIEVE_FLAG_MULTIPLE</a>, var);</div><div class="line"><a name="l01282"></a><span class="lineno"> 1282</span>&#160;</div><div class="line"><a name="l01283"></a><span class="lineno"> 1283</span>&#160;      <a class="code" href="../../d3/de6/include_2asterisk_2config_8h.html#adea5390496e5477192d86f340d512d04">ast_variables_destroy</a>(var);</div><div class="line"><a name="l01284"></a><span class="lineno"> 1284</span>&#160;      <span class="keywordflow">if</span> (contacts) {</div><div class="line"><a name="l01285"></a><span class="lineno"> 1285</span>&#160;         <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(3, <span class="stringliteral">&quot;Expiring %d contacts\n&quot;</span>, <a class="code" href="../../d5/da5/astobj2_8h.html#a512cc40ce96c63b3d5c78040baa4c9cd">ao2_container_count</a>(contacts));</div><div class="line"><a name="l01286"></a><span class="lineno"> 1286</span>&#160;         <a class="code" href="../../d5/da5/astobj2_8h.html#a47857055118a703ae87ea5ebaf4842ed">ao2_callback</a>(contacts, <a class="code" href="../../d5/da5/astobj2_8h.html#ad9d009e87e737af900825b36db55a35ca5fc59b193d86a0a8ddfe866304be829d">OBJ_NODATA</a>, <a class="code" href="../../d3/db0/res__pjsip__registrar_8c.html#a8eaee453c1eff0bc83bb6ca5e4d561e0">expire_contact</a>, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div><div class="line"><a name="l01287"></a><span class="lineno"> 1287</span>&#160;         <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(contacts, -1);</div><div class="line"><a name="l01288"></a><span class="lineno"> 1288</span>&#160;      }</div><div class="line"><a name="l01289"></a><span class="lineno"> 1289</span>&#160;   }</div><div class="line"><a name="l01290"></a><span class="lineno"> 1290</span>&#160;</div><div class="line"><a name="l01291"></a><span class="lineno"> 1291</span>&#160;   <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l01292"></a><span class="lineno"> 1292</span>&#160;}</div><div class="line"><a name="l01293"></a><span class="lineno"> 1293</span>&#160;</div><div class="line"><a name="l01294"></a><span class="lineno"><a class="line" href="../../d3/db0/res__pjsip__registrar_8c.html#a6dec9164e0ad0a361d74eefb350b9ee4"> 1294</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d3/db0/res__pjsip__registrar_8c.html#a6dec9164e0ad0a361d74eefb350b9ee4">expiration_global_loaded</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *object_type)</div><div class="line"><a name="l01295"></a><span class="lineno"> 1295</span>&#160;{</div><div class="line"><a name="l01296"></a><span class="lineno"> 1296</span>&#160;   check_interval = <a class="code" href="../../d8/d8c/res__pjsip_8h.html#a8faae2d4e4f2b202cbfed36b6f009a1b">ast_sip_get_contact_expiration_check_interval</a>();</div><div class="line"><a name="l01297"></a><span class="lineno"> 1297</span>&#160;</div><div class="line"><a name="l01298"></a><span class="lineno"> 1298</span>&#160;   <span class="comment">/* Observer calls are serialized so this is safe without it&#39;s own lock */</span></div><div class="line"><a name="l01299"></a><span class="lineno"> 1299</span>&#160;   <span class="keywordflow">if</span> (check_interval) {</div><div class="line"><a name="l01300"></a><span class="lineno"> 1300</span>&#160;      <span class="keywordflow">if</span> (check_thread == <a class="code" href="../../dd/d42/lock_8h.html#a6009440c7a72f8e2e3b1ec97641ad160">AST_PTHREADT_NULL</a>) {</div><div class="line"><a name="l01301"></a><span class="lineno"> 1301</span>&#160;         <span class="keywordflow">if</span> (<a class="code" href="../../d5/d60/utils_8h.html#a595e2f8aa398f4bd21e381c3211235fe">ast_pthread_create_background</a>(&amp;check_thread, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../d3/db0/res__pjsip__registrar_8c.html#a507c5e3db66e37573fbcb5b530841a9b">check_expiration_thread</a>, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)) {</div><div class="line"><a name="l01302"></a><span class="lineno"> 1302</span>&#160;            <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Could not create thread for checking contact expiration.\n&quot;</span>);</div><div class="line"><a name="l01303"></a><span class="lineno"> 1303</span>&#160;            <span class="keywordflow">return</span>;</div><div class="line"><a name="l01304"></a><span class="lineno"> 1304</span>&#160;         }</div><div class="line"><a name="l01305"></a><span class="lineno"> 1305</span>&#160;         <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(3, <span class="stringliteral">&quot;Interval = %d, starting thread\n&quot;</span>, check_interval);</div><div class="line"><a name="l01306"></a><span class="lineno"> 1306</span>&#160;      }</div><div class="line"><a name="l01307"></a><span class="lineno"> 1307</span>&#160;   } <span class="keywordflow">else</span> {</div><div class="line"><a name="l01308"></a><span class="lineno"> 1308</span>&#160;      <span class="keywordflow">if</span> (check_thread != <a class="code" href="../../dd/d42/lock_8h.html#a6009440c7a72f8e2e3b1ec97641ad160">AST_PTHREADT_NULL</a>) {</div><div class="line"><a name="l01309"></a><span class="lineno"> 1309</span>&#160;         pthread_kill(check_thread, SIGURG);</div><div class="line"><a name="l01310"></a><span class="lineno"> 1310</span>&#160;         pthread_join(check_thread, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div><div class="line"><a name="l01311"></a><span class="lineno"> 1311</span>&#160;         check_thread = <a class="code" href="../../dd/d42/lock_8h.html#a6009440c7a72f8e2e3b1ec97641ad160">AST_PTHREADT_NULL</a>;</div><div class="line"><a name="l01312"></a><span class="lineno"> 1312</span>&#160;         <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(3, <span class="stringliteral">&quot;Interval = 0, shutting thread down\n&quot;</span>);</div><div class="line"><a name="l01313"></a><span class="lineno"> 1313</span>&#160;      }</div><div class="line"><a name="l01314"></a><span class="lineno"> 1314</span>&#160;   }</div><div class="line"><a name="l01315"></a><span class="lineno"> 1315</span>&#160;}</div><div class="line"><a name="l01316"></a><span class="lineno"> 1316</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01317"></a><span class="lineno"> 1317</span>&#160;<span class="comment">/*! \brief Observer which is used to update our interval when the global setting changes */</span></div><div class="line"><a name="l01318"></a><span class="lineno"><a class="line" href="../../d3/db0/res__pjsip__registrar_8c.html#aaaed45b85cc20418524ffe616356c2c8"> 1318</a></span>&#160;<span class="keyword">static</span> <span class="keyword">struct </span><a class="code" href="../../d2/ddb/structast__sorcery__observer.html">ast_sorcery_observer</a> <a class="code" href="../../d3/db0/res__pjsip__registrar_8c.html#aaaed45b85cc20418524ffe616356c2c8">expiration_global_observer</a> = {</div><div class="line"><a name="l01319"></a><span class="lineno"> 1319</span>&#160;   .<a class="code" href="../../d2/ddb/structast__sorcery__observer.html#a1ebad9f5bd6a80f6f666354460b86e0d">loaded</a> = <a class="code" href="../../d3/db0/res__pjsip__registrar_8c.html#a6dec9164e0ad0a361d74eefb350b9ee4">expiration_global_loaded</a>,</div><div class="line"><a name="l01320"></a><span class="lineno"> 1320</span>&#160;};</div><div class="line"><a name="l01321"></a><span class="lineno"> 1321</span>&#160;</div><div class="line"><a name="l01322"></a><span class="lineno"><a class="line" href="../../d3/db0/res__pjsip__registrar_8c.html#ac3382bf6da54c56b37069bd76bbdf4f9"> 1322</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d3/db0/res__pjsip__registrar_8c.html#ac3382bf6da54c56b37069bd76bbdf4f9">load_module</a>(<span class="keywordtype">void</span>)</div><div class="line"><a name="l01323"></a><span class="lineno"> 1323</span>&#160;{</div><div class="line"><a name="l01324"></a><span class="lineno"> 1324</span>&#160;   <span class="keyword">const</span> pj_str_t STR_REGISTER = { <span class="stringliteral">&quot;REGISTER&quot;</span>, 8 };</div><div class="line"><a name="l01325"></a><span class="lineno"> 1325</span>&#160;</div><div class="line"><a name="l01326"></a><span class="lineno"> 1326</span>&#160;   <a class="code" href="../../df/dd5/res__pjproject_8h.html#a92bc257bd72957f8aac77a9fcf64228e">ast_pjproject_get_buildopt</a>(<span class="stringliteral">&quot;PJ_MAX_HOSTNAME&quot;</span>, <span class="stringliteral">&quot;%d&quot;</span>, &amp;<a class="code" href="../../d3/db0/res__pjsip__registrar_8c.html#aab22b4013d9535ae373964bf042881aa">pj_max_hostname</a>);</div><div class="line"><a name="l01327"></a><span class="lineno"> 1327</span>&#160;   <span class="comment">/* As of pjproject 2.4.5, PJSIP_MAX_URL_SIZE isn&#39;t exposed yet but we try anyway. */</span></div><div class="line"><a name="l01328"></a><span class="lineno"> 1328</span>&#160;   <a class="code" href="../../df/dd5/res__pjproject_8h.html#a92bc257bd72957f8aac77a9fcf64228e">ast_pjproject_get_buildopt</a>(<span class="stringliteral">&quot;PJSIP_MAX_URL_SIZE&quot;</span>, <span class="stringliteral">&quot;%d&quot;</span>, &amp;<a class="code" href="../../d3/db0/res__pjsip__registrar_8c.html#a5712e22b675f8412b1a2e49acee9d5ff">pjsip_max_url_size</a>);</div><div class="line"><a name="l01329"></a><span class="lineno"> 1329</span>&#160;</div><div class="line"><a name="l01330"></a><span class="lineno"> 1330</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d8/d8c/res__pjsip_8h.html#a2d923ef44f62dffc05178f762b88f084">ast_sip_register_service</a>(&amp;registrar_module)) {</div><div class="line"><a name="l01331"></a><span class="lineno"> 1331</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../d5/d16/module_8h.html#adc09474f0ff557e9925b722ee5b952dfac742921e9f9512d28f62c74ea2affe57">AST_MODULE_LOAD_DECLINE</a>;</div><div class="line"><a name="l01332"></a><span class="lineno"> 1332</span>&#160;   }</div><div class="line"><a name="l01333"></a><span class="lineno"> 1333</span>&#160;</div><div class="line"><a name="l01334"></a><span class="lineno"> 1334</span>&#160;   <span class="keywordflow">if</span> (pjsip_endpt_add_capability(<a class="code" href="../../d8/d8c/res__pjsip_8h.html#a785afb501e315c8a97ad476fb6a8be1d">ast_sip_get_pjsip_endpoint</a>(), <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, PJSIP_H_ALLOW, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, 1, &amp;STR_REGISTER) != PJ_SUCCESS) {</div><div class="line"><a name="l01335"></a><span class="lineno"> 1335</span>&#160;      <a class="code" href="../../d8/d8c/res__pjsip_8h.html#a15aa09d9084763cdd20b7467a4cd381a">ast_sip_unregister_service</a>(&amp;registrar_module);</div><div class="line"><a name="l01336"></a><span class="lineno"> 1336</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../d5/d16/module_8h.html#adc09474f0ff557e9925b722ee5b952dfac742921e9f9512d28f62c74ea2affe57">AST_MODULE_LOAD_DECLINE</a>;</div><div class="line"><a name="l01337"></a><span class="lineno"> 1337</span>&#160;   }</div><div class="line"><a name="l01338"></a><span class="lineno"> 1338</span>&#160;</div><div class="line"><a name="l01339"></a><span class="lineno"> 1339</span>&#160;   <a class="code" href="../../db/d45/manager_8h.html#a5b63b8a8faede2d852e071e1f7b31c11">ast_manager_register_xml</a>(<a class="code" href="../../d3/db0/res__pjsip__registrar_8c.html#ac19bc2465164ac0a5beb5db3624d5c8e">AMI_SHOW_REGISTRATIONS</a>, <a class="code" href="../../db/d45/manager_8h.html#a420f0f755e1c3378b45ca7f6f0669ffa">EVENT_FLAG_SYSTEM</a>,</div><div class="line"><a name="l01340"></a><span class="lineno"> 1340</span>&#160;             <a class="code" href="../../d3/db0/res__pjsip__registrar_8c.html#aef91583c1a44bcbb095bfa1a7c64f26a">ami_show_registrations</a>);</div><div class="line"><a name="l01341"></a><span class="lineno"> 1341</span>&#160;   <a class="code" href="../../db/d45/manager_8h.html#a5b63b8a8faede2d852e071e1f7b31c11">ast_manager_register_xml</a>(<a class="code" href="../../d3/db0/res__pjsip__registrar_8c.html#a5099f04cc6c837b05cc6f6e4db154ead">AMI_SHOW_REGISTRATION_CONTACT_STATUSES</a>, <a class="code" href="../../db/d45/manager_8h.html#a420f0f755e1c3378b45ca7f6f0669ffa">EVENT_FLAG_SYSTEM</a>,</div><div class="line"><a name="l01342"></a><span class="lineno"> 1342</span>&#160;             <a class="code" href="../../d3/db0/res__pjsip__registrar_8c.html#a65525b2ea5b7969c74517c0c620418ad">ami_show_registration_contact_statuses</a>);</div><div class="line"><a name="l01343"></a><span class="lineno"> 1343</span>&#160;</div><div class="line"><a name="l01344"></a><span class="lineno"> 1344</span>&#160;   <a class="code" href="../../d8/d25/sorcery_8h.html#a6c1928d47eae1172f236e8ee421c2db4">ast_sorcery_observer_add</a>(<a class="code" href="../../d8/d8c/res__pjsip_8h.html#a5572d52daf1a841b0f9308df901448c8">ast_sip_get_sorcery</a>(), <span class="stringliteral">&quot;global&quot;</span>, &amp;expiration_global_observer);</div><div class="line"><a name="l01345"></a><span class="lineno"> 1345</span>&#160;   <a class="code" href="../../d8/d25/sorcery_8h.html#ad98ae6e153f53b0c3c40119acc5e5266">ast_sorcery_reload_object</a>(<a class="code" href="../../d8/d8c/res__pjsip_8h.html#a5572d52daf1a841b0f9308df901448c8">ast_sip_get_sorcery</a>(), <span class="stringliteral">&quot;global&quot;</span>);</div><div class="line"><a name="l01346"></a><span class="lineno"> 1346</span>&#160;</div><div class="line"><a name="l01347"></a><span class="lineno"> 1347</span>&#160;   <span class="keywordflow">return</span> <a class="code" href="../../d5/d16/module_8h.html#adc09474f0ff557e9925b722ee5b952dfa89bb877ade9ce418ad6663f3d936f314">AST_MODULE_LOAD_SUCCESS</a>;</div><div class="line"><a name="l01348"></a><span class="lineno"> 1348</span>&#160;}</div><div class="line"><a name="l01349"></a><span class="lineno"> 1349</span>&#160;</div><div class="line"><a name="l01350"></a><span class="lineno"><a class="line" href="../../d3/db0/res__pjsip__registrar_8c.html#ad09fa931f468002152a3cc2d5ce25eae"> 1350</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d3/db0/res__pjsip__registrar_8c.html#ad09fa931f468002152a3cc2d5ce25eae">unload_module</a>(<span class="keywordtype">void</span>)</div><div class="line"><a name="l01351"></a><span class="lineno"> 1351</span>&#160;{</div><div class="line"><a name="l01352"></a><span class="lineno"> 1352</span>&#160;   <span class="keywordflow">if</span> (check_thread != <a class="code" href="../../dd/d42/lock_8h.html#a6009440c7a72f8e2e3b1ec97641ad160">AST_PTHREADT_NULL</a>) {</div><div class="line"><a name="l01353"></a><span class="lineno"> 1353</span>&#160;      check_interval = 0;</div><div class="line"><a name="l01354"></a><span class="lineno"> 1354</span>&#160;      pthread_kill(check_thread, SIGURG);</div><div class="line"><a name="l01355"></a><span class="lineno"> 1355</span>&#160;      pthread_join(check_thread, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div><div class="line"><a name="l01356"></a><span class="lineno"> 1356</span>&#160;</div><div class="line"><a name="l01357"></a><span class="lineno"> 1357</span>&#160;      check_thread = <a class="code" href="../../dd/d42/lock_8h.html#a6009440c7a72f8e2e3b1ec97641ad160">AST_PTHREADT_NULL</a>;</div><div class="line"><a name="l01358"></a><span class="lineno"> 1358</span>&#160;   }</div><div class="line"><a name="l01359"></a><span class="lineno"> 1359</span>&#160;</div><div class="line"><a name="l01360"></a><span class="lineno"> 1360</span>&#160;   <a class="code" href="../../d8/d25/sorcery_8h.html#a18d64c360480b458754fc30f781d5011">ast_sorcery_observer_remove</a>(<a class="code" href="../../d8/d8c/res__pjsip_8h.html#a5572d52daf1a841b0f9308df901448c8">ast_sip_get_sorcery</a>(), <span class="stringliteral">&quot;global&quot;</span>, &amp;expiration_global_observer);</div><div class="line"><a name="l01361"></a><span class="lineno"> 1361</span>&#160;</div><div class="line"><a name="l01362"></a><span class="lineno"> 1362</span>&#160;   <a class="code" href="../../df/d72/group__Group__AMI.html#gafadf012f66a9fd7ecf985ec5b9dee101">ast_manager_unregister</a>(<a class="code" href="../../d3/db0/res__pjsip__registrar_8c.html#ac19bc2465164ac0a5beb5db3624d5c8e">AMI_SHOW_REGISTRATIONS</a>);</div><div class="line"><a name="l01363"></a><span class="lineno"> 1363</span>&#160;   <a class="code" href="../../df/d72/group__Group__AMI.html#gafadf012f66a9fd7ecf985ec5b9dee101">ast_manager_unregister</a>(<a class="code" href="../../d3/db0/res__pjsip__registrar_8c.html#a5099f04cc6c837b05cc6f6e4db154ead">AMI_SHOW_REGISTRATION_CONTACT_STATUSES</a>);</div><div class="line"><a name="l01364"></a><span class="lineno"> 1364</span>&#160;   <a class="code" href="../../d8/d8c/res__pjsip_8h.html#a15aa09d9084763cdd20b7467a4cd381a">ast_sip_unregister_service</a>(&amp;registrar_module);</div><div class="line"><a name="l01365"></a><span class="lineno"> 1365</span>&#160;   <a class="code" href="../../d8/d8c/res__pjsip_8h.html#a7e419c29ebfb010ca04b7c189c207bbd">ast_sip_transport_monitor_unregister_all</a>(<a class="code" href="../../d3/db0/res__pjsip__registrar_8c.html#ac663f457fa4f4fed9b201e8a82a36eb2">register_contact_transport_shutdown_cb</a>, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div><div class="line"><a name="l01366"></a><span class="lineno"> 1366</span>&#160;   <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l01367"></a><span class="lineno"> 1367</span>&#160;}</div><div class="line"><a name="l01368"></a><span class="lineno"> 1368</span>&#160;</div><div class="line"><a name="l01369"></a><span class="lineno"> 1369</span>&#160;<a class="code" href="../../d9/de9/res__phoneprov_8c.html#addaa208b0ed785225e24490fb9f28a80">AST_MODULE_INFO</a>(<a class="code" href="../../d5/d16/module_8h.html#aba2c8d4be709a254658b21a834f8294a">ASTERISK_GPL_KEY</a>, <a class="code" href="../../d5/d16/module_8h.html#a155a0df9c59e04e305d4a2fa3e35f843a12c3f60dd7655dfa8d4430cbf04b1223">AST_MODFLAG_LOAD_ORDER</a>, <span class="stringliteral">&quot;PJSIP Registrar Support&quot;</span>,</div><div class="line"><a name="l01370"></a><span class="lineno"> 1370</span>&#160;   .support_level = <a class="code" href="../../d5/d16/module_8h.html#ab35bc4efd9f79706300965c9d36a0ce5a634484c0074e7b6b630756fab09e2c15">AST_MODULE_SUPPORT_CORE</a>,</div><div class="line"><a name="l01371"></a><span class="lineno"> 1371</span>&#160;   .load = <a class="code" href="../../d3/db0/res__pjsip__registrar_8c.html#ac3382bf6da54c56b37069bd76bbdf4f9">load_module</a>,</div><div class="line"><a name="l01372"></a><span class="lineno"> 1372</span>&#160;   .unload = <a class="code" href="../../d3/db0/res__pjsip__registrar_8c.html#ad09fa931f468002152a3cc2d5ce25eae">unload_module</a>,</div><div class="line"><a name="l01373"></a><span class="lineno"> 1373</span>&#160;   .load_pri = <a class="code" href="../../d5/d16/module_8h.html#aa4f734041ffd9d75b07cefb0291e1e58a87717b8c3b913bbbb55297fc169086e0">AST_MODPRI_CHANNEL_DEPEND</a> - 3,</div><div class="line"><a name="l01374"></a><span class="lineno"> 1374</span>&#160;   .requires = <span class="stringliteral">&quot;res_pjproject,res_pjsip&quot;</span>,</div><div class="line"><a name="l01375"></a><span class="lineno"><a class="line" href="../../d3/db0/res__pjsip__registrar_8c.html#a4fb0aca9bbcdb9709fa52a70aded6cae"> 1375</a></span>&#160;);</div><div class="ttc" id="res__pjsip__registrar_8c_html_ac3382bf6da54c56b37069bd76bbdf4f9"><div class="ttname"><a href="../../d3/db0/res__pjsip__registrar_8c.html#ac3382bf6da54c56b37069bd76bbdf4f9">load_module</a></div><div class="ttdeci">static int load_module(void)</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/db0/res__pjsip__registrar_8c_source.html#l01322">res_pjsip_registrar.c:1322</a></div></div>
<div class="ttc" id="vector_8h_html_a66aaa4efda59c52384b03c38e781124d"><div class="ttname"><a href="../../d6/d68/vector_8h.html#a66aaa4efda59c52384b03c38e781124d">AST_VECTOR_FREE</a></div><div class="ttdeci">#define AST_VECTOR_FREE(vec)</div><div class="ttdoc">Deallocates this vector. </div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d68/vector_8h_source.html#l00174">vector.h:174</a></div></div>
<div class="ttc" id="chan__ooh323_8c_html_a4d63fdfe5451ec2248c16a2739190c56"><div class="ttname"><a href="../../d7/d49/chan__ooh323_8c.html#a4d63fdfe5451ec2248c16a2739190c56">type</a></div><div class="ttdeci">static const char type[]</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d49/chan__ooh323_8c_source.html#l00109">chan_ooh323.c:109</a></div></div>
<div class="ttc" id="structast__sip__contact_html_aceb8cd1d19b9020476de70a5d9d38809"><div class="ttname"><a href="../../d8/d8a/structast__sip__contact.html#aceb8cd1d19b9020476de70a5d9d38809">ast_sip_contact::authenticate_qualify</a></div><div class="ttdeci">int authenticate_qualify</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d8c/res__pjsip_8h_source.html#l00309">res_pjsip.h:309</a></div></div>
<div class="ttc" id="vector_8h_html_a8418853c95c2093a85174233f0ef4827"><div class="ttname"><a href="../../d6/d68/vector_8h.html#a8418853c95c2093a85174233f0ef4827">AST_VECTOR_ADD_SORTED</a></div><div class="ttdeci">#define AST_VECTOR_ADD_SORTED(vec, elem, cmp)</div><div class="ttdoc">Add an element into a sorted vector. </div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d68/vector_8h_source.html#l00371">vector.h:371</a></div></div>
<div class="ttc" id="structmessage_html"><div class="ttname"><a href="../../d8/d9e/structmessage.html">message</a></div><div class="ttdef"><b>Definition:</b> <a href="../../db/d45/manager_8h_source.html#l00144">manager.h:144</a></div></div>
<div class="ttc" id="res__pjsip__registrar_8c_html_aab4e076fd9f059f6eed2ac6027807cb3"><div class="ttname"><a href="../../d3/db0/res__pjsip__registrar_8c.html#aab4e076fd9f059f6eed2ac6027807cb3">AST_VECTOR</a></div><div class="ttdeci">AST_VECTOR(excess_contact_vector, struct ast_sip_contact *)</div></div>
<div class="ttc" id="res__pjsip__registrar_8c_html_a59440daf72ccd107300be15c516373bd"><div class="ttname"><a href="../../d3/db0/res__pjsip__registrar_8c.html#a59440daf72ccd107300be15c516373bd">check_thread</a></div><div class="ttdeci">static pthread_t check_thread</div><div class="ttdoc">Thread keeping things alive. </div><div class="ttdef"><b>Definition:</b> <a href="../../d3/db0/res__pjsip__registrar_8c_source.html#l01236">res_pjsip_registrar.c:1236</a></div></div>
<div class="ttc" id="res__pjsip__registrar_8c_html_a88655efef49d2d5933795f840432084f"><div class="ttname"><a href="../../d3/db0/res__pjsip__registrar_8c.html#a88655efef49d2d5933795f840432084f">registrar_on_rx_request</a></div><div class="ttdeci">static pj_bool_t registrar_on_rx_request(struct pjsip_rx_data *rdata)</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/db0/res__pjsip__registrar_8c_source.html#l01076">res_pjsip_registrar.c:1076</a></div></div>
<div class="ttc" id="group__Group__AMI_html_gac2d42f7be13c532b6a70d50f1b8983d2"><div class="ttname"><a href="../../df/d72/group__Group__AMI.html#gac2d42f7be13c532b6a70d50f1b8983d2">astman_append</a></div><div class="ttdeci">void astman_append(struct mansession *s, const char *fmt,...)</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d10/manager_8c_source.html#l03080">manager.c:3080</a></div></div>
<div class="ttc" id="asterisk_8h_html"><div class="ttname"><a href="../../db/db2/asterisk_8h.html">asterisk.h</a></div><div class="ttdoc">Asterisk main include file. File version handling, generic pbx functions. </div></div>
<div class="ttc" id="structast__sip__aor_html"><div class="ttname"><a href="../../d4/d03/structast__sip__aor.html">ast_sip_aor</a></div><div class="ttdoc">A SIP address of record. </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d8c/res__pjsip_8h_source.html#l00361">res_pjsip.h:361</a></div></div>
<div class="ttc" id="astobj2_8h_html_a512cc40ce96c63b3d5c78040baa4c9cd"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#a512cc40ce96c63b3d5c78040baa4c9cd">ao2_container_count</a></div><div class="ttdeci">int ao2_container_count(struct ao2_container *c)</div><div class="ttdoc">Returns the number of elements in a container. </div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d22/astobj2__container_8c_source.html#l00034">astobj2_container.c:34</a></div></div>
<div class="ttc" id="res__pjsip_8h_html_a4a6f16128f131ec8feae5dc0f8545b2f"><div class="ttname"><a href="../../d8/d8c/res__pjsip_8h.html#a4a6f16128f131ec8feae5dc0f8545b2f">ast_sip_for_each_aor</a></div><div class="ttdeci">int ast_sip_for_each_aor(const char *aors, ao2_callback_fn on_aor, void *arg)</div><div class="ttdoc">For every aor in the comma separated aors string call the given &amp;#39;on_aor&amp;#39; handler. ...</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/dad/location_8c_source.html#l00684">location.c:684</a></div></div>
<div class="ttc" id="res__pjsip_8h_html_a5f4e724ff69a0fdf9f6c471ac888e204"><div class="ttname"><a href="../../d8/d8c/res__pjsip_8h.html#a5f4e724ff69a0fdf9f6c471ac888e204">ast_sip_location_retrieve_aor_contacts_nolock</a></div><div class="ttdeci">struct ao2_container * ast_sip_location_retrieve_aor_contacts_nolock(const struct ast_sip_aor *aor)</div><div class="ttdoc">Retrieve all contacts currently available for an AOR without locking the AOR. </div><div class="ttdef"><b>Definition:</b> <a href="../../d0/dad/location_8c_source.html#l00214">location.c:214</a></div></div>
<div class="ttc" id="astobj2_8h_html_a2cf7e3433f08351aafe3b0cd31edf7f8a23b60f2636bcfbc4dfeea6cc21bf847b"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#a2cf7e3433f08351aafe3b0cd31edf7f8a23b60f2636bcfbc4dfeea6cc21bf847b">AO2_ALLOC_OPT_LOCK_NOLOCK</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l00369">astobj2.h:369</a></div></div>
<div class="ttc" id="res__pjsip__registrar_8c_html_af0d1d79e501090634be170620bae20cf"><div class="ttname"><a href="../../d3/db0/res__pjsip__registrar_8c.html#af0d1d79e501090634be170620bae20cf">registrar_delete_contact</a></div><div class="ttdeci">static int registrar_delete_contact(void *obj, void *arg, int flags)</div><div class="ttdoc">Internal function used to delete a contact from an AOR. </div><div class="ttdef"><b>Definition:</b> <a href="../../d3/db0/res__pjsip__registrar_8c_source.html#l00216">res_pjsip_registrar.c:216</a></div></div>
<div class="ttc" id="module_8h_html_adc09474f0ff557e9925b722ee5b952dfa89bb877ade9ce418ad6663f3d936f314"><div class="ttname"><a href="../../d5/d16/module_8h.html#adc09474f0ff557e9925b722ee5b952dfa89bb877ade9ce418ad6663f3d936f314">AST_MODULE_LOAD_SUCCESS</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d16/module_8h_source.html#l00070">module.h:70</a></div></div>
<div class="ttc" id="module_8h_html_ab35bc4efd9f79706300965c9d36a0ce5a634484c0074e7b6b630756fab09e2c15"><div class="ttname"><a href="../../d5/d16/module_8h.html#ab35bc4efd9f79706300965c9d36a0ce5a634484c0074e7b6b630756fab09e2c15">AST_MODULE_SUPPORT_CORE</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d16/module_8h_source.html#l00121">module.h:121</a></div></div>
<div class="ttc" id="res__pjsip__registrar_8c_html_a93c22b96390b4c815ec199eebcbdc07e"><div class="ttname"><a href="../../d3/db0/res__pjsip__registrar_8c.html#a93c22b96390b4c815ec199eebcbdc07e">register_aor</a></div><div class="ttdeci">static int register_aor(pjsip_rx_data *rdata, struct ast_sip_endpoint *endpoint, struct ast_sip_aor *aor, const char *aor_name)</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/db0/res__pjsip__registrar_8c_source.html#l00900">res_pjsip_registrar.c:900</a></div></div>
<div class="ttc" id="include_2asterisk_2config_8h_html_adea5390496e5477192d86f340d512d04"><div class="ttname"><a href="../../d3/de6/include_2asterisk_2config_8h.html#adea5390496e5477192d86f340d512d04">ast_variables_destroy</a></div><div class="ttdeci">void ast_variables_destroy(struct ast_variable *var)</div><div class="ttdoc">Free variable list. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/dc5/extconf_8c_source.html#l01263">extconf.c:1263</a></div></div>
<div class="ttc" id="structast__sip__contact_html_a71e59257a329fbb031e9fc17eaca0922"><div class="ttname"><a href="../../d8/d8a/structast__sip__contact.html#a71e59257a329fbb031e9fc17eaca0922">ast_sip_contact::call_id</a></div><div class="ttdeci">const ast_string_field call_id</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d8c/res__pjsip_8h_source.html#l00303">res_pjsip.h:303</a></div></div>
<div class="ttc" id="structast__sip__contact_html_ad6233310a4cab812bbccf98b823aa039"><div class="ttname"><a href="../../d8/d8a/structast__sip__contact.html#ad6233310a4cab812bbccf98b823aa039">ast_sip_contact::user_agent</a></div><div class="ttdeci">const ast_string_field user_agent</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d8c/res__pjsip_8h_source.html#l00303">res_pjsip.h:303</a></div></div>
<div class="ttc" id="structast__sip__ami_html_ad43c3812e6d13e0518d9f8b8f463ffcf"><div class="ttname"><a href="../../d4/d2f/structast__sip__ami.html#ad43c3812e6d13e0518d9f8b8f463ffcf">ast_sip_ami::count</a></div><div class="ttdeci">int count</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d8c/res__pjsip_8h_source.html#l02747">res_pjsip.h:2747</a></div></div>
<div class="ttc" id="structast__sip__contact_html_aaeae1324cdfad45634df796a27bb37ac"><div class="ttname"><a href="../../d8/d8a/structast__sip__contact.html#aaeae1324cdfad45634df796a27bb37ac">ast_sip_contact::path</a></div><div class="ttdeci">const ast_string_field path</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d8c/res__pjsip_8h_source.html#l00303">res_pjsip.h:303</a></div></div>
<div class="ttc" id="res__pjsip__registrar_8c_html_ac315187e196c9ec42b2cba439d633e43"><div class="ttname"><a href="../../d3/db0/res__pjsip__registrar_8c.html#ac315187e196c9ec42b2cba439d633e43">registrar_add_non_permanent</a></div><div class="ttdeci">static int registrar_add_non_permanent(void *obj, void *arg, int flags)</div><div class="ttdoc">Callback function which adds non-permanent contacts to a container. </div><div class="ttdef"><b>Definition:</b> <a href="../../d3/db0/res__pjsip__registrar_8c_source.html#l00563">res_pjsip_registrar.c:563</a></div></div>
<div class="ttc" id="structast__sip__ami_html_ac0506a88d121327118c7346baa303a9e"><div class="ttname"><a href="../../d4/d2f/structast__sip__ami.html#ac0506a88d121327118c7346baa303a9e">ast_sip_ami::m</a></div><div class="ttdeci">const struct message * m</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d8c/res__pjsip_8h_source.html#l02741">res_pjsip.h:2741</a></div></div>
<div class="ttc" id="eagi__proxy_8c_html_ac95651d79c608a3148973b5b1fc9e525"><div class="ttname"><a href="../../dd/d7c/eagi__proxy_8c.html#ac95651d79c608a3148973b5b1fc9e525">buf</a></div><div class="ttdeci">char buf[BUFSIZE]</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d7c/eagi__proxy_8c_source.html#l00066">eagi_proxy.c:66</a></div></div>
<div class="ttc" id="structast__sip__contact_html_a08e0b4a94cab7d431f1717d53d619447"><div class="ttname"><a href="../../d8/d8a/structast__sip__contact.html#a08e0b4a94cab7d431f1717d53d619447">ast_sip_contact::prune_on_boot</a></div><div class="ttdeci">int prune_on_boot</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d8c/res__pjsip_8h_source.html#l00317">res_pjsip.h:317</a></div></div>
<div class="ttc" id="astobj2_8h_html_ad9d009e87e737af900825b36db55a35ca5fc59b193d86a0a8ddfe866304be829d"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#ad9d009e87e737af900825b36db55a35ca5fc59b193d86a0a8ddfe866304be829d">OBJ_NODATA</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l01048">astobj2.h:1048</a></div></div>
<div class="ttc" id="res__pjsip__private_8h_html"><div class="ttname"><a href="../../d7/d5c/res__pjsip__private_8h.html">res_pjsip_private.h</a></div></div>
<div class="ttc" id="structast__sip__aor_html_a3d1288cbe35da9b1ec246ce65c8a9707"><div class="ttname"><a href="../../d4/d03/structast__sip__aor.html#a3d1288cbe35da9b1ec246ce65c8a9707">ast_sip_aor::max_contacts</a></div><div class="ttdeci">unsigned int max_contacts</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d8c/res__pjsip_8h_source.html#l00379">res_pjsip.h:379</a></div></div>
<div class="ttc" id="group__Group__AMI_html_ga58c3e3da5d31739cafaee1df6ddf9342"><div class="ttname"><a href="../../df/d72/group__Group__AMI.html#ga58c3e3da5d31739cafaee1df6ddf9342">astman_send_list_complete_start</a></div><div class="ttdeci">void astman_send_list_complete_start(struct mansession *s, const struct message *m, const char *event_name, int count)</div><div class="ttdoc">Start the list complete event. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d10/manager_8c_source.html#l03237">manager.c:3237</a></div></div>
<div class="ttc" id="res__pjsip__registrar_8c_html_a2f0a330bc3afc51021a3b0d66e149f4d"><div class="ttname"><a href="../../d3/db0/res__pjsip__registrar_8c.html#a2f0a330bc3afc51021a3b0d66e149f4d">match_aor</a></div><div class="ttdeci">static int match_aor(const char *aor_name, const char *id)</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/db0/res__pjsip__registrar_8c_source.html#l00933">res_pjsip_registrar.c:933</a></div></div>
<div class="ttc" id="res__pjsip__registrar_8c_html_a3d722c6a391db4ea0d1e659467863b0e"><div class="ttname"><a href="../../d3/db0/res__pjsip__registrar_8c.html#a3d722c6a391db4ea0d1e659467863b0e">build_path_data</a></div><div class="ttdeci">static int build_path_data(pjsip_rx_data *rdata, struct ast_str **path_str)</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/db0/res__pjsip__registrar_8c_source.html#l00252">res_pjsip_registrar.c:252</a></div></div>
<div class="ttc" id="logger_8h_html_adf4476a6a4ea6c74231c826e899d7189"><div class="ttname"><a href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a></div><div class="ttdeci">#define LOG_WARNING</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d8c/logger_8h_source.html#l00274">logger.h:274</a></div></div>
<div class="ttc" id="structast__sip__contact__wrapper_html_a08490ce2b49a613ace5351f00c7c36ab"><div class="ttname"><a href="../../df/dd8/structast__sip__contact__wrapper.html#a08490ce2b49a613ace5351f00c7c36ab">ast_sip_contact_wrapper::contact_id</a></div><div class="ttdeci">char * contact_id</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d8c/res__pjsip_8h_source.html#l00400">res_pjsip.h:400</a></div></div>
<div class="ttc" id="res__pjsip__registrar_8c_html_a813499cc6957f3337adade576d82e5b0"><div class="ttname"><a href="../../d3/db0/res__pjsip__registrar_8c.html#a813499cc6957f3337adade576d82e5b0">find_aor_name</a></div><div class="ttdeci">static char * find_aor_name(const pj_str_t *pj_username, const pj_str_t *pj_domain, const char *aors)</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/db0/res__pjsip__registrar_8c_source.html#l00947">res_pjsip_registrar.c:947</a></div></div>
<div class="ttc" id="structast__sip__contact_html_a526207204e5f599fb9a618d9f8001ca2"><div class="ttname"><a href="../../d8/d8a/structast__sip__contact.html#a526207204e5f599fb9a618d9f8001ca2">ast_sip_contact::via_addr</a></div><div class="ttdeci">const ast_string_field via_addr</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d8c/res__pjsip_8h_source.html#l00303">res_pjsip.h:303</a></div></div>
<div class="ttc" id="strings_8h_html_a1ef7e2644ca7258070db316fdc0a465b"><div class="ttname"><a href="../../d6/d90/strings_8h.html#a1ef7e2644ca7258070db316fdc0a465b">ast_str_buffer</a></div><div class="ttdeci">char * ast_str_buffer(const struct ast_str *buf)</div><div class="ttdoc">Returns the string buffer within the ast_str buf. </div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d90/strings_8h_source.html#l00714">strings.h:714</a></div></div>
<div class="ttc" id="structaor__core__response_html_a3753fea80c98c041cd89012ca2599cbd"><div class="ttname"><a href="../../db/d19/structaor__core__response.html#a3753fea80c98c041cd89012ca2599cbd">aor_core_response::tdata</a></div><div class="ttdeci">pjsip_tx_data * tdata</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/db0/res__pjsip__registrar_8c_source.html#l00579">res_pjsip_registrar.c:579</a></div></div>
<div class="ttc" id="res__pjsip__registrar_8c_html_a5712e22b675f8412b1a2e49acee9d5ff"><div class="ttname"><a href="../../d3/db0/res__pjsip__registrar_8c.html#a5712e22b675f8412b1a2e49acee9d5ff">pjsip_max_url_size</a></div><div class="ttdeci">static int pjsip_max_url_size</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/db0/res__pjsip__registrar_8c_source.html#l00081">res_pjsip_registrar.c:81</a></div></div>
<div class="ttc" id="astobj2_8h_html_a47857055118a703ae87ea5ebaf4842ed"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#a47857055118a703ae87ea5ebaf4842ed">ao2_callback</a></div><div class="ttdeci">#define ao2_callback(c, flags, cb_fn, arg)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l01716">astobj2.h:1716</a></div></div>
<div class="ttc" id="logger_8h_html_a7d52159deec8b3179d27fcb4d39c30d2"><div class="ttname"><a href="../../d1/d8c/logger_8h.html#a7d52159deec8b3179d27fcb4d39c30d2">VERBOSITY_ATLEAST</a></div><div class="ttdeci">#define VERBOSITY_ATLEAST(level)</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d8c/logger_8h_source.html#l00461">logger.h:461</a></div></div>
<div class="ttc" id="structast__sip__ami_html_a9ce2ec4812a92cb6ab39f6e81e9173a9"><div class="ttname"><a href="../../d4/d2f/structast__sip__ami.html#a9ce2ec4812a92cb6ab39f6e81e9173a9">ast_sip_ami::arg</a></div><div class="ttdeci">void * arg</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d8c/res__pjsip_8h_source.html#l02745">res_pjsip.h:2745</a></div></div>
<div class="ttc" id="structast__sip__ami_html"><div class="ttname"><a href="../../d4/d2f/structast__sip__ami.html">ast_sip_ami</a></div><div class="ttdoc">AMI variable container. </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d8c/res__pjsip_8h_source.html#l02737">res_pjsip.h:2737</a></div></div>
<div class="ttc" id="astobj2_8h_html_add41bd9979cb8642f81dd38aa2dfcd6d"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#add41bd9979cb8642f81dd38aa2dfcd6d">ao2_container_alloc_list</a></div><div class="ttdeci">#define ao2_container_alloc_list(ao2_options, container_options, sort_fn, cmp_fn)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l01335">astobj2.h:1335</a></div></div>
<div class="ttc" id="structast__sip__contact__wrapper_html_aada96c4dcf837c70c990bed754148422"><div class="ttname"><a href="../../df/dd8/structast__sip__contact__wrapper.html#aada96c4dcf837c70c990bed754148422">ast_sip_contact_wrapper::aor_id</a></div><div class="ttdeci">char * aor_id</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d8c/res__pjsip_8h_source.html#l00398">res_pjsip.h:398</a></div></div>
<div class="ttc" id="structast__variable_html"><div class="ttname"><a href="../../dd/d02/structast__variable.html">ast_variable</a></div><div class="ttdoc">Structure for variables, used for configurations and for channel variables. </div><div class="ttdef"><b>Definition:</b> <a href="../../d3/de6/include_2asterisk_2config_8h_source.html#l00083">include/asterisk/config.h:83</a></div></div>
<div class="ttc" id="ast__expr2f_8c_html_a1b0936415a643c88ce543099c10e0d7f"><div class="ttname"><a href="../../dc/df2/ast__expr2f_8c.html#a1b0936415a643c88ce543099c10e0d7f">var</a></div><div class="ttdeci">#define var</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/df2/ast__expr2f_8c_source.html#l00614">ast_expr2f.c:614</a></div></div>
<div class="ttc" id="time_8h_html_a4e7b3508884147c7991a68361ac781a2"><div class="ttname"><a href="../../de/df7/time_8h.html#a4e7b3508884147c7991a68361ac781a2">ast_tvzero</a></div><div class="ttdeci">int ast_tvzero(const struct timeval t)</div><div class="ttdoc">Returns true if the argument is 0,0. </div><div class="ttdef"><b>Definition:</b> <a href="../../de/df7/time_8h_source.html#l00108">time.h:108</a></div></div>
<div class="ttc" id="test_8h_html"><div class="ttname"><a href="../../d2/ddc/test_8h.html">test.h</a></div><div class="ttdoc">Test Framework API. </div></div>
<div class="ttc" id="sorcery_8h_html_a320e98591a38316a313a3ca83ea8df20a643c7c50af2691bb16052509d47b61cd"><div class="ttname"><a href="../../d8/d25/sorcery_8h.html#a320e98591a38316a313a3ca83ea8df20a643c7c50af2691bb16052509d47b61cd">AST_RETRIEVE_FLAG_ALL</a></div><div class="ttdoc">Perform no matching, return all objects. </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d25/sorcery_8h_source.html#l00123">sorcery.h:123</a></div></div>
<div class="ttc" id="res__pjsip__registrar_8c_html_ad09fa931f468002152a3cc2d5ce25eae"><div class="ttname"><a href="../../d3/db0/res__pjsip__registrar_8c.html#ad09fa931f468002152a3cc2d5ce25eae">unload_module</a></div><div class="ttdeci">static int unload_module(void)</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/db0/res__pjsip__registrar_8c_source.html#l01350">res_pjsip_registrar.c:1350</a></div></div>
<div class="ttc" id="sorcery_8h_html_a83eba565782cb769634180b88db29d45"><div class="ttname"><a href="../../d8/d25/sorcery_8h.html#a83eba565782cb769634180b88db29d45">ast_sorcery_object_id_compare</a></div><div class="ttdeci">int ast_sorcery_object_id_compare(void *obj, void *arg, int flags)</div><div class="ttdoc">ao2 object comparator based on sorcery id. </div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d69/sorcery_8c_source.html#l02459">sorcery.c:2459</a></div></div>
<div class="ttc" id="res__pjsip__registrar_8c_html_a600472167faf6e00d346580877861570"><div class="ttname"><a href="../../d3/db0/res__pjsip__registrar_8c.html#a600472167faf6e00d346580877861570">registrar_find_contact</a></div><div class="ttdeci">static int registrar_find_contact(void *obj, void *arg, int flags)</div><div class="ttdoc">Callback function for finding a contact. </div><div class="ttdef"><b>Definition:</b> <a href="../../d3/db0/res__pjsip__registrar_8c_source.html#l00121">res_pjsip_registrar.c:121</a></div></div>
<div class="ttc" id="module_8h_html_aa4f734041ffd9d75b07cefb0291e1e58a87717b8c3b913bbbb55297fc169086e0"><div class="ttname"><a href="../../d5/d16/module_8h.html#aa4f734041ffd9d75b07cefb0291e1e58a87717b8c3b913bbbb55297fc169086e0">AST_MODPRI_CHANNEL_DEPEND</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d16/module_8h_source.html#l00326">module.h:326</a></div></div>
<div class="ttc" id="strings_8h_html_a1088afdd862a49b0fce34ebe02df8ca1"><div class="ttname"><a href="../../d6/d90/strings_8h.html#a1088afdd862a49b0fce34ebe02df8ca1">ast_str_append</a></div><div class="ttdeci">int ast_str_append(struct ast_str **buf, ssize_t max_len, const char *fmt,...)</div><div class="ttdoc">Append to a thread local dynamic string. </div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d90/strings_8h_source.html#l01091">strings.h:1091</a></div></div>
<div class="ttc" id="structast__sip__contact_html_afbb1dc2791b27417c95a4ff1693fa44b"><div class="ttname"><a href="../../d8/d8a/structast__sip__contact.html#afbb1dc2791b27417c95a4ff1693fa44b">ast_sip_contact::qualify_frequency</a></div><div class="ttdeci">unsigned int qualify_frequency</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d8c/res__pjsip_8h_source.html#l00307">res_pjsip.h:307</a></div></div>
<div class="ttc" id="res__pjsip__registrar_8c_html_a89a4d689c6439721eeb087591f4a97a3"><div class="ttname"><a href="../../d3/db0/res__pjsip__registrar_8c.html#a89a4d689c6439721eeb087591f4a97a3">registrar_get_expiration</a></div><div class="ttdeci">static unsigned int registrar_get_expiration(const struct ast_sip_aor *aor, const pjsip_contact_hdr *contact, const pjsip_rx_data *rdata)</div><div class="ttdoc">Internal function which returns the expiration time for a contact. </div><div class="ttdef"><b>Definition:</b> <a href="../../d3/db0/res__pjsip__registrar_8c_source.html#l00084">res_pjsip_registrar.c:84</a></div></div>
<div class="ttc" id="astobj2_8h_html_ad36841ab6daa3997f7ca7047ad2d033a"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#ad36841ab6daa3997f7ca7047ad2d033a">ao2_iterator_destroy</a></div><div class="ttdeci">void ao2_iterator_destroy(struct ao2_iterator *iter)</div><div class="ttdoc">Destroy a container iterator. </div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d22/astobj2__container_8c_source.html#l00534">astobj2_container.c:534</a></div></div>
<div class="ttc" id="time_8h_html_ad3899efb6f0e348556ef69f5b16aa7f7"><div class="ttname"><a href="../../de/df7/time_8h.html#ad3899efb6f0e348556ef69f5b16aa7f7">ast_tvnow</a></div><div class="ttdeci">struct timeval ast_tvnow(void)</div><div class="ttdoc">Returns current timeval. Meant to replace calls to gettimeofday(). </div><div class="ttdef"><b>Definition:</b> <a href="../../de/df7/time_8h_source.html#l00150">time.h:150</a></div></div>
<div class="ttc" id="sorcery_8h_html_a320e98591a38316a313a3ca83ea8df20a019a4a531b83f4ab0b35a3c788bf8d55"><div class="ttname"><a href="../../d8/d25/sorcery_8h.html#a320e98591a38316a313a3ca83ea8df20a019a4a531b83f4ab0b35a3c788bf8d55">AST_RETRIEVE_FLAG_MULTIPLE</a></div><div class="ttdoc">Return all matching objects. </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d25/sorcery_8h_source.html#l00120">sorcery.h:120</a></div></div>
<div class="ttc" id="utils_8h_html_a24374da24af1931d8a7ccde5b352bb2c"><div class="ttname"><a href="../../d5/d60/utils_8h.html#a24374da24af1931d8a7ccde5b352bb2c">ast_assert</a></div><div class="ttdeci">#define ast_assert(a)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d60/utils_8h_source.html#l00695">utils.h:695</a></div></div>
<div class="ttc" id="res__pjsip__registrar_8c_html_adef72ee13873b9570a83cde69c1d8a37"><div class="ttname"><a href="../../d3/db0/res__pjsip__registrar_8c.html#adef72ee13873b9570a83cde69c1d8a37">contact_transport_monitor_matcher</a></div><div class="ttdeci">static int contact_transport_monitor_matcher(void *a, void *b)</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/db0/res__pjsip__registrar_8c_source.html#l00321">res_pjsip_registrar.c:321</a></div></div>
<div class="ttc" id="astobj2_8h_html_a9998bd156b936636a8780385e9a910b2"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#a9998bd156b936636a8780385e9a910b2">ao2_unlock</a></div><div class="ttdeci">#define ao2_unlock(a)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l00730">astobj2.h:730</a></div></div>
<div class="ttc" id="res__pjproject_8h_html_a92bc257bd72957f8aac77a9fcf64228e"><div class="ttname"><a href="../../df/dd5/res__pjproject_8h.html#a92bc257bd72957f8aac77a9fcf64228e">ast_pjproject_get_buildopt</a></div><div class="ttdeci">int ast_pjproject_get_buildopt(char *option, char *format_string,...)</div><div class="ttdoc">Retrieve a pjproject build option. </div><div class="ttdef"><b>Definition:</b> <a href="../../de/deb/res__pjproject_8c_source.html#l00246">res_pjproject.c:246</a></div></div>
<div class="ttc" id="time_8h_html_aca4ecdab7d8d3519062aad9a90fcb29d"><div class="ttname"><a href="../../de/df7/time_8h.html#aca4ecdab7d8d3519062aad9a90fcb29d">ast_tvdiff_ms</a></div><div class="ttdeci">int64_t ast_tvdiff_ms(struct timeval end, struct timeval start)</div><div class="ttdoc">Computes the difference (in milliseconds) between two struct timeval instances. </div><div class="ttdef"><b>Definition:</b> <a href="../../de/df7/time_8h_source.html#l00098">time.h:98</a></div></div>
<div class="ttc" id="astmm_8h_html_ab263849d03fb892847be4986db759737"><div class="ttname"><a href="../../d8/d8a/astmm_8h.html#ab263849d03fb892847be4986db759737">ast_strdup</a></div><div class="ttdeci">#define ast_strdup(str)</div><div class="ttdoc">A wrapper for strdup() </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d8a/astmm_8h_source.html#l00243">astmm.h:243</a></div></div>
<div class="ttc" id="res__pjsip_8h_html_a7da3e1f7ee3fcb77f29d41a76a7528fe"><div class="ttname"><a href="../../d8/d8c/res__pjsip_8h.html#a7da3e1f7ee3fcb77f29d41a76a7528fe">ast_copy_pj_str</a></div><div class="ttdeci">void ast_copy_pj_str(char *dest, const pj_str_t *src, size_t size)</div><div class="ttdoc">Copy a pj_str_t into a standard character buffer. </div><div class="ttdef"><b>Definition:</b> <a href="../../de/d96/res__pjsip_8c_source.html#l05240">res_pjsip.c:5240</a></div></div>
<div class="ttc" id="res__pjsip__registrar_8c_html_a2ecd45d304041048628823fa87f43a90"><div class="ttname"><a href="../../d3/db0/res__pjsip__registrar_8c.html#a2ecd45d304041048628823fa87f43a90">remove_excess_contacts</a></div><div class="ttdeci">static void remove_excess_contacts(struct ao2_container *contacts, struct ao2_container *response_contacts, unsigned int to_remove)</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/db0/res__pjsip__registrar_8c_source.html#l00523">res_pjsip_registrar.c:523</a></div></div>
<div class="ttc" id="res__pjsip_8h_html_ae72306865fa2a2ed587acdd916c874c8"><div class="ttname"><a href="../../d8/d8c/res__pjsip_8h.html#ae72306865fa2a2ed587acdd916c874c8">ast_sip_contact_to_str</a></div><div class="ttdeci">int ast_sip_contact_to_str(void *object, void *arg, int flags)</div><div class="ttdoc">Handler used to convert a contact to a string. </div><div class="ttdef"><b>Definition:</b> <a href="../../d0/dad/location_8c_source.html#l00767">location.c:767</a></div></div>
<div class="ttc" id="structast__sip__contact_html_ad560d6e3eaa972115c360eeae000b25b"><div class="ttname"><a href="../../d8/d8a/structast__sip__contact.html#ad560d6e3eaa972115c360eeae000b25b">ast_sip_contact::reg_server</a></div><div class="ttdeci">const ast_string_field reg_server</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d8c/res__pjsip_8h_source.html#l00303">res_pjsip.h:303</a></div></div>
<div class="ttc" id="resample_8c_html_a070d2ce7b6bb7e5c05602aa8c308d0c4"><div class="ttname"><a href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a></div><div class="ttdeci">#define NULL</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d7f/resample_8c_source.html#l00096">resample.c:96</a></div></div>
<div class="ttc" id="structdomain_html"><div class="ttname"><a href="../../dd/dac/structdomain.html">domain</a></div><div class="ttdoc">Domain data structure. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d94/sip_8h_source.html#l00888">sip.h:888</a></div></div>
<div class="ttc" id="res__pjsip__registrar_8c_html_aa0b6ec2978c63b269ea90927f085c0d8a50feb257eddbe7969373b856facc714d"><div class="ttname"><a href="../../d3/db0/res__pjsip__registrar_8c.html#aa0b6ec2978c63b269ea90927f085c0d8a50feb257eddbe7969373b856facc714d">CONTACT_DELETE_ERROR</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d3/db0/res__pjsip__registrar_8c_source.html#l00205">res_pjsip_registrar.c:205</a></div></div>
<div class="ttc" id="res__pjsip__registrar_8c_html_a0b9632debb5437504806a0c988ff212d"><div class="ttname"><a href="../../d3/db0/res__pjsip__registrar_8c.html#a0b9632debb5437504806a0c988ff212d">vec_contact_cmp</a></div><div class="ttdeci">static int vec_contact_cmp(struct ast_sip_contact *left, struct ast_sip_contact *right)</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/db0/res__pjsip__registrar_8c_source.html#l00480">res_pjsip_registrar.c:480</a></div></div>
<div class="ttc" id="astobj2_8h_html_ad9d009e87e737af900825b36db55a35ca71f42ec6460e60eb6e10956c53329e45"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#ad9d009e87e737af900825b36db55a35ca71f42ec6460e60eb6e10956c53329e45">OBJ_UNLINK</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l01043">astobj2.h:1043</a></div></div>
<div class="ttc" id="logger_8h_html_ad770f83c71e237e1f64163358ce4e13d"><div class="ttname"><a href="../../d1/d8c/logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a></div><div class="ttdeci">#define ast_verb(level,...)</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d8c/logger_8h_source.html#l00463">logger.h:463</a></div></div>
<div class="ttc" id="structregistrar__contact__details_html_ac43e5728c2093e52e8a06774ab68afe2"><div class="ttname"><a href="../../d6/dcf/structregistrar__contact__details.html#ac43e5728c2093e52e8a06774ab68afe2">registrar_contact_details::uri</a></div><div class="ttdeci">pjsip_sip_uri * uri</div><div class="ttdoc">URI being looked for. </div><div class="ttdef"><b>Definition:</b> <a href="../../d3/db0/res__pjsip__registrar_8c_source.html#l00117">res_pjsip_registrar.c:117</a></div></div>
<div class="ttc" id="res__pjsip__registrar_8c_html_aa0b6ec2978c63b269ea90927f085c0d8aa8f232bbece67893e0065f35b519a01b"><div class="ttname"><a href="../../d3/db0/res__pjsip__registrar_8c.html#aa0b6ec2978c63b269ea90927f085c0d8aa8f232bbece67893e0065f35b519a01b">CONTACT_DELETE_SHUTDOWN</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d3/db0/res__pjsip__registrar_8c_source.html#l00209">res_pjsip_registrar.c:209</a></div></div>
<div class="ttc" id="res__pjsip__registrar_8c_html_aa0b6ec2978c63b269ea90927f085c0d8a50f2fbc6b9c2a86ec4e05bd350e9f253"><div class="ttname"><a href="../../d3/db0/res__pjsip__registrar_8c.html#aa0b6ec2978c63b269ea90927f085c0d8a50f2fbc6b9c2a86ec4e05bd350e9f253">CONTACT_DELETE_EXISTING</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d3/db0/res__pjsip__registrar_8c_source.html#l00206">res_pjsip_registrar.c:206</a></div></div>
<div class="ttc" id="res__pjsip__registrar_8c_html_a65525b2ea5b7969c74517c0c620418ad"><div class="ttname"><a href="../../d3/db0/res__pjsip__registrar_8c.html#a65525b2ea5b7969c74517c0c620418ad">ami_show_registration_contact_statuses</a></div><div class="ttdeci">static int ami_show_registration_contact_statuses(struct mansession *s, const struct message *m)</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/db0/res__pjsip__registrar_8c_source.html#l01190">res_pjsip_registrar.c:1190</a></div></div>
<div class="ttc" id="structast__sip__contact_html_ad3a98d512391e68d8473ad51e3fd2401"><div class="ttname"><a href="../../d8/d8a/structast__sip__contact.html#ad3a98d512391e68d8473ad51e3fd2401">ast_sip_contact::via_port</a></div><div class="ttdeci">int via_port</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d8c/res__pjsip_8h_source.html#l00315">res_pjsip.h:315</a></div></div>
<div class="ttc" id="group__Group__AMI_html_gac6a9f3498f9afffecfd78c485af41556"><div class="ttname"><a href="../../df/d72/group__Group__AMI.html#gac6a9f3498f9afffecfd78c485af41556">astman_get_header</a></div><div class="ttdeci">const char * astman_get_header(const struct message *m, char *var)</div><div class="ttdoc">Get header from mananger transaction. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d10/manager_8c_source.html#l02820">manager.c:2820</a></div></div>
<div class="ttc" id="strings_8h_html_a372554b7a2d69a8bd3adac5157672036"><div class="ttname"><a href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a></div><div class="ttdeci">#define ast_strlen_zero(foo)</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d90/strings_8h_source.html#l00052">strings.h:52</a></div></div>
<div class="ttc" id="sorcery_8h_html_a100106a82d72aa59a66513ef3ad161c8"><div class="ttname"><a href="../../d8/d25/sorcery_8h.html#a100106a82d72aa59a66513ef3ad161c8">ast_sorcery_retrieve_by_id</a></div><div class="ttdeci">void * ast_sorcery_retrieve_by_id(const struct ast_sorcery *sorcery, const char *type, const char *id)</div><div class="ttdoc">Retrieve an object using its unique identifier. </div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d69/sorcery_8c_source.html#l01853">sorcery.c:1853</a></div></div>
<div class="ttc" id="res__pjsip_8h_html_a0dc7590db76dcdc0105abc92072d1b06"><div class="ttname"><a href="../../d8/d8c/res__pjsip_8h.html#a0dc7590db76dcdc0105abc92072d1b06">ast_pjsip_rdata_get_endpoint</a></div><div class="ttdeci">struct ast_sip_endpoint * ast_pjsip_rdata_get_endpoint(pjsip_rx_data *rdata)</div><div class="ttdoc">Get the looked-up endpoint on an out-of dialog request or response. </div><div class="ttdef"><b>Definition:</b> <a href="../../d7/dad/pjsip__distributor_8c_source.html#l00969">pjsip_distributor.c:969</a></div></div>
<div class="ttc" id="res__pjsip__registrar_8c_html_a8f054c4d1c6264000a8b588fc529fbac"><div class="ttname"><a href="../../d3/db0/res__pjsip__registrar_8c.html#a8f054c4d1c6264000a8b588fc529fbac">ami_registrations_aor</a></div><div class="ttdeci">static int ami_registrations_aor(void *obj, void *arg, int flags)</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/db0/res__pjsip__registrar_8c_source.html#l01133">res_pjsip_registrar.c:1133</a></div></div>
<div class="ttc" id="utils_8h_html_a595e2f8aa398f4bd21e381c3211235fe"><div class="ttname"><a href="../../d5/d60/utils_8h.html#a595e2f8aa398f4bd21e381c3211235fe">ast_pthread_create_background</a></div><div class="ttdeci">#define ast_pthread_create_background(a, b, c, d)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d60/utils_8h_source.html#l00567">utils.h:567</a></div></div>
<div class="ttc" id="paths_8h_html_ab9f9346c7a41bdf3720f7b1ed02ec703"><div class="ttname"><a href="../../dd/df2/paths_8h.html#ab9f9346c7a41bdf3720f7b1ed02ec703">ast_config_AST_SYSTEM_NAME</a></div><div class="ttdeci">const char * ast_config_AST_SYSTEM_NAME</div><div class="ttdef"><b>Definition:</b> <a href="../../de/dc5/options_8c_source.html#l00170">options.c:170</a></div></div>
<div class="ttc" id="res__pjsip_8h_html_a2d26a9ba468e7b251897c56032705447"><div class="ttname"><a href="../../d8/d8c/res__pjsip_8h.html#a2d26a9ba468e7b251897c56032705447">ast_sip_create_response</a></div><div class="ttdeci">int ast_sip_create_response(const pjsip_rx_data *rdata, int st_code, struct ast_sip_contact *contact, pjsip_tx_data **p_tdata)</div><div class="ttdoc">General purpose method for creating a SIP response. </div><div class="ttdef"><b>Definition:</b> <a href="../../de/d96/res__pjsip_8c_source.html#l05448">res_pjsip.c:5448</a></div></div>
<div class="ttc" id="structast__sip__contact_html_a3960205b2a4e7e012dc9f0eae1855f01"><div class="ttname"><a href="../../d8/d8a/structast__sip__contact.html#a3960205b2a4e7e012dc9f0eae1855f01">ast_sip_contact::endpoint</a></div><div class="ttdeci">struct ast_sip_endpoint * endpoint</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d8c/res__pjsip_8h_source.html#l00313">res_pjsip.h:313</a></div></div>
<div class="ttc" id="res__pjsip_8h_html_a15f77bb3c5ec890ab41662c45a08f764ad9cf563e8ed07f62531c5c7e89895839"><div class="ttname"><a href="../../d8/d8c/res__pjsip_8h.html#a15f77bb3c5ec890ab41662c45a08f764ad9cf563e8ed07f62531c5c7e89895839">AST_SIP_ENDPOINT_IDENTIFY_BY_AUTH_USERNAME</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d8c/res__pjsip_8h_source.html#l00476">res_pjsip.h:476</a></div></div>
<div class="ttc" id="res__pjsip__registrar_8c_html_a72fcdc0d711444a70be3def7099fcd4b"><div class="ttname"><a href="../../d3/db0/res__pjsip__registrar_8c.html#a72fcdc0d711444a70be3def7099fcd4b">register_aor_core</a></div><div class="ttdeci">static void register_aor_core(pjsip_rx_data *rdata, struct ast_sip_endpoint *endpoint, struct ast_sip_aor *aor, const char *aor_name, struct ao2_container *contacts, struct aor_core_response *response)</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/db0/res__pjsip__registrar_8c_source.html#l00584">res_pjsip_registrar.c:584</a></div></div>
<div class="ttc" id="strings_8h_html_aa3341f35cedca29e60bb7f3927204283"><div class="ttname"><a href="../../d6/d90/strings_8h.html#aa3341f35cedca29e60bb7f3927204283">ast_str_set</a></div><div class="ttdeci">int ast_str_set(struct ast_str **buf, ssize_t max_len, const char *fmt,...)</div><div class="ttdoc">Set a dynamic string using variable arguments. </div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d90/strings_8h_source.html#l01065">strings.h:1065</a></div></div>
<div class="ttc" id="res__pjproject_8h_html"><div class="ttname"><a href="../../df/dd5/res__pjproject_8h.html">res_pjproject.h</a></div></div>
<div class="ttc" id="manager_8h_html_a420f0f755e1c3378b45ca7f6f0669ffa"><div class="ttname"><a href="../../db/d45/manager_8h.html#a420f0f755e1c3378b45ca7f6f0669ffa">EVENT_FLAG_SYSTEM</a></div><div class="ttdeci">#define EVENT_FLAG_SYSTEM</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d45/manager_8h_source.html#l00071">manager.h:71</a></div></div>
<div class="ttc" id="logger_8h_html_a3f248112c8d6ce7e3959aa723dade648"><div class="ttname"><a href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a></div><div class="ttdeci">#define ast_debug(level,...)</div><div class="ttdoc">Log a DEBUG message. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d8c/logger_8h_source.html#l00452">logger.h:452</a></div></div>
<div class="ttc" id="res__pjsip_8h_html_afa522937191ad0d45711173590521d47"><div class="ttname"><a href="../../d8/d8c/res__pjsip_8h.html#afa522937191ad0d45711173590521d47">ast_sip_report_failed_acl</a></div><div class="ttdeci">void ast_sip_report_failed_acl(struct ast_sip_endpoint *endpoint, pjsip_rx_data *rdata, const char *name)</div><div class="ttdoc">Send a security event notification for when an ACL check fails. </div><div class="ttdef"><b>Definition:</b> <a href="../../d2/d63/res_2res__pjsip_2security__events_8c_source.html#l00102">res/res_pjsip/security_events.c:102</a></div></div>
<div class="ttc" id="astobj2_8c_html_a96a00b3a518d7f32b6d51dc28f09bf9b"><div class="ttname"><a href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a></div><div class="ttdeci">#define ast_log</div><div class="ttdef"><b>Definition:</b> <a href="../../da/df7/astobj2_8c_source.html#l00042">astobj2.c:42</a></div></div>
<div class="ttc" id="utils_8h_html_afa99ec4acc4ecb2dc3c2d05da15d0e3f"><div class="ttname"><a href="../../d5/d60/utils_8h.html#afa99ec4acc4ecb2dc3c2d05da15d0e3f">MAX</a></div><div class="ttdeci">#define MAX(a, b)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d60/utils_8h_source.html#l00228">utils.h:228</a></div></div>
<div class="ttc" id="structast__sip__endpoint_html_a681d685c47bd9fedb5527fabfd0454c1"><div class="ttname"><a href="../../d3/d46/structast__sip__endpoint.html#a681d685c47bd9fedb5527fabfd0454c1">ast_sip_endpoint::ident_method_order</a></div><div class="ttdeci">struct ast_sip_identify_by_vector ident_method_order</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d8c/res__pjsip_8h_source.html#l00861">res_pjsip.h:861</a></div></div>
<div class="ttc" id="res__pjsip_8h_html_a24ad1d4596f0644e856ff6e7ec2dd590"><div class="ttname"><a href="../../d8/d8c/res__pjsip_8h.html#a24ad1d4596f0644e856ff6e7ec2dd590">ast_sip_report_req_no_support</a></div><div class="ttdeci">void ast_sip_report_req_no_support(struct ast_sip_endpoint *endpoint, pjsip_rx_data *rdata, const char *req_type)</div><div class="ttdoc">Send a security event notification for when a request is not supported. </div><div class="ttdef"><b>Definition:</b> <a href="../../d2/d63/res_2res__pjsip_2security__events_8c_source.html#l00230">res/res_pjsip/security_events.c:230</a></div></div>
<div class="ttc" id="vector_8h_html_ad9d555fa89da1bfc691181993499f785"><div class="ttname"><a href="../../d6/d68/vector_8h.html#ad9d555fa89da1bfc691181993499f785">AST_VECTOR_INIT</a></div><div class="ttdeci">#define AST_VECTOR_INIT(vec, size)</div><div class="ttdoc">Initialize a vector. </div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d68/vector_8h_source.html#l00113">vector.h:113</a></div></div>
<div class="ttc" id="structast__sip__contact__wrapper_html"><div class="ttname"><a href="../../df/dd8/structast__sip__contact__wrapper.html">ast_sip_contact_wrapper</a></div><div class="ttdoc">A wrapper for contact that adds the aor_id and a consistent contact id. Used by ast_sip_for_each_cont...</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d8c/res__pjsip_8h_source.html#l00396">res_pjsip.h:396</a></div></div>
<div class="ttc" id="module_8h_html_a155a0df9c59e04e305d4a2fa3e35f843a12c3f60dd7655dfa8d4430cbf04b1223"><div class="ttname"><a href="../../d5/d16/module_8h.html#a155a0df9c59e04e305d4a2fa3e35f843a12c3f60dd7655dfa8d4430cbf04b1223">AST_MODFLAG_LOAD_ORDER</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d16/module_8h_source.html#l00317">module.h:317</a></div></div>
<div class="ttc" id="paths_8h_html"><div class="ttname"><a href="../../dd/df2/paths_8h.html">paths.h</a></div><div class="ttdoc">Asterisk file paths, configured in asterisk.conf. </div></div>
<div class="ttc" id="group__Group__AMI_html_gabf7c909efbfc26d0d9c66786c83b8f69"><div class="ttname"><a href="../../df/d72/group__Group__AMI.html#gabf7c909efbfc26d0d9c66786c83b8f69">astman_send_list_complete_end</a></div><div class="ttdeci">void astman_send_list_complete_end(struct mansession *s)</div><div class="ttdoc">End the list complete event. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d10/manager_8c_source.html#l03245">manager.c:3245</a></div></div>
<div class="ttc" id="res__pjsip_8h_html_a8af68d3a6a66cb6f1f7b9bd28690251b"><div class="ttname"><a href="../../d8/d8c/res__pjsip_8h.html#a8af68d3a6a66cb6f1f7b9bd28690251b">ast_sip_location_create_contact</a></div><div class="ttdeci">struct ast_sip_contact * ast_sip_location_create_contact(struct ast_sip_aor *aor, const char *uri, struct timeval expiration_time, const char *path_info, const char *user_agent, const char *via_addr, int via_port, const char *call_id, int prune_on_boot, struct ast_sip_endpoint *endpoint)</div><div class="ttdoc">Create a new contact for an AOR without locking the AOR. </div><div class="ttdef"><b>Definition:</b> <a href="../../d0/dad/location_8c_source.html#l00355">location.c:355</a></div></div>
<div class="ttc" id="utils_8h_html_a1604b4d72144dd3d9f7da668e90337e9"><div class="ttname"><a href="../../d5/d60/utils_8h.html#a1604b4d72144dd3d9f7da668e90337e9">RAII_VAR</a></div><div class="ttdeci">#define RAII_VAR(vartype, varname, initval, dtor)</div><div class="ttdoc">Declare a variable that will call a destructor function when it goes out of scope. </div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d60/utils_8h_source.html#l00911">utils.h:911</a></div></div>
<div class="ttc" id="lock_8h_html_a6009440c7a72f8e2e3b1ec97641ad160"><div class="ttname"><a href="../../dd/d42/lock_8h.html#a6009440c7a72f8e2e3b1ec97641ad160">AST_PTHREADT_NULL</a></div><div class="ttdeci">#define AST_PTHREADT_NULL</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d42/lock_8h_source.html#l00066">lock.h:66</a></div></div>
<div class="ttc" id="app__meetme_8c_html_adf04f66344e3fb0a6f6a69bf39d19902"><div class="ttname"><a href="../../df/d44/app__meetme_8c.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a></div><div class="ttdeci">ast_mutex_t lock</div><div class="ttdef"><b>Definition:</b> <a href="../../df/d44/app__meetme_8c_source.html#l01091">app_meetme.c:1091</a></div></div>
<div class="ttc" id="strings_8h_html_ac92713b8d07a45720b2664be70810e55"><div class="ttname"><a href="../../d6/d90/strings_8h.html#ac92713b8d07a45720b2664be70810e55">ast_strip</a></div><div class="ttdeci">char * ast_strip(char *s)</div><div class="ttdoc">Strip leading/trailing whitespace from a string. </div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d90/strings_8h_source.html#l00219">strings.h:219</a></div></div>
<div class="ttc" id="main_2endpoints_8c_html_a0b6312c44448ff7ed80ac99b3077e438"><div class="ttname"><a href="../../d7/d4b/main_2endpoints_8c.html#a0b6312c44448ff7ed80ac99b3077e438">endpoints</a></div><div class="ttdeci">static struct ao2_container * endpoints</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d4b/main_2endpoints_8c_source.html#l00050">main/endpoints.c:50</a></div></div>
<div class="ttc" id="astobj2_8h_html_aaca5e8eac39a22f9da1c36fc6c922270"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a></div><div class="ttdeci">#define ao2_ref(o, delta)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l00464">astobj2.h:464</a></div></div>
<div class="ttc" id="astobj2_8h_html_a1f8b41308be4c47de8ff89a3b9c7e7d1a1959468a3c5d6aecd2fa1272d8e30fbf"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#a1f8b41308be4c47de8ff89a3b9c7e7d1a1959468a3c5d6aecd2fa1272d8e30fbf">CMP_MATCH</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l01031">astobj2.h:1031</a></div></div>
<div class="ttc" id="structmansession_html"><div class="ttname"><a href="../../d2/d8a/structmansession.html">mansession</a></div><div class="ttdoc">In case you didn&amp;#39;t read that giant block of text above the mansession_session struct, the struct mansession is named this solely to keep the API the same in Asterisk. This structure really represents data that is different from Manager action to Manager action. The mansession_session pointer contained within points to session-specific data. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d10/manager_8c_source.html#l01625">manager.c:1625</a></div></div>
<div class="ttc" id="res__pjsip_8h_html_ae207f7592aa7a69d0425a77bb8aa494d"><div class="ttname"><a href="../../d8/d8c/res__pjsip_8h.html#ae207f7592aa7a69d0425a77bb8aa494d">ast_sip_send_stateful_response</a></div><div class="ttdeci">int ast_sip_send_stateful_response(pjsip_rx_data *rdata, pjsip_tx_data *tdata, struct ast_sip_endpoint *sip_endpoint)</div><div class="ttdoc">Send a stateful response to an out of dialog request. </div><div class="ttdef"><b>Definition:</b> <a href="../../de/d96/res__pjsip_8c_source.html#l05420">res_pjsip.c:5420</a></div></div>
<div class="ttc" id="astobj2_8h_html_aa9fdb5d0a6157a56060d9f7279fe6c49"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#aa9fdb5d0a6157a56060d9f7279fe6c49">ao2_lock</a></div><div class="ttdeci">#define ao2_lock(a)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l00718">astobj2.h:718</a></div></div>
<div class="ttc" id="time_8h_html_a1d774df72e3dbb623475783e06ce4f61"><div class="ttname"><a href="../../de/df7/time_8h.html#a1d774df72e3dbb623475783e06ce4f61">ast_samp2tv</a></div><div class="ttdeci">struct timeval ast_samp2tv(unsigned int _nsamp, unsigned int _rate)</div><div class="ttdoc">Returns a timeval corresponding to the duration of n samples at rate r. Useful to convert samples to ...</div><div class="ttdef"><b>Definition:</b> <a href="../../de/df7/time_8h_source.html#l00238">time.h:238</a></div></div>
<div class="ttc" id="astmm_8h_html_ab5f0750cc80ba337fdcbddea2d3a1ee6"><div class="ttname"><a href="../../d8/d8a/astmm_8h.html#ab5f0750cc80ba337fdcbddea2d3a1ee6">ast_strdupa</a></div><div class="ttdeci">#define ast_strdupa(s)</div><div class="ttdoc">duplicate a string in memory from the stack </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d8a/astmm_8h_source.html#l00300">astmm.h:300</a></div></div>
<div class="ttc" id="sorcery_8h_html_a97706283a06cbb44e4f0f9620dd5cf07"><div class="ttname"><a href="../../d8/d25/sorcery_8h.html#a97706283a06cbb44e4f0f9620dd5cf07">ast_sorcery_object_get_id</a></div><div class="ttdeci">const char * ast_sorcery_object_get_id(const void *object)</div><div class="ttdoc">Get the unique identifier of a sorcery object. </div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d69/sorcery_8c_source.html#l02312">sorcery.c:2312</a></div></div>
<div class="ttc" id="structast__sip__ami_html_a38bed88f5fd00306683b620c6c90eef4"><div class="ttname"><a href="../../d4/d2f/structast__sip__ami.html#a38bed88f5fd00306683b620c6c90eef4">ast_sip_ami::s</a></div><div class="ttdeci">struct mansession * s</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d8c/res__pjsip_8h_source.html#l02739">res_pjsip.h:2739</a></div></div>
<div class="ttc" id="structcontact__transport__monitor_html_a56fc3769484040bb16d0a0b8d79e190f"><div class="ttname"><a href="../../d6/d85/structcontact__transport__monitor.html#a56fc3769484040bb16d0a0b8d79e190f">contact_transport_monitor::removing</a></div><div class="ttdeci">int removing</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/db0/res__pjsip__registrar_8c_source.html#l00316">res_pjsip_registrar.c:316</a></div></div>
<div class="ttc" id="res__fax_8c_html_a7ea220e4d14b05876af4430e9832ce47"><div class="ttname"><a href="../../d0/d60/res__fax_8c.html#a7ea220e4d14b05876af4430e9832ce47">container</a></div><div class="ttdeci">struct ao2_container * container</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d60/res__fax_8c_source.html#l00502">res_fax.c:502</a></div></div>
<div class="ttc" id="res__pjsip__registrar_8c_html_aef91583c1a44bcbb095bfa1a7c64f26a"><div class="ttname"><a href="../../d3/db0/res__pjsip__registrar_8c.html#aef91583c1a44bcbb095bfa1a7c64f26a">ami_show_registrations</a></div><div class="ttdeci">static int ami_show_registrations(struct mansession *s, const struct message *m)</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/db0/res__pjsip__registrar_8c_source.html#l01175">res_pjsip_registrar.c:1175</a></div></div>
<div class="ttc" id="structcontact__transport__monitor_html_ae91e2c22bd603c6a8b982935d32f5ac1"><div class="ttname"><a href="../../d6/d85/structcontact__transport__monitor.html#ae91e2c22bd603c6a8b982935d32f5ac1">contact_transport_monitor::contact_name</a></div><div class="ttdeci">char * contact_name</div><div class="ttdoc">Sorcery contact name to remove on transport shutdown. </div><div class="ttdef"><b>Definition:</b> <a href="../../d3/db0/res__pjsip__registrar_8c_source.html#l00314">res_pjsip_registrar.c:314</a></div></div>
<div class="ttc" id="include_2asterisk_2config_8h_html_a66581086d34dfe7ea86b0644bacef239"><div class="ttname"><a href="../../d3/de6/include_2asterisk_2config_8h.html#a66581086d34dfe7ea86b0644bacef239">ast_variable_new</a></div><div class="ttdeci">#define ast_variable_new(name, value, filename)</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/de6/include_2asterisk_2config_8h_source.html#l00914">include/asterisk/config.h:914</a></div></div>
<div class="ttc" id="structast__sip__endpoint_html"><div class="ttname"><a href="../../d3/d46/structast__sip__endpoint.html">ast_sip_endpoint</a></div><div class="ttdoc">An entity with which Asterisk communicates. </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d8c/res__pjsip_8h_source.html#l00812">res_pjsip.h:812</a></div></div>
<div class="ttc" id="structast__sip__aor_html_a6e527f7843b00df547d2221a7d31ef60"><div class="ttname"><a href="../../d4/d03/structast__sip__aor.html#a6e527f7843b00df547d2221a7d31ef60">ast_sip_aor::support_path</a></div><div class="ttdeci">unsigned int support_path</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d8c/res__pjsip_8h_source.html#l00385">res_pjsip.h:385</a></div></div>
<div class="ttc" id="named__locks_8h_html"><div class="ttname"><a href="../../d1/d32/named__locks_8h.html">named_locks.h</a></div><div class="ttdoc">Named Locks. </div></div>
<div class="ttc" id="res__pjsip__registrar_8c_html_a6dec9164e0ad0a361d74eefb350b9ee4"><div class="ttname"><a href="../../d3/db0/res__pjsip__registrar_8c.html#a6dec9164e0ad0a361d74eefb350b9ee4">expiration_global_loaded</a></div><div class="ttdeci">static void expiration_global_loaded(const char *object_type)</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/db0/res__pjsip__registrar_8c_source.html#l01294">res_pjsip_registrar.c:1294</a></div></div>
<div class="ttc" id="res__pjsip_8h_html_a2d923ef44f62dffc05178f762b88f084"><div class="ttname"><a href="../../d8/d8c/res__pjsip_8h.html#a2d923ef44f62dffc05178f762b88f084">ast_sip_register_service</a></div><div class="ttdeci">int ast_sip_register_service(pjsip_module *module)</div><div class="ttdoc">Register a SIP service in Asterisk. </div><div class="ttdef"><b>Definition:</b> <a href="../../de/d96/res__pjsip_8c_source.html#l03315">res_pjsip.c:3315</a></div></div>
<div class="ttc" id="structast__sip__domain__alias_html"><div class="ttname"><a href="../../dc/d19/structast__sip__domain__alias.html">ast_sip_domain_alias</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d8c/res__pjsip_8h_source.html#l00259">res_pjsip.h:259</a></div></div>
<div class="ttc" id="group__named__locks_html_gga9536e506e987386496d90bb12f1da9c7a4320f5fc7cf75e313ebddce649562d83"><div class="ttname"><a href="../../d0/db9/group__named__locks.html#gga9536e506e987386496d90bb12f1da9c7a4320f5fc7cf75e313ebddce649562d83">AST_NAMED_LOCK_TYPE_MUTEX</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d32/named__locks_8h_source.html#l00059">named_locks.h:59</a></div></div>
<div class="ttc" id="res__pjsip__registrar_8c_html_a29a64345e9cc1919bff949f0dcf293fe"><div class="ttname"><a href="../../d3/db0/res__pjsip__registrar_8c.html#a29a64345e9cc1919bff949f0dcf293fe">registrar_validate_path</a></div><div class="ttdeci">static int registrar_validate_path(pjsip_rx_data *rdata, struct ast_sip_aor *aor, struct ast_str **path_str)</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/db0/res__pjsip__registrar_8c_source.html#l00274">res_pjsip_registrar.c:274</a></div></div>
<div class="ttc" id="res__pjsip__registrar_8c_html_aa0b6ec2978c63b269ea90927f085c0d8ab4f9fcf2f1d563fcb73a11daad67911a"><div class="ttname"><a href="../../d3/db0/res__pjsip__registrar_8c.html#aa0b6ec2978c63b269ea90927f085c0d8ab4f9fcf2f1d563fcb73a11daad67911a">CONTACT_DELETE_REQUEST</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d3/db0/res__pjsip__registrar_8c_source.html#l00208">res_pjsip_registrar.c:208</a></div></div>
<div class="ttc" id="res__pjsip__registrar_8c_html_a00b05e0e233ed8b8a24c4ce367c97843"><div class="ttname"><a href="../../d3/db0/res__pjsip__registrar_8c.html#a00b05e0e233ed8b8a24c4ce367c97843">ami_registrations_endpoint</a></div><div class="ttdeci">static int ami_registrations_endpoint(void *obj, void *arg, int flags)</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/db0/res__pjsip__registrar_8c_source.html#l01155">res_pjsip_registrar.c:1155</a></div></div>
<div class="ttc" id="sorcery_8h_html_a6c1928d47eae1172f236e8ee421c2db4"><div class="ttname"><a href="../../d8/d25/sorcery_8h.html#a6c1928d47eae1172f236e8ee421c2db4">ast_sorcery_observer_add</a></div><div class="ttdeci">int ast_sorcery_observer_add(const struct ast_sorcery *sorcery, const char *type, const struct ast_sorcery_observer *callbacks)</div><div class="ttdoc">Add an observer to a specific object type. </div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d69/sorcery_8c_source.html#l02386">sorcery.c:2386</a></div></div>
<div class="ttc" id="res__pjsip_8h_html_af7205a9dc0a18ef1dc14785099846ca3"><div class="ttname"><a href="../../d8/d8c/res__pjsip_8h.html#af7205a9dc0a18ef1dc14785099846ca3">ast_sip_location_delete_contact</a></div><div class="ttdeci">int ast_sip_location_delete_contact(struct ast_sip_contact *contact)</div><div class="ttdoc">Delete a contact. </div><div class="ttdef"><b>Definition:</b> <a href="../../d0/dad/location_8c_source.html#l00450">location.c:450</a></div></div>
<div class="ttc" id="res__pjsip_8h_html_a15f77bb3c5ec890ab41662c45a08f764abae64f41eb012cc76b0af79173298345"><div class="ttname"><a href="../../d8/d8c/res__pjsip_8h.html#a15f77bb3c5ec890ab41662c45a08f764abae64f41eb012cc76b0af79173298345">AST_SIP_ENDPOINT_IDENTIFY_BY_USERNAME</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d8c/res__pjsip_8h_source.html#l00474">res_pjsip.h:474</a></div></div>
<div class="ttc" id="res__pjsip_8h_html_a5d73e049fbced1da4e3041d1656e0aa6"><div class="ttname"><a href="../../d8/d8c/res__pjsip_8h.html#a5d73e049fbced1da4e3041d1656e0aa6">ast_sip_transport_monitor_unregister</a></div><div class="ttdeci">void ast_sip_transport_monitor_unregister(pjsip_transport *transport, ast_transport_monitor_shutdown_cb cb, void *data, ast_transport_monitor_data_matcher matches)</div><div class="ttdoc">Unregister a reliable transport shutdown monitor. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d94/pjsip__transport__events_8c_source.html#l00277">pjsip_transport_events.c:277</a></div></div>
<div class="ttc" id="test_8h_html_a9482d93ea3931853331bdbc745ce7cb4"><div class="ttname"><a href="../../d2/ddc/test_8h.html#a9482d93ea3931853331bdbc745ce7cb4">ast_test_suite_event_notify</a></div><div class="ttdeci">#define ast_test_suite_event_notify(s, f,...)</div><div class="ttdef"><b>Definition:</b> <a href="../../d2/ddc/test_8h_source.html#l00196">test.h:196</a></div></div>
<div class="ttc" id="res__pjsip_8h_html_a434c2d85dbd10a9453f6d409809330d5"><div class="ttname"><a href="../../d8/d8c/res__pjsip_8h.html#a434c2d85dbd10a9453f6d409809330d5">ast_sip_location_retrieve_aor</a></div><div class="ttdeci">struct ast_sip_aor * ast_sip_location_retrieve_aor(const char *aor_name)</div><div class="ttdoc">Retrieve a named AOR. </div><div class="ttdef"><b>Definition:</b> <a href="../../d0/dad/location_8c_source.html#l00147">location.c:147</a></div></div>
<div class="ttc" id="astmm_8h_html_a249282ecc7ba5a1a49fa75e9a33d1717"><div class="ttname"><a href="../../d8/d8a/astmm_8h.html#a249282ecc7ba5a1a49fa75e9a33d1717">ast_alloca</a></div><div class="ttdeci">#define ast_alloca(size)</div><div class="ttdoc">call __builtin_alloca to ensure we get gcc builtin semantics </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d8a/astmm_8h_source.html#l00290">astmm.h:290</a></div></div>
<div class="ttc" id="structast__sip__contact__wrapper_html_a0181805d3b31d6f1859ef7784c67fcf2"><div class="ttname"><a href="../../df/dd8/structast__sip__contact__wrapper.html#a0181805d3b31d6f1859ef7784c67fcf2">ast_sip_contact_wrapper::contact</a></div><div class="ttdeci">struct ast_sip_contact * contact</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d8c/res__pjsip_8h_source.html#l00402">res_pjsip.h:402</a></div></div>
<div class="ttc" id="group__Group__AMI_html_gafadf012f66a9fd7ecf985ec5b9dee101"><div class="ttname"><a href="../../df/d72/group__Group__AMI.html#gafadf012f66a9fd7ecf985ec5b9dee101">ast_manager_unregister</a></div><div class="ttdeci">int ast_manager_unregister(const char *action)</div><div class="ttdoc">Unregister a registered manager command. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d10/manager_8c_source.html#l07258">manager.c:7258</a></div></div>
<div class="ttc" id="manager_8h_html"><div class="ttname"><a href="../../db/d45/manager_8h.html">manager.h</a></div><div class="ttdoc">The AMI - Asterisk Manager Interface - is a TCP protocol created to manage Asterisk with third-party ...</div></div>
<div class="ttc" id="res__pjsip__registrar_8c_html_a1c1341bf634e6df2c66669574ffd4981"><div class="ttname"><a href="../../d3/db0/res__pjsip__registrar_8c.html#a1c1341bf634e6df2c66669574ffd4981">find_registrar_aor</a></div><div class="ttdeci">static struct ast_sip_aor * find_registrar_aor(struct pjsip_rx_data *rdata, struct ast_sip_endpoint *endpoint)</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/db0/res__pjsip__registrar_8c_source.html#l01007">res_pjsip_registrar.c:1007</a></div></div>
<div class="ttc" id="res__pjsip_8h_html_a5b7ab353d9342e09fcb0520d3da15376"><div class="ttname"><a href="../../d8/d8c/res__pjsip_8h.html#a5b7ab353d9342e09fcb0520d3da15376">ast_sip_transport_monitor_register_replace</a></div><div class="ttdeci">enum ast_transport_monitor_reg ast_sip_transport_monitor_register_replace(pjsip_transport *transport, ast_transport_monitor_shutdown_cb cb, void *ao2_data, ast_transport_monitor_data_matcher matches)</div><div class="ttdoc">Register a reliable transport shutdown monitor callback replacing any duplicate. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d94/pjsip__transport__events_8c_source.html#l00312">pjsip_transport_events.c:312</a></div></div>
<div class="ttc" id="res__pjsip__registrar_8c_html_a409bbef1e0800ce705686551288fa4d1"><div class="ttname"><a href="../../d3/db0/res__pjsip__registrar_8c.html#a409bbef1e0800ce705686551288fa4d1">ami_registrations_endpoints</a></div><div class="ttdeci">static int ami_registrations_endpoints(void *arg)</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/db0/res__pjsip__registrar_8c_source.html#l01162">res_pjsip_registrar.c:1162</a></div></div>
<div class="ttc" id="res__pjsip__registrar_8c_html_a42d9e3e23494c2d8e6ad408907c2f168"><div class="ttname"><a href="../../d3/db0/res__pjsip__registrar_8c.html#a42d9e3e23494c2d8e6ad408907c2f168">register_contact_transport_remove_cb</a></div><div class="ttdeci">static int register_contact_transport_remove_cb(void *data)</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/db0/res__pjsip__registrar_8c_source.html#l00330">res_pjsip_registrar.c:330</a></div></div>
<div class="ttc" id="res__pjsip__registrar_8c_html_a8c6d34bc166948f300dea65defbc5c6e"><div class="ttname"><a href="../../d3/db0/res__pjsip__registrar_8c.html#a8c6d34bc166948f300dea65defbc5c6e">vec_contact_add</a></div><div class="ttdeci">static int vec_contact_add(void *obj, void *arg, int flags)</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/db0/res__pjsip__registrar_8c_source.html#l00489">res_pjsip_registrar.c:489</a></div></div>
<div class="ttc" id="logger_8h_html_aced66975c154ea0e2a8ec3bc818b4e08"><div class="ttname"><a href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a></div><div class="ttdeci">#define LOG_ERROR</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d8c/logger_8h_source.html#l00285">logger.h:285</a></div></div>
<div class="ttc" id="time_8h_html_a6daa33e2052acd094bb63e78aba29733"><div class="ttname"><a href="../../de/df7/time_8h.html#a6daa33e2052acd094bb63e78aba29733">ast_tvcmp</a></div><div class="ttdeci">int ast_tvcmp(struct timeval _a, struct timeval _b)</div><div class="ttdoc">Compres two struct timeval instances returning -1, 0, 1 if the first arg is smaller, equal or greater to the second. </div><div class="ttdef"><b>Definition:</b> <a href="../../de/df7/time_8h_source.html#l00128">time.h:128</a></div></div>
<div class="ttc" id="structast__str_html"><div class="ttname"><a href="../../dd/da2/structast__str.html">ast_str</a></div><div class="ttdoc">The descriptor of a dynamic string XXX storage will be optimized later if needed We use the ts field ...</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d90/strings_8h_source.html#l00584">strings.h:584</a></div></div>
<div class="ttc" id="astobj2_8h_html_a64f51be4bee35c38dbe59b0a788b5ce8"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#a64f51be4bee35c38dbe59b0a788b5ce8">ao2_unlink</a></div><div class="ttdeci">#define ao2_unlink(container, obj)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l01598">astobj2.h:1598</a></div></div>
<div class="ttc" id="res__pjsip__registrar_8c_html_ac19bc2465164ac0a5beb5db3624d5c8e"><div class="ttname"><a href="../../d3/db0/res__pjsip__registrar_8c.html#ac19bc2465164ac0a5beb5db3624d5c8e">AMI_SHOW_REGISTRATIONS</a></div><div class="ttdeci">#define AMI_SHOW_REGISTRATIONS</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/db0/res__pjsip__registrar_8c_source.html#l01226">res_pjsip_registrar.c:1226</a></div></div>
<div class="ttc" id="group__pjsip__threading_html_ga4f0a0629fa2ca084812772356d8e3565"><div class="ttname"><a href="../../d7/dfa/group__pjsip__threading.html#ga4f0a0629fa2ca084812772356d8e3565">ast_sip_push_task</a></div><div class="ttdeci">int ast_sip_push_task(struct ast_taskprocessor *serializer, int(*sip_task)(void *), void *task_data)</div><div class="ttdoc">Pushes a task to SIP servants. </div><div class="ttdef"><b>Definition:</b> <a href="../../de/d96/res__pjsip_8c_source.html#l05138">res_pjsip.c:5138</a></div></div>
<div class="ttc" id="structregistrar__contact__details_html_a2e57658a5d3ef6c4ef2774c9d5868e7c"><div class="ttname"><a href="../../d6/dcf/structregistrar__contact__details.html#a2e57658a5d3ef6c4ef2774c9d5868e7c">registrar_contact_details::pool</a></div><div class="ttdeci">pj_pool_t * pool</div><div class="ttdoc">Pool used for parsing URI. </div><div class="ttdef"><b>Definition:</b> <a href="../../d3/db0/res__pjsip__registrar_8c_source.html#l00115">res_pjsip_registrar.c:115</a></div></div>
<div class="ttc" id="res__pjsip__registrar_8c_html_ac663f457fa4f4fed9b201e8a82a36eb2"><div class="ttname"><a href="../../d3/db0/res__pjsip__registrar_8c.html#ac663f457fa4f4fed9b201e8a82a36eb2">register_contact_transport_shutdown_cb</a></div><div class="ttdeci">static void register_contact_transport_shutdown_cb(void *data)</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/db0/res__pjsip__registrar_8c_source.html#l00369">res_pjsip_registrar.c:369</a></div></div>
<div class="ttc" id="structast__sorcery__observer_html"><div class="ttname"><a href="../../d2/ddb/structast__sorcery__observer.html">ast_sorcery_observer</a></div><div class="ttdoc">Interface for a sorcery object type observer. </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d25/sorcery_8h_source.html#l00332">sorcery.h:332</a></div></div>
<div class="ttc" id="chan__phone_8c_html_a4e40373706bcf5cdb9409dac3166d280"><div class="ttname"><a href="../../da/dde/chan__phone_8c.html#a4e40373706bcf5cdb9409dac3166d280">monitor</a></div><div class="ttdeci">static unsigned int monitor</div><div class="ttdef"><b>Definition:</b> <a href="../../da/dde/chan__phone_8c_source.html#l00116">chan_phone.c:116</a></div></div>
<div class="ttc" id="structast__named__lock_html"><div class="ttname"><a href="../../d0/d55/structast__named__lock.html">ast_named_lock</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d7/db9/named__locks_8c_source.html#l00041">named_locks.c:41</a></div></div>
<div class="ttc" id="structast__sip__contact_html"><div class="ttname"><a href="../../d8/d8a/structast__sip__contact.html">ast_sip_contact</a></div><div class="ttdoc">Contact associated with an address of record. </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d8c/res__pjsip_8h_source.html#l00281">res_pjsip.h:281</a></div></div>
<div class="ttc" id="time_8h_html_a97e1bb8fbd7a103212789e87e7ed6073"><div class="ttname"><a href="../../de/df7/time_8h.html#a97e1bb8fbd7a103212789e87e7ed6073">ast_tvadd</a></div><div class="ttdeci">struct timeval ast_tvadd(struct timeval a, struct timeval b)</div><div class="ttdoc">Returns the sum of two timevals a + b. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/dc5/extconf_8c_source.html#l02283">extconf.c:2283</a></div></div>
<div class="ttc" id="structaor__core__response_html"><div class="ttname"><a href="../../db/d19/structaor__core__response.html">aor_core_response</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d3/db0/res__pjsip__registrar_8c_source.html#l00577">res_pjsip_registrar.c:577</a></div></div>
<div class="ttc" id="structaor__core__response_html_a45a5b7c00a796a23f01673cef1dbe0a9"><div class="ttname"><a href="../../db/d19/structaor__core__response.html#a45a5b7c00a796a23f01673cef1dbe0a9">aor_core_response::code</a></div><div class="ttdeci">int code</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/db0/res__pjsip__registrar_8c_source.html#l00581">res_pjsip_registrar.c:581</a></div></div>
<div class="ttc" id="astobj2_8h_html_a17990ea630db7dbd1252ef0132133a2b"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#a17990ea630db7dbd1252ef0132133a2b">ao2_iterator_next</a></div><div class="ttdeci">#define ao2_iterator_next(iter)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l01933">astobj2.h:1933</a></div></div>
<div class="ttc" id="astobj2_8h_html_ae0422b60d8e25b6962b2d61ae4ddf724"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#ae0422b60d8e25b6962b2d61ae4ddf724">ao2_alloc</a></div><div class="ttdeci">#define ao2_alloc(data_size, destructor_fn)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l00411">astobj2.h:411</a></div></div>
<div class="ttc" id="res__pjsip_8h_html_a541e93ff798b3c8ce99a158831338718"><div class="ttname"><a href="../../d8/d8c/res__pjsip_8h.html#a541e93ff798b3c8ce99a158831338718">ast_sip_add_date_header</a></div><div class="ttdeci">void ast_sip_add_date_header(pjsip_tx_data *tdata)</div><div class="ttdoc">Adds a Date header to the tdata, formatted like: Date: Wed, 01 Jan 2021 14:53:01 GMT. </div><div class="ttdef"><b>Definition:</b> <a href="../../de/d96/res__pjsip_8c_source.html#l03288">res_pjsip.c:3288</a></div></div>
<div class="ttc" id="res__pjsip__registrar_8c_html_ab620225c7d2d4b8fc85df23dc0912369"><div class="ttname"><a href="../../d3/db0/res__pjsip__registrar_8c.html#ab620225c7d2d4b8fc85df23dc0912369">registrar_validate_contacts</a></div><div class="ttdeci">static int registrar_validate_contacts(const pjsip_rx_data *rdata, pj_pool_t *pool, struct ao2_container *contacts, struct ast_sip_aor *aor, int permanent, int *added, int *updated, int *deleted)</div><div class="ttdoc">Internal function which validates provided Contact headers to confirm that they are acceptable...</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/db0/res__pjsip__registrar_8c_source.html#l00141">res_pjsip_registrar.c:141</a></div></div>
<div class="ttc" id="structcontact__transport__monitor_html_a692428c236d2054b1b889ba0b921ba87"><div class="ttname"><a href="../../d6/d85/structcontact__transport__monitor.html#a692428c236d2054b1b889ba0b921ba87">contact_transport_monitor::aor_name</a></div><div class="ttdeci">char aor_name[0]</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/db0/res__pjsip__registrar_8c_source.html#l00318">res_pjsip_registrar.c:318</a></div></div>
<div class="ttc" id="structast__sip__contact_html_a98ed99328ad621551cdfbee6b83754ae"><div class="ttname"><a href="../../d8/d8a/structast__sip__contact.html#a98ed99328ad621551cdfbee6b83754ae">ast_sip_contact::expiration_time</a></div><div class="ttdeci">struct timeval expiration_time</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d8c/res__pjsip_8h_source.html#l00305">res_pjsip.h:305</a></div></div>
<div class="ttc" id="astmm_8h_html_a402072d6789f6ed9e3a81da27504127e"><div class="ttname"><a href="../../d8/d8a/astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a></div><div class="ttdeci">#define ast_free(a)</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d8a/astmm_8h_source.html#l00182">astmm.h:182</a></div></div>
<div class="ttc" id="res__pjsip_8h_html_a8faae2d4e4f2b202cbfed36b6f009a1b"><div class="ttname"><a href="../../d8/d8c/res__pjsip_8h.html#a8faae2d4e4f2b202cbfed36b6f009a1b">ast_sip_get_contact_expiration_check_interval</a></div><div class="ttdeci">unsigned int ast_sip_get_contact_expiration_check_interval(void)</div><div class="ttdoc">Retrieve the system contact expiration check interval setting. </div><div class="ttdef"><b>Definition:</b> <a href="../../dd/dfd/config__global_8c_source.html#l00309">config_global.c:309</a></div></div>
<div class="ttc" id="res__pjsip__private_8h_html_ac73444851015b8a7be33534e4a7d2878"><div class="ttname"><a href="../../d7/d5c/res__pjsip__private_8h.html#ac73444851015b8a7be33534e4a7d2878">ast_sip_will_uri_survive_restart</a></div><div class="ttdeci">int ast_sip_will_uri_survive_restart(pjsip_sip_uri *uri, struct ast_sip_endpoint *endpoint, pjsip_rx_data *rdata)</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d96/res__pjsip_8c_source.html#l03723">res_pjsip.c:3723</a></div></div>
<div class="ttc" id="res__pjsip__registrar_8c_html_aab22b4013d9535ae373964bf042881aa"><div class="ttname"><a href="../../d3/db0/res__pjsip__registrar_8c.html#aab22b4013d9535ae373964bf042881aa">pj_max_hostname</a></div><div class="ttdeci">static int pj_max_hostname</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/db0/res__pjsip__registrar_8c_source.html#l00080">res_pjsip_registrar.c:80</a></div></div>
<div class="ttc" id="module_8h_html_adc09474f0ff557e9925b722ee5b952dfac742921e9f9512d28f62c74ea2affe57"><div class="ttname"><a href="../../d5/d16/module_8h.html#adc09474f0ff557e9925b722ee5b952dfac742921e9f9512d28f62c74ea2affe57">AST_MODULE_LOAD_DECLINE</a></div><div class="ttdoc">Module has failed to load, may be in an inconsistent state. </div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d16/module_8h_source.html#l00078">module.h:78</a></div></div>
<div class="ttc" id="taskprocessor_8h_html"><div class="ttname"><a href="../../d0/d1e/taskprocessor_8h.html">taskprocessor.h</a></div><div class="ttdoc">An API for managing task processing threads that can be shared across modules. </div></div>
<div class="ttc" id="res__pjsip__registrar_8c_html_a507c5e3db66e37573fbcb5b530841a9b"><div class="ttname"><a href="../../d3/db0/res__pjsip__registrar_8c.html#a507c5e3db66e37573fbcb5b530841a9b">check_expiration_thread</a></div><div class="ttdeci">static void * check_expiration_thread(void *data)</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/db0/res__pjsip__registrar_8c_source.html#l01266">res_pjsip_registrar.c:1266</a></div></div>
<div class="ttc" id="structheader_html"><div class="ttname"><a href="../../d5/d65/structheader.html">header</a></div><div class="ttdef"><b>Definition:</b> <a href="../../db/d73/pjsip__global__headers_8c_source.html#l00047">pjsip_global_headers.c:47</a></div></div>
<div class="ttc" id="structast__sorcery__observer_html_a1ebad9f5bd6a80f6f666354460b86e0d"><div class="ttname"><a href="../../d2/ddb/structast__sorcery__observer.html#a1ebad9f5bd6a80f6f666354460b86e0d">ast_sorcery_observer::loaded</a></div><div class="ttdeci">void(* loaded)(const char *object_type)</div><div class="ttdoc">Callback for when an object type is loaded/reloaded. </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d25/sorcery_8h_source.html#l00343">sorcery.h:343</a></div></div>
<div class="ttc" id="res__pjsip_8h_html_a85b5bfa4330f0b5e0f86311139cc00f7"><div class="ttname"><a href="../../d8/d8c/res__pjsip_8h.html#a85b5bfa4330f0b5e0f86311139cc00f7">ast_sip_format_contact_ami</a></div><div class="ttdeci">int ast_sip_format_contact_ami(void *obj, void *arg, int flags)</div><div class="ttdoc">Formats the contact and sends over AMI. </div><div class="ttdef"><b>Definition:</b> <a href="../../df/dda/pjsip__options_8c_source.html#l02717">pjsip_options.c:2717</a></div></div>
<div class="ttc" id="res__pjsip_8h_html_a5b63b1eceb879f2cf0e23f356040737a"><div class="ttname"><a href="../../d8/d8c/res__pjsip_8h.html#a5b63b1eceb879f2cf0e23f356040737a">ast_sip_create_ami_event</a></div><div class="ttdeci">struct ast_str * ast_sip_create_ami_event(const char *event, struct ast_sip_ami *ami)</div><div class="ttdoc">Creates a string to store AMI event data in. </div><div class="ttdef"><b>Definition:</b> <a href="../../dc/df6/pjsip__configuration_8c_source.html#l01584">pjsip_configuration.c:1584</a></div></div>
<div class="ttc" id="res__phoneprov_8c_html_addaa208b0ed785225e24490fb9f28a80"><div class="ttname"><a href="../../d9/de9/res__phoneprov_8c.html#addaa208b0ed785225e24490fb9f28a80">AST_MODULE_INFO</a></div><div class="ttdeci">AST_MODULE_INFO(ASTERISK_GPL_KEY, AST_MODFLAG_GLOBAL_SYMBOLS|AST_MODFLAG_LOAD_ORDER, &quot;HTTP Phone Provisioning&quot;,.support_level=AST_MODULE_SUPPORT_EXTENDED,.load=load_module,.unload=unload_module,.reload=reload,.load_pri=AST_MODPRI_CHANNEL_DEPEND,.requires=&quot;http&quot;,)</div></div>
<div class="ttc" id="sorcery_8h_html_aaa9cd237841a70862001f580b23212c9"><div class="ttname"><a href="../../d8/d25/sorcery_8h.html#aaa9cd237841a70862001f580b23212c9">ast_sorcery_retrieve_by_fields</a></div><div class="ttdeci">void * ast_sorcery_retrieve_by_fields(const struct ast_sorcery *sorcery, const char *type, unsigned int flags, struct ast_variable *fields)</div><div class="ttdoc">Retrieve an object or multiple objects using specific fields. </div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d69/sorcery_8c_source.html#l01897">sorcery.c:1897</a></div></div>
<div class="ttc" id="res__pjsip__registrar_8c_html_aa0b6ec2978c63b269ea90927f085c0d8ad88825ec6d3fcb67a681bd0c66e789eb"><div class="ttname"><a href="../../d3/db0/res__pjsip__registrar_8c.html#aa0b6ec2978c63b269ea90927f085c0d8ad88825ec6d3fcb67a681bd0c66e789eb">CONTACT_DELETE_EXPIRE</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d3/db0/res__pjsip__registrar_8c_source.html#l00207">res_pjsip_registrar.c:207</a></div></div>
<div class="ttc" id="res__pjsip_8h_html_a785afb501e315c8a97ad476fb6a8be1d"><div class="ttname"><a href="../../d8/d8c/res__pjsip_8h.html#a785afb501e315c8a97ad476fb6a8be1d">ast_sip_get_pjsip_endpoint</a></div><div class="ttdeci">pjsip_endpoint * ast_sip_get_pjsip_endpoint(void)</div><div class="ttdoc">Get a pointer to the PJSIP endpoint. </div><div class="ttdef"><b>Definition:</b> <a href="../../de/d96/res__pjsip_8c_source.html#l03718">res_pjsip.c:3718</a></div></div>
<div class="ttc" id="res__pjsip__registrar_8c_html_abefd4a2f654e85e48024d3a3751f73d1"><div class="ttname"><a href="../../d3/db0/res__pjsip__registrar_8c.html#abefd4a2f654e85e48024d3a3751f73d1">registrar_module</a></div><div class="ttdeci">static pjsip_module registrar_module</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/db0/res__pjsip__registrar_8c_source.html#l01228">res_pjsip_registrar.c:1228</a></div></div>
<div class="ttc" id="structast__sip__contact_html_a7d6a7c1f176fb54d59dd27ea307f44e6"><div class="ttname"><a href="../../d8/d8a/structast__sip__contact.html#a7d6a7c1f176fb54d59dd27ea307f44e6">ast_sip_contact::aor</a></div><div class="ttdeci">const ast_string_field aor</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d8c/res__pjsip_8h_source.html#l00303">res_pjsip.h:303</a></div></div>
<div class="ttc" id="res__pjsip__registrar_8c_html_a4f4cf2512f3131d35e101df650231ded"><div class="ttname"><a href="../../d3/db0/res__pjsip__registrar_8c.html#a4f4cf2512f3131d35e101df650231ded">sip_contact_to_str</a></div><div class="ttdeci">static int sip_contact_to_str(void *acp, void *arg, int flags)</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/db0/res__pjsip__registrar_8c_source.html#l01128">res_pjsip_registrar.c:1128</a></div></div>
<div class="ttc" id="vector_8h_html_aef32ac52c3e8a530d16eb92cde22cacd"><div class="ttname"><a href="../../d6/d68/vector_8h.html#aef32ac52c3e8a530d16eb92cde22cacd">AST_VECTOR_GET</a></div><div class="ttdeci">#define AST_VECTOR_GET(vec, idx)</div><div class="ttdoc">Get an element from a vector. </div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d68/vector_8h_source.html#l00682">vector.h:682</a></div></div>
<div class="ttc" id="sorcery_8h_html_a18d64c360480b458754fc30f781d5011"><div class="ttname"><a href="../../d8/d25/sorcery_8h.html#a18d64c360480b458754fc30f781d5011">ast_sorcery_observer_remove</a></div><div class="ttdeci">void ast_sorcery_observer_remove(const struct ast_sorcery *sorcery, const char *type, const struct ast_sorcery_observer *callbacks)</div><div class="ttdoc">Remove an observer from a specific object type. </div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d69/sorcery_8c_source.html#l02418">sorcery.c:2418</a></div></div>
<div class="ttc" id="include_2asterisk_2compat_8h_html_a40eca58273c74a20a17f137d18ba826c"><div class="ttname"><a href="../../de/da3/include_2asterisk_2compat_8h.html#a40eca58273c74a20a17f137d18ba826c">strsep</a></div><div class="ttdeci">char * strsep(char **str, const char *delims)</div></div>
<div class="ttc" id="res__pjsip__registrar_8c_html_a10954918b2b79e996b17b94e5b6c6b62"><div class="ttname"><a href="../../d3/db0/res__pjsip__registrar_8c.html#a10954918b2b79e996b17b94e5b6c6b62">registrar_contact_delete</a></div><div class="ttdeci">static int registrar_contact_delete(enum contact_delete_type type, pjsip_transport *transport, struct ast_sip_contact *contact, const char *aor_name)</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/db0/res__pjsip__registrar_8c_source.html#l00403">res_pjsip_registrar.c:403</a></div></div>
<div class="ttc" id="structast__sip__domain__alias_html_a3ec6db86c2d43dc986af427cdeb7bf0e"><div class="ttname"><a href="../../dc/d19/structast__sip__domain__alias.html#a3ec6db86c2d43dc986af427cdeb7bf0e">ast_sip_domain_alias::domain</a></div><div class="ttdeci">const ast_string_field domain</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d8c/res__pjsip_8h_source.html#l00265">res_pjsip.h:265</a></div></div>
<div class="ttc" id="res__pjsip_8h_html_a5572d52daf1a841b0f9308df901448c8"><div class="ttname"><a href="../../d8/d8c/res__pjsip_8h.html#a5572d52daf1a841b0f9308df901448c8">ast_sip_get_sorcery</a></div><div class="ttdeci">struct ast_sorcery * ast_sip_get_sorcery(void)</div><div class="ttdoc">Get a pointer to the SIP sorcery structure. </div><div class="ttdef"><b>Definition:</b> <a href="../../dc/df6/pjsip__configuration_8c_source.html#l02404">pjsip_configuration.c:2404</a></div></div>
<div class="ttc" id="structao2__iterator_html"><div class="ttname"><a href="../../d9/d97/structao2__iterator.html">ao2_iterator</a></div><div class="ttdoc">When we need to walk through a container, we use an ao2_iterator to keep track of the current positio...</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l01841">astobj2.h:1841</a></div></div>
<div class="ttc" id="astobj2_8h_html_a6321ee982370c55ab3c24c72c562cbdd"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#a6321ee982370c55ab3c24c72c562cbdd">ao2_cleanup</a></div><div class="ttdeci">#define ao2_cleanup(obj)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l01958">astobj2.h:1958</a></div></div>
<div class="ttc" id="strings_8h_html_ac4040268f7b6ed77dfc49c7767626369"><div class="ttname"><a href="../../d6/d90/strings_8h.html#ac4040268f7b6ed77dfc49c7767626369">ast_copy_string</a></div><div class="ttdeci">void ast_copy_string(char *dst, const char *src, size_t size)</div><div class="ttdoc">Size-limited null-terminating string copy. </div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d90/strings_8h_source.html#l00401">strings.h:401</a></div></div>
<div class="ttc" id="sorcery_8h_html_acb3b46997c4a11e6da3ac21e7a38d96c"><div class="ttname"><a href="../../d8/d25/sorcery_8h.html#acb3b46997c4a11e6da3ac21e7a38d96c">ast_sorcery_copy</a></div><div class="ttdeci">void * ast_sorcery_copy(const struct ast_sorcery *sorcery, const void *object)</div><div class="ttdoc">Create a copy of an object. </div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d69/sorcery_8c_source.html#l01778">sorcery.c:1778</a></div></div>
<div class="ttc" id="structregistrar__contact__details_html"><div class="ttname"><a href="../../d6/dcf/structregistrar__contact__details.html">registrar_contact_details</a></div><div class="ttdoc">Structure used for finding contact. </div><div class="ttdef"><b>Definition:</b> <a href="../../d3/db0/res__pjsip__registrar_8c_source.html#l00113">res_pjsip_registrar.c:113</a></div></div>
<div class="ttc" id="res__pjsip_8h_html_a15aa09d9084763cdd20b7467a4cd381a"><div class="ttname"><a href="../../d8/d8c/res__pjsip_8h.html#a15aa09d9084763cdd20b7467a4cd381a">ast_sip_unregister_service</a></div><div class="ttdeci">void ast_sip_unregister_service(pjsip_module *module)</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d96/res__pjsip_8c_source.html#l03331">res_pjsip.c:3331</a></div></div>
<div class="ttc" id="res__pjsip_8h_html_ab105b4d8cca635ce7aeed34c4543ab54"><div class="ttname"><a href="../../d8/d8c/res__pjsip_8h.html#ab105b4d8cca635ce7aeed34c4543ab54">ast_sip_sorcery_object_to_ami</a></div><div class="ttdeci">int ast_sip_sorcery_object_to_ami(const void *obj, struct ast_str **buf)</div><div class="ttdoc">Converts a sorcery object to a string of object properties. </div><div class="ttdef"><b>Definition:</b> <a href="../../dc/df6/pjsip__configuration_8c_source.html#l01609">pjsip_configuration.c:1609</a></div></div>
<div class="ttc" id="test__linkedlists_8c_html_a025ede890af287961d3a98d0e634a62b"><div class="ttname"><a href="../../d7/d6f/test__linkedlists_8c.html#a025ede890af287961d3a98d0e634a62b">b</a></div><div class="ttdeci">static struct test_val b</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d6f/test__linkedlists_8c_source.html#l00047">test_linkedlists.c:47</a></div></div>
<div class="ttc" id="structcontact_html"><div class="ttname"><a href="../../d9/d03/structcontact.html">contact</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d8f/reqresp__parser_8h_source.html#l00035">reqresp_parser.h:35</a></div></div>
<div class="ttc" id="res__pjsip_8h_html_a26352a4b800eeb07efd4cb7b0a531af5"><div class="ttname"><a href="../../d8/d8c/res__pjsip_8h.html#a26352a4b800eeb07efd4cb7b0a531af5">ast_sip_get_endpoints</a></div><div class="ttdeci">struct ao2_container * ast_sip_get_endpoints(void)</div><div class="ttdoc">Retrieve any endpoints available to sorcery. </div><div class="ttdef"><b>Definition:</b> <a href="../../dc/df6/pjsip__configuration_8c_source.html#l02344">pjsip_configuration.c:2344</a></div></div>
<div class="ttc" id="structao2__container_html"><div class="ttname"><a href="../../d2/da9/structao2__container.html">ao2_container</a></div><div class="ttdoc">Generic container type. </div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d20/astobj2__container__private_8h_source.html#l00282">astobj2_container_private.h:282</a></div></div>
<div class="ttc" id="res__pjsip__registrar_8c_html_ae1d1db7e95619ea0a412f1793402689e"><div class="ttname"><a href="../../d3/db0/res__pjsip__registrar_8c.html#ae1d1db7e95619ea0a412f1793402689e">path_hdr_name</a></div><div class="ttdeci">static const pj_str_t path_hdr_name</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/db0/res__pjsip__registrar_8c_source.html#l00250">res_pjsip_registrar.c:250</a></div></div>
<div class="ttc" id="structcontact__transport__monitor_html"><div class="ttname"><a href="../../d6/d85/structcontact__transport__monitor.html">contact_transport_monitor</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d3/db0/res__pjsip__registrar_8c_source.html#l00309">res_pjsip_registrar.c:309</a></div></div>
<div class="ttc" id="res__pjsip_8h_html_add251e9c14eb0f9791e60dc5c2a9e9b4"><div class="ttname"><a href="../../d8/d8c/res__pjsip_8h.html#add251e9c14eb0f9791e60dc5c2a9e9b4">ast_sip_location_update_contact</a></div><div class="ttdeci">int ast_sip_location_update_contact(struct ast_sip_contact *contact)</div><div class="ttdoc">Update a contact. </div><div class="ttdef"><b>Definition:</b> <a href="../../d0/dad/location_8c_source.html#l00445">location.c:445</a></div></div>
<div class="ttc" id="res__pjsip_8h_html_a4267a8bdd3aed1f82b2720c2c5ab61c1"><div class="ttname"><a href="../../d8/d8c/res__pjsip_8h.html#a4267a8bdd3aed1f82b2720c2c5ab61c1">ast_sip_for_each_contact</a></div><div class="ttdeci">int ast_sip_for_each_contact(const struct ast_sip_aor *aor, ao2_callback_fn on_contact, void *arg)</div><div class="ttdoc">For every contact on an AOR call the given &amp;#39;on_contact&amp;#39; handler. </div><div class="ttdef"><b>Definition:</b> <a href="../../d0/dad/location_8c_source.html#l00719">location.c:719</a></div></div>
<div class="ttc" id="res__pjsip__registrar_8c_html_aa0b6ec2978c63b269ea90927f085c0d8"><div class="ttname"><a href="../../d3/db0/res__pjsip__registrar_8c.html#aa0b6ec2978c63b269ea90927f085c0d8">contact_delete_type</a></div><div class="ttdeci">contact_delete_type</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/db0/res__pjsip__registrar_8c_source.html#l00204">res_pjsip_registrar.c:204</a></div></div>
<div class="ttc" id="structast__sip__endpoint_html_a50edbc089f02d537b9a487f1a62c889e"><div class="ttname"><a href="../../d3/d46/structast__sip__endpoint.html#a50edbc089f02d537b9a487f1a62c889e">ast_sip_endpoint::aors</a></div><div class="ttdeci">const ast_string_field aors</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d8c/res__pjsip_8h_source.html#l00821">res_pjsip.h:821</a></div></div>
<div class="ttc" id="res__pjsip__registrar_8c_html_a5099f04cc6c837b05cc6f6e4db154ead"><div class="ttname"><a href="../../d3/db0/res__pjsip__registrar_8c.html#a5099f04cc6c837b05cc6f6e4db154ead">AMI_SHOW_REGISTRATION_CONTACT_STATUSES</a></div><div class="ttdeci">#define AMI_SHOW_REGISTRATION_CONTACT_STATUSES</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/db0/res__pjsip__registrar_8c_source.html#l01225">res_pjsip_registrar.c:1225</a></div></div>
<div class="ttc" id="manager_8h_html_a5b63b8a8faede2d852e071e1f7b31c11"><div class="ttname"><a href="../../db/d45/manager_8h.html#a5b63b8a8faede2d852e071e1f7b31c11">ast_manager_register_xml</a></div><div class="ttdeci">#define ast_manager_register_xml(action, authority, func)</div><div class="ttdoc">Register a manager callback using XML documentation to describe the manager. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/d45/manager_8h_source.html#l00186">manager.h:186</a></div></div>
<div class="ttc" id="module_8h_html_aba2c8d4be709a254658b21a834f8294a"><div class="ttname"><a href="../../d5/d16/module_8h.html#aba2c8d4be709a254658b21a834f8294a">ASTERISK_GPL_KEY</a></div><div class="ttdeci">#define ASTERISK_GPL_KEY</div><div class="ttdoc">The text the key() function should return. </div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d16/module_8h_source.html#l00046">module.h:46</a></div></div>
<div class="ttc" id="res__pjsip__registrar_8c_html_aac29a93b6cccde99e2eeb55575e692fa"><div class="ttname"><a href="../../d3/db0/res__pjsip__registrar_8c.html#aac29a93b6cccde99e2eeb55575e692fa">check_interval</a></div><div class="ttdeci">static unsigned int check_interval</div><div class="ttdoc">The global interval at which to check for contact expiration. </div><div class="ttdef"><b>Definition:</b> <a href="../../d3/db0/res__pjsip__registrar_8c_source.html#l01239">res_pjsip_registrar.c:1239</a></div></div>
<div class="ttc" id="structast__sip__contact_html_a19ac71226fac09e87afe31acb4c99214"><div class="ttname"><a href="../../d8/d8a/structast__sip__contact.html#a19ac71226fac09e87afe31acb4c99214">ast_sip_contact::uri</a></div><div class="ttdeci">const ast_string_field uri</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d8c/res__pjsip_8h_source.html#l00303">res_pjsip.h:303</a></div></div>
<div class="ttc" id="module_8h_html"><div class="ttname"><a href="../../d5/d16/module_8h.html">module.h</a></div><div class="ttdoc">Asterisk module definitions. </div></div>
<div class="ttc" id="res__pjsip_8h_html_a465c83962f7f1d9d1ee84fca764505a4"><div class="ttname"><a href="../../d8/d8c/res__pjsip_8h.html#a465c83962f7f1d9d1ee84fca764505a4">ast_sip_location_retrieve_contact</a></div><div class="ttdeci">struct ast_sip_contact * ast_sip_location_retrieve_contact(const char *contact_name)</div><div class="ttdoc">Retrieve a named contact. </div><div class="ttdef"><b>Definition:</b> <a href="../../d0/dad/location_8c_source.html#l00350">location.c:350</a></div></div>
<div class="ttc" id="structast__sip__aor_html_a1286019b2fe7ef6bb13d518294d7cec4"><div class="ttname"><a href="../../d4/d03/structast__sip__aor.html#a1286019b2fe7ef6bb13d518294d7cec4">ast_sip_aor::minimum_expiration</a></div><div class="ttdeci">unsigned int minimum_expiration</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d8c/res__pjsip_8h_source.html#l00369">res_pjsip.h:369</a></div></div>
<div class="ttc" id="res__pjsip_8h_html"><div class="ttname"><a href="../../d8/d8c/res__pjsip_8h.html">res_pjsip.h</a></div></div>
<div class="ttc" id="structast__sip__aor_html_a9d65f9738bd93befcc4478004c448722"><div class="ttname"><a href="../../d4/d03/structast__sip__aor.html#a9d65f9738bd93befcc4478004c448722">ast_sip_aor::default_expiration</a></div><div class="ttdeci">unsigned int default_expiration</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d8c/res__pjsip_8h_source.html#l00373">res_pjsip.h:373</a></div></div>
<div class="ttc" id="structast__sip__aor_html_a8bc5997cae805a78e43cb40441c06ece"><div class="ttname"><a href="../../d4/d03/structast__sip__aor.html#a8bc5997cae805a78e43cb40441c06ece">ast_sip_aor::maximum_expiration</a></div><div class="ttdeci">unsigned int maximum_expiration</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d8c/res__pjsip_8h_source.html#l00371">res_pjsip.h:371</a></div></div>
<div class="ttc" id="res__pjsip__registrar_8c_html_a8eaee453c1eff0bc83bb6ca5e4d561e0"><div class="ttname"><a href="../../d3/db0/res__pjsip__registrar_8c.html#a8eaee453c1eff0bc83bb6ca5e4d561e0">expire_contact</a></div><div class="ttdeci">static int expire_contact(void *obj, void *arg, int flags)</div><div class="ttdoc">Callback function which deletes a contact. </div><div class="ttdef"><b>Definition:</b> <a href="../../d3/db0/res__pjsip__registrar_8c_source.html#l01242">res_pjsip_registrar.c:1242</a></div></div>
<div class="ttc" id="res__pjsip_8h_html_a7e419c29ebfb010ca04b7c189c207bbd"><div class="ttname"><a href="../../d8/d8c/res__pjsip_8h.html#a7e419c29ebfb010ca04b7c189c207bbd">ast_sip_transport_monitor_unregister_all</a></div><div class="ttdeci">void ast_sip_transport_monitor_unregister_all(ast_transport_monitor_shutdown_cb cb, void *data, ast_transport_monitor_data_matcher matches)</div><div class="ttdoc">Unregister a transport shutdown monitor from all reliable transports. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d94/pjsip__transport__events_8c_source.html#l00257">pjsip_transport_events.c:257</a></div></div>
<div class="ttc" id="res__pjsip__registrar_8c_html_aaaed45b85cc20418524ffe616356c2c8"><div class="ttname"><a href="../../d3/db0/res__pjsip__registrar_8c.html#aaaed45b85cc20418524ffe616356c2c8">expiration_global_observer</a></div><div class="ttdeci">static struct ast_sorcery_observer expiration_global_observer</div><div class="ttdoc">Observer which is used to update our interval when the global setting changes. </div><div class="ttdef"><b>Definition:</b> <a href="../../d3/db0/res__pjsip__registrar_8c_source.html#l01318">res_pjsip_registrar.c:1318</a></div></div>
<div class="ttc" id="res__pjsip_8h_html_acd4517938f2afe11a1c6f372e28090a5"><div class="ttname"><a href="../../d8/d8c/res__pjsip_8h.html#acd4517938f2afe11a1c6f372e28090a5">PJSIP_EXPIRES_NOT_SPECIFIED</a></div><div class="ttdeci">#define PJSIP_EXPIRES_NOT_SPECIFIED</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d8c/res__pjsip_8h_source.html#l00063">res_pjsip.h:63</a></div></div>
<div class="ttc" id="astobj2_8h_html_ad9d009e87e737af900825b36db55a35ca614744a4d36b3189d4ab5b02c8645d47"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#ad9d009e87e737af900825b36db55a35ca614744a4d36b3189d4ab5b02c8645d47">OBJ_MULTIPLE</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l01053">astobj2.h:1053</a></div></div>
<div class="ttc" id="astobj2_8h_html_a91d5d37d00874ae7a92d1a15c0a3b3a6"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#a91d5d37d00874ae7a92d1a15c0a3b3a6">ao2_iterator_init</a></div><div class="ttdeci">struct ao2_iterator ao2_iterator_init(struct ao2_container *c, int flags) attribute_warn_unused_result</div><div class="ttdoc">Create an iterator for a container. </div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d22/astobj2__container_8c_source.html#l00485">astobj2_container.c:485</a></div></div>
<div class="ttc" id="vector_8h_html_a20b08af81cc9452fb721c9a698f81bdf"><div class="ttname"><a href="../../d6/d68/vector_8h.html#a20b08af81cc9452fb721c9a698f81bdf">AST_VECTOR_SIZE</a></div><div class="ttdeci">#define AST_VECTOR_SIZE(vec)</div><div class="ttdoc">Get the number of elements in a vector. </div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d68/vector_8h_source.html#l00611">vector.h:611</a></div></div>
<div class="ttc" id="res__pjsip__registrar_8c_html_a80bf48159f4cdd1d7005f1db04b2b080"><div class="ttname"><a href="../../d3/db0/res__pjsip__registrar_8c.html#a80bf48159f4cdd1d7005f1db04b2b080">registrar_add_contact</a></div><div class="ttdeci">static int registrar_add_contact(void *obj, void *arg, int flags)</div><div class="ttdoc">Internal function which adds a contact to a response. </div><div class="ttdef"><b>Definition:</b> <a href="../../d3/db0/res__pjsip__registrar_8c_source.html#l00223">res_pjsip_registrar.c:223</a></div></div>
<div class="ttc" id="sorcery_8h_html_ad98ae6e153f53b0c3c40119acc5e5266"><div class="ttname"><a href="../../d8/d25/sorcery_8h.html#ad98ae6e153f53b0c3c40119acc5e5266">ast_sorcery_reload_object</a></div><div class="ttdeci">void ast_sorcery_reload_object(const struct ast_sorcery *sorcery, const char *type)</div><div class="ttdoc">Inform any wizards of a specific object type to reload persistent objects. </div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d69/sorcery_8c_source.html#l01442">sorcery.c:1442</a></div></div>
<div class="ttc" id="group__named__locks_html_ga2322f66e9b72ca5cc591a556c567d3e0"><div class="ttname"><a href="../../d0/db9/group__named__locks.html#ga2322f66e9b72ca5cc591a556c567d3e0">ast_named_lock_get</a></div><div class="ttdeci">#define ast_named_lock_get(lock_type, keyspace, key)</div><div class="ttdoc">Geta named lock handle. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d32/named__locks_8h_source.html#l00083">named_locks.h:83</a></div></div>
<div class="ttc" id="res__pjsip_8h_html_aa93f25c991cf8d8abb179bece0f179a6"><div class="ttname"><a href="../../d8/d8c/res__pjsip_8h.html#aa93f25c991cf8d8abb179bece0f179a6">ast_sip_get_ignore_uri_user_options</a></div><div class="ttdeci">unsigned int ast_sip_get_ignore_uri_user_options(void)</div><div class="ttdoc">Retrieve the global setting &amp;#39;ignore_uri_user_options&amp;#39;. </div><div class="ttdef"><b>Definition:</b> <a href="../../dd/dfd/config__global_8c_source.html#l00447">config_global.c:447</a></div></div>
<div class="ttc" id="strings_8h_html_a9c34c6c6b8daaba24c0406270f3cf697"><div class="ttname"><a href="../../d6/d90/strings_8h.html#a9c34c6c6b8daaba24c0406270f3cf697">ast_str_create</a></div><div class="ttdeci">#define ast_str_create(init_len)</div><div class="ttdoc">Create a malloc&amp;#39;ed dynamic length string. </div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d90/strings_8h_source.html#l00620">strings.h:620</a></div></div>
<div class="ttc" id="group__named__locks_html_ga16b38cbe1bbd5caee828393d0299f463"><div class="ttname"><a href="../../d0/db9/group__named__locks.html#ga16b38cbe1bbd5caee828393d0299f463">ast_named_lock_put</a></div><div class="ttdeci">#define ast_named_lock_put(lock)</div><div class="ttdoc">Put a named lock handle away. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d32/named__locks_8h_source.html#l00093">named_locks.h:93</a></div></div>
<div class="ttc" id="stringfields_8h_html_a653461abd6e0d16e4e3326ab90e0501d"><div class="ttname"><a href="../../d1/d0f/stringfields_8h.html#a653461abd6e0d16e4e3326ab90e0501d">ast_string_field_set</a></div><div class="ttdeci">#define ast_string_field_set(x, field, data)</div><div class="ttdoc">Set a field to a simple string value. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d0f/stringfields_8h_source.html#l00514">stringfields.h:514</a></div></div>
<div class="ttc" id="group__Group__AMI_html_ga0ee6ee1f4d200f711e2983bffe770a72"><div class="ttname"><a href="../../df/d72/group__Group__AMI.html#ga0ee6ee1f4d200f711e2983bffe770a72">astman_send_listack</a></div><div class="ttdeci">void astman_send_listack(struct mansession *s, const struct message *m, char *msg, char *listflag)</div><div class="ttdoc">Send ack in manager transaction to begin a list. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d10/manager_8c_source.html#l03201">manager.c:3201</a></div></div>
<div class="ttc" id="test__linkedlists_8c_html_a13dd15487fee89a002d17ef3aff62d02"><div class="ttname"><a href="../../d7/d6f/test__linkedlists_8c.html#a13dd15487fee89a002d17ef3aff62d02">a</a></div><div class="ttdeci">static struct test_val a</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d6f/test__linkedlists_8c_source.html#l00046">test_linkedlists.c:46</a></div></div>
<div class="ttc" id="vector_8h_html_a6e7f18e9b5743289694fea16ba629174"><div class="ttname"><a href="../../d6/d68/vector_8h.html#a6e7f18e9b5743289694fea16ba629174">AST_VECTOR_MAX_SIZE</a></div><div class="ttdeci">#define AST_VECTOR_MAX_SIZE(vec)</div><div class="ttdoc">Get the maximum number of elements the vector can currently hold. </div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d68/vector_8h_source.html#l00619">vector.h:619</a></div></div>
<div class="ttc" id="astobj2_8h_html_a1ad9f122bcae95a470639402faa3d2ee"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#a1ad9f122bcae95a470639402faa3d2ee">ao2_link</a></div><div class="ttdeci">#define ao2_link(container, obj)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l01549">astobj2.h:1549</a></div></div>
</div><!-- fragment --></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Sun Aug 8 2021 19:44:06 for Asterisk - The Open Source Telephony Project by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="../../doxygen.png" alt="doxygen"/>
</a> 1.8.13
</small></address>
</body>
</html>
