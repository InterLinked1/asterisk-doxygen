<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Asterisk - The Open Source Telephony Project: dns_internal.h File Reference</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Asterisk - The Open Source Telephony Project
   &#160;<span id="projectnumber">18.5.0</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "../../search",false,'Search');
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('../../',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="../../dir_d44c64559bbebec7f509842c48db8b23.html">include</a></li><li class="navelem"><a class="el" href="../../dir_6d4b1cdb59e2db6ad82005b337288fef.html">asterisk</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#nested-classes">Data Structures</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">dns_internal.h File Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>Internal DNS structure definitions.  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &quot;<a class="el" href="../../df/d90/linkedlists_8h_source.html">asterisk/linkedlists.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="../../d6/d68/vector_8h_source.html">asterisk/vector.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="../../d7/d38/dns__query__set_8h_source.html">asterisk/dns_query_set.h</a>&quot;</code><br />
</div><div class="textblock"><div class="dynheader">
Include dependency graph for dns_internal.h:</div>
<div class="dyncontent">
<div class="center"><img src="../../dc/de9/dns__internal_8h__incl.png" border="0" usemap="#dns__internal_8h" alt=""/></div>
<map name="dns__internal_8h" id="dns__internal_8h">
<area shape="rect" id="node2" href="../../df/d90/linkedlists_8h.html" title="A set of macros to manage forward&#45;linked lists. " alt="" coords="264,87,415,114"/>
<area shape="rect" id="node13" href="../../d6/d68/vector_8h.html" title="Vector container support. " alt="" coords="439,87,565,114"/>
<area shape="rect" id="node14" href="../../d7/d38/dns__query__set_8h.html" title="DNS Query Set API. " alt="" coords="589,80,732,121"/>
<area shape="rect" id="node3" href="../../dd/d42/lock_8h.html" title="Asterisk locking&#45;related definitions: " alt="" coords="364,169,477,196"/>
<area shape="rect" id="node5" href="../../de/df7/time_8h.html" title="Time&#45;related functions and macros. " alt="" coords="113,244,176,271"/>
<area shape="rect" id="node6" href="../../d5/d9d/inline__api_8h.html" title="Inlinable API function macro. " alt="" coords="106,319,253,345"/>
<area shape="rect" id="node9" href="../../d3/dda/backtrace_8h.html" title="Asterisk backtrace generation. " alt="" coords="488,244,639,271"/>
<area shape="rect" id="node10" href="../../d1/d8c/logger_8h.html" title="Support for logging to various files, console and syslog Configuration in file logger.conf. " alt="" coords="663,244,789,271"/>
<area shape="rect" id="node11" href="../../d4/dd1/compiler_8h.html" title="Compiler&#45;specific macros and other items. " alt="" coords="813,244,956,271"/>
</map>
</div>
</div><div class="textblock"><div class="dynheader">
This graph shows which files directly or indirectly include this file:</div>
<div class="dyncontent">
<div class="center"><img src="../../d7/d82/dns__internal_8h__dep__incl.png" border="0" usemap="#dns__internal_8hdep" alt=""/></div>
<map name="dns__internal_8hdep" id="dns__internal_8hdep">
<area shape="rect" id="node2" href="../../dc/d00/dns__core_8c.html" title="Core DNS Functionality. " alt="" coords="5,80,96,107"/>
<area shape="rect" id="node3" href="../../d3/de7/dns__naptr_8c.html" title="DNS NAPTR Record Support. " alt="" coords="120,80,216,107"/>
<area shape="rect" id="node4" href="../../d5/da5/dns__query__set_8c.html" title="DNS Query Set API. " alt="" coords="241,80,367,107"/>
<area shape="rect" id="node5" href="../../d8/dad/dns__recurring_8c.html" title="DNS Recurring Query Support. " alt="" coords="392,80,512,107"/>
<area shape="rect" id="node6" href="../../db/d8e/dns__srv_8c.html" title="DNS SRV Record Support. " alt="" coords="537,80,618,107"/>
<area shape="rect" id="node7" href="../../da/d40/dns__txt_8c.html" title="DNS TXT Record Parsing API. " alt="" coords="643,80,723,107"/>
<area shape="rect" id="node8" href="../../da/d14/test__dns_8c.html" title="test_dns.c" alt="" coords="747,80,835,107"/>
<area shape="rect" id="node9" href="../../d3/d10/test__dns__query__set_8c.html" title="test_dns_query_set.c" alt="" coords="859,80,1018,107"/>
<area shape="rect" id="node10" href="../../d5/d36/test__dns__recurring_8c.html" title="test_dns_recurring.c" alt="" coords="1043,80,1195,107"/>
</map>
</div>
</div>
<p><a href="../../d4/d07/dns__internal_8h_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="nested-classes"></a>
Data Structures</h2></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../df/de3/structast__dns__naptr__record.html">ast_dns_naptr_record</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">A NAPTR record.  <a href="../../df/de3/structast__dns__naptr__record.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/daa/structast__dns__query.html">ast_dns_query</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">A DNS query.  <a href="../../dd/daa/structast__dns__query.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d8/dcd/structast__dns__query__active.html">ast_dns_query_active</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">An active DNS query.  <a href="../../d8/dcd/structast__dns__query__active.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d3/d8e/structast__dns__query__recurring.html">ast_dns_query_recurring</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">A recurring DNS query.  <a href="../../d3/d8e/structast__dns__query__recurring.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../de/d05/structast__dns__query__set.html">ast_dns_query_set</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">A set of DNS queries.  <a href="../../de/d05/structast__dns__query__set.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d3/db7/structast__dns__record.html">ast_dns_record</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">For AST_LIST.  <a href="../../d3/db7/structast__dns__record.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d5/d8d/structast__dns__result.html">ast_dns_result</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">The result of a DNS query.  <a href="../../d5/d8d/structast__dns__result.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d8/d2f/structast__dns__srv__record.html">ast_dns_srv_record</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">An SRV record.  <a href="../../d8/d2f/structast__dns__srv__record.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d7/d27/structast__dns__txt__record.html">ast_dns_txt_record</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">A TXT record.  <a href="../../d7/d27/structast__dns__txt__record.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/d67/structdns__query__set__query.html">dns_query_set_query</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">A DNS query set query, which includes its state.  <a href="../../d1/d67/structdns__query__set__query.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../df/d30/structast__dns__result_1_1dns__records.html">ast_dns_result::dns_records</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">Records returned.  <a href="../../df/d30/structast__dns__result_1_1dns__records.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:aa9c22f8eab331f04123b701f5979b6ec"><td class="memItemLeft" align="right" valign="top">struct <a class="el" href="../../d7/de8/structast__sched__context.html">ast_sched_context</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d4/d07/dns__internal_8h.html#aa9c22f8eab331f04123b701f5979b6ec">ast_dns_get_sched</a> (void)</td></tr>
<tr class="memdesc:aa9c22f8eab331f04123b701f5979b6ec"><td class="mdescLeft">&#160;</td><td class="mdescRight">Retrieve the DNS scheduler context.  <a href="#aa9c22f8eab331f04123b701f5979b6ec">More...</a><br /></td></tr>
<tr class="separator:aa9c22f8eab331f04123b701f5979b6ec"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae0b5c136c1af09327876900be0630411"><td class="memItemLeft" align="right" valign="top">char *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d4/d07/dns__internal_8h.html#ae0b5c136c1af09327876900be0630411">dns_find_record</a> (const char *record, size_t record_size, const char *response, size_t response_size)</td></tr>
<tr class="memdesc:ae0b5c136c1af09327876900be0630411"><td class="mdescLeft">&#160;</td><td class="mdescRight">Find the location of a DNS record within the entire DNS answer.  <a href="#ae0b5c136c1af09327876900be0630411">More...</a><br /></td></tr>
<tr class="separator:ae0b5c136c1af09327876900be0630411"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1507445dcefc7ca59022e2ef4c2433aa"><td class="memItemLeft" align="right" valign="top">struct <a class="el" href="../../d3/db7/structast__dns__record.html">ast_dns_record</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d4/d07/dns__internal_8h.html#a1507445dcefc7ca59022e2ef4c2433aa">dns_naptr_alloc</a> (struct <a class="el" href="../../dd/daa/structast__dns__query.html">ast_dns_query</a> *query, const char *data, const size_t size)</td></tr>
<tr class="memdesc:a1507445dcefc7ca59022e2ef4c2433aa"><td class="mdescLeft">&#160;</td><td class="mdescRight">Allocate and parse a DNS NAPTR record.  <a href="#a1507445dcefc7ca59022e2ef4c2433aa">More...</a><br /></td></tr>
<tr class="separator:a1507445dcefc7ca59022e2ef4c2433aa"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a089c9ec9c3011b12cefaddd04afd2ec5"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d4/d07/dns__internal_8h.html#a089c9ec9c3011b12cefaddd04afd2ec5">dns_naptr_sort</a> (struct <a class="el" href="../../d5/d8d/structast__dns__result.html">ast_dns_result</a> *<a class="el" href="../../de/d1b/cel__pgsql_8c.html#ad6c487210772a9b4b0ca04b04b847d4c">result</a>)</td></tr>
<tr class="memdesc:a089c9ec9c3011b12cefaddd04afd2ec5"><td class="mdescLeft">&#160;</td><td class="mdescRight">Sort the NAPTR records on a result.  <a href="#a089c9ec9c3011b12cefaddd04afd2ec5">More...</a><br /></td></tr>
<tr class="separator:a089c9ec9c3011b12cefaddd04afd2ec5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9e4884282d130aebaed0e9d0737fa19b"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d4/d07/dns__internal_8h.html#a9e4884282d130aebaed0e9d0737fa19b">dns_parse_short</a> (unsigned char *cur, uint16_t *<a class="el" href="../../d5/d85/structval.html">val</a>)</td></tr>
<tr class="memdesc:a9e4884282d130aebaed0e9d0737fa19b"><td class="mdescLeft">&#160;</td><td class="mdescRight">Parse a 16-bit unsigned value from a DNS record.  <a href="#a9e4884282d130aebaed0e9d0737fa19b">More...</a><br /></td></tr>
<tr class="separator:a9e4884282d130aebaed0e9d0737fa19b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aabe2faa5200934ee2828955f611e4d5a"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d4/d07/dns__internal_8h.html#aabe2faa5200934ee2828955f611e4d5a">dns_parse_string</a> (char *cur, uint8_t *size, char **<a class="el" href="../../d5/d85/structval.html">val</a>)</td></tr>
<tr class="memdesc:aabe2faa5200934ee2828955f611e4d5a"><td class="mdescLeft">&#160;</td><td class="mdescRight">Parse a DNS string from a DNS record.  <a href="#aabe2faa5200934ee2828955f611e4d5a">More...</a><br /></td></tr>
<tr class="separator:aabe2faa5200934ee2828955f611e4d5a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a86b5cf0f0336d590f503c0135e787a9b"><td class="memItemLeft" align="right" valign="top">struct <a class="el" href="../../dd/daa/structast__dns__query.html">ast_dns_query</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d4/d07/dns__internal_8h.html#a86b5cf0f0336d590f503c0135e787a9b">dns_query_alloc</a> (const char *<a class="el" href="../../d1/da4/res__corosync_8c.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, int rr_type, int rr_class, <a class="el" href="../../d6/d51/dns__core_8h.html#a64f08db76c6a6c41dbf6603bbc333b93">ast_dns_resolve_callback</a> callback, void *data)</td></tr>
<tr class="memdesc:a86b5cf0f0336d590f503c0135e787a9b"><td class="mdescLeft">&#160;</td><td class="mdescRight">Allocate a DNS query (but do not start resolution)  <a href="#a86b5cf0f0336d590f503c0135e787a9b">More...</a><br /></td></tr>
<tr class="separator:a86b5cf0f0336d590f503c0135e787a9b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac589eed5d41a033773f18c17ca26ac23"><td class="memItemLeft" align="right" valign="top">struct <a class="el" href="../../d3/db7/structast__dns__record.html">ast_dns_record</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d4/d07/dns__internal_8h.html#ac589eed5d41a033773f18c17ca26ac23">dns_srv_alloc</a> (struct <a class="el" href="../../dd/daa/structast__dns__query.html">ast_dns_query</a> *query, const char *data, const size_t size)</td></tr>
<tr class="memdesc:ac589eed5d41a033773f18c17ca26ac23"><td class="mdescLeft">&#160;</td><td class="mdescRight">Allocate and parse a DNS SRV record.  <a href="#ac589eed5d41a033773f18c17ca26ac23">More...</a><br /></td></tr>
<tr class="separator:ac589eed5d41a033773f18c17ca26ac23"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:acc5da1ef3d174b88147bf572ad8f50fe"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d4/d07/dns__internal_8h.html#acc5da1ef3d174b88147bf572ad8f50fe">dns_srv_sort</a> (struct <a class="el" href="../../d5/d8d/structast__dns__result.html">ast_dns_result</a> *<a class="el" href="../../de/d1b/cel__pgsql_8c.html#ad6c487210772a9b4b0ca04b04b847d4c">result</a>)</td></tr>
<tr class="memdesc:acc5da1ef3d174b88147bf572ad8f50fe"><td class="mdescLeft">&#160;</td><td class="mdescRight">Sort the SRV records on a result.  <a href="#acc5da1ef3d174b88147bf572ad8f50fe">More...</a><br /></td></tr>
<tr class="separator:acc5da1ef3d174b88147bf572ad8f50fe"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac4f896221fef31da2cbffdb2cb496f4b"><td class="memItemLeft" align="right" valign="top">struct <a class="el" href="../../d3/db7/structast__dns__record.html">ast_dns_record</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d4/d07/dns__internal_8h.html#ac4f896221fef31da2cbffdb2cb496f4b">dns_txt_alloc</a> (struct <a class="el" href="../../dd/daa/structast__dns__query.html">ast_dns_query</a> *query, const char *data, const size_t size)</td></tr>
<tr class="memdesc:ac4f896221fef31da2cbffdb2cb496f4b"><td class="mdescLeft">&#160;</td><td class="mdescRight">Allocate and parse a DNS TXT record.  <a href="#ac4f896221fef31da2cbffdb2cb496f4b">More...</a><br /></td></tr>
<tr class="separator:ac4f896221fef31da2cbffdb2cb496f4b"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Internal DNS structure definitions. </p>
<dl class="section author"><dt>Author</dt><dd>Joshua Colp <a href="#" onclick="location.href='mai'+'lto:'+'jco'+'lp'+'@di'+'gi'+'um.'+'co'+'m'; return false;">jcolp<span style="display: none;">.nosp@m.</span>@dig<span style="display: none;">.nosp@m.</span>ium.c<span style="display: none;">.nosp@m.</span>om</a> </dd></dl>

<p class="definition">Definition in file <a class="el" href="../../d4/d07/dns__internal_8h_source.html">dns_internal.h</a>.</p>
</div><h2 class="groupheader">Function Documentation</h2>
<a id="aa9c22f8eab331f04123b701f5979b6ec"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa9c22f8eab331f04123b701f5979b6ec">&#9670;&nbsp;</a></span>ast_dns_get_sched()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="../../d7/de8/structast__sched__context.html">ast_sched_context</a>* ast_dns_get_sched </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Retrieve the DNS scheduler context. </p>
<dl class="section return"><dt>Returns</dt><dd>scheduler context </dd></dl>

<p class="definition">Definition at line <a class="el" href="../../dc/d00/dns__core_8c_source.html#l00052">52</a> of file <a class="el" href="../../dc/d00/dns__core_8c_source.html">dns_core.c</a>.</p>

<p class="reference">References <a class="el" href="../../dc/d00/dns__core_8c_source.html#l00050">sched</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../d8/dad/dns__recurring_8c_source.html#l00109">ast_dns_resolve_recurring()</a>, <a class="el" href="../../d8/dad/dns__recurring_8c_source.html#l00138">ast_dns_resolve_recurring_cancel()</a>, and <a class="el" href="../../d8/dad/dns__recurring_8c_source.html#l00071">dns_query_recurring_resolution_callback()</a>.</p>
<div class="fragment"><div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;{</div><div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;   <span class="keywordflow">return</span> <a class="code" href="../../dc/d00/dns__core_8c.html#a361b448e9abcfc301602a2573a662d3c">sched</a>;</div><div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;}</div><div class="ttc" id="dns__core_8c_html_a361b448e9abcfc301602a2573a662d3c"><div class="ttname"><a href="../../dc/d00/dns__core_8c.html#a361b448e9abcfc301602a2573a662d3c">sched</a></div><div class="ttdeci">static struct ast_sched_context * sched</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d00/dns__core_8c_source.html#l00050">dns_core.c:50</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="ae0b5c136c1af09327876900be0630411"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae0b5c136c1af09327876900be0630411">&#9670;&nbsp;</a></span>dns_find_record()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">char* dns_find_record </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>record</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>record_size</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>response</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>response_size</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Find the location of a DNS record within the entire DNS answer. </p>
<p>The DNS record that has been returned by the resolver may be a copy of the record that was found in the complete DNS response. If so, then some DNS record types (specifically those that parse domains) will need to locate the DNS record within the complete DNS response. This is so that if the domain contains pointers to other sections of the DNS response, then the referenced domains may be located.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">record</td><td>The DNS record returned by a resolver implementation </td></tr>
    <tr><td class="paramname">record_size</td><td>The size of the DNS record in bytes </td></tr>
    <tr><td class="paramname">response</td><td>The complete DNS answer </td></tr>
    <tr><td class="paramname">response_size</td><td>The size of the complete DNS response </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="../../dc/d00/dns__core_8c_source.html#l00701">701</a> of file <a class="el" href="../../dc/d00/dns__core_8c_source.html">dns_core.c</a>.</p>

<p class="reference">References <a class="el" href="../../d5/d60/utils_8h_source.html#l00695">ast_assert</a>, and <a class="el" href="../../dc/d7f/resample_8c_source.html#l00096">NULL</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../d3/de7/dns__naptr_8c_source.html#l00380">dns_naptr_alloc()</a>, and <a class="el" href="../../db/d8e/dns__srv_8c_source.html#l00042">dns_srv_alloc()</a>.</p>
<div class="fragment"><div class="line"><a name="l00702"></a><span class="lineno">  702</span>&#160;{</div><div class="line"><a name="l00703"></a><span class="lineno">  703</span>&#160;   <span class="keywordtype">size_t</span> remaining_size = response_size;</div><div class="line"><a name="l00704"></a><span class="lineno">  704</span>&#160;   <span class="keyword">const</span> <span class="keywordtype">char</span> *search_base = response;</div><div class="line"><a name="l00705"></a><span class="lineno">  705</span>&#160;   <span class="keywordtype">char</span> *record_offset;</div><div class="line"><a name="l00706"></a><span class="lineno">  706</span>&#160;</div><div class="line"><a name="l00707"></a><span class="lineno">  707</span>&#160;   <span class="keywordflow">while</span> (1) {</div><div class="line"><a name="l00708"></a><span class="lineno">  708</span>&#160;      record_offset = memchr(search_base, record[0], remaining_size);</div><div class="line"><a name="l00709"></a><span class="lineno">  709</span>&#160;</div><div class="line"><a name="l00710"></a><span class="lineno">  710</span>&#160;      <a class="code" href="../../d5/d60/utils_8h.html#a24374da24af1931d8a7ccde5b352bb2c">ast_assert</a>(record_offset != <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div><div class="line"><a name="l00711"></a><span class="lineno">  711</span>&#160;      <a class="code" href="../../d5/d60/utils_8h.html#a24374da24af1931d8a7ccde5b352bb2c">ast_assert</a>(search_base + remaining_size - record_offset &gt;= record_size);</div><div class="line"><a name="l00712"></a><span class="lineno">  712</span>&#160;</div><div class="line"><a name="l00713"></a><span class="lineno">  713</span>&#160;      <span class="keywordflow">if</span> (!memcmp(record_offset, record, record_size)) {</div><div class="line"><a name="l00714"></a><span class="lineno">  714</span>&#160;         <span class="keywordflow">return</span> record_offset;</div><div class="line"><a name="l00715"></a><span class="lineno">  715</span>&#160;      }</div><div class="line"><a name="l00716"></a><span class="lineno">  716</span>&#160;</div><div class="line"><a name="l00717"></a><span class="lineno">  717</span>&#160;      remaining_size -= record_offset - search_base;</div><div class="line"><a name="l00718"></a><span class="lineno">  718</span>&#160;      search_base = record_offset + 1;</div><div class="line"><a name="l00719"></a><span class="lineno">  719</span>&#160;   }</div><div class="line"><a name="l00720"></a><span class="lineno">  720</span>&#160;}</div><div class="ttc" id="utils_8h_html_a24374da24af1931d8a7ccde5b352bb2c"><div class="ttname"><a href="../../d5/d60/utils_8h.html#a24374da24af1931d8a7ccde5b352bb2c">ast_assert</a></div><div class="ttdeci">#define ast_assert(a)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d60/utils_8h_source.html#l00695">utils.h:695</a></div></div>
<div class="ttc" id="resample_8c_html_a070d2ce7b6bb7e5c05602aa8c308d0c4"><div class="ttname"><a href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a></div><div class="ttdeci">#define NULL</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d7f/resample_8c_source.html#l00096">resample.c:96</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a1507445dcefc7ca59022e2ef4c2433aa"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1507445dcefc7ca59022e2ef4c2433aa">&#9670;&nbsp;</a></span>dns_naptr_alloc()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="../../d3/db7/structast__dns__record.html">ast_dns_record</a>* dns_naptr_alloc </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="../../dd/daa/structast__dns__query.html">ast_dns_query</a> *&#160;</td>
          <td class="paramname"><em>query</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>data</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const size_t&#160;</td>
          <td class="paramname"><em>size</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Allocate and parse a DNS NAPTR record. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">query</td><td>The DNS query </td></tr>
    <tr><td class="paramname">data</td><td>This specific NAPTR record </td></tr>
    <tr><td class="paramname">size</td><td>The size of the NAPTR record</td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">non-NULL</td><td>success </td></tr>
    <tr><td class="paramname">NULL</td><td>failure </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="../../d3/de7/dns__naptr_8c_source.html#l00380">380</a> of file <a class="el" href="../../d3/de7/dns__naptr_8c_source.html">dns_naptr.c</a>.</p>

<p class="reference">References <a class="el" href="../../d4/d07/dns__internal_8h_source.html#l00129">ast_dns_result::answer</a>, <a class="el" href="../../d4/d07/dns__internal_8h_source.html#l00131">ast_dns_result::answer_size</a>, <a class="el" href="../../d5/d60/utils_8h_source.html#l00695">ast_assert</a>, <a class="el" href="../../d8/d8a/astmm_8h_source.html#l00204">ast_calloc</a>, <a class="el" href="../../da/df7/astobj2_8c_source.html#l00042">ast_log</a>, <a class="el" href="../../d4/d07/dns__internal_8h_source.html#l00113">ast_dns_naptr_record::data</a>, <a class="el" href="../../d4/d07/dns__internal_8h_source.html#l00058">ast_dns_record::data_ptr</a>, <a class="el" href="../../dc/d00/dns__core_8c_source.html#l00701">dns_find_record()</a>, <a class="el" href="../../dc/d00/dns__core_8c_source.html#l00722">dns_parse_short()</a>, <a class="el" href="../../dc/d00/dns__core_8c_source.html#l00734">dns_parse_string()</a>, <a class="el" href="../../d1/d6e/main_2stdtime_2private_8h.html#ad65a8842cc674e3ddf69355898c0ecbf">errno</a>, <a class="el" href="../../d4/d07/dns__internal_8h_source.html#l00096">ast_dns_naptr_record::flags</a>, <a class="el" href="../../d3/de7/dns__naptr_8c_source.html#l00054">FLAGS_INVALID</a>, <a class="el" href="../../d4/d07/dns__internal_8h_source.html#l00094">ast_dns_naptr_record::generic</a>, <a class="el" href="../../d3/de7/dns__naptr_8c_source.html#l00066">interpret_flags()</a>, <a class="el" href="../../d1/d8c/logger_8h_source.html#l00285">LOG_ERROR</a>, <a class="el" href="../../dc/d7f/resample_8c_source.html#l00096">NULL</a>, <a class="el" href="../../d2/d79/analys_8c_source.html#l00066">order</a>, <a class="el" href="../../d4/d07/dns__internal_8h_source.html#l00104">ast_dns_naptr_record::order</a>, <a class="el" href="../../d3/de7/dns__naptr_8c_source.html#l00378">PAST_END_OF_RECORD</a>, <a class="el" href="../../d4/d07/dns__internal_8h_source.html#l00106">ast_dns_naptr_record::preference</a>, <a class="el" href="../../d4/d07/dns__internal_8h_source.html#l00100">ast_dns_naptr_record::regexp</a>, <a class="el" href="../../d3/de7/dns__naptr_8c_source.html#l00309">regexp_invalid()</a>, <a class="el" href="../../d4/d07/dns__internal_8h_source.html#l00102">ast_dns_naptr_record::replacement</a>, <a class="el" href="../../d4/d07/dns__internal_8h_source.html#l00147">ast_dns_query::result</a>, <a class="el" href="../../d4/d07/dns__internal_8h_source.html#l00098">ast_dns_naptr_record::service</a>, and <a class="el" href="../../d3/de7/dns__naptr_8c_source.html#l00130">services_invalid()</a>.</p>
<div class="fragment"><div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;{</div><div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../df/de3/structast__dns__naptr__record.html">ast_dns_naptr_record</a> *<a class="code" href="../../dd/d3d/structnaptr.html">naptr</a>;</div><div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;   <span class="keywordtype">char</span> *ptr = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;   uint16_t <a class="code" href="../../d2/d79/analys_8c.html#aed7ca058008dc3e5ee131e575abed285">order</a>;</div><div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;   uint16_t <a class="code" href="../../df/de3/structast__dns__naptr__record.html#a4855753a7f624d6708dade9e9c4f0080">preference</a>;</div><div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;   uint8_t flags_size;</div><div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;   <span class="keywordtype">char</span> *<a class="code" href="../../df/de3/structast__dns__naptr__record.html#acce5fc0dd978f67c45fcf195f37e7422">flags</a>;</div><div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;   uint8_t services_size;</div><div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;   <span class="keywordtype">char</span> *services;</div><div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;   uint8_t regexp_size;</div><div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;   <span class="keywordtype">char</span> *<a class="code" href="../../df/de3/structast__dns__naptr__record.html#a5c796239be94e0b9cfe95e168e34d1da">regexp</a>;</div><div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;   <span class="keywordtype">char</span> <a class="code" href="../../df/de3/structast__dns__naptr__record.html#af13ea6e7567ddf33e5f2dc7fcafde92f">replacement</a>[256] = <span class="stringliteral">&quot;&quot;</span>;</div><div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;   <span class="keywordtype">int</span> replacement_size;</div><div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;   <span class="keyword">const</span> <span class="keywordtype">char</span> *end_of_record;</div><div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;   <span class="keyword">enum</span> <a class="code" href="../../d3/de7/dns__naptr_8c.html#aed9b1a7b999cab0deaddd6ca8704685e">flags_result</a> flags_res;</div><div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;   <span class="keywordtype">size_t</span> naptr_len;</div><div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;</div><div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;   ptr = <a class="code" href="../../d4/d07/dns__internal_8h.html#ae0b5c136c1af09327876900be0630411">dns_find_record</a>(<a class="code" href="../../df/de3/structast__dns__naptr__record.html#a9a3b4be1b9151b0369d7fca9911c7ecd">data</a>, size, query-&gt;<a class="code" href="../../dd/daa/structast__dns__query.html#a739d372feb17d2aa4aefab56762623e4">result</a>-&gt;<a class="code" href="../../d5/d8d/structast__dns__result.html#acf478081be3b257185e81c8a92235209">answer</a>, query-&gt;<a class="code" href="../../dd/daa/structast__dns__query.html#a739d372feb17d2aa4aefab56762623e4">result</a>-&gt;<a class="code" href="../../d5/d8d/structast__dns__result.html#a60e7f19e0a67dbea7e21c74f1a225fef">answer_size</a>);</div><div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;   <a class="code" href="../../d5/d60/utils_8h.html#a24374da24af1931d8a7ccde5b352bb2c">ast_assert</a>(ptr != <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div><div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;</div><div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;   end_of_record = ptr + size;</div><div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;</div><div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;   <span class="comment">/* ORDER */</span></div><div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;   <span class="comment">/* This assignment takes a big-endian 16-bit value and stores it in the</span></div><div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;<span class="comment">    * machine&#39;s native byte order. Using this method allows us to avoid potential</span></div><div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;<span class="comment">    * alignment issues in case the order is not on a short-addressable boundary.</span></div><div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;<span class="comment">    * See http://commandcenter.blogspot.com/2012/04/byte-order-fallacy.html for</span></div><div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;<span class="comment">    * more information</span></div><div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;<span class="comment">    */</span></div><div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;   ptr += <a class="code" href="../../d4/d07/dns__internal_8h.html#a9e4884282d130aebaed0e9d0737fa19b">dns_parse_short</a>((<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *) ptr, &amp;order);</div><div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d3/de7/dns__naptr_8c.html#a3f25bf14345796cc59bc63bbdfe09642">PAST_END_OF_RECORD</a>) {</div><div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;   }</div><div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;</div><div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;   <span class="comment">/* PREFERENCE */</span></div><div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;   ptr += <a class="code" href="../../d4/d07/dns__internal_8h.html#a9e4884282d130aebaed0e9d0737fa19b">dns_parse_short</a>((<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *) ptr, &amp;preference);</div><div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d3/de7/dns__naptr_8c.html#a3f25bf14345796cc59bc63bbdfe09642">PAST_END_OF_RECORD</a>) {</div><div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;   }</div><div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;</div><div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;   <span class="comment">/* FLAGS */</span></div><div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;   ptr += <a class="code" href="../../d4/d07/dns__internal_8h.html#aabe2faa5200934ee2828955f611e4d5a">dns_parse_string</a>(ptr, &amp;flags_size, &amp;flags);</div><div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d3/de7/dns__naptr_8c.html#a3f25bf14345796cc59bc63bbdfe09642">PAST_END_OF_RECORD</a>) {</div><div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;   }</div><div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;</div><div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;   <span class="comment">/* SERVICES */</span></div><div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;   ptr += <a class="code" href="../../d4/d07/dns__internal_8h.html#aabe2faa5200934ee2828955f611e4d5a">dns_parse_string</a>(ptr, &amp;services_size, &amp;services);</div><div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d3/de7/dns__naptr_8c.html#a3f25bf14345796cc59bc63bbdfe09642">PAST_END_OF_RECORD</a>) {</div><div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;   }</div><div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;</div><div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;   <span class="comment">/* REGEXP */</span></div><div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;   ptr += <a class="code" href="../../d4/d07/dns__internal_8h.html#aabe2faa5200934ee2828955f611e4d5a">dns_parse_string</a>(ptr, &amp;regexp_size, &amp;regexp);</div><div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d3/de7/dns__naptr_8c.html#a3f25bf14345796cc59bc63bbdfe09642">PAST_END_OF_RECORD</a>) {</div><div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;   }</div><div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;</div><div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;   <span class="comment">/*</span></div><div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;<span class="comment">    * The return value from dn_expand represents the size of the replacement</span></div><div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;<span class="comment">    * in the buffer which MAY be compressed.  Since the expanded replacement</span></div><div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;<span class="comment">    * is NULL terminated, you can use strlen() to get the expanded size.</span></div><div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;<span class="comment">    */</span></div><div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;   replacement_size = dn_expand((<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *)query-&gt;<a class="code" href="../../dd/daa/structast__dns__query.html#a739d372feb17d2aa4aefab56762623e4">result</a>-&gt;<a class="code" href="../../d5/d8d/structast__dns__result.html#acf478081be3b257185e81c8a92235209">answer</a>,</div><div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;      (<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *) end_of_record, (<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *) ptr,</div><div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;      replacement, <span class="keyword">sizeof</span>(replacement) - 1);</div><div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;   <span class="keywordflow">if</span> (replacement_size &lt; 0) {</div><div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Failed to expand domain name: %s\n&quot;</span>, strerror(<a class="code" href="../../d1/d6e/main_2stdtime_2private_8h.html#ad65a8842cc674e3ddf69355898c0ecbf">errno</a>));</div><div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;   }</div><div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;</div><div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;   ptr += replacement_size;</div><div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;</div><div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;   <span class="keywordflow">if</span> (ptr != end_of_record) {</div><div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;NAPTR record gave undersized string indications.\n&quot;</span>);</div><div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;   }</div><div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;</div><div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;   <span class="comment">/* We&#39;ve validated the size of the NAPTR record. Now we can validate</span></div><div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;<span class="comment">    * the individual parts</span></div><div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;<span class="comment">    */</span></div><div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;   flags_res = <a class="code" href="../../d3/de7/dns__naptr_8c.html#acda3837e17ffc03a649b907e29a029f4">interpret_flags</a>(flags, flags_size);</div><div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;   <span class="keywordflow">if</span> (flags_res == <a class="code" href="../../d3/de7/dns__naptr_8c.html#aed9b1a7b999cab0deaddd6ca8704685ea008025af8481c9f2de66631289e9b21e">FLAGS_INVALID</a>) {</div><div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;NAPTR Record contained invalid flags %.*s\n&quot;</span>, flags_size, flags);</div><div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;   }</div><div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;</div><div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d3/de7/dns__naptr_8c.html#aaa760a6fd5c0c1cb2e77cdf5aa92f7fa">services_invalid</a>(services, services_size)) {</div><div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;NAPTR record contained invalid services %.*s\n&quot;</span>, services_size, services);</div><div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;   }</div><div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;</div><div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d3/de7/dns__naptr_8c.html#ab6a35fd0de8c566f1fce2c32f08fc97a">regexp_invalid</a>(regexp, regexp_size)) {</div><div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;NAPTR record contained invalid regexp %.*s\n&quot;</span>, regexp_size, regexp);</div><div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;   }</div><div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;</div><div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;   <span class="comment">/* replacement_size takes into account the NULL label, so a NAPTR record with no replacement</span></div><div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;<span class="comment">    * will have a replacement_size of 1.</span></div><div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;<span class="comment">    */</span></div><div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;   <span class="keywordflow">if</span> (regexp_size &amp;&amp; replacement_size &gt; 1) {</div><div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;NAPTR record contained both a regexp and replacement\n&quot;</span>);</div><div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;   }</div><div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;</div><div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;   naptr_len = <span class="keyword">sizeof</span>(*naptr) + size + flags_size + 1 + services_size + 1</div><div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;      + regexp_size + 1 + strlen(replacement) + 1;</div><div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;   naptr = <a class="code" href="../../d8/d8a/astmm_8h.html#ae0cd4c5524b01287ab19cbe233d9cebb">ast_calloc</a>(1, naptr_len);</div><div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;   <span class="keywordflow">if</span> (!naptr) {</div><div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;   }</div><div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;</div><div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;   naptr-&gt;<a class="code" href="../../df/de3/structast__dns__naptr__record.html#a1236fced09ddfa5eb51667d641632420">order</a> = <a class="code" href="../../d2/d79/analys_8c.html#aed7ca058008dc3e5ee131e575abed285">order</a>;</div><div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;   naptr-&gt;<a class="code" href="../../df/de3/structast__dns__naptr__record.html#a4855753a7f624d6708dade9e9c4f0080">preference</a> = <a class="code" href="../../df/de3/structast__dns__naptr__record.html#a4855753a7f624d6708dade9e9c4f0080">preference</a>;</div><div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;</div><div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;   ptr = naptr-&gt;<a class="code" href="../../df/de3/structast__dns__naptr__record.html#a9a3b4be1b9151b0369d7fca9911c7ecd">data</a>;</div><div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;   ptr += size;</div><div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;</div><div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;   strncpy(ptr, flags, flags_size);</div><div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;   ptr[flags_size] = <span class="charliteral">&#39;\0&#39;</span>;</div><div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;   naptr-&gt;<a class="code" href="../../df/de3/structast__dns__naptr__record.html#acce5fc0dd978f67c45fcf195f37e7422">flags</a> = ptr;</div><div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;   ptr += flags_size + 1;</div><div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;</div><div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;   strncpy(ptr, services, services_size);</div><div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;   ptr[services_size] = <span class="charliteral">&#39;\0&#39;</span>;</div><div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;   naptr-&gt;<a class="code" href="../../df/de3/structast__dns__naptr__record.html#af053a80dc771b285c53ac53025303970">service</a> = ptr;</div><div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;   ptr += services_size + 1;</div><div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;</div><div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;   strncpy(ptr, regexp, regexp_size);</div><div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;   ptr[regexp_size] = <span class="charliteral">&#39;\0&#39;</span>;</div><div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;   naptr-&gt;<a class="code" href="../../df/de3/structast__dns__naptr__record.html#a5c796239be94e0b9cfe95e168e34d1da">regexp</a> = ptr;</div><div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;   ptr += regexp_size + 1;</div><div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;</div><div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;   strcpy(ptr, replacement);</div><div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;   naptr-&gt;<a class="code" href="../../df/de3/structast__dns__naptr__record.html#af13ea6e7567ddf33e5f2dc7fcafde92f">replacement</a> = ptr;</div><div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;</div><div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;   naptr-&gt;<a class="code" href="../../df/de3/structast__dns__naptr__record.html#a4648fde6e8cb9408e134bc93ef77e3a1">generic</a>.<a class="code" href="../../d3/db7/structast__dns__record.html#ae7533305b03c676bd7047f6d2c3aa7b2">data_ptr</a> = naptr-&gt;<a class="code" href="../../df/de3/structast__dns__naptr__record.html#a9a3b4be1b9151b0369d7fca9911c7ecd">data</a>;</div><div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;</div><div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;   <span class="keywordflow">return</span> (<span class="keyword">struct</span> <a class="code" href="../../d3/db7/structast__dns__record.html">ast_dns_record</a> *)naptr;</div><div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;}</div><div class="ttc" id="dns__internal_8h_html_aabe2faa5200934ee2828955f611e4d5a"><div class="ttname"><a href="../../d4/d07/dns__internal_8h.html#aabe2faa5200934ee2828955f611e4d5a">dns_parse_string</a></div><div class="ttdeci">int dns_parse_string(char *cur, uint8_t *size, char **val)</div><div class="ttdoc">Parse a DNS string from a DNS record. </div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d00/dns__core_8c_source.html#l00734">dns_core.c:734</a></div></div>
<div class="ttc" id="structast__dns__naptr__record_html_af13ea6e7567ddf33e5f2dc7fcafde92f"><div class="ttname"><a href="../../df/de3/structast__dns__naptr__record.html#af13ea6e7567ddf33e5f2dc7fcafde92f">ast_dns_naptr_record::replacement</a></div><div class="ttdeci">const char * replacement</div><div class="ttdoc">The replacement from the NAPTR record. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d07/dns__internal_8h_source.html#l00102">dns_internal.h:102</a></div></div>
<div class="ttc" id="structast__dns__record_html_ae7533305b03c676bd7047f6d2c3aa7b2"><div class="ttname"><a href="../../d3/db7/structast__dns__record.html#ae7533305b03c676bd7047f6d2c3aa7b2">ast_dns_record::data_ptr</a></div><div class="ttdeci">char * data_ptr</div><div class="ttdoc">pointer to record-specific data. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d07/dns__internal_8h_source.html#l00058">dns_internal.h:58</a></div></div>
<div class="ttc" id="structast__dns__record_html"><div class="ttname"><a href="../../d3/db7/structast__dns__record.html">ast_dns_record</a></div><div class="ttdoc">For AST_LIST. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d07/dns__internal_8h_source.html#l00039">dns_internal.h:39</a></div></div>
<div class="ttc" id="structast__dns__naptr__record_html_acce5fc0dd978f67c45fcf195f37e7422"><div class="ttname"><a href="../../df/de3/structast__dns__naptr__record.html#acce5fc0dd978f67c45fcf195f37e7422">ast_dns_naptr_record::flags</a></div><div class="ttdeci">const char * flags</div><div class="ttdoc">The flags from the NAPTR record. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d07/dns__internal_8h_source.html#l00096">dns_internal.h:96</a></div></div>
<div class="ttc" id="dns__naptr_8c_html_aed9b1a7b999cab0deaddd6ca8704685ea008025af8481c9f2de66631289e9b21e"><div class="ttname"><a href="../../d3/de7/dns__naptr_8c.html#aed9b1a7b999cab0deaddd6ca8704685ea008025af8481c9f2de66631289e9b21e">FLAGS_INVALID</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d3/de7/dns__naptr_8c_source.html#l00054">dns_naptr.c:54</a></div></div>
<div class="ttc" id="dns__internal_8h_html_a9e4884282d130aebaed0e9d0737fa19b"><div class="ttname"><a href="../../d4/d07/dns__internal_8h.html#a9e4884282d130aebaed0e9d0737fa19b">dns_parse_short</a></div><div class="ttdeci">int dns_parse_short(unsigned char *cur, uint16_t *val)</div><div class="ttdoc">Parse a 16-bit unsigned value from a DNS record. </div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d00/dns__core_8c_source.html#l00722">dns_core.c:722</a></div></div>
<div class="ttc" id="utils_8h_html_a24374da24af1931d8a7ccde5b352bb2c"><div class="ttname"><a href="../../d5/d60/utils_8h.html#a24374da24af1931d8a7ccde5b352bb2c">ast_assert</a></div><div class="ttdeci">#define ast_assert(a)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d60/utils_8h_source.html#l00695">utils.h:695</a></div></div>
<div class="ttc" id="resample_8c_html_a070d2ce7b6bb7e5c05602aa8c308d0c4"><div class="ttname"><a href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a></div><div class="ttdeci">#define NULL</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d7f/resample_8c_source.html#l00096">resample.c:96</a></div></div>
<div class="ttc" id="structast__dns__naptr__record_html_a5c796239be94e0b9cfe95e168e34d1da"><div class="ttname"><a href="../../df/de3/structast__dns__naptr__record.html#a5c796239be94e0b9cfe95e168e34d1da">ast_dns_naptr_record::regexp</a></div><div class="ttdeci">const char * regexp</div><div class="ttdoc">The regular expression from the NAPTR record. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d07/dns__internal_8h_source.html#l00100">dns_internal.h:100</a></div></div>
<div class="ttc" id="dns__naptr_8c_html_aaa760a6fd5c0c1cb2e77cdf5aa92f7fa"><div class="ttname"><a href="../../d3/de7/dns__naptr_8c.html#aaa760a6fd5c0c1cb2e77cdf5aa92f7fa">services_invalid</a></div><div class="ttdeci">static int services_invalid(const char *services, uint8_t services_size)</div><div class="ttdoc">Analyze NAPTR services for validity as defined by RFC 3404. </div><div class="ttdef"><b>Definition:</b> <a href="../../d3/de7/dns__naptr_8c_source.html#l00130">dns_naptr.c:130</a></div></div>
<div class="ttc" id="astobj2_8c_html_a96a00b3a518d7f32b6d51dc28f09bf9b"><div class="ttname"><a href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a></div><div class="ttdeci">#define ast_log</div><div class="ttdef"><b>Definition:</b> <a href="../../da/df7/astobj2_8c_source.html#l00042">astobj2.c:42</a></div></div>
<div class="ttc" id="analys_8c_html_aed7ca058008dc3e5ee131e575abed285"><div class="ttname"><a href="../../d2/d79/analys_8c.html#aed7ca058008dc3e5ee131e575abed285">order</a></div><div class="ttdeci">integer order</div><div class="ttdef"><b>Definition:</b> <a href="../../d2/d79/analys_8c_source.html#l00066">analys.c:66</a></div></div>
<div class="ttc" id="structast__dns__naptr__record_html_af053a80dc771b285c53ac53025303970"><div class="ttname"><a href="../../df/de3/structast__dns__naptr__record.html#af053a80dc771b285c53ac53025303970">ast_dns_naptr_record::service</a></div><div class="ttdeci">const char * service</div><div class="ttdoc">The service from the NAPTR record. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d07/dns__internal_8h_source.html#l00098">dns_internal.h:98</a></div></div>
<div class="ttc" id="dns__naptr_8c_html_a3f25bf14345796cc59bc63bbdfe09642"><div class="ttname"><a href="../../d3/de7/dns__naptr_8c.html#a3f25bf14345796cc59bc63bbdfe09642">PAST_END_OF_RECORD</a></div><div class="ttdeci">#define PAST_END_OF_RECORD</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/de7/dns__naptr_8c_source.html#l00378">dns_naptr.c:378</a></div></div>
<div class="ttc" id="dns__naptr_8c_html_acda3837e17ffc03a649b907e29a029f4"><div class="ttname"><a href="../../d3/de7/dns__naptr_8c.html#acda3837e17ffc03a649b907e29a029f4">interpret_flags</a></div><div class="ttdeci">static enum flags_result interpret_flags(const char *flags, uint8_t flags_size)</div><div class="ttdoc">Analyze and interpret NAPTR flags as per RFC 3404. </div><div class="ttdef"><b>Definition:</b> <a href="../../d3/de7/dns__naptr_8c_source.html#l00066">dns_naptr.c:66</a></div></div>
<div class="ttc" id="logger_8h_html_aced66975c154ea0e2a8ec3bc818b4e08"><div class="ttname"><a href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a></div><div class="ttdeci">#define LOG_ERROR</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d8c/logger_8h_source.html#l00285">logger.h:285</a></div></div>
<div class="ttc" id="structast__dns__naptr__record_html_a9a3b4be1b9151b0369d7fca9911c7ecd"><div class="ttname"><a href="../../df/de3/structast__dns__naptr__record.html#a9a3b4be1b9151b0369d7fca9911c7ecd">ast_dns_naptr_record::data</a></div><div class="ttdeci">char data[0]</div><div class="ttdoc">Buffer for NAPTR-specific data. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d07/dns__internal_8h_source.html#l00113">dns_internal.h:113</a></div></div>
<div class="ttc" id="structast__dns__query_html_a739d372feb17d2aa4aefab56762623e4"><div class="ttname"><a href="../../dd/daa/structast__dns__query.html#a739d372feb17d2aa4aefab56762623e4">ast_dns_query::result</a></div><div class="ttdeci">struct ast_dns_result * result</div><div class="ttdoc">Result of the DNS query. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d07/dns__internal_8h_source.html#l00147">dns_internal.h:147</a></div></div>
<div class="ttc" id="main_2stdtime_2private_8h_html_ad65a8842cc674e3ddf69355898c0ecbf"><div class="ttname"><a href="../../d1/d6e/main_2stdtime_2private_8h.html#ad65a8842cc674e3ddf69355898c0ecbf">errno</a></div><div class="ttdeci">int errno</div></div>
<div class="ttc" id="astmm_8h_html_ae0cd4c5524b01287ab19cbe233d9cebb"><div class="ttname"><a href="../../d8/d8a/astmm_8h.html#ae0cd4c5524b01287ab19cbe233d9cebb">ast_calloc</a></div><div class="ttdeci">#define ast_calloc(num, len)</div><div class="ttdoc">A wrapper for calloc() </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d8a/astmm_8h_source.html#l00204">astmm.h:204</a></div></div>
<div class="ttc" id="structast__dns__naptr__record_html_a4855753a7f624d6708dade9e9c4f0080"><div class="ttname"><a href="../../df/de3/structast__dns__naptr__record.html#a4855753a7f624d6708dade9e9c4f0080">ast_dns_naptr_record::preference</a></div><div class="ttdeci">unsigned short preference</div><div class="ttdoc">The preference of the NAPTR record. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d07/dns__internal_8h_source.html#l00106">dns_internal.h:106</a></div></div>
<div class="ttc" id="structnaptr_html"><div class="ttname"><a href="../../dd/d3d/structnaptr.html">naptr</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d9b/enum_8h_source.html#l00028">enum.h:28</a></div></div>
<div class="ttc" id="dns__naptr_8c_html_aed9b1a7b999cab0deaddd6ca8704685e"><div class="ttname"><a href="../../d3/de7/dns__naptr_8c.html#aed9b1a7b999cab0deaddd6ca8704685e">flags_result</a></div><div class="ttdeci">flags_result</div><div class="ttdoc">Result of analyzing NAPTR flags on a record. </div><div class="ttdef"><b>Definition:</b> <a href="../../d3/de7/dns__naptr_8c_source.html#l00046">dns_naptr.c:46</a></div></div>
<div class="ttc" id="dns__naptr_8c_html_ab6a35fd0de8c566f1fce2c32f08fc97a"><div class="ttname"><a href="../../d3/de7/dns__naptr_8c.html#ab6a35fd0de8c566f1fce2c32f08fc97a">regexp_invalid</a></div><div class="ttdeci">static int regexp_invalid(const char *regexp, uint8_t regexp_size)</div><div class="ttdoc">Determine if the regexp in a NAPTR record is invalid. </div><div class="ttdef"><b>Definition:</b> <a href="../../d3/de7/dns__naptr_8c_source.html#l00309">dns_naptr.c:309</a></div></div>
<div class="ttc" id="structast__dns__naptr__record_html_a4648fde6e8cb9408e134bc93ef77e3a1"><div class="ttname"><a href="../../df/de3/structast__dns__naptr__record.html#a4648fde6e8cb9408e134bc93ef77e3a1">ast_dns_naptr_record::generic</a></div><div class="ttdeci">struct ast_dns_record generic</div><div class="ttdoc">Generic DNS record information. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d07/dns__internal_8h_source.html#l00094">dns_internal.h:94</a></div></div>
<div class="ttc" id="structast__dns__naptr__record_html"><div class="ttname"><a href="../../df/de3/structast__dns__naptr__record.html">ast_dns_naptr_record</a></div><div class="ttdoc">A NAPTR record. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d07/dns__internal_8h_source.html#l00092">dns_internal.h:92</a></div></div>
<div class="ttc" id="dns__internal_8h_html_ae0b5c136c1af09327876900be0630411"><div class="ttname"><a href="../../d4/d07/dns__internal_8h.html#ae0b5c136c1af09327876900be0630411">dns_find_record</a></div><div class="ttdeci">char * dns_find_record(const char *record, size_t record_size, const char *response, size_t response_size)</div><div class="ttdoc">Find the location of a DNS record within the entire DNS answer. </div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d00/dns__core_8c_source.html#l00701">dns_core.c:701</a></div></div>
<div class="ttc" id="structast__dns__result_html_a60e7f19e0a67dbea7e21c74f1a225fef"><div class="ttname"><a href="../../d5/d8d/structast__dns__result.html#a60e7f19e0a67dbea7e21c74f1a225fef">ast_dns_result::answer_size</a></div><div class="ttdeci">size_t answer_size</div><div class="ttdoc">The size of the raw DNS answer. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d07/dns__internal_8h_source.html#l00131">dns_internal.h:131</a></div></div>
<div class="ttc" id="structast__dns__result_html_acf478081be3b257185e81c8a92235209"><div class="ttname"><a href="../../d5/d8d/structast__dns__result.html#acf478081be3b257185e81c8a92235209">ast_dns_result::answer</a></div><div class="ttdeci">const char * answer</div><div class="ttdoc">The raw DNS answer. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d07/dns__internal_8h_source.html#l00129">dns_internal.h:129</a></div></div>
<div class="ttc" id="structast__dns__naptr__record_html_a1236fced09ddfa5eb51667d641632420"><div class="ttname"><a href="../../df/de3/structast__dns__naptr__record.html#a1236fced09ddfa5eb51667d641632420">ast_dns_naptr_record::order</a></div><div class="ttdeci">unsigned short order</div><div class="ttdoc">The order for the NAPTR record. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d07/dns__internal_8h_source.html#l00104">dns_internal.h:104</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a089c9ec9c3011b12cefaddd04afd2ec5"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a089c9ec9c3011b12cefaddd04afd2ec5">&#9670;&nbsp;</a></span>dns_naptr_sort()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void dns_naptr_sort </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="../../d5/d8d/structast__dns__result.html">ast_dns_result</a> *&#160;</td>
          <td class="paramname"><em>result</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Sort the NAPTR records on a result. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">result</td><td>The DNS result </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="../../d3/de7/dns__naptr_8c_source.html#l00551">551</a> of file <a class="el" href="../../d3/de7/dns__naptr_8c_source.html">dns_naptr.c</a>.</p>

<p class="reference">References <a class="el" href="../../d8/d8a/astmm_8h_source.html#l00290">ast_alloca</a>, <a class="el" href="../../df/d90/linkedlists_8h_source.html#l00730">AST_LIST_INSERT_TAIL</a>, <a class="el" href="../../df/d90/linkedlists_8h_source.html#l00556">AST_LIST_REMOVE_CURRENT</a>, <a class="el" href="../../df/d90/linkedlists_8h_source.html#l00490">AST_LIST_TRAVERSE</a>, <a class="el" href="../../df/d90/linkedlists_8h_source.html#l00528">AST_LIST_TRAVERSE_SAFE_BEGIN</a>, <a class="el" href="../../df/d90/linkedlists_8h_source.html#l00614">AST_LIST_TRAVERSE_SAFE_END</a>, <a class="el" href="../../d3/de7/dns__naptr_8c_source.html#l00523">compare_order()</a>, <a class="el" href="../../d3/de7/dns__naptr_8c_source.html#l00537">compare_preference()</a>, <a class="el" href="../../d2/d79/analys_8c_source.html#l00066">order</a>, <a class="el" href="../../d4/d07/dns__internal_8h_source.html#l00104">ast_dns_naptr_record::order</a>, <a class="el" href="../../d0/d29/cdr__mysql_8c_source.html#l00084">records</a>, and <a class="el" href="../../d5/d8d/structast__dns__result.html#a85249bc4c3b2ab860d0dd551444a3ed4">ast_dns_result::records</a>.</p>
<div class="fragment"><div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;{</div><div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d3/db7/structast__dns__record.html">ast_dns_record</a> *current;</div><div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;   <span class="keywordtype">size_t</span> num_records = 0;</div><div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../df/de3/structast__dns__naptr__record.html">ast_dns_naptr_record</a> **<a class="code" href="../../d0/d29/cdr__mysql_8c.html#ab18693215565ea1a797096dfe19e895f">records</a>;</div><div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;   <span class="keywordtype">int</span> i = 0;</div><div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;   <span class="keywordtype">int</span> j = 0;</div><div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;   <span class="keywordtype">int</span> cur_order;</div><div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;</div><div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;   <span class="comment">/* Determine the number of records */</span></div><div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;   <a class="code" href="../../df/d90/linkedlists_8h.html#a3008b2f4f236b72d8bcfb80e346324ef">AST_LIST_TRAVERSE</a>(&amp;result-&gt;<a class="code" href="../../d5/d8d/structast__dns__result.html#a85249bc4c3b2ab860d0dd551444a3ed4">records</a>, current, list) {</div><div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;      ++num_records;</div><div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;   }</div><div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;</div><div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;   <span class="comment">/* No point in continuing if there are no records */</span></div><div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;   <span class="keywordflow">if</span> (num_records == 0) {</div><div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;      <span class="keywordflow">return</span>;</div><div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;   }</div><div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;</div><div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;   <span class="comment">/* Allocate an array with that number of records */</span></div><div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;   records = <a class="code" href="../../d8/d8a/astmm_8h.html#a249282ecc7ba5a1a49fa75e9a33d1717">ast_alloca</a>(num_records * <span class="keyword">sizeof</span>(*records));</div><div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;</div><div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;   <span class="comment">/* Move records from the list to the array */</span></div><div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;   <a class="code" href="../../df/d90/linkedlists_8h.html#aa5be52067bf16bdc7e56ca19b5ba858d">AST_LIST_TRAVERSE_SAFE_BEGIN</a>(&amp;result-&gt;<a class="code" href="../../d5/d8d/structast__dns__result.html#a85249bc4c3b2ab860d0dd551444a3ed4">records</a>, current, list) {</div><div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;      records[i++] = (<span class="keyword">struct </span><a class="code" href="../../df/de3/structast__dns__naptr__record.html">ast_dns_naptr_record</a> *) current;</div><div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;      <a class="code" href="../../df/d90/linkedlists_8h.html#aa8ac496fa9c717d5afb99a02e1e2760c">AST_LIST_REMOVE_CURRENT</a>(list);</div><div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;   }</div><div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;   <a class="code" href="../../df/d90/linkedlists_8h.html#a712c04b4493919a7052399cd30ee8fb9">AST_LIST_TRAVERSE_SAFE_END</a>;</div><div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;</div><div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;   <span class="comment">/* Sort the array by order */</span></div><div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;   qsort(records, num_records, <span class="keyword">sizeof</span>(*records), <a class="code" href="../../d3/de7/dns__naptr_8c.html#aed31ff93373c046a4731ca6c7cd585e7">compare_order</a>);</div><div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;</div><div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;   <span class="comment">/* Sort subarrays by preference */</span></div><div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;   <span class="keywordflow">for</span> (i = 0; i &lt; num_records; i = j) {</div><div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;      cur_order = records[i]-&gt;<a class="code" href="../../df/de3/structast__dns__naptr__record.html#a1236fced09ddfa5eb51667d641632420">order</a>;</div><div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;      <span class="keywordflow">for</span> (j = i + 1; j &lt; num_records; ++j) {</div><div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;         <span class="keywordflow">if</span> (records[j]-&gt;<a class="code" href="../../d2/d79/analys_8c.html#aed7ca058008dc3e5ee131e575abed285">order</a> != cur_order) {</div><div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;         }</div><div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;      }</div><div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;      qsort(&amp;records[i], j - i, <span class="keyword">sizeof</span>(*records), <a class="code" href="../../d3/de7/dns__naptr_8c.html#aeee7bfa19514c205321ad9c0c7908086">compare_preference</a>);</div><div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;   }</div><div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;</div><div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;   <span class="comment">/* Place sorted records back into the original list */</span></div><div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;   <span class="keywordflow">for</span> (i = 0; i &lt; num_records; ++i) {</div><div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;      <a class="code" href="../../df/d90/linkedlists_8h.html#a4d258b4525e63c435d7de579d3f46960">AST_LIST_INSERT_TAIL</a>(&amp;result-&gt;<a class="code" href="../../d5/d8d/structast__dns__result.html#a85249bc4c3b2ab860d0dd551444a3ed4">records</a>, (<span class="keyword">struct</span> <a class="code" href="../../d3/db7/structast__dns__record.html">ast_dns_record</a> *)(records[i]), list);</div><div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;   }</div><div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;}</div><div class="ttc" id="cdr__mysql_8c_html_ab18693215565ea1a797096dfe19e895f"><div class="ttname"><a href="../../d0/d29/cdr__mysql_8c.html#ab18693215565ea1a797096dfe19e895f">records</a></div><div class="ttdeci">static int records</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d29/cdr__mysql_8c_source.html#l00084">cdr_mysql.c:84</a></div></div>
<div class="ttc" id="dns__naptr_8c_html_aed31ff93373c046a4731ca6c7cd585e7"><div class="ttname"><a href="../../d3/de7/dns__naptr_8c.html#aed31ff93373c046a4731ca6c7cd585e7">compare_order</a></div><div class="ttdeci">static int compare_order(const void *record1, const void *record2)</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/de7/dns__naptr_8c_source.html#l00523">dns_naptr.c:523</a></div></div>
<div class="ttc" id="structast__dns__record_html"><div class="ttname"><a href="../../d3/db7/structast__dns__record.html">ast_dns_record</a></div><div class="ttdoc">For AST_LIST. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d07/dns__internal_8h_source.html#l00039">dns_internal.h:39</a></div></div>
<div class="ttc" id="linkedlists_8h_html_a712c04b4493919a7052399cd30ee8fb9"><div class="ttname"><a href="../../df/d90/linkedlists_8h.html#a712c04b4493919a7052399cd30ee8fb9">AST_LIST_TRAVERSE_SAFE_END</a></div><div class="ttdeci">#define AST_LIST_TRAVERSE_SAFE_END</div><div class="ttdoc">Closes a safe loop traversal block. </div><div class="ttdef"><b>Definition:</b> <a href="../../df/d90/linkedlists_8h_source.html#l00614">linkedlists.h:614</a></div></div>
<div class="ttc" id="dns__naptr_8c_html_aeee7bfa19514c205321ad9c0c7908086"><div class="ttname"><a href="../../d3/de7/dns__naptr_8c.html#aeee7bfa19514c205321ad9c0c7908086">compare_preference</a></div><div class="ttdeci">static int compare_preference(const void *record1, const void *record2)</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/de7/dns__naptr_8c_source.html#l00537">dns_naptr.c:537</a></div></div>
<div class="ttc" id="analys_8c_html_aed7ca058008dc3e5ee131e575abed285"><div class="ttname"><a href="../../d2/d79/analys_8c.html#aed7ca058008dc3e5ee131e575abed285">order</a></div><div class="ttdeci">integer order</div><div class="ttdef"><b>Definition:</b> <a href="../../d2/d79/analys_8c_source.html#l00066">analys.c:66</a></div></div>
<div class="ttc" id="linkedlists_8h_html_aa8ac496fa9c717d5afb99a02e1e2760c"><div class="ttname"><a href="../../df/d90/linkedlists_8h.html#aa8ac496fa9c717d5afb99a02e1e2760c">AST_LIST_REMOVE_CURRENT</a></div><div class="ttdeci">#define AST_LIST_REMOVE_CURRENT(field)</div><div class="ttdoc">Removes the current entry from a list during a traversal. </div><div class="ttdef"><b>Definition:</b> <a href="../../df/d90/linkedlists_8h_source.html#l00556">linkedlists.h:556</a></div></div>
<div class="ttc" id="astmm_8h_html_a249282ecc7ba5a1a49fa75e9a33d1717"><div class="ttname"><a href="../../d8/d8a/astmm_8h.html#a249282ecc7ba5a1a49fa75e9a33d1717">ast_alloca</a></div><div class="ttdeci">#define ast_alloca(size)</div><div class="ttdoc">call __builtin_alloca to ensure we get gcc builtin semantics </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d8a/astmm_8h_source.html#l00290">astmm.h:290</a></div></div>
<div class="ttc" id="linkedlists_8h_html_a4d258b4525e63c435d7de579d3f46960"><div class="ttname"><a href="../../df/d90/linkedlists_8h.html#a4d258b4525e63c435d7de579d3f46960">AST_LIST_INSERT_TAIL</a></div><div class="ttdeci">#define AST_LIST_INSERT_TAIL(head, elm, field)</div><div class="ttdoc">Appends a list entry to the tail of a list. </div><div class="ttdef"><b>Definition:</b> <a href="../../df/d90/linkedlists_8h_source.html#l00730">linkedlists.h:730</a></div></div>
<div class="ttc" id="linkedlists_8h_html_a3008b2f4f236b72d8bcfb80e346324ef"><div class="ttname"><a href="../../df/d90/linkedlists_8h.html#a3008b2f4f236b72d8bcfb80e346324ef">AST_LIST_TRAVERSE</a></div><div class="ttdeci">#define AST_LIST_TRAVERSE(head, var, field)</div><div class="ttdoc">Loops over (traverses) the entries in a list. </div><div class="ttdef"><b>Definition:</b> <a href="../../df/d90/linkedlists_8h_source.html#l00490">linkedlists.h:490</a></div></div>
<div class="ttc" id="structast__dns__naptr__record_html"><div class="ttname"><a href="../../df/de3/structast__dns__naptr__record.html">ast_dns_naptr_record</a></div><div class="ttdoc">A NAPTR record. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d07/dns__internal_8h_source.html#l00092">dns_internal.h:92</a></div></div>
<div class="ttc" id="linkedlists_8h_html_aa5be52067bf16bdc7e56ca19b5ba858d"><div class="ttname"><a href="../../df/d90/linkedlists_8h.html#aa5be52067bf16bdc7e56ca19b5ba858d">AST_LIST_TRAVERSE_SAFE_BEGIN</a></div><div class="ttdeci">#define AST_LIST_TRAVERSE_SAFE_BEGIN(head, var, field)</div><div class="ttdoc">Loops safely over (traverses) the entries in a list. </div><div class="ttdef"><b>Definition:</b> <a href="../../df/d90/linkedlists_8h_source.html#l00528">linkedlists.h:528</a></div></div>
<div class="ttc" id="structast__dns__result_html_a85249bc4c3b2ab860d0dd551444a3ed4"><div class="ttname"><a href="../../d5/d8d/structast__dns__result.html#a85249bc4c3b2ab860d0dd551444a3ed4">ast_dns_result::records</a></div><div class="ttdeci">struct ast_dns_result::dns_records records</div></div>
<div class="ttc" id="structast__dns__naptr__record_html_a1236fced09ddfa5eb51667d641632420"><div class="ttname"><a href="../../df/de3/structast__dns__naptr__record.html#a1236fced09ddfa5eb51667d641632420">ast_dns_naptr_record::order</a></div><div class="ttdeci">unsigned short order</div><div class="ttdoc">The order for the NAPTR record. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d07/dns__internal_8h_source.html#l00104">dns_internal.h:104</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a9e4884282d130aebaed0e9d0737fa19b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a9e4884282d130aebaed0e9d0737fa19b">&#9670;&nbsp;</a></span>dns_parse_short()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int dns_parse_short </td>
          <td>(</td>
          <td class="paramtype">unsigned char *&#160;</td>
          <td class="paramname"><em>cur</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint16_t *&#160;</td>
          <td class="paramname"><em>val</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Parse a 16-bit unsigned value from a DNS record. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir"></td><td class="paramname">cur</td><td>Pointer to the location of the 16-bit value in the DNS record </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">val</td><td>The parsed 16-bit unsigned integer </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>The number of bytes consumed while parsing </dd></dl>

<p class="definition">Definition at line <a class="el" href="../../dc/d00/dns__core_8c_source.html#l00722">722</a> of file <a class="el" href="../../dc/d00/dns__core_8c_source.html">dns_core.c</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../d3/de7/dns__naptr_8c_source.html#l00380">dns_naptr_alloc()</a>, and <a class="el" href="../../db/d8e/dns__srv_8c_source.html#l00042">dns_srv_alloc()</a>.</p>
<div class="fragment"><div class="line"><a name="l00723"></a><span class="lineno">  723</span>&#160;{</div><div class="line"><a name="l00724"></a><span class="lineno">  724</span>&#160;   <span class="comment">/* This assignment takes a big-endian 16-bit value and stores it in the</span></div><div class="line"><a name="l00725"></a><span class="lineno">  725</span>&#160;<span class="comment">    * machine&#39;s native byte order. Using this method allows us to avoid potential</span></div><div class="line"><a name="l00726"></a><span class="lineno">  726</span>&#160;<span class="comment">    * alignment issues in case the order is not on a short-addressable boundary.</span></div><div class="line"><a name="l00727"></a><span class="lineno">  727</span>&#160;<span class="comment">    * See http://commandcenter.blogspot.com/2012/04/byte-order-fallacy.html for</span></div><div class="line"><a name="l00728"></a><span class="lineno">  728</span>&#160;<span class="comment">    * more information</span></div><div class="line"><a name="l00729"></a><span class="lineno">  729</span>&#160;<span class="comment">    */</span></div><div class="line"><a name="l00730"></a><span class="lineno">  730</span>&#160;   *<a class="code" href="../../d5/d85/structval.html">val</a> = (cur[1] &lt;&lt; 0) | (cur[0] &lt;&lt; 8);</div><div class="line"><a name="l00731"></a><span class="lineno">  731</span>&#160;   <span class="keywordflow">return</span> <span class="keyword">sizeof</span>(*val);</div><div class="line"><a name="l00732"></a><span class="lineno">  732</span>&#160;}</div><div class="ttc" id="structval_html"><div class="ttname"><a href="../../d5/d85/structval.html">val</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d3/dd1/ast__expr2_8c_source.html#l00325">ast_expr2.c:325</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="aabe2faa5200934ee2828955f611e4d5a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aabe2faa5200934ee2828955f611e4d5a">&#9670;&nbsp;</a></span>dns_parse_string()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int dns_parse_string </td>
          <td>(</td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>cur</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t *&#160;</td>
          <td class="paramname"><em>size</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char **&#160;</td>
          <td class="paramname"><em>val</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Parse a DNS string from a DNS record. </p>
<p>A DNS string consists of an 8-bit size, followed by the string value (not NULL-terminated).</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir"></td><td class="paramname">cur</td><td>Pointer to the location of the DNS string </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">size</td><td>The parsed size of the DNS string </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">val</td><td>The contained string (not NULL-terminated) </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>The number of bytes consumed while parsing </dd></dl>

<p class="definition">Definition at line <a class="el" href="../../dc/d00/dns__core_8c_source.html#l00734">734</a> of file <a class="el" href="../../dc/d00/dns__core_8c_source.html">dns_core.c</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../d3/de7/dns__naptr_8c_source.html#l00380">dns_naptr_alloc()</a>.</p>
<div class="fragment"><div class="line"><a name="l00735"></a><span class="lineno">  735</span>&#160;{</div><div class="line"><a name="l00736"></a><span class="lineno">  736</span>&#160;   *size = *cur++;</div><div class="line"><a name="l00737"></a><span class="lineno">  737</span>&#160;   *<a class="code" href="../../d5/d85/structval.html">val</a> = cur;</div><div class="line"><a name="l00738"></a><span class="lineno">  738</span>&#160;   <span class="keywordflow">return</span> *size + 1;</div><div class="line"><a name="l00739"></a><span class="lineno">  739</span>&#160;}</div><div class="ttc" id="structval_html"><div class="ttname"><a href="../../d5/d85/structval.html">val</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d3/dd1/ast__expr2_8c_source.html#l00325">ast_expr2.c:325</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a86b5cf0f0336d590f503c0135e787a9b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a86b5cf0f0336d590f503c0135e787a9b">&#9670;&nbsp;</a></span>dns_query_alloc()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="../../dd/daa/structast__dns__query.html">ast_dns_query</a>* dns_query_alloc </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>name</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>rr_type</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>rr_class</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../d6/d51/dns__core_8h.html#a64f08db76c6a6c41dbf6603bbc333b93">ast_dns_resolve_callback</a>&#160;</td>
          <td class="paramname"><em>callback</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>data</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Allocate a DNS query (but do not start resolution) </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">name</td><td>The name of what to resolve </td></tr>
    <tr><td class="paramname">rr_type</td><td>Resource record type </td></tr>
    <tr><td class="paramname">rr_class</td><td>Resource record class </td></tr>
    <tr><td class="paramname">callback</td><td>The callback to invoke upon completion </td></tr>
    <tr><td class="paramname">data</td><td>User data to make available on the query</td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">non-NULL</td><td>success </td></tr>
    <tr><td class="paramname">NULL</td><td>failure</td></tr>
  </table>
  </dd>
</dl>
<dl class="section note"><dt>Note</dt><dd>The result passed to the callback does not need to be freed</dd>
<dd>
The user data MUST be an ao2 object</dd>
<dd>
This function increments the reference count of the user data, it does NOT steal</dd>
<dd>
The query must be released upon completion or cancellation using ao2_ref </dd></dl>

<p class="definition">Definition at line <a class="el" href="../../dc/d00/dns__core_8c_source.html#l00193">193</a> of file <a class="el" href="../../dc/d00/dns__core_8c_source.html">dns_core.c</a>.</p>

<p class="reference">References <a class="el" href="../../d5/da5/astobj2_8h_source.html#l00369">AO2_ALLOC_OPT_LOCK_NOLOCK</a>, <a class="el" href="../../d5/da5/astobj2_8h_source.html#l00406">ao2_alloc_options</a>, <a class="el" href="../../d5/da5/astobj2_8h_source.html#l00491">ao2_bump</a>, <a class="el" href="../../d5/da5/astobj2_8h_source.html#l00464">ao2_ref</a>, <a class="el" href="../../da/df7/astobj2_8c_source.html#l00042">ast_log</a>, <a class="el" href="../../df/d90/linkedlists_8h_source.html#l00422">AST_RWLIST_FIRST</a>, <a class="el" href="../../df/d90/linkedlists_8h_source.html#l00077">AST_RWLIST_RDLOCK</a>, <a class="el" href="../../df/d90/linkedlists_8h_source.html#l00150">AST_RWLIST_UNLOCK</a>, <a class="el" href="../../d6/d90/strings_8h_source.html#l00052">ast_strlen_zero</a>, <a class="el" href="../../d4/d07/dns__internal_8h_source.html#l00139">ast_dns_query::callback</a>, <a class="el" href="../../dc/d00/dns__core_8c_source.html#l00184">dns_query_destroy()</a>, <a class="el" href="../../d1/d8c/logger_8h_source.html#l00285">LOG_ERROR</a>, <a class="el" href="../../d1/d8c/logger_8h_source.html#l00274">LOG_WARNING</a>, <a class="el" href="../../d4/d07/dns__internal_8h_source.html#l00153">ast_dns_query::name</a>, <a class="el" href="../../dc/d7f/resample_8c_source.html#l00096">NULL</a>, <a class="el" href="../../d4/d07/dns__internal_8h_source.html#l00143">ast_dns_query::resolver</a>, <a class="el" href="../../d4/d07/dns__internal_8h_source.html#l00151">ast_dns_query::rr_class</a>, <a class="el" href="../../d4/d07/dns__internal_8h_source.html#l00149">ast_dns_query::rr_type</a>, and <a class="el" href="../../d4/d07/dns__internal_8h_source.html#l00141">ast_dns_query::user_data</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../d5/da5/dns__query__set_8c_source.html#l00105">ast_dns_query_set_add()</a>, <a class="el" href="../../dc/d00/dns__core_8c_source.html#l00247">ast_dns_resolve_async()</a>, and <a class="el" href="../../d8/dad/dns__recurring_8c_source.html#l00071">dns_query_recurring_resolution_callback()</a>.</p>
<div class="fragment"><div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;{</div><div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../dd/daa/structast__dns__query.html">ast_dns_query</a> *query;</div><div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;</div><div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a>(<a class="code" href="../../d0/d29/cdr__mysql_8c.html#a0980a105ccb863d8008eb6201a51da52">name</a>)) {</div><div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Could not perform asynchronous resolution, no name provided\n&quot;</span>);</div><div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;   } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="../../dd/daa/structast__dns__query.html#ac0d0e7420a9c7f7247c0f3068225df09">rr_type</a> &gt; 65536) {</div><div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Could not perform asynchronous resolution of &#39;%s&#39;, resource record type &#39;%d&#39; exceeds maximum\n&quot;</span>,</div><div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;         <a class="code" href="../../d0/d29/cdr__mysql_8c.html#a0980a105ccb863d8008eb6201a51da52">name</a>, <a class="code" href="../../dd/daa/structast__dns__query.html#ac0d0e7420a9c7f7247c0f3068225df09">rr_type</a>);</div><div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;   } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="../../dd/daa/structast__dns__query.html#ac0d0e7420a9c7f7247c0f3068225df09">rr_type</a> &lt; 0) {</div><div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Could not perform asynchronous resolution of &#39;%s&#39;, invalid resource record type &#39;%d&#39;\n&quot;</span>,</div><div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;         <a class="code" href="../../d0/d29/cdr__mysql_8c.html#a0980a105ccb863d8008eb6201a51da52">name</a>, <a class="code" href="../../dd/daa/structast__dns__query.html#ac0d0e7420a9c7f7247c0f3068225df09">rr_type</a>);</div><div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;   } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="../../dd/daa/structast__dns__query.html#abfde4c5353bcaf8fb444b116ef5cc8df">rr_class</a> &gt; 65536) {</div><div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Could not perform asynchronous resolution of &#39;%s&#39;, resource record class &#39;%d&#39; exceeds maximum\n&quot;</span>,</div><div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;         <a class="code" href="../../d0/d29/cdr__mysql_8c.html#a0980a105ccb863d8008eb6201a51da52">name</a>, <a class="code" href="../../dd/daa/structast__dns__query.html#abfde4c5353bcaf8fb444b116ef5cc8df">rr_class</a>);</div><div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;   } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="../../dd/daa/structast__dns__query.html#abfde4c5353bcaf8fb444b116ef5cc8df">rr_class</a> &lt; 0) {</div><div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Could not perform asynchronous resolution of &#39;%s&#39;, invalid resource class &#39;%d&#39;\n&quot;</span>,</div><div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;         <a class="code" href="../../d0/d29/cdr__mysql_8c.html#a0980a105ccb863d8008eb6201a51da52">name</a>, <a class="code" href="../../dd/daa/structast__dns__query.html#abfde4c5353bcaf8fb444b116ef5cc8df">rr_class</a>);</div><div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;   } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!<a class="code" href="../../dd/daa/structast__dns__query.html#a4bd02e416911ded4d9bd5c018f45dcce">callback</a>) {</div><div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Could not perform asynchronous resolution of &#39;%s&#39;, no callback provided\n&quot;</span>,</div><div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;         <a class="code" href="../../d0/d29/cdr__mysql_8c.html#a0980a105ccb863d8008eb6201a51da52">name</a>);</div><div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;   }</div><div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;</div><div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;   query = <a class="code" href="../../d5/da5/astobj2_8h.html#ab3c44e28d661616129b7819069effe61">ao2_alloc_options</a>(<span class="keyword">sizeof</span>(*query) + strlen(<a class="code" href="../../d0/d29/cdr__mysql_8c.html#a0980a105ccb863d8008eb6201a51da52">name</a>) + 1, <a class="code" href="../../dc/d00/dns__core_8c.html#af158480d2c29c44bec9a2860af39d444">dns_query_destroy</a>, <a class="code" href="../../d5/da5/astobj2_8h.html#a2cf7e3433f08351aafe3b0cd31edf7f8a23b60f2636bcfbc4dfeea6cc21bf847b">AO2_ALLOC_OPT_LOCK_NOLOCK</a>);</div><div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;   <span class="keywordflow">if</span> (!query) {</div><div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;   }</div><div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;</div><div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;   query-&gt;<a class="code" href="../../dd/daa/structast__dns__query.html#a4bd02e416911ded4d9bd5c018f45dcce">callback</a> = <a class="code" href="../../dd/daa/structast__dns__query.html#a4bd02e416911ded4d9bd5c018f45dcce">callback</a>;</div><div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;   query-&gt;<a class="code" href="../../dd/daa/structast__dns__query.html#a0f53d287ac7c064d1a49d4bd93ca1cb9">user_data</a> = <a class="code" href="../../d5/da5/astobj2_8h.html#ac438c3fcd3150481fad38689fd813a15">ao2_bump</a>(data);</div><div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;   query-&gt;<a class="code" href="../../dd/daa/structast__dns__query.html#ac0d0e7420a9c7f7247c0f3068225df09">rr_type</a> = <a class="code" href="../../dd/daa/structast__dns__query.html#ac0d0e7420a9c7f7247c0f3068225df09">rr_type</a>;</div><div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;   query-&gt;<a class="code" href="../../dd/daa/structast__dns__query.html#abfde4c5353bcaf8fb444b116ef5cc8df">rr_class</a> = <a class="code" href="../../dd/daa/structast__dns__query.html#abfde4c5353bcaf8fb444b116ef5cc8df">rr_class</a>;</div><div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;   strcpy(query-&gt;<a class="code" href="../../dd/daa/structast__dns__query.html#afd3f693e384b1ee0a0c44d58351eb87d">name</a>, <a class="code" href="../../d0/d29/cdr__mysql_8c.html#a0980a105ccb863d8008eb6201a51da52">name</a>); <span class="comment">/* SAFE */</span></div><div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;</div><div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;   <a class="code" href="../../df/d90/linkedlists_8h.html#a0a0fe104cc2cc36a43784f886f3ae7dc">AST_RWLIST_RDLOCK</a>(&amp;<a class="code" href="../../dd/da1/structresolvers.html">resolvers</a>);</div><div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;   query-&gt;<a class="code" href="../../dd/daa/structast__dns__query.html#a685d572a3fbc0c943665c13419e0ec56">resolver</a> = <a class="code" href="../../df/d90/linkedlists_8h.html#a64835fe6d570951b2a0404799c3d116f">AST_RWLIST_FIRST</a>(&amp;<a class="code" href="../../dd/da1/structresolvers.html">resolvers</a>);</div><div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;   <a class="code" href="../../df/d90/linkedlists_8h.html#a2e9a2518b5029b96671aff6701bd5138">AST_RWLIST_UNLOCK</a>(&amp;<a class="code" href="../../dd/da1/structresolvers.html">resolvers</a>);</div><div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;</div><div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;   <span class="keywordflow">if</span> (!query-&gt;<a class="code" href="../../dd/daa/structast__dns__query.html#a685d572a3fbc0c943665c13419e0ec56">resolver</a>) {</div><div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Attempted to do a DNS query for &#39;%s&#39; of class &#39;%d&#39; and type &#39;%d&#39; but no resolver is available\n&quot;</span>,</div><div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;         <a class="code" href="../../d0/d29/cdr__mysql_8c.html#a0980a105ccb863d8008eb6201a51da52">name</a>, <a class="code" href="../../dd/daa/structast__dns__query.html#abfde4c5353bcaf8fb444b116ef5cc8df">rr_class</a>, <a class="code" href="../../dd/daa/structast__dns__query.html#ac0d0e7420a9c7f7247c0f3068225df09">rr_type</a>);</div><div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;      <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(query, -1);</div><div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;   }</div><div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;</div><div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;   <span class="keywordflow">return</span> query;</div><div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;}</div><div class="ttc" id="astobj2_8h_html_a2cf7e3433f08351aafe3b0cd31edf7f8a23b60f2636bcfbc4dfeea6cc21bf847b"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#a2cf7e3433f08351aafe3b0cd31edf7f8a23b60f2636bcfbc4dfeea6cc21bf847b">AO2_ALLOC_OPT_LOCK_NOLOCK</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l00369">astobj2.h:369</a></div></div>
<div class="ttc" id="structast__dns__query_html_ac0d0e7420a9c7f7247c0f3068225df09"><div class="ttname"><a href="../../dd/daa/structast__dns__query.html#ac0d0e7420a9c7f7247c0f3068225df09">ast_dns_query::rr_type</a></div><div class="ttdeci">int rr_type</div><div class="ttdoc">Resource record type. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d07/dns__internal_8h_source.html#l00149">dns_internal.h:149</a></div></div>
<div class="ttc" id="logger_8h_html_adf4476a6a4ea6c74231c826e899d7189"><div class="ttname"><a href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a></div><div class="ttdeci">#define LOG_WARNING</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d8c/logger_8h_source.html#l00274">logger.h:274</a></div></div>
<div class="ttc" id="linkedlists_8h_html_a2e9a2518b5029b96671aff6701bd5138"><div class="ttname"><a href="../../df/d90/linkedlists_8h.html#a2e9a2518b5029b96671aff6701bd5138">AST_RWLIST_UNLOCK</a></div><div class="ttdeci">#define AST_RWLIST_UNLOCK(head)</div><div class="ttdoc">Attempts to unlock a read/write based list. </div><div class="ttdef"><b>Definition:</b> <a href="../../df/d90/linkedlists_8h_source.html#l00150">linkedlists.h:150</a></div></div>
<div class="ttc" id="structast__dns__query_html_abfde4c5353bcaf8fb444b116ef5cc8df"><div class="ttname"><a href="../../dd/daa/structast__dns__query.html#abfde4c5353bcaf8fb444b116ef5cc8df">ast_dns_query::rr_class</a></div><div class="ttdeci">int rr_class</div><div class="ttdoc">Resource record class. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d07/dns__internal_8h_source.html#l00151">dns_internal.h:151</a></div></div>
<div class="ttc" id="astobj2_8h_html_ab3c44e28d661616129b7819069effe61"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#ab3c44e28d661616129b7819069effe61">ao2_alloc_options</a></div><div class="ttdeci">#define ao2_alloc_options(data_size, destructor_fn, options)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l00406">astobj2.h:406</a></div></div>
<div class="ttc" id="structast__dns__query_html_afd3f693e384b1ee0a0c44d58351eb87d"><div class="ttname"><a href="../../dd/daa/structast__dns__query.html#afd3f693e384b1ee0a0c44d58351eb87d">ast_dns_query::name</a></div><div class="ttdeci">char name[0]</div><div class="ttdoc">The name of what is being resolved. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d07/dns__internal_8h_source.html#l00153">dns_internal.h:153</a></div></div>
<div class="ttc" id="resample_8c_html_a070d2ce7b6bb7e5c05602aa8c308d0c4"><div class="ttname"><a href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a></div><div class="ttdeci">#define NULL</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d7f/resample_8c_source.html#l00096">resample.c:96</a></div></div>
<div class="ttc" id="strings_8h_html_a372554b7a2d69a8bd3adac5157672036"><div class="ttname"><a href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a></div><div class="ttdeci">#define ast_strlen_zero(foo)</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d90/strings_8h_source.html#l00052">strings.h:52</a></div></div>
<div class="ttc" id="astobj2_8h_html_ac438c3fcd3150481fad38689fd813a15"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#ac438c3fcd3150481fad38689fd813a15">ao2_bump</a></div><div class="ttdeci">#define ao2_bump(obj)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l00491">astobj2.h:491</a></div></div>
<div class="ttc" id="linkedlists_8h_html_a0a0fe104cc2cc36a43784f886f3ae7dc"><div class="ttname"><a href="../../df/d90/linkedlists_8h.html#a0a0fe104cc2cc36a43784f886f3ae7dc">AST_RWLIST_RDLOCK</a></div><div class="ttdeci">#define AST_RWLIST_RDLOCK(head)</div><div class="ttdoc">Read locks a list. </div><div class="ttdef"><b>Definition:</b> <a href="../../df/d90/linkedlists_8h_source.html#l00077">linkedlists.h:77</a></div></div>
<div class="ttc" id="astobj2_8c_html_a96a00b3a518d7f32b6d51dc28f09bf9b"><div class="ttname"><a href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a></div><div class="ttdeci">#define ast_log</div><div class="ttdef"><b>Definition:</b> <a href="../../da/df7/astobj2_8c_source.html#l00042">astobj2.c:42</a></div></div>
<div class="ttc" id="astobj2_8h_html_aaca5e8eac39a22f9da1c36fc6c922270"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a></div><div class="ttdeci">#define ao2_ref(o, delta)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l00464">astobj2.h:464</a></div></div>
<div class="ttc" id="structast__dns__query_html_a0f53d287ac7c064d1a49d4bd93ca1cb9"><div class="ttname"><a href="../../dd/daa/structast__dns__query.html#a0f53d287ac7c064d1a49d4bd93ca1cb9">ast_dns_query::user_data</a></div><div class="ttdeci">void * user_data</div><div class="ttdoc">User-specific data. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d07/dns__internal_8h_source.html#l00141">dns_internal.h:141</a></div></div>
<div class="ttc" id="dns__core_8c_html_af158480d2c29c44bec9a2860af39d444"><div class="ttname"><a href="../../dc/d00/dns__core_8c.html#af158480d2c29c44bec9a2860af39d444">dns_query_destroy</a></div><div class="ttdeci">static void dns_query_destroy(void *data)</div><div class="ttdoc">Destructor for a DNS query. </div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d00/dns__core_8c_source.html#l00184">dns_core.c:184</a></div></div>
<div class="ttc" id="logger_8h_html_aced66975c154ea0e2a8ec3bc818b4e08"><div class="ttname"><a href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a></div><div class="ttdeci">#define LOG_ERROR</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d8c/logger_8h_source.html#l00285">logger.h:285</a></div></div>
<div class="ttc" id="structast__dns__query_html_a4bd02e416911ded4d9bd5c018f45dcce"><div class="ttname"><a href="../../dd/daa/structast__dns__query.html#a4bd02e416911ded4d9bd5c018f45dcce">ast_dns_query::callback</a></div><div class="ttdeci">ast_dns_resolve_callback callback</div><div class="ttdoc">Callback to invoke upon completion. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d07/dns__internal_8h_source.html#l00139">dns_internal.h:139</a></div></div>
<div class="ttc" id="cdr__mysql_8c_html_a0980a105ccb863d8008eb6201a51da52"><div class="ttname"><a href="../../d0/d29/cdr__mysql_8c.html#a0980a105ccb863d8008eb6201a51da52">name</a></div><div class="ttdeci">static const char name[]</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d29/cdr__mysql_8c_source.html#l00074">cdr_mysql.c:74</a></div></div>
<div class="ttc" id="structast__dns__query_html"><div class="ttname"><a href="../../dd/daa/structast__dns__query.html">ast_dns_query</a></div><div class="ttdoc">A DNS query. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d07/dns__internal_8h_source.html#l00137">dns_internal.h:137</a></div></div>
<div class="ttc" id="structast__dns__query_html_a685d572a3fbc0c943665c13419e0ec56"><div class="ttname"><a href="../../dd/daa/structast__dns__query.html#a685d572a3fbc0c943665c13419e0ec56">ast_dns_query::resolver</a></div><div class="ttdeci">struct ast_dns_resolver * resolver</div><div class="ttdoc">The resolver in use for this query. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d07/dns__internal_8h_source.html#l00143">dns_internal.h:143</a></div></div>
<div class="ttc" id="structresolvers_html"><div class="ttname"><a href="../../dd/da1/structresolvers.html">resolvers</a></div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d00/dns__core_8c_source.html#l00048">dns_core.c:48</a></div></div>
<div class="ttc" id="linkedlists_8h_html_a64835fe6d570951b2a0404799c3d116f"><div class="ttname"><a href="../../df/d90/linkedlists_8h.html#a64835fe6d570951b2a0404799c3d116f">AST_RWLIST_FIRST</a></div><div class="ttdeci">#define AST_RWLIST_FIRST</div><div class="ttdef"><b>Definition:</b> <a href="../../df/d90/linkedlists_8h_source.html#l00422">linkedlists.h:422</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="ac589eed5d41a033773f18c17ca26ac23"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac589eed5d41a033773f18c17ca26ac23">&#9670;&nbsp;</a></span>dns_srv_alloc()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="../../d3/db7/structast__dns__record.html">ast_dns_record</a>* dns_srv_alloc </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="../../dd/daa/structast__dns__query.html">ast_dns_query</a> *&#160;</td>
          <td class="paramname"><em>query</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>data</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const size_t&#160;</td>
          <td class="paramname"><em>size</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Allocate and parse a DNS SRV record. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">query</td><td>The DNS query </td></tr>
    <tr><td class="paramname">data</td><td>This specific SRV record </td></tr>
    <tr><td class="paramname">size</td><td>The size of the SRV record</td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">non-NULL</td><td>success </td></tr>
    <tr><td class="paramname">NULL</td><td>failure </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="../../db/d8e/dns__srv_8c_source.html#l00042">42</a> of file <a class="el" href="../../db/d8e/dns__srv_8c_source.html">dns_srv.c</a>.</p>

<p class="reference">References <a class="el" href="../../d4/d07/dns__internal_8h_source.html#l00129">ast_dns_result::answer</a>, <a class="el" href="../../d4/d07/dns__internal_8h_source.html#l00131">ast_dns_result::answer_size</a>, <a class="el" href="../../d5/d60/utils_8h_source.html#l00695">ast_assert</a>, <a class="el" href="../../d8/d8a/astmm_8h_source.html#l00204">ast_calloc</a>, <a class="el" href="../../d6/d90/strings_8h_source.html#l00401">ast_copy_string()</a>, <a class="el" href="../../da/df7/astobj2_8c_source.html#l00042">ast_log</a>, <a class="el" href="../../d4/d07/dns__internal_8h_source.html#l00088">ast_dns_srv_record::data</a>, <a class="el" href="../../d4/d07/dns__internal_8h_source.html#l00058">ast_dns_record::data_ptr</a>, <a class="el" href="../../dc/d00/dns__core_8c_source.html#l00701">dns_find_record()</a>, <a class="el" href="../../dc/d00/dns__core_8c_source.html#l00722">dns_parse_short()</a>, <a class="el" href="../../d1/d6e/main_2stdtime_2private_8h.html#ad65a8842cc674e3ddf69355898c0ecbf">errno</a>, <a class="el" href="../../d4/d07/dns__internal_8h_source.html#l00076">ast_dns_srv_record::generic</a>, <a class="el" href="../../d0/d8a/muted_8c_source.html#l00077">host</a>, <a class="el" href="../../d4/d07/dns__internal_8h_source.html#l00078">ast_dns_srv_record::host</a>, <a class="el" href="../../d1/d8c/logger_8h_source.html#l00285">LOG_ERROR</a>, <a class="el" href="../../dc/d7f/resample_8c_source.html#l00096">NULL</a>, <a class="el" href="../../d4/d07/dns__internal_8h_source.html#l00084">ast_dns_srv_record::port</a>, <a class="el" href="../../d9/d47/cdr__beanstalkd_8c_source.html#l00076">priority</a>, <a class="el" href="../../d4/d07/dns__internal_8h_source.html#l00080">ast_dns_srv_record::priority</a>, <a class="el" href="../../d4/d07/dns__internal_8h_source.html#l00147">ast_dns_query::result</a>, <a class="el" href="../../d4/d07/dns__internal_8h_source.html#l00082">ast_dns_srv_record::weight</a>, and <a class="el" href="../../dc/d5c/app__alarmreceiver_8c_source.html#l00132">weight</a>.</p>
<div class="fragment"><div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;{</div><div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;   uint16_t <a class="code" href="../../d9/d47/cdr__beanstalkd_8c.html#acec9ce2df15222151ad66fcb1d74eb9f">priority</a>;</div><div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;   uint16_t <a class="code" href="../../dc/d5c/app__alarmreceiver_8c.html#abad164b523955988350efd52f43e7d67">weight</a>;</div><div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;   uint16_t port;</div><div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;   <span class="keyword">const</span> <span class="keywordtype">char</span> *ptr;</div><div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;   <span class="keyword">const</span> <span class="keywordtype">char</span> *end_of_record;</div><div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d8/d2f/structast__dns__srv__record.html">ast_dns_srv_record</a> *srv;</div><div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;   <span class="keywordtype">int</span> host_size;</div><div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;   <span class="keywordtype">char</span> <a class="code" href="../../d0/d8a/muted_8c.html#a41c3a180b50c6b2ddcc1b6843a48f205">host</a>[NI_MAXHOST] = <span class="stringliteral">&quot;&quot;</span>;</div><div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;   <span class="keywordtype">size_t</span> host_len;</div><div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;</div><div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;   ptr = <a class="code" href="../../d4/d07/dns__internal_8h.html#ae0b5c136c1af09327876900be0630411">dns_find_record</a>(<a class="code" href="../../d8/d2f/structast__dns__srv__record.html#a9a3b4be1b9151b0369d7fca9911c7ecd">data</a>, size, query-&gt;<a class="code" href="../../dd/daa/structast__dns__query.html#a739d372feb17d2aa4aefab56762623e4">result</a>-&gt;<a class="code" href="../../d5/d8d/structast__dns__result.html#acf478081be3b257185e81c8a92235209">answer</a>, query-&gt;<a class="code" href="../../dd/daa/structast__dns__query.html#a739d372feb17d2aa4aefab56762623e4">result</a>-&gt;<a class="code" href="../../d5/d8d/structast__dns__result.html#a60e7f19e0a67dbea7e21c74f1a225fef">answer_size</a>);</div><div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;   <a class="code" href="../../d5/d60/utils_8h.html#a24374da24af1931d8a7ccde5b352bb2c">ast_assert</a>(ptr != <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div><div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;</div><div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;   end_of_record = ptr + size;</div><div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;</div><div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;   <span class="comment">/* PRIORITY */</span></div><div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;   ptr += <a class="code" href="../../d4/d07/dns__internal_8h.html#a9e4884282d130aebaed0e9d0737fa19b">dns_parse_short</a>((<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *) ptr, &amp;priority);</div><div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;   <span class="keywordflow">if</span> (ptr &gt;= end_of_record) {</div><div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;   }</div><div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;</div><div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;   <span class="comment">/* WEIGHT */</span></div><div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;   ptr += <a class="code" href="../../d4/d07/dns__internal_8h.html#a9e4884282d130aebaed0e9d0737fa19b">dns_parse_short</a>((<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *) ptr, &amp;weight);</div><div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;   <span class="keywordflow">if</span> (ptr &gt;= end_of_record) {</div><div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;   }</div><div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;</div><div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;   <span class="comment">/* PORT */</span></div><div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;   ptr += <a class="code" href="../../d4/d07/dns__internal_8h.html#a9e4884282d130aebaed0e9d0737fa19b">dns_parse_short</a>((<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *) ptr, &amp;port);</div><div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;   <span class="keywordflow">if</span> (ptr &gt;= end_of_record) {</div><div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;   }</div><div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;</div><div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;   <span class="comment">/*</span></div><div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;<span class="comment">    * The return value from dn_expand represents the size of the replacement</span></div><div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;<span class="comment">    * in the buffer which MAY be compressed.  Since the expanded replacement</span></div><div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;<span class="comment">    * is NULL terminated, you can use strlen() to get the expanded size.</span></div><div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;<span class="comment">    */</span></div><div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;   host_size = dn_expand((<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *)query-&gt;<a class="code" href="../../dd/daa/structast__dns__query.html#a739d372feb17d2aa4aefab56762623e4">result</a>-&gt;<a class="code" href="../../d5/d8d/structast__dns__result.html#acf478081be3b257185e81c8a92235209">answer</a>,</div><div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;      (<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *) end_of_record, (<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *) ptr, host, <span class="keyword">sizeof</span>(host) - 1);</div><div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;   <span class="keywordflow">if</span> (host_size &lt; 0) {</div><div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Failed to expand domain name: %s\n&quot;</span>, strerror(<a class="code" href="../../d1/d6e/main_2stdtime_2private_8h.html#ad65a8842cc674e3ddf69355898c0ecbf">errno</a>));</div><div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;   }</div><div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;</div><div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;   <span class="keywordflow">if</span> (!strcmp(host, <span class="stringliteral">&quot;.&quot;</span>)) {</div><div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;   }</div><div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;</div><div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;   host_len = strlen(host) + 1;</div><div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;   srv = <a class="code" href="../../d8/d8a/astmm_8h.html#ae0cd4c5524b01287ab19cbe233d9cebb">ast_calloc</a>(1, <span class="keyword">sizeof</span>(*srv) + size + host_len);</div><div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;   <span class="keywordflow">if</span> (!srv) {</div><div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;   }</div><div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;</div><div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;   srv-&gt;<a class="code" href="../../d8/d2f/structast__dns__srv__record.html#a62b78ebd7d40dbad7542cd177d0026a0">priority</a> = <a class="code" href="../../d9/d47/cdr__beanstalkd_8c.html#acec9ce2df15222151ad66fcb1d74eb9f">priority</a>;</div><div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;   srv-&gt;<a class="code" href="../../d8/d2f/structast__dns__srv__record.html#a6288d74be6b85a42be41a2cd779b8909">weight</a> = <a class="code" href="../../dc/d5c/app__alarmreceiver_8c.html#abad164b523955988350efd52f43e7d67">weight</a>;</div><div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;   srv-&gt;<a class="code" href="../../d8/d2f/structast__dns__srv__record.html#ab85ff85aa1f60f4a1c1ca1225a9dad06">port</a> = <a class="code" href="../../d8/d2f/structast__dns__srv__record.html#ab85ff85aa1f60f4a1c1ca1225a9dad06">port</a>;</div><div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;</div><div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;   srv-&gt;<a class="code" href="../../d8/d2f/structast__dns__srv__record.html#ae032e164f1daa754d6fbb79d59723931">host</a> = srv-&gt;<a class="code" href="../../d8/d2f/structast__dns__srv__record.html#a9a3b4be1b9151b0369d7fca9911c7ecd">data</a> + size;</div><div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;   <a class="code" href="../../d6/d90/strings_8h.html#ac4040268f7b6ed77dfc49c7767626369">ast_copy_string</a>((<span class="keywordtype">char</span> *)srv-&gt;<a class="code" href="../../d8/d2f/structast__dns__srv__record.html#ae032e164f1daa754d6fbb79d59723931">host</a>, host, host_len); <span class="comment">/* SAFE */</span></div><div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;   srv-&gt;<a class="code" href="../../d8/d2f/structast__dns__srv__record.html#a4648fde6e8cb9408e134bc93ef77e3a1">generic</a>.<a class="code" href="../../d3/db7/structast__dns__record.html#ae7533305b03c676bd7047f6d2c3aa7b2">data_ptr</a> = srv-&gt;<a class="code" href="../../d8/d2f/structast__dns__srv__record.html#a9a3b4be1b9151b0369d7fca9911c7ecd">data</a>;</div><div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;</div><div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;   <span class="keywordflow">return</span> (<span class="keyword">struct</span> <a class="code" href="../../d3/db7/structast__dns__record.html">ast_dns_record</a> *)srv;</div><div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;}</div><div class="ttc" id="structast__dns__srv__record_html_a9a3b4be1b9151b0369d7fca9911c7ecd"><div class="ttname"><a href="../../d8/d2f/structast__dns__srv__record.html#a9a3b4be1b9151b0369d7fca9911c7ecd">ast_dns_srv_record::data</a></div><div class="ttdeci">char data[0]</div><div class="ttdoc">Additional data. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d07/dns__internal_8h_source.html#l00088">dns_internal.h:88</a></div></div>
<div class="ttc" id="structast__dns__record_html_ae7533305b03c676bd7047f6d2c3aa7b2"><div class="ttname"><a href="../../d3/db7/structast__dns__record.html#ae7533305b03c676bd7047f6d2c3aa7b2">ast_dns_record::data_ptr</a></div><div class="ttdeci">char * data_ptr</div><div class="ttdoc">pointer to record-specific data. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d07/dns__internal_8h_source.html#l00058">dns_internal.h:58</a></div></div>
<div class="ttc" id="structast__dns__record_html"><div class="ttname"><a href="../../d3/db7/structast__dns__record.html">ast_dns_record</a></div><div class="ttdoc">For AST_LIST. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d07/dns__internal_8h_source.html#l00039">dns_internal.h:39</a></div></div>
<div class="ttc" id="dns__internal_8h_html_a9e4884282d130aebaed0e9d0737fa19b"><div class="ttname"><a href="../../d4/d07/dns__internal_8h.html#a9e4884282d130aebaed0e9d0737fa19b">dns_parse_short</a></div><div class="ttdeci">int dns_parse_short(unsigned char *cur, uint16_t *val)</div><div class="ttdoc">Parse a 16-bit unsigned value from a DNS record. </div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d00/dns__core_8c_source.html#l00722">dns_core.c:722</a></div></div>
<div class="ttc" id="utils_8h_html_a24374da24af1931d8a7ccde5b352bb2c"><div class="ttname"><a href="../../d5/d60/utils_8h.html#a24374da24af1931d8a7ccde5b352bb2c">ast_assert</a></div><div class="ttdeci">#define ast_assert(a)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d60/utils_8h_source.html#l00695">utils.h:695</a></div></div>
<div class="ttc" id="resample_8c_html_a070d2ce7b6bb7e5c05602aa8c308d0c4"><div class="ttname"><a href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a></div><div class="ttdeci">#define NULL</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d7f/resample_8c_source.html#l00096">resample.c:96</a></div></div>
<div class="ttc" id="structast__dns__srv__record_html_ab85ff85aa1f60f4a1c1ca1225a9dad06"><div class="ttname"><a href="../../d8/d2f/structast__dns__srv__record.html#ab85ff85aa1f60f4a1c1ca1225a9dad06">ast_dns_srv_record::port</a></div><div class="ttdeci">unsigned short port</div><div class="ttdoc">The port in the SRV record. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d07/dns__internal_8h_source.html#l00084">dns_internal.h:84</a></div></div>
<div class="ttc" id="cdr__beanstalkd_8c_html_acec9ce2df15222151ad66fcb1d74eb9f"><div class="ttname"><a href="../../d9/d47/cdr__beanstalkd_8c.html#acec9ce2df15222151ad66fcb1d74eb9f">priority</a></div><div class="ttdeci">static int priority</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d47/cdr__beanstalkd_8c_source.html#l00076">cdr_beanstalkd.c:76</a></div></div>
<div class="ttc" id="astobj2_8c_html_a96a00b3a518d7f32b6d51dc28f09bf9b"><div class="ttname"><a href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a></div><div class="ttdeci">#define ast_log</div><div class="ttdef"><b>Definition:</b> <a href="../../da/df7/astobj2_8c_source.html#l00042">astobj2.c:42</a></div></div>
<div class="ttc" id="muted_8c_html_a41c3a180b50c6b2ddcc1b6843a48f205"><div class="ttname"><a href="../../d0/d8a/muted_8c.html#a41c3a180b50c6b2ddcc1b6843a48f205">host</a></div><div class="ttdeci">static char host[256]</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d8a/muted_8c_source.html#l00077">muted.c:77</a></div></div>
<div class="ttc" id="structast__dns__srv__record_html"><div class="ttname"><a href="../../d8/d2f/structast__dns__srv__record.html">ast_dns_srv_record</a></div><div class="ttdoc">An SRV record. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d07/dns__internal_8h_source.html#l00074">dns_internal.h:74</a></div></div>
<div class="ttc" id="structast__dns__srv__record_html_a4648fde6e8cb9408e134bc93ef77e3a1"><div class="ttname"><a href="../../d8/d2f/structast__dns__srv__record.html#a4648fde6e8cb9408e134bc93ef77e3a1">ast_dns_srv_record::generic</a></div><div class="ttdeci">struct ast_dns_record generic</div><div class="ttdoc">Generic DNS record information. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d07/dns__internal_8h_source.html#l00076">dns_internal.h:76</a></div></div>
<div class="ttc" id="logger_8h_html_aced66975c154ea0e2a8ec3bc818b4e08"><div class="ttname"><a href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a></div><div class="ttdeci">#define LOG_ERROR</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d8c/logger_8h_source.html#l00285">logger.h:285</a></div></div>
<div class="ttc" id="app__alarmreceiver_8c_html_abad164b523955988350efd52f43e7d67"><div class="ttname"><a href="../../dc/d5c/app__alarmreceiver_8c.html#abad164b523955988350efd52f43e7d67">weight</a></div><div class="ttdeci">char weight</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d5c/app__alarmreceiver_8c_source.html#l00132">app_alarmreceiver.c:132</a></div></div>
<div class="ttc" id="structast__dns__query_html_a739d372feb17d2aa4aefab56762623e4"><div class="ttname"><a href="../../dd/daa/structast__dns__query.html#a739d372feb17d2aa4aefab56762623e4">ast_dns_query::result</a></div><div class="ttdeci">struct ast_dns_result * result</div><div class="ttdoc">Result of the DNS query. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d07/dns__internal_8h_source.html#l00147">dns_internal.h:147</a></div></div>
<div class="ttc" id="main_2stdtime_2private_8h_html_ad65a8842cc674e3ddf69355898c0ecbf"><div class="ttname"><a href="../../d1/d6e/main_2stdtime_2private_8h.html#ad65a8842cc674e3ddf69355898c0ecbf">errno</a></div><div class="ttdeci">int errno</div></div>
<div class="ttc" id="astmm_8h_html_ae0cd4c5524b01287ab19cbe233d9cebb"><div class="ttname"><a href="../../d8/d8a/astmm_8h.html#ae0cd4c5524b01287ab19cbe233d9cebb">ast_calloc</a></div><div class="ttdeci">#define ast_calloc(num, len)</div><div class="ttdoc">A wrapper for calloc() </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d8a/astmm_8h_source.html#l00204">astmm.h:204</a></div></div>
<div class="ttc" id="structast__dns__srv__record_html_a6288d74be6b85a42be41a2cd779b8909"><div class="ttname"><a href="../../d8/d2f/structast__dns__srv__record.html#a6288d74be6b85a42be41a2cd779b8909">ast_dns_srv_record::weight</a></div><div class="ttdeci">unsigned short weight</div><div class="ttdoc">The weight of the SRV record. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d07/dns__internal_8h_source.html#l00082">dns_internal.h:82</a></div></div>
<div class="ttc" id="structast__dns__srv__record_html_ae032e164f1daa754d6fbb79d59723931"><div class="ttname"><a href="../../d8/d2f/structast__dns__srv__record.html#ae032e164f1daa754d6fbb79d59723931">ast_dns_srv_record::host</a></div><div class="ttdeci">const char * host</div><div class="ttdoc">The hostname in the SRV record. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d07/dns__internal_8h_source.html#l00078">dns_internal.h:78</a></div></div>
<div class="ttc" id="strings_8h_html_ac4040268f7b6ed77dfc49c7767626369"><div class="ttname"><a href="../../d6/d90/strings_8h.html#ac4040268f7b6ed77dfc49c7767626369">ast_copy_string</a></div><div class="ttdeci">void ast_copy_string(char *dst, const char *src, size_t size)</div><div class="ttdoc">Size-limited null-terminating string copy. </div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d90/strings_8h_source.html#l00401">strings.h:401</a></div></div>
<div class="ttc" id="dns__internal_8h_html_ae0b5c136c1af09327876900be0630411"><div class="ttname"><a href="../../d4/d07/dns__internal_8h.html#ae0b5c136c1af09327876900be0630411">dns_find_record</a></div><div class="ttdeci">char * dns_find_record(const char *record, size_t record_size, const char *response, size_t response_size)</div><div class="ttdoc">Find the location of a DNS record within the entire DNS answer. </div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d00/dns__core_8c_source.html#l00701">dns_core.c:701</a></div></div>
<div class="ttc" id="structast__dns__result_html_a60e7f19e0a67dbea7e21c74f1a225fef"><div class="ttname"><a href="../../d5/d8d/structast__dns__result.html#a60e7f19e0a67dbea7e21c74f1a225fef">ast_dns_result::answer_size</a></div><div class="ttdeci">size_t answer_size</div><div class="ttdoc">The size of the raw DNS answer. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d07/dns__internal_8h_source.html#l00131">dns_internal.h:131</a></div></div>
<div class="ttc" id="structast__dns__result_html_acf478081be3b257185e81c8a92235209"><div class="ttname"><a href="../../d5/d8d/structast__dns__result.html#acf478081be3b257185e81c8a92235209">ast_dns_result::answer</a></div><div class="ttdeci">const char * answer</div><div class="ttdoc">The raw DNS answer. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d07/dns__internal_8h_source.html#l00129">dns_internal.h:129</a></div></div>
<div class="ttc" id="structast__dns__srv__record_html_a62b78ebd7d40dbad7542cd177d0026a0"><div class="ttname"><a href="../../d8/d2f/structast__dns__srv__record.html#a62b78ebd7d40dbad7542cd177d0026a0">ast_dns_srv_record::priority</a></div><div class="ttdeci">unsigned short priority</div><div class="ttdoc">The priority of the SRV record. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d07/dns__internal_8h_source.html#l00080">dns_internal.h:80</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="acc5da1ef3d174b88147bf572ad8f50fe"></a>
<h2 class="memtitle"><span class="permalink"><a href="#acc5da1ef3d174b88147bf572ad8f50fe">&#9670;&nbsp;</a></span>dns_srv_sort()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void dns_srv_sort </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="../../d5/d8d/structast__dns__result.html">ast_dns_result</a> *&#160;</td>
          <td class="paramname"><em>result</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Sort the SRV records on a result. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">result</td><td>The DNS result </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="../../db/d8e/dns__srv_8c_source.html#l00113">113</a> of file <a class="el" href="../../db/d8e/dns__srv_8c_source.html">dns_srv.c</a>.</p>

<p class="reference">References <a class="el" href="../../df/d90/linkedlists_8h_source.html#l00782">AST_LIST_APPEND_LIST</a>, <a class="el" href="../../df/d90/linkedlists_8h_source.html#l00420">AST_LIST_FIRST</a>, <a class="el" href="../../df/d90/linkedlists_8h_source.html#l00251">AST_LIST_HEAD_NOLOCK_INIT_VALUE</a>, <a class="el" href="../../df/d90/linkedlists_8h_source.html#l00710">AST_LIST_INSERT_HEAD</a>, <a class="el" href="../../df/d90/linkedlists_8h_source.html#l00730">AST_LIST_INSERT_TAIL</a>, <a class="el" href="../../df/d90/linkedlists_8h_source.html#l00581">AST_LIST_MOVE_CURRENT</a>, <a class="el" href="../../df/d90/linkedlists_8h_source.html#l00556">AST_LIST_REMOVE_CURRENT</a>, <a class="el" href="../../df/d90/linkedlists_8h_source.html#l00490">AST_LIST_TRAVERSE</a>, <a class="el" href="../../df/d90/linkedlists_8h_source.html#l00528">AST_LIST_TRAVERSE_SAFE_BEGIN</a>, <a class="el" href="../../df/d90/linkedlists_8h_source.html#l00614">AST_LIST_TRAVERSE_SAFE_END</a>, <a class="el" href="../../de/d1f/main_2utils_8c_source.html#l02064">ast_random()</a>, <a class="el" href="../../d9/d47/cdr__beanstalkd_8c_source.html#l00076">priority</a>, <a class="el" href="../../d5/d8d/structast__dns__result.html#a85249bc4c3b2ab860d0dd551444a3ed4">ast_dns_result::records</a>, <a class="el" href="../../dc/d5c/app__alarmreceiver_8c_source.html#l00132">weight</a>, and <a class="el" href="../../d4/d07/dns__internal_8h_source.html#l00086">ast_dns_srv_record::weight_sum</a>.</p>
<div class="fragment"><div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;{</div><div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d3/db7/structast__dns__record.html">ast_dns_record</a> *current;</div><div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;   <span class="keyword">struct </span>dns_records newlist = <a class="code" href="../../df/d90/linkedlists_8h.html#a5a79a9dc65f139cedb64503d171d5df4">AST_LIST_HEAD_NOLOCK_INIT_VALUE</a>;</div><div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;</div><div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;   <span class="keywordflow">while</span> (<a class="code" href="../../df/d90/linkedlists_8h.html#adf1959c5c03a3a706da97ad2f49617e5">AST_LIST_FIRST</a>(&amp;result-&gt;<a class="code" href="../../d5/d8d/structast__dns__result.html#a85249bc4c3b2ab860d0dd551444a3ed4">records</a>)) {</div><div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;      <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> cur_priority = ((<span class="keyword">struct </span><a class="code" href="../../d8/d2f/structast__dns__srv__record.html">ast_dns_srv_record</a> *)(<a class="code" href="../../df/d90/linkedlists_8h.html#adf1959c5c03a3a706da97ad2f49617e5">AST_LIST_FIRST</a>(&amp;result-&gt;<a class="code" href="../../d5/d8d/structast__dns__result.html#a85249bc4c3b2ab860d0dd551444a3ed4">records</a>)))-&gt;priority;</div><div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;      <span class="keyword">struct </span>dns_records temp_list = <a class="code" href="../../df/d90/linkedlists_8h.html#a5a79a9dc65f139cedb64503d171d5df4">AST_LIST_HEAD_NOLOCK_INIT_VALUE</a>;</div><div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;</div><div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;      <span class="comment">/* Find the lowest current priority to work on, but if the priority is already zero there is no lower priority */</span></div><div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;      <span class="keywordflow">if</span> (cur_priority) {</div><div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;         <a class="code" href="../../df/d90/linkedlists_8h.html#a3008b2f4f236b72d8bcfb80e346324ef">AST_LIST_TRAVERSE</a>(&amp;result-&gt;<a class="code" href="../../d5/d8d/structast__dns__result.html#a85249bc4c3b2ab860d0dd551444a3ed4">records</a>, current, list) {</div><div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;            <span class="keywordflow">if</span> (((<span class="keyword">struct</span> <a class="code" href="../../d8/d2f/structast__dns__srv__record.html">ast_dns_srv_record</a> *)current)-&gt;<a class="code" href="../../d9/d47/cdr__beanstalkd_8c.html#acec9ce2df15222151ad66fcb1d74eb9f">priority</a> &lt; cur_priority) {</div><div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;               cur_priority = ((<span class="keyword">struct </span><a class="code" href="../../d8/d2f/structast__dns__srv__record.html">ast_dns_srv_record</a> *)current)-&gt;priority;</div><div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;            }</div><div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;         }</div><div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;      }</div><div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;</div><div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;      <span class="comment">/* Find all records which match this priority */</span></div><div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;      <a class="code" href="../../df/d90/linkedlists_8h.html#aa5be52067bf16bdc7e56ca19b5ba858d">AST_LIST_TRAVERSE_SAFE_BEGIN</a>(&amp;result-&gt;<a class="code" href="../../d5/d8d/structast__dns__result.html#a85249bc4c3b2ab860d0dd551444a3ed4">records</a>, current, list) {</div><div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;         <span class="keywordflow">if</span> (((<span class="keyword">struct</span> <a class="code" href="../../d8/d2f/structast__dns__srv__record.html">ast_dns_srv_record</a> *)current)-&gt;<a class="code" href="../../d9/d47/cdr__beanstalkd_8c.html#acec9ce2df15222151ad66fcb1d74eb9f">priority</a> != cur_priority) {</div><div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;            <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;         }</div><div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;</div><div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;         <a class="code" href="../../df/d90/linkedlists_8h.html#aa8ac496fa9c717d5afb99a02e1e2760c">AST_LIST_REMOVE_CURRENT</a>(list);</div><div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;</div><div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;         <span class="comment">/* Records with a weight of zero must always be at the head */</span></div><div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;         <span class="keywordflow">if</span> (((<span class="keyword">struct</span> <a class="code" href="../../d8/d2f/structast__dns__srv__record.html">ast_dns_srv_record</a> *)current)-&gt;<a class="code" href="../../dc/d5c/app__alarmreceiver_8c.html#abad164b523955988350efd52f43e7d67">weight</a> == 0) {</div><div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;            <a class="code" href="../../df/d90/linkedlists_8h.html#aa2ded2af046bb513f77056c27c083307">AST_LIST_INSERT_HEAD</a>(&amp;temp_list, current, list);</div><div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;         } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;            <a class="code" href="../../df/d90/linkedlists_8h.html#a4d258b4525e63c435d7de579d3f46960">AST_LIST_INSERT_TAIL</a>(&amp;temp_list, current, list);</div><div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;         }</div><div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;      }</div><div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;      <a class="code" href="../../df/d90/linkedlists_8h.html#a712c04b4493919a7052399cd30ee8fb9">AST_LIST_TRAVERSE_SAFE_END</a>;</div><div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;</div><div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;      <span class="comment">/* Apply weighting - as each record is passed the sum of all previous weights (plus its own) is stored away, and then a random weight</span></div><div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;<span class="comment">       * is calculated. The first record with a weight sum greater than the random weight is put in the new list and the whole thing starts</span></div><div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;<span class="comment">       * once again.</span></div><div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;<span class="comment">       */</span></div><div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;      <span class="keywordflow">while</span> (<a class="code" href="../../df/d90/linkedlists_8h.html#adf1959c5c03a3a706da97ad2f49617e5">AST_LIST_FIRST</a>(&amp;temp_list)) {</div><div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;         <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="../../d8/d2f/structast__dns__srv__record.html#a87b157515f01c2059c9b8e0dbae1895b">weight_sum</a> = 0;</div><div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;         <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> random_weight;</div><div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;</div><div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;         <a class="code" href="../../df/d90/linkedlists_8h.html#a3008b2f4f236b72d8bcfb80e346324ef">AST_LIST_TRAVERSE</a>(&amp;temp_list, current, list) {</div><div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;            ((<span class="keyword">struct </span><a class="code" href="../../d8/d2f/structast__dns__srv__record.html">ast_dns_srv_record</a> *)current)-&gt;weight_sum = weight_sum += ((<span class="keyword">struct </span><a class="code" href="../../d8/d2f/structast__dns__srv__record.html">ast_dns_srv_record</a> *)current)-&gt;weight;</div><div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;         }</div><div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;</div><div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;         <span class="comment">/* if all the remaining entries have weight == 0,</span></div><div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;<span class="comment">            then just append them to the result list and quit */</span></div><div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;         <span class="keywordflow">if</span> (weight_sum == 0) {</div><div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;            <a class="code" href="../../df/d90/linkedlists_8h.html#ad66405f1d0b9e1fb484643d9a36e94ed">AST_LIST_APPEND_LIST</a>(&amp;newlist, &amp;temp_list, list);</div><div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;         }</div><div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;</div><div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;         random_weight = 1 + (<span class="keywordtype">unsigned</span> int) ((<span class="keywordtype">float</span>) weight_sum * (<a class="code" href="../../d5/d60/utils_8h.html#a7b4f10b070e95ba413e258a3e4b03c20">ast_random</a>() / ((float) RAND_MAX + 1.0)));</div><div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;</div><div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;         <a class="code" href="../../df/d90/linkedlists_8h.html#aa5be52067bf16bdc7e56ca19b5ba858d">AST_LIST_TRAVERSE_SAFE_BEGIN</a>(&amp;temp_list, current, list) {</div><div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;            <span class="keywordflow">if</span> (((<span class="keyword">struct</span> <a class="code" href="../../d8/d2f/structast__dns__srv__record.html">ast_dns_srv_record</a> *)current)-&gt;weight_sum &lt; random_weight) {</div><div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;               <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;            }</div><div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;</div><div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;            <a class="code" href="../../df/d90/linkedlists_8h.html#a8e6f4898b3dd6430077785901605b375">AST_LIST_MOVE_CURRENT</a>(&amp;newlist, list);</div><div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;         }</div><div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;         <a class="code" href="../../df/d90/linkedlists_8h.html#a712c04b4493919a7052399cd30ee8fb9">AST_LIST_TRAVERSE_SAFE_END</a>;</div><div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;      }</div><div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;</div><div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;   }</div><div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;</div><div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;   <span class="comment">/* now that the new list has been ordered,</span></div><div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;<span class="comment">      put it in place */</span></div><div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;</div><div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;   <a class="code" href="../../df/d90/linkedlists_8h.html#ad66405f1d0b9e1fb484643d9a36e94ed">AST_LIST_APPEND_LIST</a>(&amp;result-&gt;<a class="code" href="../../d5/d8d/structast__dns__result.html#a85249bc4c3b2ab860d0dd551444a3ed4">records</a>, &amp;newlist, list);</div><div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;}</div><div class="ttc" id="linkedlists_8h_html_adf1959c5c03a3a706da97ad2f49617e5"><div class="ttname"><a href="../../df/d90/linkedlists_8h.html#adf1959c5c03a3a706da97ad2f49617e5">AST_LIST_FIRST</a></div><div class="ttdeci">#define AST_LIST_FIRST(head)</div><div class="ttdoc">Returns the first entry contained in a list. </div><div class="ttdef"><b>Definition:</b> <a href="../../df/d90/linkedlists_8h_source.html#l00420">linkedlists.h:420</a></div></div>
<div class="ttc" id="structast__dns__record_html"><div class="ttname"><a href="../../d3/db7/structast__dns__record.html">ast_dns_record</a></div><div class="ttdoc">For AST_LIST. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d07/dns__internal_8h_source.html#l00039">dns_internal.h:39</a></div></div>
<div class="ttc" id="cdr__beanstalkd_8c_html_acec9ce2df15222151ad66fcb1d74eb9f"><div class="ttname"><a href="../../d9/d47/cdr__beanstalkd_8c.html#acec9ce2df15222151ad66fcb1d74eb9f">priority</a></div><div class="ttdeci">static int priority</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d47/cdr__beanstalkd_8c_source.html#l00076">cdr_beanstalkd.c:76</a></div></div>
<div class="ttc" id="linkedlists_8h_html_a712c04b4493919a7052399cd30ee8fb9"><div class="ttname"><a href="../../df/d90/linkedlists_8h.html#a712c04b4493919a7052399cd30ee8fb9">AST_LIST_TRAVERSE_SAFE_END</a></div><div class="ttdeci">#define AST_LIST_TRAVERSE_SAFE_END</div><div class="ttdoc">Closes a safe loop traversal block. </div><div class="ttdef"><b>Definition:</b> <a href="../../df/d90/linkedlists_8h_source.html#l00614">linkedlists.h:614</a></div></div>
<div class="ttc" id="structast__dns__srv__record_html"><div class="ttname"><a href="../../d8/d2f/structast__dns__srv__record.html">ast_dns_srv_record</a></div><div class="ttdoc">An SRV record. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d07/dns__internal_8h_source.html#l00074">dns_internal.h:74</a></div></div>
<div class="ttc" id="linkedlists_8h_html_aa8ac496fa9c717d5afb99a02e1e2760c"><div class="ttname"><a href="../../df/d90/linkedlists_8h.html#aa8ac496fa9c717d5afb99a02e1e2760c">AST_LIST_REMOVE_CURRENT</a></div><div class="ttdeci">#define AST_LIST_REMOVE_CURRENT(field)</div><div class="ttdoc">Removes the current entry from a list during a traversal. </div><div class="ttdef"><b>Definition:</b> <a href="../../df/d90/linkedlists_8h_source.html#l00556">linkedlists.h:556</a></div></div>
<div class="ttc" id="utils_8h_html_a7b4f10b070e95ba413e258a3e4b03c20"><div class="ttname"><a href="../../d5/d60/utils_8h.html#a7b4f10b070e95ba413e258a3e4b03c20">ast_random</a></div><div class="ttdeci">long int ast_random(void)</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d1f/main_2utils_8c_source.html#l02064">main/utils.c:2064</a></div></div>
<div class="ttc" id="linkedlists_8h_html_a8e6f4898b3dd6430077785901605b375"><div class="ttname"><a href="../../df/d90/linkedlists_8h.html#a8e6f4898b3dd6430077785901605b375">AST_LIST_MOVE_CURRENT</a></div><div class="ttdeci">#define AST_LIST_MOVE_CURRENT(newhead, field)</div><div class="ttdoc">Move the current list entry to another list. </div><div class="ttdef"><b>Definition:</b> <a href="../../df/d90/linkedlists_8h_source.html#l00581">linkedlists.h:581</a></div></div>
<div class="ttc" id="linkedlists_8h_html_a4d258b4525e63c435d7de579d3f46960"><div class="ttname"><a href="../../df/d90/linkedlists_8h.html#a4d258b4525e63c435d7de579d3f46960">AST_LIST_INSERT_TAIL</a></div><div class="ttdeci">#define AST_LIST_INSERT_TAIL(head, elm, field)</div><div class="ttdoc">Appends a list entry to the tail of a list. </div><div class="ttdef"><b>Definition:</b> <a href="../../df/d90/linkedlists_8h_source.html#l00730">linkedlists.h:730</a></div></div>
<div class="ttc" id="app__alarmreceiver_8c_html_abad164b523955988350efd52f43e7d67"><div class="ttname"><a href="../../dc/d5c/app__alarmreceiver_8c.html#abad164b523955988350efd52f43e7d67">weight</a></div><div class="ttdeci">char weight</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d5c/app__alarmreceiver_8c_source.html#l00132">app_alarmreceiver.c:132</a></div></div>
<div class="ttc" id="linkedlists_8h_html_a3008b2f4f236b72d8bcfb80e346324ef"><div class="ttname"><a href="../../df/d90/linkedlists_8h.html#a3008b2f4f236b72d8bcfb80e346324ef">AST_LIST_TRAVERSE</a></div><div class="ttdeci">#define AST_LIST_TRAVERSE(head, var, field)</div><div class="ttdoc">Loops over (traverses) the entries in a list. </div><div class="ttdef"><b>Definition:</b> <a href="../../df/d90/linkedlists_8h_source.html#l00490">linkedlists.h:490</a></div></div>
<div class="ttc" id="linkedlists_8h_html_aa2ded2af046bb513f77056c27c083307"><div class="ttname"><a href="../../df/d90/linkedlists_8h.html#aa2ded2af046bb513f77056c27c083307">AST_LIST_INSERT_HEAD</a></div><div class="ttdeci">#define AST_LIST_INSERT_HEAD(head, elm, field)</div><div class="ttdoc">Inserts a list entry at the head of a list. </div><div class="ttdef"><b>Definition:</b> <a href="../../df/d90/linkedlists_8h_source.html#l00710">linkedlists.h:710</a></div></div>
<div class="ttc" id="linkedlists_8h_html_a5a79a9dc65f139cedb64503d171d5df4"><div class="ttname"><a href="../../df/d90/linkedlists_8h.html#a5a79a9dc65f139cedb64503d171d5df4">AST_LIST_HEAD_NOLOCK_INIT_VALUE</a></div><div class="ttdeci">#define AST_LIST_HEAD_NOLOCK_INIT_VALUE</div><div class="ttdoc">Defines initial values for a declaration of AST_LIST_HEAD_NOLOCK. </div><div class="ttdef"><b>Definition:</b> <a href="../../df/d90/linkedlists_8h_source.html#l00251">linkedlists.h:251</a></div></div>
<div class="ttc" id="structast__dns__srv__record_html_a87b157515f01c2059c9b8e0dbae1895b"><div class="ttname"><a href="../../d8/d2f/structast__dns__srv__record.html#a87b157515f01c2059c9b8e0dbae1895b">ast_dns_srv_record::weight_sum</a></div><div class="ttdeci">unsigned int weight_sum</div><div class="ttdoc">The running weight sum. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d07/dns__internal_8h_source.html#l00086">dns_internal.h:86</a></div></div>
<div class="ttc" id="linkedlists_8h_html_aa5be52067bf16bdc7e56ca19b5ba858d"><div class="ttname"><a href="../../df/d90/linkedlists_8h.html#aa5be52067bf16bdc7e56ca19b5ba858d">AST_LIST_TRAVERSE_SAFE_BEGIN</a></div><div class="ttdeci">#define AST_LIST_TRAVERSE_SAFE_BEGIN(head, var, field)</div><div class="ttdoc">Loops safely over (traverses) the entries in a list. </div><div class="ttdef"><b>Definition:</b> <a href="../../df/d90/linkedlists_8h_source.html#l00528">linkedlists.h:528</a></div></div>
<div class="ttc" id="structast__dns__result_html_a85249bc4c3b2ab860d0dd551444a3ed4"><div class="ttname"><a href="../../d5/d8d/structast__dns__result.html#a85249bc4c3b2ab860d0dd551444a3ed4">ast_dns_result::records</a></div><div class="ttdeci">struct ast_dns_result::dns_records records</div></div>
<div class="ttc" id="linkedlists_8h_html_ad66405f1d0b9e1fb484643d9a36e94ed"><div class="ttname"><a href="../../df/d90/linkedlists_8h.html#ad66405f1d0b9e1fb484643d9a36e94ed">AST_LIST_APPEND_LIST</a></div><div class="ttdeci">#define AST_LIST_APPEND_LIST(head, list, field)</div><div class="ttdoc">Appends a whole list to the tail of a list. </div><div class="ttdef"><b>Definition:</b> <a href="../../df/d90/linkedlists_8h_source.html#l00782">linkedlists.h:782</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="ac4f896221fef31da2cbffdb2cb496f4b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac4f896221fef31da2cbffdb2cb496f4b">&#9670;&nbsp;</a></span>dns_txt_alloc()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="../../d3/db7/structast__dns__record.html">ast_dns_record</a>* dns_txt_alloc </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="../../dd/daa/structast__dns__query.html">ast_dns_query</a> *&#160;</td>
          <td class="paramname"><em>query</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>data</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const size_t&#160;</td>
          <td class="paramname"><em>size</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Allocate and parse a DNS TXT record. </p>
<dl class="section since"><dt>Since</dt><dd>16.10.0, 17.4.0</dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">query</td><td>The DNS query </td></tr>
    <tr><td class="paramname">data</td><td>This specific TXT record </td></tr>
    <tr><td class="paramname">size</td><td>The size of the TXT record</td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">non-NULL</td><td>success </td></tr>
    <tr><td class="paramname">NULL</td><td>failure </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="../../da/d40/dns__txt_8c_source.html#l00038">38</a> of file <a class="el" href="../../da/d40/dns__txt_8c_source.html">dns_txt.c</a>.</p>

<p class="reference">References <a class="el" href="../../d8/d8a/astmm_8h_source.html#l00204">ast_calloc</a>, <a class="el" href="../../d4/d07/dns__internal_8h_source.html#l00068">ast_dns_txt_record::count</a>, <a class="el" href="../../d4/d07/dns__internal_8h_source.html#l00070">ast_dns_txt_record::data</a>, <a class="el" href="../../d4/d07/dns__internal_8h_source.html#l00058">ast_dns_record::data_ptr</a>, <a class="el" href="../../d4/d07/dns__internal_8h_source.html#l00066">ast_dns_txt_record::generic</a>, and <a class="el" href="../../dc/d7f/resample_8c_source.html#l00096">NULL</a>.</p>
<div class="fragment"><div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;{</div><div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d7/d27/structast__dns__txt__record.html">ast_dns_txt_record</a> *txt;</div><div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;   <span class="keyword">const</span> <span class="keywordtype">char</span> *end_of_record = <a class="code" href="../../d7/d27/structast__dns__txt__record.html#a9a3b4be1b9151b0369d7fca9911c7ecd">data</a> + size;</div><div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;   <span class="keywordtype">size_t</span> <a class="code" href="../../d7/d27/structast__dns__txt__record.html#a76d971a3c552bc58ba9f0d5fceae9806">count</a> = 0;</div><div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;</div><div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;   <span class="comment">/* Because we can&#39;t allocate additional memory, the best we can do here is just</span></div><div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;<span class="comment">    * validate that this conforms to a TXT record. */</span></div><div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;   <span class="keywordflow">while</span> (<a class="code" href="../../d7/d27/structast__dns__txt__record.html#a9a3b4be1b9151b0369d7fca9911c7ecd">data</a> &lt; end_of_record) {</div><div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;      uint8_t byte_count = (uint8_t) *<a class="code" href="../../d7/d27/structast__dns__txt__record.html#a9a3b4be1b9151b0369d7fca9911c7ecd">data</a>;</div><div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;      count++;</div><div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;      <a class="code" href="../../d7/d27/structast__dns__txt__record.html#a9a3b4be1b9151b0369d7fca9911c7ecd">data</a> += byte_count + 1;</div><div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;   }</div><div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;</div><div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d7/d27/structast__dns__txt__record.html#a9a3b4be1b9151b0369d7fca9911c7ecd">data</a> != end_of_record) {</div><div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;      <span class="comment">/* This is not a valid TXT record, so we can bail out */</span></div><div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;   }</div><div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;</div><div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;   txt = <a class="code" href="../../d8/d8a/astmm_8h.html#ae0cd4c5524b01287ab19cbe233d9cebb">ast_calloc</a>(1, <span class="keyword">sizeof</span>(*txt) + size);</div><div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;   <span class="keywordflow">if</span> (!txt) {</div><div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;   }</div><div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;</div><div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;   txt-&gt;<a class="code" href="../../d7/d27/structast__dns__txt__record.html#a76d971a3c552bc58ba9f0d5fceae9806">count</a> = <a class="code" href="../../d7/d27/structast__dns__txt__record.html#a76d971a3c552bc58ba9f0d5fceae9806">count</a>;</div><div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;   txt-&gt;<a class="code" href="../../d7/d27/structast__dns__txt__record.html#a4648fde6e8cb9408e134bc93ef77e3a1">generic</a>.<a class="code" href="../../d3/db7/structast__dns__record.html#ae7533305b03c676bd7047f6d2c3aa7b2">data_ptr</a> = txt-&gt;<a class="code" href="../../d7/d27/structast__dns__txt__record.html#a9a3b4be1b9151b0369d7fca9911c7ecd">data</a>;</div><div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;</div><div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;   <span class="keywordflow">return</span> (<span class="keyword">struct</span> <a class="code" href="../../d3/db7/structast__dns__record.html">ast_dns_record</a> *) txt;</div><div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;}</div><div class="ttc" id="structast__dns__txt__record_html_a4648fde6e8cb9408e134bc93ef77e3a1"><div class="ttname"><a href="../../d7/d27/structast__dns__txt__record.html#a4648fde6e8cb9408e134bc93ef77e3a1">ast_dns_txt_record::generic</a></div><div class="ttdeci">struct ast_dns_record generic</div><div class="ttdoc">Generic DNS record information. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d07/dns__internal_8h_source.html#l00066">dns_internal.h:66</a></div></div>
<div class="ttc" id="structast__dns__txt__record_html"><div class="ttname"><a href="../../d7/d27/structast__dns__txt__record.html">ast_dns_txt_record</a></div><div class="ttdoc">A TXT record. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d07/dns__internal_8h_source.html#l00064">dns_internal.h:64</a></div></div>
<div class="ttc" id="structast__dns__record_html_ae7533305b03c676bd7047f6d2c3aa7b2"><div class="ttname"><a href="../../d3/db7/structast__dns__record.html#ae7533305b03c676bd7047f6d2c3aa7b2">ast_dns_record::data_ptr</a></div><div class="ttdeci">char * data_ptr</div><div class="ttdoc">pointer to record-specific data. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d07/dns__internal_8h_source.html#l00058">dns_internal.h:58</a></div></div>
<div class="ttc" id="structast__dns__record_html"><div class="ttname"><a href="../../d3/db7/structast__dns__record.html">ast_dns_record</a></div><div class="ttdoc">For AST_LIST. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d07/dns__internal_8h_source.html#l00039">dns_internal.h:39</a></div></div>
<div class="ttc" id="resample_8c_html_a070d2ce7b6bb7e5c05602aa8c308d0c4"><div class="ttname"><a href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a></div><div class="ttdeci">#define NULL</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d7f/resample_8c_source.html#l00096">resample.c:96</a></div></div>
<div class="ttc" id="structast__dns__txt__record_html_a9a3b4be1b9151b0369d7fca9911c7ecd"><div class="ttname"><a href="../../d7/d27/structast__dns__txt__record.html#a9a3b4be1b9151b0369d7fca9911c7ecd">ast_dns_txt_record::data</a></div><div class="ttdeci">char data[0]</div><div class="ttdoc">The raw DNS record. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d07/dns__internal_8h_source.html#l00070">dns_internal.h:70</a></div></div>
<div class="ttc" id="astmm_8h_html_ae0cd4c5524b01287ab19cbe233d9cebb"><div class="ttname"><a href="../../d8/d8a/astmm_8h.html#ae0cd4c5524b01287ab19cbe233d9cebb">ast_calloc</a></div><div class="ttdeci">#define ast_calloc(num, len)</div><div class="ttdoc">A wrapper for calloc() </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d8a/astmm_8h_source.html#l00204">astmm.h:204</a></div></div>
<div class="ttc" id="structast__dns__txt__record_html_a76d971a3c552bc58ba9f0d5fceae9806"><div class="ttname"><a href="../../d7/d27/structast__dns__txt__record.html#a76d971a3c552bc58ba9f0d5fceae9806">ast_dns_txt_record::count</a></div><div class="ttdeci">size_t count</div><div class="ttdoc">The number of character strings in the TXT record. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d07/dns__internal_8h_source.html#l00068">dns_internal.h:68</a></div></div>
</div><!-- fragment -->
</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Sun Aug 8 2021 19:45:48 for Asterisk - The Open Source Telephony Project by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="../../doxygen.png" alt="doxygen"/>
</a> 1.8.13
</small></address>
</body>
</html>
