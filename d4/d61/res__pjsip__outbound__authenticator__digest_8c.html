<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Asterisk - The Open Source Telephony Project: res_pjsip_outbound_authenticator_digest.c File Reference</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Asterisk - The Open Source Telephony Project
   &#160;<span id="projectnumber">18.5.0</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "../../search",false,'Search');
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('../../',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="../../dir_7b47cca4d318623bb4270ab1fb592ef5.html">res</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a> &#124;
<a href="#var-members">Variables</a>  </div>
  <div class="headertitle">
<div class="title">res_pjsip_outbound_authenticator_digest.c File Reference</div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><code>#include &quot;<a class="el" href="../../db/db2/asterisk_8h_source.html">asterisk.h</a>&quot;</code><br />
<code>#include &lt;pjsip.h&gt;</code><br />
<code>#include &quot;<a class="el" href="../../d8/d8c/res__pjsip_8h_source.html">asterisk/res_pjsip.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="../../d1/d8c/logger_8h_source.html">asterisk/logger.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="../../d5/d16/module_8h_source.html">asterisk/module.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="../../d6/d90/strings_8h_source.html">asterisk/strings.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="../../d6/d68/vector_8h_source.html">asterisk/vector.h</a>&quot;</code><br />
</div><div class="textblock"><div class="dynheader">
Include dependency graph for res_pjsip_outbound_authenticator_digest.c:</div>
<div class="dyncontent">
<div class="center"><img src="../../da/d6c/res__pjsip__outbound__authenticator__digest_8c__incl.png" border="0" usemap="#res__pjsip__outbound__authenticator__digest_8c" alt=""/></div>
<map name="res__pjsip__outbound__authenticator__digest_8c" id="res__pjsip__outbound__authenticator__digest_8c">
<area shape="rect" id="node2" href="../../db/db2/asterisk_8h.html" title="Asterisk main include file. File version handling, generic pbx functions. " alt="" coords="251,95,335,121"/>
<area shape="rect" id="node23" href="../../d8/d8c/res__pjsip_8h.html" title="asterisk/res_pjsip.h" alt="" coords="1434,95,1578,121"/>
<area shape="rect" id="node30" href="../../d6/d68/vector_8h.html" title="Vector container support. " alt="" coords="584,543,711,569"/>
<area shape="rect" id="node32" href="../../d1/d8c/logger_8h.html" title="Support for logging to various files, console and syslog Configuration in file logger.conf. " alt="" coords="1675,767,1801,793"/>
<area shape="rect" id="node40" href="../../d6/d90/strings_8h.html" title="String manipulation functions. " alt="" coords="1367,468,1498,495"/>
<area shape="rect" id="node50" href="../../d5/d16/module_8h.html" title="Asterisk module definitions. " alt="" coords="2171,95,2307,121"/>
<area shape="rect" id="node3" href="../../d8/d20/autoconfig_8h.html" title="asterisk/autoconfig.h" alt="" coords="47,169,202,196"/>
<area shape="rect" id="node5" href="../../de/da3/include_2asterisk_2compat_8h.html" title="General Definitions for Asterisk top level program Included by asterisk.h to handle platform&#45;specific..." alt="" coords="523,617,660,644"/>
<area shape="rect" id="node21" href="../../d8/d8a/astmm_8h.html" title="Asterisk memory management routines. " alt="" coords="277,169,412,196"/>
<area shape="rect" id="node4" href="../../dc/dba/buildopts_8h.html" title="asterisk/buildopts.h" alt="" coords="51,244,198,271"/>
<area shape="rect" id="node6" href="../../d4/dd1/compiler_8h.html" title="Compiler&#45;specific macros and other items. " alt="" coords="1077,767,1220,793"/>
<area shape="rect" id="node28" href="../../d1/d0f/stringfields_8h.html" title="asterisk/stringfields.h" alt="" coords="1826,468,1983,495"/>
<area shape="rect" id="node33" href="../../db/df1/netsock2_8h.html" title="Network socket handling. " alt="" coords="1381,244,1527,271"/>
<area shape="rect" id="node36" href="../../df/d90/linkedlists_8h.html" title="A set of macros to manage forward&#45;linked lists. " alt="" coords="916,617,1067,644"/>
<area shape="rect" id="node37" href="../../d5/d7b/channel_8h.html" title="General Asterisk PBX channel definitions. " alt="" coords="1630,244,1769,271"/>
<area shape="rect" id="node42" href="../../d4/d61/endpoints_8h.html" title="Endpoint abstractions. " alt="" coords="1877,319,2028,345"/>
<area shape="rect" id="node43" href="../../d8/d25/sorcery_8h.html" title="Sorcery Data Access Layer API. " alt="" coords="1741,169,1874,196"/>
<area shape="rect" id="node44" href="../../db/dc4/dnsmgr_8h.html" title="Background DNS update manager. " alt="" coords="1386,169,1522,196"/>
<area shape="rect" id="node45" href="../../d5/da1/udptl_8h.html" title="UDPTL support for T.38. " alt="" coords="1597,169,1717,196"/>
<area shape="rect" id="node46" href="../../d5/dde/rtp__engine_8h.html" title="Pluggable RTP Architecture. " alt="" coords="1205,169,1361,196"/>
<area shape="rect" id="node47" href="../../d9/d4a/stasis__channels_8h.html" title="asterisk/stasis_channels.h" alt="" coords="1949,169,2138,196"/>
<area shape="rect" id="node48" href="../../d7/d44/stasis__endpoints_8h.html" title="Endpoint abstractions. " alt="" coords="1985,244,2179,271"/>
<area shape="rect" id="node49" href="../../d8/d95/stream_8h.html" title="Media Stream API. " alt="" coords="539,393,673,420"/>
<area shape="rect" id="node29" href="../../d5/d9d/inline__api_8h.html" title="Inlinable API function macro. " alt="" coords="1431,767,1578,793"/>
<area shape="rect" id="node31" href="../../dd/d42/lock_8h.html" title="Asterisk locking&#45;related definitions: " alt="" coords="1353,692,1467,719"/>
<area shape="rect" id="node38" href="../../dc/d4d/alertpipe_8h.html" title="asterisk/alertpipe.h" alt="" coords="1506,319,1650,345"/>
<area shape="rect" id="node39" href="../../d5/d60/utils_8h.html" title="Utility functions. " alt="" coords="1525,393,1639,420"/>
<area shape="rect" id="node41" href="../../d5/da5/astobj2_8h.html" title="asterisk/astobj2.h" alt="" coords="1187,543,1321,569"/>
</map>
</div>
</div>
<p><a href="../../d4/d61/res__pjsip__outbound__authenticator__digest_8c_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a88b7c88fed6b80fd18f34f97757dfc04"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d4/d61/res__pjsip__outbound__authenticator__digest_8c.html#a88b7c88fed6b80fd18f34f97757dfc04">__reg_module</a> (void)</td></tr>
<tr class="separator:a88b7c88fed6b80fd18f34f97757dfc04"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:afeab1257bd17282b95875499393a147a"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d4/d61/res__pjsip__outbound__authenticator__digest_8c.html#afeab1257bd17282b95875499393a147a">__unreg_module</a> (void)</td></tr>
<tr class="separator:afeab1257bd17282b95875499393a147a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4fb0aca9bbcdb9709fa52a70aded6cae"><td class="memItemLeft" align="right" valign="top">struct <a class="el" href="../../d9/df5/structast__module.html">ast_module</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d4/d61/res__pjsip__outbound__authenticator__digest_8c.html#a4fb0aca9bbcdb9709fa52a70aded6cae">AST_MODULE_SELF_SYM</a> (void)</td></tr>
<tr class="separator:a4fb0aca9bbcdb9709fa52a70aded6cae"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa0790853094dccbf9799afbdb82076cf"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d4/d61/res__pjsip__outbound__authenticator__digest_8c.html#aa0790853094dccbf9799afbdb82076cf">digest_create_request_with_auth</a> (const struct <a class="el" href="../../d0/dca/structast__sip__auth__vector.html">ast_sip_auth_vector</a> *auth_ids_vector, pjsip_rx_data *<a class="el" href="../../dd/db2/res__pjsip__authenticator__digest_8c.html#ad920f57db5e8c4e82e415be692af48a8">challenge</a>, pjsip_tx_data *old_request, pjsip_tx_data **new_request)</td></tr>
<tr class="separator:aa0790853094dccbf9799afbdb82076cf"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae8dc4017742bf2a2fb4760a197d3ca68"><td class="memItemLeft" align="right" valign="top">static pjsip_hdr_e&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d4/d61/res__pjsip__outbound__authenticator__digest_8c.html#ae8dc4017742bf2a2fb4760a197d3ca68">get_auth_search_type</a> (pjsip_rx_data *<a class="el" href="../../dd/db2/res__pjsip__authenticator__digest_8c.html#ad920f57db5e8c4e82e415be692af48a8">challenge</a>)</td></tr>
<tr class="separator:ae8dc4017742bf2a2fb4760a197d3ca68"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad1b1334fa7d9169d5935b60482e29668"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d4/d61/res__pjsip__outbound__authenticator__digest_8c.html#ad1b1334fa7d9169d5935b60482e29668">is_digest_algorithm_supported</a> (pjsip_www_authenticate_hdr *auth_hdr)</td></tr>
<tr class="separator:ad1b1334fa7d9169d5935b60482e29668"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac3382bf6da54c56b37069bd76bbdf4f9"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d4/d61/res__pjsip__outbound__authenticator__digest_8c.html#ac3382bf6da54c56b37069bd76bbdf4f9">load_module</a> (void)</td></tr>
<tr class="separator:ac3382bf6da54c56b37069bd76bbdf4f9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a926cfa93a67784590ba19d8661ad4318"><td class="memItemLeft" align="right" valign="top">static pj_status_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d4/d61/res__pjsip__outbound__authenticator__digest_8c.html#a926cfa93a67784590ba19d8661ad4318">set_outbound_authentication_credentials</a> (pjsip_auth_clt_sess *auth_sess, const struct ast_sip_auth_objects_vector *auth_objects_vector, pjsip_rx_data *<a class="el" href="../../dd/db2/res__pjsip__authenticator__digest_8c.html#ad920f57db5e8c4e82e415be692af48a8">challenge</a>, struct <a class="el" href="../../dd/da2/structast__str.html">ast_str</a> **realms)</td></tr>
<tr class="separator:a926cfa93a67784590ba19d8661ad4318"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad09fa931f468002152a3cc2d5ce25eae"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d4/d61/res__pjsip__outbound__authenticator__digest_8c.html#ad09fa931f468002152a3cc2d5ce25eae">unload_module</a> (void)</td></tr>
<tr class="separator:ad09fa931f468002152a3cc2d5ce25eae"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="var-members"></a>
Variables</h2></td></tr>
<tr class="memitem:ab22f32016155f7f403e7178767163d7d"><td class="memItemLeft" align="right" valign="top">static struct <a class="el" href="../../dd/d5f/structast__module__info.html">ast_module_info</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d4/d61/res__pjsip__outbound__authenticator__digest_8c.html#ab22f32016155f7f403e7178767163d7d">__mod_info</a> = { .<a class="el" href="../../d1/da4/res__corosync_8c.html#a8f8f80d37794cde9472343e4487ba3eb">name</a> = <a class="el" href="../../da/ddd/named__acl_8c.html#aec23fc5034c3bb08140fc021f4955877">AST_MODULE</a>, .flags = <a class="el" href="../../d5/d16/module_8h.html#a155a0df9c59e04e305d4a2fa3e35f843a12c3f60dd7655dfa8d4430cbf04b1223">AST_MODFLAG_LOAD_ORDER</a> , .description = &quot;PJSIP authentication resource&quot; , .key = &quot;This paragraph is copyright (<a class="el" href="../../d7/d6f/test__linkedlists_8c.html#acd9db00336027462cfb25b97b5356883">c</a>) 2006 by Digium, Inc. \In <a class="el" href="../../d5/d14/voicin_8c.html#aed7ca058008dc3e5ee131e575abed285">order</a> for your module to load, it must return this \key via <a class="el" href="../../d7/d6f/test__linkedlists_8c.html#a13dd15487fee89a002d17ef3aff62d02">a</a> function called \&quot;key\&quot;. Any code which \includes this paragraph must <a class="el" href="../../dd/d7c/eagi__proxy_8c.html#a39730e90126aad69cfc9ca4d6fcdb3a6">be</a> licensed under the GNU \General Public License <a class="el" href="../../da/d7c/utils_2frame_8h.html#a56abfaab87c46691c1ef3ad0df23e864">version</a> 2 or later (at your \option). In addition to Digium's general reservations \of rights, Digium expressly reserves the right to \allow other parties to license this paragraph under \different terms. Any use of Digium, Inc. trademarks or \logos (including \&quot;Asterisk\&quot; or \&quot;Digium\&quot;) without \express written <a class="el" href="../../d4/d4c/structpermission.html">permission</a> of Digium, Inc. is prohibited.\n&quot; , .buildopt_sum = &quot;30ef0c93b36035ec78c9cfd712d36d9b&quot; , .support_level = AST_MODULE_SUPPORT_CORE, .load = load_module, .unload = unload_module, .load_pri = AST_MODPRI_CHANNEL_DEPEND, .requires = &quot;res_pjsip&quot;, }</td></tr>
<tr class="separator:ab22f32016155f7f403e7178767163d7d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad60e83b9aa660040fed4d5377966cc21"><td class="memItemLeft" align="right" valign="top">static const struct <a class="el" href="../../dd/d5f/structast__module__info.html">ast_module_info</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d4/d61/res__pjsip__outbound__authenticator__digest_8c.html#ad60e83b9aa660040fed4d5377966cc21">ast_module_info</a> = &amp;<a class="el" href="../../d6/d7a/test__xml__escape_8c.html#ab22f32016155f7f403e7178767163d7d">__mod_info</a></td></tr>
<tr class="separator:ad60e83b9aa660040fed4d5377966cc21"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3ab4b96a4c484b683a0cf2d0de04d586"><td class="memItemLeft" align="right" valign="top">static struct <a class="el" href="../../d0/dc2/structast__sip__outbound__authenticator.html">ast_sip_outbound_authenticator</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d4/d61/res__pjsip__outbound__authenticator__digest_8c.html#a3ab4b96a4c484b683a0cf2d0de04d586">digest_authenticator</a></td></tr>
<tr class="separator:a3ab4b96a4c484b683a0cf2d0de04d586"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aed62295846b3e79e7140ea74273a901e"><td class="memItemLeft" align="right" valign="top">pj_str_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d4/d61/res__pjsip__outbound__authenticator__digest_8c.html#aed62295846b3e79e7140ea74273a901e">supported_digest_algorithms</a> []</td></tr>
<tr class="separator:aed62295846b3e79e7140ea74273a901e"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<h2 class="groupheader">Function Documentation</h2>
<a id="a88b7c88fed6b80fd18f34f97757dfc04"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a88b7c88fed6b80fd18f34f97757dfc04">&#9670;&nbsp;</a></span>__reg_module()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void __reg_module </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="../../d4/d61/res__pjsip__outbound__authenticator__digest_8c_source.html#l00601">601</a> of file <a class="el" href="../../d4/d61/res__pjsip__outbound__authenticator__digest_8c_source.html">res_pjsip_outbound_authenticator_digest.c</a>.</p>

</div>
</div>
<a id="afeab1257bd17282b95875499393a147a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#afeab1257bd17282b95875499393a147a">&#9670;&nbsp;</a></span>__unreg_module()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void __unreg_module </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="../../d4/d61/res__pjsip__outbound__authenticator__digest_8c_source.html#l00601">601</a> of file <a class="el" href="../../d4/d61/res__pjsip__outbound__authenticator__digest_8c_source.html">res_pjsip_outbound_authenticator_digest.c</a>.</p>

</div>
</div>
<a id="a4fb0aca9bbcdb9709fa52a70aded6cae"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4fb0aca9bbcdb9709fa52a70aded6cae">&#9670;&nbsp;</a></span>AST_MODULE_SELF_SYM()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="../../d9/df5/structast__module.html">ast_module</a>* AST_MODULE_SELF_SYM </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="../../d4/d61/res__pjsip__outbound__authenticator__digest_8c_source.html#l00601">601</a> of file <a class="el" href="../../d4/d61/res__pjsip__outbound__authenticator__digest_8c_source.html">res_pjsip_outbound_authenticator_digest.c</a>.</p>

</div>
</div>
<a id="aa0790853094dccbf9799afbdb82076cf"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa0790853094dccbf9799afbdb82076cf">&#9670;&nbsp;</a></span>digest_create_request_with_auth()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int digest_create_request_with_auth </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="../../d0/dca/structast__sip__auth__vector.html">ast_sip_auth_vector</a> *&#160;</td>
          <td class="paramname"><em>auth_ids_vector</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">pjsip_rx_data *&#160;</td>
          <td class="paramname"><em>challenge</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">pjsip_tx_data *&#160;</td>
          <td class="paramname"><em>old_request</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">pjsip_tx_data **&#160;</td>
          <td class="paramname"><em>new_request</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="../../d4/d61/res__pjsip__outbound__authenticator__digest_8c_source.html#l00410">410</a> of file <a class="el" href="../../d4/d61/res__pjsip__outbound__authenticator__digest_8c_source.html">res_pjsip_outbound_authenticator_digest.c</a>.</p>

<p class="reference">References <a class="el" href="../../d5/da5/astobj2_8h_source.html#l01958">ao2_cleanup</a>, <a class="el" href="../../d8/d8a/astmm_8h_source.html#l00290">ast_alloca</a>, <a class="el" href="../../d5/d60/utils_8h_source.html#l00695">ast_assert</a>, <a class="el" href="../../d8/d8a/astmm_8h_source.html#l00182">ast_free</a>, <a class="el" href="../../da/df7/astobj2_8c_source.html#l00042">ast_log</a>, <a class="el" href="../../d8/d8c/res__pjsip_8h_source.html#l02538">ast_sip_cleanup_auth_objects_vector</a>, <a class="el" href="../../d7/dad/pjsip__distributor_8c_source.html#l00322">ast_sip_dialog_get_endpoint()</a>, <a class="el" href="../../de/d96/res__pjsip_8c_source.html#l03718">ast_sip_get_pjsip_endpoint()</a>, <a class="el" href="../../dc/df6/pjsip__configuration_8c_source.html#l02385">ast_sip_retrieve_auths_vector()</a>, <a class="el" href="../../db/df1/netsock2_8h_source.html#l00046">AST_SOCKADDR_BUFLEN</a>, <a class="el" href="../../d7/d69/sorcery_8c_source.html#l02312">ast_sorcery_object_get_id()</a>, <a class="el" href="../../d6/d90/strings_8h_source.html#l00714">ast_str_buffer()</a>, <a class="el" href="../../d6/d90/strings_8h_source.html#l00620">ast_str_create</a>, <a class="el" href="../../d8/d8a/astmm_8h_source.html#l00300">ast_strdupa</a>, <a class="el" href="../../d6/d68/vector_8h_source.html#l00174">AST_VECTOR_FREE</a>, <a class="el" href="../../d6/d68/vector_8h_source.html#l00113">AST_VECTOR_INIT</a>, <a class="el" href="../../d6/d68/vector_8h_source.html#l00611">AST_VECTOR_SIZE</a>, <a class="el" href="../../d2/d2c/pbx__realtime_8c_source.html#l00124">cleanup()</a>, <a class="el" href="../../d1/d8c/logger_8h_source.html#l00285">LOG_ERROR</a>, <a class="el" href="../../d1/d8c/logger_8h_source.html#l00274">LOG_WARNING</a>, <a class="el" href="../../dc/d7f/resample_8c_source.html#l00096">NULL</a>, <a class="el" href="../../d4/d61/res__pjsip__outbound__authenticator__digest_8c_source.html#l00127">set_outbound_authentication_credentials()</a>, and <a class="el" href="../../de/dcd/app__jack_8c_source.html#l00146">status</a>.</p>
<div class="fragment"><div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;{</div><div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;   pjsip_auth_clt_sess auth_sess;</div><div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;   pjsip_cseq_hdr *cseq;</div><div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;   pj_status_t <a class="code" href="../../de/dcd/app__jack_8c.html#ac191e5810fa65e63095409471eb5648f">status</a>;</div><div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;   <span class="keyword">struct </span>ast_sip_auth_objects_vector auth_objects_vector;</div><div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;   <span class="keywordtype">size_t</span> auth_object_count = 0;</div><div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d3/d46/structast__sip__endpoint.html">ast_sip_endpoint</a> *endpoint;</div><div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;   <span class="keywordtype">char</span> *<span class="keywordtype">id</span> = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;   <span class="keyword">const</span> <span class="keywordtype">char</span> *id_type;</div><div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../dd/da2/structast__str.html">ast_str</a> *realms = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;   pjsip_dialog *dlg;</div><div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;   <span class="keywordtype">int</span> res = -1;</div><div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;</div><div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;   <span class="comment">/*</span></div><div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;<span class="comment">    * Some older compilers have an issue with initializing structures with</span></div><div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;<span class="comment">    * pjsip_auth_clt_sess auth_sess = { 0, };</span></div><div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;<span class="comment">    * so we&#39;ll just do it the old fashioned way.</span></div><div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;<span class="comment">    */</span></div><div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;   memset(&amp;auth_sess, 0, <span class="keyword">sizeof</span>(auth_sess));</div><div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;</div><div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;   dlg = pjsip_rdata_get_dlg(<a class="code" href="../../dd/db2/res__pjsip__authenticator__digest_8c.html#ad920f57db5e8c4e82e415be692af48a8">challenge</a>);</div><div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;   <span class="keywordflow">if</span> (dlg) {</div><div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;      <span class="comment">/* The only thing we use endpoint for is to get an id for error/debug messages */</span></div><div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;      endpoint = <a class="code" href="../../d7/dfa/group__pjsip__threading.html#ga8f70e0cb65924cc6ace6a1a0b64a87ef">ast_sip_dialog_get_endpoint</a>(dlg);</div><div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;      <span class="keywordtype">id</span> = endpoint ? <a class="code" href="../../d8/d8a/astmm_8h.html#ab5f0750cc80ba337fdcbddea2d3a1ee6">ast_strdupa</a>(<a class="code" href="../../d8/d25/sorcery_8h.html#a97706283a06cbb44e4f0f9620dd5cf07">ast_sorcery_object_get_id</a>(endpoint)) : <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;      <a class="code" href="../../d5/da5/astobj2_8h.html#a6321ee982370c55ab3c24c72c562cbdd">ao2_cleanup</a>(endpoint);</div><div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;      id_type = <span class="stringliteral">&quot;Endpoint&quot;</span>;</div><div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;   }</div><div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;</div><div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;   <span class="comment">/* If there was no dialog, then this is probably a REGISTER so no endpoint */</span></div><div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;   <span class="keywordflow">if</span> (!<span class="keywordtype">id</span>) {</div><div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;      <span class="comment">/* The only thing we use the address for is to get an id for error/debug messages */</span></div><div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;      <span class="keywordtype">id</span> = <a class="code" href="../../d8/d8a/astmm_8h.html#a249282ecc7ba5a1a49fa75e9a33d1717">ast_alloca</a>(<a class="code" href="../../db/df1/netsock2_8h.html#aded4d9ff3f772448b4716fd90ed47c8d">AST_SOCKADDR_BUFLEN</a>);</div><div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;      pj_sockaddr_print(&amp;<a class="code" href="../../dd/db2/res__pjsip__authenticator__digest_8c.html#ad920f57db5e8c4e82e415be692af48a8">challenge</a>-&gt;pkt_info.src_addr, <span class="keywordtype">id</span>, <a class="code" href="../../db/df1/netsock2_8h.html#aded4d9ff3f772448b4716fd90ed47c8d">AST_SOCKADDR_BUFLEN</a>, 3);</div><div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;      id_type = <span class="stringliteral">&quot;Host&quot;</span>;</div><div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;   }</div><div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;</div><div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;   <span class="keywordflow">if</span> (!auth_ids_vector || <a class="code" href="../../d6/d68/vector_8h.html#a20b08af81cc9452fb721c9a698f81bdf">AST_VECTOR_SIZE</a>(auth_ids_vector) == 0) {</div><div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;%s: &#39;%s&#39;: There were no auth ids available\n&quot;</span>, id_type, <span class="keywordtype">id</span>);</div><div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;   }</div><div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;</div><div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d6/d68/vector_8h.html#ad9d555fa89da1bfc691181993499f785">AST_VECTOR_INIT</a>(&amp;auth_objects_vector, <a class="code" href="../../d6/d68/vector_8h.html#a20b08af81cc9452fb721c9a698f81bdf">AST_VECTOR_SIZE</a>(auth_ids_vector)) != 0) {</div><div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;%s: &#39;%s&#39;: Couldn&#39;t initialize auth object vector\n&quot;</span>, id_type, <span class="keywordtype">id</span>);</div><div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;   }</div><div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;</div><div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;   <span class="comment">/*</span></div><div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;<span class="comment">    * We don&#39;t really care about ast_sip_retrieve_auths_vector()&#39;s return code</span></div><div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;<span class="comment">    * because we&#39;re checking the count of objects in the vector.</span></div><div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;<span class="comment">    *</span></div><div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;<span class="comment">    * Don&#39;t forget to call</span></div><div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;<span class="comment">    *    ast_sip_cleanup_auth_objects_vector(&amp;auth_objects_vector);</span></div><div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;<span class="comment">    *  AST_VECTOR_FREE(&amp;auth_objects_vector);</span></div><div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;<span class="comment">    * when you&#39;re done with the vector</span></div><div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;<span class="comment">    */</span></div><div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;   <a class="code" href="../../d8/d8c/res__pjsip_8h.html#aa470ba4d30d13a73a7f161fefcbd9ecc">ast_sip_retrieve_auths_vector</a>(auth_ids_vector, &amp;auth_objects_vector);</div><div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;   auth_object_count = <a class="code" href="../../d6/d68/vector_8h.html#a20b08af81cc9452fb721c9a698f81bdf">AST_VECTOR_SIZE</a>(&amp;auth_objects_vector);</div><div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;   <span class="keywordflow">if</span> (auth_object_count == 0) {</div><div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;      <span class="comment">/*</span></div><div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;<span class="comment">       * If none of the auth ids were found, we can&#39;t continue.</span></div><div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;<span class="comment">       * We&#39;re OK if there&#39;s at least one left.</span></div><div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;<span class="comment">       * ast_sip_retrieve_auths_vector() will print a warning for every</span></div><div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;<span class="comment">       * id that wasn&#39;t found.</span></div><div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;<span class="comment">       */</span></div><div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;      res = -1;</div><div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;      <span class="keywordflow">goto</span> <a class="code" href="../../d2/d2c/pbx__realtime_8c.html#a10b51e1931bd03dd172cbfb9d3d67efb">cleanup</a>;</div><div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;   }</div><div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;</div><div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;   <span class="keywordflow">if</span> (pjsip_auth_clt_init(&amp;auth_sess, <a class="code" href="../../d8/d8c/res__pjsip_8h.html#a785afb501e315c8a97ad476fb6a8be1d">ast_sip_get_pjsip_endpoint</a>(),</div><div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;            old_request-&gt;pool, 0) != PJ_SUCCESS) {</div><div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;%s: &#39;%s&#39;: Failed to initialize client authentication session\n&quot;</span>,</div><div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;         id_type, <span class="keywordtype">id</span>);</div><div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;      res = -1;</div><div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;      <span class="keywordflow">goto</span> <a class="code" href="../../d2/d2c/pbx__realtime_8c.html#a10b51e1931bd03dd172cbfb9d3d67efb">cleanup</a>;</div><div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;   }</div><div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;</div><div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;   <span class="comment">/*</span></div><div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;<span class="comment">    * realms is used only for displaying good error messages.</span></div><div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;<span class="comment">    */</span></div><div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;   realms = <a class="code" href="../../d6/d90/strings_8h.html#a9c34c6c6b8daaba24c0406270f3cf697">ast_str_create</a>(32);</div><div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;   <span class="keywordflow">if</span> (!realms) {</div><div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;      res = -1;</div><div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;      <span class="keywordflow">goto</span> <a class="code" href="../../d2/d2c/pbx__realtime_8c.html#a10b51e1931bd03dd172cbfb9d3d67efb">cleanup</a>;</div><div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;   }</div><div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;</div><div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;   <span class="comment">/*</span></div><div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;<span class="comment">    * Load pjproject with the valid credentials for the Authentication headers</span></div><div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;<span class="comment">    * received on the 401 or 407 response.</span></div><div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;<span class="comment">    */</span></div><div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;   status = <a class="code" href="../../d4/d61/res__pjsip__outbound__authenticator__digest_8c.html#a926cfa93a67784590ba19d8661ad4318">set_outbound_authentication_credentials</a>(&amp;auth_sess, &amp;auth_objects_vector, <a class="code" href="../../dd/db2/res__pjsip__authenticator__digest_8c.html#ad920f57db5e8c4e82e415be692af48a8">challenge</a>, &amp;realms);</div><div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;   <span class="keywordflow">switch</span> (status) {</div><div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;   <span class="keywordflow">case</span> PJ_SUCCESS:</div><div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;   <span class="keywordflow">case</span> PJSIP_ENOCREDENTIAL:</div><div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>,</div><div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;         <span class="stringliteral">&quot;%s: &#39;%s&#39;: No auth objects matching realm(s) &#39;%s&#39; from challenge found.\n&quot;</span>, id_type, <span class="keywordtype">id</span>,</div><div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;         realms ? <a class="code" href="../../d6/d90/strings_8h.html#a1ef7e2644ca7258070db316fdc0a465b">ast_str_buffer</a>(realms) : <span class="stringliteral">&quot;&lt;none&gt;&quot;</span>);</div><div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;      res = -1;</div><div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;      <span class="keywordflow">goto</span> <a class="code" href="../../d2/d2c/pbx__realtime_8c.html#a10b51e1931bd03dd172cbfb9d3d67efb">cleanup</a>;</div><div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;   <span class="keywordflow">default</span>:</div><div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;%s: &#39;%s&#39;: Failed to set authentication credentials\n&quot;</span>, id_type, <span class="keywordtype">id</span>);</div><div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;      res = -1;</div><div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;      <span class="keywordflow">goto</span> <a class="code" href="../../d2/d2c/pbx__realtime_8c.html#a10b51e1931bd03dd172cbfb9d3d67efb">cleanup</a>;</div><div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;   }</div><div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;</div><div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;   <span class="comment">/*</span></div><div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;<span class="comment">    * reinit_req actually creates the Authorization headers to send on</span></div><div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;<span class="comment">    * the next request.  If reinit_req already has a cached credential</span></div><div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;<span class="comment">    * from an earlier successful authorization, it&#39;ll use it. Otherwise</span></div><div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;<span class="comment">    * it&#39;ll create a new authorization and cache it.</span></div><div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;<span class="comment">    */</span></div><div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;   status = pjsip_auth_clt_reinit_req(&amp;auth_sess, <a class="code" href="../../dd/db2/res__pjsip__authenticator__digest_8c.html#ad920f57db5e8c4e82e415be692af48a8">challenge</a>, old_request, new_request);</div><div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;</div><div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;   <span class="keywordflow">switch</span> (status) {</div><div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;   <span class="keywordflow">case</span> PJ_SUCCESS:</div><div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;      <span class="comment">/* PJSIP creates a new transaction for new_request (meaning it creates a new</span></div><div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;<span class="comment">       * branch). However, it recycles the Call-ID, from-tag, and CSeq from the</span></div><div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;<span class="comment">       * original request. Some SIP implementations will not process the new request</span></div><div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;<span class="comment">       * since the CSeq is the same as the original request. Incrementing it here</span></div><div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;<span class="comment">       * fixes the interop issue</span></div><div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;<span class="comment">       */</span></div><div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;      cseq = pjsip_msg_find_hdr((*new_request)-&gt;msg, PJSIP_H_CSEQ, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div><div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;      <a class="code" href="../../d5/d60/utils_8h.html#a24374da24af1931d8a7ccde5b352bb2c">ast_assert</a>(cseq != <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div><div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;      ++cseq-&gt;cseq;</div><div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;      res = 0;</div><div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;      <span class="keywordflow">goto</span> <a class="code" href="../../d2/d2c/pbx__realtime_8c.html#a10b51e1931bd03dd172cbfb9d3d67efb">cleanup</a>;</div><div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;   <span class="keywordflow">case</span> PJSIP_ENOCREDENTIAL:</div><div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;      <span class="comment">/*</span></div><div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;<span class="comment">       * This should be rare since set_outbound_authentication_credentials()</span></div><div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;<span class="comment">       * did the matching but you never know.</span></div><div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;<span class="comment">       */</span></div><div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>,</div><div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;         <span class="stringliteral">&quot;%s: &#39;%s&#39;: No auth objects matching realm(s) &#39;%s&#39; from challenge found.\n&quot;</span>, id_type, <span class="keywordtype">id</span>,</div><div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;         realms ? <a class="code" href="../../d6/d90/strings_8h.html#a1ef7e2644ca7258070db316fdc0a465b">ast_str_buffer</a>(realms) : <span class="stringliteral">&quot;&lt;none&gt;&quot;</span>);</div><div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;   <span class="keywordflow">case</span> PJSIP_EAUTHSTALECOUNT:</div><div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>,</div><div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;         <span class="stringliteral">&quot;%s: &#39;%s&#39;: Unable to create request with auth.  Number of stale retries exceeded.\n&quot;</span>,</div><div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;         id_type, <span class="keywordtype">id</span>);</div><div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;   <span class="keywordflow">case</span> PJSIP_EFAILEDCREDENTIAL:</div><div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;%s: &#39;%s&#39;: Authentication credentials not accepted by server.\n&quot;</span>,</div><div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;         id_type, <span class="keywordtype">id</span>);</div><div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;   <span class="keywordflow">default</span>:</div><div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;%s: &#39;%s&#39;: Unable to create request with auth. Unknown failure.\n&quot;</span>,</div><div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;         id_type, <span class="keywordtype">id</span>);</div><div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;   }</div><div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;   res = -1;</div><div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;</div><div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;<a class="code" href="../../d2/d2c/pbx__realtime_8c.html#a10b51e1931bd03dd172cbfb9d3d67efb">cleanup</a>:</div><div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;<span class="preprocessor">#if defined(HAVE_PJSIP_AUTH_CLT_DEINIT)</span></div><div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;   <span class="comment">/* Release any cached auths */</span></div><div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;   pjsip_auth_clt_deinit(&amp;auth_sess);</div><div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;</div><div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;   <a class="code" href="../../d8/d8c/res__pjsip_8h.html#a9a1e39bb4db68bc2768dc43cc3d38149">ast_sip_cleanup_auth_objects_vector</a>(&amp;auth_objects_vector);</div><div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;   <a class="code" href="../../d6/d68/vector_8h.html#a66aaa4efda59c52384b03c38e781124d">AST_VECTOR_FREE</a>(&amp;auth_objects_vector);</div><div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;   <a class="code" href="../../d8/d8a/astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(realms);</div><div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;</div><div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;   <span class="keywordflow">return</span> res;</div><div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;}</div><div class="ttc" id="vector_8h_html_a66aaa4efda59c52384b03c38e781124d"><div class="ttname"><a href="../../d6/d68/vector_8h.html#a66aaa4efda59c52384b03c38e781124d">AST_VECTOR_FREE</a></div><div class="ttdeci">#define AST_VECTOR_FREE(vec)</div><div class="ttdoc">Deallocates this vector. </div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d68/vector_8h_source.html#l00174">vector.h:174</a></div></div>
<div class="ttc" id="netsock2_8h_html_aded4d9ff3f772448b4716fd90ed47c8d"><div class="ttname"><a href="../../db/df1/netsock2_8h.html#aded4d9ff3f772448b4716fd90ed47c8d">AST_SOCKADDR_BUFLEN</a></div><div class="ttdeci">#define AST_SOCKADDR_BUFLEN</div><div class="ttdef"><b>Definition:</b> <a href="../../db/df1/netsock2_8h_source.html#l00046">netsock2.h:46</a></div></div>
<div class="ttc" id="logger_8h_html_adf4476a6a4ea6c74231c826e899d7189"><div class="ttname"><a href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a></div><div class="ttdeci">#define LOG_WARNING</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d8c/logger_8h_source.html#l00274">logger.h:274</a></div></div>
<div class="ttc" id="strings_8h_html_a1ef7e2644ca7258070db316fdc0a465b"><div class="ttname"><a href="../../d6/d90/strings_8h.html#a1ef7e2644ca7258070db316fdc0a465b">ast_str_buffer</a></div><div class="ttdeci">char * ast_str_buffer(const struct ast_str *buf)</div><div class="ttdoc">Returns the string buffer within the ast_str buf. </div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d90/strings_8h_source.html#l00714">strings.h:714</a></div></div>
<div class="ttc" id="utils_8h_html_a24374da24af1931d8a7ccde5b352bb2c"><div class="ttname"><a href="../../d5/d60/utils_8h.html#a24374da24af1931d8a7ccde5b352bb2c">ast_assert</a></div><div class="ttdeci">#define ast_assert(a)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d60/utils_8h_source.html#l00695">utils.h:695</a></div></div>
<div class="ttc" id="resample_8c_html_a070d2ce7b6bb7e5c05602aa8c308d0c4"><div class="ttname"><a href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a></div><div class="ttdeci">#define NULL</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d7f/resample_8c_source.html#l00096">resample.c:96</a></div></div>
<div class="ttc" id="astobj2_8c_html_a96a00b3a518d7f32b6d51dc28f09bf9b"><div class="ttname"><a href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a></div><div class="ttdeci">#define ast_log</div><div class="ttdef"><b>Definition:</b> <a href="../../da/df7/astobj2_8c_source.html#l00042">astobj2.c:42</a></div></div>
<div class="ttc" id="vector_8h_html_ad9d555fa89da1bfc691181993499f785"><div class="ttname"><a href="../../d6/d68/vector_8h.html#ad9d555fa89da1bfc691181993499f785">AST_VECTOR_INIT</a></div><div class="ttdeci">#define AST_VECTOR_INIT(vec, size)</div><div class="ttdoc">Initialize a vector. </div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d68/vector_8h_source.html#l00113">vector.h:113</a></div></div>
<div class="ttc" id="group__pjsip__threading_html_ga8f70e0cb65924cc6ace6a1a0b64a87ef"><div class="ttname"><a href="../../d7/dfa/group__pjsip__threading.html#ga8f70e0cb65924cc6ace6a1a0b64a87ef">ast_sip_dialog_get_endpoint</a></div><div class="ttdeci">struct ast_sip_endpoint * ast_sip_dialog_get_endpoint(pjsip_dialog *dlg)</div><div class="ttdoc">Get the endpoint associated with this dialog. </div><div class="ttdef"><b>Definition:</b> <a href="../../d7/dad/pjsip__distributor_8c_source.html#l00322">pjsip_distributor.c:322</a></div></div>
<div class="ttc" id="astmm_8h_html_ab5f0750cc80ba337fdcbddea2d3a1ee6"><div class="ttname"><a href="../../d8/d8a/astmm_8h.html#ab5f0750cc80ba337fdcbddea2d3a1ee6">ast_strdupa</a></div><div class="ttdeci">#define ast_strdupa(s)</div><div class="ttdoc">duplicate a string in memory from the stack </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d8a/astmm_8h_source.html#l00300">astmm.h:300</a></div></div>
<div class="ttc" id="sorcery_8h_html_a97706283a06cbb44e4f0f9620dd5cf07"><div class="ttname"><a href="../../d8/d25/sorcery_8h.html#a97706283a06cbb44e4f0f9620dd5cf07">ast_sorcery_object_get_id</a></div><div class="ttdeci">const char * ast_sorcery_object_get_id(const void *object)</div><div class="ttdoc">Get the unique identifier of a sorcery object. </div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d69/sorcery_8c_source.html#l02312">sorcery.c:2312</a></div></div>
<div class="ttc" id="res__pjsip__authenticator__digest_8c_html_ad920f57db5e8c4e82e415be692af48a8"><div class="ttname"><a href="../../dd/db2/res__pjsip__authenticator__digest_8c.html#ad920f57db5e8c4e82e415be692af48a8">challenge</a></div><div class="ttdeci">static void challenge(const char *realm, pjsip_tx_data *tdata, const pjsip_rx_data *rdata, int is_stale)</div><div class="ttdoc">astobj2 callback for adding digest challenges to responses </div><div class="ttdef"><b>Definition:</b> <a href="../../dd/db2/res__pjsip__authenticator__digest_8c_source.html#l00377">res_pjsip_authenticator_digest.c:377</a></div></div>
<div class="ttc" id="structast__sip__endpoint_html"><div class="ttname"><a href="../../d3/d46/structast__sip__endpoint.html">ast_sip_endpoint</a></div><div class="ttdoc">An entity with which Asterisk communicates. </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d8c/res__pjsip_8h_source.html#l00812">res_pjsip.h:812</a></div></div>
<div class="ttc" id="astmm_8h_html_a249282ecc7ba5a1a49fa75e9a33d1717"><div class="ttname"><a href="../../d8/d8a/astmm_8h.html#a249282ecc7ba5a1a49fa75e9a33d1717">ast_alloca</a></div><div class="ttdeci">#define ast_alloca(size)</div><div class="ttdoc">call __builtin_alloca to ensure we get gcc builtin semantics </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d8a/astmm_8h_source.html#l00290">astmm.h:290</a></div></div>
<div class="ttc" id="logger_8h_html_aced66975c154ea0e2a8ec3bc818b4e08"><div class="ttname"><a href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a></div><div class="ttdeci">#define LOG_ERROR</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d8c/logger_8h_source.html#l00285">logger.h:285</a></div></div>
<div class="ttc" id="structast__str_html"><div class="ttname"><a href="../../dd/da2/structast__str.html">ast_str</a></div><div class="ttdoc">The descriptor of a dynamic string XXX storage will be optimized later if needed We use the ts field ...</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d90/strings_8h_source.html#l00584">strings.h:584</a></div></div>
<div class="ttc" id="astmm_8h_html_a402072d6789f6ed9e3a81da27504127e"><div class="ttname"><a href="../../d8/d8a/astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a></div><div class="ttdeci">#define ast_free(a)</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d8a/astmm_8h_source.html#l00182">astmm.h:182</a></div></div>
<div class="ttc" id="res__pjsip__outbound__authenticator__digest_8c_html_a926cfa93a67784590ba19d8661ad4318"><div class="ttname"><a href="../../d4/d61/res__pjsip__outbound__authenticator__digest_8c.html#a926cfa93a67784590ba19d8661ad4318">set_outbound_authentication_credentials</a></div><div class="ttdeci">static pj_status_t set_outbound_authentication_credentials(pjsip_auth_clt_sess *auth_sess, const struct ast_sip_auth_objects_vector *auth_objects_vector, pjsip_rx_data *challenge, struct ast_str **realms)</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d61/res__pjsip__outbound__authenticator__digest_8c_source.html#l00127">res_pjsip_outbound_authenticator_digest.c:127</a></div></div>
<div class="ttc" id="pbx__realtime_8c_html_a10b51e1931bd03dd172cbfb9d3d67efb"><div class="ttname"><a href="../../d2/d2c/pbx__realtime_8c.html#a10b51e1931bd03dd172cbfb9d3d67efb">cleanup</a></div><div class="ttdeci">static void * cleanup(void *unused)</div><div class="ttdef"><b>Definition:</b> <a href="../../d2/d2c/pbx__realtime_8c_source.html#l00124">pbx_realtime.c:124</a></div></div>
<div class="ttc" id="res__pjsip_8h_html_a785afb501e315c8a97ad476fb6a8be1d"><div class="ttname"><a href="../../d8/d8c/res__pjsip_8h.html#a785afb501e315c8a97ad476fb6a8be1d">ast_sip_get_pjsip_endpoint</a></div><div class="ttdeci">pjsip_endpoint * ast_sip_get_pjsip_endpoint(void)</div><div class="ttdoc">Get a pointer to the PJSIP endpoint. </div><div class="ttdef"><b>Definition:</b> <a href="../../de/d96/res__pjsip_8c_source.html#l03718">res_pjsip.c:3718</a></div></div>
<div class="ttc" id="astobj2_8h_html_a6321ee982370c55ab3c24c72c562cbdd"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#a6321ee982370c55ab3c24c72c562cbdd">ao2_cleanup</a></div><div class="ttdeci">#define ao2_cleanup(obj)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l01958">astobj2.h:1958</a></div></div>
<div class="ttc" id="res__pjsip_8h_html_aa470ba4d30d13a73a7f161fefcbd9ecc"><div class="ttname"><a href="../../d8/d8c/res__pjsip_8h.html#aa470ba4d30d13a73a7f161fefcbd9ecc">ast_sip_retrieve_auths_vector</a></div><div class="ttdeci">int ast_sip_retrieve_auths_vector(const struct ast_sip_auth_vector *auth_ids, struct ast_sip_auth_objects_vector *auth_objects)</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/df6/pjsip__configuration_8c_source.html#l02385">pjsip_configuration.c:2385</a></div></div>
<div class="ttc" id="res__pjsip_8h_html_a9a1e39bb4db68bc2768dc43cc3d38149"><div class="ttname"><a href="../../d8/d8c/res__pjsip_8h.html#a9a1e39bb4db68bc2768dc43cc3d38149">ast_sip_cleanup_auth_objects_vector</a></div><div class="ttdeci">#define ast_sip_cleanup_auth_objects_vector(auth_objects)</div><div class="ttdoc">Clean up retrieved auth objects in vector. </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d8c/res__pjsip_8h_source.html#l02538">res_pjsip.h:2538</a></div></div>
<div class="ttc" id="vector_8h_html_a20b08af81cc9452fb721c9a698f81bdf"><div class="ttname"><a href="../../d6/d68/vector_8h.html#a20b08af81cc9452fb721c9a698f81bdf">AST_VECTOR_SIZE</a></div><div class="ttdeci">#define AST_VECTOR_SIZE(vec)</div><div class="ttdoc">Get the number of elements in a vector. </div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d68/vector_8h_source.html#l00611">vector.h:611</a></div></div>
<div class="ttc" id="app__jack_8c_html_ac191e5810fa65e63095409471eb5648f"><div class="ttname"><a href="../../de/dcd/app__jack_8c.html#ac191e5810fa65e63095409471eb5648f">status</a></div><div class="ttdeci">jack_status_t status</div><div class="ttdef"><b>Definition:</b> <a href="../../de/dcd/app__jack_8c_source.html#l00146">app_jack.c:146</a></div></div>
<div class="ttc" id="strings_8h_html_a9c34c6c6b8daaba24c0406270f3cf697"><div class="ttname"><a href="../../d6/d90/strings_8h.html#a9c34c6c6b8daaba24c0406270f3cf697">ast_str_create</a></div><div class="ttdeci">#define ast_str_create(init_len)</div><div class="ttdoc">Create a malloc&amp;#39;ed dynamic length string. </div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d90/strings_8h_source.html#l00620">strings.h:620</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="ae8dc4017742bf2a2fb4760a197d3ca68"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae8dc4017742bf2a2fb4760a197d3ca68">&#9670;&nbsp;</a></span>get_auth_search_type()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static pjsip_hdr_e get_auth_search_type </td>
          <td>(</td>
          <td class="paramtype">pjsip_rx_data *&#160;</td>
          <td class="paramname"><em>challenge</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="../../d4/d61/res__pjsip__outbound__authenticator__digest_8c_source.html#l00046">46</a> of file <a class="el" href="../../d4/d61/res__pjsip__outbound__authenticator__digest_8c_source.html">res_pjsip_outbound_authenticator_digest.c</a>.</p>

<p class="reference">References <a class="el" href="../../da/df7/astobj2_8c_source.html#l00042">ast_log</a>, and <a class="el" href="../../d1/d8c/logger_8h_source.html#l00285">LOG_ERROR</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../d4/d61/res__pjsip__outbound__authenticator__digest_8c_source.html#l00127">set_outbound_authentication_credentials()</a>.</p>
<div class="fragment"><div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;{</div><div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../dd/db2/res__pjsip__authenticator__digest_8c.html#ad920f57db5e8c4e82e415be692af48a8">challenge</a>-&gt;msg_info.msg-&gt;line.status.code == PJSIP_SC_UNAUTHORIZED) {</div><div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;      <span class="keywordflow">return</span> PJSIP_H_WWW_AUTHENTICATE;</div><div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;   } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="../../dd/db2/res__pjsip__authenticator__digest_8c.html#ad920f57db5e8c4e82e415be692af48a8">challenge</a>-&gt;msg_info.msg-&gt;line.status.code == PJSIP_SC_PROXY_AUTHENTICATION_REQUIRED) {</div><div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;      <span class="keywordflow">return</span> PJSIP_H_PROXY_AUTHENTICATE;</div><div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;   } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>,</div><div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;            <span class="stringliteral">&quot;Status code %d was received when it should have been 401 or 407.\n&quot;</span>,</div><div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;            <a class="code" href="../../dd/db2/res__pjsip__authenticator__digest_8c.html#ad920f57db5e8c4e82e415be692af48a8">challenge</a>-&gt;msg_info.msg-&gt;line.status.code);</div><div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;      <span class="keywordflow">return</span> PJSIP_H_OTHER;</div><div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;   }</div><div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;}</div><div class="ttc" id="astobj2_8c_html_a96a00b3a518d7f32b6d51dc28f09bf9b"><div class="ttname"><a href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a></div><div class="ttdeci">#define ast_log</div><div class="ttdef"><b>Definition:</b> <a href="../../da/df7/astobj2_8c_source.html#l00042">astobj2.c:42</a></div></div>
<div class="ttc" id="res__pjsip__authenticator__digest_8c_html_ad920f57db5e8c4e82e415be692af48a8"><div class="ttname"><a href="../../dd/db2/res__pjsip__authenticator__digest_8c.html#ad920f57db5e8c4e82e415be692af48a8">challenge</a></div><div class="ttdeci">static void challenge(const char *realm, pjsip_tx_data *tdata, const pjsip_rx_data *rdata, int is_stale)</div><div class="ttdoc">astobj2 callback for adding digest challenges to responses </div><div class="ttdef"><b>Definition:</b> <a href="../../dd/db2/res__pjsip__authenticator__digest_8c_source.html#l00377">res_pjsip_authenticator_digest.c:377</a></div></div>
<div class="ttc" id="logger_8h_html_aced66975c154ea0e2a8ec3bc818b4e08"><div class="ttname"><a href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a></div><div class="ttdeci">#define LOG_ERROR</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d8c/logger_8h_source.html#l00285">logger.h:285</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="ad1b1334fa7d9169d5935b60482e29668"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad1b1334fa7d9169d5935b60482e29668">&#9670;&nbsp;</a></span>is_digest_algorithm_supported()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int is_digest_algorithm_supported </td>
          <td>(</td>
          <td class="paramtype">pjsip_www_authenticate_hdr *&#160;</td>
          <td class="paramname"><em>auth_hdr</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="../../d4/d61/res__pjsip__outbound__authenticator__digest_8c_source.html#l00068">68</a> of file <a class="el" href="../../d4/d61/res__pjsip__outbound__authenticator__digest_8c_source.html">res_pjsip_outbound_authenticator_digest.c</a>.</p>

<p class="reference">References <a class="el" href="../../de/dfe/isdn__lib_8c_source.html#l00042">ARRAY_LEN</a>, and <a class="el" href="../../d4/d61/res__pjsip__outbound__authenticator__digest_8c_source.html#l00035">supported_digest_algorithms</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../d4/d61/res__pjsip__outbound__authenticator__digest_8c_source.html#l00127">set_outbound_authentication_credentials()</a>.</p>
<div class="fragment"><div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;{</div><div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;   <span class="keywordtype">int</span> digest;</div><div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;</div><div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;   <span class="comment">/* An empty digest is assumed to be md5 */</span></div><div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;   <span class="keywordflow">if</span> (pj_strlen(&amp;auth_hdr-&gt;challenge.digest.algorithm) == 0) {</div><div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;      <span class="keywordflow">return</span> 1;</div><div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;   }</div><div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;</div><div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;   <span class="keywordflow">for</span> (digest = 0; digest &lt; <a class="code" href="../../de/dfe/isdn__lib_8c.html#ab9129b977a587b50ea801daac75e178f">ARRAY_LEN</a>(<a class="code" href="../../d4/d61/res__pjsip__outbound__authenticator__digest_8c.html#aed62295846b3e79e7140ea74273a901e">supported_digest_algorithms</a>); digest++) {</div><div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;      <span class="keywordflow">if</span> (pj_stricmp(&amp;auth_hdr-&gt;challenge.digest.algorithm, &amp;<a class="code" href="../../d4/d61/res__pjsip__outbound__authenticator__digest_8c.html#aed62295846b3e79e7140ea74273a901e">supported_digest_algorithms</a>[digest]) == 0) {</div><div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;         <span class="keywordflow">return</span> 1;</div><div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;      }</div><div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;   }</div><div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;   <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;}</div><div class="ttc" id="isdn__lib_8c_html_ab9129b977a587b50ea801daac75e178f"><div class="ttname"><a href="../../de/dfe/isdn__lib_8c.html#ab9129b977a587b50ea801daac75e178f">ARRAY_LEN</a></div><div class="ttdeci">#define ARRAY_LEN(a)</div><div class="ttdef"><b>Definition:</b> <a href="../../de/dfe/isdn__lib_8c_source.html#l00042">isdn_lib.c:42</a></div></div>
<div class="ttc" id="res__pjsip__outbound__authenticator__digest_8c_html_aed62295846b3e79e7140ea74273a901e"><div class="ttname"><a href="../../d4/d61/res__pjsip__outbound__authenticator__digest_8c.html#aed62295846b3e79e7140ea74273a901e">supported_digest_algorithms</a></div><div class="ttdeci">pj_str_t supported_digest_algorithms[]</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d61/res__pjsip__outbound__authenticator__digest_8c_source.html#l00035">res_pjsip_outbound_authenticator_digest.c:35</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="ac3382bf6da54c56b37069bd76bbdf4f9"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac3382bf6da54c56b37069bd76bbdf4f9">&#9670;&nbsp;</a></span>load_module()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int load_module </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="../../d4/d61/res__pjsip__outbound__authenticator__digest_8c_source.html#l00581">581</a> of file <a class="el" href="../../d4/d61/res__pjsip__outbound__authenticator__digest_8c_source.html">res_pjsip_outbound_authenticator_digest.c</a>.</p>

<p class="reference">References <a class="el" href="../../d5/d16/module_8h_source.html#l00078">AST_MODULE_LOAD_DECLINE</a>, <a class="el" href="../../d5/d16/module_8h_source.html#l00070">AST_MODULE_LOAD_SUCCESS</a>, and <a class="el" href="../../de/d96/res__pjsip_8c_source.html#l03389">ast_sip_register_outbound_authenticator()</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../d4/d61/res__pjsip__outbound__authenticator__digest_8c_source.html#l00589">unload_module()</a>.</p>
<div class="fragment"><div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;{</div><div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d8/d8c/res__pjsip_8h.html#a98307b232bed0aa477edfdb1cb2d6ee4">ast_sip_register_outbound_authenticator</a>(&amp;<a class="code" href="../../d4/d61/res__pjsip__outbound__authenticator__digest_8c.html#a3ab4b96a4c484b683a0cf2d0de04d586">digest_authenticator</a>)) {</div><div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../d5/d16/module_8h.html#adc09474f0ff557e9925b722ee5b952dfac742921e9f9512d28f62c74ea2affe57">AST_MODULE_LOAD_DECLINE</a>;</div><div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;   }</div><div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;   <span class="keywordflow">return</span> <a class="code" href="../../d5/d16/module_8h.html#adc09474f0ff557e9925b722ee5b952dfa89bb877ade9ce418ad6663f3d936f314">AST_MODULE_LOAD_SUCCESS</a>;</div><div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;}</div><div class="ttc" id="res__pjsip_8h_html_a98307b232bed0aa477edfdb1cb2d6ee4"><div class="ttname"><a href="../../d8/d8c/res__pjsip_8h.html#a98307b232bed0aa477edfdb1cb2d6ee4">ast_sip_register_outbound_authenticator</a></div><div class="ttdeci">int ast_sip_register_outbound_authenticator(struct ast_sip_outbound_authenticator *outbound_auth)</div><div class="ttdoc">Register an outbound SIP authenticator. </div><div class="ttdef"><b>Definition:</b> <a href="../../de/d96/res__pjsip_8c_source.html#l03389">res_pjsip.c:3389</a></div></div>
<div class="ttc" id="module_8h_html_adc09474f0ff557e9925b722ee5b952dfa89bb877ade9ce418ad6663f3d936f314"><div class="ttname"><a href="../../d5/d16/module_8h.html#adc09474f0ff557e9925b722ee5b952dfa89bb877ade9ce418ad6663f3d936f314">AST_MODULE_LOAD_SUCCESS</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d16/module_8h_source.html#l00070">module.h:70</a></div></div>
<div class="ttc" id="module_8h_html_adc09474f0ff557e9925b722ee5b952dfac742921e9f9512d28f62c74ea2affe57"><div class="ttname"><a href="../../d5/d16/module_8h.html#adc09474f0ff557e9925b722ee5b952dfac742921e9f9512d28f62c74ea2affe57">AST_MODULE_LOAD_DECLINE</a></div><div class="ttdoc">Module has failed to load, may be in an inconsistent state. </div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d16/module_8h_source.html#l00078">module.h:78</a></div></div>
<div class="ttc" id="res__pjsip__outbound__authenticator__digest_8c_html_a3ab4b96a4c484b683a0cf2d0de04d586"><div class="ttname"><a href="../../d4/d61/res__pjsip__outbound__authenticator__digest_8c.html#a3ab4b96a4c484b683a0cf2d0de04d586">digest_authenticator</a></div><div class="ttdeci">static struct ast_sip_outbound_authenticator digest_authenticator</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d61/res__pjsip__outbound__authenticator__digest_8c_source.html#l00577">res_pjsip_outbound_authenticator_digest.c:577</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a926cfa93a67784590ba19d8661ad4318"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a926cfa93a67784590ba19d8661ad4318">&#9670;&nbsp;</a></span>set_outbound_authentication_credentials()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static pj_status_t set_outbound_authentication_credentials </td>
          <td>(</td>
          <td class="paramtype">pjsip_auth_clt_sess *&#160;</td>
          <td class="paramname"><em>auth_sess</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const struct ast_sip_auth_objects_vector *&#160;</td>
          <td class="paramname"><em>auth_objects_vector</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">pjsip_rx_data *&#160;</td>
          <td class="paramname"><em>challenge</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="../../dd/da2/structast__str.html">ast_str</a> **&#160;</td>
          <td class="paramname"><em>realms</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="../../d4/d61/res__pjsip__outbound__authenticator__digest_8c_source.html#l00127">127</a> of file <a class="el" href="../../d4/d61/res__pjsip__outbound__authenticator__digest_8c_source.html">res_pjsip_outbound_authenticator_digest.c</a>.</p>

<p class="reference">References <a class="el" href="../../d1/d8c/logger_8h_source.html#l00452">ast_debug</a>, <a class="el" href="../../d8/d8a/astmm_8h_source.html#l00182">ast_free</a>, <a class="el" href="../../da/df7/astobj2_8c_source.html#l00042">ast_log</a>, <a class="el" href="../../d8/d8c/res__pjsip_8h_source.html#l00439">AST_SIP_AUTH_TYPE_ARTIFICIAL</a>, <a class="el" href="../../d8/d8c/res__pjsip_8h_source.html#l00437">AST_SIP_AUTH_TYPE_GOOGLE_OAUTH</a>, <a class="el" href="../../d8/d8c/res__pjsip_8h_source.html#l00435">AST_SIP_AUTH_TYPE_MD5</a>, <a class="el" href="../../d8/d8c/res__pjsip_8h_source.html#l00433">AST_SIP_AUTH_TYPE_USER_PASS</a>, <a class="el" href="../../d7/d69/sorcery_8c_source.html#l02312">ast_sorcery_object_get_id()</a>, <a class="el" href="../../d6/d90/strings_8h_source.html#l01091">ast_str_append()</a>, <a class="el" href="../../d6/d90/strings_8h_source.html#l00688">ast_str_strlen()</a>, <a class="el" href="../../d6/d90/strings_8h_source.html#l00738">ast_str_truncate()</a>, <a class="el" href="../../d2/d48/strings_8c_source.html#l00239">ast_strings_equal()</a>, <a class="el" href="../../d6/d90/strings_8h_source.html#l00052">ast_strlen_zero</a>, <a class="el" href="../../d6/d68/vector_8h_source.html#l00044">AST_VECTOR</a>, <a class="el" href="../../d6/d68/vector_8h_source.html#l00256">AST_VECTOR_APPEND</a>, <a class="el" href="../../d6/d68/vector_8h_source.html#l00174">AST_VECTOR_FREE</a>, <a class="el" href="../../d6/d68/vector_8h_source.html#l00682">AST_VECTOR_GET</a>, <a class="el" href="../../d6/d68/vector_8h_source.html#l00113">AST_VECTOR_INIT</a>, <a class="el" href="../../d6/d68/vector_8h_source.html#l00611">AST_VECTOR_SIZE</a>, <a class="el" href="../../d6/d68/vector_8h_source.html#l00140">AST_VECTOR_STEAL_ELEMENTS</a>, <a class="el" href="../../d8/d8c/res__pjsip_8h_source.html#l00452">ast_sip_auth::auth_pass</a>, <a class="el" href="../../d8/d8c/res__pjsip_8h_source.html#l00450">ast_sip_auth::auth_user</a>, <a class="el" href="../../d2/d2c/pbx__realtime_8c_source.html#l00124">cleanup()</a>, <a class="el" href="../../d4/d61/res__pjsip__outbound__authenticator__digest_8c_source.html#l00046">get_auth_search_type()</a>, <a class="el" href="../../d4/d61/res__pjsip__outbound__authenticator__digest_8c_source.html#l00068">is_digest_algorithm_supported()</a>, <a class="el" href="../../d1/d8c/logger_8h_source.html#l00285">LOG_ERROR</a>, <a class="el" href="../../d8/d8c/res__pjsip_8h_source.html#l00454">ast_sip_auth::md5_creds</a>, <a class="el" href="../../dc/d7f/resample_8c_source.html#l00096">NULL</a>, <a class="el" href="../../d8/d8c/res__pjsip_8h_source.html#l00448">ast_sip_auth::realm</a>, and <a class="el" href="../../d8/d8c/res__pjsip_8h_source.html#l00464">ast_sip_auth::type</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../d4/d61/res__pjsip__outbound__authenticator__digest_8c_source.html#l00410">digest_create_request_with_auth()</a>.</p>
<div class="fragment"><div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;{</div><div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;   <span class="keywordtype">int</span> i;</div><div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;   <span class="keywordtype">size_t</span> auth_object_count;</div><div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;   pjsip_www_authenticate_hdr *auth_hdr = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;   pj_status_t res = PJ_SUCCESS;</div><div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;   pjsip_hdr_e search_type;</div><div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;   <span class="keywordtype">size_t</span> cred_count;</div><div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;   pjsip_cred_info *creds_array;</div><div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;</div><div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;   <span class="comment">/*</span></div><div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;<span class="comment">    * Normally vector elements are pointers to something else, usually</span></div><div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;<span class="comment">    * structures. In this case however, the elements are the</span></div><div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;<span class="comment">    * structures themselves instead of pointers to them.  This is due</span></div><div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;<span class="comment">    * to the fact that pjsip_auth_clt_set_credentials() expects an</span></div><div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;<span class="comment">    * array of structues, not an array of pointers to structures.</span></div><div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;<span class="comment">    * Thankfully, vectors allow you to &quot;steal&quot; their underlying</span></div><div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;<span class="comment">    * arrays, in this case an array of pjsip_cred_info structures,</span></div><div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;<span class="comment">    * which we&#39;ll pass to pjsip_auth_clt_set_credentials() at the</span></div><div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;<span class="comment">    * end.</span></div><div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;<span class="comment">    */</span></div><div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;   <a class="code" href="../../d6/d68/vector_8h.html#aecf5cf511c06438b264c501224d13d89">AST_VECTOR</a>(cred_info, pjsip_cred_info) auth_creds;</div><div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;</div><div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;   search_type = <a class="code" href="../../d4/d61/res__pjsip__outbound__authenticator__digest_8c.html#ae8dc4017742bf2a2fb4760a197d3ca68">get_auth_search_type</a>(<a class="code" href="../../dd/db2/res__pjsip__authenticator__digest_8c.html#ad920f57db5e8c4e82e415be692af48a8">challenge</a>);</div><div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;   <span class="keywordflow">if</span> (search_type == PJSIP_H_OTHER) {</div><div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;      <span class="comment">/*</span></div><div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;<span class="comment">       * The status code on the response wasn&#39;t 401 or 407</span></div><div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;<span class="comment">       * so there are no WWW-Authenticate or Proxy-Authenticate</span></div><div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;<span class="comment">       * headers to process.</span></div><div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;<span class="comment">       */</span></div><div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;      <span class="keywordflow">return</span> PJ_ENOTSUP;</div><div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;   }</div><div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;</div><div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;   auth_object_count = <a class="code" href="../../d6/d68/vector_8h.html#a20b08af81cc9452fb721c9a698f81bdf">AST_VECTOR_SIZE</a>(auth_objects_vector);</div><div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;   <span class="keywordflow">if</span> (auth_object_count == 0) {</div><div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;      <span class="comment">/* This shouldn&#39;t happen but we&#39;ll check anyway. */</span></div><div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;      <span class="keywordflow">return</span> PJ_EINVAL;</div><div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;   }</div><div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;</div><div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;   <span class="comment">/*</span></div><div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;<span class="comment">    * The number of pjsip_cred_infos we send to pjproject can</span></div><div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;<span class="comment">    * vary based on the number of acceptable headers received</span></div><div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;<span class="comment">    * and the number of acceptable auth objects on the endpoint</span></div><div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;<span class="comment">    * so we just use a vector to accumulate them.</span></div><div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;<span class="comment">    *</span></div><div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;<span class="comment">    * NOTE: You have to call AST_VECTOR_FREE() on the vector</span></div><div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;<span class="comment">    * but you don&#39;t have to free the elements because they&#39;re</span></div><div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;<span class="comment">    * actual structures, not pointers to structures.</span></div><div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;<span class="comment">    */</span></div><div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d6/d68/vector_8h.html#ad9d555fa89da1bfc691181993499f785">AST_VECTOR_INIT</a>(&amp;auth_creds, 5) != 0) {</div><div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;      <span class="keywordflow">return</span> PJ_ENOMEM;</div><div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;   }</div><div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;</div><div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;   <span class="comment">/*</span></div><div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;<span class="comment">    * It&#39;s going to be rare that we actually have more than one</span></div><div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;<span class="comment">    * WWW-Authentication header or more than one auth object to</span></div><div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;<span class="comment">    * match to it so the following nested loop should be fine.</span></div><div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;<span class="comment">    */</span></div><div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;   <span class="keywordflow">while</span> ((auth_hdr = pjsip_msg_find_hdr(<a class="code" href="../../dd/db2/res__pjsip__authenticator__digest_8c.html#ad920f57db5e8c4e82e415be692af48a8">challenge</a>-&gt;msg_info.msg,</div><div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;      search_type, auth_hdr ? auth_hdr-&gt;next : <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>))) {</div><div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;      <span class="keywordtype">int</span> exact_match_index = -1;</div><div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;      <span class="keywordtype">int</span> wildcard_match_index = -1;</div><div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;      <span class="keywordtype">int</span> match_index = 0;</div><div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;      pjsip_cred_info auth_cred;</div><div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;      <span class="keyword">struct </span><a class="code" href="../../d0/d01/structast__sip__auth.html">ast_sip_auth</a> *auth = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;</div><div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;      memset(&amp;auth_cred, 0, <span class="keyword">sizeof</span>(auth_cred));</div><div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;      <span class="comment">/*</span></div><div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;<span class="comment">       * Since we only support the MD5 algorithm at the current time,</span></div><div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;<span class="comment">       * there&#39;s no sense searching for auth objects that match the algorithm.</span></div><div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;<span class="comment">       * In fact, the auth_object structure doesn&#39;t even have a member</span></div><div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;<span class="comment">       * for it.</span></div><div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;<span class="comment">       *</span></div><div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;<span class="comment">       * When we do support more algorithms, this check will need to be</span></div><div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;<span class="comment">       * moved inside the auth object loop below.</span></div><div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;<span class="comment">       *</span></div><div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;<span class="comment">       * Note: The header may not have specified an algorithm at all in which</span></div><div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;<span class="comment">       * case it&#39;s assumed to be MD5. is_digest_algorithm_supported() returns</span></div><div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;<span class="comment">       * true for that case.</span></div><div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;<span class="comment">       */</span></div><div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;      <span class="keywordflow">if</span> (!<a class="code" href="../../d4/d61/res__pjsip__outbound__authenticator__digest_8c.html#ad1b1334fa7d9169d5935b60482e29668">is_digest_algorithm_supported</a>(auth_hdr)) {</div><div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;         <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(3, <span class="stringliteral">&quot;Skipping header with realm &#39;%.*s&#39; and unsupported &#39;%.*s&#39; algorithm \n&quot;</span>,</div><div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;            (<span class="keywordtype">int</span>)auth_hdr-&gt;challenge.digest.realm.slen, auth_hdr-&gt;challenge.digest.realm.ptr,</div><div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;            (<span class="keywordtype">int</span>)auth_hdr-&gt;challenge.digest.algorithm.slen, auth_hdr-&gt;challenge.digest.algorithm.ptr);</div><div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;         <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;      }</div><div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;</div><div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;      <span class="comment">/*</span></div><div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;<span class="comment">       * Appending the realms is strictly so digest_create_request_with_auth()</span></div><div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;<span class="comment">       * can display good error messages.  Since we only support one algorithm,</span></div><div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;<span class="comment">       * there can&#39;t be more than one header with the same realm.  No need to worry</span></div><div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;<span class="comment">       * about duplicate realms until then.</span></div><div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;<span class="comment">       */</span></div><div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;      <span class="keywordflow">if</span> (*realms) {</div><div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;         <a class="code" href="../../d6/d90/strings_8h.html#a1088afdd862a49b0fce34ebe02df8ca1">ast_str_append</a>(realms, 0, <span class="stringliteral">&quot;%.*s, &quot;</span>,</div><div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;            (<span class="keywordtype">int</span>)auth_hdr-&gt;challenge.digest.realm.slen, auth_hdr-&gt;challenge.digest.realm.ptr);</div><div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;      }</div><div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;</div><div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;      <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(3, <span class="stringliteral">&quot;Searching auths to find matching ones for header with realm &#39;%.*s&#39; and algorithm &#39;%.*s&#39;\n&quot;</span>,</div><div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;         (<span class="keywordtype">int</span>)auth_hdr-&gt;challenge.digest.realm.slen, auth_hdr-&gt;challenge.digest.realm.ptr,</div><div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;         (<span class="keywordtype">int</span>)auth_hdr-&gt;challenge.digest.algorithm.slen, auth_hdr-&gt;challenge.digest.algorithm.ptr);</div><div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;</div><div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;      <span class="comment">/*</span></div><div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;<span class="comment">       * Now that we have a valid header, we can loop over the auths available to</span></div><div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;<span class="comment">       * find either an exact realm match or, failing that, a wildcard auth (an</span></div><div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;<span class="comment">       * auth with an empty or &quot;*&quot; realm).</span></div><div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;<span class="comment">       *</span></div><div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;<span class="comment">       * NOTE: We never use the global default realm when we&#39;re the UAC responding</span></div><div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;<span class="comment">       * to a 401 or 407.  We only use that when we&#39;re the UAS (handled elsewhere)</span></div><div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;<span class="comment">       * and the auth object didn&#39;t have a realm.</span></div><div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;<span class="comment">       */</span></div><div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;      <span class="keywordflow">for</span> (i = 0; i &lt; auth_object_count; ++i) {</div><div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;         auth = <a class="code" href="../../d6/d68/vector_8h.html#aef32ac52c3e8a530d16eb92cde22cacd">AST_VECTOR_GET</a>(auth_objects_vector, i);</div><div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;</div><div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;         <span class="comment">/*</span></div><div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;<span class="comment">          * If this auth object&#39;s realm exactly matches the one</span></div><div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;<span class="comment">          * from the header, we can just break out and use it.</span></div><div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;<span class="comment">          *</span></div><div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;<span class="comment">          * NOTE: If there&#39;s more than one auth object for an endpoint with</span></div><div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;<span class="comment">          * a matching realm it&#39;s a misconfiguration.  We&#39;ll only use the first.</span></div><div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;<span class="comment">          */</span></div><div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;         <span class="keywordflow">if</span> (pj_stricmp2(&amp;auth_hdr-&gt;challenge.digest.realm, auth-&gt;<a class="code" href="../../d0/d01/structast__sip__auth.html#a71767d73977f42a36bcb04fb76f7a286">realm</a>) == 0) {</div><div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;            <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(3, <span class="stringliteral">&quot;Found matching auth &#39;%s&#39; with realm &#39;%s&#39;\n&quot;</span>, <a class="code" href="../../d8/d25/sorcery_8h.html#a97706283a06cbb44e4f0f9620dd5cf07">ast_sorcery_object_get_id</a>(auth),</div><div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;               auth-&gt;<a class="code" href="../../d0/d01/structast__sip__auth.html#a71767d73977f42a36bcb04fb76f7a286">realm</a>);</div><div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;            exact_match_index = i;</div><div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;            <span class="comment">/*</span></div><div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;<span class="comment">             * If we found an exact realm match, there&#39;s no need to keep</span></div><div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;<span class="comment">             * looking for a wildcard.</span></div><div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;<span class="comment">             */</span></div><div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;         }</div><div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;</div><div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;         <span class="comment">/*</span></div><div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;<span class="comment">          * If this auth object&#39;s realm is empty or a &quot;*&quot;, it&#39;s a wildcard</span></div><div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;<span class="comment">          * auth object.  We going to save its index but keep iterating over</span></div><div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;<span class="comment">          * the vector in case we find an exact match later.</span></div><div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;<span class="comment">          *</span></div><div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;<span class="comment">          * NOTE: If there&#39;s more than one wildcard auth object for an endpoint</span></div><div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;<span class="comment">          * it&#39;s a misconfiguration.  We&#39;ll only use the first.</span></div><div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;<span class="comment">          */</span></div><div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;         <span class="keywordflow">if</span> (wildcard_match_index &lt; 0</div><div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;            &amp;&amp; (<a class="code" href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a>(auth-&gt;<a class="code" href="../../d0/d01/structast__sip__auth.html#a71767d73977f42a36bcb04fb76f7a286">realm</a>) || <a class="code" href="../../d6/d90/strings_8h.html#a13824dd1c76e6cbb12dd7f7783fca8fd">ast_strings_equal</a>(auth-&gt;<a class="code" href="../../d0/d01/structast__sip__auth.html#a71767d73977f42a36bcb04fb76f7a286">realm</a>, <span class="stringliteral">&quot;*&quot;</span>))) {</div><div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;            <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(3, <span class="stringliteral">&quot;Found wildcard auth &#39;%s&#39; for realm &#39;%.*s&#39;\n&quot;</span>, <a class="code" href="../../d8/d25/sorcery_8h.html#a97706283a06cbb44e4f0f9620dd5cf07">ast_sorcery_object_get_id</a>(auth),</div><div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;               (<span class="keywordtype">int</span>)auth_hdr-&gt;challenge.digest.realm.slen, auth_hdr-&gt;challenge.digest.realm.ptr);</div><div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;            wildcard_match_index = i;</div><div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;         }</div><div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;      }</div><div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;</div><div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;      <span class="keywordflow">if</span> (exact_match_index &lt; 0 &amp;&amp; wildcard_match_index &lt; 0) {</div><div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;         <span class="comment">/*</span></div><div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;<span class="comment">          * Didn&#39;t find either a wildcard or an exact realm match.</span></div><div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;<span class="comment">          * Move on to the next header.</span></div><div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;<span class="comment">          */</span></div><div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;         <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(3, <span class="stringliteral">&quot;No auth matching realm or no wildcard found for realm &#39;%.*s&#39;\n&quot;</span>,</div><div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;            (<span class="keywordtype">int</span>)auth_hdr-&gt;challenge.digest.realm.slen, auth_hdr-&gt;challenge.digest.realm.ptr);</div><div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;         <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;      }</div><div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;</div><div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;      <span class="keywordflow">if</span> (exact_match_index &gt;= 0) {</div><div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;         <span class="comment">/*</span></div><div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;<span class="comment">          * If we found an exact match, we&#39;ll always prefer that.</span></div><div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;<span class="comment">          */</span></div><div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;         match_index = exact_match_index;</div><div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;         auth = <a class="code" href="../../d6/d68/vector_8h.html#aef32ac52c3e8a530d16eb92cde22cacd">AST_VECTOR_GET</a>(auth_objects_vector, match_index);</div><div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;         <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(3, <span class="stringliteral">&quot;Using matched auth &#39;%s&#39; with realm &#39;%.*s&#39;\n&quot;</span>, <a class="code" href="../../d8/d25/sorcery_8h.html#a97706283a06cbb44e4f0f9620dd5cf07">ast_sorcery_object_get_id</a>(auth),</div><div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;            (<span class="keywordtype">int</span>)auth_hdr-&gt;challenge.digest.realm.slen, auth_hdr-&gt;challenge.digest.realm.ptr);</div><div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;      } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;         <span class="comment">/*</span></div><div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;<span class="comment">          * We&#39;ll only use the wildcard if we didn&#39;t find an exact match.</span></div><div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;<span class="comment">          */</span></div><div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;         match_index = wildcard_match_index;</div><div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;         auth = <a class="code" href="../../d6/d68/vector_8h.html#aef32ac52c3e8a530d16eb92cde22cacd">AST_VECTOR_GET</a>(auth_objects_vector, match_index);</div><div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;         <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(3, <span class="stringliteral">&quot;Using wildcard auth &#39;%s&#39; for realm &#39;%.*s&#39;\n&quot;</span>, <a class="code" href="../../d8/d25/sorcery_8h.html#a97706283a06cbb44e4f0f9620dd5cf07">ast_sorcery_object_get_id</a>(auth),</div><div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;            (<span class="keywordtype">int</span>)auth_hdr-&gt;challenge.digest.realm.slen, auth_hdr-&gt;challenge.digest.realm.ptr);</div><div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;      }</div><div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;</div><div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;      <span class="comment">/*</span></div><div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;<span class="comment">       * Copy the fields from the auth_object to the</span></div><div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;<span class="comment">       * pjsip_cred_info structure.</span></div><div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;<span class="comment">       */</span></div><div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;      auth_cred.realm = auth_hdr-&gt;challenge.common.realm;</div><div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;      pj_cstr(&amp;auth_cred.username, auth-&gt;<a class="code" href="../../d0/d01/structast__sip__auth.html#a9dfeb2fdce6acf9c0f869d674aa5a1c2">auth_user</a>);</div><div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;      pj_cstr(&amp;auth_cred.scheme, <span class="stringliteral">&quot;digest&quot;</span>);</div><div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;      <span class="keywordflow">switch</span> (auth-&gt;<a class="code" href="../../d0/d01/structast__sip__auth.html#af9a537c0354134006946f9dd7351fc49">type</a>) {</div><div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;      <span class="keywordflow">case</span> <a class="code" href="../../d8/d8c/res__pjsip_8h.html#ab5b75b4bdba91e178731511c7fa659cdacb1470ed32c61ab7bf30cccb2887ed2b">AST_SIP_AUTH_TYPE_USER_PASS</a>:</div><div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;         pj_cstr(&amp;auth_cred.data, auth-&gt;<a class="code" href="../../d0/d01/structast__sip__auth.html#af263f62bf45d20982f102de2a9cd461f">auth_pass</a>);</div><div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;         auth_cred.data_type = PJSIP_CRED_DATA_PLAIN_PASSWD;</div><div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;         <span class="keywordflow">break</span>;</div><div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;      <span class="keywordflow">case</span> <a class="code" href="../../d8/d8c/res__pjsip_8h.html#ab5b75b4bdba91e178731511c7fa659cdabbc9332fb29a5f57bc4a9b6c39c3d553">AST_SIP_AUTH_TYPE_MD5</a>:</div><div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;         pj_cstr(&amp;auth_cred.data, auth-&gt;<a class="code" href="../../d0/d01/structast__sip__auth.html#a65a9bdda248637db17f2af0c9896cdfb">md5_creds</a>);</div><div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;         auth_cred.data_type = PJSIP_CRED_DATA_DIGEST;</div><div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;         <span class="keywordflow">break</span>;</div><div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;      <span class="keywordflow">case</span> <a class="code" href="../../d8/d8c/res__pjsip_8h.html#ab5b75b4bdba91e178731511c7fa659cda0d8d8506a624618324fd18bb4a7e7079">AST_SIP_AUTH_TYPE_GOOGLE_OAUTH</a>:</div><div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;         <span class="comment">/* nothing to do. handled seperately in res_pjsip_outbound_registration */</span></div><div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;         <span class="keywordflow">break</span>;</div><div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;      <span class="keywordflow">case</span> <a class="code" href="../../d8/d8c/res__pjsip_8h.html#ab5b75b4bdba91e178731511c7fa659cda662c2f6a25954136d58f73a6e7940501">AST_SIP_AUTH_TYPE_ARTIFICIAL</a>:</div><div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;         <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>,</div><div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;            <span class="stringliteral">&quot;Trying to set artificial outbound auth credentials shouldn&#39;t happen.\n&quot;</span>);</div><div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;         <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;      } <span class="comment">/* End auth object loop */</span></div><div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;</div><div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;      <span class="comment">/*</span></div><div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;<span class="comment">       * Because the vector contains actual structures and not pointers</span></div><div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;<span class="comment">       * to structures, the call to AST_VECTOR_APPEND results in a simple</span></div><div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;<span class="comment">       * assign of one structure to another, effectively copying the auth_cred</span></div><div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;<span class="comment">       * structure contents to the array element.</span></div><div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;<span class="comment">       *</span></div><div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;<span class="comment">       * Also note that the calls to pj_cstr above set their respective</span></div><div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;<span class="comment">       * auth_cred fields to the _pointers_ of their corresponding auth</span></div><div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;<span class="comment">       * object fields.  This is safe because the call to</span></div><div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;<span class="comment">       * pjsip_auth_clt_set_credentials() below strdups them before we</span></div><div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;<span class="comment">       * return to the calling function which decrements the reference</span></div><div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;<span class="comment">       * counts.</span></div><div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;<span class="comment">       */</span></div><div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;      res = <a class="code" href="../../d6/d68/vector_8h.html#ae9d6199727f88a8c2407cb0e004e634a">AST_VECTOR_APPEND</a>(&amp;auth_creds, auth_cred);</div><div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;      <span class="keywordflow">if</span> (res != PJ_SUCCESS) {</div><div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;         res = PJ_ENOMEM;</div><div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;         <span class="keywordflow">goto</span> <a class="code" href="../../d2/d2c/pbx__realtime_8c.html#a10b51e1931bd03dd172cbfb9d3d67efb">cleanup</a>;</div><div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;      }</div><div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;   } <span class="comment">/* End header loop */</span></div><div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;</div><div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;   <span class="keywordflow">if</span> (*realms &amp;&amp; <a class="code" href="../../d6/d90/strings_8h.html#aabc005bd1c7e249e8f8659d57d4500b6">ast_str_strlen</a>(*realms)) {</div><div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;      <span class="comment">/*</span></div><div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;<span class="comment">       * Again, this is strictly so digest_create_request_with_auth()</span></div><div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;<span class="comment">       * can display good error messages.</span></div><div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;<span class="comment">       *</span></div><div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;<span class="comment">       * Chop off the trailing &quot;, &quot; on the last realm.</span></div><div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;<span class="comment">       */</span></div><div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;      <a class="code" href="../../d6/d90/strings_8h.html#a0b9c195ff2235f7670358e1e37cf6b8d">ast_str_truncate</a>(*realms, <a class="code" href="../../d6/d90/strings_8h.html#aabc005bd1c7e249e8f8659d57d4500b6">ast_str_strlen</a>(*realms) - 2);</div><div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;   }</div><div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;</div><div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d6/d68/vector_8h.html#a20b08af81cc9452fb721c9a698f81bdf">AST_VECTOR_SIZE</a>(&amp;auth_creds) == 0) {</div><div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;      <span class="comment">/* No matching auth objects were found. */</span></div><div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;      res = PJSIP_ENOCREDENTIAL;</div><div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;      <span class="keywordflow">goto</span> <a class="code" href="../../d2/d2c/pbx__realtime_8c.html#a10b51e1931bd03dd172cbfb9d3d67efb">cleanup</a>;</div><div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;   }</div><div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;</div><div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;   <span class="comment">/*</span></div><div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;<span class="comment">    * Here&#39;s where we steal the cred info structures from the vector.</span></div><div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;<span class="comment">    *</span></div><div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;<span class="comment">    * The steal effectively returns a pointer to the underlying</span></div><div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;<span class="comment">    * array of pjsip_cred_info structures which is exactly what we need</span></div><div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;<span class="comment">    * to pass to pjsip_auth_clt_set_credentials().</span></div><div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;<span class="comment">    *</span></div><div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;<span class="comment">    * &lt;struct cred info&gt;&lt;struct cred info&gt;...&lt;struct cred info&gt;</span></div><div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;<span class="comment">    * ^pointer</span></div><div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;<span class="comment">    *</span></div><div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;<span class="comment">    * Since we stole the array from the vector, we have to free it ourselves.</span></div><div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;<span class="comment">    *</span></div><div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;<span class="comment">    * We also have to copy the size before we steal because stealing</span></div><div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;<span class="comment">    * resets the vector size to 0.</span></div><div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;<span class="comment">    */</span></div><div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;   cred_count = <a class="code" href="../../d6/d68/vector_8h.html#a20b08af81cc9452fb721c9a698f81bdf">AST_VECTOR_SIZE</a>(&amp;auth_creds);</div><div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;   creds_array = <a class="code" href="../../d6/d68/vector_8h.html#a5d8e2ddea0e358edc1021c417461f21b">AST_VECTOR_STEAL_ELEMENTS</a>(&amp;auth_creds);</div><div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;</div><div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;   res = pjsip_auth_clt_set_credentials(auth_sess, cred_count, creds_array);</div><div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;   <a class="code" href="../../d8/d8a/astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(creds_array);</div><div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;   <span class="keywordflow">if</span> (res == PJ_SUCCESS) {</div><div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;      <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(3, <span class="stringliteral">&quot;Set %&quot;</span>PRIu64<span class="stringliteral">&quot; credentials in auth session\n&quot;</span>, cred_count);</div><div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;   } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Failed to set %&quot;</span>PRIu64<span class="stringliteral">&quot; credentials in auth session\n&quot;</span>, cred_count);</div><div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;   }</div><div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;</div><div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;<a class="code" href="../../d2/d2c/pbx__realtime_8c.html#a10b51e1931bd03dd172cbfb9d3d67efb">cleanup</a>:</div><div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;   <a class="code" href="../../d6/d68/vector_8h.html#a66aaa4efda59c52384b03c38e781124d">AST_VECTOR_FREE</a>(&amp;auth_creds);</div><div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;   <span class="keywordflow">return</span> res;</div><div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;}</div><div class="ttc" id="vector_8h_html_a66aaa4efda59c52384b03c38e781124d"><div class="ttname"><a href="../../d6/d68/vector_8h.html#a66aaa4efda59c52384b03c38e781124d">AST_VECTOR_FREE</a></div><div class="ttdeci">#define AST_VECTOR_FREE(vec)</div><div class="ttdoc">Deallocates this vector. </div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d68/vector_8h_source.html#l00174">vector.h:174</a></div></div>
<div class="ttc" id="structast__sip__auth_html"><div class="ttname"><a href="../../d0/d01/structast__sip__auth.html">ast_sip_auth</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d8c/res__pjsip_8h_source.html#l00444">res_pjsip.h:444</a></div></div>
<div class="ttc" id="structast__sip__auth_html_a65a9bdda248637db17f2af0c9896cdfb"><div class="ttname"><a href="../../d0/d01/structast__sip__auth.html#a65a9bdda248637db17f2af0c9896cdfb">ast_sip_auth::md5_creds</a></div><div class="ttdeci">const ast_string_field md5_creds</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d8c/res__pjsip_8h_source.html#l00454">res_pjsip.h:454</a></div></div>
<div class="ttc" id="vector_8h_html_ae9d6199727f88a8c2407cb0e004e634a"><div class="ttname"><a href="../../d6/d68/vector_8h.html#ae9d6199727f88a8c2407cb0e004e634a">AST_VECTOR_APPEND</a></div><div class="ttdeci">#define AST_VECTOR_APPEND(vec, elem)</div><div class="ttdoc">Append an element to a vector, growing the vector if needed. </div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d68/vector_8h_source.html#l00256">vector.h:256</a></div></div>
<div class="ttc" id="strings_8h_html_a1088afdd862a49b0fce34ebe02df8ca1"><div class="ttname"><a href="../../d6/d90/strings_8h.html#a1088afdd862a49b0fce34ebe02df8ca1">ast_str_append</a></div><div class="ttdeci">int ast_str_append(struct ast_str **buf, ssize_t max_len, const char *fmt,...)</div><div class="ttdoc">Append to a thread local dynamic string. </div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d90/strings_8h_source.html#l01091">strings.h:1091</a></div></div>
<div class="ttc" id="resample_8c_html_a070d2ce7b6bb7e5c05602aa8c308d0c4"><div class="ttname"><a href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a></div><div class="ttdeci">#define NULL</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d7f/resample_8c_source.html#l00096">resample.c:96</a></div></div>
<div class="ttc" id="res__pjsip_8h_html_ab5b75b4bdba91e178731511c7fa659cdacb1470ed32c61ab7bf30cccb2887ed2b"><div class="ttname"><a href="../../d8/d8c/res__pjsip_8h.html#ab5b75b4bdba91e178731511c7fa659cdacb1470ed32c61ab7bf30cccb2887ed2b">AST_SIP_AUTH_TYPE_USER_PASS</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d8c/res__pjsip_8h_source.html#l00433">res_pjsip.h:433</a></div></div>
<div class="ttc" id="strings_8h_html_a0b9c195ff2235f7670358e1e37cf6b8d"><div class="ttname"><a href="../../d6/d90/strings_8h.html#a0b9c195ff2235f7670358e1e37cf6b8d">ast_str_truncate</a></div><div class="ttdeci">char * ast_str_truncate(struct ast_str *buf, ssize_t len)</div><div class="ttdoc">Truncates the enclosed string to the given length. </div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d90/strings_8h_source.html#l00738">strings.h:738</a></div></div>
<div class="ttc" id="strings_8h_html_a372554b7a2d69a8bd3adac5157672036"><div class="ttname"><a href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a></div><div class="ttdeci">#define ast_strlen_zero(foo)</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d90/strings_8h_source.html#l00052">strings.h:52</a></div></div>
<div class="ttc" id="logger_8h_html_a3f248112c8d6ce7e3959aa723dade648"><div class="ttname"><a href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a></div><div class="ttdeci">#define ast_debug(level,...)</div><div class="ttdoc">Log a DEBUG message. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d8c/logger_8h_source.html#l00452">logger.h:452</a></div></div>
<div class="ttc" id="astobj2_8c_html_a96a00b3a518d7f32b6d51dc28f09bf9b"><div class="ttname"><a href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a></div><div class="ttdeci">#define ast_log</div><div class="ttdef"><b>Definition:</b> <a href="../../da/df7/astobj2_8c_source.html#l00042">astobj2.c:42</a></div></div>
<div class="ttc" id="vector_8h_html_ad9d555fa89da1bfc691181993499f785"><div class="ttname"><a href="../../d6/d68/vector_8h.html#ad9d555fa89da1bfc691181993499f785">AST_VECTOR_INIT</a></div><div class="ttdeci">#define AST_VECTOR_INIT(vec, size)</div><div class="ttdoc">Initialize a vector. </div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d68/vector_8h_source.html#l00113">vector.h:113</a></div></div>
<div class="ttc" id="res__pjsip_8h_html_ab5b75b4bdba91e178731511c7fa659cda662c2f6a25954136d58f73a6e7940501"><div class="ttname"><a href="../../d8/d8c/res__pjsip_8h.html#ab5b75b4bdba91e178731511c7fa659cda662c2f6a25954136d58f73a6e7940501">AST_SIP_AUTH_TYPE_ARTIFICIAL</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d8c/res__pjsip_8h_source.html#l00439">res_pjsip.h:439</a></div></div>
<div class="ttc" id="sorcery_8h_html_a97706283a06cbb44e4f0f9620dd5cf07"><div class="ttname"><a href="../../d8/d25/sorcery_8h.html#a97706283a06cbb44e4f0f9620dd5cf07">ast_sorcery_object_get_id</a></div><div class="ttdeci">const char * ast_sorcery_object_get_id(const void *object)</div><div class="ttdoc">Get the unique identifier of a sorcery object. </div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d69/sorcery_8c_source.html#l02312">sorcery.c:2312</a></div></div>
<div class="ttc" id="res__pjsip__authenticator__digest_8c_html_ad920f57db5e8c4e82e415be692af48a8"><div class="ttname"><a href="../../dd/db2/res__pjsip__authenticator__digest_8c.html#ad920f57db5e8c4e82e415be692af48a8">challenge</a></div><div class="ttdeci">static void challenge(const char *realm, pjsip_tx_data *tdata, const pjsip_rx_data *rdata, int is_stale)</div><div class="ttdoc">astobj2 callback for adding digest challenges to responses </div><div class="ttdef"><b>Definition:</b> <a href="../../dd/db2/res__pjsip__authenticator__digest_8c_source.html#l00377">res_pjsip_authenticator_digest.c:377</a></div></div>
<div class="ttc" id="vector_8h_html_a5d8e2ddea0e358edc1021c417461f21b"><div class="ttname"><a href="../../d6/d68/vector_8h.html#a5d8e2ddea0e358edc1021c417461f21b">AST_VECTOR_STEAL_ELEMENTS</a></div><div class="ttdeci">#define AST_VECTOR_STEAL_ELEMENTS(vec)</div><div class="ttdoc">Steal the elements from a vector and reinitialize. </div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d68/vector_8h_source.html#l00140">vector.h:140</a></div></div>
<div class="ttc" id="vector_8h_html_aecf5cf511c06438b264c501224d13d89"><div class="ttname"><a href="../../d6/d68/vector_8h.html#aecf5cf511c06438b264c501224d13d89">AST_VECTOR</a></div><div class="ttdeci">#define AST_VECTOR(name, type)</div><div class="ttdoc">Define a vector structure. </div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d68/vector_8h_source.html#l00044">vector.h:44</a></div></div>
<div class="ttc" id="res__pjsip__outbound__authenticator__digest_8c_html_ae8dc4017742bf2a2fb4760a197d3ca68"><div class="ttname"><a href="../../d4/d61/res__pjsip__outbound__authenticator__digest_8c.html#ae8dc4017742bf2a2fb4760a197d3ca68">get_auth_search_type</a></div><div class="ttdeci">static pjsip_hdr_e get_auth_search_type(pjsip_rx_data *challenge)</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d61/res__pjsip__outbound__authenticator__digest_8c_source.html#l00046">res_pjsip_outbound_authenticator_digest.c:46</a></div></div>
<div class="ttc" id="logger_8h_html_aced66975c154ea0e2a8ec3bc818b4e08"><div class="ttname"><a href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a></div><div class="ttdeci">#define LOG_ERROR</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d8c/logger_8h_source.html#l00285">logger.h:285</a></div></div>
<div class="ttc" id="structast__sip__auth_html_a71767d73977f42a36bcb04fb76f7a286"><div class="ttname"><a href="../../d0/d01/structast__sip__auth.html#a71767d73977f42a36bcb04fb76f7a286">ast_sip_auth::realm</a></div><div class="ttdeci">const ast_string_field realm</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d8c/res__pjsip_8h_source.html#l00448">res_pjsip.h:448</a></div></div>
<div class="ttc" id="strings_8h_html_a13824dd1c76e6cbb12dd7f7783fca8fd"><div class="ttname"><a href="../../d6/d90/strings_8h.html#a13824dd1c76e6cbb12dd7f7783fca8fd">ast_strings_equal</a></div><div class="ttdeci">int ast_strings_equal(const char *str1, const char *str2)</div><div class="ttdoc">Compare strings for equality checking for NULL. </div><div class="ttdef"><b>Definition:</b> <a href="../../d2/d48/strings_8c_source.html#l00239">strings.c:239</a></div></div>
<div class="ttc" id="astmm_8h_html_a402072d6789f6ed9e3a81da27504127e"><div class="ttname"><a href="../../d8/d8a/astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a></div><div class="ttdeci">#define ast_free(a)</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d8a/astmm_8h_source.html#l00182">astmm.h:182</a></div></div>
<div class="ttc" id="structast__sip__auth_html_af263f62bf45d20982f102de2a9cd461f"><div class="ttname"><a href="../../d0/d01/structast__sip__auth.html#af263f62bf45d20982f102de2a9cd461f">ast_sip_auth::auth_pass</a></div><div class="ttdeci">const ast_string_field auth_pass</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d8c/res__pjsip_8h_source.html#l00452">res_pjsip.h:452</a></div></div>
<div class="ttc" id="structast__sip__auth_html_af9a537c0354134006946f9dd7351fc49"><div class="ttname"><a href="../../d0/d01/structast__sip__auth.html#af9a537c0354134006946f9dd7351fc49">ast_sip_auth::type</a></div><div class="ttdeci">enum ast_sip_auth_type type</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d8c/res__pjsip_8h_source.html#l00464">res_pjsip.h:464</a></div></div>
<div class="ttc" id="pbx__realtime_8c_html_a10b51e1931bd03dd172cbfb9d3d67efb"><div class="ttname"><a href="../../d2/d2c/pbx__realtime_8c.html#a10b51e1931bd03dd172cbfb9d3d67efb">cleanup</a></div><div class="ttdeci">static void * cleanup(void *unused)</div><div class="ttdef"><b>Definition:</b> <a href="../../d2/d2c/pbx__realtime_8c_source.html#l00124">pbx_realtime.c:124</a></div></div>
<div class="ttc" id="strings_8h_html_aabc005bd1c7e249e8f8659d57d4500b6"><div class="ttname"><a href="../../d6/d90/strings_8h.html#aabc005bd1c7e249e8f8659d57d4500b6">ast_str_strlen</a></div><div class="ttdeci">size_t ast_str_strlen(const struct ast_str *buf)</div><div class="ttdoc">Returns the current length of the string stored within buf. </div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d90/strings_8h_source.html#l00688">strings.h:688</a></div></div>
<div class="ttc" id="res__pjsip_8h_html_ab5b75b4bdba91e178731511c7fa659cda0d8d8506a624618324fd18bb4a7e7079"><div class="ttname"><a href="../../d8/d8c/res__pjsip_8h.html#ab5b75b4bdba91e178731511c7fa659cda0d8d8506a624618324fd18bb4a7e7079">AST_SIP_AUTH_TYPE_GOOGLE_OAUTH</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d8c/res__pjsip_8h_source.html#l00437">res_pjsip.h:437</a></div></div>
<div class="ttc" id="vector_8h_html_aef32ac52c3e8a530d16eb92cde22cacd"><div class="ttname"><a href="../../d6/d68/vector_8h.html#aef32ac52c3e8a530d16eb92cde22cacd">AST_VECTOR_GET</a></div><div class="ttdeci">#define AST_VECTOR_GET(vec, idx)</div><div class="ttdoc">Get an element from a vector. </div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d68/vector_8h_source.html#l00682">vector.h:682</a></div></div>
<div class="ttc" id="res__pjsip__outbound__authenticator__digest_8c_html_ad1b1334fa7d9169d5935b60482e29668"><div class="ttname"><a href="../../d4/d61/res__pjsip__outbound__authenticator__digest_8c.html#ad1b1334fa7d9169d5935b60482e29668">is_digest_algorithm_supported</a></div><div class="ttdeci">static int is_digest_algorithm_supported(pjsip_www_authenticate_hdr *auth_hdr)</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d61/res__pjsip__outbound__authenticator__digest_8c_source.html#l00068">res_pjsip_outbound_authenticator_digest.c:68</a></div></div>
<div class="ttc" id="res__pjsip_8h_html_ab5b75b4bdba91e178731511c7fa659cdabbc9332fb29a5f57bc4a9b6c39c3d553"><div class="ttname"><a href="../../d8/d8c/res__pjsip_8h.html#ab5b75b4bdba91e178731511c7fa659cdabbc9332fb29a5f57bc4a9b6c39c3d553">AST_SIP_AUTH_TYPE_MD5</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d8c/res__pjsip_8h_source.html#l00435">res_pjsip.h:435</a></div></div>
<div class="ttc" id="structast__sip__auth_html_a9dfeb2fdce6acf9c0f869d674aa5a1c2"><div class="ttname"><a href="../../d0/d01/structast__sip__auth.html#a9dfeb2fdce6acf9c0f869d674aa5a1c2">ast_sip_auth::auth_user</a></div><div class="ttdeci">const ast_string_field auth_user</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d8c/res__pjsip_8h_source.html#l00450">res_pjsip.h:450</a></div></div>
<div class="ttc" id="vector_8h_html_a20b08af81cc9452fb721c9a698f81bdf"><div class="ttname"><a href="../../d6/d68/vector_8h.html#a20b08af81cc9452fb721c9a698f81bdf">AST_VECTOR_SIZE</a></div><div class="ttdeci">#define AST_VECTOR_SIZE(vec)</div><div class="ttdoc">Get the number of elements in a vector. </div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d68/vector_8h_source.html#l00611">vector.h:611</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="ad09fa931f468002152a3cc2d5ce25eae"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad09fa931f468002152a3cc2d5ce25eae">&#9670;&nbsp;</a></span>unload_module()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int unload_module </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="../../d4/d61/res__pjsip__outbound__authenticator__digest_8c_source.html#l00589">589</a> of file <a class="el" href="../../d4/d61/res__pjsip__outbound__authenticator__digest_8c_source.html">res_pjsip_outbound_authenticator_digest.c</a>.</p>

<p class="reference">References <a class="el" href="../../d5/d16/module_8h_source.html#l00317">AST_MODFLAG_LOAD_ORDER</a>, <a class="el" href="../../d5/d16/module_8h_source.html#l00326">AST_MODPRI_CHANNEL_DEPEND</a>, <a class="el" href="../../d9/de9/res__phoneprov_8c.html#addaa208b0ed785225e24490fb9f28a80">AST_MODULE_INFO()</a>, <a class="el" href="../../d5/d16/module_8h_source.html#l00121">AST_MODULE_SUPPORT_CORE</a>, <a class="el" href="../../de/d96/res__pjsip_8c_source.html#l03401">ast_sip_unregister_outbound_authenticator()</a>, <a class="el" href="../../d5/d16/module_8h_source.html#l00046">ASTERISK_GPL_KEY</a>, and <a class="el" href="../../d4/d61/res__pjsip__outbound__authenticator__digest_8c_source.html#l00581">load_module()</a>.</p>
<div class="fragment"><div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;{</div><div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;   <a class="code" href="../../d8/d8c/res__pjsip_8h.html#a5a7f20f3df296fe384f405c5e5a2995a">ast_sip_unregister_outbound_authenticator</a>(&amp;<a class="code" href="../../d4/d61/res__pjsip__outbound__authenticator__digest_8c.html#a3ab4b96a4c484b683a0cf2d0de04d586">digest_authenticator</a>);</div><div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;   <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;}</div><div class="ttc" id="res__pjsip_8h_html_a5a7f20f3df296fe384f405c5e5a2995a"><div class="ttname"><a href="../../d8/d8c/res__pjsip_8h.html#a5a7f20f3df296fe384f405c5e5a2995a">ast_sip_unregister_outbound_authenticator</a></div><div class="ttdeci">void ast_sip_unregister_outbound_authenticator(struct ast_sip_outbound_authenticator *auth)</div><div class="ttdoc">Unregister an outbound SIP authenticator. </div><div class="ttdef"><b>Definition:</b> <a href="../../de/d96/res__pjsip_8c_source.html#l03401">res_pjsip.c:3401</a></div></div>
<div class="ttc" id="res__pjsip__outbound__authenticator__digest_8c_html_a3ab4b96a4c484b683a0cf2d0de04d586"><div class="ttname"><a href="../../d4/d61/res__pjsip__outbound__authenticator__digest_8c.html#a3ab4b96a4c484b683a0cf2d0de04d586">digest_authenticator</a></div><div class="ttdeci">static struct ast_sip_outbound_authenticator digest_authenticator</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d61/res__pjsip__outbound__authenticator__digest_8c_source.html#l00577">res_pjsip_outbound_authenticator_digest.c:577</a></div></div>
</div><!-- fragment -->
</div>
</div>
<h2 class="groupheader">Variable Documentation</h2>
<a id="ab22f32016155f7f403e7178767163d7d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab22f32016155f7f403e7178767163d7d">&#9670;&nbsp;</a></span>__mod_info</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="../../dd/d5f/structast__module__info.html">ast_module_info</a> __mod_info = { .<a class="el" href="../../d1/da4/res__corosync_8c.html#a8f8f80d37794cde9472343e4487ba3eb">name</a> = <a class="el" href="../../da/ddd/named__acl_8c.html#aec23fc5034c3bb08140fc021f4955877">AST_MODULE</a>, .flags = <a class="el" href="../../d5/d16/module_8h.html#a155a0df9c59e04e305d4a2fa3e35f843a12c3f60dd7655dfa8d4430cbf04b1223">AST_MODFLAG_LOAD_ORDER</a> , .description = &quot;PJSIP authentication resource&quot; , .key = &quot;This paragraph is copyright (<a class="el" href="../../d7/d6f/test__linkedlists_8c.html#acd9db00336027462cfb25b97b5356883">c</a>) 2006 by Digium, Inc. \In <a class="el" href="../../d5/d14/voicin_8c.html#aed7ca058008dc3e5ee131e575abed285">order</a> for your module to load, it must return this \key via <a class="el" href="../../d7/d6f/test__linkedlists_8c.html#a13dd15487fee89a002d17ef3aff62d02">a</a> function called \&quot;key\&quot;. Any code which \includes this paragraph must <a class="el" href="../../dd/d7c/eagi__proxy_8c.html#a39730e90126aad69cfc9ca4d6fcdb3a6">be</a> licensed under the GNU \General Public License <a class="el" href="../../da/d7c/utils_2frame_8h.html#a56abfaab87c46691c1ef3ad0df23e864">version</a> 2 or later (at your \option). In addition to Digium's general reservations \of rights, Digium expressly reserves the right to \allow other parties to license this paragraph under \different terms. Any use of Digium, Inc. trademarks or \logos (including \&quot;Asterisk\&quot; or \&quot;Digium\&quot;) without \express written <a class="el" href="../../d4/d4c/structpermission.html">permission</a> of Digium, Inc. is prohibited.\n&quot; , .buildopt_sum = &quot;30ef0c93b36035ec78c9cfd712d36d9b&quot; , .support_level = AST_MODULE_SUPPORT_CORE, .load = load_module, .unload = unload_module, .load_pri = AST_MODPRI_CHANNEL_DEPEND, .requires = &quot;res_pjsip&quot;, }</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="../../d4/d61/res__pjsip__outbound__authenticator__digest_8c_source.html#l00601">601</a> of file <a class="el" href="../../d4/d61/res__pjsip__outbound__authenticator__digest_8c_source.html">res_pjsip_outbound_authenticator_digest.c</a>.</p>

</div>
</div>
<a id="ad60e83b9aa660040fed4d5377966cc21"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad60e83b9aa660040fed4d5377966cc21">&#9670;&nbsp;</a></span>ast_module_info</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">const struct <a class="el" href="../../dd/d5f/structast__module__info.html">ast_module_info</a>* <a class="el" href="../../dd/d5f/structast__module__info.html">ast_module_info</a> = &amp;<a class="el" href="../../d6/d7a/test__xml__escape_8c.html#ab22f32016155f7f403e7178767163d7d">__mod_info</a></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="../../d4/d61/res__pjsip__outbound__authenticator__digest_8c_source.html#l00601">601</a> of file <a class="el" href="../../d4/d61/res__pjsip__outbound__authenticator__digest_8c_source.html">res_pjsip_outbound_authenticator_digest.c</a>.</p>

</div>
</div>
<a id="a3ab4b96a4c484b683a0cf2d0de04d586"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3ab4b96a4c484b683a0cf2d0de04d586">&#9670;&nbsp;</a></span>digest_authenticator</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="../../d0/dc2/structast__sip__outbound__authenticator.html">ast_sip_outbound_authenticator</a> digest_authenticator</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<b>Initial value:</b><div class="fragment"><div class="line">= {</div><div class="line">   .create_request_with_auth = <a class="code" href="../../d4/d61/res__pjsip__outbound__authenticator__digest_8c.html#aa0790853094dccbf9799afbdb82076cf">digest_create_request_with_auth</a>,</div><div class="line">}</div><div class="ttc" id="res__pjsip__outbound__authenticator__digest_8c_html_aa0790853094dccbf9799afbdb82076cf"><div class="ttname"><a href="../../d4/d61/res__pjsip__outbound__authenticator__digest_8c.html#aa0790853094dccbf9799afbdb82076cf">digest_create_request_with_auth</a></div><div class="ttdeci">static int digest_create_request_with_auth(const struct ast_sip_auth_vector *auth_ids_vector, pjsip_rx_data *challenge, pjsip_tx_data *old_request, pjsip_tx_data **new_request)</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d61/res__pjsip__outbound__authenticator__digest_8c_source.html#l00410">res_pjsip_outbound_authenticator_digest.c:410</a></div></div>
</div><!-- fragment -->
<p class="definition">Definition at line <a class="el" href="../../d4/d61/res__pjsip__outbound__authenticator__digest_8c_source.html#l00577">577</a> of file <a class="el" href="../../d4/d61/res__pjsip__outbound__authenticator__digest_8c_source.html">res_pjsip_outbound_authenticator_digest.c</a>.</p>

</div>
</div>
<a id="aed62295846b3e79e7140ea74273a901e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aed62295846b3e79e7140ea74273a901e">&#9670;&nbsp;</a></span>supported_digest_algorithms</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">pj_str_t supported_digest_algorithms[]</td>
        </tr>
      </table>
</div><div class="memdoc">
<b>Initial value:</b><div class="fragment"><div class="line">= {</div><div class="line">   { <span class="stringliteral">&quot;MD5&quot;</span>, 3}</div><div class="line">}</div></div><!-- fragment -->
<p class="definition">Definition at line <a class="el" href="../../d4/d61/res__pjsip__outbound__authenticator__digest_8c_source.html#l00035">35</a> of file <a class="el" href="../../d4/d61/res__pjsip__outbound__authenticator__digest_8c_source.html">res_pjsip_outbound_authenticator_digest.c</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../d4/d61/res__pjsip__outbound__authenticator__digest_8c_source.html#l00068">is_digest_algorithm_supported()</a>.</p>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Sun Aug 8 2021 19:46:31 for Asterisk - The Open Source Telephony Project by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="../../doxygen.png" alt="doxygen"/>
</a> 1.8.13
</small></address>
</body>
</html>
