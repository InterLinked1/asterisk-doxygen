<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Asterisk - The Open Source Telephony Project: func_env.c File Reference</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Asterisk - The Open Source Telephony Project
   &#160;<span id="projectnumber">18.5.0</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "../../search",false,'Search');
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('../../',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="../../dir_e878cef7102f6638a560ae32a811d88b.html">funcs</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#define-members">Macros</a> &#124;
<a href="#enum-members">Enumerations</a> &#124;
<a href="#func-members">Functions</a> &#124;
<a href="#var-members">Variables</a>  </div>
  <div class="headertitle">
<div class="title">func_env.c File Reference<div class="ingroups"><a class="el" href="../../d5/db0/group__functions.html">Module: Dial plan functions</a></div></div>  </div>
</div><!--header-->
<div class="contents">

<p>Environment related dialplan functions.  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &quot;<a class="el" href="../../db/db2/asterisk_8h_source.html">asterisk.h</a>&quot;</code><br />
<code>#include &lt;sys/stat.h&gt;</code><br />
<code>#include &quot;<a class="el" href="../../d5/d16/module_8h_source.html">asterisk/module.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="../../d5/d7b/channel_8h_source.html">asterisk/channel.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="../../db/de0/pbx_8h_source.html">asterisk/pbx.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="../../d5/d60/utils_8h_source.html">asterisk/utils.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="../../d3/d93/include_2asterisk_2app_8h_source.html">asterisk/app.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="../../d2/d4d/file_8h_source.html">asterisk/file.h</a>&quot;</code><br />
</div><div class="textblock"><div class="dynheader">
Include dependency graph for func_env.c:</div>
<div class="dyncontent">
<div class="center"><img src="../../da/d34/func__env_8c__incl.png" border="0" usemap="#func__env_8c" alt=""/></div>
<map name="func__env_8c" id="func__env_8c">
<area shape="rect" id="node2" href="../../db/db2/asterisk_8h.html" title="Asterisk main include file. File version handling, generic pbx functions. " alt="" coords="109,453,193,480"/>
<area shape="rect" id="node13" href="../../d5/d16/module_8h.html" title="Asterisk module definitions. " alt="" coords="1699,80,1835,107"/>
<area shape="rect" id="node14" href="../../d5/d60/utils_8h.html" title="Utility functions. " alt="" coords="1693,379,1808,405"/>
<area shape="rect" id="node25" href="../../d5/d7b/channel_8h.html" title="General Asterisk PBX channel definitions. " alt="" coords="1107,155,1245,181"/>
<area shape="rect" id="node42" href="../../db/de0/pbx_8h.html" title="Core PBX routines and definitions. " alt="" coords="1859,80,1970,107"/>
<area shape="rect" id="node47" href="../../d3/d93/include_2asterisk_2app_8h.html" title="Application convenience functions, designed to give consistent look and feel to Asterisk apps..." alt="" coords="2359,229,2471,256"/>
<area shape="rect" id="node48" href="../../d2/d4d/file_8h.html" title="Generic File Format Support. Should be included by clients of the file handling routines. File service providers should instead include mod_format.h. " alt="" coords="2511,304,2617,331"/>
<area shape="rect" id="node3" href="../../d8/d20/autoconfig_8h.html" title="asterisk/autoconfig.h" alt="" coords="485,827,640,853"/>
<area shape="rect" id="node5" href="../../de/da3/include_2asterisk_2compat_8h.html" title="General Definitions for Asterisk top level program Included by asterisk.h to handle platform&#45;specific..." alt="" coords="997,603,1134,629"/>
<area shape="rect" id="node11" href="../../d8/d8a/astmm_8h.html" title="Asterisk memory management routines. " alt="" coords="214,528,349,555"/>
<area shape="rect" id="node4" href="../../dc/dba/buildopts_8h.html" title="asterisk/buildopts.h" alt="" coords="489,901,636,928"/>
<area shape="rect" id="node6" href="../../d4/dd1/compiler_8h.html" title="Compiler&#45;specific macros and other items. " alt="" coords="1266,752,1409,779"/>
<area shape="rect" id="node15" href="../../d9/d94/network_8h.html" title="Wrapper for network related headers, masking differences between various operating systems..." alt="" coords="1524,453,1663,480"/>
<area shape="rect" id="node16" href="../../de/df7/time_8h.html" title="Time&#45;related functions and macros. " alt="" coords="970,752,1033,779"/>
<area shape="rect" id="node17" href="../../dd/d42/lock_8h.html" title="Asterisk locking&#45;related definitions: " alt="" coords="1345,677,1458,704"/>
<area shape="rect" id="node18" href="../../d1/d8c/logger_8h.html" title="Support for logging to various files, console and syslog Configuration in file logger.conf. " alt="" coords="1585,752,1711,779"/>
<area shape="rect" id="node19" href="../../d5/deb/localtime_8h.html" title="Custom localtime functions for multiple timezones. " alt="" coords="1353,453,1500,480"/>
<area shape="rect" id="node20" href="../../d1/d0f/stringfields_8h.html" title="asterisk/stringfields.h" alt="" coords="2177,453,2335,480"/>
<area shape="rect" id="node21" href="../../d6/d90/strings_8h.html" title="String manipulation functions. " alt="" coords="1839,453,1969,480"/>
<area shape="rect" id="node22" href="../../dc/d7d/threadstorage_8h.html" title="Definitions to aid in the use of thread local storage. " alt="" coords="1788,528,1967,555"/>
<area shape="rect" id="node23" href="../../d5/da5/astobj2_8h.html" title="asterisk/astobj2.h" alt="" coords="1249,528,1383,555"/>
<area shape="rect" id="node24" href="../../df/d90/linkedlists_8h.html" title="A set of macros to manage forward&#45;linked lists. " alt="" coords="1210,603,1361,629"/>
<area shape="rect" id="node26" href="../../dc/d4d/alertpipe_8h.html" title="asterisk/alertpipe.h" alt="" coords="1433,304,1577,331"/>
<area shape="rect" id="node27" href="../../dc/d14/abstract__jb_8h.html" title="Common implementation&#45;independent jitterbuffer stuff. " alt="" coords="1098,304,1257,331"/>
<area shape="rect" id="node29" href="../../d4/dfb/poll-compat_8h.html" title="asterisk/poll&#45;compat.h" alt="" coords="1239,229,1403,256"/>
<area shape="rect" id="node30" href="../../d6/d66/include_2asterisk_2frame_8h.html" title="Asterisk internal frame definitions. " alt="" coords="895,304,1022,331"/>
<area shape="rect" id="node31" href="../../d9/de7/chanvars_8h.html" title="Channel Variables. " alt="" coords="1681,229,1828,256"/>
<area shape="rect" id="node32" href="../../d3/de6/include_2asterisk_2config_8h.html" title="Configuration File Parser. " alt="" coords="1653,304,1779,331"/>
<area shape="rect" id="node33" href="../../dc/d07/cdr_8h.html" title="Call Detail Record API. " alt="" coords="169,229,276,256"/>
<area shape="rect" id="node34" href="../../d9/db6/datastore_8h.html" title="Asterisk datastore objects. " alt="" coords="425,528,575,555"/>
<area shape="rect" id="node35" href="../../d0/d3c/format__cap_8h.html" title="Format Capabilities API. " alt="" coords="301,229,462,256"/>
<area shape="rect" id="node36" href="../../d9/d95/channelstate_8h.html" title="Channel states. " alt="" coords="93,379,264,405"/>
<area shape="rect" id="node37" href="../../de/dc8/ccss_8h.html" title="Call Completion Supplementary Services API. " alt="" coords="538,229,654,256"/>
<area shape="rect" id="node39" href="../../db/d3c/framehook_8h.html" title="FrameHook Architecture. " alt="" coords="729,229,887,256"/>
<area shape="rect" id="node40" href="../../dd/d79/stasis_8h.html" title="Stasis Message Bus API. See Stasis Message Bus API for detailed documentation. " alt="" coords="1804,304,1929,331"/>
<area shape="rect" id="node41" href="../../d4/d61/endpoints_8h.html" title="Endpoint abstractions. " alt="" coords="911,229,1062,256"/>
<area shape="rect" id="node28" href="../../d0/d0a/format_8h.html" title="Media Format API. " alt="" coords="1097,379,1228,405"/>
<area shape="rect" id="node38" href="../../da/da2/devicestate_8h.html" title="Device state management. " alt="" coords="651,304,813,331"/>
<area shape="rect" id="node43" href="../../d7/d00/sched_8h.html" title="Scheduler Routines (derived from cheops) " alt="" coords="1801,155,1927,181"/>
<area shape="rect" id="node44" href="../../d6/dd7/presencestate_8h.html" title="Presence state management. " alt="" coords="1951,155,2131,181"/>
<area shape="rect" id="node45" href="../../d6/da0/hashtab_8h.html" title="Generic (perhaps overly so) hashtable implementation Hash Table support in Asterisk. " alt="" coords="1911,603,2051,629"/>
<area shape="rect" id="node46" href="../../d1/d99/xmldoc_8h.html" title="Asterisk XML Documentation API. " alt="" coords="2149,379,2283,405"/>
</map>
</div>
</div>
<p><a href="../../d4/daa/func__env_8c_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="define-members"></a>
Macros</h2></td></tr>
<tr class="memitem:ad2682ceb1f8ed7d6551cd75454aa25c4"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d4/daa/func__env_8c.html#ad2682ceb1f8ed7d6551cd75454aa25c4">LINE_COUNTER</a>(cptr,  term,  counter)</td></tr>
<tr class="separator:ad2682ceb1f8ed7d6551cd75454aa25c4"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="enum-members"></a>
Enumerations</h2></td></tr>
<tr class="memitem:abd81d11867ad50357ea8332e8d36cf8a"><td class="memItemLeft" align="right" valign="top">enum &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d4/daa/func__env_8c.html#abd81d11867ad50357ea8332e8d36cf8a">file_format</a> { <a class="el" href="../../d4/daa/func__env_8c.html#abd81d11867ad50357ea8332e8d36cf8aa002a351c4fed7e3b7dbc83129ecc397e">FF_UNKNOWN</a> = -1, 
<a class="el" href="../../d4/daa/func__env_8c.html#abd81d11867ad50357ea8332e8d36cf8aa073f48545d1fcf02ce4bf0a9619914ca">FF_UNIX</a>, 
<a class="el" href="../../d4/daa/func__env_8c.html#abd81d11867ad50357ea8332e8d36cf8aa7c12b0aea0d0de06a80877d724b86525">FF_DOS</a>, 
<a class="el" href="../../d4/daa/func__env_8c.html#abd81d11867ad50357ea8332e8d36cf8aaf1329bf6f765b89c787e5a5151db2102">FF_MAC</a>
 }</td></tr>
<tr class="separator:abd81d11867ad50357ea8332e8d36cf8a"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a88b7c88fed6b80fd18f34f97757dfc04"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d4/daa/func__env_8c.html#a88b7c88fed6b80fd18f34f97757dfc04">__reg_module</a> (void)</td></tr>
<tr class="separator:a88b7c88fed6b80fd18f34f97757dfc04"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:afeab1257bd17282b95875499393a147a"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d4/daa/func__env_8c.html#afeab1257bd17282b95875499393a147a">__unreg_module</a> (void)</td></tr>
<tr class="separator:afeab1257bd17282b95875499393a147a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4fb0aca9bbcdb9709fa52a70aded6cae"><td class="memItemLeft" align="right" valign="top">struct <a class="el" href="../../d9/df5/structast__module.html">ast_module</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d4/daa/func__env_8c.html#a4fb0aca9bbcdb9709fa52a70aded6cae">AST_MODULE_SELF_SYM</a> (void)</td></tr>
<tr class="separator:a4fb0aca9bbcdb9709fa52a70aded6cae"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a34b3047dd79c835f08704ae4348b9b36"><td class="memItemLeft" align="right" valign="top">static int64_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d4/daa/func__env_8c.html#a34b3047dd79c835f08704ae4348b9b36">count_lines</a> (const char *filename, enum <a class="el" href="../../d4/daa/func__env_8c.html#abd81d11867ad50357ea8332e8d36cf8a">file_format</a> newline_format)</td></tr>
<tr class="separator:a34b3047dd79c835f08704ae4348b9b36"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5c51c4b5326bf3113ae5c5593ef47e8d"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d4/daa/func__env_8c.html#a5c51c4b5326bf3113ae5c5593ef47e8d">env_read</a> (struct <a class="el" href="../../df/d3c/structast__channel.html">ast_channel</a> *chan, const char *cmd, char *data, char *<a class="el" href="../../dd/d7c/eagi__proxy_8c.html#ac95651d79c608a3148973b5b1fc9e525">buf</a>, size_t <a class="el" href="../../d9/d1e/func__strings_8c.html#af24e73aaf92f3000fda15d285e66df24">len</a>)</td></tr>
<tr class="separator:a5c51c4b5326bf3113ae5c5593ef47e8d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a05b024411e5c6c79e3883e7c7bfdb061"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d4/daa/func__env_8c.html#a05b024411e5c6c79e3883e7c7bfdb061">env_write</a> (struct <a class="el" href="../../df/d3c/structast__channel.html">ast_channel</a> *chan, const char *cmd, char *data, const char *<a class="el" href="../../d5/dde/test__func__file_8c.html#a8556878012feffc9e0beb86cd78f424d">value</a>)</td></tr>
<tr class="separator:a05b024411e5c6c79e3883e7c7bfdb061"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4afbbc5eaddf30a658b75c9e2f7b4ee3"><td class="memItemLeft" align="right" valign="top">static enum <a class="el" href="../../d4/daa/func__env_8c.html#abd81d11867ad50357ea8332e8d36cf8a">file_format</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d4/daa/func__env_8c.html#a4afbbc5eaddf30a658b75c9e2f7b4ee3">file2format</a> (const char *filename)</td></tr>
<tr class="separator:a4afbbc5eaddf30a658b75c9e2f7b4ee3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a74f5988113b2cba86f2d8bdb6cdc92ae"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d4/daa/func__env_8c.html#a74f5988113b2cba86f2d8bdb6cdc92ae">file_count_line</a> (struct <a class="el" href="../../df/d3c/structast__channel.html">ast_channel</a> *chan, const char *cmd, char *data, struct <a class="el" href="../../dd/da2/structast__str.html">ast_str</a> **<a class="el" href="../../dd/d7c/eagi__proxy_8c.html#ac95651d79c608a3148973b5b1fc9e525">buf</a>, ssize_t <a class="el" href="../../d9/d1e/func__strings_8c.html#af24e73aaf92f3000fda15d285e66df24">len</a>)</td></tr>
<tr class="separator:a74f5988113b2cba86f2d8bdb6cdc92ae"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:afeb12a759cd5054ae2854a2ad356cf6e"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d4/daa/func__env_8c.html#afeb12a759cd5054ae2854a2ad356cf6e">file_format</a> (struct <a class="el" href="../../df/d3c/structast__channel.html">ast_channel</a> *chan, const char *cmd, char *data, struct <a class="el" href="../../dd/da2/structast__str.html">ast_str</a> **<a class="el" href="../../dd/d7c/eagi__proxy_8c.html#ac95651d79c608a3148973b5b1fc9e525">buf</a>, ssize_t <a class="el" href="../../d9/d1e/func__strings_8c.html#af24e73aaf92f3000fda15d285e66df24">len</a>)</td></tr>
<tr class="separator:afeb12a759cd5054ae2854a2ad356cf6e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:add1f9152200c079d475b65e42844f0ea"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d4/daa/func__env_8c.html#add1f9152200c079d475b65e42844f0ea">file_read</a> (struct <a class="el" href="../../df/d3c/structast__channel.html">ast_channel</a> *chan, const char *cmd, char *data, struct <a class="el" href="../../dd/da2/structast__str.html">ast_str</a> **<a class="el" href="../../dd/d7c/eagi__proxy_8c.html#ac95651d79c608a3148973b5b1fc9e525">buf</a>, ssize_t <a class="el" href="../../d9/d1e/func__strings_8c.html#af24e73aaf92f3000fda15d285e66df24">len</a>)</td></tr>
<tr class="separator:add1f9152200c079d475b65e42844f0ea"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a175689ce25a8a01263bda2409f4d0003"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d4/daa/func__env_8c.html#a175689ce25a8a01263bda2409f4d0003">file_write</a> (struct <a class="el" href="../../df/d3c/structast__channel.html">ast_channel</a> *chan, const char *cmd, char *data, const char *<a class="el" href="../../d5/dde/test__func__file_8c.html#a8556878012feffc9e0beb86cd78f424d">value</a>)</td></tr>
<tr class="separator:a175689ce25a8a01263bda2409f4d0003"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9cc0a8665ffb4519792ae07a380a2753"><td class="memItemLeft" align="right" valign="top">const char *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d4/daa/func__env_8c.html#a9cc0a8665ffb4519792ae07a380a2753">format2term</a> (enum <a class="el" href="../../d4/daa/func__env_8c.html#abd81d11867ad50357ea8332e8d36cf8a">file_format</a> f)</td></tr>
<tr class="separator:a9cc0a8665ffb4519792ae07a380a2753"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac3382bf6da54c56b37069bd76bbdf4f9"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d4/daa/func__env_8c.html#ac3382bf6da54c56b37069bd76bbdf4f9">load_module</a> (void)</td></tr>
<tr class="separator:ac3382bf6da54c56b37069bd76bbdf4f9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa57fd1166ed1411c59ff39ce109e28dc"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d4/daa/func__env_8c.html#aa57fd1166ed1411c59ff39ce109e28dc">stat_read</a> (struct <a class="el" href="../../df/d3c/structast__channel.html">ast_channel</a> *chan, const char *cmd, char *data, char *<a class="el" href="../../dd/d7c/eagi__proxy_8c.html#ac95651d79c608a3148973b5b1fc9e525">buf</a>, size_t <a class="el" href="../../d9/d1e/func__strings_8c.html#af24e73aaf92f3000fda15d285e66df24">len</a>)</td></tr>
<tr class="separator:aa57fd1166ed1411c59ff39ce109e28dc"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad09fa931f468002152a3cc2d5ce25eae"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d4/daa/func__env_8c.html#ad09fa931f468002152a3cc2d5ce25eae">unload_module</a> (void)</td></tr>
<tr class="separator:ad09fa931f468002152a3cc2d5ce25eae"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="var-members"></a>
Variables</h2></td></tr>
<tr class="memitem:ab22f32016155f7f403e7178767163d7d"><td class="memItemLeft" align="right" valign="top">static struct <a class="el" href="../../dd/d5f/structast__module__info.html">ast_module_info</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d4/daa/func__env_8c.html#ab22f32016155f7f403e7178767163d7d">__mod_info</a> = { .<a class="el" href="../../d1/da4/res__corosync_8c.html#a8f8f80d37794cde9472343e4487ba3eb">name</a> = <a class="el" href="../../da/ddd/named__acl_8c.html#aec23fc5034c3bb08140fc021f4955877">AST_MODULE</a>, .flags = <a class="el" href="../../d5/d16/module_8h.html#a155a0df9c59e04e305d4a2fa3e35f843a12c3f60dd7655dfa8d4430cbf04b1223">AST_MODFLAG_LOAD_ORDER</a> , .description = &quot;Environment/filesystem dialplan functions&quot; , .key = &quot;This paragraph is copyright (<a class="el" href="../../d7/d6f/test__linkedlists_8c.html#acd9db00336027462cfb25b97b5356883">c</a>) 2006 by Digium, Inc. \In <a class="el" href="../../d5/d14/voicin_8c.html#aed7ca058008dc3e5ee131e575abed285">order</a> for your module to load, it must return this \key via <a class="el" href="../../d7/d6f/test__linkedlists_8c.html#a13dd15487fee89a002d17ef3aff62d02">a</a> function called \&quot;key\&quot;. Any code which \includes this paragraph must <a class="el" href="../../dd/d7c/eagi__proxy_8c.html#a39730e90126aad69cfc9ca4d6fcdb3a6">be</a> licensed under the GNU \General Public License <a class="el" href="../../da/d7c/utils_2frame_8h.html#a56abfaab87c46691c1ef3ad0df23e864">version</a> 2 or later (at your \option). In addition to Digium's general reservations \of rights, Digium expressly reserves the right to \allow other parties to license this paragraph under \different terms. Any use of Digium, Inc. trademarks or \logos (including \&quot;Asterisk\&quot; or \&quot;Digium\&quot;) without \express written <a class="el" href="../../d4/d4c/structpermission.html">permission</a> of Digium, Inc. is prohibited.\n&quot; , .buildopt_sum = &quot;30ef0c93b36035ec78c9cfd712d36d9b&quot; , .load = load_module, .unload = unload_module, .load_pri = AST_MODPRI_DEFAULT, .support_level = AST_MODULE_SUPPORT_CORE, }</td></tr>
<tr class="separator:ab22f32016155f7f403e7178767163d7d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad60e83b9aa660040fed4d5377966cc21"><td class="memItemLeft" align="right" valign="top">static const struct <a class="el" href="../../dd/d5f/structast__module__info.html">ast_module_info</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d4/daa/func__env_8c.html#ad60e83b9aa660040fed4d5377966cc21">ast_module_info</a> = &amp;<a class="el" href="../../d6/d7a/test__xml__escape_8c.html#ab22f32016155f7f403e7178767163d7d">__mod_info</a></td></tr>
<tr class="separator:ad60e83b9aa660040fed4d5377966cc21"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6b67a1aba70acfa8c3c5ef192fa56932"><td class="memItemLeft" align="right" valign="top">static struct <a class="el" href="../../db/dc0/structast__custom__function.html">ast_custom_function</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d4/daa/func__env_8c.html#a6b67a1aba70acfa8c3c5ef192fa56932">env_function</a></td></tr>
<tr class="separator:a6b67a1aba70acfa8c3c5ef192fa56932"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a17ea170150ac5c64cf33944d8cd8ba41"><td class="memItemLeft" align="right" valign="top">static struct <a class="el" href="../../db/dc0/structast__custom__function.html">ast_custom_function</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d4/daa/func__env_8c.html#a17ea170150ac5c64cf33944d8cd8ba41">file_count_line_function</a></td></tr>
<tr class="separator:a17ea170150ac5c64cf33944d8cd8ba41"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0f7287e3ba226430598c894a31fb2ad5"><td class="memItemLeft" align="right" valign="top">static struct <a class="el" href="../../db/dc0/structast__custom__function.html">ast_custom_function</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d4/daa/func__env_8c.html#a0f7287e3ba226430598c894a31fb2ad5">file_format_function</a></td></tr>
<tr class="separator:a0f7287e3ba226430598c894a31fb2ad5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab4313cc35ebf797006bea982b3bd34e4"><td class="memItemLeft" align="right" valign="top">static struct <a class="el" href="../../db/dc0/structast__custom__function.html">ast_custom_function</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d4/daa/func__env_8c.html#ab4313cc35ebf797006bea982b3bd34e4">file_function</a></td></tr>
<tr class="separator:ab4313cc35ebf797006bea982b3bd34e4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac0eb4828f9ab570b1cbb5e122ffa039b"><td class="memItemLeft" align="right" valign="top">static struct <a class="el" href="../../db/dc0/structast__custom__function.html">ast_custom_function</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d4/daa/func__env_8c.html#ac0eb4828f9ab570b1cbb5e122ffa039b">stat_function</a></td></tr>
<tr class="separator:ac0eb4828f9ab570b1cbb5e122ffa039b"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Environment related dialplan functions. </p>

<p class="definition">Definition in file <a class="el" href="../../d4/daa/func__env_8c_source.html">func_env.c</a>.</p>
</div><h2 class="groupheader">Macro Definition Documentation</h2>
<a id="ad2682ceb1f8ed7d6551cd75454aa25c4"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad2682ceb1f8ed7d6551cd75454aa25c4">&#9670;&nbsp;</a></span>LINE_COUNTER</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define LINE_COUNTER</td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">cptr, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">term, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">counter&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="../../d4/daa/func__env_8c_source.html#l00425">425</a> of file <a class="el" href="../../d4/daa/func__env_8c_source.html">func_env.c</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../d4/daa/func__env_8c_source.html#l00486">file_read()</a>, and <a class="el" href="../../d4/daa/func__env_8c_source.html#l00746">file_write()</a>.</p>

</div>
</div>
<h2 class="groupheader">Enumeration Type Documentation</h2>
<a id="abd81d11867ad50357ea8332e8d36cf8a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#abd81d11867ad50357ea8332e8d36cf8a">&#9670;&nbsp;</a></span>file_format</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">enum <a class="el" href="../../d4/daa/func__env_8c.html#abd81d11867ad50357ea8332e8d36cf8a">file_format</a></td>
        </tr>
      </table>
</div><div class="memdoc">
<table class="fieldtable">
<tr><th colspan="2">Enumerator</th></tr><tr><td class="fieldname"><a id="abd81d11867ad50357ea8332e8d36cf8aa002a351c4fed7e3b7dbc83129ecc397e"></a>FF_UNKNOWN&#160;</td><td class="fielddoc"></td></tr>
<tr><td class="fieldname"><a id="abd81d11867ad50357ea8332e8d36cf8aa073f48545d1fcf02ce4bf0a9619914ca"></a>FF_UNIX&#160;</td><td class="fielddoc"></td></tr>
<tr><td class="fieldname"><a id="abd81d11867ad50357ea8332e8d36cf8aa7c12b0aea0d0de06a80877d724b86525"></a>FF_DOS&#160;</td><td class="fielddoc"></td></tr>
<tr><td class="fieldname"><a id="abd81d11867ad50357ea8332e8d36cf8aaf1329bf6f765b89c787e5a5151db2102"></a>FF_MAC&#160;</td><td class="fielddoc"></td></tr>
</table>

<p class="definition">Definition at line <a class="el" href="../../d4/daa/func__env_8c_source.html#l00318">318</a> of file <a class="el" href="../../d4/daa/func__env_8c_source.html">func_env.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;                 {</div><div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;   <a class="code" href="../../d4/daa/func__env_8c.html#abd81d11867ad50357ea8332e8d36cf8aa002a351c4fed7e3b7dbc83129ecc397e">FF_UNKNOWN</a> = -1,</div><div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;   <a class="code" href="../../d4/daa/func__env_8c.html#abd81d11867ad50357ea8332e8d36cf8aa073f48545d1fcf02ce4bf0a9619914ca">FF_UNIX</a>,</div><div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;   <a class="code" href="../../d4/daa/func__env_8c.html#abd81d11867ad50357ea8332e8d36cf8aa7c12b0aea0d0de06a80877d724b86525">FF_DOS</a>,</div><div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;   <a class="code" href="../../d4/daa/func__env_8c.html#abd81d11867ad50357ea8332e8d36cf8aaf1329bf6f765b89c787e5a5151db2102">FF_MAC</a>,</div><div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;};</div><div class="ttc" id="func__env_8c_html_abd81d11867ad50357ea8332e8d36cf8aaf1329bf6f765b89c787e5a5151db2102"><div class="ttname"><a href="../../d4/daa/func__env_8c.html#abd81d11867ad50357ea8332e8d36cf8aaf1329bf6f765b89c787e5a5151db2102">FF_MAC</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d4/daa/func__env_8c_source.html#l00322">func_env.c:322</a></div></div>
<div class="ttc" id="func__env_8c_html_abd81d11867ad50357ea8332e8d36cf8aa002a351c4fed7e3b7dbc83129ecc397e"><div class="ttname"><a href="../../d4/daa/func__env_8c.html#abd81d11867ad50357ea8332e8d36cf8aa002a351c4fed7e3b7dbc83129ecc397e">FF_UNKNOWN</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d4/daa/func__env_8c_source.html#l00319">func_env.c:319</a></div></div>
<div class="ttc" id="func__env_8c_html_abd81d11867ad50357ea8332e8d36cf8aa073f48545d1fcf02ce4bf0a9619914ca"><div class="ttname"><a href="../../d4/daa/func__env_8c.html#abd81d11867ad50357ea8332e8d36cf8aa073f48545d1fcf02ce4bf0a9619914ca">FF_UNIX</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d4/daa/func__env_8c_source.html#l00320">func_env.c:320</a></div></div>
<div class="ttc" id="func__env_8c_html_abd81d11867ad50357ea8332e8d36cf8aa7c12b0aea0d0de06a80877d724b86525"><div class="ttname"><a href="../../d4/daa/func__env_8c.html#abd81d11867ad50357ea8332e8d36cf8aa7c12b0aea0d0de06a80877d724b86525">FF_DOS</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d4/daa/func__env_8c_source.html#l00321">func_env.c:321</a></div></div>
</div><!-- fragment -->
</div>
</div>
<h2 class="groupheader">Function Documentation</h2>
<a id="a88b7c88fed6b80fd18f34f97757dfc04"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a88b7c88fed6b80fd18f34f97757dfc04">&#9670;&nbsp;</a></span>__reg_module()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void __reg_module </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="../../d4/daa/func__env_8c_source.html#l01289">1289</a> of file <a class="el" href="../../d4/daa/func__env_8c_source.html">func_env.c</a>.</p>

</div>
</div>
<a id="afeab1257bd17282b95875499393a147a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#afeab1257bd17282b95875499393a147a">&#9670;&nbsp;</a></span>__unreg_module()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void __unreg_module </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="../../d4/daa/func__env_8c_source.html#l01289">1289</a> of file <a class="el" href="../../d4/daa/func__env_8c_source.html">func_env.c</a>.</p>

</div>
</div>
<a id="a4fb0aca9bbcdb9709fa52a70aded6cae"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4fb0aca9bbcdb9709fa52a70aded6cae">&#9670;&nbsp;</a></span>AST_MODULE_SELF_SYM()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="../../d9/df5/structast__module.html">ast_module</a>* AST_MODULE_SELF_SYM </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="../../d4/daa/func__env_8c_source.html#l01289">1289</a> of file <a class="el" href="../../d4/daa/func__env_8c_source.html">func_env.c</a>.</p>

</div>
</div>
<a id="a34b3047dd79c835f08704ae4348b9b36"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a34b3047dd79c835f08704ae4348b9b36">&#9670;&nbsp;</a></span>count_lines()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int64_t count_lines </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>filename</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">enum <a class="el" href="../../d4/daa/func__env_8c.html#abd81d11867ad50357ea8332e8d36cf8a">file_format</a>&#160;</td>
          <td class="paramname"><em>newline_format</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="../../d4/daa/func__env_8c_source.html#l00325">325</a> of file <a class="el" href="../../d4/daa/func__env_8c_source.html">func_env.c</a>.</p>

<p class="reference">References <a class="el" href="../../da/df7/astobj2_8c_source.html#l00042">ast_log</a>, <a class="el" href="../../d1/d6e/main_2stdtime_2private_8h.html#ad65a8842cc674e3ddf69355898c0ecbf">errno</a>, <a class="el" href="../../d4/daa/func__env_8c_source.html#l00321">FF_DOS</a>, <a class="el" href="../../d4/daa/func__env_8c_source.html#l00322">FF_MAC</a>, <a class="el" href="../../d4/daa/func__env_8c_source.html#l00320">FF_UNIX</a>, <a class="el" href="../../d4/daa/func__env_8c_source.html#l00319">FF_UNKNOWN</a>, <a class="el" href="../../d1/d8c/logger_8h_source.html#l00285">LOG_ERROR</a>, and <a class="el" href="../../dc/d7f/resample_8c_source.html#l00096">NULL</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../d4/daa/func__env_8c_source.html#l00400">file_count_line()</a>.</p>
<div class="fragment"><div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;{</div><div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;   <span class="keywordtype">int</span> count = 0;</div><div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;   <span class="keywordtype">char</span> fbuf[4096];</div><div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;   FILE *ff;</div><div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;</div><div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;   <span class="keywordflow">if</span> (!(ff = fopen(filename, <span class="stringliteral">&quot;r&quot;</span>))) {</div><div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Unable to open &#39;%s&#39;: %s\n&quot;</span>, filename, strerror(<a class="code" href="../../d1/d6e/main_2stdtime_2private_8h.html#ad65a8842cc674e3ddf69355898c0ecbf">errno</a>));</div><div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;   }</div><div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;</div><div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;   <span class="keywordflow">while</span> (fgets(fbuf, <span class="keyword">sizeof</span>(fbuf), ff)) {</div><div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;      <span class="keywordtype">char</span> *next = fbuf, *first_cr = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, *first_nl = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;</div><div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;      <span class="comment">/* Must do it this way, because if the fileformat is FF_MAC, then Unix</span></div><div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;<span class="comment">       * assumptions about line-format will not come into play. */</span></div><div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;      <span class="keywordflow">while</span> (next) {</div><div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;         <span class="keywordflow">if</span> (newline_format == <a class="code" href="../../d4/daa/func__env_8c.html#abd81d11867ad50357ea8332e8d36cf8aa7c12b0aea0d0de06a80877d724b86525">FF_DOS</a> || newline_format == <a class="code" href="../../d4/daa/func__env_8c.html#abd81d11867ad50357ea8332e8d36cf8aaf1329bf6f765b89c787e5a5151db2102">FF_MAC</a> || newline_format == <a class="code" href="../../d4/daa/func__env_8c.html#abd81d11867ad50357ea8332e8d36cf8aa002a351c4fed7e3b7dbc83129ecc397e">FF_UNKNOWN</a>) {</div><div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;            first_cr = strchr(next, <span class="charliteral">&#39;\r&#39;</span>);</div><div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;         }</div><div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;         <span class="keywordflow">if</span> (newline_format == <a class="code" href="../../d4/daa/func__env_8c.html#abd81d11867ad50357ea8332e8d36cf8aa073f48545d1fcf02ce4bf0a9619914ca">FF_UNIX</a> || newline_format == <a class="code" href="../../d4/daa/func__env_8c.html#abd81d11867ad50357ea8332e8d36cf8aa002a351c4fed7e3b7dbc83129ecc397e">FF_UNKNOWN</a>) {</div><div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;            first_nl = strchr(next, <span class="charliteral">&#39;\n&#39;</span>);</div><div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;         }</div><div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;</div><div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;         <span class="comment">/* No terminators found in buffer */</span></div><div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;         <span class="keywordflow">if</span> (!first_cr &amp;&amp; !first_nl) {</div><div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;         }</div><div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;</div><div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;         <span class="keywordflow">if</span> (newline_format == <a class="code" href="../../d4/daa/func__env_8c.html#abd81d11867ad50357ea8332e8d36cf8aa002a351c4fed7e3b7dbc83129ecc397e">FF_UNKNOWN</a>) {</div><div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;            <span class="keywordflow">if</span> ((first_cr &amp;&amp; !first_nl) || (first_cr &amp;&amp; first_cr &lt; first_nl)) {</div><div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;               <span class="keywordflow">if</span> (first_nl &amp;&amp; first_nl == first_cr + 1) {</div><div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;                  newline_format = <a class="code" href="../../d4/daa/func__env_8c.html#abd81d11867ad50357ea8332e8d36cf8aa7c12b0aea0d0de06a80877d724b86525">FF_DOS</a>;</div><div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;               } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (first_cr &amp;&amp; first_cr == &amp;fbuf[<span class="keyword">sizeof</span>(fbuf) - 2]) {</div><div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;                  <span class="comment">/* Get it on the next pass */</span></div><div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;                  fseek(ff, -1, SEEK_CUR);</div><div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;                  <span class="keywordflow">break</span>;</div><div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;               } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;                  newline_format = <a class="code" href="../../d4/daa/func__env_8c.html#abd81d11867ad50357ea8332e8d36cf8aaf1329bf6f765b89c787e5a5151db2102">FF_MAC</a>;</div><div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;                  first_nl = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;               }</div><div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;            } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;               newline_format = <a class="code" href="../../d4/daa/func__env_8c.html#abd81d11867ad50357ea8332e8d36cf8aa073f48545d1fcf02ce4bf0a9619914ca">FF_UNIX</a>;</div><div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;               first_cr = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;            }</div><div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;            <span class="comment">/* Jump down into next section */</span></div><div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;         }</div><div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;</div><div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;         <span class="keywordflow">if</span> (newline_format == <a class="code" href="../../d4/daa/func__env_8c.html#abd81d11867ad50357ea8332e8d36cf8aa7c12b0aea0d0de06a80877d724b86525">FF_DOS</a>) {</div><div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;            <span class="keywordflow">if</span> (first_nl &amp;&amp; first_cr &amp;&amp; first_nl == first_cr + 1) {</div><div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;               next = first_nl + 1;</div><div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;               count++;</div><div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;            } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (first_cr == &amp;fbuf[<span class="keyword">sizeof</span>(fbuf) - 2]) {</div><div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;               <span class="comment">/* Get it on the next pass */</span></div><div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;               fseek(ff, -1, SEEK_CUR);</div><div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;               <span class="keywordflow">break</span>;</div><div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;            }</div><div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (newline_format == <a class="code" href="../../d4/daa/func__env_8c.html#abd81d11867ad50357ea8332e8d36cf8aaf1329bf6f765b89c787e5a5151db2102">FF_MAC</a>) {</div><div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;            <span class="keywordflow">if</span> (first_cr) {</div><div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;               next = first_cr + 1;</div><div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;               count++;</div><div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;            }</div><div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (newline_format == <a class="code" href="../../d4/daa/func__env_8c.html#abd81d11867ad50357ea8332e8d36cf8aa073f48545d1fcf02ce4bf0a9619914ca">FF_UNIX</a>) {</div><div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;            <span class="keywordflow">if</span> (first_nl) {</div><div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;               next = first_nl + 1;</div><div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;               count++;</div><div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;            }</div><div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;         }</div><div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;      }</div><div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;   }</div><div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;   fclose(ff);</div><div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;</div><div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;   <span class="keywordflow">return</span> count;</div><div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;}</div><div class="ttc" id="func__env_8c_html_abd81d11867ad50357ea8332e8d36cf8aaf1329bf6f765b89c787e5a5151db2102"><div class="ttname"><a href="../../d4/daa/func__env_8c.html#abd81d11867ad50357ea8332e8d36cf8aaf1329bf6f765b89c787e5a5151db2102">FF_MAC</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d4/daa/func__env_8c_source.html#l00322">func_env.c:322</a></div></div>
<div class="ttc" id="resample_8c_html_a070d2ce7b6bb7e5c05602aa8c308d0c4"><div class="ttname"><a href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a></div><div class="ttdeci">#define NULL</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d7f/resample_8c_source.html#l00096">resample.c:96</a></div></div>
<div class="ttc" id="astobj2_8c_html_a96a00b3a518d7f32b6d51dc28f09bf9b"><div class="ttname"><a href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a></div><div class="ttdeci">#define ast_log</div><div class="ttdef"><b>Definition:</b> <a href="../../da/df7/astobj2_8c_source.html#l00042">astobj2.c:42</a></div></div>
<div class="ttc" id="func__env_8c_html_abd81d11867ad50357ea8332e8d36cf8aa002a351c4fed7e3b7dbc83129ecc397e"><div class="ttname"><a href="../../d4/daa/func__env_8c.html#abd81d11867ad50357ea8332e8d36cf8aa002a351c4fed7e3b7dbc83129ecc397e">FF_UNKNOWN</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d4/daa/func__env_8c_source.html#l00319">func_env.c:319</a></div></div>
<div class="ttc" id="logger_8h_html_aced66975c154ea0e2a8ec3bc818b4e08"><div class="ttname"><a href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a></div><div class="ttdeci">#define LOG_ERROR</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d8c/logger_8h_source.html#l00285">logger.h:285</a></div></div>
<div class="ttc" id="main_2stdtime_2private_8h_html_ad65a8842cc674e3ddf69355898c0ecbf"><div class="ttname"><a href="../../d1/d6e/main_2stdtime_2private_8h.html#ad65a8842cc674e3ddf69355898c0ecbf">errno</a></div><div class="ttdeci">int errno</div></div>
<div class="ttc" id="func__env_8c_html_abd81d11867ad50357ea8332e8d36cf8aa073f48545d1fcf02ce4bf0a9619914ca"><div class="ttname"><a href="../../d4/daa/func__env_8c.html#abd81d11867ad50357ea8332e8d36cf8aa073f48545d1fcf02ce4bf0a9619914ca">FF_UNIX</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d4/daa/func__env_8c_source.html#l00320">func_env.c:320</a></div></div>
<div class="ttc" id="func__env_8c_html_abd81d11867ad50357ea8332e8d36cf8aa7c12b0aea0d0de06a80877d724b86525"><div class="ttname"><a href="../../d4/daa/func__env_8c.html#abd81d11867ad50357ea8332e8d36cf8aa7c12b0aea0d0de06a80877d724b86525">FF_DOS</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d4/daa/func__env_8c_source.html#l00321">func_env.c:321</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a5c51c4b5326bf3113ae5c5593ef47e8d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a5c51c4b5326bf3113ae5c5593ef47e8d">&#9670;&nbsp;</a></span>env_read()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int env_read </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="../../df/d3c/structast__channel.html">ast_channel</a> *&#160;</td>
          <td class="paramname"><em>chan</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>cmd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>data</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>buf</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>len</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="../../d4/daa/func__env_8c_source.html#l00245">245</a> of file <a class="el" href="../../d4/daa/func__env_8c_source.html">func_env.c</a>.</p>

<p class="reference">References <a class="el" href="../../d6/d90/strings_8h_source.html#l00401">ast_copy_string()</a>, and <a class="el" href="../../dc/d7f/resample_8c_source.html#l00096">NULL</a>.</p>
<div class="fragment"><div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;{</div><div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;   <span class="keywordtype">char</span> *ret = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;</div><div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;   *<a class="code" href="../../dd/d7c/eagi__proxy_8c.html#ac95651d79c608a3148973b5b1fc9e525">buf</a> = <span class="charliteral">&#39;\0&#39;</span>;</div><div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;</div><div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;   <span class="keywordflow">if</span> (data)</div><div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;      ret = getenv(data);</div><div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;</div><div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;   <span class="keywordflow">if</span> (ret)</div><div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;      <a class="code" href="../../d6/d90/strings_8h.html#ac4040268f7b6ed77dfc49c7767626369">ast_copy_string</a>(<a class="code" href="../../dd/d7c/eagi__proxy_8c.html#ac95651d79c608a3148973b5b1fc9e525">buf</a>, ret, <a class="code" href="../../d9/d1e/func__strings_8c.html#af24e73aaf92f3000fda15d285e66df24">len</a>);</div><div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;</div><div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;   <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;}</div><div class="ttc" id="eagi__proxy_8c_html_ac95651d79c608a3148973b5b1fc9e525"><div class="ttname"><a href="../../dd/d7c/eagi__proxy_8c.html#ac95651d79c608a3148973b5b1fc9e525">buf</a></div><div class="ttdeci">char buf[BUFSIZE]</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d7c/eagi__proxy_8c_source.html#l00066">eagi_proxy.c:66</a></div></div>
<div class="ttc" id="resample_8c_html_a070d2ce7b6bb7e5c05602aa8c308d0c4"><div class="ttname"><a href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a></div><div class="ttdeci">#define NULL</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d7f/resample_8c_source.html#l00096">resample.c:96</a></div></div>
<div class="ttc" id="func__strings_8c_html_af24e73aaf92f3000fda15d285e66df24"><div class="ttname"><a href="../../d9/d1e/func__strings_8c.html#af24e73aaf92f3000fda15d285e66df24">len</a></div><div class="ttdeci">static int len(struct ast_channel *chan, const char *cmd, char *data, char *buf, size_t buflen)</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d1e/func__strings_8c_source.html#l01344">func_strings.c:1344</a></div></div>
<div class="ttc" id="strings_8h_html_ac4040268f7b6ed77dfc49c7767626369"><div class="ttname"><a href="../../d6/d90/strings_8h.html#ac4040268f7b6ed77dfc49c7767626369">ast_copy_string</a></div><div class="ttdeci">void ast_copy_string(char *dst, const char *src, size_t size)</div><div class="ttdoc">Size-limited null-terminating string copy. </div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d90/strings_8h_source.html#l00401">strings.h:401</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a05b024411e5c6c79e3883e7c7bfdb061"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a05b024411e5c6c79e3883e7c7bfdb061">&#9670;&nbsp;</a></span>env_write()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int env_write </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="../../df/d3c/structast__channel.html">ast_channel</a> *&#160;</td>
          <td class="paramname"><em>chan</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>cmd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>data</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>value</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="../../d4/daa/func__env_8c_source.html#l00261">261</a> of file <a class="el" href="../../d4/daa/func__env_8c_source.html">func_env.c</a>.</p>

<p class="reference">References <a class="el" href="../../d6/d90/strings_8h_source.html#l00052">ast_strlen_zero</a>, <a class="el" href="../../de/da3/include_2asterisk_2compat_8h.html#a1c8b16a3abcb4dc450a0a62b42c554dd">setenv()</a>, and <a class="el" href="../../de/da3/include_2asterisk_2compat_8h.html#a17a3a11d20a551951a4acbc3872b280c">unsetenv()</a>.</p>
<div class="fragment"><div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;{</div><div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;   <span class="keywordflow">if</span> (!<a class="code" href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a>(data) &amp;&amp; strncmp(data, <span class="stringliteral">&quot;AST_&quot;</span>, 4)) {</div><div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;      <span class="keywordflow">if</span> (!<a class="code" href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a>(<a class="code" href="../../d4/d2f/syslog_8c.html#ac4f474c82e82cbb89ca7c36dd52be0ed">value</a>)) {</div><div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;         <a class="code" href="../../de/da3/include_2asterisk_2compat_8h.html#a1c8b16a3abcb4dc450a0a62b42c554dd">setenv</a>(data, <a class="code" href="../../d4/d2f/syslog_8c.html#ac4f474c82e82cbb89ca7c36dd52be0ed">value</a>, 1);</div><div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;      } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;         <a class="code" href="../../de/da3/include_2asterisk_2compat_8h.html#a17a3a11d20a551951a4acbc3872b280c">unsetenv</a>(data);</div><div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;      }</div><div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;   }</div><div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;</div><div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;   <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;}</div><div class="ttc" id="syslog_8c_html_ac4f474c82e82cbb89ca7c36dd52be0ed"><div class="ttname"><a href="../../d4/d2f/syslog_8c.html#ac4f474c82e82cbb89ca7c36dd52be0ed">value</a></div><div class="ttdeci">int value</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d2f/syslog_8c_source.html#l00037">syslog.c:37</a></div></div>
<div class="ttc" id="strings_8h_html_a372554b7a2d69a8bd3adac5157672036"><div class="ttname"><a href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a></div><div class="ttdeci">#define ast_strlen_zero(foo)</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d90/strings_8h_source.html#l00052">strings.h:52</a></div></div>
<div class="ttc" id="include_2asterisk_2compat_8h_html_a1c8b16a3abcb4dc450a0a62b42c554dd"><div class="ttname"><a href="../../de/da3/include_2asterisk_2compat_8h.html#a1c8b16a3abcb4dc450a0a62b42c554dd">setenv</a></div><div class="ttdeci">int setenv(const char *name, const char *value, int overwrite)</div></div>
<div class="ttc" id="include_2asterisk_2compat_8h_html_a17a3a11d20a551951a4acbc3872b280c"><div class="ttname"><a href="../../de/da3/include_2asterisk_2compat_8h.html#a17a3a11d20a551951a4acbc3872b280c">unsetenv</a></div><div class="ttdeci">int unsetenv(const char *name)</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a4afbbc5eaddf30a658b75c9e2f7b4ee3"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4afbbc5eaddf30a658b75c9e2f7b4ee3">&#9670;&nbsp;</a></span>file2format()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static enum <a class="el" href="../../d4/daa/func__env_8c.html#abd81d11867ad50357ea8332e8d36cf8a">file_format</a> file2format </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>filename</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="../../d4/daa/func__env_8c_source.html#l00439">439</a> of file <a class="el" href="../../d4/daa/func__env_8c_source.html">func_env.c</a>.</p>

<p class="reference">References <a class="el" href="../../da/df7/astobj2_8c_source.html#l00042">ast_log</a>, <a class="el" href="../../d1/d6e/main_2stdtime_2private_8h.html#ad65a8842cc674e3ddf69355898c0ecbf">errno</a>, <a class="el" href="../../d4/daa/func__env_8c_source.html#l00321">FF_DOS</a>, <a class="el" href="../../d4/daa/func__env_8c_source.html#l00322">FF_MAC</a>, <a class="el" href="../../d4/daa/func__env_8c_source.html#l00320">FF_UNIX</a>, <a class="el" href="../../d4/daa/func__env_8c_source.html#l00319">FF_UNKNOWN</a>, and <a class="el" href="../../d1/d8c/logger_8h_source.html#l00285">LOG_ERROR</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../d4/daa/func__env_8c_source.html#l00479">file_format()</a>, <a class="el" href="../../d4/daa/func__env_8c_source.html#l00486">file_read()</a>, and <a class="el" href="../../d4/daa/func__env_8c_source.html#l00746">file_write()</a>.</p>
<div class="fragment"><div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;{</div><div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;   FILE *ff;</div><div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;   <span class="keywordtype">char</span> fbuf[4096];</div><div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;   <span class="keywordtype">char</span> *first_cr, *first_nl;</div><div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;   <span class="keyword">enum</span> <a class="code" href="../../d4/daa/func__env_8c.html#abd81d11867ad50357ea8332e8d36cf8a">file_format</a> newline_format = <a class="code" href="../../d4/daa/func__env_8c.html#abd81d11867ad50357ea8332e8d36cf8aa002a351c4fed7e3b7dbc83129ecc397e">FF_UNKNOWN</a>;</div><div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;</div><div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;   <span class="keywordflow">if</span> (!(ff = fopen(filename, <span class="stringliteral">&quot;r&quot;</span>))) {</div><div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Cannot open &#39;%s&#39;: %s\n&quot;</span>, filename, strerror(<a class="code" href="../../d1/d6e/main_2stdtime_2private_8h.html#ad65a8842cc674e3ddf69355898c0ecbf">errno</a>));</div><div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;   }</div><div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;</div><div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;   <span class="keywordflow">while</span> (fgets(fbuf, <span class="keyword">sizeof</span>(fbuf), ff)) {</div><div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;      first_cr = strchr(fbuf, <span class="charliteral">&#39;\r&#39;</span>);</div><div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;      first_nl = strchr(fbuf, <span class="charliteral">&#39;\n&#39;</span>);</div><div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;</div><div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;      <span class="keywordflow">if</span> (!first_cr &amp;&amp; !first_nl) {</div><div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;         <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;      }</div><div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;</div><div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;      <span class="keywordflow">if</span> ((first_cr &amp;&amp; !first_nl) || (first_cr &amp;&amp; first_cr &lt; first_nl)) {</div><div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;</div><div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;         <span class="keywordflow">if</span> (first_nl &amp;&amp; first_nl == first_cr + 1) {</div><div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;            newline_format = <a class="code" href="../../d4/daa/func__env_8c.html#abd81d11867ad50357ea8332e8d36cf8aa7c12b0aea0d0de06a80877d724b86525">FF_DOS</a>;</div><div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (first_cr &amp;&amp; first_cr == &amp;fbuf[<span class="keyword">sizeof</span>(fbuf) - 2]) {</div><div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;            <span class="comment">/* Edge case: get it on the next pass */</span></div><div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;            fseek(ff, -1, SEEK_CUR);</div><div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;            <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;         } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;            newline_format = <a class="code" href="../../d4/daa/func__env_8c.html#abd81d11867ad50357ea8332e8d36cf8aaf1329bf6f765b89c787e5a5151db2102">FF_MAC</a>;</div><div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;         }</div><div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;      } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;         newline_format = <a class="code" href="../../d4/daa/func__env_8c.html#abd81d11867ad50357ea8332e8d36cf8aa073f48545d1fcf02ce4bf0a9619914ca">FF_UNIX</a>;</div><div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;      }</div><div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;   }</div><div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;   fclose(ff);</div><div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;   <span class="keywordflow">return</span> newline_format;</div><div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;}</div><div class="ttc" id="func__env_8c_html_abd81d11867ad50357ea8332e8d36cf8aaf1329bf6f765b89c787e5a5151db2102"><div class="ttname"><a href="../../d4/daa/func__env_8c.html#abd81d11867ad50357ea8332e8d36cf8aaf1329bf6f765b89c787e5a5151db2102">FF_MAC</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d4/daa/func__env_8c_source.html#l00322">func_env.c:322</a></div></div>
<div class="ttc" id="astobj2_8c_html_a96a00b3a518d7f32b6d51dc28f09bf9b"><div class="ttname"><a href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a></div><div class="ttdeci">#define ast_log</div><div class="ttdef"><b>Definition:</b> <a href="../../da/df7/astobj2_8c_source.html#l00042">astobj2.c:42</a></div></div>
<div class="ttc" id="func__env_8c_html_abd81d11867ad50357ea8332e8d36cf8aa002a351c4fed7e3b7dbc83129ecc397e"><div class="ttname"><a href="../../d4/daa/func__env_8c.html#abd81d11867ad50357ea8332e8d36cf8aa002a351c4fed7e3b7dbc83129ecc397e">FF_UNKNOWN</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d4/daa/func__env_8c_source.html#l00319">func_env.c:319</a></div></div>
<div class="ttc" id="logger_8h_html_aced66975c154ea0e2a8ec3bc818b4e08"><div class="ttname"><a href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a></div><div class="ttdeci">#define LOG_ERROR</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d8c/logger_8h_source.html#l00285">logger.h:285</a></div></div>
<div class="ttc" id="func__env_8c_html_abd81d11867ad50357ea8332e8d36cf8a"><div class="ttname"><a href="../../d4/daa/func__env_8c.html#abd81d11867ad50357ea8332e8d36cf8a">file_format</a></div><div class="ttdeci">file_format</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/daa/func__env_8c_source.html#l00318">func_env.c:318</a></div></div>
<div class="ttc" id="main_2stdtime_2private_8h_html_ad65a8842cc674e3ddf69355898c0ecbf"><div class="ttname"><a href="../../d1/d6e/main_2stdtime_2private_8h.html#ad65a8842cc674e3ddf69355898c0ecbf">errno</a></div><div class="ttdeci">int errno</div></div>
<div class="ttc" id="func__env_8c_html_abd81d11867ad50357ea8332e8d36cf8aa073f48545d1fcf02ce4bf0a9619914ca"><div class="ttname"><a href="../../d4/daa/func__env_8c.html#abd81d11867ad50357ea8332e8d36cf8aa073f48545d1fcf02ce4bf0a9619914ca">FF_UNIX</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d4/daa/func__env_8c_source.html#l00320">func_env.c:320</a></div></div>
<div class="ttc" id="func__env_8c_html_abd81d11867ad50357ea8332e8d36cf8aa7c12b0aea0d0de06a80877d724b86525"><div class="ttname"><a href="../../d4/daa/func__env_8c.html#abd81d11867ad50357ea8332e8d36cf8aa7c12b0aea0d0de06a80877d724b86525">FF_DOS</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d4/daa/func__env_8c_source.html#l00321">func_env.c:321</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a74f5988113b2cba86f2d8bdb6cdc92ae"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a74f5988113b2cba86f2d8bdb6cdc92ae">&#9670;&nbsp;</a></span>file_count_line()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int file_count_line </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="../../df/d3c/structast__channel.html">ast_channel</a> *&#160;</td>
          <td class="paramname"><em>chan</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>cmd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>data</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="../../dd/da2/structast__str.html">ast_str</a> **&#160;</td>
          <td class="paramname"><em>buf</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">ssize_t&#160;</td>
          <td class="paramname"><em>len</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="../../d4/daa/func__env_8c_source.html#l00400">400</a> of file <a class="el" href="../../d4/daa/func__env_8c_source.html">func_env.c</a>.</p>

<p class="reference">References <a class="el" href="../../d5/dde/test__func__file_8c_source.html#l00046">args</a>, <a class="el" href="../../d3/d93/include_2asterisk_2app_8h_source.html#l01232">AST_APP_ARG</a>, <a class="el" href="../../d3/d93/include_2asterisk_2app_8h_source.html#l01249">AST_DECLARE_APP_ARGS</a>, <a class="el" href="../../d3/d93/include_2asterisk_2app_8h_source.html#l01285">AST_STANDARD_APP_ARGS</a>, <a class="el" href="../../d6/d90/strings_8h_source.html#l01065">ast_str_set()</a>, <a class="el" href="../../d4/daa/func__env_8c_source.html#l00325">count_lines()</a>, <a class="el" href="../../d4/daa/func__env_8c_source.html#l00321">FF_DOS</a>, <a class="el" href="../../d4/daa/func__env_8c_source.html#l00322">FF_MAC</a>, <a class="el" href="../../d4/daa/func__env_8c_source.html#l00320">FF_UNIX</a>, <a class="el" href="../../d4/daa/func__env_8c_source.html#l00319">FF_UNKNOWN</a>, and <a class="el" href="../../da/d45/chan__alsa_8c_source.html#l00102">format</a>.</p>
<div class="fragment"><div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;{</div><div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;   <span class="keyword">enum</span> <a class="code" href="../../d4/daa/func__env_8c.html#abd81d11867ad50357ea8332e8d36cf8a">file_format</a> newline_format = <a class="code" href="../../d4/daa/func__env_8c.html#abd81d11867ad50357ea8332e8d36cf8aa002a351c4fed7e3b7dbc83129ecc397e">FF_UNKNOWN</a>;</div><div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;   int64_t count;</div><div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;   <a class="code" href="../../d3/d93/include_2asterisk_2app_8h.html#a80cd3f6f786b59b742bcecfc0b3be7c2">AST_DECLARE_APP_ARGS</a>(<a class="code" href="../../d5/dde/test__func__file_8c.html#a7df83d295429a2562396f1ec127a46c0">args</a>,</div><div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;      <a class="code" href="../../d3/d93/include_2asterisk_2app_8h.html#a037e9a5b28477b17e7c9acbe7ecb21d5">AST_APP_ARG</a>(filename);</div><div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;      <a class="code" href="../../d3/d93/include_2asterisk_2app_8h.html#a037e9a5b28477b17e7c9acbe7ecb21d5">AST_APP_ARG</a>(<a class="code" href="../../da/d45/chan__alsa_8c.html#a98f5e70e98f6dc48e3c5ba316066d540">format</a>);</div><div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;   );</div><div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;</div><div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;   <a class="code" href="../../d3/d93/include_2asterisk_2app_8h.html#ac08f7eb1eb9476b30987c73e1052ada8">AST_STANDARD_APP_ARGS</a>(<a class="code" href="../../d5/dde/test__func__file_8c.html#a7df83d295429a2562396f1ec127a46c0">args</a>, data);</div><div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d5/dde/test__func__file_8c.html#a7df83d295429a2562396f1ec127a46c0">args</a>.argc &gt; 1) {</div><div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;      <span class="keywordflow">if</span> (tolower(<a class="code" href="../../d5/dde/test__func__file_8c.html#a7df83d295429a2562396f1ec127a46c0">args</a>.format[0]) == <span class="charliteral">&#39;d&#39;</span>) {</div><div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;         newline_format = <a class="code" href="../../d4/daa/func__env_8c.html#abd81d11867ad50357ea8332e8d36cf8aa7c12b0aea0d0de06a80877d724b86525">FF_DOS</a>;</div><div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;      } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (tolower(<a class="code" href="../../d5/dde/test__func__file_8c.html#a7df83d295429a2562396f1ec127a46c0">args</a>.format[0]) == <span class="charliteral">&#39;m&#39;</span>) {</div><div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;         newline_format = <a class="code" href="../../d4/daa/func__env_8c.html#abd81d11867ad50357ea8332e8d36cf8aaf1329bf6f765b89c787e5a5151db2102">FF_MAC</a>;</div><div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;      } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (tolower(<a class="code" href="../../d5/dde/test__func__file_8c.html#a7df83d295429a2562396f1ec127a46c0">args</a>.format[0]) == <span class="charliteral">&#39;u&#39;</span>) {</div><div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;         newline_format = <a class="code" href="../../d4/daa/func__env_8c.html#abd81d11867ad50357ea8332e8d36cf8aa073f48545d1fcf02ce4bf0a9619914ca">FF_UNIX</a>;</div><div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;      }</div><div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;   }</div><div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;</div><div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;   count = <a class="code" href="../../d4/daa/func__env_8c.html#a34b3047dd79c835f08704ae4348b9b36">count_lines</a>(<a class="code" href="../../d5/dde/test__func__file_8c.html#a7df83d295429a2562396f1ec127a46c0">args</a>.filename, newline_format);</div><div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;   <a class="code" href="../../d6/d90/strings_8h.html#aa3341f35cedca29e60bb7f3927204283">ast_str_set</a>(buf, <a class="code" href="../../d9/d1e/func__strings_8c.html#af24e73aaf92f3000fda15d285e66df24">len</a>, <span class="stringliteral">&quot;%&quot;</span> PRId64, count);</div><div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;   <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;}</div><div class="ttc" id="func__env_8c_html_abd81d11867ad50357ea8332e8d36cf8aaf1329bf6f765b89c787e5a5151db2102"><div class="ttname"><a href="../../d4/daa/func__env_8c.html#abd81d11867ad50357ea8332e8d36cf8aaf1329bf6f765b89c787e5a5151db2102">FF_MAC</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d4/daa/func__env_8c_source.html#l00322">func_env.c:322</a></div></div>
<div class="ttc" id="include_2asterisk_2app_8h_html_ac08f7eb1eb9476b30987c73e1052ada8"><div class="ttname"><a href="../../d3/d93/include_2asterisk_2app_8h.html#ac08f7eb1eb9476b30987c73e1052ada8">AST_STANDARD_APP_ARGS</a></div><div class="ttdeci">#define AST_STANDARD_APP_ARGS(args, parse)</div><div class="ttdoc">Performs the &amp;#39;standard&amp;#39; argument separation process for an application. </div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d93/include_2asterisk_2app_8h_source.html#l01285">include/asterisk/app.h:1285</a></div></div>
<div class="ttc" id="test__func__file_8c_html_a7df83d295429a2562396f1ec127a46c0"><div class="ttname"><a href="../../d5/dde/test__func__file_8c.html#a7df83d295429a2562396f1ec127a46c0">args</a></div><div class="ttdeci">const char * args</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/dde/test__func__file_8c_source.html#l00046">test_func_file.c:46</a></div></div>
<div class="ttc" id="strings_8h_html_aa3341f35cedca29e60bb7f3927204283"><div class="ttname"><a href="../../d6/d90/strings_8h.html#aa3341f35cedca29e60bb7f3927204283">ast_str_set</a></div><div class="ttdeci">int ast_str_set(struct ast_str **buf, ssize_t max_len, const char *fmt,...)</div><div class="ttdoc">Set a dynamic string using variable arguments. </div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d90/strings_8h_source.html#l01065">strings.h:1065</a></div></div>
<div class="ttc" id="func__env_8c_html_a34b3047dd79c835f08704ae4348b9b36"><div class="ttname"><a href="../../d4/daa/func__env_8c.html#a34b3047dd79c835f08704ae4348b9b36">count_lines</a></div><div class="ttdeci">static int64_t count_lines(const char *filename, enum file_format newline_format)</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/daa/func__env_8c_source.html#l00325">func_env.c:325</a></div></div>
<div class="ttc" id="func__env_8c_html_abd81d11867ad50357ea8332e8d36cf8aa002a351c4fed7e3b7dbc83129ecc397e"><div class="ttname"><a href="../../d4/daa/func__env_8c.html#abd81d11867ad50357ea8332e8d36cf8aa002a351c4fed7e3b7dbc83129ecc397e">FF_UNKNOWN</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d4/daa/func__env_8c_source.html#l00319">func_env.c:319</a></div></div>
<div class="ttc" id="func__env_8c_html_abd81d11867ad50357ea8332e8d36cf8a"><div class="ttname"><a href="../../d4/daa/func__env_8c.html#abd81d11867ad50357ea8332e8d36cf8a">file_format</a></div><div class="ttdeci">file_format</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/daa/func__env_8c_source.html#l00318">func_env.c:318</a></div></div>
<div class="ttc" id="func__strings_8c_html_af24e73aaf92f3000fda15d285e66df24"><div class="ttname"><a href="../../d9/d1e/func__strings_8c.html#af24e73aaf92f3000fda15d285e66df24">len</a></div><div class="ttdeci">static int len(struct ast_channel *chan, const char *cmd, char *data, char *buf, size_t buflen)</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d1e/func__strings_8c_source.html#l01344">func_strings.c:1344</a></div></div>
<div class="ttc" id="func__env_8c_html_abd81d11867ad50357ea8332e8d36cf8aa073f48545d1fcf02ce4bf0a9619914ca"><div class="ttname"><a href="../../d4/daa/func__env_8c.html#abd81d11867ad50357ea8332e8d36cf8aa073f48545d1fcf02ce4bf0a9619914ca">FF_UNIX</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d4/daa/func__env_8c_source.html#l00320">func_env.c:320</a></div></div>
<div class="ttc" id="chan__alsa_8c_html_a98f5e70e98f6dc48e3c5ba316066d540"><div class="ttname"><a href="../../da/d45/chan__alsa_8c.html#a98f5e70e98f6dc48e3c5ba316066d540">format</a></div><div class="ttdeci">static snd_pcm_format_t format</div><div class="ttdef"><b>Definition:</b> <a href="../../da/d45/chan__alsa_8c_source.html#l00102">chan_alsa.c:102</a></div></div>
<div class="ttc" id="include_2asterisk_2app_8h_html_a80cd3f6f786b59b742bcecfc0b3be7c2"><div class="ttname"><a href="../../d3/d93/include_2asterisk_2app_8h.html#a80cd3f6f786b59b742bcecfc0b3be7c2">AST_DECLARE_APP_ARGS</a></div><div class="ttdeci">#define AST_DECLARE_APP_ARGS(name, arglist)</div><div class="ttdoc">Declare a structure to hold an application&amp;#39;s arguments. </div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d93/include_2asterisk_2app_8h_source.html#l01249">include/asterisk/app.h:1249</a></div></div>
<div class="ttc" id="func__env_8c_html_abd81d11867ad50357ea8332e8d36cf8aa7c12b0aea0d0de06a80877d724b86525"><div class="ttname"><a href="../../d4/daa/func__env_8c.html#abd81d11867ad50357ea8332e8d36cf8aa7c12b0aea0d0de06a80877d724b86525">FF_DOS</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d4/daa/func__env_8c_source.html#l00321">func_env.c:321</a></div></div>
<div class="ttc" id="include_2asterisk_2app_8h_html_a037e9a5b28477b17e7c9acbe7ecb21d5"><div class="ttname"><a href="../../d3/d93/include_2asterisk_2app_8h.html#a037e9a5b28477b17e7c9acbe7ecb21d5">AST_APP_ARG</a></div><div class="ttdeci">#define AST_APP_ARG(name)</div><div class="ttdoc">Define an application argument. </div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d93/include_2asterisk_2app_8h_source.html#l01232">include/asterisk/app.h:1232</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="afeb12a759cd5054ae2854a2ad356cf6e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#afeb12a759cd5054ae2854a2ad356cf6e">&#9670;&nbsp;</a></span>file_format()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int <a class="el" href="../../d4/daa/func__env_8c.html#abd81d11867ad50357ea8332e8d36cf8a">file_format</a> </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="../../df/d3c/structast__channel.html">ast_channel</a> *&#160;</td>
          <td class="paramname"><em>chan</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>cmd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>data</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="../../dd/da2/structast__str.html">ast_str</a> **&#160;</td>
          <td class="paramname"><em>buf</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">ssize_t&#160;</td>
          <td class="paramname"><em>len</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="../../d4/daa/func__env_8c_source.html#l00479">479</a> of file <a class="el" href="../../d4/daa/func__env_8c_source.html">func_env.c</a>.</p>

<p class="reference">References <a class="el" href="../../d6/d90/strings_8h_source.html#l01065">ast_str_set()</a>, <a class="el" href="../../d4/daa/func__env_8c_source.html#l00321">FF_DOS</a>, <a class="el" href="../../d4/daa/func__env_8c_source.html#l00322">FF_MAC</a>, <a class="el" href="../../d4/daa/func__env_8c_source.html#l00320">FF_UNIX</a>, and <a class="el" href="../../d4/daa/func__env_8c_source.html#l00439">file2format()</a>.</p>
<div class="fragment"><div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;{</div><div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;   <span class="keyword">enum</span> <a class="code" href="../../d4/daa/func__env_8c.html#abd81d11867ad50357ea8332e8d36cf8a">file_format</a> newline_format = <a class="code" href="../../d4/daa/func__env_8c.html#a4afbbc5eaddf30a658b75c9e2f7b4ee3">file2format</a>(data);</div><div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;   <a class="code" href="../../d6/d90/strings_8h.html#aa3341f35cedca29e60bb7f3927204283">ast_str_set</a>(buf, <a class="code" href="../../d9/d1e/func__strings_8c.html#af24e73aaf92f3000fda15d285e66df24">len</a>, <span class="stringliteral">&quot;%c&quot;</span>, newline_format == <a class="code" href="../../d4/daa/func__env_8c.html#abd81d11867ad50357ea8332e8d36cf8aa073f48545d1fcf02ce4bf0a9619914ca">FF_UNIX</a> ? <span class="charliteral">&#39;u&#39;</span> : newline_format == <a class="code" href="../../d4/daa/func__env_8c.html#abd81d11867ad50357ea8332e8d36cf8aa7c12b0aea0d0de06a80877d724b86525">FF_DOS</a> ? <span class="charliteral">&#39;d&#39;</span> : newline_format == <a class="code" href="../../d4/daa/func__env_8c.html#abd81d11867ad50357ea8332e8d36cf8aaf1329bf6f765b89c787e5a5151db2102">FF_MAC</a> ? <span class="charliteral">&#39;m&#39;</span> : <span class="charliteral">&#39;x&#39;</span>);</div><div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;   <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;}</div><div class="ttc" id="func__env_8c_html_abd81d11867ad50357ea8332e8d36cf8aaf1329bf6f765b89c787e5a5151db2102"><div class="ttname"><a href="../../d4/daa/func__env_8c.html#abd81d11867ad50357ea8332e8d36cf8aaf1329bf6f765b89c787e5a5151db2102">FF_MAC</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d4/daa/func__env_8c_source.html#l00322">func_env.c:322</a></div></div>
<div class="ttc" id="func__env_8c_html_a4afbbc5eaddf30a658b75c9e2f7b4ee3"><div class="ttname"><a href="../../d4/daa/func__env_8c.html#a4afbbc5eaddf30a658b75c9e2f7b4ee3">file2format</a></div><div class="ttdeci">static enum file_format file2format(const char *filename)</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/daa/func__env_8c_source.html#l00439">func_env.c:439</a></div></div>
<div class="ttc" id="strings_8h_html_aa3341f35cedca29e60bb7f3927204283"><div class="ttname"><a href="../../d6/d90/strings_8h.html#aa3341f35cedca29e60bb7f3927204283">ast_str_set</a></div><div class="ttdeci">int ast_str_set(struct ast_str **buf, ssize_t max_len, const char *fmt,...)</div><div class="ttdoc">Set a dynamic string using variable arguments. </div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d90/strings_8h_source.html#l01065">strings.h:1065</a></div></div>
<div class="ttc" id="func__env_8c_html_abd81d11867ad50357ea8332e8d36cf8a"><div class="ttname"><a href="../../d4/daa/func__env_8c.html#abd81d11867ad50357ea8332e8d36cf8a">file_format</a></div><div class="ttdeci">file_format</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/daa/func__env_8c_source.html#l00318">func_env.c:318</a></div></div>
<div class="ttc" id="func__strings_8c_html_af24e73aaf92f3000fda15d285e66df24"><div class="ttname"><a href="../../d9/d1e/func__strings_8c.html#af24e73aaf92f3000fda15d285e66df24">len</a></div><div class="ttdeci">static int len(struct ast_channel *chan, const char *cmd, char *data, char *buf, size_t buflen)</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d1e/func__strings_8c_source.html#l01344">func_strings.c:1344</a></div></div>
<div class="ttc" id="func__env_8c_html_abd81d11867ad50357ea8332e8d36cf8aa073f48545d1fcf02ce4bf0a9619914ca"><div class="ttname"><a href="../../d4/daa/func__env_8c.html#abd81d11867ad50357ea8332e8d36cf8aa073f48545d1fcf02ce4bf0a9619914ca">FF_UNIX</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d4/daa/func__env_8c_source.html#l00320">func_env.c:320</a></div></div>
<div class="ttc" id="func__env_8c_html_abd81d11867ad50357ea8332e8d36cf8aa7c12b0aea0d0de06a80877d724b86525"><div class="ttname"><a href="../../d4/daa/func__env_8c.html#abd81d11867ad50357ea8332e8d36cf8aa7c12b0aea0d0de06a80877d724b86525">FF_DOS</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d4/daa/func__env_8c_source.html#l00321">func_env.c:321</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="add1f9152200c079d475b65e42844f0ea"></a>
<h2 class="memtitle"><span class="permalink"><a href="#add1f9152200c079d475b65e42844f0ea">&#9670;&nbsp;</a></span>file_read()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int file_read </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="../../df/d3c/structast__channel.html">ast_channel</a> *&#160;</td>
          <td class="paramname"><em>chan</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>cmd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>data</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="../../dd/da2/structast__str.html">ast_str</a> **&#160;</td>
          <td class="paramname"><em>buf</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">ssize_t&#160;</td>
          <td class="paramname"><em>len</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="../../d4/daa/func__env_8c_source.html#l00486">486</a> of file <a class="el" href="../../d4/daa/func__env_8c_source.html">func_env.c</a>.</p>

<p class="reference">References <a class="el" href="../../d5/dde/test__func__file_8c_source.html#l00046">args</a>, <a class="el" href="../../d3/d93/include_2asterisk_2app_8h_source.html#l01232">AST_APP_ARG</a>, <a class="el" href="../../d1/d8c/logger_8h_source.html#l00452">ast_debug</a>, <a class="el" href="../../d3/d93/include_2asterisk_2app_8h_source.html#l01249">AST_DECLARE_APP_ARGS</a>, <a class="el" href="../../da/df7/astobj2_8c_source.html#l00042">ast_log</a>, <a class="el" href="../../d1/d8c/logger_8h_source.html#l00290">AST_LOG_ERROR</a>, <a class="el" href="../../d3/d93/include_2asterisk_2app_8h_source.html#l01285">AST_STANDARD_APP_ARGS</a>, <a class="el" href="../../d6/d90/strings_8h_source.html#l01014">ast_str_append_substr()</a>, <a class="el" href="../../d6/d90/strings_8h_source.html#l00653">ast_str_reset()</a>, <a class="el" href="../../dd/d7c/eagi__proxy_8c_source.html#l00073">end</a>, <a class="el" href="../../d1/d6e/main_2stdtime_2private_8h.html#ad65a8842cc674e3ddf69355898c0ecbf">errno</a>, <a class="el" href="../../d4/daa/func__env_8c_source.html#l00321">FF_DOS</a>, <a class="el" href="../../d4/daa/func__env_8c_source.html#l00322">FF_MAC</a>, <a class="el" href="../../d4/daa/func__env_8c_source.html#l00320">FF_UNIX</a>, <a class="el" href="../../d4/daa/func__env_8c_source.html#l00319">FF_UNKNOWN</a>, <a class="el" href="../../d4/daa/func__env_8c_source.html#l00439">file2format()</a>, <a class="el" href="../../da/d45/chan__alsa_8c_source.html#l00102">format</a>, <a class="el" href="../../d4/daa/func__env_8c_source.html#l00740">format2term()</a>, <a class="el" href="../../d4/daa/func__env_8c_source.html#l00425">LINE_COUNTER</a>, <a class="el" href="../../de/da3/include_2asterisk_2compat_8h_source.html#l00060">LLONG_MAX</a>, <a class="el" href="../../d1/d8c/logger_8h_source.html#l00285">LOG_ERROR</a>, <a class="el" href="../../d1/d8c/logger_8h_source.html#l00274">LOG_WARNING</a>, <a class="el" href="../../d5/d60/utils_8h_source.html#l00226">MIN</a>, and <a class="el" href="../../d4/d45/test__http__media__cache_8c_source.html#l00062">options</a>.</p>
<div class="fragment"><div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;{</div><div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;   FILE *ff;</div><div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;   int64_t offset = 0, length = <a class="code" href="../../de/da3/include_2asterisk_2compat_8h.html#a23ec2cf7fc07ea8f817bbac758402baf">LLONG_MAX</a>;</div><div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;   <span class="keyword">enum</span> <a class="code" href="../../d4/daa/func__env_8c.html#abd81d11867ad50357ea8332e8d36cf8a">file_format</a> <a class="code" href="../../da/d45/chan__alsa_8c.html#a98f5e70e98f6dc48e3c5ba316066d540">format</a> = <a class="code" href="../../d4/daa/func__env_8c.html#abd81d11867ad50357ea8332e8d36cf8aa002a351c4fed7e3b7dbc83129ecc397e">FF_UNKNOWN</a>;</div><div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;   <span class="keywordtype">char</span> fbuf[4096];</div><div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;   int64_t flength, i; <span class="comment">/* iterator needs to be signed, so it can go negative and terminate the loop */</span></div><div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;   int64_t offset_offset = -1, length_offset = -1;</div><div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;   <span class="keywordtype">char</span> dos_state = 0;</div><div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;   <a class="code" href="../../d3/d93/include_2asterisk_2app_8h.html#a80cd3f6f786b59b742bcecfc0b3be7c2">AST_DECLARE_APP_ARGS</a>(<a class="code" href="../../d5/dde/test__func__file_8c.html#a7df83d295429a2562396f1ec127a46c0">args</a>,</div><div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;      <a class="code" href="../../d3/d93/include_2asterisk_2app_8h.html#a037e9a5b28477b17e7c9acbe7ecb21d5">AST_APP_ARG</a>(filename);</div><div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;      <a class="code" href="../../d3/d93/include_2asterisk_2app_8h.html#a037e9a5b28477b17e7c9acbe7ecb21d5">AST_APP_ARG</a>(offset);</div><div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;      <a class="code" href="../../d3/d93/include_2asterisk_2app_8h.html#a037e9a5b28477b17e7c9acbe7ecb21d5">AST_APP_ARG</a>(length);</div><div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;      <a class="code" href="../../d3/d93/include_2asterisk_2app_8h.html#a037e9a5b28477b17e7c9acbe7ecb21d5">AST_APP_ARG</a>(<a class="code" href="../../d4/d45/test__http__media__cache_8c.html#a80c8e3ae5087d90d422675d034eeebc7">options</a>);</div><div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;      <a class="code" href="../../d3/d93/include_2asterisk_2app_8h.html#a037e9a5b28477b17e7c9acbe7ecb21d5">AST_APP_ARG</a>(fileformat);</div><div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;   );</div><div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;</div><div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;   <a class="code" href="../../d3/d93/include_2asterisk_2app_8h.html#ac08f7eb1eb9476b30987c73e1052ada8">AST_STANDARD_APP_ARGS</a>(<a class="code" href="../../d5/dde/test__func__file_8c.html#a7df83d295429a2562396f1ec127a46c0">args</a>, data);</div><div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;</div><div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d5/dde/test__func__file_8c.html#a7df83d295429a2562396f1ec127a46c0">args</a>.argc &gt; 1) {</div><div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;      sscanf(<a class="code" href="../../d5/dde/test__func__file_8c.html#a7df83d295429a2562396f1ec127a46c0">args</a>.offset, <span class="stringliteral">&quot;%&quot;</span> SCNd64, &amp;offset);</div><div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;   }</div><div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d5/dde/test__func__file_8c.html#a7df83d295429a2562396f1ec127a46c0">args</a>.argc &gt; 2) {</div><div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;      sscanf(<a class="code" href="../../d5/dde/test__func__file_8c.html#a7df83d295429a2562396f1ec127a46c0">args</a>.length, <span class="stringliteral">&quot;%&quot;</span> SCNd64, &amp;length);</div><div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;   }</div><div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;</div><div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d5/dde/test__func__file_8c.html#a7df83d295429a2562396f1ec127a46c0">args</a>.argc &lt; 4 || !strchr(<a class="code" href="../../d5/dde/test__func__file_8c.html#a7df83d295429a2562396f1ec127a46c0">args</a>.options, <span class="charliteral">&#39;l&#39;</span>)) {</div><div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;      <span class="comment">/* Character-based mode */</span></div><div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;      off_t off_i;</div><div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;</div><div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;      <span class="keywordflow">if</span> (!(ff = fopen(<a class="code" href="../../d5/dde/test__func__file_8c.html#a7df83d295429a2562396f1ec127a46c0">args</a>.filename, <span class="stringliteral">&quot;r&quot;</span>))) {</div><div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;         <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Cannot open file &#39;%s&#39; for reading: %s\n&quot;</span>, <a class="code" href="../../d5/dde/test__func__file_8c.html#a7df83d295429a2562396f1ec127a46c0">args</a>.filename, strerror(<a class="code" href="../../d1/d6e/main_2stdtime_2private_8h.html#ad65a8842cc674e3ddf69355898c0ecbf">errno</a>));</div><div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;         <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;      }</div><div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;</div><div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;      <span class="keywordflow">if</span> (fseeko(ff, 0, SEEK_END) &lt; 0) {</div><div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;         <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Cannot seek to end of &#39;%s&#39;: %s\n&quot;</span>, <a class="code" href="../../d5/dde/test__func__file_8c.html#a7df83d295429a2562396f1ec127a46c0">args</a>.filename, strerror(<a class="code" href="../../d1/d6e/main_2stdtime_2private_8h.html#ad65a8842cc674e3ddf69355898c0ecbf">errno</a>));</div><div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;         fclose(ff);</div><div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;         <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;      }</div><div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;      flength = ftello(ff);</div><div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;</div><div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;      <span class="keywordflow">if</span> (offset &lt; 0) {</div><div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;         fseeko(ff, offset, SEEK_END);</div><div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;         <span class="keywordflow">if</span> ((offset = ftello(ff)) &lt; 0) {</div><div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;            <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#a2fdd5bff193a29ec6c7278da2851ea56">AST_LOG_ERROR</a>, <span class="stringliteral">&quot;Cannot determine offset position of &#39;%s&#39;: %s\n&quot;</span>, <a class="code" href="../../d5/dde/test__func__file_8c.html#a7df83d295429a2562396f1ec127a46c0">args</a>.filename, strerror(<a class="code" href="../../d1/d6e/main_2stdtime_2private_8h.html#ad65a8842cc674e3ddf69355898c0ecbf">errno</a>));</div><div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;            fclose(ff);</div><div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;            <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;         }</div><div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;      }</div><div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;      <span class="keywordflow">if</span> (length &lt; 0) {</div><div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;         fseeko(ff, length, SEEK_END);</div><div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;         <span class="keywordflow">if</span> ((length = ftello(ff)) - offset &lt; 0) {</div><div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;            <span class="comment">/* Eliminates all results */</span></div><div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;            fclose(ff);</div><div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;            <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;         }</div><div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;      } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (length == <a class="code" href="../../de/da3/include_2asterisk_2compat_8h.html#a23ec2cf7fc07ea8f817bbac758402baf">LLONG_MAX</a>) {</div><div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;         fseeko(ff, 0, SEEK_END);</div><div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;         length = ftello(ff);</div><div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;      }</div><div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;</div><div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;      <a class="code" href="../../d6/d90/strings_8h.html#a8239b9ad10367bfc936e9b60ff7706a8">ast_str_reset</a>(*buf);</div><div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;</div><div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;      fseeko(ff, offset, SEEK_SET);</div><div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;      <span class="keywordflow">for</span> (off_i = ftello(ff); off_i &lt; flength &amp;&amp; off_i &lt; offset + length; off_i += <span class="keyword">sizeof</span>(fbuf)) {</div><div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;         <span class="comment">/* Calculate if we need to retrieve just a portion of the file in memory */</span></div><div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;         <span class="keywordtype">size_t</span> toappend = <span class="keyword">sizeof</span>(fbuf);</div><div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;</div><div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;         <span class="keywordflow">if</span> (fread(fbuf, 1, <span class="keyword">sizeof</span>(fbuf), ff) &lt; <span class="keyword">sizeof</span>(fbuf) &amp;&amp; !feof(ff)) {</div><div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;            <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Short read?!!\n&quot;</span>);</div><div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;         }</div><div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;</div><div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;         <span class="comment">/* Don&#39;t go past the length requested */</span></div><div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;         <span class="keywordflow">if</span> (off_i + toappend &gt; offset + length) {</div><div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;            toappend = <a class="code" href="../../d5/d60/utils_8h.html#a3acffbd305ee72dcd4593c0d8af64a4f">MIN</a>(offset + length - off_i, flength - off_i);</div><div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;         }</div><div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;</div><div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;         <a class="code" href="../../d6/d90/strings_8h.html#a66daf21afabae2111fb397beb9a6c57e">ast_str_append_substr</a>(buf, <a class="code" href="../../d9/d1e/func__strings_8c.html#af24e73aaf92f3000fda15d285e66df24">len</a>, fbuf, toappend);</div><div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;      }</div><div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;      fclose(ff);</div><div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;      <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;   }</div><div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;</div><div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;   <span class="comment">/* Line-based read */</span></div><div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d5/dde/test__func__file_8c.html#a7df83d295429a2562396f1ec127a46c0">args</a>.argc == 5) {</div><div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;      <span class="keywordflow">if</span> (tolower(<a class="code" href="../../d5/dde/test__func__file_8c.html#a7df83d295429a2562396f1ec127a46c0">args</a>.fileformat[0]) == <span class="charliteral">&#39;d&#39;</span>) {</div><div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;         format = <a class="code" href="../../d4/daa/func__env_8c.html#abd81d11867ad50357ea8332e8d36cf8aa7c12b0aea0d0de06a80877d724b86525">FF_DOS</a>;</div><div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;      } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (tolower(<a class="code" href="../../d5/dde/test__func__file_8c.html#a7df83d295429a2562396f1ec127a46c0">args</a>.fileformat[0]) == <span class="charliteral">&#39;m&#39;</span>) {</div><div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;         format = <a class="code" href="../../d4/daa/func__env_8c.html#abd81d11867ad50357ea8332e8d36cf8aaf1329bf6f765b89c787e5a5151db2102">FF_MAC</a>;</div><div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;      } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (tolower(<a class="code" href="../../d5/dde/test__func__file_8c.html#a7df83d295429a2562396f1ec127a46c0">args</a>.fileformat[0]) == <span class="charliteral">&#39;u&#39;</span>) {</div><div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;         format = <a class="code" href="../../d4/daa/func__env_8c.html#abd81d11867ad50357ea8332e8d36cf8aa073f48545d1fcf02ce4bf0a9619914ca">FF_UNIX</a>;</div><div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;      }</div><div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;   }</div><div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;</div><div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;   <span class="keywordflow">if</span> (format == <a class="code" href="../../d4/daa/func__env_8c.html#abd81d11867ad50357ea8332e8d36cf8aa002a351c4fed7e3b7dbc83129ecc397e">FF_UNKNOWN</a>) {</div><div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;      <span class="keywordflow">if</span> ((format = <a class="code" href="../../d4/daa/func__env_8c.html#a4afbbc5eaddf30a658b75c9e2f7b4ee3">file2format</a>(<a class="code" href="../../d5/dde/test__func__file_8c.html#a7df83d295429a2562396f1ec127a46c0">args</a>.filename)) == <a class="code" href="../../d4/daa/func__env_8c.html#abd81d11867ad50357ea8332e8d36cf8aa002a351c4fed7e3b7dbc83129ecc397e">FF_UNKNOWN</a>) {</div><div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;         <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;&#39;%s&#39; is not a line-based file\n&quot;</span>, <a class="code" href="../../d5/dde/test__func__file_8c.html#a7df83d295429a2562396f1ec127a46c0">args</a>.filename);</div><div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;         <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;      }</div><div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;   }</div><div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;</div><div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;   <span class="keywordflow">if</span> (offset &lt; 0 &amp;&amp; length &lt;= offset) {</div><div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;      <span class="comment">/* Length eliminates all content */</span></div><div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;   } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (offset == 0) {</div><div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;      offset_offset = 0;</div><div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;   }</div><div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;</div><div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;   <span class="keywordflow">if</span> (!(ff = fopen(<a class="code" href="../../d5/dde/test__func__file_8c.html#a7df83d295429a2562396f1ec127a46c0">args</a>.filename, <span class="stringliteral">&quot;r&quot;</span>))) {</div><div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Cannot open &#39;%s&#39;: %s\n&quot;</span>, <a class="code" href="../../d5/dde/test__func__file_8c.html#a7df83d295429a2562396f1ec127a46c0">args</a>.filename, strerror(<a class="code" href="../../d1/d6e/main_2stdtime_2private_8h.html#ad65a8842cc674e3ddf69355898c0ecbf">errno</a>));</div><div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;   }</div><div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;</div><div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;   <span class="keywordflow">if</span> (fseek(ff, 0, SEEK_END)) {</div><div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Cannot seek to end of file &#39;%s&#39;: %s\n&quot;</span>, <a class="code" href="../../d5/dde/test__func__file_8c.html#a7df83d295429a2562396f1ec127a46c0">args</a>.filename, strerror(<a class="code" href="../../d1/d6e/main_2stdtime_2private_8h.html#ad65a8842cc674e3ddf69355898c0ecbf">errno</a>));</div><div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;      fclose(ff);</div><div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;   }</div><div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;</div><div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;   flength = ftello(ff);</div><div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;</div><div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;   <span class="keywordflow">if</span> (length == <a class="code" href="../../de/da3/include_2asterisk_2compat_8h.html#a23ec2cf7fc07ea8f817bbac758402baf">LLONG_MAX</a>) {</div><div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;      length_offset = flength;</div><div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;   }</div><div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;</div><div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160;   <span class="comment">/* For negative offset and/or negative length */</span></div><div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;   <span class="keywordflow">if</span> (offset &lt; 0 || length &lt; 0) {</div><div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;      int64_t count = 0;</div><div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;      <span class="comment">/* Start with an even multiple of fbuf, so at the end of reading with a</span></div><div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160;<span class="comment">       * 0 offset, we don&#39;t try to go past the beginning of the file. */</span></div><div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160;      <span class="keywordflow">for</span> (i = (flength / <span class="keyword">sizeof</span>(fbuf)) * <span class="keyword">sizeof</span>(fbuf); i &gt;= 0; i -= <span class="keyword">sizeof</span>(fbuf)) {</div><div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160;         <span class="keywordtype">size_t</span> <a class="code" href="../../dd/d7c/eagi__proxy_8c.html#a8fd806ad19b8f5513a4cf18cbf77532c">end</a>;</div><div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160;         <span class="keywordtype">char</span> *pos;</div><div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;         <span class="keywordflow">if</span> (fseeko(ff, i, SEEK_SET)) {</div><div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;            <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Cannot seek to offset %&quot;</span> PRId64 <span class="stringliteral">&quot;: %s\n&quot;</span>, i, strerror(<a class="code" href="../../d1/d6e/main_2stdtime_2private_8h.html#ad65a8842cc674e3ddf69355898c0ecbf">errno</a>));</div><div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;         }</div><div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;         end = fread(fbuf, 1, <span class="keyword">sizeof</span>(fbuf), ff);</div><div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160;         <span class="keywordflow">for</span> (pos = (end &lt; <span class="keyword">sizeof</span>(fbuf) ? fbuf + end - 1 : fbuf + <span class="keyword">sizeof</span>(fbuf) - 1); pos &gt;= fbuf; pos--) {</div><div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160;            <a class="code" href="../../d4/daa/func__env_8c.html#ad2682ceb1f8ed7d6551cd75454aa25c4">LINE_COUNTER</a>(pos, format, count);</div><div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160;</div><div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;            <span class="keywordflow">if</span> (length &lt; 0 &amp;&amp; count * -1 == length) {</div><div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160;               length_offset = i + (pos - fbuf);</div><div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;            } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (offset &lt; 0 &amp;&amp; count * -1 == (offset - 1)) {</div><div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160;               <span class="comment">/* Found our initial offset.  We&#39;re done with reverse motion! */</span></div><div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160;               <span class="keywordflow">if</span> (format == <a class="code" href="../../d4/daa/func__env_8c.html#abd81d11867ad50357ea8332e8d36cf8aa7c12b0aea0d0de06a80877d724b86525">FF_DOS</a>) {</div><div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160;                  offset_offset = i + (pos - fbuf) + 2;</div><div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160;               } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160;                  offset_offset = i + (pos - fbuf) + 1;</div><div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160;               }</div><div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160;               <span class="keywordflow">break</span>;</div><div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160;            }</div><div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160;         }</div><div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160;         <span class="keywordflow">if</span> ((offset &lt; 0 &amp;&amp; offset_offset &gt;= 0) || (offset &gt;= 0 &amp;&amp; length_offset &gt;= 0)) {</div><div class="line"><a name="l00641"></a><span class="lineno">  641</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160;         }</div><div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160;      }</div><div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160;      <span class="comment">/* We&#39;re at the beginning, and the negative offset indicates the exact number of lines in the file */</span></div><div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160;      <span class="keywordflow">if</span> (offset &lt; 0 &amp;&amp; offset_offset &lt; 0 &amp;&amp; offset == count * -1) {</div><div class="line"><a name="l00646"></a><span class="lineno">  646</span>&#160;         offset_offset = 0;</div><div class="line"><a name="l00647"></a><span class="lineno">  647</span>&#160;      }</div><div class="line"><a name="l00648"></a><span class="lineno">  648</span>&#160;   }</div><div class="line"><a name="l00649"></a><span class="lineno">  649</span>&#160;</div><div class="line"><a name="l00650"></a><span class="lineno">  650</span>&#160;   <span class="comment">/* Positve line offset */</span></div><div class="line"><a name="l00651"></a><span class="lineno">  651</span>&#160;   <span class="keywordflow">if</span> (offset &gt; 0) {</div><div class="line"><a name="l00652"></a><span class="lineno">  652</span>&#160;      int64_t count = 0;</div><div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160;      fseek(ff, 0, SEEK_SET);</div><div class="line"><a name="l00654"></a><span class="lineno">  654</span>&#160;      <span class="keywordflow">for</span> (i = 0; i &lt; flength; i += <span class="keyword">sizeof</span>(fbuf)) {</div><div class="line"><a name="l00655"></a><span class="lineno">  655</span>&#160;         <span class="keywordtype">char</span> *pos;</div><div class="line"><a name="l00656"></a><span class="lineno">  656</span>&#160;         <span class="keywordflow">if</span> (i + <span class="keyword">sizeof</span>(fbuf) &lt;= flength) {</div><div class="line"><a name="l00657"></a><span class="lineno">  657</span>&#160;            <span class="comment">/* Don&#39;t let previous values influence current counts, due to short reads */</span></div><div class="line"><a name="l00658"></a><span class="lineno">  658</span>&#160;            memset(fbuf, 0, <span class="keyword">sizeof</span>(fbuf));</div><div class="line"><a name="l00659"></a><span class="lineno">  659</span>&#160;         }</div><div class="line"><a name="l00660"></a><span class="lineno">  660</span>&#160;         <span class="keywordflow">if</span> (fread(fbuf, 1, <span class="keyword">sizeof</span>(fbuf), ff) &lt; <span class="keyword">sizeof</span>(fbuf) &amp;&amp; !feof(ff)) {</div><div class="line"><a name="l00661"></a><span class="lineno">  661</span>&#160;            <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Short read?!!\n&quot;</span>);</div><div class="line"><a name="l00662"></a><span class="lineno">  662</span>&#160;            fclose(ff);</div><div class="line"><a name="l00663"></a><span class="lineno">  663</span>&#160;            <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l00664"></a><span class="lineno">  664</span>&#160;         }</div><div class="line"><a name="l00665"></a><span class="lineno">  665</span>&#160;         <span class="keywordflow">for</span> (pos = fbuf; pos &lt; fbuf + <span class="keyword">sizeof</span>(fbuf); pos++) {</div><div class="line"><a name="l00666"></a><span class="lineno">  666</span>&#160;            <a class="code" href="../../d4/daa/func__env_8c.html#ad2682ceb1f8ed7d6551cd75454aa25c4">LINE_COUNTER</a>(pos, format, count);</div><div class="line"><a name="l00667"></a><span class="lineno">  667</span>&#160;</div><div class="line"><a name="l00668"></a><span class="lineno">  668</span>&#160;            <span class="keywordflow">if</span> (count == offset) {</div><div class="line"><a name="l00669"></a><span class="lineno">  669</span>&#160;               offset_offset = i + (pos - fbuf) + 1;</div><div class="line"><a name="l00670"></a><span class="lineno">  670</span>&#160;               <span class="keywordflow">break</span>;</div><div class="line"><a name="l00671"></a><span class="lineno">  671</span>&#160;            }</div><div class="line"><a name="l00672"></a><span class="lineno">  672</span>&#160;         }</div><div class="line"><a name="l00673"></a><span class="lineno">  673</span>&#160;         <span class="keywordflow">if</span> (offset_offset &gt;= 0) {</div><div class="line"><a name="l00674"></a><span class="lineno">  674</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l00675"></a><span class="lineno">  675</span>&#160;         }</div><div class="line"><a name="l00676"></a><span class="lineno">  676</span>&#160;      }</div><div class="line"><a name="l00677"></a><span class="lineno">  677</span>&#160;   }</div><div class="line"><a name="l00678"></a><span class="lineno">  678</span>&#160;</div><div class="line"><a name="l00679"></a><span class="lineno">  679</span>&#160;   <span class="keywordflow">if</span> (offset_offset &lt; 0) {</div><div class="line"><a name="l00680"></a><span class="lineno">  680</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Offset &#39;%s&#39; refers to before the beginning of the file!\n&quot;</span>, <a class="code" href="../../d5/dde/test__func__file_8c.html#a7df83d295429a2562396f1ec127a46c0">args</a>.offset);</div><div class="line"><a name="l00681"></a><span class="lineno">  681</span>&#160;      fclose(ff);</div><div class="line"><a name="l00682"></a><span class="lineno">  682</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l00683"></a><span class="lineno">  683</span>&#160;   }</div><div class="line"><a name="l00684"></a><span class="lineno">  684</span>&#160;</div><div class="line"><a name="l00685"></a><span class="lineno">  685</span>&#160;   <a class="code" href="../../d6/d90/strings_8h.html#a8239b9ad10367bfc936e9b60ff7706a8">ast_str_reset</a>(*buf);</div><div class="line"><a name="l00686"></a><span class="lineno">  686</span>&#160;   <span class="keywordflow">if</span> (fseeko(ff, offset_offset, SEEK_SET)) {</div><div class="line"><a name="l00687"></a><span class="lineno">  687</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;fseeko failed: %s\n&quot;</span>, strerror(<a class="code" href="../../d1/d6e/main_2stdtime_2private_8h.html#ad65a8842cc674e3ddf69355898c0ecbf">errno</a>));</div><div class="line"><a name="l00688"></a><span class="lineno">  688</span>&#160;   }</div><div class="line"><a name="l00689"></a><span class="lineno">  689</span>&#160;</div><div class="line"><a name="l00690"></a><span class="lineno">  690</span>&#160;   <span class="comment">/* If we have both offset_offset and length_offset, then grabbing the</span></div><div class="line"><a name="l00691"></a><span class="lineno">  691</span>&#160;<span class="comment">    * buffer is simply a matter of just retrieving the file and adding it</span></div><div class="line"><a name="l00692"></a><span class="lineno">  692</span>&#160;<span class="comment">    * to buf.  Otherwise, we need to run byte-by-byte forward until the</span></div><div class="line"><a name="l00693"></a><span class="lineno">  693</span>&#160;<span class="comment">    * length is complete. */</span></div><div class="line"><a name="l00694"></a><span class="lineno">  694</span>&#160;   <span class="keywordflow">if</span> (length_offset &gt;= 0) {</div><div class="line"><a name="l00695"></a><span class="lineno">  695</span>&#160;      <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(3, <span class="stringliteral">&quot;offset=%&quot;</span> PRId64 <span class="stringliteral">&quot;, length=%&quot;</span> PRId64 <span class="stringliteral">&quot;, offset_offset=%&quot;</span> PRId64 <span class="stringliteral">&quot;, length_offset=%&quot;</span> PRId64 <span class="stringliteral">&quot;\n&quot;</span>, offset, length, offset_offset, length_offset);</div><div class="line"><a name="l00696"></a><span class="lineno">  696</span>&#160;      <span class="keywordflow">for</span> (i = offset_offset; i &lt; length_offset; i += <span class="keyword">sizeof</span>(fbuf)) {</div><div class="line"><a name="l00697"></a><span class="lineno">  697</span>&#160;         <span class="keywordflow">if</span> (fread(fbuf, 1, i + <span class="keyword">sizeof</span>(fbuf) &gt; flength ? flength - i : <span class="keyword">sizeof</span>(fbuf), ff) &lt; (i + <span class="keyword">sizeof</span>(fbuf) &gt; flength ? flength - i : <span class="keyword">sizeof</span>(fbuf))) {</div><div class="line"><a name="l00698"></a><span class="lineno">  698</span>&#160;            <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Short read?!!\n&quot;</span>);</div><div class="line"><a name="l00699"></a><span class="lineno">  699</span>&#160;         }</div><div class="line"><a name="l00700"></a><span class="lineno">  700</span>&#160;         <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(3, <span class="stringliteral">&quot;Appending first %&quot;</span> PRId64<span class="stringliteral">&quot; bytes of fbuf=%s\n&quot;</span>, (int64_t)(i + <span class="keyword">sizeof</span>(fbuf) &gt; length_offset ? length_offset - i : <span class="keyword">sizeof</span>(fbuf)), fbuf);</div><div class="line"><a name="l00701"></a><span class="lineno">  701</span>&#160;         <a class="code" href="../../d6/d90/strings_8h.html#a66daf21afabae2111fb397beb9a6c57e">ast_str_append_substr</a>(buf, <a class="code" href="../../d9/d1e/func__strings_8c.html#af24e73aaf92f3000fda15d285e66df24">len</a>, fbuf, i + <span class="keyword">sizeof</span>(fbuf) &gt; length_offset ? length_offset - i : <span class="keyword">sizeof</span>(fbuf));</div><div class="line"><a name="l00702"></a><span class="lineno">  702</span>&#160;      }</div><div class="line"><a name="l00703"></a><span class="lineno">  703</span>&#160;   } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (length == 0) {</div><div class="line"><a name="l00704"></a><span class="lineno">  704</span>&#160;      <span class="comment">/* Nothing to do */</span></div><div class="line"><a name="l00705"></a><span class="lineno">  705</span>&#160;   } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00706"></a><span class="lineno">  706</span>&#160;      <span class="comment">/* Positive line offset */</span></div><div class="line"><a name="l00707"></a><span class="lineno">  707</span>&#160;      int64_t current_length = 0;</div><div class="line"><a name="l00708"></a><span class="lineno">  708</span>&#160;      <span class="keywordtype">char</span> dos_state = 0;</div><div class="line"><a name="l00709"></a><span class="lineno">  709</span>&#160;      <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(3, <span class="stringliteral">&quot;offset=%&quot;</span> PRId64 <span class="stringliteral">&quot;, length=%&quot;</span> PRId64 <span class="stringliteral">&quot;, offset_offset=%&quot;</span> PRId64 <span class="stringliteral">&quot;, length_offset=%&quot;</span> PRId64 <span class="stringliteral">&quot;\n&quot;</span>, offset, length, offset_offset, length_offset);</div><div class="line"><a name="l00710"></a><span class="lineno">  710</span>&#160;      <span class="keywordflow">for</span> (i = offset_offset; i &lt; flength; i += <span class="keyword">sizeof</span>(fbuf)) {</div><div class="line"><a name="l00711"></a><span class="lineno">  711</span>&#160;         <span class="keywordtype">char</span> *pos;</div><div class="line"><a name="l00712"></a><span class="lineno">  712</span>&#160;         <span class="keywordtype">size_t</span> bytes_read;</div><div class="line"><a name="l00713"></a><span class="lineno">  713</span>&#160;         <span class="keywordflow">if</span> ((bytes_read = fread(fbuf, 1, <span class="keyword">sizeof</span>(fbuf), ff)) &lt; <span class="keyword">sizeof</span>(fbuf) &amp;&amp; !feof(ff)) {</div><div class="line"><a name="l00714"></a><span class="lineno">  714</span>&#160;            <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Short read?!!\n&quot;</span>);</div><div class="line"><a name="l00715"></a><span class="lineno">  715</span>&#160;            fclose(ff);</div><div class="line"><a name="l00716"></a><span class="lineno">  716</span>&#160;            <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l00717"></a><span class="lineno">  717</span>&#160;         }</div><div class="line"><a name="l00718"></a><span class="lineno">  718</span>&#160;         <span class="keywordflow">for</span> (pos = fbuf; pos &lt; fbuf + bytes_read; pos++) {</div><div class="line"><a name="l00719"></a><span class="lineno">  719</span>&#160;            <a class="code" href="../../d4/daa/func__env_8c.html#ad2682ceb1f8ed7d6551cd75454aa25c4">LINE_COUNTER</a>(pos, format, current_length);</div><div class="line"><a name="l00720"></a><span class="lineno">  720</span>&#160;</div><div class="line"><a name="l00721"></a><span class="lineno">  721</span>&#160;            <span class="keywordflow">if</span> (current_length == length) {</div><div class="line"><a name="l00722"></a><span class="lineno">  722</span>&#160;               length_offset = i + (pos - fbuf) + 1;</div><div class="line"><a name="l00723"></a><span class="lineno">  723</span>&#160;               <span class="keywordflow">break</span>;</div><div class="line"><a name="l00724"></a><span class="lineno">  724</span>&#160;            }</div><div class="line"><a name="l00725"></a><span class="lineno">  725</span>&#160;         }</div><div class="line"><a name="l00726"></a><span class="lineno">  726</span>&#160;         <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(3, <span class="stringliteral">&quot;length_offset=%&quot;</span> PRId64 <span class="stringliteral">&quot;, length_offset - i=%&quot;</span> PRId64 <span class="stringliteral">&quot;\n&quot;</span>, length_offset, length_offset - i);</div><div class="line"><a name="l00727"></a><span class="lineno">  727</span>&#160;         <a class="code" href="../../d6/d90/strings_8h.html#a66daf21afabae2111fb397beb9a6c57e">ast_str_append_substr</a>(buf, <a class="code" href="../../d9/d1e/func__strings_8c.html#af24e73aaf92f3000fda15d285e66df24">len</a>, fbuf, (length_offset &gt;= 0) ? length_offset - i : (flength &gt; i + <span class="keyword">sizeof</span>(fbuf)) ? <span class="keyword">sizeof</span>(fbuf) : flength - i);</div><div class="line"><a name="l00728"></a><span class="lineno">  728</span>&#160;</div><div class="line"><a name="l00729"></a><span class="lineno">  729</span>&#160;         <span class="keywordflow">if</span> (length_offset &gt;= 0) {</div><div class="line"><a name="l00730"></a><span class="lineno">  730</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l00731"></a><span class="lineno">  731</span>&#160;         }</div><div class="line"><a name="l00732"></a><span class="lineno">  732</span>&#160;      }</div><div class="line"><a name="l00733"></a><span class="lineno">  733</span>&#160;   }</div><div class="line"><a name="l00734"></a><span class="lineno">  734</span>&#160;</div><div class="line"><a name="l00735"></a><span class="lineno">  735</span>&#160;   fclose(ff);</div><div class="line"><a name="l00736"></a><span class="lineno">  736</span>&#160;   <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00737"></a><span class="lineno">  737</span>&#160;}</div><div class="ttc" id="func__env_8c_html_abd81d11867ad50357ea8332e8d36cf8aaf1329bf6f765b89c787e5a5151db2102"><div class="ttname"><a href="../../d4/daa/func__env_8c.html#abd81d11867ad50357ea8332e8d36cf8aaf1329bf6f765b89c787e5a5151db2102">FF_MAC</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d4/daa/func__env_8c_source.html#l00322">func_env.c:322</a></div></div>
<div class="ttc" id="include_2asterisk_2app_8h_html_ac08f7eb1eb9476b30987c73e1052ada8"><div class="ttname"><a href="../../d3/d93/include_2asterisk_2app_8h.html#ac08f7eb1eb9476b30987c73e1052ada8">AST_STANDARD_APP_ARGS</a></div><div class="ttdeci">#define AST_STANDARD_APP_ARGS(args, parse)</div><div class="ttdoc">Performs the &amp;#39;standard&amp;#39; argument separation process for an application. </div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d93/include_2asterisk_2app_8h_source.html#l01285">include/asterisk/app.h:1285</a></div></div>
<div class="ttc" id="logger_8h_html_adf4476a6a4ea6c74231c826e899d7189"><div class="ttname"><a href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a></div><div class="ttdeci">#define LOG_WARNING</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d8c/logger_8h_source.html#l00274">logger.h:274</a></div></div>
<div class="ttc" id="test__func__file_8c_html_a7df83d295429a2562396f1ec127a46c0"><div class="ttname"><a href="../../d5/dde/test__func__file_8c.html#a7df83d295429a2562396f1ec127a46c0">args</a></div><div class="ttdeci">const char * args</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/dde/test__func__file_8c_source.html#l00046">test_func_file.c:46</a></div></div>
<div class="ttc" id="eagi__proxy_8c_html_a8fd806ad19b8f5513a4cf18cbf77532c"><div class="ttname"><a href="../../dd/d7c/eagi__proxy_8c.html#a8fd806ad19b8f5513a4cf18cbf77532c">end</a></div><div class="ttdeci">char * end</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d7c/eagi__proxy_8c_source.html#l00073">eagi_proxy.c:73</a></div></div>
<div class="ttc" id="func__env_8c_html_a4afbbc5eaddf30a658b75c9e2f7b4ee3"><div class="ttname"><a href="../../d4/daa/func__env_8c.html#a4afbbc5eaddf30a658b75c9e2f7b4ee3">file2format</a></div><div class="ttdeci">static enum file_format file2format(const char *filename)</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/daa/func__env_8c_source.html#l00439">func_env.c:439</a></div></div>
<div class="ttc" id="utils_8h_html_a3acffbd305ee72dcd4593c0d8af64a4f"><div class="ttname"><a href="../../d5/d60/utils_8h.html#a3acffbd305ee72dcd4593c0d8af64a4f">MIN</a></div><div class="ttdeci">#define MIN(a, b)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d60/utils_8h_source.html#l00226">utils.h:226</a></div></div>
<div class="ttc" id="logger_8h_html_a3f248112c8d6ce7e3959aa723dade648"><div class="ttname"><a href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a></div><div class="ttdeci">#define ast_debug(level,...)</div><div class="ttdoc">Log a DEBUG message. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d8c/logger_8h_source.html#l00452">logger.h:452</a></div></div>
<div class="ttc" id="astobj2_8c_html_a96a00b3a518d7f32b6d51dc28f09bf9b"><div class="ttname"><a href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a></div><div class="ttdeci">#define ast_log</div><div class="ttdef"><b>Definition:</b> <a href="../../da/df7/astobj2_8c_source.html#l00042">astobj2.c:42</a></div></div>
<div class="ttc" id="logger_8h_html_a2fdd5bff193a29ec6c7278da2851ea56"><div class="ttname"><a href="../../d1/d8c/logger_8h.html#a2fdd5bff193a29ec6c7278da2851ea56">AST_LOG_ERROR</a></div><div class="ttdeci">#define AST_LOG_ERROR</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d8c/logger_8h_source.html#l00290">logger.h:290</a></div></div>
<div class="ttc" id="strings_8h_html_a66daf21afabae2111fb397beb9a6c57e"><div class="ttname"><a href="../../d6/d90/strings_8h.html#a66daf21afabae2111fb397beb9a6c57e">ast_str_append_substr</a></div><div class="ttdeci">char * ast_str_append_substr(struct ast_str **buf, ssize_t maxlen, const char *src, size_t maxsrc)</div><div class="ttdoc">Append a non-NULL terminated substring to the end of a dynamic string. </div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d90/strings_8h_source.html#l01014">strings.h:1014</a></div></div>
<div class="ttc" id="func__env_8c_html_abd81d11867ad50357ea8332e8d36cf8aa002a351c4fed7e3b7dbc83129ecc397e"><div class="ttname"><a href="../../d4/daa/func__env_8c.html#abd81d11867ad50357ea8332e8d36cf8aa002a351c4fed7e3b7dbc83129ecc397e">FF_UNKNOWN</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d4/daa/func__env_8c_source.html#l00319">func_env.c:319</a></div></div>
<div class="ttc" id="logger_8h_html_aced66975c154ea0e2a8ec3bc818b4e08"><div class="ttname"><a href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a></div><div class="ttdeci">#define LOG_ERROR</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d8c/logger_8h_source.html#l00285">logger.h:285</a></div></div>
<div class="ttc" id="func__env_8c_html_abd81d11867ad50357ea8332e8d36cf8a"><div class="ttname"><a href="../../d4/daa/func__env_8c.html#abd81d11867ad50357ea8332e8d36cf8a">file_format</a></div><div class="ttdeci">file_format</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/daa/func__env_8c_source.html#l00318">func_env.c:318</a></div></div>
<div class="ttc" id="func__env_8c_html_ad2682ceb1f8ed7d6551cd75454aa25c4"><div class="ttname"><a href="../../d4/daa/func__env_8c.html#ad2682ceb1f8ed7d6551cd75454aa25c4">LINE_COUNTER</a></div><div class="ttdeci">#define LINE_COUNTER(cptr, term, counter)</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/daa/func__env_8c_source.html#l00425">func_env.c:425</a></div></div>
<div class="ttc" id="func__strings_8c_html_af24e73aaf92f3000fda15d285e66df24"><div class="ttname"><a href="../../d9/d1e/func__strings_8c.html#af24e73aaf92f3000fda15d285e66df24">len</a></div><div class="ttdeci">static int len(struct ast_channel *chan, const char *cmd, char *data, char *buf, size_t buflen)</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d1e/func__strings_8c_source.html#l01344">func_strings.c:1344</a></div></div>
<div class="ttc" id="main_2stdtime_2private_8h_html_ad65a8842cc674e3ddf69355898c0ecbf"><div class="ttname"><a href="../../d1/d6e/main_2stdtime_2private_8h.html#ad65a8842cc674e3ddf69355898c0ecbf">errno</a></div><div class="ttdeci">int errno</div></div>
<div class="ttc" id="strings_8h_html_a8239b9ad10367bfc936e9b60ff7706a8"><div class="ttname"><a href="../../d6/d90/strings_8h.html#a8239b9ad10367bfc936e9b60ff7706a8">ast_str_reset</a></div><div class="ttdeci">void ast_str_reset(struct ast_str *buf)</div><div class="ttdoc">Reset the content of a dynamic string. Useful before a series of ast_str_append. </div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d90/strings_8h_source.html#l00653">strings.h:653</a></div></div>
<div class="ttc" id="func__env_8c_html_abd81d11867ad50357ea8332e8d36cf8aa073f48545d1fcf02ce4bf0a9619914ca"><div class="ttname"><a href="../../d4/daa/func__env_8c.html#abd81d11867ad50357ea8332e8d36cf8aa073f48545d1fcf02ce4bf0a9619914ca">FF_UNIX</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d4/daa/func__env_8c_source.html#l00320">func_env.c:320</a></div></div>
<div class="ttc" id="include_2asterisk_2compat_8h_html_a23ec2cf7fc07ea8f817bbac758402baf"><div class="ttname"><a href="../../de/da3/include_2asterisk_2compat_8h.html#a23ec2cf7fc07ea8f817bbac758402baf">LLONG_MAX</a></div><div class="ttdeci">#define LLONG_MAX</div><div class="ttdef"><b>Definition:</b> <a href="../../de/da3/include_2asterisk_2compat_8h_source.html#l00060">include/asterisk/compat.h:60</a></div></div>
<div class="ttc" id="test__http__media__cache_8c_html_a80c8e3ae5087d90d422675d034eeebc7"><div class="ttname"><a href="../../d4/d45/test__http__media__cache_8c.html#a80c8e3ae5087d90d422675d034eeebc7">options</a></div><div class="ttdeci">static struct test_options options</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d45/test__http__media__cache_8c_source.html#l00062">test_http_media_cache.c:62</a></div></div>
<div class="ttc" id="chan__alsa_8c_html_a98f5e70e98f6dc48e3c5ba316066d540"><div class="ttname"><a href="../../da/d45/chan__alsa_8c.html#a98f5e70e98f6dc48e3c5ba316066d540">format</a></div><div class="ttdeci">static snd_pcm_format_t format</div><div class="ttdef"><b>Definition:</b> <a href="../../da/d45/chan__alsa_8c_source.html#l00102">chan_alsa.c:102</a></div></div>
<div class="ttc" id="include_2asterisk_2app_8h_html_a80cd3f6f786b59b742bcecfc0b3be7c2"><div class="ttname"><a href="../../d3/d93/include_2asterisk_2app_8h.html#a80cd3f6f786b59b742bcecfc0b3be7c2">AST_DECLARE_APP_ARGS</a></div><div class="ttdeci">#define AST_DECLARE_APP_ARGS(name, arglist)</div><div class="ttdoc">Declare a structure to hold an application&amp;#39;s arguments. </div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d93/include_2asterisk_2app_8h_source.html#l01249">include/asterisk/app.h:1249</a></div></div>
<div class="ttc" id="func__env_8c_html_abd81d11867ad50357ea8332e8d36cf8aa7c12b0aea0d0de06a80877d724b86525"><div class="ttname"><a href="../../d4/daa/func__env_8c.html#abd81d11867ad50357ea8332e8d36cf8aa7c12b0aea0d0de06a80877d724b86525">FF_DOS</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d4/daa/func__env_8c_source.html#l00321">func_env.c:321</a></div></div>
<div class="ttc" id="include_2asterisk_2app_8h_html_a037e9a5b28477b17e7c9acbe7ecb21d5"><div class="ttname"><a href="../../d3/d93/include_2asterisk_2app_8h.html#a037e9a5b28477b17e7c9acbe7ecb21d5">AST_APP_ARG</a></div><div class="ttdeci">#define AST_APP_ARG(name)</div><div class="ttdoc">Define an application argument. </div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d93/include_2asterisk_2app_8h_source.html#l01232">include/asterisk/app.h:1232</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a175689ce25a8a01263bda2409f4d0003"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a175689ce25a8a01263bda2409f4d0003">&#9670;&nbsp;</a></span>file_write()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int file_write </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="../../df/d3c/structast__channel.html">ast_channel</a> *&#160;</td>
          <td class="paramname"><em>chan</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>cmd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>data</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>value</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="../../d4/daa/func__env_8c_source.html#l00746">746</a> of file <a class="el" href="../../d4/daa/func__env_8c_source.html">func_env.c</a>.</p>

<p class="reference">References <a class="el" href="../../d5/dde/test__func__file_8c_source.html#l00046">args</a>, <a class="el" href="../../d3/d93/include_2asterisk_2app_8h_source.html#l01232">AST_APP_ARG</a>, <a class="el" href="../../d1/d8c/logger_8h_source.html#l00452">ast_debug</a>, <a class="el" href="../../d3/d93/include_2asterisk_2app_8h_source.html#l01249">AST_DECLARE_APP_ARGS</a>, <a class="el" href="../../da/df7/astobj2_8c_source.html#l00042">ast_log</a>, <a class="el" href="../../d1/d8c/logger_8h_source.html#l00290">AST_LOG_ERROR</a>, <a class="el" href="../../d3/d93/include_2asterisk_2app_8h_source.html#l01285">AST_STANDARD_APP_ARGS</a>, <a class="el" href="../../d1/d6e/main_2stdtime_2private_8h.html#ad65a8842cc674e3ddf69355898c0ecbf">errno</a>, <a class="el" href="../../d4/daa/func__env_8c_source.html#l00321">FF_DOS</a>, <a class="el" href="../../d4/daa/func__env_8c_source.html#l00322">FF_MAC</a>, <a class="el" href="../../d4/daa/func__env_8c_source.html#l00320">FF_UNIX</a>, <a class="el" href="../../d4/daa/func__env_8c_source.html#l00319">FF_UNKNOWN</a>, <a class="el" href="../../d4/daa/func__env_8c_source.html#l00439">file2format()</a>, <a class="el" href="../../da/d45/chan__alsa_8c_source.html#l00102">format</a>, <a class="el" href="../../d4/daa/func__env_8c_source.html#l00740">format2term()</a>, <a class="el" href="../../d4/daa/func__env_8c_source.html#l00425">LINE_COUNTER</a>, <a class="el" href="../../de/da3/include_2asterisk_2compat_8h_source.html#l00060">LLONG_MAX</a>, <a class="el" href="../../d1/d8c/logger_8h_source.html#l00285">LOG_ERROR</a>, <a class="el" href="../../d1/d8c/logger_8h_source.html#l00274">LOG_WARNING</a>, <a class="el" href="../../d4/d45/test__http__media__cache_8c_source.html#l00062">options</a>, and <a class="el" href="../../d6/d90/strings_8h_source.html#l00079">S_OR</a>.</p>
<div class="fragment"><div class="line"><a name="l00747"></a><span class="lineno">  747</span>&#160;{</div><div class="line"><a name="l00748"></a><span class="lineno">  748</span>&#160;   <a class="code" href="../../d3/d93/include_2asterisk_2app_8h.html#a80cd3f6f786b59b742bcecfc0b3be7c2">AST_DECLARE_APP_ARGS</a>(<a class="code" href="../../d5/dde/test__func__file_8c.html#a7df83d295429a2562396f1ec127a46c0">args</a>,</div><div class="line"><a name="l00749"></a><span class="lineno">  749</span>&#160;      <a class="code" href="../../d3/d93/include_2asterisk_2app_8h.html#a037e9a5b28477b17e7c9acbe7ecb21d5">AST_APP_ARG</a>(filename);</div><div class="line"><a name="l00750"></a><span class="lineno">  750</span>&#160;      <a class="code" href="../../d3/d93/include_2asterisk_2app_8h.html#a037e9a5b28477b17e7c9acbe7ecb21d5">AST_APP_ARG</a>(offset);</div><div class="line"><a name="l00751"></a><span class="lineno">  751</span>&#160;      <a class="code" href="../../d3/d93/include_2asterisk_2app_8h.html#a037e9a5b28477b17e7c9acbe7ecb21d5">AST_APP_ARG</a>(length);</div><div class="line"><a name="l00752"></a><span class="lineno">  752</span>&#160;      <a class="code" href="../../d3/d93/include_2asterisk_2app_8h.html#a037e9a5b28477b17e7c9acbe7ecb21d5">AST_APP_ARG</a>(<a class="code" href="../../d4/d45/test__http__media__cache_8c.html#a80c8e3ae5087d90d422675d034eeebc7">options</a>);</div><div class="line"><a name="l00753"></a><span class="lineno">  753</span>&#160;      <a class="code" href="../../d3/d93/include_2asterisk_2app_8h.html#a037e9a5b28477b17e7c9acbe7ecb21d5">AST_APP_ARG</a>(<a class="code" href="../../da/d45/chan__alsa_8c.html#a98f5e70e98f6dc48e3c5ba316066d540">format</a>);</div><div class="line"><a name="l00754"></a><span class="lineno">  754</span>&#160;   );</div><div class="line"><a name="l00755"></a><span class="lineno">  755</span>&#160;   int64_t offset = 0, length = <a class="code" href="../../de/da3/include_2asterisk_2compat_8h.html#a23ec2cf7fc07ea8f817bbac758402baf">LLONG_MAX</a>;</div><div class="line"><a name="l00756"></a><span class="lineno">  756</span>&#160;   off_t flength, vlength;</div><div class="line"><a name="l00757"></a><span class="lineno">  757</span>&#160;   <span class="keywordtype">size_t</span> foplen = 0;</div><div class="line"><a name="l00758"></a><span class="lineno">  758</span>&#160;   FILE *ff;</div><div class="line"><a name="l00759"></a><span class="lineno">  759</span>&#160;</div><div class="line"><a name="l00760"></a><span class="lineno">  760</span>&#160;   <a class="code" href="../../d3/d93/include_2asterisk_2app_8h.html#ac08f7eb1eb9476b30987c73e1052ada8">AST_STANDARD_APP_ARGS</a>(<a class="code" href="../../d5/dde/test__func__file_8c.html#a7df83d295429a2562396f1ec127a46c0">args</a>, data);</div><div class="line"><a name="l00761"></a><span class="lineno">  761</span>&#160;</div><div class="line"><a name="l00762"></a><span class="lineno">  762</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d5/dde/test__func__file_8c.html#a7df83d295429a2562396f1ec127a46c0">args</a>.argc &gt; 1) {</div><div class="line"><a name="l00763"></a><span class="lineno">  763</span>&#160;      sscanf(<a class="code" href="../../d5/dde/test__func__file_8c.html#a7df83d295429a2562396f1ec127a46c0">args</a>.offset, <span class="stringliteral">&quot;%&quot;</span> SCNd64, &amp;offset);</div><div class="line"><a name="l00764"></a><span class="lineno">  764</span>&#160;   }</div><div class="line"><a name="l00765"></a><span class="lineno">  765</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d5/dde/test__func__file_8c.html#a7df83d295429a2562396f1ec127a46c0">args</a>.argc &gt; 2) {</div><div class="line"><a name="l00766"></a><span class="lineno">  766</span>&#160;      sscanf(<a class="code" href="../../d5/dde/test__func__file_8c.html#a7df83d295429a2562396f1ec127a46c0">args</a>.length, <span class="stringliteral">&quot;%&quot;</span> SCNd64, &amp;length);</div><div class="line"><a name="l00767"></a><span class="lineno">  767</span>&#160;   }</div><div class="line"><a name="l00768"></a><span class="lineno">  768</span>&#160;</div><div class="line"><a name="l00769"></a><span class="lineno">  769</span>&#160;   vlength = strlen(<a class="code" href="../../d4/d2f/syslog_8c.html#ac4f474c82e82cbb89ca7c36dd52be0ed">value</a>);</div><div class="line"><a name="l00770"></a><span class="lineno">  770</span>&#160;</div><div class="line"><a name="l00771"></a><span class="lineno">  771</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d5/dde/test__func__file_8c.html#a7df83d295429a2562396f1ec127a46c0">args</a>.argc &lt; 4 || !strchr(<a class="code" href="../../d5/dde/test__func__file_8c.html#a7df83d295429a2562396f1ec127a46c0">args</a>.options, <span class="charliteral">&#39;l&#39;</span>)) {</div><div class="line"><a name="l00772"></a><span class="lineno">  772</span>&#160;      <span class="comment">/* Character-based mode */</span></div><div class="line"><a name="l00773"></a><span class="lineno">  773</span>&#160;</div><div class="line"><a name="l00774"></a><span class="lineno">  774</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="../../d5/dde/test__func__file_8c.html#a7df83d295429a2562396f1ec127a46c0">args</a>.argc &gt; 3 &amp;&amp; strchr(<a class="code" href="../../d5/dde/test__func__file_8c.html#a7df83d295429a2562396f1ec127a46c0">args</a>.options, <span class="charliteral">&#39;a&#39;</span>)) {</div><div class="line"><a name="l00775"></a><span class="lineno">  775</span>&#160;         <span class="comment">/* Append mode */</span></div><div class="line"><a name="l00776"></a><span class="lineno">  776</span>&#160;         <span class="keywordflow">if</span> (!(ff = fopen(<a class="code" href="../../d5/dde/test__func__file_8c.html#a7df83d295429a2562396f1ec127a46c0">args</a>.filename, <span class="stringliteral">&quot;a&quot;</span>))) {</div><div class="line"><a name="l00777"></a><span class="lineno">  777</span>&#160;            <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Cannot open file &#39;%s&#39; for appending: %s\n&quot;</span>, <a class="code" href="../../d5/dde/test__func__file_8c.html#a7df83d295429a2562396f1ec127a46c0">args</a>.filename, strerror(<a class="code" href="../../d1/d6e/main_2stdtime_2private_8h.html#ad65a8842cc674e3ddf69355898c0ecbf">errno</a>));</div><div class="line"><a name="l00778"></a><span class="lineno">  778</span>&#160;            <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00779"></a><span class="lineno">  779</span>&#160;         }</div><div class="line"><a name="l00780"></a><span class="lineno">  780</span>&#160;         <span class="keywordflow">if</span> (fwrite(<a class="code" href="../../d4/d2f/syslog_8c.html#ac4f474c82e82cbb89ca7c36dd52be0ed">value</a>, 1, vlength, ff) &lt; vlength) {</div><div class="line"><a name="l00781"></a><span class="lineno">  781</span>&#160;            <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Short write?!!\n&quot;</span>);</div><div class="line"><a name="l00782"></a><span class="lineno">  782</span>&#160;         }</div><div class="line"><a name="l00783"></a><span class="lineno">  783</span>&#160;         fclose(ff);</div><div class="line"><a name="l00784"></a><span class="lineno">  784</span>&#160;         <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00785"></a><span class="lineno">  785</span>&#160;      } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (offset == 0 &amp;&amp; length == <a class="code" href="../../de/da3/include_2asterisk_2compat_8h.html#a23ec2cf7fc07ea8f817bbac758402baf">LLONG_MAX</a>) {</div><div class="line"><a name="l00786"></a><span class="lineno">  786</span>&#160;         <span class="keywordflow">if</span> (!(ff = fopen(<a class="code" href="../../d5/dde/test__func__file_8c.html#a7df83d295429a2562396f1ec127a46c0">args</a>.filename, <span class="stringliteral">&quot;w&quot;</span>))) {</div><div class="line"><a name="l00787"></a><span class="lineno">  787</span>&#160;            <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Cannot open file &#39;%s&#39; for writing: %s\n&quot;</span>, <a class="code" href="../../d5/dde/test__func__file_8c.html#a7df83d295429a2562396f1ec127a46c0">args</a>.filename, strerror(<a class="code" href="../../d1/d6e/main_2stdtime_2private_8h.html#ad65a8842cc674e3ddf69355898c0ecbf">errno</a>));</div><div class="line"><a name="l00788"></a><span class="lineno">  788</span>&#160;            <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00789"></a><span class="lineno">  789</span>&#160;         }</div><div class="line"><a name="l00790"></a><span class="lineno">  790</span>&#160;         <span class="keywordflow">if</span> (fwrite(<a class="code" href="../../d4/d2f/syslog_8c.html#ac4f474c82e82cbb89ca7c36dd52be0ed">value</a>, 1, vlength, ff) &lt; vlength) {</div><div class="line"><a name="l00791"></a><span class="lineno">  791</span>&#160;            <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Short write?!!\n&quot;</span>);</div><div class="line"><a name="l00792"></a><span class="lineno">  792</span>&#160;         }</div><div class="line"><a name="l00793"></a><span class="lineno">  793</span>&#160;         fclose(ff);</div><div class="line"><a name="l00794"></a><span class="lineno">  794</span>&#160;         <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00795"></a><span class="lineno">  795</span>&#160;      }</div><div class="line"><a name="l00796"></a><span class="lineno">  796</span>&#160;</div><div class="line"><a name="l00797"></a><span class="lineno">  797</span>&#160;      <span class="keywordflow">if</span> (!(ff = fopen(<a class="code" href="../../d5/dde/test__func__file_8c.html#a7df83d295429a2562396f1ec127a46c0">args</a>.filename, <span class="stringliteral">&quot;r+&quot;</span>))) {</div><div class="line"><a name="l00798"></a><span class="lineno">  798</span>&#160;         <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Cannot open file &#39;%s&#39; for modification: %s\n&quot;</span>, <a class="code" href="../../d5/dde/test__func__file_8c.html#a7df83d295429a2562396f1ec127a46c0">args</a>.filename, strerror(<a class="code" href="../../d1/d6e/main_2stdtime_2private_8h.html#ad65a8842cc674e3ddf69355898c0ecbf">errno</a>));</div><div class="line"><a name="l00799"></a><span class="lineno">  799</span>&#160;         <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00800"></a><span class="lineno">  800</span>&#160;      }</div><div class="line"><a name="l00801"></a><span class="lineno">  801</span>&#160;      fseeko(ff, 0, SEEK_END);</div><div class="line"><a name="l00802"></a><span class="lineno">  802</span>&#160;      flength = ftello(ff);</div><div class="line"><a name="l00803"></a><span class="lineno">  803</span>&#160;</div><div class="line"><a name="l00804"></a><span class="lineno">  804</span>&#160;      <span class="keywordflow">if</span> (offset &lt; 0) {</div><div class="line"><a name="l00805"></a><span class="lineno">  805</span>&#160;         <span class="keywordflow">if</span> (fseeko(ff, offset, SEEK_END)) {</div><div class="line"><a name="l00806"></a><span class="lineno">  806</span>&#160;            <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Cannot seek to offset of &#39;%s&#39;: %s\n&quot;</span>, <a class="code" href="../../d5/dde/test__func__file_8c.html#a7df83d295429a2562396f1ec127a46c0">args</a>.filename, strerror(<a class="code" href="../../d1/d6e/main_2stdtime_2private_8h.html#ad65a8842cc674e3ddf69355898c0ecbf">errno</a>));</div><div class="line"><a name="l00807"></a><span class="lineno">  807</span>&#160;            fclose(ff);</div><div class="line"><a name="l00808"></a><span class="lineno">  808</span>&#160;            <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l00809"></a><span class="lineno">  809</span>&#160;         }</div><div class="line"><a name="l00810"></a><span class="lineno">  810</span>&#160;         <span class="keywordflow">if</span> ((offset = ftello(ff)) &lt; 0) {</div><div class="line"><a name="l00811"></a><span class="lineno">  811</span>&#160;            <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#a2fdd5bff193a29ec6c7278da2851ea56">AST_LOG_ERROR</a>, <span class="stringliteral">&quot;Cannot determine offset position of &#39;%s&#39;: %s\n&quot;</span>, <a class="code" href="../../d5/dde/test__func__file_8c.html#a7df83d295429a2562396f1ec127a46c0">args</a>.filename, strerror(<a class="code" href="../../d1/d6e/main_2stdtime_2private_8h.html#ad65a8842cc674e3ddf69355898c0ecbf">errno</a>));</div><div class="line"><a name="l00812"></a><span class="lineno">  812</span>&#160;            fclose(ff);</div><div class="line"><a name="l00813"></a><span class="lineno">  813</span>&#160;            <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l00814"></a><span class="lineno">  814</span>&#160;         }</div><div class="line"><a name="l00815"></a><span class="lineno">  815</span>&#160;      }</div><div class="line"><a name="l00816"></a><span class="lineno">  816</span>&#160;</div><div class="line"><a name="l00817"></a><span class="lineno">  817</span>&#160;      <span class="keywordflow">if</span> (length &lt; 0) {</div><div class="line"><a name="l00818"></a><span class="lineno">  818</span>&#160;         length = flength - offset + length;</div><div class="line"><a name="l00819"></a><span class="lineno">  819</span>&#160;         <span class="keywordflow">if</span> (length &lt; 0) {</div><div class="line"><a name="l00820"></a><span class="lineno">  820</span>&#160;            <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Length &#39;%s&#39; exceeds the file length.  No data will be written.\n&quot;</span>, <a class="code" href="../../d5/dde/test__func__file_8c.html#a7df83d295429a2562396f1ec127a46c0">args</a>.length);</div><div class="line"><a name="l00821"></a><span class="lineno">  821</span>&#160;            fclose(ff);</div><div class="line"><a name="l00822"></a><span class="lineno">  822</span>&#160;            <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l00823"></a><span class="lineno">  823</span>&#160;         }</div><div class="line"><a name="l00824"></a><span class="lineno">  824</span>&#160;      }</div><div class="line"><a name="l00825"></a><span class="lineno">  825</span>&#160;</div><div class="line"><a name="l00826"></a><span class="lineno">  826</span>&#160;      fseeko(ff, offset, SEEK_SET);</div><div class="line"><a name="l00827"></a><span class="lineno">  827</span>&#160;</div><div class="line"><a name="l00828"></a><span class="lineno">  828</span>&#160;      <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(3, <span class="stringliteral">&quot;offset=%s/%&quot;</span> PRId64 <span class="stringliteral">&quot;, length=%s/%&quot;</span> PRId64 <span class="stringliteral">&quot;, vlength=%&quot;</span> PRId64 <span class="stringliteral">&quot;, flength=%&quot;</span> PRId64 <span class="stringliteral">&quot;\n&quot;</span>,</div><div class="line"><a name="l00829"></a><span class="lineno">  829</span>&#160;         <a class="code" href="../../d6/d90/strings_8h.html#a2faaa16929951bfd2802b7829a100ba2">S_OR</a>(<a class="code" href="../../d5/dde/test__func__file_8c.html#a7df83d295429a2562396f1ec127a46c0">args</a>.offset, <span class="stringliteral">&quot;(null)&quot;</span>), offset, <a class="code" href="../../d6/d90/strings_8h.html#a2faaa16929951bfd2802b7829a100ba2">S_OR</a>(<a class="code" href="../../d5/dde/test__func__file_8c.html#a7df83d295429a2562396f1ec127a46c0">args</a>.length, <span class="stringliteral">&quot;(null)&quot;</span>), length, vlength, flength);</div><div class="line"><a name="l00830"></a><span class="lineno">  830</span>&#160;</div><div class="line"><a name="l00831"></a><span class="lineno">  831</span>&#160;      <span class="keywordflow">if</span> (length == vlength) {</div><div class="line"><a name="l00832"></a><span class="lineno">  832</span>&#160;         <span class="comment">/* Simplest case, a straight replace */</span></div><div class="line"><a name="l00833"></a><span class="lineno">  833</span>&#160;         <span class="keywordflow">if</span> (fwrite(<a class="code" href="../../d4/d2f/syslog_8c.html#ac4f474c82e82cbb89ca7c36dd52be0ed">value</a>, 1, vlength, ff) &lt; vlength) {</div><div class="line"><a name="l00834"></a><span class="lineno">  834</span>&#160;            <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Short write?!!\n&quot;</span>);</div><div class="line"><a name="l00835"></a><span class="lineno">  835</span>&#160;         }</div><div class="line"><a name="l00836"></a><span class="lineno">  836</span>&#160;         fclose(ff);</div><div class="line"><a name="l00837"></a><span class="lineno">  837</span>&#160;      } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (length == <a class="code" href="../../de/da3/include_2asterisk_2compat_8h.html#a23ec2cf7fc07ea8f817bbac758402baf">LLONG_MAX</a>) {</div><div class="line"><a name="l00838"></a><span class="lineno">  838</span>&#160;         <span class="comment">/* Simple truncation */</span></div><div class="line"><a name="l00839"></a><span class="lineno">  839</span>&#160;         <span class="keywordflow">if</span> (fwrite(<a class="code" href="../../d4/d2f/syslog_8c.html#ac4f474c82e82cbb89ca7c36dd52be0ed">value</a>, 1, vlength, ff) &lt; vlength) {</div><div class="line"><a name="l00840"></a><span class="lineno">  840</span>&#160;            <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Short write?!!\n&quot;</span>);</div><div class="line"><a name="l00841"></a><span class="lineno">  841</span>&#160;         }</div><div class="line"><a name="l00842"></a><span class="lineno">  842</span>&#160;         fclose(ff);</div><div class="line"><a name="l00843"></a><span class="lineno">  843</span>&#160;         <span class="keywordflow">if</span> (truncate(<a class="code" href="../../d5/dde/test__func__file_8c.html#a7df83d295429a2562396f1ec127a46c0">args</a>.filename, offset + vlength)) {</div><div class="line"><a name="l00844"></a><span class="lineno">  844</span>&#160;            <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Unable to truncate the file: %s\n&quot;</span>, strerror(<a class="code" href="../../d1/d6e/main_2stdtime_2private_8h.html#ad65a8842cc674e3ddf69355898c0ecbf">errno</a>));</div><div class="line"><a name="l00845"></a><span class="lineno">  845</span>&#160;         }</div><div class="line"><a name="l00846"></a><span class="lineno">  846</span>&#160;      } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (length &gt; vlength) {</div><div class="line"><a name="l00847"></a><span class="lineno">  847</span>&#160;         <span class="comment">/* More complex -- need to close a gap */</span></div><div class="line"><a name="l00848"></a><span class="lineno">  848</span>&#160;         <span class="keywordtype">char</span> fbuf[4096];</div><div class="line"><a name="l00849"></a><span class="lineno">  849</span>&#160;         off_t cur;</div><div class="line"><a name="l00850"></a><span class="lineno">  850</span>&#160;         <span class="keywordflow">if</span> (fwrite(<a class="code" href="../../d4/d2f/syslog_8c.html#ac4f474c82e82cbb89ca7c36dd52be0ed">value</a>, 1, vlength, ff) &lt; vlength) {</div><div class="line"><a name="l00851"></a><span class="lineno">  851</span>&#160;            <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Short write?!!\n&quot;</span>);</div><div class="line"><a name="l00852"></a><span class="lineno">  852</span>&#160;         }</div><div class="line"><a name="l00853"></a><span class="lineno">  853</span>&#160;         fseeko(ff, length - vlength, SEEK_CUR);</div><div class="line"><a name="l00854"></a><span class="lineno">  854</span>&#160;         <span class="keywordflow">while</span> ((cur = ftello(ff)) &lt; flength) {</div><div class="line"><a name="l00855"></a><span class="lineno">  855</span>&#160;            <span class="keywordflow">if</span> (fread(fbuf, 1, <span class="keyword">sizeof</span>(fbuf), ff) &lt; <span class="keyword">sizeof</span>(fbuf) &amp;&amp; !feof(ff)) {</div><div class="line"><a name="l00856"></a><span class="lineno">  856</span>&#160;               <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Short read?!!\n&quot;</span>);</div><div class="line"><a name="l00857"></a><span class="lineno">  857</span>&#160;            }</div><div class="line"><a name="l00858"></a><span class="lineno">  858</span>&#160;            fseeko(ff, cur + vlength - length, SEEK_SET);</div><div class="line"><a name="l00859"></a><span class="lineno">  859</span>&#160;            <span class="keywordflow">if</span> (fwrite(fbuf, 1, <span class="keyword">sizeof</span>(fbuf), ff) &lt; <span class="keyword">sizeof</span>(fbuf)) {</div><div class="line"><a name="l00860"></a><span class="lineno">  860</span>&#160;               <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Short write?!!\n&quot;</span>);</div><div class="line"><a name="l00861"></a><span class="lineno">  861</span>&#160;            }</div><div class="line"><a name="l00862"></a><span class="lineno">  862</span>&#160;            <span class="comment">/* Seek to where we stopped reading */</span></div><div class="line"><a name="l00863"></a><span class="lineno">  863</span>&#160;            <span class="keywordflow">if</span> (fseeko(ff, cur + <span class="keyword">sizeof</span>(fbuf), SEEK_SET) &lt; 0) {</div><div class="line"><a name="l00864"></a><span class="lineno">  864</span>&#160;               <span class="comment">/* Only reason for seek to fail is EOF */</span></div><div class="line"><a name="l00865"></a><span class="lineno">  865</span>&#160;               <span class="keywordflow">break</span>;</div><div class="line"><a name="l00866"></a><span class="lineno">  866</span>&#160;            }</div><div class="line"><a name="l00867"></a><span class="lineno">  867</span>&#160;         }</div><div class="line"><a name="l00868"></a><span class="lineno">  868</span>&#160;         fclose(ff);</div><div class="line"><a name="l00869"></a><span class="lineno">  869</span>&#160;         <span class="keywordflow">if</span> (truncate(<a class="code" href="../../d5/dde/test__func__file_8c.html#a7df83d295429a2562396f1ec127a46c0">args</a>.filename, flength - (length - vlength))) {</div><div class="line"><a name="l00870"></a><span class="lineno">  870</span>&#160;            <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Unable to truncate the file: %s\n&quot;</span>, strerror(<a class="code" href="../../d1/d6e/main_2stdtime_2private_8h.html#ad65a8842cc674e3ddf69355898c0ecbf">errno</a>));</div><div class="line"><a name="l00871"></a><span class="lineno">  871</span>&#160;         }</div><div class="line"><a name="l00872"></a><span class="lineno">  872</span>&#160;      } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00873"></a><span class="lineno">  873</span>&#160;         <span class="comment">/* Most complex -- need to open a gap */</span></div><div class="line"><a name="l00874"></a><span class="lineno">  874</span>&#160;         <span class="keywordtype">char</span> fbuf[4096];</div><div class="line"><a name="l00875"></a><span class="lineno">  875</span>&#160;         off_t lastwritten = flength + vlength - length;</div><div class="line"><a name="l00876"></a><span class="lineno">  876</span>&#160;</div><div class="line"><a name="l00877"></a><span class="lineno">  877</span>&#160;         <span class="comment">/* Start reading exactly the buffer size back from the end. */</span></div><div class="line"><a name="l00878"></a><span class="lineno">  878</span>&#160;         fseeko(ff, flength - <span class="keyword">sizeof</span>(fbuf), SEEK_SET);</div><div class="line"><a name="l00879"></a><span class="lineno">  879</span>&#160;         <span class="keywordflow">while</span> (offset &lt; ftello(ff)) {</div><div class="line"><a name="l00880"></a><span class="lineno">  880</span>&#160;            <span class="keywordflow">if</span> (fread(fbuf, 1, <span class="keyword">sizeof</span>(fbuf), ff) &lt; <span class="keyword">sizeof</span>(fbuf)) {</div><div class="line"><a name="l00881"></a><span class="lineno">  881</span>&#160;               <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Short read?!!\n&quot;</span>);</div><div class="line"><a name="l00882"></a><span class="lineno">  882</span>&#160;               fclose(ff);</div><div class="line"><a name="l00883"></a><span class="lineno">  883</span>&#160;               <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l00884"></a><span class="lineno">  884</span>&#160;            }</div><div class="line"><a name="l00885"></a><span class="lineno">  885</span>&#160;            <span class="comment">/* Since the read moved our file ptr forward, we reverse, but</span></div><div class="line"><a name="l00886"></a><span class="lineno">  886</span>&#160;<span class="comment">             * seek an offset equal to the amount we want to extend the</span></div><div class="line"><a name="l00887"></a><span class="lineno">  887</span>&#160;<span class="comment">             * file by */</span></div><div class="line"><a name="l00888"></a><span class="lineno">  888</span>&#160;            fseeko(ff, vlength - length - <span class="keyword">sizeof</span>(fbuf), SEEK_CUR);</div><div class="line"><a name="l00889"></a><span class="lineno">  889</span>&#160;</div><div class="line"><a name="l00890"></a><span class="lineno">  890</span>&#160;            <span class="comment">/* Note the location of this buffer -- we must not overwrite this position. */</span></div><div class="line"><a name="l00891"></a><span class="lineno">  891</span>&#160;            lastwritten = ftello(ff);</div><div class="line"><a name="l00892"></a><span class="lineno">  892</span>&#160;</div><div class="line"><a name="l00893"></a><span class="lineno">  893</span>&#160;            <span class="keywordflow">if</span> (fwrite(fbuf, 1, <span class="keyword">sizeof</span>(fbuf), ff) &lt; <span class="keyword">sizeof</span>(fbuf)) {</div><div class="line"><a name="l00894"></a><span class="lineno">  894</span>&#160;               <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Short write?!!\n&quot;</span>);</div><div class="line"><a name="l00895"></a><span class="lineno">  895</span>&#160;               fclose(ff);</div><div class="line"><a name="l00896"></a><span class="lineno">  896</span>&#160;               <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l00897"></a><span class="lineno">  897</span>&#160;            }</div><div class="line"><a name="l00898"></a><span class="lineno">  898</span>&#160;</div><div class="line"><a name="l00899"></a><span class="lineno">  899</span>&#160;            <span class="keywordflow">if</span> (lastwritten &lt; offset + <span class="keyword">sizeof</span>(fbuf)) {</div><div class="line"><a name="l00900"></a><span class="lineno">  900</span>&#160;               <span class="keywordflow">break</span>;</div><div class="line"><a name="l00901"></a><span class="lineno">  901</span>&#160;            }</div><div class="line"><a name="l00902"></a><span class="lineno">  902</span>&#160;            <span class="comment">/* Our file pointer is now either pointing to the end of the</span></div><div class="line"><a name="l00903"></a><span class="lineno">  903</span>&#160;<span class="comment">             * file (new position) or a multiple of the fbuf size back from</span></div><div class="line"><a name="l00904"></a><span class="lineno">  904</span>&#160;<span class="comment">             * that point.  Move back to where we want to start reading</span></div><div class="line"><a name="l00905"></a><span class="lineno">  905</span>&#160;<span class="comment">             * again.  We never actually try to read beyond the end of the</span></div><div class="line"><a name="l00906"></a><span class="lineno">  906</span>&#160;<span class="comment">             * file, so we don&#39;t have do deal with short reads, as we would</span></div><div class="line"><a name="l00907"></a><span class="lineno">  907</span>&#160;<span class="comment">             * when we&#39;re shortening the file. */</span></div><div class="line"><a name="l00908"></a><span class="lineno">  908</span>&#160;            fseeko(ff, 2 * <span class="keyword">sizeof</span>(fbuf) + vlength - length, SEEK_CUR);</div><div class="line"><a name="l00909"></a><span class="lineno">  909</span>&#160;         }</div><div class="line"><a name="l00910"></a><span class="lineno">  910</span>&#160;</div><div class="line"><a name="l00911"></a><span class="lineno">  911</span>&#160;         <span class="comment">/* Last part of the file that we need to preserve */</span></div><div class="line"><a name="l00912"></a><span class="lineno">  912</span>&#160;         <span class="keywordflow">if</span> (fseeko(ff, offset + length, SEEK_SET)) {</div><div class="line"><a name="l00913"></a><span class="lineno">  913</span>&#160;            <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Unable to seek to %&quot;</span> PRId64 <span class="stringliteral">&quot; + %&quot;</span> PRId64 <span class="stringliteral">&quot; != %&quot;</span> PRId64 <span class="stringliteral">&quot;?)\n&quot;</span>, offset, length, ftello(ff));</div><div class="line"><a name="l00914"></a><span class="lineno">  914</span>&#160;         }</div><div class="line"><a name="l00915"></a><span class="lineno">  915</span>&#160;</div><div class="line"><a name="l00916"></a><span class="lineno">  916</span>&#160;         <span class="comment">/* Doesn&#39;t matter how much we read -- just need to restrict the write */</span></div><div class="line"><a name="l00917"></a><span class="lineno">  917</span>&#160;         <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(1, <span class="stringliteral">&quot;Reading at %&quot;</span> PRId64 <span class="stringliteral">&quot;\n&quot;</span>, ftello(ff));</div><div class="line"><a name="l00918"></a><span class="lineno">  918</span>&#160;         <span class="keywordflow">if</span> (fread(fbuf, 1, <span class="keyword">sizeof</span>(fbuf), ff) &lt; <span class="keyword">sizeof</span>(fbuf) &amp;&amp; !feof(ff)) {</div><div class="line"><a name="l00919"></a><span class="lineno">  919</span>&#160;            <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Short read?!!\n&quot;</span>);</div><div class="line"><a name="l00920"></a><span class="lineno">  920</span>&#160;         }</div><div class="line"><a name="l00921"></a><span class="lineno">  921</span>&#160;         fseek(ff, offset, SEEK_SET);</div><div class="line"><a name="l00922"></a><span class="lineno">  922</span>&#160;         <span class="comment">/* Write out the value, then write just up until where we last moved some data */</span></div><div class="line"><a name="l00923"></a><span class="lineno">  923</span>&#160;         <span class="keywordflow">if</span> (fwrite(<a class="code" href="../../d4/d2f/syslog_8c.html#ac4f474c82e82cbb89ca7c36dd52be0ed">value</a>, 1, vlength, ff) &lt; vlength) {</div><div class="line"><a name="l00924"></a><span class="lineno">  924</span>&#160;            <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Short write?!!\n&quot;</span>);</div><div class="line"><a name="l00925"></a><span class="lineno">  925</span>&#160;         } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00926"></a><span class="lineno">  926</span>&#160;            off_t curpos = ftello(ff);</div><div class="line"><a name="l00927"></a><span class="lineno">  927</span>&#160;            foplen = lastwritten - curpos;</div><div class="line"><a name="l00928"></a><span class="lineno">  928</span>&#160;            <span class="keywordflow">if</span> (fwrite(fbuf, 1, foplen, ff) &lt; foplen) {</div><div class="line"><a name="l00929"></a><span class="lineno">  929</span>&#160;               <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Short write?!!\n&quot;</span>);</div><div class="line"><a name="l00930"></a><span class="lineno">  930</span>&#160;            }</div><div class="line"><a name="l00931"></a><span class="lineno">  931</span>&#160;         }</div><div class="line"><a name="l00932"></a><span class="lineno">  932</span>&#160;         fclose(ff);</div><div class="line"><a name="l00933"></a><span class="lineno">  933</span>&#160;      }</div><div class="line"><a name="l00934"></a><span class="lineno">  934</span>&#160;   } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00935"></a><span class="lineno">  935</span>&#160;      <span class="keyword">enum</span> <a class="code" href="../../d4/daa/func__env_8c.html#abd81d11867ad50357ea8332e8d36cf8a">file_format</a> newline_format = <a class="code" href="../../d4/daa/func__env_8c.html#abd81d11867ad50357ea8332e8d36cf8aa002a351c4fed7e3b7dbc83129ecc397e">FF_UNKNOWN</a>;</div><div class="line"><a name="l00936"></a><span class="lineno">  936</span>&#160;</div><div class="line"><a name="l00937"></a><span class="lineno">  937</span>&#160;      <span class="comment">/* Line mode */</span></div><div class="line"><a name="l00938"></a><span class="lineno">  938</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="../../d5/dde/test__func__file_8c.html#a7df83d295429a2562396f1ec127a46c0">args</a>.argc == 5) {</div><div class="line"><a name="l00939"></a><span class="lineno">  939</span>&#160;         <span class="keywordflow">if</span> (tolower(<a class="code" href="../../d5/dde/test__func__file_8c.html#a7df83d295429a2562396f1ec127a46c0">args</a>.format[0]) == <span class="charliteral">&#39;u&#39;</span>) {</div><div class="line"><a name="l00940"></a><span class="lineno">  940</span>&#160;            newline_format = <a class="code" href="../../d4/daa/func__env_8c.html#abd81d11867ad50357ea8332e8d36cf8aa073f48545d1fcf02ce4bf0a9619914ca">FF_UNIX</a>;</div><div class="line"><a name="l00941"></a><span class="lineno">  941</span>&#160;         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (tolower(<a class="code" href="../../d5/dde/test__func__file_8c.html#a7df83d295429a2562396f1ec127a46c0">args</a>.format[0]) == <span class="charliteral">&#39;m&#39;</span>) {</div><div class="line"><a name="l00942"></a><span class="lineno">  942</span>&#160;            newline_format = <a class="code" href="../../d4/daa/func__env_8c.html#abd81d11867ad50357ea8332e8d36cf8aaf1329bf6f765b89c787e5a5151db2102">FF_MAC</a>;</div><div class="line"><a name="l00943"></a><span class="lineno">  943</span>&#160;         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (tolower(<a class="code" href="../../d5/dde/test__func__file_8c.html#a7df83d295429a2562396f1ec127a46c0">args</a>.format[0]) == <span class="charliteral">&#39;d&#39;</span>) {</div><div class="line"><a name="l00944"></a><span class="lineno">  944</span>&#160;            newline_format = <a class="code" href="../../d4/daa/func__env_8c.html#abd81d11867ad50357ea8332e8d36cf8aa7c12b0aea0d0de06a80877d724b86525">FF_DOS</a>;</div><div class="line"><a name="l00945"></a><span class="lineno">  945</span>&#160;         }</div><div class="line"><a name="l00946"></a><span class="lineno">  946</span>&#160;      }</div><div class="line"><a name="l00947"></a><span class="lineno">  947</span>&#160;      <span class="keywordflow">if</span> (newline_format == <a class="code" href="../../d4/daa/func__env_8c.html#abd81d11867ad50357ea8332e8d36cf8aa002a351c4fed7e3b7dbc83129ecc397e">FF_UNKNOWN</a> &amp;&amp; (newline_format = <a class="code" href="../../d4/daa/func__env_8c.html#a4afbbc5eaddf30a658b75c9e2f7b4ee3">file2format</a>(<a class="code" href="../../d5/dde/test__func__file_8c.html#a7df83d295429a2562396f1ec127a46c0">args</a>.filename)) == <a class="code" href="../../d4/daa/func__env_8c.html#abd81d11867ad50357ea8332e8d36cf8aa002a351c4fed7e3b7dbc83129ecc397e">FF_UNKNOWN</a>) {</div><div class="line"><a name="l00948"></a><span class="lineno">  948</span>&#160;         <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;File &#39;%s&#39; not in line format\n&quot;</span>, <a class="code" href="../../d5/dde/test__func__file_8c.html#a7df83d295429a2562396f1ec127a46c0">args</a>.filename);</div><div class="line"><a name="l00949"></a><span class="lineno">  949</span>&#160;         <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l00950"></a><span class="lineno">  950</span>&#160;      }</div><div class="line"><a name="l00951"></a><span class="lineno">  951</span>&#160;</div><div class="line"><a name="l00952"></a><span class="lineno">  952</span>&#160;      <span class="keywordflow">if</span> (strchr(<a class="code" href="../../d5/dde/test__func__file_8c.html#a7df83d295429a2562396f1ec127a46c0">args</a>.options, <span class="charliteral">&#39;a&#39;</span>)) {</div><div class="line"><a name="l00953"></a><span class="lineno">  953</span>&#160;         <span class="comment">/* Append to file */</span></div><div class="line"><a name="l00954"></a><span class="lineno">  954</span>&#160;         <span class="keywordflow">if</span> (!(ff = fopen(<a class="code" href="../../d5/dde/test__func__file_8c.html#a7df83d295429a2562396f1ec127a46c0">args</a>.filename, <span class="stringliteral">&quot;a&quot;</span>))) {</div><div class="line"><a name="l00955"></a><span class="lineno">  955</span>&#160;            <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Unable to open &#39;%s&#39; for appending: %s\n&quot;</span>, <a class="code" href="../../d5/dde/test__func__file_8c.html#a7df83d295429a2562396f1ec127a46c0">args</a>.filename, strerror(<a class="code" href="../../d1/d6e/main_2stdtime_2private_8h.html#ad65a8842cc674e3ddf69355898c0ecbf">errno</a>));</div><div class="line"><a name="l00956"></a><span class="lineno">  956</span>&#160;            <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l00957"></a><span class="lineno">  957</span>&#160;         }</div><div class="line"><a name="l00958"></a><span class="lineno">  958</span>&#160;         <span class="keywordflow">if</span> (fwrite(<a class="code" href="../../d4/d2f/syslog_8c.html#ac4f474c82e82cbb89ca7c36dd52be0ed">value</a>, 1, vlength, ff) &lt; vlength) {</div><div class="line"><a name="l00959"></a><span class="lineno">  959</span>&#160;            <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Short write?!!\n&quot;</span>);</div><div class="line"><a name="l00960"></a><span class="lineno">  960</span>&#160;         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strchr(<a class="code" href="../../d5/dde/test__func__file_8c.html#a7df83d295429a2562396f1ec127a46c0">args</a>.options, <span class="charliteral">&#39;d&#39;</span>) &amp;&amp; fwrite(<a class="code" href="../../d4/daa/func__env_8c.html#a9cc0a8665ffb4519792ae07a380a2753">format2term</a>(newline_format), 1, strlen(<a class="code" href="../../d4/daa/func__env_8c.html#a9cc0a8665ffb4519792ae07a380a2753">format2term</a>(newline_format)), ff) &lt; strlen(<a class="code" href="../../d4/daa/func__env_8c.html#a9cc0a8665ffb4519792ae07a380a2753">format2term</a>(newline_format))) {</div><div class="line"><a name="l00961"></a><span class="lineno">  961</span>&#160;            <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Short write?!!\n&quot;</span>);</div><div class="line"><a name="l00962"></a><span class="lineno">  962</span>&#160;         }</div><div class="line"><a name="l00963"></a><span class="lineno">  963</span>&#160;         fclose(ff);</div><div class="line"><a name="l00964"></a><span class="lineno">  964</span>&#160;      } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (offset == 0 &amp;&amp; length == <a class="code" href="../../de/da3/include_2asterisk_2compat_8h.html#a23ec2cf7fc07ea8f817bbac758402baf">LLONG_MAX</a>) {</div><div class="line"><a name="l00965"></a><span class="lineno">  965</span>&#160;         <span class="comment">/* Overwrite file */</span></div><div class="line"><a name="l00966"></a><span class="lineno">  966</span>&#160;         off_t truncsize;</div><div class="line"><a name="l00967"></a><span class="lineno">  967</span>&#160;         <span class="keywordflow">if</span> (!(ff = fopen(<a class="code" href="../../d5/dde/test__func__file_8c.html#a7df83d295429a2562396f1ec127a46c0">args</a>.filename, <span class="stringliteral">&quot;w&quot;</span>))) {</div><div class="line"><a name="l00968"></a><span class="lineno">  968</span>&#160;            <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Unable to open &#39;%s&#39; for writing: %s\n&quot;</span>, <a class="code" href="../../d5/dde/test__func__file_8c.html#a7df83d295429a2562396f1ec127a46c0">args</a>.filename, strerror(<a class="code" href="../../d1/d6e/main_2stdtime_2private_8h.html#ad65a8842cc674e3ddf69355898c0ecbf">errno</a>));</div><div class="line"><a name="l00969"></a><span class="lineno">  969</span>&#160;            <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l00970"></a><span class="lineno">  970</span>&#160;         }</div><div class="line"><a name="l00971"></a><span class="lineno">  971</span>&#160;         <span class="keywordflow">if</span> (fwrite(<a class="code" href="../../d4/d2f/syslog_8c.html#ac4f474c82e82cbb89ca7c36dd52be0ed">value</a>, 1, vlength, ff) &lt; vlength) {</div><div class="line"><a name="l00972"></a><span class="lineno">  972</span>&#160;            <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Short write?!!\n&quot;</span>);</div><div class="line"><a name="l00973"></a><span class="lineno">  973</span>&#160;         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strchr(<a class="code" href="../../d5/dde/test__func__file_8c.html#a7df83d295429a2562396f1ec127a46c0">args</a>.options, <span class="charliteral">&#39;d&#39;</span>) &amp;&amp; fwrite(<a class="code" href="../../d4/daa/func__env_8c.html#a9cc0a8665ffb4519792ae07a380a2753">format2term</a>(newline_format), 1, strlen(<a class="code" href="../../d4/daa/func__env_8c.html#a9cc0a8665ffb4519792ae07a380a2753">format2term</a>(newline_format)), ff) &lt; strlen(<a class="code" href="../../d4/daa/func__env_8c.html#a9cc0a8665ffb4519792ae07a380a2753">format2term</a>(newline_format))) {</div><div class="line"><a name="l00974"></a><span class="lineno">  974</span>&#160;            <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Short write?!!\n&quot;</span>);</div><div class="line"><a name="l00975"></a><span class="lineno">  975</span>&#160;         }</div><div class="line"><a name="l00976"></a><span class="lineno">  976</span>&#160;         <span class="keywordflow">if</span> ((truncsize = ftello(ff)) &lt; 0) {</div><div class="line"><a name="l00977"></a><span class="lineno">  977</span>&#160;            <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#a2fdd5bff193a29ec6c7278da2851ea56">AST_LOG_ERROR</a>, <span class="stringliteral">&quot;Unable to determine truncate position of &#39;%s&#39;: %s\n&quot;</span>, <a class="code" href="../../d5/dde/test__func__file_8c.html#a7df83d295429a2562396f1ec127a46c0">args</a>.filename, strerror(<a class="code" href="../../d1/d6e/main_2stdtime_2private_8h.html#ad65a8842cc674e3ddf69355898c0ecbf">errno</a>));</div><div class="line"><a name="l00978"></a><span class="lineno">  978</span>&#160;         }</div><div class="line"><a name="l00979"></a><span class="lineno">  979</span>&#160;         fclose(ff);</div><div class="line"><a name="l00980"></a><span class="lineno">  980</span>&#160;         <span class="keywordflow">if</span> (truncsize &gt;= 0 &amp;&amp; truncate(<a class="code" href="../../d5/dde/test__func__file_8c.html#a7df83d295429a2562396f1ec127a46c0">args</a>.filename, truncsize)) {</div><div class="line"><a name="l00981"></a><span class="lineno">  981</span>&#160;            <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Unable to truncate file &#39;%s&#39;: %s\n&quot;</span>, <a class="code" href="../../d5/dde/test__func__file_8c.html#a7df83d295429a2562396f1ec127a46c0">args</a>.filename, strerror(<a class="code" href="../../d1/d6e/main_2stdtime_2private_8h.html#ad65a8842cc674e3ddf69355898c0ecbf">errno</a>));</div><div class="line"><a name="l00982"></a><span class="lineno">  982</span>&#160;            <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l00983"></a><span class="lineno">  983</span>&#160;         }</div><div class="line"><a name="l00984"></a><span class="lineno">  984</span>&#160;      } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00985"></a><span class="lineno">  985</span>&#160;         int64_t offset_offset = (offset == 0 ? 0 : -1), length_offset = -1, flength, i, current_length = 0;</div><div class="line"><a name="l00986"></a><span class="lineno">  986</span>&#160;         <span class="keywordtype">char</span> dos_state = 0, fbuf[4096];</div><div class="line"><a name="l00987"></a><span class="lineno">  987</span>&#160;</div><div class="line"><a name="l00988"></a><span class="lineno">  988</span>&#160;         <span class="keywordflow">if</span> (offset &lt; 0 &amp;&amp; length &lt; offset) {</div><div class="line"><a name="l00989"></a><span class="lineno">  989</span>&#160;            <span class="comment">/* Nonsense! */</span></div><div class="line"><a name="l00990"></a><span class="lineno">  990</span>&#160;            <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Length cannot specify a position prior to the offset\n&quot;</span>);</div><div class="line"><a name="l00991"></a><span class="lineno">  991</span>&#160;            <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l00992"></a><span class="lineno">  992</span>&#160;         }</div><div class="line"><a name="l00993"></a><span class="lineno">  993</span>&#160;</div><div class="line"><a name="l00994"></a><span class="lineno">  994</span>&#160;         <span class="keywordflow">if</span> (!(ff = fopen(<a class="code" href="../../d5/dde/test__func__file_8c.html#a7df83d295429a2562396f1ec127a46c0">args</a>.filename, <span class="stringliteral">&quot;r+&quot;</span>))) {</div><div class="line"><a name="l00995"></a><span class="lineno">  995</span>&#160;            <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Cannot open &#39;%s&#39; for modification: %s\n&quot;</span>, <a class="code" href="../../d5/dde/test__func__file_8c.html#a7df83d295429a2562396f1ec127a46c0">args</a>.filename, strerror(<a class="code" href="../../d1/d6e/main_2stdtime_2private_8h.html#ad65a8842cc674e3ddf69355898c0ecbf">errno</a>));</div><div class="line"><a name="l00996"></a><span class="lineno">  996</span>&#160;            <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l00997"></a><span class="lineno">  997</span>&#160;         }</div><div class="line"><a name="l00998"></a><span class="lineno">  998</span>&#160;</div><div class="line"><a name="l00999"></a><span class="lineno">  999</span>&#160;         <span class="keywordflow">if</span> (fseek(ff, 0, SEEK_END)) {</div><div class="line"><a name="l01000"></a><span class="lineno"> 1000</span>&#160;            <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Cannot seek to end of file &#39;%s&#39;: %s\n&quot;</span>, <a class="code" href="../../d5/dde/test__func__file_8c.html#a7df83d295429a2562396f1ec127a46c0">args</a>.filename, strerror(<a class="code" href="../../d1/d6e/main_2stdtime_2private_8h.html#ad65a8842cc674e3ddf69355898c0ecbf">errno</a>));</div><div class="line"><a name="l01001"></a><span class="lineno"> 1001</span>&#160;            fclose(ff);</div><div class="line"><a name="l01002"></a><span class="lineno"> 1002</span>&#160;            <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l01003"></a><span class="lineno"> 1003</span>&#160;         }</div><div class="line"><a name="l01004"></a><span class="lineno"> 1004</span>&#160;         <span class="keywordflow">if</span> ((flength = ftello(ff)) &lt; 0) {</div><div class="line"><a name="l01005"></a><span class="lineno"> 1005</span>&#160;            <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#a2fdd5bff193a29ec6c7278da2851ea56">AST_LOG_ERROR</a>, <span class="stringliteral">&quot;Cannot determine end position of file &#39;%s&#39;: %s\n&quot;</span>, <a class="code" href="../../d5/dde/test__func__file_8c.html#a7df83d295429a2562396f1ec127a46c0">args</a>.filename, strerror(<a class="code" href="../../d1/d6e/main_2stdtime_2private_8h.html#ad65a8842cc674e3ddf69355898c0ecbf">errno</a>));</div><div class="line"><a name="l01006"></a><span class="lineno"> 1006</span>&#160;            fclose(ff);</div><div class="line"><a name="l01007"></a><span class="lineno"> 1007</span>&#160;            <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l01008"></a><span class="lineno"> 1008</span>&#160;         }</div><div class="line"><a name="l01009"></a><span class="lineno"> 1009</span>&#160;</div><div class="line"><a name="l01010"></a><span class="lineno"> 1010</span>&#160;         <span class="comment">/* For negative offset and/or negative length */</span></div><div class="line"><a name="l01011"></a><span class="lineno"> 1011</span>&#160;         <span class="keywordflow">if</span> (offset &lt; 0 || length &lt; 0) {</div><div class="line"><a name="l01012"></a><span class="lineno"> 1012</span>&#160;            int64_t count = 0;</div><div class="line"><a name="l01013"></a><span class="lineno"> 1013</span>&#160;            <span class="keywordflow">for</span> (i = (flength / <span class="keyword">sizeof</span>(fbuf)) * <span class="keyword">sizeof</span>(fbuf); i &gt;= 0; i -= <span class="keyword">sizeof</span>(fbuf)) {</div><div class="line"><a name="l01014"></a><span class="lineno"> 1014</span>&#160;               <span class="keywordtype">char</span> *pos;</div><div class="line"><a name="l01015"></a><span class="lineno"> 1015</span>&#160;               <span class="keywordflow">if</span> (fseeko(ff, i, SEEK_SET)) {</div><div class="line"><a name="l01016"></a><span class="lineno"> 1016</span>&#160;                  <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Cannot seek to offset %&quot;</span> PRId64 <span class="stringliteral">&quot;: %s\n&quot;</span>, i, strerror(<a class="code" href="../../d1/d6e/main_2stdtime_2private_8h.html#ad65a8842cc674e3ddf69355898c0ecbf">errno</a>));</div><div class="line"><a name="l01017"></a><span class="lineno"> 1017</span>&#160;               }</div><div class="line"><a name="l01018"></a><span class="lineno"> 1018</span>&#160;               <span class="keywordflow">if</span> (i + <span class="keyword">sizeof</span>(fbuf) &gt;= flength) {</div><div class="line"><a name="l01019"></a><span class="lineno"> 1019</span>&#160;                  memset(fbuf, 0, <span class="keyword">sizeof</span>(fbuf));</div><div class="line"><a name="l01020"></a><span class="lineno"> 1020</span>&#160;               }</div><div class="line"><a name="l01021"></a><span class="lineno"> 1021</span>&#160;               <span class="keywordflow">if</span> (fread(fbuf, 1, <span class="keyword">sizeof</span>(fbuf), ff) &lt; <span class="keyword">sizeof</span>(fbuf) &amp;&amp; !feof(ff)) {</div><div class="line"><a name="l01022"></a><span class="lineno"> 1022</span>&#160;                  <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Short read: %s\n&quot;</span>, strerror(<a class="code" href="../../d1/d6e/main_2stdtime_2private_8h.html#ad65a8842cc674e3ddf69355898c0ecbf">errno</a>));</div><div class="line"><a name="l01023"></a><span class="lineno"> 1023</span>&#160;                  fclose(ff);</div><div class="line"><a name="l01024"></a><span class="lineno"> 1024</span>&#160;                  <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l01025"></a><span class="lineno"> 1025</span>&#160;               }</div><div class="line"><a name="l01026"></a><span class="lineno"> 1026</span>&#160;               <span class="keywordflow">for</span> (pos = fbuf + <span class="keyword">sizeof</span>(fbuf) - 1; pos &gt;= fbuf; pos--) {</div><div class="line"><a name="l01027"></a><span class="lineno"> 1027</span>&#160;                  <a class="code" href="../../d4/daa/func__env_8c.html#ad2682ceb1f8ed7d6551cd75454aa25c4">LINE_COUNTER</a>(pos, newline_format, count);</div><div class="line"><a name="l01028"></a><span class="lineno"> 1028</span>&#160;</div><div class="line"><a name="l01029"></a><span class="lineno"> 1029</span>&#160;                  <span class="keywordflow">if</span> (length &lt; 0 &amp;&amp; count * -1 == length) {</div><div class="line"><a name="l01030"></a><span class="lineno"> 1030</span>&#160;                     length_offset = i + (pos - fbuf);</div><div class="line"><a name="l01031"></a><span class="lineno"> 1031</span>&#160;                  } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (offset &lt; 0 &amp;&amp; count * -1 == (offset - 1)) {</div><div class="line"><a name="l01032"></a><span class="lineno"> 1032</span>&#160;                     <span class="comment">/* Found our initial offset.  We&#39;re done with reverse motion! */</span></div><div class="line"><a name="l01033"></a><span class="lineno"> 1033</span>&#160;                     <span class="keywordflow">if</span> (newline_format == <a class="code" href="../../d4/daa/func__env_8c.html#abd81d11867ad50357ea8332e8d36cf8aa7c12b0aea0d0de06a80877d724b86525">FF_DOS</a>) {</div><div class="line"><a name="l01034"></a><span class="lineno"> 1034</span>&#160;                        offset_offset = i + (pos - fbuf) + 2;</div><div class="line"><a name="l01035"></a><span class="lineno"> 1035</span>&#160;                     } <span class="keywordflow">else</span> {</div><div class="line"><a name="l01036"></a><span class="lineno"> 1036</span>&#160;                        offset_offset = i + (pos - fbuf) + 1;</div><div class="line"><a name="l01037"></a><span class="lineno"> 1037</span>&#160;                     }</div><div class="line"><a name="l01038"></a><span class="lineno"> 1038</span>&#160;                     <span class="keywordflow">break</span>;</div><div class="line"><a name="l01039"></a><span class="lineno"> 1039</span>&#160;                  }</div><div class="line"><a name="l01040"></a><span class="lineno"> 1040</span>&#160;               }</div><div class="line"><a name="l01041"></a><span class="lineno"> 1041</span>&#160;               <span class="keywordflow">if</span> ((offset &lt; 0 &amp;&amp; offset_offset &gt;= 0) || (offset &gt;= 0 &amp;&amp; length_offset &gt;= 0)) {</div><div class="line"><a name="l01042"></a><span class="lineno"> 1042</span>&#160;                  <span class="keywordflow">break</span>;</div><div class="line"><a name="l01043"></a><span class="lineno"> 1043</span>&#160;               }</div><div class="line"><a name="l01044"></a><span class="lineno"> 1044</span>&#160;            }</div><div class="line"><a name="l01045"></a><span class="lineno"> 1045</span>&#160;            <span class="comment">/* We&#39;re at the beginning, and the negative offset indicates the exact number of lines in the file */</span></div><div class="line"><a name="l01046"></a><span class="lineno"> 1046</span>&#160;            <span class="keywordflow">if</span> (offset &lt; 0 &amp;&amp; offset_offset &lt; 0 &amp;&amp; offset == count * -1) {</div><div class="line"><a name="l01047"></a><span class="lineno"> 1047</span>&#160;               offset_offset = 0;</div><div class="line"><a name="l01048"></a><span class="lineno"> 1048</span>&#160;            }</div><div class="line"><a name="l01049"></a><span class="lineno"> 1049</span>&#160;         }</div><div class="line"><a name="l01050"></a><span class="lineno"> 1050</span>&#160;</div><div class="line"><a name="l01051"></a><span class="lineno"> 1051</span>&#160;         <span class="comment">/* Positve line offset */</span></div><div class="line"><a name="l01052"></a><span class="lineno"> 1052</span>&#160;         <span class="keywordflow">if</span> (offset &gt; 0) {</div><div class="line"><a name="l01053"></a><span class="lineno"> 1053</span>&#160;            int64_t count = 0;</div><div class="line"><a name="l01054"></a><span class="lineno"> 1054</span>&#160;            fseek(ff, 0, SEEK_SET);</div><div class="line"><a name="l01055"></a><span class="lineno"> 1055</span>&#160;            <span class="keywordflow">for</span> (i = 0; i &lt; flength; i += <span class="keyword">sizeof</span>(fbuf)) {</div><div class="line"><a name="l01056"></a><span class="lineno"> 1056</span>&#160;               <span class="keywordtype">char</span> *pos;</div><div class="line"><a name="l01057"></a><span class="lineno"> 1057</span>&#160;               <span class="keywordflow">if</span> (i + <span class="keyword">sizeof</span>(fbuf) &gt;= flength) {</div><div class="line"><a name="l01058"></a><span class="lineno"> 1058</span>&#160;                  memset(fbuf, 0, <span class="keyword">sizeof</span>(fbuf));</div><div class="line"><a name="l01059"></a><span class="lineno"> 1059</span>&#160;               }</div><div class="line"><a name="l01060"></a><span class="lineno"> 1060</span>&#160;               <span class="keywordflow">if</span> (fread(fbuf, 1, <span class="keyword">sizeof</span>(fbuf), ff) &lt; <span class="keyword">sizeof</span>(fbuf) &amp;&amp; !feof(ff)) {</div><div class="line"><a name="l01061"></a><span class="lineno"> 1061</span>&#160;                  <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Short read?!!\n&quot;</span>);</div><div class="line"><a name="l01062"></a><span class="lineno"> 1062</span>&#160;                  fclose(ff);</div><div class="line"><a name="l01063"></a><span class="lineno"> 1063</span>&#160;                  <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l01064"></a><span class="lineno"> 1064</span>&#160;               }</div><div class="line"><a name="l01065"></a><span class="lineno"> 1065</span>&#160;               <span class="keywordflow">for</span> (pos = fbuf; pos &lt; fbuf + <span class="keyword">sizeof</span>(fbuf); pos++) {</div><div class="line"><a name="l01066"></a><span class="lineno"> 1066</span>&#160;                  <a class="code" href="../../d4/daa/func__env_8c.html#ad2682ceb1f8ed7d6551cd75454aa25c4">LINE_COUNTER</a>(pos, newline_format, count);</div><div class="line"><a name="l01067"></a><span class="lineno"> 1067</span>&#160;</div><div class="line"><a name="l01068"></a><span class="lineno"> 1068</span>&#160;                  <span class="keywordflow">if</span> (count == offset) {</div><div class="line"><a name="l01069"></a><span class="lineno"> 1069</span>&#160;                     offset_offset = i + (pos - fbuf) + 1;</div><div class="line"><a name="l01070"></a><span class="lineno"> 1070</span>&#160;                     <span class="keywordflow">break</span>;</div><div class="line"><a name="l01071"></a><span class="lineno"> 1071</span>&#160;                  }</div><div class="line"><a name="l01072"></a><span class="lineno"> 1072</span>&#160;               }</div><div class="line"><a name="l01073"></a><span class="lineno"> 1073</span>&#160;               <span class="keywordflow">if</span> (offset_offset &gt;= 0) {</div><div class="line"><a name="l01074"></a><span class="lineno"> 1074</span>&#160;                  <span class="keywordflow">break</span>;</div><div class="line"><a name="l01075"></a><span class="lineno"> 1075</span>&#160;               }</div><div class="line"><a name="l01076"></a><span class="lineno"> 1076</span>&#160;            }</div><div class="line"><a name="l01077"></a><span class="lineno"> 1077</span>&#160;         }</div><div class="line"><a name="l01078"></a><span class="lineno"> 1078</span>&#160;</div><div class="line"><a name="l01079"></a><span class="lineno"> 1079</span>&#160;         <span class="keywordflow">if</span> (offset_offset &lt; 0) {</div><div class="line"><a name="l01080"></a><span class="lineno"> 1080</span>&#160;            <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Offset &#39;%s&#39; refers to before the beginning of the file!\n&quot;</span>, <a class="code" href="../../d5/dde/test__func__file_8c.html#a7df83d295429a2562396f1ec127a46c0">args</a>.offset);</div><div class="line"><a name="l01081"></a><span class="lineno"> 1081</span>&#160;            fclose(ff);</div><div class="line"><a name="l01082"></a><span class="lineno"> 1082</span>&#160;            <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l01083"></a><span class="lineno"> 1083</span>&#160;         }</div><div class="line"><a name="l01084"></a><span class="lineno"> 1084</span>&#160;</div><div class="line"><a name="l01085"></a><span class="lineno"> 1085</span>&#160;         <span class="keywordflow">if</span> (length == 0) {</div><div class="line"><a name="l01086"></a><span class="lineno"> 1086</span>&#160;            length_offset = offset_offset;</div><div class="line"><a name="l01087"></a><span class="lineno"> 1087</span>&#160;         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (length == <a class="code" href="../../de/da3/include_2asterisk_2compat_8h.html#a23ec2cf7fc07ea8f817bbac758402baf">LLONG_MAX</a>) {</div><div class="line"><a name="l01088"></a><span class="lineno"> 1088</span>&#160;            length_offset = flength;</div><div class="line"><a name="l01089"></a><span class="lineno"> 1089</span>&#160;         }</div><div class="line"><a name="l01090"></a><span class="lineno"> 1090</span>&#160;</div><div class="line"><a name="l01091"></a><span class="lineno"> 1091</span>&#160;         <span class="comment">/* Positive line length */</span></div><div class="line"><a name="l01092"></a><span class="lineno"> 1092</span>&#160;         <span class="keywordflow">if</span> (length_offset &lt; 0) {</div><div class="line"><a name="l01093"></a><span class="lineno"> 1093</span>&#160;            fseeko(ff, offset_offset, SEEK_SET);</div><div class="line"><a name="l01094"></a><span class="lineno"> 1094</span>&#160;            <span class="keywordflow">for</span> (i = offset_offset; i &lt; flength; i += <span class="keyword">sizeof</span>(fbuf)) {</div><div class="line"><a name="l01095"></a><span class="lineno"> 1095</span>&#160;               <span class="keywordtype">char</span> *pos;</div><div class="line"><a name="l01096"></a><span class="lineno"> 1096</span>&#160;               <span class="keywordflow">if</span> (i + <span class="keyword">sizeof</span>(fbuf) &gt;= flength) {</div><div class="line"><a name="l01097"></a><span class="lineno"> 1097</span>&#160;                  memset(fbuf, 0, <span class="keyword">sizeof</span>(fbuf));</div><div class="line"><a name="l01098"></a><span class="lineno"> 1098</span>&#160;               }</div><div class="line"><a name="l01099"></a><span class="lineno"> 1099</span>&#160;               <span class="keywordflow">if</span> (fread(fbuf, 1, <span class="keyword">sizeof</span>(fbuf), ff) &lt; <span class="keyword">sizeof</span>(fbuf) &amp;&amp; !feof(ff)) {</div><div class="line"><a name="l01100"></a><span class="lineno"> 1100</span>&#160;                  <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Short read?!!\n&quot;</span>);</div><div class="line"><a name="l01101"></a><span class="lineno"> 1101</span>&#160;                  fclose(ff);</div><div class="line"><a name="l01102"></a><span class="lineno"> 1102</span>&#160;                  <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l01103"></a><span class="lineno"> 1103</span>&#160;               }</div><div class="line"><a name="l01104"></a><span class="lineno"> 1104</span>&#160;               <span class="keywordflow">for</span> (pos = fbuf; pos &lt; fbuf + <span class="keyword">sizeof</span>(fbuf); pos++) {</div><div class="line"><a name="l01105"></a><span class="lineno"> 1105</span>&#160;                  <a class="code" href="../../d4/daa/func__env_8c.html#ad2682ceb1f8ed7d6551cd75454aa25c4">LINE_COUNTER</a>(pos, newline_format, current_length);</div><div class="line"><a name="l01106"></a><span class="lineno"> 1106</span>&#160;</div><div class="line"><a name="l01107"></a><span class="lineno"> 1107</span>&#160;                  <span class="keywordflow">if</span> (current_length == length) {</div><div class="line"><a name="l01108"></a><span class="lineno"> 1108</span>&#160;                     length_offset = i + (pos - fbuf) + 1;</div><div class="line"><a name="l01109"></a><span class="lineno"> 1109</span>&#160;                     <span class="keywordflow">break</span>;</div><div class="line"><a name="l01110"></a><span class="lineno"> 1110</span>&#160;                  }</div><div class="line"><a name="l01111"></a><span class="lineno"> 1111</span>&#160;               }</div><div class="line"><a name="l01112"></a><span class="lineno"> 1112</span>&#160;               <span class="keywordflow">if</span> (length_offset &gt;= 0) {</div><div class="line"><a name="l01113"></a><span class="lineno"> 1113</span>&#160;                  <span class="keywordflow">break</span>;</div><div class="line"><a name="l01114"></a><span class="lineno"> 1114</span>&#160;               }</div><div class="line"><a name="l01115"></a><span class="lineno"> 1115</span>&#160;            }</div><div class="line"><a name="l01116"></a><span class="lineno"> 1116</span>&#160;            <span class="keywordflow">if</span> (length_offset &lt; 0) {</div><div class="line"><a name="l01117"></a><span class="lineno"> 1117</span>&#160;               <span class="comment">/* Exceeds length of file */</span></div><div class="line"><a name="l01118"></a><span class="lineno"> 1118</span>&#160;               <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(3, <span class="stringliteral">&quot;Exceeds length of file? length=%&quot;</span> PRId64 <span class="stringliteral">&quot;, count=%&quot;</span> PRId64 <span class="stringliteral">&quot;, flength=%&quot;</span> PRId64 <span class="stringliteral">&quot;\n&quot;</span>, length, current_length, flength);</div><div class="line"><a name="l01119"></a><span class="lineno"> 1119</span>&#160;               length_offset = flength;</div><div class="line"><a name="l01120"></a><span class="lineno"> 1120</span>&#160;            }</div><div class="line"><a name="l01121"></a><span class="lineno"> 1121</span>&#160;         }</div><div class="line"><a name="l01122"></a><span class="lineno"> 1122</span>&#160;</div><div class="line"><a name="l01123"></a><span class="lineno"> 1123</span>&#160;         <span class="comment">/* Have offset_offset and length_offset now */</span></div><div class="line"><a name="l01124"></a><span class="lineno"> 1124</span>&#160;         <span class="keywordflow">if</span> (length_offset - offset_offset == vlength + (strchr(<a class="code" href="../../d5/dde/test__func__file_8c.html#a7df83d295429a2562396f1ec127a46c0">args</a>.options, <span class="charliteral">&#39;d&#39;</span>) ? 0 : strlen(<a class="code" href="../../d4/daa/func__env_8c.html#a9cc0a8665ffb4519792ae07a380a2753">format2term</a>(newline_format)))) {</div><div class="line"><a name="l01125"></a><span class="lineno"> 1125</span>&#160;            <span class="comment">/* Simple case - replacement of text inline */</span></div><div class="line"><a name="l01126"></a><span class="lineno"> 1126</span>&#160;            fseeko(ff, offset_offset, SEEK_SET);</div><div class="line"><a name="l01127"></a><span class="lineno"> 1127</span>&#160;            <span class="keywordflow">if</span> (fwrite(<a class="code" href="../../d4/d2f/syslog_8c.html#ac4f474c82e82cbb89ca7c36dd52be0ed">value</a>, 1, vlength, ff) &lt; vlength) {</div><div class="line"><a name="l01128"></a><span class="lineno"> 1128</span>&#160;               <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Short write?!!\n&quot;</span>);</div><div class="line"><a name="l01129"></a><span class="lineno"> 1129</span>&#160;            } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strchr(<a class="code" href="../../d5/dde/test__func__file_8c.html#a7df83d295429a2562396f1ec127a46c0">args</a>.options, <span class="charliteral">&#39;d&#39;</span>) &amp;&amp; fwrite(<a class="code" href="../../d4/daa/func__env_8c.html#a9cc0a8665ffb4519792ae07a380a2753">format2term</a>(newline_format), 1, strlen(<a class="code" href="../../d4/daa/func__env_8c.html#a9cc0a8665ffb4519792ae07a380a2753">format2term</a>(newline_format)), ff) &lt; strlen(<a class="code" href="../../d4/daa/func__env_8c.html#a9cc0a8665ffb4519792ae07a380a2753">format2term</a>(newline_format))) {</div><div class="line"><a name="l01130"></a><span class="lineno"> 1130</span>&#160;               <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Short write?!!\n&quot;</span>);</div><div class="line"><a name="l01131"></a><span class="lineno"> 1131</span>&#160;            }</div><div class="line"><a name="l01132"></a><span class="lineno"> 1132</span>&#160;            fclose(ff);</div><div class="line"><a name="l01133"></a><span class="lineno"> 1133</span>&#160;         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (length_offset - offset_offset &gt; vlength + (strchr(<a class="code" href="../../d5/dde/test__func__file_8c.html#a7df83d295429a2562396f1ec127a46c0">args</a>.options, <span class="charliteral">&#39;d&#39;</span>) ? 0 : strlen(<a class="code" href="../../d4/daa/func__env_8c.html#a9cc0a8665ffb4519792ae07a380a2753">format2term</a>(newline_format)))) {</div><div class="line"><a name="l01134"></a><span class="lineno"> 1134</span>&#160;            <span class="comment">/* More complex case - need to shorten file */</span></div><div class="line"><a name="l01135"></a><span class="lineno"> 1135</span>&#160;            off_t cur;</div><div class="line"><a name="l01136"></a><span class="lineno"> 1136</span>&#160;            int64_t length_length = length_offset - offset_offset;</div><div class="line"><a name="l01137"></a><span class="lineno"> 1137</span>&#160;            <span class="keywordtype">size_t</span> vlen = vlength + (strchr(<a class="code" href="../../d5/dde/test__func__file_8c.html#a7df83d295429a2562396f1ec127a46c0">args</a>.options, <span class="charliteral">&#39;d&#39;</span>) ? 0 : strlen(<a class="code" href="../../d4/daa/func__env_8c.html#a9cc0a8665ffb4519792ae07a380a2753">format2term</a>(newline_format)));</div><div class="line"><a name="l01138"></a><span class="lineno"> 1138</span>&#160;</div><div class="line"><a name="l01139"></a><span class="lineno"> 1139</span>&#160;            <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(3, <span class="stringliteral">&quot;offset=%s/%&quot;</span> PRId64 <span class="stringliteral">&quot;, length=%s/%&quot;</span> PRId64 <span class="stringliteral">&quot; (%&quot;</span> PRId64 <span class="stringliteral">&quot;), vlength=%&quot;</span> PRId64 <span class="stringliteral">&quot;, flength=%&quot;</span> PRId64 <span class="stringliteral">&quot;\n&quot;</span>,</div><div class="line"><a name="l01140"></a><span class="lineno"> 1140</span>&#160;               <a class="code" href="../../d5/dde/test__func__file_8c.html#a7df83d295429a2562396f1ec127a46c0">args</a>.offset, offset_offset, <a class="code" href="../../d5/dde/test__func__file_8c.html#a7df83d295429a2562396f1ec127a46c0">args</a>.length, length_offset, length_length, vlength, flength);</div><div class="line"><a name="l01141"></a><span class="lineno"> 1141</span>&#160;</div><div class="line"><a name="l01142"></a><span class="lineno"> 1142</span>&#160;            fseeko(ff, offset_offset, SEEK_SET);</div><div class="line"><a name="l01143"></a><span class="lineno"> 1143</span>&#160;            <span class="keywordflow">if</span> (fwrite(<a class="code" href="../../d4/d2f/syslog_8c.html#ac4f474c82e82cbb89ca7c36dd52be0ed">value</a>, 1, vlength, ff) &lt; vlength) {</div><div class="line"><a name="l01144"></a><span class="lineno"> 1144</span>&#160;               <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Short write?!!\n&quot;</span>);</div><div class="line"><a name="l01145"></a><span class="lineno"> 1145</span>&#160;               fclose(ff);</div><div class="line"><a name="l01146"></a><span class="lineno"> 1146</span>&#160;               <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l01147"></a><span class="lineno"> 1147</span>&#160;            } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strchr(<a class="code" href="../../d5/dde/test__func__file_8c.html#a7df83d295429a2562396f1ec127a46c0">args</a>.options, <span class="charliteral">&#39;d&#39;</span>) &amp;&amp; fwrite(<a class="code" href="../../d4/daa/func__env_8c.html#a9cc0a8665ffb4519792ae07a380a2753">format2term</a>(newline_format), 1, vlen - vlength, ff) &lt; vlen - vlength) {</div><div class="line"><a name="l01148"></a><span class="lineno"> 1148</span>&#160;               <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Short write?!!\n&quot;</span>);</div><div class="line"><a name="l01149"></a><span class="lineno"> 1149</span>&#160;               fclose(ff);</div><div class="line"><a name="l01150"></a><span class="lineno"> 1150</span>&#160;               <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l01151"></a><span class="lineno"> 1151</span>&#160;            }</div><div class="line"><a name="l01152"></a><span class="lineno"> 1152</span>&#160;            <span class="keywordflow">while</span> ((cur = ftello(ff)) &lt; flength) {</div><div class="line"><a name="l01153"></a><span class="lineno"> 1153</span>&#160;               <span class="keywordflow">if</span> (cur &lt; 0) {</div><div class="line"><a name="l01154"></a><span class="lineno"> 1154</span>&#160;                  <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#a2fdd5bff193a29ec6c7278da2851ea56">AST_LOG_ERROR</a>, <span class="stringliteral">&quot;Unable to determine last write position for &#39;%s&#39;: %s\n&quot;</span>, <a class="code" href="../../d5/dde/test__func__file_8c.html#a7df83d295429a2562396f1ec127a46c0">args</a>.filename, strerror(<a class="code" href="../../d1/d6e/main_2stdtime_2private_8h.html#ad65a8842cc674e3ddf69355898c0ecbf">errno</a>));</div><div class="line"><a name="l01155"></a><span class="lineno"> 1155</span>&#160;                  fclose(ff);</div><div class="line"><a name="l01156"></a><span class="lineno"> 1156</span>&#160;                  <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l01157"></a><span class="lineno"> 1157</span>&#160;               }</div><div class="line"><a name="l01158"></a><span class="lineno"> 1158</span>&#160;               fseeko(ff, length_length - vlen, SEEK_CUR);</div><div class="line"><a name="l01159"></a><span class="lineno"> 1159</span>&#160;               <span class="keywordflow">if</span> (fread(fbuf, 1, <span class="keyword">sizeof</span>(fbuf), ff) &lt; <span class="keyword">sizeof</span>(fbuf) &amp;&amp; !feof(ff)) {</div><div class="line"><a name="l01160"></a><span class="lineno"> 1160</span>&#160;                  <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Short read?!!\n&quot;</span>);</div><div class="line"><a name="l01161"></a><span class="lineno"> 1161</span>&#160;                  fclose(ff);</div><div class="line"><a name="l01162"></a><span class="lineno"> 1162</span>&#160;                  <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l01163"></a><span class="lineno"> 1163</span>&#160;               }</div><div class="line"><a name="l01164"></a><span class="lineno"> 1164</span>&#160;               <span class="comment">/* Seek to where we last stopped writing */</span></div><div class="line"><a name="l01165"></a><span class="lineno"> 1165</span>&#160;               fseeko(ff, cur, SEEK_SET);</div><div class="line"><a name="l01166"></a><span class="lineno"> 1166</span>&#160;               <span class="keywordflow">if</span> (fwrite(fbuf, 1, <span class="keyword">sizeof</span>(fbuf), ff) &lt; <span class="keyword">sizeof</span>(fbuf)) {</div><div class="line"><a name="l01167"></a><span class="lineno"> 1167</span>&#160;                  <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Short write?!!\n&quot;</span>);</div><div class="line"><a name="l01168"></a><span class="lineno"> 1168</span>&#160;                  fclose(ff);</div><div class="line"><a name="l01169"></a><span class="lineno"> 1169</span>&#160;                  <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l01170"></a><span class="lineno"> 1170</span>&#160;               }</div><div class="line"><a name="l01171"></a><span class="lineno"> 1171</span>&#160;            }</div><div class="line"><a name="l01172"></a><span class="lineno"> 1172</span>&#160;            fclose(ff);</div><div class="line"><a name="l01173"></a><span class="lineno"> 1173</span>&#160;            <span class="keywordflow">if</span> (truncate(<a class="code" href="../../d5/dde/test__func__file_8c.html#a7df83d295429a2562396f1ec127a46c0">args</a>.filename, flength - (length_length - vlen))) {</div><div class="line"><a name="l01174"></a><span class="lineno"> 1174</span>&#160;               <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Truncation of file failed: %s\n&quot;</span>, strerror(<a class="code" href="../../d1/d6e/main_2stdtime_2private_8h.html#ad65a8842cc674e3ddf69355898c0ecbf">errno</a>));</div><div class="line"><a name="l01175"></a><span class="lineno"> 1175</span>&#160;            }</div><div class="line"><a name="l01176"></a><span class="lineno"> 1176</span>&#160;         } <span class="keywordflow">else</span> {</div><div class="line"><a name="l01177"></a><span class="lineno"> 1177</span>&#160;            <span class="comment">/* Most complex case - need to lengthen file */</span></div><div class="line"><a name="l01178"></a><span class="lineno"> 1178</span>&#160;            <span class="keywordtype">size_t</span> vlen = vlength + (strchr(<a class="code" href="../../d5/dde/test__func__file_8c.html#a7df83d295429a2562396f1ec127a46c0">args</a>.options, <span class="charliteral">&#39;d&#39;</span>) ? 0 : strlen(<a class="code" href="../../d4/daa/func__env_8c.html#a9cc0a8665ffb4519792ae07a380a2753">format2term</a>(newline_format)));</div><div class="line"><a name="l01179"></a><span class="lineno"> 1179</span>&#160;            int64_t origlen = length_offset - offset_offset;</div><div class="line"><a name="l01180"></a><span class="lineno"> 1180</span>&#160;            off_t lastwritten = flength + vlen - origlen;</div><div class="line"><a name="l01181"></a><span class="lineno"> 1181</span>&#160;</div><div class="line"><a name="l01182"></a><span class="lineno"> 1182</span>&#160;            <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(3, <span class="stringliteral">&quot;offset=%s/%&quot;</span> PRId64 <span class="stringliteral">&quot;, length=%s/%&quot;</span> PRId64 <span class="stringliteral">&quot;, vlength=%&quot;</span> PRId64 <span class="stringliteral">&quot;, flength=%&quot;</span> PRId64 <span class="stringliteral">&quot;\n&quot;</span>,</div><div class="line"><a name="l01183"></a><span class="lineno"> 1183</span>&#160;               <a class="code" href="../../d5/dde/test__func__file_8c.html#a7df83d295429a2562396f1ec127a46c0">args</a>.offset, offset_offset, <a class="code" href="../../d5/dde/test__func__file_8c.html#a7df83d295429a2562396f1ec127a46c0">args</a>.length, length_offset, vlength, flength);</div><div class="line"><a name="l01184"></a><span class="lineno"> 1184</span>&#160;</div><div class="line"><a name="l01185"></a><span class="lineno"> 1185</span>&#160;            fseeko(ff, flength - <span class="keyword">sizeof</span>(fbuf), SEEK_SET);</div><div class="line"><a name="l01186"></a><span class="lineno"> 1186</span>&#160;            <span class="keywordflow">while</span> (offset_offset + <span class="keyword">sizeof</span>(fbuf) &lt; ftello(ff)) {</div><div class="line"><a name="l01187"></a><span class="lineno"> 1187</span>&#160;               <span class="keywordflow">if</span> (fread(fbuf, 1, <span class="keyword">sizeof</span>(fbuf), ff) &lt; <span class="keyword">sizeof</span>(fbuf)) {</div><div class="line"><a name="l01188"></a><span class="lineno"> 1188</span>&#160;                  <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Short read?!!\n&quot;</span>);</div><div class="line"><a name="l01189"></a><span class="lineno"> 1189</span>&#160;                  fclose(ff);</div><div class="line"><a name="l01190"></a><span class="lineno"> 1190</span>&#160;                  <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l01191"></a><span class="lineno"> 1191</span>&#160;               }</div><div class="line"><a name="l01192"></a><span class="lineno"> 1192</span>&#160;               fseeko(ff, <span class="keyword">sizeof</span>(fbuf) - vlen - origlen, SEEK_CUR);</div><div class="line"><a name="l01193"></a><span class="lineno"> 1193</span>&#160;               <span class="keywordflow">if</span> (fwrite(fbuf, 1, <span class="keyword">sizeof</span>(fbuf), ff) &lt; <span class="keyword">sizeof</span>(fbuf)) {</div><div class="line"><a name="l01194"></a><span class="lineno"> 1194</span>&#160;                  <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Short write?!!\n&quot;</span>);</div><div class="line"><a name="l01195"></a><span class="lineno"> 1195</span>&#160;                  fclose(ff);</div><div class="line"><a name="l01196"></a><span class="lineno"> 1196</span>&#160;                  <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l01197"></a><span class="lineno"> 1197</span>&#160;               }</div><div class="line"><a name="l01198"></a><span class="lineno"> 1198</span>&#160;               <span class="keywordflow">if</span> ((lastwritten = ftello(ff) - <span class="keyword">sizeof</span>(fbuf)) &lt; offset_offset + <span class="keyword">sizeof</span>(fbuf)) {</div><div class="line"><a name="l01199"></a><span class="lineno"> 1199</span>&#160;                  <span class="keywordflow">break</span>;</div><div class="line"><a name="l01200"></a><span class="lineno"> 1200</span>&#160;               }</div><div class="line"><a name="l01201"></a><span class="lineno"> 1201</span>&#160;               fseeko(ff, 2 * <span class="keyword">sizeof</span>(fbuf) + vlen - origlen, SEEK_CUR);</div><div class="line"><a name="l01202"></a><span class="lineno"> 1202</span>&#160;            }</div><div class="line"><a name="l01203"></a><span class="lineno"> 1203</span>&#160;            fseek(ff, length_offset, SEEK_SET);</div><div class="line"><a name="l01204"></a><span class="lineno"> 1204</span>&#160;            <span class="keywordflow">if</span> (fread(fbuf, 1, <span class="keyword">sizeof</span>(fbuf), ff) &lt; <span class="keyword">sizeof</span>(fbuf) &amp;&amp; !feof(ff)) {</div><div class="line"><a name="l01205"></a><span class="lineno"> 1205</span>&#160;               <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Short read?!!\n&quot;</span>);</div><div class="line"><a name="l01206"></a><span class="lineno"> 1206</span>&#160;               fclose(ff);</div><div class="line"><a name="l01207"></a><span class="lineno"> 1207</span>&#160;               <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l01208"></a><span class="lineno"> 1208</span>&#160;            }</div><div class="line"><a name="l01209"></a><span class="lineno"> 1209</span>&#160;            fseek(ff, offset_offset, SEEK_SET);</div><div class="line"><a name="l01210"></a><span class="lineno"> 1210</span>&#160;            <span class="keywordflow">if</span> (fwrite(<a class="code" href="../../d4/d2f/syslog_8c.html#ac4f474c82e82cbb89ca7c36dd52be0ed">value</a>, 1, vlength, ff) &lt; vlength) {</div><div class="line"><a name="l01211"></a><span class="lineno"> 1211</span>&#160;               <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Short write?!!\n&quot;</span>);</div><div class="line"><a name="l01212"></a><span class="lineno"> 1212</span>&#160;               fclose(ff);</div><div class="line"><a name="l01213"></a><span class="lineno"> 1213</span>&#160;               <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l01214"></a><span class="lineno"> 1214</span>&#160;            } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strchr(<a class="code" href="../../d5/dde/test__func__file_8c.html#a7df83d295429a2562396f1ec127a46c0">args</a>.options, <span class="charliteral">&#39;d&#39;</span>) &amp;&amp; fwrite(<a class="code" href="../../d4/daa/func__env_8c.html#a9cc0a8665ffb4519792ae07a380a2753">format2term</a>(newline_format), 1, strlen(<a class="code" href="../../d4/daa/func__env_8c.html#a9cc0a8665ffb4519792ae07a380a2753">format2term</a>(newline_format)), ff) &lt; strlen(<a class="code" href="../../d4/daa/func__env_8c.html#a9cc0a8665ffb4519792ae07a380a2753">format2term</a>(newline_format))) {</div><div class="line"><a name="l01215"></a><span class="lineno"> 1215</span>&#160;               <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Short write?!!\n&quot;</span>);</div><div class="line"><a name="l01216"></a><span class="lineno"> 1216</span>&#160;               fclose(ff);</div><div class="line"><a name="l01217"></a><span class="lineno"> 1217</span>&#160;               <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l01218"></a><span class="lineno"> 1218</span>&#160;            } <span class="keywordflow">else</span> {</div><div class="line"><a name="l01219"></a><span class="lineno"> 1219</span>&#160;               off_t curpos = ftello(ff);</div><div class="line"><a name="l01220"></a><span class="lineno"> 1220</span>&#160;               foplen = lastwritten - curpos;</div><div class="line"><a name="l01221"></a><span class="lineno"> 1221</span>&#160;               <span class="keywordflow">if</span> (fwrite(fbuf, 1, foplen, ff) &lt; foplen) {</div><div class="line"><a name="l01222"></a><span class="lineno"> 1222</span>&#160;                  <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Short write?!!\n&quot;</span>);</div><div class="line"><a name="l01223"></a><span class="lineno"> 1223</span>&#160;               }</div><div class="line"><a name="l01224"></a><span class="lineno"> 1224</span>&#160;            }</div><div class="line"><a name="l01225"></a><span class="lineno"> 1225</span>&#160;            fclose(ff);</div><div class="line"><a name="l01226"></a><span class="lineno"> 1226</span>&#160;         }</div><div class="line"><a name="l01227"></a><span class="lineno"> 1227</span>&#160;      }</div><div class="line"><a name="l01228"></a><span class="lineno"> 1228</span>&#160;   }</div><div class="line"><a name="l01229"></a><span class="lineno"> 1229</span>&#160;</div><div class="line"><a name="l01230"></a><span class="lineno"> 1230</span>&#160;   <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l01231"></a><span class="lineno"> 1231</span>&#160;}</div><div class="ttc" id="func__env_8c_html_abd81d11867ad50357ea8332e8d36cf8aaf1329bf6f765b89c787e5a5151db2102"><div class="ttname"><a href="../../d4/daa/func__env_8c.html#abd81d11867ad50357ea8332e8d36cf8aaf1329bf6f765b89c787e5a5151db2102">FF_MAC</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d4/daa/func__env_8c_source.html#l00322">func_env.c:322</a></div></div>
<div class="ttc" id="include_2asterisk_2app_8h_html_ac08f7eb1eb9476b30987c73e1052ada8"><div class="ttname"><a href="../../d3/d93/include_2asterisk_2app_8h.html#ac08f7eb1eb9476b30987c73e1052ada8">AST_STANDARD_APP_ARGS</a></div><div class="ttdeci">#define AST_STANDARD_APP_ARGS(args, parse)</div><div class="ttdoc">Performs the &amp;#39;standard&amp;#39; argument separation process for an application. </div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d93/include_2asterisk_2app_8h_source.html#l01285">include/asterisk/app.h:1285</a></div></div>
<div class="ttc" id="logger_8h_html_adf4476a6a4ea6c74231c826e899d7189"><div class="ttname"><a href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a></div><div class="ttdeci">#define LOG_WARNING</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d8c/logger_8h_source.html#l00274">logger.h:274</a></div></div>
<div class="ttc" id="func__env_8c_html_a9cc0a8665ffb4519792ae07a380a2753"><div class="ttname"><a href="../../d4/daa/func__env_8c.html#a9cc0a8665ffb4519792ae07a380a2753">format2term</a></div><div class="ttdeci">const char * format2term(enum file_format f)</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/daa/func__env_8c_source.html#l00740">func_env.c:740</a></div></div>
<div class="ttc" id="test__func__file_8c_html_a7df83d295429a2562396f1ec127a46c0"><div class="ttname"><a href="../../d5/dde/test__func__file_8c.html#a7df83d295429a2562396f1ec127a46c0">args</a></div><div class="ttdeci">const char * args</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/dde/test__func__file_8c_source.html#l00046">test_func_file.c:46</a></div></div>
<div class="ttc" id="syslog_8c_html_ac4f474c82e82cbb89ca7c36dd52be0ed"><div class="ttname"><a href="../../d4/d2f/syslog_8c.html#ac4f474c82e82cbb89ca7c36dd52be0ed">value</a></div><div class="ttdeci">int value</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d2f/syslog_8c_source.html#l00037">syslog.c:37</a></div></div>
<div class="ttc" id="func__env_8c_html_a4afbbc5eaddf30a658b75c9e2f7b4ee3"><div class="ttname"><a href="../../d4/daa/func__env_8c.html#a4afbbc5eaddf30a658b75c9e2f7b4ee3">file2format</a></div><div class="ttdeci">static enum file_format file2format(const char *filename)</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/daa/func__env_8c_source.html#l00439">func_env.c:439</a></div></div>
<div class="ttc" id="logger_8h_html_a3f248112c8d6ce7e3959aa723dade648"><div class="ttname"><a href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a></div><div class="ttdeci">#define ast_debug(level,...)</div><div class="ttdoc">Log a DEBUG message. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d8c/logger_8h_source.html#l00452">logger.h:452</a></div></div>
<div class="ttc" id="astobj2_8c_html_a96a00b3a518d7f32b6d51dc28f09bf9b"><div class="ttname"><a href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a></div><div class="ttdeci">#define ast_log</div><div class="ttdef"><b>Definition:</b> <a href="../../da/df7/astobj2_8c_source.html#l00042">astobj2.c:42</a></div></div>
<div class="ttc" id="logger_8h_html_a2fdd5bff193a29ec6c7278da2851ea56"><div class="ttname"><a href="../../d1/d8c/logger_8h.html#a2fdd5bff193a29ec6c7278da2851ea56">AST_LOG_ERROR</a></div><div class="ttdeci">#define AST_LOG_ERROR</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d8c/logger_8h_source.html#l00290">logger.h:290</a></div></div>
<div class="ttc" id="func__env_8c_html_abd81d11867ad50357ea8332e8d36cf8aa002a351c4fed7e3b7dbc83129ecc397e"><div class="ttname"><a href="../../d4/daa/func__env_8c.html#abd81d11867ad50357ea8332e8d36cf8aa002a351c4fed7e3b7dbc83129ecc397e">FF_UNKNOWN</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d4/daa/func__env_8c_source.html#l00319">func_env.c:319</a></div></div>
<div class="ttc" id="logger_8h_html_aced66975c154ea0e2a8ec3bc818b4e08"><div class="ttname"><a href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a></div><div class="ttdeci">#define LOG_ERROR</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d8c/logger_8h_source.html#l00285">logger.h:285</a></div></div>
<div class="ttc" id="func__env_8c_html_abd81d11867ad50357ea8332e8d36cf8a"><div class="ttname"><a href="../../d4/daa/func__env_8c.html#abd81d11867ad50357ea8332e8d36cf8a">file_format</a></div><div class="ttdeci">file_format</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/daa/func__env_8c_source.html#l00318">func_env.c:318</a></div></div>
<div class="ttc" id="func__env_8c_html_ad2682ceb1f8ed7d6551cd75454aa25c4"><div class="ttname"><a href="../../d4/daa/func__env_8c.html#ad2682ceb1f8ed7d6551cd75454aa25c4">LINE_COUNTER</a></div><div class="ttdeci">#define LINE_COUNTER(cptr, term, counter)</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/daa/func__env_8c_source.html#l00425">func_env.c:425</a></div></div>
<div class="ttc" id="main_2stdtime_2private_8h_html_ad65a8842cc674e3ddf69355898c0ecbf"><div class="ttname"><a href="../../d1/d6e/main_2stdtime_2private_8h.html#ad65a8842cc674e3ddf69355898c0ecbf">errno</a></div><div class="ttdeci">int errno</div></div>
<div class="ttc" id="strings_8h_html_a2faaa16929951bfd2802b7829a100ba2"><div class="ttname"><a href="../../d6/d90/strings_8h.html#a2faaa16929951bfd2802b7829a100ba2">S_OR</a></div><div class="ttdeci">#define S_OR(a, b)</div><div class="ttdoc">returns the equivalent of logic or for strings: first one if not empty, otherwise second one...</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d90/strings_8h_source.html#l00079">strings.h:79</a></div></div>
<div class="ttc" id="func__env_8c_html_abd81d11867ad50357ea8332e8d36cf8aa073f48545d1fcf02ce4bf0a9619914ca"><div class="ttname"><a href="../../d4/daa/func__env_8c.html#abd81d11867ad50357ea8332e8d36cf8aa073f48545d1fcf02ce4bf0a9619914ca">FF_UNIX</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d4/daa/func__env_8c_source.html#l00320">func_env.c:320</a></div></div>
<div class="ttc" id="include_2asterisk_2compat_8h_html_a23ec2cf7fc07ea8f817bbac758402baf"><div class="ttname"><a href="../../de/da3/include_2asterisk_2compat_8h.html#a23ec2cf7fc07ea8f817bbac758402baf">LLONG_MAX</a></div><div class="ttdeci">#define LLONG_MAX</div><div class="ttdef"><b>Definition:</b> <a href="../../de/da3/include_2asterisk_2compat_8h_source.html#l00060">include/asterisk/compat.h:60</a></div></div>
<div class="ttc" id="test__http__media__cache_8c_html_a80c8e3ae5087d90d422675d034eeebc7"><div class="ttname"><a href="../../d4/d45/test__http__media__cache_8c.html#a80c8e3ae5087d90d422675d034eeebc7">options</a></div><div class="ttdeci">static struct test_options options</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d45/test__http__media__cache_8c_source.html#l00062">test_http_media_cache.c:62</a></div></div>
<div class="ttc" id="chan__alsa_8c_html_a98f5e70e98f6dc48e3c5ba316066d540"><div class="ttname"><a href="../../da/d45/chan__alsa_8c.html#a98f5e70e98f6dc48e3c5ba316066d540">format</a></div><div class="ttdeci">static snd_pcm_format_t format</div><div class="ttdef"><b>Definition:</b> <a href="../../da/d45/chan__alsa_8c_source.html#l00102">chan_alsa.c:102</a></div></div>
<div class="ttc" id="include_2asterisk_2app_8h_html_a80cd3f6f786b59b742bcecfc0b3be7c2"><div class="ttname"><a href="../../d3/d93/include_2asterisk_2app_8h.html#a80cd3f6f786b59b742bcecfc0b3be7c2">AST_DECLARE_APP_ARGS</a></div><div class="ttdeci">#define AST_DECLARE_APP_ARGS(name, arglist)</div><div class="ttdoc">Declare a structure to hold an application&amp;#39;s arguments. </div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d93/include_2asterisk_2app_8h_source.html#l01249">include/asterisk/app.h:1249</a></div></div>
<div class="ttc" id="func__env_8c_html_abd81d11867ad50357ea8332e8d36cf8aa7c12b0aea0d0de06a80877d724b86525"><div class="ttname"><a href="../../d4/daa/func__env_8c.html#abd81d11867ad50357ea8332e8d36cf8aa7c12b0aea0d0de06a80877d724b86525">FF_DOS</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d4/daa/func__env_8c_source.html#l00321">func_env.c:321</a></div></div>
<div class="ttc" id="include_2asterisk_2app_8h_html_a037e9a5b28477b17e7c9acbe7ecb21d5"><div class="ttname"><a href="../../d3/d93/include_2asterisk_2app_8h.html#a037e9a5b28477b17e7c9acbe7ecb21d5">AST_APP_ARG</a></div><div class="ttdeci">#define AST_APP_ARG(name)</div><div class="ttdoc">Define an application argument. </div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d93/include_2asterisk_2app_8h_source.html#l01232">include/asterisk/app.h:1232</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a9cc0a8665ffb4519792ae07a380a2753"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a9cc0a8665ffb4519792ae07a380a2753">&#9670;&nbsp;</a></span>format2term()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">const char * format2term </td>
          <td>(</td>
          <td class="paramtype">enum <a class="el" href="../../d4/daa/func__env_8c.html#abd81d11867ad50357ea8332e8d36cf8a">file_format</a>&#160;</td>
          <td class="paramname"><em>f</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="../../d4/daa/func__env_8c_source.html#l00740">740</a> of file <a class="el" href="../../d4/daa/func__env_8c_source.html">func_env.c</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../d4/daa/func__env_8c_source.html#l00486">file_read()</a>, and <a class="el" href="../../d4/daa/func__env_8c_source.html#l00746">file_write()</a>.</p>
<div class="fragment"><div class="line"><a name="l00741"></a><span class="lineno">  741</span>&#160;{</div><div class="line"><a name="l00742"></a><span class="lineno">  742</span>&#160;   <span class="keyword">const</span> <span class="keywordtype">char</span> *term[] = { <span class="stringliteral">&quot;&quot;</span>, <span class="stringliteral">&quot;\n&quot;</span>, <span class="stringliteral">&quot;\r\n&quot;</span>, <span class="stringliteral">&quot;\r&quot;</span> };</div><div class="line"><a name="l00743"></a><span class="lineno">  743</span>&#160;   <span class="keywordflow">return</span> term[f + 1];</div><div class="line"><a name="l00744"></a><span class="lineno">  744</span>&#160;}</div></div><!-- fragment -->
</div>
</div>
<a id="ac3382bf6da54c56b37069bd76bbdf4f9"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac3382bf6da54c56b37069bd76bbdf4f9">&#9670;&nbsp;</a></span>load_module()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int load_module </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="../../d4/daa/func__env_8c_source.html#l01276">1276</a> of file <a class="el" href="../../d4/daa/func__env_8c_source.html">func_env.c</a>.</p>

<p class="reference">References <a class="el" href="../../db/de0/pbx_8h_source.html#l01502">AST_CFE_BOTH</a>, <a class="el" href="../../db/de0/pbx_8h_source.html#l01500">AST_CFE_READ</a>, <a class="el" href="../../db/de0/pbx_8h_source.html#l01508">ast_custom_function_register</a>, and <a class="el" href="../../db/de0/pbx_8h_source.html#l01517">ast_custom_function_register_escalating</a>.</p>
<div class="fragment"><div class="line"><a name="l01277"></a><span class="lineno"> 1277</span>&#160;{</div><div class="line"><a name="l01278"></a><span class="lineno"> 1278</span>&#160;   <span class="keywordtype">int</span> res = 0;</div><div class="line"><a name="l01279"></a><span class="lineno"> 1279</span>&#160;</div><div class="line"><a name="l01280"></a><span class="lineno"> 1280</span>&#160;   res |= <a class="code" href="../../db/de0/pbx_8h.html#a8af0e93442a9e468425f63cc52b0ac7b">ast_custom_function_register</a>(&amp;<a class="code" href="../../d4/daa/func__env_8c.html#a6b67a1aba70acfa8c3c5ef192fa56932">env_function</a>);</div><div class="line"><a name="l01281"></a><span class="lineno"> 1281</span>&#160;   res |= <a class="code" href="../../db/de0/pbx_8h.html#a82a6116c57689246592c0707b8eec102">ast_custom_function_register_escalating</a>(&amp;<a class="code" href="../../d4/daa/func__env_8c.html#ac0eb4828f9ab570b1cbb5e122ffa039b">stat_function</a>, <a class="code" href="../../db/de0/pbx_8h.html#ae44f095e3bb053c0d3f8d6b963df4a25a3b871161353508e1ce975ece03be26cd">AST_CFE_READ</a>);</div><div class="line"><a name="l01282"></a><span class="lineno"> 1282</span>&#160;   res |= <a class="code" href="../../db/de0/pbx_8h.html#a82a6116c57689246592c0707b8eec102">ast_custom_function_register_escalating</a>(&amp;<a class="code" href="../../d4/daa/func__env_8c.html#ab4313cc35ebf797006bea982b3bd34e4">file_function</a>, <a class="code" href="../../db/de0/pbx_8h.html#ae44f095e3bb053c0d3f8d6b963df4a25a6c4889ef775a45630878b61f315b3ac7">AST_CFE_BOTH</a>);</div><div class="line"><a name="l01283"></a><span class="lineno"> 1283</span>&#160;   res |= <a class="code" href="../../db/de0/pbx_8h.html#a82a6116c57689246592c0707b8eec102">ast_custom_function_register_escalating</a>(&amp;<a class="code" href="../../d4/daa/func__env_8c.html#a17ea170150ac5c64cf33944d8cd8ba41">file_count_line_function</a>, <a class="code" href="../../db/de0/pbx_8h.html#ae44f095e3bb053c0d3f8d6b963df4a25a3b871161353508e1ce975ece03be26cd">AST_CFE_READ</a>);</div><div class="line"><a name="l01284"></a><span class="lineno"> 1284</span>&#160;   res |= <a class="code" href="../../db/de0/pbx_8h.html#a82a6116c57689246592c0707b8eec102">ast_custom_function_register_escalating</a>(&amp;<a class="code" href="../../d4/daa/func__env_8c.html#a0f7287e3ba226430598c894a31fb2ad5">file_format_function</a>, <a class="code" href="../../db/de0/pbx_8h.html#ae44f095e3bb053c0d3f8d6b963df4a25a3b871161353508e1ce975ece03be26cd">AST_CFE_READ</a>);</div><div class="line"><a name="l01285"></a><span class="lineno"> 1285</span>&#160;</div><div class="line"><a name="l01286"></a><span class="lineno"> 1286</span>&#160;   <span class="keywordflow">return</span> res;</div><div class="line"><a name="l01287"></a><span class="lineno"> 1287</span>&#160;}</div><div class="ttc" id="func__env_8c_html_ab4313cc35ebf797006bea982b3bd34e4"><div class="ttname"><a href="../../d4/daa/func__env_8c.html#ab4313cc35ebf797006bea982b3bd34e4">file_function</a></div><div class="ttdeci">static struct ast_custom_function file_function</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/daa/func__env_8c_source.html#l01245">func_env.c:1245</a></div></div>
<div class="ttc" id="func__env_8c_html_a17ea170150ac5c64cf33944d8cd8ba41"><div class="ttname"><a href="../../d4/daa/func__env_8c.html#a17ea170150ac5c64cf33944d8cd8ba41">file_count_line_function</a></div><div class="ttdeci">static struct ast_custom_function file_count_line_function</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/daa/func__env_8c_source.html#l01251">func_env.c:1251</a></div></div>
<div class="ttc" id="func__env_8c_html_a0f7287e3ba226430598c894a31fb2ad5"><div class="ttname"><a href="../../d4/daa/func__env_8c.html#a0f7287e3ba226430598c894a31fb2ad5">file_format_function</a></div><div class="ttdeci">static struct ast_custom_function file_format_function</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/daa/func__env_8c_source.html#l01257">func_env.c:1257</a></div></div>
<div class="ttc" id="pbx_8h_html_ae44f095e3bb053c0d3f8d6b963df4a25a3b871161353508e1ce975ece03be26cd"><div class="ttname"><a href="../../db/de0/pbx_8h.html#ae44f095e3bb053c0d3f8d6b963df4a25a3b871161353508e1ce975ece03be26cd">AST_CFE_READ</a></div><div class="ttdef"><b>Definition:</b> <a href="../../db/de0/pbx_8h_source.html#l01500">pbx.h:1500</a></div></div>
<div class="ttc" id="pbx_8h_html_a82a6116c57689246592c0707b8eec102"><div class="ttname"><a href="../../db/de0/pbx_8h.html#a82a6116c57689246592c0707b8eec102">ast_custom_function_register_escalating</a></div><div class="ttdeci">#define ast_custom_function_register_escalating(acf, escalation)</div><div class="ttdoc">Register a custom function which requires escalated privileges. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/de0/pbx_8h_source.html#l01517">pbx.h:1517</a></div></div>
<div class="ttc" id="pbx_8h_html_ae44f095e3bb053c0d3f8d6b963df4a25a6c4889ef775a45630878b61f315b3ac7"><div class="ttname"><a href="../../db/de0/pbx_8h.html#ae44f095e3bb053c0d3f8d6b963df4a25a6c4889ef775a45630878b61f315b3ac7">AST_CFE_BOTH</a></div><div class="ttdef"><b>Definition:</b> <a href="../../db/de0/pbx_8h_source.html#l01502">pbx.h:1502</a></div></div>
<div class="ttc" id="func__env_8c_html_a6b67a1aba70acfa8c3c5ef192fa56932"><div class="ttname"><a href="../../d4/daa/func__env_8c.html#a6b67a1aba70acfa8c3c5ef192fa56932">env_function</a></div><div class="ttdeci">static struct ast_custom_function env_function</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/daa/func__env_8c_source.html#l01233">func_env.c:1233</a></div></div>
<div class="ttc" id="func__env_8c_html_ac0eb4828f9ab570b1cbb5e122ffa039b"><div class="ttname"><a href="../../d4/daa/func__env_8c.html#ac0eb4828f9ab570b1cbb5e122ffa039b">stat_function</a></div><div class="ttdeci">static struct ast_custom_function stat_function</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/daa/func__env_8c_source.html#l01239">func_env.c:1239</a></div></div>
<div class="ttc" id="pbx_8h_html_a8af0e93442a9e468425f63cc52b0ac7b"><div class="ttname"><a href="../../db/de0/pbx_8h.html#a8af0e93442a9e468425f63cc52b0ac7b">ast_custom_function_register</a></div><div class="ttdeci">#define ast_custom_function_register(acf)</div><div class="ttdoc">Register a custom function. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/de0/pbx_8h_source.html#l01508">pbx.h:1508</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="aa57fd1166ed1411c59ff39ce109e28dc"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa57fd1166ed1411c59ff39ce109e28dc">&#9670;&nbsp;</a></span>stat_read()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int stat_read </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="../../df/d3c/structast__channel.html">ast_channel</a> *&#160;</td>
          <td class="paramname"><em>chan</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>cmd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>data</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>buf</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>len</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="../../d4/daa/func__env_8c_source.html#l00275">275</a> of file <a class="el" href="../../d4/daa/func__env_8c_source.html">func_env.c</a>.</p>

<p class="reference">References <a class="el" href="../../d6/d90/strings_8h_source.html#l00401">ast_copy_string()</a>, and <a class="el" href="../../de/da3/include_2asterisk_2compat_8h.html#a40eca58273c74a20a17f137d18ba826c">strsep()</a>.</p>
<div class="fragment"><div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;{</div><div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;   <span class="keywordtype">char</span> *action;</div><div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;   <span class="keyword">struct </span>stat s;</div><div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;</div><div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;   <a class="code" href="../../d6/d90/strings_8h.html#ac4040268f7b6ed77dfc49c7767626369">ast_copy_string</a>(<a class="code" href="../../dd/d7c/eagi__proxy_8c.html#ac95651d79c608a3148973b5b1fc9e525">buf</a>, <span class="stringliteral">&quot;0&quot;</span>, <a class="code" href="../../d9/d1e/func__strings_8c.html#af24e73aaf92f3000fda15d285e66df24">len</a>);</div><div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;</div><div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;   action = <a class="code" href="../../de/da3/include_2asterisk_2compat_8h.html#a40eca58273c74a20a17f137d18ba826c">strsep</a>(&amp;data, <span class="stringliteral">&quot;,&quot;</span>);</div><div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;   <span class="keywordflow">if</span> (stat(data, &amp;s)) {</div><div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;      <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;   } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;      <span class="keywordflow">switch</span> (*action) {</div><div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;      <span class="keywordflow">case</span> <span class="charliteral">&#39;e&#39;</span>:</div><div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;         strcpy(<a class="code" href="../../dd/d7c/eagi__proxy_8c.html#ac95651d79c608a3148973b5b1fc9e525">buf</a>, <span class="stringliteral">&quot;1&quot;</span>);</div><div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;         <span class="keywordflow">break</span>;</div><div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;      <span class="keywordflow">case</span> <span class="charliteral">&#39;s&#39;</span>:</div><div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;         snprintf(<a class="code" href="../../dd/d7c/eagi__proxy_8c.html#ac95651d79c608a3148973b5b1fc9e525">buf</a>, <a class="code" href="../../d9/d1e/func__strings_8c.html#af24e73aaf92f3000fda15d285e66df24">len</a>, <span class="stringliteral">&quot;%u&quot;</span>, (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>) s.st_size);</div><div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;         <span class="keywordflow">break</span>;</div><div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;      <span class="keywordflow">case</span> <span class="charliteral">&#39;f&#39;</span>:</div><div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;         snprintf(<a class="code" href="../../dd/d7c/eagi__proxy_8c.html#ac95651d79c608a3148973b5b1fc9e525">buf</a>, <a class="code" href="../../d9/d1e/func__strings_8c.html#af24e73aaf92f3000fda15d285e66df24">len</a>, <span class="stringliteral">&quot;%d&quot;</span>, S_ISREG(s.st_mode) ? 1 : 0);</div><div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;         <span class="keywordflow">break</span>;</div><div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;      <span class="keywordflow">case</span> <span class="charliteral">&#39;d&#39;</span>:</div><div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;         snprintf(<a class="code" href="../../dd/d7c/eagi__proxy_8c.html#ac95651d79c608a3148973b5b1fc9e525">buf</a>, <a class="code" href="../../d9/d1e/func__strings_8c.html#af24e73aaf92f3000fda15d285e66df24">len</a>, <span class="stringliteral">&quot;%d&quot;</span>, S_ISDIR(s.st_mode) ? 1 : 0);</div><div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;         <span class="keywordflow">break</span>;</div><div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;      <span class="keywordflow">case</span> <span class="charliteral">&#39;M&#39;</span>:</div><div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;         snprintf(<a class="code" href="../../dd/d7c/eagi__proxy_8c.html#ac95651d79c608a3148973b5b1fc9e525">buf</a>, <a class="code" href="../../d9/d1e/func__strings_8c.html#af24e73aaf92f3000fda15d285e66df24">len</a>, <span class="stringliteral">&quot;%d&quot;</span>, (<span class="keywordtype">int</span>) s.st_mtime);</div><div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;         <span class="keywordflow">break</span>;</div><div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;      <span class="keywordflow">case</span> <span class="charliteral">&#39;A&#39;</span>:</div><div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;         snprintf(<a class="code" href="../../dd/d7c/eagi__proxy_8c.html#ac95651d79c608a3148973b5b1fc9e525">buf</a>, <a class="code" href="../../d9/d1e/func__strings_8c.html#af24e73aaf92f3000fda15d285e66df24">len</a>, <span class="stringliteral">&quot;%d&quot;</span>, (<span class="keywordtype">int</span>) s.st_mtime);</div><div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;         <span class="keywordflow">break</span>;</div><div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;      <span class="keywordflow">case</span> <span class="charliteral">&#39;C&#39;</span>:</div><div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;         snprintf(<a class="code" href="../../dd/d7c/eagi__proxy_8c.html#ac95651d79c608a3148973b5b1fc9e525">buf</a>, <a class="code" href="../../d9/d1e/func__strings_8c.html#af24e73aaf92f3000fda15d285e66df24">len</a>, <span class="stringliteral">&quot;%d&quot;</span>, (<span class="keywordtype">int</span>) s.st_ctime);</div><div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;         <span class="keywordflow">break</span>;</div><div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;      <span class="keywordflow">case</span> <span class="charliteral">&#39;m&#39;</span>:</div><div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;         snprintf(<a class="code" href="../../dd/d7c/eagi__proxy_8c.html#ac95651d79c608a3148973b5b1fc9e525">buf</a>, <a class="code" href="../../d9/d1e/func__strings_8c.html#af24e73aaf92f3000fda15d285e66df24">len</a>, <span class="stringliteral">&quot;%o&quot;</span>, (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>) s.st_mode);</div><div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;         <span class="keywordflow">break</span>;</div><div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;      }</div><div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;   }</div><div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;</div><div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;   <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;}</div><div class="ttc" id="eagi__proxy_8c_html_ac95651d79c608a3148973b5b1fc9e525"><div class="ttname"><a href="../../dd/d7c/eagi__proxy_8c.html#ac95651d79c608a3148973b5b1fc9e525">buf</a></div><div class="ttdeci">char buf[BUFSIZE]</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d7c/eagi__proxy_8c_source.html#l00066">eagi_proxy.c:66</a></div></div>
<div class="ttc" id="func__strings_8c_html_af24e73aaf92f3000fda15d285e66df24"><div class="ttname"><a href="../../d9/d1e/func__strings_8c.html#af24e73aaf92f3000fda15d285e66df24">len</a></div><div class="ttdeci">static int len(struct ast_channel *chan, const char *cmd, char *data, char *buf, size_t buflen)</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d1e/func__strings_8c_source.html#l01344">func_strings.c:1344</a></div></div>
<div class="ttc" id="include_2asterisk_2compat_8h_html_a40eca58273c74a20a17f137d18ba826c"><div class="ttname"><a href="../../de/da3/include_2asterisk_2compat_8h.html#a40eca58273c74a20a17f137d18ba826c">strsep</a></div><div class="ttdeci">char * strsep(char **str, const char *delims)</div></div>
<div class="ttc" id="strings_8h_html_ac4040268f7b6ed77dfc49c7767626369"><div class="ttname"><a href="../../d6/d90/strings_8h.html#ac4040268f7b6ed77dfc49c7767626369">ast_copy_string</a></div><div class="ttdeci">void ast_copy_string(char *dst, const char *src, size_t size)</div><div class="ttdoc">Size-limited null-terminating string copy. </div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d90/strings_8h_source.html#l00401">strings.h:401</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="ad09fa931f468002152a3cc2d5ce25eae"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad09fa931f468002152a3cc2d5ce25eae">&#9670;&nbsp;</a></span>unload_module()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int unload_module </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="../../d4/daa/func__env_8c_source.html#l01263">1263</a> of file <a class="el" href="../../d4/daa/func__env_8c_source.html">func_env.c</a>.</p>

<p class="reference">References <a class="el" href="../../db/d70/pbx__functions_8c_source.html#l00273">ast_custom_function_unregister()</a>.</p>
<div class="fragment"><div class="line"><a name="l01264"></a><span class="lineno"> 1264</span>&#160;{</div><div class="line"><a name="l01265"></a><span class="lineno"> 1265</span>&#160;   <span class="keywordtype">int</span> res = 0;</div><div class="line"><a name="l01266"></a><span class="lineno"> 1266</span>&#160;</div><div class="line"><a name="l01267"></a><span class="lineno"> 1267</span>&#160;   res |= <a class="code" href="../../db/de0/pbx_8h.html#a965977ea9a3144bc203e0ce7a64680a1">ast_custom_function_unregister</a>(&amp;<a class="code" href="../../d4/daa/func__env_8c.html#a6b67a1aba70acfa8c3c5ef192fa56932">env_function</a>);</div><div class="line"><a name="l01268"></a><span class="lineno"> 1268</span>&#160;   res |= <a class="code" href="../../db/de0/pbx_8h.html#a965977ea9a3144bc203e0ce7a64680a1">ast_custom_function_unregister</a>(&amp;<a class="code" href="../../d4/daa/func__env_8c.html#ac0eb4828f9ab570b1cbb5e122ffa039b">stat_function</a>);</div><div class="line"><a name="l01269"></a><span class="lineno"> 1269</span>&#160;   res |= <a class="code" href="../../db/de0/pbx_8h.html#a965977ea9a3144bc203e0ce7a64680a1">ast_custom_function_unregister</a>(&amp;<a class="code" href="../../d4/daa/func__env_8c.html#ab4313cc35ebf797006bea982b3bd34e4">file_function</a>);</div><div class="line"><a name="l01270"></a><span class="lineno"> 1270</span>&#160;   res |= <a class="code" href="../../db/de0/pbx_8h.html#a965977ea9a3144bc203e0ce7a64680a1">ast_custom_function_unregister</a>(&amp;<a class="code" href="../../d4/daa/func__env_8c.html#a17ea170150ac5c64cf33944d8cd8ba41">file_count_line_function</a>);</div><div class="line"><a name="l01271"></a><span class="lineno"> 1271</span>&#160;   res |= <a class="code" href="../../db/de0/pbx_8h.html#a965977ea9a3144bc203e0ce7a64680a1">ast_custom_function_unregister</a>(&amp;<a class="code" href="../../d4/daa/func__env_8c.html#a0f7287e3ba226430598c894a31fb2ad5">file_format_function</a>);</div><div class="line"><a name="l01272"></a><span class="lineno"> 1272</span>&#160;</div><div class="line"><a name="l01273"></a><span class="lineno"> 1273</span>&#160;   <span class="keywordflow">return</span> res;</div><div class="line"><a name="l01274"></a><span class="lineno"> 1274</span>&#160;}</div><div class="ttc" id="func__env_8c_html_ab4313cc35ebf797006bea982b3bd34e4"><div class="ttname"><a href="../../d4/daa/func__env_8c.html#ab4313cc35ebf797006bea982b3bd34e4">file_function</a></div><div class="ttdeci">static struct ast_custom_function file_function</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/daa/func__env_8c_source.html#l01245">func_env.c:1245</a></div></div>
<div class="ttc" id="func__env_8c_html_a17ea170150ac5c64cf33944d8cd8ba41"><div class="ttname"><a href="../../d4/daa/func__env_8c.html#a17ea170150ac5c64cf33944d8cd8ba41">file_count_line_function</a></div><div class="ttdeci">static struct ast_custom_function file_count_line_function</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/daa/func__env_8c_source.html#l01251">func_env.c:1251</a></div></div>
<div class="ttc" id="func__env_8c_html_a0f7287e3ba226430598c894a31fb2ad5"><div class="ttname"><a href="../../d4/daa/func__env_8c.html#a0f7287e3ba226430598c894a31fb2ad5">file_format_function</a></div><div class="ttdeci">static struct ast_custom_function file_format_function</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/daa/func__env_8c_source.html#l01257">func_env.c:1257</a></div></div>
<div class="ttc" id="pbx_8h_html_a965977ea9a3144bc203e0ce7a64680a1"><div class="ttname"><a href="../../db/de0/pbx_8h.html#a965977ea9a3144bc203e0ce7a64680a1">ast_custom_function_unregister</a></div><div class="ttdeci">int ast_custom_function_unregister(struct ast_custom_function *acf)</div><div class="ttdoc">Unregister a custom function. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/d70/pbx__functions_8c_source.html#l00273">pbx_functions.c:273</a></div></div>
<div class="ttc" id="func__env_8c_html_a6b67a1aba70acfa8c3c5ef192fa56932"><div class="ttname"><a href="../../d4/daa/func__env_8c.html#a6b67a1aba70acfa8c3c5ef192fa56932">env_function</a></div><div class="ttdeci">static struct ast_custom_function env_function</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/daa/func__env_8c_source.html#l01233">func_env.c:1233</a></div></div>
<div class="ttc" id="func__env_8c_html_ac0eb4828f9ab570b1cbb5e122ffa039b"><div class="ttname"><a href="../../d4/daa/func__env_8c.html#ac0eb4828f9ab570b1cbb5e122ffa039b">stat_function</a></div><div class="ttdeci">static struct ast_custom_function stat_function</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/daa/func__env_8c_source.html#l01239">func_env.c:1239</a></div></div>
</div><!-- fragment -->
</div>
</div>
<h2 class="groupheader">Variable Documentation</h2>
<a id="ab22f32016155f7f403e7178767163d7d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab22f32016155f7f403e7178767163d7d">&#9670;&nbsp;</a></span>__mod_info</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="../../dd/d5f/structast__module__info.html">ast_module_info</a> __mod_info = { .<a class="el" href="../../d1/da4/res__corosync_8c.html#a8f8f80d37794cde9472343e4487ba3eb">name</a> = <a class="el" href="../../da/ddd/named__acl_8c.html#aec23fc5034c3bb08140fc021f4955877">AST_MODULE</a>, .flags = <a class="el" href="../../d5/d16/module_8h.html#a155a0df9c59e04e305d4a2fa3e35f843a12c3f60dd7655dfa8d4430cbf04b1223">AST_MODFLAG_LOAD_ORDER</a> , .description = &quot;Environment/filesystem dialplan functions&quot; , .key = &quot;This paragraph is copyright (<a class="el" href="../../d7/d6f/test__linkedlists_8c.html#acd9db00336027462cfb25b97b5356883">c</a>) 2006 by Digium, Inc. \In <a class="el" href="../../d5/d14/voicin_8c.html#aed7ca058008dc3e5ee131e575abed285">order</a> for your module to load, it must return this \key via <a class="el" href="../../d7/d6f/test__linkedlists_8c.html#a13dd15487fee89a002d17ef3aff62d02">a</a> function called \&quot;key\&quot;. Any code which \includes this paragraph must <a class="el" href="../../dd/d7c/eagi__proxy_8c.html#a39730e90126aad69cfc9ca4d6fcdb3a6">be</a> licensed under the GNU \General Public License <a class="el" href="../../da/d7c/utils_2frame_8h.html#a56abfaab87c46691c1ef3ad0df23e864">version</a> 2 or later (at your \option). In addition to Digium's general reservations \of rights, Digium expressly reserves the right to \allow other parties to license this paragraph under \different terms. Any use of Digium, Inc. trademarks or \logos (including \&quot;Asterisk\&quot; or \&quot;Digium\&quot;) without \express written <a class="el" href="../../d4/d4c/structpermission.html">permission</a> of Digium, Inc. is prohibited.\n&quot; , .buildopt_sum = &quot;30ef0c93b36035ec78c9cfd712d36d9b&quot; , .load = load_module, .unload = unload_module, .load_pri = AST_MODPRI_DEFAULT, .support_level = AST_MODULE_SUPPORT_CORE, }</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="../../d4/daa/func__env_8c_source.html#l01289">1289</a> of file <a class="el" href="../../d4/daa/func__env_8c_source.html">func_env.c</a>.</p>

</div>
</div>
<a id="ad60e83b9aa660040fed4d5377966cc21"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad60e83b9aa660040fed4d5377966cc21">&#9670;&nbsp;</a></span>ast_module_info</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">const struct <a class="el" href="../../dd/d5f/structast__module__info.html">ast_module_info</a>* <a class="el" href="../../dd/d5f/structast__module__info.html">ast_module_info</a> = &amp;<a class="el" href="../../d6/d7a/test__xml__escape_8c.html#ab22f32016155f7f403e7178767163d7d">__mod_info</a></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="../../d4/daa/func__env_8c_source.html#l01289">1289</a> of file <a class="el" href="../../d4/daa/func__env_8c_source.html">func_env.c</a>.</p>

</div>
</div>
<a id="a6b67a1aba70acfa8c3c5ef192fa56932"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6b67a1aba70acfa8c3c5ef192fa56932">&#9670;&nbsp;</a></span>env_function</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="../../db/dc0/structast__custom__function.html">ast_custom_function</a> env_function</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<b>Initial value:</b><div class="fragment"><div class="line">= {</div><div class="line">   .name = <span class="stringliteral">&quot;ENV&quot;</span>,</div><div class="line">   .read = <a class="code" href="../../d4/daa/func__env_8c.html#a5c51c4b5326bf3113ae5c5593ef47e8d">env_read</a>,</div><div class="line">   .write = <a class="code" href="../../d4/daa/func__env_8c.html#a05b024411e5c6c79e3883e7c7bfdb061">env_write</a></div><div class="line">}</div><div class="ttc" id="func__env_8c_html_a5c51c4b5326bf3113ae5c5593ef47e8d"><div class="ttname"><a href="../../d4/daa/func__env_8c.html#a5c51c4b5326bf3113ae5c5593ef47e8d">env_read</a></div><div class="ttdeci">static int env_read(struct ast_channel *chan, const char *cmd, char *data, char *buf, size_t len)</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/daa/func__env_8c_source.html#l00245">func_env.c:245</a></div></div>
<div class="ttc" id="func__env_8c_html_a05b024411e5c6c79e3883e7c7bfdb061"><div class="ttname"><a href="../../d4/daa/func__env_8c.html#a05b024411e5c6c79e3883e7c7bfdb061">env_write</a></div><div class="ttdeci">static int env_write(struct ast_channel *chan, const char *cmd, char *data, const char *value)</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/daa/func__env_8c_source.html#l00261">func_env.c:261</a></div></div>
</div><!-- fragment -->
<p class="definition">Definition at line <a class="el" href="../../d4/daa/func__env_8c_source.html#l01233">1233</a> of file <a class="el" href="../../d4/daa/func__env_8c_source.html">func_env.c</a>.</p>

</div>
</div>
<a id="a17ea170150ac5c64cf33944d8cd8ba41"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a17ea170150ac5c64cf33944d8cd8ba41">&#9670;&nbsp;</a></span>file_count_line_function</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="../../db/dc0/structast__custom__function.html">ast_custom_function</a> file_count_line_function</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<b>Initial value:</b><div class="fragment"><div class="line">= {</div><div class="line">   .name = <span class="stringliteral">&quot;FILE_COUNT_LINE&quot;</span>,</div><div class="line">   .read2 = <a class="code" href="../../d4/daa/func__env_8c.html#a74f5988113b2cba86f2d8bdb6cdc92ae">file_count_line</a>,</div><div class="line">   .read_max = 12,</div><div class="line">}</div><div class="ttc" id="func__env_8c_html_a74f5988113b2cba86f2d8bdb6cdc92ae"><div class="ttname"><a href="../../d4/daa/func__env_8c.html#a74f5988113b2cba86f2d8bdb6cdc92ae">file_count_line</a></div><div class="ttdeci">static int file_count_line(struct ast_channel *chan, const char *cmd, char *data, struct ast_str **buf, ssize_t len)</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/daa/func__env_8c_source.html#l00400">func_env.c:400</a></div></div>
</div><!-- fragment -->
<p class="definition">Definition at line <a class="el" href="../../d4/daa/func__env_8c_source.html#l01251">1251</a> of file <a class="el" href="../../d4/daa/func__env_8c_source.html">func_env.c</a>.</p>

</div>
</div>
<a id="a0f7287e3ba226430598c894a31fb2ad5"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0f7287e3ba226430598c894a31fb2ad5">&#9670;&nbsp;</a></span>file_format_function</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="../../db/dc0/structast__custom__function.html">ast_custom_function</a> file_format_function</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<b>Initial value:</b><div class="fragment"><div class="line">= {</div><div class="line">   .name = <span class="stringliteral">&quot;FILE_FORMAT&quot;</span>,</div><div class="line">   .read2 = <a class="code" href="../../d4/daa/func__env_8c.html#abd81d11867ad50357ea8332e8d36cf8a">file_format</a>,</div><div class="line">   .read_max = 2,</div><div class="line">}</div><div class="ttc" id="func__env_8c_html_abd81d11867ad50357ea8332e8d36cf8a"><div class="ttname"><a href="../../d4/daa/func__env_8c.html#abd81d11867ad50357ea8332e8d36cf8a">file_format</a></div><div class="ttdeci">file_format</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/daa/func__env_8c_source.html#l00318">func_env.c:318</a></div></div>
</div><!-- fragment -->
<p class="definition">Definition at line <a class="el" href="../../d4/daa/func__env_8c_source.html#l01257">1257</a> of file <a class="el" href="../../d4/daa/func__env_8c_source.html">func_env.c</a>.</p>

</div>
</div>
<a id="ab4313cc35ebf797006bea982b3bd34e4"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab4313cc35ebf797006bea982b3bd34e4">&#9670;&nbsp;</a></span>file_function</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="../../db/dc0/structast__custom__function.html">ast_custom_function</a> file_function</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<b>Initial value:</b><div class="fragment"><div class="line">= {</div><div class="line">   .name = <span class="stringliteral">&quot;FILE&quot;</span>,</div><div class="line">   .read2 = <a class="code" href="../../d4/daa/func__env_8c.html#add1f9152200c079d475b65e42844f0ea">file_read</a>,</div><div class="line">   .write = <a class="code" href="../../d4/daa/func__env_8c.html#a175689ce25a8a01263bda2409f4d0003">file_write</a>,</div><div class="line">}</div><div class="ttc" id="func__env_8c_html_add1f9152200c079d475b65e42844f0ea"><div class="ttname"><a href="../../d4/daa/func__env_8c.html#add1f9152200c079d475b65e42844f0ea">file_read</a></div><div class="ttdeci">static int file_read(struct ast_channel *chan, const char *cmd, char *data, struct ast_str **buf, ssize_t len)</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/daa/func__env_8c_source.html#l00486">func_env.c:486</a></div></div>
<div class="ttc" id="func__env_8c_html_a175689ce25a8a01263bda2409f4d0003"><div class="ttname"><a href="../../d4/daa/func__env_8c.html#a175689ce25a8a01263bda2409f4d0003">file_write</a></div><div class="ttdeci">static int file_write(struct ast_channel *chan, const char *cmd, char *data, const char *value)</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/daa/func__env_8c_source.html#l00746">func_env.c:746</a></div></div>
</div><!-- fragment -->
<p class="definition">Definition at line <a class="el" href="../../d4/daa/func__env_8c_source.html#l01245">1245</a> of file <a class="el" href="../../d4/daa/func__env_8c_source.html">func_env.c</a>.</p>

</div>
</div>
<a id="ac0eb4828f9ab570b1cbb5e122ffa039b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac0eb4828f9ab570b1cbb5e122ffa039b">&#9670;&nbsp;</a></span>stat_function</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="../../db/dc0/structast__custom__function.html">ast_custom_function</a> stat_function</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<b>Initial value:</b><div class="fragment"><div class="line">= {</div><div class="line">   .name = <span class="stringliteral">&quot;STAT&quot;</span>,</div><div class="line">   .read = <a class="code" href="../../d4/daa/func__env_8c.html#aa57fd1166ed1411c59ff39ce109e28dc">stat_read</a>,</div><div class="line">   .read_max = 12,</div><div class="line">}</div><div class="ttc" id="func__env_8c_html_aa57fd1166ed1411c59ff39ce109e28dc"><div class="ttname"><a href="../../d4/daa/func__env_8c.html#aa57fd1166ed1411c59ff39ce109e28dc">stat_read</a></div><div class="ttdeci">static int stat_read(struct ast_channel *chan, const char *cmd, char *data, char *buf, size_t len)</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/daa/func__env_8c_source.html#l00275">func_env.c:275</a></div></div>
</div><!-- fragment -->
<p class="definition">Definition at line <a class="el" href="../../d4/daa/func__env_8c_source.html#l01239">1239</a> of file <a class="el" href="../../d4/daa/func__env_8c_source.html">func_env.c</a>.</p>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Sun Aug 8 2021 19:45:56 for Asterisk - The Open Source Telephony Project by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="../../doxygen.png" alt="doxygen"/>
</a> 1.8.13
</small></address>
</body>
</html>
