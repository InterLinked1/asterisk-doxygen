<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Asterisk - The Open Source Telephony Project: manager_mwi.c File Reference</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Asterisk - The Open Source Telephony Project
   &#160;<span id="projectnumber">18.5.0</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "../../search",false,'Search');
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('../../',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="../../dir_5c982d53a68cdbcd421152b4020263a9.html">main</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a> &#124;
<a href="#var-members">Variables</a>  </div>
  <div class="headertitle">
<div class="title">manager_mwi.c File Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>The Asterisk Management Interface - AMI (MWI event handling)  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &quot;<a class="el" href="../../db/db2/asterisk_8h_source.html">asterisk.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="../../db/d45/manager_8h_source.html">asterisk/manager.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="../../d3/d93/include_2asterisk_2app_8h_source.html">asterisk/app.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="../../dc/d33/mwi_8h_source.html">asterisk/mwi.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="../../d5/d7b/channel_8h_source.html">asterisk/channel.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="../../d4/d25/stasis__message__router_8h_source.html">asterisk/stasis_message_router.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="../../dd/d79/stasis_8h_source.html">asterisk/stasis.h</a>&quot;</code><br />
</div><div class="textblock"><div class="dynheader">
Include dependency graph for manager_mwi.c:</div>
<div class="dyncontent">
<div class="center"><img src="../../d4/d5b/manager__mwi_8c__incl.png" border="0" usemap="#manager__mwi_8c" alt=""/></div>
<map name="manager__mwi_8c" id="manager__mwi_8c">
<area shape="rect" id="node2" href="../../db/db2/asterisk_8h.html" title="Asterisk main include file. File version handling, generic pbx functions. " alt="" coords="2144,319,2228,345"/>
<area shape="rect" id="node19" href="../../db/d45/manager_8h.html" title="The AMI &#45; Asterisk Manager Interface &#45; is a TCP protocol created to manage Asterisk with third&#45;party ..." alt="" coords="716,319,861,345"/>
<area shape="rect" id="node30" href="../../d3/d93/include_2asterisk_2app_8h.html" title="Application convenience functions, designed to give consistent look and feel to Asterisk apps..." alt="" coords="193,169,305,196"/>
<area shape="rect" id="node32" href="../../dd/d79/stasis_8h.html" title="Stasis Message Bus API. See Stasis Message Bus API for detailed documentation. " alt="" coords="377,244,502,271"/>
<area shape="rect" id="node35" href="../../dc/d33/mwi_8h.html" title="Asterisk MWI API. " alt="" coords="299,87,412,114"/>
<area shape="rect" id="node37" href="../../d5/d7b/channel_8h.html" title="General Asterisk PBX channel definitions. " alt="" coords="1217,169,1355,196"/>
<area shape="rect" id="node50" href="../../d4/d25/stasis__message__router_8h.html" title="asterisk/stasis_message\l_router.h" alt="" coords="487,80,666,121"/>
<area shape="rect" id="node3" href="../../d8/d20/autoconfig_8h.html" title="asterisk/autoconfig.h" alt="" coords="1925,393,2079,420"/>
<area shape="rect" id="node5" href="../../de/da3/include_2asterisk_2compat_8h.html" title="General Definitions for Asterisk top level program Included by asterisk.h to handle platform&#45;specific..." alt="" coords="1860,617,1997,644"/>
<area shape="rect" id="node18" href="../../d8/d8a/astmm_8h.html" title="Asterisk memory management routines. " alt="" coords="2104,393,2239,420"/>
<area shape="rect" id="node4" href="../../dc/dba/buildopts_8h.html" title="asterisk/buildopts.h" alt="" coords="1929,468,2075,495"/>
<area shape="rect" id="node6" href="../../d4/dd1/compiler_8h.html" title="Compiler&#45;specific macros and other items. " alt="" coords="1281,767,1424,793"/>
<area shape="rect" id="node20" href="../../d9/d94/network_8h.html" title="Wrapper for network related headers, masking differences between various operating systems..." alt="" coords="371,692,510,719"/>
<area shape="rect" id="node21" href="../../dd/d42/lock_8h.html" title="Asterisk locking&#45;related definitions: " alt="" coords="1107,692,1220,719"/>
<area shape="rect" id="node22" href="../../d9/db6/datastore_8h.html" title="Asterisk datastore objects. " alt="" coords="1657,393,1808,420"/>
<area shape="rect" id="node24" href="../../d1/d99/xmldoc_8h.html" title="Asterisk XML Documentation API. " alt="" coords="513,393,648,420"/>
<area shape="rect" id="node23" href="../../df/d90/linkedlists_8h.html" title="A set of macros to manage forward&#45;linked lists. " alt="" coords="1325,617,1476,644"/>
<area shape="rect" id="node25" href="../../d1/d0f/stringfields_8h.html" title="asterisk/stringfields.h" alt="" coords="58,692,215,719"/>
<area shape="rect" id="node26" href="../../d6/d90/strings_8h.html" title="String manipulation functions. " alt="" coords="722,468,853,495"/>
<area shape="rect" id="node27" href="../../d5/d60/utils_8h.html" title="Utility functions. " alt="" coords="565,617,679,644"/>
<area shape="rect" id="node28" href="../../dc/d7d/threadstorage_8h.html" title="Definitions to aid in the use of thread local storage. " alt="" coords="469,543,647,569"/>
<area shape="rect" id="node29" href="../../d5/da5/astobj2_8h.html" title="asterisk/astobj2.h" alt="" coords="1096,543,1231,569"/>
<area shape="rect" id="node31" href="../../d2/d4d/file_8h.html" title="Generic File Format Support. Should be included by clients of the file handling routines. File service providers should instead include mod_format.h. " alt="" coords="43,244,150,271"/>
<area shape="rect" id="node33" href="../../d4/d05/json_8h.html" title="Asterisk JSON abstraction layer. " alt="" coords="526,319,641,345"/>
<area shape="rect" id="node34" href="../../dd/d20/event_8h.html" title="asterisk/event.h" alt="" coords="377,319,501,345"/>
<area shape="rect" id="node36" href="../../d1/d96/stasis__state_8h.html" title="Stasis State API. " alt="" coords="347,169,513,196"/>
<area shape="rect" id="node38" href="../../dc/d4d/alertpipe_8h.html" title="asterisk/alertpipe.h" alt="" coords="877,468,1021,495"/>
<area shape="rect" id="node39" href="../../dc/d14/abstract__jb_8h.html" title="Common implementation&#45;independent jitterbuffer stuff. " alt="" coords="1708,244,1867,271"/>
<area shape="rect" id="node40" href="../../d4/dfb/poll-compat_8h.html" title="asterisk/poll&#45;compat.h" alt="" coords="1891,244,2055,271"/>
<area shape="rect" id="node41" href="../../d6/d66/include_2asterisk_2frame_8h.html" title="Asterisk internal frame definitions. " alt="" coords="1287,319,1413,345"/>
<area shape="rect" id="node42" href="../../d9/de7/chanvars_8h.html" title="Channel Variables. " alt="" coords="1438,543,1585,569"/>
<area shape="rect" id="node43" href="../../d3/de6/include_2asterisk_2config_8h.html" title="Configuration File Parser. " alt="" coords="459,468,585,495"/>
<area shape="rect" id="node44" href="../../dc/d07/cdr_8h.html" title="Call Detail Record API. " alt="" coords="955,244,1062,271"/>
<area shape="rect" id="node45" href="../../d0/d3c/format__cap_8h.html" title="Format Capabilities API. " alt="" coords="1087,244,1248,271"/>
<area shape="rect" id="node46" href="../../d9/d95/channelstate_8h.html" title="Channel states. " alt="" coords="2219,244,2390,271"/>
<area shape="rect" id="node47" href="../../de/dc8/ccss_8h.html" title="Call Completion Supplementary Services API. " alt="" coords="2079,244,2195,271"/>
<area shape="rect" id="node48" href="../../db/d3c/framehook_8h.html" title="FrameHook Architecture. " alt="" coords="1374,244,1531,271"/>
<area shape="rect" id="node49" href="../../d4/d61/endpoints_8h.html" title="Endpoint abstractions. " alt="" coords="527,244,677,271"/>
</map>
</div>
</div>
<p><a href="../../d4/d00/manager__mwi_8c_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:aec9fe0ded4af0ffc4b4220fba8d031d0"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d4/d00/manager__mwi_8c.html#aec9fe0ded4af0ffc4b4220fba8d031d0">exclude_event_cb</a> (const char *key)</td></tr>
<tr class="memdesc:aec9fe0ded4af0ffc4b4220fba8d031d0"><td class="mdescLeft">&#160;</td><td class="mdescRight">Callback function used by <a class="el" href="../../d4/d00/manager__mwi_8c.html#a68833626c247fb273853dbb03fa37596">mwi_app_event_cb</a> to weed out "Event" keys.  <a href="#aec9fe0ded4af0ffc4b4220fba8d031d0">More...</a><br /></td></tr>
<tr class="separator:aec9fe0ded4af0ffc4b4220fba8d031d0"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2571c636aafd979f5719051090e5bbff"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d4/d00/manager__mwi_8c.html#a2571c636aafd979f5719051090e5bbff">manager_mwi_init</a> (void)</td></tr>
<tr class="memdesc:a2571c636aafd979f5719051090e5bbff"><td class="mdescLeft">&#160;</td><td class="mdescRight">Initialize support for AMI MWI events.  <a href="#a2571c636aafd979f5719051090e5bbff">More...</a><br /></td></tr>
<tr class="separator:a2571c636aafd979f5719051090e5bbff"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a83d4f212d1e60249baa2c1a4742d425a"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d4/d00/manager__mwi_8c.html#a83d4f212d1e60249baa2c1a4742d425a">manager_mwi_shutdown</a> (void)</td></tr>
<tr class="separator:a83d4f212d1e60249baa2c1a4742d425a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a68833626c247fb273853dbb03fa37596"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d4/d00/manager__mwi_8c.html#a68833626c247fb273853dbb03fa37596">mwi_app_event_cb</a> (void *data, struct <a class="el" href="../../d9/de4/structstasis__subscription.html">stasis_subscription</a> *<a class="el" href="../../d1/da4/res__corosync_8c.html#a8e51289dd0fc7415cee40e7a57b49fdf">sub</a>, struct <a class="el" href="../../d7/d55/structstasis__message.html">stasis_message</a> *<a class="el" href="../../d8/d9e/structmessage.html">message</a>)</td></tr>
<tr class="memdesc:a68833626c247fb273853dbb03fa37596"><td class="mdescLeft">&#160;</td><td class="mdescRight">Generic MWI event callback used for one-off events from voicemail modules.  <a href="#a68833626c247fb273853dbb03fa37596">More...</a><br /></td></tr>
<tr class="separator:a68833626c247fb273853dbb03fa37596"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0dd8c01611e6e0047ed4befb34254fbf"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d4/d00/manager__mwi_8c.html#a0dd8c01611e6e0047ed4befb34254fbf">mwi_update_cb</a> (void *data, struct <a class="el" href="../../d9/de4/structstasis__subscription.html">stasis_subscription</a> *<a class="el" href="../../d1/da4/res__corosync_8c.html#a8e51289dd0fc7415cee40e7a57b49fdf">sub</a>, struct <a class="el" href="../../d7/d55/structstasis__message.html">stasis_message</a> *<a class="el" href="../../d8/d9e/structmessage.html">message</a>)</td></tr>
<tr class="separator:a0dd8c01611e6e0047ed4befb34254fbf"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="var-members"></a>
Variables</h2></td></tr>
<tr class="memitem:a1b448ebd6615ec57a8f94a57f6db73dc"><td class="memItemLeft" align="right" valign="top">struct <a class="el" href="../../d4/d1b/structstasis__message__router.html">stasis_message_router</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d4/d00/manager__mwi_8c.html#a1b448ebd6615ec57a8f94a57f6db73dc">mwi_state_router</a></td></tr>
<tr class="separator:a1b448ebd6615ec57a8f94a57f6db73dc"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aeb9ef797eacc8523239c5136cfb7677e"><td class="memItemLeft" align="right" valign="top">static struct <a class="el" href="../../d8/d54/structstasis__forward.html">stasis_forward</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d4/d00/manager__mwi_8c.html#aeb9ef797eacc8523239c5136cfb7677e">topic_forwarder</a></td></tr>
<tr class="memdesc:aeb9ef797eacc8523239c5136cfb7677e"><td class="mdescLeft">&#160;</td><td class="mdescRight">The <a class="el" href="../../dd/dfd/stasis.html">Stasis Message Bus API</a> subscription returned by the forwarding of the MWI topic to the manager topic.  <a href="#aeb9ef797eacc8523239c5136cfb7677e">More...</a><br /></td></tr>
<tr class="separator:aeb9ef797eacc8523239c5136cfb7677e"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>The Asterisk Management Interface - AMI (MWI event handling) </p>
<dl class="section author"><dt>Author</dt><dd>Matt Jordan <a href="#" onclick="location.href='mai'+'lto:'+'mjo'+'rd'+'an@'+'di'+'giu'+'m.'+'com'; return false;">mjord<span style="display: none;">.nosp@m.</span>an@d<span style="display: none;">.nosp@m.</span>igium<span style="display: none;">.nosp@m.</span>.com</a> </dd></dl>

<p class="definition">Definition in file <a class="el" href="../../d4/d00/manager__mwi_8c_source.html">manager_mwi.c</a>.</p>
</div><h2 class="groupheader">Function Documentation</h2>
<a id="aec9fe0ded4af0ffc4b4220fba8d031d0"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aec9fe0ded4af0ffc4b4220fba8d031d0">&#9670;&nbsp;</a></span>exclude_event_cb()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int exclude_event_cb </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>key</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Callback function used by <a class="el" href="../../d4/d00/manager__mwi_8c.html#a68833626c247fb273853dbb03fa37596">mwi_app_event_cb</a> to weed out "Event" keys. </p>

<p class="definition">Definition at line <a class="el" href="../../d4/d00/manager__mwi_8c_source.html#l00046">46</a> of file <a class="el" href="../../d4/d00/manager__mwi_8c_source.html">manager_mwi.c</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../d4/d00/manager__mwi_8c_source.html#l00055">mwi_app_event_cb()</a>.</p>
<div class="fragment"><div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;{</div><div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;   <span class="keywordflow">if</span> (!strcmp(key, <span class="stringliteral">&quot;Event&quot;</span>)) {</div><div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;   }</div><div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;   <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;}</div></div><!-- fragment -->
</div>
</div>
<a id="a2571c636aafd979f5719051090e5bbff"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2571c636aafd979f5719051090e5bbff">&#9670;&nbsp;</a></span>manager_mwi_init()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int manager_mwi_init </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Initialize support for AMI MWI events. </p>
<dl class="section since"><dt>Since</dt><dd>12 </dd></dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">0</td><td>on success </td></tr>
    <tr><td class="paramname">non-zero</td><td>on error </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="../../d4/d00/manager__mwi_8c_source.html#l00153">153</a> of file <a class="el" href="../../d4/d00/manager__mwi_8c_source.html">manager_mwi.c</a>.</p>

<p class="reference">References <a class="el" href="../../d4/d10/manager_8c_source.html#l01725">ast_manager_get_message_router()</a>, <a class="el" href="../../d4/d10/manager_8c_source.html#l01720">ast_manager_get_topic()</a>, <a class="el" href="../../df/deb/group__StasisTopicsAndMessages.html#gaf226cf2d1a4dbbbf220521d58c05ac0f">ast_mwi_state_type()</a>, <a class="el" href="../../d6/db4/mwi_8c_source.html#l00085">ast_mwi_topic_all()</a>, <a class="el" href="../../df/deb/group__StasisTopicsAndMessages.html#ga03bf52a37253e9ecdc4fadf9747a3497">ast_mwi_vm_app_type()</a>, <a class="el" href="../../da/d4d/clicompat_8c_source.html#l00019">ast_register_cleanup()</a>, <a class="el" href="../../d4/d00/manager__mwi_8c_source.html#l00147">manager_mwi_shutdown()</a>, <a class="el" href="../../d4/d10/manager_8c_source.html#l01490">manager_topic</a>, <a class="el" href="../../d4/d00/manager__mwi_8c_source.html#l00055">mwi_app_event_cb()</a>, <a class="el" href="../../d4/d00/manager__mwi_8c_source.html#l00086">mwi_update_cb()</a>, <a class="el" href="../../dc/d7f/resample_8c_source.html#l00096">NULL</a>, <a class="el" href="../../d0/df4/stasis_8c_source.html#l01578">stasis_forward_all()</a>, and <a class="el" href="../../d2/d78/stasis__message__router_8c_source.html#l00310">stasis_message_router_add()</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../d4/d10/manager_8c_source.html#l09086">subscribe_all()</a>.</p>
<div class="fragment"><div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;{</div><div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;   <span class="keywordtype">int</span> ret = 0;</div><div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d9/d1d/structstasis__topic.html">stasis_topic</a> *<a class="code" href="../../df/d72/group__Group__AMI.html#gadeff73697d2789905f4c3a21671ef6d3">manager_topic</a>;</div><div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d9/d1d/structstasis__topic.html">stasis_topic</a> *mwi_topic;</div><div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d4/d1b/structstasis__message__router.html">stasis_message_router</a> *message_router;</div><div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;</div><div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;   manager_topic = <a class="code" href="../../df/d72/group__Group__AMI.html#ga568aa1aff837fc0001279490a6d9b22f">ast_manager_get_topic</a>();</div><div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;   <span class="keywordflow">if</span> (!manager_topic) {</div><div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;   }</div><div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;   message_router = <a class="code" href="../../df/d72/group__Group__AMI.html#gacfa23131c1c93528074761076ca2bc85">ast_manager_get_message_router</a>();</div><div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;   <span class="keywordflow">if</span> (!message_router) {</div><div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;   }</div><div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;   mwi_topic = <a class="code" href="../../df/deb/group__StasisTopicsAndMessages.html#ga547ae87810e6cd121cea7b3149343366">ast_mwi_topic_all</a>();</div><div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;   <span class="keywordflow">if</span> (!mwi_topic) {</div><div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;   }</div><div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;</div><div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;   <a class="code" href="../../d4/d00/manager__mwi_8c.html#aeb9ef797eacc8523239c5136cfb7677e">topic_forwarder</a> = <a class="code" href="../../dd/d79/stasis_8h.html#a2513a93567ddc93510f7896b777da119">stasis_forward_all</a>(mwi_topic, manager_topic);</div><div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;   <span class="keywordflow">if</span> (!<a class="code" href="../../d4/d00/manager__mwi_8c.html#aeb9ef797eacc8523239c5136cfb7677e">topic_forwarder</a>) {</div><div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;   }</div><div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;</div><div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;   <a class="code" href="../../db/db2/asterisk_8h.html#a412442e1beffe5bec07ed2e9ea72afc3">ast_register_cleanup</a>(<a class="code" href="../../d4/d00/manager__mwi_8c.html#a83d4f212d1e60249baa2c1a4742d425a">manager_mwi_shutdown</a>);</div><div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;</div><div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;   ret |= <a class="code" href="../../d4/d25/stasis__message__router_8h.html#a5adc304e693097ec75b474e6a5309958">stasis_message_router_add</a>(message_router,</div><div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;                <a class="code" href="../../df/deb/group__StasisTopicsAndMessages.html#gaf226cf2d1a4dbbbf220521d58c05ac0f">ast_mwi_state_type</a>(),</div><div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;                <a class="code" href="../../d4/d00/manager__mwi_8c.html#a0dd8c01611e6e0047ed4befb34254fbf">mwi_update_cb</a>,</div><div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;                <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div><div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;</div><div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;   ret |= <a class="code" href="../../d4/d25/stasis__message__router_8h.html#a5adc304e693097ec75b474e6a5309958">stasis_message_router_add</a>(message_router,</div><div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;                <a class="code" href="../../df/deb/group__StasisTopicsAndMessages.html#ga03bf52a37253e9ecdc4fadf9747a3497">ast_mwi_vm_app_type</a>(),</div><div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;                <a class="code" href="../../d4/d00/manager__mwi_8c.html#a68833626c247fb273853dbb03fa37596">mwi_app_event_cb</a>,</div><div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;                <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div><div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;</div><div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;   <span class="comment">/* If somehow we failed to add any routes, just shut down the whole</span></div><div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;<span class="comment">    * thing and fail it.</span></div><div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;<span class="comment">    */</span></div><div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;   <span class="keywordflow">if</span> (ret) {</div><div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;      <a class="code" href="../../d4/d00/manager__mwi_8c.html#a83d4f212d1e60249baa2c1a4742d425a">manager_mwi_shutdown</a>();</div><div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;   }</div><div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;</div><div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;   <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;}</div><div class="ttc" id="stasis__message__router_8h_html_a5adc304e693097ec75b474e6a5309958"><div class="ttname"><a href="../../d4/d25/stasis__message__router_8h.html#a5adc304e693097ec75b474e6a5309958">stasis_message_router_add</a></div><div class="ttdeci">int stasis_message_router_add(struct stasis_message_router *router, struct stasis_message_type *message_type, stasis_subscription_cb callback, void *data)</div><div class="ttdoc">Add a route to a message router. </div><div class="ttdef"><b>Definition:</b> <a href="../../d2/d78/stasis__message__router_8c_source.html#l00310">stasis_message_router.c:310</a></div></div>
<div class="ttc" id="manager__mwi_8c_html_a83d4f212d1e60249baa2c1a4742d425a"><div class="ttname"><a href="../../d4/d00/manager__mwi_8c.html#a83d4f212d1e60249baa2c1a4742d425a">manager_mwi_shutdown</a></div><div class="ttdeci">static void manager_mwi_shutdown(void)</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d00/manager__mwi_8c_source.html#l00147">manager_mwi.c:147</a></div></div>
<div class="ttc" id="structstasis__topic_html"><div class="ttname"><a href="../../d9/d1d/structstasis__topic.html">stasis_topic</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d0/df4/stasis_8c_source.html#l00372">stasis.c:372</a></div></div>
<div class="ttc" id="group__StasisTopicsAndMessages_html_ga547ae87810e6cd121cea7b3149343366"><div class="ttname"><a href="../../df/deb/group__StasisTopicsAndMessages.html#ga547ae87810e6cd121cea7b3149343366">ast_mwi_topic_all</a></div><div class="ttdeci">struct stasis_topic * ast_mwi_topic_all(void)</div><div class="ttdoc">Get the Stasis Message Bus API topic for MWI messages. </div><div class="ttdef"><b>Definition:</b> <a href="../../d6/db4/mwi_8c_source.html#l00085">mwi.c:85</a></div></div>
<div class="ttc" id="resample_8c_html_a070d2ce7b6bb7e5c05602aa8c308d0c4"><div class="ttname"><a href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a></div><div class="ttdeci">#define NULL</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d7f/resample_8c_source.html#l00096">resample.c:96</a></div></div>
<div class="ttc" id="group__Group__AMI_html_gadeff73697d2789905f4c3a21671ef6d3"><div class="ttname"><a href="../../df/d72/group__Group__AMI.html#gadeff73697d2789905f4c3a21671ef6d3">manager_topic</a></div><div class="ttdeci">static struct stasis_topic * manager_topic</div><div class="ttdoc">A stasis_topic that all topics AMI cares about will be forwarded to. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d10/manager_8c_source.html#l01490">manager.c:1490</a></div></div>
<div class="ttc" id="asterisk_8h_html_a412442e1beffe5bec07ed2e9ea72afc3"><div class="ttname"><a href="../../db/db2/asterisk_8h.html#a412442e1beffe5bec07ed2e9ea72afc3">ast_register_cleanup</a></div><div class="ttdeci">int ast_register_cleanup(void(*func)(void))</div><div class="ttdoc">Register a function to be executed before Asterisk gracefully exits. </div><div class="ttdef"><b>Definition:</b> <a href="../../da/d4d/clicompat_8c_source.html#l00019">clicompat.c:19</a></div></div>
<div class="ttc" id="structstasis__message__router_html"><div class="ttname"><a href="../../d4/d1b/structstasis__message__router.html">stasis_message_router</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d2/d78/stasis__message__router_8c_source.html#l00131">stasis_message_router.c:131</a></div></div>
<div class="ttc" id="manager__mwi_8c_html_a68833626c247fb273853dbb03fa37596"><div class="ttname"><a href="../../d4/d00/manager__mwi_8c.html#a68833626c247fb273853dbb03fa37596">mwi_app_event_cb</a></div><div class="ttdeci">static void mwi_app_event_cb(void *data, struct stasis_subscription *sub, struct stasis_message *message)</div><div class="ttdoc">Generic MWI event callback used for one-off events from voicemail modules. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d00/manager__mwi_8c_source.html#l00055">manager_mwi.c:55</a></div></div>
<div class="ttc" id="group__Group__AMI_html_gacfa23131c1c93528074761076ca2bc85"><div class="ttname"><a href="../../df/d72/group__Group__AMI.html#gacfa23131c1c93528074761076ca2bc85">ast_manager_get_message_router</a></div><div class="ttdeci">struct stasis_message_router * ast_manager_get_message_router(void)</div><div class="ttdoc">Get the stasis_message_router for AMI. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d10/manager_8c_source.html#l01725">manager.c:1725</a></div></div>
<div class="ttc" id="group__StasisTopicsAndMessages_html_gaf226cf2d1a4dbbbf220521d58c05ac0f"><div class="ttname"><a href="../../df/deb/group__StasisTopicsAndMessages.html#gaf226cf2d1a4dbbbf220521d58c05ac0f">ast_mwi_state_type</a></div><div class="ttdeci">struct stasis_message_type * ast_mwi_state_type(void)</div><div class="ttdoc">Get the Stasis Message Bus API message type for MWI messages. </div></div>
<div class="ttc" id="manager__mwi_8c_html_aeb9ef797eacc8523239c5136cfb7677e"><div class="ttname"><a href="../../d4/d00/manager__mwi_8c.html#aeb9ef797eacc8523239c5136cfb7677e">topic_forwarder</a></div><div class="ttdeci">static struct stasis_forward * topic_forwarder</div><div class="ttdoc">The Stasis Message Bus API subscription returned by the forwarding of the MWI topic to the manager to...</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d00/manager__mwi_8c_source.html#l00043">manager_mwi.c:43</a></div></div>
<div class="ttc" id="group__Group__AMI_html_ga568aa1aff837fc0001279490a6d9b22f"><div class="ttname"><a href="../../df/d72/group__Group__AMI.html#ga568aa1aff837fc0001279490a6d9b22f">ast_manager_get_topic</a></div><div class="ttdeci">struct stasis_topic * ast_manager_get_topic(void)</div><div class="ttdoc">Get the Stasis Message Bus API topic for AMI. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d10/manager_8c_source.html#l01720">manager.c:1720</a></div></div>
<div class="ttc" id="manager__mwi_8c_html_a0dd8c01611e6e0047ed4befb34254fbf"><div class="ttname"><a href="../../d4/d00/manager__mwi_8c.html#a0dd8c01611e6e0047ed4befb34254fbf">mwi_update_cb</a></div><div class="ttdeci">static void mwi_update_cb(void *data, struct stasis_subscription *sub, struct stasis_message *message)</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d00/manager__mwi_8c_source.html#l00086">manager_mwi.c:86</a></div></div>
<div class="ttc" id="stasis_8h_html_a2513a93567ddc93510f7896b777da119"><div class="ttname"><a href="../../dd/d79/stasis_8h.html#a2513a93567ddc93510f7896b777da119">stasis_forward_all</a></div><div class="ttdeci">struct stasis_forward * stasis_forward_all(struct stasis_topic *from_topic, struct stasis_topic *to_topic)</div><div class="ttdoc">Create a subscription which forwards all messages from one topic to another. </div><div class="ttdef"><b>Definition:</b> <a href="../../d0/df4/stasis_8c_source.html#l01578">stasis.c:1578</a></div></div>
<div class="ttc" id="group__StasisTopicsAndMessages_html_ga03bf52a37253e9ecdc4fadf9747a3497"><div class="ttname"><a href="../../df/deb/group__StasisTopicsAndMessages.html#ga03bf52a37253e9ecdc4fadf9747a3497">ast_mwi_vm_app_type</a></div><div class="ttdeci">struct stasis_message_type * ast_mwi_vm_app_type(void)</div><div class="ttdoc">Get the Stasis Message Bus API message type for voicemail application specific messages. </div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a83d4f212d1e60249baa2c1a4742d425a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a83d4f212d1e60249baa2c1a4742d425a">&#9670;&nbsp;</a></span>manager_mwi_shutdown()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void manager_mwi_shutdown </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="../../d4/d00/manager__mwi_8c_source.html#l00147">147</a> of file <a class="el" href="../../d4/d00/manager__mwi_8c_source.html">manager_mwi.c</a>.</p>

<p class="reference">References <a class="el" href="../../dc/d7f/resample_8c_source.html#l00096">NULL</a>, and <a class="el" href="../../d0/df4/stasis_8c_source.html#l01548">stasis_forward_cancel()</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../d4/d00/manager__mwi_8c_source.html#l00153">manager_mwi_init()</a>.</p>
<div class="fragment"><div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;{</div><div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;   <a class="code" href="../../dd/d79/stasis_8h.html#a5713715b0f26f4943d0af05363b07027">stasis_forward_cancel</a>(<a class="code" href="../../d4/d00/manager__mwi_8c.html#aeb9ef797eacc8523239c5136cfb7677e">topic_forwarder</a>);</div><div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;   <a class="code" href="../../d4/d00/manager__mwi_8c.html#aeb9ef797eacc8523239c5136cfb7677e">topic_forwarder</a> = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;}</div><div class="ttc" id="resample_8c_html_a070d2ce7b6bb7e5c05602aa8c308d0c4"><div class="ttname"><a href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a></div><div class="ttdeci">#define NULL</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d7f/resample_8c_source.html#l00096">resample.c:96</a></div></div>
<div class="ttc" id="stasis_8h_html_a5713715b0f26f4943d0af05363b07027"><div class="ttname"><a href="../../dd/d79/stasis_8h.html#a5713715b0f26f4943d0af05363b07027">stasis_forward_cancel</a></div><div class="ttdeci">struct stasis_forward * stasis_forward_cancel(struct stasis_forward *forward)</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/df4/stasis_8c_source.html#l01548">stasis.c:1548</a></div></div>
<div class="ttc" id="manager__mwi_8c_html_aeb9ef797eacc8523239c5136cfb7677e"><div class="ttname"><a href="../../d4/d00/manager__mwi_8c.html#aeb9ef797eacc8523239c5136cfb7677e">topic_forwarder</a></div><div class="ttdeci">static struct stasis_forward * topic_forwarder</div><div class="ttdoc">The Stasis Message Bus API subscription returned by the forwarding of the MWI topic to the manager to...</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d00/manager__mwi_8c_source.html#l00043">manager_mwi.c:43</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a68833626c247fb273853dbb03fa37596"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a68833626c247fb273853dbb03fa37596">&#9670;&nbsp;</a></span>mwi_app_event_cb()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void mwi_app_event_cb </td>
          <td>(</td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>data</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="../../d9/de4/structstasis__subscription.html">stasis_subscription</a> *&#160;</td>
          <td class="paramname"><em>sub</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="../../d7/d55/structstasis__message.html">stasis_message</a> *&#160;</td>
          <td class="paramname"><em>message</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Generic MWI event callback used for one-off events from voicemail modules. </p>

<p class="definition">Definition at line <a class="el" href="../../d4/d00/manager__mwi_8c_source.html#l00055">55</a> of file <a class="el" href="../../d4/d00/manager__mwi_8c_source.html">manager_mwi.c</a>.</p>

<p class="reference">References <a class="el" href="../../d8/d8a/astmm_8h_source.html#l00182">ast_free</a>, <a class="el" href="../../df/d98/json_8c_source.html#l00397">ast_json_object_get()</a>, <a class="el" href="../../df/d98/json_8c_source.html#l00273">ast_json_string_get()</a>, <a class="el" href="../../da/df7/astobj2_8c_source.html#l00042">ast_log</a>, <a class="el" href="../../d1/d8c/logger_8h_source.html#l00279">AST_LOG_WARNING</a>, <a class="el" href="../../d0/d1c/manager__channels_8c_source.html#l00561">ast_manager_build_channel_state_string()</a>, <a class="el" href="../../d4/d10/manager_8c_source.html#l01821">ast_manager_str_from_json_object()</a>, <a class="el" href="../../d6/d90/strings_8h_source.html#l00714">ast_str_buffer()</a>, <a class="el" href="../../dc/d33/mwi_8h_source.html#l00475">ast_mwi_blob::blob</a>, <a class="el" href="../../db/d45/manager_8h_source.html#l00072">EVENT_FLAG_CALL</a>, <a class="el" href="../../d4/d00/manager__mwi_8c_source.html#l00046">exclude_event_cb()</a>, <a class="el" href="../../db/d45/manager_8h_source.html#l00248">manager_event</a>, <a class="el" href="../../dc/d33/mwi_8h_source.html#l00474">ast_mwi_blob::mwi_state</a>, <a class="el" href="../../dc/d7f/resample_8c_source.html#l00096">NULL</a>, <a class="el" href="../../d5/d60/utils_8h_source.html#l00911">RAII_VAR</a>, <a class="el" href="../../dc/d33/mwi_8h_source.html#l00464">ast_mwi_state::snapshot</a>, <a class="el" href="../../d2/db9/stasis__message_8c_source.html#l00195">stasis_message_data()</a>, and <a class="el" href="../../dc/d33/mwi_8h_source.html#l00460">ast_mwi_state::uniqueid</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../d4/d00/manager__mwi_8c_source.html#l00153">manager_mwi_init()</a>.</p>
<div class="fragment"><div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;{</div><div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../dd/dce/structast__mwi__blob.html">ast_mwi_blob</a> *payload = <a class="code" href="../../dd/d79/stasis_8h.html#af6081f17431b81bc1a010b680517491d">stasis_message_data</a>(message);</div><div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;   <a class="code" href="../../d5/d60/utils_8h.html#a1604b4d72144dd3d9f7da668e90337e9">RAII_VAR</a>(<span class="keyword">struct</span> <a class="code" href="../../dd/da2/structast__str.html">ast_str</a> *, channel_event_string, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../d8/d8a/astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>);</div><div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;   <a class="code" href="../../d5/d60/utils_8h.html#a1604b4d72144dd3d9f7da668e90337e9">RAII_VAR</a>(<span class="keyword">struct</span> <a class="code" href="../../dd/da2/structast__str.html">ast_str</a> *, event_buffer, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../d8/d8a/astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>);</div><div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d1/da1/structast__json.html">ast_json</a> *event_json = <a class="code" href="../../d4/d05/json_8h.html#a53707225c3bf831e263245c6e3800676">ast_json_object_get</a>(payload-&gt;<a class="code" href="../../df/deb/group__StasisTopicsAndMessages.html#gad2b8e22df32b99651f727cd9a8dcb9f3">blob</a>, <span class="stringliteral">&quot;Event&quot;</span>);</div><div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;</div><div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;   <span class="keywordflow">if</span> (!event_json) {</div><div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;      <span class="keywordflow">return</span>;</div><div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;   }</div><div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;</div><div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;   <span class="keywordflow">if</span> (payload-&gt;<a class="code" href="../../df/deb/group__StasisTopicsAndMessages.html#ga6342aa357329880c14a06738ca544ab1">mwi_state</a> &amp;&amp; payload-&gt;<a class="code" href="../../df/deb/group__StasisTopicsAndMessages.html#ga6342aa357329880c14a06738ca544ab1">mwi_state</a>-&gt;<a class="code" href="../../df/deb/group__StasisTopicsAndMessages.html#ga36584c0251e54a7af4892d63f7a28c77">snapshot</a>) {</div><div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;      channel_event_string = <a class="code" href="../../db/d45/manager_8h.html#a777cde87d12b331902f862ec44641688">ast_manager_build_channel_state_string</a>(payload-&gt;<a class="code" href="../../df/deb/group__StasisTopicsAndMessages.html#ga6342aa357329880c14a06738ca544ab1">mwi_state</a>-&gt;<a class="code" href="../../df/deb/group__StasisTopicsAndMessages.html#ga36584c0251e54a7af4892d63f7a28c77">snapshot</a>);</div><div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;   }</div><div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;</div><div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;   event_buffer = <a class="code" href="../../df/d72/group__Group__AMI.html#ga2a7a78b91c9ba54f89c9b5a9e7435027">ast_manager_str_from_json_object</a>(payload-&gt;<a class="code" href="../../df/deb/group__StasisTopicsAndMessages.html#gad2b8e22df32b99651f727cd9a8dcb9f3">blob</a>, <a class="code" href="../../d4/d00/manager__mwi_8c.html#aec9fe0ded4af0ffc4b4220fba8d031d0">exclude_event_cb</a>);</div><div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;   <span class="keywordflow">if</span> (!event_buffer) {</div><div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#a2878d83e36d91850732bad997524e45e">AST_LOG_WARNING</a>, <span class="stringliteral">&quot;Failed to create payload for event %s\n&quot;</span>, <a class="code" href="../../d4/d05/json_8h.html#a6772fcee88746a9d4f6ec6f240b76dd0">ast_json_string_get</a>(event_json));</div><div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;      <span class="keywordflow">return</span>;</div><div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;   }</div><div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;</div><div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;   <a class="code" href="../../db/d45/manager_8h.html#a1ef0ee0044dbbeb4c3a5abc6c046b208">manager_event</a>(<a class="code" href="../../db/d45/manager_8h.html#ab5db3cc603d7e798d61cb4cd94fbb4e2">EVENT_FLAG_CALL</a>, <a class="code" href="../../d4/d05/json_8h.html#a6772fcee88746a9d4f6ec6f240b76dd0">ast_json_string_get</a>(event_json),</div><div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;         <span class="stringliteral">&quot;Mailbox: %s\r\n&quot;</span></div><div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;         <span class="stringliteral">&quot;%s&quot;</span></div><div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;         <span class="stringliteral">&quot;%s&quot;</span>,</div><div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;         payload-&gt;<a class="code" href="../../df/deb/group__StasisTopicsAndMessages.html#ga6342aa357329880c14a06738ca544ab1">mwi_state</a> ? payload-&gt;<a class="code" href="../../df/deb/group__StasisTopicsAndMessages.html#ga6342aa357329880c14a06738ca544ab1">mwi_state</a>-&gt;<a class="code" href="../../df/deb/group__StasisTopicsAndMessages.html#ga753c7b39e3284d771f13f513b003d033">uniqueid</a> : <span class="stringliteral">&quot;Unknown&quot;</span>,</div><div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;         <a class="code" href="../../d6/d90/strings_8h.html#a1ef7e2644ca7258070db316fdc0a465b">ast_str_buffer</a>(event_buffer),</div><div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;         channel_event_string ? <a class="code" href="../../d6/d90/strings_8h.html#a1ef7e2644ca7258070db316fdc0a465b">ast_str_buffer</a>(channel_event_string) : <span class="stringliteral">&quot;&quot;</span>);</div><div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;}</div><div class="ttc" id="manager__mwi_8c_html_aec9fe0ded4af0ffc4b4220fba8d031d0"><div class="ttname"><a href="../../d4/d00/manager__mwi_8c.html#aec9fe0ded4af0ffc4b4220fba8d031d0">exclude_event_cb</a></div><div class="ttdeci">static int exclude_event_cb(const char *key)</div><div class="ttdoc">Callback function used by mwi_app_event_cb to weed out &quot;Event&quot; keys. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d00/manager__mwi_8c_source.html#l00046">manager_mwi.c:46</a></div></div>
<div class="ttc" id="group__StasisTopicsAndMessages_html_ga6342aa357329880c14a06738ca544ab1"><div class="ttname"><a href="../../df/deb/group__StasisTopicsAndMessages.html#ga6342aa357329880c14a06738ca544ab1">ast_mwi_blob::mwi_state</a></div><div class="ttdeci">struct ast_mwi_state * mwi_state</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d33/mwi_8h_source.html#l00474">mwi.h:474</a></div></div>
<div class="ttc" id="strings_8h_html_a1ef7e2644ca7258070db316fdc0a465b"><div class="ttname"><a href="../../d6/d90/strings_8h.html#a1ef7e2644ca7258070db316fdc0a465b">ast_str_buffer</a></div><div class="ttdeci">char * ast_str_buffer(const struct ast_str *buf)</div><div class="ttdoc">Returns the string buffer within the ast_str buf. </div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d90/strings_8h_source.html#l00714">strings.h:714</a></div></div>
<div class="ttc" id="logger_8h_html_a2878d83e36d91850732bad997524e45e"><div class="ttname"><a href="../../d1/d8c/logger_8h.html#a2878d83e36d91850732bad997524e45e">AST_LOG_WARNING</a></div><div class="ttdeci">#define AST_LOG_WARNING</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d8c/logger_8h_source.html#l00279">logger.h:279</a></div></div>
<div class="ttc" id="manager_8h_html_ab5db3cc603d7e798d61cb4cd94fbb4e2"><div class="ttname"><a href="../../db/d45/manager_8h.html#ab5db3cc603d7e798d61cb4cd94fbb4e2">EVENT_FLAG_CALL</a></div><div class="ttdeci">#define EVENT_FLAG_CALL</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d45/manager_8h_source.html#l00072">manager.h:72</a></div></div>
<div class="ttc" id="resample_8c_html_a070d2ce7b6bb7e5c05602aa8c308d0c4"><div class="ttname"><a href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a></div><div class="ttdeci">#define NULL</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d7f/resample_8c_source.html#l00096">resample.c:96</a></div></div>
<div class="ttc" id="group__StasisTopicsAndMessages_html_gad2b8e22df32b99651f727cd9a8dcb9f3"><div class="ttname"><a href="../../df/deb/group__StasisTopicsAndMessages.html#gad2b8e22df32b99651f727cd9a8dcb9f3">ast_mwi_blob::blob</a></div><div class="ttdeci">struct ast_json * blob</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d33/mwi_8h_source.html#l00475">mwi.h:475</a></div></div>
<div class="ttc" id="group__Group__AMI_html_ga2a7a78b91c9ba54f89c9b5a9e7435027"><div class="ttname"><a href="../../df/d72/group__Group__AMI.html#ga2a7a78b91c9ba54f89c9b5a9e7435027">ast_manager_str_from_json_object</a></div><div class="ttdeci">struct ast_str * ast_manager_str_from_json_object(struct ast_json *blob, key_exclusion_cb exclusion_cb)</div><div class="ttdoc">Convert a JSON object into an AMI compatible string. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d10/manager_8c_source.html#l01821">manager.c:1821</a></div></div>
<div class="ttc" id="astobj2_8c_html_a96a00b3a518d7f32b6d51dc28f09bf9b"><div class="ttname"><a href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a></div><div class="ttdeci">#define ast_log</div><div class="ttdef"><b>Definition:</b> <a href="../../da/df7/astobj2_8c_source.html#l00042">astobj2.c:42</a></div></div>
<div class="ttc" id="utils_8h_html_a1604b4d72144dd3d9f7da668e90337e9"><div class="ttname"><a href="../../d5/d60/utils_8h.html#a1604b4d72144dd3d9f7da668e90337e9">RAII_VAR</a></div><div class="ttdeci">#define RAII_VAR(vartype, varname, initval, dtor)</div><div class="ttdoc">Declare a variable that will call a destructor function when it goes out of scope. </div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d60/utils_8h_source.html#l00911">utils.h:911</a></div></div>
<div class="ttc" id="json_8h_html_a6772fcee88746a9d4f6ec6f240b76dd0"><div class="ttname"><a href="../../d4/d05/json_8h.html#a6772fcee88746a9d4f6ec6f240b76dd0">ast_json_string_get</a></div><div class="ttdeci">const char * ast_json_string_get(const struct ast_json *string)</div><div class="ttdoc">Get the value of a JSON string. </div><div class="ttdef"><b>Definition:</b> <a href="../../df/d98/json_8c_source.html#l00273">json.c:273</a></div></div>
<div class="ttc" id="manager_8h_html_a777cde87d12b331902f862ec44641688"><div class="ttname"><a href="../../db/d45/manager_8h.html#a777cde87d12b331902f862ec44641688">ast_manager_build_channel_state_string</a></div><div class="ttdeci">struct ast_str * ast_manager_build_channel_state_string(const struct ast_channel_snapshot *snapshot)</div><div class="ttdoc">Generate the AMI message body from a channel snapshot. </div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d1c/manager__channels_8c_source.html#l00561">manager_channels.c:561</a></div></div>
<div class="ttc" id="structast__str_html"><div class="ttname"><a href="../../dd/da2/structast__str.html">ast_str</a></div><div class="ttdoc">The descriptor of a dynamic string XXX storage will be optimized later if needed We use the ts field ...</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d90/strings_8h_source.html#l00584">strings.h:584</a></div></div>
<div class="ttc" id="stasis_8h_html_af6081f17431b81bc1a010b680517491d"><div class="ttname"><a href="../../dd/d79/stasis_8h.html#af6081f17431b81bc1a010b680517491d">stasis_message_data</a></div><div class="ttdeci">void * stasis_message_data(const struct stasis_message *msg)</div><div class="ttdoc">Get the data contained in a message. </div><div class="ttdef"><b>Definition:</b> <a href="../../d2/db9/stasis__message_8c_source.html#l00195">stasis_message.c:195</a></div></div>
<div class="ttc" id="astmm_8h_html_a402072d6789f6ed9e3a81da27504127e"><div class="ttname"><a href="../../d8/d8a/astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a></div><div class="ttdeci">#define ast_free(a)</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d8a/astmm_8h_source.html#l00182">astmm.h:182</a></div></div>
<div class="ttc" id="group__StasisTopicsAndMessages_html_ga36584c0251e54a7af4892d63f7a28c77"><div class="ttname"><a href="../../df/deb/group__StasisTopicsAndMessages.html#ga36584c0251e54a7af4892d63f7a28c77">ast_mwi_state::snapshot</a></div><div class="ttdeci">struct ast_channel_snapshot * snapshot</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d33/mwi_8h_source.html#l00464">mwi.h:464</a></div></div>
<div class="ttc" id="structast__mwi__blob_html"><div class="ttname"><a href="../../dd/dce/structast__mwi__blob.html">ast_mwi_blob</a></div><div class="ttdoc">Object that represents an MWI update with some additional application defined data. </div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d33/mwi_8h_source.html#l00473">mwi.h:473</a></div></div>
<div class="ttc" id="json_8h_html_a53707225c3bf831e263245c6e3800676"><div class="ttname"><a href="../../d4/d05/json_8h.html#a53707225c3bf831e263245c6e3800676">ast_json_object_get</a></div><div class="ttdeci">struct ast_json * ast_json_object_get(struct ast_json *object, const char *key)</div><div class="ttdoc">Get a field from a JSON object. </div><div class="ttdef"><b>Definition:</b> <a href="../../df/d98/json_8c_source.html#l00397">json.c:397</a></div></div>
<div class="ttc" id="group__StasisTopicsAndMessages_html_ga753c7b39e3284d771f13f513b003d033"><div class="ttname"><a href="../../df/deb/group__StasisTopicsAndMessages.html#ga753c7b39e3284d771f13f513b003d033">ast_mwi_state::uniqueid</a></div><div class="ttdeci">const ast_string_field uniqueid</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d33/mwi_8h_source.html#l00460">mwi.h:460</a></div></div>
<div class="ttc" id="structast__json_html"><div class="ttname"><a href="../../d1/da1/structast__json.html">ast_json</a></div><div class="ttdoc">Abstract JSON element (object, array, string, int, ...). </div></div>
<div class="ttc" id="manager_8h_html_a1ef0ee0044dbbeb4c3a5abc6c046b208"><div class="ttname"><a href="../../db/d45/manager_8h.html#a1ef0ee0044dbbeb4c3a5abc6c046b208">manager_event</a></div><div class="ttdeci">#define manager_event(category, event, contents,...)</div><div class="ttdoc">External routines may send asterisk manager events this way. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/d45/manager_8h_source.html#l00248">manager.h:248</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a0dd8c01611e6e0047ed4befb34254fbf"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0dd8c01611e6e0047ed4befb34254fbf">&#9670;&nbsp;</a></span>mwi_update_cb()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void mwi_update_cb </td>
          <td>(</td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>data</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="../../d9/de4/structstasis__subscription.html">stasis_subscription</a> *&#160;</td>
          <td class="paramname"><em>sub</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="../../d7/d55/structstasis__message.html">stasis_message</a> *&#160;</td>
          <td class="paramname"><em>message</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="../../d4/d00/manager__mwi_8c_source.html#l00086">86</a> of file <a class="el" href="../../d4/d00/manager__mwi_8c_source.html">manager_mwi.c</a>.</p>

<p class="reference">References <a class="el" href="../../d6/d90/strings_8h_source.html#l00049">AS_OR</a>, <a class="el" href="../../d3/d83/main_2app_8c_source.html#l00655">ast_app_has_voicemail()</a>, <a class="el" href="../../d8/d8a/astmm_8h_source.html#l00182">ast_free</a>, <a class="el" href="../../d0/d1c/manager__channels_8c_source.html#l00561">ast_manager_build_channel_state_string()</a>, <a class="el" href="../../df/deb/group__StasisTopicsAndMessages.html#gaf226cf2d1a4dbbbf220521d58c05ac0f">ast_mwi_state_type()</a>, <a class="el" href="../../db/d45/manager_8h_source.html#l00072">EVENT_FLAG_CALL</a>, <a class="el" href="../../db/d45/manager_8h_source.html#l00248">manager_event</a>, <a class="el" href="../../dc/d33/mwi_8h_source.html#l00461">ast_mwi_state::new_msgs</a>, <a class="el" href="../../dc/d7f/resample_8c_source.html#l00096">NULL</a>, <a class="el" href="../../dc/d33/mwi_8h_source.html#l00462">ast_mwi_state::old_msgs</a>, <a class="el" href="../../d5/d60/utils_8h_source.html#l00911">RAII_VAR</a>, <a class="el" href="../../dc/d33/mwi_8h_source.html#l00464">ast_mwi_state::snapshot</a>, <a class="el" href="../../d2/db9/stasis__message_8c_source.html#l00195">stasis_message_data()</a>, <a class="el" href="../../d2/db9/stasis__message_8c_source.html#l00187">stasis_message_type()</a>, and <a class="el" href="../../dc/d33/mwi_8h_source.html#l00460">ast_mwi_state::uniqueid</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../d4/d00/manager__mwi_8c_source.html#l00153">manager_mwi_init()</a>.</p>
<div class="fragment"><div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;{</div><div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d6/d45/structast__mwi__state.html">ast_mwi_state</a> *mwi_state;</div><div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;   <a class="code" href="../../d5/d60/utils_8h.html#a1604b4d72144dd3d9f7da668e90337e9">RAII_VAR</a>(<span class="keyword">struct</span> <a class="code" href="../../dd/da2/structast__str.html">ast_str</a> *, channel_event_string, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../d8/d8a/astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>);</div><div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;</div><div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../df/deb/group__StasisTopicsAndMessages.html#gaf226cf2d1a4dbbbf220521d58c05ac0f">ast_mwi_state_type</a>() != <a class="code" href="../../dd/d79/stasis_8h.html#a9356e8a29344ca4eac93088198ccff89">stasis_message_type</a>(message)) {</div><div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;      <span class="keywordflow">return</span>;</div><div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;   }</div><div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;</div><div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;   mwi_state = <a class="code" href="../../dd/d79/stasis_8h.html#af6081f17431b81bc1a010b680517491d">stasis_message_data</a>(message);</div><div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;   <span class="keywordflow">if</span> (!mwi_state) {</div><div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;      <span class="keywordflow">return</span>;</div><div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;   }</div><div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;</div><div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;   <span class="keywordflow">if</span> (mwi_state-&gt;<a class="code" href="../../df/deb/group__StasisTopicsAndMessages.html#ga36584c0251e54a7af4892d63f7a28c77">snapshot</a>) {</div><div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;      channel_event_string = <a class="code" href="../../db/d45/manager_8h.html#a777cde87d12b331902f862ec44641688">ast_manager_build_channel_state_string</a>(mwi_state-&gt;<a class="code" href="../../df/deb/group__StasisTopicsAndMessages.html#ga36584c0251e54a7af4892d63f7a28c77">snapshot</a>);</div><div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;   }</div><div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;</div><div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;   <span class="comment">/*** DOCUMENTATION</span></div><div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;<span class="comment">      &lt;managerEventInstance&gt;</span></div><div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;<span class="comment">         &lt;synopsis&gt;Raised when the state of messages in a voicemail mailbox</span></div><div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;<span class="comment">         has changed or when a channel has finished interacting with a</span></div><div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;<span class="comment">         mailbox.&lt;/synopsis&gt;</span></div><div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;<span class="comment">         &lt;syntax&gt;</span></div><div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;<span class="comment">            &lt;channel_snapshot/&gt;</span></div><div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;<span class="comment">            &lt;parameter name=&quot;Mailbox&quot;&gt;</span></div><div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;<span class="comment">               &lt;para&gt;The mailbox with the new message, specified as &lt;literal&gt;mailbox&lt;/literal&gt;@&lt;literal&gt;context&lt;/literal&gt;&lt;/para&gt;</span></div><div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;<span class="comment">            &lt;/parameter&gt;</span></div><div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;<span class="comment">            &lt;parameter name=&quot;Waiting&quot;&gt;</span></div><div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;<span class="comment">               &lt;para&gt;Whether or not the mailbox has messages waiting for it.&lt;/para&gt;</span></div><div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;<span class="comment">            &lt;/parameter&gt;</span></div><div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;<span class="comment">            &lt;parameter name=&quot;New&quot;&gt;</span></div><div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;<span class="comment">               &lt;para&gt;The number of new messages.&lt;/para&gt;</span></div><div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;<span class="comment">            &lt;/parameter&gt;</span></div><div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;<span class="comment">            &lt;parameter name=&quot;Old&quot;&gt;</span></div><div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;<span class="comment">               &lt;para&gt;The number of old messages.&lt;/para&gt;</span></div><div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;<span class="comment">            &lt;/parameter&gt;</span></div><div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;<span class="comment">         &lt;/syntax&gt;</span></div><div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;<span class="comment">         &lt;description&gt;</span></div><div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;<span class="comment">            &lt;note&gt;&lt;para&gt;The Channel related parameters are only present if a</span></div><div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;<span class="comment">            channel was involved in the manipulation of a mailbox. If no</span></div><div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;<span class="comment">            channel is involved, the parameters are not included with the</span></div><div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;<span class="comment">            event.&lt;/para&gt;</span></div><div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;<span class="comment">            &lt;/note&gt;</span></div><div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;<span class="comment">         &lt;/description&gt;</span></div><div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;<span class="comment">      &lt;/managerEventInstance&gt;</span></div><div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;<span class="comment">   ***/</span></div><div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;   <a class="code" href="../../db/d45/manager_8h.html#a1ef0ee0044dbbeb4c3a5abc6c046b208">manager_event</a>(<a class="code" href="../../db/d45/manager_8h.html#ab5db3cc603d7e798d61cb4cd94fbb4e2">EVENT_FLAG_CALL</a>, <span class="stringliteral">&quot;MessageWaiting&quot;</span>,</div><div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;         <span class="stringliteral">&quot;%s&quot;</span></div><div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;         <span class="stringliteral">&quot;Mailbox: %s\r\n&quot;</span></div><div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;         <span class="stringliteral">&quot;Waiting: %d\r\n&quot;</span></div><div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;         <span class="stringliteral">&quot;New: %d\r\n&quot;</span></div><div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;         <span class="stringliteral">&quot;Old: %d\r\n&quot;</span>,</div><div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;         <a class="code" href="../../d6/d90/strings_8h.html#aec1b0a2c5fdd41672184aecbb7ee4e3c">AS_OR</a>(channel_event_string, <span class="stringliteral">&quot;&quot;</span>),</div><div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;         mwi_state-&gt;<a class="code" href="../../df/deb/group__StasisTopicsAndMessages.html#ga753c7b39e3284d771f13f513b003d033">uniqueid</a>,</div><div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;         <a class="code" href="../../d3/d93/include_2asterisk_2app_8h.html#a76b4d3927cacd1bcd5da9ca8fe375cb6">ast_app_has_voicemail</a>(mwi_state-&gt;<a class="code" href="../../df/deb/group__StasisTopicsAndMessages.html#ga753c7b39e3284d771f13f513b003d033">uniqueid</a>, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>),</div><div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;         mwi_state-&gt;<a class="code" href="../../df/deb/group__StasisTopicsAndMessages.html#ga70de9f16a229e2c5bf1a973372949d3e">new_msgs</a>,</div><div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;         mwi_state-&gt;<a class="code" href="../../df/deb/group__StasisTopicsAndMessages.html#ga4369ae7c984aba22ce6d0e92718f2b29">old_msgs</a>);</div><div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;}</div><div class="ttc" id="manager_8h_html_ab5db3cc603d7e798d61cb4cd94fbb4e2"><div class="ttname"><a href="../../db/d45/manager_8h.html#ab5db3cc603d7e798d61cb4cd94fbb4e2">EVENT_FLAG_CALL</a></div><div class="ttdeci">#define EVENT_FLAG_CALL</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d45/manager_8h_source.html#l00072">manager.h:72</a></div></div>
<div class="ttc" id="stasis_8h_html_a9356e8a29344ca4eac93088198ccff89"><div class="ttname"><a href="../../dd/d79/stasis_8h.html#a9356e8a29344ca4eac93088198ccff89">stasis_message_type</a></div><div class="ttdeci">struct stasis_message_type * stasis_message_type(const struct stasis_message *msg)</div><div class="ttdoc">Get the message type for a stasis_message. </div><div class="ttdef"><b>Definition:</b> <a href="../../d2/db9/stasis__message_8c_source.html#l00187">stasis_message.c:187</a></div></div>
<div class="ttc" id="resample_8c_html_a070d2ce7b6bb7e5c05602aa8c308d0c4"><div class="ttname"><a href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a></div><div class="ttdeci">#define NULL</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d7f/resample_8c_source.html#l00096">resample.c:96</a></div></div>
<div class="ttc" id="utils_8h_html_a1604b4d72144dd3d9f7da668e90337e9"><div class="ttname"><a href="../../d5/d60/utils_8h.html#a1604b4d72144dd3d9f7da668e90337e9">RAII_VAR</a></div><div class="ttdeci">#define RAII_VAR(vartype, varname, initval, dtor)</div><div class="ttdoc">Declare a variable that will call a destructor function when it goes out of scope. </div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d60/utils_8h_source.html#l00911">utils.h:911</a></div></div>
<div class="ttc" id="group__StasisTopicsAndMessages_html_ga4369ae7c984aba22ce6d0e92718f2b29"><div class="ttname"><a href="../../df/deb/group__StasisTopicsAndMessages.html#ga4369ae7c984aba22ce6d0e92718f2b29">ast_mwi_state::old_msgs</a></div><div class="ttdeci">int old_msgs</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d33/mwi_8h_source.html#l00462">mwi.h:462</a></div></div>
<div class="ttc" id="manager_8h_html_a777cde87d12b331902f862ec44641688"><div class="ttname"><a href="../../db/d45/manager_8h.html#a777cde87d12b331902f862ec44641688">ast_manager_build_channel_state_string</a></div><div class="ttdeci">struct ast_str * ast_manager_build_channel_state_string(const struct ast_channel_snapshot *snapshot)</div><div class="ttdoc">Generate the AMI message body from a channel snapshot. </div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d1c/manager__channels_8c_source.html#l00561">manager_channels.c:561</a></div></div>
<div class="ttc" id="structast__str_html"><div class="ttname"><a href="../../dd/da2/structast__str.html">ast_str</a></div><div class="ttdoc">The descriptor of a dynamic string XXX storage will be optimized later if needed We use the ts field ...</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d90/strings_8h_source.html#l00584">strings.h:584</a></div></div>
<div class="ttc" id="stasis_8h_html_af6081f17431b81bc1a010b680517491d"><div class="ttname"><a href="../../dd/d79/stasis_8h.html#af6081f17431b81bc1a010b680517491d">stasis_message_data</a></div><div class="ttdeci">void * stasis_message_data(const struct stasis_message *msg)</div><div class="ttdoc">Get the data contained in a message. </div><div class="ttdef"><b>Definition:</b> <a href="../../d2/db9/stasis__message_8c_source.html#l00195">stasis_message.c:195</a></div></div>
<div class="ttc" id="astmm_8h_html_a402072d6789f6ed9e3a81da27504127e"><div class="ttname"><a href="../../d8/d8a/astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a></div><div class="ttdeci">#define ast_free(a)</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d8a/astmm_8h_source.html#l00182">astmm.h:182</a></div></div>
<div class="ttc" id="group__StasisTopicsAndMessages_html_ga36584c0251e54a7af4892d63f7a28c77"><div class="ttname"><a href="../../df/deb/group__StasisTopicsAndMessages.html#ga36584c0251e54a7af4892d63f7a28c77">ast_mwi_state::snapshot</a></div><div class="ttdeci">struct ast_channel_snapshot * snapshot</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d33/mwi_8h_source.html#l00464">mwi.h:464</a></div></div>
<div class="ttc" id="group__StasisTopicsAndMessages_html_gaf226cf2d1a4dbbbf220521d58c05ac0f"><div class="ttname"><a href="../../df/deb/group__StasisTopicsAndMessages.html#gaf226cf2d1a4dbbbf220521d58c05ac0f">ast_mwi_state_type</a></div><div class="ttdeci">struct stasis_message_type * ast_mwi_state_type(void)</div><div class="ttdoc">Get the Stasis Message Bus API message type for MWI messages. </div></div>
<div class="ttc" id="include_2asterisk_2app_8h_html_a76b4d3927cacd1bcd5da9ca8fe375cb6"><div class="ttname"><a href="../../d3/d93/include_2asterisk_2app_8h.html#a76b4d3927cacd1bcd5da9ca8fe375cb6">ast_app_has_voicemail</a></div><div class="ttdeci">int ast_app_has_voicemail(const char *mailboxes, const char *folder)</div><div class="ttdoc">Determine if a given mailbox has any voicemail If folder is NULL, defaults to &quot;INBOX&quot;. If folder is &quot;INBOX&quot;, includes the number of messages in the &quot;Urgent&quot; folder. </div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d83/main_2app_8c_source.html#l00655">main/app.c:655</a></div></div>
<div class="ttc" id="strings_8h_html_aec1b0a2c5fdd41672184aecbb7ee4e3c"><div class="ttname"><a href="../../d6/d90/strings_8h.html#aec1b0a2c5fdd41672184aecbb7ee4e3c">AS_OR</a></div><div class="ttdeci">#define AS_OR(a, b)</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d90/strings_8h_source.html#l00049">strings.h:49</a></div></div>
<div class="ttc" id="group__StasisTopicsAndMessages_html_ga70de9f16a229e2c5bf1a973372949d3e"><div class="ttname"><a href="../../df/deb/group__StasisTopicsAndMessages.html#ga70de9f16a229e2c5bf1a973372949d3e">ast_mwi_state::new_msgs</a></div><div class="ttdeci">int new_msgs</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d33/mwi_8h_source.html#l00461">mwi.h:461</a></div></div>
<div class="ttc" id="group__StasisTopicsAndMessages_html_ga753c7b39e3284d771f13f513b003d033"><div class="ttname"><a href="../../df/deb/group__StasisTopicsAndMessages.html#ga753c7b39e3284d771f13f513b003d033">ast_mwi_state::uniqueid</a></div><div class="ttdeci">const ast_string_field uniqueid</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d33/mwi_8h_source.html#l00460">mwi.h:460</a></div></div>
<div class="ttc" id="structast__mwi__state_html"><div class="ttname"><a href="../../d6/d45/structast__mwi__state.html">ast_mwi_state</a></div><div class="ttdoc">The structure that contains MWI state. </div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d33/mwi_8h_source.html#l00457">mwi.h:457</a></div></div>
<div class="ttc" id="manager_8h_html_a1ef0ee0044dbbeb4c3a5abc6c046b208"><div class="ttname"><a href="../../db/d45/manager_8h.html#a1ef0ee0044dbbeb4c3a5abc6c046b208">manager_event</a></div><div class="ttdeci">#define manager_event(category, event, contents,...)</div><div class="ttdoc">External routines may send asterisk manager events this way. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/d45/manager_8h_source.html#l00248">manager.h:248</a></div></div>
</div><!-- fragment -->
</div>
</div>
<h2 class="groupheader">Variable Documentation</h2>
<a id="a1b448ebd6615ec57a8f94a57f6db73dc"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1b448ebd6615ec57a8f94a57f6db73dc">&#9670;&nbsp;</a></span>mwi_state_router</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="../../d4/d1b/structstasis__message__router.html">stasis_message_router</a>* mwi_state_router</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="../../d4/d00/manager__mwi_8c_source.html#l00035">35</a> of file <a class="el" href="../../d4/d00/manager__mwi_8c_source.html">manager_mwi.c</a>.</p>

</div>
</div>
<a id="aeb9ef797eacc8523239c5136cfb7677e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aeb9ef797eacc8523239c5136cfb7677e">&#9670;&nbsp;</a></span>topic_forwarder</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="../../d8/d54/structstasis__forward.html">stasis_forward</a>* topic_forwarder</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>The <a class="el" href="../../dd/dfd/stasis.html">Stasis Message Bus API</a> subscription returned by the forwarding of the MWI topic to the manager topic. </p>

<p class="definition">Definition at line <a class="el" href="../../d4/d00/manager__mwi_8c_source.html#l00043">43</a> of file <a class="el" href="../../d4/d00/manager__mwi_8c_source.html">manager_mwi.c</a>.</p>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Sun Aug 8 2021 19:46:07 for Asterisk - The Open Source Telephony Project by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="../../doxygen.png" alt="doxygen"/>
</a> 1.8.13
</small></address>
</body>
</html>
