<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Asterisk - The Open Source Telephony Project: tcptls.h File Reference</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Asterisk - The Open Source Telephony Project
   &#160;<span id="projectnumber">18.5.0</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "../../search",false,'Search');
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('../../',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="../../dir_d44c64559bbebec7f509842c48db8b23.html">include</a></li><li class="navelem"><a class="el" href="../../dir_6d4b1cdb59e2db6ad82005b337288fef.html">asterisk</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#nested-classes">Data Structures</a> &#124;
<a href="#define-members">Macros</a> &#124;
<a href="#enum-members">Enumerations</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">tcptls.h File Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>Generic support for tcp/tls servers in Asterisk.  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &lt;pthread.h&gt;</code><br />
<code>#include &lt;sys/param.h&gt;</code><br />
<code>#include &quot;<a class="el" href="../../dd/d27/iostream_8h_source.html">asterisk/iostream.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="../../db/df1/netsock2_8h_source.html">asterisk/netsock2.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="../../d5/d60/utils_8h_source.html">asterisk/utils.h</a>&quot;</code><br />
</div><div class="textblock"><div class="dynheader">
Include dependency graph for tcptls.h:</div>
<div class="dyncontent">
<div class="center"><img src="../../d4/d13/tcptls_8h__incl.png" border="0" usemap="#tcptls_8h" alt=""/></div>
<map name="tcptls_8h" id="tcptls_8h">
<area shape="rect" id="node4" href="../../dd/d27/iostream_8h.html" title="Generic abstraction for input/output streams. " alt="" coords="155,80,300,107"/>
<area shape="rect" id="node14" href="../../db/df1/netsock2_8h.html" title="Network socket handling. " alt="" coords="1529,155,1675,181"/>
<area shape="rect" id="node19" href="../../d5/d60/utils_8h.html" title="Utility functions. " alt="" coords="983,80,1098,107"/>
<area shape="rect" id="node5" href="../../db/db2/asterisk_8h.html" title="Asterisk main include file. File version handling, generic pbx functions. " alt="" coords="189,229,273,256"/>
<area shape="rect" id="node6" href="../../d8/d20/autoconfig_8h.html" title="asterisk/autoconfig.h" alt="" coords="163,528,318,555"/>
<area shape="rect" id="node7" href="../../de/da3/include_2asterisk_2compat_8h.html" title="General Definitions for Asterisk top level program Included by asterisk.h to handle platform&#45;specific..." alt="" coords="885,304,1023,331"/>
<area shape="rect" id="node13" href="../../d8/d8a/astmm_8h.html" title="Asterisk memory management routines. " alt="" coords="165,304,300,331"/>
<area shape="rect" id="node8" href="../../d4/dd1/compiler_8h.html" title="Compiler&#45;specific macros and other items. " alt="" coords="859,379,1001,405"/>
<area shape="rect" id="node17" href="../../d1/d8c/logger_8h.html" title="Support for logging to various files, console and syslog Configuration in file logger.conf. " alt="" coords="1419,379,1545,405"/>
<area shape="rect" id="node18" href="../../d7/d5b/options_8h.html" title="Options provided by main asterisk program. " alt="" coords="1348,453,1483,480"/>
<area shape="rect" id="node20" href="../../d9/d94/network_8h.html" title="Wrapper for network related headers, masking differences between various operating systems..." alt="" coords="1947,155,2086,181"/>
<area shape="rect" id="node28" href="../../de/df7/time_8h.html" title="Time&#45;related functions and macros. " alt="" coords="291,379,353,405"/>
<area shape="rect" id="node31" href="../../dd/d42/lock_8h.html" title="Asterisk locking&#45;related definitions: " alt="" coords="657,304,771,331"/>
<area shape="rect" id="node34" href="../../d5/deb/localtime_8h.html" title="Custom localtime functions for multiple timezones. " alt="" coords="514,155,661,181"/>
<area shape="rect" id="node36" href="../../d1/d0f/stringfields_8h.html" title="asterisk/stringfields.h" alt="" coords="905,155,1062,181"/>
<area shape="rect" id="node38" href="../../d6/d90/strings_8h.html" title="String manipulation functions. " alt="" coords="1137,155,1267,181"/>
<area shape="rect" id="node30" href="../../d5/d9d/inline__api_8h.html" title="Inlinable API function macro. " alt="" coords="1110,453,1257,480"/>
<area shape="rect" id="node33" href="../../d3/dda/backtrace_8h.html" title="Asterisk backtrace generation. " alt="" coords="540,379,691,405"/>
<area shape="rect" id="node37" href="../../d6/d68/vector_8h.html" title="Vector container support. " alt="" coords="736,229,863,256"/>
<area shape="rect" id="node40" href="../../dc/d7d/threadstorage_8h.html" title="Definitions to aid in the use of thread local storage. " alt="" coords="1342,229,1521,256"/>
<area shape="rect" id="node41" href="../../d5/da5/astobj2_8h.html" title="asterisk/astobj2.h" alt="" coords="887,229,1021,256"/>
</map>
</div>
</div><div class="textblock"><div class="dynheader">
This graph shows which files directly or indirectly include this file:</div>
<div class="dyncontent">
<div class="center"><img src="../../d2/d55/tcptls_8h__dep__incl.png" border="0" usemap="#tcptls_8hdep" alt=""/></div>
<map name="tcptls_8hdep" id="tcptls_8hdep">
<area shape="rect" id="node2" href="../../de/d26/app__externalivr_8c.html" title="External IVR application interface. " alt="" coords="497,80,627,107"/>
<area shape="rect" id="node3" href="../../d1/d94/sip_8h.html" title="chan_sip header file " alt="" coords="652,80,704,107"/>
<area shape="rect" id="node15" href="../../dd/d56/http_8h.html" title="Support for Private Asterisk HTTP Servers. " alt="" coords="3560,80,3620,107"/>
<area shape="rect" id="node39" href="../../dd/d43/http_8c.html" title="http server for AMI access " alt="" coords="2438,155,2497,181"/>
<area shape="rect" id="node40" href="../../d4/d10/manager_8c.html" title="The Asterisk Management Interface &#45; AMI. " alt="" coords="4150,155,4241,181"/>
<area shape="rect" id="node43" href="../../d6/dc9/res__http__post_8c.html" title="HTTP POST upload support for Asterisk HTTP server. " alt="" coords="4265,155,4387,181"/>
<area shape="rect" id="node47" href="../../dc/d9b/tcptls_8c.html" title="Code to support TCP and TLS server/client. " alt="" coords="3747,80,3815,107"/>
<area shape="rect" id="node4" href="../../d5/dfe/chan__sip_8c.html" title="Implementation of Session Initiation Protocol. " alt="" coords="603,237,692,263"/>
<area shape="rect" id="node5" href="../../d5/d87/globals_8h.html" title="sip global declaration header file " alt="" coords="465,155,544,181"/>
<area shape="rect" id="node6" href="../../d8/d06/sip_2dialplan__functions_8c.html" title="sip channel dialplan functions and unit tests " alt="" coords="362,237,509,263"/>
<area shape="rect" id="node7" href="../../d1/d2b/config__parser_8h.html" title="sip.conf parser header file " alt="" coords="716,155,835,181"/>
<area shape="rect" id="node8" href="../../d8/d9c/config__parser_8c.html" title="sip config parsing functions and unit tests " alt="" coords="716,237,835,263"/>
<area shape="rect" id="node9" href="../../d1/dc9/dialog_8h.html" title="sip dialog management header file " alt="" coords="569,155,641,181"/>
<area shape="rect" id="node10" href="../../d4/dd3/sip_2include_2dialplan__functions_8h.html" title="SIP dialplan functions header file. " alt="" coords="293,155,441,181"/>
<area shape="rect" id="node11" href="../../d2/d1d/channels_2sip_2include_2security__events_8h.html" title="Generate security events in the SIP channel. " alt="" coords="859,155,993,181"/>
<area shape="rect" id="node12" href="../../d4/dea/channels_2sip_2security__events_8c.html" title="Generate security events in the SIP channel. " alt="" coords="859,237,993,263"/>
<area shape="rect" id="node13" href="../../d5/d85/reqresp__parser_8c.html" title="sip request parsing functions and unit tests " alt="" coords="5,155,135,181"/>
<area shape="rect" id="node14" href="../../d1/dba/channels_2sip_2utils_8c.html" title="Utility functions for chan_sip. " alt="" coords="159,155,218,181"/>
<area shape="rect" id="node16" href="../../d0/d0c/http__websocket_8h.html" title="Support for WebSocket connections within the Asterisk HTTP server and client WebSocket connections to..." alt="" coords="3417,155,3552,181"/>
<area shape="rect" id="node21" href="../../de/d4c/res__http__websocket_8c.html" title="WebSocket support for the Asterisk internal HTTP server. " alt="" coords="4174,237,4334,263"/>
<area shape="rect" id="node25" href="../../d4/d59/ari_8h.html" title="Asterisk RESTful API hooks. " alt="" coords="2521,155,2571,181"/>
<area shape="rect" id="node41" href="../../db/dde/internal_8h.html" title="Internal API&#39;s for res_ari. " alt="" coords="3310,155,3393,181"/>
<area shape="rect" id="node44" href="../../d9/de9/res__phoneprov_8c.html" title="Phone provisioning application for the asterisk internal http server. " alt="" coords="3628,155,3755,181"/>
<area shape="rect" id="node45" href="../../d7/d1b/res__prometheus_8c.html" title="Core Prometheus metrics API. " alt="" coords="3779,155,3918,181"/>
<area shape="rect" id="node46" href="../../d4/d45/test__http__media__cache_8c.html" title="Tests for the HTTP media cache backend. " alt="" coords="3943,155,4125,181"/>
<area shape="rect" id="node17" href="../../d8/d44/ari__websockets_8c.html" title="WebSocket support for RESTful API&#39;s. " alt="" coords="3294,237,3425,263"/>
<area shape="rect" id="node18" href="../../dc/dec/res_2ari_2config_8c.html" title="Config framework stuffz for ARI. " alt="" coords="3449,237,3520,263"/>
<area shape="rect" id="node19" href="../../dd/df4/resource__events_8c.html" title="/api&#45;docs/events.{format} implementation&#45; WebSocket resource " alt="" coords="3197,319,3335,345"/>
<area shape="rect" id="node20" href="../../d6/d87/res__ari__events_8c.html" title="WebSocket resource. " alt="" coords="3835,319,3961,345"/>
<area shape="rect" id="node22" href="../../d3/d17/config__transport_8c.html" title="config_transport.c" alt="" coords="3596,237,3733,263"/>
<area shape="rect" id="node23" href="../../d2/db8/res__pjsip__transport__websocket_8c.html" title="res_pjsip_transport\l_websocket.c" alt="" coords="3758,229,3902,271"/>
<area shape="rect" id="node24" href="../../de/de9/test__websocket__client_8c.html" title="Websocket Client Unit Tests. " alt="" coords="3926,237,4099,263"/>
<area shape="rect" id="node26" href="../../d7/d0c/resource__applications_8h.html" title="Generated file &#45; declares stubs to be implemented in res/ari/resource_applications.c. " alt="" coords="1411,237,1585,263"/>
<area shape="rect" id="node27" href="../../d3/ddb/resource__asterisk_8h.html" title="Generated file &#45; declares stubs to be implemented in res/ari/resource_asterisk.c. ..." alt="" coords="1609,237,1755,263"/>
<area shape="rect" id="node28" href="../../d5/d36/resource__bridges_8h.html" title="Generated file &#45; declares stubs to be implemented in res/ari/resource_bridges.c. " alt="" coords="2611,237,2755,263"/>
<area shape="rect" id="node29" href="../../d0/d12/resource__channels_8h.html" title="Generated file &#45; declares stubs to be implemented in res/ari/resource_channels.c. ..." alt="" coords="2779,237,2934,263"/>
<area shape="rect" id="node30" href="../../db/d87/resource__device__states_8h.html" title="Generated file &#45; declares stubs to be implemented in res/ari/resource_deviceStates.c. " alt="" coords="1017,237,1203,263"/>
<area shape="rect" id="node31" href="../../d6/d2d/resource__endpoints_8h.html" title="Generated file &#45; declares stubs to be implemented in res/ari/resource_endpoints.c. " alt="" coords="1227,237,1387,263"/>
<area shape="rect" id="node32" href="../../d1/dda/resource__events_8h.html" title="Generated file &#45; declares stubs to be implemented in res/ari/resource_events.c. " alt="" coords="2959,237,3099,263"/>
<area shape="rect" id="node33" href="../../d0/db9/resource__mailboxes_8h.html" title="Generated file &#45; declares stubs to be implemented in res/ari/resource_mailboxes.c. " alt="" coords="1779,237,1942,263"/>
<area shape="rect" id="node34" href="../../de/d64/resource__playbacks_8h.html" title="Generated file &#45; declares stubs to be implemented in res/ari/resource_playbacks.c. " alt="" coords="1966,237,2126,263"/>
<area shape="rect" id="node35" href="../../dd/dfd/resource__recordings_8h.html" title="Generated file &#45; declares stubs to be implemented in res/ari/resource_recordings.c. " alt="" coords="2151,237,2315,263"/>
<area shape="rect" id="node36" href="../../d3/dde/resource__sounds_8h.html" title="Generated file &#45; declares stubs to be implemented in res/ari/resource_sounds.c. " alt="" coords="2339,237,2481,263"/>
<area shape="rect" id="node37" href="../../d7/dbc/res__ari_8c.html" title="HTTP binding for the Stasis API. " alt="" coords="3123,237,3199,263"/>
<area shape="rect" id="node38" href="../../da/d03/test__ari_8c.html" title="Test ARI API. David M. Lee, II &lt;dlee@digium.com&gt; . " alt="" coords="2505,237,2587,263"/>
<area shape="rect" id="node42" href="../../d8/dfa/res_2ari_2cli_8c.html" title="Command line for ARI. " alt="" coords="3223,237,3269,263"/>
</map>
</div>
</div>
<p><a href="../../d4/ddf/tcptls_8h_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="nested-classes"></a>
Data Structures</h2></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../da/d2b/structast__tcptls__session__args.html">ast_tcptls_session_args</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">arguments for the accepting thread  <a href="../../da/d2b/structast__tcptls__session__args.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d6/d49/structast__tcptls__session__instance.html">ast_tcptls_session_instance</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">describes a server instance  <a href="../../d6/d49/structast__tcptls__session__instance.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d5/d90/structast__tls__config.html">ast_tls_config</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="define-members"></a>
Macros</h2></td></tr>
<tr class="memitem:a1850a109f5255895d75980912723ae7c"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d4/ddf/tcptls_8h.html#a1850a109f5255895d75980912723ae7c">AST_CERTFILE</a>&#160;&#160;&#160;&quot;asterisk.pem&quot;</td></tr>
<tr class="separator:a1850a109f5255895d75980912723ae7c"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="enum-members"></a>
Enumerations</h2></td></tr>
<tr class="memitem:a667a09d76fe878551ac296875754971c"><td class="memItemLeft" align="right" valign="top">enum &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d4/ddf/tcptls_8h.html#a667a09d76fe878551ac296875754971c">ast_ssl_flags</a> { <br />
&#160;&#160;<a class="el" href="../../d4/ddf/tcptls_8h.html#a667a09d76fe878551ac296875754971ca26806f8aa1f6534c10f6bfe0989948ab">AST_SSL_VERIFY_CLIENT</a> = (1 &lt;&lt; 0), 
<a class="el" href="../../d4/ddf/tcptls_8h.html#a667a09d76fe878551ac296875754971ca53c54dbfbad41c1a7ecd6caaf0b06cba">AST_SSL_DONT_VERIFY_SERVER</a> = (1 &lt;&lt; 1), 
<a class="el" href="../../d4/ddf/tcptls_8h.html#a667a09d76fe878551ac296875754971ca8845bda4b8cce494a3c4bbc2828143f7">AST_SSL_IGNORE_COMMON_NAME</a> = (1 &lt;&lt; 2), 
<a class="el" href="../../d4/ddf/tcptls_8h.html#a667a09d76fe878551ac296875754971cae98119ef26aab11db1884e23837adb55">AST_SSL_SSLV2_CLIENT</a> = (1 &lt;&lt; 3), 
<br />
&#160;&#160;<a class="el" href="../../d4/ddf/tcptls_8h.html#a667a09d76fe878551ac296875754971ca55890a6de938cdc69f90cc1b360301f9">AST_SSL_SSLV3_CLIENT</a> = (1 &lt;&lt; 4), 
<a class="el" href="../../d4/ddf/tcptls_8h.html#a667a09d76fe878551ac296875754971ca9d59ad57cfceba9e2854f9b2a271a0bb">AST_SSL_TLSV1_CLIENT</a> = (1 &lt;&lt; 5), 
<a class="el" href="../../d4/ddf/tcptls_8h.html#a667a09d76fe878551ac296875754971cabd2609384690cb305648269648e9ff46">AST_SSL_SERVER_CIPHER_ORDER</a> = (1 &lt;&lt; 6), 
<a class="el" href="../../d4/ddf/tcptls_8h.html#a667a09d76fe878551ac296875754971cae2335e286c6332acafc11c55bda2b3ef">AST_SSL_DISABLE_TLSV1</a> = (1 &lt;&lt; 7), 
<br />
&#160;&#160;<a class="el" href="../../d4/ddf/tcptls_8h.html#a667a09d76fe878551ac296875754971ca73370a73491eb5332459590aec17dcfd">AST_SSL_DISABLE_TLSV11</a> = (1 &lt;&lt; 8), 
<a class="el" href="../../d4/ddf/tcptls_8h.html#a667a09d76fe878551ac296875754971caa9ae1ac923a99921ec8798d7100470f2">AST_SSL_DISABLE_TLSV12</a> = (1 &lt;&lt; 9)
<br />
 }</td></tr>
<tr class="separator:a667a09d76fe878551ac296875754971c"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a24ff4bad1d2894ae3cae4e555d508fd0"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d4/ddf/tcptls_8h.html#a24ff4bad1d2894ae3cae4e555d508fd0">ast_ssl_setup</a> (struct <a class="el" href="../../d5/d90/structast__tls__config.html">ast_tls_config</a> *cfg)</td></tr>
<tr class="memdesc:a24ff4bad1d2894ae3cae4e555d508fd0"><td class="mdescLeft">&#160;</td><td class="mdescRight">Set up an SSL server.  <a href="#a24ff4bad1d2894ae3cae4e555d508fd0">More...</a><br /></td></tr>
<tr class="separator:a24ff4bad1d2894ae3cae4e555d508fd0"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5a34250828700061832a29115f0aaf33"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d4/ddf/tcptls_8h.html#a5a34250828700061832a29115f0aaf33">ast_ssl_teardown</a> (struct <a class="el" href="../../d5/d90/structast__tls__config.html">ast_tls_config</a> *cfg)</td></tr>
<tr class="memdesc:a5a34250828700061832a29115f0aaf33"><td class="mdescLeft">&#160;</td><td class="mdescRight">free resources used by an SSL server  <a href="#a5a34250828700061832a29115f0aaf33">More...</a><br /></td></tr>
<tr class="separator:a5a34250828700061832a29115f0aaf33"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9bf6d5b9eb8b646983d127c2b1ac1822"><td class="memItemLeft" align="right" valign="top">struct <a class="el" href="../../d6/d49/structast__tcptls__session__instance.html">ast_tcptls_session_instance</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d4/ddf/tcptls_8h.html#a9bf6d5b9eb8b646983d127c2b1ac1822">ast_tcptls_client_create</a> (struct <a class="el" href="../../da/d2b/structast__tcptls__session__args.html">ast_tcptls_session_args</a> *<a class="el" href="../../d5/dd1/cdr__sqlite3__custom_8c.html#a787f82faccb7c1f40a2539a14855601b">desc</a>)</td></tr>
<tr class="separator:a9bf6d5b9eb8b646983d127c2b1ac1822"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:afbdc75838c2b7c41b7cb4a7740f49851"><td class="memItemLeft" align="right" valign="top">struct <a class="el" href="../../d6/d49/structast__tcptls__session__instance.html">ast_tcptls_session_instance</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d4/ddf/tcptls_8h.html#afbdc75838c2b7c41b7cb4a7740f49851">ast_tcptls_client_start</a> (struct <a class="el" href="../../d6/d49/structast__tcptls__session__instance.html">ast_tcptls_session_instance</a> *tcptls_session)</td></tr>
<tr class="memdesc:afbdc75838c2b7c41b7cb4a7740f49851"><td class="mdescLeft">&#160;</td><td class="mdescRight">attempts to connect and start tcptls session, on error the tcptls_session's ref count is decremented, fd and file are closed, and NULL is returned.  <a href="#afbdc75838c2b7c41b7cb4a7740f49851">More...</a><br /></td></tr>
<tr class="separator:afbdc75838c2b7c41b7cb4a7740f49851"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:adea645492f53ec11186b84eaf85e14d9"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d4/ddf/tcptls_8h.html#adea645492f53ec11186b84eaf85e14d9">ast_tcptls_close_session_file</a> (struct <a class="el" href="../../d6/d49/structast__tcptls__session__instance.html">ast_tcptls_session_instance</a> *tcptls_session)</td></tr>
<tr class="memdesc:adea645492f53ec11186b84eaf85e14d9"><td class="mdescLeft">&#160;</td><td class="mdescRight">Closes a tcptls session instance's file and/or file descriptor. The tcptls_session will be set to NULL and it's file descriptor will be set to -1 by this function.  <a href="#adea645492f53ec11186b84eaf85e14d9">More...</a><br /></td></tr>
<tr class="separator:adea645492f53ec11186b84eaf85e14d9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac1fd2d3038c57a8f8f28f4b558eb5583"><td class="memItemLeft" align="right" valign="top">void *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d4/ddf/tcptls_8h.html#ac1fd2d3038c57a8f8f28f4b558eb5583">ast_tcptls_server_root</a> (void *)</td></tr>
<tr class="separator:ac1fd2d3038c57a8f8f28f4b558eb5583"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a29375a4482c8de1e9879b97be2e88bf0"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d4/ddf/tcptls_8h.html#a29375a4482c8de1e9879b97be2e88bf0">ast_tcptls_server_start</a> (struct <a class="el" href="../../da/d2b/structast__tcptls__session__args.html">ast_tcptls_session_args</a> *<a class="el" href="../../d5/dd1/cdr__sqlite3__custom_8c.html#a787f82faccb7c1f40a2539a14855601b">desc</a>)</td></tr>
<tr class="memdesc:a29375a4482c8de1e9879b97be2e88bf0"><td class="mdescLeft">&#160;</td><td class="mdescRight">This is a generic (re)start routine for a TCP server, which does the socket/bind/listen and starts a thread for handling accept().  <a href="#a29375a4482c8de1e9879b97be2e88bf0">More...</a><br /></td></tr>
<tr class="separator:a29375a4482c8de1e9879b97be2e88bf0"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1fd4aa5038c9a488acc0f8017fe94fda"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d4/ddf/tcptls_8h.html#a1fd4aa5038c9a488acc0f8017fe94fda">ast_tcptls_server_stop</a> (struct <a class="el" href="../../da/d2b/structast__tcptls__session__args.html">ast_tcptls_session_args</a> *<a class="el" href="../../d5/dd1/cdr__sqlite3__custom_8c.html#a787f82faccb7c1f40a2539a14855601b">desc</a>)</td></tr>
<tr class="memdesc:a1fd4aa5038c9a488acc0f8017fe94fda"><td class="mdescLeft">&#160;</td><td class="mdescRight">Shutdown a running server if there is one.  <a href="#a1fd4aa5038c9a488acc0f8017fe94fda">More...</a><br /></td></tr>
<tr class="separator:a1fd4aa5038c9a488acc0f8017fe94fda"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a79d9a3beb22f1fb8551cef625e9fd8a1"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d4/ddf/tcptls_8h.html#a79d9a3beb22f1fb8551cef625e9fd8a1">ast_tls_read_conf</a> (struct <a class="el" href="../../d5/d90/structast__tls__config.html">ast_tls_config</a> *tls_cfg, struct <a class="el" href="../../da/d2b/structast__tcptls__session__args.html">ast_tcptls_session_args</a> *tls_desc, const char *varname, const char *<a class="el" href="../../d5/dde/test__func__file_8c.html#a8556878012feffc9e0beb86cd78f424d">value</a>)</td></tr>
<tr class="memdesc:a79d9a3beb22f1fb8551cef625e9fd8a1"><td class="mdescLeft">&#160;</td><td class="mdescRight">Used to parse conf files containing tls/ssl options.  <a href="#a79d9a3beb22f1fb8551cef625e9fd8a1">More...</a><br /></td></tr>
<tr class="separator:a79d9a3beb22f1fb8551cef625e9fd8a1"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Generic support for tcp/tls servers in Asterisk. </p>
<dl class="section note"><dt>Note</dt><dd>In order to have TLS/SSL support, we need the openssl libraries. Still we can decide whether or not to use them by commenting in or out the DO_SSL macro.</dd></dl>
<p>TLS/SSL support is basically implemented by reading from a config file (currently manager.conf, http.conf and sip.conf) the names of the certificate files and cipher to use, and then run ssl_setup() to create an appropriate data structure named ssl_ctx.</p>
<p>If we support multiple domains, presumably we need to read multiple certificates.</p>
<p>When we are requested to open a TLS socket, we run make_file_from_fd() on the socket, to do the necessary setup. At the moment the context's name is hardwired in the function, but we can certainly make it into an extra parameter to the function.</p>
<p>We declare most of ssl support variables unconditionally, because their number is small and this simplifies the code.</p>
<dl class="section note"><dt>Note</dt><dd>The ssl-support variables (ssl_ctx, do_ssl, certfile, cipher) and their setup should be moved to a more central place, e.g. asterisk.conf and the source files that processes it. Similarly, ssl_setup() should be run earlier in the startup process so modules have it available.</dd></dl>
<p><a class="el" href="../../d9/d3e/AstTlsOverview.html">TLS Implementation Overview</a> </p>

<p class="definition">Definition in file <a class="el" href="../../d4/ddf/tcptls_8h_source.html">tcptls.h</a>.</p>
</div><h2 class="groupheader">Macro Definition Documentation</h2>
<a id="a1850a109f5255895d75980912723ae7c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1850a109f5255895d75980912723ae7c">&#9670;&nbsp;</a></span>AST_CERTFILE</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define AST_CERTFILE&#160;&#160;&#160;&quot;asterisk.pem&quot;</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>SSL support </p>

<p class="definition">Definition at line <a class="el" href="../../d4/ddf/tcptls_8h_source.html#l00062">62</a> of file <a class="el" href="../../d4/ddf/tcptls_8h_source.html">tcptls.h</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../dd/d43/http_8c_source.html#l02077">__ast_http_load()</a>, <a class="el" href="../../d4/d10/manager_8c_source.html#l09116">manager_set_defaults()</a>, and <a class="el" href="../../d5/dfe/chan__sip_8c_source.html#l32514">reload_config()</a>.</p>

</div>
</div>
<h2 class="groupheader">Enumeration Type Documentation</h2>
<a id="a667a09d76fe878551ac296875754971c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a667a09d76fe878551ac296875754971c">&#9670;&nbsp;</a></span>ast_ssl_flags</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">enum <a class="el" href="../../d4/ddf/tcptls_8h.html#a667a09d76fe878551ac296875754971c">ast_ssl_flags</a></td>
        </tr>
      </table>
</div><div class="memdoc">
<table class="fieldtable">
<tr><th colspan="2">Enumerator</th></tr><tr><td class="fieldname"><a id="a667a09d76fe878551ac296875754971ca26806f8aa1f6534c10f6bfe0989948ab"></a>AST_SSL_VERIFY_CLIENT&#160;</td><td class="fielddoc"><p>Verify certificate when acting as server </p>
</td></tr>
<tr><td class="fieldname"><a id="a667a09d76fe878551ac296875754971ca53c54dbfbad41c1a7ecd6caaf0b06cba"></a>AST_SSL_DONT_VERIFY_SERVER&#160;</td><td class="fielddoc"><p>Don't verify certificate when connecting to a server </p>
</td></tr>
<tr><td class="fieldname"><a id="a667a09d76fe878551ac296875754971ca8845bda4b8cce494a3c4bbc2828143f7"></a>AST_SSL_IGNORE_COMMON_NAME&#160;</td><td class="fielddoc"><p>Don't compare "Common Name" against IP or hostname </p>
</td></tr>
<tr><td class="fieldname"><a id="a667a09d76fe878551ac296875754971cae98119ef26aab11db1884e23837adb55"></a>AST_SSL_SSLV2_CLIENT&#160;</td><td class="fielddoc"><p>Use SSLv2 for outgoing client connections </p>
</td></tr>
<tr><td class="fieldname"><a id="a667a09d76fe878551ac296875754971ca55890a6de938cdc69f90cc1b360301f9"></a>AST_SSL_SSLV3_CLIENT&#160;</td><td class="fielddoc"><p>Use SSLv3 for outgoing client connections </p>
</td></tr>
<tr><td class="fieldname"><a id="a667a09d76fe878551ac296875754971ca9d59ad57cfceba9e2854f9b2a271a0bb"></a>AST_SSL_TLSV1_CLIENT&#160;</td><td class="fielddoc"><p>Use TLSv1 for outgoing client connections </p>
</td></tr>
<tr><td class="fieldname"><a id="a667a09d76fe878551ac296875754971cabd2609384690cb305648269648e9ff46"></a>AST_SSL_SERVER_CIPHER_ORDER&#160;</td><td class="fielddoc"><p>Use server cipher order instead of the client order </p>
</td></tr>
<tr><td class="fieldname"><a id="a667a09d76fe878551ac296875754971cae2335e286c6332acafc11c55bda2b3ef"></a>AST_SSL_DISABLE_TLSV1&#160;</td><td class="fielddoc"><p>Disable TLSv1 support </p>
</td></tr>
<tr><td class="fieldname"><a id="a667a09d76fe878551ac296875754971ca73370a73491eb5332459590aec17dcfd"></a>AST_SSL_DISABLE_TLSV11&#160;</td><td class="fielddoc"><p>Disable TLSv1.1 support </p>
</td></tr>
<tr><td class="fieldname"><a id="a667a09d76fe878551ac296875754971caa9ae1ac923a99921ec8798d7100470f2"></a>AST_SSL_DISABLE_TLSV12&#160;</td><td class="fielddoc"><p>Disable TLSv1.2 support </p>
</td></tr>
</table>

<p class="definition">Definition at line <a class="el" href="../../d4/ddf/tcptls_8h_source.html#l00064">64</a> of file <a class="el" href="../../d4/ddf/tcptls_8h_source.html">tcptls.h</a>.</p>
<div class="fragment"><div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;                   {<span class="comment"></span></div><div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;<span class="comment">   /*! Verify certificate when acting as server */</span></div><div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;   <a class="code" href="../../d4/ddf/tcptls_8h.html#a667a09d76fe878551ac296875754971ca26806f8aa1f6534c10f6bfe0989948ab">AST_SSL_VERIFY_CLIENT</a> = (1 &lt;&lt; 0),<span class="comment"></span></div><div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;<span class="comment">   /*! Don&#39;t verify certificate when connecting to a server */</span></div><div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;   <a class="code" href="../../d4/ddf/tcptls_8h.html#a667a09d76fe878551ac296875754971ca53c54dbfbad41c1a7ecd6caaf0b06cba">AST_SSL_DONT_VERIFY_SERVER</a> = (1 &lt;&lt; 1),<span class="comment"></span></div><div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;<span class="comment">   /*! Don&#39;t compare &quot;Common Name&quot; against IP or hostname */</span></div><div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;   <a class="code" href="../../d4/ddf/tcptls_8h.html#a667a09d76fe878551ac296875754971ca8845bda4b8cce494a3c4bbc2828143f7">AST_SSL_IGNORE_COMMON_NAME</a> = (1 &lt;&lt; 2),<span class="comment"></span></div><div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;<span class="comment">   /*! Use SSLv2 for outgoing client connections */</span></div><div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;   <a class="code" href="../../d4/ddf/tcptls_8h.html#a667a09d76fe878551ac296875754971cae98119ef26aab11db1884e23837adb55">AST_SSL_SSLV2_CLIENT</a> = (1 &lt;&lt; 3),<span class="comment"></span></div><div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;<span class="comment">   /*! Use SSLv3 for outgoing client connections */</span></div><div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;   <a class="code" href="../../d4/ddf/tcptls_8h.html#a667a09d76fe878551ac296875754971ca55890a6de938cdc69f90cc1b360301f9">AST_SSL_SSLV3_CLIENT</a> = (1 &lt;&lt; 4),<span class="comment"></span></div><div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;<span class="comment">   /*! Use TLSv1 for outgoing client connections */</span></div><div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;   <a class="code" href="../../d4/ddf/tcptls_8h.html#a667a09d76fe878551ac296875754971ca9d59ad57cfceba9e2854f9b2a271a0bb">AST_SSL_TLSV1_CLIENT</a> = (1 &lt;&lt; 5),<span class="comment"></span></div><div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;<span class="comment">   /*! Use server cipher order instead of the client order */</span></div><div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;   <a class="code" href="../../d4/ddf/tcptls_8h.html#a667a09d76fe878551ac296875754971cabd2609384690cb305648269648e9ff46">AST_SSL_SERVER_CIPHER_ORDER</a> = (1 &lt;&lt; 6),<span class="comment"></span></div><div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;<span class="comment">   /*! Disable TLSv1 support */</span></div><div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;   <a class="code" href="../../d4/ddf/tcptls_8h.html#a667a09d76fe878551ac296875754971cae2335e286c6332acafc11c55bda2b3ef">AST_SSL_DISABLE_TLSV1</a> = (1 &lt;&lt; 7),<span class="comment"></span></div><div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;<span class="comment">   /*! Disable TLSv1.1 support */</span></div><div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;   <a class="code" href="../../d4/ddf/tcptls_8h.html#a667a09d76fe878551ac296875754971ca73370a73491eb5332459590aec17dcfd">AST_SSL_DISABLE_TLSV11</a> = (1 &lt;&lt; 8),<span class="comment"></span></div><div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;<span class="comment">   /*! Disable TLSv1.2 support */</span></div><div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;   <a class="code" href="../../d4/ddf/tcptls_8h.html#a667a09d76fe878551ac296875754971caa9ae1ac923a99921ec8798d7100470f2">AST_SSL_DISABLE_TLSV12</a> = (1 &lt;&lt; 9),</div><div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;};</div><div class="ttc" id="tcptls_8h_html_a667a09d76fe878551ac296875754971ca9d59ad57cfceba9e2854f9b2a271a0bb"><div class="ttname"><a href="../../d4/ddf/tcptls_8h.html#a667a09d76fe878551ac296875754971ca9d59ad57cfceba9e2854f9b2a271a0bb">AST_SSL_TLSV1_CLIENT</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d4/ddf/tcptls_8h_source.html#l00076">tcptls.h:76</a></div></div>
<div class="ttc" id="tcptls_8h_html_a667a09d76fe878551ac296875754971cabd2609384690cb305648269648e9ff46"><div class="ttname"><a href="../../d4/ddf/tcptls_8h.html#a667a09d76fe878551ac296875754971cabd2609384690cb305648269648e9ff46">AST_SSL_SERVER_CIPHER_ORDER</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d4/ddf/tcptls_8h_source.html#l00078">tcptls.h:78</a></div></div>
<div class="ttc" id="tcptls_8h_html_a667a09d76fe878551ac296875754971caa9ae1ac923a99921ec8798d7100470f2"><div class="ttname"><a href="../../d4/ddf/tcptls_8h.html#a667a09d76fe878551ac296875754971caa9ae1ac923a99921ec8798d7100470f2">AST_SSL_DISABLE_TLSV12</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d4/ddf/tcptls_8h_source.html#l00084">tcptls.h:84</a></div></div>
<div class="ttc" id="tcptls_8h_html_a667a09d76fe878551ac296875754971cae98119ef26aab11db1884e23837adb55"><div class="ttname"><a href="../../d4/ddf/tcptls_8h.html#a667a09d76fe878551ac296875754971cae98119ef26aab11db1884e23837adb55">AST_SSL_SSLV2_CLIENT</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d4/ddf/tcptls_8h_source.html#l00072">tcptls.h:72</a></div></div>
<div class="ttc" id="tcptls_8h_html_a667a09d76fe878551ac296875754971cae2335e286c6332acafc11c55bda2b3ef"><div class="ttname"><a href="../../d4/ddf/tcptls_8h.html#a667a09d76fe878551ac296875754971cae2335e286c6332acafc11c55bda2b3ef">AST_SSL_DISABLE_TLSV1</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d4/ddf/tcptls_8h_source.html#l00080">tcptls.h:80</a></div></div>
<div class="ttc" id="tcptls_8h_html_a667a09d76fe878551ac296875754971ca73370a73491eb5332459590aec17dcfd"><div class="ttname"><a href="../../d4/ddf/tcptls_8h.html#a667a09d76fe878551ac296875754971ca73370a73491eb5332459590aec17dcfd">AST_SSL_DISABLE_TLSV11</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d4/ddf/tcptls_8h_source.html#l00082">tcptls.h:82</a></div></div>
<div class="ttc" id="tcptls_8h_html_a667a09d76fe878551ac296875754971ca53c54dbfbad41c1a7ecd6caaf0b06cba"><div class="ttname"><a href="../../d4/ddf/tcptls_8h.html#a667a09d76fe878551ac296875754971ca53c54dbfbad41c1a7ecd6caaf0b06cba">AST_SSL_DONT_VERIFY_SERVER</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d4/ddf/tcptls_8h_source.html#l00068">tcptls.h:68</a></div></div>
<div class="ttc" id="tcptls_8h_html_a667a09d76fe878551ac296875754971ca26806f8aa1f6534c10f6bfe0989948ab"><div class="ttname"><a href="../../d4/ddf/tcptls_8h.html#a667a09d76fe878551ac296875754971ca26806f8aa1f6534c10f6bfe0989948ab">AST_SSL_VERIFY_CLIENT</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d4/ddf/tcptls_8h_source.html#l00066">tcptls.h:66</a></div></div>
<div class="ttc" id="tcptls_8h_html_a667a09d76fe878551ac296875754971ca55890a6de938cdc69f90cc1b360301f9"><div class="ttname"><a href="../../d4/ddf/tcptls_8h.html#a667a09d76fe878551ac296875754971ca55890a6de938cdc69f90cc1b360301f9">AST_SSL_SSLV3_CLIENT</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d4/ddf/tcptls_8h_source.html#l00074">tcptls.h:74</a></div></div>
<div class="ttc" id="tcptls_8h_html_a667a09d76fe878551ac296875754971ca8845bda4b8cce494a3c4bbc2828143f7"><div class="ttname"><a href="../../d4/ddf/tcptls_8h.html#a667a09d76fe878551ac296875754971ca8845bda4b8cce494a3c4bbc2828143f7">AST_SSL_IGNORE_COMMON_NAME</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d4/ddf/tcptls_8h_source.html#l00070">tcptls.h:70</a></div></div>
</div><!-- fragment -->
</div>
</div>
<h2 class="groupheader">Function Documentation</h2>
<a id="a24ff4bad1d2894ae3cae4e555d508fd0"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a24ff4bad1d2894ae3cae4e555d508fd0">&#9670;&nbsp;</a></span>ast_ssl_setup()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ast_ssl_setup </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="../../d5/d90/structast__tls__config.html">ast_tls_config</a> *&#160;</td>
          <td class="paramname"><em>cfg</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Set up an SSL server. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">cfg</td><td>Configuration for the SSL server </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">1</td><td>Success </td></tr>
    <tr><td class="paramname">0</td><td>Failure </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="../../dc/d9b/tcptls_8c_source.html#l00570">570</a> of file <a class="el" href="../../dc/d9b/tcptls_8c_source.html">tcptls.c</a>.</p>

<p class="reference">References <a class="el" href="../../dc/d9b/tcptls_8c_source.html#l00382">__ssl_setup()</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../dd/d43/http_8c_source.html#l02077">__ast_http_load()</a>, <a class="el" href="../../d4/d10/manager_8c_source.html#l09144">__init_manager()</a>, and <a class="el" href="../../d5/dfe/chan__sip_8c_source.html#l32514">reload_config()</a>.</p>
<div class="fragment"><div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;{</div><div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;   <span class="keywordflow">return</span> <a class="code" href="../../dc/d9b/tcptls_8c.html#a12ec3b45ca50a675005cf5d336a4e496">__ssl_setup</a>(cfg, 0);</div><div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;}</div><div class="ttc" id="tcptls_8c_html_a12ec3b45ca50a675005cf5d336a4e496"><div class="ttname"><a href="../../dc/d9b/tcptls_8c.html#a12ec3b45ca50a675005cf5d336a4e496">__ssl_setup</a></div><div class="ttdeci">static int __ssl_setup(struct ast_tls_config *cfg, int client)</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d9b/tcptls_8c_source.html#l00382">tcptls.c:382</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a5a34250828700061832a29115f0aaf33"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a5a34250828700061832a29115f0aaf33">&#9670;&nbsp;</a></span>ast_ssl_teardown()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ast_ssl_teardown </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="../../d5/d90/structast__tls__config.html">ast_tls_config</a> *&#160;</td>
          <td class="paramname"><em>cfg</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>free resources used by an SSL server </p>
<dl class="section note"><dt>Note</dt><dd>This only needs to be called if <a class="el" href="../../d4/ddf/tcptls_8h.html#a24ff4bad1d2894ae3cae4e555d508fd0" title="Set up an SSL server. ">ast_ssl_setup()</a> was directly called first. </dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">cfg</td><td>Configuration for the SSL server </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="../../dc/d9b/tcptls_8c_source.html#l00575">575</a> of file <a class="el" href="../../dc/d9b/tcptls_8c_source.html">tcptls.c</a>.</p>

<p class="reference">References <a class="el" href="../../dc/d7f/resample_8c_source.html#l00096">NULL</a>, and <a class="el" href="../../d4/ddf/tcptls_8h_source.html#l00095">ast_tls_config::ssl_ctx</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../d5/dfe/chan__sip_8c_source.html#l02545">sip_tcptls_client_args_destructor()</a>, <a class="el" href="../../d5/dfe/chan__sip_8c_source.html#l35708">unload_module()</a>, and <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html#l01123">websocket_client_args_destroy()</a>.</p>
<div class="fragment"><div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;{</div><div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;<span class="preprocessor">#ifdef DO_SSL</span></div><div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;   <span class="keywordflow">if</span> (cfg &amp;&amp; cfg-&gt;<a class="code" href="../../d5/d90/structast__tls__config.html#a500f2070b7b9f34238a51cbf8f9b5024">ssl_ctx</a>) {</div><div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;      SSL_CTX_free(cfg-&gt;<a class="code" href="../../d5/d90/structast__tls__config.html#a500f2070b7b9f34238a51cbf8f9b5024">ssl_ctx</a>);</div><div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;      cfg-&gt;<a class="code" href="../../d5/d90/structast__tls__config.html#a500f2070b7b9f34238a51cbf8f9b5024">ssl_ctx</a> = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;   }</div><div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;}</div><div class="ttc" id="resample_8c_html_a070d2ce7b6bb7e5c05602aa8c308d0c4"><div class="ttname"><a href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a></div><div class="ttdeci">#define NULL</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d7f/resample_8c_source.html#l00096">resample.c:96</a></div></div>
<div class="ttc" id="structast__tls__config_html_a500f2070b7b9f34238a51cbf8f9b5024"><div class="ttname"><a href="../../d5/d90/structast__tls__config.html#a500f2070b7b9f34238a51cbf8f9b5024">ast_tls_config::ssl_ctx</a></div><div class="ttdeci">SSL_CTX * ssl_ctx</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/ddf/tcptls_8h_source.html#l00095">tcptls.h:95</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a9bf6d5b9eb8b646983d127c2b1ac1822"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a9bf6d5b9eb8b646983d127c2b1ac1822">&#9670;&nbsp;</a></span>ast_tcptls_client_create()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="../../d6/d49/structast__tcptls__session__instance.html">ast_tcptls_session_instance</a>* ast_tcptls_client_create </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="../../da/d2b/structast__tcptls__session__args.html">ast_tcptls_session_args</a> *&#160;</td>
          <td class="paramname"><em>desc</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="../../dc/d9b/tcptls_8c_source.html#l00615">615</a> of file <a class="el" href="../../dc/d9b/tcptls_8c_source.html">tcptls.c</a>.</p>

<p class="reference">References <a class="el" href="../../d4/ddf/tcptls_8h_source.html#l00135">ast_tcptls_session_args::accept_fd</a>, <a class="el" href="../../d5/da5/astobj2_8h_source.html#l00411">ao2_alloc</a>, <a class="el" href="../../d5/da5/astobj2_8h_source.html#l01958">ao2_cleanup</a>, <a class="el" href="../../d4/d27/netsock2_8c_source.html#l00590">ast_bind()</a>, <a class="el" href="../../d1/d8c/logger_8h_source.html#l00452">ast_debug</a>, <a class="el" href="../../d1/dc8/iostream_8c_source.html#l00604">ast_iostream_from_fd()</a>, <a class="el" href="../../da/df7/astobj2_8c_source.html#l00042">ast_log</a>, <a class="el" href="../../d4/d27/netsock2_8c_source.html#l00388">ast_sockaddr_cmp()</a>, <a class="el" href="../../db/df1/netsock2_8h_source.html#l00171">ast_sockaddr_copy()</a>, <a class="el" href="../../d4/d27/netsock2_8c_source.html#l00534">ast_sockaddr_is_any()</a>, <a class="el" href="../../d4/d27/netsock2_8c_source.html#l00524">ast_sockaddr_is_ipv6()</a>, <a class="el" href="../../db/df1/netsock2_8h_source.html#l00127">ast_sockaddr_isnull()</a>, <a class="el" href="../../db/df1/netsock2_8h_source.html#l00140">ast_sockaddr_setnull()</a>, <a class="el" href="../../db/df1/netsock2_8h_source.html#l00260">ast_sockaddr_stringify()</a>, <a class="el" href="../../d6/d90/strings_8h_source.html#l00620">ast_str_create</a>, <a class="el" href="../../d4/ddf/tcptls_8h_source.html#l00150">ast_tcptls_session_instance::client</a>, <a class="el" href="../../d0/d29/cdr__mysql_8c_source.html#l00073">desc</a>, <a class="el" href="../../d1/d6e/main_2stdtime_2private_8h.html#ad65a8842cc674e3ddf69355898c0ecbf">errno</a>, <a class="el" href="../../d6/d47/utils_2frame_8c_source.html#l00999">error()</a>, <a class="el" href="../../d4/ddf/tcptls_8h_source.html#l00130">ast_tcptls_session_args::local_address</a>, <a class="el" href="../../d1/d8c/logger_8h_source.html#l00285">LOG_ERROR</a>, <a class="el" href="../../d4/ddf/tcptls_8h_source.html#l00142">ast_tcptls_session_args::name</a>, <a class="el" href="../../dc/d7f/resample_8c_source.html#l00096">NULL</a>, <a class="el" href="../../d4/ddf/tcptls_8h_source.html#l00131">ast_tcptls_session_args::old_address</a>, <a class="el" href="../../d4/ddf/tcptls_8h_source.html#l00158">ast_tcptls_session_instance::overflow_buf</a>, <a class="el" href="../../d4/ddf/tcptls_8h_source.html#l00152">ast_tcptls_session_instance::parent</a>, <a class="el" href="../../d4/ddf/tcptls_8h_source.html#l00132">ast_tcptls_session_args::remote_address</a>, <a class="el" href="../../d4/ddf/tcptls_8h_source.html#l00151">ast_tcptls_session_instance::remote_address</a>, <a class="el" href="../../dc/d9b/tcptls_8c_source.html#l00072">session_instance_destructor()</a>, <a class="el" href="../../d4/ddf/tcptls_8h_source.html#l00160">ast_tcptls_session_instance::stream</a>, and <a class="el" href="../../d4/ddf/tcptls_8h_source.html#l00141">ast_tcptls_session_args::worker_fn</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../de/d26/app__externalivr_8c_source.html#l00392">app_exec()</a>, <a class="el" href="../../d5/dfe/chan__sip_8c_source.html#l29578">sip_prepare_socket()</a>, and <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html#l01397">websocket_client_connect()</a>.</p>
<div class="fragment"><div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;{</div><div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160;   <span class="keywordtype">int</span> fd, x = 1;</div><div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d6/d49/structast__tcptls__session__instance.html">ast_tcptls_session_instance</a> *tcptls_session = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160;</div><div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160;   <span class="comment">/* Do nothing if nothing has changed */</span></div><div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;   <span class="keywordflow">if</span> (!<a class="code" href="../../db/df1/netsock2_8h.html#abae1b903c8f5b7639235b579a267aaab">ast_sockaddr_cmp</a>(&amp;desc-&gt;<a class="code" href="../../da/d2b/structast__tcptls__session__args.html#ac2badb17597d7e81dc4d44e54d470a05">old_address</a>, &amp;desc-&gt;<a class="code" href="../../da/d2b/structast__tcptls__session__args.html#a9dfcf41ffc851689eea95be7bb1f849a">remote_address</a>)) {</div><div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;      <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(1, <span class="stringliteral">&quot;Nothing changed in %s\n&quot;</span>, desc-&gt;<a class="code" href="../../da/d2b/structast__tcptls__session__args.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>);</div><div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;   }</div><div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160;</div><div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160;   <span class="comment">/* If we return early, there is no connection */</span></div><div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160;   <a class="code" href="../../db/df1/netsock2_8h.html#ad91b5dfe4c188d15f4b2e9e2ec5d8864">ast_sockaddr_setnull</a>(&amp;desc-&gt;<a class="code" href="../../da/d2b/structast__tcptls__session__args.html#ac2badb17597d7e81dc4d44e54d470a05">old_address</a>);</div><div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;</div><div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160;   fd = desc-&gt;<a class="code" href="../../da/d2b/structast__tcptls__session__args.html#ad6d7a8463d59a02084cf9d4360f46b79">accept_fd</a> = socket(<a class="code" href="../../db/df1/netsock2_8h.html#a579748bd6ceddd06b1cc6eb3578e8acc">ast_sockaddr_is_ipv6</a>(&amp;desc-&gt;<a class="code" href="../../da/d2b/structast__tcptls__session__args.html#a9dfcf41ffc851689eea95be7bb1f849a">remote_address</a>) ?</div><div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;                  AF_INET6 : AF_INET, SOCK_STREAM, IPPROTO_TCP);</div><div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160;   <span class="keywordflow">if</span> (desc-&gt;<a class="code" href="../../da/d2b/structast__tcptls__session__args.html#ad6d7a8463d59a02084cf9d4360f46b79">accept_fd</a> &lt; 0) {</div><div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Unable to allocate socket for %s: %s\n&quot;</span>,</div><div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160;         desc-&gt;<a class="code" href="../../da/d2b/structast__tcptls__session__args.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, strerror(<a class="code" href="../../d1/d6e/main_2stdtime_2private_8h.html#ad65a8842cc674e3ddf69355898c0ecbf">errno</a>));</div><div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160;   }</div><div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160;</div><div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160;   <span class="comment">/* if a local address was specified, bind to it so the connection will</span></div><div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160;<span class="comment">      originate from the desired address */</span></div><div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160;   <span class="keywordflow">if</span> (!<a class="code" href="../../db/df1/netsock2_8h.html#aae671446fa65b8f846efaf165872c683">ast_sockaddr_isnull</a>(&amp;desc-&gt;<a class="code" href="../../da/d2b/structast__tcptls__session__args.html#a6652499b3aff8f317d4c6d1a36c6c740">local_address</a>) &amp;&amp;</div><div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160;       !<a class="code" href="../../db/df1/netsock2_8h.html#a7704d67f19f3ca91198d8cc6e6445c3f">ast_sockaddr_is_any</a>(&amp;desc-&gt;<a class="code" href="../../da/d2b/structast__tcptls__session__args.html#a6652499b3aff8f317d4c6d1a36c6c740">local_address</a>)) {</div><div class="line"><a name="l00641"></a><span class="lineno">  641</span>&#160;      setsockopt(desc-&gt;<a class="code" href="../../da/d2b/structast__tcptls__session__args.html#ad6d7a8463d59a02084cf9d4360f46b79">accept_fd</a>, SOL_SOCKET, SO_REUSEADDR, &amp;x, <span class="keyword">sizeof</span>(x));</div><div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="../../db/df1/netsock2_8h.html#a58f856feeaf684b7d5353357e85a0dd5">ast_bind</a>(desc-&gt;<a class="code" href="../../da/d2b/structast__tcptls__session__args.html#ad6d7a8463d59a02084cf9d4360f46b79">accept_fd</a>, &amp;desc-&gt;<a class="code" href="../../da/d2b/structast__tcptls__session__args.html#a6652499b3aff8f317d4c6d1a36c6c740">local_address</a>)) {</div><div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160;         <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Unable to bind %s to %s: %s\n&quot;</span>,</div><div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160;            desc-&gt;<a class="code" href="../../da/d2b/structast__tcptls__session__args.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>,</div><div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160;            <a class="code" href="../../db/df1/netsock2_8h.html#aae9156c7fe6dff51463f29ed1c3b96c9">ast_sockaddr_stringify</a>(&amp;desc-&gt;<a class="code" href="../../da/d2b/structast__tcptls__session__args.html#a6652499b3aff8f317d4c6d1a36c6c740">local_address</a>),</div><div class="line"><a name="l00646"></a><span class="lineno">  646</span>&#160;            strerror(<a class="code" href="../../d1/d6e/main_2stdtime_2private_8h.html#ad65a8842cc674e3ddf69355898c0ecbf">errno</a>));</div><div class="line"><a name="l00647"></a><span class="lineno">  647</span>&#160;         <span class="keywordflow">goto</span> <a class="code" href="../../d6/d47/utils_2frame_8c.html#a4a9391ee88e57361b613c4c2fd2bf4aa">error</a>;</div><div class="line"><a name="l00648"></a><span class="lineno">  648</span>&#160;      }</div><div class="line"><a name="l00649"></a><span class="lineno">  649</span>&#160;   }</div><div class="line"><a name="l00650"></a><span class="lineno">  650</span>&#160;</div><div class="line"><a name="l00651"></a><span class="lineno">  651</span>&#160;   tcptls_session = <a class="code" href="../../d5/da5/astobj2_8h.html#ae0422b60d8e25b6962b2d61ae4ddf724">ao2_alloc</a>(<span class="keyword">sizeof</span>(*tcptls_session), <a class="code" href="../../dc/d9b/tcptls_8c.html#a5914d0d7ed685b4de9807f245de8fe69">session_instance_destructor</a>);</div><div class="line"><a name="l00652"></a><span class="lineno">  652</span>&#160;   <span class="keywordflow">if</span> (!tcptls_session) {</div><div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160;      <span class="keywordflow">goto</span> <a class="code" href="../../d6/d47/utils_2frame_8c.html#a4a9391ee88e57361b613c4c2fd2bf4aa">error</a>;</div><div class="line"><a name="l00654"></a><span class="lineno">  654</span>&#160;   }</div><div class="line"><a name="l00655"></a><span class="lineno">  655</span>&#160;</div><div class="line"><a name="l00656"></a><span class="lineno">  656</span>&#160;   tcptls_session-&gt;<a class="code" href="../../d6/d49/structast__tcptls__session__instance.html#af4e119b2a262dea0fce95abe3c7996c8">overflow_buf</a> = <a class="code" href="../../d6/d90/strings_8h.html#a9c34c6c6b8daaba24c0406270f3cf697">ast_str_create</a>(128);</div><div class="line"><a name="l00657"></a><span class="lineno">  657</span>&#160;   <span class="keywordflow">if</span> (!tcptls_session-&gt;<a class="code" href="../../d6/d49/structast__tcptls__session__instance.html#af4e119b2a262dea0fce95abe3c7996c8">overflow_buf</a>) {</div><div class="line"><a name="l00658"></a><span class="lineno">  658</span>&#160;      <span class="keywordflow">goto</span> <a class="code" href="../../d6/d47/utils_2frame_8c.html#a4a9391ee88e57361b613c4c2fd2bf4aa">error</a>;</div><div class="line"><a name="l00659"></a><span class="lineno">  659</span>&#160;   }</div><div class="line"><a name="l00660"></a><span class="lineno">  660</span>&#160;   tcptls_session-&gt;<a class="code" href="../../d6/d49/structast__tcptls__session__instance.html#a4bf947cca001e8ca0cd9def2b8d058c7">client</a> = 1;</div><div class="line"><a name="l00661"></a><span class="lineno">  661</span>&#160;   tcptls_session-&gt;<a class="code" href="../../d6/d49/structast__tcptls__session__instance.html#a36ac2dd734607a43ed90acb7e9d81ac5">stream</a> = <a class="code" href="../../dd/d27/iostream_8h.html#a5dd1ed6f7ebb56180cc9f953db97f0fd">ast_iostream_from_fd</a>(&amp;fd);</div><div class="line"><a name="l00662"></a><span class="lineno">  662</span>&#160;   <span class="keywordflow">if</span> (!tcptls_session-&gt;<a class="code" href="../../d6/d49/structast__tcptls__session__instance.html#a36ac2dd734607a43ed90acb7e9d81ac5">stream</a>) {</div><div class="line"><a name="l00663"></a><span class="lineno">  663</span>&#160;      <span class="keywordflow">goto</span> <a class="code" href="../../d6/d47/utils_2frame_8c.html#a4a9391ee88e57361b613c4c2fd2bf4aa">error</a>;</div><div class="line"><a name="l00664"></a><span class="lineno">  664</span>&#160;   }</div><div class="line"><a name="l00665"></a><span class="lineno">  665</span>&#160;</div><div class="line"><a name="l00666"></a><span class="lineno">  666</span>&#160;   <span class="comment">/* From here on out, the iostream owns the accept_fd and it will take</span></div><div class="line"><a name="l00667"></a><span class="lineno">  667</span>&#160;<span class="comment">    * care of closing it when the iostream is closed */</span></div><div class="line"><a name="l00668"></a><span class="lineno">  668</span>&#160;</div><div class="line"><a name="l00669"></a><span class="lineno">  669</span>&#160;   tcptls_session-&gt;<a class="code" href="../../d6/d49/structast__tcptls__session__instance.html#ac7fc8bed1104b4557f6a183ae1155b75">parent</a> = <a class="code" href="../../d0/d29/cdr__mysql_8c.html#a787f82faccb7c1f40a2539a14855601b">desc</a>;</div><div class="line"><a name="l00670"></a><span class="lineno">  670</span>&#160;   tcptls_session-&gt;<a class="code" href="../../d6/d49/structast__tcptls__session__instance.html#ac7fc8bed1104b4557f6a183ae1155b75">parent</a>-&gt;<a class="code" href="../../da/d2b/structast__tcptls__session__args.html#a0e9a9a6604c5e4d8be1fead736365051">worker_fn</a> = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l00671"></a><span class="lineno">  671</span>&#160;   <a class="code" href="../../db/df1/netsock2_8h.html#a56a46003c93bfd65111ea8ffc97af8f9">ast_sockaddr_copy</a>(&amp;tcptls_session-&gt;<a class="code" href="../../d6/d49/structast__tcptls__session__instance.html#a9dfcf41ffc851689eea95be7bb1f849a">remote_address</a>,</div><div class="line"><a name="l00672"></a><span class="lineno">  672</span>&#160;           &amp;desc-&gt;<a class="code" href="../../da/d2b/structast__tcptls__session__args.html#a9dfcf41ffc851689eea95be7bb1f849a">remote_address</a>);</div><div class="line"><a name="l00673"></a><span class="lineno">  673</span>&#160;</div><div class="line"><a name="l00674"></a><span class="lineno">  674</span>&#160;   <span class="comment">/* Set current info */</span></div><div class="line"><a name="l00675"></a><span class="lineno">  675</span>&#160;   <a class="code" href="../../db/df1/netsock2_8h.html#a56a46003c93bfd65111ea8ffc97af8f9">ast_sockaddr_copy</a>(&amp;desc-&gt;<a class="code" href="../../da/d2b/structast__tcptls__session__args.html#ac2badb17597d7e81dc4d44e54d470a05">old_address</a>, &amp;desc-&gt;<a class="code" href="../../da/d2b/structast__tcptls__session__args.html#a9dfcf41ffc851689eea95be7bb1f849a">remote_address</a>);</div><div class="line"><a name="l00676"></a><span class="lineno">  676</span>&#160;   <span class="keywordflow">return</span> tcptls_session;</div><div class="line"><a name="l00677"></a><span class="lineno">  677</span>&#160;</div><div class="line"><a name="l00678"></a><span class="lineno">  678</span>&#160;<a class="code" href="../../d6/d47/utils_2frame_8c.html#a4a9391ee88e57361b613c4c2fd2bf4aa">error</a>:</div><div class="line"><a name="l00679"></a><span class="lineno">  679</span>&#160;   close(desc-&gt;<a class="code" href="../../da/d2b/structast__tcptls__session__args.html#ad6d7a8463d59a02084cf9d4360f46b79">accept_fd</a>);</div><div class="line"><a name="l00680"></a><span class="lineno">  680</span>&#160;   desc-&gt;<a class="code" href="../../da/d2b/structast__tcptls__session__args.html#ad6d7a8463d59a02084cf9d4360f46b79">accept_fd</a> = -1;</div><div class="line"><a name="l00681"></a><span class="lineno">  681</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#a6321ee982370c55ab3c24c72c562cbdd">ao2_cleanup</a>(tcptls_session);</div><div class="line"><a name="l00682"></a><span class="lineno">  682</span>&#160;   <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l00683"></a><span class="lineno">  683</span>&#160;}</div><div class="ttc" id="netsock2_8h_html_a56a46003c93bfd65111ea8ffc97af8f9"><div class="ttname"><a href="../../db/df1/netsock2_8h.html#a56a46003c93bfd65111ea8ffc97af8f9">ast_sockaddr_copy</a></div><div class="ttdeci">static void ast_sockaddr_copy(struct ast_sockaddr *dst, const struct ast_sockaddr *src)</div><div class="ttdoc">Copies the data from one ast_sockaddr to another. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/df1/netsock2_8h_source.html#l00171">netsock2.h:171</a></div></div>
<div class="ttc" id="structast__tcptls__session__instance_html_a4bf947cca001e8ca0cd9def2b8d058c7"><div class="ttname"><a href="../../d6/d49/structast__tcptls__session__instance.html#a4bf947cca001e8ca0cd9def2b8d058c7">ast_tcptls_session_instance::client</a></div><div class="ttdeci">int client</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/ddf/tcptls_8h_source.html#l00150">tcptls.h:150</a></div></div>
<div class="ttc" id="structast__tcptls__session__instance_html_af4e119b2a262dea0fce95abe3c7996c8"><div class="ttname"><a href="../../d6/d49/structast__tcptls__session__instance.html#af4e119b2a262dea0fce95abe3c7996c8">ast_tcptls_session_instance::overflow_buf</a></div><div class="ttdeci">struct ast_str * overflow_buf</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/ddf/tcptls_8h_source.html#l00158">tcptls.h:158</a></div></div>
<div class="ttc" id="structast__tcptls__session__instance_html_ac7fc8bed1104b4557f6a183ae1155b75"><div class="ttname"><a href="../../d6/d49/structast__tcptls__session__instance.html#ac7fc8bed1104b4557f6a183ae1155b75">ast_tcptls_session_instance::parent</a></div><div class="ttdeci">struct ast_tcptls_session_args * parent</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/ddf/tcptls_8h_source.html#l00152">tcptls.h:152</a></div></div>
<div class="ttc" id="cdr__mysql_8c_html_a787f82faccb7c1f40a2539a14855601b"><div class="ttname"><a href="../../d0/d29/cdr__mysql_8c.html#a787f82faccb7c1f40a2539a14855601b">desc</a></div><div class="ttdeci">static const char desc[]</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d29/cdr__mysql_8c_source.html#l00073">cdr_mysql.c:73</a></div></div>
<div class="ttc" id="iostream_8h_html_a5dd1ed6f7ebb56180cc9f953db97f0fd"><div class="ttname"><a href="../../dd/d27/iostream_8h.html#a5dd1ed6f7ebb56180cc9f953db97f0fd">ast_iostream_from_fd</a></div><div class="ttdeci">struct ast_iostream * ast_iostream_from_fd(int *fd)</div><div class="ttdoc">Create an iostream from a file descriptor. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/dc8/iostream_8c_source.html#l00604">iostream.c:604</a></div></div>
<div class="ttc" id="resample_8c_html_a070d2ce7b6bb7e5c05602aa8c308d0c4"><div class="ttname"><a href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a></div><div class="ttdeci">#define NULL</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d7f/resample_8c_source.html#l00096">resample.c:96</a></div></div>
<div class="ttc" id="netsock2_8h_html_abae1b903c8f5b7639235b579a267aaab"><div class="ttname"><a href="../../db/df1/netsock2_8h.html#abae1b903c8f5b7639235b579a267aaab">ast_sockaddr_cmp</a></div><div class="ttdeci">int ast_sockaddr_cmp(const struct ast_sockaddr *a, const struct ast_sockaddr *b)</div><div class="ttdoc">Compares two ast_sockaddr structures. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d27/netsock2_8c_source.html#l00388">netsock2.c:388</a></div></div>
<div class="ttc" id="netsock2_8h_html_a58f856feeaf684b7d5353357e85a0dd5"><div class="ttname"><a href="../../db/df1/netsock2_8h.html#a58f856feeaf684b7d5353357e85a0dd5">ast_bind</a></div><div class="ttdeci">int ast_bind(int sockfd, const struct ast_sockaddr *addr)</div><div class="ttdoc">Wrapper around bind(2) that uses struct ast_sockaddr. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d27/netsock2_8c_source.html#l00590">netsock2.c:590</a></div></div>
<div class="ttc" id="netsock2_8h_html_ad91b5dfe4c188d15f4b2e9e2ec5d8864"><div class="ttname"><a href="../../db/df1/netsock2_8h.html#ad91b5dfe4c188d15f4b2e9e2ec5d8864">ast_sockaddr_setnull</a></div><div class="ttdeci">static void ast_sockaddr_setnull(struct ast_sockaddr *addr)</div><div class="ttdoc">Sets address addr to null. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/df1/netsock2_8h_source.html#l00140">netsock2.h:140</a></div></div>
<div class="ttc" id="netsock2_8h_html_aae671446fa65b8f846efaf165872c683"><div class="ttname"><a href="../../db/df1/netsock2_8h.html#aae671446fa65b8f846efaf165872c683">ast_sockaddr_isnull</a></div><div class="ttdeci">static int ast_sockaddr_isnull(const struct ast_sockaddr *addr)</div><div class="ttdoc">Checks if the ast_sockaddr is null. &quot;null&quot; in this sense essentially means uninitialized, or having a 0 length. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/df1/netsock2_8h_source.html#l00127">netsock2.h:127</a></div></div>
<div class="ttc" id="logger_8h_html_a3f248112c8d6ce7e3959aa723dade648"><div class="ttname"><a href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a></div><div class="ttdeci">#define ast_debug(level,...)</div><div class="ttdoc">Log a DEBUG message. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d8c/logger_8h_source.html#l00452">logger.h:452</a></div></div>
<div class="ttc" id="astobj2_8c_html_a96a00b3a518d7f32b6d51dc28f09bf9b"><div class="ttname"><a href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a></div><div class="ttdeci">#define ast_log</div><div class="ttdef"><b>Definition:</b> <a href="../../da/df7/astobj2_8c_source.html#l00042">astobj2.c:42</a></div></div>
<div class="ttc" id="netsock2_8h_html_a7704d67f19f3ca91198d8cc6e6445c3f"><div class="ttname"><a href="../../db/df1/netsock2_8h.html#a7704d67f19f3ca91198d8cc6e6445c3f">ast_sockaddr_is_any</a></div><div class="ttdeci">int ast_sockaddr_is_any(const struct ast_sockaddr *addr)</div><div class="ttdoc">Determine if the address type is unspecified, or &quot;any&quot; address. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d27/netsock2_8c_source.html#l00534">netsock2.c:534</a></div></div>
<div class="ttc" id="structast__tcptls__session__args_html_a9dfcf41ffc851689eea95be7bb1f849a"><div class="ttname"><a href="../../da/d2b/structast__tcptls__session__args.html#a9dfcf41ffc851689eea95be7bb1f849a">ast_tcptls_session_args::remote_address</a></div><div class="ttdeci">struct ast_sockaddr remote_address</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/ddf/tcptls_8h_source.html#l00132">tcptls.h:132</a></div></div>
<div class="ttc" id="structast__tcptls__session__instance_html"><div class="ttname"><a href="../../d6/d49/structast__tcptls__session__instance.html">ast_tcptls_session_instance</a></div><div class="ttdoc">describes a server instance </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/ddf/tcptls_8h_source.html#l00149">tcptls.h:149</a></div></div>
<div class="ttc" id="logger_8h_html_aced66975c154ea0e2a8ec3bc818b4e08"><div class="ttname"><a href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a></div><div class="ttdeci">#define LOG_ERROR</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d8c/logger_8h_source.html#l00285">logger.h:285</a></div></div>
<div class="ttc" id="main_2stdtime_2private_8h_html_ad65a8842cc674e3ddf69355898c0ecbf"><div class="ttname"><a href="../../d1/d6e/main_2stdtime_2private_8h.html#ad65a8842cc674e3ddf69355898c0ecbf">errno</a></div><div class="ttdeci">int errno</div></div>
<div class="ttc" id="netsock2_8h_html_aae9156c7fe6dff51463f29ed1c3b96c9"><div class="ttname"><a href="../../db/df1/netsock2_8h.html#aae9156c7fe6dff51463f29ed1c3b96c9">ast_sockaddr_stringify</a></div><div class="ttdeci">static char * ast_sockaddr_stringify(const struct ast_sockaddr *addr)</div><div class="ttdoc">Wrapper around ast_sockaddr_stringify_fmt() with default format. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/df1/netsock2_8h_source.html#l00260">netsock2.h:260</a></div></div>
<div class="ttc" id="astobj2_8h_html_ae0422b60d8e25b6962b2d61ae4ddf724"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#ae0422b60d8e25b6962b2d61ae4ddf724">ao2_alloc</a></div><div class="ttdeci">#define ao2_alloc(data_size, destructor_fn)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l00411">astobj2.h:411</a></div></div>
<div class="ttc" id="tcptls_8c_html_a5914d0d7ed685b4de9807f245de8fe69"><div class="ttname"><a href="../../dc/d9b/tcptls_8c.html#a5914d0d7ed685b4de9807f245de8fe69">session_instance_destructor</a></div><div class="ttdeci">static void session_instance_destructor(void *obj)</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d9b/tcptls_8c_source.html#l00072">tcptls.c:72</a></div></div>
<div class="ttc" id="structast__tcptls__session__args_html_a0e9a9a6604c5e4d8be1fead736365051"><div class="ttname"><a href="../../da/d2b/structast__tcptls__session__args.html#a0e9a9a6604c5e4d8be1fead736365051">ast_tcptls_session_args::worker_fn</a></div><div class="ttdeci">void *(* worker_fn)(void *)</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/ddf/tcptls_8h_source.html#l00141">tcptls.h:141</a></div></div>
<div class="ttc" id="structast__tcptls__session__args_html_ac2badb17597d7e81dc4d44e54d470a05"><div class="ttname"><a href="../../da/d2b/structast__tcptls__session__args.html#ac2badb17597d7e81dc4d44e54d470a05">ast_tcptls_session_args::old_address</a></div><div class="ttdeci">struct ast_sockaddr old_address</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/ddf/tcptls_8h_source.html#l00131">tcptls.h:131</a></div></div>
<div class="ttc" id="structast__tcptls__session__args_html_a8f8f80d37794cde9472343e4487ba3eb"><div class="ttname"><a href="../../da/d2b/structast__tcptls__session__args.html#a8f8f80d37794cde9472343e4487ba3eb">ast_tcptls_session_args::name</a></div><div class="ttdeci">const char * name</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/ddf/tcptls_8h_source.html#l00142">tcptls.h:142</a></div></div>
<div class="ttc" id="structast__tcptls__session__instance_html_a36ac2dd734607a43ed90acb7e9d81ac5"><div class="ttname"><a href="../../d6/d49/structast__tcptls__session__instance.html#a36ac2dd734607a43ed90acb7e9d81ac5">ast_tcptls_session_instance::stream</a></div><div class="ttdeci">struct ast_iostream * stream</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/ddf/tcptls_8h_source.html#l00160">tcptls.h:160</a></div></div>
<div class="ttc" id="astobj2_8h_html_a6321ee982370c55ab3c24c72c562cbdd"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#a6321ee982370c55ab3c24c72c562cbdd">ao2_cleanup</a></div><div class="ttdeci">#define ao2_cleanup(obj)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l01958">astobj2.h:1958</a></div></div>
<div class="ttc" id="structast__tcptls__session__args_html_ad6d7a8463d59a02084cf9d4360f46b79"><div class="ttname"><a href="../../da/d2b/structast__tcptls__session__args.html#ad6d7a8463d59a02084cf9d4360f46b79">ast_tcptls_session_args::accept_fd</a></div><div class="ttdeci">int accept_fd</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/ddf/tcptls_8h_source.html#l00135">tcptls.h:135</a></div></div>
<div class="ttc" id="utils_2frame_8c_html_a4a9391ee88e57361b613c4c2fd2bf4aa"><div class="ttname"><a href="../../d6/d47/utils_2frame_8c.html#a4a9391ee88e57361b613c4c2fd2bf4aa">error</a></div><div class="ttdeci">int error(const char *format,...)</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d47/utils_2frame_8c_source.html#l00999">utils/frame.c:999</a></div></div>
<div class="ttc" id="structast__tcptls__session__args_html_a6652499b3aff8f317d4c6d1a36c6c740"><div class="ttname"><a href="../../da/d2b/structast__tcptls__session__args.html#a6652499b3aff8f317d4c6d1a36c6c740">ast_tcptls_session_args::local_address</a></div><div class="ttdeci">struct ast_sockaddr local_address</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/ddf/tcptls_8h_source.html#l00130">tcptls.h:130</a></div></div>
<div class="ttc" id="netsock2_8h_html_a579748bd6ceddd06b1cc6eb3578e8acc"><div class="ttname"><a href="../../db/df1/netsock2_8h.html#a579748bd6ceddd06b1cc6eb3578e8acc">ast_sockaddr_is_ipv6</a></div><div class="ttdeci">int ast_sockaddr_is_ipv6(const struct ast_sockaddr *addr)</div><div class="ttdoc">Determine if this is an IPv6 address. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d27/netsock2_8c_source.html#l00524">netsock2.c:524</a></div></div>
<div class="ttc" id="strings_8h_html_a9c34c6c6b8daaba24c0406270f3cf697"><div class="ttname"><a href="../../d6/d90/strings_8h.html#a9c34c6c6b8daaba24c0406270f3cf697">ast_str_create</a></div><div class="ttdeci">#define ast_str_create(init_len)</div><div class="ttdoc">Create a malloc&amp;#39;ed dynamic length string. </div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d90/strings_8h_source.html#l00620">strings.h:620</a></div></div>
<div class="ttc" id="structast__tcptls__session__instance_html_a9dfcf41ffc851689eea95be7bb1f849a"><div class="ttname"><a href="../../d6/d49/structast__tcptls__session__instance.html#a9dfcf41ffc851689eea95be7bb1f849a">ast_tcptls_session_instance::remote_address</a></div><div class="ttdeci">struct ast_sockaddr remote_address</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/ddf/tcptls_8h_source.html#l00151">tcptls.h:151</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="afbdc75838c2b7c41b7cb4a7740f49851"></a>
<h2 class="memtitle"><span class="permalink"><a href="#afbdc75838c2b7c41b7cb4a7740f49851">&#9670;&nbsp;</a></span>ast_tcptls_client_start()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="../../d6/d49/structast__tcptls__session__instance.html">ast_tcptls_session_instance</a>* ast_tcptls_client_start </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="../../d6/d49/structast__tcptls__session__instance.html">ast_tcptls_session_instance</a> *&#160;</td>
          <td class="paramname"><em>tcptls_session</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>attempts to connect and start tcptls session, on error the tcptls_session's ref count is decremented, fd and file are closed, and NULL is returned. </p>

<p class="definition">Definition at line <a class="el" href="../../dc/d9b/tcptls_8c_source.html#l00585">585</a> of file <a class="el" href="../../dc/d9b/tcptls_8c_source.html">tcptls.c</a>.</p>

<p class="reference">References <a class="el" href="../../dc/d9b/tcptls_8c_source.html#l00382">__ssl_setup()</a>, <a class="el" href="../../d4/ddf/tcptls_8h_source.html#l00135">ast_tcptls_session_args::accept_fd</a>, <a class="el" href="../../d5/da5/astobj2_8h_source.html#l00464">ao2_ref</a>, <a class="el" href="../../d4/d27/netsock2_8c_source.html#l00595">ast_connect()</a>, <a class="el" href="../../d5/d60/utils_8h_source.html#l01025">ast_fd_clear_flags</a>, <a class="el" href="../../da/df7/astobj2_8c_source.html#l00042">ast_log</a>, <a class="el" href="../../db/df1/netsock2_8h_source.html#l00260">ast_sockaddr_stringify()</a>, <a class="el" href="../../d0/d29/cdr__mysql_8c_source.html#l00073">desc</a>, <a class="el" href="../../d4/ddf/tcptls_8h_source.html#l00088">ast_tls_config::enabled</a>, <a class="el" href="../../d1/d6e/main_2stdtime_2private_8h.html#ad65a8842cc674e3ddf69355898c0ecbf">errno</a>, <a class="el" href="../../dc/d9b/tcptls_8c_source.html#l00140">handle_tcptls_connection()</a>, <a class="el" href="../../d1/d8c/logger_8h_source.html#l00285">LOG_ERROR</a>, <a class="el" href="../../d4/ddf/tcptls_8h_source.html#l00142">ast_tcptls_session_args::name</a>, <a class="el" href="../../dc/d7f/resample_8c_source.html#l00096">NULL</a>, <a class="el" href="../../d4/ddf/tcptls_8h_source.html#l00152">ast_tcptls_session_instance::parent</a>, <a class="el" href="../../d4/ddf/tcptls_8h_source.html#l00132">ast_tcptls_session_args::remote_address</a>, and <a class="el" href="../../d4/ddf/tcptls_8h_source.html#l00134">ast_tcptls_session_args::tls_cfg</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../d5/dfe/chan__sip_8c_source.html#l02985">_sip_tcp_helper_thread()</a>, <a class="el" href="../../de/d26/app__externalivr_8c_source.html#l00392">app_exec()</a>, and <a class="el" href="../../de/d4c/res__http__websocket_8c_source.html#l01397">websocket_client_connect()</a>.</p>
<div class="fragment"><div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;{</div><div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../da/d2b/structast__tcptls__session__args.html">ast_tcptls_session_args</a> *<a class="code" href="../../d0/d29/cdr__mysql_8c.html#a787f82faccb7c1f40a2539a14855601b">desc</a>;</div><div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;</div><div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;   <span class="keywordflow">if</span> (!(desc = tcptls_session-&gt;<a class="code" href="../../d6/d49/structast__tcptls__session__instance.html#ac7fc8bed1104b4557f6a183ae1155b75">parent</a>)) {</div><div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;      <span class="keywordflow">goto</span> client_start_error;</div><div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;   }</div><div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;</div><div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../db/df1/netsock2_8h.html#a16d4f77ca9af75e4afb60accca62e819">ast_connect</a>(desc-&gt;<a class="code" href="../../da/d2b/structast__tcptls__session__args.html#ad6d7a8463d59a02084cf9d4360f46b79">accept_fd</a>, &amp;desc-&gt;<a class="code" href="../../da/d2b/structast__tcptls__session__args.html#a9dfcf41ffc851689eea95be7bb1f849a">remote_address</a>)) {</div><div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Unable to connect %s to %s: %s\n&quot;</span>,</div><div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;         desc-&gt;<a class="code" href="../../da/d2b/structast__tcptls__session__args.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>,</div><div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;         <a class="code" href="../../db/df1/netsock2_8h.html#aae9156c7fe6dff51463f29ed1c3b96c9">ast_sockaddr_stringify</a>(&amp;desc-&gt;<a class="code" href="../../da/d2b/structast__tcptls__session__args.html#a9dfcf41ffc851689eea95be7bb1f849a">remote_address</a>),</div><div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;         strerror(<a class="code" href="../../d1/d6e/main_2stdtime_2private_8h.html#ad65a8842cc674e3ddf69355898c0ecbf">errno</a>));</div><div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;      <span class="keywordflow">goto</span> client_start_error;</div><div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;   }</div><div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;</div><div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;   <a class="code" href="../../d5/d60/utils_8h.html#ac2456bee4128b33d0fa35e8382a2038c">ast_fd_clear_flags</a>(desc-&gt;<a class="code" href="../../da/d2b/structast__tcptls__session__args.html#ad6d7a8463d59a02084cf9d4360f46b79">accept_fd</a>, O_NONBLOCK);</div><div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;</div><div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;   <span class="keywordflow">if</span> (desc-&gt;<a class="code" href="../../da/d2b/structast__tcptls__session__args.html#aeb4a21e3ae033a326cc9dfd20a7ab074">tls_cfg</a>) {</div><div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;      desc-&gt;<a class="code" href="../../da/d2b/structast__tcptls__session__args.html#aeb4a21e3ae033a326cc9dfd20a7ab074">tls_cfg</a>-&gt;<a class="code" href="../../d5/d90/structast__tls__config.html#a03e6cca0c879c0443efb431c30c14f76">enabled</a> = 1;</div><div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;      <a class="code" href="../../dc/d9b/tcptls_8c.html#a12ec3b45ca50a675005cf5d336a4e496">__ssl_setup</a>(desc-&gt;<a class="code" href="../../da/d2b/structast__tcptls__session__args.html#aeb4a21e3ae033a326cc9dfd20a7ab074">tls_cfg</a>, 1);</div><div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;   }</div><div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;</div><div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;   <span class="keywordflow">return</span> <a class="code" href="../../dc/d9b/tcptls_8c.html#aa7a554acdb67dd3845edc19c99cdf2d2">handle_tcptls_connection</a>(tcptls_session);</div><div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;</div><div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;client_start_error:</div><div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(tcptls_session, -1);</div><div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;   <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160;}</div><div class="ttc" id="structast__tcptls__session__instance_html_ac7fc8bed1104b4557f6a183ae1155b75"><div class="ttname"><a href="../../d6/d49/structast__tcptls__session__instance.html#ac7fc8bed1104b4557f6a183ae1155b75">ast_tcptls_session_instance::parent</a></div><div class="ttdeci">struct ast_tcptls_session_args * parent</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/ddf/tcptls_8h_source.html#l00152">tcptls.h:152</a></div></div>
<div class="ttc" id="tcptls_8c_html_aa7a554acdb67dd3845edc19c99cdf2d2"><div class="ttname"><a href="../../dc/d9b/tcptls_8c.html#aa7a554acdb67dd3845edc19c99cdf2d2">handle_tcptls_connection</a></div><div class="ttdeci">static void * handle_tcptls_connection(void *data)</div><div class="ttdoc">creates a FILE * from the fd passed by the accept thread. This operation is potentially expensive (ce...</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d9b/tcptls_8c_source.html#l00140">tcptls.c:140</a></div></div>
<div class="ttc" id="cdr__mysql_8c_html_a787f82faccb7c1f40a2539a14855601b"><div class="ttname"><a href="../../d0/d29/cdr__mysql_8c.html#a787f82faccb7c1f40a2539a14855601b">desc</a></div><div class="ttdeci">static const char desc[]</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d29/cdr__mysql_8c_source.html#l00073">cdr_mysql.c:73</a></div></div>
<div class="ttc" id="structast__tcptls__session__args_html"><div class="ttname"><a href="../../da/d2b/structast__tcptls__session__args.html">ast_tcptls_session_args</a></div><div class="ttdoc">arguments for the accepting thread </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/ddf/tcptls_8h_source.html#l00129">tcptls.h:129</a></div></div>
<div class="ttc" id="resample_8c_html_a070d2ce7b6bb7e5c05602aa8c308d0c4"><div class="ttname"><a href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a></div><div class="ttdeci">#define NULL</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d7f/resample_8c_source.html#l00096">resample.c:96</a></div></div>
<div class="ttc" id="astobj2_8c_html_a96a00b3a518d7f32b6d51dc28f09bf9b"><div class="ttname"><a href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a></div><div class="ttdeci">#define ast_log</div><div class="ttdef"><b>Definition:</b> <a href="../../da/df7/astobj2_8c_source.html#l00042">astobj2.c:42</a></div></div>
<div class="ttc" id="structast__tcptls__session__args_html_a9dfcf41ffc851689eea95be7bb1f849a"><div class="ttname"><a href="../../da/d2b/structast__tcptls__session__args.html#a9dfcf41ffc851689eea95be7bb1f849a">ast_tcptls_session_args::remote_address</a></div><div class="ttdeci">struct ast_sockaddr remote_address</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/ddf/tcptls_8h_source.html#l00132">tcptls.h:132</a></div></div>
<div class="ttc" id="astobj2_8h_html_aaca5e8eac39a22f9da1c36fc6c922270"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a></div><div class="ttdeci">#define ao2_ref(o, delta)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l00464">astobj2.h:464</a></div></div>
<div class="ttc" id="tcptls_8c_html_a12ec3b45ca50a675005cf5d336a4e496"><div class="ttname"><a href="../../dc/d9b/tcptls_8c.html#a12ec3b45ca50a675005cf5d336a4e496">__ssl_setup</a></div><div class="ttdeci">static int __ssl_setup(struct ast_tls_config *cfg, int client)</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d9b/tcptls_8c_source.html#l00382">tcptls.c:382</a></div></div>
<div class="ttc" id="logger_8h_html_aced66975c154ea0e2a8ec3bc818b4e08"><div class="ttname"><a href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a></div><div class="ttdeci">#define LOG_ERROR</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d8c/logger_8h_source.html#l00285">logger.h:285</a></div></div>
<div class="ttc" id="main_2stdtime_2private_8h_html_ad65a8842cc674e3ddf69355898c0ecbf"><div class="ttname"><a href="../../d1/d6e/main_2stdtime_2private_8h.html#ad65a8842cc674e3ddf69355898c0ecbf">errno</a></div><div class="ttdeci">int errno</div></div>
<div class="ttc" id="netsock2_8h_html_aae9156c7fe6dff51463f29ed1c3b96c9"><div class="ttname"><a href="../../db/df1/netsock2_8h.html#aae9156c7fe6dff51463f29ed1c3b96c9">ast_sockaddr_stringify</a></div><div class="ttdeci">static char * ast_sockaddr_stringify(const struct ast_sockaddr *addr)</div><div class="ttdoc">Wrapper around ast_sockaddr_stringify_fmt() with default format. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/df1/netsock2_8h_source.html#l00260">netsock2.h:260</a></div></div>
<div class="ttc" id="utils_8h_html_ac2456bee4128b33d0fa35e8382a2038c"><div class="ttname"><a href="../../d5/d60/utils_8h.html#ac2456bee4128b33d0fa35e8382a2038c">ast_fd_clear_flags</a></div><div class="ttdeci">#define ast_fd_clear_flags(fd, flags)</div><div class="ttdoc">Clear flags on the given file descriptor. </div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d60/utils_8h_source.html#l01025">utils.h:1025</a></div></div>
<div class="ttc" id="structast__tcptls__session__args_html_a8f8f80d37794cde9472343e4487ba3eb"><div class="ttname"><a href="../../da/d2b/structast__tcptls__session__args.html#a8f8f80d37794cde9472343e4487ba3eb">ast_tcptls_session_args::name</a></div><div class="ttdeci">const char * name</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/ddf/tcptls_8h_source.html#l00142">tcptls.h:142</a></div></div>
<div class="ttc" id="structast__tcptls__session__args_html_ad6d7a8463d59a02084cf9d4360f46b79"><div class="ttname"><a href="../../da/d2b/structast__tcptls__session__args.html#ad6d7a8463d59a02084cf9d4360f46b79">ast_tcptls_session_args::accept_fd</a></div><div class="ttdeci">int accept_fd</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/ddf/tcptls_8h_source.html#l00135">tcptls.h:135</a></div></div>
<div class="ttc" id="structast__tcptls__session__args_html_aeb4a21e3ae033a326cc9dfd20a7ab074"><div class="ttname"><a href="../../da/d2b/structast__tcptls__session__args.html#aeb4a21e3ae033a326cc9dfd20a7ab074">ast_tcptls_session_args::tls_cfg</a></div><div class="ttdeci">struct ast_tls_config * tls_cfg</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/ddf/tcptls_8h_source.html#l00134">tcptls.h:134</a></div></div>
<div class="ttc" id="netsock2_8h_html_a16d4f77ca9af75e4afb60accca62e819"><div class="ttname"><a href="../../db/df1/netsock2_8h.html#a16d4f77ca9af75e4afb60accca62e819">ast_connect</a></div><div class="ttdeci">int ast_connect(int sockfd, const struct ast_sockaddr *addr)</div><div class="ttdoc">Wrapper around connect(2) that uses struct ast_sockaddr. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d27/netsock2_8c_source.html#l00595">netsock2.c:595</a></div></div>
<div class="ttc" id="structast__tls__config_html_a03e6cca0c879c0443efb431c30c14f76"><div class="ttname"><a href="../../d5/d90/structast__tls__config.html#a03e6cca0c879c0443efb431c30c14f76">ast_tls_config::enabled</a></div><div class="ttdeci">int enabled</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/ddf/tcptls_8h_source.html#l00088">tcptls.h:88</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="adea645492f53ec11186b84eaf85e14d9"></a>
<h2 class="memtitle"><span class="permalink"><a href="#adea645492f53ec11186b84eaf85e14d9">&#9670;&nbsp;</a></span>ast_tcptls_close_session_file()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ast_tcptls_close_session_file </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="../../d6/d49/structast__tcptls__session__instance.html">ast_tcptls_session_instance</a> *&#160;</td>
          <td class="paramname"><em>tcptls_session</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Closes a tcptls session instance's file and/or file descriptor. The tcptls_session will be set to NULL and it's file descriptor will be set to -1 by this function. </p>

<p class="definition">Definition at line <a class="el" href="../../dc/d9b/tcptls_8c_source.html#l00839">839</a> of file <a class="el" href="../../dc/d9b/tcptls_8c_source.html">tcptls.c</a>.</p>

<p class="reference">References <a class="el" href="../../d1/d8c/logger_8h_source.html#l00452">ast_debug</a>, <a class="el" href="../../d1/dc8/iostream_8c_source.html#l00528">ast_iostream_close()</a>, <a class="el" href="../../dc/d7f/resample_8c_source.html#l00096">NULL</a>, and <a class="el" href="../../d4/ddf/tcptls_8h_source.html#l00160">ast_tcptls_session_instance::stream</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../d5/dfe/chan__sip_8c_source.html#l02985">_sip_tcp_helper_thread()</a>, <a class="el" href="../../dd/d43/http_8c_source.html#l00567">ast_http_create_response()</a>, <a class="el" href="../../dd/d43/http_8c_source.html#l00456">ast_http_send()</a>, <a class="el" href="../../dc/d9b/tcptls_8c_source.html#l00140">handle_tcptls_connection()</a>, <a class="el" href="../../dd/d43/http_8c_source.html#l01937">httpd_helper_thread()</a>, and <a class="el" href="../../d5/dfe/chan__sip_8c_source.html#l29578">sip_prepare_socket()</a>.</p>
<div class="fragment"><div class="line"><a name="l00840"></a><span class="lineno">  840</span>&#160;{</div><div class="line"><a name="l00841"></a><span class="lineno">  841</span>&#160;   <span class="keywordflow">if</span> (tcptls_session-&gt;<a class="code" href="../../d6/d49/structast__tcptls__session__instance.html#a36ac2dd734607a43ed90acb7e9d81ac5">stream</a>) {</div><div class="line"><a name="l00842"></a><span class="lineno">  842</span>&#160;      <a class="code" href="../../dd/d27/iostream_8h.html#ac0297067e6921ce6a2c5f3b3d0647d3a">ast_iostream_close</a>(tcptls_session-&gt;<a class="code" href="../../d6/d49/structast__tcptls__session__instance.html#a36ac2dd734607a43ed90acb7e9d81ac5">stream</a>);</div><div class="line"><a name="l00843"></a><span class="lineno">  843</span>&#160;      tcptls_session-&gt;<a class="code" href="../../d6/d49/structast__tcptls__session__instance.html#a36ac2dd734607a43ed90acb7e9d81ac5">stream</a> = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l00844"></a><span class="lineno">  844</span>&#160;   } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00845"></a><span class="lineno">  845</span>&#160;      <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(1, <span class="stringliteral">&quot;ast_tcptls_close_session_file invoked on session instance without file or file descriptor\n&quot;</span>);</div><div class="line"><a name="l00846"></a><span class="lineno">  846</span>&#160;   }</div><div class="line"><a name="l00847"></a><span class="lineno">  847</span>&#160;}</div><div class="ttc" id="resample_8c_html_a070d2ce7b6bb7e5c05602aa8c308d0c4"><div class="ttname"><a href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a></div><div class="ttdeci">#define NULL</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d7f/resample_8c_source.html#l00096">resample.c:96</a></div></div>
<div class="ttc" id="logger_8h_html_a3f248112c8d6ce7e3959aa723dade648"><div class="ttname"><a href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a></div><div class="ttdeci">#define ast_debug(level,...)</div><div class="ttdoc">Log a DEBUG message. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d8c/logger_8h_source.html#l00452">logger.h:452</a></div></div>
<div class="ttc" id="iostream_8h_html_ac0297067e6921ce6a2c5f3b3d0647d3a"><div class="ttname"><a href="../../dd/d27/iostream_8h.html#ac0297067e6921ce6a2c5f3b3d0647d3a">ast_iostream_close</a></div><div class="ttdeci">int ast_iostream_close(struct ast_iostream *stream)</div><div class="ttdoc">Close an iostream. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/dc8/iostream_8c_source.html#l00528">iostream.c:528</a></div></div>
<div class="ttc" id="structast__tcptls__session__instance_html_a36ac2dd734607a43ed90acb7e9d81ac5"><div class="ttname"><a href="../../d6/d49/structast__tcptls__session__instance.html#a36ac2dd734607a43ed90acb7e9d81ac5">ast_tcptls_session_instance::stream</a></div><div class="ttdeci">struct ast_iostream * stream</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/ddf/tcptls_8h_source.html#l00160">tcptls.h:160</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="ac1fd2d3038c57a8f8f28f4b558eb5583"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac1fd2d3038c57a8f8f28f4b558eb5583">&#9670;&nbsp;</a></span>ast_tcptls_server_root()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void* ast_tcptls_server_root </td>
          <td>(</td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="../../dc/d9b/tcptls_8c_source.html#l00280">280</a> of file <a class="el" href="../../dc/d9b/tcptls_8c_source.html">tcptls.c</a>.</p>

<p class="reference">References <a class="el" href="../../d4/ddf/tcptls_8h_source.html#l00135">ast_tcptls_session_args::accept_fd</a>, <a class="el" href="../../d5/da5/astobj2_8h_source.html#l00411">ao2_alloc</a>, <a class="el" href="../../d5/da5/astobj2_8h_source.html#l00464">ao2_ref</a>, <a class="el" href="../../d4/d27/netsock2_8c_source.html#l00584">ast_accept()</a>, <a class="el" href="../../d5/d60/utils_8h_source.html#l01025">ast_fd_clear_flags</a>, <a class="el" href="../../d1/dc8/iostream_8c_source.html#l00604">ast_iostream_from_fd()</a>, <a class="el" href="../../da/df7/astobj2_8c_source.html#l00042">ast_log</a>, <a class="el" href="../../d5/d60/utils_8h_source.html#l00572">ast_pthread_create_detached_background</a>, <a class="el" href="../../db/df1/netsock2_8h_source.html#l00171">ast_sockaddr_copy()</a>, <a class="el" href="../../db/df1/netsock2_8h_source.html#l00260">ast_sockaddr_stringify()</a>, <a class="el" href="../../d6/d90/strings_8h_source.html#l00620">ast_str_create</a>, <a class="el" href="../../de/d1f/main_2utils_8c_source.html#l01519">ast_wait_for_input()</a>, <a class="el" href="../../d4/ddf/tcptls_8h_source.html#l00150">ast_tcptls_session_instance::client</a>, <a class="el" href="../../d0/d29/cdr__mysql_8c_source.html#l00073">desc</a>, <a class="el" href="../../d1/d6e/main_2stdtime_2private_8h.html#ad65a8842cc674e3ddf69355898c0ecbf">errno</a>, <a class="el" href="../../dc/d9b/tcptls_8c_source.html#l00140">handle_tcptls_connection()</a>, <a class="el" href="../../d1/d8c/logger_8h_source.html#l00285">LOG_ERROR</a>, <a class="el" href="../../dc/d7f/resample_8c_source.html#l00096">NULL</a>, <a class="el" href="../../d4/ddf/tcptls_8h_source.html#l00158">ast_tcptls_session_instance::overflow_buf</a>, <a class="el" href="../../d4/ddf/tcptls_8h_source.html#l00152">ast_tcptls_session_instance::parent</a>, <a class="el" href="../../d4/ddf/tcptls_8h_source.html#l00140">ast_tcptls_session_args::periodic_fn</a>, <a class="el" href="../../d4/ddf/tcptls_8h_source.html#l00136">ast_tcptls_session_args::poll_timeout</a>, <a class="el" href="../../d4/ddf/tcptls_8h_source.html#l00151">ast_tcptls_session_instance::remote_address</a>, <a class="el" href="../../dc/d9b/tcptls_8c_source.html#l00072">session_instance_destructor()</a>, and <a class="el" href="../../d4/ddf/tcptls_8h_source.html#l00160">ast_tcptls_session_instance::stream</a>.</p>
<div class="fragment"><div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;{</div><div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../da/d2b/structast__tcptls__session__args.html">ast_tcptls_session_args</a> *<a class="code" href="../../d0/d29/cdr__mysql_8c.html#a787f82faccb7c1f40a2539a14855601b">desc</a> = data;</div><div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;   <span class="keywordtype">int</span> fd;</div><div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d3/db3/structast__sockaddr.html">ast_sockaddr</a> addr;</div><div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d6/d49/structast__tcptls__session__instance.html">ast_tcptls_session_instance</a> *tcptls_session;</div><div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;   pthread_t launched;</div><div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;</div><div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;   <span class="keywordflow">for</span> (;;) {</div><div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;      <span class="keywordtype">int</span> i;</div><div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;</div><div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;      <span class="keywordflow">if</span> (desc-&gt;<a class="code" href="../../da/d2b/structast__tcptls__session__args.html#a5f9d338c62d7115400d1c36e687c010f">periodic_fn</a>) {</div><div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;         desc-&gt;<a class="code" href="../../da/d2b/structast__tcptls__session__args.html#a5f9d338c62d7115400d1c36e687c010f">periodic_fn</a>(desc);</div><div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;      }</div><div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;      i = <a class="code" href="../../d5/d60/utils_8h.html#a60404ef44696316455e79c3a002cc71e">ast_wait_for_input</a>(desc-&gt;<a class="code" href="../../da/d2b/structast__tcptls__session__args.html#ad6d7a8463d59a02084cf9d4360f46b79">accept_fd</a>, desc-&gt;<a class="code" href="../../da/d2b/structast__tcptls__session__args.html#ad4d3065dbbbbf8dc07f813869fccb11a">poll_timeout</a>);</div><div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;      <span class="keywordflow">if</span> (i &lt;= 0) {</div><div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;         <span class="comment">/* Prevent tight loop from hogging CPU */</span></div><div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;         usleep(1);</div><div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;         <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;      }</div><div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;      fd = <a class="code" href="../../db/df1/netsock2_8h.html#a84c24a7f016faea067015e805ef6e57b">ast_accept</a>(desc-&gt;<a class="code" href="../../da/d2b/structast__tcptls__session__args.html#ad6d7a8463d59a02084cf9d4360f46b79">accept_fd</a>, &amp;addr);</div><div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;      <span class="keywordflow">if</span> (fd &lt; 0) {</div><div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;         <span class="keywordflow">if</span> (<a class="code" href="../../d1/d6e/main_2stdtime_2private_8h.html#ad65a8842cc674e3ddf69355898c0ecbf">errno</a> != EAGAIN</div><div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;            &amp;&amp; <a class="code" href="../../d1/d6e/main_2stdtime_2private_8h.html#ad65a8842cc674e3ddf69355898c0ecbf">errno</a> != EWOULDBLOCK</div><div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;            &amp;&amp; <a class="code" href="../../d1/d6e/main_2stdtime_2private_8h.html#ad65a8842cc674e3ddf69355898c0ecbf">errno</a> != EINTR</div><div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;            &amp;&amp; <a class="code" href="../../d1/d6e/main_2stdtime_2private_8h.html#ad65a8842cc674e3ddf69355898c0ecbf">errno</a> != ECONNABORTED) {</div><div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;            <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;TCP/TLS accept failed: %s\n&quot;</span>, strerror(<a class="code" href="../../d1/d6e/main_2stdtime_2private_8h.html#ad65a8842cc674e3ddf69355898c0ecbf">errno</a>));</div><div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;            <span class="keywordflow">if</span> (<a class="code" href="../../d1/d6e/main_2stdtime_2private_8h.html#ad65a8842cc674e3ddf69355898c0ecbf">errno</a> != EMFILE) {</div><div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;               <span class="keywordflow">break</span>;</div><div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;            }</div><div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;         }</div><div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;         <span class="comment">/* Prevent tight loop from hogging CPU */</span></div><div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;         usleep(1);</div><div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;         <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;      }</div><div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;      tcptls_session = <a class="code" href="../../d5/da5/astobj2_8h.html#ae0422b60d8e25b6962b2d61ae4ddf724">ao2_alloc</a>(<span class="keyword">sizeof</span>(*tcptls_session), <a class="code" href="../../dc/d9b/tcptls_8c.html#a5914d0d7ed685b4de9807f245de8fe69">session_instance_destructor</a>);</div><div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;      <span class="keywordflow">if</span> (!tcptls_session) {</div><div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;         close(fd);</div><div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;         <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;      }</div><div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;</div><div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;      tcptls_session-&gt;<a class="code" href="../../d6/d49/structast__tcptls__session__instance.html#af4e119b2a262dea0fce95abe3c7996c8">overflow_buf</a> = <a class="code" href="../../d6/d90/strings_8h.html#a9c34c6c6b8daaba24c0406270f3cf697">ast_str_create</a>(128);</div><div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;      <span class="keywordflow">if</span> (!tcptls_session-&gt;<a class="code" href="../../d6/d49/structast__tcptls__session__instance.html#af4e119b2a262dea0fce95abe3c7996c8">overflow_buf</a>) {</div><div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;         <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(tcptls_session, -1);</div><div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;         close(fd);</div><div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;         <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;      }</div><div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;      <a class="code" href="../../d5/d60/utils_8h.html#ac2456bee4128b33d0fa35e8382a2038c">ast_fd_clear_flags</a>(fd, O_NONBLOCK);</div><div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;</div><div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;      tcptls_session-&gt;<a class="code" href="../../d6/d49/structast__tcptls__session__instance.html#a36ac2dd734607a43ed90acb7e9d81ac5">stream</a> = <a class="code" href="../../dd/d27/iostream_8h.html#a5dd1ed6f7ebb56180cc9f953db97f0fd">ast_iostream_from_fd</a>(&amp;fd);</div><div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;      <span class="keywordflow">if</span> (!tcptls_session-&gt;<a class="code" href="../../d6/d49/structast__tcptls__session__instance.html#a36ac2dd734607a43ed90acb7e9d81ac5">stream</a>) {</div><div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;         <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(tcptls_session, -1);</div><div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;         close(fd);</div><div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;         <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;      }</div><div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;</div><div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;      tcptls_session-&gt;<a class="code" href="../../d6/d49/structast__tcptls__session__instance.html#ac7fc8bed1104b4557f6a183ae1155b75">parent</a> = <a class="code" href="../../d0/d29/cdr__mysql_8c.html#a787f82faccb7c1f40a2539a14855601b">desc</a>;</div><div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;      <a class="code" href="../../db/df1/netsock2_8h.html#a56a46003c93bfd65111ea8ffc97af8f9">ast_sockaddr_copy</a>(&amp;tcptls_session-&gt;<a class="code" href="../../d6/d49/structast__tcptls__session__instance.html#a9dfcf41ffc851689eea95be7bb1f849a">remote_address</a>, &amp;addr);</div><div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;</div><div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;      tcptls_session-&gt;<a class="code" href="../../d6/d49/structast__tcptls__session__instance.html#a4bf947cca001e8ca0cd9def2b8d058c7">client</a> = 0;</div><div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;</div><div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;      <span class="comment">/* This thread is now the only place that controls the single ref to tcptls_session */</span></div><div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="../../d5/d60/utils_8h.html#aa73be876e3a4024b91ce2e09d8b945d1">ast_pthread_create_detached_background</a>(&amp;launched, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../dc/d9b/tcptls_8c.html#aa7a554acdb67dd3845edc19c99cdf2d2">handle_tcptls_connection</a>, tcptls_session)) {</div><div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;         <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;TCP/TLS unable to launch helper thread for peer &#39;%s&#39;: %s\n&quot;</span>,</div><div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;            <a class="code" href="../../db/df1/netsock2_8h.html#aae9156c7fe6dff51463f29ed1c3b96c9">ast_sockaddr_stringify</a>(&amp;tcptls_session-&gt;<a class="code" href="../../d6/d49/structast__tcptls__session__instance.html#a9dfcf41ffc851689eea95be7bb1f849a">remote_address</a>),</div><div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;            strerror(<a class="code" href="../../d1/d6e/main_2stdtime_2private_8h.html#ad65a8842cc674e3ddf69355898c0ecbf">errno</a>));</div><div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;         <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(tcptls_session, -1);</div><div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;      }</div><div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;   }</div><div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;</div><div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;   <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;TCP/TLS listener thread ended abnormally\n&quot;</span>);</div><div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;</div><div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;   <span class="comment">/* Close the listener socket so Asterisk doesn&#39;t appear dead. */</span></div><div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;   fd = desc-&gt;<a class="code" href="../../da/d2b/structast__tcptls__session__args.html#ad6d7a8463d59a02084cf9d4360f46b79">accept_fd</a>;</div><div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;   desc-&gt;<a class="code" href="../../da/d2b/structast__tcptls__session__args.html#ad6d7a8463d59a02084cf9d4360f46b79">accept_fd</a> = -1;</div><div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;   <span class="keywordflow">if</span> (0 &lt;= fd) {</div><div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;      close(fd);</div><div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;   }</div><div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;   <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;}</div><div class="ttc" id="structast__tcptls__session__args_html_ad4d3065dbbbbf8dc07f813869fccb11a"><div class="ttname"><a href="../../da/d2b/structast__tcptls__session__args.html#ad4d3065dbbbbf8dc07f813869fccb11a">ast_tcptls_session_args::poll_timeout</a></div><div class="ttdeci">int poll_timeout</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/ddf/tcptls_8h_source.html#l00136">tcptls.h:136</a></div></div>
<div class="ttc" id="structast__tcptls__session__args_html_a5f9d338c62d7115400d1c36e687c010f"><div class="ttname"><a href="../../da/d2b/structast__tcptls__session__args.html#a5f9d338c62d7115400d1c36e687c010f">ast_tcptls_session_args::periodic_fn</a></div><div class="ttdeci">void(* periodic_fn)(void *)</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/ddf/tcptls_8h_source.html#l00140">tcptls.h:140</a></div></div>
<div class="ttc" id="netsock2_8h_html_a56a46003c93bfd65111ea8ffc97af8f9"><div class="ttname"><a href="../../db/df1/netsock2_8h.html#a56a46003c93bfd65111ea8ffc97af8f9">ast_sockaddr_copy</a></div><div class="ttdeci">static void ast_sockaddr_copy(struct ast_sockaddr *dst, const struct ast_sockaddr *src)</div><div class="ttdoc">Copies the data from one ast_sockaddr to another. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/df1/netsock2_8h_source.html#l00171">netsock2.h:171</a></div></div>
<div class="ttc" id="structast__tcptls__session__instance_html_a4bf947cca001e8ca0cd9def2b8d058c7"><div class="ttname"><a href="../../d6/d49/structast__tcptls__session__instance.html#a4bf947cca001e8ca0cd9def2b8d058c7">ast_tcptls_session_instance::client</a></div><div class="ttdeci">int client</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/ddf/tcptls_8h_source.html#l00150">tcptls.h:150</a></div></div>
<div class="ttc" id="structast__tcptls__session__instance_html_af4e119b2a262dea0fce95abe3c7996c8"><div class="ttname"><a href="../../d6/d49/structast__tcptls__session__instance.html#af4e119b2a262dea0fce95abe3c7996c8">ast_tcptls_session_instance::overflow_buf</a></div><div class="ttdeci">struct ast_str * overflow_buf</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/ddf/tcptls_8h_source.html#l00158">tcptls.h:158</a></div></div>
<div class="ttc" id="structast__tcptls__session__instance_html_ac7fc8bed1104b4557f6a183ae1155b75"><div class="ttname"><a href="../../d6/d49/structast__tcptls__session__instance.html#ac7fc8bed1104b4557f6a183ae1155b75">ast_tcptls_session_instance::parent</a></div><div class="ttdeci">struct ast_tcptls_session_args * parent</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/ddf/tcptls_8h_source.html#l00152">tcptls.h:152</a></div></div>
<div class="ttc" id="tcptls_8c_html_aa7a554acdb67dd3845edc19c99cdf2d2"><div class="ttname"><a href="../../dc/d9b/tcptls_8c.html#aa7a554acdb67dd3845edc19c99cdf2d2">handle_tcptls_connection</a></div><div class="ttdeci">static void * handle_tcptls_connection(void *data)</div><div class="ttdoc">creates a FILE * from the fd passed by the accept thread. This operation is potentially expensive (ce...</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d9b/tcptls_8c_source.html#l00140">tcptls.c:140</a></div></div>
<div class="ttc" id="cdr__mysql_8c_html_a787f82faccb7c1f40a2539a14855601b"><div class="ttname"><a href="../../d0/d29/cdr__mysql_8c.html#a787f82faccb7c1f40a2539a14855601b">desc</a></div><div class="ttdeci">static const char desc[]</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d29/cdr__mysql_8c_source.html#l00073">cdr_mysql.c:73</a></div></div>
<div class="ttc" id="iostream_8h_html_a5dd1ed6f7ebb56180cc9f953db97f0fd"><div class="ttname"><a href="../../dd/d27/iostream_8h.html#a5dd1ed6f7ebb56180cc9f953db97f0fd">ast_iostream_from_fd</a></div><div class="ttdeci">struct ast_iostream * ast_iostream_from_fd(int *fd)</div><div class="ttdoc">Create an iostream from a file descriptor. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/dc8/iostream_8c_source.html#l00604">iostream.c:604</a></div></div>
<div class="ttc" id="structast__tcptls__session__args_html"><div class="ttname"><a href="../../da/d2b/structast__tcptls__session__args.html">ast_tcptls_session_args</a></div><div class="ttdoc">arguments for the accepting thread </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/ddf/tcptls_8h_source.html#l00129">tcptls.h:129</a></div></div>
<div class="ttc" id="resample_8c_html_a070d2ce7b6bb7e5c05602aa8c308d0c4"><div class="ttname"><a href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a></div><div class="ttdeci">#define NULL</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d7f/resample_8c_source.html#l00096">resample.c:96</a></div></div>
<div class="ttc" id="structast__sockaddr_html"><div class="ttname"><a href="../../d3/db3/structast__sockaddr.html">ast_sockaddr</a></div><div class="ttdoc">Socket address structure. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/df1/netsock2_8h_source.html#l00097">netsock2.h:97</a></div></div>
<div class="ttc" id="utils_8h_html_aa73be876e3a4024b91ce2e09d8b945d1"><div class="ttname"><a href="../../d5/d60/utils_8h.html#aa73be876e3a4024b91ce2e09d8b945d1">ast_pthread_create_detached_background</a></div><div class="ttdeci">#define ast_pthread_create_detached_background(a, b, c, d)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d60/utils_8h_source.html#l00572">utils.h:572</a></div></div>
<div class="ttc" id="astobj2_8c_html_a96a00b3a518d7f32b6d51dc28f09bf9b"><div class="ttname"><a href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a></div><div class="ttdeci">#define ast_log</div><div class="ttdef"><b>Definition:</b> <a href="../../da/df7/astobj2_8c_source.html#l00042">astobj2.c:42</a></div></div>
<div class="ttc" id="netsock2_8h_html_a84c24a7f016faea067015e805ef6e57b"><div class="ttname"><a href="../../db/df1/netsock2_8h.html#a84c24a7f016faea067015e805ef6e57b">ast_accept</a></div><div class="ttdeci">int ast_accept(int sockfd, struct ast_sockaddr *addr)</div><div class="ttdoc">Wrapper around accept(2) that uses struct ast_sockaddr. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d27/netsock2_8c_source.html#l00584">netsock2.c:584</a></div></div>
<div class="ttc" id="astobj2_8h_html_aaca5e8eac39a22f9da1c36fc6c922270"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a></div><div class="ttdeci">#define ao2_ref(o, delta)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l00464">astobj2.h:464</a></div></div>
<div class="ttc" id="structast__tcptls__session__instance_html"><div class="ttname"><a href="../../d6/d49/structast__tcptls__session__instance.html">ast_tcptls_session_instance</a></div><div class="ttdoc">describes a server instance </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/ddf/tcptls_8h_source.html#l00149">tcptls.h:149</a></div></div>
<div class="ttc" id="logger_8h_html_aced66975c154ea0e2a8ec3bc818b4e08"><div class="ttname"><a href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a></div><div class="ttdeci">#define LOG_ERROR</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d8c/logger_8h_source.html#l00285">logger.h:285</a></div></div>
<div class="ttc" id="main_2stdtime_2private_8h_html_ad65a8842cc674e3ddf69355898c0ecbf"><div class="ttname"><a href="../../d1/d6e/main_2stdtime_2private_8h.html#ad65a8842cc674e3ddf69355898c0ecbf">errno</a></div><div class="ttdeci">int errno</div></div>
<div class="ttc" id="netsock2_8h_html_aae9156c7fe6dff51463f29ed1c3b96c9"><div class="ttname"><a href="../../db/df1/netsock2_8h.html#aae9156c7fe6dff51463f29ed1c3b96c9">ast_sockaddr_stringify</a></div><div class="ttdeci">static char * ast_sockaddr_stringify(const struct ast_sockaddr *addr)</div><div class="ttdoc">Wrapper around ast_sockaddr_stringify_fmt() with default format. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/df1/netsock2_8h_source.html#l00260">netsock2.h:260</a></div></div>
<div class="ttc" id="astobj2_8h_html_ae0422b60d8e25b6962b2d61ae4ddf724"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#ae0422b60d8e25b6962b2d61ae4ddf724">ao2_alloc</a></div><div class="ttdeci">#define ao2_alloc(data_size, destructor_fn)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l00411">astobj2.h:411</a></div></div>
<div class="ttc" id="tcptls_8c_html_a5914d0d7ed685b4de9807f245de8fe69"><div class="ttname"><a href="../../dc/d9b/tcptls_8c.html#a5914d0d7ed685b4de9807f245de8fe69">session_instance_destructor</a></div><div class="ttdeci">static void session_instance_destructor(void *obj)</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d9b/tcptls_8c_source.html#l00072">tcptls.c:72</a></div></div>
<div class="ttc" id="utils_8h_html_ac2456bee4128b33d0fa35e8382a2038c"><div class="ttname"><a href="../../d5/d60/utils_8h.html#ac2456bee4128b33d0fa35e8382a2038c">ast_fd_clear_flags</a></div><div class="ttdeci">#define ast_fd_clear_flags(fd, flags)</div><div class="ttdoc">Clear flags on the given file descriptor. </div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d60/utils_8h_source.html#l01025">utils.h:1025</a></div></div>
<div class="ttc" id="structast__tcptls__session__instance_html_a36ac2dd734607a43ed90acb7e9d81ac5"><div class="ttname"><a href="../../d6/d49/structast__tcptls__session__instance.html#a36ac2dd734607a43ed90acb7e9d81ac5">ast_tcptls_session_instance::stream</a></div><div class="ttdeci">struct ast_iostream * stream</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/ddf/tcptls_8h_source.html#l00160">tcptls.h:160</a></div></div>
<div class="ttc" id="structast__tcptls__session__args_html_ad6d7a8463d59a02084cf9d4360f46b79"><div class="ttname"><a href="../../da/d2b/structast__tcptls__session__args.html#ad6d7a8463d59a02084cf9d4360f46b79">ast_tcptls_session_args::accept_fd</a></div><div class="ttdeci">int accept_fd</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/ddf/tcptls_8h_source.html#l00135">tcptls.h:135</a></div></div>
<div class="ttc" id="utils_8h_html_a60404ef44696316455e79c3a002cc71e"><div class="ttname"><a href="../../d5/d60/utils_8h.html#a60404ef44696316455e79c3a002cc71e">ast_wait_for_input</a></div><div class="ttdeci">int ast_wait_for_input(int fd, int ms)</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d1f/main_2utils_8c_source.html#l01519">main/utils.c:1519</a></div></div>
<div class="ttc" id="strings_8h_html_a9c34c6c6b8daaba24c0406270f3cf697"><div class="ttname"><a href="../../d6/d90/strings_8h.html#a9c34c6c6b8daaba24c0406270f3cf697">ast_str_create</a></div><div class="ttdeci">#define ast_str_create(init_len)</div><div class="ttdoc">Create a malloc&amp;#39;ed dynamic length string. </div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d90/strings_8h_source.html#l00620">strings.h:620</a></div></div>
<div class="ttc" id="structast__tcptls__session__instance_html_a9dfcf41ffc851689eea95be7bb1f849a"><div class="ttname"><a href="../../d6/d49/structast__tcptls__session__instance.html#a9dfcf41ffc851689eea95be7bb1f849a">ast_tcptls_session_instance::remote_address</a></div><div class="ttdeci">struct ast_sockaddr remote_address</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/ddf/tcptls_8h_source.html#l00151">tcptls.h:151</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a29375a4482c8de1e9879b97be2e88bf0"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a29375a4482c8de1e9879b97be2e88bf0">&#9670;&nbsp;</a></span>ast_tcptls_server_start()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ast_tcptls_server_start </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="../../da/d2b/structast__tcptls__session__args.html">ast_tcptls_session_args</a> *&#160;</td>
          <td class="paramname"><em>desc</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>This is a generic (re)start routine for a TCP server, which does the socket/bind/listen and starts a thread for handling accept(). </p>
<dl class="section version"><dt>Version</dt><dd>1.6.1 changed desc parameter to be of <a class="el" href="../../da/d2b/structast__tcptls__session__args.html" title="arguments for the accepting thread ">ast_tcptls_session_args</a> type </dd></dl>

<p class="definition">Definition at line <a class="el" href="../../dc/d9b/tcptls_8c_source.html#l00685">685</a> of file <a class="el" href="../../dc/d9b/tcptls_8c_source.html">tcptls.c</a>.</p>

<p class="reference">References <a class="el" href="../../d4/ddf/tcptls_8h_source.html#l00135">ast_tcptls_session_args::accept_fd</a>, <a class="el" href="../../d4/ddf/tcptls_8h_source.html#l00139">ast_tcptls_session_args::accept_fn</a>, <a class="el" href="../../d4/d27/netsock2_8c_source.html#l00590">ast_bind()</a>, <a class="el" href="../../d8/d8a/astmm_8h_source.html#l00204">ast_calloc</a>, <a class="el" href="../../d1/d8c/logger_8h_source.html#l00452">ast_debug</a>, <a class="el" href="../../d8/d8a/astmm_8h_source.html#l00182">ast_free</a>, <a class="el" href="../../da/df7/astobj2_8c_source.html#l00042">ast_log</a>, <a class="el" href="../../d5/d60/utils_8h_source.html#l00567">ast_pthread_create_background</a>, <a class="el" href="../../dd/d42/lock_8h_source.html#l00066">AST_PTHREADT_NULL</a>, <a class="el" href="../../d3/d83/main_2app_8c_source.html#l02792">ast_read_textfile()</a>, <a class="el" href="../../df/d0a/io_8c_source.html#l00438">ast_sd_get_fd()</a>, <a class="el" href="../../de/d1f/main_2utils_8c_source.html#l00264">ast_sha1_hash()</a>, <a class="el" href="../../d4/d27/netsock2_8c_source.html#l00388">ast_sockaddr_cmp()</a>, <a class="el" href="../../db/df1/netsock2_8h_source.html#l00171">ast_sockaddr_copy()</a>, <a class="el" href="../../d4/d27/netsock2_8c_source.html#l00524">ast_sockaddr_is_ipv6()</a>, <a class="el" href="../../db/df1/netsock2_8h_source.html#l00127">ast_sockaddr_isnull()</a>, <a class="el" href="../../db/df1/netsock2_8h_source.html#l00140">ast_sockaddr_setnull()</a>, <a class="el" href="../../db/df1/netsock2_8h_source.html#l00260">ast_sockaddr_stringify()</a>, <a class="el" href="../../d5/d60/utils_8h_source.html#l01043">ast_socket_nonblock</a>, <a class="el" href="../../d8/d8a/astmm_8h_source.html#l00243">ast_strdup</a>, <a class="el" href="../../d4/ddf/tcptls_8h_source.html#l00092">ast_tls_config::cafile</a>, <a class="el" href="../../d4/ddf/tcptls_8h_source.html#l00098">ast_tls_config::cahash</a>, <a class="el" href="../../d4/ddf/tcptls_8h_source.html#l00093">ast_tls_config::capath</a>, <a class="el" href="../../d4/ddf/tcptls_8h_source.html#l00089">ast_tls_config::certfile</a>, <a class="el" href="../../d4/ddf/tcptls_8h_source.html#l00096">ast_tls_config::certhash</a>, <a class="el" href="../../d4/ddf/tcptls_8h_source.html#l00091">ast_tls_config::cipher</a>, <a class="el" href="../../d1/d6e/main_2stdtime_2private_8h.html#ad65a8842cc674e3ddf69355898c0ecbf">errno</a>, <a class="el" href="../../d6/d47/utils_2frame_8c_source.html#l00999">error()</a>, <a class="el" href="../../d4/ddf/tcptls_8h_source.html#l00094">ast_tls_config::flags</a>, <a class="el" href="../../d4/ddf/tcptls_8h_source.html#l00130">ast_tcptls_session_args::local_address</a>, <a class="el" href="../../d1/d8c/logger_8h_source.html#l00285">LOG_ERROR</a>, <a class="el" href="../../d4/ddf/tcptls_8h_source.html#l00138">ast_tcptls_session_args::master</a>, <a class="el" href="../../d4/ddf/tcptls_8h_source.html#l00142">ast_tcptls_session_args::name</a>, <a class="el" href="../../dc/d7f/resample_8c_source.html#l00096">NULL</a>, <a class="el" href="../../d4/ddf/tcptls_8h_source.html#l00131">ast_tcptls_session_args::old_address</a>, <a class="el" href="../../d4/ddf/tcptls_8h_source.html#l00143">ast_tcptls_session_args::old_tls_cfg</a>, <a class="el" href="../../d4/ddf/tcptls_8h_source.html#l00090">ast_tls_config::pvtfile</a>, <a class="el" href="../../d4/ddf/tcptls_8h_source.html#l00097">ast_tls_config::pvthash</a>, <a class="el" href="../../de/dcd/app__jack_8c_source.html#l00147">str</a>, and <a class="el" href="../../d4/ddf/tcptls_8h_source.html#l00134">ast_tcptls_session_args::tls_cfg</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../dd/d43/http_8c_source.html#l02077">__ast_http_load()</a>, <a class="el" href="../../d4/d10/manager_8c_source.html#l09144">__init_manager()</a>, and <a class="el" href="../../d5/dfe/chan__sip_8c_source.html#l32514">reload_config()</a>.</p>
<div class="fragment"><div class="line"><a name="l00686"></a><span class="lineno">  686</span>&#160;{</div><div class="line"><a name="l00687"></a><span class="lineno">  687</span>&#160;   <span class="keywordtype">int</span> x = 1;</div><div class="line"><a name="l00688"></a><span class="lineno">  688</span>&#160;   <span class="keywordtype">int</span> tls_changed = 0;</div><div class="line"><a name="l00689"></a><span class="lineno">  689</span>&#160;   <span class="keywordtype">int</span> sd_socket;</div><div class="line"><a name="l00690"></a><span class="lineno">  690</span>&#160;</div><div class="line"><a name="l00691"></a><span class="lineno">  691</span>&#160;   <span class="keywordflow">if</span> (desc-&gt;<a class="code" href="../../da/d2b/structast__tcptls__session__args.html#aeb4a21e3ae033a326cc9dfd20a7ab074">tls_cfg</a>) {</div><div class="line"><a name="l00692"></a><span class="lineno">  692</span>&#160;      <span class="keywordtype">char</span> hash[41];</div><div class="line"><a name="l00693"></a><span class="lineno">  693</span>&#160;      <span class="keywordtype">char</span> *<a class="code" href="../../de/dcd/app__jack_8c.html#af25d6dc49269fa2003ac7c7fa6f13915">str</a> = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l00694"></a><span class="lineno">  694</span>&#160;      <span class="keyword">struct </span>stat st;</div><div class="line"><a name="l00695"></a><span class="lineno">  695</span>&#160;</div><div class="line"><a name="l00696"></a><span class="lineno">  696</span>&#160;      <span class="comment">/* Store the hashes of the TLS certificate etc. */</span></div><div class="line"><a name="l00697"></a><span class="lineno">  697</span>&#160;      <span class="keywordflow">if</span> (stat(desc-&gt;<a class="code" href="../../da/d2b/structast__tcptls__session__args.html#aeb4a21e3ae033a326cc9dfd20a7ab074">tls_cfg</a>-&gt;<a class="code" href="../../d5/d90/structast__tls__config.html#a333dffcec025fcdbee0676476f401685">certfile</a>, &amp;st) || <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a> == (str = <a class="code" href="../../d3/d93/include_2asterisk_2app_8h.html#ac5aea5ca8a190e3a89d29b74a09cdb3e">ast_read_textfile</a>(desc-&gt;<a class="code" href="../../da/d2b/structast__tcptls__session__args.html#aeb4a21e3ae033a326cc9dfd20a7ab074">tls_cfg</a>-&gt;<a class="code" href="../../d5/d90/structast__tls__config.html#a333dffcec025fcdbee0676476f401685">certfile</a>))) {</div><div class="line"><a name="l00698"></a><span class="lineno">  698</span>&#160;         memset(hash, 0, 41);</div><div class="line"><a name="l00699"></a><span class="lineno">  699</span>&#160;      } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00700"></a><span class="lineno">  700</span>&#160;         <a class="code" href="../../d5/d60/utils_8h.html#af35c6f780502c691f0ae35e1d0f7a444">ast_sha1_hash</a>(hash, str);</div><div class="line"><a name="l00701"></a><span class="lineno">  701</span>&#160;      }</div><div class="line"><a name="l00702"></a><span class="lineno">  702</span>&#160;      <a class="code" href="../../d8/d8a/astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(str);</div><div class="line"><a name="l00703"></a><span class="lineno">  703</span>&#160;      str = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l00704"></a><span class="lineno">  704</span>&#160;      memcpy(desc-&gt;<a class="code" href="../../da/d2b/structast__tcptls__session__args.html#aeb4a21e3ae033a326cc9dfd20a7ab074">tls_cfg</a>-&gt;<a class="code" href="../../d5/d90/structast__tls__config.html#adc8bd94310105dbfcf981a6d622c0b1c">certhash</a>, hash, 41);</div><div class="line"><a name="l00705"></a><span class="lineno">  705</span>&#160;      <span class="keywordflow">if</span> (stat(desc-&gt;<a class="code" href="../../da/d2b/structast__tcptls__session__args.html#aeb4a21e3ae033a326cc9dfd20a7ab074">tls_cfg</a>-&gt;<a class="code" href="../../d5/d90/structast__tls__config.html#a6005f11af6a60f4169876fcd075595ca">pvtfile</a>, &amp;st) || <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a> == (str = <a class="code" href="../../d3/d93/include_2asterisk_2app_8h.html#ac5aea5ca8a190e3a89d29b74a09cdb3e">ast_read_textfile</a>(desc-&gt;<a class="code" href="../../da/d2b/structast__tcptls__session__args.html#aeb4a21e3ae033a326cc9dfd20a7ab074">tls_cfg</a>-&gt;<a class="code" href="../../d5/d90/structast__tls__config.html#a6005f11af6a60f4169876fcd075595ca">pvtfile</a>))) {</div><div class="line"><a name="l00706"></a><span class="lineno">  706</span>&#160;         memset(hash, 0, 41);</div><div class="line"><a name="l00707"></a><span class="lineno">  707</span>&#160;      } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00708"></a><span class="lineno">  708</span>&#160;         <a class="code" href="../../d5/d60/utils_8h.html#af35c6f780502c691f0ae35e1d0f7a444">ast_sha1_hash</a>(hash, str);</div><div class="line"><a name="l00709"></a><span class="lineno">  709</span>&#160;      }</div><div class="line"><a name="l00710"></a><span class="lineno">  710</span>&#160;      <a class="code" href="../../d8/d8a/astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(str);</div><div class="line"><a name="l00711"></a><span class="lineno">  711</span>&#160;      str = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l00712"></a><span class="lineno">  712</span>&#160;      memcpy(desc-&gt;<a class="code" href="../../da/d2b/structast__tcptls__session__args.html#aeb4a21e3ae033a326cc9dfd20a7ab074">tls_cfg</a>-&gt;<a class="code" href="../../d5/d90/structast__tls__config.html#a14000c65e91ab34458e5a21f7c3d75fa">pvthash</a>, hash, 41);</div><div class="line"><a name="l00713"></a><span class="lineno">  713</span>&#160;      <span class="keywordflow">if</span> (stat(desc-&gt;<a class="code" href="../../da/d2b/structast__tcptls__session__args.html#aeb4a21e3ae033a326cc9dfd20a7ab074">tls_cfg</a>-&gt;<a class="code" href="../../d5/d90/structast__tls__config.html#a9ff8d56644bac1d41f8039f2fde5acf2">cafile</a>, &amp;st) || <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a> == (str = <a class="code" href="../../d3/d93/include_2asterisk_2app_8h.html#ac5aea5ca8a190e3a89d29b74a09cdb3e">ast_read_textfile</a>(desc-&gt;<a class="code" href="../../da/d2b/structast__tcptls__session__args.html#aeb4a21e3ae033a326cc9dfd20a7ab074">tls_cfg</a>-&gt;<a class="code" href="../../d5/d90/structast__tls__config.html#a9ff8d56644bac1d41f8039f2fde5acf2">cafile</a>))) {</div><div class="line"><a name="l00714"></a><span class="lineno">  714</span>&#160;         memset(hash, 0, 41);</div><div class="line"><a name="l00715"></a><span class="lineno">  715</span>&#160;      } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00716"></a><span class="lineno">  716</span>&#160;         <a class="code" href="../../d5/d60/utils_8h.html#af35c6f780502c691f0ae35e1d0f7a444">ast_sha1_hash</a>(hash, str);</div><div class="line"><a name="l00717"></a><span class="lineno">  717</span>&#160;      }</div><div class="line"><a name="l00718"></a><span class="lineno">  718</span>&#160;      <a class="code" href="../../d8/d8a/astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(str);</div><div class="line"><a name="l00719"></a><span class="lineno">  719</span>&#160;      str = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l00720"></a><span class="lineno">  720</span>&#160;      memcpy(desc-&gt;<a class="code" href="../../da/d2b/structast__tcptls__session__args.html#aeb4a21e3ae033a326cc9dfd20a7ab074">tls_cfg</a>-&gt;<a class="code" href="../../d5/d90/structast__tls__config.html#a5941a9fbcacdb17f1bf89f8f6a0af19b">cahash</a>, hash, 41);</div><div class="line"><a name="l00721"></a><span class="lineno">  721</span>&#160;</div><div class="line"><a name="l00722"></a><span class="lineno">  722</span>&#160;      <span class="comment">/* Check whether TLS configuration has changed */</span></div><div class="line"><a name="l00723"></a><span class="lineno">  723</span>&#160;      <span class="keywordflow">if</span> (!desc-&gt;<a class="code" href="../../da/d2b/structast__tcptls__session__args.html#a20cf0c41efdc66f5b8c2880c1011ac66">old_tls_cfg</a>) { <span class="comment">/* No previous configuration */</span></div><div class="line"><a name="l00724"></a><span class="lineno">  724</span>&#160;         tls_changed = 1;</div><div class="line"><a name="l00725"></a><span class="lineno">  725</span>&#160;         desc-&gt;<a class="code" href="../../da/d2b/structast__tcptls__session__args.html#a20cf0c41efdc66f5b8c2880c1011ac66">old_tls_cfg</a> = <a class="code" href="../../d8/d8a/astmm_8h.html#ae0cd4c5524b01287ab19cbe233d9cebb">ast_calloc</a>(1, <span class="keyword">sizeof</span>(*desc-&gt;<a class="code" href="../../da/d2b/structast__tcptls__session__args.html#a20cf0c41efdc66f5b8c2880c1011ac66">old_tls_cfg</a>));</div><div class="line"><a name="l00726"></a><span class="lineno">  726</span>&#160;      } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (memcmp(desc-&gt;<a class="code" href="../../da/d2b/structast__tcptls__session__args.html#aeb4a21e3ae033a326cc9dfd20a7ab074">tls_cfg</a>-&gt;<a class="code" href="../../d5/d90/structast__tls__config.html#adc8bd94310105dbfcf981a6d622c0b1c">certhash</a>, desc-&gt;<a class="code" href="../../da/d2b/structast__tcptls__session__args.html#a20cf0c41efdc66f5b8c2880c1011ac66">old_tls_cfg</a>-&gt;<a class="code" href="../../d5/d90/structast__tls__config.html#adc8bd94310105dbfcf981a6d622c0b1c">certhash</a>, 41)) {</div><div class="line"><a name="l00727"></a><span class="lineno">  727</span>&#160;         tls_changed = 1;</div><div class="line"><a name="l00728"></a><span class="lineno">  728</span>&#160;      } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (memcmp(desc-&gt;<a class="code" href="../../da/d2b/structast__tcptls__session__args.html#aeb4a21e3ae033a326cc9dfd20a7ab074">tls_cfg</a>-&gt;<a class="code" href="../../d5/d90/structast__tls__config.html#a14000c65e91ab34458e5a21f7c3d75fa">pvthash</a>, desc-&gt;<a class="code" href="../../da/d2b/structast__tcptls__session__args.html#a20cf0c41efdc66f5b8c2880c1011ac66">old_tls_cfg</a>-&gt;<a class="code" href="../../d5/d90/structast__tls__config.html#a14000c65e91ab34458e5a21f7c3d75fa">pvthash</a>, 41)) {</div><div class="line"><a name="l00729"></a><span class="lineno">  729</span>&#160;         tls_changed = 1;</div><div class="line"><a name="l00730"></a><span class="lineno">  730</span>&#160;      } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strcmp(desc-&gt;<a class="code" href="../../da/d2b/structast__tcptls__session__args.html#aeb4a21e3ae033a326cc9dfd20a7ab074">tls_cfg</a>-&gt;<a class="code" href="../../d5/d90/structast__tls__config.html#a3d12e13733aa5172b5cb091fbf8ea478">cipher</a>, desc-&gt;<a class="code" href="../../da/d2b/structast__tcptls__session__args.html#a20cf0c41efdc66f5b8c2880c1011ac66">old_tls_cfg</a>-&gt;<a class="code" href="../../d5/d90/structast__tls__config.html#a3d12e13733aa5172b5cb091fbf8ea478">cipher</a>)) {</div><div class="line"><a name="l00731"></a><span class="lineno">  731</span>&#160;         tls_changed = 1;</div><div class="line"><a name="l00732"></a><span class="lineno">  732</span>&#160;      } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (memcmp(desc-&gt;<a class="code" href="../../da/d2b/structast__tcptls__session__args.html#aeb4a21e3ae033a326cc9dfd20a7ab074">tls_cfg</a>-&gt;<a class="code" href="../../d5/d90/structast__tls__config.html#a5941a9fbcacdb17f1bf89f8f6a0af19b">cahash</a>, desc-&gt;<a class="code" href="../../da/d2b/structast__tcptls__session__args.html#a20cf0c41efdc66f5b8c2880c1011ac66">old_tls_cfg</a>-&gt;<a class="code" href="../../d5/d90/structast__tls__config.html#a5941a9fbcacdb17f1bf89f8f6a0af19b">cahash</a>, 41)) {</div><div class="line"><a name="l00733"></a><span class="lineno">  733</span>&#160;         tls_changed = 1;</div><div class="line"><a name="l00734"></a><span class="lineno">  734</span>&#160;      } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strcmp(desc-&gt;<a class="code" href="../../da/d2b/structast__tcptls__session__args.html#aeb4a21e3ae033a326cc9dfd20a7ab074">tls_cfg</a>-&gt;<a class="code" href="../../d5/d90/structast__tls__config.html#a8331a8443119478cd6b1daeb707a94dc">capath</a>, desc-&gt;<a class="code" href="../../da/d2b/structast__tcptls__session__args.html#a20cf0c41efdc66f5b8c2880c1011ac66">old_tls_cfg</a>-&gt;<a class="code" href="../../d5/d90/structast__tls__config.html#a8331a8443119478cd6b1daeb707a94dc">capath</a>)) {</div><div class="line"><a name="l00735"></a><span class="lineno">  735</span>&#160;         tls_changed = 1;</div><div class="line"><a name="l00736"></a><span class="lineno">  736</span>&#160;      } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (memcmp(&amp;desc-&gt;<a class="code" href="../../da/d2b/structast__tcptls__session__args.html#aeb4a21e3ae033a326cc9dfd20a7ab074">tls_cfg</a>-&gt;<a class="code" href="../../d5/d90/structast__tls__config.html#aec78000b2897c094f68ed72559e18acd">flags</a>, &amp;desc-&gt;<a class="code" href="../../da/d2b/structast__tcptls__session__args.html#a20cf0c41efdc66f5b8c2880c1011ac66">old_tls_cfg</a>-&gt;<a class="code" href="../../d5/d90/structast__tls__config.html#aec78000b2897c094f68ed72559e18acd">flags</a>, <span class="keyword">sizeof</span>(desc-&gt;<a class="code" href="../../da/d2b/structast__tcptls__session__args.html#aeb4a21e3ae033a326cc9dfd20a7ab074">tls_cfg</a>-&gt;<a class="code" href="../../d5/d90/structast__tls__config.html#aec78000b2897c094f68ed72559e18acd">flags</a>))) {</div><div class="line"><a name="l00737"></a><span class="lineno">  737</span>&#160;         tls_changed = 1;</div><div class="line"><a name="l00738"></a><span class="lineno">  738</span>&#160;      }</div><div class="line"><a name="l00739"></a><span class="lineno">  739</span>&#160;</div><div class="line"><a name="l00740"></a><span class="lineno">  740</span>&#160;      <span class="keywordflow">if</span> (tls_changed) {</div><div class="line"><a name="l00741"></a><span class="lineno">  741</span>&#160;         <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(1, <span class="stringliteral">&quot;Changed parameters for %s found\n&quot;</span>, desc-&gt;<a class="code" href="../../da/d2b/structast__tcptls__session__args.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>);</div><div class="line"><a name="l00742"></a><span class="lineno">  742</span>&#160;      }</div><div class="line"><a name="l00743"></a><span class="lineno">  743</span>&#160;   }</div><div class="line"><a name="l00744"></a><span class="lineno">  744</span>&#160;</div><div class="line"><a name="l00745"></a><span class="lineno">  745</span>&#160;   <span class="comment">/* Do nothing if nothing has changed */</span></div><div class="line"><a name="l00746"></a><span class="lineno">  746</span>&#160;   <span class="keywordflow">if</span> (!tls_changed &amp;&amp; !<a class="code" href="../../db/df1/netsock2_8h.html#abae1b903c8f5b7639235b579a267aaab">ast_sockaddr_cmp</a>(&amp;desc-&gt;<a class="code" href="../../da/d2b/structast__tcptls__session__args.html#ac2badb17597d7e81dc4d44e54d470a05">old_address</a>, &amp;desc-&gt;<a class="code" href="../../da/d2b/structast__tcptls__session__args.html#a6652499b3aff8f317d4c6d1a36c6c740">local_address</a>)) {</div><div class="line"><a name="l00747"></a><span class="lineno">  747</span>&#160;      <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(1, <span class="stringliteral">&quot;Nothing changed in %s\n&quot;</span>, desc-&gt;<a class="code" href="../../da/d2b/structast__tcptls__session__args.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>);</div><div class="line"><a name="l00748"></a><span class="lineno">  748</span>&#160;      <span class="keywordflow">return</span>;</div><div class="line"><a name="l00749"></a><span class="lineno">  749</span>&#160;   }</div><div class="line"><a name="l00750"></a><span class="lineno">  750</span>&#160;</div><div class="line"><a name="l00751"></a><span class="lineno">  751</span>&#160;   <span class="comment">/* If we return early, there is no one listening */</span></div><div class="line"><a name="l00752"></a><span class="lineno">  752</span>&#160;   <a class="code" href="../../db/df1/netsock2_8h.html#ad91b5dfe4c188d15f4b2e9e2ec5d8864">ast_sockaddr_setnull</a>(&amp;desc-&gt;<a class="code" href="../../da/d2b/structast__tcptls__session__args.html#ac2badb17597d7e81dc4d44e54d470a05">old_address</a>);</div><div class="line"><a name="l00753"></a><span class="lineno">  753</span>&#160;</div><div class="line"><a name="l00754"></a><span class="lineno">  754</span>&#160;   <span class="comment">/* Shutdown a running server if there is one */</span></div><div class="line"><a name="l00755"></a><span class="lineno">  755</span>&#160;   <span class="keywordflow">if</span> (desc-&gt;<a class="code" href="../../da/d2b/structast__tcptls__session__args.html#a9e187fd6e33fd32a888531467786c773">master</a> != <a class="code" href="../../dd/d42/lock_8h.html#a6009440c7a72f8e2e3b1ec97641ad160">AST_PTHREADT_NULL</a>) {</div><div class="line"><a name="l00756"></a><span class="lineno">  756</span>&#160;      pthread_cancel(desc-&gt;<a class="code" href="../../da/d2b/structast__tcptls__session__args.html#a9e187fd6e33fd32a888531467786c773">master</a>);</div><div class="line"><a name="l00757"></a><span class="lineno">  757</span>&#160;      pthread_kill(desc-&gt;<a class="code" href="../../da/d2b/structast__tcptls__session__args.html#a9e187fd6e33fd32a888531467786c773">master</a>, SIGURG);</div><div class="line"><a name="l00758"></a><span class="lineno">  758</span>&#160;      pthread_join(desc-&gt;<a class="code" href="../../da/d2b/structast__tcptls__session__args.html#a9e187fd6e33fd32a888531467786c773">master</a>, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div><div class="line"><a name="l00759"></a><span class="lineno">  759</span>&#160;   }</div><div class="line"><a name="l00760"></a><span class="lineno">  760</span>&#160;</div><div class="line"><a name="l00761"></a><span class="lineno">  761</span>&#160;   sd_socket = <a class="code" href="../../dc/dac/io_8h.html#a8416672b837668e153695bf7e9b3702e">ast_sd_get_fd</a>(SOCK_STREAM, &amp;desc-&gt;<a class="code" href="../../da/d2b/structast__tcptls__session__args.html#a6652499b3aff8f317d4c6d1a36c6c740">local_address</a>);</div><div class="line"><a name="l00762"></a><span class="lineno">  762</span>&#160;</div><div class="line"><a name="l00763"></a><span class="lineno">  763</span>&#160;   <span class="keywordflow">if</span> (sd_socket != -1) {</div><div class="line"><a name="l00764"></a><span class="lineno">  764</span>&#160;      <span class="keywordflow">if</span> (desc-&gt;<a class="code" href="../../da/d2b/structast__tcptls__session__args.html#ad6d7a8463d59a02084cf9d4360f46b79">accept_fd</a> != sd_socket) {</div><div class="line"><a name="l00765"></a><span class="lineno">  765</span>&#160;         <span class="keywordflow">if</span> (desc-&gt;<a class="code" href="../../da/d2b/structast__tcptls__session__args.html#ad6d7a8463d59a02084cf9d4360f46b79">accept_fd</a> != -1) {</div><div class="line"><a name="l00766"></a><span class="lineno">  766</span>&#160;            close(desc-&gt;<a class="code" href="../../da/d2b/structast__tcptls__session__args.html#ad6d7a8463d59a02084cf9d4360f46b79">accept_fd</a>);</div><div class="line"><a name="l00767"></a><span class="lineno">  767</span>&#160;         }</div><div class="line"><a name="l00768"></a><span class="lineno">  768</span>&#160;         desc-&gt;<a class="code" href="../../da/d2b/structast__tcptls__session__args.html#ad6d7a8463d59a02084cf9d4360f46b79">accept_fd</a> = sd_socket;</div><div class="line"><a name="l00769"></a><span class="lineno">  769</span>&#160;      }</div><div class="line"><a name="l00770"></a><span class="lineno">  770</span>&#160;</div><div class="line"><a name="l00771"></a><span class="lineno">  771</span>&#160;      <span class="keywordflow">goto</span> systemd_socket_activation;</div><div class="line"><a name="l00772"></a><span class="lineno">  772</span>&#160;   }</div><div class="line"><a name="l00773"></a><span class="lineno">  773</span>&#160;</div><div class="line"><a name="l00774"></a><span class="lineno">  774</span>&#160;   <span class="keywordflow">if</span> (desc-&gt;<a class="code" href="../../da/d2b/structast__tcptls__session__args.html#ad6d7a8463d59a02084cf9d4360f46b79">accept_fd</a> != -1) {</div><div class="line"><a name="l00775"></a><span class="lineno">  775</span>&#160;      close(desc-&gt;<a class="code" href="../../da/d2b/structast__tcptls__session__args.html#ad6d7a8463d59a02084cf9d4360f46b79">accept_fd</a>);</div><div class="line"><a name="l00776"></a><span class="lineno">  776</span>&#160;   }</div><div class="line"><a name="l00777"></a><span class="lineno">  777</span>&#160;</div><div class="line"><a name="l00778"></a><span class="lineno">  778</span>&#160;   <span class="comment">/* If there&#39;s no new server, stop here */</span></div><div class="line"><a name="l00779"></a><span class="lineno">  779</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../db/df1/netsock2_8h.html#aae671446fa65b8f846efaf165872c683">ast_sockaddr_isnull</a>(&amp;desc-&gt;<a class="code" href="../../da/d2b/structast__tcptls__session__args.html#a6652499b3aff8f317d4c6d1a36c6c740">local_address</a>)) {</div><div class="line"><a name="l00780"></a><span class="lineno">  780</span>&#160;      <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(2, <span class="stringliteral">&quot;Server disabled:  %s\n&quot;</span>, desc-&gt;<a class="code" href="../../da/d2b/structast__tcptls__session__args.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>);</div><div class="line"><a name="l00781"></a><span class="lineno">  781</span>&#160;      <span class="keywordflow">return</span>;</div><div class="line"><a name="l00782"></a><span class="lineno">  782</span>&#160;   }</div><div class="line"><a name="l00783"></a><span class="lineno">  783</span>&#160;</div><div class="line"><a name="l00784"></a><span class="lineno">  784</span>&#160;   desc-&gt;<a class="code" href="../../da/d2b/structast__tcptls__session__args.html#ad6d7a8463d59a02084cf9d4360f46b79">accept_fd</a> = <a class="code" href="../../d5/d60/utils_8h.html#a4aacbe2dadb9b8befc5a76765ea6d14b">ast_socket_nonblock</a>(<a class="code" href="../../db/df1/netsock2_8h.html#a579748bd6ceddd06b1cc6eb3578e8acc">ast_sockaddr_is_ipv6</a>(&amp;desc-&gt;<a class="code" href="../../da/d2b/structast__tcptls__session__args.html#a6652499b3aff8f317d4c6d1a36c6c740">local_address</a>) ?</div><div class="line"><a name="l00785"></a><span class="lineno">  785</span>&#160;             AF_INET6 : AF_INET, SOCK_STREAM, 0);</div><div class="line"><a name="l00786"></a><span class="lineno">  786</span>&#160;   <span class="keywordflow">if</span> (desc-&gt;<a class="code" href="../../da/d2b/structast__tcptls__session__args.html#ad6d7a8463d59a02084cf9d4360f46b79">accept_fd</a> &lt; 0) {</div><div class="line"><a name="l00787"></a><span class="lineno">  787</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Unable to allocate socket for %s: %s\n&quot;</span>, desc-&gt;<a class="code" href="../../da/d2b/structast__tcptls__session__args.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, strerror(<a class="code" href="../../d1/d6e/main_2stdtime_2private_8h.html#ad65a8842cc674e3ddf69355898c0ecbf">errno</a>));</div><div class="line"><a name="l00788"></a><span class="lineno">  788</span>&#160;      <span class="keywordflow">return</span>;</div><div class="line"><a name="l00789"></a><span class="lineno">  789</span>&#160;   }</div><div class="line"><a name="l00790"></a><span class="lineno">  790</span>&#160;</div><div class="line"><a name="l00791"></a><span class="lineno">  791</span>&#160;   setsockopt(desc-&gt;<a class="code" href="../../da/d2b/structast__tcptls__session__args.html#ad6d7a8463d59a02084cf9d4360f46b79">accept_fd</a>, SOL_SOCKET, SO_REUSEADDR, &amp;x, <span class="keyword">sizeof</span>(x));</div><div class="line"><a name="l00792"></a><span class="lineno">  792</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../db/df1/netsock2_8h.html#a58f856feeaf684b7d5353357e85a0dd5">ast_bind</a>(desc-&gt;<a class="code" href="../../da/d2b/structast__tcptls__session__args.html#ad6d7a8463d59a02084cf9d4360f46b79">accept_fd</a>, &amp;desc-&gt;<a class="code" href="../../da/d2b/structast__tcptls__session__args.html#a6652499b3aff8f317d4c6d1a36c6c740">local_address</a>)) {</div><div class="line"><a name="l00793"></a><span class="lineno">  793</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Unable to bind %s to %s: %s\n&quot;</span>,</div><div class="line"><a name="l00794"></a><span class="lineno">  794</span>&#160;         desc-&gt;<a class="code" href="../../da/d2b/structast__tcptls__session__args.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>,</div><div class="line"><a name="l00795"></a><span class="lineno">  795</span>&#160;         <a class="code" href="../../db/df1/netsock2_8h.html#aae9156c7fe6dff51463f29ed1c3b96c9">ast_sockaddr_stringify</a>(&amp;desc-&gt;<a class="code" href="../../da/d2b/structast__tcptls__session__args.html#a6652499b3aff8f317d4c6d1a36c6c740">local_address</a>),</div><div class="line"><a name="l00796"></a><span class="lineno">  796</span>&#160;         strerror(<a class="code" href="../../d1/d6e/main_2stdtime_2private_8h.html#ad65a8842cc674e3ddf69355898c0ecbf">errno</a>));</div><div class="line"><a name="l00797"></a><span class="lineno">  797</span>&#160;      <span class="keywordflow">goto</span> <a class="code" href="../../d6/d47/utils_2frame_8c.html#a4a9391ee88e57361b613c4c2fd2bf4aa">error</a>;</div><div class="line"><a name="l00798"></a><span class="lineno">  798</span>&#160;   }</div><div class="line"><a name="l00799"></a><span class="lineno">  799</span>&#160;   <span class="keywordflow">if</span> (listen(desc-&gt;<a class="code" href="../../da/d2b/structast__tcptls__session__args.html#ad6d7a8463d59a02084cf9d4360f46b79">accept_fd</a>, 10)) {</div><div class="line"><a name="l00800"></a><span class="lineno">  800</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Unable to listen for %s!\n&quot;</span>, desc-&gt;<a class="code" href="../../da/d2b/structast__tcptls__session__args.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>);</div><div class="line"><a name="l00801"></a><span class="lineno">  801</span>&#160;      <span class="keywordflow">goto</span> <a class="code" href="../../d6/d47/utils_2frame_8c.html#a4a9391ee88e57361b613c4c2fd2bf4aa">error</a>;</div><div class="line"><a name="l00802"></a><span class="lineno">  802</span>&#160;   }</div><div class="line"><a name="l00803"></a><span class="lineno">  803</span>&#160;</div><div class="line"><a name="l00804"></a><span class="lineno">  804</span>&#160;systemd_socket_activation:</div><div class="line"><a name="l00805"></a><span class="lineno">  805</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d5/d60/utils_8h.html#a595e2f8aa398f4bd21e381c3211235fe">ast_pthread_create_background</a>(&amp;desc-&gt;<a class="code" href="../../da/d2b/structast__tcptls__session__args.html#a9e187fd6e33fd32a888531467786c773">master</a>, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, desc-&gt;<a class="code" href="../../da/d2b/structast__tcptls__session__args.html#ad2f35276548bde6a940dd632d1354253">accept_fn</a>, desc)) {</div><div class="line"><a name="l00806"></a><span class="lineno">  806</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Unable to launch thread for %s on %s: %s\n&quot;</span>,</div><div class="line"><a name="l00807"></a><span class="lineno">  807</span>&#160;         desc-&gt;<a class="code" href="../../da/d2b/structast__tcptls__session__args.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>,</div><div class="line"><a name="l00808"></a><span class="lineno">  808</span>&#160;         <a class="code" href="../../db/df1/netsock2_8h.html#aae9156c7fe6dff51463f29ed1c3b96c9">ast_sockaddr_stringify</a>(&amp;desc-&gt;<a class="code" href="../../da/d2b/structast__tcptls__session__args.html#a6652499b3aff8f317d4c6d1a36c6c740">local_address</a>),</div><div class="line"><a name="l00809"></a><span class="lineno">  809</span>&#160;         strerror(<a class="code" href="../../d1/d6e/main_2stdtime_2private_8h.html#ad65a8842cc674e3ddf69355898c0ecbf">errno</a>));</div><div class="line"><a name="l00810"></a><span class="lineno">  810</span>&#160;      <span class="keywordflow">goto</span> <a class="code" href="../../d6/d47/utils_2frame_8c.html#a4a9391ee88e57361b613c4c2fd2bf4aa">error</a>;</div><div class="line"><a name="l00811"></a><span class="lineno">  811</span>&#160;   }</div><div class="line"><a name="l00812"></a><span class="lineno">  812</span>&#160;</div><div class="line"><a name="l00813"></a><span class="lineno">  813</span>&#160;   <span class="comment">/* Set current info */</span></div><div class="line"><a name="l00814"></a><span class="lineno">  814</span>&#160;   <a class="code" href="../../db/df1/netsock2_8h.html#a56a46003c93bfd65111ea8ffc97af8f9">ast_sockaddr_copy</a>(&amp;desc-&gt;<a class="code" href="../../da/d2b/structast__tcptls__session__args.html#ac2badb17597d7e81dc4d44e54d470a05">old_address</a>, &amp;desc-&gt;<a class="code" href="../../da/d2b/structast__tcptls__session__args.html#a6652499b3aff8f317d4c6d1a36c6c740">local_address</a>);</div><div class="line"><a name="l00815"></a><span class="lineno">  815</span>&#160;   <span class="keywordflow">if</span> (desc-&gt;<a class="code" href="../../da/d2b/structast__tcptls__session__args.html#a20cf0c41efdc66f5b8c2880c1011ac66">old_tls_cfg</a>) {</div><div class="line"><a name="l00816"></a><span class="lineno">  816</span>&#160;      <a class="code" href="../../d8/d8a/astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(desc-&gt;<a class="code" href="../../da/d2b/structast__tcptls__session__args.html#a20cf0c41efdc66f5b8c2880c1011ac66">old_tls_cfg</a>-&gt;<a class="code" href="../../d5/d90/structast__tls__config.html#a333dffcec025fcdbee0676476f401685">certfile</a>);</div><div class="line"><a name="l00817"></a><span class="lineno">  817</span>&#160;      <a class="code" href="../../d8/d8a/astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(desc-&gt;<a class="code" href="../../da/d2b/structast__tcptls__session__args.html#a20cf0c41efdc66f5b8c2880c1011ac66">old_tls_cfg</a>-&gt;<a class="code" href="../../d5/d90/structast__tls__config.html#a6005f11af6a60f4169876fcd075595ca">pvtfile</a>);</div><div class="line"><a name="l00818"></a><span class="lineno">  818</span>&#160;      <a class="code" href="../../d8/d8a/astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(desc-&gt;<a class="code" href="../../da/d2b/structast__tcptls__session__args.html#a20cf0c41efdc66f5b8c2880c1011ac66">old_tls_cfg</a>-&gt;<a class="code" href="../../d5/d90/structast__tls__config.html#a3d12e13733aa5172b5cb091fbf8ea478">cipher</a>);</div><div class="line"><a name="l00819"></a><span class="lineno">  819</span>&#160;      <a class="code" href="../../d8/d8a/astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(desc-&gt;<a class="code" href="../../da/d2b/structast__tcptls__session__args.html#a20cf0c41efdc66f5b8c2880c1011ac66">old_tls_cfg</a>-&gt;<a class="code" href="../../d5/d90/structast__tls__config.html#a9ff8d56644bac1d41f8039f2fde5acf2">cafile</a>);</div><div class="line"><a name="l00820"></a><span class="lineno">  820</span>&#160;      <a class="code" href="../../d8/d8a/astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(desc-&gt;<a class="code" href="../../da/d2b/structast__tcptls__session__args.html#a20cf0c41efdc66f5b8c2880c1011ac66">old_tls_cfg</a>-&gt;<a class="code" href="../../d5/d90/structast__tls__config.html#a8331a8443119478cd6b1daeb707a94dc">capath</a>);</div><div class="line"><a name="l00821"></a><span class="lineno">  821</span>&#160;      desc-&gt;<a class="code" href="../../da/d2b/structast__tcptls__session__args.html#a20cf0c41efdc66f5b8c2880c1011ac66">old_tls_cfg</a>-&gt;<a class="code" href="../../d5/d90/structast__tls__config.html#a333dffcec025fcdbee0676476f401685">certfile</a> = <a class="code" href="../../d8/d8a/astmm_8h.html#ab263849d03fb892847be4986db759737">ast_strdup</a>(desc-&gt;<a class="code" href="../../da/d2b/structast__tcptls__session__args.html#aeb4a21e3ae033a326cc9dfd20a7ab074">tls_cfg</a>-&gt;<a class="code" href="../../d5/d90/structast__tls__config.html#a333dffcec025fcdbee0676476f401685">certfile</a>);</div><div class="line"><a name="l00822"></a><span class="lineno">  822</span>&#160;      desc-&gt;<a class="code" href="../../da/d2b/structast__tcptls__session__args.html#a20cf0c41efdc66f5b8c2880c1011ac66">old_tls_cfg</a>-&gt;<a class="code" href="../../d5/d90/structast__tls__config.html#a6005f11af6a60f4169876fcd075595ca">pvtfile</a> = <a class="code" href="../../d8/d8a/astmm_8h.html#ab263849d03fb892847be4986db759737">ast_strdup</a>(desc-&gt;<a class="code" href="../../da/d2b/structast__tcptls__session__args.html#aeb4a21e3ae033a326cc9dfd20a7ab074">tls_cfg</a>-&gt;<a class="code" href="../../d5/d90/structast__tls__config.html#a6005f11af6a60f4169876fcd075595ca">pvtfile</a>);</div><div class="line"><a name="l00823"></a><span class="lineno">  823</span>&#160;      desc-&gt;<a class="code" href="../../da/d2b/structast__tcptls__session__args.html#a20cf0c41efdc66f5b8c2880c1011ac66">old_tls_cfg</a>-&gt;<a class="code" href="../../d5/d90/structast__tls__config.html#a3d12e13733aa5172b5cb091fbf8ea478">cipher</a> = <a class="code" href="../../d8/d8a/astmm_8h.html#ab263849d03fb892847be4986db759737">ast_strdup</a>(desc-&gt;<a class="code" href="../../da/d2b/structast__tcptls__session__args.html#aeb4a21e3ae033a326cc9dfd20a7ab074">tls_cfg</a>-&gt;<a class="code" href="../../d5/d90/structast__tls__config.html#a3d12e13733aa5172b5cb091fbf8ea478">cipher</a>);</div><div class="line"><a name="l00824"></a><span class="lineno">  824</span>&#160;      desc-&gt;<a class="code" href="../../da/d2b/structast__tcptls__session__args.html#a20cf0c41efdc66f5b8c2880c1011ac66">old_tls_cfg</a>-&gt;<a class="code" href="../../d5/d90/structast__tls__config.html#a9ff8d56644bac1d41f8039f2fde5acf2">cafile</a> = <a class="code" href="../../d8/d8a/astmm_8h.html#ab263849d03fb892847be4986db759737">ast_strdup</a>(desc-&gt;<a class="code" href="../../da/d2b/structast__tcptls__session__args.html#aeb4a21e3ae033a326cc9dfd20a7ab074">tls_cfg</a>-&gt;<a class="code" href="../../d5/d90/structast__tls__config.html#a9ff8d56644bac1d41f8039f2fde5acf2">cafile</a>);</div><div class="line"><a name="l00825"></a><span class="lineno">  825</span>&#160;      desc-&gt;<a class="code" href="../../da/d2b/structast__tcptls__session__args.html#a20cf0c41efdc66f5b8c2880c1011ac66">old_tls_cfg</a>-&gt;<a class="code" href="../../d5/d90/structast__tls__config.html#a8331a8443119478cd6b1daeb707a94dc">capath</a> = <a class="code" href="../../d8/d8a/astmm_8h.html#ab263849d03fb892847be4986db759737">ast_strdup</a>(desc-&gt;<a class="code" href="../../da/d2b/structast__tcptls__session__args.html#aeb4a21e3ae033a326cc9dfd20a7ab074">tls_cfg</a>-&gt;<a class="code" href="../../d5/d90/structast__tls__config.html#a8331a8443119478cd6b1daeb707a94dc">capath</a>);</div><div class="line"><a name="l00826"></a><span class="lineno">  826</span>&#160;      memcpy(desc-&gt;<a class="code" href="../../da/d2b/structast__tcptls__session__args.html#a20cf0c41efdc66f5b8c2880c1011ac66">old_tls_cfg</a>-&gt;<a class="code" href="../../d5/d90/structast__tls__config.html#adc8bd94310105dbfcf981a6d622c0b1c">certhash</a>, desc-&gt;<a class="code" href="../../da/d2b/structast__tcptls__session__args.html#aeb4a21e3ae033a326cc9dfd20a7ab074">tls_cfg</a>-&gt;<a class="code" href="../../d5/d90/structast__tls__config.html#adc8bd94310105dbfcf981a6d622c0b1c">certhash</a>, 41);</div><div class="line"><a name="l00827"></a><span class="lineno">  827</span>&#160;      memcpy(desc-&gt;<a class="code" href="../../da/d2b/structast__tcptls__session__args.html#a20cf0c41efdc66f5b8c2880c1011ac66">old_tls_cfg</a>-&gt;<a class="code" href="../../d5/d90/structast__tls__config.html#a14000c65e91ab34458e5a21f7c3d75fa">pvthash</a>, desc-&gt;<a class="code" href="../../da/d2b/structast__tcptls__session__args.html#aeb4a21e3ae033a326cc9dfd20a7ab074">tls_cfg</a>-&gt;<a class="code" href="../../d5/d90/structast__tls__config.html#a14000c65e91ab34458e5a21f7c3d75fa">pvthash</a>, 41);</div><div class="line"><a name="l00828"></a><span class="lineno">  828</span>&#160;      memcpy(desc-&gt;<a class="code" href="../../da/d2b/structast__tcptls__session__args.html#a20cf0c41efdc66f5b8c2880c1011ac66">old_tls_cfg</a>-&gt;<a class="code" href="../../d5/d90/structast__tls__config.html#a5941a9fbcacdb17f1bf89f8f6a0af19b">cahash</a>, desc-&gt;<a class="code" href="../../da/d2b/structast__tcptls__session__args.html#aeb4a21e3ae033a326cc9dfd20a7ab074">tls_cfg</a>-&gt;<a class="code" href="../../d5/d90/structast__tls__config.html#a5941a9fbcacdb17f1bf89f8f6a0af19b">cahash</a>, 41);</div><div class="line"><a name="l00829"></a><span class="lineno">  829</span>&#160;      memcpy(&amp;desc-&gt;<a class="code" href="../../da/d2b/structast__tcptls__session__args.html#a20cf0c41efdc66f5b8c2880c1011ac66">old_tls_cfg</a>-&gt;<a class="code" href="../../d5/d90/structast__tls__config.html#aec78000b2897c094f68ed72559e18acd">flags</a>, &amp;desc-&gt;<a class="code" href="../../da/d2b/structast__tcptls__session__args.html#aeb4a21e3ae033a326cc9dfd20a7ab074">tls_cfg</a>-&gt;<a class="code" href="../../d5/d90/structast__tls__config.html#aec78000b2897c094f68ed72559e18acd">flags</a>, <span class="keyword">sizeof</span>(desc-&gt;<a class="code" href="../../da/d2b/structast__tcptls__session__args.html#a20cf0c41efdc66f5b8c2880c1011ac66">old_tls_cfg</a>-&gt;<a class="code" href="../../d5/d90/structast__tls__config.html#aec78000b2897c094f68ed72559e18acd">flags</a>));</div><div class="line"><a name="l00830"></a><span class="lineno">  830</span>&#160;   }</div><div class="line"><a name="l00831"></a><span class="lineno">  831</span>&#160;</div><div class="line"><a name="l00832"></a><span class="lineno">  832</span>&#160;   <span class="keywordflow">return</span>;</div><div class="line"><a name="l00833"></a><span class="lineno">  833</span>&#160;</div><div class="line"><a name="l00834"></a><span class="lineno">  834</span>&#160;<a class="code" href="../../d6/d47/utils_2frame_8c.html#a4a9391ee88e57361b613c4c2fd2bf4aa">error</a>:</div><div class="line"><a name="l00835"></a><span class="lineno">  835</span>&#160;   close(desc-&gt;<a class="code" href="../../da/d2b/structast__tcptls__session__args.html#ad6d7a8463d59a02084cf9d4360f46b79">accept_fd</a>);</div><div class="line"><a name="l00836"></a><span class="lineno">  836</span>&#160;   desc-&gt;<a class="code" href="../../da/d2b/structast__tcptls__session__args.html#ad6d7a8463d59a02084cf9d4360f46b79">accept_fd</a> = -1;</div><div class="line"><a name="l00837"></a><span class="lineno">  837</span>&#160;}</div><div class="ttc" id="structast__tls__config_html_a6005f11af6a60f4169876fcd075595ca"><div class="ttname"><a href="../../d5/d90/structast__tls__config.html#a6005f11af6a60f4169876fcd075595ca">ast_tls_config::pvtfile</a></div><div class="ttdeci">char * pvtfile</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/ddf/tcptls_8h_source.html#l00090">tcptls.h:90</a></div></div>
<div class="ttc" id="structast__tls__config_html_a14000c65e91ab34458e5a21f7c3d75fa"><div class="ttname"><a href="../../d5/d90/structast__tls__config.html#a14000c65e91ab34458e5a21f7c3d75fa">ast_tls_config::pvthash</a></div><div class="ttdeci">char pvthash[41]</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/ddf/tcptls_8h_source.html#l00097">tcptls.h:97</a></div></div>
<div class="ttc" id="netsock2_8h_html_a56a46003c93bfd65111ea8ffc97af8f9"><div class="ttname"><a href="../../db/df1/netsock2_8h.html#a56a46003c93bfd65111ea8ffc97af8f9">ast_sockaddr_copy</a></div><div class="ttdeci">static void ast_sockaddr_copy(struct ast_sockaddr *dst, const struct ast_sockaddr *src)</div><div class="ttdoc">Copies the data from one ast_sockaddr to another. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/df1/netsock2_8h_source.html#l00171">netsock2.h:171</a></div></div>
<div class="ttc" id="utils_8h_html_a4aacbe2dadb9b8befc5a76765ea6d14b"><div class="ttname"><a href="../../d5/d60/utils_8h.html#a4aacbe2dadb9b8befc5a76765ea6d14b">ast_socket_nonblock</a></div><div class="ttdeci">#define ast_socket_nonblock(domain, type, protocol)</div><div class="ttdoc">Create a non-blocking socket. </div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d60/utils_8h_source.html#l01043">utils.h:1043</a></div></div>
<div class="ttc" id="structast__tls__config_html_adc8bd94310105dbfcf981a6d622c0b1c"><div class="ttname"><a href="../../d5/d90/structast__tls__config.html#adc8bd94310105dbfcf981a6d622c0b1c">ast_tls_config::certhash</a></div><div class="ttdeci">char certhash[41]</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/ddf/tcptls_8h_source.html#l00096">tcptls.h:96</a></div></div>
<div class="ttc" id="astmm_8h_html_ab263849d03fb892847be4986db759737"><div class="ttname"><a href="../../d8/d8a/astmm_8h.html#ab263849d03fb892847be4986db759737">ast_strdup</a></div><div class="ttdeci">#define ast_strdup(str)</div><div class="ttdoc">A wrapper for strdup() </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d8a/astmm_8h_source.html#l00243">astmm.h:243</a></div></div>
<div class="ttc" id="app__jack_8c_html_af25d6dc49269fa2003ac7c7fa6f13915"><div class="ttname"><a href="../../de/dcd/app__jack_8c.html#af25d6dc49269fa2003ac7c7fa6f13915">str</a></div><div class="ttdeci">const char * str</div><div class="ttdef"><b>Definition:</b> <a href="../../de/dcd/app__jack_8c_source.html#l00147">app_jack.c:147</a></div></div>
<div class="ttc" id="resample_8c_html_a070d2ce7b6bb7e5c05602aa8c308d0c4"><div class="ttname"><a href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a></div><div class="ttdeci">#define NULL</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d7f/resample_8c_source.html#l00096">resample.c:96</a></div></div>
<div class="ttc" id="netsock2_8h_html_abae1b903c8f5b7639235b579a267aaab"><div class="ttname"><a href="../../db/df1/netsock2_8h.html#abae1b903c8f5b7639235b579a267aaab">ast_sockaddr_cmp</a></div><div class="ttdeci">int ast_sockaddr_cmp(const struct ast_sockaddr *a, const struct ast_sockaddr *b)</div><div class="ttdoc">Compares two ast_sockaddr structures. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d27/netsock2_8c_source.html#l00388">netsock2.c:388</a></div></div>
<div class="ttc" id="netsock2_8h_html_a58f856feeaf684b7d5353357e85a0dd5"><div class="ttname"><a href="../../db/df1/netsock2_8h.html#a58f856feeaf684b7d5353357e85a0dd5">ast_bind</a></div><div class="ttdeci">int ast_bind(int sockfd, const struct ast_sockaddr *addr)</div><div class="ttdoc">Wrapper around bind(2) that uses struct ast_sockaddr. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d27/netsock2_8c_source.html#l00590">netsock2.c:590</a></div></div>
<div class="ttc" id="include_2asterisk_2app_8h_html_ac5aea5ca8a190e3a89d29b74a09cdb3e"><div class="ttname"><a href="../../d3/d93/include_2asterisk_2app_8h.html#ac5aea5ca8a190e3a89d29b74a09cdb3e">ast_read_textfile</a></div><div class="ttdeci">char * ast_read_textfile(const char *file)</div><div class="ttdoc">Read a file into asterisk. </div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d83/main_2app_8c_source.html#l02792">main/app.c:2792</a></div></div>
<div class="ttc" id="io_8h_html_a8416672b837668e153695bf7e9b3702e"><div class="ttname"><a href="../../dc/dac/io_8h.html#a8416672b837668e153695bf7e9b3702e">ast_sd_get_fd</a></div><div class="ttdeci">int ast_sd_get_fd(int type, const struct ast_sockaddr *addr)</div><div class="ttdoc">Find a listening file descriptor provided by socket activation. </div><div class="ttdef"><b>Definition:</b> <a href="../../df/d0a/io_8c_source.html#l00438">io.c:438</a></div></div>
<div class="ttc" id="netsock2_8h_html_ad91b5dfe4c188d15f4b2e9e2ec5d8864"><div class="ttname"><a href="../../db/df1/netsock2_8h.html#ad91b5dfe4c188d15f4b2e9e2ec5d8864">ast_sockaddr_setnull</a></div><div class="ttdeci">static void ast_sockaddr_setnull(struct ast_sockaddr *addr)</div><div class="ttdoc">Sets address addr to null. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/df1/netsock2_8h_source.html#l00140">netsock2.h:140</a></div></div>
<div class="ttc" id="structast__tcptls__session__args_html_a9e187fd6e33fd32a888531467786c773"><div class="ttname"><a href="../../da/d2b/structast__tcptls__session__args.html#a9e187fd6e33fd32a888531467786c773">ast_tcptls_session_args::master</a></div><div class="ttdeci">pthread_t master</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/ddf/tcptls_8h_source.html#l00138">tcptls.h:138</a></div></div>
<div class="ttc" id="utils_8h_html_a595e2f8aa398f4bd21e381c3211235fe"><div class="ttname"><a href="../../d5/d60/utils_8h.html#a595e2f8aa398f4bd21e381c3211235fe">ast_pthread_create_background</a></div><div class="ttdeci">#define ast_pthread_create_background(a, b, c, d)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d60/utils_8h_source.html#l00567">utils.h:567</a></div></div>
<div class="ttc" id="netsock2_8h_html_aae671446fa65b8f846efaf165872c683"><div class="ttname"><a href="../../db/df1/netsock2_8h.html#aae671446fa65b8f846efaf165872c683">ast_sockaddr_isnull</a></div><div class="ttdeci">static int ast_sockaddr_isnull(const struct ast_sockaddr *addr)</div><div class="ttdoc">Checks if the ast_sockaddr is null. &quot;null&quot; in this sense essentially means uninitialized, or having a 0 length. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/df1/netsock2_8h_source.html#l00127">netsock2.h:127</a></div></div>
<div class="ttc" id="logger_8h_html_a3f248112c8d6ce7e3959aa723dade648"><div class="ttname"><a href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a></div><div class="ttdeci">#define ast_debug(level,...)</div><div class="ttdoc">Log a DEBUG message. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d8c/logger_8h_source.html#l00452">logger.h:452</a></div></div>
<div class="ttc" id="astobj2_8c_html_a96a00b3a518d7f32b6d51dc28f09bf9b"><div class="ttname"><a href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a></div><div class="ttdeci">#define ast_log</div><div class="ttdef"><b>Definition:</b> <a href="../../da/df7/astobj2_8c_source.html#l00042">astobj2.c:42</a></div></div>
<div class="ttc" id="lock_8h_html_a6009440c7a72f8e2e3b1ec97641ad160"><div class="ttname"><a href="../../dd/d42/lock_8h.html#a6009440c7a72f8e2e3b1ec97641ad160">AST_PTHREADT_NULL</a></div><div class="ttdeci">#define AST_PTHREADT_NULL</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d42/lock_8h_source.html#l00066">lock.h:66</a></div></div>
<div class="ttc" id="utils_8h_html_af35c6f780502c691f0ae35e1d0f7a444"><div class="ttname"><a href="../../d5/d60/utils_8h.html#af35c6f780502c691f0ae35e1d0f7a444">ast_sha1_hash</a></div><div class="ttdeci">void ast_sha1_hash(char *output, const char *input)</div><div class="ttdoc">Produces SHA1 hash based on input string. </div><div class="ttdef"><b>Definition:</b> <a href="../../de/d1f/main_2utils_8c_source.html#l00264">main/utils.c:264</a></div></div>
<div class="ttc" id="logger_8h_html_aced66975c154ea0e2a8ec3bc818b4e08"><div class="ttname"><a href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a></div><div class="ttdeci">#define LOG_ERROR</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d8c/logger_8h_source.html#l00285">logger.h:285</a></div></div>
<div class="ttc" id="main_2stdtime_2private_8h_html_ad65a8842cc674e3ddf69355898c0ecbf"><div class="ttname"><a href="../../d1/d6e/main_2stdtime_2private_8h.html#ad65a8842cc674e3ddf69355898c0ecbf">errno</a></div><div class="ttdeci">int errno</div></div>
<div class="ttc" id="netsock2_8h_html_aae9156c7fe6dff51463f29ed1c3b96c9"><div class="ttname"><a href="../../db/df1/netsock2_8h.html#aae9156c7fe6dff51463f29ed1c3b96c9">ast_sockaddr_stringify</a></div><div class="ttdeci">static char * ast_sockaddr_stringify(const struct ast_sockaddr *addr)</div><div class="ttdoc">Wrapper around ast_sockaddr_stringify_fmt() with default format. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/df1/netsock2_8h_source.html#l00260">netsock2.h:260</a></div></div>
<div class="ttc" id="structast__tls__config_html_a9ff8d56644bac1d41f8039f2fde5acf2"><div class="ttname"><a href="../../d5/d90/structast__tls__config.html#a9ff8d56644bac1d41f8039f2fde5acf2">ast_tls_config::cafile</a></div><div class="ttdeci">char * cafile</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/ddf/tcptls_8h_source.html#l00092">tcptls.h:92</a></div></div>
<div class="ttc" id="astmm_8h_html_a402072d6789f6ed9e3a81da27504127e"><div class="ttname"><a href="../../d8/d8a/astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a></div><div class="ttdeci">#define ast_free(a)</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d8a/astmm_8h_source.html#l00182">astmm.h:182</a></div></div>
<div class="ttc" id="astmm_8h_html_ae0cd4c5524b01287ab19cbe233d9cebb"><div class="ttname"><a href="../../d8/d8a/astmm_8h.html#ae0cd4c5524b01287ab19cbe233d9cebb">ast_calloc</a></div><div class="ttdeci">#define ast_calloc(num, len)</div><div class="ttdoc">A wrapper for calloc() </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d8a/astmm_8h_source.html#l00204">astmm.h:204</a></div></div>
<div class="ttc" id="structast__tcptls__session__args_html_ac2badb17597d7e81dc4d44e54d470a05"><div class="ttname"><a href="../../da/d2b/structast__tcptls__session__args.html#ac2badb17597d7e81dc4d44e54d470a05">ast_tcptls_session_args::old_address</a></div><div class="ttdeci">struct ast_sockaddr old_address</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/ddf/tcptls_8h_source.html#l00131">tcptls.h:131</a></div></div>
<div class="ttc" id="structast__tcptls__session__args_html_a20cf0c41efdc66f5b8c2880c1011ac66"><div class="ttname"><a href="../../da/d2b/structast__tcptls__session__args.html#a20cf0c41efdc66f5b8c2880c1011ac66">ast_tcptls_session_args::old_tls_cfg</a></div><div class="ttdeci">struct ast_tls_config * old_tls_cfg</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/ddf/tcptls_8h_source.html#l00143">tcptls.h:143</a></div></div>
<div class="ttc" id="structast__tls__config_html_a333dffcec025fcdbee0676476f401685"><div class="ttname"><a href="../../d5/d90/structast__tls__config.html#a333dffcec025fcdbee0676476f401685">ast_tls_config::certfile</a></div><div class="ttdeci">char * certfile</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/ddf/tcptls_8h_source.html#l00089">tcptls.h:89</a></div></div>
<div class="ttc" id="structast__tcptls__session__args_html_a8f8f80d37794cde9472343e4487ba3eb"><div class="ttname"><a href="../../da/d2b/structast__tcptls__session__args.html#a8f8f80d37794cde9472343e4487ba3eb">ast_tcptls_session_args::name</a></div><div class="ttdeci">const char * name</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/ddf/tcptls_8h_source.html#l00142">tcptls.h:142</a></div></div>
<div class="ttc" id="structast__tls__config_html_a5941a9fbcacdb17f1bf89f8f6a0af19b"><div class="ttname"><a href="../../d5/d90/structast__tls__config.html#a5941a9fbcacdb17f1bf89f8f6a0af19b">ast_tls_config::cahash</a></div><div class="ttdeci">char cahash[41]</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/ddf/tcptls_8h_source.html#l00098">tcptls.h:98</a></div></div>
<div class="ttc" id="structast__tcptls__session__args_html_ad6d7a8463d59a02084cf9d4360f46b79"><div class="ttname"><a href="../../da/d2b/structast__tcptls__session__args.html#ad6d7a8463d59a02084cf9d4360f46b79">ast_tcptls_session_args::accept_fd</a></div><div class="ttdeci">int accept_fd</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/ddf/tcptls_8h_source.html#l00135">tcptls.h:135</a></div></div>
<div class="ttc" id="structast__tls__config_html_aec78000b2897c094f68ed72559e18acd"><div class="ttname"><a href="../../d5/d90/structast__tls__config.html#aec78000b2897c094f68ed72559e18acd">ast_tls_config::flags</a></div><div class="ttdeci">struct ast_flags flags</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/ddf/tcptls_8h_source.html#l00094">tcptls.h:94</a></div></div>
<div class="ttc" id="utils_2frame_8c_html_a4a9391ee88e57361b613c4c2fd2bf4aa"><div class="ttname"><a href="../../d6/d47/utils_2frame_8c.html#a4a9391ee88e57361b613c4c2fd2bf4aa">error</a></div><div class="ttdeci">int error(const char *format,...)</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d47/utils_2frame_8c_source.html#l00999">utils/frame.c:999</a></div></div>
<div class="ttc" id="structast__tls__config_html_a8331a8443119478cd6b1daeb707a94dc"><div class="ttname"><a href="../../d5/d90/structast__tls__config.html#a8331a8443119478cd6b1daeb707a94dc">ast_tls_config::capath</a></div><div class="ttdeci">char * capath</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/ddf/tcptls_8h_source.html#l00093">tcptls.h:93</a></div></div>
<div class="ttc" id="structast__tcptls__session__args_html_aeb4a21e3ae033a326cc9dfd20a7ab074"><div class="ttname"><a href="../../da/d2b/structast__tcptls__session__args.html#aeb4a21e3ae033a326cc9dfd20a7ab074">ast_tcptls_session_args::tls_cfg</a></div><div class="ttdeci">struct ast_tls_config * tls_cfg</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/ddf/tcptls_8h_source.html#l00134">tcptls.h:134</a></div></div>
<div class="ttc" id="structast__tcptls__session__args_html_a6652499b3aff8f317d4c6d1a36c6c740"><div class="ttname"><a href="../../da/d2b/structast__tcptls__session__args.html#a6652499b3aff8f317d4c6d1a36c6c740">ast_tcptls_session_args::local_address</a></div><div class="ttdeci">struct ast_sockaddr local_address</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/ddf/tcptls_8h_source.html#l00130">tcptls.h:130</a></div></div>
<div class="ttc" id="structast__tls__config_html_a3d12e13733aa5172b5cb091fbf8ea478"><div class="ttname"><a href="../../d5/d90/structast__tls__config.html#a3d12e13733aa5172b5cb091fbf8ea478">ast_tls_config::cipher</a></div><div class="ttdeci">char * cipher</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/ddf/tcptls_8h_source.html#l00091">tcptls.h:91</a></div></div>
<div class="ttc" id="netsock2_8h_html_a579748bd6ceddd06b1cc6eb3578e8acc"><div class="ttname"><a href="../../db/df1/netsock2_8h.html#a579748bd6ceddd06b1cc6eb3578e8acc">ast_sockaddr_is_ipv6</a></div><div class="ttdeci">int ast_sockaddr_is_ipv6(const struct ast_sockaddr *addr)</div><div class="ttdoc">Determine if this is an IPv6 address. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d27/netsock2_8c_source.html#l00524">netsock2.c:524</a></div></div>
<div class="ttc" id="structast__tcptls__session__args_html_ad2f35276548bde6a940dd632d1354253"><div class="ttname"><a href="../../da/d2b/structast__tcptls__session__args.html#ad2f35276548bde6a940dd632d1354253">ast_tcptls_session_args::accept_fn</a></div><div class="ttdeci">void *(* accept_fn)(void *)</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/ddf/tcptls_8h_source.html#l00139">tcptls.h:139</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a1fd4aa5038c9a488acc0f8017fe94fda"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1fd4aa5038c9a488acc0f8017fe94fda">&#9670;&nbsp;</a></span>ast_tcptls_server_stop()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ast_tcptls_server_stop </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="../../da/d2b/structast__tcptls__session__args.html">ast_tcptls_session_args</a> *&#160;</td>
          <td class="paramname"><em>desc</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Shutdown a running server if there is one. </p>
<dl class="section version"><dt>Version</dt><dd>1.6.1 changed desc parameter to be of <a class="el" href="../../da/d2b/structast__tcptls__session__args.html" title="arguments for the accepting thread ">ast_tcptls_session_args</a> type </dd></dl>

<p class="definition">Definition at line <a class="el" href="../../dc/d9b/tcptls_8c_source.html#l00849">849</a> of file <a class="el" href="../../dc/d9b/tcptls_8c_source.html">tcptls.c</a>.</p>

<p class="reference">References <a class="el" href="../../d4/ddf/tcptls_8h_source.html#l00135">ast_tcptls_session_args::accept_fd</a>, <a class="el" href="../../d1/d8c/logger_8h_source.html#l00452">ast_debug</a>, <a class="el" href="../../d8/d8a/astmm_8h_source.html#l00182">ast_free</a>, <a class="el" href="../../dd/d42/lock_8h_source.html#l00066">AST_PTHREADT_NULL</a>, <a class="el" href="../../d4/ddf/tcptls_8h_source.html#l00092">ast_tls_config::cafile</a>, <a class="el" href="../../d4/ddf/tcptls_8h_source.html#l00093">ast_tls_config::capath</a>, <a class="el" href="../../d4/ddf/tcptls_8h_source.html#l00089">ast_tls_config::certfile</a>, <a class="el" href="../../d4/ddf/tcptls_8h_source.html#l00091">ast_tls_config::cipher</a>, <a class="el" href="../../d4/ddf/tcptls_8h_source.html#l00138">ast_tcptls_session_args::master</a>, <a class="el" href="../../d4/ddf/tcptls_8h_source.html#l00142">ast_tcptls_session_args::name</a>, <a class="el" href="../../dc/d7f/resample_8c_source.html#l00096">NULL</a>, <a class="el" href="../../d4/ddf/tcptls_8h_source.html#l00143">ast_tcptls_session_args::old_tls_cfg</a>, and <a class="el" href="../../d4/ddf/tcptls_8h_source.html#l00090">ast_tls_config::pvtfile</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../dd/d43/http_8c_source.html#l02077">__ast_http_load()</a>, <a class="el" href="../../d4/d10/manager_8c_source.html#l09144">__init_manager()</a>, <a class="el" href="../../d4/d10/manager_8c_source.html#l08956">manager_shutdown()</a>, and <a class="el" href="../../d5/dfe/chan__sip_8c_source.html#l35708">unload_module()</a>.</p>
<div class="fragment"><div class="line"><a name="l00850"></a><span class="lineno">  850</span>&#160;{</div><div class="line"><a name="l00851"></a><span class="lineno">  851</span>&#160;   <span class="keywordflow">if</span> (desc-&gt;<a class="code" href="../../da/d2b/structast__tcptls__session__args.html#a9e187fd6e33fd32a888531467786c773">master</a> != <a class="code" href="../../dd/d42/lock_8h.html#a6009440c7a72f8e2e3b1ec97641ad160">AST_PTHREADT_NULL</a>) {</div><div class="line"><a name="l00852"></a><span class="lineno">  852</span>&#160;      pthread_cancel(desc-&gt;<a class="code" href="../../da/d2b/structast__tcptls__session__args.html#a9e187fd6e33fd32a888531467786c773">master</a>);</div><div class="line"><a name="l00853"></a><span class="lineno">  853</span>&#160;      pthread_kill(desc-&gt;<a class="code" href="../../da/d2b/structast__tcptls__session__args.html#a9e187fd6e33fd32a888531467786c773">master</a>, SIGURG);</div><div class="line"><a name="l00854"></a><span class="lineno">  854</span>&#160;      pthread_join(desc-&gt;<a class="code" href="../../da/d2b/structast__tcptls__session__args.html#a9e187fd6e33fd32a888531467786c773">master</a>, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div><div class="line"><a name="l00855"></a><span class="lineno">  855</span>&#160;      desc-&gt;<a class="code" href="../../da/d2b/structast__tcptls__session__args.html#a9e187fd6e33fd32a888531467786c773">master</a> = <a class="code" href="../../dd/d42/lock_8h.html#a6009440c7a72f8e2e3b1ec97641ad160">AST_PTHREADT_NULL</a>;</div><div class="line"><a name="l00856"></a><span class="lineno">  856</span>&#160;   }</div><div class="line"><a name="l00857"></a><span class="lineno">  857</span>&#160;   <span class="keywordflow">if</span> (desc-&gt;<a class="code" href="../../da/d2b/structast__tcptls__session__args.html#ad6d7a8463d59a02084cf9d4360f46b79">accept_fd</a> != -1) {</div><div class="line"><a name="l00858"></a><span class="lineno">  858</span>&#160;      close(desc-&gt;<a class="code" href="../../da/d2b/structast__tcptls__session__args.html#ad6d7a8463d59a02084cf9d4360f46b79">accept_fd</a>);</div><div class="line"><a name="l00859"></a><span class="lineno">  859</span>&#160;   }</div><div class="line"><a name="l00860"></a><span class="lineno">  860</span>&#160;   desc-&gt;<a class="code" href="../../da/d2b/structast__tcptls__session__args.html#ad6d7a8463d59a02084cf9d4360f46b79">accept_fd</a> = -1;</div><div class="line"><a name="l00861"></a><span class="lineno">  861</span>&#160;</div><div class="line"><a name="l00862"></a><span class="lineno">  862</span>&#160;   <span class="keywordflow">if</span> (desc-&gt;<a class="code" href="../../da/d2b/structast__tcptls__session__args.html#a20cf0c41efdc66f5b8c2880c1011ac66">old_tls_cfg</a>) {</div><div class="line"><a name="l00863"></a><span class="lineno">  863</span>&#160;      <a class="code" href="../../d8/d8a/astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(desc-&gt;<a class="code" href="../../da/d2b/structast__tcptls__session__args.html#a20cf0c41efdc66f5b8c2880c1011ac66">old_tls_cfg</a>-&gt;<a class="code" href="../../d5/d90/structast__tls__config.html#a333dffcec025fcdbee0676476f401685">certfile</a>);</div><div class="line"><a name="l00864"></a><span class="lineno">  864</span>&#160;      <a class="code" href="../../d8/d8a/astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(desc-&gt;<a class="code" href="../../da/d2b/structast__tcptls__session__args.html#a20cf0c41efdc66f5b8c2880c1011ac66">old_tls_cfg</a>-&gt;<a class="code" href="../../d5/d90/structast__tls__config.html#a6005f11af6a60f4169876fcd075595ca">pvtfile</a>);</div><div class="line"><a name="l00865"></a><span class="lineno">  865</span>&#160;      <a class="code" href="../../d8/d8a/astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(desc-&gt;<a class="code" href="../../da/d2b/structast__tcptls__session__args.html#a20cf0c41efdc66f5b8c2880c1011ac66">old_tls_cfg</a>-&gt;<a class="code" href="../../d5/d90/structast__tls__config.html#a3d12e13733aa5172b5cb091fbf8ea478">cipher</a>);</div><div class="line"><a name="l00866"></a><span class="lineno">  866</span>&#160;      <a class="code" href="../../d8/d8a/astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(desc-&gt;<a class="code" href="../../da/d2b/structast__tcptls__session__args.html#a20cf0c41efdc66f5b8c2880c1011ac66">old_tls_cfg</a>-&gt;<a class="code" href="../../d5/d90/structast__tls__config.html#a9ff8d56644bac1d41f8039f2fde5acf2">cafile</a>);</div><div class="line"><a name="l00867"></a><span class="lineno">  867</span>&#160;      <a class="code" href="../../d8/d8a/astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(desc-&gt;<a class="code" href="../../da/d2b/structast__tcptls__session__args.html#a20cf0c41efdc66f5b8c2880c1011ac66">old_tls_cfg</a>-&gt;<a class="code" href="../../d5/d90/structast__tls__config.html#a8331a8443119478cd6b1daeb707a94dc">capath</a>);</div><div class="line"><a name="l00868"></a><span class="lineno">  868</span>&#160;      <a class="code" href="../../d8/d8a/astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(desc-&gt;<a class="code" href="../../da/d2b/structast__tcptls__session__args.html#a20cf0c41efdc66f5b8c2880c1011ac66">old_tls_cfg</a>);</div><div class="line"><a name="l00869"></a><span class="lineno">  869</span>&#160;      desc-&gt;<a class="code" href="../../da/d2b/structast__tcptls__session__args.html#a20cf0c41efdc66f5b8c2880c1011ac66">old_tls_cfg</a> = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l00870"></a><span class="lineno">  870</span>&#160;   }</div><div class="line"><a name="l00871"></a><span class="lineno">  871</span>&#160;</div><div class="line"><a name="l00872"></a><span class="lineno">  872</span>&#160;   <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(2, <span class="stringliteral">&quot;Stopped server :: %s\n&quot;</span>, desc-&gt;<a class="code" href="../../da/d2b/structast__tcptls__session__args.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>);</div><div class="line"><a name="l00873"></a><span class="lineno">  873</span>&#160;}</div><div class="ttc" id="structast__tls__config_html_a6005f11af6a60f4169876fcd075595ca"><div class="ttname"><a href="../../d5/d90/structast__tls__config.html#a6005f11af6a60f4169876fcd075595ca">ast_tls_config::pvtfile</a></div><div class="ttdeci">char * pvtfile</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/ddf/tcptls_8h_source.html#l00090">tcptls.h:90</a></div></div>
<div class="ttc" id="resample_8c_html_a070d2ce7b6bb7e5c05602aa8c308d0c4"><div class="ttname"><a href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a></div><div class="ttdeci">#define NULL</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d7f/resample_8c_source.html#l00096">resample.c:96</a></div></div>
<div class="ttc" id="structast__tcptls__session__args_html_a9e187fd6e33fd32a888531467786c773"><div class="ttname"><a href="../../da/d2b/structast__tcptls__session__args.html#a9e187fd6e33fd32a888531467786c773">ast_tcptls_session_args::master</a></div><div class="ttdeci">pthread_t master</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/ddf/tcptls_8h_source.html#l00138">tcptls.h:138</a></div></div>
<div class="ttc" id="logger_8h_html_a3f248112c8d6ce7e3959aa723dade648"><div class="ttname"><a href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a></div><div class="ttdeci">#define ast_debug(level,...)</div><div class="ttdoc">Log a DEBUG message. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d8c/logger_8h_source.html#l00452">logger.h:452</a></div></div>
<div class="ttc" id="lock_8h_html_a6009440c7a72f8e2e3b1ec97641ad160"><div class="ttname"><a href="../../dd/d42/lock_8h.html#a6009440c7a72f8e2e3b1ec97641ad160">AST_PTHREADT_NULL</a></div><div class="ttdeci">#define AST_PTHREADT_NULL</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d42/lock_8h_source.html#l00066">lock.h:66</a></div></div>
<div class="ttc" id="structast__tls__config_html_a9ff8d56644bac1d41f8039f2fde5acf2"><div class="ttname"><a href="../../d5/d90/structast__tls__config.html#a9ff8d56644bac1d41f8039f2fde5acf2">ast_tls_config::cafile</a></div><div class="ttdeci">char * cafile</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/ddf/tcptls_8h_source.html#l00092">tcptls.h:92</a></div></div>
<div class="ttc" id="astmm_8h_html_a402072d6789f6ed9e3a81da27504127e"><div class="ttname"><a href="../../d8/d8a/astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a></div><div class="ttdeci">#define ast_free(a)</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d8a/astmm_8h_source.html#l00182">astmm.h:182</a></div></div>
<div class="ttc" id="structast__tcptls__session__args_html_a20cf0c41efdc66f5b8c2880c1011ac66"><div class="ttname"><a href="../../da/d2b/structast__tcptls__session__args.html#a20cf0c41efdc66f5b8c2880c1011ac66">ast_tcptls_session_args::old_tls_cfg</a></div><div class="ttdeci">struct ast_tls_config * old_tls_cfg</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/ddf/tcptls_8h_source.html#l00143">tcptls.h:143</a></div></div>
<div class="ttc" id="structast__tls__config_html_a333dffcec025fcdbee0676476f401685"><div class="ttname"><a href="../../d5/d90/structast__tls__config.html#a333dffcec025fcdbee0676476f401685">ast_tls_config::certfile</a></div><div class="ttdeci">char * certfile</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/ddf/tcptls_8h_source.html#l00089">tcptls.h:89</a></div></div>
<div class="ttc" id="structast__tcptls__session__args_html_a8f8f80d37794cde9472343e4487ba3eb"><div class="ttname"><a href="../../da/d2b/structast__tcptls__session__args.html#a8f8f80d37794cde9472343e4487ba3eb">ast_tcptls_session_args::name</a></div><div class="ttdeci">const char * name</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/ddf/tcptls_8h_source.html#l00142">tcptls.h:142</a></div></div>
<div class="ttc" id="structast__tcptls__session__args_html_ad6d7a8463d59a02084cf9d4360f46b79"><div class="ttname"><a href="../../da/d2b/structast__tcptls__session__args.html#ad6d7a8463d59a02084cf9d4360f46b79">ast_tcptls_session_args::accept_fd</a></div><div class="ttdeci">int accept_fd</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/ddf/tcptls_8h_source.html#l00135">tcptls.h:135</a></div></div>
<div class="ttc" id="structast__tls__config_html_a8331a8443119478cd6b1daeb707a94dc"><div class="ttname"><a href="../../d5/d90/structast__tls__config.html#a8331a8443119478cd6b1daeb707a94dc">ast_tls_config::capath</a></div><div class="ttdeci">char * capath</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/ddf/tcptls_8h_source.html#l00093">tcptls.h:93</a></div></div>
<div class="ttc" id="structast__tls__config_html_a3d12e13733aa5172b5cb091fbf8ea478"><div class="ttname"><a href="../../d5/d90/structast__tls__config.html#a3d12e13733aa5172b5cb091fbf8ea478">ast_tls_config::cipher</a></div><div class="ttdeci">char * cipher</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/ddf/tcptls_8h_source.html#l00091">tcptls.h:91</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a79d9a3beb22f1fb8551cef625e9fd8a1"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a79d9a3beb22f1fb8551cef625e9fd8a1">&#9670;&nbsp;</a></span>ast_tls_read_conf()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ast_tls_read_conf </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="../../d5/d90/structast__tls__config.html">ast_tls_config</a> *&#160;</td>
          <td class="paramname"><em>tls_cfg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="../../da/d2b/structast__tcptls__session__args.html">ast_tcptls_session_args</a> *&#160;</td>
          <td class="paramname"><em>tls_desc</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>varname</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>value</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Used to parse conf files containing tls/ssl options. </p>

<p class="definition">Definition at line <a class="el" href="../../dc/d9b/tcptls_8c_source.html#l00875">875</a> of file <a class="el" href="../../dc/d9b/tcptls_8c_source.html">tcptls.c</a>.</p>

<p class="reference">References <a class="el" href="../../d5/d60/utils_8h_source.html#l00077">ast_clear_flag</a>, <a class="el" href="../../d8/d8a/astmm_8h_source.html#l00182">ast_free</a>, <a class="el" href="../../da/df7/astobj2_8c_source.html#l00042">ast_log</a>, <a class="el" href="../../d2/d9d/main_2config_8c_source.html#l03657">ast_parse_arg()</a>, <a class="el" href="../../d5/d60/utils_8h_source.html#l00094">ast_set2_flag</a>, <a class="el" href="../../d5/d60/utils_8h_source.html#l00070">ast_set_flag</a>, <a class="el" href="../../d4/ddf/tcptls_8h_source.html#l00080">AST_SSL_DISABLE_TLSV1</a>, <a class="el" href="../../d4/ddf/tcptls_8h_source.html#l00082">AST_SSL_DISABLE_TLSV11</a>, <a class="el" href="../../d4/ddf/tcptls_8h_source.html#l00084">AST_SSL_DISABLE_TLSV12</a>, <a class="el" href="../../d4/ddf/tcptls_8h_source.html#l00068">AST_SSL_DONT_VERIFY_SERVER</a>, <a class="el" href="../../d4/ddf/tcptls_8h_source.html#l00078">AST_SSL_SERVER_CIPHER_ORDER</a>, <a class="el" href="../../d4/ddf/tcptls_8h_source.html#l00072">AST_SSL_SSLV2_CLIENT</a>, <a class="el" href="../../d4/ddf/tcptls_8h_source.html#l00074">AST_SSL_SSLV3_CLIENT</a>, <a class="el" href="../../d4/ddf/tcptls_8h_source.html#l00076">AST_SSL_TLSV1_CLIENT</a>, <a class="el" href="../../d4/ddf/tcptls_8h_source.html#l00066">AST_SSL_VERIFY_CLIENT</a>, <a class="el" href="../../d8/d8a/astmm_8h_source.html#l00243">ast_strdup</a>, <a class="el" href="../../de/d1f/main_2utils_8c_source.html#l01951">ast_true()</a>, <a class="el" href="../../d4/ddf/tcptls_8h_source.html#l00092">ast_tls_config::cafile</a>, <a class="el" href="../../d4/ddf/tcptls_8h_source.html#l00093">ast_tls_config::capath</a>, <a class="el" href="../../d4/ddf/tcptls_8h_source.html#l00089">ast_tls_config::certfile</a>, <a class="el" href="../../d4/ddf/tcptls_8h_source.html#l00091">ast_tls_config::cipher</a>, <a class="el" href="../../d4/ddf/tcptls_8h_source.html#l00088">ast_tls_config::enabled</a>, <a class="el" href="../../d4/ddf/tcptls_8h_source.html#l00094">ast_tls_config::flags</a>, <a class="el" href="../../d4/ddf/tcptls_8h_source.html#l00130">ast_tcptls_session_args::local_address</a>, <a class="el" href="../../d1/d8c/logger_8h_source.html#l00285">LOG_ERROR</a>, <a class="el" href="../../d3/de6/include_2asterisk_2config_8h_source.html#l01104">PARSE_ADDR</a>, and <a class="el" href="../../d4/ddf/tcptls_8h_source.html#l00090">ast_tls_config::pvtfile</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../dd/d43/http_8c_source.html#l02077">__ast_http_load()</a>, <a class="el" href="../../d4/d10/manager_8c_source.html#l09144">__init_manager()</a>, and <a class="el" href="../../d5/dfe/chan__sip_8c_source.html#l32514">reload_config()</a>.</p>
<div class="fragment"><div class="line"><a name="l00876"></a><span class="lineno">  876</span>&#160;{</div><div class="line"><a name="l00877"></a><span class="lineno">  877</span>&#160;   <span class="keywordflow">if</span> (!strcasecmp(varname, <span class="stringliteral">&quot;tlsenable&quot;</span>) || !strcasecmp(varname, <span class="stringliteral">&quot;sslenable&quot;</span>)) {</div><div class="line"><a name="l00878"></a><span class="lineno">  878</span>&#160;      tls_cfg-&gt;<a class="code" href="../../d5/d90/structast__tls__config.html#a03e6cca0c879c0443efb431c30c14f76">enabled</a> = <a class="code" href="../../d6/d90/strings_8h.html#a387a69b3871ca31061566a73f45d20f4">ast_true</a>(<a class="code" href="../../d4/d2f/syslog_8c.html#ac4f474c82e82cbb89ca7c36dd52be0ed">value</a>) ? 1 : 0;</div><div class="line"><a name="l00879"></a><span class="lineno">  879</span>&#160;   } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(varname, <span class="stringliteral">&quot;tlscertfile&quot;</span>) || !strcasecmp(varname, <span class="stringliteral">&quot;sslcert&quot;</span>) || !strcasecmp(varname, <span class="stringliteral">&quot;tlscert&quot;</span>)) {</div><div class="line"><a name="l00880"></a><span class="lineno">  880</span>&#160;      <a class="code" href="../../d8/d8a/astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(tls_cfg-&gt;<a class="code" href="../../d5/d90/structast__tls__config.html#a333dffcec025fcdbee0676476f401685">certfile</a>);</div><div class="line"><a name="l00881"></a><span class="lineno">  881</span>&#160;      tls_cfg-&gt;<a class="code" href="../../d5/d90/structast__tls__config.html#a333dffcec025fcdbee0676476f401685">certfile</a> = <a class="code" href="../../d8/d8a/astmm_8h.html#ab263849d03fb892847be4986db759737">ast_strdup</a>(<a class="code" href="../../d4/d2f/syslog_8c.html#ac4f474c82e82cbb89ca7c36dd52be0ed">value</a>);</div><div class="line"><a name="l00882"></a><span class="lineno">  882</span>&#160;   } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(varname, <span class="stringliteral">&quot;tlsprivatekey&quot;</span>) || !strcasecmp(varname, <span class="stringliteral">&quot;sslprivatekey&quot;</span>)) {</div><div class="line"><a name="l00883"></a><span class="lineno">  883</span>&#160;      <a class="code" href="../../d8/d8a/astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(tls_cfg-&gt;<a class="code" href="../../d5/d90/structast__tls__config.html#a6005f11af6a60f4169876fcd075595ca">pvtfile</a>);</div><div class="line"><a name="l00884"></a><span class="lineno">  884</span>&#160;      tls_cfg-&gt;<a class="code" href="../../d5/d90/structast__tls__config.html#a6005f11af6a60f4169876fcd075595ca">pvtfile</a> = <a class="code" href="../../d8/d8a/astmm_8h.html#ab263849d03fb892847be4986db759737">ast_strdup</a>(<a class="code" href="../../d4/d2f/syslog_8c.html#ac4f474c82e82cbb89ca7c36dd52be0ed">value</a>);</div><div class="line"><a name="l00885"></a><span class="lineno">  885</span>&#160;   } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(varname, <span class="stringliteral">&quot;tlscipher&quot;</span>) || !strcasecmp(varname, <span class="stringliteral">&quot;sslcipher&quot;</span>)) {</div><div class="line"><a name="l00886"></a><span class="lineno">  886</span>&#160;      <a class="code" href="../../d8/d8a/astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(tls_cfg-&gt;<a class="code" href="../../d5/d90/structast__tls__config.html#a3d12e13733aa5172b5cb091fbf8ea478">cipher</a>);</div><div class="line"><a name="l00887"></a><span class="lineno">  887</span>&#160;      tls_cfg-&gt;<a class="code" href="../../d5/d90/structast__tls__config.html#a3d12e13733aa5172b5cb091fbf8ea478">cipher</a> = <a class="code" href="../../d8/d8a/astmm_8h.html#ab263849d03fb892847be4986db759737">ast_strdup</a>(<a class="code" href="../../d4/d2f/syslog_8c.html#ac4f474c82e82cbb89ca7c36dd52be0ed">value</a>);</div><div class="line"><a name="l00888"></a><span class="lineno">  888</span>&#160;   } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(varname, <span class="stringliteral">&quot;tlscafile&quot;</span>)) {</div><div class="line"><a name="l00889"></a><span class="lineno">  889</span>&#160;      <a class="code" href="../../d8/d8a/astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(tls_cfg-&gt;<a class="code" href="../../d5/d90/structast__tls__config.html#a9ff8d56644bac1d41f8039f2fde5acf2">cafile</a>);</div><div class="line"><a name="l00890"></a><span class="lineno">  890</span>&#160;      tls_cfg-&gt;<a class="code" href="../../d5/d90/structast__tls__config.html#a9ff8d56644bac1d41f8039f2fde5acf2">cafile</a> = <a class="code" href="../../d8/d8a/astmm_8h.html#ab263849d03fb892847be4986db759737">ast_strdup</a>(<a class="code" href="../../d4/d2f/syslog_8c.html#ac4f474c82e82cbb89ca7c36dd52be0ed">value</a>);</div><div class="line"><a name="l00891"></a><span class="lineno">  891</span>&#160;   } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(varname, <span class="stringliteral">&quot;tlscapath&quot;</span>) || !strcasecmp(varname, <span class="stringliteral">&quot;tlscadir&quot;</span>)) {</div><div class="line"><a name="l00892"></a><span class="lineno">  892</span>&#160;      <a class="code" href="../../d8/d8a/astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(tls_cfg-&gt;<a class="code" href="../../d5/d90/structast__tls__config.html#a8331a8443119478cd6b1daeb707a94dc">capath</a>);</div><div class="line"><a name="l00893"></a><span class="lineno">  893</span>&#160;      tls_cfg-&gt;<a class="code" href="../../d5/d90/structast__tls__config.html#a8331a8443119478cd6b1daeb707a94dc">capath</a> = <a class="code" href="../../d8/d8a/astmm_8h.html#ab263849d03fb892847be4986db759737">ast_strdup</a>(<a class="code" href="../../d4/d2f/syslog_8c.html#ac4f474c82e82cbb89ca7c36dd52be0ed">value</a>);</div><div class="line"><a name="l00894"></a><span class="lineno">  894</span>&#160;   } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(varname, <span class="stringliteral">&quot;tlsverifyclient&quot;</span>)) {</div><div class="line"><a name="l00895"></a><span class="lineno">  895</span>&#160;      <a class="code" href="../../d5/d60/utils_8h.html#a67b6713ff86cf82aaed821e9a87d1c21">ast_set2_flag</a>(&amp;tls_cfg-&gt;<a class="code" href="../../d5/d90/structast__tls__config.html#aec78000b2897c094f68ed72559e18acd">flags</a>, <a class="code" href="../../d6/d90/strings_8h.html#a387a69b3871ca31061566a73f45d20f4">ast_true</a>(<a class="code" href="../../d4/d2f/syslog_8c.html#ac4f474c82e82cbb89ca7c36dd52be0ed">value</a>), <a class="code" href="../../d4/ddf/tcptls_8h.html#a667a09d76fe878551ac296875754971ca26806f8aa1f6534c10f6bfe0989948ab">AST_SSL_VERIFY_CLIENT</a>);</div><div class="line"><a name="l00896"></a><span class="lineno">  896</span>&#160;   } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(varname, <span class="stringliteral">&quot;tlsdontverifyserver&quot;</span>)) {</div><div class="line"><a name="l00897"></a><span class="lineno">  897</span>&#160;      <a class="code" href="../../d5/d60/utils_8h.html#a67b6713ff86cf82aaed821e9a87d1c21">ast_set2_flag</a>(&amp;tls_cfg-&gt;<a class="code" href="../../d5/d90/structast__tls__config.html#aec78000b2897c094f68ed72559e18acd">flags</a>, <a class="code" href="../../d6/d90/strings_8h.html#a387a69b3871ca31061566a73f45d20f4">ast_true</a>(<a class="code" href="../../d4/d2f/syslog_8c.html#ac4f474c82e82cbb89ca7c36dd52be0ed">value</a>), <a class="code" href="../../d4/ddf/tcptls_8h.html#a667a09d76fe878551ac296875754971ca53c54dbfbad41c1a7ecd6caaf0b06cba">AST_SSL_DONT_VERIFY_SERVER</a>);</div><div class="line"><a name="l00898"></a><span class="lineno">  898</span>&#160;   } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(varname, <span class="stringliteral">&quot;tlsbindaddr&quot;</span>) || !strcasecmp(varname, <span class="stringliteral">&quot;sslbindaddr&quot;</span>)) {</div><div class="line"><a name="l00899"></a><span class="lineno">  899</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="../../d3/de6/include_2asterisk_2config_8h.html#a7e9aea581abeaae5d3799367d95284ac">ast_parse_arg</a>(<a class="code" href="../../d4/d2f/syslog_8c.html#ac4f474c82e82cbb89ca7c36dd52be0ed">value</a>, <a class="code" href="../../d3/de6/include_2asterisk_2config_8h.html#ad60d9d8c34b4f61493c1d85ae02d569fa4b42c80c591c4da820aecc2bb80bde18">PARSE_ADDR</a>, &amp;tls_desc-&gt;<a class="code" href="../../da/d2b/structast__tcptls__session__args.html#a6652499b3aff8f317d4c6d1a36c6c740">local_address</a>))</div><div class="line"><a name="l00900"></a><span class="lineno">  900</span>&#160;         <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Invalid %s &#39;%s&#39;\n&quot;</span>, varname, <a class="code" href="../../d4/d2f/syslog_8c.html#ac4f474c82e82cbb89ca7c36dd52be0ed">value</a>);</div><div class="line"><a name="l00901"></a><span class="lineno">  901</span>&#160;   } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(varname, <span class="stringliteral">&quot;tlsclientmethod&quot;</span>) || !strcasecmp(varname, <span class="stringliteral">&quot;sslclientmethod&quot;</span>)) {</div><div class="line"><a name="l00902"></a><span class="lineno">  902</span>&#160;      <span class="keywordflow">if</span> (!strcasecmp(<a class="code" href="../../d4/d2f/syslog_8c.html#ac4f474c82e82cbb89ca7c36dd52be0ed">value</a>, <span class="stringliteral">&quot;tlsv1&quot;</span>)) {</div><div class="line"><a name="l00903"></a><span class="lineno">  903</span>&#160;         <a class="code" href="../../d5/d60/utils_8h.html#ab5033a1f3d781d45e7ccc27598114510">ast_set_flag</a>(&amp;tls_cfg-&gt;<a class="code" href="../../d5/d90/structast__tls__config.html#aec78000b2897c094f68ed72559e18acd">flags</a>, <a class="code" href="../../d4/ddf/tcptls_8h.html#a667a09d76fe878551ac296875754971ca9d59ad57cfceba9e2854f9b2a271a0bb">AST_SSL_TLSV1_CLIENT</a>);</div><div class="line"><a name="l00904"></a><span class="lineno">  904</span>&#160;         <a class="code" href="../../d5/d60/utils_8h.html#a7b260320610a09017a9416398acd0a70">ast_clear_flag</a>(&amp;tls_cfg-&gt;<a class="code" href="../../d5/d90/structast__tls__config.html#aec78000b2897c094f68ed72559e18acd">flags</a>, <a class="code" href="../../d4/ddf/tcptls_8h.html#a667a09d76fe878551ac296875754971ca55890a6de938cdc69f90cc1b360301f9">AST_SSL_SSLV3_CLIENT</a>);</div><div class="line"><a name="l00905"></a><span class="lineno">  905</span>&#160;         <a class="code" href="../../d5/d60/utils_8h.html#a7b260320610a09017a9416398acd0a70">ast_clear_flag</a>(&amp;tls_cfg-&gt;<a class="code" href="../../d5/d90/structast__tls__config.html#aec78000b2897c094f68ed72559e18acd">flags</a>, <a class="code" href="../../d4/ddf/tcptls_8h.html#a667a09d76fe878551ac296875754971cae98119ef26aab11db1884e23837adb55">AST_SSL_SSLV2_CLIENT</a>);</div><div class="line"><a name="l00906"></a><span class="lineno">  906</span>&#160;      } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(<a class="code" href="../../d4/d2f/syslog_8c.html#ac4f474c82e82cbb89ca7c36dd52be0ed">value</a>, <span class="stringliteral">&quot;sslv3&quot;</span>)) {</div><div class="line"><a name="l00907"></a><span class="lineno">  907</span>&#160;         <a class="code" href="../../d5/d60/utils_8h.html#ab5033a1f3d781d45e7ccc27598114510">ast_set_flag</a>(&amp;tls_cfg-&gt;<a class="code" href="../../d5/d90/structast__tls__config.html#aec78000b2897c094f68ed72559e18acd">flags</a>, <a class="code" href="../../d4/ddf/tcptls_8h.html#a667a09d76fe878551ac296875754971ca55890a6de938cdc69f90cc1b360301f9">AST_SSL_SSLV3_CLIENT</a>);</div><div class="line"><a name="l00908"></a><span class="lineno">  908</span>&#160;         <a class="code" href="../../d5/d60/utils_8h.html#a7b260320610a09017a9416398acd0a70">ast_clear_flag</a>(&amp;tls_cfg-&gt;<a class="code" href="../../d5/d90/structast__tls__config.html#aec78000b2897c094f68ed72559e18acd">flags</a>, <a class="code" href="../../d4/ddf/tcptls_8h.html#a667a09d76fe878551ac296875754971cae98119ef26aab11db1884e23837adb55">AST_SSL_SSLV2_CLIENT</a>);</div><div class="line"><a name="l00909"></a><span class="lineno">  909</span>&#160;         <a class="code" href="../../d5/d60/utils_8h.html#a7b260320610a09017a9416398acd0a70">ast_clear_flag</a>(&amp;tls_cfg-&gt;<a class="code" href="../../d5/d90/structast__tls__config.html#aec78000b2897c094f68ed72559e18acd">flags</a>, <a class="code" href="../../d4/ddf/tcptls_8h.html#a667a09d76fe878551ac296875754971ca9d59ad57cfceba9e2854f9b2a271a0bb">AST_SSL_TLSV1_CLIENT</a>);</div><div class="line"><a name="l00910"></a><span class="lineno">  910</span>&#160;      } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(<a class="code" href="../../d4/d2f/syslog_8c.html#ac4f474c82e82cbb89ca7c36dd52be0ed">value</a>, <span class="stringliteral">&quot;sslv2&quot;</span>)) {</div><div class="line"><a name="l00911"></a><span class="lineno">  911</span>&#160;         <a class="code" href="../../d5/d60/utils_8h.html#ab5033a1f3d781d45e7ccc27598114510">ast_set_flag</a>(&amp;tls_cfg-&gt;<a class="code" href="../../d5/d90/structast__tls__config.html#aec78000b2897c094f68ed72559e18acd">flags</a>, <a class="code" href="../../d4/ddf/tcptls_8h.html#a667a09d76fe878551ac296875754971cae98119ef26aab11db1884e23837adb55">AST_SSL_SSLV2_CLIENT</a>);</div><div class="line"><a name="l00912"></a><span class="lineno">  912</span>&#160;         <a class="code" href="../../d5/d60/utils_8h.html#a7b260320610a09017a9416398acd0a70">ast_clear_flag</a>(&amp;tls_cfg-&gt;<a class="code" href="../../d5/d90/structast__tls__config.html#aec78000b2897c094f68ed72559e18acd">flags</a>, <a class="code" href="../../d4/ddf/tcptls_8h.html#a667a09d76fe878551ac296875754971ca9d59ad57cfceba9e2854f9b2a271a0bb">AST_SSL_TLSV1_CLIENT</a>);</div><div class="line"><a name="l00913"></a><span class="lineno">  913</span>&#160;         <a class="code" href="../../d5/d60/utils_8h.html#a7b260320610a09017a9416398acd0a70">ast_clear_flag</a>(&amp;tls_cfg-&gt;<a class="code" href="../../d5/d90/structast__tls__config.html#aec78000b2897c094f68ed72559e18acd">flags</a>, <a class="code" href="../../d4/ddf/tcptls_8h.html#a667a09d76fe878551ac296875754971ca55890a6de938cdc69f90cc1b360301f9">AST_SSL_SSLV3_CLIENT</a>);</div><div class="line"><a name="l00914"></a><span class="lineno">  914</span>&#160;      }</div><div class="line"><a name="l00915"></a><span class="lineno">  915</span>&#160;   } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(varname, <span class="stringliteral">&quot;tlsservercipherorder&quot;</span>)) {</div><div class="line"><a name="l00916"></a><span class="lineno">  916</span>&#160;      <a class="code" href="../../d5/d60/utils_8h.html#a67b6713ff86cf82aaed821e9a87d1c21">ast_set2_flag</a>(&amp;tls_cfg-&gt;<a class="code" href="../../d5/d90/structast__tls__config.html#aec78000b2897c094f68ed72559e18acd">flags</a>, <a class="code" href="../../d6/d90/strings_8h.html#a387a69b3871ca31061566a73f45d20f4">ast_true</a>(<a class="code" href="../../d4/d2f/syslog_8c.html#ac4f474c82e82cbb89ca7c36dd52be0ed">value</a>), <a class="code" href="../../d4/ddf/tcptls_8h.html#a667a09d76fe878551ac296875754971cabd2609384690cb305648269648e9ff46">AST_SSL_SERVER_CIPHER_ORDER</a>);</div><div class="line"><a name="l00917"></a><span class="lineno">  917</span>&#160;   } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(varname, <span class="stringliteral">&quot;tlsdisablev1&quot;</span>)) {</div><div class="line"><a name="l00918"></a><span class="lineno">  918</span>&#160;      <a class="code" href="../../d5/d60/utils_8h.html#a67b6713ff86cf82aaed821e9a87d1c21">ast_set2_flag</a>(&amp;tls_cfg-&gt;<a class="code" href="../../d5/d90/structast__tls__config.html#aec78000b2897c094f68ed72559e18acd">flags</a>, <a class="code" href="../../d6/d90/strings_8h.html#a387a69b3871ca31061566a73f45d20f4">ast_true</a>(<a class="code" href="../../d4/d2f/syslog_8c.html#ac4f474c82e82cbb89ca7c36dd52be0ed">value</a>), <a class="code" href="../../d4/ddf/tcptls_8h.html#a667a09d76fe878551ac296875754971cae2335e286c6332acafc11c55bda2b3ef">AST_SSL_DISABLE_TLSV1</a>);</div><div class="line"><a name="l00919"></a><span class="lineno">  919</span>&#160;   } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(varname, <span class="stringliteral">&quot;tlsdisablev11&quot;</span>)) {</div><div class="line"><a name="l00920"></a><span class="lineno">  920</span>&#160;      <a class="code" href="../../d5/d60/utils_8h.html#a67b6713ff86cf82aaed821e9a87d1c21">ast_set2_flag</a>(&amp;tls_cfg-&gt;<a class="code" href="../../d5/d90/structast__tls__config.html#aec78000b2897c094f68ed72559e18acd">flags</a>, <a class="code" href="../../d6/d90/strings_8h.html#a387a69b3871ca31061566a73f45d20f4">ast_true</a>(<a class="code" href="../../d4/d2f/syslog_8c.html#ac4f474c82e82cbb89ca7c36dd52be0ed">value</a>), <a class="code" href="../../d4/ddf/tcptls_8h.html#a667a09d76fe878551ac296875754971ca73370a73491eb5332459590aec17dcfd">AST_SSL_DISABLE_TLSV11</a>);</div><div class="line"><a name="l00921"></a><span class="lineno">  921</span>&#160;   } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(varname, <span class="stringliteral">&quot;tlsdisablev12&quot;</span>)) {</div><div class="line"><a name="l00922"></a><span class="lineno">  922</span>&#160;      <a class="code" href="../../d5/d60/utils_8h.html#a67b6713ff86cf82aaed821e9a87d1c21">ast_set2_flag</a>(&amp;tls_cfg-&gt;<a class="code" href="../../d5/d90/structast__tls__config.html#aec78000b2897c094f68ed72559e18acd">flags</a>, <a class="code" href="../../d6/d90/strings_8h.html#a387a69b3871ca31061566a73f45d20f4">ast_true</a>(<a class="code" href="../../d4/d2f/syslog_8c.html#ac4f474c82e82cbb89ca7c36dd52be0ed">value</a>), <a class="code" href="../../d4/ddf/tcptls_8h.html#a667a09d76fe878551ac296875754971caa9ae1ac923a99921ec8798d7100470f2">AST_SSL_DISABLE_TLSV12</a>);</div><div class="line"><a name="l00923"></a><span class="lineno">  923</span>&#160;   } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00924"></a><span class="lineno">  924</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l00925"></a><span class="lineno">  925</span>&#160;   }</div><div class="line"><a name="l00926"></a><span class="lineno">  926</span>&#160;</div><div class="line"><a name="l00927"></a><span class="lineno">  927</span>&#160;   <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00928"></a><span class="lineno">  928</span>&#160;}</div><div class="ttc" id="structast__tls__config_html_a6005f11af6a60f4169876fcd075595ca"><div class="ttname"><a href="../../d5/d90/structast__tls__config.html#a6005f11af6a60f4169876fcd075595ca">ast_tls_config::pvtfile</a></div><div class="ttdeci">char * pvtfile</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/ddf/tcptls_8h_source.html#l00090">tcptls.h:90</a></div></div>
<div class="ttc" id="utils_8h_html_a67b6713ff86cf82aaed821e9a87d1c21"><div class="ttname"><a href="../../d5/d60/utils_8h.html#a67b6713ff86cf82aaed821e9a87d1c21">ast_set2_flag</a></div><div class="ttdeci">#define ast_set2_flag(p, value, flag)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d60/utils_8h_source.html#l00094">utils.h:94</a></div></div>
<div class="ttc" id="utils_8h_html_ab5033a1f3d781d45e7ccc27598114510"><div class="ttname"><a href="../../d5/d60/utils_8h.html#ab5033a1f3d781d45e7ccc27598114510">ast_set_flag</a></div><div class="ttdeci">#define ast_set_flag(p, flag)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d60/utils_8h_source.html#l00070">utils.h:70</a></div></div>
<div class="ttc" id="astmm_8h_html_ab263849d03fb892847be4986db759737"><div class="ttname"><a href="../../d8/d8a/astmm_8h.html#ab263849d03fb892847be4986db759737">ast_strdup</a></div><div class="ttdeci">#define ast_strdup(str)</div><div class="ttdoc">A wrapper for strdup() </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d8a/astmm_8h_source.html#l00243">astmm.h:243</a></div></div>
<div class="ttc" id="syslog_8c_html_ac4f474c82e82cbb89ca7c36dd52be0ed"><div class="ttname"><a href="../../d4/d2f/syslog_8c.html#ac4f474c82e82cbb89ca7c36dd52be0ed">value</a></div><div class="ttdeci">int value</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d2f/syslog_8c_source.html#l00037">syslog.c:37</a></div></div>
<div class="ttc" id="include_2asterisk_2config_8h_html_ad60d9d8c34b4f61493c1d85ae02d569fa4b42c80c591c4da820aecc2bb80bde18"><div class="ttname"><a href="../../d3/de6/include_2asterisk_2config_8h.html#ad60d9d8c34b4f61493c1d85ae02d569fa4b42c80c591c4da820aecc2bb80bde18">PARSE_ADDR</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d3/de6/include_2asterisk_2config_8h_source.html#l01104">include/asterisk/config.h:1104</a></div></div>
<div class="ttc" id="astobj2_8c_html_a96a00b3a518d7f32b6d51dc28f09bf9b"><div class="ttname"><a href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a></div><div class="ttdeci">#define ast_log</div><div class="ttdef"><b>Definition:</b> <a href="../../da/df7/astobj2_8c_source.html#l00042">astobj2.c:42</a></div></div>
<div class="ttc" id="tcptls_8h_html_a667a09d76fe878551ac296875754971ca9d59ad57cfceba9e2854f9b2a271a0bb"><div class="ttname"><a href="../../d4/ddf/tcptls_8h.html#a667a09d76fe878551ac296875754971ca9d59ad57cfceba9e2854f9b2a271a0bb">AST_SSL_TLSV1_CLIENT</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d4/ddf/tcptls_8h_source.html#l00076">tcptls.h:76</a></div></div>
<div class="ttc" id="tcptls_8h_html_a667a09d76fe878551ac296875754971cabd2609384690cb305648269648e9ff46"><div class="ttname"><a href="../../d4/ddf/tcptls_8h.html#a667a09d76fe878551ac296875754971cabd2609384690cb305648269648e9ff46">AST_SSL_SERVER_CIPHER_ORDER</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d4/ddf/tcptls_8h_source.html#l00078">tcptls.h:78</a></div></div>
<div class="ttc" id="tcptls_8h_html_a667a09d76fe878551ac296875754971caa9ae1ac923a99921ec8798d7100470f2"><div class="ttname"><a href="../../d4/ddf/tcptls_8h.html#a667a09d76fe878551ac296875754971caa9ae1ac923a99921ec8798d7100470f2">AST_SSL_DISABLE_TLSV12</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d4/ddf/tcptls_8h_source.html#l00084">tcptls.h:84</a></div></div>
<div class="ttc" id="logger_8h_html_aced66975c154ea0e2a8ec3bc818b4e08"><div class="ttname"><a href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a></div><div class="ttdeci">#define LOG_ERROR</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d8c/logger_8h_source.html#l00285">logger.h:285</a></div></div>
<div class="ttc" id="strings_8h_html_a387a69b3871ca31061566a73f45d20f4"><div class="ttname"><a href="../../d6/d90/strings_8h.html#a387a69b3871ca31061566a73f45d20f4">ast_true</a></div><div class="ttdeci">int attribute_pure ast_true(const char *val)</div><div class="ttdoc">Make sure something is true. Determine if a string containing a boolean value is &quot;true&quot;. This function checks to see whether a string passed to it is an indication of an &quot;true&quot; value. It checks to see if the string is &quot;yes&quot;, &quot;true&quot;, &quot;y&quot;, &quot;t&quot;, &quot;on&quot; or &quot;1&quot;. </div><div class="ttdef"><b>Definition:</b> <a href="../../de/d1f/main_2utils_8c_source.html#l01951">main/utils.c:1951</a></div></div>
<div class="ttc" id="tcptls_8h_html_a667a09d76fe878551ac296875754971cae98119ef26aab11db1884e23837adb55"><div class="ttname"><a href="../../d4/ddf/tcptls_8h.html#a667a09d76fe878551ac296875754971cae98119ef26aab11db1884e23837adb55">AST_SSL_SSLV2_CLIENT</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d4/ddf/tcptls_8h_source.html#l00072">tcptls.h:72</a></div></div>
<div class="ttc" id="tcptls_8h_html_a667a09d76fe878551ac296875754971cae2335e286c6332acafc11c55bda2b3ef"><div class="ttname"><a href="../../d4/ddf/tcptls_8h.html#a667a09d76fe878551ac296875754971cae2335e286c6332acafc11c55bda2b3ef">AST_SSL_DISABLE_TLSV1</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d4/ddf/tcptls_8h_source.html#l00080">tcptls.h:80</a></div></div>
<div class="ttc" id="tcptls_8h_html_a667a09d76fe878551ac296875754971ca73370a73491eb5332459590aec17dcfd"><div class="ttname"><a href="../../d4/ddf/tcptls_8h.html#a667a09d76fe878551ac296875754971ca73370a73491eb5332459590aec17dcfd">AST_SSL_DISABLE_TLSV11</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d4/ddf/tcptls_8h_source.html#l00082">tcptls.h:82</a></div></div>
<div class="ttc" id="structast__tls__config_html_a9ff8d56644bac1d41f8039f2fde5acf2"><div class="ttname"><a href="../../d5/d90/structast__tls__config.html#a9ff8d56644bac1d41f8039f2fde5acf2">ast_tls_config::cafile</a></div><div class="ttdeci">char * cafile</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/ddf/tcptls_8h_source.html#l00092">tcptls.h:92</a></div></div>
<div class="ttc" id="astmm_8h_html_a402072d6789f6ed9e3a81da27504127e"><div class="ttname"><a href="../../d8/d8a/astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a></div><div class="ttdeci">#define ast_free(a)</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d8a/astmm_8h_source.html#l00182">astmm.h:182</a></div></div>
<div class="ttc" id="include_2asterisk_2config_8h_html_a7e9aea581abeaae5d3799367d95284ac"><div class="ttname"><a href="../../d3/de6/include_2asterisk_2config_8h.html#a7e9aea581abeaae5d3799367d95284ac">ast_parse_arg</a></div><div class="ttdeci">int ast_parse_arg(const char *arg, enum ast_parse_flags flags, void *result,...)</div><div class="ttdoc">The argument parsing routine. </div><div class="ttdef"><b>Definition:</b> <a href="../../d2/d9d/main_2config_8c_source.html#l03657">main/config.c:3657</a></div></div>
<div class="ttc" id="structast__tls__config_html_a333dffcec025fcdbee0676476f401685"><div class="ttname"><a href="../../d5/d90/structast__tls__config.html#a333dffcec025fcdbee0676476f401685">ast_tls_config::certfile</a></div><div class="ttdeci">char * certfile</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/ddf/tcptls_8h_source.html#l00089">tcptls.h:89</a></div></div>
<div class="ttc" id="utils_8h_html_a7b260320610a09017a9416398acd0a70"><div class="ttname"><a href="../../d5/d60/utils_8h.html#a7b260320610a09017a9416398acd0a70">ast_clear_flag</a></div><div class="ttdeci">#define ast_clear_flag(p, flag)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d60/utils_8h_source.html#l00077">utils.h:77</a></div></div>
<div class="ttc" id="tcptls_8h_html_a667a09d76fe878551ac296875754971ca53c54dbfbad41c1a7ecd6caaf0b06cba"><div class="ttname"><a href="../../d4/ddf/tcptls_8h.html#a667a09d76fe878551ac296875754971ca53c54dbfbad41c1a7ecd6caaf0b06cba">AST_SSL_DONT_VERIFY_SERVER</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d4/ddf/tcptls_8h_source.html#l00068">tcptls.h:68</a></div></div>
<div class="ttc" id="tcptls_8h_html_a667a09d76fe878551ac296875754971ca26806f8aa1f6534c10f6bfe0989948ab"><div class="ttname"><a href="../../d4/ddf/tcptls_8h.html#a667a09d76fe878551ac296875754971ca26806f8aa1f6534c10f6bfe0989948ab">AST_SSL_VERIFY_CLIENT</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d4/ddf/tcptls_8h_source.html#l00066">tcptls.h:66</a></div></div>
<div class="ttc" id="structast__tls__config_html_aec78000b2897c094f68ed72559e18acd"><div class="ttname"><a href="../../d5/d90/structast__tls__config.html#aec78000b2897c094f68ed72559e18acd">ast_tls_config::flags</a></div><div class="ttdeci">struct ast_flags flags</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/ddf/tcptls_8h_source.html#l00094">tcptls.h:94</a></div></div>
<div class="ttc" id="structast__tls__config_html_a8331a8443119478cd6b1daeb707a94dc"><div class="ttname"><a href="../../d5/d90/structast__tls__config.html#a8331a8443119478cd6b1daeb707a94dc">ast_tls_config::capath</a></div><div class="ttdeci">char * capath</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/ddf/tcptls_8h_source.html#l00093">tcptls.h:93</a></div></div>
<div class="ttc" id="tcptls_8h_html_a667a09d76fe878551ac296875754971ca55890a6de938cdc69f90cc1b360301f9"><div class="ttname"><a href="../../d4/ddf/tcptls_8h.html#a667a09d76fe878551ac296875754971ca55890a6de938cdc69f90cc1b360301f9">AST_SSL_SSLV3_CLIENT</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d4/ddf/tcptls_8h_source.html#l00074">tcptls.h:74</a></div></div>
<div class="ttc" id="structast__tcptls__session__args_html_a6652499b3aff8f317d4c6d1a36c6c740"><div class="ttname"><a href="../../da/d2b/structast__tcptls__session__args.html#a6652499b3aff8f317d4c6d1a36c6c740">ast_tcptls_session_args::local_address</a></div><div class="ttdeci">struct ast_sockaddr local_address</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/ddf/tcptls_8h_source.html#l00130">tcptls.h:130</a></div></div>
<div class="ttc" id="structast__tls__config_html_a3d12e13733aa5172b5cb091fbf8ea478"><div class="ttname"><a href="../../d5/d90/structast__tls__config.html#a3d12e13733aa5172b5cb091fbf8ea478">ast_tls_config::cipher</a></div><div class="ttdeci">char * cipher</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/ddf/tcptls_8h_source.html#l00091">tcptls.h:91</a></div></div>
<div class="ttc" id="structast__tls__config_html_a03e6cca0c879c0443efb431c30c14f76"><div class="ttname"><a href="../../d5/d90/structast__tls__config.html#a03e6cca0c879c0443efb431c30c14f76">ast_tls_config::enabled</a></div><div class="ttdeci">int enabled</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/ddf/tcptls_8h_source.html#l00088">tcptls.h:88</a></div></div>
</div><!-- fragment -->
</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Sun Aug 8 2021 19:46:52 for Asterisk - The Open Source Telephony Project by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="../../doxygen.png" alt="doxygen"/>
</a> 1.8.13
</small></address>
</body>
</html>
