<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Asterisk - The Open Source Telephony Project: res_sorcery_memory_cache.c Source File</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Asterisk - The Open Source Telephony Project
   &#160;<span id="projectnumber">18.5.0</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "../../search",false,'Search');
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('../../',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="../../dir_7b47cca4d318623bb4270ab1fb592ef5.html">res</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">res_sorcery_memory_cache.c</div>  </div>
</div><!--header-->
<div class="contents">
<a href="../../d7/d30/res__sorcery__memory__cache_8c.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="comment">/*</span></div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="comment"> * Asterisk -- An open source telephony toolkit.</span></div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="comment"> * Copyright (C) 2015, Digium, Inc.</span></div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="comment"> * Joshua Colp &lt;jcolp@digium.com&gt;</span></div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="comment"> * See http://www.asterisk.org for more information about</span></div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="comment"> * the Asterisk project. Please do not directly contact</span></div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;<span class="comment"> * any of the maintainers of this project for assistance;</span></div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;<span class="comment"> * the project provides a web site, mailing lists and IRC</span></div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;<span class="comment"> * channels for your use.</span></div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;<span class="comment"> * This program is free software, distributed under the terms of</span></div><div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;<span class="comment"> * the GNU General Public License Version 2. See the LICENSE file</span></div><div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;<span class="comment"> * at the top of the source tree.</span></div><div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;<span class="comment">/*!</span></div><div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;<span class="comment"> * \file</span></div><div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;<span class="comment"> * \brief Sorcery Memory Cache Object Wizard</span></div><div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;<span class="comment"> * \author Joshua Colp &lt;jcolp@digium.com&gt;</span></div><div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;</div><div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;<span class="comment">/*** MODULEINFO</span></div><div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;<span class="comment">   &lt;support_level&gt;core&lt;/support_level&gt;</span></div><div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;<span class="comment"> ***/</span></div><div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;</div><div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../db/db2/asterisk_8h.html">asterisk.h</a>&quot;</span></div><div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;</div><div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../d5/d16/module_8h.html">asterisk/module.h</a>&quot;</span></div><div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../d8/d25/sorcery_8h.html">asterisk/sorcery.h</a>&quot;</span></div><div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../d5/da5/astobj2_8h.html">asterisk/astobj2.h</a>&quot;</span></div><div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../d7/d00/sched_8h.html">asterisk/sched.h</a>&quot;</span></div><div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../d2/ddc/test_8h.html">asterisk/test.h</a>&quot;</span></div><div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../da/ddb/heap_8h.html">asterisk/heap.h</a>&quot;</span></div><div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../dc/db0/cli_8h.html">asterisk/cli.h</a>&quot;</span></div><div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../db/d45/manager_8h.html">asterisk/manager.h</a>&quot;</span></div><div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;</div><div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;<span class="comment">/*** DOCUMENTATION</span></div><div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;<span class="comment">   &lt;manager name=&quot;SorceryMemoryCacheExpireObject&quot; language=&quot;en_US&quot;&gt;</span></div><div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;<span class="comment">      &lt;synopsis&gt;</span></div><div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;<span class="comment">         Expire (remove) an object from a sorcery memory cache.</span></div><div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;<span class="comment">      &lt;/synopsis&gt;</span></div><div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;<span class="comment">      &lt;syntax&gt;</span></div><div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;<span class="comment">         &lt;xi:include xpointer=&quot;xpointer(/docs/manager[@name=&#39;Login&#39;]/syntax/parameter[@name=&#39;ActionID&#39;])&quot; /&gt;</span></div><div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;<span class="comment">         &lt;parameter name=&quot;Cache&quot; required=&quot;true&quot;&gt;</span></div><div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;<span class="comment">            &lt;para&gt;The name of the cache to expire the object from.&lt;/para&gt;</span></div><div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;<span class="comment">         &lt;/parameter&gt;</span></div><div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;<span class="comment">         &lt;parameter name=&quot;Object&quot; required=&quot;true&quot;&gt;</span></div><div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;<span class="comment">            &lt;para&gt;The name of the object to expire.&lt;/para&gt;</span></div><div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;<span class="comment">         &lt;/parameter&gt;</span></div><div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;<span class="comment">      &lt;/syntax&gt;</span></div><div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;<span class="comment">      &lt;description&gt;</span></div><div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;<span class="comment">         &lt;para&gt;Expires (removes) an object from a sorcery memory cache. If full backend caching is enabled</span></div><div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;<span class="comment">         this action is not available and will fail. In this case the SorceryMemoryCachePopulate or</span></div><div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;<span class="comment">         SorceryMemoryCacheExpire AMI actions must be used instead.&lt;/para&gt;</span></div><div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;<span class="comment">      &lt;/description&gt;</span></div><div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;<span class="comment">   &lt;/manager&gt;</span></div><div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;<span class="comment">   &lt;manager name=&quot;SorceryMemoryCacheExpire&quot; language=&quot;en_US&quot;&gt;</span></div><div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;<span class="comment">      &lt;synopsis&gt;</span></div><div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;<span class="comment">         Expire (remove) ALL objects from a sorcery memory cache.</span></div><div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;<span class="comment">      &lt;/synopsis&gt;</span></div><div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;<span class="comment">      &lt;syntax&gt;</span></div><div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;<span class="comment">         &lt;xi:include xpointer=&quot;xpointer(/docs/manager[@name=&#39;Login&#39;]/syntax/parameter[@name=&#39;ActionID&#39;])&quot; /&gt;</span></div><div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;<span class="comment">         &lt;parameter name=&quot;Cache&quot; required=&quot;true&quot;&gt;</span></div><div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;<span class="comment">            &lt;para&gt;The name of the cache to expire all objects from.&lt;/para&gt;</span></div><div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;<span class="comment">         &lt;/parameter&gt;</span></div><div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;<span class="comment">      &lt;/syntax&gt;</span></div><div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;<span class="comment">      &lt;description&gt;</span></div><div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;<span class="comment">         &lt;para&gt;Expires (removes) ALL objects from a sorcery memory cache.&lt;/para&gt;</span></div><div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;<span class="comment">      &lt;/description&gt;</span></div><div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;<span class="comment">   &lt;/manager&gt;</span></div><div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;<span class="comment">   &lt;manager name=&quot;SorceryMemoryCacheStaleObject&quot; language=&quot;en_US&quot;&gt;</span></div><div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;<span class="comment">      &lt;synopsis&gt;</span></div><div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;<span class="comment">         Mark an object in a sorcery memory cache as stale.</span></div><div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;<span class="comment">      &lt;/synopsis&gt;</span></div><div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;<span class="comment">      &lt;syntax&gt;</span></div><div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;<span class="comment">         &lt;xi:include xpointer=&quot;xpointer(/docs/manager[@name=&#39;Login&#39;]/syntax/parameter[@name=&#39;ActionID&#39;])&quot; /&gt;</span></div><div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;<span class="comment">         &lt;parameter name=&quot;Cache&quot; required=&quot;true&quot;&gt;</span></div><div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;<span class="comment">            &lt;para&gt;The name of the cache to mark the object as stale in.&lt;/para&gt;</span></div><div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;<span class="comment">         &lt;/parameter&gt;</span></div><div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;<span class="comment">         &lt;parameter name=&quot;Object&quot; required=&quot;true&quot;&gt;</span></div><div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;<span class="comment">            &lt;para&gt;The name of the object to mark as stale.&lt;/para&gt;</span></div><div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;<span class="comment">         &lt;/parameter&gt;</span></div><div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;<span class="comment">         &lt;parameter name=&quot;Reload&quot; required=&quot;false&quot;&gt;</span></div><div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;<span class="comment">            &lt;para&gt;If true, then immediately reload the object from the backend cache instead of waiting for the next retrieval&lt;/para&gt;</span></div><div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;<span class="comment">         &lt;/parameter&gt;</span></div><div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;<span class="comment">      &lt;/syntax&gt;</span></div><div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;<span class="comment">      &lt;description&gt;</span></div><div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;<span class="comment">         &lt;para&gt;Marks an object as stale within a sorcery memory cache.&lt;/para&gt;</span></div><div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;<span class="comment">      &lt;/description&gt;</span></div><div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;<span class="comment">   &lt;/manager&gt;</span></div><div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;<span class="comment">   &lt;manager name=&quot;SorceryMemoryCacheStale&quot; language=&quot;en_US&quot;&gt;</span></div><div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;<span class="comment">      &lt;synopsis&gt;</span></div><div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;<span class="comment">         Marks ALL objects in a sorcery memory cache as stale.</span></div><div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;<span class="comment">      &lt;/synopsis&gt;</span></div><div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;<span class="comment">      &lt;syntax&gt;</span></div><div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;<span class="comment">         &lt;xi:include xpointer=&quot;xpointer(/docs/manager[@name=&#39;Login&#39;]/syntax/parameter[@name=&#39;ActionID&#39;])&quot; /&gt;</span></div><div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;<span class="comment">         &lt;parameter name=&quot;Cache&quot; required=&quot;true&quot;&gt;</span></div><div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;<span class="comment">            &lt;para&gt;The name of the cache to mark all object as stale in.&lt;/para&gt;</span></div><div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;<span class="comment">         &lt;/parameter&gt;</span></div><div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;<span class="comment">      &lt;/syntax&gt;</span></div><div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;<span class="comment">      &lt;description&gt;</span></div><div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;<span class="comment">         &lt;para&gt;Marks ALL objects in a sorcery memory cache as stale.&lt;/para&gt;</span></div><div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;<span class="comment">      &lt;/description&gt;</span></div><div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;<span class="comment">   &lt;/manager&gt;</span></div><div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;<span class="comment">   &lt;manager name=&quot;SorceryMemoryCachePopulate&quot; language=&quot;en_US&quot;&gt;</span></div><div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;<span class="comment">      &lt;synopsis&gt;</span></div><div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;<span class="comment">         Expire all objects from a memory cache and populate it with all objects from the backend.</span></div><div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;<span class="comment">      &lt;/synopsis&gt;</span></div><div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;<span class="comment">      &lt;syntax&gt;</span></div><div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;<span class="comment">         &lt;xi:include xpointer=&quot;xpointer(/docs/manager[@name=&#39;Login&#39;]/syntax/parameter[@name=&#39;ActionID&#39;])&quot; /&gt;</span></div><div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;<span class="comment">         &lt;parameter name=&quot;Cache&quot; required=&quot;true&quot;&gt;</span></div><div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;<span class="comment">            &lt;para&gt;The name of the cache to populate.&lt;/para&gt;</span></div><div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;<span class="comment">         &lt;/parameter&gt;</span></div><div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;<span class="comment">      &lt;/syntax&gt;</span></div><div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;<span class="comment">      &lt;description&gt;</span></div><div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;<span class="comment">         &lt;para&gt;Expires all objects from a memory cache and populate it with all objects from the backend.&lt;/para&gt;</span></div><div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;<span class="comment">      &lt;/description&gt;</span></div><div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;<span class="comment">   &lt;/manager&gt;</span></div><div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;<span class="comment"> ***/</span></div><div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;<span class="comment">/*! \brief Structure for storing a memory cache */</span></div><div class="line"><a name="l00127"></a><span class="lineno"><a class="line" href="../../d2/d6b/structsorcery__memory__cache.html">  127</a></span>&#160;<span class="keyword">struct </span><a class="code" href="../../d2/d6b/structsorcery__memory__cache.html">sorcery_memory_cache</a> {<span class="comment"></span></div><div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;<span class="comment">   /*! \brief The name of the memory cache */</span></div><div class="line"><a name="l00129"></a><span class="lineno"><a class="line" href="../../d2/d6b/structsorcery__memory__cache.html#a5ac083a645d964373f022d03df4849c8">  129</a></span>&#160;   <span class="keywordtype">char</span> *<a class="code" href="../../d2/d6b/structsorcery__memory__cache.html#a5ac083a645d964373f022d03df4849c8">name</a>;<span class="comment"></span></div><div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;<span class="comment">   /*! \brief Objects in the cache */</span></div><div class="line"><a name="l00131"></a><span class="lineno"><a class="line" href="../../d2/d6b/structsorcery__memory__cache.html#aa0a84e33972901716d6d5a6dcf1a68de">  131</a></span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d2/da9/structao2__container.html">ao2_container</a> *<a class="code" href="../../d2/d6b/structsorcery__memory__cache.html#aa0a84e33972901716d6d5a6dcf1a68de">objects</a>;<span class="comment"></span></div><div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;<span class="comment">   /*! \brief The maximum number of objects permitted in the cache, 0 if no limit */</span></div><div class="line"><a name="l00133"></a><span class="lineno"><a class="line" href="../../d2/d6b/structsorcery__memory__cache.html#a73ce7cbebacf7170f054f846300d67ff">  133</a></span>&#160;   <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="../../d2/d6b/structsorcery__memory__cache.html#a73ce7cbebacf7170f054f846300d67ff">maximum_objects</a>;<span class="comment"></span></div><div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;<span class="comment">   /*! \brief The maximum time (in seconds) an object will stay in the cache, 0 if no limit */</span></div><div class="line"><a name="l00135"></a><span class="lineno"><a class="line" href="../../d2/d6b/structsorcery__memory__cache.html#a890cd2c933f495837f720efe44aa9642">  135</a></span>&#160;   <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="../../d2/d6b/structsorcery__memory__cache.html#a890cd2c933f495837f720efe44aa9642">object_lifetime_maximum</a>;<span class="comment"></span></div><div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;<span class="comment">   /*! \brief The amount of time (in seconds) before an object is marked as stale, 0 if disabled */</span></div><div class="line"><a name="l00137"></a><span class="lineno"><a class="line" href="../../d2/d6b/structsorcery__memory__cache.html#a89b193072cd806e8e239c9a448463efe">  137</a></span>&#160;   <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="../../d2/d6b/structsorcery__memory__cache.html#a89b193072cd806e8e239c9a448463efe">object_lifetime_stale</a>;<span class="comment"></span></div><div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;<span class="comment">   /*! \brief Whether all objects are expired when the object type is reloaded, 0 if disabled */</span></div><div class="line"><a name="l00139"></a><span class="lineno"><a class="line" href="../../d2/d6b/structsorcery__memory__cache.html#a7e8d8ec709f7bce006b45892fa15fdb7">  139</a></span>&#160;   <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="../../d2/d6b/structsorcery__memory__cache.html#a7e8d8ec709f7bce006b45892fa15fdb7">expire_on_reload</a>;<span class="comment"></span></div><div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;<span class="comment">   /*! \brief Whether this is a cache of the entire backend, 0 if disabled */</span></div><div class="line"><a name="l00141"></a><span class="lineno"><a class="line" href="../../d2/d6b/structsorcery__memory__cache.html#acbaed991b7fd3a4fd5661a99cb304d56">  141</a></span>&#160;   <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="../../d2/d6b/structsorcery__memory__cache.html#acbaed991b7fd3a4fd5661a99cb304d56">full_backend_cache</a>;<span class="comment"></span></div><div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;<span class="comment">   /*! \brief Heap of cached objects. Oldest object is at the top. */</span></div><div class="line"><a name="l00143"></a><span class="lineno"><a class="line" href="../../d2/d6b/structsorcery__memory__cache.html#ac2c70d25e5f4a7ef4384b344d4f411ce">  143</a></span>&#160;   <span class="keyword">struct </span><a class="code" href="../../dc/dec/structast__heap.html">ast_heap</a> *<a class="code" href="../../d2/d6b/structsorcery__memory__cache.html#ac2c70d25e5f4a7ef4384b344d4f411ce">object_heap</a>;<span class="comment"></span></div><div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;<span class="comment">   /*! \brief Scheduler item for expiring oldest object. */</span></div><div class="line"><a name="l00145"></a><span class="lineno"><a class="line" href="../../d2/d6b/structsorcery__memory__cache.html#ad6bc34b0274c32a28f0b0803da66ee9e">  145</a></span>&#160;   <span class="keywordtype">int</span> <a class="code" href="../../d2/d6b/structsorcery__memory__cache.html#ad6bc34b0274c32a28f0b0803da66ee9e">expire_id</a>;<span class="comment"></span></div><div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;<span class="comment">   /*! \brief scheduler id of stale update task */</span></div><div class="line"><a name="l00147"></a><span class="lineno"><a class="line" href="../../d2/d6b/structsorcery__memory__cache.html#a59a79dcdae51e4000f776c4c48b8c7d1">  147</a></span>&#160;   <span class="keywordtype">int</span> <a class="code" href="../../d2/d6b/structsorcery__memory__cache.html#a59a79dcdae51e4000f776c4c48b8c7d1">stale_update_sched_id</a>;<span class="comment"></span></div><div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;<span class="comment">   /*! \brief An unreffed pointer to the sorcery instance, accessible only with lock held */</span></div><div class="line"><a name="l00149"></a><span class="lineno"><a class="line" href="../../d2/d6b/structsorcery__memory__cache.html#aeb33dcb5573e1661c82b5370681fb626">  149</a></span>&#160;   <span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="../../d2/d88/structast__sorcery.html">ast_sorcery</a> *<a class="code" href="../../d2/d6b/structsorcery__memory__cache.html#aeb33dcb5573e1661c82b5370681fb626">sorcery</a>;<span class="comment"></span></div><div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;<span class="comment">   /*! \brief The type of object we are caching */</span></div><div class="line"><a name="l00151"></a><span class="lineno"><a class="line" href="../../d2/d6b/structsorcery__memory__cache.html#aaa0b4796a46428e565991525a543f4f0">  151</a></span>&#160;   <span class="keywordtype">char</span> *<a class="code" href="../../d2/d6b/structsorcery__memory__cache.html#aaa0b4796a46428e565991525a543f4f0">object_type</a>;<span class="comment"></span></div><div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;<span class="comment">   /*! TRUE if trying to stop the oldest object expiration scheduler item. */</span></div><div class="line"><a name="l00153"></a><span class="lineno"><a class="line" href="../../d2/d6b/structsorcery__memory__cache.html#a9e6035463adde27a5c155e5221add7cd">  153</a></span>&#160;   <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="../../d2/d6b/structsorcery__memory__cache.html#a9e6035463adde27a5c155e5221add7cd">del_expire</a>:1;</div><div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;<span class="preprocessor">#ifdef TEST_FRAMEWORK</span></div><div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;<span class="comment">   /*! \brief Variable used to indicate we should notify a test when we reach empty */</span></div><div class="line"><a name="l00156"></a><span class="lineno"><a class="line" href="../../d2/d6b/structsorcery__memory__cache.html#ac0ac5403988b7156dde84af2b7054766">  156</a></span>&#160;   <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="../../d2/d6b/structsorcery__memory__cache.html#ac0ac5403988b7156dde84af2b7054766">cache_notify</a>;<span class="comment"></span></div><div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;<span class="comment">   /*! \brief Mutex lock used for signaling when the cache has reached empty */</span></div><div class="line"><a name="l00158"></a><span class="lineno"><a class="line" href="../../d2/d6b/structsorcery__memory__cache.html#adf04f66344e3fb0a6f6a69bf39d19902">  158</a></span>&#160;   <a class="code" href="../../d8/dc5/structast__mutex__info.html">ast_mutex_t</a> <a class="code" href="../../d2/d6b/structsorcery__memory__cache.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>;<span class="comment"></span></div><div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;<span class="comment">   /*! \brief Condition used for signaling when the cache has reached empty */</span></div><div class="line"><a name="l00160"></a><span class="lineno"><a class="line" href="../../d2/d6b/structsorcery__memory__cache.html#a1c7181c39f99ee801943a0d0aa9872b9">  160</a></span>&#160;   <a class="code" href="../../dd/d42/lock_8h.html#ab134d98cdfe7de0f7a72b377c0765dc7">ast_cond_t</a> <a class="code" href="../../d2/d6b/structsorcery__memory__cache.html#a1c7181c39f99ee801943a0d0aa9872b9">cond</a>;<span class="comment"></span></div><div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;<span class="comment">   /*! \brief Variable that is set when the cache has reached empty */</span></div><div class="line"><a name="l00162"></a><span class="lineno"><a class="line" href="../../d2/d6b/structsorcery__memory__cache.html#a1c0f22ced3c7233f3945fcc05219f12a">  162</a></span>&#160;   <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="../../d2/d6b/structsorcery__memory__cache.html#a1c0f22ced3c7233f3945fcc05219f12a">cache_completed</a>;</div><div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;};</div><div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;<span class="comment">/*! \brief Structure for stored a cached object */</span></div><div class="line"><a name="l00167"></a><span class="lineno"><a class="line" href="../../df/d93/structsorcery__memory__cached__object.html">  167</a></span>&#160;<span class="keyword">struct </span><a class="code" href="../../df/d93/structsorcery__memory__cached__object.html">sorcery_memory_cached_object</a> {<span class="comment"></span></div><div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;<span class="comment">   /*! \brief The cached object */</span></div><div class="line"><a name="l00169"></a><span class="lineno"><a class="line" href="../../df/d93/structsorcery__memory__cached__object.html#a077376d12464f945e2414d5499c79b3f">  169</a></span>&#160;   <span class="keywordtype">void</span> *<a class="code" href="../../df/d93/structsorcery__memory__cached__object.html#a077376d12464f945e2414d5499c79b3f">object</a>;<span class="comment"></span></div><div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;<span class="comment">   /*! \brief The time at which the object was created */</span></div><div class="line"><a name="l00171"></a><span class="lineno"><a class="line" href="../../df/d93/structsorcery__memory__cached__object.html#a529e497bc965817d03dbcdc5805305c4">  171</a></span>&#160;   <span class="keyword">struct </span>timeval created;<span class="comment"></span></div><div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;<span class="comment">   /*! \brief index required by heap */</span></div><div class="line"><a name="l00173"></a><span class="lineno"><a class="line" href="../../df/d93/structsorcery__memory__cached__object.html#a3b444e1155e0c3811c338083c63e5f8a">  173</a></span>&#160;   ssize_t <a class="code" href="../../df/d93/structsorcery__memory__cached__object.html#a3b444e1155e0c3811c338083c63e5f8a">__heap_index</a>;<span class="comment"></span></div><div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;<span class="comment">   /*! \brief scheduler id of stale update task */</span></div><div class="line"><a name="l00175"></a><span class="lineno"><a class="line" href="../../df/d93/structsorcery__memory__cached__object.html#a59a79dcdae51e4000f776c4c48b8c7d1">  175</a></span>&#160;   <span class="keywordtype">int</span> <a class="code" href="../../df/d93/structsorcery__memory__cached__object.html#a59a79dcdae51e4000f776c4c48b8c7d1">stale_update_sched_id</a>;<span class="comment"></span></div><div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;<span class="comment">   /*! \brief Cached objectset for field and regex retrieval */</span></div><div class="line"><a name="l00177"></a><span class="lineno"><a class="line" href="../../df/d93/structsorcery__memory__cached__object.html#a269a2854677d498d5b2ffe7cef85a751">  177</a></span>&#160;   <span class="keyword">struct </span><a class="code" href="../../dd/d02/structast__variable.html">ast_variable</a> *<a class="code" href="../../df/d93/structsorcery__memory__cached__object.html#a269a2854677d498d5b2ffe7cef85a751">objectset</a>;</div><div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;};</div><div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;<span class="comment">/*! \brief Structure used for fields comparison */</span></div><div class="line"><a name="l00181"></a><span class="lineno"><a class="line" href="../../d7/d59/structsorcery__memory__cache__fields__cmp__params.html">  181</a></span>&#160;<span class="keyword">struct </span><a class="code" href="../../d7/d59/structsorcery__memory__cache__fields__cmp__params.html">sorcery_memory_cache_fields_cmp_params</a> {<span class="comment"></span></div><div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;<span class="comment">   /*! \brief Pointer to the sorcery structure */</span></div><div class="line"><a name="l00183"></a><span class="lineno"><a class="line" href="../../d7/d59/structsorcery__memory__cache__fields__cmp__params.html#aeb33dcb5573e1661c82b5370681fb626">  183</a></span>&#160;   <span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="../../d2/d88/structast__sorcery.html">ast_sorcery</a> *<a class="code" href="../../d7/d59/structsorcery__memory__cache__fields__cmp__params.html#aeb33dcb5573e1661c82b5370681fb626">sorcery</a>;<span class="comment"></span></div><div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;<span class="comment">   /*! \brief The sorcery memory cache */</span></div><div class="line"><a name="l00185"></a><span class="lineno"><a class="line" href="../../d7/d59/structsorcery__memory__cache__fields__cmp__params.html#ada420b1f724d02917b97a9b0d5288086">  185</a></span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d2/d6b/structsorcery__memory__cache.html">sorcery_memory_cache</a> *<a class="code" href="../../d7/d59/structsorcery__memory__cache__fields__cmp__params.html#ada420b1f724d02917b97a9b0d5288086">cache</a>;<span class="comment"></span></div><div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;<span class="comment">   /*! \brief Pointer to the fields to check */</span></div><div class="line"><a name="l00187"></a><span class="lineno"><a class="line" href="../../d7/d59/structsorcery__memory__cache__fields__cmp__params.html#aed2d94a6fe15ec228d25838ea61f6a94">  187</a></span>&#160;   <span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="../../dd/d02/structast__variable.html">ast_variable</a> *<a class="code" href="../../d7/d59/structsorcery__memory__cache__fields__cmp__params.html#aed2d94a6fe15ec228d25838ea61f6a94">fields</a>;<span class="comment"></span></div><div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;<span class="comment">   /*! \brief Regular expression for checking object id */</span></div><div class="line"><a name="l00189"></a><span class="lineno"><a class="line" href="../../d7/d59/structsorcery__memory__cache__fields__cmp__params.html#af71a3fad7fee5d731252ce89e56f948f">  189</a></span>&#160;   regex_t *<a class="code" href="../../d7/d59/structsorcery__memory__cache__fields__cmp__params.html#af71a3fad7fee5d731252ce89e56f948f">regex</a>;<span class="comment"></span></div><div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;<span class="comment">   /*! \brief Prefix for matching object id */</span></div><div class="line"><a name="l00191"></a><span class="lineno"><a class="line" href="../../d7/d59/structsorcery__memory__cache__fields__cmp__params.html#a5b41c5ae4505891e6c53e26df197e02b">  191</a></span>&#160;   <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="../../d7/d59/structsorcery__memory__cache__fields__cmp__params.html#a5b41c5ae4505891e6c53e26df197e02b">prefix</a>;<span class="comment"></span></div><div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;<span class="comment">   /*! \brief Prefix length in bytes for matching object id */</span></div><div class="line"><a name="l00193"></a><span class="lineno"><a class="line" href="../../d7/d59/structsorcery__memory__cache__fields__cmp__params.html#ae9fc6d86a482d56978b6a7de516da7f8">  193</a></span>&#160;   <span class="keyword">const</span> <span class="keywordtype">size_t</span> <a class="code" href="../../d7/d59/structsorcery__memory__cache__fields__cmp__params.html#ae9fc6d86a482d56978b6a7de516da7f8">prefix_len</a>;<span class="comment"></span></div><div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;<span class="comment">   /*! \brief Optional container to put object into */</span></div><div class="line"><a name="l00195"></a><span class="lineno"><a class="line" href="../../d7/d59/structsorcery__memory__cache__fields__cmp__params.html#a7ea220e4d14b05876af4430e9832ce47">  195</a></span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d2/da9/structao2__container.html">ao2_container</a> *<a class="code" href="../../d7/d59/structsorcery__memory__cache__fields__cmp__params.html#a7ea220e4d14b05876af4430e9832ce47">container</a>;</div><div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;};</div><div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;</div><div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> *<a class="code" href="../../d7/d30/res__sorcery__memory__cache_8c.html#a73c11b5eb7314f2dbd3f32d18b69b10f">sorcery_memory_cache_open</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *data);</div><div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d7/d30/res__sorcery__memory__cache_8c.html#a751f8dcc38eb8ff1f9aee8b2b0c14db0">sorcery_memory_cache_create</a>(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="../../d2/d88/structast__sorcery.html">ast_sorcery</a> *<a class="code" href="../../d2/d6b/structsorcery__memory__cache.html#aeb33dcb5573e1661c82b5370681fb626">sorcery</a>, <span class="keywordtype">void</span> *data, <span class="keywordtype">void</span> *<span class="keywordtype">object</span>);</div><div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d7/d30/res__sorcery__memory__cache_8c.html#a71fbafef4114d205d0efb067d84f47f1">sorcery_memory_cache_load</a>(<span class="keywordtype">void</span> *data, <span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="../../d2/d88/structast__sorcery.html">ast_sorcery</a> *<a class="code" href="../../d2/d6b/structsorcery__memory__cache.html#aeb33dcb5573e1661c82b5370681fb626">sorcery</a>, <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="../../d7/d49/chan__ooh323_8c.html#a4d63fdfe5451ec2248c16a2739190c56">type</a>);</div><div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d7/d30/res__sorcery__memory__cache_8c.html#a6e5cc056cb8ed0f3ff6c59a498b8f974">sorcery_memory_cache_reload</a>(<span class="keywordtype">void</span> *data, <span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="../../d2/d88/structast__sorcery.html">ast_sorcery</a> *<a class="code" href="../../d2/d6b/structsorcery__memory__cache.html#aeb33dcb5573e1661c82b5370681fb626">sorcery</a>, <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="../../d7/d49/chan__ooh323_8c.html#a4d63fdfe5451ec2248c16a2739190c56">type</a>);</div><div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> *<a class="code" href="../../d7/d30/res__sorcery__memory__cache_8c.html#a0e33561fb1fc08c9366a5a83eb83583e">sorcery_memory_cache_retrieve_id</a>(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="../../d2/d88/structast__sorcery.html">ast_sorcery</a> *<a class="code" href="../../d2/d6b/structsorcery__memory__cache.html#aeb33dcb5573e1661c82b5370681fb626">sorcery</a>, <span class="keywordtype">void</span> *data, <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="../../d7/d49/chan__ooh323_8c.html#a4d63fdfe5451ec2248c16a2739190c56">type</a>,</div><div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;   <span class="keyword">const</span> <span class="keywordtype">char</span> *<span class="keywordtype">id</span>);</div><div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> *<a class="code" href="../../d7/d30/res__sorcery__memory__cache_8c.html#a4a0aad57b8dff22d4df96c5000d4fb80">sorcery_memory_cache_retrieve_fields</a>(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="../../d2/d88/structast__sorcery.html">ast_sorcery</a> *<a class="code" href="../../d2/d6b/structsorcery__memory__cache.html#aeb33dcb5573e1661c82b5370681fb626">sorcery</a>, <span class="keywordtype">void</span> *data, <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="../../d7/d49/chan__ooh323_8c.html#a4d63fdfe5451ec2248c16a2739190c56">type</a>,</div><div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;   <span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="../../dd/d02/structast__variable.html">ast_variable</a> *fields);</div><div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d7/d30/res__sorcery__memory__cache_8c.html#acf5c4d16aab69f65543750c6f069fac4">sorcery_memory_cache_retrieve_multiple</a>(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="../../d2/d88/structast__sorcery.html">ast_sorcery</a> *<a class="code" href="../../d2/d6b/structsorcery__memory__cache.html#aeb33dcb5573e1661c82b5370681fb626">sorcery</a>, <span class="keywordtype">void</span> *data, <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="../../d7/d49/chan__ooh323_8c.html#a4d63fdfe5451ec2248c16a2739190c56">type</a>,</div><div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;   <span class="keyword">struct</span> <a class="code" href="../../d2/da9/structao2__container.html">ao2_container</a> *<a class="code" href="../../d2/d6b/structsorcery__memory__cache.html#aa0a84e33972901716d6d5a6dcf1a68de">objects</a>, <span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="../../dd/d02/structast__variable.html">ast_variable</a> *fields);</div><div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d7/d30/res__sorcery__memory__cache_8c.html#a474ead91b9f86ab23435c2ee0fe1a19d">sorcery_memory_cache_retrieve_regex</a>(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="../../d2/d88/structast__sorcery.html">ast_sorcery</a> *<a class="code" href="../../d2/d6b/structsorcery__memory__cache.html#aeb33dcb5573e1661c82b5370681fb626">sorcery</a>, <span class="keywordtype">void</span> *data, <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="../../d7/d49/chan__ooh323_8c.html#a4d63fdfe5451ec2248c16a2739190c56">type</a>,</div><div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;   <span class="keyword">struct</span> <a class="code" href="../../d2/da9/structao2__container.html">ao2_container</a> *<a class="code" href="../../d2/d6b/structsorcery__memory__cache.html#aa0a84e33972901716d6d5a6dcf1a68de">objects</a>, <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="../../d9/d1e/func__strings_8c.html#a1b62eb9e3ebf087509f4301aa6336931">regex</a>);</div><div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d7/d30/res__sorcery__memory__cache_8c.html#ad3cb017e536622a783cbd0cff96b1ce7">sorcery_memory_cache_retrieve_prefix</a>(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="../../d2/d88/structast__sorcery.html">ast_sorcery</a> *<a class="code" href="../../d2/d6b/structsorcery__memory__cache.html#aeb33dcb5573e1661c82b5370681fb626">sorcery</a>, <span class="keywordtype">void</span> *data, <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="../../d7/d49/chan__ooh323_8c.html#a4d63fdfe5451ec2248c16a2739190c56">type</a>,</div><div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;   <span class="keyword">struct</span> <a class="code" href="../../d2/da9/structao2__container.html">ao2_container</a> *<a class="code" href="../../d2/d6b/structsorcery__memory__cache.html#aa0a84e33972901716d6d5a6dcf1a68de">objects</a>, <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="../../dd/d43/http_8c.html#a6f25bc812d09fedb86bf394c01061c56">prefix</a>, <span class="keyword">const</span> <span class="keywordtype">size_t</span> prefix_len);</div><div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d7/d30/res__sorcery__memory__cache_8c.html#a8be072ec91ebdbdbb1153b0a5b03a452">sorcery_memory_cache_delete</a>(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="../../d2/d88/structast__sorcery.html">ast_sorcery</a> *<a class="code" href="../../d2/d6b/structsorcery__memory__cache.html#aeb33dcb5573e1661c82b5370681fb626">sorcery</a>, <span class="keywordtype">void</span> *data, <span class="keywordtype">void</span> *<span class="keywordtype">object</span>);</div><div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d7/d30/res__sorcery__memory__cache_8c.html#a9f6a8b7453ee946fb55fac3b0237f514">sorcery_memory_cache_close</a>(<span class="keywordtype">void</span> *data);</div><div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;</div><div class="line"><a name="l00215"></a><span class="lineno"><a class="line" href="../../d7/d30/res__sorcery__memory__cache_8c.html#a7754241bba93af948258f9385fb9829a">  215</a></span>&#160;<span class="keyword">static</span> <span class="keyword">struct </span><a class="code" href="../../dd/d0a/structast__sorcery__wizard.html">ast_sorcery_wizard</a> <a class="code" href="../../d7/d30/res__sorcery__memory__cache_8c.html#a7754241bba93af948258f9385fb9829a">memory_cache_object_wizard</a> = {</div><div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;   .<a class="code" href="../../dd/d0a/structast__sorcery__wizard.html#a8f8f80d37794cde9472343e4487ba3eb">name</a> = <span class="stringliteral">&quot;memory_cache&quot;</span>,</div><div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;   .open = <a class="code" href="../../d7/d30/res__sorcery__memory__cache_8c.html#a73c11b5eb7314f2dbd3f32d18b69b10f">sorcery_memory_cache_open</a>,</div><div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;   .create = <a class="code" href="../../d7/d30/res__sorcery__memory__cache_8c.html#a751f8dcc38eb8ff1f9aee8b2b0c14db0">sorcery_memory_cache_create</a>,</div><div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;   .update = <a class="code" href="../../d7/d30/res__sorcery__memory__cache_8c.html#a751f8dcc38eb8ff1f9aee8b2b0c14db0">sorcery_memory_cache_create</a>,</div><div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;   .delete = <a class="code" href="../../d7/d30/res__sorcery__memory__cache_8c.html#a8be072ec91ebdbdbb1153b0a5b03a452">sorcery_memory_cache_delete</a>,</div><div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;   .load = <a class="code" href="../../d7/d30/res__sorcery__memory__cache_8c.html#a71fbafef4114d205d0efb067d84f47f1">sorcery_memory_cache_load</a>,</div><div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;   .reload = <a class="code" href="../../d7/d30/res__sorcery__memory__cache_8c.html#a6e5cc056cb8ed0f3ff6c59a498b8f974">sorcery_memory_cache_reload</a>,</div><div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;   .retrieve_id = <a class="code" href="../../d7/d30/res__sorcery__memory__cache_8c.html#a0e33561fb1fc08c9366a5a83eb83583e">sorcery_memory_cache_retrieve_id</a>,</div><div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;   .retrieve_fields = <a class="code" href="../../d7/d30/res__sorcery__memory__cache_8c.html#a4a0aad57b8dff22d4df96c5000d4fb80">sorcery_memory_cache_retrieve_fields</a>,</div><div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;   .retrieve_multiple = <a class="code" href="../../d7/d30/res__sorcery__memory__cache_8c.html#acf5c4d16aab69f65543750c6f069fac4">sorcery_memory_cache_retrieve_multiple</a>,</div><div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;   .retrieve_regex = <a class="code" href="../../d7/d30/res__sorcery__memory__cache_8c.html#a474ead91b9f86ab23435c2ee0fe1a19d">sorcery_memory_cache_retrieve_regex</a>,</div><div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;   .retrieve_prefix = <a class="code" href="../../d7/d30/res__sorcery__memory__cache_8c.html#ad3cb017e536622a783cbd0cff96b1ce7">sorcery_memory_cache_retrieve_prefix</a>,</div><div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;   .close = <a class="code" href="../../d7/d30/res__sorcery__memory__cache_8c.html#a9f6a8b7453ee946fb55fac3b0237f514">sorcery_memory_cache_close</a>,</div><div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;};</div><div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;<span class="comment">/*! \brief The bucket size for the container of caches */</span></div><div class="line"><a name="l00232"></a><span class="lineno"><a class="line" href="../../d7/d30/res__sorcery__memory__cache_8c.html#a308b0239d5b6189ab1fd75e101a82326">  232</a></span>&#160;<span class="preprocessor">#define CACHES_CONTAINER_BUCKET_SIZE 53</span></div><div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;<span class="comment">/*! \brief The default bucket size for the container of objects in the cache */</span></div><div class="line"><a name="l00235"></a><span class="lineno"><a class="line" href="../../d7/d30/res__sorcery__memory__cache_8c.html#a940b3f80c54615cf9a05eec2f99fdf96">  235</a></span>&#160;<span class="preprocessor">#define CACHE_CONTAINER_BUCKET_SIZE 53</span></div><div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;<span class="comment">/*! \brief Height of heap for cache object heap. Allows 31 initial objects */</span></div><div class="line"><a name="l00238"></a><span class="lineno"><a class="line" href="../../d7/d30/res__sorcery__memory__cache_8c.html#a43170aa76d29a3c41a32e557acf6c0b1">  238</a></span>&#160;<span class="preprocessor">#define CACHE_HEAP_INIT_HEIGHT 5</span></div><div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;<span class="comment">/*! \brief Container of created caches */</span></div><div class="line"><a name="l00241"></a><span class="lineno"><a class="line" href="../../d7/d30/res__sorcery__memory__cache_8c.html#ae8c811d7666eaefff6b737ad4b574671">  241</a></span>&#160;<span class="keyword">static</span> <span class="keyword">struct </span><a class="code" href="../../d2/da9/structao2__container.html">ao2_container</a> *<a class="code" href="../../d7/d30/res__sorcery__memory__cache_8c.html#ae8c811d7666eaefff6b737ad4b574671">caches</a>;</div><div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;<span class="comment">/*! \brief Scheduler for cache management */</span></div><div class="line"><a name="l00244"></a><span class="lineno"><a class="line" href="../../d7/d30/res__sorcery__memory__cache_8c.html#a361b448e9abcfc301602a2573a662d3c">  244</a></span>&#160;<span class="keyword">static</span> <span class="keyword">struct </span><a class="code" href="../../d7/de8/structast__sched__context.html">ast_sched_context</a> *<a class="code" href="../../d7/d30/res__sorcery__memory__cache_8c.html#a361b448e9abcfc301602a2573a662d3c">sched</a>;</div><div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;</div><div class="line"><a name="l00246"></a><span class="lineno"><a class="line" href="../../d7/d30/res__sorcery__memory__cache_8c.html#a275341d3c1b190fdfc2d970dc7a32858">  246</a></span>&#160;<span class="preprocessor">#define PASSTHRU_UPDATE_THREAD_ID 0x5EED1E55</span></div><div class="line"><a name="l00247"></a><span class="lineno"><a class="line" href="../../d7/d30/res__sorcery__memory__cache_8c.html#a27ec518b8a57a1ea0161d387061145c9">  247</a></span>&#160;<a class="code" href="../../dc/d7d/threadstorage_8h.html#ac268c0a8272ec11e73269392507fb1a6">AST_THREADSTORAGE</a>(<a class="code" href="../../d7/d30/res__sorcery__memory__cache_8c.html#a27ec518b8a57a1ea0161d387061145c9">passthru_update_id_storage</a>);</div><div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;</div><div class="line"><a name="l00249"></a><span class="lineno"><a class="line" href="../../d7/d30/res__sorcery__memory__cache_8c.html#a8f1f8589c9e03dcae4a7c2eb435be59c">  249</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d7/d30/res__sorcery__memory__cache_8c.html#a8f1f8589c9e03dcae4a7c2eb435be59c">is_passthru_update</a>(<span class="keywordtype">void</span>)</div><div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;{</div><div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;   uint32_t *passthru_update_thread_id;</div><div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;</div><div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;   passthru_update_thread_id = <a class="code" href="../../dc/d7d/threadstorage_8h.html#ab6ff44d2acf6ea45090177cd3141da03">ast_threadstorage_get</a>(&amp;<a class="code" href="../../d7/d30/res__sorcery__memory__cache_8c.html#a27ec518b8a57a1ea0161d387061145c9">passthru_update_id_storage</a>,</div><div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;      <span class="keyword">sizeof</span>(*passthru_update_thread_id));</div><div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;   <span class="keywordflow">if</span> (!passthru_update_thread_id) {</div><div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;      <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;   }</div><div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;</div><div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;   <span class="keywordflow">return</span> *passthru_update_thread_id == <a class="code" href="../../d7/d30/res__sorcery__memory__cache_8c.html#a275341d3c1b190fdfc2d970dc7a32858">PASSTHRU_UPDATE_THREAD_ID</a>;</div><div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;}</div><div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;</div><div class="line"><a name="l00262"></a><span class="lineno"><a class="line" href="../../d7/d30/res__sorcery__memory__cache_8c.html#a42e64d7234b0312fee62bb181f81be89">  262</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d7/d30/res__sorcery__memory__cache_8c.html#a42e64d7234b0312fee62bb181f81be89">set_passthru_update</a>(uint32_t <a class="code" href="../../d4/d2f/syslog_8c.html#ac4f474c82e82cbb89ca7c36dd52be0ed">value</a>)</div><div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;{</div><div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;   uint32_t *passthru_update_thread_id;</div><div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;</div><div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;   passthru_update_thread_id = <a class="code" href="../../dc/d7d/threadstorage_8h.html#ab6ff44d2acf6ea45090177cd3141da03">ast_threadstorage_get</a>(&amp;<a class="code" href="../../d7/d30/res__sorcery__memory__cache_8c.html#a27ec518b8a57a1ea0161d387061145c9">passthru_update_id_storage</a>,</div><div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;      <span class="keyword">sizeof</span>(*passthru_update_thread_id));</div><div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;   <span class="keywordflow">if</span> (!passthru_update_thread_id) {</div><div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Could not set passthru update ID for sorcery memory cache thread\n&quot;</span>);</div><div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;      <span class="keywordflow">return</span>;</div><div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;   }</div><div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;</div><div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;   *passthru_update_thread_id = <a class="code" href="../../d4/d2f/syslog_8c.html#ac4f474c82e82cbb89ca7c36dd52be0ed">value</a>;</div><div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;}</div><div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;</div><div class="line"><a name="l00276"></a><span class="lineno"><a class="line" href="../../d7/d30/res__sorcery__memory__cache_8c.html#a7b6e5c518260e60c41a9eda9f7078a07">  276</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d7/d30/res__sorcery__memory__cache_8c.html#a7b6e5c518260e60c41a9eda9f7078a07">start_passthru_update</a>(<span class="keywordtype">void</span>)</div><div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;{</div><div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;   <a class="code" href="../../d7/d30/res__sorcery__memory__cache_8c.html#a42e64d7234b0312fee62bb181f81be89">set_passthru_update</a>(<a class="code" href="../../d7/d30/res__sorcery__memory__cache_8c.html#a275341d3c1b190fdfc2d970dc7a32858">PASSTHRU_UPDATE_THREAD_ID</a>);</div><div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;}</div><div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;</div><div class="line"><a name="l00281"></a><span class="lineno"><a class="line" href="../../d7/d30/res__sorcery__memory__cache_8c.html#a3ec056ba134c65c1a2326dd4cac57410">  281</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d7/d30/res__sorcery__memory__cache_8c.html#a3ec056ba134c65c1a2326dd4cac57410">end_passthru_update</a>(<span class="keywordtype">void</span>)</div><div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;{</div><div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;   <a class="code" href="../../d7/d30/res__sorcery__memory__cache_8c.html#a42e64d7234b0312fee62bb181f81be89">set_passthru_update</a>(0);</div><div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;}</div><div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;<span class="comment">/*!</span></div><div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;<span class="comment"> * \internal</span></div><div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;<span class="comment"> * \brief Hashing function for the container holding caches</span></div><div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;<span class="comment"> * \param obj A sorcery memory cache or name of one</span></div><div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;<span class="comment"> * \param flags Hashing flags</span></div><div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;<span class="comment"> * \return The hash of the memory cache name</span></div><div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00295"></a><span class="lineno"><a class="line" href="../../d7/d30/res__sorcery__memory__cache_8c.html#a73ad8004e57b45af60c0303ded1e6862">  295</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d7/d30/res__sorcery__memory__cache_8c.html#a73ad8004e57b45af60c0303ded1e6862">sorcery_memory_cache_hash</a>(<span class="keyword">const</span> <span class="keywordtype">void</span> *obj, <span class="keywordtype">int</span> flags)</div><div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;{</div><div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;   <span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="../../d2/d6b/structsorcery__memory__cache.html">sorcery_memory_cache</a> *<a class="code" href="../../d2/d2c/pbx__realtime_8c.html#aefe318d32c8bb7a9e2025eb146d47781">cache</a> = obj;</div><div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;   <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="../../d2/d6b/structsorcery__memory__cache.html#a5ac083a645d964373f022d03df4849c8">name</a> = obj;</div><div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;   <span class="keywordtype">int</span> hash;</div><div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;</div><div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;   <span class="keywordflow">switch</span> (flags &amp; <a class="code" href="../../d5/da5/astobj2_8h.html#ad9d009e87e737af900825b36db55a35ca61056b5855dc9921faa4f10a67b1a250">OBJ_SEARCH_MASK</a>) {</div><div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;   <span class="keywordflow">default</span>:</div><div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="../../d5/da5/astobj2_8h.html#ad9d009e87e737af900825b36db55a35ca4a56217fdad3e940fa6b87dfd296c829">OBJ_SEARCH_OBJECT</a>:</div><div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;      name = cache-&gt;<a class="code" href="../../d2/d6b/structsorcery__memory__cache.html#a5ac083a645d964373f022d03df4849c8">name</a>;</div><div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;      <span class="comment">/* Fall through */</span></div><div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="../../d5/da5/astobj2_8h.html#ad9d009e87e737af900825b36db55a35caa13a6e0771cc457e86f425d95c3b8d54">OBJ_SEARCH_KEY</a>:</div><div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;      hash = <a class="code" href="../../d6/d90/strings_8h.html#a33ab7fa091d5513d8507d3bd33ef5b55">ast_str_hash</a>(name);</div><div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="../../d5/da5/astobj2_8h.html#ad9d009e87e737af900825b36db55a35ca269370d42230fc6aa6700e2948e1eb20">OBJ_SEARCH_PARTIAL_KEY</a>:</div><div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;      <span class="comment">/* Should never happen in hash callback. */</span></div><div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;      <a class="code" href="../../d5/d60/utils_8h.html#a24374da24af1931d8a7ccde5b352bb2c">ast_assert</a>(0);</div><div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;      hash = 0;</div><div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;   }</div><div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;   <span class="keywordflow">return</span> hash;</div><div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;}</div><div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;<span class="comment">/*!</span></div><div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;<span class="comment"> * \internal</span></div><div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;<span class="comment"> * \brief Comparison function for the container holding caches</span></div><div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;<span class="comment"> * \param obj A sorcery memory cache</span></div><div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;<span class="comment"> * \param arg A sorcery memory cache, or name of one</span></div><div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;<span class="comment"> * \param flags Comparison flags</span></div><div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;<span class="comment"> * \retval CMP_MATCH if the name is the same</span></div><div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;<span class="comment"> * \retval 0 if the name does not match</span></div><div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00329"></a><span class="lineno"><a class="line" href="../../d7/d30/res__sorcery__memory__cache_8c.html#a6ef09b2208df722b2abff81c398c8e46">  329</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d7/d30/res__sorcery__memory__cache_8c.html#a6ef09b2208df722b2abff81c398c8e46">sorcery_memory_cache_cmp</a>(<span class="keywordtype">void</span> *obj, <span class="keywordtype">void</span> *arg, <span class="keywordtype">int</span> flags)</div><div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;{</div><div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;   <span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="../../d2/d6b/structsorcery__memory__cache.html">sorcery_memory_cache</a> *left = obj;</div><div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;   <span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="../../d2/d6b/structsorcery__memory__cache.html">sorcery_memory_cache</a> *right = arg;</div><div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;   <span class="keyword">const</span> <span class="keywordtype">char</span> *right_name = arg;</div><div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;   <span class="keywordtype">int</span> cmp;</div><div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;</div><div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;   <span class="keywordflow">switch</span> (flags &amp; <a class="code" href="../../d5/da5/astobj2_8h.html#ad9d009e87e737af900825b36db55a35ca61056b5855dc9921faa4f10a67b1a250">OBJ_SEARCH_MASK</a>) {</div><div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;   <span class="keywordflow">default</span>:</div><div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="../../d5/da5/astobj2_8h.html#ad9d009e87e737af900825b36db55a35ca4a56217fdad3e940fa6b87dfd296c829">OBJ_SEARCH_OBJECT</a>:</div><div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;      right_name = right-&gt;<a class="code" href="../../d2/d6b/structsorcery__memory__cache.html#a5ac083a645d964373f022d03df4849c8">name</a>;</div><div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;      <span class="comment">/* Fall through */</span></div><div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="../../d5/da5/astobj2_8h.html#ad9d009e87e737af900825b36db55a35caa13a6e0771cc457e86f425d95c3b8d54">OBJ_SEARCH_KEY</a>:</div><div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;      cmp = strcmp(left-&gt;<a class="code" href="../../d2/d6b/structsorcery__memory__cache.html#a5ac083a645d964373f022d03df4849c8">name</a>, right_name);</div><div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="../../d5/da5/astobj2_8h.html#ad9d009e87e737af900825b36db55a35ca269370d42230fc6aa6700e2948e1eb20">OBJ_SEARCH_PARTIAL_KEY</a>:</div><div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;      cmp = strncmp(left-&gt;<a class="code" href="../../d2/d6b/structsorcery__memory__cache.html#a5ac083a645d964373f022d03df4849c8">name</a>, right_name, strlen(right_name));</div><div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;   }</div><div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;   <span class="keywordflow">return</span> cmp ? 0 : <a class="code" href="../../d5/da5/astobj2_8h.html#a1f8b41308be4c47de8ff89a3b9c7e7d1a1959468a3c5d6aecd2fa1272d8e30fbf">CMP_MATCH</a>;</div><div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;}</div><div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;<span class="comment">/*!</span></div><div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;<span class="comment"> * \internal</span></div><div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;<span class="comment"> * \brief Hashing function for the container holding cached objects</span></div><div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;<span class="comment"> * \param obj A cached object or id of one</span></div><div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;<span class="comment"> * \param flags Hashing flags</span></div><div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;<span class="comment"> * \return The hash of the cached object id</span></div><div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00360"></a><span class="lineno"><a class="line" href="../../d7/d30/res__sorcery__memory__cache_8c.html#a9e6ba05ab24228b88fabe3520c2055e9">  360</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d7/d30/res__sorcery__memory__cache_8c.html#a9e6ba05ab24228b88fabe3520c2055e9">sorcery_memory_cached_object_hash</a>(<span class="keyword">const</span> <span class="keywordtype">void</span> *obj, <span class="keywordtype">int</span> flags)</div><div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;{</div><div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;   <span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="../../df/d93/structsorcery__memory__cached__object.html">sorcery_memory_cached_object</a> *cached = obj;</div><div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;   <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="../../d2/d6b/structsorcery__memory__cache.html#a5ac083a645d964373f022d03df4849c8">name</a> = obj;</div><div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;   <span class="keywordtype">int</span> hash;</div><div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;</div><div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;   <span class="keywordflow">switch</span> (flags &amp; <a class="code" href="../../d5/da5/astobj2_8h.html#ad9d009e87e737af900825b36db55a35ca61056b5855dc9921faa4f10a67b1a250">OBJ_SEARCH_MASK</a>) {</div><div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;   <span class="keywordflow">default</span>:</div><div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="../../d5/da5/astobj2_8h.html#ad9d009e87e737af900825b36db55a35ca4a56217fdad3e940fa6b87dfd296c829">OBJ_SEARCH_OBJECT</a>:</div><div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;      name = <a class="code" href="../../d8/d25/sorcery_8h.html#a97706283a06cbb44e4f0f9620dd5cf07">ast_sorcery_object_get_id</a>(cached-&gt;<a class="code" href="../../df/d93/structsorcery__memory__cached__object.html#a077376d12464f945e2414d5499c79b3f">object</a>);</div><div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;      <span class="comment">/* Fall through */</span></div><div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="../../d5/da5/astobj2_8h.html#ad9d009e87e737af900825b36db55a35caa13a6e0771cc457e86f425d95c3b8d54">OBJ_SEARCH_KEY</a>:</div><div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;      hash = <a class="code" href="../../d6/d90/strings_8h.html#a33ab7fa091d5513d8507d3bd33ef5b55">ast_str_hash</a>(name);</div><div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="../../d5/da5/astobj2_8h.html#ad9d009e87e737af900825b36db55a35ca269370d42230fc6aa6700e2948e1eb20">OBJ_SEARCH_PARTIAL_KEY</a>:</div><div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;      <span class="comment">/* Should never happen in hash callback. */</span></div><div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;      <a class="code" href="../../d5/d60/utils_8h.html#a24374da24af1931d8a7ccde5b352bb2c">ast_assert</a>(0);</div><div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;      hash = 0;</div><div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;   }</div><div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;   <span class="keywordflow">return</span> hash;</div><div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;}</div><div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;<span class="comment">/*!</span></div><div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;<span class="comment"> * \internal</span></div><div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;<span class="comment"> * \brief Comparison function for the container holding cached objects</span></div><div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;<span class="comment"> * \param obj A cached object</span></div><div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;<span class="comment"> * \param arg A cached object, or id of one</span></div><div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;<span class="comment"> * \param flags Comparison flags</span></div><div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;<span class="comment"> * \retval CMP_MATCH if the id is the same</span></div><div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;<span class="comment"> * \retval 0 if the id does not match</span></div><div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00394"></a><span class="lineno"><a class="line" href="../../d7/d30/res__sorcery__memory__cache_8c.html#a3a2529b2a452b7589da51c1ad620ffe5">  394</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d7/d30/res__sorcery__memory__cache_8c.html#a3a2529b2a452b7589da51c1ad620ffe5">sorcery_memory_cached_object_cmp</a>(<span class="keywordtype">void</span> *obj, <span class="keywordtype">void</span> *arg, <span class="keywordtype">int</span> flags)</div><div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;{</div><div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../df/d93/structsorcery__memory__cached__object.html">sorcery_memory_cached_object</a> *left = obj;</div><div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../df/d93/structsorcery__memory__cached__object.html">sorcery_memory_cached_object</a> *right = arg;</div><div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;   <span class="keyword">const</span> <span class="keywordtype">char</span> *right_name = arg;</div><div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;   <span class="keywordtype">int</span> cmp;</div><div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;</div><div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;   <span class="keywordflow">switch</span> (flags &amp; <a class="code" href="../../d5/da5/astobj2_8h.html#ad9d009e87e737af900825b36db55a35ca61056b5855dc9921faa4f10a67b1a250">OBJ_SEARCH_MASK</a>) {</div><div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;   <span class="keywordflow">default</span>:</div><div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="../../d5/da5/astobj2_8h.html#ad9d009e87e737af900825b36db55a35ca4a56217fdad3e940fa6b87dfd296c829">OBJ_SEARCH_OBJECT</a>:</div><div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;      right_name = <a class="code" href="../../d8/d25/sorcery_8h.html#a97706283a06cbb44e4f0f9620dd5cf07">ast_sorcery_object_get_id</a>(right-&gt;<a class="code" href="../../df/d93/structsorcery__memory__cached__object.html#a077376d12464f945e2414d5499c79b3f">object</a>);</div><div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;      <span class="comment">/* Fall through */</span></div><div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="../../d5/da5/astobj2_8h.html#ad9d009e87e737af900825b36db55a35caa13a6e0771cc457e86f425d95c3b8d54">OBJ_SEARCH_KEY</a>:</div><div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;      cmp = strcmp(<a class="code" href="../../d8/d25/sorcery_8h.html#a97706283a06cbb44e4f0f9620dd5cf07">ast_sorcery_object_get_id</a>(left-&gt;<a class="code" href="../../df/d93/structsorcery__memory__cached__object.html#a077376d12464f945e2414d5499c79b3f">object</a>), right_name);</div><div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="../../d5/da5/astobj2_8h.html#ad9d009e87e737af900825b36db55a35ca269370d42230fc6aa6700e2948e1eb20">OBJ_SEARCH_PARTIAL_KEY</a>:</div><div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;      cmp = strncmp(<a class="code" href="../../d8/d25/sorcery_8h.html#a97706283a06cbb44e4f0f9620dd5cf07">ast_sorcery_object_get_id</a>(left-&gt;<a class="code" href="../../df/d93/structsorcery__memory__cached__object.html#a077376d12464f945e2414d5499c79b3f">object</a>), right_name, strlen(right_name));</div><div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;   }</div><div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;   <span class="keywordflow">return</span> cmp ? 0 : <a class="code" href="../../d5/da5/astobj2_8h.html#a1f8b41308be4c47de8ff89a3b9c7e7d1a1959468a3c5d6aecd2fa1272d8e30fbf">CMP_MATCH</a>;</div><div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;}</div><div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;<span class="comment">/*!</span></div><div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;<span class="comment"> * \internal</span></div><div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;<span class="comment"> * \brief Destructor function for a sorcery memory cache</span></div><div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;<span class="comment"> * \param obj A sorcery memory cache</span></div><div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00422"></a><span class="lineno"><a class="line" href="../../d7/d30/res__sorcery__memory__cache_8c.html#a3af131f13cb4426b2bce7a8b077849bb">  422</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d7/d30/res__sorcery__memory__cache_8c.html#a3af131f13cb4426b2bce7a8b077849bb">sorcery_memory_cache_destructor</a>(<span class="keywordtype">void</span> *obj)</div><div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;{</div><div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d2/d6b/structsorcery__memory__cache.html">sorcery_memory_cache</a> *<a class="code" href="../../d2/d2c/pbx__realtime_8c.html#aefe318d32c8bb7a9e2025eb146d47781">cache</a> = obj;</div><div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;</div><div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;   <a class="code" href="../../d8/d8a/astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(cache-&gt;<a class="code" href="../../d2/d6b/structsorcery__memory__cache.html#a5ac083a645d964373f022d03df4849c8">name</a>);</div><div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;   <span class="keywordflow">if</span> (cache-&gt;<a class="code" href="../../d2/d6b/structsorcery__memory__cache.html#ac2c70d25e5f4a7ef4384b344d4f411ce">object_heap</a>) {</div><div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;      <a class="code" href="../../da/ddb/heap_8h.html#a66d0a4a9d9e08e704abc44c856407bb8">ast_heap_destroy</a>(cache-&gt;<a class="code" href="../../d2/d6b/structsorcery__memory__cache.html#ac2c70d25e5f4a7ef4384b344d4f411ce">object_heap</a>);</div><div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;   }</div><div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#a6321ee982370c55ab3c24c72c562cbdd">ao2_cleanup</a>(cache-&gt;<a class="code" href="../../d2/d6b/structsorcery__memory__cache.html#aa0a84e33972901716d6d5a6dcf1a68de">objects</a>);</div><div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;   <a class="code" href="../../d8/d8a/astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(cache-&gt;<a class="code" href="../../d2/d6b/structsorcery__memory__cache.html#aaa0b4796a46428e565991525a543f4f0">object_type</a>);</div><div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;}</div><div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;<span class="comment">/*!</span></div><div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;<span class="comment"> * \internal</span></div><div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;<span class="comment"> * \brief Destructor function for sorcery memory cached objects</span></div><div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;<span class="comment"> * \param obj A sorcery memory cached object</span></div><div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00440"></a><span class="lineno"><a class="line" href="../../d7/d30/res__sorcery__memory__cache_8c.html#af5f9133c11b90356f5a24913b7cd66c5">  440</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d7/d30/res__sorcery__memory__cache_8c.html#af5f9133c11b90356f5a24913b7cd66c5">sorcery_memory_cached_object_destructor</a>(<span class="keywordtype">void</span> *obj)</div><div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;{</div><div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../df/d93/structsorcery__memory__cached__object.html">sorcery_memory_cached_object</a> *cached = obj;</div><div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;</div><div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#a6321ee982370c55ab3c24c72c562cbdd">ao2_cleanup</a>(cached-&gt;<a class="code" href="../../df/d93/structsorcery__memory__cached__object.html#a077376d12464f945e2414d5499c79b3f">object</a>);</div><div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;   <a class="code" href="../../d3/de6/include_2asterisk_2config_8h.html#adea5390496e5477192d86f340d512d04">ast_variables_destroy</a>(cached-&gt;<a class="code" href="../../df/d93/structsorcery__memory__cached__object.html#a269a2854677d498d5b2ffe7cef85a751">objectset</a>);</div><div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;}</div><div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;</div><div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d7/d30/res__sorcery__memory__cache_8c.html#ac9cca89523a693cbff7bb7c8f1122e11">schedule_cache_expiration</a>(<span class="keyword">struct</span> <a class="code" href="../../d2/d6b/structsorcery__memory__cache.html">sorcery_memory_cache</a> *<a class="code" href="../../d2/d2c/pbx__realtime_8c.html#aefe318d32c8bb7a9e2025eb146d47781">cache</a>);</div><div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;<span class="comment">/*!</span></div><div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;<span class="comment"> * \internal</span></div><div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;<span class="comment"> * \brief Remove an object from the cache.</span></div><div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;<span class="comment"> * This removes the item from both the hashtable and the heap.</span></div><div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;<span class="comment"> * \pre cache-&gt;objects is write-locked</span></div><div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;<span class="comment"> * \param cache The cache from which the object is being removed.</span></div><div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;<span class="comment"> * \param id The sorcery object id of the object to remove.</span></div><div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;<span class="comment"> * \param reschedule Reschedule cache expiration if this was the oldest object.</span></div><div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;<span class="comment"> * \retval 0 Success</span></div><div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;<span class="comment"> * \retval non-zero Failure</span></div><div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00465"></a><span class="lineno"><a class="line" href="../../d7/d30/res__sorcery__memory__cache_8c.html#a6046abe86f78c86c1140084831686a25">  465</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d7/d30/res__sorcery__memory__cache_8c.html#a6046abe86f78c86c1140084831686a25">remove_from_cache</a>(<span class="keyword">struct</span> <a class="code" href="../../d2/d6b/structsorcery__memory__cache.html">sorcery_memory_cache</a> *cache, <span class="keyword">const</span> <span class="keywordtype">char</span> *<span class="keywordtype">id</span>, <span class="keywordtype">int</span> reschedule)</div><div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;{</div><div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../df/d93/structsorcery__memory__cached__object.html">sorcery_memory_cached_object</a> *hash_object;</div><div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../df/d93/structsorcery__memory__cached__object.html">sorcery_memory_cached_object</a> *oldest_object;</div><div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../df/d93/structsorcery__memory__cached__object.html">sorcery_memory_cached_object</a> *heap_object;</div><div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;</div><div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;   hash_object = <a class="code" href="../../d5/da5/astobj2_8h.html#a911e0703891a9a7aaf73978152092586">ao2_find</a>(cache-&gt;<a class="code" href="../../d2/d6b/structsorcery__memory__cache.html#aa0a84e33972901716d6d5a6dcf1a68de">objects</a>, <span class="keywordtype">id</span>, <a class="code" href="../../d5/da5/astobj2_8h.html#ad9d009e87e737af900825b36db55a35caa13a6e0771cc457e86f425d95c3b8d54">OBJ_SEARCH_KEY</a> | <a class="code" href="../../d5/da5/astobj2_8h.html#ad9d009e87e737af900825b36db55a35ca71f42ec6460e60eb6e10956c53329e45">OBJ_UNLINK</a> | <a class="code" href="../../d5/da5/astobj2_8h.html#ad9d009e87e737af900825b36db55a35ca52efdf13b66ae502e2e20a5f49f068de">OBJ_NOLOCK</a>);</div><div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;   <span class="keywordflow">if</span> (!hash_object) {</div><div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;   }</div><div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;</div><div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;   <a class="code" href="../../d5/d60/utils_8h.html#a24374da24af1931d8a7ccde5b352bb2c">ast_assert</a>(!strcmp(<a class="code" href="../../d8/d25/sorcery_8h.html#a97706283a06cbb44e4f0f9620dd5cf07">ast_sorcery_object_get_id</a>(hash_object-&gt;<a class="code" href="../../df/d93/structsorcery__memory__cached__object.html#a077376d12464f945e2414d5499c79b3f">object</a>), <span class="keywordtype">id</span>));</div><div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;</div><div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;   oldest_object = <a class="code" href="../../da/ddb/heap_8h.html#aaa326b988236a0841d41cf2af8ec9b7e">ast_heap_peek</a>(cache-&gt;<a class="code" href="../../d2/d6b/structsorcery__memory__cache.html#ac2c70d25e5f4a7ef4384b344d4f411ce">object_heap</a>, 1);</div><div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;   heap_object = <a class="code" href="../../da/ddb/heap_8h.html#ac68d03b30bb0adc489ccd67a11873b59">ast_heap_remove</a>(cache-&gt;<a class="code" href="../../d2/d6b/structsorcery__memory__cache.html#ac2c70d25e5f4a7ef4384b344d4f411ce">object_heap</a>, hash_object);</div><div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;</div><div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;   <a class="code" href="../../d5/d60/utils_8h.html#a24374da24af1931d8a7ccde5b352bb2c">ast_assert</a>(heap_object == hash_object);</div><div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;</div><div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(hash_object, -1);</div><div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;</div><div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;   <span class="keywordflow">if</span> (reschedule &amp;&amp; (oldest_object == heap_object)) {</div><div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;      <a class="code" href="../../d7/d30/res__sorcery__memory__cache_8c.html#ac9cca89523a693cbff7bb7c8f1122e11">schedule_cache_expiration</a>(cache);</div><div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;   }</div><div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;</div><div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;   <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;}</div><div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;<span class="comment">/*!</span></div><div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;<span class="comment"> * \internal</span></div><div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;<span class="comment"> * \brief Scheduler callback invoked to expire old objects</span></div><div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;<span class="comment"> * \param data The opaque callback data (in our case, the memory cache)</span></div><div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00498"></a><span class="lineno"><a class="line" href="../../d7/d30/res__sorcery__memory__cache_8c.html#a84a61df59852cbf3d4896f2d7517047e">  498</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d7/d30/res__sorcery__memory__cache_8c.html#a84a61df59852cbf3d4896f2d7517047e">expire_objects_from_cache</a>(<span class="keyword">const</span> <span class="keywordtype">void</span> *data)</div><div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;{</div><div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d2/d6b/structsorcery__memory__cache.html">sorcery_memory_cache</a> *cache = (<span class="keyword">struct </span><a class="code" href="../../d2/d6b/structsorcery__memory__cache.html">sorcery_memory_cache</a> *)data;</div><div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../df/d93/structsorcery__memory__cached__object.html">sorcery_memory_cached_object</a> *cached;</div><div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;</div><div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;   <span class="comment">/*</span></div><div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;<span class="comment">    * We need to do deadlock avoidance between a non-scheduler thread</span></div><div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;<span class="comment">    * blocking when trying to delete the scheduled entry for this</span></div><div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;<span class="comment">    * callback because the scheduler thread is running this callback</span></div><div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;<span class="comment">    * and this callback waiting for the cache-&gt;objects container lock</span></div><div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;<span class="comment">    * that the blocked non-scheduler thread already holds.</span></div><div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;<span class="comment">    */</span></div><div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;   <span class="keywordflow">while</span> (<a class="code" href="../../d5/da5/astobj2_8h.html#a7f4dac6f8a1f5d07357acccc55bd370a">ao2_trywrlock</a>(cache-&gt;<a class="code" href="../../d2/d6b/structsorcery__memory__cache.html#aa0a84e33972901716d6d5a6dcf1a68de">objects</a>)) {</div><div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;      <span class="keywordflow">if</span> (cache-&gt;<a class="code" href="../../d2/d6b/structsorcery__memory__cache.html#a9e6035463adde27a5c155e5221add7cd">del_expire</a>) {</div><div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;         cache-&gt;<a class="code" href="../../d2/d6b/structsorcery__memory__cache.html#ad6bc34b0274c32a28f0b0803da66ee9e">expire_id</a> = -1;</div><div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;         <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(cache, -1);</div><div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;         <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;      }</div><div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;      sched_yield();</div><div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;   }</div><div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;</div><div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;   cache-&gt;<a class="code" href="../../d2/d6b/structsorcery__memory__cache.html#ad6bc34b0274c32a28f0b0803da66ee9e">expire_id</a> = -1;</div><div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;</div><div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;   <span class="comment">/* This is an optimization for objects which have been cached close to each other */</span></div><div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;   <span class="keywordflow">while</span> ((cached = <a class="code" href="../../da/ddb/heap_8h.html#aaa326b988236a0841d41cf2af8ec9b7e">ast_heap_peek</a>(cache-&gt;<a class="code" href="../../d2/d6b/structsorcery__memory__cache.html#ac2c70d25e5f4a7ef4384b344d4f411ce">object_heap</a>, 1))) {</div><div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;      <span class="keywordtype">int</span> expiration;</div><div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;</div><div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;      expiration = <a class="code" href="../../de/df7/time_8h.html#aca4ecdab7d8d3519062aad9a90fcb29d">ast_tvdiff_ms</a>(<a class="code" href="../../de/df7/time_8h.html#a97e1bb8fbd7a103212789e87e7ed6073">ast_tvadd</a>(cached-&gt;<a class="code" href="../../df/d93/structsorcery__memory__cached__object.html#a529e497bc965817d03dbcdc5805305c4">created</a>, <a class="code" href="../../de/df7/time_8h.html#a1d774df72e3dbb623475783e06ce4f61">ast_samp2tv</a>(cache-&gt;<a class="code" href="../../d2/d6b/structsorcery__memory__cache.html#a890cd2c933f495837f720efe44aa9642">object_lifetime_maximum</a>, 1)), <a class="code" href="../../de/df7/time_8h.html#ad3899efb6f0e348556ef69f5b16aa7f7">ast_tvnow</a>());</div><div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;</div><div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;      <span class="comment">/* If the current oldest object has not yet expired stop and reschedule for it */</span></div><div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;      <span class="keywordflow">if</span> (expiration &gt; 0) {</div><div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;         <span class="keywordflow">break</span>;</div><div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;      }</div><div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;</div><div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;      <a class="code" href="../../d7/d30/res__sorcery__memory__cache_8c.html#a6046abe86f78c86c1140084831686a25">remove_from_cache</a>(cache, <a class="code" href="../../d8/d25/sorcery_8h.html#a97706283a06cbb44e4f0f9620dd5cf07">ast_sorcery_object_get_id</a>(cached-&gt;<a class="code" href="../../df/d93/structsorcery__memory__cached__object.html#a077376d12464f945e2414d5499c79b3f">object</a>), 0);</div><div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;   }</div><div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;</div><div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;   <a class="code" href="../../d7/d30/res__sorcery__memory__cache_8c.html#ac9cca89523a693cbff7bb7c8f1122e11">schedule_cache_expiration</a>(cache);</div><div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;</div><div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#a9998bd156b936636a8780385e9a910b2">ao2_unlock</a>(cache-&gt;<a class="code" href="../../d2/d6b/structsorcery__memory__cache.html#aa0a84e33972901716d6d5a6dcf1a68de">objects</a>);</div><div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;</div><div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(cache, -1);</div><div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;</div><div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;   <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;}</div><div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;<span class="comment">/*!</span></div><div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;<span class="comment"> * \internal</span></div><div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;<span class="comment"> * \brief Remove all objects from the cache.</span></div><div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;<span class="comment"> * This removes ALL objects from both the hash table and heap.</span></div><div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;<span class="comment"> * \pre cache-&gt;objects is write-locked</span></div><div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;<span class="comment"> * \param cache The cache to empty.</span></div><div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00554"></a><span class="lineno"><a class="line" href="../../d7/d30/res__sorcery__memory__cache_8c.html#ab6ca326a1f05631b3e363a4302069c93">  554</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d7/d30/res__sorcery__memory__cache_8c.html#ab6ca326a1f05631b3e363a4302069c93">remove_all_from_cache</a>(<span class="keyword">struct</span> <a class="code" href="../../d2/d6b/structsorcery__memory__cache.html">sorcery_memory_cache</a> *cache)</div><div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;{</div><div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;   <span class="keywordflow">while</span> (<a class="code" href="../../da/ddb/heap_8h.html#ad56625488a481df852f0b13d58b15a93">ast_heap_pop</a>(cache-&gt;<a class="code" href="../../d2/d6b/structsorcery__memory__cache.html#ac2c70d25e5f4a7ef4384b344d4f411ce">object_heap</a>)) {</div><div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;   }</div><div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;</div><div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#a47857055118a703ae87ea5ebaf4842ed">ao2_callback</a>(cache-&gt;<a class="code" href="../../d2/d6b/structsorcery__memory__cache.html#aa0a84e33972901716d6d5a6dcf1a68de">objects</a>, <a class="code" href="../../d5/da5/astobj2_8h.html#ad9d009e87e737af900825b36db55a35ca71f42ec6460e60eb6e10956c53329e45">OBJ_UNLINK</a> | <a class="code" href="../../d5/da5/astobj2_8h.html#ad9d009e87e737af900825b36db55a35ca52efdf13b66ae502e2e20a5f49f068de">OBJ_NOLOCK</a> | <a class="code" href="../../d5/da5/astobj2_8h.html#ad9d009e87e737af900825b36db55a35ca5fc59b193d86a0a8ddfe866304be829d">OBJ_NODATA</a> | <a class="code" href="../../d5/da5/astobj2_8h.html#ad9d009e87e737af900825b36db55a35ca614744a4d36b3189d4ab5b02c8645d47">OBJ_MULTIPLE</a>,</div><div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;      <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div><div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;</div><div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;   cache-&gt;<a class="code" href="../../d2/d6b/structsorcery__memory__cache.html#a9e6035463adde27a5c155e5221add7cd">del_expire</a> = 1;</div><div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;   <a class="code" href="../../d7/d00/sched_8h.html#a11e2d4283c11790a27a0f899dab00e93">AST_SCHED_DEL_UNREF</a>(sched, cache-&gt;<a class="code" href="../../d2/d6b/structsorcery__memory__cache.html#ad6bc34b0274c32a28f0b0803da66ee9e">expire_id</a>, <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(cache, -1));</div><div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;   cache-&gt;<a class="code" href="../../d2/d6b/structsorcery__memory__cache.html#a9e6035463adde27a5c155e5221add7cd">del_expire</a> = 0;</div><div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;}</div><div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;<span class="comment">/*!</span></div><div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;<span class="comment"> * \internal</span></div><div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;<span class="comment"> * \brief AO2 callback function for making an object stale immediately</span></div><div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;<span class="comment"> * This changes the creation time of an object so it appears as though it is stale immediately.</span></div><div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;<span class="comment"> * \param obj The cached object</span></div><div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;<span class="comment"> * \param arg The cache itself</span></div><div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;<span class="comment"> * \param flags Unused flags</span></div><div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00577"></a><span class="lineno"><a class="line" href="../../d7/d30/res__sorcery__memory__cache_8c.html#a04243beb9f66b626e37e214f10746efd">  577</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d7/d30/res__sorcery__memory__cache_8c.html#a04243beb9f66b626e37e214f10746efd">object_stale_callback</a>(<span class="keywordtype">void</span> *obj, <span class="keywordtype">void</span> *arg, <span class="keywordtype">int</span> flags)</div><div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;{</div><div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../df/d93/structsorcery__memory__cached__object.html">sorcery_memory_cached_object</a> *cached = obj;</div><div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d2/d6b/structsorcery__memory__cache.html">sorcery_memory_cache</a> *cache = arg;</div><div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;</div><div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;   <span class="comment">/* Since our granularity is seconds it&#39;s possible for something to retrieve us within a window</span></div><div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;<span class="comment">    * where we wouldn&#39;t be treated as stale. To ensure that doesn&#39;t happen we use the configured stale</span></div><div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;<span class="comment">    * time plus a second.</span></div><div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;<span class="comment">    */</span></div><div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;   cached-&gt;<a class="code" href="../../df/d93/structsorcery__memory__cached__object.html#a529e497bc965817d03dbcdc5805305c4">created</a> = <a class="code" href="../../de/df7/time_8h.html#aa13b651c18bc6004cab21ac041d44dd8">ast_tvsub</a>(cached-&gt;<a class="code" href="../../df/d93/structsorcery__memory__cached__object.html#a529e497bc965817d03dbcdc5805305c4">created</a>, <a class="code" href="../../de/df7/time_8h.html#a1d774df72e3dbb623475783e06ce4f61">ast_samp2tv</a>(cache-&gt;<a class="code" href="../../d2/d6b/structsorcery__memory__cache.html#a89b193072cd806e8e239c9a448463efe">object_lifetime_stale</a> + 1, 1));</div><div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;</div><div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;   <span class="keywordflow">return</span> <a class="code" href="../../d5/da5/astobj2_8h.html#a1f8b41308be4c47de8ff89a3b9c7e7d1a1959468a3c5d6aecd2fa1272d8e30fbf">CMP_MATCH</a>;</div><div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;}</div><div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;<span class="comment">/*!</span></div><div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;<span class="comment"> * \internal</span></div><div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;<span class="comment"> * \brief Mark an object as stale explicitly.</span></div><div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;<span class="comment"> * This changes the creation time of an object so it appears as though it is stale immediately.</span></div><div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;<span class="comment"> * \pre cache-&gt;objects is read-locked</span></div><div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;<span class="comment"> * \param cache The cache the object is in</span></div><div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;<span class="comment"> * \param id The unique identifier of the object</span></div><div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;<span class="comment"> * \retval 0 success</span></div><div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;<span class="comment"> * \retval -1 failure</span></div><div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00605"></a><span class="lineno"><a class="line" href="../../d7/d30/res__sorcery__memory__cache_8c.html#aeefdfc3206b1465c47f5e7833c3192b6">  605</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d7/d30/res__sorcery__memory__cache_8c.html#aeefdfc3206b1465c47f5e7833c3192b6">mark_object_as_stale_in_cache</a>(<span class="keyword">struct</span> <a class="code" href="../../d2/d6b/structsorcery__memory__cache.html">sorcery_memory_cache</a> *cache, <span class="keyword">const</span> <span class="keywordtype">char</span> *<span class="keywordtype">id</span>)</div><div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;{</div><div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../df/d93/structsorcery__memory__cached__object.html">sorcery_memory_cached_object</a> *cached;</div><div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;</div><div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;   cached = <a class="code" href="../../d5/da5/astobj2_8h.html#a911e0703891a9a7aaf73978152092586">ao2_find</a>(cache-&gt;<a class="code" href="../../d2/d6b/structsorcery__memory__cache.html#aa0a84e33972901716d6d5a6dcf1a68de">objects</a>, <span class="keywordtype">id</span>, <a class="code" href="../../d5/da5/astobj2_8h.html#ad9d009e87e737af900825b36db55a35caa13a6e0771cc457e86f425d95c3b8d54">OBJ_SEARCH_KEY</a> | <a class="code" href="../../d5/da5/astobj2_8h.html#ad9d009e87e737af900825b36db55a35ca52efdf13b66ae502e2e20a5f49f068de">OBJ_NOLOCK</a>);</div><div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;   <span class="keywordflow">if</span> (!cached) {</div><div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;   }</div><div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160;</div><div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;   <a class="code" href="../../d5/d60/utils_8h.html#a24374da24af1931d8a7ccde5b352bb2c">ast_assert</a>(!strcmp(<a class="code" href="../../d8/d25/sorcery_8h.html#a97706283a06cbb44e4f0f9620dd5cf07">ast_sorcery_object_get_id</a>(cached-&gt;<a class="code" href="../../df/d93/structsorcery__memory__cached__object.html#a077376d12464f945e2414d5499c79b3f">object</a>), <span class="keywordtype">id</span>));</div><div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;</div><div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;   <a class="code" href="../../d7/d30/res__sorcery__memory__cache_8c.html#a04243beb9f66b626e37e214f10746efd">object_stale_callback</a>(cached, cache, 0);</div><div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(cached, -1);</div><div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160;</div><div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160;   <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160;}</div><div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;<span class="comment">/*!</span></div><div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;<span class="comment"> * \internal</span></div><div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;<span class="comment"> * \brief Mark all objects as stale within a cache.</span></div><div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160;<span class="comment"> * This changes the creation time of ALL objects so they appear as though they are stale.</span></div><div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;<span class="comment"> * \pre cache-&gt;objects is read-locked</span></div><div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;<span class="comment"> * \param cache</span></div><div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00632"></a><span class="lineno"><a class="line" href="../../d7/d30/res__sorcery__memory__cache_8c.html#abd8e246b3ae983064f28ae743fa2c0f2">  632</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d7/d30/res__sorcery__memory__cache_8c.html#abd8e246b3ae983064f28ae743fa2c0f2">mark_all_as_stale_in_cache</a>(<span class="keyword">struct</span> <a class="code" href="../../d2/d6b/structsorcery__memory__cache.html">sorcery_memory_cache</a> *cache)</div><div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160;{</div><div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#a47857055118a703ae87ea5ebaf4842ed">ao2_callback</a>(cache-&gt;<a class="code" href="../../d2/d6b/structsorcery__memory__cache.html#aa0a84e33972901716d6d5a6dcf1a68de">objects</a>, <a class="code" href="../../d5/da5/astobj2_8h.html#ad9d009e87e737af900825b36db55a35ca52efdf13b66ae502e2e20a5f49f068de">OBJ_NOLOCK</a> | <a class="code" href="../../d5/da5/astobj2_8h.html#ad9d009e87e737af900825b36db55a35ca5fc59b193d86a0a8ddfe866304be829d">OBJ_NODATA</a> | <a class="code" href="../../d5/da5/astobj2_8h.html#ad9d009e87e737af900825b36db55a35ca614744a4d36b3189d4ab5b02c8645d47">OBJ_MULTIPLE</a>, <a class="code" href="../../d7/d30/res__sorcery__memory__cache_8c.html#a04243beb9f66b626e37e214f10746efd">object_stale_callback</a>, cache);</div><div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160;}</div><div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160;<span class="comment">/*!</span></div><div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160;<span class="comment"> * \internal</span></div><div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160;<span class="comment"> * \brief Schedule a callback for cached object expiration.</span></div><div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00641"></a><span class="lineno">  641</span>&#160;<span class="comment"> * \pre cache-&gt;objects is write-locked</span></div><div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160;<span class="comment"> * \param cache The cache that is having its callback scheduled.</span></div><div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160;<span class="comment"> * \retval 0 success</span></div><div class="line"><a name="l00646"></a><span class="lineno">  646</span>&#160;<span class="comment"> * \retval -1 failure</span></div><div class="line"><a name="l00647"></a><span class="lineno">  647</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00648"></a><span class="lineno"><a class="line" href="../../d7/d30/res__sorcery__memory__cache_8c.html#ac9cca89523a693cbff7bb7c8f1122e11">  648</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d7/d30/res__sorcery__memory__cache_8c.html#ac9cca89523a693cbff7bb7c8f1122e11">schedule_cache_expiration</a>(<span class="keyword">struct</span> <a class="code" href="../../d2/d6b/structsorcery__memory__cache.html">sorcery_memory_cache</a> *cache)</div><div class="line"><a name="l00649"></a><span class="lineno">  649</span>&#160;{</div><div class="line"><a name="l00650"></a><span class="lineno">  650</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../df/d93/structsorcery__memory__cached__object.html">sorcery_memory_cached_object</a> *cached;</div><div class="line"><a name="l00651"></a><span class="lineno">  651</span>&#160;   <span class="keywordtype">int</span> expiration = 0;</div><div class="line"><a name="l00652"></a><span class="lineno">  652</span>&#160;</div><div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160;   <span class="keywordflow">if</span> (!cache-&gt;<a class="code" href="../../d2/d6b/structsorcery__memory__cache.html#a890cd2c933f495837f720efe44aa9642">object_lifetime_maximum</a>) {</div><div class="line"><a name="l00654"></a><span class="lineno">  654</span>&#160;      <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00655"></a><span class="lineno">  655</span>&#160;   }</div><div class="line"><a name="l00656"></a><span class="lineno">  656</span>&#160;</div><div class="line"><a name="l00657"></a><span class="lineno">  657</span>&#160;   cache-&gt;<a class="code" href="../../d2/d6b/structsorcery__memory__cache.html#a9e6035463adde27a5c155e5221add7cd">del_expire</a> = 1;</div><div class="line"><a name="l00658"></a><span class="lineno">  658</span>&#160;   <a class="code" href="../../d7/d00/sched_8h.html#a11e2d4283c11790a27a0f899dab00e93">AST_SCHED_DEL_UNREF</a>(sched, cache-&gt;<a class="code" href="../../d2/d6b/structsorcery__memory__cache.html#ad6bc34b0274c32a28f0b0803da66ee9e">expire_id</a>, <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(cache, -1));</div><div class="line"><a name="l00659"></a><span class="lineno">  659</span>&#160;   cache-&gt;<a class="code" href="../../d2/d6b/structsorcery__memory__cache.html#a9e6035463adde27a5c155e5221add7cd">del_expire</a> = 0;</div><div class="line"><a name="l00660"></a><span class="lineno">  660</span>&#160;</div><div class="line"><a name="l00661"></a><span class="lineno">  661</span>&#160;   cached = <a class="code" href="../../da/ddb/heap_8h.html#aaa326b988236a0841d41cf2af8ec9b7e">ast_heap_peek</a>(cache-&gt;<a class="code" href="../../d2/d6b/structsorcery__memory__cache.html#ac2c70d25e5f4a7ef4384b344d4f411ce">object_heap</a>, 1);</div><div class="line"><a name="l00662"></a><span class="lineno">  662</span>&#160;   <span class="keywordflow">if</span> (!cached) {</div><div class="line"><a name="l00663"></a><span class="lineno">  663</span>&#160;<span class="preprocessor">#ifdef TEST_FRAMEWORK</span></div><div class="line"><a name="l00664"></a><span class="lineno">  664</span>&#160;      <a class="code" href="../../dd/d42/lock_8h.html#ac5e13c7fe64d3b271a52028b0a78b92b">ast_mutex_lock</a>(&amp;cache-&gt;<a class="code" href="../../d2/d6b/structsorcery__memory__cache.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);</div><div class="line"><a name="l00665"></a><span class="lineno">  665</span>&#160;      cache-&gt;<a class="code" href="../../d2/d6b/structsorcery__memory__cache.html#a1c0f22ced3c7233f3945fcc05219f12a">cache_completed</a> = 1;</div><div class="line"><a name="l00666"></a><span class="lineno">  666</span>&#160;      <a class="code" href="../../dd/d42/lock_8h.html#ae2cdf274a5da241c3ad7324d82bf6af0">ast_cond_signal</a>(&amp;cache-&gt;<a class="code" href="../../d2/d6b/structsorcery__memory__cache.html#a1c7181c39f99ee801943a0d0aa9872b9">cond</a>);</div><div class="line"><a name="l00667"></a><span class="lineno">  667</span>&#160;      <a class="code" href="../../dd/d42/lock_8h.html#a873f9ce8c6287a32d48c83133e124418">ast_mutex_unlock</a>(&amp;cache-&gt;<a class="code" href="../../d2/d6b/structsorcery__memory__cache.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);</div><div class="line"><a name="l00668"></a><span class="lineno">  668</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00669"></a><span class="lineno">  669</span>&#160;      <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00670"></a><span class="lineno">  670</span>&#160;   }</div><div class="line"><a name="l00671"></a><span class="lineno">  671</span>&#160;</div><div class="line"><a name="l00672"></a><span class="lineno">  672</span>&#160;   expiration = <a class="code" href="../../d5/d60/utils_8h.html#afa99ec4acc4ecb2dc3c2d05da15d0e3f">MAX</a>(<a class="code" href="../../de/df7/time_8h.html#aca4ecdab7d8d3519062aad9a90fcb29d">ast_tvdiff_ms</a>(<a class="code" href="../../de/df7/time_8h.html#a97e1bb8fbd7a103212789e87e7ed6073">ast_tvadd</a>(cached-&gt;<a class="code" href="../../df/d93/structsorcery__memory__cached__object.html#a529e497bc965817d03dbcdc5805305c4">created</a>, <a class="code" href="../../de/df7/time_8h.html#a1d774df72e3dbb623475783e06ce4f61">ast_samp2tv</a>(cache-&gt;<a class="code" href="../../d2/d6b/structsorcery__memory__cache.html#a890cd2c933f495837f720efe44aa9642">object_lifetime_maximum</a>, 1)), <a class="code" href="../../de/df7/time_8h.html#ad3899efb6f0e348556ef69f5b16aa7f7">ast_tvnow</a>()),</div><div class="line"><a name="l00673"></a><span class="lineno">  673</span>&#160;      1);</div><div class="line"><a name="l00674"></a><span class="lineno">  674</span>&#160;</div><div class="line"><a name="l00675"></a><span class="lineno">  675</span>&#160;   cache-&gt;<a class="code" href="../../d2/d6b/structsorcery__memory__cache.html#ad6bc34b0274c32a28f0b0803da66ee9e">expire_id</a> = <a class="code" href="../../d7/d00/sched_8h.html#a7a43dcf8be6b2ed7f96f3867fbcb4082">ast_sched_add</a>(sched, expiration, <a class="code" href="../../d7/d30/res__sorcery__memory__cache_8c.html#a84a61df59852cbf3d4896f2d7517047e">expire_objects_from_cache</a>, <a class="code" href="../../d5/da5/astobj2_8h.html#ac438c3fcd3150481fad38689fd813a15">ao2_bump</a>(cache));</div><div class="line"><a name="l00676"></a><span class="lineno">  676</span>&#160;   <span class="keywordflow">if</span> (cache-&gt;<a class="code" href="../../d2/d6b/structsorcery__memory__cache.html#ad6bc34b0274c32a28f0b0803da66ee9e">expire_id</a> &lt; 0) {</div><div class="line"><a name="l00677"></a><span class="lineno">  677</span>&#160;      <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(cache, -1);</div><div class="line"><a name="l00678"></a><span class="lineno">  678</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l00679"></a><span class="lineno">  679</span>&#160;   }</div><div class="line"><a name="l00680"></a><span class="lineno">  680</span>&#160;</div><div class="line"><a name="l00681"></a><span class="lineno">  681</span>&#160;   <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00682"></a><span class="lineno">  682</span>&#160;}</div><div class="line"><a name="l00683"></a><span class="lineno">  683</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00684"></a><span class="lineno">  684</span>&#160;<span class="comment">/*!</span></div><div class="line"><a name="l00685"></a><span class="lineno">  685</span>&#160;<span class="comment"> * \internal</span></div><div class="line"><a name="l00686"></a><span class="lineno">  686</span>&#160;<span class="comment"> * \brief Remove the oldest item from the cache.</span></div><div class="line"><a name="l00687"></a><span class="lineno">  687</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00688"></a><span class="lineno">  688</span>&#160;<span class="comment"> * \pre cache-&gt;objects is write-locked</span></div><div class="line"><a name="l00689"></a><span class="lineno">  689</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00690"></a><span class="lineno">  690</span>&#160;<span class="comment"> * \param cache The cache from which to remove the oldest object</span></div><div class="line"><a name="l00691"></a><span class="lineno">  691</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00692"></a><span class="lineno">  692</span>&#160;<span class="comment"> * \retval 0 Success</span></div><div class="line"><a name="l00693"></a><span class="lineno">  693</span>&#160;<span class="comment"> * \retval non-zero Failure</span></div><div class="line"><a name="l00694"></a><span class="lineno">  694</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00695"></a><span class="lineno"><a class="line" href="../../d7/d30/res__sorcery__memory__cache_8c.html#ac327a9bcce9e826693e6eb851af0f0dc">  695</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d7/d30/res__sorcery__memory__cache_8c.html#ac327a9bcce9e826693e6eb851af0f0dc">remove_oldest_from_cache</a>(<span class="keyword">struct</span> <a class="code" href="../../d2/d6b/structsorcery__memory__cache.html">sorcery_memory_cache</a> *cache)</div><div class="line"><a name="l00696"></a><span class="lineno">  696</span>&#160;{</div><div class="line"><a name="l00697"></a><span class="lineno">  697</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../df/d93/structsorcery__memory__cached__object.html">sorcery_memory_cached_object</a> *heap_old_object;</div><div class="line"><a name="l00698"></a><span class="lineno">  698</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../df/d93/structsorcery__memory__cached__object.html">sorcery_memory_cached_object</a> *hash_old_object;</div><div class="line"><a name="l00699"></a><span class="lineno">  699</span>&#160;</div><div class="line"><a name="l00700"></a><span class="lineno">  700</span>&#160;   heap_old_object = <a class="code" href="../../da/ddb/heap_8h.html#ad56625488a481df852f0b13d58b15a93">ast_heap_pop</a>(cache-&gt;<a class="code" href="../../d2/d6b/structsorcery__memory__cache.html#ac2c70d25e5f4a7ef4384b344d4f411ce">object_heap</a>);</div><div class="line"><a name="l00701"></a><span class="lineno">  701</span>&#160;   <span class="keywordflow">if</span> (!heap_old_object) {</div><div class="line"><a name="l00702"></a><span class="lineno">  702</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l00703"></a><span class="lineno">  703</span>&#160;   }</div><div class="line"><a name="l00704"></a><span class="lineno">  704</span>&#160;   hash_old_object = <a class="code" href="../../d5/da5/astobj2_8h.html#a911e0703891a9a7aaf73978152092586">ao2_find</a>(cache-&gt;<a class="code" href="../../d2/d6b/structsorcery__memory__cache.html#aa0a84e33972901716d6d5a6dcf1a68de">objects</a>, heap_old_object,</div><div class="line"><a name="l00705"></a><span class="lineno">  705</span>&#160;      <a class="code" href="../../d5/da5/astobj2_8h.html#ad9d009e87e737af900825b36db55a35ca4a56217fdad3e940fa6b87dfd296c829">OBJ_SEARCH_OBJECT</a> | <a class="code" href="../../d5/da5/astobj2_8h.html#ad9d009e87e737af900825b36db55a35ca71f42ec6460e60eb6e10956c53329e45">OBJ_UNLINK</a> | <a class="code" href="../../d5/da5/astobj2_8h.html#ad9d009e87e737af900825b36db55a35ca52efdf13b66ae502e2e20a5f49f068de">OBJ_NOLOCK</a>);</div><div class="line"><a name="l00706"></a><span class="lineno">  706</span>&#160;</div><div class="line"><a name="l00707"></a><span class="lineno">  707</span>&#160;   <a class="code" href="../../d5/d60/utils_8h.html#a24374da24af1931d8a7ccde5b352bb2c">ast_assert</a>(heap_old_object == hash_old_object);</div><div class="line"><a name="l00708"></a><span class="lineno">  708</span>&#160;</div><div class="line"><a name="l00709"></a><span class="lineno">  709</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(hash_old_object, -1);</div><div class="line"><a name="l00710"></a><span class="lineno">  710</span>&#160;</div><div class="line"><a name="l00711"></a><span class="lineno">  711</span>&#160;   <a class="code" href="../../d7/d30/res__sorcery__memory__cache_8c.html#ac9cca89523a693cbff7bb7c8f1122e11">schedule_cache_expiration</a>(cache);</div><div class="line"><a name="l00712"></a><span class="lineno">  712</span>&#160;</div><div class="line"><a name="l00713"></a><span class="lineno">  713</span>&#160;   <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00714"></a><span class="lineno">  714</span>&#160;}</div><div class="line"><a name="l00715"></a><span class="lineno">  715</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00716"></a><span class="lineno">  716</span>&#160;<span class="comment">/*!</span></div><div class="line"><a name="l00717"></a><span class="lineno">  717</span>&#160;<span class="comment"> * \internal</span></div><div class="line"><a name="l00718"></a><span class="lineno">  718</span>&#160;<span class="comment"> * \brief Add a new object to the cache.</span></div><div class="line"><a name="l00719"></a><span class="lineno">  719</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00720"></a><span class="lineno">  720</span>&#160;<span class="comment"> * \pre cache-&gt;objects is write-locked</span></div><div class="line"><a name="l00721"></a><span class="lineno">  721</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00722"></a><span class="lineno">  722</span>&#160;<span class="comment"> * \param cache The cache in which to add the new object</span></div><div class="line"><a name="l00723"></a><span class="lineno">  723</span>&#160;<span class="comment"> * \param cached_object The object to add to the cache</span></div><div class="line"><a name="l00724"></a><span class="lineno">  724</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00725"></a><span class="lineno">  725</span>&#160;<span class="comment"> * \retval 0 Success</span></div><div class="line"><a name="l00726"></a><span class="lineno">  726</span>&#160;<span class="comment"> * \retval non-zero Failure</span></div><div class="line"><a name="l00727"></a><span class="lineno">  727</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00728"></a><span class="lineno"><a class="line" href="../../d7/d30/res__sorcery__memory__cache_8c.html#ad0c0e9a4028c7f194b269e7334375ac3">  728</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d7/d30/res__sorcery__memory__cache_8c.html#ad0c0e9a4028c7f194b269e7334375ac3">add_to_cache</a>(<span class="keyword">struct</span> <a class="code" href="../../d2/d6b/structsorcery__memory__cache.html">sorcery_memory_cache</a> *cache,</div><div class="line"><a name="l00729"></a><span class="lineno">  729</span>&#160;      <span class="keyword">struct</span> <a class="code" href="../../df/d93/structsorcery__memory__cached__object.html">sorcery_memory_cached_object</a> *cached_object)</div><div class="line"><a name="l00730"></a><span class="lineno">  730</span>&#160;{</div><div class="line"><a name="l00731"></a><span class="lineno">  731</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../df/d93/structsorcery__memory__cached__object.html">sorcery_memory_cached_object</a> *front;</div><div class="line"><a name="l00732"></a><span class="lineno">  732</span>&#160;</div><div class="line"><a name="l00733"></a><span class="lineno">  733</span>&#160;   <span class="keywordflow">if</span> (!<a class="code" href="../../d5/da5/astobj2_8h.html#a7ce8563daf84a18540a86504d165b444">ao2_link_flags</a>(cache-&gt;<a class="code" href="../../d2/d6b/structsorcery__memory__cache.html#aa0a84e33972901716d6d5a6dcf1a68de">objects</a>, cached_object, <a class="code" href="../../d5/da5/astobj2_8h.html#ad9d009e87e737af900825b36db55a35ca52efdf13b66ae502e2e20a5f49f068de">OBJ_NOLOCK</a>)) {</div><div class="line"><a name="l00734"></a><span class="lineno">  734</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l00735"></a><span class="lineno">  735</span>&#160;   }</div><div class="line"><a name="l00736"></a><span class="lineno">  736</span>&#160;</div><div class="line"><a name="l00737"></a><span class="lineno">  737</span>&#160;   <span class="keywordflow">if</span> (cache-&gt;<a class="code" href="../../d2/d6b/structsorcery__memory__cache.html#acbaed991b7fd3a4fd5661a99cb304d56">full_backend_cache</a> &amp;&amp; (front = <a class="code" href="../../da/ddb/heap_8h.html#aaa326b988236a0841d41cf2af8ec9b7e">ast_heap_peek</a>(cache-&gt;<a class="code" href="../../d2/d6b/structsorcery__memory__cache.html#ac2c70d25e5f4a7ef4384b344d4f411ce">object_heap</a>, 1))) {</div><div class="line"><a name="l00738"></a><span class="lineno">  738</span>&#160;      <span class="comment">/* For a full backend cache all objects share the same lifetime */</span></div><div class="line"><a name="l00739"></a><span class="lineno">  739</span>&#160;      cached_object-&gt;<a class="code" href="../../df/d93/structsorcery__memory__cached__object.html#a529e497bc965817d03dbcdc5805305c4">created</a> = front-&gt;<a class="code" href="../../df/d93/structsorcery__memory__cached__object.html#a529e497bc965817d03dbcdc5805305c4">created</a>;</div><div class="line"><a name="l00740"></a><span class="lineno">  740</span>&#160;   }</div><div class="line"><a name="l00741"></a><span class="lineno">  741</span>&#160;</div><div class="line"><a name="l00742"></a><span class="lineno">  742</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../da/ddb/heap_8h.html#ad181f4df20e6039b37e1b8d128884a81">ast_heap_push</a>(cache-&gt;<a class="code" href="../../d2/d6b/structsorcery__memory__cache.html#ac2c70d25e5f4a7ef4384b344d4f411ce">object_heap</a>, cached_object)) {</div><div class="line"><a name="l00743"></a><span class="lineno">  743</span>&#160;      <a class="code" href="../../d5/da5/astobj2_8h.html#a911e0703891a9a7aaf73978152092586">ao2_find</a>(cache-&gt;<a class="code" href="../../d2/d6b/structsorcery__memory__cache.html#aa0a84e33972901716d6d5a6dcf1a68de">objects</a>, cached_object,</div><div class="line"><a name="l00744"></a><span class="lineno">  744</span>&#160;         <a class="code" href="../../d5/da5/astobj2_8h.html#ad9d009e87e737af900825b36db55a35ca4a56217fdad3e940fa6b87dfd296c829">OBJ_SEARCH_OBJECT</a> | <a class="code" href="../../d5/da5/astobj2_8h.html#ad9d009e87e737af900825b36db55a35ca71f42ec6460e60eb6e10956c53329e45">OBJ_UNLINK</a> | <a class="code" href="../../d5/da5/astobj2_8h.html#ad9d009e87e737af900825b36db55a35ca5fc59b193d86a0a8ddfe866304be829d">OBJ_NODATA</a> | <a class="code" href="../../d5/da5/astobj2_8h.html#ad9d009e87e737af900825b36db55a35ca52efdf13b66ae502e2e20a5f49f068de">OBJ_NOLOCK</a>);</div><div class="line"><a name="l00745"></a><span class="lineno">  745</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l00746"></a><span class="lineno">  746</span>&#160;   }</div><div class="line"><a name="l00747"></a><span class="lineno">  747</span>&#160;</div><div class="line"><a name="l00748"></a><span class="lineno">  748</span>&#160;   <span class="keywordflow">if</span> (cache-&gt;<a class="code" href="../../d2/d6b/structsorcery__memory__cache.html#ad6bc34b0274c32a28f0b0803da66ee9e">expire_id</a> == -1) {</div><div class="line"><a name="l00749"></a><span class="lineno">  749</span>&#160;      <a class="code" href="../../d7/d30/res__sorcery__memory__cache_8c.html#ac9cca89523a693cbff7bb7c8f1122e11">schedule_cache_expiration</a>(cache);</div><div class="line"><a name="l00750"></a><span class="lineno">  750</span>&#160;   }</div><div class="line"><a name="l00751"></a><span class="lineno">  751</span>&#160;</div><div class="line"><a name="l00752"></a><span class="lineno">  752</span>&#160;   <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00753"></a><span class="lineno">  753</span>&#160;}</div><div class="line"><a name="l00754"></a><span class="lineno">  754</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00755"></a><span class="lineno">  755</span>&#160;<span class="comment">/*!</span></div><div class="line"><a name="l00756"></a><span class="lineno">  756</span>&#160;<span class="comment"> * \internal</span></div><div class="line"><a name="l00757"></a><span class="lineno">  757</span>&#160;<span class="comment"> * \brief Allocate a cached object for caching an object</span></div><div class="line"><a name="l00758"></a><span class="lineno">  758</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00759"></a><span class="lineno">  759</span>&#160;<span class="comment"> * \param sorcery The sorcery instance</span></div><div class="line"><a name="l00760"></a><span class="lineno">  760</span>&#160;<span class="comment"> * \param cache The sorcery memory cache</span></div><div class="line"><a name="l00761"></a><span class="lineno">  761</span>&#160;<span class="comment"> * \param object The object to cache</span></div><div class="line"><a name="l00762"></a><span class="lineno">  762</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00763"></a><span class="lineno">  763</span>&#160;<span class="comment"> * \retval non-NULL success</span></div><div class="line"><a name="l00764"></a><span class="lineno">  764</span>&#160;<span class="comment"> * \retval NULL failure</span></div><div class="line"><a name="l00765"></a><span class="lineno">  765</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00766"></a><span class="lineno"><a class="line" href="../../d7/d30/res__sorcery__memory__cache_8c.html#a92ed0802901a8b858f90e33983bab271">  766</a></span>&#160;<span class="keyword">static</span> <span class="keyword">struct </span><a class="code" href="../../df/d93/structsorcery__memory__cached__object.html">sorcery_memory_cached_object</a> *<a class="code" href="../../d7/d30/res__sorcery__memory__cache_8c.html#a92ed0802901a8b858f90e33983bab271">sorcery_memory_cached_object_alloc</a>(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="../../d2/d88/structast__sorcery.html">ast_sorcery</a> *<a class="code" href="../../d2/d6b/structsorcery__memory__cache.html#aeb33dcb5573e1661c82b5370681fb626">sorcery</a>,</div><div class="line"><a name="l00767"></a><span class="lineno">  767</span>&#160;   <span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="../../d2/d6b/structsorcery__memory__cache.html">sorcery_memory_cache</a> *cache, <span class="keywordtype">void</span> *<span class="keywordtype">object</span>)</div><div class="line"><a name="l00768"></a><span class="lineno">  768</span>&#160;{</div><div class="line"><a name="l00769"></a><span class="lineno">  769</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../df/d93/structsorcery__memory__cached__object.html">sorcery_memory_cached_object</a> *cached;</div><div class="line"><a name="l00770"></a><span class="lineno">  770</span>&#160;</div><div class="line"><a name="l00771"></a><span class="lineno">  771</span>&#160;   cached = <a class="code" href="../../d5/da5/astobj2_8h.html#ae0422b60d8e25b6962b2d61ae4ddf724">ao2_alloc</a>(<span class="keyword">sizeof</span>(*cached), <a class="code" href="../../d7/d30/res__sorcery__memory__cache_8c.html#af5f9133c11b90356f5a24913b7cd66c5">sorcery_memory_cached_object_destructor</a>);</div><div class="line"><a name="l00772"></a><span class="lineno">  772</span>&#160;   <span class="keywordflow">if</span> (!cached) {</div><div class="line"><a name="l00773"></a><span class="lineno">  773</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l00774"></a><span class="lineno">  774</span>&#160;   }</div><div class="line"><a name="l00775"></a><span class="lineno">  775</span>&#160;</div><div class="line"><a name="l00776"></a><span class="lineno">  776</span>&#160;   cached-&gt;<a class="code" href="../../df/d93/structsorcery__memory__cached__object.html#a077376d12464f945e2414d5499c79b3f">object</a> = <a class="code" href="../../d5/da5/astobj2_8h.html#ac438c3fcd3150481fad38689fd813a15">ao2_bump</a>(<span class="keywordtype">object</span>);</div><div class="line"><a name="l00777"></a><span class="lineno">  777</span>&#160;   cached-&gt;<a class="code" href="../../df/d93/structsorcery__memory__cached__object.html#a529e497bc965817d03dbcdc5805305c4">created</a> = <a class="code" href="../../de/df7/time_8h.html#ad3899efb6f0e348556ef69f5b16aa7f7">ast_tvnow</a>();</div><div class="line"><a name="l00778"></a><span class="lineno">  778</span>&#160;   cached-&gt;<a class="code" href="../../df/d93/structsorcery__memory__cached__object.html#a59a79dcdae51e4000f776c4c48b8c7d1">stale_update_sched_id</a> = -1;</div><div class="line"><a name="l00779"></a><span class="lineno">  779</span>&#160;</div><div class="line"><a name="l00780"></a><span class="lineno">  780</span>&#160;   <span class="keywordflow">if</span> (cache-&gt;<a class="code" href="../../d2/d6b/structsorcery__memory__cache.html#acbaed991b7fd3a4fd5661a99cb304d56">full_backend_cache</a>) {</div><div class="line"><a name="l00781"></a><span class="lineno">  781</span>&#160;      <span class="comment">/* A cached objectset allows us to easily perform all retrieval operations in a</span></div><div class="line"><a name="l00782"></a><span class="lineno">  782</span>&#160;<span class="comment">       * minimal of time.</span></div><div class="line"><a name="l00783"></a><span class="lineno">  783</span>&#160;<span class="comment">       */</span></div><div class="line"><a name="l00784"></a><span class="lineno">  784</span>&#160;      cached-&gt;<a class="code" href="../../df/d93/structsorcery__memory__cached__object.html#a269a2854677d498d5b2ffe7cef85a751">objectset</a> = <a class="code" href="../../d8/d25/sorcery_8h.html#a197b6724158db0da59852d25d36fa5f1">ast_sorcery_objectset_create</a>(sorcery, <span class="keywordtype">object</span>);</div><div class="line"><a name="l00785"></a><span class="lineno">  785</span>&#160;      <span class="keywordflow">if</span> (!cached-&gt;<a class="code" href="../../df/d93/structsorcery__memory__cached__object.html#a269a2854677d498d5b2ffe7cef85a751">objectset</a>) {</div><div class="line"><a name="l00786"></a><span class="lineno">  786</span>&#160;         <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(cached, -1);</div><div class="line"><a name="l00787"></a><span class="lineno">  787</span>&#160;         <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l00788"></a><span class="lineno">  788</span>&#160;      }</div><div class="line"><a name="l00789"></a><span class="lineno">  789</span>&#160;   }</div><div class="line"><a name="l00790"></a><span class="lineno">  790</span>&#160;</div><div class="line"><a name="l00791"></a><span class="lineno">  791</span>&#160;   <span class="keywordflow">return</span> cached;</div><div class="line"><a name="l00792"></a><span class="lineno">  792</span>&#160;}</div><div class="line"><a name="l00793"></a><span class="lineno">  793</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00794"></a><span class="lineno">  794</span>&#160;<span class="comment">/*!</span></div><div class="line"><a name="l00795"></a><span class="lineno">  795</span>&#160;<span class="comment"> * \internal</span></div><div class="line"><a name="l00796"></a><span class="lineno">  796</span>&#160;<span class="comment"> * \brief Callback function to cache an object in a memory cache</span></div><div class="line"><a name="l00797"></a><span class="lineno">  797</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00798"></a><span class="lineno">  798</span>&#160;<span class="comment"> * \param sorcery The sorcery instance</span></div><div class="line"><a name="l00799"></a><span class="lineno">  799</span>&#160;<span class="comment"> * \param data The sorcery memory cache</span></div><div class="line"><a name="l00800"></a><span class="lineno">  800</span>&#160;<span class="comment"> * \param object The object to cache</span></div><div class="line"><a name="l00801"></a><span class="lineno">  801</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00802"></a><span class="lineno">  802</span>&#160;<span class="comment"> * \retval 0 success</span></div><div class="line"><a name="l00803"></a><span class="lineno">  803</span>&#160;<span class="comment"> * \retval -1 failure</span></div><div class="line"><a name="l00804"></a><span class="lineno">  804</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00805"></a><span class="lineno"><a class="line" href="../../d7/d30/res__sorcery__memory__cache_8c.html#a751f8dcc38eb8ff1f9aee8b2b0c14db0">  805</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d7/d30/res__sorcery__memory__cache_8c.html#a751f8dcc38eb8ff1f9aee8b2b0c14db0">sorcery_memory_cache_create</a>(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="../../d2/d88/structast__sorcery.html">ast_sorcery</a> *<a class="code" href="../../d2/d6b/structsorcery__memory__cache.html#aeb33dcb5573e1661c82b5370681fb626">sorcery</a>, <span class="keywordtype">void</span> *data, <span class="keywordtype">void</span> *<span class="keywordtype">object</span>)</div><div class="line"><a name="l00806"></a><span class="lineno">  806</span>&#160;{</div><div class="line"><a name="l00807"></a><span class="lineno">  807</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d2/d6b/structsorcery__memory__cache.html">sorcery_memory_cache</a> *cache = data;</div><div class="line"><a name="l00808"></a><span class="lineno">  808</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../df/d93/structsorcery__memory__cached__object.html">sorcery_memory_cached_object</a> *cached;</div><div class="line"><a name="l00809"></a><span class="lineno">  809</span>&#160;</div><div class="line"><a name="l00810"></a><span class="lineno">  810</span>&#160;   cached = <a class="code" href="../../d7/d30/res__sorcery__memory__cache_8c.html#a92ed0802901a8b858f90e33983bab271">sorcery_memory_cached_object_alloc</a>(sorcery, cache, <span class="keywordtype">object</span>);</div><div class="line"><a name="l00811"></a><span class="lineno">  811</span>&#160;   <span class="keywordflow">if</span> (!cached) {</div><div class="line"><a name="l00812"></a><span class="lineno">  812</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l00813"></a><span class="lineno">  813</span>&#160;   }</div><div class="line"><a name="l00814"></a><span class="lineno">  814</span>&#160;</div><div class="line"><a name="l00815"></a><span class="lineno">  815</span>&#160;   <span class="comment">/* As there is no guarantee that this won&#39;t be called by multiple threads wanting to cache</span></div><div class="line"><a name="l00816"></a><span class="lineno">  816</span>&#160;<span class="comment">    * the same object we remove any old ones, which turns this into a create/update function</span></div><div class="line"><a name="l00817"></a><span class="lineno">  817</span>&#160;<span class="comment">    * in reality. As well since there&#39;s no guarantee that the object in the cache is the same</span></div><div class="line"><a name="l00818"></a><span class="lineno">  818</span>&#160;<span class="comment">    * one here we remove any old objects using the object identifier.</span></div><div class="line"><a name="l00819"></a><span class="lineno">  819</span>&#160;<span class="comment">    */</span></div><div class="line"><a name="l00820"></a><span class="lineno">  820</span>&#160;</div><div class="line"><a name="l00821"></a><span class="lineno">  821</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#a3498e30d6154a052e7b64b7a96da8b4b">ao2_wrlock</a>(cache-&gt;<a class="code" href="../../d2/d6b/structsorcery__memory__cache.html#aa0a84e33972901716d6d5a6dcf1a68de">objects</a>);</div><div class="line"><a name="l00822"></a><span class="lineno">  822</span>&#160;   <a class="code" href="../../d7/d30/res__sorcery__memory__cache_8c.html#a6046abe86f78c86c1140084831686a25">remove_from_cache</a>(cache, <a class="code" href="../../d8/d25/sorcery_8h.html#a97706283a06cbb44e4f0f9620dd5cf07">ast_sorcery_object_get_id</a>(<span class="keywordtype">object</span>), 1);</div><div class="line"><a name="l00823"></a><span class="lineno">  823</span>&#160;   <span class="keywordflow">if</span> (cache-&gt;<a class="code" href="../../d2/d6b/structsorcery__memory__cache.html#a73ce7cbebacf7170f054f846300d67ff">maximum_objects</a> &amp;&amp; <a class="code" href="../../d5/da5/astobj2_8h.html#a512cc40ce96c63b3d5c78040baa4c9cd">ao2_container_count</a>(cache-&gt;<a class="code" href="../../d2/d6b/structsorcery__memory__cache.html#aa0a84e33972901716d6d5a6dcf1a68de">objects</a>) &gt;= cache-&gt;<a class="code" href="../../d2/d6b/structsorcery__memory__cache.html#a73ce7cbebacf7170f054f846300d67ff">maximum_objects</a>) {</div><div class="line"><a name="l00824"></a><span class="lineno">  824</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="../../d7/d30/res__sorcery__memory__cache_8c.html#ac327a9bcce9e826693e6eb851af0f0dc">remove_oldest_from_cache</a>(cache)) {</div><div class="line"><a name="l00825"></a><span class="lineno">  825</span>&#160;         <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Unable to make room in cache for sorcery object &#39;%s&#39;.\n&quot;</span>,</div><div class="line"><a name="l00826"></a><span class="lineno">  826</span>&#160;            <a class="code" href="../../d8/d25/sorcery_8h.html#a97706283a06cbb44e4f0f9620dd5cf07">ast_sorcery_object_get_id</a>(<span class="keywordtype">object</span>));</div><div class="line"><a name="l00827"></a><span class="lineno">  827</span>&#160;         <a class="code" href="../../d5/da5/astobj2_8h.html#a9998bd156b936636a8780385e9a910b2">ao2_unlock</a>(cache-&gt;<a class="code" href="../../d2/d6b/structsorcery__memory__cache.html#aa0a84e33972901716d6d5a6dcf1a68de">objects</a>);</div><div class="line"><a name="l00828"></a><span class="lineno">  828</span>&#160;         <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(cached, -1);</div><div class="line"><a name="l00829"></a><span class="lineno">  829</span>&#160;         <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l00830"></a><span class="lineno">  830</span>&#160;      }</div><div class="line"><a name="l00831"></a><span class="lineno">  831</span>&#160;      <a class="code" href="../../d5/d60/utils_8h.html#a24374da24af1931d8a7ccde5b352bb2c">ast_assert</a>(<a class="code" href="../../d5/da5/astobj2_8h.html#a512cc40ce96c63b3d5c78040baa4c9cd">ao2_container_count</a>(cache-&gt;<a class="code" href="../../d2/d6b/structsorcery__memory__cache.html#aa0a84e33972901716d6d5a6dcf1a68de">objects</a>) != cache-&gt;<a class="code" href="../../d2/d6b/structsorcery__memory__cache.html#a73ce7cbebacf7170f054f846300d67ff">maximum_objects</a>);</div><div class="line"><a name="l00832"></a><span class="lineno">  832</span>&#160;   }</div><div class="line"><a name="l00833"></a><span class="lineno">  833</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d7/d30/res__sorcery__memory__cache_8c.html#ad0c0e9a4028c7f194b269e7334375ac3">add_to_cache</a>(cache, cached)) {</div><div class="line"><a name="l00834"></a><span class="lineno">  834</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Unable to add object &#39;%s&#39; to the cache\n&quot;</span>,</div><div class="line"><a name="l00835"></a><span class="lineno">  835</span>&#160;         <a class="code" href="../../d8/d25/sorcery_8h.html#a97706283a06cbb44e4f0f9620dd5cf07">ast_sorcery_object_get_id</a>(<span class="keywordtype">object</span>));</div><div class="line"><a name="l00836"></a><span class="lineno">  836</span>&#160;      <a class="code" href="../../d5/da5/astobj2_8h.html#a9998bd156b936636a8780385e9a910b2">ao2_unlock</a>(cache-&gt;<a class="code" href="../../d2/d6b/structsorcery__memory__cache.html#aa0a84e33972901716d6d5a6dcf1a68de">objects</a>);</div><div class="line"><a name="l00837"></a><span class="lineno">  837</span>&#160;      <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(cached, -1);</div><div class="line"><a name="l00838"></a><span class="lineno">  838</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l00839"></a><span class="lineno">  839</span>&#160;   }</div><div class="line"><a name="l00840"></a><span class="lineno">  840</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#a9998bd156b936636a8780385e9a910b2">ao2_unlock</a>(cache-&gt;<a class="code" href="../../d2/d6b/structsorcery__memory__cache.html#aa0a84e33972901716d6d5a6dcf1a68de">objects</a>);</div><div class="line"><a name="l00841"></a><span class="lineno">  841</span>&#160;</div><div class="line"><a name="l00842"></a><span class="lineno">  842</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(cached, -1);</div><div class="line"><a name="l00843"></a><span class="lineno">  843</span>&#160;   <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00844"></a><span class="lineno">  844</span>&#160;}</div><div class="line"><a name="l00845"></a><span class="lineno">  845</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00846"></a><span class="lineno">  846</span>&#160;<span class="comment">/*!</span></div><div class="line"><a name="l00847"></a><span class="lineno">  847</span>&#160;<span class="comment"> * \internal</span></div><div class="line"><a name="l00848"></a><span class="lineno">  848</span>&#160;<span class="comment"> * \brief AO2 callback function for adding an object to a memory cache</span></div><div class="line"><a name="l00849"></a><span class="lineno">  849</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00850"></a><span class="lineno">  850</span>&#160;<span class="comment"> * \param obj The cached object</span></div><div class="line"><a name="l00851"></a><span class="lineno">  851</span>&#160;<span class="comment"> * \param arg The sorcery instance</span></div><div class="line"><a name="l00852"></a><span class="lineno">  852</span>&#160;<span class="comment"> * \param data The cache itself</span></div><div class="line"><a name="l00853"></a><span class="lineno">  853</span>&#160;<span class="comment"> * \param flags Unused flags</span></div><div class="line"><a name="l00854"></a><span class="lineno">  854</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00855"></a><span class="lineno"><a class="line" href="../../d7/d30/res__sorcery__memory__cache_8c.html#aaedaa3e74978866f28fa653c7702edf9">  855</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d7/d30/res__sorcery__memory__cache_8c.html#aaedaa3e74978866f28fa653c7702edf9">object_add_to_cache_callback</a>(<span class="keywordtype">void</span> *obj, <span class="keywordtype">void</span> *arg, <span class="keywordtype">void</span> *data, <span class="keywordtype">int</span> flags)</div><div class="line"><a name="l00856"></a><span class="lineno">  856</span>&#160;{</div><div class="line"><a name="l00857"></a><span class="lineno">  857</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d2/d6b/structsorcery__memory__cache.html">sorcery_memory_cache</a> *cache = data;</div><div class="line"><a name="l00858"></a><span class="lineno">  858</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../df/d93/structsorcery__memory__cached__object.html">sorcery_memory_cached_object</a> *cached;</div><div class="line"><a name="l00859"></a><span class="lineno">  859</span>&#160;</div><div class="line"><a name="l00860"></a><span class="lineno">  860</span>&#160;   cached = <a class="code" href="../../d7/d30/res__sorcery__memory__cache_8c.html#a92ed0802901a8b858f90e33983bab271">sorcery_memory_cached_object_alloc</a>(arg, cache, obj);</div><div class="line"><a name="l00861"></a><span class="lineno">  861</span>&#160;   <span class="keywordflow">if</span> (!cached) {</div><div class="line"><a name="l00862"></a><span class="lineno">  862</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../d5/da5/astobj2_8h.html#a1f8b41308be4c47de8ff89a3b9c7e7d1a75382dc9117cc118719edf6c3d2b71df">CMP_STOP</a>;</div><div class="line"><a name="l00863"></a><span class="lineno">  863</span>&#160;   }</div><div class="line"><a name="l00864"></a><span class="lineno">  864</span>&#160;</div><div class="line"><a name="l00865"></a><span class="lineno">  865</span>&#160;   <a class="code" href="../../d7/d30/res__sorcery__memory__cache_8c.html#ad0c0e9a4028c7f194b269e7334375ac3">add_to_cache</a>(cache, cached);</div><div class="line"><a name="l00866"></a><span class="lineno">  866</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(cached, -1);</div><div class="line"><a name="l00867"></a><span class="lineno">  867</span>&#160;</div><div class="line"><a name="l00868"></a><span class="lineno">  868</span>&#160;   <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00869"></a><span class="lineno">  869</span>&#160;}</div><div class="line"><a name="l00870"></a><span class="lineno">  870</span>&#160;</div><div class="line"><a name="l00871"></a><span class="lineno"><a class="line" href="../../df/df7/structstale__cache__update__task__data.html">  871</a></span>&#160;<span class="keyword">struct </span><a class="code" href="../../df/df7/structstale__cache__update__task__data.html">stale_cache_update_task_data</a> {</div><div class="line"><a name="l00872"></a><span class="lineno"><a class="line" href="../../df/df7/structstale__cache__update__task__data.html#a95eb520bdb1abcd2a70b1432d3ecbf4c">  872</a></span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d2/d88/structast__sorcery.html">ast_sorcery</a> *<a class="code" href="../../df/df7/structstale__cache__update__task__data.html#a95eb520bdb1abcd2a70b1432d3ecbf4c">sorcery</a>;</div><div class="line"><a name="l00873"></a><span class="lineno"><a class="line" href="../../df/df7/structstale__cache__update__task__data.html#ada420b1f724d02917b97a9b0d5288086">  873</a></span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d2/d6b/structsorcery__memory__cache.html">sorcery_memory_cache</a> *<a class="code" href="../../df/df7/structstale__cache__update__task__data.html#ada420b1f724d02917b97a9b0d5288086">cache</a>;</div><div class="line"><a name="l00874"></a><span class="lineno"><a class="line" href="../../df/df7/structstale__cache__update__task__data.html#a23506fc4821ab6d9671f3e6222591a96">  874</a></span>&#160;   <span class="keywordtype">char</span> *<a class="code" href="../../df/df7/structstale__cache__update__task__data.html#a23506fc4821ab6d9671f3e6222591a96">type</a>;</div><div class="line"><a name="l00875"></a><span class="lineno">  875</span>&#160;};</div><div class="line"><a name="l00876"></a><span class="lineno">  876</span>&#160;</div><div class="line"><a name="l00877"></a><span class="lineno"><a class="line" href="../../d7/d30/res__sorcery__memory__cache_8c.html#a20de7198ad993d1e69f0c4e53bd1cd26">  877</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d7/d30/res__sorcery__memory__cache_8c.html#a20de7198ad993d1e69f0c4e53bd1cd26">stale_cache_update_task_data_destructor</a>(<span class="keywordtype">void</span> *obj)</div><div class="line"><a name="l00878"></a><span class="lineno">  878</span>&#160;{</div><div class="line"><a name="l00879"></a><span class="lineno">  879</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../df/df7/structstale__cache__update__task__data.html">stale_cache_update_task_data</a> *<a class="code" href="../../d1/dd9/structtask__data.html">task_data</a> = obj;</div><div class="line"><a name="l00880"></a><span class="lineno">  880</span>&#160;</div><div class="line"><a name="l00881"></a><span class="lineno">  881</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#a6321ee982370c55ab3c24c72c562cbdd">ao2_cleanup</a>(task_data-&gt;<a class="code" href="../../df/df7/structstale__cache__update__task__data.html#ada420b1f724d02917b97a9b0d5288086">cache</a>);</div><div class="line"><a name="l00882"></a><span class="lineno">  882</span>&#160;   <a class="code" href="../../d8/d25/sorcery_8h.html#a09cba9c37c702ca2bdcf94052068ed67">ast_sorcery_unref</a>(task_data-&gt;<a class="code" href="../../df/df7/structstale__cache__update__task__data.html#a95eb520bdb1abcd2a70b1432d3ecbf4c">sorcery</a>);</div><div class="line"><a name="l00883"></a><span class="lineno">  883</span>&#160;   <a class="code" href="../../d8/d8a/astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(task_data-&gt;<a class="code" href="../../df/df7/structstale__cache__update__task__data.html#a23506fc4821ab6d9671f3e6222591a96">type</a>);</div><div class="line"><a name="l00884"></a><span class="lineno">  884</span>&#160;}</div><div class="line"><a name="l00885"></a><span class="lineno">  885</span>&#160;</div><div class="line"><a name="l00886"></a><span class="lineno"><a class="line" href="../../d7/d30/res__sorcery__memory__cache_8c.html#a9114eb0a0bb526616f3ca82bec5e324d">  886</a></span>&#160;<span class="keyword">static</span> <span class="keyword">struct </span><a class="code" href="../../df/df7/structstale__cache__update__task__data.html">stale_cache_update_task_data</a> *<a class="code" href="../../d7/d30/res__sorcery__memory__cache_8c.html#a9114eb0a0bb526616f3ca82bec5e324d">stale_cache_update_task_data_alloc</a>(<span class="keyword">struct</span> <a class="code" href="../../d2/d88/structast__sorcery.html">ast_sorcery</a> *<a class="code" href="../../d2/d6b/structsorcery__memory__cache.html#aeb33dcb5573e1661c82b5370681fb626">sorcery</a>,</div><div class="line"><a name="l00887"></a><span class="lineno">  887</span>&#160;      <span class="keyword">struct</span> <a class="code" href="../../d2/d6b/structsorcery__memory__cache.html">sorcery_memory_cache</a> *cache, <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="../../d7/d49/chan__ooh323_8c.html#a4d63fdfe5451ec2248c16a2739190c56">type</a>)</div><div class="line"><a name="l00888"></a><span class="lineno">  888</span>&#160;{</div><div class="line"><a name="l00889"></a><span class="lineno">  889</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../df/df7/structstale__cache__update__task__data.html">stale_cache_update_task_data</a> *<a class="code" href="../../d1/dd9/structtask__data.html">task_data</a>;</div><div class="line"><a name="l00890"></a><span class="lineno">  890</span>&#160;</div><div class="line"><a name="l00891"></a><span class="lineno">  891</span>&#160;   task_data = <a class="code" href="../../d5/da5/astobj2_8h.html#ab3c44e28d661616129b7819069effe61">ao2_alloc_options</a>(<span class="keyword">sizeof</span>(*task_data), <a class="code" href="../../d7/d30/res__sorcery__memory__cache_8c.html#a20de7198ad993d1e69f0c4e53bd1cd26">stale_cache_update_task_data_destructor</a>,</div><div class="line"><a name="l00892"></a><span class="lineno">  892</span>&#160;      <a class="code" href="../../d5/da5/astobj2_8h.html#a2cf7e3433f08351aafe3b0cd31edf7f8a23b60f2636bcfbc4dfeea6cc21bf847b">AO2_ALLOC_OPT_LOCK_NOLOCK</a>);</div><div class="line"><a name="l00893"></a><span class="lineno">  893</span>&#160;   <span class="keywordflow">if</span> (!task_data) {</div><div class="line"><a name="l00894"></a><span class="lineno">  894</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l00895"></a><span class="lineno">  895</span>&#160;   }</div><div class="line"><a name="l00896"></a><span class="lineno">  896</span>&#160;</div><div class="line"><a name="l00897"></a><span class="lineno">  897</span>&#160;   task_data-&gt;<a class="code" href="../../df/df7/structstale__cache__update__task__data.html#a95eb520bdb1abcd2a70b1432d3ecbf4c">sorcery</a> = <a class="code" href="../../d5/da5/astobj2_8h.html#ac438c3fcd3150481fad38689fd813a15">ao2_bump</a>(sorcery);</div><div class="line"><a name="l00898"></a><span class="lineno">  898</span>&#160;   task_data-&gt;<a class="code" href="../../df/df7/structstale__cache__update__task__data.html#ada420b1f724d02917b97a9b0d5288086">cache</a> = <a class="code" href="../../d5/da5/astobj2_8h.html#ac438c3fcd3150481fad38689fd813a15">ao2_bump</a>(cache);</div><div class="line"><a name="l00899"></a><span class="lineno">  899</span>&#160;   task_data-&gt;<a class="code" href="../../df/df7/structstale__cache__update__task__data.html#a23506fc4821ab6d9671f3e6222591a96">type</a> = <a class="code" href="../../d8/d8a/astmm_8h.html#ab263849d03fb892847be4986db759737">ast_strdup</a>(type);</div><div class="line"><a name="l00900"></a><span class="lineno">  900</span>&#160;   <span class="keywordflow">if</span> (!task_data-&gt;<a class="code" href="../../df/df7/structstale__cache__update__task__data.html#a23506fc4821ab6d9671f3e6222591a96">type</a>) {</div><div class="line"><a name="l00901"></a><span class="lineno">  901</span>&#160;      <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(task_data, -1);</div><div class="line"><a name="l00902"></a><span class="lineno">  902</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l00903"></a><span class="lineno">  903</span>&#160;   }</div><div class="line"><a name="l00904"></a><span class="lineno">  904</span>&#160;</div><div class="line"><a name="l00905"></a><span class="lineno">  905</span>&#160;   <span class="keywordflow">return</span> task_data;</div><div class="line"><a name="l00906"></a><span class="lineno">  906</span>&#160;}</div><div class="line"><a name="l00907"></a><span class="lineno">  907</span>&#160;</div><div class="line"><a name="l00908"></a><span class="lineno"><a class="line" href="../../d7/d30/res__sorcery__memory__cache_8c.html#abba21810d1ea3b864abcc57c12eba397">  908</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d7/d30/res__sorcery__memory__cache_8c.html#abba21810d1ea3b864abcc57c12eba397">stale_cache_update</a>(<span class="keyword">const</span> <span class="keywordtype">void</span> *data)</div><div class="line"><a name="l00909"></a><span class="lineno">  909</span>&#160;{</div><div class="line"><a name="l00910"></a><span class="lineno">  910</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../df/df7/structstale__cache__update__task__data.html">stale_cache_update_task_data</a> *<a class="code" href="../../d1/dd9/structtask__data.html">task_data</a> = (<span class="keyword">struct </span><a class="code" href="../../df/df7/structstale__cache__update__task__data.html">stale_cache_update_task_data</a> *) data;</div><div class="line"><a name="l00911"></a><span class="lineno">  911</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d2/da9/structao2__container.html">ao2_container</a> *backend_objects;</div><div class="line"><a name="l00912"></a><span class="lineno">  912</span>&#160;</div><div class="line"><a name="l00913"></a><span class="lineno">  913</span>&#160;   <a class="code" href="../../d7/d30/res__sorcery__memory__cache_8c.html#a7b6e5c518260e60c41a9eda9f7078a07">start_passthru_update</a>();</div><div class="line"><a name="l00914"></a><span class="lineno">  914</span>&#160;   backend_objects = <a class="code" href="../../d8/d25/sorcery_8h.html#aaa9cd237841a70862001f580b23212c9">ast_sorcery_retrieve_by_fields</a>(task_data-&gt;<a class="code" href="../../df/df7/structstale__cache__update__task__data.html#a95eb520bdb1abcd2a70b1432d3ecbf4c">sorcery</a>, task_data-&gt;<a class="code" href="../../df/df7/structstale__cache__update__task__data.html#a23506fc4821ab6d9671f3e6222591a96">type</a>,</div><div class="line"><a name="l00915"></a><span class="lineno">  915</span>&#160;      <a class="code" href="../../d8/d25/sorcery_8h.html#a320e98591a38316a313a3ca83ea8df20a019a4a531b83f4ab0b35a3c788bf8d55">AST_RETRIEVE_FLAG_MULTIPLE</a> | <a class="code" href="../../d8/d25/sorcery_8h.html#a320e98591a38316a313a3ca83ea8df20a643c7c50af2691bb16052509d47b61cd">AST_RETRIEVE_FLAG_ALL</a>, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div><div class="line"><a name="l00916"></a><span class="lineno">  916</span>&#160;   <a class="code" href="../../d7/d30/res__sorcery__memory__cache_8c.html#a3ec056ba134c65c1a2326dd4cac57410">end_passthru_update</a>();</div><div class="line"><a name="l00917"></a><span class="lineno">  917</span>&#160;</div><div class="line"><a name="l00918"></a><span class="lineno">  918</span>&#160;   <span class="keywordflow">if</span> (!backend_objects) {</div><div class="line"><a name="l00919"></a><span class="lineno">  919</span>&#160;      task_data-&gt;<a class="code" href="../../df/df7/structstale__cache__update__task__data.html#ada420b1f724d02917b97a9b0d5288086">cache</a>-&gt;<a class="code" href="../../d2/d6b/structsorcery__memory__cache.html#a59a79dcdae51e4000f776c4c48b8c7d1">stale_update_sched_id</a> = -1;</div><div class="line"><a name="l00920"></a><span class="lineno">  920</span>&#160;      <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(task_data, -1);</div><div class="line"><a name="l00921"></a><span class="lineno">  921</span>&#160;      <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00922"></a><span class="lineno">  922</span>&#160;   }</div><div class="line"><a name="l00923"></a><span class="lineno">  923</span>&#160;</div><div class="line"><a name="l00924"></a><span class="lineno">  924</span>&#160;   <span class="keywordflow">if</span> (task_data-&gt;<a class="code" href="../../df/df7/structstale__cache__update__task__data.html#ada420b1f724d02917b97a9b0d5288086">cache</a>-&gt;<a class="code" href="../../d2/d6b/structsorcery__memory__cache.html#a73ce7cbebacf7170f054f846300d67ff">maximum_objects</a> &amp;&amp; <a class="code" href="../../d5/da5/astobj2_8h.html#a512cc40ce96c63b3d5c78040baa4c9cd">ao2_container_count</a>(backend_objects) &gt;= task_data-&gt;<a class="code" href="../../df/df7/structstale__cache__update__task__data.html#ada420b1f724d02917b97a9b0d5288086">cache</a>-&gt;<a class="code" href="../../d2/d6b/structsorcery__memory__cache.html#a73ce7cbebacf7170f054f846300d67ff">maximum_objects</a>) {</div><div class="line"><a name="l00925"></a><span class="lineno">  925</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;The backend contains %d objects while the sorcery memory cache &#39;%s&#39; is explicitly configured to only allow %d\n&quot;</span>,</div><div class="line"><a name="l00926"></a><span class="lineno">  926</span>&#160;         <a class="code" href="../../d5/da5/astobj2_8h.html#a512cc40ce96c63b3d5c78040baa4c9cd">ao2_container_count</a>(backend_objects), task_data-&gt;<a class="code" href="../../df/df7/structstale__cache__update__task__data.html#ada420b1f724d02917b97a9b0d5288086">cache</a>-&gt;<a class="code" href="../../d2/d6b/structsorcery__memory__cache.html#a5ac083a645d964373f022d03df4849c8">name</a>, task_data-&gt;<a class="code" href="../../df/df7/structstale__cache__update__task__data.html#ada420b1f724d02917b97a9b0d5288086">cache</a>-&gt;<a class="code" href="../../d2/d6b/structsorcery__memory__cache.html#a73ce7cbebacf7170f054f846300d67ff">maximum_objects</a>);</div><div class="line"><a name="l00927"></a><span class="lineno">  927</span>&#160;      task_data-&gt;<a class="code" href="../../df/df7/structstale__cache__update__task__data.html#ada420b1f724d02917b97a9b0d5288086">cache</a>-&gt;<a class="code" href="../../d2/d6b/structsorcery__memory__cache.html#a59a79dcdae51e4000f776c4c48b8c7d1">stale_update_sched_id</a> = -1;</div><div class="line"><a name="l00928"></a><span class="lineno">  928</span>&#160;      <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(task_data, -1);</div><div class="line"><a name="l00929"></a><span class="lineno">  929</span>&#160;      <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00930"></a><span class="lineno">  930</span>&#160;   }</div><div class="line"><a name="l00931"></a><span class="lineno">  931</span>&#160;</div><div class="line"><a name="l00932"></a><span class="lineno">  932</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#a3498e30d6154a052e7b64b7a96da8b4b">ao2_wrlock</a>(task_data-&gt;<a class="code" href="../../df/df7/structstale__cache__update__task__data.html#ada420b1f724d02917b97a9b0d5288086">cache</a>-&gt;<a class="code" href="../../d2/d6b/structsorcery__memory__cache.html#aa0a84e33972901716d6d5a6dcf1a68de">objects</a>);</div><div class="line"><a name="l00933"></a><span class="lineno">  933</span>&#160;   <a class="code" href="../../d7/d30/res__sorcery__memory__cache_8c.html#ab6ca326a1f05631b3e363a4302069c93">remove_all_from_cache</a>(task_data-&gt;<a class="code" href="../../df/df7/structstale__cache__update__task__data.html#ada420b1f724d02917b97a9b0d5288086">cache</a>);</div><div class="line"><a name="l00934"></a><span class="lineno">  934</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#a63fd831fe48aed32d3ef992ad8e45293">ao2_callback_data</a>(backend_objects, <a class="code" href="../../d5/da5/astobj2_8h.html#ad9d009e87e737af900825b36db55a35ca52efdf13b66ae502e2e20a5f49f068de">OBJ_NOLOCK</a> | <a class="code" href="../../d5/da5/astobj2_8h.html#ad9d009e87e737af900825b36db55a35ca5fc59b193d86a0a8ddfe866304be829d">OBJ_NODATA</a> | <a class="code" href="../../d5/da5/astobj2_8h.html#ad9d009e87e737af900825b36db55a35ca614744a4d36b3189d4ab5b02c8645d47">OBJ_MULTIPLE</a>, <a class="code" href="../../d7/d30/res__sorcery__memory__cache_8c.html#aaedaa3e74978866f28fa653c7702edf9">object_add_to_cache_callback</a>,</div><div class="line"><a name="l00935"></a><span class="lineno">  935</span>&#160;      task_data-&gt;<a class="code" href="../../df/df7/structstale__cache__update__task__data.html#a95eb520bdb1abcd2a70b1432d3ecbf4c">sorcery</a>, task_data-&gt;<a class="code" href="../../df/df7/structstale__cache__update__task__data.html#ada420b1f724d02917b97a9b0d5288086">cache</a>);</div><div class="line"><a name="l00936"></a><span class="lineno">  936</span>&#160;</div><div class="line"><a name="l00937"></a><span class="lineno">  937</span>&#160;   <span class="comment">/* If the number of cached objects does not match the number of backend objects we encountered a memory allocation</span></div><div class="line"><a name="l00938"></a><span class="lineno">  938</span>&#160;<span class="comment">    * failure and the cache is incomplete, so drop everything and fall back to querying the backend directly</span></div><div class="line"><a name="l00939"></a><span class="lineno">  939</span>&#160;<span class="comment">    * as it may be able to provide what is wanted.</span></div><div class="line"><a name="l00940"></a><span class="lineno">  940</span>&#160;<span class="comment">    */</span></div><div class="line"><a name="l00941"></a><span class="lineno">  941</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d5/da5/astobj2_8h.html#a512cc40ce96c63b3d5c78040baa4c9cd">ao2_container_count</a>(task_data-&gt;<a class="code" href="../../df/df7/structstale__cache__update__task__data.html#ada420b1f724d02917b97a9b0d5288086">cache</a>-&gt;<a class="code" href="../../d2/d6b/structsorcery__memory__cache.html#aa0a84e33972901716d6d5a6dcf1a68de">objects</a>) != <a class="code" href="../../d5/da5/astobj2_8h.html#a512cc40ce96c63b3d5c78040baa4c9cd">ao2_container_count</a>(backend_objects)) {</div><div class="line"><a name="l00942"></a><span class="lineno">  942</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;The backend contains %d objects while only %d could be added to sorcery memory cache &#39;%s&#39;\n&quot;</span>,</div><div class="line"><a name="l00943"></a><span class="lineno">  943</span>&#160;         <a class="code" href="../../d5/da5/astobj2_8h.html#a512cc40ce96c63b3d5c78040baa4c9cd">ao2_container_count</a>(backend_objects), <a class="code" href="../../d5/da5/astobj2_8h.html#a512cc40ce96c63b3d5c78040baa4c9cd">ao2_container_count</a>(task_data-&gt;<a class="code" href="../../df/df7/structstale__cache__update__task__data.html#ada420b1f724d02917b97a9b0d5288086">cache</a>-&gt;<a class="code" href="../../d2/d6b/structsorcery__memory__cache.html#aa0a84e33972901716d6d5a6dcf1a68de">objects</a>), task_data-&gt;<a class="code" href="../../df/df7/structstale__cache__update__task__data.html#ada420b1f724d02917b97a9b0d5288086">cache</a>-&gt;<a class="code" href="../../d2/d6b/structsorcery__memory__cache.html#a5ac083a645d964373f022d03df4849c8">name</a>);</div><div class="line"><a name="l00944"></a><span class="lineno">  944</span>&#160;      <a class="code" href="../../d7/d30/res__sorcery__memory__cache_8c.html#ab6ca326a1f05631b3e363a4302069c93">remove_all_from_cache</a>(task_data-&gt;<a class="code" href="../../df/df7/structstale__cache__update__task__data.html#ada420b1f724d02917b97a9b0d5288086">cache</a>);</div><div class="line"><a name="l00945"></a><span class="lineno">  945</span>&#160;   }</div><div class="line"><a name="l00946"></a><span class="lineno">  946</span>&#160;</div><div class="line"><a name="l00947"></a><span class="lineno">  947</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#a9998bd156b936636a8780385e9a910b2">ao2_unlock</a>(task_data-&gt;<a class="code" href="../../df/df7/structstale__cache__update__task__data.html#ada420b1f724d02917b97a9b0d5288086">cache</a>-&gt;<a class="code" href="../../d2/d6b/structsorcery__memory__cache.html#aa0a84e33972901716d6d5a6dcf1a68de">objects</a>);</div><div class="line"><a name="l00948"></a><span class="lineno">  948</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(backend_objects, -1);</div><div class="line"><a name="l00949"></a><span class="lineno">  949</span>&#160;</div><div class="line"><a name="l00950"></a><span class="lineno">  950</span>&#160;   task_data-&gt;<a class="code" href="../../df/df7/structstale__cache__update__task__data.html#ada420b1f724d02917b97a9b0d5288086">cache</a>-&gt;<a class="code" href="../../d2/d6b/structsorcery__memory__cache.html#a59a79dcdae51e4000f776c4c48b8c7d1">stale_update_sched_id</a> = -1;</div><div class="line"><a name="l00951"></a><span class="lineno">  951</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(task_data, -1);</div><div class="line"><a name="l00952"></a><span class="lineno">  952</span>&#160;</div><div class="line"><a name="l00953"></a><span class="lineno">  953</span>&#160;   <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00954"></a><span class="lineno">  954</span>&#160;}</div><div class="line"><a name="l00955"></a><span class="lineno">  955</span>&#160;</div><div class="line"><a name="l00956"></a><span class="lineno"><a class="line" href="../../da/d04/structstale__update__task__data.html">  956</a></span>&#160;<span class="keyword">struct </span><a class="code" href="../../da/d04/structstale__update__task__data.html">stale_update_task_data</a> {</div><div class="line"><a name="l00957"></a><span class="lineno"><a class="line" href="../../da/d04/structstale__update__task__data.html#a95eb520bdb1abcd2a70b1432d3ecbf4c">  957</a></span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d2/d88/structast__sorcery.html">ast_sorcery</a> *<a class="code" href="../../da/d04/structstale__update__task__data.html#a95eb520bdb1abcd2a70b1432d3ecbf4c">sorcery</a>;</div><div class="line"><a name="l00958"></a><span class="lineno"><a class="line" href="../../da/d04/structstale__update__task__data.html#ada420b1f724d02917b97a9b0d5288086">  958</a></span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d2/d6b/structsorcery__memory__cache.html">sorcery_memory_cache</a> *<a class="code" href="../../da/d04/structstale__update__task__data.html#ada420b1f724d02917b97a9b0d5288086">cache</a>;</div><div class="line"><a name="l00959"></a><span class="lineno"><a class="line" href="../../da/d04/structstale__update__task__data.html#a077376d12464f945e2414d5499c79b3f">  959</a></span>&#160;   <span class="keywordtype">void</span> *<a class="code" href="../../da/d04/structstale__update__task__data.html#a077376d12464f945e2414d5499c79b3f">object</a>;</div><div class="line"><a name="l00960"></a><span class="lineno">  960</span>&#160;};</div><div class="line"><a name="l00961"></a><span class="lineno">  961</span>&#160;</div><div class="line"><a name="l00962"></a><span class="lineno"><a class="line" href="../../d7/d30/res__sorcery__memory__cache_8c.html#a580c75cea0df48f776caecd4e7680dc2">  962</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d7/d30/res__sorcery__memory__cache_8c.html#a580c75cea0df48f776caecd4e7680dc2">stale_update_task_data_destructor</a>(<span class="keywordtype">void</span> *obj)</div><div class="line"><a name="l00963"></a><span class="lineno">  963</span>&#160;{</div><div class="line"><a name="l00964"></a><span class="lineno">  964</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../da/d04/structstale__update__task__data.html">stale_update_task_data</a> *<a class="code" href="../../d1/dd9/structtask__data.html">task_data</a> = obj;</div><div class="line"><a name="l00965"></a><span class="lineno">  965</span>&#160;</div><div class="line"><a name="l00966"></a><span class="lineno">  966</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#a6321ee982370c55ab3c24c72c562cbdd">ao2_cleanup</a>(task_data-&gt;<a class="code" href="../../da/d04/structstale__update__task__data.html#ada420b1f724d02917b97a9b0d5288086">cache</a>);</div><div class="line"><a name="l00967"></a><span class="lineno">  967</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#a6321ee982370c55ab3c24c72c562cbdd">ao2_cleanup</a>(task_data-&gt;<a class="code" href="../../da/d04/structstale__update__task__data.html#a077376d12464f945e2414d5499c79b3f">object</a>);</div><div class="line"><a name="l00968"></a><span class="lineno">  968</span>&#160;   <a class="code" href="../../d8/d25/sorcery_8h.html#a09cba9c37c702ca2bdcf94052068ed67">ast_sorcery_unref</a>(task_data-&gt;<a class="code" href="../../da/d04/structstale__update__task__data.html#a95eb520bdb1abcd2a70b1432d3ecbf4c">sorcery</a>);</div><div class="line"><a name="l00969"></a><span class="lineno">  969</span>&#160;}</div><div class="line"><a name="l00970"></a><span class="lineno">  970</span>&#160;</div><div class="line"><a name="l00971"></a><span class="lineno"><a class="line" href="../../d7/d30/res__sorcery__memory__cache_8c.html#aabdbeb4b0dcc076ebdd36377fce2013d">  971</a></span>&#160;<span class="keyword">static</span> <span class="keyword">struct </span><a class="code" href="../../da/d04/structstale__update__task__data.html">stale_update_task_data</a> *<a class="code" href="../../d7/d30/res__sorcery__memory__cache_8c.html#aabdbeb4b0dcc076ebdd36377fce2013d">stale_update_task_data_alloc</a>(<span class="keyword">struct</span> <a class="code" href="../../d2/d88/structast__sorcery.html">ast_sorcery</a> *<a class="code" href="../../d2/d6b/structsorcery__memory__cache.html#aeb33dcb5573e1661c82b5370681fb626">sorcery</a>,</div><div class="line"><a name="l00972"></a><span class="lineno">  972</span>&#160;      <span class="keyword">struct</span> <a class="code" href="../../d2/d6b/structsorcery__memory__cache.html">sorcery_memory_cache</a> *cache, <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="../../d7/d49/chan__ooh323_8c.html#a4d63fdfe5451ec2248c16a2739190c56">type</a>, <span class="keywordtype">void</span> *<span class="keywordtype">object</span>)</div><div class="line"><a name="l00973"></a><span class="lineno">  973</span>&#160;{</div><div class="line"><a name="l00974"></a><span class="lineno">  974</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../da/d04/structstale__update__task__data.html">stale_update_task_data</a> *<a class="code" href="../../d1/dd9/structtask__data.html">task_data</a>;</div><div class="line"><a name="l00975"></a><span class="lineno">  975</span>&#160;</div><div class="line"><a name="l00976"></a><span class="lineno">  976</span>&#160;   task_data = <a class="code" href="../../d5/da5/astobj2_8h.html#ab3c44e28d661616129b7819069effe61">ao2_alloc_options</a>(<span class="keyword">sizeof</span>(*task_data), <a class="code" href="../../d7/d30/res__sorcery__memory__cache_8c.html#a580c75cea0df48f776caecd4e7680dc2">stale_update_task_data_destructor</a>,</div><div class="line"><a name="l00977"></a><span class="lineno">  977</span>&#160;      <a class="code" href="../../d5/da5/astobj2_8h.html#a2cf7e3433f08351aafe3b0cd31edf7f8a23b60f2636bcfbc4dfeea6cc21bf847b">AO2_ALLOC_OPT_LOCK_NOLOCK</a>);</div><div class="line"><a name="l00978"></a><span class="lineno">  978</span>&#160;   <span class="keywordflow">if</span> (!task_data) {</div><div class="line"><a name="l00979"></a><span class="lineno">  979</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l00980"></a><span class="lineno">  980</span>&#160;   }</div><div class="line"><a name="l00981"></a><span class="lineno">  981</span>&#160;</div><div class="line"><a name="l00982"></a><span class="lineno">  982</span>&#160;   task_data-&gt;<a class="code" href="../../da/d04/structstale__update__task__data.html#a95eb520bdb1abcd2a70b1432d3ecbf4c">sorcery</a> = <a class="code" href="../../d5/da5/astobj2_8h.html#ac438c3fcd3150481fad38689fd813a15">ao2_bump</a>(sorcery);</div><div class="line"><a name="l00983"></a><span class="lineno">  983</span>&#160;   task_data-&gt;<a class="code" href="../../da/d04/structstale__update__task__data.html#ada420b1f724d02917b97a9b0d5288086">cache</a> = <a class="code" href="../../d5/da5/astobj2_8h.html#ac438c3fcd3150481fad38689fd813a15">ao2_bump</a>(cache);</div><div class="line"><a name="l00984"></a><span class="lineno">  984</span>&#160;   task_data-&gt;<a class="code" href="../../da/d04/structstale__update__task__data.html#a077376d12464f945e2414d5499c79b3f">object</a> = <a class="code" href="../../d5/da5/astobj2_8h.html#ac438c3fcd3150481fad38689fd813a15">ao2_bump</a>(<span class="keywordtype">object</span>);</div><div class="line"><a name="l00985"></a><span class="lineno">  985</span>&#160;</div><div class="line"><a name="l00986"></a><span class="lineno">  986</span>&#160;   <span class="keywordflow">return</span> task_data;</div><div class="line"><a name="l00987"></a><span class="lineno">  987</span>&#160;}</div><div class="line"><a name="l00988"></a><span class="lineno">  988</span>&#160;</div><div class="line"><a name="l00989"></a><span class="lineno"><a class="line" href="../../d7/d30/res__sorcery__memory__cache_8c.html#a0942c70adebf2e7f884ece65e18718ff">  989</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d7/d30/res__sorcery__memory__cache_8c.html#a0942c70adebf2e7f884ece65e18718ff">stale_item_update</a>(<span class="keyword">const</span> <span class="keywordtype">void</span> *data)</div><div class="line"><a name="l00990"></a><span class="lineno">  990</span>&#160;{</div><div class="line"><a name="l00991"></a><span class="lineno">  991</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../da/d04/structstale__update__task__data.html">stale_update_task_data</a> *<a class="code" href="../../d1/dd9/structtask__data.html">task_data</a> = (<span class="keyword">struct </span><a class="code" href="../../da/d04/structstale__update__task__data.html">stale_update_task_data</a> *) data;</div><div class="line"><a name="l00992"></a><span class="lineno">  992</span>&#160;   <span class="keywordtype">void</span> *<a class="code" href="../../da/d04/structstale__update__task__data.html#a077376d12464f945e2414d5499c79b3f">object</a>;</div><div class="line"><a name="l00993"></a><span class="lineno">  993</span>&#160;</div><div class="line"><a name="l00994"></a><span class="lineno">  994</span>&#160;   <a class="code" href="../../d7/d30/res__sorcery__memory__cache_8c.html#a7b6e5c518260e60c41a9eda9f7078a07">start_passthru_update</a>();</div><div class="line"><a name="l00995"></a><span class="lineno">  995</span>&#160;</div><div class="line"><a name="l00996"></a><span class="lineno">  996</span>&#160;   <span class="keywordtype">object</span> = <a class="code" href="../../d8/d25/sorcery_8h.html#a100106a82d72aa59a66513ef3ad161c8">ast_sorcery_retrieve_by_id</a>(task_data-&gt;<a class="code" href="../../da/d04/structstale__update__task__data.html#a95eb520bdb1abcd2a70b1432d3ecbf4c">sorcery</a>,</div><div class="line"><a name="l00997"></a><span class="lineno">  997</span>&#160;      <a class="code" href="../../d8/d25/sorcery_8h.html#ac6d61f7f74e9face6219d1d3f5f0671c">ast_sorcery_object_get_type</a>(task_data-&gt;<a class="code" href="../../da/d04/structstale__update__task__data.html#a077376d12464f945e2414d5499c79b3f">object</a>),</div><div class="line"><a name="l00998"></a><span class="lineno">  998</span>&#160;      <a class="code" href="../../d8/d25/sorcery_8h.html#a97706283a06cbb44e4f0f9620dd5cf07">ast_sorcery_object_get_id</a>(task_data-&gt;<a class="code" href="../../da/d04/structstale__update__task__data.html#a077376d12464f945e2414d5499c79b3f">object</a>));</div><div class="line"><a name="l00999"></a><span class="lineno">  999</span>&#160;   <span class="keywordflow">if</span> (!<span class="keywordtype">object</span>) {</div><div class="line"><a name="l01000"></a><span class="lineno"> 1000</span>&#160;      <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(1, <span class="stringliteral">&quot;Backend no longer has object type &#39;%s&#39; ID &#39;%s&#39;. Removing from cache\n&quot;</span>,</div><div class="line"><a name="l01001"></a><span class="lineno"> 1001</span>&#160;         <a class="code" href="../../d8/d25/sorcery_8h.html#ac6d61f7f74e9face6219d1d3f5f0671c">ast_sorcery_object_get_type</a>(task_data-&gt;<a class="code" href="../../da/d04/structstale__update__task__data.html#a077376d12464f945e2414d5499c79b3f">object</a>),</div><div class="line"><a name="l01002"></a><span class="lineno"> 1002</span>&#160;         <a class="code" href="../../d8/d25/sorcery_8h.html#a97706283a06cbb44e4f0f9620dd5cf07">ast_sorcery_object_get_id</a>(task_data-&gt;<a class="code" href="../../da/d04/structstale__update__task__data.html#a077376d12464f945e2414d5499c79b3f">object</a>));</div><div class="line"><a name="l01003"></a><span class="lineno"> 1003</span>&#160;      <a class="code" href="../../d7/d30/res__sorcery__memory__cache_8c.html#a8be072ec91ebdbdbb1153b0a5b03a452">sorcery_memory_cache_delete</a>(task_data-&gt;<a class="code" href="../../da/d04/structstale__update__task__data.html#a95eb520bdb1abcd2a70b1432d3ecbf4c">sorcery</a>, task_data-&gt;<a class="code" href="../../da/d04/structstale__update__task__data.html#ada420b1f724d02917b97a9b0d5288086">cache</a>,</div><div class="line"><a name="l01004"></a><span class="lineno"> 1004</span>&#160;         task_data-&gt;<a class="code" href="../../da/d04/structstale__update__task__data.html#a077376d12464f945e2414d5499c79b3f">object</a>);</div><div class="line"><a name="l01005"></a><span class="lineno"> 1005</span>&#160;   } <span class="keywordflow">else</span> {</div><div class="line"><a name="l01006"></a><span class="lineno"> 1006</span>&#160;      <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(1, <span class="stringliteral">&quot;Refreshing stale cache object type &#39;%s&#39; ID &#39;%s&#39;\n&quot;</span>,</div><div class="line"><a name="l01007"></a><span class="lineno"> 1007</span>&#160;         <a class="code" href="../../d8/d25/sorcery_8h.html#ac6d61f7f74e9face6219d1d3f5f0671c">ast_sorcery_object_get_type</a>(task_data-&gt;<a class="code" href="../../da/d04/structstale__update__task__data.html#a077376d12464f945e2414d5499c79b3f">object</a>),</div><div class="line"><a name="l01008"></a><span class="lineno"> 1008</span>&#160;         <a class="code" href="../../d8/d25/sorcery_8h.html#a97706283a06cbb44e4f0f9620dd5cf07">ast_sorcery_object_get_id</a>(task_data-&gt;<a class="code" href="../../da/d04/structstale__update__task__data.html#a077376d12464f945e2414d5499c79b3f">object</a>));</div><div class="line"><a name="l01009"></a><span class="lineno"> 1009</span>&#160;      <a class="code" href="../../d7/d30/res__sorcery__memory__cache_8c.html#a751f8dcc38eb8ff1f9aee8b2b0c14db0">sorcery_memory_cache_create</a>(task_data-&gt;<a class="code" href="../../da/d04/structstale__update__task__data.html#a95eb520bdb1abcd2a70b1432d3ecbf4c">sorcery</a>, task_data-&gt;<a class="code" href="../../da/d04/structstale__update__task__data.html#ada420b1f724d02917b97a9b0d5288086">cache</a>,</div><div class="line"><a name="l01010"></a><span class="lineno"> 1010</span>&#160;         <span class="keywordtype">object</span>);</div><div class="line"><a name="l01011"></a><span class="lineno"> 1011</span>&#160;      <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(<span class="keywordtype">object</span>, -1);</div><div class="line"><a name="l01012"></a><span class="lineno"> 1012</span>&#160;   }</div><div class="line"><a name="l01013"></a><span class="lineno"> 1013</span>&#160;</div><div class="line"><a name="l01014"></a><span class="lineno"> 1014</span>&#160;   <a class="code" href="../../d2/ddc/test_8h.html#a9482d93ea3931853331bdbc745ce7cb4">ast_test_suite_event_notify</a>(<span class="stringliteral">&quot;SORCERY_MEMORY_CACHE_REFRESHED&quot;</span>, <span class="stringliteral">&quot;Cache: %s\r\nType: %s\r\nName: %s\r\n&quot;</span>,</div><div class="line"><a name="l01015"></a><span class="lineno"> 1015</span>&#160;      task_data-&gt;<a class="code" href="../../da/d04/structstale__update__task__data.html#ada420b1f724d02917b97a9b0d5288086">cache</a>-&gt;<a class="code" href="../../d2/d6b/structsorcery__memory__cache.html#a5ac083a645d964373f022d03df4849c8">name</a>, <a class="code" href="../../d8/d25/sorcery_8h.html#ac6d61f7f74e9face6219d1d3f5f0671c">ast_sorcery_object_get_type</a>(task_data-&gt;<a class="code" href="../../da/d04/structstale__update__task__data.html#a077376d12464f945e2414d5499c79b3f">object</a>),</div><div class="line"><a name="l01016"></a><span class="lineno"> 1016</span>&#160;      <a class="code" href="../../d8/d25/sorcery_8h.html#a97706283a06cbb44e4f0f9620dd5cf07">ast_sorcery_object_get_id</a>(task_data-&gt;<a class="code" href="../../da/d04/structstale__update__task__data.html#a077376d12464f945e2414d5499c79b3f">object</a>));</div><div class="line"><a name="l01017"></a><span class="lineno"> 1017</span>&#160;</div><div class="line"><a name="l01018"></a><span class="lineno"> 1018</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(task_data, -1);</div><div class="line"><a name="l01019"></a><span class="lineno"> 1019</span>&#160;   <a class="code" href="../../d7/d30/res__sorcery__memory__cache_8c.html#a3ec056ba134c65c1a2326dd4cac57410">end_passthru_update</a>();</div><div class="line"><a name="l01020"></a><span class="lineno"> 1020</span>&#160;</div><div class="line"><a name="l01021"></a><span class="lineno"> 1021</span>&#160;   <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l01022"></a><span class="lineno"> 1022</span>&#160;}</div><div class="line"><a name="l01023"></a><span class="lineno"> 1023</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01024"></a><span class="lineno"> 1024</span>&#160;<span class="comment">/*!</span></div><div class="line"><a name="l01025"></a><span class="lineno"> 1025</span>&#160;<span class="comment"> * \internal</span></div><div class="line"><a name="l01026"></a><span class="lineno"> 1026</span>&#160;<span class="comment"> * \brief Populate the cache with all objects from the backend</span></div><div class="line"><a name="l01027"></a><span class="lineno"> 1027</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l01028"></a><span class="lineno"> 1028</span>&#160;<span class="comment"> * \pre cache-&gt;objects is write-locked</span></div><div class="line"><a name="l01029"></a><span class="lineno"> 1029</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l01030"></a><span class="lineno"> 1030</span>&#160;<span class="comment"> * \param sorcery The sorcery instance</span></div><div class="line"><a name="l01031"></a><span class="lineno"> 1031</span>&#160;<span class="comment"> * \param type The type of object</span></div><div class="line"><a name="l01032"></a><span class="lineno"> 1032</span>&#160;<span class="comment"> * \param cache The sorcery memory cache</span></div><div class="line"><a name="l01033"></a><span class="lineno"> 1033</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l01034"></a><span class="lineno"><a class="line" href="../../d7/d30/res__sorcery__memory__cache_8c.html#a9c1643daa6ed7fa4b16780a45f2beeb1"> 1034</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d7/d30/res__sorcery__memory__cache_8c.html#a9c1643daa6ed7fa4b16780a45f2beeb1">memory_cache_populate</a>(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="../../d2/d88/structast__sorcery.html">ast_sorcery</a> *<a class="code" href="../../d2/d6b/structsorcery__memory__cache.html#aeb33dcb5573e1661c82b5370681fb626">sorcery</a>, <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="../../d7/d49/chan__ooh323_8c.html#a4d63fdfe5451ec2248c16a2739190c56">type</a>, <span class="keyword">struct</span> <a class="code" href="../../d2/d6b/structsorcery__memory__cache.html">sorcery_memory_cache</a> *cache)</div><div class="line"><a name="l01035"></a><span class="lineno"> 1035</span>&#160;{</div><div class="line"><a name="l01036"></a><span class="lineno"> 1036</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d2/da9/structao2__container.html">ao2_container</a> *backend_objects;</div><div class="line"><a name="l01037"></a><span class="lineno"> 1037</span>&#160;</div><div class="line"><a name="l01038"></a><span class="lineno"> 1038</span>&#160;   <a class="code" href="../../d7/d30/res__sorcery__memory__cache_8c.html#a7b6e5c518260e60c41a9eda9f7078a07">start_passthru_update</a>();</div><div class="line"><a name="l01039"></a><span class="lineno"> 1039</span>&#160;   backend_objects = <a class="code" href="../../d8/d25/sorcery_8h.html#aaa9cd237841a70862001f580b23212c9">ast_sorcery_retrieve_by_fields</a>(sorcery, type, <a class="code" href="../../d8/d25/sorcery_8h.html#a320e98591a38316a313a3ca83ea8df20a019a4a531b83f4ab0b35a3c788bf8d55">AST_RETRIEVE_FLAG_MULTIPLE</a> | <a class="code" href="../../d8/d25/sorcery_8h.html#a320e98591a38316a313a3ca83ea8df20a643c7c50af2691bb16052509d47b61cd">AST_RETRIEVE_FLAG_ALL</a>, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div><div class="line"><a name="l01040"></a><span class="lineno"> 1040</span>&#160;   <a class="code" href="../../d7/d30/res__sorcery__memory__cache_8c.html#a3ec056ba134c65c1a2326dd4cac57410">end_passthru_update</a>();</div><div class="line"><a name="l01041"></a><span class="lineno"> 1041</span>&#160;</div><div class="line"><a name="l01042"></a><span class="lineno"> 1042</span>&#160;   <span class="keywordflow">if</span> (!backend_objects) {</div><div class="line"><a name="l01043"></a><span class="lineno"> 1043</span>&#160;      <span class="comment">/* This will occur in off-nominal memory allocation failure scenarios */</span></div><div class="line"><a name="l01044"></a><span class="lineno"> 1044</span>&#160;      <span class="keywordflow">return</span>;</div><div class="line"><a name="l01045"></a><span class="lineno"> 1045</span>&#160;   }</div><div class="line"><a name="l01046"></a><span class="lineno"> 1046</span>&#160;</div><div class="line"><a name="l01047"></a><span class="lineno"> 1047</span>&#160;   <span class="keywordflow">if</span> (cache-&gt;<a class="code" href="../../d2/d6b/structsorcery__memory__cache.html#a73ce7cbebacf7170f054f846300d67ff">maximum_objects</a> &amp;&amp; <a class="code" href="../../d5/da5/astobj2_8h.html#a512cc40ce96c63b3d5c78040baa4c9cd">ao2_container_count</a>(backend_objects) &gt;= cache-&gt;<a class="code" href="../../d2/d6b/structsorcery__memory__cache.html#a73ce7cbebacf7170f054f846300d67ff">maximum_objects</a>) {</div><div class="line"><a name="l01048"></a><span class="lineno"> 1048</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;The backend contains %d objects while the sorcery memory cache &#39;%s&#39; is explicitly configured to only allow %d\n&quot;</span>,</div><div class="line"><a name="l01049"></a><span class="lineno"> 1049</span>&#160;         <a class="code" href="../../d5/da5/astobj2_8h.html#a512cc40ce96c63b3d5c78040baa4c9cd">ao2_container_count</a>(backend_objects), cache-&gt;<a class="code" href="../../d2/d6b/structsorcery__memory__cache.html#a5ac083a645d964373f022d03df4849c8">name</a>, cache-&gt;<a class="code" href="../../d2/d6b/structsorcery__memory__cache.html#a73ce7cbebacf7170f054f846300d67ff">maximum_objects</a>);</div><div class="line"><a name="l01050"></a><span class="lineno"> 1050</span>&#160;      <span class="keywordflow">return</span>;</div><div class="line"><a name="l01051"></a><span class="lineno"> 1051</span>&#160;   }</div><div class="line"><a name="l01052"></a><span class="lineno"> 1052</span>&#160;</div><div class="line"><a name="l01053"></a><span class="lineno"> 1053</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#a63fd831fe48aed32d3ef992ad8e45293">ao2_callback_data</a>(backend_objects, <a class="code" href="../../d5/da5/astobj2_8h.html#ad9d009e87e737af900825b36db55a35ca52efdf13b66ae502e2e20a5f49f068de">OBJ_NOLOCK</a> | <a class="code" href="../../d5/da5/astobj2_8h.html#ad9d009e87e737af900825b36db55a35ca5fc59b193d86a0a8ddfe866304be829d">OBJ_NODATA</a> | <a class="code" href="../../d5/da5/astobj2_8h.html#ad9d009e87e737af900825b36db55a35ca614744a4d36b3189d4ab5b02c8645d47">OBJ_MULTIPLE</a>, <a class="code" href="../../d7/d30/res__sorcery__memory__cache_8c.html#aaedaa3e74978866f28fa653c7702edf9">object_add_to_cache_callback</a>,</div><div class="line"><a name="l01054"></a><span class="lineno"> 1054</span>&#160;      (<span class="keyword">struct</span> <a class="code" href="../../d2/d88/structast__sorcery.html">ast_sorcery</a>*)sorcery, cache);</div><div class="line"><a name="l01055"></a><span class="lineno"> 1055</span>&#160;</div><div class="line"><a name="l01056"></a><span class="lineno"> 1056</span>&#160;   <span class="comment">/* If the number of cached objects does not match the number of backend objects we encountered a memory allocation</span></div><div class="line"><a name="l01057"></a><span class="lineno"> 1057</span>&#160;<span class="comment">    * failure and the cache is incomplete, so drop everything and fall back to querying the backend directly</span></div><div class="line"><a name="l01058"></a><span class="lineno"> 1058</span>&#160;<span class="comment">    * as it may be able to provide what is wanted.</span></div><div class="line"><a name="l01059"></a><span class="lineno"> 1059</span>&#160;<span class="comment">    */</span></div><div class="line"><a name="l01060"></a><span class="lineno"> 1060</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d5/da5/astobj2_8h.html#a512cc40ce96c63b3d5c78040baa4c9cd">ao2_container_count</a>(cache-&gt;<a class="code" href="../../d2/d6b/structsorcery__memory__cache.html#aa0a84e33972901716d6d5a6dcf1a68de">objects</a>) != <a class="code" href="../../d5/da5/astobj2_8h.html#a512cc40ce96c63b3d5c78040baa4c9cd">ao2_container_count</a>(backend_objects)) {</div><div class="line"><a name="l01061"></a><span class="lineno"> 1061</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;The backend contains %d objects while only %d could be added to sorcery memory cache &#39;%s&#39;\n&quot;</span>,</div><div class="line"><a name="l01062"></a><span class="lineno"> 1062</span>&#160;         <a class="code" href="../../d5/da5/astobj2_8h.html#a512cc40ce96c63b3d5c78040baa4c9cd">ao2_container_count</a>(backend_objects), <a class="code" href="../../d5/da5/astobj2_8h.html#a512cc40ce96c63b3d5c78040baa4c9cd">ao2_container_count</a>(cache-&gt;<a class="code" href="../../d2/d6b/structsorcery__memory__cache.html#aa0a84e33972901716d6d5a6dcf1a68de">objects</a>), cache-&gt;<a class="code" href="../../d2/d6b/structsorcery__memory__cache.html#a5ac083a645d964373f022d03df4849c8">name</a>);</div><div class="line"><a name="l01063"></a><span class="lineno"> 1063</span>&#160;      <a class="code" href="../../d7/d30/res__sorcery__memory__cache_8c.html#ab6ca326a1f05631b3e363a4302069c93">remove_all_from_cache</a>(cache);</div><div class="line"><a name="l01064"></a><span class="lineno"> 1064</span>&#160;   }</div><div class="line"><a name="l01065"></a><span class="lineno"> 1065</span>&#160;</div><div class="line"><a name="l01066"></a><span class="lineno"> 1066</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(backend_objects, -1);</div><div class="line"><a name="l01067"></a><span class="lineno"> 1067</span>&#160;}</div><div class="line"><a name="l01068"></a><span class="lineno"> 1068</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01069"></a><span class="lineno"> 1069</span>&#160;<span class="comment">/*!</span></div><div class="line"><a name="l01070"></a><span class="lineno"> 1070</span>&#160;<span class="comment"> * \internal</span></div><div class="line"><a name="l01071"></a><span class="lineno"> 1071</span>&#160;<span class="comment"> * \brief Determine if a full backend cache update is needed and do it</span></div><div class="line"><a name="l01072"></a><span class="lineno"> 1072</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l01073"></a><span class="lineno"> 1073</span>&#160;<span class="comment"> * \param sorcery The sorcery instance</span></div><div class="line"><a name="l01074"></a><span class="lineno"> 1074</span>&#160;<span class="comment"> * \param type The type of object</span></div><div class="line"><a name="l01075"></a><span class="lineno"> 1075</span>&#160;<span class="comment"> * \param cache The sorcery memory cache</span></div><div class="line"><a name="l01076"></a><span class="lineno"> 1076</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l01077"></a><span class="lineno"><a class="line" href="../../d7/d30/res__sorcery__memory__cache_8c.html#a8c078864ef352717e61f7435221ee7c4"> 1077</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d7/d30/res__sorcery__memory__cache_8c.html#a8c078864ef352717e61f7435221ee7c4">memory_cache_full_update</a>(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="../../d2/d88/structast__sorcery.html">ast_sorcery</a> *<a class="code" href="../../d2/d6b/structsorcery__memory__cache.html#aeb33dcb5573e1661c82b5370681fb626">sorcery</a>, <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="../../d7/d49/chan__ooh323_8c.html#a4d63fdfe5451ec2248c16a2739190c56">type</a>, <span class="keyword">struct</span> <a class="code" href="../../d2/d6b/structsorcery__memory__cache.html">sorcery_memory_cache</a> *cache)</div><div class="line"><a name="l01078"></a><span class="lineno"> 1078</span>&#160;{</div><div class="line"><a name="l01079"></a><span class="lineno"> 1079</span>&#160;   <span class="keywordflow">if</span> (!cache-&gt;<a class="code" href="../../d2/d6b/structsorcery__memory__cache.html#acbaed991b7fd3a4fd5661a99cb304d56">full_backend_cache</a>) {</div><div class="line"><a name="l01080"></a><span class="lineno"> 1080</span>&#160;      <span class="keywordflow">return</span>;</div><div class="line"><a name="l01081"></a><span class="lineno"> 1081</span>&#160;   }</div><div class="line"><a name="l01082"></a><span class="lineno"> 1082</span>&#160;</div><div class="line"><a name="l01083"></a><span class="lineno"> 1083</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#a3498e30d6154a052e7b64b7a96da8b4b">ao2_wrlock</a>(cache-&gt;<a class="code" href="../../d2/d6b/structsorcery__memory__cache.html#aa0a84e33972901716d6d5a6dcf1a68de">objects</a>);</div><div class="line"><a name="l01084"></a><span class="lineno"> 1084</span>&#160;   <span class="keywordflow">if</span> (!<a class="code" href="../../d5/da5/astobj2_8h.html#a512cc40ce96c63b3d5c78040baa4c9cd">ao2_container_count</a>(cache-&gt;<a class="code" href="../../d2/d6b/structsorcery__memory__cache.html#aa0a84e33972901716d6d5a6dcf1a68de">objects</a>)) {</div><div class="line"><a name="l01085"></a><span class="lineno"> 1085</span>&#160;      <a class="code" href="../../d7/d30/res__sorcery__memory__cache_8c.html#a9c1643daa6ed7fa4b16780a45f2beeb1">memory_cache_populate</a>(sorcery, type, cache);</div><div class="line"><a name="l01086"></a><span class="lineno"> 1086</span>&#160;   }</div><div class="line"><a name="l01087"></a><span class="lineno"> 1087</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#a9998bd156b936636a8780385e9a910b2">ao2_unlock</a>(cache-&gt;<a class="code" href="../../d2/d6b/structsorcery__memory__cache.html#aa0a84e33972901716d6d5a6dcf1a68de">objects</a>);</div><div class="line"><a name="l01088"></a><span class="lineno"> 1088</span>&#160;}</div><div class="line"><a name="l01089"></a><span class="lineno"> 1089</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01090"></a><span class="lineno"> 1090</span>&#160;<span class="comment">/*!</span></div><div class="line"><a name="l01091"></a><span class="lineno"> 1091</span>&#160;<span class="comment"> * \internal</span></div><div class="line"><a name="l01092"></a><span class="lineno"> 1092</span>&#160;<span class="comment"> * \brief Queue a full cache update</span></div><div class="line"><a name="l01093"></a><span class="lineno"> 1093</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l01094"></a><span class="lineno"> 1094</span>&#160;<span class="comment"> * \param sorcery The sorcery instance</span></div><div class="line"><a name="l01095"></a><span class="lineno"> 1095</span>&#160;<span class="comment"> * \param cache The sorcery memory cache</span></div><div class="line"><a name="l01096"></a><span class="lineno"> 1096</span>&#160;<span class="comment"> * \param type The type of object</span></div><div class="line"><a name="l01097"></a><span class="lineno"> 1097</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l01098"></a><span class="lineno"><a class="line" href="../../d7/d30/res__sorcery__memory__cache_8c.html#ac3d8ebcb3363c9044516347d76393007"> 1098</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d7/d30/res__sorcery__memory__cache_8c.html#ac3d8ebcb3363c9044516347d76393007">memory_cache_stale_update_full</a>(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="../../d2/d88/structast__sorcery.html">ast_sorcery</a> *<a class="code" href="../../d2/d6b/structsorcery__memory__cache.html#aeb33dcb5573e1661c82b5370681fb626">sorcery</a>, <span class="keyword">struct</span> <a class="code" href="../../d2/d6b/structsorcery__memory__cache.html">sorcery_memory_cache</a> *cache,</div><div class="line"><a name="l01099"></a><span class="lineno"> 1099</span>&#160;   <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="../../d7/d49/chan__ooh323_8c.html#a4d63fdfe5451ec2248c16a2739190c56">type</a>)</div><div class="line"><a name="l01100"></a><span class="lineno"> 1100</span>&#160;{</div><div class="line"><a name="l01101"></a><span class="lineno"> 1101</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#a3498e30d6154a052e7b64b7a96da8b4b">ao2_wrlock</a>(cache-&gt;<a class="code" href="../../d2/d6b/structsorcery__memory__cache.html#aa0a84e33972901716d6d5a6dcf1a68de">objects</a>);</div><div class="line"><a name="l01102"></a><span class="lineno"> 1102</span>&#160;   <span class="keywordflow">if</span> (cache-&gt;<a class="code" href="../../d2/d6b/structsorcery__memory__cache.html#a59a79dcdae51e4000f776c4c48b8c7d1">stale_update_sched_id</a> == -1) {</div><div class="line"><a name="l01103"></a><span class="lineno"> 1103</span>&#160;      <span class="keyword">struct </span><a class="code" href="../../df/df7/structstale__cache__update__task__data.html">stale_cache_update_task_data</a> *<a class="code" href="../../d1/dd9/structtask__data.html">task_data</a>;</div><div class="line"><a name="l01104"></a><span class="lineno"> 1104</span>&#160;</div><div class="line"><a name="l01105"></a><span class="lineno"> 1105</span>&#160;      task_data = <a class="code" href="../../d7/d30/res__sorcery__memory__cache_8c.html#a9114eb0a0bb526616f3ca82bec5e324d">stale_cache_update_task_data_alloc</a>((<span class="keyword">struct</span> <a class="code" href="../../d2/d88/structast__sorcery.html">ast_sorcery</a> *) sorcery,</div><div class="line"><a name="l01106"></a><span class="lineno"> 1106</span>&#160;         cache, type);</div><div class="line"><a name="l01107"></a><span class="lineno"> 1107</span>&#160;      <span class="keywordflow">if</span> (task_data) {</div><div class="line"><a name="l01108"></a><span class="lineno"> 1108</span>&#160;         cache-&gt;<a class="code" href="../../d2/d6b/structsorcery__memory__cache.html#a59a79dcdae51e4000f776c4c48b8c7d1">stale_update_sched_id</a> = <a class="code" href="../../d7/d00/sched_8h.html#a7a43dcf8be6b2ed7f96f3867fbcb4082">ast_sched_add</a>(sched, 1,</div><div class="line"><a name="l01109"></a><span class="lineno"> 1109</span>&#160;            <a class="code" href="../../d7/d30/res__sorcery__memory__cache_8c.html#abba21810d1ea3b864abcc57c12eba397">stale_cache_update</a>, task_data);</div><div class="line"><a name="l01110"></a><span class="lineno"> 1110</span>&#160;      }</div><div class="line"><a name="l01111"></a><span class="lineno"> 1111</span>&#160;      <span class="keywordflow">if</span> (cache-&gt;<a class="code" href="../../d2/d6b/structsorcery__memory__cache.html#a59a79dcdae51e4000f776c4c48b8c7d1">stale_update_sched_id</a> &lt; 0) {</div><div class="line"><a name="l01112"></a><span class="lineno"> 1112</span>&#160;         <a class="code" href="../../d5/da5/astobj2_8h.html#a6321ee982370c55ab3c24c72c562cbdd">ao2_cleanup</a>(task_data);</div><div class="line"><a name="l01113"></a><span class="lineno"> 1113</span>&#160;      }</div><div class="line"><a name="l01114"></a><span class="lineno"> 1114</span>&#160;   }</div><div class="line"><a name="l01115"></a><span class="lineno"> 1115</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#a9998bd156b936636a8780385e9a910b2">ao2_unlock</a>(cache-&gt;<a class="code" href="../../d2/d6b/structsorcery__memory__cache.html#aa0a84e33972901716d6d5a6dcf1a68de">objects</a>);</div><div class="line"><a name="l01116"></a><span class="lineno"> 1116</span>&#160;}</div><div class="line"><a name="l01117"></a><span class="lineno"> 1117</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01118"></a><span class="lineno"> 1118</span>&#160;<span class="comment">/*!</span></div><div class="line"><a name="l01119"></a><span class="lineno"> 1119</span>&#160;<span class="comment"> * \internal</span></div><div class="line"><a name="l01120"></a><span class="lineno"> 1120</span>&#160;<span class="comment"> * \brief Queue a stale object update</span></div><div class="line"><a name="l01121"></a><span class="lineno"> 1121</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l01122"></a><span class="lineno"> 1122</span>&#160;<span class="comment"> * \param sorcery The sorcery instance</span></div><div class="line"><a name="l01123"></a><span class="lineno"> 1123</span>&#160;<span class="comment"> * \param cache The sorcery memory cache</span></div><div class="line"><a name="l01124"></a><span class="lineno"> 1124</span>&#160;<span class="comment"> * \param cached The cached object</span></div><div class="line"><a name="l01125"></a><span class="lineno"> 1125</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l01126"></a><span class="lineno"><a class="line" href="../../d7/d30/res__sorcery__memory__cache_8c.html#ab1da9230c15ffd14293df53648a90c3d"> 1126</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d7/d30/res__sorcery__memory__cache_8c.html#ab1da9230c15ffd14293df53648a90c3d">memory_cache_stale_update_object</a>(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="../../d2/d88/structast__sorcery.html">ast_sorcery</a> *<a class="code" href="../../d2/d6b/structsorcery__memory__cache.html#aeb33dcb5573e1661c82b5370681fb626">sorcery</a>, <span class="keyword">struct</span> <a class="code" href="../../d2/d6b/structsorcery__memory__cache.html">sorcery_memory_cache</a> *cache,</div><div class="line"><a name="l01127"></a><span class="lineno"> 1127</span>&#160;   <span class="keyword">struct</span> <a class="code" href="../../df/d93/structsorcery__memory__cached__object.html">sorcery_memory_cached_object</a> *cached)</div><div class="line"><a name="l01128"></a><span class="lineno"> 1128</span>&#160;{</div><div class="line"><a name="l01129"></a><span class="lineno"> 1129</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#aa9fdb5d0a6157a56060d9f7279fe6c49">ao2_lock</a>(cached);</div><div class="line"><a name="l01130"></a><span class="lineno"> 1130</span>&#160;   <span class="keywordflow">if</span> (cached-&gt;<a class="code" href="../../df/d93/structsorcery__memory__cached__object.html#a59a79dcdae51e4000f776c4c48b8c7d1">stale_update_sched_id</a> == -1) {</div><div class="line"><a name="l01131"></a><span class="lineno"> 1131</span>&#160;      <span class="keyword">struct </span><a class="code" href="../../da/d04/structstale__update__task__data.html">stale_update_task_data</a> *<a class="code" href="../../d1/dd9/structtask__data.html">task_data</a>;</div><div class="line"><a name="l01132"></a><span class="lineno"> 1132</span>&#160;</div><div class="line"><a name="l01133"></a><span class="lineno"> 1133</span>&#160;      task_data = <a class="code" href="../../d7/d30/res__sorcery__memory__cache_8c.html#aabdbeb4b0dcc076ebdd36377fce2013d">stale_update_task_data_alloc</a>((<span class="keyword">struct</span> <a class="code" href="../../d2/d88/structast__sorcery.html">ast_sorcery</a> *) sorcery,</div><div class="line"><a name="l01134"></a><span class="lineno"> 1134</span>&#160;         cache, <a class="code" href="../../d8/d25/sorcery_8h.html#ac6d61f7f74e9face6219d1d3f5f0671c">ast_sorcery_object_get_type</a>(cached-&gt;<a class="code" href="../../df/d93/structsorcery__memory__cached__object.html#a077376d12464f945e2414d5499c79b3f">object</a>), cached-&gt;<a class="code" href="../../df/d93/structsorcery__memory__cached__object.html#a077376d12464f945e2414d5499c79b3f">object</a>);</div><div class="line"><a name="l01135"></a><span class="lineno"> 1135</span>&#160;      <span class="keywordflow">if</span> (task_data) {</div><div class="line"><a name="l01136"></a><span class="lineno"> 1136</span>&#160;         <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(1, <span class="stringliteral">&quot;Cached sorcery object type &#39;%s&#39; ID &#39;%s&#39; is stale. Refreshing\n&quot;</span>,</div><div class="line"><a name="l01137"></a><span class="lineno"> 1137</span>&#160;            <a class="code" href="../../d8/d25/sorcery_8h.html#ac6d61f7f74e9face6219d1d3f5f0671c">ast_sorcery_object_get_type</a>(cached-&gt;<a class="code" href="../../df/d93/structsorcery__memory__cached__object.html#a077376d12464f945e2414d5499c79b3f">object</a>), <a class="code" href="../../d8/d25/sorcery_8h.html#a97706283a06cbb44e4f0f9620dd5cf07">ast_sorcery_object_get_id</a>(cached-&gt;<a class="code" href="../../df/d93/structsorcery__memory__cached__object.html#a077376d12464f945e2414d5499c79b3f">object</a>));</div><div class="line"><a name="l01138"></a><span class="lineno"> 1138</span>&#160;         cached-&gt;<a class="code" href="../../df/d93/structsorcery__memory__cached__object.html#a59a79dcdae51e4000f776c4c48b8c7d1">stale_update_sched_id</a> = <a class="code" href="../../d7/d00/sched_8h.html#a7a43dcf8be6b2ed7f96f3867fbcb4082">ast_sched_add</a>(sched, 1,</div><div class="line"><a name="l01139"></a><span class="lineno"> 1139</span>&#160;            <a class="code" href="../../d7/d30/res__sorcery__memory__cache_8c.html#a0942c70adebf2e7f884ece65e18718ff">stale_item_update</a>, task_data);</div><div class="line"><a name="l01140"></a><span class="lineno"> 1140</span>&#160;      }</div><div class="line"><a name="l01141"></a><span class="lineno"> 1141</span>&#160;      <span class="keywordflow">if</span> (cached-&gt;<a class="code" href="../../df/d93/structsorcery__memory__cached__object.html#a59a79dcdae51e4000f776c4c48b8c7d1">stale_update_sched_id</a> &lt; 0) {</div><div class="line"><a name="l01142"></a><span class="lineno"> 1142</span>&#160;         <a class="code" href="../../d5/da5/astobj2_8h.html#a6321ee982370c55ab3c24c72c562cbdd">ao2_cleanup</a>(task_data);</div><div class="line"><a name="l01143"></a><span class="lineno"> 1143</span>&#160;         <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Unable to update stale cached object type &#39;%s&#39;, ID &#39;%s&#39;.\n&quot;</span>,</div><div class="line"><a name="l01144"></a><span class="lineno"> 1144</span>&#160;            <a class="code" href="../../d8/d25/sorcery_8h.html#ac6d61f7f74e9face6219d1d3f5f0671c">ast_sorcery_object_get_type</a>(cached-&gt;<a class="code" href="../../df/d93/structsorcery__memory__cached__object.html#a077376d12464f945e2414d5499c79b3f">object</a>), <a class="code" href="../../d8/d25/sorcery_8h.html#a97706283a06cbb44e4f0f9620dd5cf07">ast_sorcery_object_get_id</a>(cached-&gt;<a class="code" href="../../df/d93/structsorcery__memory__cached__object.html#a077376d12464f945e2414d5499c79b3f">object</a>));</div><div class="line"><a name="l01145"></a><span class="lineno"> 1145</span>&#160;      }</div><div class="line"><a name="l01146"></a><span class="lineno"> 1146</span>&#160;   }</div><div class="line"><a name="l01147"></a><span class="lineno"> 1147</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#a9998bd156b936636a8780385e9a910b2">ao2_unlock</a>(cached);</div><div class="line"><a name="l01148"></a><span class="lineno"> 1148</span>&#160;}</div><div class="line"><a name="l01149"></a><span class="lineno"> 1149</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01150"></a><span class="lineno"> 1150</span>&#160;<span class="comment">/*!</span></div><div class="line"><a name="l01151"></a><span class="lineno"> 1151</span>&#160;<span class="comment"> * \internal</span></div><div class="line"><a name="l01152"></a><span class="lineno"> 1152</span>&#160;<span class="comment"> * \brief Check whether an object (or cache) is stale and queue an update</span></div><div class="line"><a name="l01153"></a><span class="lineno"> 1153</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l01154"></a><span class="lineno"> 1154</span>&#160;<span class="comment"> * \param sorcery The sorcery instance</span></div><div class="line"><a name="l01155"></a><span class="lineno"> 1155</span>&#160;<span class="comment"> * \param cache The sorcery memory cache</span></div><div class="line"><a name="l01156"></a><span class="lineno"> 1156</span>&#160;<span class="comment"> * \param cached The cached object</span></div><div class="line"><a name="l01157"></a><span class="lineno"> 1157</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l01158"></a><span class="lineno"><a class="line" href="../../d7/d30/res__sorcery__memory__cache_8c.html#a556435fe0ff7dea99df054fac75dce8d"> 1158</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d7/d30/res__sorcery__memory__cache_8c.html#a556435fe0ff7dea99df054fac75dce8d">memory_cache_stale_check_object</a>(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="../../d2/d88/structast__sorcery.html">ast_sorcery</a> *<a class="code" href="../../d2/d6b/structsorcery__memory__cache.html#aeb33dcb5573e1661c82b5370681fb626">sorcery</a>, <span class="keyword">struct</span> <a class="code" href="../../d2/d6b/structsorcery__memory__cache.html">sorcery_memory_cache</a> *cache,</div><div class="line"><a name="l01159"></a><span class="lineno"> 1159</span>&#160;   <span class="keyword">struct</span> <a class="code" href="../../df/d93/structsorcery__memory__cached__object.html">sorcery_memory_cached_object</a> *cached)</div><div class="line"><a name="l01160"></a><span class="lineno"> 1160</span>&#160;{</div><div class="line"><a name="l01161"></a><span class="lineno"> 1161</span>&#160;   <span class="keyword">struct </span>timeval elapsed;</div><div class="line"><a name="l01162"></a><span class="lineno"> 1162</span>&#160;</div><div class="line"><a name="l01163"></a><span class="lineno"> 1163</span>&#160;   <span class="keywordflow">if</span> (!cache-&gt;<a class="code" href="../../d2/d6b/structsorcery__memory__cache.html#a89b193072cd806e8e239c9a448463efe">object_lifetime_stale</a>) {</div><div class="line"><a name="l01164"></a><span class="lineno"> 1164</span>&#160;      <span class="keywordflow">return</span>;</div><div class="line"><a name="l01165"></a><span class="lineno"> 1165</span>&#160;   }</div><div class="line"><a name="l01166"></a><span class="lineno"> 1166</span>&#160;</div><div class="line"><a name="l01167"></a><span class="lineno"> 1167</span>&#160;   <span class="comment">/* For a full cache as every object has the same expiration/staleness we can do the same check */</span></div><div class="line"><a name="l01168"></a><span class="lineno"> 1168</span>&#160;   elapsed = <a class="code" href="../../de/df7/time_8h.html#aa13b651c18bc6004cab21ac041d44dd8">ast_tvsub</a>(<a class="code" href="../../de/df7/time_8h.html#ad3899efb6f0e348556ef69f5b16aa7f7">ast_tvnow</a>(), cached-&gt;<a class="code" href="../../df/d93/structsorcery__memory__cached__object.html#a529e497bc965817d03dbcdc5805305c4">created</a>);</div><div class="line"><a name="l01169"></a><span class="lineno"> 1169</span>&#160;</div><div class="line"><a name="l01170"></a><span class="lineno"> 1170</span>&#160;   <span class="keywordflow">if</span> (elapsed.tv_sec &lt; cache-&gt;<a class="code" href="../../d2/d6b/structsorcery__memory__cache.html#a89b193072cd806e8e239c9a448463efe">object_lifetime_stale</a>) {</div><div class="line"><a name="l01171"></a><span class="lineno"> 1171</span>&#160;      <span class="keywordflow">return</span>;</div><div class="line"><a name="l01172"></a><span class="lineno"> 1172</span>&#160;   }</div><div class="line"><a name="l01173"></a><span class="lineno"> 1173</span>&#160;</div><div class="line"><a name="l01174"></a><span class="lineno"> 1174</span>&#160;   <span class="keywordflow">if</span> (cache-&gt;<a class="code" href="../../d2/d6b/structsorcery__memory__cache.html#acbaed991b7fd3a4fd5661a99cb304d56">full_backend_cache</a>) {</div><div class="line"><a name="l01175"></a><span class="lineno"> 1175</span>&#160;      <a class="code" href="../../d7/d30/res__sorcery__memory__cache_8c.html#ac3d8ebcb3363c9044516347d76393007">memory_cache_stale_update_full</a>(sorcery, cache, <a class="code" href="../../d8/d25/sorcery_8h.html#ac6d61f7f74e9face6219d1d3f5f0671c">ast_sorcery_object_get_type</a>(cached-&gt;<a class="code" href="../../df/d93/structsorcery__memory__cached__object.html#a077376d12464f945e2414d5499c79b3f">object</a>));</div><div class="line"><a name="l01176"></a><span class="lineno"> 1176</span>&#160;   } <span class="keywordflow">else</span> {</div><div class="line"><a name="l01177"></a><span class="lineno"> 1177</span>&#160;      <a class="code" href="../../d7/d30/res__sorcery__memory__cache_8c.html#ab1da9230c15ffd14293df53648a90c3d">memory_cache_stale_update_object</a>(sorcery, cache, cached);</div><div class="line"><a name="l01178"></a><span class="lineno"> 1178</span>&#160;   }</div><div class="line"><a name="l01179"></a><span class="lineno"> 1179</span>&#160;</div><div class="line"><a name="l01180"></a><span class="lineno"> 1180</span>&#160;}</div><div class="line"><a name="l01181"></a><span class="lineno"> 1181</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01182"></a><span class="lineno"> 1182</span>&#160;<span class="comment">/*!</span></div><div class="line"><a name="l01183"></a><span class="lineno"> 1183</span>&#160;<span class="comment"> * \internal</span></div><div class="line"><a name="l01184"></a><span class="lineno"> 1184</span>&#160;<span class="comment"> * \brief Check whether the entire cache is stale or not and queue an update</span></div><div class="line"><a name="l01185"></a><span class="lineno"> 1185</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l01186"></a><span class="lineno"> 1186</span>&#160;<span class="comment"> * \param sorcery The sorcery instance</span></div><div class="line"><a name="l01187"></a><span class="lineno"> 1187</span>&#160;<span class="comment"> * \param cache The sorcery memory cache</span></div><div class="line"><a name="l01188"></a><span class="lineno"> 1188</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l01189"></a><span class="lineno"> 1189</span>&#160;<span class="comment"> * \note Unlike \ref memory_cache_stale_check this does not require  an explicit object</span></div><div class="line"><a name="l01190"></a><span class="lineno"> 1190</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l01191"></a><span class="lineno"><a class="line" href="../../d7/d30/res__sorcery__memory__cache_8c.html#ac2710be96da7280183f8b711e01dc81b"> 1191</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d7/d30/res__sorcery__memory__cache_8c.html#ac2710be96da7280183f8b711e01dc81b">memory_cache_stale_check</a>(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="../../d2/d88/structast__sorcery.html">ast_sorcery</a> *<a class="code" href="../../d2/d6b/structsorcery__memory__cache.html#aeb33dcb5573e1661c82b5370681fb626">sorcery</a>, <span class="keyword">struct</span> <a class="code" href="../../d2/d6b/structsorcery__memory__cache.html">sorcery_memory_cache</a> *cache)</div><div class="line"><a name="l01192"></a><span class="lineno"> 1192</span>&#160;{</div><div class="line"><a name="l01193"></a><span class="lineno"> 1193</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../df/d93/structsorcery__memory__cached__object.html">sorcery_memory_cached_object</a> *cached;</div><div class="line"><a name="l01194"></a><span class="lineno"> 1194</span>&#160;</div><div class="line"><a name="l01195"></a><span class="lineno"> 1195</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#a24c1bf4b1202c996cf8a793fa6669bc2">ao2_rdlock</a>(cache-&gt;<a class="code" href="../../d2/d6b/structsorcery__memory__cache.html#aa0a84e33972901716d6d5a6dcf1a68de">objects</a>);</div><div class="line"><a name="l01196"></a><span class="lineno"> 1196</span>&#160;   cached = <a class="code" href="../../d5/da5/astobj2_8h.html#ac438c3fcd3150481fad38689fd813a15">ao2_bump</a>(<a class="code" href="../../da/ddb/heap_8h.html#aaa326b988236a0841d41cf2af8ec9b7e">ast_heap_peek</a>(cache-&gt;<a class="code" href="../../d2/d6b/structsorcery__memory__cache.html#ac2c70d25e5f4a7ef4384b344d4f411ce">object_heap</a>, 1));</div><div class="line"><a name="l01197"></a><span class="lineno"> 1197</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#a9998bd156b936636a8780385e9a910b2">ao2_unlock</a>(cache-&gt;<a class="code" href="../../d2/d6b/structsorcery__memory__cache.html#aa0a84e33972901716d6d5a6dcf1a68de">objects</a>);</div><div class="line"><a name="l01198"></a><span class="lineno"> 1198</span>&#160;</div><div class="line"><a name="l01199"></a><span class="lineno"> 1199</span>&#160;   <span class="keywordflow">if</span> (!cached) {</div><div class="line"><a name="l01200"></a><span class="lineno"> 1200</span>&#160;      <span class="keywordflow">return</span>;</div><div class="line"><a name="l01201"></a><span class="lineno"> 1201</span>&#160;   }</div><div class="line"><a name="l01202"></a><span class="lineno"> 1202</span>&#160;</div><div class="line"><a name="l01203"></a><span class="lineno"> 1203</span>&#160;   <a class="code" href="../../d7/d30/res__sorcery__memory__cache_8c.html#a556435fe0ff7dea99df054fac75dce8d">memory_cache_stale_check_object</a>(sorcery, cache, cached);</div><div class="line"><a name="l01204"></a><span class="lineno"> 1204</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(cached, -1);</div><div class="line"><a name="l01205"></a><span class="lineno"> 1205</span>&#160;}</div><div class="line"><a name="l01206"></a><span class="lineno"> 1206</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01207"></a><span class="lineno"> 1207</span>&#160;<span class="comment">/*!</span></div><div class="line"><a name="l01208"></a><span class="lineno"> 1208</span>&#160;<span class="comment"> * \internal</span></div><div class="line"><a name="l01209"></a><span class="lineno"> 1209</span>&#160;<span class="comment"> * \brief Callback function to retrieve an object from a memory cache</span></div><div class="line"><a name="l01210"></a><span class="lineno"> 1210</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l01211"></a><span class="lineno"> 1211</span>&#160;<span class="comment"> * \param sorcery The sorcery instance</span></div><div class="line"><a name="l01212"></a><span class="lineno"> 1212</span>&#160;<span class="comment"> * \param data The sorcery memory cache</span></div><div class="line"><a name="l01213"></a><span class="lineno"> 1213</span>&#160;<span class="comment"> * \param type The type of the object to retrieve</span></div><div class="line"><a name="l01214"></a><span class="lineno"> 1214</span>&#160;<span class="comment"> * \param id The id of the object to retrieve</span></div><div class="line"><a name="l01215"></a><span class="lineno"> 1215</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l01216"></a><span class="lineno"> 1216</span>&#160;<span class="comment"> * \retval non-NULL success</span></div><div class="line"><a name="l01217"></a><span class="lineno"> 1217</span>&#160;<span class="comment"> * \retval NULL failure</span></div><div class="line"><a name="l01218"></a><span class="lineno"> 1218</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l01219"></a><span class="lineno"><a class="line" href="../../d7/d30/res__sorcery__memory__cache_8c.html#a0e33561fb1fc08c9366a5a83eb83583e"> 1219</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> *<a class="code" href="../../d7/d30/res__sorcery__memory__cache_8c.html#a0e33561fb1fc08c9366a5a83eb83583e">sorcery_memory_cache_retrieve_id</a>(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="../../d2/d88/structast__sorcery.html">ast_sorcery</a> *<a class="code" href="../../d2/d6b/structsorcery__memory__cache.html#aeb33dcb5573e1661c82b5370681fb626">sorcery</a>, <span class="keywordtype">void</span> *data, <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="../../d7/d49/chan__ooh323_8c.html#a4d63fdfe5451ec2248c16a2739190c56">type</a>, <span class="keyword">const</span> <span class="keywordtype">char</span> *<span class="keywordtype">id</span>)</div><div class="line"><a name="l01220"></a><span class="lineno"> 1220</span>&#160;{</div><div class="line"><a name="l01221"></a><span class="lineno"> 1221</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d2/d6b/structsorcery__memory__cache.html">sorcery_memory_cache</a> *cache = data;</div><div class="line"><a name="l01222"></a><span class="lineno"> 1222</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../df/d93/structsorcery__memory__cached__object.html">sorcery_memory_cached_object</a> *cached;</div><div class="line"><a name="l01223"></a><span class="lineno"> 1223</span>&#160;   <span class="keywordtype">void</span> *<a class="code" href="../../df/d93/structsorcery__memory__cached__object.html#a077376d12464f945e2414d5499c79b3f">object</a>;</div><div class="line"><a name="l01224"></a><span class="lineno"> 1224</span>&#160;</div><div class="line"><a name="l01225"></a><span class="lineno"> 1225</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d7/d30/res__sorcery__memory__cache_8c.html#a8f1f8589c9e03dcae4a7c2eb435be59c">is_passthru_update</a>()) {</div><div class="line"><a name="l01226"></a><span class="lineno"> 1226</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l01227"></a><span class="lineno"> 1227</span>&#160;   }</div><div class="line"><a name="l01228"></a><span class="lineno"> 1228</span>&#160;</div><div class="line"><a name="l01229"></a><span class="lineno"> 1229</span>&#160;   <a class="code" href="../../d7/d30/res__sorcery__memory__cache_8c.html#a8c078864ef352717e61f7435221ee7c4">memory_cache_full_update</a>(sorcery, type, cache);</div><div class="line"><a name="l01230"></a><span class="lineno"> 1230</span>&#160;</div><div class="line"><a name="l01231"></a><span class="lineno"> 1231</span>&#160;   cached = <a class="code" href="../../d5/da5/astobj2_8h.html#a911e0703891a9a7aaf73978152092586">ao2_find</a>(cache-&gt;<a class="code" href="../../d2/d6b/structsorcery__memory__cache.html#aa0a84e33972901716d6d5a6dcf1a68de">objects</a>, <span class="keywordtype">id</span>, <a class="code" href="../../d5/da5/astobj2_8h.html#ad9d009e87e737af900825b36db55a35caa13a6e0771cc457e86f425d95c3b8d54">OBJ_SEARCH_KEY</a>);</div><div class="line"><a name="l01232"></a><span class="lineno"> 1232</span>&#160;   <span class="keywordflow">if</span> (!cached) {</div><div class="line"><a name="l01233"></a><span class="lineno"> 1233</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l01234"></a><span class="lineno"> 1234</span>&#160;   }</div><div class="line"><a name="l01235"></a><span class="lineno"> 1235</span>&#160;</div><div class="line"><a name="l01236"></a><span class="lineno"> 1236</span>&#160;   <a class="code" href="../../d5/d60/utils_8h.html#a24374da24af1931d8a7ccde5b352bb2c">ast_assert</a>(!strcmp(<a class="code" href="../../d8/d25/sorcery_8h.html#a97706283a06cbb44e4f0f9620dd5cf07">ast_sorcery_object_get_id</a>(cached-&gt;<a class="code" href="../../df/d93/structsorcery__memory__cached__object.html#a077376d12464f945e2414d5499c79b3f">object</a>), <span class="keywordtype">id</span>));</div><div class="line"><a name="l01237"></a><span class="lineno"> 1237</span>&#160;</div><div class="line"><a name="l01238"></a><span class="lineno"> 1238</span>&#160;   <a class="code" href="../../d7/d30/res__sorcery__memory__cache_8c.html#a556435fe0ff7dea99df054fac75dce8d">memory_cache_stale_check_object</a>(sorcery, cache, cached);</div><div class="line"><a name="l01239"></a><span class="lineno"> 1239</span>&#160;</div><div class="line"><a name="l01240"></a><span class="lineno"> 1240</span>&#160;   <span class="keywordtype">object</span> = <a class="code" href="../../d5/da5/astobj2_8h.html#ac438c3fcd3150481fad38689fd813a15">ao2_bump</a>(cached-&gt;<a class="code" href="../../df/d93/structsorcery__memory__cached__object.html#a077376d12464f945e2414d5499c79b3f">object</a>);</div><div class="line"><a name="l01241"></a><span class="lineno"> 1241</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(cached, -1);</div><div class="line"><a name="l01242"></a><span class="lineno"> 1242</span>&#160;</div><div class="line"><a name="l01243"></a><span class="lineno"> 1243</span>&#160;   <span class="keywordflow">return</span> <a class="code" href="../../df/d93/structsorcery__memory__cached__object.html#a077376d12464f945e2414d5499c79b3f">object</a>;</div><div class="line"><a name="l01244"></a><span class="lineno"> 1244</span>&#160;}</div><div class="line"><a name="l01245"></a><span class="lineno"> 1245</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01246"></a><span class="lineno"> 1246</span>&#160;<span class="comment">/*!</span></div><div class="line"><a name="l01247"></a><span class="lineno"> 1247</span>&#160;<span class="comment"> * \internal</span></div><div class="line"><a name="l01248"></a><span class="lineno"> 1248</span>&#160;<span class="comment"> * \brief AO2 callback function for comparing a retrieval request and finding applicable objects</span></div><div class="line"><a name="l01249"></a><span class="lineno"> 1249</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l01250"></a><span class="lineno"> 1250</span>&#160;<span class="comment"> * \param obj The cached object</span></div><div class="line"><a name="l01251"></a><span class="lineno"> 1251</span>&#160;<span class="comment"> * \param arg The comparison parameters</span></div><div class="line"><a name="l01252"></a><span class="lineno"> 1252</span>&#160;<span class="comment"> * \param flags Unused flags</span></div><div class="line"><a name="l01253"></a><span class="lineno"> 1253</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l01254"></a><span class="lineno"><a class="line" href="../../d7/d30/res__sorcery__memory__cache_8c.html#a56cee8e124bf2766c1e1d71ccfb464cd"> 1254</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d7/d30/res__sorcery__memory__cache_8c.html#a56cee8e124bf2766c1e1d71ccfb464cd">sorcery_memory_cache_fields_cmp</a>(<span class="keywordtype">void</span> *obj, <span class="keywordtype">void</span> *arg, <span class="keywordtype">int</span> flags)</div><div class="line"><a name="l01255"></a><span class="lineno"> 1255</span>&#160;{</div><div class="line"><a name="l01256"></a><span class="lineno"> 1256</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../df/d93/structsorcery__memory__cached__object.html">sorcery_memory_cached_object</a> *cached = obj;</div><div class="line"><a name="l01257"></a><span class="lineno"> 1257</span>&#160;   <span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="../../d7/d59/structsorcery__memory__cache__fields__cmp__params.html">sorcery_memory_cache_fields_cmp_params</a> *params = arg;</div><div class="line"><a name="l01258"></a><span class="lineno"> 1258</span>&#160;   <a class="code" href="../../d5/d60/utils_8h.html#a1604b4d72144dd3d9f7da668e90337e9">RAII_VAR</a>(<span class="keyword">struct</span> <a class="code" href="../../dd/d02/structast__variable.html">ast_variable</a> *, diff, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../d3/de6/include_2asterisk_2config_8h.html#adea5390496e5477192d86f340d512d04">ast_variables_destroy</a>);</div><div class="line"><a name="l01259"></a><span class="lineno"> 1259</span>&#160;</div><div class="line"><a name="l01260"></a><span class="lineno"> 1260</span>&#160;   <span class="keywordflow">if</span> (params-&gt;<a class="code" href="../../d7/d59/structsorcery__memory__cache__fields__cmp__params.html#af71a3fad7fee5d731252ce89e56f948f">regex</a>) {</div><div class="line"><a name="l01261"></a><span class="lineno"> 1261</span>&#160;      <span class="comment">/* If a regular expression has been provided see if it matches, otherwise move on */</span></div><div class="line"><a name="l01262"></a><span class="lineno"> 1262</span>&#160;      <span class="keywordflow">if</span> (!regexec(params-&gt;<a class="code" href="../../d7/d59/structsorcery__memory__cache__fields__cmp__params.html#af71a3fad7fee5d731252ce89e56f948f">regex</a>, <a class="code" href="../../d8/d25/sorcery_8h.html#a97706283a06cbb44e4f0f9620dd5cf07">ast_sorcery_object_get_id</a>(cached-&gt;<a class="code" href="../../df/d93/structsorcery__memory__cached__object.html#a077376d12464f945e2414d5499c79b3f">object</a>), 0, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, 0)) {</div><div class="line"><a name="l01263"></a><span class="lineno"> 1263</span>&#160;         <a class="code" href="../../d5/da5/astobj2_8h.html#a1ad9f122bcae95a470639402faa3d2ee">ao2_link</a>(params-&gt;<a class="code" href="../../d7/d59/structsorcery__memory__cache__fields__cmp__params.html#a7ea220e4d14b05876af4430e9832ce47">container</a>, cached-&gt;<a class="code" href="../../df/d93/structsorcery__memory__cached__object.html#a077376d12464f945e2414d5499c79b3f">object</a>);</div><div class="line"><a name="l01264"></a><span class="lineno"> 1264</span>&#160;      }</div><div class="line"><a name="l01265"></a><span class="lineno"> 1265</span>&#160;      <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l01266"></a><span class="lineno"> 1266</span>&#160;   } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (params-&gt;<a class="code" href="../../d7/d59/structsorcery__memory__cache__fields__cmp__params.html#a5b41c5ae4505891e6c53e26df197e02b">prefix</a>) {</div><div class="line"><a name="l01267"></a><span class="lineno"> 1267</span>&#160;      <span class="keywordflow">if</span> (!strncmp(params-&gt;<a class="code" href="../../d7/d59/structsorcery__memory__cache__fields__cmp__params.html#a5b41c5ae4505891e6c53e26df197e02b">prefix</a>, <a class="code" href="../../d8/d25/sorcery_8h.html#a97706283a06cbb44e4f0f9620dd5cf07">ast_sorcery_object_get_id</a>(cached-&gt;<a class="code" href="../../df/d93/structsorcery__memory__cached__object.html#a077376d12464f945e2414d5499c79b3f">object</a>), params-&gt;<a class="code" href="../../d7/d59/structsorcery__memory__cache__fields__cmp__params.html#ae9fc6d86a482d56978b6a7de516da7f8">prefix_len</a>)) {</div><div class="line"><a name="l01268"></a><span class="lineno"> 1268</span>&#160;         <a class="code" href="../../d5/da5/astobj2_8h.html#a1ad9f122bcae95a470639402faa3d2ee">ao2_link</a>(params-&gt;<a class="code" href="../../d7/d59/structsorcery__memory__cache__fields__cmp__params.html#a7ea220e4d14b05876af4430e9832ce47">container</a>, cached-&gt;<a class="code" href="../../df/d93/structsorcery__memory__cached__object.html#a077376d12464f945e2414d5499c79b3f">object</a>);</div><div class="line"><a name="l01269"></a><span class="lineno"> 1269</span>&#160;      }</div><div class="line"><a name="l01270"></a><span class="lineno"> 1270</span>&#160;      <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l01271"></a><span class="lineno"> 1271</span>&#160;   } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (params-&gt;<a class="code" href="../../d7/d59/structsorcery__memory__cache__fields__cmp__params.html#aed2d94a6fe15ec228d25838ea61f6a94">fields</a> &amp;&amp;</div><div class="line"><a name="l01272"></a><span class="lineno"> 1272</span>&#160;        (!<a class="code" href="../../d3/de6/include_2asterisk_2config_8h.html#ad25b8d6e1ba6692683c35625e5301c1e">ast_variable_lists_match</a>(cached-&gt;<a class="code" href="../../df/d93/structsorcery__memory__cached__object.html#a269a2854677d498d5b2ffe7cef85a751">objectset</a>, params-&gt;<a class="code" href="../../d7/d59/structsorcery__memory__cache__fields__cmp__params.html#aed2d94a6fe15ec228d25838ea61f6a94">fields</a>, 0))) {</div><div class="line"><a name="l01273"></a><span class="lineno"> 1273</span>&#160;      <span class="comment">/* If we can&#39;t turn the object into an object set OR if differences exist between the fields</span></div><div class="line"><a name="l01274"></a><span class="lineno"> 1274</span>&#160;<span class="comment">       * passed in and what are present on the object they are not a match.</span></div><div class="line"><a name="l01275"></a><span class="lineno"> 1275</span>&#160;<span class="comment">       */</span></div><div class="line"><a name="l01276"></a><span class="lineno"> 1276</span>&#160;      <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l01277"></a><span class="lineno"> 1277</span>&#160;   }</div><div class="line"><a name="l01278"></a><span class="lineno"> 1278</span>&#160;</div><div class="line"><a name="l01279"></a><span class="lineno"> 1279</span>&#160;   <span class="keywordflow">if</span> (params-&gt;<a class="code" href="../../d7/d59/structsorcery__memory__cache__fields__cmp__params.html#a7ea220e4d14b05876af4430e9832ce47">container</a>) {</div><div class="line"><a name="l01280"></a><span class="lineno"> 1280</span>&#160;      <a class="code" href="../../d5/da5/astobj2_8h.html#a1ad9f122bcae95a470639402faa3d2ee">ao2_link</a>(params-&gt;<a class="code" href="../../d7/d59/structsorcery__memory__cache__fields__cmp__params.html#a7ea220e4d14b05876af4430e9832ce47">container</a>, cached-&gt;<a class="code" href="../../df/d93/structsorcery__memory__cached__object.html#a077376d12464f945e2414d5499c79b3f">object</a>);</div><div class="line"><a name="l01281"></a><span class="lineno"> 1281</span>&#160;</div><div class="line"><a name="l01282"></a><span class="lineno"> 1282</span>&#160;      <span class="comment">/* As multiple objects are being returned keep going */</span></div><div class="line"><a name="l01283"></a><span class="lineno"> 1283</span>&#160;      <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l01284"></a><span class="lineno"> 1284</span>&#160;   } <span class="keywordflow">else</span> {</div><div class="line"><a name="l01285"></a><span class="lineno"> 1285</span>&#160;      <span class="comment">/* Immediately stop and return, we only want a single object */</span></div><div class="line"><a name="l01286"></a><span class="lineno"> 1286</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../d5/da5/astobj2_8h.html#a1f8b41308be4c47de8ff89a3b9c7e7d1a1959468a3c5d6aecd2fa1272d8e30fbf">CMP_MATCH</a> | <a class="code" href="../../d5/da5/astobj2_8h.html#a1f8b41308be4c47de8ff89a3b9c7e7d1a75382dc9117cc118719edf6c3d2b71df">CMP_STOP</a>;</div><div class="line"><a name="l01287"></a><span class="lineno"> 1287</span>&#160;   }</div><div class="line"><a name="l01288"></a><span class="lineno"> 1288</span>&#160;}</div><div class="line"><a name="l01289"></a><span class="lineno"> 1289</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01290"></a><span class="lineno"> 1290</span>&#160;<span class="comment">/*!</span></div><div class="line"><a name="l01291"></a><span class="lineno"> 1291</span>&#160;<span class="comment"> * \internal</span></div><div class="line"><a name="l01292"></a><span class="lineno"> 1292</span>&#160;<span class="comment"> * \brief Callback function to retrieve a single object based on fields</span></div><div class="line"><a name="l01293"></a><span class="lineno"> 1293</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l01294"></a><span class="lineno"> 1294</span>&#160;<span class="comment"> * \param sorcery The sorcery instance</span></div><div class="line"><a name="l01295"></a><span class="lineno"> 1295</span>&#160;<span class="comment"> * \param data The sorcery memory cache</span></div><div class="line"><a name="l01296"></a><span class="lineno"> 1296</span>&#160;<span class="comment"> * \param type The type of the object to retrieve</span></div><div class="line"><a name="l01297"></a><span class="lineno"> 1297</span>&#160;<span class="comment"> * \param fields Any explicit fields to search for</span></div><div class="line"><a name="l01298"></a><span class="lineno"> 1298</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l01299"></a><span class="lineno"><a class="line" href="../../d7/d30/res__sorcery__memory__cache_8c.html#a4a0aad57b8dff22d4df96c5000d4fb80"> 1299</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> *<a class="code" href="../../d7/d30/res__sorcery__memory__cache_8c.html#a4a0aad57b8dff22d4df96c5000d4fb80">sorcery_memory_cache_retrieve_fields</a>(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="../../d2/d88/structast__sorcery.html">ast_sorcery</a> *<a class="code" href="../../d2/d6b/structsorcery__memory__cache.html#aeb33dcb5573e1661c82b5370681fb626">sorcery</a>, <span class="keywordtype">void</span> *data, <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="../../d7/d49/chan__ooh323_8c.html#a4d63fdfe5451ec2248c16a2739190c56">type</a>,</div><div class="line"><a name="l01300"></a><span class="lineno"> 1300</span>&#160;   <span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="../../dd/d02/structast__variable.html">ast_variable</a> *<a class="code" href="../../d7/d59/structsorcery__memory__cache__fields__cmp__params.html#aed2d94a6fe15ec228d25838ea61f6a94">fields</a>)</div><div class="line"><a name="l01301"></a><span class="lineno"> 1301</span>&#160;{</div><div class="line"><a name="l01302"></a><span class="lineno"> 1302</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d2/d6b/structsorcery__memory__cache.html">sorcery_memory_cache</a> *cache = data;</div><div class="line"><a name="l01303"></a><span class="lineno"> 1303</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d7/d59/structsorcery__memory__cache__fields__cmp__params.html">sorcery_memory_cache_fields_cmp_params</a> params = {</div><div class="line"><a name="l01304"></a><span class="lineno"> 1304</span>&#160;      .<a class="code" href="../../d7/d59/structsorcery__memory__cache__fields__cmp__params.html#aeb33dcb5573e1661c82b5370681fb626">sorcery</a> = <a class="code" href="../../d2/d6b/structsorcery__memory__cache.html#aeb33dcb5573e1661c82b5370681fb626">sorcery</a>,</div><div class="line"><a name="l01305"></a><span class="lineno"> 1305</span>&#160;      .cache = <a class="code" href="../../d2/d2c/pbx__realtime_8c.html#aefe318d32c8bb7a9e2025eb146d47781">cache</a>,</div><div class="line"><a name="l01306"></a><span class="lineno"> 1306</span>&#160;      .fields = <a class="code" href="../../d7/d59/structsorcery__memory__cache__fields__cmp__params.html#aed2d94a6fe15ec228d25838ea61f6a94">fields</a>,</div><div class="line"><a name="l01307"></a><span class="lineno"> 1307</span>&#160;   };</div><div class="line"><a name="l01308"></a><span class="lineno"> 1308</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../df/d93/structsorcery__memory__cached__object.html">sorcery_memory_cached_object</a> *cached;</div><div class="line"><a name="l01309"></a><span class="lineno"> 1309</span>&#160;   <span class="keywordtype">void</span> *<span class="keywordtype">object</span> = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l01310"></a><span class="lineno"> 1310</span>&#160;</div><div class="line"><a name="l01311"></a><span class="lineno"> 1311</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d7/d30/res__sorcery__memory__cache_8c.html#a8f1f8589c9e03dcae4a7c2eb435be59c">is_passthru_update</a>() || !cache-&gt;<a class="code" href="../../d2/d6b/structsorcery__memory__cache.html#acbaed991b7fd3a4fd5661a99cb304d56">full_backend_cache</a> || !fields) {</div><div class="line"><a name="l01312"></a><span class="lineno"> 1312</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l01313"></a><span class="lineno"> 1313</span>&#160;   }</div><div class="line"><a name="l01314"></a><span class="lineno"> 1314</span>&#160;</div><div class="line"><a name="l01315"></a><span class="lineno"> 1315</span>&#160;   cached = <a class="code" href="../../d5/da5/astobj2_8h.html#a47857055118a703ae87ea5ebaf4842ed">ao2_callback</a>(cache-&gt;<a class="code" href="../../d2/d6b/structsorcery__memory__cache.html#aa0a84e33972901716d6d5a6dcf1a68de">objects</a>, 0, <a class="code" href="../../d7/d30/res__sorcery__memory__cache_8c.html#a56cee8e124bf2766c1e1d71ccfb464cd">sorcery_memory_cache_fields_cmp</a>, &amp;params);</div><div class="line"><a name="l01316"></a><span class="lineno"> 1316</span>&#160;</div><div class="line"><a name="l01317"></a><span class="lineno"> 1317</span>&#160;   <span class="keywordflow">if</span> (cached) {</div><div class="line"><a name="l01318"></a><span class="lineno"> 1318</span>&#160;      <a class="code" href="../../d7/d30/res__sorcery__memory__cache_8c.html#a556435fe0ff7dea99df054fac75dce8d">memory_cache_stale_check_object</a>(sorcery, cache, cached);</div><div class="line"><a name="l01319"></a><span class="lineno"> 1319</span>&#160;      <span class="keywordtype">object</span> = <a class="code" href="../../d5/da5/astobj2_8h.html#ac438c3fcd3150481fad38689fd813a15">ao2_bump</a>(cached-&gt;<a class="code" href="../../df/d93/structsorcery__memory__cached__object.html#a077376d12464f945e2414d5499c79b3f">object</a>);</div><div class="line"><a name="l01320"></a><span class="lineno"> 1320</span>&#160;      <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(cached, -1);</div><div class="line"><a name="l01321"></a><span class="lineno"> 1321</span>&#160;   }</div><div class="line"><a name="l01322"></a><span class="lineno"> 1322</span>&#160;</div><div class="line"><a name="l01323"></a><span class="lineno"> 1323</span>&#160;   <span class="keywordflow">return</span> <a class="code" href="../../df/d93/structsorcery__memory__cached__object.html#a077376d12464f945e2414d5499c79b3f">object</a>;</div><div class="line"><a name="l01324"></a><span class="lineno"> 1324</span>&#160;}</div><div class="line"><a name="l01325"></a><span class="lineno"> 1325</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01326"></a><span class="lineno"> 1326</span>&#160;<span class="comment">/*!</span></div><div class="line"><a name="l01327"></a><span class="lineno"> 1327</span>&#160;<span class="comment"> * \internal</span></div><div class="line"><a name="l01328"></a><span class="lineno"> 1328</span>&#160;<span class="comment"> * \brief Callback function to retrieve multiple objects from a memory cache</span></div><div class="line"><a name="l01329"></a><span class="lineno"> 1329</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l01330"></a><span class="lineno"> 1330</span>&#160;<span class="comment"> * \param sorcery The sorcery instance</span></div><div class="line"><a name="l01331"></a><span class="lineno"> 1331</span>&#160;<span class="comment"> * \param data The sorcery memory cache</span></div><div class="line"><a name="l01332"></a><span class="lineno"> 1332</span>&#160;<span class="comment"> * \param type The type of the object to retrieve</span></div><div class="line"><a name="l01333"></a><span class="lineno"> 1333</span>&#160;<span class="comment"> * \param objects Container to place the objects into</span></div><div class="line"><a name="l01334"></a><span class="lineno"> 1334</span>&#160;<span class="comment"> * \param fields Any explicit fields to search for</span></div><div class="line"><a name="l01335"></a><span class="lineno"> 1335</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l01336"></a><span class="lineno"><a class="line" href="../../d7/d30/res__sorcery__memory__cache_8c.html#acf5c4d16aab69f65543750c6f069fac4"> 1336</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d7/d30/res__sorcery__memory__cache_8c.html#acf5c4d16aab69f65543750c6f069fac4">sorcery_memory_cache_retrieve_multiple</a>(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="../../d2/d88/structast__sorcery.html">ast_sorcery</a> *<a class="code" href="../../d2/d6b/structsorcery__memory__cache.html#aeb33dcb5573e1661c82b5370681fb626">sorcery</a>, <span class="keywordtype">void</span> *data, <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="../../d7/d49/chan__ooh323_8c.html#a4d63fdfe5451ec2248c16a2739190c56">type</a>,</div><div class="line"><a name="l01337"></a><span class="lineno"> 1337</span>&#160;   <span class="keyword">struct</span> <a class="code" href="../../d2/da9/structao2__container.html">ao2_container</a> *<a class="code" href="../../d2/d6b/structsorcery__memory__cache.html#aa0a84e33972901716d6d5a6dcf1a68de">objects</a>, <span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="../../dd/d02/structast__variable.html">ast_variable</a> *fields)</div><div class="line"><a name="l01338"></a><span class="lineno"> 1338</span>&#160;{</div><div class="line"><a name="l01339"></a><span class="lineno"> 1339</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d2/d6b/structsorcery__memory__cache.html">sorcery_memory_cache</a> *cache = data;</div><div class="line"><a name="l01340"></a><span class="lineno"> 1340</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d7/d59/structsorcery__memory__cache__fields__cmp__params.html">sorcery_memory_cache_fields_cmp_params</a> params = {</div><div class="line"><a name="l01341"></a><span class="lineno"> 1341</span>&#160;      .<a class="code" href="../../d7/d59/structsorcery__memory__cache__fields__cmp__params.html#aeb33dcb5573e1661c82b5370681fb626">sorcery</a> = <a class="code" href="../../d2/d6b/structsorcery__memory__cache.html#aeb33dcb5573e1661c82b5370681fb626">sorcery</a>,</div><div class="line"><a name="l01342"></a><span class="lineno"> 1342</span>&#160;      .cache = <a class="code" href="../../d2/d2c/pbx__realtime_8c.html#aefe318d32c8bb7a9e2025eb146d47781">cache</a>,</div><div class="line"><a name="l01343"></a><span class="lineno"> 1343</span>&#160;      .fields = <a class="code" href="../../d7/d59/structsorcery__memory__cache__fields__cmp__params.html#aed2d94a6fe15ec228d25838ea61f6a94">fields</a>,</div><div class="line"><a name="l01344"></a><span class="lineno"> 1344</span>&#160;      .container = <a class="code" href="../../d2/d6b/structsorcery__memory__cache.html#aa0a84e33972901716d6d5a6dcf1a68de">objects</a>,</div><div class="line"><a name="l01345"></a><span class="lineno"> 1345</span>&#160;   };</div><div class="line"><a name="l01346"></a><span class="lineno"> 1346</span>&#160;</div><div class="line"><a name="l01347"></a><span class="lineno"> 1347</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d7/d30/res__sorcery__memory__cache_8c.html#a8f1f8589c9e03dcae4a7c2eb435be59c">is_passthru_update</a>() || !cache-&gt;<a class="code" href="../../d2/d6b/structsorcery__memory__cache.html#acbaed991b7fd3a4fd5661a99cb304d56">full_backend_cache</a>) {</div><div class="line"><a name="l01348"></a><span class="lineno"> 1348</span>&#160;      <span class="keywordflow">return</span>;</div><div class="line"><a name="l01349"></a><span class="lineno"> 1349</span>&#160;   }</div><div class="line"><a name="l01350"></a><span class="lineno"> 1350</span>&#160;</div><div class="line"><a name="l01351"></a><span class="lineno"> 1351</span>&#160;   <a class="code" href="../../d7/d30/res__sorcery__memory__cache_8c.html#a8c078864ef352717e61f7435221ee7c4">memory_cache_full_update</a>(sorcery, type, cache);</div><div class="line"><a name="l01352"></a><span class="lineno"> 1352</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#a47857055118a703ae87ea5ebaf4842ed">ao2_callback</a>(cache-&gt;<a class="code" href="../../d2/d6b/structsorcery__memory__cache.html#aa0a84e33972901716d6d5a6dcf1a68de">objects</a>, 0, <a class="code" href="../../d7/d30/res__sorcery__memory__cache_8c.html#a56cee8e124bf2766c1e1d71ccfb464cd">sorcery_memory_cache_fields_cmp</a>, &amp;params);</div><div class="line"><a name="l01353"></a><span class="lineno"> 1353</span>&#160;</div><div class="line"><a name="l01354"></a><span class="lineno"> 1354</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d5/da5/astobj2_8h.html#a512cc40ce96c63b3d5c78040baa4c9cd">ao2_container_count</a>(objects)) {</div><div class="line"><a name="l01355"></a><span class="lineno"> 1355</span>&#160;      <a class="code" href="../../d7/d30/res__sorcery__memory__cache_8c.html#ac2710be96da7280183f8b711e01dc81b">memory_cache_stale_check</a>(sorcery, cache);</div><div class="line"><a name="l01356"></a><span class="lineno"> 1356</span>&#160;   }</div><div class="line"><a name="l01357"></a><span class="lineno"> 1357</span>&#160;}</div><div class="line"><a name="l01358"></a><span class="lineno"> 1358</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01359"></a><span class="lineno"> 1359</span>&#160;<span class="comment">/*!</span></div><div class="line"><a name="l01360"></a><span class="lineno"> 1360</span>&#160;<span class="comment"> * \internal</span></div><div class="line"><a name="l01361"></a><span class="lineno"> 1361</span>&#160;<span class="comment"> * \brief Callback function to retrieve multiple objects using a regex on the object id</span></div><div class="line"><a name="l01362"></a><span class="lineno"> 1362</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l01363"></a><span class="lineno"> 1363</span>&#160;<span class="comment"> * \param sorcery The sorcery instance</span></div><div class="line"><a name="l01364"></a><span class="lineno"> 1364</span>&#160;<span class="comment"> * \param data The sorcery memory cache</span></div><div class="line"><a name="l01365"></a><span class="lineno"> 1365</span>&#160;<span class="comment"> * \param type The type of the object to retrieve</span></div><div class="line"><a name="l01366"></a><span class="lineno"> 1366</span>&#160;<span class="comment"> * \param objects Container to place the objects into</span></div><div class="line"><a name="l01367"></a><span class="lineno"> 1367</span>&#160;<span class="comment"> * \param regex Regular expression to apply to the object id</span></div><div class="line"><a name="l01368"></a><span class="lineno"> 1368</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l01369"></a><span class="lineno"><a class="line" href="../../d7/d30/res__sorcery__memory__cache_8c.html#a474ead91b9f86ab23435c2ee0fe1a19d"> 1369</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d7/d30/res__sorcery__memory__cache_8c.html#a474ead91b9f86ab23435c2ee0fe1a19d">sorcery_memory_cache_retrieve_regex</a>(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="../../d2/d88/structast__sorcery.html">ast_sorcery</a> *<a class="code" href="../../d2/d6b/structsorcery__memory__cache.html#aeb33dcb5573e1661c82b5370681fb626">sorcery</a>, <span class="keywordtype">void</span> *data, <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="../../d7/d49/chan__ooh323_8c.html#a4d63fdfe5451ec2248c16a2739190c56">type</a>,</div><div class="line"><a name="l01370"></a><span class="lineno"> 1370</span>&#160;   <span class="keyword">struct</span> <a class="code" href="../../d2/da9/structao2__container.html">ao2_container</a> *<a class="code" href="../../d2/d6b/structsorcery__memory__cache.html#aa0a84e33972901716d6d5a6dcf1a68de">objects</a>, <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="../../d9/d1e/func__strings_8c.html#a1b62eb9e3ebf087509f4301aa6336931">regex</a>)</div><div class="line"><a name="l01371"></a><span class="lineno"> 1371</span>&#160;{</div><div class="line"><a name="l01372"></a><span class="lineno"> 1372</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d2/d6b/structsorcery__memory__cache.html">sorcery_memory_cache</a> *cache = data;</div><div class="line"><a name="l01373"></a><span class="lineno"> 1373</span>&#160;   regex_t expression;</div><div class="line"><a name="l01374"></a><span class="lineno"> 1374</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d7/d59/structsorcery__memory__cache__fields__cmp__params.html">sorcery_memory_cache_fields_cmp_params</a> params = {</div><div class="line"><a name="l01375"></a><span class="lineno"> 1375</span>&#160;      .<a class="code" href="../../d7/d59/structsorcery__memory__cache__fields__cmp__params.html#aeb33dcb5573e1661c82b5370681fb626">sorcery</a> = <a class="code" href="../../d2/d6b/structsorcery__memory__cache.html#aeb33dcb5573e1661c82b5370681fb626">sorcery</a>,</div><div class="line"><a name="l01376"></a><span class="lineno"> 1376</span>&#160;      .cache = <a class="code" href="../../d2/d2c/pbx__realtime_8c.html#aefe318d32c8bb7a9e2025eb146d47781">cache</a>,</div><div class="line"><a name="l01377"></a><span class="lineno"> 1377</span>&#160;      .container = <a class="code" href="../../d2/d6b/structsorcery__memory__cache.html#aa0a84e33972901716d6d5a6dcf1a68de">objects</a>,</div><div class="line"><a name="l01378"></a><span class="lineno"> 1378</span>&#160;      .regex = &amp;expression,</div><div class="line"><a name="l01379"></a><span class="lineno"> 1379</span>&#160;   };</div><div class="line"><a name="l01380"></a><span class="lineno"> 1380</span>&#160;</div><div class="line"><a name="l01381"></a><span class="lineno"> 1381</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d7/d30/res__sorcery__memory__cache_8c.html#a8f1f8589c9e03dcae4a7c2eb435be59c">is_passthru_update</a>() || !cache-&gt;<a class="code" href="../../d2/d6b/structsorcery__memory__cache.html#acbaed991b7fd3a4fd5661a99cb304d56">full_backend_cache</a> || regcomp(&amp;expression, regex, REG_EXTENDED | REG_NOSUB)) {</div><div class="line"><a name="l01382"></a><span class="lineno"> 1382</span>&#160;      <span class="keywordflow">return</span>;</div><div class="line"><a name="l01383"></a><span class="lineno"> 1383</span>&#160;   }</div><div class="line"><a name="l01384"></a><span class="lineno"> 1384</span>&#160;</div><div class="line"><a name="l01385"></a><span class="lineno"> 1385</span>&#160;   <a class="code" href="../../d7/d30/res__sorcery__memory__cache_8c.html#a8c078864ef352717e61f7435221ee7c4">memory_cache_full_update</a>(sorcery, type, cache);</div><div class="line"><a name="l01386"></a><span class="lineno"> 1386</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#a47857055118a703ae87ea5ebaf4842ed">ao2_callback</a>(cache-&gt;<a class="code" href="../../d2/d6b/structsorcery__memory__cache.html#aa0a84e33972901716d6d5a6dcf1a68de">objects</a>, 0, <a class="code" href="../../d7/d30/res__sorcery__memory__cache_8c.html#a56cee8e124bf2766c1e1d71ccfb464cd">sorcery_memory_cache_fields_cmp</a>, &amp;params);</div><div class="line"><a name="l01387"></a><span class="lineno"> 1387</span>&#160;   regfree(&amp;expression);</div><div class="line"><a name="l01388"></a><span class="lineno"> 1388</span>&#160;</div><div class="line"><a name="l01389"></a><span class="lineno"> 1389</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d5/da5/astobj2_8h.html#a512cc40ce96c63b3d5c78040baa4c9cd">ao2_container_count</a>(objects)) {</div><div class="line"><a name="l01390"></a><span class="lineno"> 1390</span>&#160;      <a class="code" href="../../d7/d30/res__sorcery__memory__cache_8c.html#ac2710be96da7280183f8b711e01dc81b">memory_cache_stale_check</a>(sorcery, cache);</div><div class="line"><a name="l01391"></a><span class="lineno"> 1391</span>&#160;   }</div><div class="line"><a name="l01392"></a><span class="lineno"> 1392</span>&#160;}</div><div class="line"><a name="l01393"></a><span class="lineno"> 1393</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01394"></a><span class="lineno"> 1394</span>&#160;<span class="comment">/*!</span></div><div class="line"><a name="l01395"></a><span class="lineno"> 1395</span>&#160;<span class="comment"> * \internal</span></div><div class="line"><a name="l01396"></a><span class="lineno"> 1396</span>&#160;<span class="comment"> * \brief Callback function to retrieve multiple objects whose id matches a prefix</span></div><div class="line"><a name="l01397"></a><span class="lineno"> 1397</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l01398"></a><span class="lineno"> 1398</span>&#160;<span class="comment"> * \param sorcery The sorcery instance</span></div><div class="line"><a name="l01399"></a><span class="lineno"> 1399</span>&#160;<span class="comment"> * \param data The sorcery memory cache</span></div><div class="line"><a name="l01400"></a><span class="lineno"> 1400</span>&#160;<span class="comment"> * \param type The type of the object to retrieve</span></div><div class="line"><a name="l01401"></a><span class="lineno"> 1401</span>&#160;<span class="comment"> * \param objects Container to place the objects into</span></div><div class="line"><a name="l01402"></a><span class="lineno"> 1402</span>&#160;<span class="comment"> * \param prefix Prefix to match against the object id</span></div><div class="line"><a name="l01403"></a><span class="lineno"> 1403</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l01404"></a><span class="lineno"><a class="line" href="../../d7/d30/res__sorcery__memory__cache_8c.html#ad3cb017e536622a783cbd0cff96b1ce7"> 1404</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d7/d30/res__sorcery__memory__cache_8c.html#ad3cb017e536622a783cbd0cff96b1ce7">sorcery_memory_cache_retrieve_prefix</a>(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="../../d2/d88/structast__sorcery.html">ast_sorcery</a> *<a class="code" href="../../d2/d6b/structsorcery__memory__cache.html#aeb33dcb5573e1661c82b5370681fb626">sorcery</a>, <span class="keywordtype">void</span> *data, <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="../../d7/d49/chan__ooh323_8c.html#a4d63fdfe5451ec2248c16a2739190c56">type</a>,</div><div class="line"><a name="l01405"></a><span class="lineno"> 1405</span>&#160;   <span class="keyword">struct</span> <a class="code" href="../../d2/da9/structao2__container.html">ao2_container</a> *<a class="code" href="../../d2/d6b/structsorcery__memory__cache.html#aa0a84e33972901716d6d5a6dcf1a68de">objects</a>, <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="../../dd/d43/http_8c.html#a6f25bc812d09fedb86bf394c01061c56">prefix</a>, <span class="keyword">const</span> <span class="keywordtype">size_t</span> <a class="code" href="../../d7/d59/structsorcery__memory__cache__fields__cmp__params.html#ae9fc6d86a482d56978b6a7de516da7f8">prefix_len</a>)</div><div class="line"><a name="l01406"></a><span class="lineno"> 1406</span>&#160;{</div><div class="line"><a name="l01407"></a><span class="lineno"> 1407</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d2/d6b/structsorcery__memory__cache.html">sorcery_memory_cache</a> *cache = data;</div><div class="line"><a name="l01408"></a><span class="lineno"> 1408</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d7/d59/structsorcery__memory__cache__fields__cmp__params.html">sorcery_memory_cache_fields_cmp_params</a> params = {</div><div class="line"><a name="l01409"></a><span class="lineno"> 1409</span>&#160;      .<a class="code" href="../../d7/d59/structsorcery__memory__cache__fields__cmp__params.html#aeb33dcb5573e1661c82b5370681fb626">sorcery</a> = <a class="code" href="../../d2/d6b/structsorcery__memory__cache.html#aeb33dcb5573e1661c82b5370681fb626">sorcery</a>,</div><div class="line"><a name="l01410"></a><span class="lineno"> 1410</span>&#160;      .cache = <a class="code" href="../../d2/d2c/pbx__realtime_8c.html#aefe318d32c8bb7a9e2025eb146d47781">cache</a>,</div><div class="line"><a name="l01411"></a><span class="lineno"> 1411</span>&#160;      .container = <a class="code" href="../../d2/d6b/structsorcery__memory__cache.html#aa0a84e33972901716d6d5a6dcf1a68de">objects</a>,</div><div class="line"><a name="l01412"></a><span class="lineno"> 1412</span>&#160;      .prefix = <a class="code" href="../../dd/d43/http_8c.html#a6f25bc812d09fedb86bf394c01061c56">prefix</a>,</div><div class="line"><a name="l01413"></a><span class="lineno"> 1413</span>&#160;      .prefix_len = <a class="code" href="../../d7/d59/structsorcery__memory__cache__fields__cmp__params.html#ae9fc6d86a482d56978b6a7de516da7f8">prefix_len</a>,</div><div class="line"><a name="l01414"></a><span class="lineno"> 1414</span>&#160;   };</div><div class="line"><a name="l01415"></a><span class="lineno"> 1415</span>&#160;</div><div class="line"><a name="l01416"></a><span class="lineno"> 1416</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d7/d30/res__sorcery__memory__cache_8c.html#a8f1f8589c9e03dcae4a7c2eb435be59c">is_passthru_update</a>() || !cache-&gt;<a class="code" href="../../d2/d6b/structsorcery__memory__cache.html#acbaed991b7fd3a4fd5661a99cb304d56">full_backend_cache</a>) {</div><div class="line"><a name="l01417"></a><span class="lineno"> 1417</span>&#160;      <span class="keywordflow">return</span>;</div><div class="line"><a name="l01418"></a><span class="lineno"> 1418</span>&#160;   }</div><div class="line"><a name="l01419"></a><span class="lineno"> 1419</span>&#160;</div><div class="line"><a name="l01420"></a><span class="lineno"> 1420</span>&#160;   <a class="code" href="../../d7/d30/res__sorcery__memory__cache_8c.html#a8c078864ef352717e61f7435221ee7c4">memory_cache_full_update</a>(sorcery, type, cache);</div><div class="line"><a name="l01421"></a><span class="lineno"> 1421</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#a47857055118a703ae87ea5ebaf4842ed">ao2_callback</a>(cache-&gt;<a class="code" href="../../d2/d6b/structsorcery__memory__cache.html#aa0a84e33972901716d6d5a6dcf1a68de">objects</a>, 0, <a class="code" href="../../d7/d30/res__sorcery__memory__cache_8c.html#a56cee8e124bf2766c1e1d71ccfb464cd">sorcery_memory_cache_fields_cmp</a>, &amp;params);</div><div class="line"><a name="l01422"></a><span class="lineno"> 1422</span>&#160;</div><div class="line"><a name="l01423"></a><span class="lineno"> 1423</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d5/da5/astobj2_8h.html#a512cc40ce96c63b3d5c78040baa4c9cd">ao2_container_count</a>(objects)) {</div><div class="line"><a name="l01424"></a><span class="lineno"> 1424</span>&#160;      <a class="code" href="../../d7/d30/res__sorcery__memory__cache_8c.html#ac2710be96da7280183f8b711e01dc81b">memory_cache_stale_check</a>(sorcery, cache);</div><div class="line"><a name="l01425"></a><span class="lineno"> 1425</span>&#160;   }</div><div class="line"><a name="l01426"></a><span class="lineno"> 1426</span>&#160;}</div><div class="line"><a name="l01427"></a><span class="lineno"> 1427</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01428"></a><span class="lineno"> 1428</span>&#160;<span class="comment">/*!</span></div><div class="line"><a name="l01429"></a><span class="lineno"> 1429</span>&#160;<span class="comment"> * \internal</span></div><div class="line"><a name="l01430"></a><span class="lineno"> 1430</span>&#160;<span class="comment"> * \brief Callback function to finish configuring the memory cache</span></div><div class="line"><a name="l01431"></a><span class="lineno"> 1431</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l01432"></a><span class="lineno"> 1432</span>&#160;<span class="comment"> * \param data The sorcery memory cache</span></div><div class="line"><a name="l01433"></a><span class="lineno"> 1433</span>&#160;<span class="comment"> * \param sorcery The sorcery instance</span></div><div class="line"><a name="l01434"></a><span class="lineno"> 1434</span>&#160;<span class="comment"> * \param type The type of object being loaded</span></div><div class="line"><a name="l01435"></a><span class="lineno"> 1435</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l01436"></a><span class="lineno"><a class="line" href="../../d7/d30/res__sorcery__memory__cache_8c.html#a71fbafef4114d205d0efb067d84f47f1"> 1436</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d7/d30/res__sorcery__memory__cache_8c.html#a71fbafef4114d205d0efb067d84f47f1">sorcery_memory_cache_load</a>(<span class="keywordtype">void</span> *data, <span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="../../d2/d88/structast__sorcery.html">ast_sorcery</a> *<a class="code" href="../../d2/d6b/structsorcery__memory__cache.html#aeb33dcb5573e1661c82b5370681fb626">sorcery</a>, <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="../../d7/d49/chan__ooh323_8c.html#a4d63fdfe5451ec2248c16a2739190c56">type</a>)</div><div class="line"><a name="l01437"></a><span class="lineno"> 1437</span>&#160;{</div><div class="line"><a name="l01438"></a><span class="lineno"> 1438</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d2/d6b/structsorcery__memory__cache.html">sorcery_memory_cache</a> *cache = data;</div><div class="line"><a name="l01439"></a><span class="lineno"> 1439</span>&#160;</div><div class="line"><a name="l01440"></a><span class="lineno"> 1440</span>&#160;   <span class="comment">/* If no name was explicitly specified generate one given the sorcery instance and object type */</span></div><div class="line"><a name="l01441"></a><span class="lineno"> 1441</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a>(cache-&gt;<a class="code" href="../../d2/d6b/structsorcery__memory__cache.html#a5ac083a645d964373f022d03df4849c8">name</a>)) {</div><div class="line"><a name="l01442"></a><span class="lineno"> 1442</span>&#160;      <a class="code" href="../../d8/d8a/astmm_8h.html#ada667b6f84a08e6848cb37c5ffb94a5f">ast_asprintf</a>(&amp;cache-&gt;<a class="code" href="../../d2/d6b/structsorcery__memory__cache.html#a5ac083a645d964373f022d03df4849c8">name</a>, <span class="stringliteral">&quot;%s/%s&quot;</span>, <a class="code" href="../../d8/d25/sorcery_8h.html#a4aa06205a33d1fa168299de936451415">ast_sorcery_get_module</a>(sorcery), type);</div><div class="line"><a name="l01443"></a><span class="lineno"> 1443</span>&#160;   }</div><div class="line"><a name="l01444"></a><span class="lineno"> 1444</span>&#160;</div><div class="line"><a name="l01445"></a><span class="lineno"> 1445</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#a1ad9f122bcae95a470639402faa3d2ee">ao2_link</a>(caches, cache);</div><div class="line"><a name="l01446"></a><span class="lineno"> 1446</span>&#160;   <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(1, <span class="stringliteral">&quot;Memory cache &#39;%s&#39; associated with sorcery instance &#39;%p&#39; of module &#39;%s&#39; with object type &#39;%s&#39;\n&quot;</span>,</div><div class="line"><a name="l01447"></a><span class="lineno"> 1447</span>&#160;      cache-&gt;<a class="code" href="../../d2/d6b/structsorcery__memory__cache.html#a5ac083a645d964373f022d03df4849c8">name</a>, sorcery, <a class="code" href="../../d8/d25/sorcery_8h.html#a4aa06205a33d1fa168299de936451415">ast_sorcery_get_module</a>(sorcery), type);</div><div class="line"><a name="l01448"></a><span class="lineno"> 1448</span>&#160;</div><div class="line"><a name="l01449"></a><span class="lineno"> 1449</span>&#160;   cache-&gt;<a class="code" href="../../d2/d6b/structsorcery__memory__cache.html#aeb33dcb5573e1661c82b5370681fb626">sorcery</a> = <a class="code" href="../../d2/d6b/structsorcery__memory__cache.html#aeb33dcb5573e1661c82b5370681fb626">sorcery</a>;</div><div class="line"><a name="l01450"></a><span class="lineno"> 1450</span>&#160;   cache-&gt;<a class="code" href="../../d2/d6b/structsorcery__memory__cache.html#aaa0b4796a46428e565991525a543f4f0">object_type</a> = <a class="code" href="../../d8/d8a/astmm_8h.html#ab263849d03fb892847be4986db759737">ast_strdup</a>(type);</div><div class="line"><a name="l01451"></a><span class="lineno"> 1451</span>&#160;}</div><div class="line"><a name="l01452"></a><span class="lineno"> 1452</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01453"></a><span class="lineno"> 1453</span>&#160;<span class="comment">/*!</span></div><div class="line"><a name="l01454"></a><span class="lineno"> 1454</span>&#160;<span class="comment"> * \internal</span></div><div class="line"><a name="l01455"></a><span class="lineno"> 1455</span>&#160;<span class="comment"> * \brief Callback function to expire objects from the memory cache on reload (if configured)</span></div><div class="line"><a name="l01456"></a><span class="lineno"> 1456</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l01457"></a><span class="lineno"> 1457</span>&#160;<span class="comment"> * \param data The sorcery memory cache</span></div><div class="line"><a name="l01458"></a><span class="lineno"> 1458</span>&#160;<span class="comment"> * \param sorcery The sorcery instance</span></div><div class="line"><a name="l01459"></a><span class="lineno"> 1459</span>&#160;<span class="comment"> * \param type The type of object being reloaded</span></div><div class="line"><a name="l01460"></a><span class="lineno"> 1460</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l01461"></a><span class="lineno"><a class="line" href="../../d7/d30/res__sorcery__memory__cache_8c.html#a6e5cc056cb8ed0f3ff6c59a498b8f974"> 1461</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d7/d30/res__sorcery__memory__cache_8c.html#a6e5cc056cb8ed0f3ff6c59a498b8f974">sorcery_memory_cache_reload</a>(<span class="keywordtype">void</span> *data, <span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="../../d2/d88/structast__sorcery.html">ast_sorcery</a> *<a class="code" href="../../d2/d6b/structsorcery__memory__cache.html#aeb33dcb5573e1661c82b5370681fb626">sorcery</a>, <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="../../d7/d49/chan__ooh323_8c.html#a4d63fdfe5451ec2248c16a2739190c56">type</a>)</div><div class="line"><a name="l01462"></a><span class="lineno"> 1462</span>&#160;{</div><div class="line"><a name="l01463"></a><span class="lineno"> 1463</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d2/d6b/structsorcery__memory__cache.html">sorcery_memory_cache</a> *cache = data;</div><div class="line"><a name="l01464"></a><span class="lineno"> 1464</span>&#160;</div><div class="line"><a name="l01465"></a><span class="lineno"> 1465</span>&#160;   <span class="keywordflow">if</span> (!cache-&gt;<a class="code" href="../../d2/d6b/structsorcery__memory__cache.html#a7e8d8ec709f7bce006b45892fa15fdb7">expire_on_reload</a>) {</div><div class="line"><a name="l01466"></a><span class="lineno"> 1466</span>&#160;      <span class="keywordflow">return</span>;</div><div class="line"><a name="l01467"></a><span class="lineno"> 1467</span>&#160;   }</div><div class="line"><a name="l01468"></a><span class="lineno"> 1468</span>&#160;</div><div class="line"><a name="l01469"></a><span class="lineno"> 1469</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#a3498e30d6154a052e7b64b7a96da8b4b">ao2_wrlock</a>(cache-&gt;<a class="code" href="../../d2/d6b/structsorcery__memory__cache.html#aa0a84e33972901716d6d5a6dcf1a68de">objects</a>);</div><div class="line"><a name="l01470"></a><span class="lineno"> 1470</span>&#160;   <a class="code" href="../../d7/d30/res__sorcery__memory__cache_8c.html#ab6ca326a1f05631b3e363a4302069c93">remove_all_from_cache</a>(cache);</div><div class="line"><a name="l01471"></a><span class="lineno"> 1471</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#a9998bd156b936636a8780385e9a910b2">ao2_unlock</a>(cache-&gt;<a class="code" href="../../d2/d6b/structsorcery__memory__cache.html#aa0a84e33972901716d6d5a6dcf1a68de">objects</a>);</div><div class="line"><a name="l01472"></a><span class="lineno"> 1472</span>&#160;}</div><div class="line"><a name="l01473"></a><span class="lineno"> 1473</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01474"></a><span class="lineno"> 1474</span>&#160;<span class="comment">/*!</span></div><div class="line"><a name="l01475"></a><span class="lineno"> 1475</span>&#160;<span class="comment"> * \internal</span></div><div class="line"><a name="l01476"></a><span class="lineno"> 1476</span>&#160;<span class="comment"> * \brief Function used to take an unsigned integer based configuration option and parse it</span></div><div class="line"><a name="l01477"></a><span class="lineno"> 1477</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l01478"></a><span class="lineno"> 1478</span>&#160;<span class="comment"> * \param value The string value of the configuration option</span></div><div class="line"><a name="l01479"></a><span class="lineno"> 1479</span>&#160;<span class="comment"> * \param result The unsigned integer to place the result in</span></div><div class="line"><a name="l01480"></a><span class="lineno"> 1480</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l01481"></a><span class="lineno"> 1481</span>&#160;<span class="comment"> * \retval 0 failure</span></div><div class="line"><a name="l01482"></a><span class="lineno"> 1482</span>&#160;<span class="comment"> * \retval 1 success</span></div><div class="line"><a name="l01483"></a><span class="lineno"> 1483</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l01484"></a><span class="lineno"><a class="line" href="../../d7/d30/res__sorcery__memory__cache_8c.html#a2cb830e802d44a2cf4eb386aaca36db3"> 1484</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d7/d30/res__sorcery__memory__cache_8c.html#a2cb830e802d44a2cf4eb386aaca36db3">configuration_parse_unsigned_integer</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="../../d4/d2f/syslog_8c.html#ac4f474c82e82cbb89ca7c36dd52be0ed">value</a>, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> *<a class="code" href="../../de/d1b/cel__pgsql_8c.html#ad6c487210772a9b4b0ca04b04b847d4c">result</a>)</div><div class="line"><a name="l01485"></a><span class="lineno"> 1485</span>&#160;{</div><div class="line"><a name="l01486"></a><span class="lineno"> 1486</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a>(value) || !strncmp(value, <span class="stringliteral">&quot;-&quot;</span>, 1)) {</div><div class="line"><a name="l01487"></a><span class="lineno"> 1487</span>&#160;      <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l01488"></a><span class="lineno"> 1488</span>&#160;   }</div><div class="line"><a name="l01489"></a><span class="lineno"> 1489</span>&#160;</div><div class="line"><a name="l01490"></a><span class="lineno"> 1490</span>&#160;   <span class="keywordflow">return</span> sscanf(value, <span class="stringliteral">&quot;%30u&quot;</span>, result);</div><div class="line"><a name="l01491"></a><span class="lineno"> 1491</span>&#160;}</div><div class="line"><a name="l01492"></a><span class="lineno"> 1492</span>&#160;</div><div class="line"><a name="l01493"></a><span class="lineno"><a class="line" href="../../d7/d30/res__sorcery__memory__cache_8c.html#a93a10f716c3fc5f0aa7ff0f843e03aca"> 1493</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d7/d30/res__sorcery__memory__cache_8c.html#a93a10f716c3fc5f0aa7ff0f843e03aca">age_cmp</a>(<span class="keywordtype">void</span> *<a class="code" href="../../d7/d6f/test__linkedlists_8c.html#a13dd15487fee89a002d17ef3aff62d02">a</a>, <span class="keywordtype">void</span> *<a class="code" href="../../d7/d6f/test__linkedlists_8c.html#a025ede890af287961d3a98d0e634a62b">b</a>)</div><div class="line"><a name="l01494"></a><span class="lineno"> 1494</span>&#160;{</div><div class="line"><a name="l01495"></a><span class="lineno"> 1495</span>&#160;   <span class="keywordflow">return</span> <a class="code" href="../../de/df7/time_8h.html#a6daa33e2052acd094bb63e78aba29733">ast_tvcmp</a>(((<span class="keyword">struct</span> <a class="code" href="../../df/d93/structsorcery__memory__cached__object.html">sorcery_memory_cached_object</a> *) b)-&gt;created,</div><div class="line"><a name="l01496"></a><span class="lineno"> 1496</span>&#160;         ((<span class="keyword">struct</span> <a class="code" href="../../df/d93/structsorcery__memory__cached__object.html">sorcery_memory_cached_object</a> *) a)-&gt;created);</div><div class="line"><a name="l01497"></a><span class="lineno"> 1497</span>&#160;}</div><div class="line"><a name="l01498"></a><span class="lineno"> 1498</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01499"></a><span class="lineno"> 1499</span>&#160;<span class="comment">/*!</span></div><div class="line"><a name="l01500"></a><span class="lineno"> 1500</span>&#160;<span class="comment"> * \internal</span></div><div class="line"><a name="l01501"></a><span class="lineno"> 1501</span>&#160;<span class="comment"> * \brief Callback function to create a new sorcery memory cache using provided configuration</span></div><div class="line"><a name="l01502"></a><span class="lineno"> 1502</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l01503"></a><span class="lineno"> 1503</span>&#160;<span class="comment"> * \param data A stringified configuration for the memory cache</span></div><div class="line"><a name="l01504"></a><span class="lineno"> 1504</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l01505"></a><span class="lineno"> 1505</span>&#160;<span class="comment"> * \retval non-NULL success</span></div><div class="line"><a name="l01506"></a><span class="lineno"> 1506</span>&#160;<span class="comment"> * \retval NULL failure</span></div><div class="line"><a name="l01507"></a><span class="lineno"> 1507</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l01508"></a><span class="lineno"><a class="line" href="../../d7/d30/res__sorcery__memory__cache_8c.html#a73c11b5eb7314f2dbd3f32d18b69b10f"> 1508</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> *<a class="code" href="../../d7/d30/res__sorcery__memory__cache_8c.html#a73c11b5eb7314f2dbd3f32d18b69b10f">sorcery_memory_cache_open</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *data)</div><div class="line"><a name="l01509"></a><span class="lineno"> 1509</span>&#160;{</div><div class="line"><a name="l01510"></a><span class="lineno"> 1510</span>&#160;   <span class="keywordtype">char</span> *<a class="code" href="../../d4/d45/test__http__media__cache_8c.html#a80c8e3ae5087d90d422675d034eeebc7">options</a> = <a class="code" href="../../d8/d8a/astmm_8h.html#ab263849d03fb892847be4986db759737">ast_strdup</a>(data), *option;</div><div class="line"><a name="l01511"></a><span class="lineno"> 1511</span>&#160;   <a class="code" href="../../d5/d60/utils_8h.html#a1604b4d72144dd3d9f7da668e90337e9">RAII_VAR</a>(<span class="keyword">struct</span> <a class="code" href="../../d2/d6b/structsorcery__memory__cache.html">sorcery_memory_cache</a> *, cache, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../d5/da5/astobj2_8h.html#a6321ee982370c55ab3c24c72c562cbdd">ao2_cleanup</a>);</div><div class="line"><a name="l01512"></a><span class="lineno"> 1512</span>&#160;</div><div class="line"><a name="l01513"></a><span class="lineno"> 1513</span>&#160;   cache = <a class="code" href="../../d5/da5/astobj2_8h.html#ab3c44e28d661616129b7819069effe61">ao2_alloc_options</a>(<span class="keyword">sizeof</span>(*cache), <a class="code" href="../../d7/d30/res__sorcery__memory__cache_8c.html#a3af131f13cb4426b2bce7a8b077849bb">sorcery_memory_cache_destructor</a>, <a class="code" href="../../d5/da5/astobj2_8h.html#a2cf7e3433f08351aafe3b0cd31edf7f8a23b60f2636bcfbc4dfeea6cc21bf847b">AO2_ALLOC_OPT_LOCK_NOLOCK</a>);</div><div class="line"><a name="l01514"></a><span class="lineno"> 1514</span>&#160;   <span class="keywordflow">if</span> (!cache) {</div><div class="line"><a name="l01515"></a><span class="lineno"> 1515</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l01516"></a><span class="lineno"> 1516</span>&#160;   }</div><div class="line"><a name="l01517"></a><span class="lineno"> 1517</span>&#160;</div><div class="line"><a name="l01518"></a><span class="lineno"> 1518</span>&#160;   cache-&gt;<a class="code" href="../../d2/d6b/structsorcery__memory__cache.html#ad6bc34b0274c32a28f0b0803da66ee9e">expire_id</a> = -1;</div><div class="line"><a name="l01519"></a><span class="lineno"> 1519</span>&#160;   cache-&gt;<a class="code" href="../../d2/d6b/structsorcery__memory__cache.html#a59a79dcdae51e4000f776c4c48b8c7d1">stale_update_sched_id</a> = -1;</div><div class="line"><a name="l01520"></a><span class="lineno"> 1520</span>&#160;</div><div class="line"><a name="l01521"></a><span class="lineno"> 1521</span>&#160;   <span class="comment">/* If no configuration options have been provided this memory cache will operate in a default</span></div><div class="line"><a name="l01522"></a><span class="lineno"> 1522</span>&#160;<span class="comment">    * configuration.</span></div><div class="line"><a name="l01523"></a><span class="lineno"> 1523</span>&#160;<span class="comment">    */</span></div><div class="line"><a name="l01524"></a><span class="lineno"> 1524</span>&#160;   <span class="keywordflow">while</span> (!<a class="code" href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a>(options) &amp;&amp; (option = <a class="code" href="../../de/da3/include_2asterisk_2compat_8h.html#a40eca58273c74a20a17f137d18ba826c">strsep</a>(&amp;options, <span class="stringliteral">&quot;,&quot;</span>))) {</div><div class="line"><a name="l01525"></a><span class="lineno"> 1525</span>&#160;      <span class="keywordtype">char</span> *<a class="code" href="../../d2/d6b/structsorcery__memory__cache.html#a5ac083a645d964373f022d03df4849c8">name</a> = <a class="code" href="../../de/da3/include_2asterisk_2compat_8h.html#a40eca58273c74a20a17f137d18ba826c">strsep</a>(&amp;option, <span class="stringliteral">&quot;=&quot;</span>), *<a class="code" href="../../d4/d2f/syslog_8c.html#ac4f474c82e82cbb89ca7c36dd52be0ed">value</a> = option;</div><div class="line"><a name="l01526"></a><span class="lineno"> 1526</span>&#160;</div><div class="line"><a name="l01527"></a><span class="lineno"> 1527</span>&#160;      <span class="keywordflow">if</span> (!strcasecmp(name, <span class="stringliteral">&quot;name&quot;</span>)) {</div><div class="line"><a name="l01528"></a><span class="lineno"> 1528</span>&#160;         <span class="keywordflow">if</span> (<a class="code" href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a>(<a class="code" href="../../d4/d2f/syslog_8c.html#ac4f474c82e82cbb89ca7c36dd52be0ed">value</a>)) {</div><div class="line"><a name="l01529"></a><span class="lineno"> 1529</span>&#160;            <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;A name must be specified for the memory cache\n&quot;</span>);</div><div class="line"><a name="l01530"></a><span class="lineno"> 1530</span>&#160;            <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l01531"></a><span class="lineno"> 1531</span>&#160;         }</div><div class="line"><a name="l01532"></a><span class="lineno"> 1532</span>&#160;         <a class="code" href="../../d8/d8a/astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(cache-&gt;<a class="code" href="../../d2/d6b/structsorcery__memory__cache.html#a5ac083a645d964373f022d03df4849c8">name</a>);</div><div class="line"><a name="l01533"></a><span class="lineno"> 1533</span>&#160;         cache-&gt;<a class="code" href="../../d2/d6b/structsorcery__memory__cache.html#a5ac083a645d964373f022d03df4849c8">name</a> = <a class="code" href="../../d8/d8a/astmm_8h.html#ab263849d03fb892847be4986db759737">ast_strdup</a>(<a class="code" href="../../d4/d2f/syslog_8c.html#ac4f474c82e82cbb89ca7c36dd52be0ed">value</a>);</div><div class="line"><a name="l01534"></a><span class="lineno"> 1534</span>&#160;      } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(name, <span class="stringliteral">&quot;maximum_objects&quot;</span>)) {</div><div class="line"><a name="l01535"></a><span class="lineno"> 1535</span>&#160;         <span class="keywordflow">if</span> (<a class="code" href="../../d7/d30/res__sorcery__memory__cache_8c.html#a2cb830e802d44a2cf4eb386aaca36db3">configuration_parse_unsigned_integer</a>(<a class="code" href="../../d4/d2f/syslog_8c.html#ac4f474c82e82cbb89ca7c36dd52be0ed">value</a>, &amp;cache-&gt;<a class="code" href="../../d2/d6b/structsorcery__memory__cache.html#a73ce7cbebacf7170f054f846300d67ff">maximum_objects</a>) != 1) {</div><div class="line"><a name="l01536"></a><span class="lineno"> 1536</span>&#160;            <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Unsupported maximum objects value of &#39;%s&#39; used for memory cache\n&quot;</span>,</div><div class="line"><a name="l01537"></a><span class="lineno"> 1537</span>&#160;               <a class="code" href="../../d4/d2f/syslog_8c.html#ac4f474c82e82cbb89ca7c36dd52be0ed">value</a>);</div><div class="line"><a name="l01538"></a><span class="lineno"> 1538</span>&#160;            <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l01539"></a><span class="lineno"> 1539</span>&#160;         }</div><div class="line"><a name="l01540"></a><span class="lineno"> 1540</span>&#160;      } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(name, <span class="stringliteral">&quot;object_lifetime_maximum&quot;</span>)) {</div><div class="line"><a name="l01541"></a><span class="lineno"> 1541</span>&#160;         <span class="keywordflow">if</span> (<a class="code" href="../../d7/d30/res__sorcery__memory__cache_8c.html#a2cb830e802d44a2cf4eb386aaca36db3">configuration_parse_unsigned_integer</a>(<a class="code" href="../../d4/d2f/syslog_8c.html#ac4f474c82e82cbb89ca7c36dd52be0ed">value</a>, &amp;cache-&gt;<a class="code" href="../../d2/d6b/structsorcery__memory__cache.html#a890cd2c933f495837f720efe44aa9642">object_lifetime_maximum</a>) != 1) {</div><div class="line"><a name="l01542"></a><span class="lineno"> 1542</span>&#160;            <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Unsupported object maximum lifetime value of &#39;%s&#39; used for memory cache\n&quot;</span>,</div><div class="line"><a name="l01543"></a><span class="lineno"> 1543</span>&#160;               <a class="code" href="../../d4/d2f/syslog_8c.html#ac4f474c82e82cbb89ca7c36dd52be0ed">value</a>);</div><div class="line"><a name="l01544"></a><span class="lineno"> 1544</span>&#160;            <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l01545"></a><span class="lineno"> 1545</span>&#160;         }</div><div class="line"><a name="l01546"></a><span class="lineno"> 1546</span>&#160;      } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(name, <span class="stringliteral">&quot;object_lifetime_stale&quot;</span>)) {</div><div class="line"><a name="l01547"></a><span class="lineno"> 1547</span>&#160;         <span class="keywordflow">if</span> (<a class="code" href="../../d7/d30/res__sorcery__memory__cache_8c.html#a2cb830e802d44a2cf4eb386aaca36db3">configuration_parse_unsigned_integer</a>(<a class="code" href="../../d4/d2f/syslog_8c.html#ac4f474c82e82cbb89ca7c36dd52be0ed">value</a>, &amp;cache-&gt;<a class="code" href="../../d2/d6b/structsorcery__memory__cache.html#a89b193072cd806e8e239c9a448463efe">object_lifetime_stale</a>) != 1) {</div><div class="line"><a name="l01548"></a><span class="lineno"> 1548</span>&#160;            <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Unsupported object stale lifetime value of &#39;%s&#39; used for memory cache\n&quot;</span>,</div><div class="line"><a name="l01549"></a><span class="lineno"> 1549</span>&#160;               <a class="code" href="../../d4/d2f/syslog_8c.html#ac4f474c82e82cbb89ca7c36dd52be0ed">value</a>);</div><div class="line"><a name="l01550"></a><span class="lineno"> 1550</span>&#160;            <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l01551"></a><span class="lineno"> 1551</span>&#160;         }</div><div class="line"><a name="l01552"></a><span class="lineno"> 1552</span>&#160;      } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(name, <span class="stringliteral">&quot;expire_on_reload&quot;</span>)) {</div><div class="line"><a name="l01553"></a><span class="lineno"> 1553</span>&#160;         cache-&gt;<a class="code" href="../../d2/d6b/structsorcery__memory__cache.html#a7e8d8ec709f7bce006b45892fa15fdb7">expire_on_reload</a> = <a class="code" href="../../d6/d90/strings_8h.html#a387a69b3871ca31061566a73f45d20f4">ast_true</a>(<a class="code" href="../../d4/d2f/syslog_8c.html#ac4f474c82e82cbb89ca7c36dd52be0ed">value</a>);</div><div class="line"><a name="l01554"></a><span class="lineno"> 1554</span>&#160;      } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(name, <span class="stringliteral">&quot;full_backend_cache&quot;</span>)) {</div><div class="line"><a name="l01555"></a><span class="lineno"> 1555</span>&#160;         cache-&gt;<a class="code" href="../../d2/d6b/structsorcery__memory__cache.html#acbaed991b7fd3a4fd5661a99cb304d56">full_backend_cache</a> = <a class="code" href="../../d6/d90/strings_8h.html#a387a69b3871ca31061566a73f45d20f4">ast_true</a>(<a class="code" href="../../d4/d2f/syslog_8c.html#ac4f474c82e82cbb89ca7c36dd52be0ed">value</a>);</div><div class="line"><a name="l01556"></a><span class="lineno"> 1556</span>&#160;      } <span class="keywordflow">else</span> {</div><div class="line"><a name="l01557"></a><span class="lineno"> 1557</span>&#160;         <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Unsupported option &#39;%s&#39; used for memory cache\n&quot;</span>, name);</div><div class="line"><a name="l01558"></a><span class="lineno"> 1558</span>&#160;         <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l01559"></a><span class="lineno"> 1559</span>&#160;      }</div><div class="line"><a name="l01560"></a><span class="lineno"> 1560</span>&#160;   }</div><div class="line"><a name="l01561"></a><span class="lineno"> 1561</span>&#160;</div><div class="line"><a name="l01562"></a><span class="lineno"> 1562</span>&#160;   cache-&gt;<a class="code" href="../../d2/d6b/structsorcery__memory__cache.html#aa0a84e33972901716d6d5a6dcf1a68de">objects</a> = <a class="code" href="../../d5/da5/astobj2_8h.html#aefc16f8aa9087cbc5c55c70cf1dd41b2">ao2_container_alloc_hash</a>(<a class="code" href="../../d5/da5/astobj2_8h.html#a2cf7e3433f08351aafe3b0cd31edf7f8a7016a58d1b7524c186ccc72ec48ef488">AO2_ALLOC_OPT_LOCK_RWLOCK</a>, 0,</div><div class="line"><a name="l01563"></a><span class="lineno"> 1563</span>&#160;      cache-&gt;<a class="code" href="../../d2/d6b/structsorcery__memory__cache.html#a73ce7cbebacf7170f054f846300d67ff">maximum_objects</a> ? cache-&gt;<a class="code" href="../../d2/d6b/structsorcery__memory__cache.html#a73ce7cbebacf7170f054f846300d67ff">maximum_objects</a> : <a class="code" href="../../d7/d30/res__sorcery__memory__cache_8c.html#a940b3f80c54615cf9a05eec2f99fdf96">CACHE_CONTAINER_BUCKET_SIZE</a>,</div><div class="line"><a name="l01564"></a><span class="lineno"> 1564</span>&#160;      <a class="code" href="../../d7/d30/res__sorcery__memory__cache_8c.html#a9e6ba05ab24228b88fabe3520c2055e9">sorcery_memory_cached_object_hash</a>, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../d7/d30/res__sorcery__memory__cache_8c.html#a3a2529b2a452b7589da51c1ad620ffe5">sorcery_memory_cached_object_cmp</a>);</div><div class="line"><a name="l01565"></a><span class="lineno"> 1565</span>&#160;   <span class="keywordflow">if</span> (!cache-&gt;<a class="code" href="../../d2/d6b/structsorcery__memory__cache.html#aa0a84e33972901716d6d5a6dcf1a68de">objects</a>) {</div><div class="line"><a name="l01566"></a><span class="lineno"> 1566</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Could not create a container to hold cached objects for memory cache\n&quot;</span>);</div><div class="line"><a name="l01567"></a><span class="lineno"> 1567</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l01568"></a><span class="lineno"> 1568</span>&#160;   }</div><div class="line"><a name="l01569"></a><span class="lineno"> 1569</span>&#160;</div><div class="line"><a name="l01570"></a><span class="lineno"> 1570</span>&#160;   cache-&gt;<a class="code" href="../../d2/d6b/structsorcery__memory__cache.html#ac2c70d25e5f4a7ef4384b344d4f411ce">object_heap</a> = <a class="code" href="../../da/ddb/heap_8h.html#a42b42e04887dbc86276e590141147f63">ast_heap_create</a>(<a class="code" href="../../d7/d30/res__sorcery__memory__cache_8c.html#a43170aa76d29a3c41a32e557acf6c0b1">CACHE_HEAP_INIT_HEIGHT</a>, <a class="code" href="../../d7/d30/res__sorcery__memory__cache_8c.html#a93a10f716c3fc5f0aa7ff0f843e03aca">age_cmp</a>,</div><div class="line"><a name="l01571"></a><span class="lineno"> 1571</span>&#160;      offsetof(<span class="keyword">struct</span> <a class="code" href="../../df/d93/structsorcery__memory__cached__object.html">sorcery_memory_cached_object</a>, __heap_index));</div><div class="line"><a name="l01572"></a><span class="lineno"> 1572</span>&#160;   <span class="keywordflow">if</span> (!cache-&gt;<a class="code" href="../../d2/d6b/structsorcery__memory__cache.html#ac2c70d25e5f4a7ef4384b344d4f411ce">object_heap</a>) {</div><div class="line"><a name="l01573"></a><span class="lineno"> 1573</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Could not create heap to hold cached objects\n&quot;</span>);</div><div class="line"><a name="l01574"></a><span class="lineno"> 1574</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l01575"></a><span class="lineno"> 1575</span>&#160;   }</div><div class="line"><a name="l01576"></a><span class="lineno"> 1576</span>&#160;</div><div class="line"><a name="l01577"></a><span class="lineno"> 1577</span>&#160;   <span class="comment">/* The memory cache is not linked to the caches container until the load callback is invoked.</span></div><div class="line"><a name="l01578"></a><span class="lineno"> 1578</span>&#160;<span class="comment">    * Linking occurs there so an intelligent cache name can be constructed using the module of</span></div><div class="line"><a name="l01579"></a><span class="lineno"> 1579</span>&#160;<span class="comment">    * the sorcery instance and the specific object type if no cache name was specified as part</span></div><div class="line"><a name="l01580"></a><span class="lineno"> 1580</span>&#160;<span class="comment">    * of the configuration.</span></div><div class="line"><a name="l01581"></a><span class="lineno"> 1581</span>&#160;<span class="comment">    */</span></div><div class="line"><a name="l01582"></a><span class="lineno"> 1582</span>&#160;</div><div class="line"><a name="l01583"></a><span class="lineno"> 1583</span>&#160;   <span class="comment">/* This is done as RAII_VAR will drop the reference */</span></div><div class="line"><a name="l01584"></a><span class="lineno"> 1584</span>&#160;   <span class="keywordflow">return</span> <a class="code" href="../../d5/da5/astobj2_8h.html#ac438c3fcd3150481fad38689fd813a15">ao2_bump</a>(cache);</div><div class="line"><a name="l01585"></a><span class="lineno"> 1585</span>&#160;}</div><div class="line"><a name="l01586"></a><span class="lineno"> 1586</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01587"></a><span class="lineno"> 1587</span>&#160;<span class="comment">/*!</span></div><div class="line"><a name="l01588"></a><span class="lineno"> 1588</span>&#160;<span class="comment"> * \internal</span></div><div class="line"><a name="l01589"></a><span class="lineno"> 1589</span>&#160;<span class="comment"> * \brief Callback function to delete an object from a memory cache</span></div><div class="line"><a name="l01590"></a><span class="lineno"> 1590</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l01591"></a><span class="lineno"> 1591</span>&#160;<span class="comment"> * \param sorcery The sorcery instance</span></div><div class="line"><a name="l01592"></a><span class="lineno"> 1592</span>&#160;<span class="comment"> * \param data The sorcery memory cache</span></div><div class="line"><a name="l01593"></a><span class="lineno"> 1593</span>&#160;<span class="comment"> * \param object The object to cache</span></div><div class="line"><a name="l01594"></a><span class="lineno"> 1594</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l01595"></a><span class="lineno"> 1595</span>&#160;<span class="comment"> * \retval 0 success</span></div><div class="line"><a name="l01596"></a><span class="lineno"> 1596</span>&#160;<span class="comment"> * \retval -1 failure</span></div><div class="line"><a name="l01597"></a><span class="lineno"> 1597</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l01598"></a><span class="lineno"><a class="line" href="../../d7/d30/res__sorcery__memory__cache_8c.html#a8be072ec91ebdbdbb1153b0a5b03a452"> 1598</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d7/d30/res__sorcery__memory__cache_8c.html#a8be072ec91ebdbdbb1153b0a5b03a452">sorcery_memory_cache_delete</a>(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="../../d2/d88/structast__sorcery.html">ast_sorcery</a> *<a class="code" href="../../d2/d6b/structsorcery__memory__cache.html#aeb33dcb5573e1661c82b5370681fb626">sorcery</a>, <span class="keywordtype">void</span> *data, <span class="keywordtype">void</span> *<span class="keywordtype">object</span>)</div><div class="line"><a name="l01599"></a><span class="lineno"> 1599</span>&#160;{</div><div class="line"><a name="l01600"></a><span class="lineno"> 1600</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d2/d6b/structsorcery__memory__cache.html">sorcery_memory_cache</a> *cache = data;</div><div class="line"><a name="l01601"></a><span class="lineno"> 1601</span>&#160;   <span class="keywordtype">int</span> res;</div><div class="line"><a name="l01602"></a><span class="lineno"> 1602</span>&#160;</div><div class="line"><a name="l01603"></a><span class="lineno"> 1603</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#a3498e30d6154a052e7b64b7a96da8b4b">ao2_wrlock</a>(cache-&gt;<a class="code" href="../../d2/d6b/structsorcery__memory__cache.html#aa0a84e33972901716d6d5a6dcf1a68de">objects</a>);</div><div class="line"><a name="l01604"></a><span class="lineno"> 1604</span>&#160;   res = <a class="code" href="../../d7/d30/res__sorcery__memory__cache_8c.html#a6046abe86f78c86c1140084831686a25">remove_from_cache</a>(cache, <a class="code" href="../../d8/d25/sorcery_8h.html#a97706283a06cbb44e4f0f9620dd5cf07">ast_sorcery_object_get_id</a>(<span class="keywordtype">object</span>), 1);</div><div class="line"><a name="l01605"></a><span class="lineno"> 1605</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#a9998bd156b936636a8780385e9a910b2">ao2_unlock</a>(cache-&gt;<a class="code" href="../../d2/d6b/structsorcery__memory__cache.html#aa0a84e33972901716d6d5a6dcf1a68de">objects</a>);</div><div class="line"><a name="l01606"></a><span class="lineno"> 1606</span>&#160;</div><div class="line"><a name="l01607"></a><span class="lineno"> 1607</span>&#160;   <span class="keywordflow">if</span> (res) {</div><div class="line"><a name="l01608"></a><span class="lineno"> 1608</span>&#160;      <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(1, <span class="stringliteral">&quot;Unable to delete object &#39;%s&#39; from sorcery cache\n&quot;</span>, <a class="code" href="../../d8/d25/sorcery_8h.html#a97706283a06cbb44e4f0f9620dd5cf07">ast_sorcery_object_get_id</a>(<span class="keywordtype">object</span>));</div><div class="line"><a name="l01609"></a><span class="lineno"> 1609</span>&#160;   }</div><div class="line"><a name="l01610"></a><span class="lineno"> 1610</span>&#160;</div><div class="line"><a name="l01611"></a><span class="lineno"> 1611</span>&#160;   <span class="keywordflow">return</span> res;</div><div class="line"><a name="l01612"></a><span class="lineno"> 1612</span>&#160;}</div><div class="line"><a name="l01613"></a><span class="lineno"> 1613</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01614"></a><span class="lineno"> 1614</span>&#160;<span class="comment">/*!</span></div><div class="line"><a name="l01615"></a><span class="lineno"> 1615</span>&#160;<span class="comment"> * \internal</span></div><div class="line"><a name="l01616"></a><span class="lineno"> 1616</span>&#160;<span class="comment"> * \brief Callback function to terminate a memory cache</span></div><div class="line"><a name="l01617"></a><span class="lineno"> 1617</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l01618"></a><span class="lineno"> 1618</span>&#160;<span class="comment"> * \param data The sorcery memory cache</span></div><div class="line"><a name="l01619"></a><span class="lineno"> 1619</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l01620"></a><span class="lineno"><a class="line" href="../../d7/d30/res__sorcery__memory__cache_8c.html#a9f6a8b7453ee946fb55fac3b0237f514"> 1620</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d7/d30/res__sorcery__memory__cache_8c.html#a9f6a8b7453ee946fb55fac3b0237f514">sorcery_memory_cache_close</a>(<span class="keywordtype">void</span> *data)</div><div class="line"><a name="l01621"></a><span class="lineno"> 1621</span>&#160;{</div><div class="line"><a name="l01622"></a><span class="lineno"> 1622</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d2/d6b/structsorcery__memory__cache.html">sorcery_memory_cache</a> *cache = data;</div><div class="line"><a name="l01623"></a><span class="lineno"> 1623</span>&#160;</div><div class="line"><a name="l01624"></a><span class="lineno"> 1624</span>&#160;   <span class="comment">/* This can occur if a cache is created but never loaded */</span></div><div class="line"><a name="l01625"></a><span class="lineno"> 1625</span>&#160;   <span class="keywordflow">if</span> (!<a class="code" href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a>(cache-&gt;<a class="code" href="../../d2/d6b/structsorcery__memory__cache.html#a5ac083a645d964373f022d03df4849c8">name</a>)) {</div><div class="line"><a name="l01626"></a><span class="lineno"> 1626</span>&#160;      <a class="code" href="../../d5/da5/astobj2_8h.html#a64f51be4bee35c38dbe59b0a788b5ce8">ao2_unlink</a>(caches, cache);</div><div class="line"><a name="l01627"></a><span class="lineno"> 1627</span>&#160;   }</div><div class="line"><a name="l01628"></a><span class="lineno"> 1628</span>&#160;</div><div class="line"><a name="l01629"></a><span class="lineno"> 1629</span>&#160;   <span class="keywordflow">if</span> (cache-&gt;<a class="code" href="../../d2/d6b/structsorcery__memory__cache.html#a890cd2c933f495837f720efe44aa9642">object_lifetime_maximum</a>) {</div><div class="line"><a name="l01630"></a><span class="lineno"> 1630</span>&#160;      <span class="comment">/* If object lifetime support is enabled we need to explicitly drop all cached objects here</span></div><div class="line"><a name="l01631"></a><span class="lineno"> 1631</span>&#160;<span class="comment">       * and stop the scheduled task. Failure to do so could potentially keep the cache around for</span></div><div class="line"><a name="l01632"></a><span class="lineno"> 1632</span>&#160;<span class="comment">       * a prolonged period of time.</span></div><div class="line"><a name="l01633"></a><span class="lineno"> 1633</span>&#160;<span class="comment">       */</span></div><div class="line"><a name="l01634"></a><span class="lineno"> 1634</span>&#160;      <a class="code" href="../../d5/da5/astobj2_8h.html#a3498e30d6154a052e7b64b7a96da8b4b">ao2_wrlock</a>(cache-&gt;<a class="code" href="../../d2/d6b/structsorcery__memory__cache.html#aa0a84e33972901716d6d5a6dcf1a68de">objects</a>);</div><div class="line"><a name="l01635"></a><span class="lineno"> 1635</span>&#160;      <a class="code" href="../../d7/d30/res__sorcery__memory__cache_8c.html#ab6ca326a1f05631b3e363a4302069c93">remove_all_from_cache</a>(cache);</div><div class="line"><a name="l01636"></a><span class="lineno"> 1636</span>&#160;      <a class="code" href="../../d5/da5/astobj2_8h.html#a9998bd156b936636a8780385e9a910b2">ao2_unlock</a>(cache-&gt;<a class="code" href="../../d2/d6b/structsorcery__memory__cache.html#aa0a84e33972901716d6d5a6dcf1a68de">objects</a>);</div><div class="line"><a name="l01637"></a><span class="lineno"> 1637</span>&#160;   }</div><div class="line"><a name="l01638"></a><span class="lineno"> 1638</span>&#160;</div><div class="line"><a name="l01639"></a><span class="lineno"> 1639</span>&#160;   <span class="keywordflow">if</span> (cache-&gt;<a class="code" href="../../d2/d6b/structsorcery__memory__cache.html#acbaed991b7fd3a4fd5661a99cb304d56">full_backend_cache</a>) {</div><div class="line"><a name="l01640"></a><span class="lineno"> 1640</span>&#160;      <a class="code" href="../../d5/da5/astobj2_8h.html#a3498e30d6154a052e7b64b7a96da8b4b">ao2_wrlock</a>(cache-&gt;<a class="code" href="../../d2/d6b/structsorcery__memory__cache.html#aa0a84e33972901716d6d5a6dcf1a68de">objects</a>);</div><div class="line"><a name="l01641"></a><span class="lineno"> 1641</span>&#160;      cache-&gt;<a class="code" href="../../d2/d6b/structsorcery__memory__cache.html#aeb33dcb5573e1661c82b5370681fb626">sorcery</a> = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l01642"></a><span class="lineno"> 1642</span>&#160;      <a class="code" href="../../d5/da5/astobj2_8h.html#a9998bd156b936636a8780385e9a910b2">ao2_unlock</a>(cache-&gt;<a class="code" href="../../d2/d6b/structsorcery__memory__cache.html#aa0a84e33972901716d6d5a6dcf1a68de">objects</a>);</div><div class="line"><a name="l01643"></a><span class="lineno"> 1643</span>&#160;   }</div><div class="line"><a name="l01644"></a><span class="lineno"> 1644</span>&#160;</div><div class="line"><a name="l01645"></a><span class="lineno"> 1645</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(cache, -1);</div><div class="line"><a name="l01646"></a><span class="lineno"> 1646</span>&#160;}</div><div class="line"><a name="l01647"></a><span class="lineno"> 1647</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01648"></a><span class="lineno"> 1648</span>&#160;<span class="comment">/*!</span></div><div class="line"><a name="l01649"></a><span class="lineno"> 1649</span>&#160;<span class="comment"> * \internal</span></div><div class="line"><a name="l01650"></a><span class="lineno"> 1650</span>&#160;<span class="comment"> * \brief CLI tab completion for cache names</span></div><div class="line"><a name="l01651"></a><span class="lineno"> 1651</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l01652"></a><span class="lineno"><a class="line" href="../../d7/d30/res__sorcery__memory__cache_8c.html#a098acef6bba076f66097ff668cc060ff"> 1652</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">char</span> *<a class="code" href="../../d7/d30/res__sorcery__memory__cache_8c.html#a098acef6bba076f66097ff668cc060ff">sorcery_memory_cache_complete_name</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="../../d6/da0/codecs_2gsm_2inc_2private_8h.html#a0b023cbb2bf7d034c2269d58d7455ac8">word</a>, <span class="keywordtype">int</span> <a class="code" href="../../d4/d88/structstate.html">state</a>)</div><div class="line"><a name="l01653"></a><span class="lineno"> 1653</span>&#160;{</div><div class="line"><a name="l01654"></a><span class="lineno"> 1654</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d2/d6b/structsorcery__memory__cache.html">sorcery_memory_cache</a> *<a class="code" href="../../d2/d2c/pbx__realtime_8c.html#aefe318d32c8bb7a9e2025eb146d47781">cache</a>;</div><div class="line"><a name="l01655"></a><span class="lineno"> 1655</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d9/d97/structao2__iterator.html">ao2_iterator</a> it_caches;</div><div class="line"><a name="l01656"></a><span class="lineno"> 1656</span>&#160;   <span class="keywordtype">int</span> wordlen = strlen(word);</div><div class="line"><a name="l01657"></a><span class="lineno"> 1657</span>&#160;   <span class="keywordtype">int</span> which = 0;</div><div class="line"><a name="l01658"></a><span class="lineno"> 1658</span>&#160;   <span class="keywordtype">char</span> *<a class="code" href="../../de/d1b/cel__pgsql_8c.html#ad6c487210772a9b4b0ca04b04b847d4c">result</a> = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l01659"></a><span class="lineno"> 1659</span>&#160;</div><div class="line"><a name="l01660"></a><span class="lineno"> 1660</span>&#160;   it_caches = <a class="code" href="../../d5/da5/astobj2_8h.html#a91d5d37d00874ae7a92d1a15c0a3b3a6">ao2_iterator_init</a>(caches, 0);</div><div class="line"><a name="l01661"></a><span class="lineno"> 1661</span>&#160;   <span class="keywordflow">while</span> ((cache = <a class="code" href="../../d5/da5/astobj2_8h.html#a17990ea630db7dbd1252ef0132133a2b">ao2_iterator_next</a>(&amp;it_caches))) {</div><div class="line"><a name="l01662"></a><span class="lineno"> 1662</span>&#160;      <span class="keywordflow">if</span> (!strncasecmp(word, cache-&gt;<a class="code" href="../../d2/d6b/structsorcery__memory__cache.html#a5ac083a645d964373f022d03df4849c8">name</a>, wordlen)</div><div class="line"><a name="l01663"></a><span class="lineno"> 1663</span>&#160;         &amp;&amp; ++which &gt; state) {</div><div class="line"><a name="l01664"></a><span class="lineno"> 1664</span>&#160;         result = <a class="code" href="../../d8/d8a/astmm_8h.html#ab263849d03fb892847be4986db759737">ast_strdup</a>(cache-&gt;<a class="code" href="../../d2/d6b/structsorcery__memory__cache.html#a5ac083a645d964373f022d03df4849c8">name</a>);</div><div class="line"><a name="l01665"></a><span class="lineno"> 1665</span>&#160;      }</div><div class="line"><a name="l01666"></a><span class="lineno"> 1666</span>&#160;      <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(cache, -1);</div><div class="line"><a name="l01667"></a><span class="lineno"> 1667</span>&#160;      <span class="keywordflow">if</span> (result) {</div><div class="line"><a name="l01668"></a><span class="lineno"> 1668</span>&#160;         <span class="keywordflow">break</span>;</div><div class="line"><a name="l01669"></a><span class="lineno"> 1669</span>&#160;      }</div><div class="line"><a name="l01670"></a><span class="lineno"> 1670</span>&#160;   }</div><div class="line"><a name="l01671"></a><span class="lineno"> 1671</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#ad36841ab6daa3997f7ca7047ad2d033a">ao2_iterator_destroy</a>(&amp;it_caches);</div><div class="line"><a name="l01672"></a><span class="lineno"> 1672</span>&#160;   <span class="keywordflow">return</span> <a class="code" href="../../de/d1b/cel__pgsql_8c.html#ad6c487210772a9b4b0ca04b04b847d4c">result</a>;</div><div class="line"><a name="l01673"></a><span class="lineno"> 1673</span>&#160;}</div><div class="line"><a name="l01674"></a><span class="lineno"> 1674</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01675"></a><span class="lineno"> 1675</span>&#160;<span class="comment">/*!</span></div><div class="line"><a name="l01676"></a><span class="lineno"> 1676</span>&#160;<span class="comment"> * \internal</span></div><div class="line"><a name="l01677"></a><span class="lineno"> 1677</span>&#160;<span class="comment"> * \brief CLI command implementation for &#39;sorcery memory cache show&#39;</span></div><div class="line"><a name="l01678"></a><span class="lineno"> 1678</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l01679"></a><span class="lineno"><a class="line" href="../../d7/d30/res__sorcery__memory__cache_8c.html#acd685da136b665d9151211a6b0566689"> 1679</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">char</span> *<a class="code" href="../../d7/d30/res__sorcery__memory__cache_8c.html#acd685da136b665d9151211a6b0566689">sorcery_memory_cache_show</a>(<span class="keyword">struct</span> <a class="code" href="../../d8/d07/structast__cli__entry.html">ast_cli_entry</a> *e, <span class="keywordtype">int</span> cmd, <span class="keyword">struct</span> <a class="code" href="../../d3/dad/structast__cli__args.html">ast_cli_args</a> *<a class="code" href="../../d7/d6f/test__linkedlists_8c.html#a13dd15487fee89a002d17ef3aff62d02">a</a>)</div><div class="line"><a name="l01680"></a><span class="lineno"> 1680</span>&#160;{</div><div class="line"><a name="l01681"></a><span class="lineno"> 1681</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d2/d6b/structsorcery__memory__cache.html">sorcery_memory_cache</a> *<a class="code" href="../../d2/d2c/pbx__realtime_8c.html#aefe318d32c8bb7a9e2025eb146d47781">cache</a>;</div><div class="line"><a name="l01682"></a><span class="lineno"> 1682</span>&#160;</div><div class="line"><a name="l01683"></a><span class="lineno"> 1683</span>&#160;   <span class="keywordflow">switch</span> (cmd) {</div><div class="line"><a name="l01684"></a><span class="lineno"> 1684</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="../../dc/db0/cli_8h.html#ab33e5350a923c3a8cedbeb496cd88ec9a71745eb63dd093f560a1add3e430d2a9">CLI_INIT</a>:</div><div class="line"><a name="l01685"></a><span class="lineno"> 1685</span>&#160;      e-&gt;<a class="code" href="../../d8/d07/structast__cli__entry.html#ade9cba72805fe52685a1deea307a8e82">command</a> = <span class="stringliteral">&quot;sorcery memory cache show&quot;</span>;</div><div class="line"><a name="l01686"></a><span class="lineno"> 1686</span>&#160;      e-&gt;<a class="code" href="../../d8/d07/structast__cli__entry.html#aef1bd6ad890a110b466cb0e8088507a2">usage</a> =</div><div class="line"><a name="l01687"></a><span class="lineno"> 1687</span>&#160;          <span class="stringliteral">&quot;Usage: sorcery memory cache show &lt;name&gt;\n&quot;</span></div><div class="line"><a name="l01688"></a><span class="lineno"> 1688</span>&#160;          <span class="stringliteral">&quot;       Show sorcery memory cache configuration and statistics.\n&quot;</span>;</div><div class="line"><a name="l01689"></a><span class="lineno"> 1689</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l01690"></a><span class="lineno"> 1690</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="../../dc/db0/cli_8h.html#ab33e5350a923c3a8cedbeb496cd88ec9a76bf33139279b03ec1691f2be2d1be40">CLI_GENERATE</a>:</div><div class="line"><a name="l01691"></a><span class="lineno"> 1691</span>&#160;      <span class="keywordflow">if</span> (a-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#a4b911d12699acbbb5a8b62355b35bae8">pos</a> == 4) {</div><div class="line"><a name="l01692"></a><span class="lineno"> 1692</span>&#160;         <span class="keywordflow">return</span> <a class="code" href="../../d7/d30/res__sorcery__memory__cache_8c.html#a098acef6bba076f66097ff668cc060ff">sorcery_memory_cache_complete_name</a>(a-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#adc1f34651f7bbfa3ba5af27db5f53817">word</a>, a-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#acfc02ec89670db29251fda6a66602ce2">n</a>);</div><div class="line"><a name="l01693"></a><span class="lineno"> 1693</span>&#160;      } <span class="keywordflow">else</span> {</div><div class="line"><a name="l01694"></a><span class="lineno"> 1694</span>&#160;         <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l01695"></a><span class="lineno"> 1695</span>&#160;      }</div><div class="line"><a name="l01696"></a><span class="lineno"> 1696</span>&#160;   }</div><div class="line"><a name="l01697"></a><span class="lineno"> 1697</span>&#160;</div><div class="line"><a name="l01698"></a><span class="lineno"> 1698</span>&#160;   <span class="keywordflow">if</span> (a-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#a98e1d8441ca58834f11f7367be4b3345">argc</a> != 5) {</div><div class="line"><a name="l01699"></a><span class="lineno"> 1699</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/db0/cli_8h.html#a0873456096960dab21fff0ce68c95acb">CLI_SHOWUSAGE</a>;</div><div class="line"><a name="l01700"></a><span class="lineno"> 1700</span>&#160;   }</div><div class="line"><a name="l01701"></a><span class="lineno"> 1701</span>&#160;</div><div class="line"><a name="l01702"></a><span class="lineno"> 1702</span>&#160;   cache = <a class="code" href="../../d5/da5/astobj2_8h.html#a911e0703891a9a7aaf73978152092586">ao2_find</a>(caches, a-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#ad0a19c4d63698f9e9cfd5653e8851452">argv</a>[4], <a class="code" href="../../d5/da5/astobj2_8h.html#ad9d009e87e737af900825b36db55a35caa13a6e0771cc457e86f425d95c3b8d54">OBJ_SEARCH_KEY</a>);</div><div class="line"><a name="l01703"></a><span class="lineno"> 1703</span>&#160;   <span class="keywordflow">if</span> (!cache) {</div><div class="line"><a name="l01704"></a><span class="lineno"> 1704</span>&#160;      <a class="code" href="../../dc/db0/cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#acf64f219885421479997667d2ed3f08a">fd</a>, <span class="stringliteral">&quot;Specified sorcery memory cache &#39;%s&#39; does not exist\n&quot;</span>, a-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#ad0a19c4d63698f9e9cfd5653e8851452">argv</a>[4]);</div><div class="line"><a name="l01705"></a><span class="lineno"> 1705</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/db0/cli_8h.html#ae47751901c430ebb833e59291a5e0b3f">CLI_FAILURE</a>;</div><div class="line"><a name="l01706"></a><span class="lineno"> 1706</span>&#160;   }</div><div class="line"><a name="l01707"></a><span class="lineno"> 1707</span>&#160;</div><div class="line"><a name="l01708"></a><span class="lineno"> 1708</span>&#160;   <a class="code" href="../../dc/db0/cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#acf64f219885421479997667d2ed3f08a">fd</a>, <span class="stringliteral">&quot;Sorcery memory cache: %s\n&quot;</span>, cache-&gt;<a class="code" href="../../d2/d6b/structsorcery__memory__cache.html#a5ac083a645d964373f022d03df4849c8">name</a>);</div><div class="line"><a name="l01709"></a><span class="lineno"> 1709</span>&#160;   <a class="code" href="../../dc/db0/cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#acf64f219885421479997667d2ed3f08a">fd</a>, <span class="stringliteral">&quot;Number of objects within cache: %d\n&quot;</span>, <a class="code" href="../../d5/da5/astobj2_8h.html#a512cc40ce96c63b3d5c78040baa4c9cd">ao2_container_count</a>(cache-&gt;<a class="code" href="../../d2/d6b/structsorcery__memory__cache.html#aa0a84e33972901716d6d5a6dcf1a68de">objects</a>));</div><div class="line"><a name="l01710"></a><span class="lineno"> 1710</span>&#160;   <span class="keywordflow">if</span> (cache-&gt;<a class="code" href="../../d2/d6b/structsorcery__memory__cache.html#a73ce7cbebacf7170f054f846300d67ff">maximum_objects</a>) {</div><div class="line"><a name="l01711"></a><span class="lineno"> 1711</span>&#160;      <a class="code" href="../../dc/db0/cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#acf64f219885421479997667d2ed3f08a">fd</a>, <span class="stringliteral">&quot;Maximum allowed objects: %d\n&quot;</span>, cache-&gt;<a class="code" href="../../d2/d6b/structsorcery__memory__cache.html#a73ce7cbebacf7170f054f846300d67ff">maximum_objects</a>);</div><div class="line"><a name="l01712"></a><span class="lineno"> 1712</span>&#160;   } <span class="keywordflow">else</span> {</div><div class="line"><a name="l01713"></a><span class="lineno"> 1713</span>&#160;      <a class="code" href="../../dc/db0/cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#acf64f219885421479997667d2ed3f08a">fd</a>, <span class="stringliteral">&quot;There is no limit on the maximum number of objects in the cache\n&quot;</span>);</div><div class="line"><a name="l01714"></a><span class="lineno"> 1714</span>&#160;   }</div><div class="line"><a name="l01715"></a><span class="lineno"> 1715</span>&#160;   <span class="keywordflow">if</span> (cache-&gt;<a class="code" href="../../d2/d6b/structsorcery__memory__cache.html#a890cd2c933f495837f720efe44aa9642">object_lifetime_maximum</a>) {</div><div class="line"><a name="l01716"></a><span class="lineno"> 1716</span>&#160;      <a class="code" href="../../dc/db0/cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#acf64f219885421479997667d2ed3f08a">fd</a>, <span class="stringliteral">&quot;Number of seconds before object expires: %d\n&quot;</span>, cache-&gt;<a class="code" href="../../d2/d6b/structsorcery__memory__cache.html#a890cd2c933f495837f720efe44aa9642">object_lifetime_maximum</a>);</div><div class="line"><a name="l01717"></a><span class="lineno"> 1717</span>&#160;   } <span class="keywordflow">else</span> {</div><div class="line"><a name="l01718"></a><span class="lineno"> 1718</span>&#160;      <a class="code" href="../../dc/db0/cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#acf64f219885421479997667d2ed3f08a">fd</a>, <span class="stringliteral">&quot;Object expiration is not enabled - cached objects will not expire\n&quot;</span>);</div><div class="line"><a name="l01719"></a><span class="lineno"> 1719</span>&#160;   }</div><div class="line"><a name="l01720"></a><span class="lineno"> 1720</span>&#160;   <span class="keywordflow">if</span> (cache-&gt;<a class="code" href="../../d2/d6b/structsorcery__memory__cache.html#a89b193072cd806e8e239c9a448463efe">object_lifetime_stale</a>) {</div><div class="line"><a name="l01721"></a><span class="lineno"> 1721</span>&#160;      <a class="code" href="../../dc/db0/cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#acf64f219885421479997667d2ed3f08a">fd</a>, <span class="stringliteral">&quot;Number of seconds before object becomes stale: %d\n&quot;</span>, cache-&gt;<a class="code" href="../../d2/d6b/structsorcery__memory__cache.html#a89b193072cd806e8e239c9a448463efe">object_lifetime_stale</a>);</div><div class="line"><a name="l01722"></a><span class="lineno"> 1722</span>&#160;   } <span class="keywordflow">else</span> {</div><div class="line"><a name="l01723"></a><span class="lineno"> 1723</span>&#160;      <a class="code" href="../../dc/db0/cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#acf64f219885421479997667d2ed3f08a">fd</a>, <span class="stringliteral">&quot;Object staleness is not enabled - cached objects will not go stale\n&quot;</span>);</div><div class="line"><a name="l01724"></a><span class="lineno"> 1724</span>&#160;   }</div><div class="line"><a name="l01725"></a><span class="lineno"> 1725</span>&#160;   <a class="code" href="../../dc/db0/cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#acf64f219885421479997667d2ed3f08a">fd</a>, <span class="stringliteral">&quot;Expire all objects on reload: %s\n&quot;</span>, <a class="code" href="../../dc/db0/cli_8h.html#a93bd04b9d331251376fdfb0eda7e7a6c">AST_CLI_ONOFF</a>(cache-&gt;<a class="code" href="../../d2/d6b/structsorcery__memory__cache.html#a7e8d8ec709f7bce006b45892fa15fdb7">expire_on_reload</a>));</div><div class="line"><a name="l01726"></a><span class="lineno"> 1726</span>&#160;</div><div class="line"><a name="l01727"></a><span class="lineno"> 1727</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(cache, -1);</div><div class="line"><a name="l01728"></a><span class="lineno"> 1728</span>&#160;</div><div class="line"><a name="l01729"></a><span class="lineno"> 1729</span>&#160;   <span class="keywordflow">return</span> <a class="code" href="../../dc/db0/cli_8h.html#a50989f00b32eeb2516a3803cb2ffb766">CLI_SUCCESS</a>;</div><div class="line"><a name="l01730"></a><span class="lineno"> 1730</span>&#160;}</div><div class="line"><a name="l01731"></a><span class="lineno"> 1731</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01732"></a><span class="lineno"> 1732</span>&#160;<span class="comment">/*! \brief Structure used to pass data for printing cached object information */</span></div><div class="line"><a name="l01733"></a><span class="lineno"><a class="line" href="../../d7/d2a/structprint__object__details.html"> 1733</a></span>&#160;<span class="keyword">struct </span><a class="code" href="../../d7/d2a/structprint__object__details.html">print_object_details</a> {<span class="comment"></span></div><div class="line"><a name="l01734"></a><span class="lineno"> 1734</span>&#160;<span class="comment">   /*! \brief The sorcery memory cache */</span></div><div class="line"><a name="l01735"></a><span class="lineno"><a class="line" href="../../d7/d2a/structprint__object__details.html#ada420b1f724d02917b97a9b0d5288086"> 1735</a></span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d2/d6b/structsorcery__memory__cache.html">sorcery_memory_cache</a> *<a class="code" href="../../d7/d2a/structprint__object__details.html#ada420b1f724d02917b97a9b0d5288086">cache</a>;<span class="comment"></span></div><div class="line"><a name="l01736"></a><span class="lineno"> 1736</span>&#160;<span class="comment">   /*! \brief The CLI arguments */</span></div><div class="line"><a name="l01737"></a><span class="lineno"><a class="line" href="../../d7/d2a/structprint__object__details.html#ae19846dd61ed50eb0d30e3b8bb915a8f"> 1737</a></span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d3/dad/structast__cli__args.html">ast_cli_args</a> *<a class="code" href="../../d7/d2a/structprint__object__details.html#ae19846dd61ed50eb0d30e3b8bb915a8f">a</a>;</div><div class="line"><a name="l01738"></a><span class="lineno"> 1738</span>&#160;};</div><div class="line"><a name="l01739"></a><span class="lineno"> 1739</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01740"></a><span class="lineno"> 1740</span>&#160;<span class="comment">/*!</span></div><div class="line"><a name="l01741"></a><span class="lineno"> 1741</span>&#160;<span class="comment"> * \internal</span></div><div class="line"><a name="l01742"></a><span class="lineno"> 1742</span>&#160;<span class="comment"> * \brief Callback function for displaying object within the cache</span></div><div class="line"><a name="l01743"></a><span class="lineno"> 1743</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l01744"></a><span class="lineno"><a class="line" href="../../d7/d30/res__sorcery__memory__cache_8c.html#a2e2cc75f11aaadea52350001ec0a1b72"> 1744</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d7/d30/res__sorcery__memory__cache_8c.html#a2e2cc75f11aaadea52350001ec0a1b72">sorcery_memory_cache_print_object</a>(<span class="keywordtype">void</span> *obj, <span class="keywordtype">void</span> *arg, <span class="keywordtype">int</span> flags)</div><div class="line"><a name="l01745"></a><span class="lineno"> 1745</span>&#160;{</div><div class="line"><a name="l01746"></a><span class="lineno"> 1746</span>&#160;<span class="preprocessor">#define FORMAT &quot;%-25.25s %-15u %-15u \n&quot;</span></div><div class="line"><a name="l01747"></a><span class="lineno"> 1747</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../df/d93/structsorcery__memory__cached__object.html">sorcery_memory_cached_object</a> *cached = obj;</div><div class="line"><a name="l01748"></a><span class="lineno"> 1748</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d7/d2a/structprint__object__details.html">print_object_details</a> *details = arg;</div><div class="line"><a name="l01749"></a><span class="lineno"> 1749</span>&#160;   <span class="keywordtype">int</span> seconds_until_expire = 0, seconds_until_stale = 0;</div><div class="line"><a name="l01750"></a><span class="lineno"> 1750</span>&#160;</div><div class="line"><a name="l01751"></a><span class="lineno"> 1751</span>&#160;   <span class="keywordflow">if</span> (details-&gt;<a class="code" href="../../d7/d2a/structprint__object__details.html#ada420b1f724d02917b97a9b0d5288086">cache</a>-&gt;<a class="code" href="../../d2/d6b/structsorcery__memory__cache.html#a890cd2c933f495837f720efe44aa9642">object_lifetime_maximum</a>) {</div><div class="line"><a name="l01752"></a><span class="lineno"> 1752</span>&#160;      seconds_until_expire = <a class="code" href="../../de/df7/time_8h.html#aca4ecdab7d8d3519062aad9a90fcb29d">ast_tvdiff_ms</a>(<a class="code" href="../../de/df7/time_8h.html#a97e1bb8fbd7a103212789e87e7ed6073">ast_tvadd</a>(cached-&gt;<a class="code" href="../../df/d93/structsorcery__memory__cached__object.html#a529e497bc965817d03dbcdc5805305c4">created</a>, <a class="code" href="../../de/df7/time_8h.html#a1d774df72e3dbb623475783e06ce4f61">ast_samp2tv</a>(details-&gt;<a class="code" href="../../d7/d2a/structprint__object__details.html#ada420b1f724d02917b97a9b0d5288086">cache</a>-&gt;<a class="code" href="../../d2/d6b/structsorcery__memory__cache.html#a890cd2c933f495837f720efe44aa9642">object_lifetime_maximum</a>, 1)), <a class="code" href="../../de/df7/time_8h.html#ad3899efb6f0e348556ef69f5b16aa7f7">ast_tvnow</a>()) / 1000;</div><div class="line"><a name="l01753"></a><span class="lineno"> 1753</span>&#160;   }</div><div class="line"><a name="l01754"></a><span class="lineno"> 1754</span>&#160;   <span class="keywordflow">if</span> (details-&gt;<a class="code" href="../../d7/d2a/structprint__object__details.html#ada420b1f724d02917b97a9b0d5288086">cache</a>-&gt;<a class="code" href="../../d2/d6b/structsorcery__memory__cache.html#a89b193072cd806e8e239c9a448463efe">object_lifetime_stale</a>) {</div><div class="line"><a name="l01755"></a><span class="lineno"> 1755</span>&#160;      seconds_until_stale = <a class="code" href="../../de/df7/time_8h.html#aca4ecdab7d8d3519062aad9a90fcb29d">ast_tvdiff_ms</a>(<a class="code" href="../../de/df7/time_8h.html#a97e1bb8fbd7a103212789e87e7ed6073">ast_tvadd</a>(cached-&gt;<a class="code" href="../../df/d93/structsorcery__memory__cached__object.html#a529e497bc965817d03dbcdc5805305c4">created</a>, <a class="code" href="../../de/df7/time_8h.html#a1d774df72e3dbb623475783e06ce4f61">ast_samp2tv</a>(details-&gt;<a class="code" href="../../d7/d2a/structprint__object__details.html#ada420b1f724d02917b97a9b0d5288086">cache</a>-&gt;<a class="code" href="../../d2/d6b/structsorcery__memory__cache.html#a89b193072cd806e8e239c9a448463efe">object_lifetime_stale</a>, 1)), <a class="code" href="../../de/df7/time_8h.html#ad3899efb6f0e348556ef69f5b16aa7f7">ast_tvnow</a>()) / 1000;</div><div class="line"><a name="l01756"></a><span class="lineno"> 1756</span>&#160;   }</div><div class="line"><a name="l01757"></a><span class="lineno"> 1757</span>&#160;</div><div class="line"><a name="l01758"></a><span class="lineno"> 1758</span>&#160;   <a class="code" href="../../dc/db0/cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(details-&gt;<a class="code" href="../../d7/d2a/structprint__object__details.html#ae19846dd61ed50eb0d30e3b8bb915a8f">a</a>-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#acf64f219885421479997667d2ed3f08a">fd</a>, <a class="code" href="../../d7/d30/res__sorcery__memory__cache_8c.html#ac8dc47e3b39c930caed4bfd05b4ba805">FORMAT</a>, <a class="code" href="../../d8/d25/sorcery_8h.html#a97706283a06cbb44e4f0f9620dd5cf07">ast_sorcery_object_get_id</a>(cached-&gt;<a class="code" href="../../df/d93/structsorcery__memory__cached__object.html#a077376d12464f945e2414d5499c79b3f">object</a>), <a class="code" href="../../d5/d60/utils_8h.html#afa99ec4acc4ecb2dc3c2d05da15d0e3f">MAX</a>(seconds_until_stale, 0), <a class="code" href="../../d5/d60/utils_8h.html#afa99ec4acc4ecb2dc3c2d05da15d0e3f">MAX</a>(seconds_until_expire, 0));</div><div class="line"><a name="l01759"></a><span class="lineno"> 1759</span>&#160;</div><div class="line"><a name="l01760"></a><span class="lineno"> 1760</span>&#160;   <span class="keywordflow">return</span> <a class="code" href="../../d5/da5/astobj2_8h.html#a1f8b41308be4c47de8ff89a3b9c7e7d1a1959468a3c5d6aecd2fa1272d8e30fbf">CMP_MATCH</a>;</div><div class="line"><a name="l01761"></a><span class="lineno"> 1761</span>&#160;<span class="preprocessor">#undef FORMAT</span></div><div class="line"><a name="l01762"></a><span class="lineno"> 1762</span>&#160;}</div><div class="line"><a name="l01763"></a><span class="lineno"> 1763</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01764"></a><span class="lineno"> 1764</span>&#160;<span class="comment">/*!</span></div><div class="line"><a name="l01765"></a><span class="lineno"> 1765</span>&#160;<span class="comment"> * \internal</span></div><div class="line"><a name="l01766"></a><span class="lineno"> 1766</span>&#160;<span class="comment"> * \brief CLI command implementation for &#39;sorcery memory cache dump&#39;</span></div><div class="line"><a name="l01767"></a><span class="lineno"> 1767</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l01768"></a><span class="lineno"><a class="line" href="../../d7/d30/res__sorcery__memory__cache_8c.html#a42a82fa90ac4b7493edfdbffc6c0fac8"> 1768</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">char</span> *<a class="code" href="../../d7/d30/res__sorcery__memory__cache_8c.html#a42a82fa90ac4b7493edfdbffc6c0fac8">sorcery_memory_cache_dump</a>(<span class="keyword">struct</span> <a class="code" href="../../d8/d07/structast__cli__entry.html">ast_cli_entry</a> *e, <span class="keywordtype">int</span> cmd, <span class="keyword">struct</span> <a class="code" href="../../d3/dad/structast__cli__args.html">ast_cli_args</a> *<a class="code" href="../../d7/d6f/test__linkedlists_8c.html#a13dd15487fee89a002d17ef3aff62d02">a</a>)</div><div class="line"><a name="l01769"></a><span class="lineno"> 1769</span>&#160;{</div><div class="line"><a name="l01770"></a><span class="lineno"> 1770</span>&#160;<span class="preprocessor">#define FORMAT &quot;%-25.25s %-15.15s %-15.15s \n&quot;</span></div><div class="line"><a name="l01771"></a><span class="lineno"> 1771</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d2/d6b/structsorcery__memory__cache.html">sorcery_memory_cache</a> *<a class="code" href="../../d2/d2c/pbx__realtime_8c.html#aefe318d32c8bb7a9e2025eb146d47781">cache</a>;</div><div class="line"><a name="l01772"></a><span class="lineno"> 1772</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d7/d2a/structprint__object__details.html">print_object_details</a> details;</div><div class="line"><a name="l01773"></a><span class="lineno"> 1773</span>&#160;</div><div class="line"><a name="l01774"></a><span class="lineno"> 1774</span>&#160;   <span class="keywordflow">switch</span> (cmd) {</div><div class="line"><a name="l01775"></a><span class="lineno"> 1775</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="../../dc/db0/cli_8h.html#ab33e5350a923c3a8cedbeb496cd88ec9a71745eb63dd093f560a1add3e430d2a9">CLI_INIT</a>:</div><div class="line"><a name="l01776"></a><span class="lineno"> 1776</span>&#160;      e-&gt;<a class="code" href="../../d8/d07/structast__cli__entry.html#ade9cba72805fe52685a1deea307a8e82">command</a> = <span class="stringliteral">&quot;sorcery memory cache dump&quot;</span>;</div><div class="line"><a name="l01777"></a><span class="lineno"> 1777</span>&#160;      e-&gt;<a class="code" href="../../d8/d07/structast__cli__entry.html#aef1bd6ad890a110b466cb0e8088507a2">usage</a> =</div><div class="line"><a name="l01778"></a><span class="lineno"> 1778</span>&#160;          <span class="stringliteral">&quot;Usage: sorcery memory cache dump &lt;name&gt;\n&quot;</span></div><div class="line"><a name="l01779"></a><span class="lineno"> 1779</span>&#160;          <span class="stringliteral">&quot;       Dump a list of the objects within the cache, listed by object identifier.\n&quot;</span>;</div><div class="line"><a name="l01780"></a><span class="lineno"> 1780</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l01781"></a><span class="lineno"> 1781</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="../../dc/db0/cli_8h.html#ab33e5350a923c3a8cedbeb496cd88ec9a76bf33139279b03ec1691f2be2d1be40">CLI_GENERATE</a>:</div><div class="line"><a name="l01782"></a><span class="lineno"> 1782</span>&#160;      <span class="keywordflow">if</span> (a-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#a4b911d12699acbbb5a8b62355b35bae8">pos</a> == 4) {</div><div class="line"><a name="l01783"></a><span class="lineno"> 1783</span>&#160;         <span class="keywordflow">return</span> <a class="code" href="../../d7/d30/res__sorcery__memory__cache_8c.html#a098acef6bba076f66097ff668cc060ff">sorcery_memory_cache_complete_name</a>(a-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#adc1f34651f7bbfa3ba5af27db5f53817">word</a>, a-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#acfc02ec89670db29251fda6a66602ce2">n</a>);</div><div class="line"><a name="l01784"></a><span class="lineno"> 1784</span>&#160;      } <span class="keywordflow">else</span> {</div><div class="line"><a name="l01785"></a><span class="lineno"> 1785</span>&#160;         <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l01786"></a><span class="lineno"> 1786</span>&#160;      }</div><div class="line"><a name="l01787"></a><span class="lineno"> 1787</span>&#160;   }</div><div class="line"><a name="l01788"></a><span class="lineno"> 1788</span>&#160;</div><div class="line"><a name="l01789"></a><span class="lineno"> 1789</span>&#160;   <span class="keywordflow">if</span> (a-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#a98e1d8441ca58834f11f7367be4b3345">argc</a> != 5) {</div><div class="line"><a name="l01790"></a><span class="lineno"> 1790</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/db0/cli_8h.html#a0873456096960dab21fff0ce68c95acb">CLI_SHOWUSAGE</a>;</div><div class="line"><a name="l01791"></a><span class="lineno"> 1791</span>&#160;   }</div><div class="line"><a name="l01792"></a><span class="lineno"> 1792</span>&#160;</div><div class="line"><a name="l01793"></a><span class="lineno"> 1793</span>&#160;   cache = <a class="code" href="../../d5/da5/astobj2_8h.html#a911e0703891a9a7aaf73978152092586">ao2_find</a>(caches, a-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#ad0a19c4d63698f9e9cfd5653e8851452">argv</a>[4], <a class="code" href="../../d5/da5/astobj2_8h.html#ad9d009e87e737af900825b36db55a35caa13a6e0771cc457e86f425d95c3b8d54">OBJ_SEARCH_KEY</a>);</div><div class="line"><a name="l01794"></a><span class="lineno"> 1794</span>&#160;   <span class="keywordflow">if</span> (!cache) {</div><div class="line"><a name="l01795"></a><span class="lineno"> 1795</span>&#160;      <a class="code" href="../../dc/db0/cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#acf64f219885421479997667d2ed3f08a">fd</a>, <span class="stringliteral">&quot;Specified sorcery memory cache &#39;%s&#39; does not exist\n&quot;</span>, a-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#ad0a19c4d63698f9e9cfd5653e8851452">argv</a>[4]);</div><div class="line"><a name="l01796"></a><span class="lineno"> 1796</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/db0/cli_8h.html#ae47751901c430ebb833e59291a5e0b3f">CLI_FAILURE</a>;</div><div class="line"><a name="l01797"></a><span class="lineno"> 1797</span>&#160;   }</div><div class="line"><a name="l01798"></a><span class="lineno"> 1798</span>&#160;</div><div class="line"><a name="l01799"></a><span class="lineno"> 1799</span>&#160;   details.<a class="code" href="../../d7/d2a/structprint__object__details.html#ada420b1f724d02917b97a9b0d5288086">cache</a> = <a class="code" href="../../d2/d2c/pbx__realtime_8c.html#aefe318d32c8bb7a9e2025eb146d47781">cache</a>;</div><div class="line"><a name="l01800"></a><span class="lineno"> 1800</span>&#160;   details.<a class="code" href="../../d7/d2a/structprint__object__details.html#ae19846dd61ed50eb0d30e3b8bb915a8f">a</a> = <a class="code" href="../../d7/d6f/test__linkedlists_8c.html#a13dd15487fee89a002d17ef3aff62d02">a</a>;</div><div class="line"><a name="l01801"></a><span class="lineno"> 1801</span>&#160;</div><div class="line"><a name="l01802"></a><span class="lineno"> 1802</span>&#160;   <a class="code" href="../../dc/db0/cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#acf64f219885421479997667d2ed3f08a">fd</a>, <span class="stringliteral">&quot;Dumping sorcery memory cache &#39;%s&#39;:\n&quot;</span>, cache-&gt;<a class="code" href="../../d2/d6b/structsorcery__memory__cache.html#a5ac083a645d964373f022d03df4849c8">name</a>);</div><div class="line"><a name="l01803"></a><span class="lineno"> 1803</span>&#160;   <span class="keywordflow">if</span> (!cache-&gt;<a class="code" href="../../d2/d6b/structsorcery__memory__cache.html#a89b193072cd806e8e239c9a448463efe">object_lifetime_stale</a>) {</div><div class="line"><a name="l01804"></a><span class="lineno"> 1804</span>&#160;      <a class="code" href="../../dc/db0/cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#acf64f219885421479997667d2ed3f08a">fd</a>, <span class="stringliteral">&quot; * Staleness is not enabled - objects will not go stale\n&quot;</span>);</div><div class="line"><a name="l01805"></a><span class="lineno"> 1805</span>&#160;   }</div><div class="line"><a name="l01806"></a><span class="lineno"> 1806</span>&#160;   <span class="keywordflow">if</span> (!cache-&gt;<a class="code" href="../../d2/d6b/structsorcery__memory__cache.html#a890cd2c933f495837f720efe44aa9642">object_lifetime_maximum</a>) {</div><div class="line"><a name="l01807"></a><span class="lineno"> 1807</span>&#160;      <a class="code" href="../../dc/db0/cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#acf64f219885421479997667d2ed3f08a">fd</a>, <span class="stringliteral">&quot; * Object lifetime is not enabled - objects will not expire\n&quot;</span>);</div><div class="line"><a name="l01808"></a><span class="lineno"> 1808</span>&#160;   }</div><div class="line"><a name="l01809"></a><span class="lineno"> 1809</span>&#160;   <a class="code" href="../../dc/db0/cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#acf64f219885421479997667d2ed3f08a">fd</a>, <a class="code" href="../../d7/d30/res__sorcery__memory__cache_8c.html#ac8dc47e3b39c930caed4bfd05b4ba805">FORMAT</a>, <span class="stringliteral">&quot;Object Name&quot;</span>, <span class="stringliteral">&quot;Stale In&quot;</span>, <span class="stringliteral">&quot;Expires In&quot;</span>);</div><div class="line"><a name="l01810"></a><span class="lineno"> 1810</span>&#160;   <a class="code" href="../../dc/db0/cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#acf64f219885421479997667d2ed3f08a">fd</a>, <a class="code" href="../../d7/d30/res__sorcery__memory__cache_8c.html#ac8dc47e3b39c930caed4bfd05b4ba805">FORMAT</a>, <span class="stringliteral">&quot;-------------------------&quot;</span>, <span class="stringliteral">&quot;---------------&quot;</span>, <span class="stringliteral">&quot;---------------&quot;</span>);</div><div class="line"><a name="l01811"></a><span class="lineno"> 1811</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#a47857055118a703ae87ea5ebaf4842ed">ao2_callback</a>(cache-&gt;<a class="code" href="../../d2/d6b/structsorcery__memory__cache.html#aa0a84e33972901716d6d5a6dcf1a68de">objects</a>, <a class="code" href="../../d5/da5/astobj2_8h.html#ad9d009e87e737af900825b36db55a35ca5fc59b193d86a0a8ddfe866304be829d">OBJ_NODATA</a> | <a class="code" href="../../d5/da5/astobj2_8h.html#ad9d009e87e737af900825b36db55a35ca614744a4d36b3189d4ab5b02c8645d47">OBJ_MULTIPLE</a>, <a class="code" href="../../d7/d30/res__sorcery__memory__cache_8c.html#a2e2cc75f11aaadea52350001ec0a1b72">sorcery_memory_cache_print_object</a>, &amp;details);</div><div class="line"><a name="l01812"></a><span class="lineno"> 1812</span>&#160;   <a class="code" href="../../dc/db0/cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#acf64f219885421479997667d2ed3f08a">fd</a>, <a class="code" href="../../d7/d30/res__sorcery__memory__cache_8c.html#ac8dc47e3b39c930caed4bfd05b4ba805">FORMAT</a>, <span class="stringliteral">&quot;-------------------------&quot;</span>, <span class="stringliteral">&quot;---------------&quot;</span>, <span class="stringliteral">&quot;---------------&quot;</span>);</div><div class="line"><a name="l01813"></a><span class="lineno"> 1813</span>&#160;   <a class="code" href="../../dc/db0/cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#acf64f219885421479997667d2ed3f08a">fd</a>, <span class="stringliteral">&quot;Total number of objects cached: %d\n&quot;</span>, <a class="code" href="../../d5/da5/astobj2_8h.html#a512cc40ce96c63b3d5c78040baa4c9cd">ao2_container_count</a>(cache-&gt;<a class="code" href="../../d2/d6b/structsorcery__memory__cache.html#aa0a84e33972901716d6d5a6dcf1a68de">objects</a>));</div><div class="line"><a name="l01814"></a><span class="lineno"> 1814</span>&#160;</div><div class="line"><a name="l01815"></a><span class="lineno"> 1815</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(cache, -1);</div><div class="line"><a name="l01816"></a><span class="lineno"> 1816</span>&#160;</div><div class="line"><a name="l01817"></a><span class="lineno"> 1817</span>&#160;   <span class="keywordflow">return</span> <a class="code" href="../../dc/db0/cli_8h.html#a50989f00b32eeb2516a3803cb2ffb766">CLI_SUCCESS</a>;</div><div class="line"><a name="l01818"></a><span class="lineno"> 1818</span>&#160;<span class="preprocessor">#undef FORMAT</span></div><div class="line"><a name="l01819"></a><span class="lineno"> 1819</span>&#160;}</div><div class="line"><a name="l01820"></a><span class="lineno"> 1820</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01821"></a><span class="lineno"> 1821</span>&#160;<span class="comment">/*!</span></div><div class="line"><a name="l01822"></a><span class="lineno"> 1822</span>&#160;<span class="comment"> * \internal</span></div><div class="line"><a name="l01823"></a><span class="lineno"> 1823</span>&#160;<span class="comment"> * \brief CLI tab completion for cached object names</span></div><div class="line"><a name="l01824"></a><span class="lineno"> 1824</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l01825"></a><span class="lineno"><a class="line" href="../../d7/d30/res__sorcery__memory__cache_8c.html#a6eb01814e57ff655e2fc04a6ac96bd8d"> 1825</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">char</span> *<a class="code" href="../../d7/d30/res__sorcery__memory__cache_8c.html#a6eb01814e57ff655e2fc04a6ac96bd8d">sorcery_memory_cache_complete_object_name</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *cache_name, <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="../../d6/da0/codecs_2gsm_2inc_2private_8h.html#a0b023cbb2bf7d034c2269d58d7455ac8">word</a>, <span class="keywordtype">int</span> <a class="code" href="../../d4/d88/structstate.html">state</a>)</div><div class="line"><a name="l01826"></a><span class="lineno"> 1826</span>&#160;{</div><div class="line"><a name="l01827"></a><span class="lineno"> 1827</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d2/d6b/structsorcery__memory__cache.html">sorcery_memory_cache</a> *<a class="code" href="../../d2/d2c/pbx__realtime_8c.html#aefe318d32c8bb7a9e2025eb146d47781">cache</a>;</div><div class="line"><a name="l01828"></a><span class="lineno"> 1828</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../df/d93/structsorcery__memory__cached__object.html">sorcery_memory_cached_object</a> *cached;</div><div class="line"><a name="l01829"></a><span class="lineno"> 1829</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d9/d97/structao2__iterator.html">ao2_iterator</a> it_cached;</div><div class="line"><a name="l01830"></a><span class="lineno"> 1830</span>&#160;   <span class="keywordtype">int</span> wordlen = strlen(word);</div><div class="line"><a name="l01831"></a><span class="lineno"> 1831</span>&#160;   <span class="keywordtype">int</span> which = 0;</div><div class="line"><a name="l01832"></a><span class="lineno"> 1832</span>&#160;   <span class="keywordtype">char</span> *<a class="code" href="../../de/d1b/cel__pgsql_8c.html#ad6c487210772a9b4b0ca04b04b847d4c">result</a> = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l01833"></a><span class="lineno"> 1833</span>&#160;</div><div class="line"><a name="l01834"></a><span class="lineno"> 1834</span>&#160;   cache = <a class="code" href="../../d5/da5/astobj2_8h.html#a911e0703891a9a7aaf73978152092586">ao2_find</a>(caches, cache_name, <a class="code" href="../../d5/da5/astobj2_8h.html#ad9d009e87e737af900825b36db55a35caa13a6e0771cc457e86f425d95c3b8d54">OBJ_SEARCH_KEY</a>);</div><div class="line"><a name="l01835"></a><span class="lineno"> 1835</span>&#160;   <span class="keywordflow">if</span> (!cache) {</div><div class="line"><a name="l01836"></a><span class="lineno"> 1836</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l01837"></a><span class="lineno"> 1837</span>&#160;   }</div><div class="line"><a name="l01838"></a><span class="lineno"> 1838</span>&#160;</div><div class="line"><a name="l01839"></a><span class="lineno"> 1839</span>&#160;   it_cached = <a class="code" href="../../d5/da5/astobj2_8h.html#a91d5d37d00874ae7a92d1a15c0a3b3a6">ao2_iterator_init</a>(cache-&gt;<a class="code" href="../../d2/d6b/structsorcery__memory__cache.html#aa0a84e33972901716d6d5a6dcf1a68de">objects</a>, 0);</div><div class="line"><a name="l01840"></a><span class="lineno"> 1840</span>&#160;   <span class="keywordflow">while</span> ((cached = <a class="code" href="../../d5/da5/astobj2_8h.html#a17990ea630db7dbd1252ef0132133a2b">ao2_iterator_next</a>(&amp;it_cached))) {</div><div class="line"><a name="l01841"></a><span class="lineno"> 1841</span>&#160;      <span class="keywordflow">if</span> (!strncasecmp(word, <a class="code" href="../../d8/d25/sorcery_8h.html#a97706283a06cbb44e4f0f9620dd5cf07">ast_sorcery_object_get_id</a>(cached-&gt;<a class="code" href="../../df/d93/structsorcery__memory__cached__object.html#a077376d12464f945e2414d5499c79b3f">object</a>), wordlen)</div><div class="line"><a name="l01842"></a><span class="lineno"> 1842</span>&#160;         &amp;&amp; ++which &gt; state) {</div><div class="line"><a name="l01843"></a><span class="lineno"> 1843</span>&#160;         result = <a class="code" href="../../d8/d8a/astmm_8h.html#ab263849d03fb892847be4986db759737">ast_strdup</a>(<a class="code" href="../../d8/d25/sorcery_8h.html#a97706283a06cbb44e4f0f9620dd5cf07">ast_sorcery_object_get_id</a>(cached-&gt;<a class="code" href="../../df/d93/structsorcery__memory__cached__object.html#a077376d12464f945e2414d5499c79b3f">object</a>));</div><div class="line"><a name="l01844"></a><span class="lineno"> 1844</span>&#160;      }</div><div class="line"><a name="l01845"></a><span class="lineno"> 1845</span>&#160;      <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(cached, -1);</div><div class="line"><a name="l01846"></a><span class="lineno"> 1846</span>&#160;      <span class="keywordflow">if</span> (result) {</div><div class="line"><a name="l01847"></a><span class="lineno"> 1847</span>&#160;         <span class="keywordflow">break</span>;</div><div class="line"><a name="l01848"></a><span class="lineno"> 1848</span>&#160;      }</div><div class="line"><a name="l01849"></a><span class="lineno"> 1849</span>&#160;   }</div><div class="line"><a name="l01850"></a><span class="lineno"> 1850</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#ad36841ab6daa3997f7ca7047ad2d033a">ao2_iterator_destroy</a>(&amp;it_cached);</div><div class="line"><a name="l01851"></a><span class="lineno"> 1851</span>&#160;</div><div class="line"><a name="l01852"></a><span class="lineno"> 1852</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(cache, -1);</div><div class="line"><a name="l01853"></a><span class="lineno"> 1853</span>&#160;</div><div class="line"><a name="l01854"></a><span class="lineno"> 1854</span>&#160;   <span class="keywordflow">return</span> <a class="code" href="../../de/d1b/cel__pgsql_8c.html#ad6c487210772a9b4b0ca04b04b847d4c">result</a>;</div><div class="line"><a name="l01855"></a><span class="lineno"> 1855</span>&#160;}</div><div class="line"><a name="l01856"></a><span class="lineno"> 1856</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01857"></a><span class="lineno"> 1857</span>&#160;<span class="comment">/*!</span></div><div class="line"><a name="l01858"></a><span class="lineno"> 1858</span>&#160;<span class="comment"> * \internal</span></div><div class="line"><a name="l01859"></a><span class="lineno"> 1859</span>&#160;<span class="comment"> * \brief CLI command implementation for &#39;sorcery memory cache expire&#39;</span></div><div class="line"><a name="l01860"></a><span class="lineno"> 1860</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l01861"></a><span class="lineno"><a class="line" href="../../d7/d30/res__sorcery__memory__cache_8c.html#a5d2a76b3fae4c75ffec13a20241a74e9"> 1861</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">char</span> *<a class="code" href="../../d7/d30/res__sorcery__memory__cache_8c.html#a5d2a76b3fae4c75ffec13a20241a74e9">sorcery_memory_cache_expire</a>(<span class="keyword">struct</span> <a class="code" href="../../d8/d07/structast__cli__entry.html">ast_cli_entry</a> *e, <span class="keywordtype">int</span> cmd, <span class="keyword">struct</span> <a class="code" href="../../d3/dad/structast__cli__args.html">ast_cli_args</a> *<a class="code" href="../../d7/d6f/test__linkedlists_8c.html#a13dd15487fee89a002d17ef3aff62d02">a</a>)</div><div class="line"><a name="l01862"></a><span class="lineno"> 1862</span>&#160;{</div><div class="line"><a name="l01863"></a><span class="lineno"> 1863</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d2/d6b/structsorcery__memory__cache.html">sorcery_memory_cache</a> *<a class="code" href="../../d2/d2c/pbx__realtime_8c.html#aefe318d32c8bb7a9e2025eb146d47781">cache</a>;</div><div class="line"><a name="l01864"></a><span class="lineno"> 1864</span>&#160;</div><div class="line"><a name="l01865"></a><span class="lineno"> 1865</span>&#160;   <span class="keywordflow">switch</span> (cmd) {</div><div class="line"><a name="l01866"></a><span class="lineno"> 1866</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="../../dc/db0/cli_8h.html#ab33e5350a923c3a8cedbeb496cd88ec9a71745eb63dd093f560a1add3e430d2a9">CLI_INIT</a>:</div><div class="line"><a name="l01867"></a><span class="lineno"> 1867</span>&#160;      e-&gt;<a class="code" href="../../d8/d07/structast__cli__entry.html#ade9cba72805fe52685a1deea307a8e82">command</a> = <span class="stringliteral">&quot;sorcery memory cache expire&quot;</span>;</div><div class="line"><a name="l01868"></a><span class="lineno"> 1868</span>&#160;      e-&gt;<a class="code" href="../../d8/d07/structast__cli__entry.html#aef1bd6ad890a110b466cb0e8088507a2">usage</a> =</div><div class="line"><a name="l01869"></a><span class="lineno"> 1869</span>&#160;          <span class="stringliteral">&quot;Usage: sorcery memory cache expire &lt;cache name&gt; [object name]\n&quot;</span></div><div class="line"><a name="l01870"></a><span class="lineno"> 1870</span>&#160;          <span class="stringliteral">&quot;       Expire a specific object or ALL objects within a sorcery memory cache.\n&quot;</span>;</div><div class="line"><a name="l01871"></a><span class="lineno"> 1871</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l01872"></a><span class="lineno"> 1872</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="../../dc/db0/cli_8h.html#ab33e5350a923c3a8cedbeb496cd88ec9a76bf33139279b03ec1691f2be2d1be40">CLI_GENERATE</a>:</div><div class="line"><a name="l01873"></a><span class="lineno"> 1873</span>&#160;      <span class="keywordflow">if</span> (a-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#a4b911d12699acbbb5a8b62355b35bae8">pos</a> == 4) {</div><div class="line"><a name="l01874"></a><span class="lineno"> 1874</span>&#160;         <span class="keywordflow">return</span> <a class="code" href="../../d7/d30/res__sorcery__memory__cache_8c.html#a098acef6bba076f66097ff668cc060ff">sorcery_memory_cache_complete_name</a>(a-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#adc1f34651f7bbfa3ba5af27db5f53817">word</a>, a-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#acfc02ec89670db29251fda6a66602ce2">n</a>);</div><div class="line"><a name="l01875"></a><span class="lineno"> 1875</span>&#160;      } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (a-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#a4b911d12699acbbb5a8b62355b35bae8">pos</a> == 5) {</div><div class="line"><a name="l01876"></a><span class="lineno"> 1876</span>&#160;         <span class="keywordflow">return</span> <a class="code" href="../../d7/d30/res__sorcery__memory__cache_8c.html#a6eb01814e57ff655e2fc04a6ac96bd8d">sorcery_memory_cache_complete_object_name</a>(a-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#ad0a19c4d63698f9e9cfd5653e8851452">argv</a>[4], a-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#adc1f34651f7bbfa3ba5af27db5f53817">word</a>, a-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#acfc02ec89670db29251fda6a66602ce2">n</a>);</div><div class="line"><a name="l01877"></a><span class="lineno"> 1877</span>&#160;      } <span class="keywordflow">else</span> {</div><div class="line"><a name="l01878"></a><span class="lineno"> 1878</span>&#160;         <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l01879"></a><span class="lineno"> 1879</span>&#160;      }</div><div class="line"><a name="l01880"></a><span class="lineno"> 1880</span>&#160;   }</div><div class="line"><a name="l01881"></a><span class="lineno"> 1881</span>&#160;</div><div class="line"><a name="l01882"></a><span class="lineno"> 1882</span>&#160;   <span class="keywordflow">if</span> (a-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#a98e1d8441ca58834f11f7367be4b3345">argc</a> &lt; 5 || a-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#a98e1d8441ca58834f11f7367be4b3345">argc</a> &gt; 6) {</div><div class="line"><a name="l01883"></a><span class="lineno"> 1883</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/db0/cli_8h.html#a0873456096960dab21fff0ce68c95acb">CLI_SHOWUSAGE</a>;</div><div class="line"><a name="l01884"></a><span class="lineno"> 1884</span>&#160;   }</div><div class="line"><a name="l01885"></a><span class="lineno"> 1885</span>&#160;</div><div class="line"><a name="l01886"></a><span class="lineno"> 1886</span>&#160;   cache = <a class="code" href="../../d5/da5/astobj2_8h.html#a911e0703891a9a7aaf73978152092586">ao2_find</a>(caches, a-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#ad0a19c4d63698f9e9cfd5653e8851452">argv</a>[4], <a class="code" href="../../d5/da5/astobj2_8h.html#ad9d009e87e737af900825b36db55a35caa13a6e0771cc457e86f425d95c3b8d54">OBJ_SEARCH_KEY</a>);</div><div class="line"><a name="l01887"></a><span class="lineno"> 1887</span>&#160;   <span class="keywordflow">if</span> (!cache) {</div><div class="line"><a name="l01888"></a><span class="lineno"> 1888</span>&#160;      <a class="code" href="../../dc/db0/cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#acf64f219885421479997667d2ed3f08a">fd</a>, <span class="stringliteral">&quot;Specified sorcery memory cache &#39;%s&#39; does not exist\n&quot;</span>, a-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#ad0a19c4d63698f9e9cfd5653e8851452">argv</a>[4]);</div><div class="line"><a name="l01889"></a><span class="lineno"> 1889</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/db0/cli_8h.html#ae47751901c430ebb833e59291a5e0b3f">CLI_FAILURE</a>;</div><div class="line"><a name="l01890"></a><span class="lineno"> 1890</span>&#160;   }</div><div class="line"><a name="l01891"></a><span class="lineno"> 1891</span>&#160;</div><div class="line"><a name="l01892"></a><span class="lineno"> 1892</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#a3498e30d6154a052e7b64b7a96da8b4b">ao2_wrlock</a>(cache-&gt;<a class="code" href="../../d2/d6b/structsorcery__memory__cache.html#aa0a84e33972901716d6d5a6dcf1a68de">objects</a>);</div><div class="line"><a name="l01893"></a><span class="lineno"> 1893</span>&#160;   <span class="keywordflow">if</span> (a-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#a98e1d8441ca58834f11f7367be4b3345">argc</a> == 5) {</div><div class="line"><a name="l01894"></a><span class="lineno"> 1894</span>&#160;      <a class="code" href="../../d7/d30/res__sorcery__memory__cache_8c.html#ab6ca326a1f05631b3e363a4302069c93">remove_all_from_cache</a>(cache);</div><div class="line"><a name="l01895"></a><span class="lineno"> 1895</span>&#160;      <a class="code" href="../../dc/db0/cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#acf64f219885421479997667d2ed3f08a">fd</a>, <span class="stringliteral">&quot;All objects have been removed from cache &#39;%s&#39;\n&quot;</span>, a-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#ad0a19c4d63698f9e9cfd5653e8851452">argv</a>[4]);</div><div class="line"><a name="l01896"></a><span class="lineno"> 1896</span>&#160;   } <span class="keywordflow">else</span> {</div><div class="line"><a name="l01897"></a><span class="lineno"> 1897</span>&#160;      <span class="keywordflow">if</span> (cache-&gt;<a class="code" href="../../d2/d6b/structsorcery__memory__cache.html#acbaed991b7fd3a4fd5661a99cb304d56">full_backend_cache</a>) {</div><div class="line"><a name="l01898"></a><span class="lineno"> 1898</span>&#160;         <a class="code" href="../../dc/db0/cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#acf64f219885421479997667d2ed3f08a">fd</a>, <span class="stringliteral">&quot;Due to full backend caching per-object expiration is not available on cache &#39;%s&#39;\n&quot;</span>, a-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#ad0a19c4d63698f9e9cfd5653e8851452">argv</a>[4]);</div><div class="line"><a name="l01899"></a><span class="lineno"> 1899</span>&#160;      } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!<a class="code" href="../../d7/d30/res__sorcery__memory__cache_8c.html#a6046abe86f78c86c1140084831686a25">remove_from_cache</a>(cache, a-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#ad0a19c4d63698f9e9cfd5653e8851452">argv</a>[5], 1)) {</div><div class="line"><a name="l01900"></a><span class="lineno"> 1900</span>&#160;         <a class="code" href="../../dc/db0/cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#acf64f219885421479997667d2ed3f08a">fd</a>, <span class="stringliteral">&quot;Successfully expired object &#39;%s&#39; from cache &#39;%s&#39;\n&quot;</span>, a-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#ad0a19c4d63698f9e9cfd5653e8851452">argv</a>[5], a-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#ad0a19c4d63698f9e9cfd5653e8851452">argv</a>[4]);</div><div class="line"><a name="l01901"></a><span class="lineno"> 1901</span>&#160;      } <span class="keywordflow">else</span> {</div><div class="line"><a name="l01902"></a><span class="lineno"> 1902</span>&#160;         <a class="code" href="../../dc/db0/cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#acf64f219885421479997667d2ed3f08a">fd</a>, <span class="stringliteral">&quot;Object &#39;%s&#39; was not expired from cache &#39;%s&#39; as it was not found\n&quot;</span>, a-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#ad0a19c4d63698f9e9cfd5653e8851452">argv</a>[5],</div><div class="line"><a name="l01903"></a><span class="lineno"> 1903</span>&#160;            a-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#ad0a19c4d63698f9e9cfd5653e8851452">argv</a>[4]);</div><div class="line"><a name="l01904"></a><span class="lineno"> 1904</span>&#160;      }</div><div class="line"><a name="l01905"></a><span class="lineno"> 1905</span>&#160;   }</div><div class="line"><a name="l01906"></a><span class="lineno"> 1906</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#a9998bd156b936636a8780385e9a910b2">ao2_unlock</a>(cache-&gt;<a class="code" href="../../d2/d6b/structsorcery__memory__cache.html#aa0a84e33972901716d6d5a6dcf1a68de">objects</a>);</div><div class="line"><a name="l01907"></a><span class="lineno"> 1907</span>&#160;</div><div class="line"><a name="l01908"></a><span class="lineno"> 1908</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(cache, -1);</div><div class="line"><a name="l01909"></a><span class="lineno"> 1909</span>&#160;</div><div class="line"><a name="l01910"></a><span class="lineno"> 1910</span>&#160;   <span class="keywordflow">return</span> <a class="code" href="../../dc/db0/cli_8h.html#a50989f00b32eeb2516a3803cb2ffb766">CLI_SUCCESS</a>;</div><div class="line"><a name="l01911"></a><span class="lineno"> 1911</span>&#160;}</div><div class="line"><a name="l01912"></a><span class="lineno"> 1912</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01913"></a><span class="lineno"> 1913</span>&#160;<span class="comment">/*!</span></div><div class="line"><a name="l01914"></a><span class="lineno"> 1914</span>&#160;<span class="comment"> * \internal</span></div><div class="line"><a name="l01915"></a><span class="lineno"> 1915</span>&#160;<span class="comment"> * \brief CLI command implementation for &#39;sorcery memory cache stale&#39;</span></div><div class="line"><a name="l01916"></a><span class="lineno"> 1916</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l01917"></a><span class="lineno"><a class="line" href="../../d7/d30/res__sorcery__memory__cache_8c.html#ab79b499f6e1269a7b4156fd60467fa27"> 1917</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">char</span> *<a class="code" href="../../d7/d30/res__sorcery__memory__cache_8c.html#ab79b499f6e1269a7b4156fd60467fa27">sorcery_memory_cache_stale</a>(<span class="keyword">struct</span> <a class="code" href="../../d8/d07/structast__cli__entry.html">ast_cli_entry</a> *e, <span class="keywordtype">int</span> cmd, <span class="keyword">struct</span> <a class="code" href="../../d3/dad/structast__cli__args.html">ast_cli_args</a> *<a class="code" href="../../d7/d6f/test__linkedlists_8c.html#a13dd15487fee89a002d17ef3aff62d02">a</a>)</div><div class="line"><a name="l01918"></a><span class="lineno"> 1918</span>&#160;{</div><div class="line"><a name="l01919"></a><span class="lineno"> 1919</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d2/d6b/structsorcery__memory__cache.html">sorcery_memory_cache</a> *<a class="code" href="../../d2/d2c/pbx__realtime_8c.html#aefe318d32c8bb7a9e2025eb146d47781">cache</a>;</div><div class="line"><a name="l01920"></a><span class="lineno"> 1920</span>&#160;   <span class="keywordtype">int</span> <a class="code" href="../../d0/d29/cdr__mysql_8c.html#ad1982509765f4870f1f63412a53ea668">reload</a> = 0;</div><div class="line"><a name="l01921"></a><span class="lineno"> 1921</span>&#160;</div><div class="line"><a name="l01922"></a><span class="lineno"> 1922</span>&#160;   <span class="keywordflow">switch</span> (cmd) {</div><div class="line"><a name="l01923"></a><span class="lineno"> 1923</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="../../dc/db0/cli_8h.html#ab33e5350a923c3a8cedbeb496cd88ec9a71745eb63dd093f560a1add3e430d2a9">CLI_INIT</a>:</div><div class="line"><a name="l01924"></a><span class="lineno"> 1924</span>&#160;      e-&gt;<a class="code" href="../../d8/d07/structast__cli__entry.html#ade9cba72805fe52685a1deea307a8e82">command</a> = <span class="stringliteral">&quot;sorcery memory cache stale&quot;</span>;</div><div class="line"><a name="l01925"></a><span class="lineno"> 1925</span>&#160;      e-&gt;<a class="code" href="../../d8/d07/structast__cli__entry.html#aef1bd6ad890a110b466cb0e8088507a2">usage</a> =</div><div class="line"><a name="l01926"></a><span class="lineno"> 1926</span>&#160;          <span class="stringliteral">&quot;Usage: sorcery memory cache stale &lt;cache name&gt; [object name [reload]]\n&quot;</span></div><div class="line"><a name="l01927"></a><span class="lineno"> 1927</span>&#160;          <span class="stringliteral">&quot;       Mark a specific object or ALL objects as stale in a sorcery memory cache.\n&quot;</span></div><div class="line"><a name="l01928"></a><span class="lineno"> 1928</span>&#160;          <span class="stringliteral">&quot;       If \&quot;reload\&quot; is specified, then the object is marked stale and immediately\n&quot;</span></div><div class="line"><a name="l01929"></a><span class="lineno"> 1929</span>&#160;          <span class="stringliteral">&quot;       retrieved from backend storage to repopulate the cache\n&quot;</span>;</div><div class="line"><a name="l01930"></a><span class="lineno"> 1930</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l01931"></a><span class="lineno"> 1931</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="../../dc/db0/cli_8h.html#ab33e5350a923c3a8cedbeb496cd88ec9a76bf33139279b03ec1691f2be2d1be40">CLI_GENERATE</a>:</div><div class="line"><a name="l01932"></a><span class="lineno"> 1932</span>&#160;      <span class="keywordflow">if</span> (a-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#a4b911d12699acbbb5a8b62355b35bae8">pos</a> == 4) {</div><div class="line"><a name="l01933"></a><span class="lineno"> 1933</span>&#160;         <span class="keywordflow">return</span> <a class="code" href="../../d7/d30/res__sorcery__memory__cache_8c.html#a098acef6bba076f66097ff668cc060ff">sorcery_memory_cache_complete_name</a>(a-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#adc1f34651f7bbfa3ba5af27db5f53817">word</a>, a-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#acfc02ec89670db29251fda6a66602ce2">n</a>);</div><div class="line"><a name="l01934"></a><span class="lineno"> 1934</span>&#160;      } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (a-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#a4b911d12699acbbb5a8b62355b35bae8">pos</a> == 5) {</div><div class="line"><a name="l01935"></a><span class="lineno"> 1935</span>&#160;         <span class="keywordflow">return</span> <a class="code" href="../../d7/d30/res__sorcery__memory__cache_8c.html#a6eb01814e57ff655e2fc04a6ac96bd8d">sorcery_memory_cache_complete_object_name</a>(a-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#ad0a19c4d63698f9e9cfd5653e8851452">argv</a>[4], a-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#adc1f34651f7bbfa3ba5af27db5f53817">word</a>, a-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#acfc02ec89670db29251fda6a66602ce2">n</a>);</div><div class="line"><a name="l01936"></a><span class="lineno"> 1936</span>&#160;      } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (a-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#a4b911d12699acbbb5a8b62355b35bae8">pos</a> == 6) {</div><div class="line"><a name="l01937"></a><span class="lineno"> 1937</span>&#160;         <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span> * <span class="keyword">const</span> completions[] = { <span class="stringliteral">&quot;reload&quot;</span>, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a> };</div><div class="line"><a name="l01938"></a><span class="lineno"> 1938</span>&#160;         <span class="keywordflow">return</span> <a class="code" href="../../dc/db0/cli_8h.html#a2a43f82ed19e84f386787154f2f22fc9">ast_cli_complete</a>(a-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#adc1f34651f7bbfa3ba5af27db5f53817">word</a>, completions, a-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#acfc02ec89670db29251fda6a66602ce2">n</a>);</div><div class="line"><a name="l01939"></a><span class="lineno"> 1939</span>&#160;      } <span class="keywordflow">else</span> {</div><div class="line"><a name="l01940"></a><span class="lineno"> 1940</span>&#160;         <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l01941"></a><span class="lineno"> 1941</span>&#160;      }</div><div class="line"><a name="l01942"></a><span class="lineno"> 1942</span>&#160;   }</div><div class="line"><a name="l01943"></a><span class="lineno"> 1943</span>&#160;</div><div class="line"><a name="l01944"></a><span class="lineno"> 1944</span>&#160;   <span class="keywordflow">if</span> (a-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#a98e1d8441ca58834f11f7367be4b3345">argc</a> &lt; 5 || a-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#a98e1d8441ca58834f11f7367be4b3345">argc</a> &gt; 7) {</div><div class="line"><a name="l01945"></a><span class="lineno"> 1945</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/db0/cli_8h.html#a0873456096960dab21fff0ce68c95acb">CLI_SHOWUSAGE</a>;</div><div class="line"><a name="l01946"></a><span class="lineno"> 1946</span>&#160;   }</div><div class="line"><a name="l01947"></a><span class="lineno"> 1947</span>&#160;</div><div class="line"><a name="l01948"></a><span class="lineno"> 1948</span>&#160;   <span class="keywordflow">if</span> (a-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#a98e1d8441ca58834f11f7367be4b3345">argc</a> == 7) {</div><div class="line"><a name="l01949"></a><span class="lineno"> 1949</span>&#160;      <span class="keywordflow">if</span> (!strcasecmp(a-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#ad0a19c4d63698f9e9cfd5653e8851452">argv</a>[6], <span class="stringliteral">&quot;reload&quot;</span>)) {</div><div class="line"><a name="l01950"></a><span class="lineno"> 1950</span>&#160;         reload = 1;</div><div class="line"><a name="l01951"></a><span class="lineno"> 1951</span>&#160;      } <span class="keywordflow">else</span> {</div><div class="line"><a name="l01952"></a><span class="lineno"> 1952</span>&#160;         <span class="keywordflow">return</span> <a class="code" href="../../dc/db0/cli_8h.html#a0873456096960dab21fff0ce68c95acb">CLI_SHOWUSAGE</a>;</div><div class="line"><a name="l01953"></a><span class="lineno"> 1953</span>&#160;      }</div><div class="line"><a name="l01954"></a><span class="lineno"> 1954</span>&#160;   }</div><div class="line"><a name="l01955"></a><span class="lineno"> 1955</span>&#160;</div><div class="line"><a name="l01956"></a><span class="lineno"> 1956</span>&#160;   cache = <a class="code" href="../../d5/da5/astobj2_8h.html#a911e0703891a9a7aaf73978152092586">ao2_find</a>(caches, a-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#ad0a19c4d63698f9e9cfd5653e8851452">argv</a>[4], <a class="code" href="../../d5/da5/astobj2_8h.html#ad9d009e87e737af900825b36db55a35caa13a6e0771cc457e86f425d95c3b8d54">OBJ_SEARCH_KEY</a>);</div><div class="line"><a name="l01957"></a><span class="lineno"> 1957</span>&#160;   <span class="keywordflow">if</span> (!cache) {</div><div class="line"><a name="l01958"></a><span class="lineno"> 1958</span>&#160;      <a class="code" href="../../dc/db0/cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#acf64f219885421479997667d2ed3f08a">fd</a>, <span class="stringliteral">&quot;Specified sorcery memory cache &#39;%s&#39; does not exist\n&quot;</span>, a-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#ad0a19c4d63698f9e9cfd5653e8851452">argv</a>[4]);</div><div class="line"><a name="l01959"></a><span class="lineno"> 1959</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/db0/cli_8h.html#ae47751901c430ebb833e59291a5e0b3f">CLI_FAILURE</a>;</div><div class="line"><a name="l01960"></a><span class="lineno"> 1960</span>&#160;   }</div><div class="line"><a name="l01961"></a><span class="lineno"> 1961</span>&#160;</div><div class="line"><a name="l01962"></a><span class="lineno"> 1962</span>&#160;   <span class="keywordflow">if</span> (!cache-&gt;<a class="code" href="../../d2/d6b/structsorcery__memory__cache.html#a89b193072cd806e8e239c9a448463efe">object_lifetime_stale</a>) {</div><div class="line"><a name="l01963"></a><span class="lineno"> 1963</span>&#160;      <a class="code" href="../../dc/db0/cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#acf64f219885421479997667d2ed3f08a">fd</a>, <span class="stringliteral">&quot;Specified sorcery memory cache &#39;%s&#39; does not have staleness enabled\n&quot;</span>, a-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#ad0a19c4d63698f9e9cfd5653e8851452">argv</a>[4]);</div><div class="line"><a name="l01964"></a><span class="lineno"> 1964</span>&#160;      <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(cache, -1);</div><div class="line"><a name="l01965"></a><span class="lineno"> 1965</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/db0/cli_8h.html#ae47751901c430ebb833e59291a5e0b3f">CLI_FAILURE</a>;</div><div class="line"><a name="l01966"></a><span class="lineno"> 1966</span>&#160;   }</div><div class="line"><a name="l01967"></a><span class="lineno"> 1967</span>&#160;</div><div class="line"><a name="l01968"></a><span class="lineno"> 1968</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#a24c1bf4b1202c996cf8a793fa6669bc2">ao2_rdlock</a>(cache-&gt;<a class="code" href="../../d2/d6b/structsorcery__memory__cache.html#aa0a84e33972901716d6d5a6dcf1a68de">objects</a>);</div><div class="line"><a name="l01969"></a><span class="lineno"> 1969</span>&#160;   <span class="keywordflow">if</span> (a-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#a98e1d8441ca58834f11f7367be4b3345">argc</a> == 5) {</div><div class="line"><a name="l01970"></a><span class="lineno"> 1970</span>&#160;      <a class="code" href="../../d7/d30/res__sorcery__memory__cache_8c.html#abd8e246b3ae983064f28ae743fa2c0f2">mark_all_as_stale_in_cache</a>(cache);</div><div class="line"><a name="l01971"></a><span class="lineno"> 1971</span>&#160;      <a class="code" href="../../dc/db0/cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#acf64f219885421479997667d2ed3f08a">fd</a>, <span class="stringliteral">&quot;Marked all objects in sorcery memory cache &#39;%s&#39; as stale\n&quot;</span>, a-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#ad0a19c4d63698f9e9cfd5653e8851452">argv</a>[4]);</div><div class="line"><a name="l01972"></a><span class="lineno"> 1972</span>&#160;   } <span class="keywordflow">else</span> {</div><div class="line"><a name="l01973"></a><span class="lineno"> 1973</span>&#160;      <span class="keywordflow">if</span> (!<a class="code" href="../../d7/d30/res__sorcery__memory__cache_8c.html#aeefdfc3206b1465c47f5e7833c3192b6">mark_object_as_stale_in_cache</a>(cache, a-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#ad0a19c4d63698f9e9cfd5653e8851452">argv</a>[5])) {</div><div class="line"><a name="l01974"></a><span class="lineno"> 1974</span>&#160;         <a class="code" href="../../dc/db0/cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#acf64f219885421479997667d2ed3f08a">fd</a>, <span class="stringliteral">&quot;Successfully marked object &#39;%s&#39; in memory cache &#39;%s&#39; as stale\n&quot;</span>,</div><div class="line"><a name="l01975"></a><span class="lineno"> 1975</span>&#160;            a-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#ad0a19c4d63698f9e9cfd5653e8851452">argv</a>[5], a-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#ad0a19c4d63698f9e9cfd5653e8851452">argv</a>[4]);</div><div class="line"><a name="l01976"></a><span class="lineno"> 1976</span>&#160;         <span class="keywordflow">if</span> (reload) {</div><div class="line"><a name="l01977"></a><span class="lineno"> 1977</span>&#160;            <span class="keyword">struct </span><a class="code" href="../../df/d93/structsorcery__memory__cached__object.html">sorcery_memory_cached_object</a> *cached;</div><div class="line"><a name="l01978"></a><span class="lineno"> 1978</span>&#160;</div><div class="line"><a name="l01979"></a><span class="lineno"> 1979</span>&#160;            cached = <a class="code" href="../../d5/da5/astobj2_8h.html#a911e0703891a9a7aaf73978152092586">ao2_find</a>(cache-&gt;<a class="code" href="../../d2/d6b/structsorcery__memory__cache.html#aa0a84e33972901716d6d5a6dcf1a68de">objects</a>, a-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#ad0a19c4d63698f9e9cfd5653e8851452">argv</a>[5], <a class="code" href="../../d5/da5/astobj2_8h.html#ad9d009e87e737af900825b36db55a35caa13a6e0771cc457e86f425d95c3b8d54">OBJ_SEARCH_KEY</a> | <a class="code" href="../../d5/da5/astobj2_8h.html#ad9d009e87e737af900825b36db55a35ca52efdf13b66ae502e2e20a5f49f068de">OBJ_NOLOCK</a>);</div><div class="line"><a name="l01980"></a><span class="lineno"> 1980</span>&#160;            <span class="keywordflow">if</span> (cached) {</div><div class="line"><a name="l01981"></a><span class="lineno"> 1981</span>&#160;               <a class="code" href="../../d7/d30/res__sorcery__memory__cache_8c.html#ab1da9230c15ffd14293df53648a90c3d">memory_cache_stale_update_object</a>(cache-&gt;<a class="code" href="../../d2/d6b/structsorcery__memory__cache.html#aeb33dcb5573e1661c82b5370681fb626">sorcery</a>, cache, cached);</div><div class="line"><a name="l01982"></a><span class="lineno"> 1982</span>&#160;               <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(cached, -1);</div><div class="line"><a name="l01983"></a><span class="lineno"> 1983</span>&#160;            }</div><div class="line"><a name="l01984"></a><span class="lineno"> 1984</span>&#160;         }</div><div class="line"><a name="l01985"></a><span class="lineno"> 1985</span>&#160;      } <span class="keywordflow">else</span> {</div><div class="line"><a name="l01986"></a><span class="lineno"> 1986</span>&#160;         <a class="code" href="../../dc/db0/cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#acf64f219885421479997667d2ed3f08a">fd</a>, <span class="stringliteral">&quot;Object &#39;%s&#39; in sorcery memory cache &#39;%s&#39; could not be marked as stale as it was not found\n&quot;</span>,</div><div class="line"><a name="l01987"></a><span class="lineno"> 1987</span>&#160;            a-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#ad0a19c4d63698f9e9cfd5653e8851452">argv</a>[5], a-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#ad0a19c4d63698f9e9cfd5653e8851452">argv</a>[4]);</div><div class="line"><a name="l01988"></a><span class="lineno"> 1988</span>&#160;      }</div><div class="line"><a name="l01989"></a><span class="lineno"> 1989</span>&#160;   }</div><div class="line"><a name="l01990"></a><span class="lineno"> 1990</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#a9998bd156b936636a8780385e9a910b2">ao2_unlock</a>(cache-&gt;<a class="code" href="../../d2/d6b/structsorcery__memory__cache.html#aa0a84e33972901716d6d5a6dcf1a68de">objects</a>);</div><div class="line"><a name="l01991"></a><span class="lineno"> 1991</span>&#160;</div><div class="line"><a name="l01992"></a><span class="lineno"> 1992</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(cache, -1);</div><div class="line"><a name="l01993"></a><span class="lineno"> 1993</span>&#160;</div><div class="line"><a name="l01994"></a><span class="lineno"> 1994</span>&#160;   <span class="keywordflow">return</span> <a class="code" href="../../dc/db0/cli_8h.html#a50989f00b32eeb2516a3803cb2ffb766">CLI_SUCCESS</a>;</div><div class="line"><a name="l01995"></a><span class="lineno"> 1995</span>&#160;}</div><div class="line"><a name="l01996"></a><span class="lineno"> 1996</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01997"></a><span class="lineno"> 1997</span>&#160;<span class="comment">/*!</span></div><div class="line"><a name="l01998"></a><span class="lineno"> 1998</span>&#160;<span class="comment"> * \internal</span></div><div class="line"><a name="l01999"></a><span class="lineno"> 1999</span>&#160;<span class="comment"> * \brief CLI command implementation for &#39;sorcery memory cache populate&#39;</span></div><div class="line"><a name="l02000"></a><span class="lineno"> 2000</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l02001"></a><span class="lineno"><a class="line" href="../../d7/d30/res__sorcery__memory__cache_8c.html#ab82ef9b77a071d0ccba6e81eee3cee4a"> 2001</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">char</span> *<a class="code" href="../../d7/d30/res__sorcery__memory__cache_8c.html#ab82ef9b77a071d0ccba6e81eee3cee4a">sorcery_memory_cache_populate</a>(<span class="keyword">struct</span> <a class="code" href="../../d8/d07/structast__cli__entry.html">ast_cli_entry</a> *e, <span class="keywordtype">int</span> cmd, <span class="keyword">struct</span> <a class="code" href="../../d3/dad/structast__cli__args.html">ast_cli_args</a> *<a class="code" href="../../d7/d6f/test__linkedlists_8c.html#a13dd15487fee89a002d17ef3aff62d02">a</a>)</div><div class="line"><a name="l02002"></a><span class="lineno"> 2002</span>&#160;{</div><div class="line"><a name="l02003"></a><span class="lineno"> 2003</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d2/d6b/structsorcery__memory__cache.html">sorcery_memory_cache</a> *<a class="code" href="../../d2/d2c/pbx__realtime_8c.html#aefe318d32c8bb7a9e2025eb146d47781">cache</a>;</div><div class="line"><a name="l02004"></a><span class="lineno"> 2004</span>&#160;</div><div class="line"><a name="l02005"></a><span class="lineno"> 2005</span>&#160;   <span class="keywordflow">switch</span> (cmd) {</div><div class="line"><a name="l02006"></a><span class="lineno"> 2006</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="../../dc/db0/cli_8h.html#ab33e5350a923c3a8cedbeb496cd88ec9a71745eb63dd093f560a1add3e430d2a9">CLI_INIT</a>:</div><div class="line"><a name="l02007"></a><span class="lineno"> 2007</span>&#160;      e-&gt;<a class="code" href="../../d8/d07/structast__cli__entry.html#ade9cba72805fe52685a1deea307a8e82">command</a> = <span class="stringliteral">&quot;sorcery memory cache populate&quot;</span>;</div><div class="line"><a name="l02008"></a><span class="lineno"> 2008</span>&#160;      e-&gt;<a class="code" href="../../d8/d07/structast__cli__entry.html#aef1bd6ad890a110b466cb0e8088507a2">usage</a> =</div><div class="line"><a name="l02009"></a><span class="lineno"> 2009</span>&#160;          <span class="stringliteral">&quot;Usage: sorcery memory cache populate &lt;cache name&gt;\n&quot;</span></div><div class="line"><a name="l02010"></a><span class="lineno"> 2010</span>&#160;          <span class="stringliteral">&quot;       Expire all objects in the cache and populate it with ALL objects from backend.\n&quot;</span>;</div><div class="line"><a name="l02011"></a><span class="lineno"> 2011</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l02012"></a><span class="lineno"> 2012</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="../../dc/db0/cli_8h.html#ab33e5350a923c3a8cedbeb496cd88ec9a76bf33139279b03ec1691f2be2d1be40">CLI_GENERATE</a>:</div><div class="line"><a name="l02013"></a><span class="lineno"> 2013</span>&#160;      <span class="keywordflow">if</span> (a-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#a4b911d12699acbbb5a8b62355b35bae8">pos</a> == 4) {</div><div class="line"><a name="l02014"></a><span class="lineno"> 2014</span>&#160;         <span class="keywordflow">return</span> <a class="code" href="../../d7/d30/res__sorcery__memory__cache_8c.html#a098acef6bba076f66097ff668cc060ff">sorcery_memory_cache_complete_name</a>(a-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#adc1f34651f7bbfa3ba5af27db5f53817">word</a>, a-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#acfc02ec89670db29251fda6a66602ce2">n</a>);</div><div class="line"><a name="l02015"></a><span class="lineno"> 2015</span>&#160;      } <span class="keywordflow">else</span> {</div><div class="line"><a name="l02016"></a><span class="lineno"> 2016</span>&#160;         <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l02017"></a><span class="lineno"> 2017</span>&#160;      }</div><div class="line"><a name="l02018"></a><span class="lineno"> 2018</span>&#160;   }</div><div class="line"><a name="l02019"></a><span class="lineno"> 2019</span>&#160;</div><div class="line"><a name="l02020"></a><span class="lineno"> 2020</span>&#160;   <span class="keywordflow">if</span> (a-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#a98e1d8441ca58834f11f7367be4b3345">argc</a> != 5) {</div><div class="line"><a name="l02021"></a><span class="lineno"> 2021</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/db0/cli_8h.html#a0873456096960dab21fff0ce68c95acb">CLI_SHOWUSAGE</a>;</div><div class="line"><a name="l02022"></a><span class="lineno"> 2022</span>&#160;   }</div><div class="line"><a name="l02023"></a><span class="lineno"> 2023</span>&#160;</div><div class="line"><a name="l02024"></a><span class="lineno"> 2024</span>&#160;   cache = <a class="code" href="../../d5/da5/astobj2_8h.html#a911e0703891a9a7aaf73978152092586">ao2_find</a>(caches, a-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#ad0a19c4d63698f9e9cfd5653e8851452">argv</a>[4], <a class="code" href="../../d5/da5/astobj2_8h.html#ad9d009e87e737af900825b36db55a35caa13a6e0771cc457e86f425d95c3b8d54">OBJ_SEARCH_KEY</a>);</div><div class="line"><a name="l02025"></a><span class="lineno"> 2025</span>&#160;   <span class="keywordflow">if</span> (!cache) {</div><div class="line"><a name="l02026"></a><span class="lineno"> 2026</span>&#160;      <a class="code" href="../../dc/db0/cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#acf64f219885421479997667d2ed3f08a">fd</a>, <span class="stringliteral">&quot;Specified sorcery memory cache &#39;%s&#39; does not exist\n&quot;</span>, a-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#ad0a19c4d63698f9e9cfd5653e8851452">argv</a>[4]);</div><div class="line"><a name="l02027"></a><span class="lineno"> 2027</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/db0/cli_8h.html#ae47751901c430ebb833e59291a5e0b3f">CLI_FAILURE</a>;</div><div class="line"><a name="l02028"></a><span class="lineno"> 2028</span>&#160;   }</div><div class="line"><a name="l02029"></a><span class="lineno"> 2029</span>&#160;</div><div class="line"><a name="l02030"></a><span class="lineno"> 2030</span>&#160;   <span class="keywordflow">if</span> (!cache-&gt;<a class="code" href="../../d2/d6b/structsorcery__memory__cache.html#acbaed991b7fd3a4fd5661a99cb304d56">full_backend_cache</a>) {</div><div class="line"><a name="l02031"></a><span class="lineno"> 2031</span>&#160;      <a class="code" href="../../dc/db0/cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#acf64f219885421479997667d2ed3f08a">fd</a>, <span class="stringliteral">&quot;Specified sorcery memory cache &#39;%s&#39; does not have full backend caching enabled\n&quot;</span>, a-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#ad0a19c4d63698f9e9cfd5653e8851452">argv</a>[4]);</div><div class="line"><a name="l02032"></a><span class="lineno"> 2032</span>&#160;      <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(cache, -1);</div><div class="line"><a name="l02033"></a><span class="lineno"> 2033</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/db0/cli_8h.html#ae47751901c430ebb833e59291a5e0b3f">CLI_FAILURE</a>;</div><div class="line"><a name="l02034"></a><span class="lineno"> 2034</span>&#160;   }</div><div class="line"><a name="l02035"></a><span class="lineno"> 2035</span>&#160;</div><div class="line"><a name="l02036"></a><span class="lineno"> 2036</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#a3498e30d6154a052e7b64b7a96da8b4b">ao2_wrlock</a>(cache-&gt;<a class="code" href="../../d2/d6b/structsorcery__memory__cache.html#aa0a84e33972901716d6d5a6dcf1a68de">objects</a>);</div><div class="line"><a name="l02037"></a><span class="lineno"> 2037</span>&#160;   <span class="keywordflow">if</span> (!cache-&gt;<a class="code" href="../../d2/d6b/structsorcery__memory__cache.html#aeb33dcb5573e1661c82b5370681fb626">sorcery</a>) {</div><div class="line"><a name="l02038"></a><span class="lineno"> 2038</span>&#160;      <a class="code" href="../../dc/db0/cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#acf64f219885421479997667d2ed3f08a">fd</a>, <span class="stringliteral">&quot;Specified sorcery memory cache &#39;%s&#39; is no longer active\n&quot;</span>, a-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#ad0a19c4d63698f9e9cfd5653e8851452">argv</a>[4]);</div><div class="line"><a name="l02039"></a><span class="lineno"> 2039</span>&#160;      <a class="code" href="../../d5/da5/astobj2_8h.html#a9998bd156b936636a8780385e9a910b2">ao2_unlock</a>(cache-&gt;<a class="code" href="../../d2/d6b/structsorcery__memory__cache.html#aa0a84e33972901716d6d5a6dcf1a68de">objects</a>);</div><div class="line"><a name="l02040"></a><span class="lineno"> 2040</span>&#160;      <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(cache, -1);</div><div class="line"><a name="l02041"></a><span class="lineno"> 2041</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/db0/cli_8h.html#ae47751901c430ebb833e59291a5e0b3f">CLI_FAILURE</a>;</div><div class="line"><a name="l02042"></a><span class="lineno"> 2042</span>&#160;   }</div><div class="line"><a name="l02043"></a><span class="lineno"> 2043</span>&#160;</div><div class="line"><a name="l02044"></a><span class="lineno"> 2044</span>&#160;   <a class="code" href="../../d7/d30/res__sorcery__memory__cache_8c.html#ab6ca326a1f05631b3e363a4302069c93">remove_all_from_cache</a>(cache);</div><div class="line"><a name="l02045"></a><span class="lineno"> 2045</span>&#160;   <a class="code" href="../../d7/d30/res__sorcery__memory__cache_8c.html#a9c1643daa6ed7fa4b16780a45f2beeb1">memory_cache_populate</a>(cache-&gt;<a class="code" href="../../d2/d6b/structsorcery__memory__cache.html#aeb33dcb5573e1661c82b5370681fb626">sorcery</a>, cache-&gt;<a class="code" href="../../d2/d6b/structsorcery__memory__cache.html#aaa0b4796a46428e565991525a543f4f0">object_type</a>, cache);</div><div class="line"><a name="l02046"></a><span class="lineno"> 2046</span>&#160;</div><div class="line"><a name="l02047"></a><span class="lineno"> 2047</span>&#160;   <a class="code" href="../../dc/db0/cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#acf64f219885421479997667d2ed3f08a">fd</a>, <span class="stringliteral">&quot;Specified sorcery memory cache &#39;%s&#39; has been populated with &#39;%d&#39; objects from the backend\n&quot;</span>,</div><div class="line"><a name="l02048"></a><span class="lineno"> 2048</span>&#160;      a-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#ad0a19c4d63698f9e9cfd5653e8851452">argv</a>[4], <a class="code" href="../../d5/da5/astobj2_8h.html#a512cc40ce96c63b3d5c78040baa4c9cd">ao2_container_count</a>(cache-&gt;<a class="code" href="../../d2/d6b/structsorcery__memory__cache.html#aa0a84e33972901716d6d5a6dcf1a68de">objects</a>));</div><div class="line"><a name="l02049"></a><span class="lineno"> 2049</span>&#160;</div><div class="line"><a name="l02050"></a><span class="lineno"> 2050</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#a9998bd156b936636a8780385e9a910b2">ao2_unlock</a>(cache-&gt;<a class="code" href="../../d2/d6b/structsorcery__memory__cache.html#aa0a84e33972901716d6d5a6dcf1a68de">objects</a>);</div><div class="line"><a name="l02051"></a><span class="lineno"> 2051</span>&#160;</div><div class="line"><a name="l02052"></a><span class="lineno"> 2052</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(cache, -1);</div><div class="line"><a name="l02053"></a><span class="lineno"> 2053</span>&#160;</div><div class="line"><a name="l02054"></a><span class="lineno"> 2054</span>&#160;   <span class="keywordflow">return</span> <a class="code" href="../../dc/db0/cli_8h.html#a50989f00b32eeb2516a3803cb2ffb766">CLI_SUCCESS</a>;</div><div class="line"><a name="l02055"></a><span class="lineno"> 2055</span>&#160;}</div><div class="line"><a name="l02056"></a><span class="lineno"> 2056</span>&#160;</div><div class="line"><a name="l02057"></a><span class="lineno"><a class="line" href="../../d7/d30/res__sorcery__memory__cache_8c.html#a629f9405d8ea21f16479c4b40197120d"> 2057</a></span>&#160;<span class="keyword">static</span> <span class="keyword">struct </span><a class="code" href="../../d8/d07/structast__cli__entry.html">ast_cli_entry</a> <a class="code" href="../../d7/d30/res__sorcery__memory__cache_8c.html#a629f9405d8ea21f16479c4b40197120d">cli_memory_cache</a>[] = {</div><div class="line"><a name="l02058"></a><span class="lineno"> 2058</span>&#160;   <a class="code" href="../../dc/db0/cli_8h.html#a5c4130cf8f1e93acfdd84416cebf1aef">AST_CLI_DEFINE</a>(<a class="code" href="../../d7/d30/res__sorcery__memory__cache_8c.html#acd685da136b665d9151211a6b0566689">sorcery_memory_cache_show</a>, <span class="stringliteral">&quot;Show sorcery memory cache information&quot;</span>),</div><div class="line"><a name="l02059"></a><span class="lineno"> 2059</span>&#160;   <a class="code" href="../../dc/db0/cli_8h.html#a5c4130cf8f1e93acfdd84416cebf1aef">AST_CLI_DEFINE</a>(<a class="code" href="../../d7/d30/res__sorcery__memory__cache_8c.html#a42a82fa90ac4b7493edfdbffc6c0fac8">sorcery_memory_cache_dump</a>, <span class="stringliteral">&quot;Dump all objects within a sorcery memory cache&quot;</span>),</div><div class="line"><a name="l02060"></a><span class="lineno"> 2060</span>&#160;   <a class="code" href="../../dc/db0/cli_8h.html#a5c4130cf8f1e93acfdd84416cebf1aef">AST_CLI_DEFINE</a>(<a class="code" href="../../d7/d30/res__sorcery__memory__cache_8c.html#a5d2a76b3fae4c75ffec13a20241a74e9">sorcery_memory_cache_expire</a>, <span class="stringliteral">&quot;Expire a specific object or ALL objects within a sorcery memory cache&quot;</span>),</div><div class="line"><a name="l02061"></a><span class="lineno"> 2061</span>&#160;   <a class="code" href="../../dc/db0/cli_8h.html#a5c4130cf8f1e93acfdd84416cebf1aef">AST_CLI_DEFINE</a>(<a class="code" href="../../d7/d30/res__sorcery__memory__cache_8c.html#ab79b499f6e1269a7b4156fd60467fa27">sorcery_memory_cache_stale</a>, <span class="stringliteral">&quot;Mark a specific object or ALL objects as stale within a sorcery memory cache&quot;</span>),</div><div class="line"><a name="l02062"></a><span class="lineno"> 2062</span>&#160;   <a class="code" href="../../dc/db0/cli_8h.html#a5c4130cf8f1e93acfdd84416cebf1aef">AST_CLI_DEFINE</a>(<a class="code" href="../../d7/d30/res__sorcery__memory__cache_8c.html#ab82ef9b77a071d0ccba6e81eee3cee4a">sorcery_memory_cache_populate</a>, <span class="stringliteral">&quot;Clear and populate the sorcery memory cache with objects from the backend&quot;</span>),</div><div class="line"><a name="l02063"></a><span class="lineno"> 2063</span>&#160;};</div><div class="line"><a name="l02064"></a><span class="lineno"> 2064</span>&#160;<span class="comment"></span></div><div class="line"><a name="l02065"></a><span class="lineno"> 2065</span>&#160;<span class="comment">/*!</span></div><div class="line"><a name="l02066"></a><span class="lineno"> 2066</span>&#160;<span class="comment"> * \internal</span></div><div class="line"><a name="l02067"></a><span class="lineno"> 2067</span>&#160;<span class="comment"> * \brief AMI command implementation for &#39;SorceryMemoryCacheExpireObject&#39;</span></div><div class="line"><a name="l02068"></a><span class="lineno"> 2068</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l02069"></a><span class="lineno"><a class="line" href="../../d7/d30/res__sorcery__memory__cache_8c.html#aee7c26d9d56d476f4a268f293be7fbda"> 2069</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d7/d30/res__sorcery__memory__cache_8c.html#aee7c26d9d56d476f4a268f293be7fbda">sorcery_memory_cache_ami_expire_object</a>(<span class="keyword">struct</span> <a class="code" href="../../d2/d8a/structmansession.html">mansession</a> *s, <span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="../../d8/d9e/structmessage.html">message</a> *m)</div><div class="line"><a name="l02070"></a><span class="lineno"> 2070</span>&#160;{</div><div class="line"><a name="l02071"></a><span class="lineno"> 2071</span>&#160;   <span class="keyword">const</span> <span class="keywordtype">char</span> *cache_name = <a class="code" href="../../df/d72/group__Group__AMI.html#gac6a9f3498f9afffecfd78c485af41556">astman_get_header</a>(m, <span class="stringliteral">&quot;Cache&quot;</span>);</div><div class="line"><a name="l02072"></a><span class="lineno"> 2072</span>&#160;   <span class="keyword">const</span> <span class="keywordtype">char</span> *object_name = <a class="code" href="../../df/d72/group__Group__AMI.html#gac6a9f3498f9afffecfd78c485af41556">astman_get_header</a>(m, <span class="stringliteral">&quot;Object&quot;</span>);</div><div class="line"><a name="l02073"></a><span class="lineno"> 2073</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d2/d6b/structsorcery__memory__cache.html">sorcery_memory_cache</a> *<a class="code" href="../../d2/d2c/pbx__realtime_8c.html#aefe318d32c8bb7a9e2025eb146d47781">cache</a>;</div><div class="line"><a name="l02074"></a><span class="lineno"> 2074</span>&#160;   <span class="keywordtype">int</span> res;</div><div class="line"><a name="l02075"></a><span class="lineno"> 2075</span>&#160;</div><div class="line"><a name="l02076"></a><span class="lineno"> 2076</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a>(cache_name)) {</div><div class="line"><a name="l02077"></a><span class="lineno"> 2077</span>&#160;      <a class="code" href="../../df/d72/group__Group__AMI.html#ga31a02a7d3cc36aa66ebebdedfc574d1c">astman_send_error</a>(s, m, <span class="stringliteral">&quot;SorceryMemoryCacheExpireObject requires that a cache name be provided.\n&quot;</span>);</div><div class="line"><a name="l02078"></a><span class="lineno"> 2078</span>&#160;      <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l02079"></a><span class="lineno"> 2079</span>&#160;   } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a>(object_name)) {</div><div class="line"><a name="l02080"></a><span class="lineno"> 2080</span>&#160;      <a class="code" href="../../df/d72/group__Group__AMI.html#ga31a02a7d3cc36aa66ebebdedfc574d1c">astman_send_error</a>(s, m, <span class="stringliteral">&quot;SorceryMemoryCacheExpireObject requires that an object name be provided\n&quot;</span>);</div><div class="line"><a name="l02081"></a><span class="lineno"> 2081</span>&#160;      <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l02082"></a><span class="lineno"> 2082</span>&#160;   }</div><div class="line"><a name="l02083"></a><span class="lineno"> 2083</span>&#160;</div><div class="line"><a name="l02084"></a><span class="lineno"> 2084</span>&#160;   cache = <a class="code" href="../../d5/da5/astobj2_8h.html#a911e0703891a9a7aaf73978152092586">ao2_find</a>(caches, cache_name, <a class="code" href="../../d5/da5/astobj2_8h.html#ad9d009e87e737af900825b36db55a35caa13a6e0771cc457e86f425d95c3b8d54">OBJ_SEARCH_KEY</a>);</div><div class="line"><a name="l02085"></a><span class="lineno"> 2085</span>&#160;   <span class="keywordflow">if</span> (!cache) {</div><div class="line"><a name="l02086"></a><span class="lineno"> 2086</span>&#160;      <a class="code" href="../../df/d72/group__Group__AMI.html#ga31a02a7d3cc36aa66ebebdedfc574d1c">astman_send_error</a>(s, m, <span class="stringliteral">&quot;The provided cache does not exist\n&quot;</span>);</div><div class="line"><a name="l02087"></a><span class="lineno"> 2087</span>&#160;      <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l02088"></a><span class="lineno"> 2088</span>&#160;   }</div><div class="line"><a name="l02089"></a><span class="lineno"> 2089</span>&#160;</div><div class="line"><a name="l02090"></a><span class="lineno"> 2090</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#a3498e30d6154a052e7b64b7a96da8b4b">ao2_wrlock</a>(cache-&gt;<a class="code" href="../../d2/d6b/structsorcery__memory__cache.html#aa0a84e33972901716d6d5a6dcf1a68de">objects</a>);</div><div class="line"><a name="l02091"></a><span class="lineno"> 2091</span>&#160;   <span class="keywordflow">if</span> (cache-&gt;<a class="code" href="../../d2/d6b/structsorcery__memory__cache.html#acbaed991b7fd3a4fd5661a99cb304d56">full_backend_cache</a>) {</div><div class="line"><a name="l02092"></a><span class="lineno"> 2092</span>&#160;      res = 1;</div><div class="line"><a name="l02093"></a><span class="lineno"> 2093</span>&#160;   } <span class="keywordflow">else</span> {</div><div class="line"><a name="l02094"></a><span class="lineno"> 2094</span>&#160;      res = <a class="code" href="../../d7/d30/res__sorcery__memory__cache_8c.html#a6046abe86f78c86c1140084831686a25">remove_from_cache</a>(cache, object_name, 1);</div><div class="line"><a name="l02095"></a><span class="lineno"> 2095</span>&#160;   }</div><div class="line"><a name="l02096"></a><span class="lineno"> 2096</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#a9998bd156b936636a8780385e9a910b2">ao2_unlock</a>(cache-&gt;<a class="code" href="../../d2/d6b/structsorcery__memory__cache.html#aa0a84e33972901716d6d5a6dcf1a68de">objects</a>);</div><div class="line"><a name="l02097"></a><span class="lineno"> 2097</span>&#160;</div><div class="line"><a name="l02098"></a><span class="lineno"> 2098</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(cache, -1);</div><div class="line"><a name="l02099"></a><span class="lineno"> 2099</span>&#160;</div><div class="line"><a name="l02100"></a><span class="lineno"> 2100</span>&#160;   <span class="keywordflow">if</span> (res == 1) {</div><div class="line"><a name="l02101"></a><span class="lineno"> 2101</span>&#160;      <a class="code" href="../../df/d72/group__Group__AMI.html#ga31a02a7d3cc36aa66ebebdedfc574d1c">astman_send_error</a>(s, m, <span class="stringliteral">&quot;Due to full backend caching per-object expiration is not available, consider using SorceryMemoryCachePopulate or SorceryMemoryCacheExpire instead\n&quot;</span>);</div><div class="line"><a name="l02102"></a><span class="lineno"> 2102</span>&#160;   } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!res) {</div><div class="line"><a name="l02103"></a><span class="lineno"> 2103</span>&#160;      <a class="code" href="../../df/d72/group__Group__AMI.html#ga77315fa8e29950f0c88120501acda0a3">astman_send_ack</a>(s, m, <span class="stringliteral">&quot;The provided object was expired from the cache\n&quot;</span>);</div><div class="line"><a name="l02104"></a><span class="lineno"> 2104</span>&#160;   } <span class="keywordflow">else</span> {</div><div class="line"><a name="l02105"></a><span class="lineno"> 2105</span>&#160;      <a class="code" href="../../df/d72/group__Group__AMI.html#ga31a02a7d3cc36aa66ebebdedfc574d1c">astman_send_error</a>(s, m, <span class="stringliteral">&quot;The provided object could not be expired from the cache\n&quot;</span>);</div><div class="line"><a name="l02106"></a><span class="lineno"> 2106</span>&#160;   }</div><div class="line"><a name="l02107"></a><span class="lineno"> 2107</span>&#160;</div><div class="line"><a name="l02108"></a><span class="lineno"> 2108</span>&#160;   <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l02109"></a><span class="lineno"> 2109</span>&#160;}</div><div class="line"><a name="l02110"></a><span class="lineno"> 2110</span>&#160;<span class="comment"></span></div><div class="line"><a name="l02111"></a><span class="lineno"> 2111</span>&#160;<span class="comment">/*!</span></div><div class="line"><a name="l02112"></a><span class="lineno"> 2112</span>&#160;<span class="comment"> * \internal</span></div><div class="line"><a name="l02113"></a><span class="lineno"> 2113</span>&#160;<span class="comment"> * \brief AMI command implementation for &#39;SorceryMemoryCacheExpire&#39;</span></div><div class="line"><a name="l02114"></a><span class="lineno"> 2114</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l02115"></a><span class="lineno"><a class="line" href="../../d7/d30/res__sorcery__memory__cache_8c.html#a761d1c9efa33774cc89405895ed848a1"> 2115</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d7/d30/res__sorcery__memory__cache_8c.html#a761d1c9efa33774cc89405895ed848a1">sorcery_memory_cache_ami_expire</a>(<span class="keyword">struct</span> <a class="code" href="../../d2/d8a/structmansession.html">mansession</a> *s, <span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="../../d8/d9e/structmessage.html">message</a> *m)</div><div class="line"><a name="l02116"></a><span class="lineno"> 2116</span>&#160;{</div><div class="line"><a name="l02117"></a><span class="lineno"> 2117</span>&#160;   <span class="keyword">const</span> <span class="keywordtype">char</span> *cache_name = <a class="code" href="../../df/d72/group__Group__AMI.html#gac6a9f3498f9afffecfd78c485af41556">astman_get_header</a>(m, <span class="stringliteral">&quot;Cache&quot;</span>);</div><div class="line"><a name="l02118"></a><span class="lineno"> 2118</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d2/d6b/structsorcery__memory__cache.html">sorcery_memory_cache</a> *<a class="code" href="../../d2/d2c/pbx__realtime_8c.html#aefe318d32c8bb7a9e2025eb146d47781">cache</a>;</div><div class="line"><a name="l02119"></a><span class="lineno"> 2119</span>&#160;</div><div class="line"><a name="l02120"></a><span class="lineno"> 2120</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a>(cache_name)) {</div><div class="line"><a name="l02121"></a><span class="lineno"> 2121</span>&#160;      <a class="code" href="../../df/d72/group__Group__AMI.html#ga31a02a7d3cc36aa66ebebdedfc574d1c">astman_send_error</a>(s, m, <span class="stringliteral">&quot;SorceryMemoryCacheExpire requires that a cache name be provided.\n&quot;</span>);</div><div class="line"><a name="l02122"></a><span class="lineno"> 2122</span>&#160;      <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l02123"></a><span class="lineno"> 2123</span>&#160;   }</div><div class="line"><a name="l02124"></a><span class="lineno"> 2124</span>&#160;</div><div class="line"><a name="l02125"></a><span class="lineno"> 2125</span>&#160;   cache = <a class="code" href="../../d5/da5/astobj2_8h.html#a911e0703891a9a7aaf73978152092586">ao2_find</a>(caches, cache_name, <a class="code" href="../../d5/da5/astobj2_8h.html#ad9d009e87e737af900825b36db55a35caa13a6e0771cc457e86f425d95c3b8d54">OBJ_SEARCH_KEY</a>);</div><div class="line"><a name="l02126"></a><span class="lineno"> 2126</span>&#160;   <span class="keywordflow">if</span> (!cache) {</div><div class="line"><a name="l02127"></a><span class="lineno"> 2127</span>&#160;      <a class="code" href="../../df/d72/group__Group__AMI.html#ga31a02a7d3cc36aa66ebebdedfc574d1c">astman_send_error</a>(s, m, <span class="stringliteral">&quot;The provided cache does not exist\n&quot;</span>);</div><div class="line"><a name="l02128"></a><span class="lineno"> 2128</span>&#160;      <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l02129"></a><span class="lineno"> 2129</span>&#160;   }</div><div class="line"><a name="l02130"></a><span class="lineno"> 2130</span>&#160;</div><div class="line"><a name="l02131"></a><span class="lineno"> 2131</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#a3498e30d6154a052e7b64b7a96da8b4b">ao2_wrlock</a>(cache-&gt;<a class="code" href="../../d2/d6b/structsorcery__memory__cache.html#aa0a84e33972901716d6d5a6dcf1a68de">objects</a>);</div><div class="line"><a name="l02132"></a><span class="lineno"> 2132</span>&#160;   <a class="code" href="../../d7/d30/res__sorcery__memory__cache_8c.html#ab6ca326a1f05631b3e363a4302069c93">remove_all_from_cache</a>(cache);</div><div class="line"><a name="l02133"></a><span class="lineno"> 2133</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#a9998bd156b936636a8780385e9a910b2">ao2_unlock</a>(cache-&gt;<a class="code" href="../../d2/d6b/structsorcery__memory__cache.html#aa0a84e33972901716d6d5a6dcf1a68de">objects</a>);</div><div class="line"><a name="l02134"></a><span class="lineno"> 2134</span>&#160;</div><div class="line"><a name="l02135"></a><span class="lineno"> 2135</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(cache, -1);</div><div class="line"><a name="l02136"></a><span class="lineno"> 2136</span>&#160;</div><div class="line"><a name="l02137"></a><span class="lineno"> 2137</span>&#160;   <a class="code" href="../../df/d72/group__Group__AMI.html#ga77315fa8e29950f0c88120501acda0a3">astman_send_ack</a>(s, m, <span class="stringliteral">&quot;All objects were expired from the cache\n&quot;</span>);</div><div class="line"><a name="l02138"></a><span class="lineno"> 2138</span>&#160;</div><div class="line"><a name="l02139"></a><span class="lineno"> 2139</span>&#160;   <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l02140"></a><span class="lineno"> 2140</span>&#160;}</div><div class="line"><a name="l02141"></a><span class="lineno"> 2141</span>&#160;<span class="comment"></span></div><div class="line"><a name="l02142"></a><span class="lineno"> 2142</span>&#160;<span class="comment">/*!</span></div><div class="line"><a name="l02143"></a><span class="lineno"> 2143</span>&#160;<span class="comment"> * \internal</span></div><div class="line"><a name="l02144"></a><span class="lineno"> 2144</span>&#160;<span class="comment"> * \brief AMI command implementation for &#39;SorceryMemoryCacheStaleObject&#39;</span></div><div class="line"><a name="l02145"></a><span class="lineno"> 2145</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l02146"></a><span class="lineno"><a class="line" href="../../d7/d30/res__sorcery__memory__cache_8c.html#a0a8302d60836f9207cb2b3ea36948023"> 2146</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d7/d30/res__sorcery__memory__cache_8c.html#a0a8302d60836f9207cb2b3ea36948023">sorcery_memory_cache_ami_stale_object</a>(<span class="keyword">struct</span> <a class="code" href="../../d2/d8a/structmansession.html">mansession</a> *s, <span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="../../d8/d9e/structmessage.html">message</a> *m)</div><div class="line"><a name="l02147"></a><span class="lineno"> 2147</span>&#160;{</div><div class="line"><a name="l02148"></a><span class="lineno"> 2148</span>&#160;   <span class="keyword">const</span> <span class="keywordtype">char</span> *cache_name = <a class="code" href="../../df/d72/group__Group__AMI.html#gac6a9f3498f9afffecfd78c485af41556">astman_get_header</a>(m, <span class="stringliteral">&quot;Cache&quot;</span>);</div><div class="line"><a name="l02149"></a><span class="lineno"> 2149</span>&#160;   <span class="keyword">const</span> <span class="keywordtype">char</span> *object_name = <a class="code" href="../../df/d72/group__Group__AMI.html#gac6a9f3498f9afffecfd78c485af41556">astman_get_header</a>(m, <span class="stringliteral">&quot;Object&quot;</span>);</div><div class="line"><a name="l02150"></a><span class="lineno"> 2150</span>&#160;   <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="../../d0/d29/cdr__mysql_8c.html#ad1982509765f4870f1f63412a53ea668">reload</a> = <a class="code" href="../../df/d72/group__Group__AMI.html#gac6a9f3498f9afffecfd78c485af41556">astman_get_header</a>(m, <span class="stringliteral">&quot;Reload&quot;</span>);</div><div class="line"><a name="l02151"></a><span class="lineno"> 2151</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d2/d6b/structsorcery__memory__cache.html">sorcery_memory_cache</a> *<a class="code" href="../../d2/d2c/pbx__realtime_8c.html#aefe318d32c8bb7a9e2025eb146d47781">cache</a>;</div><div class="line"><a name="l02152"></a><span class="lineno"> 2152</span>&#160;   <span class="keywordtype">int</span> res;</div><div class="line"><a name="l02153"></a><span class="lineno"> 2153</span>&#160;</div><div class="line"><a name="l02154"></a><span class="lineno"> 2154</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a>(cache_name)) {</div><div class="line"><a name="l02155"></a><span class="lineno"> 2155</span>&#160;      <a class="code" href="../../df/d72/group__Group__AMI.html#ga31a02a7d3cc36aa66ebebdedfc574d1c">astman_send_error</a>(s, m, <span class="stringliteral">&quot;SorceryMemoryCacheStaleObject requires that a cache name be provided.\n&quot;</span>);</div><div class="line"><a name="l02156"></a><span class="lineno"> 2156</span>&#160;      <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l02157"></a><span class="lineno"> 2157</span>&#160;   } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a>(object_name)) {</div><div class="line"><a name="l02158"></a><span class="lineno"> 2158</span>&#160;      <a class="code" href="../../df/d72/group__Group__AMI.html#ga31a02a7d3cc36aa66ebebdedfc574d1c">astman_send_error</a>(s, m, <span class="stringliteral">&quot;SorceryMemoryCacheStaleObject requires that an object name be provided\n&quot;</span>);</div><div class="line"><a name="l02159"></a><span class="lineno"> 2159</span>&#160;      <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l02160"></a><span class="lineno"> 2160</span>&#160;   }</div><div class="line"><a name="l02161"></a><span class="lineno"> 2161</span>&#160;</div><div class="line"><a name="l02162"></a><span class="lineno"> 2162</span>&#160;   cache = <a class="code" href="../../d5/da5/astobj2_8h.html#a911e0703891a9a7aaf73978152092586">ao2_find</a>(caches, cache_name, <a class="code" href="../../d5/da5/astobj2_8h.html#ad9d009e87e737af900825b36db55a35caa13a6e0771cc457e86f425d95c3b8d54">OBJ_SEARCH_KEY</a>);</div><div class="line"><a name="l02163"></a><span class="lineno"> 2163</span>&#160;   <span class="keywordflow">if</span> (!cache) {</div><div class="line"><a name="l02164"></a><span class="lineno"> 2164</span>&#160;      <a class="code" href="../../df/d72/group__Group__AMI.html#ga31a02a7d3cc36aa66ebebdedfc574d1c">astman_send_error</a>(s, m, <span class="stringliteral">&quot;The provided cache does not exist\n&quot;</span>);</div><div class="line"><a name="l02165"></a><span class="lineno"> 2165</span>&#160;      <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l02166"></a><span class="lineno"> 2166</span>&#160;   }</div><div class="line"><a name="l02167"></a><span class="lineno"> 2167</span>&#160;</div><div class="line"><a name="l02168"></a><span class="lineno"> 2168</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#a24c1bf4b1202c996cf8a793fa6669bc2">ao2_rdlock</a>(cache-&gt;<a class="code" href="../../d2/d6b/structsorcery__memory__cache.html#aa0a84e33972901716d6d5a6dcf1a68de">objects</a>);</div><div class="line"><a name="l02169"></a><span class="lineno"> 2169</span>&#160;</div><div class="line"><a name="l02170"></a><span class="lineno"> 2170</span>&#160;   res = <a class="code" href="../../d7/d30/res__sorcery__memory__cache_8c.html#aeefdfc3206b1465c47f5e7833c3192b6">mark_object_as_stale_in_cache</a>(cache, object_name);</div><div class="line"><a name="l02171"></a><span class="lineno"> 2171</span>&#160;</div><div class="line"><a name="l02172"></a><span class="lineno"> 2172</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d6/d90/strings_8h.html#a387a69b3871ca31061566a73f45d20f4">ast_true</a>(reload)) {</div><div class="line"><a name="l02173"></a><span class="lineno"> 2173</span>&#160;      <span class="keyword">struct </span><a class="code" href="../../df/d93/structsorcery__memory__cached__object.html">sorcery_memory_cached_object</a> *cached;</div><div class="line"><a name="l02174"></a><span class="lineno"> 2174</span>&#160;</div><div class="line"><a name="l02175"></a><span class="lineno"> 2175</span>&#160;      cached = <a class="code" href="../../d5/da5/astobj2_8h.html#a911e0703891a9a7aaf73978152092586">ao2_find</a>(cache-&gt;<a class="code" href="../../d2/d6b/structsorcery__memory__cache.html#aa0a84e33972901716d6d5a6dcf1a68de">objects</a>, object_name, <a class="code" href="../../d5/da5/astobj2_8h.html#ad9d009e87e737af900825b36db55a35caa13a6e0771cc457e86f425d95c3b8d54">OBJ_SEARCH_KEY</a> | <a class="code" href="../../d5/da5/astobj2_8h.html#ad9d009e87e737af900825b36db55a35ca52efdf13b66ae502e2e20a5f49f068de">OBJ_NOLOCK</a>);</div><div class="line"><a name="l02176"></a><span class="lineno"> 2176</span>&#160;      <span class="keywordflow">if</span> (cached) {</div><div class="line"><a name="l02177"></a><span class="lineno"> 2177</span>&#160;         <a class="code" href="../../d7/d30/res__sorcery__memory__cache_8c.html#ab1da9230c15ffd14293df53648a90c3d">memory_cache_stale_update_object</a>(cache-&gt;<a class="code" href="../../d2/d6b/structsorcery__memory__cache.html#aeb33dcb5573e1661c82b5370681fb626">sorcery</a>, cache, cached);</div><div class="line"><a name="l02178"></a><span class="lineno"> 2178</span>&#160;         <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(cached, -1);</div><div class="line"><a name="l02179"></a><span class="lineno"> 2179</span>&#160;      }</div><div class="line"><a name="l02180"></a><span class="lineno"> 2180</span>&#160;   }</div><div class="line"><a name="l02181"></a><span class="lineno"> 2181</span>&#160;</div><div class="line"><a name="l02182"></a><span class="lineno"> 2182</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#a9998bd156b936636a8780385e9a910b2">ao2_unlock</a>(cache-&gt;<a class="code" href="../../d2/d6b/structsorcery__memory__cache.html#aa0a84e33972901716d6d5a6dcf1a68de">objects</a>);</div><div class="line"><a name="l02183"></a><span class="lineno"> 2183</span>&#160;</div><div class="line"><a name="l02184"></a><span class="lineno"> 2184</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(cache, -1);</div><div class="line"><a name="l02185"></a><span class="lineno"> 2185</span>&#160;</div><div class="line"><a name="l02186"></a><span class="lineno"> 2186</span>&#160;   <span class="keywordflow">if</span> (!res) {</div><div class="line"><a name="l02187"></a><span class="lineno"> 2187</span>&#160;      <a class="code" href="../../df/d72/group__Group__AMI.html#ga77315fa8e29950f0c88120501acda0a3">astman_send_ack</a>(s, m, <span class="stringliteral">&quot;The provided object was marked as stale in the cache\n&quot;</span>);</div><div class="line"><a name="l02188"></a><span class="lineno"> 2188</span>&#160;   } <span class="keywordflow">else</span> {</div><div class="line"><a name="l02189"></a><span class="lineno"> 2189</span>&#160;      <a class="code" href="../../df/d72/group__Group__AMI.html#ga31a02a7d3cc36aa66ebebdedfc574d1c">astman_send_error</a>(s, m, <span class="stringliteral">&quot;The provided object could not be marked as stale in the cache\n&quot;</span>);</div><div class="line"><a name="l02190"></a><span class="lineno"> 2190</span>&#160;   }</div><div class="line"><a name="l02191"></a><span class="lineno"> 2191</span>&#160;</div><div class="line"><a name="l02192"></a><span class="lineno"> 2192</span>&#160;   <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l02193"></a><span class="lineno"> 2193</span>&#160;}</div><div class="line"><a name="l02194"></a><span class="lineno"> 2194</span>&#160;<span class="comment"></span></div><div class="line"><a name="l02195"></a><span class="lineno"> 2195</span>&#160;<span class="comment">/*!</span></div><div class="line"><a name="l02196"></a><span class="lineno"> 2196</span>&#160;<span class="comment"> * \internal</span></div><div class="line"><a name="l02197"></a><span class="lineno"> 2197</span>&#160;<span class="comment"> * \brief AMI command implementation for &#39;SorceryMemoryCacheStale&#39;</span></div><div class="line"><a name="l02198"></a><span class="lineno"> 2198</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l02199"></a><span class="lineno"><a class="line" href="../../d7/d30/res__sorcery__memory__cache_8c.html#a4161fc89535e551cb44e80ea3b51dadb"> 2199</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d7/d30/res__sorcery__memory__cache_8c.html#a4161fc89535e551cb44e80ea3b51dadb">sorcery_memory_cache_ami_stale</a>(<span class="keyword">struct</span> <a class="code" href="../../d2/d8a/structmansession.html">mansession</a> *s, <span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="../../d8/d9e/structmessage.html">message</a> *m)</div><div class="line"><a name="l02200"></a><span class="lineno"> 2200</span>&#160;{</div><div class="line"><a name="l02201"></a><span class="lineno"> 2201</span>&#160;   <span class="keyword">const</span> <span class="keywordtype">char</span> *cache_name = <a class="code" href="../../df/d72/group__Group__AMI.html#gac6a9f3498f9afffecfd78c485af41556">astman_get_header</a>(m, <span class="stringliteral">&quot;Cache&quot;</span>);</div><div class="line"><a name="l02202"></a><span class="lineno"> 2202</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d2/d6b/structsorcery__memory__cache.html">sorcery_memory_cache</a> *<a class="code" href="../../d2/d2c/pbx__realtime_8c.html#aefe318d32c8bb7a9e2025eb146d47781">cache</a>;</div><div class="line"><a name="l02203"></a><span class="lineno"> 2203</span>&#160;</div><div class="line"><a name="l02204"></a><span class="lineno"> 2204</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a>(cache_name)) {</div><div class="line"><a name="l02205"></a><span class="lineno"> 2205</span>&#160;      <a class="code" href="../../df/d72/group__Group__AMI.html#ga31a02a7d3cc36aa66ebebdedfc574d1c">astman_send_error</a>(s, m, <span class="stringliteral">&quot;SorceryMemoryCacheStale requires that a cache name be provided.\n&quot;</span>);</div><div class="line"><a name="l02206"></a><span class="lineno"> 2206</span>&#160;      <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l02207"></a><span class="lineno"> 2207</span>&#160;   }</div><div class="line"><a name="l02208"></a><span class="lineno"> 2208</span>&#160;</div><div class="line"><a name="l02209"></a><span class="lineno"> 2209</span>&#160;   cache = <a class="code" href="../../d5/da5/astobj2_8h.html#a911e0703891a9a7aaf73978152092586">ao2_find</a>(caches, cache_name, <a class="code" href="../../d5/da5/astobj2_8h.html#ad9d009e87e737af900825b36db55a35caa13a6e0771cc457e86f425d95c3b8d54">OBJ_SEARCH_KEY</a>);</div><div class="line"><a name="l02210"></a><span class="lineno"> 2210</span>&#160;   <span class="keywordflow">if</span> (!cache) {</div><div class="line"><a name="l02211"></a><span class="lineno"> 2211</span>&#160;      <a class="code" href="../../df/d72/group__Group__AMI.html#ga31a02a7d3cc36aa66ebebdedfc574d1c">astman_send_error</a>(s, m, <span class="stringliteral">&quot;The provided cache does not exist\n&quot;</span>);</div><div class="line"><a name="l02212"></a><span class="lineno"> 2212</span>&#160;      <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l02213"></a><span class="lineno"> 2213</span>&#160;   }</div><div class="line"><a name="l02214"></a><span class="lineno"> 2214</span>&#160;</div><div class="line"><a name="l02215"></a><span class="lineno"> 2215</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#a24c1bf4b1202c996cf8a793fa6669bc2">ao2_rdlock</a>(cache-&gt;<a class="code" href="../../d2/d6b/structsorcery__memory__cache.html#aa0a84e33972901716d6d5a6dcf1a68de">objects</a>);</div><div class="line"><a name="l02216"></a><span class="lineno"> 2216</span>&#160;   <a class="code" href="../../d7/d30/res__sorcery__memory__cache_8c.html#abd8e246b3ae983064f28ae743fa2c0f2">mark_all_as_stale_in_cache</a>(cache);</div><div class="line"><a name="l02217"></a><span class="lineno"> 2217</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#a9998bd156b936636a8780385e9a910b2">ao2_unlock</a>(cache-&gt;<a class="code" href="../../d2/d6b/structsorcery__memory__cache.html#aa0a84e33972901716d6d5a6dcf1a68de">objects</a>);</div><div class="line"><a name="l02218"></a><span class="lineno"> 2218</span>&#160;</div><div class="line"><a name="l02219"></a><span class="lineno"> 2219</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(cache, -1);</div><div class="line"><a name="l02220"></a><span class="lineno"> 2220</span>&#160;</div><div class="line"><a name="l02221"></a><span class="lineno"> 2221</span>&#160;   <a class="code" href="../../df/d72/group__Group__AMI.html#ga77315fa8e29950f0c88120501acda0a3">astman_send_ack</a>(s, m, <span class="stringliteral">&quot;All objects were marked as stale in the cache\n&quot;</span>);</div><div class="line"><a name="l02222"></a><span class="lineno"> 2222</span>&#160;</div><div class="line"><a name="l02223"></a><span class="lineno"> 2223</span>&#160;   <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l02224"></a><span class="lineno"> 2224</span>&#160;}</div><div class="line"><a name="l02225"></a><span class="lineno"> 2225</span>&#160;<span class="comment"></span></div><div class="line"><a name="l02226"></a><span class="lineno"> 2226</span>&#160;<span class="comment">/*!</span></div><div class="line"><a name="l02227"></a><span class="lineno"> 2227</span>&#160;<span class="comment"> * \internal</span></div><div class="line"><a name="l02228"></a><span class="lineno"> 2228</span>&#160;<span class="comment"> * \brief AMI command implementation for &#39;SorceryMemoryCachePopulate&#39;</span></div><div class="line"><a name="l02229"></a><span class="lineno"> 2229</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l02230"></a><span class="lineno"><a class="line" href="../../d7/d30/res__sorcery__memory__cache_8c.html#aa7e1302041b154a0df319fb0abbd6447"> 2230</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d7/d30/res__sorcery__memory__cache_8c.html#aa7e1302041b154a0df319fb0abbd6447">sorcery_memory_cache_ami_populate</a>(<span class="keyword">struct</span> <a class="code" href="../../d2/d8a/structmansession.html">mansession</a> *s, <span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="../../d8/d9e/structmessage.html">message</a> *m)</div><div class="line"><a name="l02231"></a><span class="lineno"> 2231</span>&#160;{</div><div class="line"><a name="l02232"></a><span class="lineno"> 2232</span>&#160;   <span class="keyword">const</span> <span class="keywordtype">char</span> *cache_name = <a class="code" href="../../df/d72/group__Group__AMI.html#gac6a9f3498f9afffecfd78c485af41556">astman_get_header</a>(m, <span class="stringliteral">&quot;Cache&quot;</span>);</div><div class="line"><a name="l02233"></a><span class="lineno"> 2233</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d2/d6b/structsorcery__memory__cache.html">sorcery_memory_cache</a> *<a class="code" href="../../d2/d2c/pbx__realtime_8c.html#aefe318d32c8bb7a9e2025eb146d47781">cache</a>;</div><div class="line"><a name="l02234"></a><span class="lineno"> 2234</span>&#160;</div><div class="line"><a name="l02235"></a><span class="lineno"> 2235</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a>(cache_name)) {</div><div class="line"><a name="l02236"></a><span class="lineno"> 2236</span>&#160;      <a class="code" href="../../df/d72/group__Group__AMI.html#ga31a02a7d3cc36aa66ebebdedfc574d1c">astman_send_error</a>(s, m, <span class="stringliteral">&quot;SorceryMemoryCachePopulate requires that a cache name be provided.\n&quot;</span>);</div><div class="line"><a name="l02237"></a><span class="lineno"> 2237</span>&#160;      <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l02238"></a><span class="lineno"> 2238</span>&#160;   }</div><div class="line"><a name="l02239"></a><span class="lineno"> 2239</span>&#160;</div><div class="line"><a name="l02240"></a><span class="lineno"> 2240</span>&#160;   cache = <a class="code" href="../../d5/da5/astobj2_8h.html#a911e0703891a9a7aaf73978152092586">ao2_find</a>(caches, cache_name, <a class="code" href="../../d5/da5/astobj2_8h.html#ad9d009e87e737af900825b36db55a35caa13a6e0771cc457e86f425d95c3b8d54">OBJ_SEARCH_KEY</a>);</div><div class="line"><a name="l02241"></a><span class="lineno"> 2241</span>&#160;   <span class="keywordflow">if</span> (!cache) {</div><div class="line"><a name="l02242"></a><span class="lineno"> 2242</span>&#160;      <a class="code" href="../../df/d72/group__Group__AMI.html#ga31a02a7d3cc36aa66ebebdedfc574d1c">astman_send_error</a>(s, m, <span class="stringliteral">&quot;The provided cache does not exist\n&quot;</span>);</div><div class="line"><a name="l02243"></a><span class="lineno"> 2243</span>&#160;      <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l02244"></a><span class="lineno"> 2244</span>&#160;   }</div><div class="line"><a name="l02245"></a><span class="lineno"> 2245</span>&#160;</div><div class="line"><a name="l02246"></a><span class="lineno"> 2246</span>&#160;   <span class="keywordflow">if</span> (!cache-&gt;<a class="code" href="../../d2/d6b/structsorcery__memory__cache.html#acbaed991b7fd3a4fd5661a99cb304d56">full_backend_cache</a>) {</div><div class="line"><a name="l02247"></a><span class="lineno"> 2247</span>&#160;      <a class="code" href="../../df/d72/group__Group__AMI.html#ga31a02a7d3cc36aa66ebebdedfc574d1c">astman_send_error</a>(s, m, <span class="stringliteral">&quot;The provided cache does not have full backend caching enabled\n&quot;</span>);</div><div class="line"><a name="l02248"></a><span class="lineno"> 2248</span>&#160;      <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(cache, -1);</div><div class="line"><a name="l02249"></a><span class="lineno"> 2249</span>&#160;      <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l02250"></a><span class="lineno"> 2250</span>&#160;   }</div><div class="line"><a name="l02251"></a><span class="lineno"> 2251</span>&#160;</div><div class="line"><a name="l02252"></a><span class="lineno"> 2252</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#a3498e30d6154a052e7b64b7a96da8b4b">ao2_wrlock</a>(cache-&gt;<a class="code" href="../../d2/d6b/structsorcery__memory__cache.html#aa0a84e33972901716d6d5a6dcf1a68de">objects</a>);</div><div class="line"><a name="l02253"></a><span class="lineno"> 2253</span>&#160;   <span class="keywordflow">if</span> (!cache-&gt;<a class="code" href="../../d2/d6b/structsorcery__memory__cache.html#aeb33dcb5573e1661c82b5370681fb626">sorcery</a>) {</div><div class="line"><a name="l02254"></a><span class="lineno"> 2254</span>&#160;      <a class="code" href="../../df/d72/group__Group__AMI.html#ga31a02a7d3cc36aa66ebebdedfc574d1c">astman_send_error</a>(s, m, <span class="stringliteral">&quot;The provided cache is no longer active\n&quot;</span>);</div><div class="line"><a name="l02255"></a><span class="lineno"> 2255</span>&#160;      <a class="code" href="../../d5/da5/astobj2_8h.html#a9998bd156b936636a8780385e9a910b2">ao2_unlock</a>(cache-&gt;<a class="code" href="../../d2/d6b/structsorcery__memory__cache.html#aa0a84e33972901716d6d5a6dcf1a68de">objects</a>);</div><div class="line"><a name="l02256"></a><span class="lineno"> 2256</span>&#160;      <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(cache, -1);</div><div class="line"><a name="l02257"></a><span class="lineno"> 2257</span>&#160;      <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l02258"></a><span class="lineno"> 2258</span>&#160;   }</div><div class="line"><a name="l02259"></a><span class="lineno"> 2259</span>&#160;</div><div class="line"><a name="l02260"></a><span class="lineno"> 2260</span>&#160;   <a class="code" href="../../d7/d30/res__sorcery__memory__cache_8c.html#ab6ca326a1f05631b3e363a4302069c93">remove_all_from_cache</a>(cache);</div><div class="line"><a name="l02261"></a><span class="lineno"> 2261</span>&#160;   <a class="code" href="../../d7/d30/res__sorcery__memory__cache_8c.html#a9c1643daa6ed7fa4b16780a45f2beeb1">memory_cache_populate</a>(cache-&gt;<a class="code" href="../../d2/d6b/structsorcery__memory__cache.html#aeb33dcb5573e1661c82b5370681fb626">sorcery</a>, cache-&gt;<a class="code" href="../../d2/d6b/structsorcery__memory__cache.html#aaa0b4796a46428e565991525a543f4f0">object_type</a>, cache);</div><div class="line"><a name="l02262"></a><span class="lineno"> 2262</span>&#160;</div><div class="line"><a name="l02263"></a><span class="lineno"> 2263</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#a9998bd156b936636a8780385e9a910b2">ao2_unlock</a>(cache-&gt;<a class="code" href="../../d2/d6b/structsorcery__memory__cache.html#aa0a84e33972901716d6d5a6dcf1a68de">objects</a>);</div><div class="line"><a name="l02264"></a><span class="lineno"> 2264</span>&#160;</div><div class="line"><a name="l02265"></a><span class="lineno"> 2265</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(cache, -1);</div><div class="line"><a name="l02266"></a><span class="lineno"> 2266</span>&#160;</div><div class="line"><a name="l02267"></a><span class="lineno"> 2267</span>&#160;   <a class="code" href="../../df/d72/group__Group__AMI.html#ga77315fa8e29950f0c88120501acda0a3">astman_send_ack</a>(s, m, <span class="stringliteral">&quot;Cache has been expired and populated\n&quot;</span>);</div><div class="line"><a name="l02268"></a><span class="lineno"> 2268</span>&#160;</div><div class="line"><a name="l02269"></a><span class="lineno"> 2269</span>&#160;   <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l02270"></a><span class="lineno"> 2270</span>&#160;}</div><div class="line"><a name="l02271"></a><span class="lineno"> 2271</span>&#160;</div><div class="line"><a name="l02272"></a><span class="lineno"> 2272</span>&#160;<span class="preprocessor">#ifdef TEST_FRAMEWORK</span></div><div class="line"><a name="l02273"></a><span class="lineno"> 2273</span>&#160;<span class="comment"></span></div><div class="line"><a name="l02274"></a><span class="lineno"> 2274</span>&#160;<span class="comment">/*! \brief Dummy sorcery object */</span></div><div class="line"><a name="l02275"></a><span class="lineno"><a class="line" href="../../db/d6c/structtest__sorcery__object.html"> 2275</a></span>&#160;<span class="keyword">struct </span><a class="code" href="../../db/d6c/structtest__sorcery__object.html">test_sorcery_object</a> {</div><div class="line"><a name="l02276"></a><span class="lineno"> 2276</span>&#160;   <a class="code" href="../../d8/d25/sorcery_8h.html#a27ab062271c22bdbc2b6f5d607c980cf">SORCERY_OBJECT</a>(details);</div><div class="line"><a name="l02277"></a><span class="lineno"> 2277</span>&#160;};</div><div class="line"><a name="l02278"></a><span class="lineno"> 2278</span>&#160;<span class="comment"></span></div><div class="line"><a name="l02279"></a><span class="lineno"> 2279</span>&#160;<span class="comment">/*!</span></div><div class="line"><a name="l02280"></a><span class="lineno"> 2280</span>&#160;<span class="comment"> * \internal</span></div><div class="line"><a name="l02281"></a><span class="lineno"> 2281</span>&#160;<span class="comment"> * \brief Allocator for test object</span></div><div class="line"><a name="l02282"></a><span class="lineno"> 2282</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l02283"></a><span class="lineno"> 2283</span>&#160;<span class="comment"> * \param id The identifier for the object</span></div><div class="line"><a name="l02284"></a><span class="lineno"> 2284</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l02285"></a><span class="lineno"> 2285</span>&#160;<span class="comment"> * \retval non-NULL success</span></div><div class="line"><a name="l02286"></a><span class="lineno"> 2286</span>&#160;<span class="comment"> * \retval NULL failure</span></div><div class="line"><a name="l02287"></a><span class="lineno"> 2287</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l02288"></a><span class="lineno"><a class="line" href="../../d7/d30/res__sorcery__memory__cache_8c.html#a79c1852b8824773f75e2988a04c6abbd"> 2288</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> *<a class="code" href="../../d7/d30/res__sorcery__memory__cache_8c.html#a79c1852b8824773f75e2988a04c6abbd">test_sorcery_object_alloc</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *<span class="keywordtype">id</span>)</div><div class="line"><a name="l02289"></a><span class="lineno"> 2289</span>&#160;{</div><div class="line"><a name="l02290"></a><span class="lineno"> 2290</span>&#160;   <span class="keywordflow">return</span> <a class="code" href="../../d8/d25/sorcery_8h.html#a4c03ccef909474831717c93679065508">ast_sorcery_generic_alloc</a>(<span class="keyword">sizeof</span>(<span class="keyword">struct</span> <a class="code" href="../../db/d6c/structtest__sorcery__object.html">test_sorcery_object</a>), <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div><div class="line"><a name="l02291"></a><span class="lineno"> 2291</span>&#160;}</div><div class="line"><a name="l02292"></a><span class="lineno"> 2292</span>&#160;<span class="comment"></span></div><div class="line"><a name="l02293"></a><span class="lineno"> 2293</span>&#160;<span class="comment">/*!</span></div><div class="line"><a name="l02294"></a><span class="lineno"> 2294</span>&#160;<span class="comment"> * \internal</span></div><div class="line"><a name="l02295"></a><span class="lineno"> 2295</span>&#160;<span class="comment"> * \brief Allocator for test sorcery instance</span></div><div class="line"><a name="l02296"></a><span class="lineno"> 2296</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l02297"></a><span class="lineno"> 2297</span>&#160;<span class="comment"> * \retval non-NULL success</span></div><div class="line"><a name="l02298"></a><span class="lineno"> 2298</span>&#160;<span class="comment"> * \retval NULL failure</span></div><div class="line"><a name="l02299"></a><span class="lineno"> 2299</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l02300"></a><span class="lineno"><a class="line" href="../../d7/d30/res__sorcery__memory__cache_8c.html#af9b170dc8108e107601ebfdc5b0ed1ed"> 2300</a></span>&#160;<span class="keyword">static</span> <span class="keyword">struct </span><a class="code" href="../../d2/d88/structast__sorcery.html">ast_sorcery</a> *<a class="code" href="../../d7/d30/res__sorcery__memory__cache_8c.html#af9b170dc8108e107601ebfdc5b0ed1ed">alloc_and_initialize_sorcery</a>(<span class="keywordtype">void</span>)</div><div class="line"><a name="l02301"></a><span class="lineno"> 2301</span>&#160;{</div><div class="line"><a name="l02302"></a><span class="lineno"> 2302</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d2/d88/structast__sorcery.html">ast_sorcery</a> *<a class="code" href="../../d2/d6b/structsorcery__memory__cache.html#aeb33dcb5573e1661c82b5370681fb626">sorcery</a>;</div><div class="line"><a name="l02303"></a><span class="lineno"> 2303</span>&#160;</div><div class="line"><a name="l02304"></a><span class="lineno"> 2304</span>&#160;   <span class="keywordflow">if</span> (!(sorcery = <a class="code" href="../../d8/d25/sorcery_8h.html#ad60f3b81bed748245f8045cb48fadee2">ast_sorcery_open</a>())) {</div><div class="line"><a name="l02305"></a><span class="lineno"> 2305</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l02306"></a><span class="lineno"> 2306</span>&#160;   }</div><div class="line"><a name="l02307"></a><span class="lineno"> 2307</span>&#160;</div><div class="line"><a name="l02308"></a><span class="lineno"> 2308</span>&#160;   <span class="keywordflow">if</span> ((<a class="code" href="../../d8/d25/sorcery_8h.html#ad1165cf9d45ed5ffa1555371be9ae770">ast_sorcery_apply_default</a>(sorcery, <span class="stringliteral">&quot;test&quot;</span>, <span class="stringliteral">&quot;memory&quot;</span>, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) != <a class="code" href="../../d8/d25/sorcery_8h.html#af7a3667fd0c15838da1a7bca838f6eeea2f5cefe801ae693345fd663ad71351be">AST_SORCERY_APPLY_SUCCESS</a>) ||</div><div class="line"><a name="l02309"></a><span class="lineno"> 2309</span>&#160;      <a class="code" href="../../d8/d25/sorcery_8h.html#a6f16dd100bbc816e1d8eb67026ab4ee3">ast_sorcery_internal_object_register</a>(sorcery, <span class="stringliteral">&quot;test&quot;</span>, <a class="code" href="../../d7/d30/res__sorcery__memory__cache_8c.html#a79c1852b8824773f75e2988a04c6abbd">test_sorcery_object_alloc</a>, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)) {</div><div class="line"><a name="l02310"></a><span class="lineno"> 2310</span>&#160;      <a class="code" href="../../d8/d25/sorcery_8h.html#a09cba9c37c702ca2bdcf94052068ed67">ast_sorcery_unref</a>(sorcery);</div><div class="line"><a name="l02311"></a><span class="lineno"> 2311</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l02312"></a><span class="lineno"> 2312</span>&#160;   }</div><div class="line"><a name="l02313"></a><span class="lineno"> 2313</span>&#160;</div><div class="line"><a name="l02314"></a><span class="lineno"> 2314</span>&#160;   <span class="keywordflow">return</span> <a class="code" href="../../d2/d6b/structsorcery__memory__cache.html#aeb33dcb5573e1661c82b5370681fb626">sorcery</a>;</div><div class="line"><a name="l02315"></a><span class="lineno"> 2315</span>&#160;}</div><div class="line"><a name="l02316"></a><span class="lineno"> 2316</span>&#160;</div><div class="line"><a name="l02317"></a><span class="lineno"><a class="line" href="../../d7/d30/res__sorcery__memory__cache_8c.html#af6639c66b2a5eff1e659bf57d5938e54"> 2317</a></span>&#160;<a class="code" href="../../d7/d30/res__sorcery__memory__cache_8c.html#af6639c66b2a5eff1e659bf57d5938e54">AST_TEST_DEFINE</a>(open_with_valid_options)</div><div class="line"><a name="l02318"></a><span class="lineno"> 2318</span>&#160;{</div><div class="line"><a name="l02319"></a><span class="lineno"> 2319</span>&#160;   <span class="keywordtype">int</span> res = <a class="code" href="../../d2/ddc/test_8h.html#aad2aec78205d328d23894a6598cc4044a7a3ab73c870a7ce6cf1a0f3cfd42a37b">AST_TEST_PASS</a>;</div><div class="line"><a name="l02320"></a><span class="lineno"> 2320</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d2/d6b/structsorcery__memory__cache.html">sorcery_memory_cache</a> *<a class="code" href="../../d2/d2c/pbx__realtime_8c.html#aefe318d32c8bb7a9e2025eb146d47781">cache</a>;</div><div class="line"><a name="l02321"></a><span class="lineno"> 2321</span>&#160;</div><div class="line"><a name="l02322"></a><span class="lineno"> 2322</span>&#160;   <span class="keywordflow">switch</span> (cmd) {</div><div class="line"><a name="l02323"></a><span class="lineno"> 2323</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="../../d2/ddc/test_8h.html#a0689ac4326c7a771e1b6ed1e4cde53e2a21df97525a6ac371a7fb604dfa8ea67b">TEST_INIT</a>:</div><div class="line"><a name="l02324"></a><span class="lineno"> 2324</span>&#160;      <a class="code" href="../../dd/d17/namespacesip__to__pjsip.html#ab82f408a83ecba10ea39afd8abfd371e">info</a>-&gt;name = <span class="stringliteral">&quot;open_with_valid_options&quot;</span>;</div><div class="line"><a name="l02325"></a><span class="lineno"> 2325</span>&#160;      <a class="code" href="../../dd/d17/namespacesip__to__pjsip.html#ab82f408a83ecba10ea39afd8abfd371e">info</a>-&gt;category = <span class="stringliteral">&quot;/res/res_sorcery_memory_cache/&quot;</span>;</div><div class="line"><a name="l02326"></a><span class="lineno"> 2326</span>&#160;      <a class="code" href="../../dd/d17/namespacesip__to__pjsip.html#ab82f408a83ecba10ea39afd8abfd371e">info</a>-&gt;summary = <span class="stringliteral">&quot;Attempt to create sorcery memory caches using valid options&quot;</span>;</div><div class="line"><a name="l02327"></a><span class="lineno"> 2327</span>&#160;      <a class="code" href="../../dd/d17/namespacesip__to__pjsip.html#ab82f408a83ecba10ea39afd8abfd371e">info</a>-&gt;description = <span class="stringliteral">&quot;This test performs the following:\n&quot;</span></div><div class="line"><a name="l02328"></a><span class="lineno"> 2328</span>&#160;         <span class="stringliteral">&quot;\t* Creates a memory cache with default configuration\n&quot;</span></div><div class="line"><a name="l02329"></a><span class="lineno"> 2329</span>&#160;         <span class="stringliteral">&quot;\t* Creates a memory cache with a maximum object count of 10 and verifies it\n&quot;</span></div><div class="line"><a name="l02330"></a><span class="lineno"> 2330</span>&#160;         <span class="stringliteral">&quot;\t* Creates a memory cache with a maximum object lifetime of 60 and verifies it\n&quot;</span></div><div class="line"><a name="l02331"></a><span class="lineno"> 2331</span>&#160;         <span class="stringliteral">&quot;\t* Creates a memory cache with a stale object lifetime of 90 and verifies it&quot;</span>;</div><div class="line"><a name="l02332"></a><span class="lineno"> 2332</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../d2/ddc/test_8h.html#aad2aec78205d328d23894a6598cc4044a8cf2ae27807baf798d726d630693cc8c">AST_TEST_NOT_RUN</a>;</div><div class="line"><a name="l02333"></a><span class="lineno"> 2333</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="../../d2/ddc/test_8h.html#a0689ac4326c7a771e1b6ed1e4cde53e2adb2586ef58bb9dd2f84a7d592ecf3e0e">TEST_EXECUTE</a>:</div><div class="line"><a name="l02334"></a><span class="lineno"> 2334</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l02335"></a><span class="lineno"> 2335</span>&#160;   }</div><div class="line"><a name="l02336"></a><span class="lineno"> 2336</span>&#160;</div><div class="line"><a name="l02337"></a><span class="lineno"> 2337</span>&#160;   cache = <a class="code" href="../../d7/d30/res__sorcery__memory__cache_8c.html#a73c11b5eb7314f2dbd3f32d18b69b10f">sorcery_memory_cache_open</a>(<span class="stringliteral">&quot;&quot;</span>);</div><div class="line"><a name="l02338"></a><span class="lineno"> 2338</span>&#160;   <span class="keywordflow">if</span> (!cache) {</div><div class="line"><a name="l02339"></a><span class="lineno"> 2339</span>&#160;      <a class="code" href="../../d2/ddc/test_8h.html#a5e8fddded61f6989172c981256e7c9bd">ast_test_status_update</a>(<a class="code" href="../../d8/d89/structtest.html">test</a>, <span class="stringliteral">&quot;Failed to create a sorcery memory cache using default configuration\n&quot;</span>);</div><div class="line"><a name="l02340"></a><span class="lineno"> 2340</span>&#160;      res = <a class="code" href="../../d2/ddc/test_8h.html#aad2aec78205d328d23894a6598cc4044a8a11a3a19eb4c9fd2ba654d95df1adb6">AST_TEST_FAIL</a>;</div><div class="line"><a name="l02341"></a><span class="lineno"> 2341</span>&#160;   } <span class="keywordflow">else</span> {</div><div class="line"><a name="l02342"></a><span class="lineno"> 2342</span>&#160;      <a class="code" href="../../d7/d30/res__sorcery__memory__cache_8c.html#a9f6a8b7453ee946fb55fac3b0237f514">sorcery_memory_cache_close</a>(cache);</div><div class="line"><a name="l02343"></a><span class="lineno"> 2343</span>&#160;   }</div><div class="line"><a name="l02344"></a><span class="lineno"> 2344</span>&#160;</div><div class="line"><a name="l02345"></a><span class="lineno"> 2345</span>&#160;   cache = <a class="code" href="../../d7/d30/res__sorcery__memory__cache_8c.html#a73c11b5eb7314f2dbd3f32d18b69b10f">sorcery_memory_cache_open</a>(<span class="stringliteral">&quot;maximum_objects=10&quot;</span>);</div><div class="line"><a name="l02346"></a><span class="lineno"> 2346</span>&#160;   <span class="keywordflow">if</span> (!cache) {</div><div class="line"><a name="l02347"></a><span class="lineno"> 2347</span>&#160;      <a class="code" href="../../d2/ddc/test_8h.html#a5e8fddded61f6989172c981256e7c9bd">ast_test_status_update</a>(<a class="code" href="../../d8/d89/structtest.html">test</a>, <span class="stringliteral">&quot;Failed to create a sorcery memory cache with a maximum object count of 10\n&quot;</span>);</div><div class="line"><a name="l02348"></a><span class="lineno"> 2348</span>&#160;      res = <a class="code" href="../../d2/ddc/test_8h.html#aad2aec78205d328d23894a6598cc4044a8a11a3a19eb4c9fd2ba654d95df1adb6">AST_TEST_FAIL</a>;</div><div class="line"><a name="l02349"></a><span class="lineno"> 2349</span>&#160;   } <span class="keywordflow">else</span> {</div><div class="line"><a name="l02350"></a><span class="lineno"> 2350</span>&#160;      <span class="keywordflow">if</span> (cache-&gt;<a class="code" href="../../d2/d6b/structsorcery__memory__cache.html#a73ce7cbebacf7170f054f846300d67ff">maximum_objects</a> != 10) {</div><div class="line"><a name="l02351"></a><span class="lineno"> 2351</span>&#160;         <a class="code" href="../../d2/ddc/test_8h.html#a5e8fddded61f6989172c981256e7c9bd">ast_test_status_update</a>(<a class="code" href="../../d8/d89/structtest.html">test</a>, <span class="stringliteral">&quot;Created a sorcery memory cache with a maximum object count of 10 but it has &#39;%u&#39;\n&quot;</span>,</div><div class="line"><a name="l02352"></a><span class="lineno"> 2352</span>&#160;            cache-&gt;<a class="code" href="../../d2/d6b/structsorcery__memory__cache.html#a73ce7cbebacf7170f054f846300d67ff">maximum_objects</a>);</div><div class="line"><a name="l02353"></a><span class="lineno"> 2353</span>&#160;      }</div><div class="line"><a name="l02354"></a><span class="lineno"> 2354</span>&#160;      <a class="code" href="../../d7/d30/res__sorcery__memory__cache_8c.html#a9f6a8b7453ee946fb55fac3b0237f514">sorcery_memory_cache_close</a>(cache);</div><div class="line"><a name="l02355"></a><span class="lineno"> 2355</span>&#160;   }</div><div class="line"><a name="l02356"></a><span class="lineno"> 2356</span>&#160;</div><div class="line"><a name="l02357"></a><span class="lineno"> 2357</span>&#160;   cache = <a class="code" href="../../d7/d30/res__sorcery__memory__cache_8c.html#a73c11b5eb7314f2dbd3f32d18b69b10f">sorcery_memory_cache_open</a>(<span class="stringliteral">&quot;object_lifetime_maximum=60&quot;</span>);</div><div class="line"><a name="l02358"></a><span class="lineno"> 2358</span>&#160;   <span class="keywordflow">if</span> (!cache) {</div><div class="line"><a name="l02359"></a><span class="lineno"> 2359</span>&#160;      <a class="code" href="../../d2/ddc/test_8h.html#a5e8fddded61f6989172c981256e7c9bd">ast_test_status_update</a>(<a class="code" href="../../d8/d89/structtest.html">test</a>, <span class="stringliteral">&quot;Failed to create a sorcery memory cache with a maximum object lifetime of 60\n&quot;</span>);</div><div class="line"><a name="l02360"></a><span class="lineno"> 2360</span>&#160;      res = <a class="code" href="../../d2/ddc/test_8h.html#aad2aec78205d328d23894a6598cc4044a8a11a3a19eb4c9fd2ba654d95df1adb6">AST_TEST_FAIL</a>;</div><div class="line"><a name="l02361"></a><span class="lineno"> 2361</span>&#160;   } <span class="keywordflow">else</span> {</div><div class="line"><a name="l02362"></a><span class="lineno"> 2362</span>&#160;      <span class="keywordflow">if</span> (cache-&gt;<a class="code" href="../../d2/d6b/structsorcery__memory__cache.html#a890cd2c933f495837f720efe44aa9642">object_lifetime_maximum</a> != 60) {</div><div class="line"><a name="l02363"></a><span class="lineno"> 2363</span>&#160;         <a class="code" href="../../d2/ddc/test_8h.html#a5e8fddded61f6989172c981256e7c9bd">ast_test_status_update</a>(<a class="code" href="../../d8/d89/structtest.html">test</a>, <span class="stringliteral">&quot;Created a sorcery memory cache with a maximum object lifetime of 60 but it has &#39;%u&#39;\n&quot;</span>,</div><div class="line"><a name="l02364"></a><span class="lineno"> 2364</span>&#160;            cache-&gt;<a class="code" href="../../d2/d6b/structsorcery__memory__cache.html#a890cd2c933f495837f720efe44aa9642">object_lifetime_maximum</a>);</div><div class="line"><a name="l02365"></a><span class="lineno"> 2365</span>&#160;      }</div><div class="line"><a name="l02366"></a><span class="lineno"> 2366</span>&#160;      <a class="code" href="../../d7/d30/res__sorcery__memory__cache_8c.html#a9f6a8b7453ee946fb55fac3b0237f514">sorcery_memory_cache_close</a>(cache);</div><div class="line"><a name="l02367"></a><span class="lineno"> 2367</span>&#160;   }</div><div class="line"><a name="l02368"></a><span class="lineno"> 2368</span>&#160;</div><div class="line"><a name="l02369"></a><span class="lineno"> 2369</span>&#160;   cache = <a class="code" href="../../d7/d30/res__sorcery__memory__cache_8c.html#a73c11b5eb7314f2dbd3f32d18b69b10f">sorcery_memory_cache_open</a>(<span class="stringliteral">&quot;object_lifetime_stale=90&quot;</span>);</div><div class="line"><a name="l02370"></a><span class="lineno"> 2370</span>&#160;   <span class="keywordflow">if</span> (!cache) {</div><div class="line"><a name="l02371"></a><span class="lineno"> 2371</span>&#160;      <a class="code" href="../../d2/ddc/test_8h.html#a5e8fddded61f6989172c981256e7c9bd">ast_test_status_update</a>(<a class="code" href="../../d8/d89/structtest.html">test</a>, <span class="stringliteral">&quot;Failed to create a sorcery memory cache with a stale object lifetime of 90\n&quot;</span>);</div><div class="line"><a name="l02372"></a><span class="lineno"> 2372</span>&#160;      res = <a class="code" href="../../d2/ddc/test_8h.html#aad2aec78205d328d23894a6598cc4044a8a11a3a19eb4c9fd2ba654d95df1adb6">AST_TEST_FAIL</a>;</div><div class="line"><a name="l02373"></a><span class="lineno"> 2373</span>&#160;   } <span class="keywordflow">else</span> {</div><div class="line"><a name="l02374"></a><span class="lineno"> 2374</span>&#160;      <span class="keywordflow">if</span> (cache-&gt;<a class="code" href="../../d2/d6b/structsorcery__memory__cache.html#a89b193072cd806e8e239c9a448463efe">object_lifetime_stale</a> != 90) {</div><div class="line"><a name="l02375"></a><span class="lineno"> 2375</span>&#160;         <a class="code" href="../../d2/ddc/test_8h.html#a5e8fddded61f6989172c981256e7c9bd">ast_test_status_update</a>(<a class="code" href="../../d8/d89/structtest.html">test</a>, <span class="stringliteral">&quot;Created a sorcery memory cache with a stale object lifetime of 90 but it has &#39;%u&#39;\n&quot;</span>,</div><div class="line"><a name="l02376"></a><span class="lineno"> 2376</span>&#160;            cache-&gt;<a class="code" href="../../d2/d6b/structsorcery__memory__cache.html#a89b193072cd806e8e239c9a448463efe">object_lifetime_stale</a>);</div><div class="line"><a name="l02377"></a><span class="lineno"> 2377</span>&#160;      }</div><div class="line"><a name="l02378"></a><span class="lineno"> 2378</span>&#160;      <a class="code" href="../../d7/d30/res__sorcery__memory__cache_8c.html#a9f6a8b7453ee946fb55fac3b0237f514">sorcery_memory_cache_close</a>(cache);</div><div class="line"><a name="l02379"></a><span class="lineno"> 2379</span>&#160;   }</div><div class="line"><a name="l02380"></a><span class="lineno"> 2380</span>&#160;</div><div class="line"><a name="l02381"></a><span class="lineno"> 2381</span>&#160;</div><div class="line"><a name="l02382"></a><span class="lineno"> 2382</span>&#160;   <span class="keywordflow">return</span> res;</div><div class="line"><a name="l02383"></a><span class="lineno"> 2383</span>&#160;}</div><div class="line"><a name="l02384"></a><span class="lineno"> 2384</span>&#160;</div><div class="line"><a name="l02385"></a><span class="lineno"><a class="line" href="../../d7/d30/res__sorcery__memory__cache_8c.html#ac9c0dda3673b2ab9bfeee9359deef067"> 2385</a></span>&#160;<a class="code" href="../../d7/d30/res__sorcery__memory__cache_8c.html#af6639c66b2a5eff1e659bf57d5938e54">AST_TEST_DEFINE</a>(open_with_invalid_options)</div><div class="line"><a name="l02386"></a><span class="lineno"> 2386</span>&#160;{</div><div class="line"><a name="l02387"></a><span class="lineno"> 2387</span>&#160;   <span class="keywordtype">int</span> res = <a class="code" href="../../d2/ddc/test_8h.html#aad2aec78205d328d23894a6598cc4044a7a3ab73c870a7ce6cf1a0f3cfd42a37b">AST_TEST_PASS</a>;</div><div class="line"><a name="l02388"></a><span class="lineno"> 2388</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d2/d6b/structsorcery__memory__cache.html">sorcery_memory_cache</a> *<a class="code" href="../../d2/d2c/pbx__realtime_8c.html#aefe318d32c8bb7a9e2025eb146d47781">cache</a>;</div><div class="line"><a name="l02389"></a><span class="lineno"> 2389</span>&#160;</div><div class="line"><a name="l02390"></a><span class="lineno"> 2390</span>&#160;   <span class="keywordflow">switch</span> (cmd) {</div><div class="line"><a name="l02391"></a><span class="lineno"> 2391</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="../../d2/ddc/test_8h.html#a0689ac4326c7a771e1b6ed1e4cde53e2a21df97525a6ac371a7fb604dfa8ea67b">TEST_INIT</a>:</div><div class="line"><a name="l02392"></a><span class="lineno"> 2392</span>&#160;      <a class="code" href="../../dd/d17/namespacesip__to__pjsip.html#ab82f408a83ecba10ea39afd8abfd371e">info</a>-&gt;name = <span class="stringliteral">&quot;open_with_invalid_options&quot;</span>;</div><div class="line"><a name="l02393"></a><span class="lineno"> 2393</span>&#160;      <a class="code" href="../../dd/d17/namespacesip__to__pjsip.html#ab82f408a83ecba10ea39afd8abfd371e">info</a>-&gt;category = <span class="stringliteral">&quot;/res/res_sorcery_memory_cache/&quot;</span>;</div><div class="line"><a name="l02394"></a><span class="lineno"> 2394</span>&#160;      <a class="code" href="../../dd/d17/namespacesip__to__pjsip.html#ab82f408a83ecba10ea39afd8abfd371e">info</a>-&gt;summary = <span class="stringliteral">&quot;Attempt to create sorcery memory caches using invalid options&quot;</span>;</div><div class="line"><a name="l02395"></a><span class="lineno"> 2395</span>&#160;      <a class="code" href="../../dd/d17/namespacesip__to__pjsip.html#ab82f408a83ecba10ea39afd8abfd371e">info</a>-&gt;description = <span class="stringliteral">&quot;This test attempts to perform the following:\n&quot;</span></div><div class="line"><a name="l02396"></a><span class="lineno"> 2396</span>&#160;         <span class="stringliteral">&quot;\t* Create a memory cache with an empty name\n&quot;</span></div><div class="line"><a name="l02397"></a><span class="lineno"> 2397</span>&#160;         <span class="stringliteral">&quot;\t* Create a memory cache with a maximum object count of -1\n&quot;</span></div><div class="line"><a name="l02398"></a><span class="lineno"> 2398</span>&#160;         <span class="stringliteral">&quot;\t* Create a memory cache with a maximum object count of toast\n&quot;</span></div><div class="line"><a name="l02399"></a><span class="lineno"> 2399</span>&#160;         <span class="stringliteral">&quot;\t* Create a memory cache with a maximum object lifetime of -1\n&quot;</span></div><div class="line"><a name="l02400"></a><span class="lineno"> 2400</span>&#160;         <span class="stringliteral">&quot;\t* Create a memory cache with a maximum object lifetime of toast\n&quot;</span></div><div class="line"><a name="l02401"></a><span class="lineno"> 2401</span>&#160;         <span class="stringliteral">&quot;\t* Create a memory cache with a stale object lifetime of -1\n&quot;</span></div><div class="line"><a name="l02402"></a><span class="lineno"> 2402</span>&#160;         <span class="stringliteral">&quot;\t* Create a memory cache with a stale object lifetime of toast&quot;</span>;</div><div class="line"><a name="l02403"></a><span class="lineno"> 2403</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../d2/ddc/test_8h.html#aad2aec78205d328d23894a6598cc4044a8cf2ae27807baf798d726d630693cc8c">AST_TEST_NOT_RUN</a>;</div><div class="line"><a name="l02404"></a><span class="lineno"> 2404</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="../../d2/ddc/test_8h.html#a0689ac4326c7a771e1b6ed1e4cde53e2adb2586ef58bb9dd2f84a7d592ecf3e0e">TEST_EXECUTE</a>:</div><div class="line"><a name="l02405"></a><span class="lineno"> 2405</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l02406"></a><span class="lineno"> 2406</span>&#160;   }</div><div class="line"><a name="l02407"></a><span class="lineno"> 2407</span>&#160;</div><div class="line"><a name="l02408"></a><span class="lineno"> 2408</span>&#160;   cache = <a class="code" href="../../d7/d30/res__sorcery__memory__cache_8c.html#a73c11b5eb7314f2dbd3f32d18b69b10f">sorcery_memory_cache_open</a>(<span class="stringliteral">&quot;name=&quot;</span>);</div><div class="line"><a name="l02409"></a><span class="lineno"> 2409</span>&#160;   <span class="keywordflow">if</span> (cache) {</div><div class="line"><a name="l02410"></a><span class="lineno"> 2410</span>&#160;      <a class="code" href="../../d2/ddc/test_8h.html#a5e8fddded61f6989172c981256e7c9bd">ast_test_status_update</a>(<a class="code" href="../../d8/d89/structtest.html">test</a>, <span class="stringliteral">&quot;Created a sorcery memory cache with an empty name\n&quot;</span>);</div><div class="line"><a name="l02411"></a><span class="lineno"> 2411</span>&#160;      <a class="code" href="../../d7/d30/res__sorcery__memory__cache_8c.html#a9f6a8b7453ee946fb55fac3b0237f514">sorcery_memory_cache_close</a>(cache);</div><div class="line"><a name="l02412"></a><span class="lineno"> 2412</span>&#160;      res = <a class="code" href="../../d2/ddc/test_8h.html#aad2aec78205d328d23894a6598cc4044a8a11a3a19eb4c9fd2ba654d95df1adb6">AST_TEST_FAIL</a>;</div><div class="line"><a name="l02413"></a><span class="lineno"> 2413</span>&#160;   }</div><div class="line"><a name="l02414"></a><span class="lineno"> 2414</span>&#160;</div><div class="line"><a name="l02415"></a><span class="lineno"> 2415</span>&#160;   cache = <a class="code" href="../../d7/d30/res__sorcery__memory__cache_8c.html#a73c11b5eb7314f2dbd3f32d18b69b10f">sorcery_memory_cache_open</a>(<span class="stringliteral">&quot;maximum_objects=-1&quot;</span>);</div><div class="line"><a name="l02416"></a><span class="lineno"> 2416</span>&#160;   <span class="keywordflow">if</span> (cache) {</div><div class="line"><a name="l02417"></a><span class="lineno"> 2417</span>&#160;      <a class="code" href="../../d2/ddc/test_8h.html#a5e8fddded61f6989172c981256e7c9bd">ast_test_status_update</a>(<a class="code" href="../../d8/d89/structtest.html">test</a>, <span class="stringliteral">&quot;Created a sorcery memory cache with a maximum object count of -1\n&quot;</span>);</div><div class="line"><a name="l02418"></a><span class="lineno"> 2418</span>&#160;      <a class="code" href="../../d7/d30/res__sorcery__memory__cache_8c.html#a9f6a8b7453ee946fb55fac3b0237f514">sorcery_memory_cache_close</a>(cache);</div><div class="line"><a name="l02419"></a><span class="lineno"> 2419</span>&#160;      res = <a class="code" href="../../d2/ddc/test_8h.html#aad2aec78205d328d23894a6598cc4044a8a11a3a19eb4c9fd2ba654d95df1adb6">AST_TEST_FAIL</a>;</div><div class="line"><a name="l02420"></a><span class="lineno"> 2420</span>&#160;   }</div><div class="line"><a name="l02421"></a><span class="lineno"> 2421</span>&#160;</div><div class="line"><a name="l02422"></a><span class="lineno"> 2422</span>&#160;   cache = <a class="code" href="../../d7/d30/res__sorcery__memory__cache_8c.html#a73c11b5eb7314f2dbd3f32d18b69b10f">sorcery_memory_cache_open</a>(<span class="stringliteral">&quot;maximum_objects=toast&quot;</span>);</div><div class="line"><a name="l02423"></a><span class="lineno"> 2423</span>&#160;   <span class="keywordflow">if</span> (cache) {</div><div class="line"><a name="l02424"></a><span class="lineno"> 2424</span>&#160;      <a class="code" href="../../d2/ddc/test_8h.html#a5e8fddded61f6989172c981256e7c9bd">ast_test_status_update</a>(<a class="code" href="../../d8/d89/structtest.html">test</a>, <span class="stringliteral">&quot;Created a sorcery memory cache with a maximum object count of toast\n&quot;</span>);</div><div class="line"><a name="l02425"></a><span class="lineno"> 2425</span>&#160;      <a class="code" href="../../d7/d30/res__sorcery__memory__cache_8c.html#a9f6a8b7453ee946fb55fac3b0237f514">sorcery_memory_cache_close</a>(cache);</div><div class="line"><a name="l02426"></a><span class="lineno"> 2426</span>&#160;      res = <a class="code" href="../../d2/ddc/test_8h.html#aad2aec78205d328d23894a6598cc4044a8a11a3a19eb4c9fd2ba654d95df1adb6">AST_TEST_FAIL</a>;</div><div class="line"><a name="l02427"></a><span class="lineno"> 2427</span>&#160;   }</div><div class="line"><a name="l02428"></a><span class="lineno"> 2428</span>&#160;</div><div class="line"><a name="l02429"></a><span class="lineno"> 2429</span>&#160;   cache = <a class="code" href="../../d7/d30/res__sorcery__memory__cache_8c.html#a73c11b5eb7314f2dbd3f32d18b69b10f">sorcery_memory_cache_open</a>(<span class="stringliteral">&quot;object_lifetime_maximum=-1&quot;</span>);</div><div class="line"><a name="l02430"></a><span class="lineno"> 2430</span>&#160;   <span class="keywordflow">if</span> (cache) {</div><div class="line"><a name="l02431"></a><span class="lineno"> 2431</span>&#160;      <a class="code" href="../../d2/ddc/test_8h.html#a5e8fddded61f6989172c981256e7c9bd">ast_test_status_update</a>(<a class="code" href="../../d8/d89/structtest.html">test</a>, <span class="stringliteral">&quot;Created a sorcery memory cache with an object lifetime maximum of -1\n&quot;</span>);</div><div class="line"><a name="l02432"></a><span class="lineno"> 2432</span>&#160;      <a class="code" href="../../d7/d30/res__sorcery__memory__cache_8c.html#a9f6a8b7453ee946fb55fac3b0237f514">sorcery_memory_cache_close</a>(cache);</div><div class="line"><a name="l02433"></a><span class="lineno"> 2433</span>&#160;      res = <a class="code" href="../../d2/ddc/test_8h.html#aad2aec78205d328d23894a6598cc4044a8a11a3a19eb4c9fd2ba654d95df1adb6">AST_TEST_FAIL</a>;</div><div class="line"><a name="l02434"></a><span class="lineno"> 2434</span>&#160;   }</div><div class="line"><a name="l02435"></a><span class="lineno"> 2435</span>&#160;</div><div class="line"><a name="l02436"></a><span class="lineno"> 2436</span>&#160;   cache = <a class="code" href="../../d7/d30/res__sorcery__memory__cache_8c.html#a73c11b5eb7314f2dbd3f32d18b69b10f">sorcery_memory_cache_open</a>(<span class="stringliteral">&quot;object_lifetime_maximum=toast&quot;</span>);</div><div class="line"><a name="l02437"></a><span class="lineno"> 2437</span>&#160;   <span class="keywordflow">if</span> (cache) {</div><div class="line"><a name="l02438"></a><span class="lineno"> 2438</span>&#160;      <a class="code" href="../../d2/ddc/test_8h.html#a5e8fddded61f6989172c981256e7c9bd">ast_test_status_update</a>(<a class="code" href="../../d8/d89/structtest.html">test</a>, <span class="stringliteral">&quot;Created a sorcery memory cache with an object lifetime maximum of toast\n&quot;</span>);</div><div class="line"><a name="l02439"></a><span class="lineno"> 2439</span>&#160;      <a class="code" href="../../d7/d30/res__sorcery__memory__cache_8c.html#a9f6a8b7453ee946fb55fac3b0237f514">sorcery_memory_cache_close</a>(cache);</div><div class="line"><a name="l02440"></a><span class="lineno"> 2440</span>&#160;      res = <a class="code" href="../../d2/ddc/test_8h.html#aad2aec78205d328d23894a6598cc4044a8a11a3a19eb4c9fd2ba654d95df1adb6">AST_TEST_FAIL</a>;</div><div class="line"><a name="l02441"></a><span class="lineno"> 2441</span>&#160;   }</div><div class="line"><a name="l02442"></a><span class="lineno"> 2442</span>&#160;</div><div class="line"><a name="l02443"></a><span class="lineno"> 2443</span>&#160;   cache = <a class="code" href="../../d7/d30/res__sorcery__memory__cache_8c.html#a73c11b5eb7314f2dbd3f32d18b69b10f">sorcery_memory_cache_open</a>(<span class="stringliteral">&quot;object_lifetime_stale=-1&quot;</span>);</div><div class="line"><a name="l02444"></a><span class="lineno"> 2444</span>&#160;   <span class="keywordflow">if</span> (cache) {</div><div class="line"><a name="l02445"></a><span class="lineno"> 2445</span>&#160;      <a class="code" href="../../d2/ddc/test_8h.html#a5e8fddded61f6989172c981256e7c9bd">ast_test_status_update</a>(<a class="code" href="../../d8/d89/structtest.html">test</a>, <span class="stringliteral">&quot;Created a sorcery memory cache with a stale object lifetime of -1\n&quot;</span>);</div><div class="line"><a name="l02446"></a><span class="lineno"> 2446</span>&#160;      <a class="code" href="../../d7/d30/res__sorcery__memory__cache_8c.html#a9f6a8b7453ee946fb55fac3b0237f514">sorcery_memory_cache_close</a>(cache);</div><div class="line"><a name="l02447"></a><span class="lineno"> 2447</span>&#160;      res = <a class="code" href="../../d2/ddc/test_8h.html#aad2aec78205d328d23894a6598cc4044a8a11a3a19eb4c9fd2ba654d95df1adb6">AST_TEST_FAIL</a>;</div><div class="line"><a name="l02448"></a><span class="lineno"> 2448</span>&#160;   }</div><div class="line"><a name="l02449"></a><span class="lineno"> 2449</span>&#160;</div><div class="line"><a name="l02450"></a><span class="lineno"> 2450</span>&#160;   cache = <a class="code" href="../../d7/d30/res__sorcery__memory__cache_8c.html#a73c11b5eb7314f2dbd3f32d18b69b10f">sorcery_memory_cache_open</a>(<span class="stringliteral">&quot;object_lifetime_stale=toast&quot;</span>);</div><div class="line"><a name="l02451"></a><span class="lineno"> 2451</span>&#160;   <span class="keywordflow">if</span> (cache) {</div><div class="line"><a name="l02452"></a><span class="lineno"> 2452</span>&#160;      <a class="code" href="../../d2/ddc/test_8h.html#a5e8fddded61f6989172c981256e7c9bd">ast_test_status_update</a>(<a class="code" href="../../d8/d89/structtest.html">test</a>, <span class="stringliteral">&quot;Created a sorcery memory cache with a stale object lifetime of toast\n&quot;</span>);</div><div class="line"><a name="l02453"></a><span class="lineno"> 2453</span>&#160;      <a class="code" href="../../d7/d30/res__sorcery__memory__cache_8c.html#a9f6a8b7453ee946fb55fac3b0237f514">sorcery_memory_cache_close</a>(cache);</div><div class="line"><a name="l02454"></a><span class="lineno"> 2454</span>&#160;      res = <a class="code" href="../../d2/ddc/test_8h.html#aad2aec78205d328d23894a6598cc4044a8a11a3a19eb4c9fd2ba654d95df1adb6">AST_TEST_FAIL</a>;</div><div class="line"><a name="l02455"></a><span class="lineno"> 2455</span>&#160;   }</div><div class="line"><a name="l02456"></a><span class="lineno"> 2456</span>&#160;</div><div class="line"><a name="l02457"></a><span class="lineno"> 2457</span>&#160;   cache = <a class="code" href="../../d7/d30/res__sorcery__memory__cache_8c.html#a73c11b5eb7314f2dbd3f32d18b69b10f">sorcery_memory_cache_open</a>(<span class="stringliteral">&quot;tacos&quot;</span>);</div><div class="line"><a name="l02458"></a><span class="lineno"> 2458</span>&#160;   <span class="keywordflow">if</span> (cache) {</div><div class="line"><a name="l02459"></a><span class="lineno"> 2459</span>&#160;      <a class="code" href="../../d2/ddc/test_8h.html#a5e8fddded61f6989172c981256e7c9bd">ast_test_status_update</a>(<a class="code" href="../../d8/d89/structtest.html">test</a>, <span class="stringliteral">&quot;Created a sorcery memory cache with an invalid configuration option &#39;tacos&#39;\n&quot;</span>);</div><div class="line"><a name="l02460"></a><span class="lineno"> 2460</span>&#160;      <a class="code" href="../../d7/d30/res__sorcery__memory__cache_8c.html#a9f6a8b7453ee946fb55fac3b0237f514">sorcery_memory_cache_close</a>(cache);</div><div class="line"><a name="l02461"></a><span class="lineno"> 2461</span>&#160;      res = <a class="code" href="../../d2/ddc/test_8h.html#aad2aec78205d328d23894a6598cc4044a8a11a3a19eb4c9fd2ba654d95df1adb6">AST_TEST_FAIL</a>;</div><div class="line"><a name="l02462"></a><span class="lineno"> 2462</span>&#160;   }</div><div class="line"><a name="l02463"></a><span class="lineno"> 2463</span>&#160;</div><div class="line"><a name="l02464"></a><span class="lineno"> 2464</span>&#160;   <span class="keywordflow">return</span> res;</div><div class="line"><a name="l02465"></a><span class="lineno"> 2465</span>&#160;}</div><div class="line"><a name="l02466"></a><span class="lineno"> 2466</span>&#160;</div><div class="line"><a name="l02467"></a><span class="lineno"><a class="line" href="../../d7/d30/res__sorcery__memory__cache_8c.html#a0d46d8f39e496fbcc648fe7401bb4be9"> 2467</a></span>&#160;<a class="code" href="../../d7/d30/res__sorcery__memory__cache_8c.html#af6639c66b2a5eff1e659bf57d5938e54">AST_TEST_DEFINE</a>(create_and_retrieve)</div><div class="line"><a name="l02468"></a><span class="lineno"> 2468</span>&#160;{</div><div class="line"><a name="l02469"></a><span class="lineno"> 2469</span>&#160;   <span class="keywordtype">int</span> res = <a class="code" href="../../d2/ddc/test_8h.html#aad2aec78205d328d23894a6598cc4044a8a11a3a19eb4c9fd2ba654d95df1adb6">AST_TEST_FAIL</a>;</div><div class="line"><a name="l02470"></a><span class="lineno"> 2470</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d2/d88/structast__sorcery.html">ast_sorcery</a> *<a class="code" href="../../d2/d6b/structsorcery__memory__cache.html#aeb33dcb5573e1661c82b5370681fb626">sorcery</a> = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l02471"></a><span class="lineno"> 2471</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d2/d6b/structsorcery__memory__cache.html">sorcery_memory_cache</a> *cache = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l02472"></a><span class="lineno"> 2472</span>&#160;   <a class="code" href="../../d5/d60/utils_8h.html#a1604b4d72144dd3d9f7da668e90337e9">RAII_VAR</a>(<span class="keywordtype">void</span> *, <span class="keywordtype">object</span>, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../d5/da5/astobj2_8h.html#a6321ee982370c55ab3c24c72c562cbdd">ao2_cleanup</a>);</div><div class="line"><a name="l02473"></a><span class="lineno"> 2473</span>&#160;   <a class="code" href="../../d5/d60/utils_8h.html#a1604b4d72144dd3d9f7da668e90337e9">RAII_VAR</a>(<span class="keywordtype">void</span> *, cached_object, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../d5/da5/astobj2_8h.html#a6321ee982370c55ab3c24c72c562cbdd">ao2_cleanup</a>);</div><div class="line"><a name="l02474"></a><span class="lineno"> 2474</span>&#160;</div><div class="line"><a name="l02475"></a><span class="lineno"> 2475</span>&#160;   <span class="keywordflow">switch</span> (cmd) {</div><div class="line"><a name="l02476"></a><span class="lineno"> 2476</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="../../d2/ddc/test_8h.html#a0689ac4326c7a771e1b6ed1e4cde53e2a21df97525a6ac371a7fb604dfa8ea67b">TEST_INIT</a>:</div><div class="line"><a name="l02477"></a><span class="lineno"> 2477</span>&#160;      <a class="code" href="../../dd/d17/namespacesip__to__pjsip.html#ab82f408a83ecba10ea39afd8abfd371e">info</a>-&gt;name = <span class="stringliteral">&quot;create&quot;</span>;</div><div class="line"><a name="l02478"></a><span class="lineno"> 2478</span>&#160;      <a class="code" href="../../dd/d17/namespacesip__to__pjsip.html#ab82f408a83ecba10ea39afd8abfd371e">info</a>-&gt;category = <span class="stringliteral">&quot;/res/res_sorcery_memory_cache/&quot;</span>;</div><div class="line"><a name="l02479"></a><span class="lineno"> 2479</span>&#160;      <a class="code" href="../../dd/d17/namespacesip__to__pjsip.html#ab82f408a83ecba10ea39afd8abfd371e">info</a>-&gt;summary = <span class="stringliteral">&quot;Attempt to create an object in the cache&quot;</span>;</div><div class="line"><a name="l02480"></a><span class="lineno"> 2480</span>&#160;      <a class="code" href="../../dd/d17/namespacesip__to__pjsip.html#ab82f408a83ecba10ea39afd8abfd371e">info</a>-&gt;description = <span class="stringliteral">&quot;This test performs the following:\n&quot;</span></div><div class="line"><a name="l02481"></a><span class="lineno"> 2481</span>&#160;         <span class="stringliteral">&quot;\t* Creates a memory cache with default options\n&quot;</span></div><div class="line"><a name="l02482"></a><span class="lineno"> 2482</span>&#160;         <span class="stringliteral">&quot;\t* Creates a sorcery instance with a test object\n&quot;</span></div><div class="line"><a name="l02483"></a><span class="lineno"> 2483</span>&#160;         <span class="stringliteral">&quot;\t* Creates a test object with an id of test\n&quot;</span></div><div class="line"><a name="l02484"></a><span class="lineno"> 2484</span>&#160;         <span class="stringliteral">&quot;\t* Pushes the test object into the memory cache\n&quot;</span></div><div class="line"><a name="l02485"></a><span class="lineno"> 2485</span>&#160;         <span class="stringliteral">&quot;\t* Confirms that the test object is in the cache&quot;</span>;</div><div class="line"><a name="l02486"></a><span class="lineno"> 2486</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../d2/ddc/test_8h.html#aad2aec78205d328d23894a6598cc4044a8cf2ae27807baf798d726d630693cc8c">AST_TEST_NOT_RUN</a>;</div><div class="line"><a name="l02487"></a><span class="lineno"> 2487</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="../../d2/ddc/test_8h.html#a0689ac4326c7a771e1b6ed1e4cde53e2adb2586ef58bb9dd2f84a7d592ecf3e0e">TEST_EXECUTE</a>:</div><div class="line"><a name="l02488"></a><span class="lineno"> 2488</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l02489"></a><span class="lineno"> 2489</span>&#160;   }</div><div class="line"><a name="l02490"></a><span class="lineno"> 2490</span>&#160;</div><div class="line"><a name="l02491"></a><span class="lineno"> 2491</span>&#160;   cache = <a class="code" href="../../d7/d30/res__sorcery__memory__cache_8c.html#a73c11b5eb7314f2dbd3f32d18b69b10f">sorcery_memory_cache_open</a>(<span class="stringliteral">&quot;&quot;</span>);</div><div class="line"><a name="l02492"></a><span class="lineno"> 2492</span>&#160;   <span class="keywordflow">if</span> (!cache) {</div><div class="line"><a name="l02493"></a><span class="lineno"> 2493</span>&#160;      <a class="code" href="../../d2/ddc/test_8h.html#a5e8fddded61f6989172c981256e7c9bd">ast_test_status_update</a>(<a class="code" href="../../d8/d89/structtest.html">test</a>, <span class="stringliteral">&quot;Failed to create a sorcery memory cache using default options\n&quot;</span>);</div><div class="line"><a name="l02494"></a><span class="lineno"> 2494</span>&#160;      <span class="keywordflow">goto</span> <a class="code" href="../../d2/d2c/pbx__realtime_8c.html#a10b51e1931bd03dd172cbfb9d3d67efb">cleanup</a>;</div><div class="line"><a name="l02495"></a><span class="lineno"> 2495</span>&#160;   }</div><div class="line"><a name="l02496"></a><span class="lineno"> 2496</span>&#160;</div><div class="line"><a name="l02497"></a><span class="lineno"> 2497</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d5/da5/astobj2_8h.html#a512cc40ce96c63b3d5c78040baa4c9cd">ao2_container_count</a>(cache-&gt;<a class="code" href="../../d2/d6b/structsorcery__memory__cache.html#aa0a84e33972901716d6d5a6dcf1a68de">objects</a>)) {</div><div class="line"><a name="l02498"></a><span class="lineno"> 2498</span>&#160;      <a class="code" href="../../d2/ddc/test_8h.html#a5e8fddded61f6989172c981256e7c9bd">ast_test_status_update</a>(<a class="code" href="../../d8/d89/structtest.html">test</a>, <span class="stringliteral">&quot;Memory cache contains cached objects before we added one\n&quot;</span>);</div><div class="line"><a name="l02499"></a><span class="lineno"> 2499</span>&#160;      <span class="keywordflow">goto</span> <a class="code" href="../../d2/d2c/pbx__realtime_8c.html#a10b51e1931bd03dd172cbfb9d3d67efb">cleanup</a>;</div><div class="line"><a name="l02500"></a><span class="lineno"> 2500</span>&#160;   }</div><div class="line"><a name="l02501"></a><span class="lineno"> 2501</span>&#160;</div><div class="line"><a name="l02502"></a><span class="lineno"> 2502</span>&#160;   sorcery = <a class="code" href="../../d7/d30/res__sorcery__memory__cache_8c.html#af9b170dc8108e107601ebfdc5b0ed1ed">alloc_and_initialize_sorcery</a>();</div><div class="line"><a name="l02503"></a><span class="lineno"> 2503</span>&#160;   <span class="keywordflow">if</span> (!sorcery) {</div><div class="line"><a name="l02504"></a><span class="lineno"> 2504</span>&#160;      <a class="code" href="../../d2/ddc/test_8h.html#a5e8fddded61f6989172c981256e7c9bd">ast_test_status_update</a>(<a class="code" href="../../d8/d89/structtest.html">test</a>, <span class="stringliteral">&quot;Failed to create a test sorcery instance\n&quot;</span>);</div><div class="line"><a name="l02505"></a><span class="lineno"> 2505</span>&#160;      <span class="keywordflow">goto</span> <a class="code" href="../../d2/d2c/pbx__realtime_8c.html#a10b51e1931bd03dd172cbfb9d3d67efb">cleanup</a>;</div><div class="line"><a name="l02506"></a><span class="lineno"> 2506</span>&#160;   }</div><div class="line"><a name="l02507"></a><span class="lineno"> 2507</span>&#160;</div><div class="line"><a name="l02508"></a><span class="lineno"> 2508</span>&#160;   <span class="keywordtype">object</span> = <a class="code" href="../../d8/d25/sorcery_8h.html#acb6c97c18566cf94a7ac95a43dd9a816">ast_sorcery_alloc</a>(sorcery, <span class="stringliteral">&quot;test&quot;</span>, <span class="stringliteral">&quot;test&quot;</span>);</div><div class="line"><a name="l02509"></a><span class="lineno"> 2509</span>&#160;   <span class="keywordflow">if</span> (!<span class="keywordtype">object</span>) {</div><div class="line"><a name="l02510"></a><span class="lineno"> 2510</span>&#160;      <a class="code" href="../../d2/ddc/test_8h.html#a5e8fddded61f6989172c981256e7c9bd">ast_test_status_update</a>(<a class="code" href="../../d8/d89/structtest.html">test</a>, <span class="stringliteral">&quot;Failed to allocate a test object\n&quot;</span>);</div><div class="line"><a name="l02511"></a><span class="lineno"> 2511</span>&#160;      <span class="keywordflow">goto</span> <a class="code" href="../../d2/d2c/pbx__realtime_8c.html#a10b51e1931bd03dd172cbfb9d3d67efb">cleanup</a>;</div><div class="line"><a name="l02512"></a><span class="lineno"> 2512</span>&#160;   }</div><div class="line"><a name="l02513"></a><span class="lineno"> 2513</span>&#160;</div><div class="line"><a name="l02514"></a><span class="lineno"> 2514</span>&#160;   <a class="code" href="../../d7/d30/res__sorcery__memory__cache_8c.html#a751f8dcc38eb8ff1f9aee8b2b0c14db0">sorcery_memory_cache_create</a>(sorcery, cache, <span class="keywordtype">object</span>);</div><div class="line"><a name="l02515"></a><span class="lineno"> 2515</span>&#160;</div><div class="line"><a name="l02516"></a><span class="lineno"> 2516</span>&#160;   <span class="keywordflow">if</span> (!<a class="code" href="../../d5/da5/astobj2_8h.html#a512cc40ce96c63b3d5c78040baa4c9cd">ao2_container_count</a>(cache-&gt;<a class="code" href="../../d2/d6b/structsorcery__memory__cache.html#aa0a84e33972901716d6d5a6dcf1a68de">objects</a>)) {</div><div class="line"><a name="l02517"></a><span class="lineno"> 2517</span>&#160;      <a class="code" href="../../d2/ddc/test_8h.html#a5e8fddded61f6989172c981256e7c9bd">ast_test_status_update</a>(<a class="code" href="../../d8/d89/structtest.html">test</a>, <span class="stringliteral">&quot;Added test object to memory cache but cache remains empty\n&quot;</span>);</div><div class="line"><a name="l02518"></a><span class="lineno"> 2518</span>&#160;      <span class="keywordflow">goto</span> <a class="code" href="../../d2/d2c/pbx__realtime_8c.html#a10b51e1931bd03dd172cbfb9d3d67efb">cleanup</a>;</div><div class="line"><a name="l02519"></a><span class="lineno"> 2519</span>&#160;   }</div><div class="line"><a name="l02520"></a><span class="lineno"> 2520</span>&#160;</div><div class="line"><a name="l02521"></a><span class="lineno"> 2521</span>&#160;   cached_object = <a class="code" href="../../d7/d30/res__sorcery__memory__cache_8c.html#a0e33561fb1fc08c9366a5a83eb83583e">sorcery_memory_cache_retrieve_id</a>(sorcery, cache, <span class="stringliteral">&quot;test&quot;</span>, <span class="stringliteral">&quot;test&quot;</span>);</div><div class="line"><a name="l02522"></a><span class="lineno"> 2522</span>&#160;   <span class="keywordflow">if</span> (!cached_object) {</div><div class="line"><a name="l02523"></a><span class="lineno"> 2523</span>&#160;      <a class="code" href="../../d2/ddc/test_8h.html#a5e8fddded61f6989172c981256e7c9bd">ast_test_status_update</a>(<a class="code" href="../../d8/d89/structtest.html">test</a>, <span class="stringliteral">&quot;Object placed into memory cache could not be retrieved\n&quot;</span>);</div><div class="line"><a name="l02524"></a><span class="lineno"> 2524</span>&#160;      <span class="keywordflow">goto</span> <a class="code" href="../../d2/d2c/pbx__realtime_8c.html#a10b51e1931bd03dd172cbfb9d3d67efb">cleanup</a>;</div><div class="line"><a name="l02525"></a><span class="lineno"> 2525</span>&#160;   }</div><div class="line"><a name="l02526"></a><span class="lineno"> 2526</span>&#160;</div><div class="line"><a name="l02527"></a><span class="lineno"> 2527</span>&#160;   <span class="keywordflow">if</span> (cached_object != <span class="keywordtype">object</span>) {</div><div class="line"><a name="l02528"></a><span class="lineno"> 2528</span>&#160;      <a class="code" href="../../d2/ddc/test_8h.html#a5e8fddded61f6989172c981256e7c9bd">ast_test_status_update</a>(<a class="code" href="../../d8/d89/structtest.html">test</a>, <span class="stringliteral">&quot;Object retrieved from memory cached is not the one we cached\n&quot;</span>);</div><div class="line"><a name="l02529"></a><span class="lineno"> 2529</span>&#160;      <span class="keywordflow">goto</span> <a class="code" href="../../d2/d2c/pbx__realtime_8c.html#a10b51e1931bd03dd172cbfb9d3d67efb">cleanup</a>;</div><div class="line"><a name="l02530"></a><span class="lineno"> 2530</span>&#160;   }</div><div class="line"><a name="l02531"></a><span class="lineno"> 2531</span>&#160;</div><div class="line"><a name="l02532"></a><span class="lineno"> 2532</span>&#160;   res = <a class="code" href="../../d2/ddc/test_8h.html#aad2aec78205d328d23894a6598cc4044a7a3ab73c870a7ce6cf1a0f3cfd42a37b">AST_TEST_PASS</a>;</div><div class="line"><a name="l02533"></a><span class="lineno"> 2533</span>&#160;</div><div class="line"><a name="l02534"></a><span class="lineno"> 2534</span>&#160;<a class="code" href="../../d2/d2c/pbx__realtime_8c.html#a10b51e1931bd03dd172cbfb9d3d67efb">cleanup</a>:</div><div class="line"><a name="l02535"></a><span class="lineno"> 2535</span>&#160;   <span class="keywordflow">if</span> (cache) {</div><div class="line"><a name="l02536"></a><span class="lineno"> 2536</span>&#160;      <a class="code" href="../../d7/d30/res__sorcery__memory__cache_8c.html#a9f6a8b7453ee946fb55fac3b0237f514">sorcery_memory_cache_close</a>(cache);</div><div class="line"><a name="l02537"></a><span class="lineno"> 2537</span>&#160;   }</div><div class="line"><a name="l02538"></a><span class="lineno"> 2538</span>&#160;   <span class="keywordflow">if</span> (sorcery) {</div><div class="line"><a name="l02539"></a><span class="lineno"> 2539</span>&#160;      <a class="code" href="../../d8/d25/sorcery_8h.html#a09cba9c37c702ca2bdcf94052068ed67">ast_sorcery_unref</a>(sorcery);</div><div class="line"><a name="l02540"></a><span class="lineno"> 2540</span>&#160;   }</div><div class="line"><a name="l02541"></a><span class="lineno"> 2541</span>&#160;</div><div class="line"><a name="l02542"></a><span class="lineno"> 2542</span>&#160;   <span class="keywordflow">return</span> res;</div><div class="line"><a name="l02543"></a><span class="lineno"> 2543</span>&#160;}</div><div class="line"><a name="l02544"></a><span class="lineno"> 2544</span>&#160;</div><div class="line"><a name="l02545"></a><span class="lineno"><a class="line" href="../../d7/d30/res__sorcery__memory__cache_8c.html#a4af26c9bee5ef32efe9ff8b51b313615"> 2545</a></span>&#160;<a class="code" href="../../d7/d30/res__sorcery__memory__cache_8c.html#af6639c66b2a5eff1e659bf57d5938e54">AST_TEST_DEFINE</a>(<a class="code" href="../../d0/d89/codec__g726_8c.html#a8c58a1d1fd9436ff5145385d3ef7a430">update</a>)</div><div class="line"><a name="l02546"></a><span class="lineno"> 2546</span>&#160;{</div><div class="line"><a name="l02547"></a><span class="lineno"> 2547</span>&#160;   <span class="keywordtype">int</span> res = <a class="code" href="../../d2/ddc/test_8h.html#aad2aec78205d328d23894a6598cc4044a8a11a3a19eb4c9fd2ba654d95df1adb6">AST_TEST_FAIL</a>;</div><div class="line"><a name="l02548"></a><span class="lineno"> 2548</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d2/d88/structast__sorcery.html">ast_sorcery</a> *<a class="code" href="../../d2/d6b/structsorcery__memory__cache.html#aeb33dcb5573e1661c82b5370681fb626">sorcery</a> = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l02549"></a><span class="lineno"> 2549</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d2/d6b/structsorcery__memory__cache.html">sorcery_memory_cache</a> *cache = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l02550"></a><span class="lineno"> 2550</span>&#160;   <a class="code" href="../../d5/d60/utils_8h.html#a1604b4d72144dd3d9f7da668e90337e9">RAII_VAR</a>(<span class="keywordtype">void</span> *, original_object, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../d5/da5/astobj2_8h.html#a6321ee982370c55ab3c24c72c562cbdd">ao2_cleanup</a>);</div><div class="line"><a name="l02551"></a><span class="lineno"> 2551</span>&#160;   <a class="code" href="../../d5/d60/utils_8h.html#a1604b4d72144dd3d9f7da668e90337e9">RAII_VAR</a>(<span class="keywordtype">void</span> *, updated_object, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../d5/da5/astobj2_8h.html#a6321ee982370c55ab3c24c72c562cbdd">ao2_cleanup</a>);</div><div class="line"><a name="l02552"></a><span class="lineno"> 2552</span>&#160;   <a class="code" href="../../d5/d60/utils_8h.html#a1604b4d72144dd3d9f7da668e90337e9">RAII_VAR</a>(<span class="keywordtype">void</span> *, cached_object, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../d5/da5/astobj2_8h.html#a6321ee982370c55ab3c24c72c562cbdd">ao2_cleanup</a>);</div><div class="line"><a name="l02553"></a><span class="lineno"> 2553</span>&#160;</div><div class="line"><a name="l02554"></a><span class="lineno"> 2554</span>&#160;   <span class="keywordflow">switch</span> (cmd) {</div><div class="line"><a name="l02555"></a><span class="lineno"> 2555</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="../../d2/ddc/test_8h.html#a0689ac4326c7a771e1b6ed1e4cde53e2a21df97525a6ac371a7fb604dfa8ea67b">TEST_INIT</a>:</div><div class="line"><a name="l02556"></a><span class="lineno"> 2556</span>&#160;      <a class="code" href="../../dd/d17/namespacesip__to__pjsip.html#ab82f408a83ecba10ea39afd8abfd371e">info</a>-&gt;name = <span class="stringliteral">&quot;create&quot;</span>;</div><div class="line"><a name="l02557"></a><span class="lineno"> 2557</span>&#160;      <a class="code" href="../../dd/d17/namespacesip__to__pjsip.html#ab82f408a83ecba10ea39afd8abfd371e">info</a>-&gt;category = <span class="stringliteral">&quot;/res/res_sorcery_memory_cache/&quot;</span>;</div><div class="line"><a name="l02558"></a><span class="lineno"> 2558</span>&#160;      <a class="code" href="../../dd/d17/namespacesip__to__pjsip.html#ab82f408a83ecba10ea39afd8abfd371e">info</a>-&gt;summary = <span class="stringliteral">&quot;Attempt to create and then update an object in the cache&quot;</span>;</div><div class="line"><a name="l02559"></a><span class="lineno"> 2559</span>&#160;      <a class="code" href="../../dd/d17/namespacesip__to__pjsip.html#ab82f408a83ecba10ea39afd8abfd371e">info</a>-&gt;description = <span class="stringliteral">&quot;This test performs the following:\n&quot;</span></div><div class="line"><a name="l02560"></a><span class="lineno"> 2560</span>&#160;         <span class="stringliteral">&quot;\t* Creates a memory cache with default options\n&quot;</span></div><div class="line"><a name="l02561"></a><span class="lineno"> 2561</span>&#160;         <span class="stringliteral">&quot;\t* Creates a sorcery instance with a test object\n&quot;</span></div><div class="line"><a name="l02562"></a><span class="lineno"> 2562</span>&#160;         <span class="stringliteral">&quot;\t* Creates a test object with an id of test\n&quot;</span></div><div class="line"><a name="l02563"></a><span class="lineno"> 2563</span>&#160;         <span class="stringliteral">&quot;\t* Pushes the test object into the memory cache\n&quot;</span></div><div class="line"><a name="l02564"></a><span class="lineno"> 2564</span>&#160;         <span class="stringliteral">&quot;\t* Confirms that the test object is in the cache\n&quot;</span></div><div class="line"><a name="l02565"></a><span class="lineno"> 2565</span>&#160;         <span class="stringliteral">&quot;\t* Creates a new test object with the same id of test\n&quot;</span></div><div class="line"><a name="l02566"></a><span class="lineno"> 2566</span>&#160;         <span class="stringliteral">&quot;\t* Pushes the new test object into the memory cache\n&quot;</span></div><div class="line"><a name="l02567"></a><span class="lineno"> 2567</span>&#160;         <span class="stringliteral">&quot;\t* Confirms that the new test object has replaced the old one&quot;</span>;</div><div class="line"><a name="l02568"></a><span class="lineno"> 2568</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../d2/ddc/test_8h.html#aad2aec78205d328d23894a6598cc4044a8cf2ae27807baf798d726d630693cc8c">AST_TEST_NOT_RUN</a>;</div><div class="line"><a name="l02569"></a><span class="lineno"> 2569</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="../../d2/ddc/test_8h.html#a0689ac4326c7a771e1b6ed1e4cde53e2adb2586ef58bb9dd2f84a7d592ecf3e0e">TEST_EXECUTE</a>:</div><div class="line"><a name="l02570"></a><span class="lineno"> 2570</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l02571"></a><span class="lineno"> 2571</span>&#160;   }</div><div class="line"><a name="l02572"></a><span class="lineno"> 2572</span>&#160;</div><div class="line"><a name="l02573"></a><span class="lineno"> 2573</span>&#160;   cache = <a class="code" href="../../d7/d30/res__sorcery__memory__cache_8c.html#a73c11b5eb7314f2dbd3f32d18b69b10f">sorcery_memory_cache_open</a>(<span class="stringliteral">&quot;&quot;</span>);</div><div class="line"><a name="l02574"></a><span class="lineno"> 2574</span>&#160;   <span class="keywordflow">if</span> (!cache) {</div><div class="line"><a name="l02575"></a><span class="lineno"> 2575</span>&#160;      <a class="code" href="../../d2/ddc/test_8h.html#a5e8fddded61f6989172c981256e7c9bd">ast_test_status_update</a>(<a class="code" href="../../d8/d89/structtest.html">test</a>, <span class="stringliteral">&quot;Failed to create a sorcery memory cache using default options\n&quot;</span>);</div><div class="line"><a name="l02576"></a><span class="lineno"> 2576</span>&#160;      <span class="keywordflow">goto</span> <a class="code" href="../../d2/d2c/pbx__realtime_8c.html#a10b51e1931bd03dd172cbfb9d3d67efb">cleanup</a>;</div><div class="line"><a name="l02577"></a><span class="lineno"> 2577</span>&#160;   }</div><div class="line"><a name="l02578"></a><span class="lineno"> 2578</span>&#160;</div><div class="line"><a name="l02579"></a><span class="lineno"> 2579</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d5/da5/astobj2_8h.html#a512cc40ce96c63b3d5c78040baa4c9cd">ao2_container_count</a>(cache-&gt;<a class="code" href="../../d2/d6b/structsorcery__memory__cache.html#aa0a84e33972901716d6d5a6dcf1a68de">objects</a>)) {</div><div class="line"><a name="l02580"></a><span class="lineno"> 2580</span>&#160;      <a class="code" href="../../d2/ddc/test_8h.html#a5e8fddded61f6989172c981256e7c9bd">ast_test_status_update</a>(<a class="code" href="../../d8/d89/structtest.html">test</a>, <span class="stringliteral">&quot;Memory cache contains cached objects before we added one\n&quot;</span>);</div><div class="line"><a name="l02581"></a><span class="lineno"> 2581</span>&#160;      <span class="keywordflow">goto</span> <a class="code" href="../../d2/d2c/pbx__realtime_8c.html#a10b51e1931bd03dd172cbfb9d3d67efb">cleanup</a>;</div><div class="line"><a name="l02582"></a><span class="lineno"> 2582</span>&#160;   }</div><div class="line"><a name="l02583"></a><span class="lineno"> 2583</span>&#160;</div><div class="line"><a name="l02584"></a><span class="lineno"> 2584</span>&#160;   sorcery = <a class="code" href="../../d7/d30/res__sorcery__memory__cache_8c.html#af9b170dc8108e107601ebfdc5b0ed1ed">alloc_and_initialize_sorcery</a>();</div><div class="line"><a name="l02585"></a><span class="lineno"> 2585</span>&#160;   <span class="keywordflow">if</span> (!sorcery) {</div><div class="line"><a name="l02586"></a><span class="lineno"> 2586</span>&#160;      <a class="code" href="../../d2/ddc/test_8h.html#a5e8fddded61f6989172c981256e7c9bd">ast_test_status_update</a>(<a class="code" href="../../d8/d89/structtest.html">test</a>, <span class="stringliteral">&quot;Failed to create a test sorcery instance\n&quot;</span>);</div><div class="line"><a name="l02587"></a><span class="lineno"> 2587</span>&#160;      <span class="keywordflow">goto</span> <a class="code" href="../../d2/d2c/pbx__realtime_8c.html#a10b51e1931bd03dd172cbfb9d3d67efb">cleanup</a>;</div><div class="line"><a name="l02588"></a><span class="lineno"> 2588</span>&#160;   }</div><div class="line"><a name="l02589"></a><span class="lineno"> 2589</span>&#160;</div><div class="line"><a name="l02590"></a><span class="lineno"> 2590</span>&#160;   original_object = <a class="code" href="../../d8/d25/sorcery_8h.html#acb6c97c18566cf94a7ac95a43dd9a816">ast_sorcery_alloc</a>(sorcery, <span class="stringliteral">&quot;test&quot;</span>, <span class="stringliteral">&quot;test&quot;</span>);</div><div class="line"><a name="l02591"></a><span class="lineno"> 2591</span>&#160;   <span class="keywordflow">if</span> (!original_object) {</div><div class="line"><a name="l02592"></a><span class="lineno"> 2592</span>&#160;      <a class="code" href="../../d2/ddc/test_8h.html#a5e8fddded61f6989172c981256e7c9bd">ast_test_status_update</a>(<a class="code" href="../../d8/d89/structtest.html">test</a>, <span class="stringliteral">&quot;Failed to allocate a test object\n&quot;</span>);</div><div class="line"><a name="l02593"></a><span class="lineno"> 2593</span>&#160;      <span class="keywordflow">goto</span> <a class="code" href="../../d2/d2c/pbx__realtime_8c.html#a10b51e1931bd03dd172cbfb9d3d67efb">cleanup</a>;</div><div class="line"><a name="l02594"></a><span class="lineno"> 2594</span>&#160;   }</div><div class="line"><a name="l02595"></a><span class="lineno"> 2595</span>&#160;</div><div class="line"><a name="l02596"></a><span class="lineno"> 2596</span>&#160;   <a class="code" href="../../d7/d30/res__sorcery__memory__cache_8c.html#a751f8dcc38eb8ff1f9aee8b2b0c14db0">sorcery_memory_cache_create</a>(sorcery, cache, original_object);</div><div class="line"><a name="l02597"></a><span class="lineno"> 2597</span>&#160;</div><div class="line"><a name="l02598"></a><span class="lineno"> 2598</span>&#160;   updated_object = <a class="code" href="../../d8/d25/sorcery_8h.html#acb6c97c18566cf94a7ac95a43dd9a816">ast_sorcery_alloc</a>(sorcery, <span class="stringliteral">&quot;test&quot;</span>, <span class="stringliteral">&quot;test&quot;</span>);</div><div class="line"><a name="l02599"></a><span class="lineno"> 2599</span>&#160;   <span class="keywordflow">if</span> (!updated_object) {</div><div class="line"><a name="l02600"></a><span class="lineno"> 2600</span>&#160;      <a class="code" href="../../d2/ddc/test_8h.html#a5e8fddded61f6989172c981256e7c9bd">ast_test_status_update</a>(<a class="code" href="../../d8/d89/structtest.html">test</a>, <span class="stringliteral">&quot;Failed to allocate an updated test object\n&quot;</span>);</div><div class="line"><a name="l02601"></a><span class="lineno"> 2601</span>&#160;      <span class="keywordflow">goto</span> <a class="code" href="../../d2/d2c/pbx__realtime_8c.html#a10b51e1931bd03dd172cbfb9d3d67efb">cleanup</a>;</div><div class="line"><a name="l02602"></a><span class="lineno"> 2602</span>&#160;   }</div><div class="line"><a name="l02603"></a><span class="lineno"> 2603</span>&#160;</div><div class="line"><a name="l02604"></a><span class="lineno"> 2604</span>&#160;   <a class="code" href="../../d7/d30/res__sorcery__memory__cache_8c.html#a751f8dcc38eb8ff1f9aee8b2b0c14db0">sorcery_memory_cache_create</a>(sorcery, cache, updated_object);</div><div class="line"><a name="l02605"></a><span class="lineno"> 2605</span>&#160;</div><div class="line"><a name="l02606"></a><span class="lineno"> 2606</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d5/da5/astobj2_8h.html#a512cc40ce96c63b3d5c78040baa4c9cd">ao2_container_count</a>(cache-&gt;<a class="code" href="../../d2/d6b/structsorcery__memory__cache.html#aa0a84e33972901716d6d5a6dcf1a68de">objects</a>) != 1) {</div><div class="line"><a name="l02607"></a><span class="lineno"> 2607</span>&#160;      <a class="code" href="../../d2/ddc/test_8h.html#a5e8fddded61f6989172c981256e7c9bd">ast_test_status_update</a>(<a class="code" href="../../d8/d89/structtest.html">test</a>, <span class="stringliteral">&quot;Added updated test object to memory cache but cache now contains %d objects instead of 1\n&quot;</span>,</div><div class="line"><a name="l02608"></a><span class="lineno"> 2608</span>&#160;         <a class="code" href="../../d5/da5/astobj2_8h.html#a512cc40ce96c63b3d5c78040baa4c9cd">ao2_container_count</a>(cache-&gt;<a class="code" href="../../d2/d6b/structsorcery__memory__cache.html#aa0a84e33972901716d6d5a6dcf1a68de">objects</a>));</div><div class="line"><a name="l02609"></a><span class="lineno"> 2609</span>&#160;      <span class="keywordflow">goto</span> <a class="code" href="../../d2/d2c/pbx__realtime_8c.html#a10b51e1931bd03dd172cbfb9d3d67efb">cleanup</a>;</div><div class="line"><a name="l02610"></a><span class="lineno"> 2610</span>&#160;   }</div><div class="line"><a name="l02611"></a><span class="lineno"> 2611</span>&#160;</div><div class="line"><a name="l02612"></a><span class="lineno"> 2612</span>&#160;   cached_object = <a class="code" href="../../d7/d30/res__sorcery__memory__cache_8c.html#a0e33561fb1fc08c9366a5a83eb83583e">sorcery_memory_cache_retrieve_id</a>(sorcery, cache, <span class="stringliteral">&quot;test&quot;</span>, <span class="stringliteral">&quot;test&quot;</span>);</div><div class="line"><a name="l02613"></a><span class="lineno"> 2613</span>&#160;   <span class="keywordflow">if</span> (!cached_object) {</div><div class="line"><a name="l02614"></a><span class="lineno"> 2614</span>&#160;      <a class="code" href="../../d2/ddc/test_8h.html#a5e8fddded61f6989172c981256e7c9bd">ast_test_status_update</a>(<a class="code" href="../../d8/d89/structtest.html">test</a>, <span class="stringliteral">&quot;Updated object placed into memory cache could not be retrieved\n&quot;</span>);</div><div class="line"><a name="l02615"></a><span class="lineno"> 2615</span>&#160;      <span class="keywordflow">goto</span> <a class="code" href="../../d2/d2c/pbx__realtime_8c.html#a10b51e1931bd03dd172cbfb9d3d67efb">cleanup</a>;</div><div class="line"><a name="l02616"></a><span class="lineno"> 2616</span>&#160;   }</div><div class="line"><a name="l02617"></a><span class="lineno"> 2617</span>&#160;</div><div class="line"><a name="l02618"></a><span class="lineno"> 2618</span>&#160;   <span class="keywordflow">if</span> (cached_object == original_object) {</div><div class="line"><a name="l02619"></a><span class="lineno"> 2619</span>&#160;      <a class="code" href="../../d2/ddc/test_8h.html#a5e8fddded61f6989172c981256e7c9bd">ast_test_status_update</a>(<a class="code" href="../../d8/d89/structtest.html">test</a>, <span class="stringliteral">&quot;Updated object placed into memory cache but old one is being retrieved\n&quot;</span>);</div><div class="line"><a name="l02620"></a><span class="lineno"> 2620</span>&#160;      <span class="keywordflow">goto</span> <a class="code" href="../../d2/d2c/pbx__realtime_8c.html#a10b51e1931bd03dd172cbfb9d3d67efb">cleanup</a>;</div><div class="line"><a name="l02621"></a><span class="lineno"> 2621</span>&#160;   } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (cached_object != updated_object) {</div><div class="line"><a name="l02622"></a><span class="lineno"> 2622</span>&#160;      <a class="code" href="../../d2/ddc/test_8h.html#a5e8fddded61f6989172c981256e7c9bd">ast_test_status_update</a>(<a class="code" href="../../d8/d89/structtest.html">test</a>, <span class="stringliteral">&quot;Updated object placed into memory cache but different one is being retrieved\n&quot;</span>);</div><div class="line"><a name="l02623"></a><span class="lineno"> 2623</span>&#160;      <span class="keywordflow">goto</span> <a class="code" href="../../d2/d2c/pbx__realtime_8c.html#a10b51e1931bd03dd172cbfb9d3d67efb">cleanup</a>;</div><div class="line"><a name="l02624"></a><span class="lineno"> 2624</span>&#160;   }</div><div class="line"><a name="l02625"></a><span class="lineno"> 2625</span>&#160;</div><div class="line"><a name="l02626"></a><span class="lineno"> 2626</span>&#160;   res = <a class="code" href="../../d2/ddc/test_8h.html#aad2aec78205d328d23894a6598cc4044a7a3ab73c870a7ce6cf1a0f3cfd42a37b">AST_TEST_PASS</a>;</div><div class="line"><a name="l02627"></a><span class="lineno"> 2627</span>&#160;</div><div class="line"><a name="l02628"></a><span class="lineno"> 2628</span>&#160;<a class="code" href="../../d2/d2c/pbx__realtime_8c.html#a10b51e1931bd03dd172cbfb9d3d67efb">cleanup</a>:</div><div class="line"><a name="l02629"></a><span class="lineno"> 2629</span>&#160;   <span class="keywordflow">if</span> (cache) {</div><div class="line"><a name="l02630"></a><span class="lineno"> 2630</span>&#160;      <a class="code" href="../../d7/d30/res__sorcery__memory__cache_8c.html#a9f6a8b7453ee946fb55fac3b0237f514">sorcery_memory_cache_close</a>(cache);</div><div class="line"><a name="l02631"></a><span class="lineno"> 2631</span>&#160;   }</div><div class="line"><a name="l02632"></a><span class="lineno"> 2632</span>&#160;   <span class="keywordflow">if</span> (sorcery) {</div><div class="line"><a name="l02633"></a><span class="lineno"> 2633</span>&#160;      <a class="code" href="../../d8/d25/sorcery_8h.html#a09cba9c37c702ca2bdcf94052068ed67">ast_sorcery_unref</a>(sorcery);</div><div class="line"><a name="l02634"></a><span class="lineno"> 2634</span>&#160;   }</div><div class="line"><a name="l02635"></a><span class="lineno"> 2635</span>&#160;</div><div class="line"><a name="l02636"></a><span class="lineno"> 2636</span>&#160;   <span class="keywordflow">return</span> res;</div><div class="line"><a name="l02637"></a><span class="lineno"> 2637</span>&#160;}</div><div class="line"><a name="l02638"></a><span class="lineno"> 2638</span>&#160;</div><div class="line"><a name="l02639"></a><span class="lineno"><a class="line" href="../../d7/d30/res__sorcery__memory__cache_8c.html#abaf4ac614f70de7753ba83ed1dd9bde6"> 2639</a></span>&#160;<a class="code" href="../../d7/d30/res__sorcery__memory__cache_8c.html#af6639c66b2a5eff1e659bf57d5938e54">AST_TEST_DEFINE</a>(<span class="keyword">delete</span>)</div><div class="line"><a name="l02640"></a><span class="lineno"> 2640</span>&#160;{</div><div class="line"><a name="l02641"></a><span class="lineno"> 2641</span>&#160;   <span class="keywordtype">int</span> res = <a class="code" href="../../d2/ddc/test_8h.html#aad2aec78205d328d23894a6598cc4044a8a11a3a19eb4c9fd2ba654d95df1adb6">AST_TEST_FAIL</a>;</div><div class="line"><a name="l02642"></a><span class="lineno"> 2642</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d2/d88/structast__sorcery.html">ast_sorcery</a> *<a class="code" href="../../d2/d6b/structsorcery__memory__cache.html#aeb33dcb5573e1661c82b5370681fb626">sorcery</a> = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l02643"></a><span class="lineno"> 2643</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d2/d6b/structsorcery__memory__cache.html">sorcery_memory_cache</a> *cache = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l02644"></a><span class="lineno"> 2644</span>&#160;   <a class="code" href="../../d5/d60/utils_8h.html#a1604b4d72144dd3d9f7da668e90337e9">RAII_VAR</a>(<span class="keywordtype">void</span> *, <span class="keywordtype">object</span>, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../d5/da5/astobj2_8h.html#a6321ee982370c55ab3c24c72c562cbdd">ao2_cleanup</a>);</div><div class="line"><a name="l02645"></a><span class="lineno"> 2645</span>&#160;   <a class="code" href="../../d5/d60/utils_8h.html#a1604b4d72144dd3d9f7da668e90337e9">RAII_VAR</a>(<span class="keywordtype">void</span> *, cached_object, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../d5/da5/astobj2_8h.html#a6321ee982370c55ab3c24c72c562cbdd">ao2_cleanup</a>);</div><div class="line"><a name="l02646"></a><span class="lineno"> 2646</span>&#160;</div><div class="line"><a name="l02647"></a><span class="lineno"> 2647</span>&#160;   <span class="keywordflow">switch</span> (cmd) {</div><div class="line"><a name="l02648"></a><span class="lineno"> 2648</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="../../d2/ddc/test_8h.html#a0689ac4326c7a771e1b6ed1e4cde53e2a21df97525a6ac371a7fb604dfa8ea67b">TEST_INIT</a>:</div><div class="line"><a name="l02649"></a><span class="lineno"> 2649</span>&#160;      <a class="code" href="../../dd/d17/namespacesip__to__pjsip.html#ab82f408a83ecba10ea39afd8abfd371e">info</a>-&gt;name = <span class="stringliteral">&quot;delete&quot;</span>;</div><div class="line"><a name="l02650"></a><span class="lineno"> 2650</span>&#160;      <a class="code" href="../../dd/d17/namespacesip__to__pjsip.html#ab82f408a83ecba10ea39afd8abfd371e">info</a>-&gt;category = <span class="stringliteral">&quot;/res/res_sorcery_memory_cache/&quot;</span>;</div><div class="line"><a name="l02651"></a><span class="lineno"> 2651</span>&#160;      <a class="code" href="../../dd/d17/namespacesip__to__pjsip.html#ab82f408a83ecba10ea39afd8abfd371e">info</a>-&gt;summary = <span class="stringliteral">&quot;Attempt to create and then delete an object in the cache&quot;</span>;</div><div class="line"><a name="l02652"></a><span class="lineno"> 2652</span>&#160;      <a class="code" href="../../dd/d17/namespacesip__to__pjsip.html#ab82f408a83ecba10ea39afd8abfd371e">info</a>-&gt;description = <span class="stringliteral">&quot;This test performs the following:\n&quot;</span></div><div class="line"><a name="l02653"></a><span class="lineno"> 2653</span>&#160;         <span class="stringliteral">&quot;\t* Creates a memory cache with default options\n&quot;</span></div><div class="line"><a name="l02654"></a><span class="lineno"> 2654</span>&#160;         <span class="stringliteral">&quot;\t* Creates a sorcery instance with a test object\n&quot;</span></div><div class="line"><a name="l02655"></a><span class="lineno"> 2655</span>&#160;         <span class="stringliteral">&quot;\t* Creates a test object with an id of test\n&quot;</span></div><div class="line"><a name="l02656"></a><span class="lineno"> 2656</span>&#160;         <span class="stringliteral">&quot;\t* Pushes the test object into the memory cache\n&quot;</span></div><div class="line"><a name="l02657"></a><span class="lineno"> 2657</span>&#160;         <span class="stringliteral">&quot;\t* Confirms that the test object is in the cache\n&quot;</span></div><div class="line"><a name="l02658"></a><span class="lineno"> 2658</span>&#160;         <span class="stringliteral">&quot;\t* Deletes the test object from the cache\n&quot;</span></div><div class="line"><a name="l02659"></a><span class="lineno"> 2659</span>&#160;         <span class="stringliteral">&quot;\t* Confirms that the test object is no longer in the cache&quot;</span>;</div><div class="line"><a name="l02660"></a><span class="lineno"> 2660</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../d2/ddc/test_8h.html#aad2aec78205d328d23894a6598cc4044a8cf2ae27807baf798d726d630693cc8c">AST_TEST_NOT_RUN</a>;</div><div class="line"><a name="l02661"></a><span class="lineno"> 2661</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="../../d2/ddc/test_8h.html#a0689ac4326c7a771e1b6ed1e4cde53e2adb2586ef58bb9dd2f84a7d592ecf3e0e">TEST_EXECUTE</a>:</div><div class="line"><a name="l02662"></a><span class="lineno"> 2662</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l02663"></a><span class="lineno"> 2663</span>&#160;   }</div><div class="line"><a name="l02664"></a><span class="lineno"> 2664</span>&#160;</div><div class="line"><a name="l02665"></a><span class="lineno"> 2665</span>&#160;   cache = <a class="code" href="../../d7/d30/res__sorcery__memory__cache_8c.html#a73c11b5eb7314f2dbd3f32d18b69b10f">sorcery_memory_cache_open</a>(<span class="stringliteral">&quot;&quot;</span>);</div><div class="line"><a name="l02666"></a><span class="lineno"> 2666</span>&#160;   <span class="keywordflow">if</span> (!cache) {</div><div class="line"><a name="l02667"></a><span class="lineno"> 2667</span>&#160;      <a class="code" href="../../d2/ddc/test_8h.html#a5e8fddded61f6989172c981256e7c9bd">ast_test_status_update</a>(<a class="code" href="../../d8/d89/structtest.html">test</a>, <span class="stringliteral">&quot;Failed to create a sorcery memory cache using default options\n&quot;</span>);</div><div class="line"><a name="l02668"></a><span class="lineno"> 2668</span>&#160;      <span class="keywordflow">goto</span> <a class="code" href="../../d2/d2c/pbx__realtime_8c.html#a10b51e1931bd03dd172cbfb9d3d67efb">cleanup</a>;</div><div class="line"><a name="l02669"></a><span class="lineno"> 2669</span>&#160;   }</div><div class="line"><a name="l02670"></a><span class="lineno"> 2670</span>&#160;</div><div class="line"><a name="l02671"></a><span class="lineno"> 2671</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d5/da5/astobj2_8h.html#a512cc40ce96c63b3d5c78040baa4c9cd">ao2_container_count</a>(cache-&gt;<a class="code" href="../../d2/d6b/structsorcery__memory__cache.html#aa0a84e33972901716d6d5a6dcf1a68de">objects</a>)) {</div><div class="line"><a name="l02672"></a><span class="lineno"> 2672</span>&#160;      <a class="code" href="../../d2/ddc/test_8h.html#a5e8fddded61f6989172c981256e7c9bd">ast_test_status_update</a>(<a class="code" href="../../d8/d89/structtest.html">test</a>, <span class="stringliteral">&quot;Memory cache contains cached objects before we added one\n&quot;</span>);</div><div class="line"><a name="l02673"></a><span class="lineno"> 2673</span>&#160;      <span class="keywordflow">goto</span> <a class="code" href="../../d2/d2c/pbx__realtime_8c.html#a10b51e1931bd03dd172cbfb9d3d67efb">cleanup</a>;</div><div class="line"><a name="l02674"></a><span class="lineno"> 2674</span>&#160;   }</div><div class="line"><a name="l02675"></a><span class="lineno"> 2675</span>&#160;</div><div class="line"><a name="l02676"></a><span class="lineno"> 2676</span>&#160;   sorcery = <a class="code" href="../../d7/d30/res__sorcery__memory__cache_8c.html#af9b170dc8108e107601ebfdc5b0ed1ed">alloc_and_initialize_sorcery</a>();</div><div class="line"><a name="l02677"></a><span class="lineno"> 2677</span>&#160;   <span class="keywordflow">if</span> (!sorcery) {</div><div class="line"><a name="l02678"></a><span class="lineno"> 2678</span>&#160;      <a class="code" href="../../d2/ddc/test_8h.html#a5e8fddded61f6989172c981256e7c9bd">ast_test_status_update</a>(<a class="code" href="../../d8/d89/structtest.html">test</a>, <span class="stringliteral">&quot;Failed to create a test sorcery instance\n&quot;</span>);</div><div class="line"><a name="l02679"></a><span class="lineno"> 2679</span>&#160;      <span class="keywordflow">goto</span> <a class="code" href="../../d2/d2c/pbx__realtime_8c.html#a10b51e1931bd03dd172cbfb9d3d67efb">cleanup</a>;</div><div class="line"><a name="l02680"></a><span class="lineno"> 2680</span>&#160;   }</div><div class="line"><a name="l02681"></a><span class="lineno"> 2681</span>&#160;</div><div class="line"><a name="l02682"></a><span class="lineno"> 2682</span>&#160;   <span class="keywordtype">object</span> = <a class="code" href="../../d8/d25/sorcery_8h.html#acb6c97c18566cf94a7ac95a43dd9a816">ast_sorcery_alloc</a>(sorcery, <span class="stringliteral">&quot;test&quot;</span>, <span class="stringliteral">&quot;test&quot;</span>);</div><div class="line"><a name="l02683"></a><span class="lineno"> 2683</span>&#160;   <span class="keywordflow">if</span> (!<span class="keywordtype">object</span>) {</div><div class="line"><a name="l02684"></a><span class="lineno"> 2684</span>&#160;      <a class="code" href="../../d2/ddc/test_8h.html#a5e8fddded61f6989172c981256e7c9bd">ast_test_status_update</a>(<a class="code" href="../../d8/d89/structtest.html">test</a>, <span class="stringliteral">&quot;Failed to allocate a test object\n&quot;</span>);</div><div class="line"><a name="l02685"></a><span class="lineno"> 2685</span>&#160;      <span class="keywordflow">goto</span> <a class="code" href="../../d2/d2c/pbx__realtime_8c.html#a10b51e1931bd03dd172cbfb9d3d67efb">cleanup</a>;</div><div class="line"><a name="l02686"></a><span class="lineno"> 2686</span>&#160;   }</div><div class="line"><a name="l02687"></a><span class="lineno"> 2687</span>&#160;</div><div class="line"><a name="l02688"></a><span class="lineno"> 2688</span>&#160;   <a class="code" href="../../d7/d30/res__sorcery__memory__cache_8c.html#a751f8dcc38eb8ff1f9aee8b2b0c14db0">sorcery_memory_cache_create</a>(sorcery, cache, <span class="keywordtype">object</span>);</div><div class="line"><a name="l02689"></a><span class="lineno"> 2689</span>&#160;</div><div class="line"><a name="l02690"></a><span class="lineno"> 2690</span>&#160;   <span class="keywordflow">if</span> (!<a class="code" href="../../d5/da5/astobj2_8h.html#a512cc40ce96c63b3d5c78040baa4c9cd">ao2_container_count</a>(cache-&gt;<a class="code" href="../../d2/d6b/structsorcery__memory__cache.html#aa0a84e33972901716d6d5a6dcf1a68de">objects</a>)) {</div><div class="line"><a name="l02691"></a><span class="lineno"> 2691</span>&#160;      <a class="code" href="../../d2/ddc/test_8h.html#a5e8fddded61f6989172c981256e7c9bd">ast_test_status_update</a>(<a class="code" href="../../d8/d89/structtest.html">test</a>, <span class="stringliteral">&quot;Added test object to memory cache but cache contains no objects\n&quot;</span>);</div><div class="line"><a name="l02692"></a><span class="lineno"> 2692</span>&#160;      <span class="keywordflow">goto</span> <a class="code" href="../../d2/d2c/pbx__realtime_8c.html#a10b51e1931bd03dd172cbfb9d3d67efb">cleanup</a>;</div><div class="line"><a name="l02693"></a><span class="lineno"> 2693</span>&#160;   }</div><div class="line"><a name="l02694"></a><span class="lineno"> 2694</span>&#160;</div><div class="line"><a name="l02695"></a><span class="lineno"> 2695</span>&#160;   cached_object = <a class="code" href="../../d7/d30/res__sorcery__memory__cache_8c.html#a0e33561fb1fc08c9366a5a83eb83583e">sorcery_memory_cache_retrieve_id</a>(sorcery, cache, <span class="stringliteral">&quot;test&quot;</span>, <span class="stringliteral">&quot;test&quot;</span>);</div><div class="line"><a name="l02696"></a><span class="lineno"> 2696</span>&#160;   <span class="keywordflow">if</span> (!cached_object) {</div><div class="line"><a name="l02697"></a><span class="lineno"> 2697</span>&#160;      <a class="code" href="../../d2/ddc/test_8h.html#a5e8fddded61f6989172c981256e7c9bd">ast_test_status_update</a>(<a class="code" href="../../d8/d89/structtest.html">test</a>, <span class="stringliteral">&quot;Test object placed into memory cache could not be retrieved\n&quot;</span>);</div><div class="line"><a name="l02698"></a><span class="lineno"> 2698</span>&#160;      <span class="keywordflow">goto</span> <a class="code" href="../../d2/d2c/pbx__realtime_8c.html#a10b51e1931bd03dd172cbfb9d3d67efb">cleanup</a>;</div><div class="line"><a name="l02699"></a><span class="lineno"> 2699</span>&#160;   }</div><div class="line"><a name="l02700"></a><span class="lineno"> 2700</span>&#160;</div><div class="line"><a name="l02701"></a><span class="lineno"> 2701</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(cached_object, -1);</div><div class="line"><a name="l02702"></a><span class="lineno"> 2702</span>&#160;   cached_object = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l02703"></a><span class="lineno"> 2703</span>&#160;</div><div class="line"><a name="l02704"></a><span class="lineno"> 2704</span>&#160;   <a class="code" href="../../d7/d30/res__sorcery__memory__cache_8c.html#a8be072ec91ebdbdbb1153b0a5b03a452">sorcery_memory_cache_delete</a>(sorcery, cache, <span class="keywordtype">object</span>);</div><div class="line"><a name="l02705"></a><span class="lineno"> 2705</span>&#160;</div><div class="line"><a name="l02706"></a><span class="lineno"> 2706</span>&#160;   cached_object = <a class="code" href="../../d7/d30/res__sorcery__memory__cache_8c.html#a0e33561fb1fc08c9366a5a83eb83583e">sorcery_memory_cache_retrieve_id</a>(sorcery, cache, <span class="stringliteral">&quot;test&quot;</span>, <span class="stringliteral">&quot;test&quot;</span>);</div><div class="line"><a name="l02707"></a><span class="lineno"> 2707</span>&#160;   <span class="keywordflow">if</span> (cached_object) {</div><div class="line"><a name="l02708"></a><span class="lineno"> 2708</span>&#160;      <a class="code" href="../../d2/ddc/test_8h.html#a5e8fddded61f6989172c981256e7c9bd">ast_test_status_update</a>(<a class="code" href="../../d8/d89/structtest.html">test</a>, <span class="stringliteral">&quot;Test object deleted from memory cache can still be retrieved\n&quot;</span>);</div><div class="line"><a name="l02709"></a><span class="lineno"> 2709</span>&#160;      <span class="keywordflow">goto</span> <a class="code" href="../../d2/d2c/pbx__realtime_8c.html#a10b51e1931bd03dd172cbfb9d3d67efb">cleanup</a>;</div><div class="line"><a name="l02710"></a><span class="lineno"> 2710</span>&#160;   }</div><div class="line"><a name="l02711"></a><span class="lineno"> 2711</span>&#160;</div><div class="line"><a name="l02712"></a><span class="lineno"> 2712</span>&#160;   res = <a class="code" href="../../d2/ddc/test_8h.html#aad2aec78205d328d23894a6598cc4044a7a3ab73c870a7ce6cf1a0f3cfd42a37b">AST_TEST_PASS</a>;</div><div class="line"><a name="l02713"></a><span class="lineno"> 2713</span>&#160;</div><div class="line"><a name="l02714"></a><span class="lineno"> 2714</span>&#160;<a class="code" href="../../d2/d2c/pbx__realtime_8c.html#a10b51e1931bd03dd172cbfb9d3d67efb">cleanup</a>:</div><div class="line"><a name="l02715"></a><span class="lineno"> 2715</span>&#160;   <span class="keywordflow">if</span> (cache) {</div><div class="line"><a name="l02716"></a><span class="lineno"> 2716</span>&#160;      <a class="code" href="../../d7/d30/res__sorcery__memory__cache_8c.html#a9f6a8b7453ee946fb55fac3b0237f514">sorcery_memory_cache_close</a>(cache);</div><div class="line"><a name="l02717"></a><span class="lineno"> 2717</span>&#160;   }</div><div class="line"><a name="l02718"></a><span class="lineno"> 2718</span>&#160;   <span class="keywordflow">if</span> (sorcery) {</div><div class="line"><a name="l02719"></a><span class="lineno"> 2719</span>&#160;      <a class="code" href="../../d8/d25/sorcery_8h.html#a09cba9c37c702ca2bdcf94052068ed67">ast_sorcery_unref</a>(sorcery);</div><div class="line"><a name="l02720"></a><span class="lineno"> 2720</span>&#160;   }</div><div class="line"><a name="l02721"></a><span class="lineno"> 2721</span>&#160;</div><div class="line"><a name="l02722"></a><span class="lineno"> 2722</span>&#160;   <span class="keywordflow">return</span> res;</div><div class="line"><a name="l02723"></a><span class="lineno"> 2723</span>&#160;}</div><div class="line"><a name="l02724"></a><span class="lineno"> 2724</span>&#160;</div><div class="line"><a name="l02725"></a><span class="lineno"><a class="line" href="../../d7/d30/res__sorcery__memory__cache_8c.html#adda5136e1f2b6ee965600a082879388e"> 2725</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d7/d30/res__sorcery__memory__cache_8c.html#adda5136e1f2b6ee965600a082879388e">check_cache_content</a>(<span class="keyword">struct</span> <a class="code" href="../../d9/d79/structast__test.html">ast_test</a> *<a class="code" href="../../d8/d89/structtest.html">test</a>, <span class="keyword">struct</span> <a class="code" href="../../d2/d88/structast__sorcery.html">ast_sorcery</a> *<a class="code" href="../../d2/d6b/structsorcery__memory__cache.html#aeb33dcb5573e1661c82b5370681fb626">sorcery</a>, <span class="keyword">struct</span> <a class="code" href="../../d2/d6b/structsorcery__memory__cache.html">sorcery_memory_cache</a> *cache,</div><div class="line"><a name="l02726"></a><span class="lineno"> 2726</span>&#160;      <span class="keyword">const</span> <span class="keywordtype">char</span> **in_cache, <span class="keywordtype">size_t</span> num_in_cache, <span class="keyword">const</span> <span class="keywordtype">char</span> **not_in_cache, <span class="keywordtype">size_t</span> num_not_in_cache)</div><div class="line"><a name="l02727"></a><span class="lineno"> 2727</span>&#160;{</div><div class="line"><a name="l02728"></a><span class="lineno"> 2728</span>&#160;   <span class="keywordtype">int</span> i;</div><div class="line"><a name="l02729"></a><span class="lineno"> 2729</span>&#160;   <span class="keywordtype">int</span> res = 0;</div><div class="line"><a name="l02730"></a><span class="lineno"> 2730</span>&#160;   <a class="code" href="../../d5/d60/utils_8h.html#a1604b4d72144dd3d9f7da668e90337e9">RAII_VAR</a>(<span class="keywordtype">void</span> *, cached_object, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../d5/da5/astobj2_8h.html#a6321ee982370c55ab3c24c72c562cbdd">ao2_cleanup</a>);</div><div class="line"><a name="l02731"></a><span class="lineno"> 2731</span>&#160;</div><div class="line"><a name="l02732"></a><span class="lineno"> 2732</span>&#160;   <span class="keywordflow">for</span> (i = 0; i &lt; num_in_cache; ++i) {</div><div class="line"><a name="l02733"></a><span class="lineno"> 2733</span>&#160;      cached_object = <a class="code" href="../../d7/d30/res__sorcery__memory__cache_8c.html#a0e33561fb1fc08c9366a5a83eb83583e">sorcery_memory_cache_retrieve_id</a>(sorcery, cache, <span class="stringliteral">&quot;test&quot;</span>, in_cache[i]);</div><div class="line"><a name="l02734"></a><span class="lineno"> 2734</span>&#160;      <span class="keywordflow">if</span> (!cached_object) {</div><div class="line"><a name="l02735"></a><span class="lineno"> 2735</span>&#160;         <a class="code" href="../../d2/ddc/test_8h.html#a5e8fddded61f6989172c981256e7c9bd">ast_test_status_update</a>(test, <span class="stringliteral">&quot;Failed to retrieve &#39;%s&#39; object from the cache\n&quot;</span>,</div><div class="line"><a name="l02736"></a><span class="lineno"> 2736</span>&#160;               in_cache[i]);</div><div class="line"><a name="l02737"></a><span class="lineno"> 2737</span>&#160;         res = -1;</div><div class="line"><a name="l02738"></a><span class="lineno"> 2738</span>&#160;      }</div><div class="line"><a name="l02739"></a><span class="lineno"> 2739</span>&#160;      <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(cached_object, -1);</div><div class="line"><a name="l02740"></a><span class="lineno"> 2740</span>&#160;   }</div><div class="line"><a name="l02741"></a><span class="lineno"> 2741</span>&#160;</div><div class="line"><a name="l02742"></a><span class="lineno"> 2742</span>&#160;   <span class="keywordflow">for</span> (i = 0; i &lt; num_not_in_cache; ++i) {</div><div class="line"><a name="l02743"></a><span class="lineno"> 2743</span>&#160;      cached_object = <a class="code" href="../../d7/d30/res__sorcery__memory__cache_8c.html#a0e33561fb1fc08c9366a5a83eb83583e">sorcery_memory_cache_retrieve_id</a>(sorcery, cache, <span class="stringliteral">&quot;test&quot;</span>, not_in_cache[i]);</div><div class="line"><a name="l02744"></a><span class="lineno"> 2744</span>&#160;      <span class="keywordflow">if</span> (cached_object) {</div><div class="line"><a name="l02745"></a><span class="lineno"> 2745</span>&#160;         <a class="code" href="../../d2/ddc/test_8h.html#a5e8fddded61f6989172c981256e7c9bd">ast_test_status_update</a>(test, <span class="stringliteral">&quot;Retrieved &#39;%s&#39; object from the cache unexpectedly\n&quot;</span>,</div><div class="line"><a name="l02746"></a><span class="lineno"> 2746</span>&#160;               not_in_cache[i]);</div><div class="line"><a name="l02747"></a><span class="lineno"> 2747</span>&#160;         <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(cached_object, -1);</div><div class="line"><a name="l02748"></a><span class="lineno"> 2748</span>&#160;         res = -1;</div><div class="line"><a name="l02749"></a><span class="lineno"> 2749</span>&#160;      }</div><div class="line"><a name="l02750"></a><span class="lineno"> 2750</span>&#160;   }</div><div class="line"><a name="l02751"></a><span class="lineno"> 2751</span>&#160;</div><div class="line"><a name="l02752"></a><span class="lineno"> 2752</span>&#160;   <span class="keywordflow">return</span> res;</div><div class="line"><a name="l02753"></a><span class="lineno"> 2753</span>&#160;}</div><div class="line"><a name="l02754"></a><span class="lineno"> 2754</span>&#160;</div><div class="line"><a name="l02755"></a><span class="lineno"><a class="line" href="../../d7/d30/res__sorcery__memory__cache_8c.html#a0041febade92a59944de63b047e5390f"> 2755</a></span>&#160;<a class="code" href="../../d7/d30/res__sorcery__memory__cache_8c.html#af6639c66b2a5eff1e659bf57d5938e54">AST_TEST_DEFINE</a>(<a class="code" href="../../d2/d6b/structsorcery__memory__cache.html#a73ce7cbebacf7170f054f846300d67ff">maximum_objects</a>)</div><div class="line"><a name="l02756"></a><span class="lineno"> 2756</span>&#160;{</div><div class="line"><a name="l02757"></a><span class="lineno"> 2757</span>&#160;   <span class="keywordtype">int</span> res = <a class="code" href="../../d2/ddc/test_8h.html#aad2aec78205d328d23894a6598cc4044a8a11a3a19eb4c9fd2ba654d95df1adb6">AST_TEST_FAIL</a>;</div><div class="line"><a name="l02758"></a><span class="lineno"> 2758</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d2/d88/structast__sorcery.html">ast_sorcery</a> *<a class="code" href="../../d2/d6b/structsorcery__memory__cache.html#aeb33dcb5573e1661c82b5370681fb626">sorcery</a> = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l02759"></a><span class="lineno"> 2759</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d2/d6b/structsorcery__memory__cache.html">sorcery_memory_cache</a> *cache = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l02760"></a><span class="lineno"> 2760</span>&#160;   <a class="code" href="../../d5/d60/utils_8h.html#a1604b4d72144dd3d9f7da668e90337e9">RAII_VAR</a>(<span class="keywordtype">void</span> *, alice, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../d5/da5/astobj2_8h.html#a6321ee982370c55ab3c24c72c562cbdd">ao2_cleanup</a>);</div><div class="line"><a name="l02761"></a><span class="lineno"> 2761</span>&#160;   <a class="code" href="../../d5/d60/utils_8h.html#a1604b4d72144dd3d9f7da668e90337e9">RAII_VAR</a>(<span class="keywordtype">void</span> *, bob, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../d5/da5/astobj2_8h.html#a6321ee982370c55ab3c24c72c562cbdd">ao2_cleanup</a>);</div><div class="line"><a name="l02762"></a><span class="lineno"> 2762</span>&#160;   <a class="code" href="../../d5/d60/utils_8h.html#a1604b4d72144dd3d9f7da668e90337e9">RAII_VAR</a>(<span class="keywordtype">void</span> *, charlie, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../d5/da5/astobj2_8h.html#a6321ee982370c55ab3c24c72c562cbdd">ao2_cleanup</a>);</div><div class="line"><a name="l02763"></a><span class="lineno"> 2763</span>&#160;   <a class="code" href="../../d5/d60/utils_8h.html#a1604b4d72144dd3d9f7da668e90337e9">RAII_VAR</a>(<span class="keywordtype">void</span> *, cached_object, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../d5/da5/astobj2_8h.html#a6321ee982370c55ab3c24c72c562cbdd">ao2_cleanup</a>);</div><div class="line"><a name="l02764"></a><span class="lineno"> 2764</span>&#160;   <span class="keyword">const</span> <span class="keywordtype">char</span> *in_cache[2];</div><div class="line"><a name="l02765"></a><span class="lineno"> 2765</span>&#160;   <span class="keyword">const</span> <span class="keywordtype">char</span> *not_in_cache[2];</div><div class="line"><a name="l02766"></a><span class="lineno"> 2766</span>&#160;</div><div class="line"><a name="l02767"></a><span class="lineno"> 2767</span>&#160;   <span class="keywordflow">switch</span> (cmd) {</div><div class="line"><a name="l02768"></a><span class="lineno"> 2768</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="../../d2/ddc/test_8h.html#a0689ac4326c7a771e1b6ed1e4cde53e2a21df97525a6ac371a7fb604dfa8ea67b">TEST_INIT</a>:</div><div class="line"><a name="l02769"></a><span class="lineno"> 2769</span>&#160;      <a class="code" href="../../dd/d17/namespacesip__to__pjsip.html#ab82f408a83ecba10ea39afd8abfd371e">info</a>-&gt;name = <span class="stringliteral">&quot;maximum_objects&quot;</span>;</div><div class="line"><a name="l02770"></a><span class="lineno"> 2770</span>&#160;      <a class="code" href="../../dd/d17/namespacesip__to__pjsip.html#ab82f408a83ecba10ea39afd8abfd371e">info</a>-&gt;category = <span class="stringliteral">&quot;/res/res_sorcery_memory_cache/&quot;</span>;</div><div class="line"><a name="l02771"></a><span class="lineno"> 2771</span>&#160;      <a class="code" href="../../dd/d17/namespacesip__to__pjsip.html#ab82f408a83ecba10ea39afd8abfd371e">info</a>-&gt;summary = <span class="stringliteral">&quot;Ensure that the &#39;maximum_objects&#39; option works as expected&quot;</span>;</div><div class="line"><a name="l02772"></a><span class="lineno"> 2772</span>&#160;      <a class="code" href="../../dd/d17/namespacesip__to__pjsip.html#ab82f408a83ecba10ea39afd8abfd371e">info</a>-&gt;description = <span class="stringliteral">&quot;This test performs the following:\n&quot;</span></div><div class="line"><a name="l02773"></a><span class="lineno"> 2773</span>&#160;         <span class="stringliteral">&quot;\t* Creates a memory cache with maximum_objects=2\n&quot;</span></div><div class="line"><a name="l02774"></a><span class="lineno"> 2774</span>&#160;         <span class="stringliteral">&quot;\t* Creates a sorcery instance\n&quot;</span></div><div class="line"><a name="l02775"></a><span class="lineno"> 2775</span>&#160;         <span class="stringliteral">&quot;\t* Creates a three test objects: alice, bob, charlie, and david\n&quot;</span></div><div class="line"><a name="l02776"></a><span class="lineno"> 2776</span>&#160;         <span class="stringliteral">&quot;\t* Pushes alice and bob into the memory cache\n&quot;</span></div><div class="line"><a name="l02777"></a><span class="lineno"> 2777</span>&#160;         <span class="stringliteral">&quot;\t* Confirms that alice and bob are in the memory cache\n&quot;</span></div><div class="line"><a name="l02778"></a><span class="lineno"> 2778</span>&#160;         <span class="stringliteral">&quot;\t* Pushes charlie into the memory cache\n&quot;</span></div><div class="line"><a name="l02779"></a><span class="lineno"> 2779</span>&#160;         <span class="stringliteral">&quot;\t* Confirms that bob and charlie are in the memory cache\n&quot;</span></div><div class="line"><a name="l02780"></a><span class="lineno"> 2780</span>&#160;         <span class="stringliteral">&quot;\t* Deletes charlie from the memory cache\n&quot;</span></div><div class="line"><a name="l02781"></a><span class="lineno"> 2781</span>&#160;         <span class="stringliteral">&quot;\t* Confirms that only bob is in the memory cache\n&quot;</span></div><div class="line"><a name="l02782"></a><span class="lineno"> 2782</span>&#160;         <span class="stringliteral">&quot;\t* Pushes alice into the memory cache\n&quot;</span></div><div class="line"><a name="l02783"></a><span class="lineno"> 2783</span>&#160;         <span class="stringliteral">&quot;\t* Confirms that bob and alice are in the memory cache&quot;</span>;</div><div class="line"><a name="l02784"></a><span class="lineno"> 2784</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../d2/ddc/test_8h.html#aad2aec78205d328d23894a6598cc4044a8cf2ae27807baf798d726d630693cc8c">AST_TEST_NOT_RUN</a>;</div><div class="line"><a name="l02785"></a><span class="lineno"> 2785</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="../../d2/ddc/test_8h.html#a0689ac4326c7a771e1b6ed1e4cde53e2adb2586ef58bb9dd2f84a7d592ecf3e0e">TEST_EXECUTE</a>:</div><div class="line"><a name="l02786"></a><span class="lineno"> 2786</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l02787"></a><span class="lineno"> 2787</span>&#160;   }</div><div class="line"><a name="l02788"></a><span class="lineno"> 2788</span>&#160;</div><div class="line"><a name="l02789"></a><span class="lineno"> 2789</span>&#160;   cache = <a class="code" href="../../d7/d30/res__sorcery__memory__cache_8c.html#a73c11b5eb7314f2dbd3f32d18b69b10f">sorcery_memory_cache_open</a>(<span class="stringliteral">&quot;maximum_objects=2&quot;</span>);</div><div class="line"><a name="l02790"></a><span class="lineno"> 2790</span>&#160;   <span class="keywordflow">if</span> (!cache) {</div><div class="line"><a name="l02791"></a><span class="lineno"> 2791</span>&#160;      <a class="code" href="../../d2/ddc/test_8h.html#a5e8fddded61f6989172c981256e7c9bd">ast_test_status_update</a>(<a class="code" href="../../d8/d89/structtest.html">test</a>, <span class="stringliteral">&quot;Failed to create a sorcery memory cache with maximum_objects=2\n&quot;</span>);</div><div class="line"><a name="l02792"></a><span class="lineno"> 2792</span>&#160;      <span class="keywordflow">goto</span> <a class="code" href="../../d2/d2c/pbx__realtime_8c.html#a10b51e1931bd03dd172cbfb9d3d67efb">cleanup</a>;</div><div class="line"><a name="l02793"></a><span class="lineno"> 2793</span>&#160;   }</div><div class="line"><a name="l02794"></a><span class="lineno"> 2794</span>&#160;</div><div class="line"><a name="l02795"></a><span class="lineno"> 2795</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d5/da5/astobj2_8h.html#a512cc40ce96c63b3d5c78040baa4c9cd">ao2_container_count</a>(cache-&gt;<a class="code" href="../../d2/d6b/structsorcery__memory__cache.html#aa0a84e33972901716d6d5a6dcf1a68de">objects</a>)) {</div><div class="line"><a name="l02796"></a><span class="lineno"> 2796</span>&#160;      <a class="code" href="../../d2/ddc/test_8h.html#a5e8fddded61f6989172c981256e7c9bd">ast_test_status_update</a>(<a class="code" href="../../d8/d89/structtest.html">test</a>, <span class="stringliteral">&quot;Memory cache contains cached objects before we added one\n&quot;</span>);</div><div class="line"><a name="l02797"></a><span class="lineno"> 2797</span>&#160;      <span class="keywordflow">goto</span> <a class="code" href="../../d2/d2c/pbx__realtime_8c.html#a10b51e1931bd03dd172cbfb9d3d67efb">cleanup</a>;</div><div class="line"><a name="l02798"></a><span class="lineno"> 2798</span>&#160;   }</div><div class="line"><a name="l02799"></a><span class="lineno"> 2799</span>&#160;</div><div class="line"><a name="l02800"></a><span class="lineno"> 2800</span>&#160;   sorcery = <a class="code" href="../../d7/d30/res__sorcery__memory__cache_8c.html#af9b170dc8108e107601ebfdc5b0ed1ed">alloc_and_initialize_sorcery</a>();</div><div class="line"><a name="l02801"></a><span class="lineno"> 2801</span>&#160;   <span class="keywordflow">if</span> (!sorcery) {</div><div class="line"><a name="l02802"></a><span class="lineno"> 2802</span>&#160;      <a class="code" href="../../d2/ddc/test_8h.html#a5e8fddded61f6989172c981256e7c9bd">ast_test_status_update</a>(<a class="code" href="../../d8/d89/structtest.html">test</a>, <span class="stringliteral">&quot;Failed to create a test sorcery instance\n&quot;</span>);</div><div class="line"><a name="l02803"></a><span class="lineno"> 2803</span>&#160;      <span class="keywordflow">goto</span> <a class="code" href="../../d2/d2c/pbx__realtime_8c.html#a10b51e1931bd03dd172cbfb9d3d67efb">cleanup</a>;</div><div class="line"><a name="l02804"></a><span class="lineno"> 2804</span>&#160;   }</div><div class="line"><a name="l02805"></a><span class="lineno"> 2805</span>&#160;</div><div class="line"><a name="l02806"></a><span class="lineno"> 2806</span>&#160;   alice = <a class="code" href="../../d8/d25/sorcery_8h.html#acb6c97c18566cf94a7ac95a43dd9a816">ast_sorcery_alloc</a>(sorcery, <span class="stringliteral">&quot;test&quot;</span>, <span class="stringliteral">&quot;alice&quot;</span>);</div><div class="line"><a name="l02807"></a><span class="lineno"> 2807</span>&#160;   bob = <a class="code" href="../../d8/d25/sorcery_8h.html#acb6c97c18566cf94a7ac95a43dd9a816">ast_sorcery_alloc</a>(sorcery, <span class="stringliteral">&quot;test&quot;</span>, <span class="stringliteral">&quot;bob&quot;</span>);</div><div class="line"><a name="l02808"></a><span class="lineno"> 2808</span>&#160;   charlie = <a class="code" href="../../d8/d25/sorcery_8h.html#acb6c97c18566cf94a7ac95a43dd9a816">ast_sorcery_alloc</a>(sorcery, <span class="stringliteral">&quot;test&quot;</span>, <span class="stringliteral">&quot;charlie&quot;</span>);</div><div class="line"><a name="l02809"></a><span class="lineno"> 2809</span>&#160;</div><div class="line"><a name="l02810"></a><span class="lineno"> 2810</span>&#160;   <span class="keywordflow">if</span> (!alice || !bob || !charlie) {</div><div class="line"><a name="l02811"></a><span class="lineno"> 2811</span>&#160;      <a class="code" href="../../d2/ddc/test_8h.html#a5e8fddded61f6989172c981256e7c9bd">ast_test_status_update</a>(<a class="code" href="../../d8/d89/structtest.html">test</a>, <span class="stringliteral">&quot;Failed to allocate sorcery object(s)\n&quot;</span>);</div><div class="line"><a name="l02812"></a><span class="lineno"> 2812</span>&#160;      <span class="keywordflow">goto</span> <a class="code" href="../../d2/d2c/pbx__realtime_8c.html#a10b51e1931bd03dd172cbfb9d3d67efb">cleanup</a>;</div><div class="line"><a name="l02813"></a><span class="lineno"> 2813</span>&#160;   }</div><div class="line"><a name="l02814"></a><span class="lineno"> 2814</span>&#160;</div><div class="line"><a name="l02815"></a><span class="lineno"> 2815</span>&#160;   <a class="code" href="../../d7/d30/res__sorcery__memory__cache_8c.html#a751f8dcc38eb8ff1f9aee8b2b0c14db0">sorcery_memory_cache_create</a>(sorcery, cache, alice);</div><div class="line"><a name="l02816"></a><span class="lineno"> 2816</span>&#160;   in_cache[0] = <span class="stringliteral">&quot;alice&quot;</span>;</div><div class="line"><a name="l02817"></a><span class="lineno"> 2817</span>&#160;   in_cache[1] = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l02818"></a><span class="lineno"> 2818</span>&#160;   not_in_cache[0] = <span class="stringliteral">&quot;bob&quot;</span>;</div><div class="line"><a name="l02819"></a><span class="lineno"> 2819</span>&#160;   not_in_cache[1] = <span class="stringliteral">&quot;charlie&quot;</span>;</div><div class="line"><a name="l02820"></a><span class="lineno"> 2820</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d7/d30/res__sorcery__memory__cache_8c.html#adda5136e1f2b6ee965600a082879388e">check_cache_content</a>(<a class="code" href="../../d8/d89/structtest.html">test</a>, sorcery, cache, in_cache, 1, not_in_cache, 2)) {</div><div class="line"><a name="l02821"></a><span class="lineno"> 2821</span>&#160;      <span class="keywordflow">goto</span> <a class="code" href="../../d2/d2c/pbx__realtime_8c.html#a10b51e1931bd03dd172cbfb9d3d67efb">cleanup</a>;</div><div class="line"><a name="l02822"></a><span class="lineno"> 2822</span>&#160;   }</div><div class="line"><a name="l02823"></a><span class="lineno"> 2823</span>&#160;</div><div class="line"><a name="l02824"></a><span class="lineno"> 2824</span>&#160;   <span class="comment">/* Delays are added to ensure that we are not adding cache entries within the</span></div><div class="line"><a name="l02825"></a><span class="lineno"> 2825</span>&#160;<span class="comment">    * same microsecond</span></div><div class="line"><a name="l02826"></a><span class="lineno"> 2826</span>&#160;<span class="comment">    */</span></div><div class="line"><a name="l02827"></a><span class="lineno"> 2827</span>&#160;   usleep(1000);</div><div class="line"><a name="l02828"></a><span class="lineno"> 2828</span>&#160;</div><div class="line"><a name="l02829"></a><span class="lineno"> 2829</span>&#160;   <a class="code" href="../../d7/d30/res__sorcery__memory__cache_8c.html#a751f8dcc38eb8ff1f9aee8b2b0c14db0">sorcery_memory_cache_create</a>(sorcery, cache, bob);</div><div class="line"><a name="l02830"></a><span class="lineno"> 2830</span>&#160;   in_cache[0] = <span class="stringliteral">&quot;alice&quot;</span>;</div><div class="line"><a name="l02831"></a><span class="lineno"> 2831</span>&#160;   in_cache[1] = <span class="stringliteral">&quot;bob&quot;</span>;</div><div class="line"><a name="l02832"></a><span class="lineno"> 2832</span>&#160;   not_in_cache[0] = <span class="stringliteral">&quot;charlie&quot;</span>;</div><div class="line"><a name="l02833"></a><span class="lineno"> 2833</span>&#160;   not_in_cache[1] = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l02834"></a><span class="lineno"> 2834</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d7/d30/res__sorcery__memory__cache_8c.html#adda5136e1f2b6ee965600a082879388e">check_cache_content</a>(<a class="code" href="../../d8/d89/structtest.html">test</a>, sorcery, cache, in_cache, 2, not_in_cache, 1)) {</div><div class="line"><a name="l02835"></a><span class="lineno"> 2835</span>&#160;      <span class="keywordflow">goto</span> <a class="code" href="../../d2/d2c/pbx__realtime_8c.html#a10b51e1931bd03dd172cbfb9d3d67efb">cleanup</a>;</div><div class="line"><a name="l02836"></a><span class="lineno"> 2836</span>&#160;   }</div><div class="line"><a name="l02837"></a><span class="lineno"> 2837</span>&#160;</div><div class="line"><a name="l02838"></a><span class="lineno"> 2838</span>&#160;   usleep(1000);</div><div class="line"><a name="l02839"></a><span class="lineno"> 2839</span>&#160;</div><div class="line"><a name="l02840"></a><span class="lineno"> 2840</span>&#160;   <a class="code" href="../../d7/d30/res__sorcery__memory__cache_8c.html#a751f8dcc38eb8ff1f9aee8b2b0c14db0">sorcery_memory_cache_create</a>(sorcery, cache, charlie);</div><div class="line"><a name="l02841"></a><span class="lineno"> 2841</span>&#160;   in_cache[0] = <span class="stringliteral">&quot;bob&quot;</span>;</div><div class="line"><a name="l02842"></a><span class="lineno"> 2842</span>&#160;   in_cache[1] = <span class="stringliteral">&quot;charlie&quot;</span>;</div><div class="line"><a name="l02843"></a><span class="lineno"> 2843</span>&#160;   not_in_cache[0] = <span class="stringliteral">&quot;alice&quot;</span>;</div><div class="line"><a name="l02844"></a><span class="lineno"> 2844</span>&#160;   not_in_cache[1] = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l02845"></a><span class="lineno"> 2845</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d7/d30/res__sorcery__memory__cache_8c.html#adda5136e1f2b6ee965600a082879388e">check_cache_content</a>(<a class="code" href="../../d8/d89/structtest.html">test</a>, sorcery, cache, in_cache, 2, not_in_cache, 1)) {</div><div class="line"><a name="l02846"></a><span class="lineno"> 2846</span>&#160;      <span class="keywordflow">goto</span> <a class="code" href="../../d2/d2c/pbx__realtime_8c.html#a10b51e1931bd03dd172cbfb9d3d67efb">cleanup</a>;</div><div class="line"><a name="l02847"></a><span class="lineno"> 2847</span>&#160;   }</div><div class="line"><a name="l02848"></a><span class="lineno"> 2848</span>&#160;   usleep(1000);</div><div class="line"><a name="l02849"></a><span class="lineno"> 2849</span>&#160;</div><div class="line"><a name="l02850"></a><span class="lineno"> 2850</span>&#160;   <a class="code" href="../../d7/d30/res__sorcery__memory__cache_8c.html#a8be072ec91ebdbdbb1153b0a5b03a452">sorcery_memory_cache_delete</a>(sorcery, cache, charlie);</div><div class="line"><a name="l02851"></a><span class="lineno"> 2851</span>&#160;   in_cache[0] = <span class="stringliteral">&quot;bob&quot;</span>;</div><div class="line"><a name="l02852"></a><span class="lineno"> 2852</span>&#160;   in_cache[1] = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l02853"></a><span class="lineno"> 2853</span>&#160;   not_in_cache[0] = <span class="stringliteral">&quot;alice&quot;</span>;</div><div class="line"><a name="l02854"></a><span class="lineno"> 2854</span>&#160;   not_in_cache[1] = <span class="stringliteral">&quot;charlie&quot;</span>;</div><div class="line"><a name="l02855"></a><span class="lineno"> 2855</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d7/d30/res__sorcery__memory__cache_8c.html#adda5136e1f2b6ee965600a082879388e">check_cache_content</a>(<a class="code" href="../../d8/d89/structtest.html">test</a>, sorcery, cache, in_cache, 1, not_in_cache, 2)) {</div><div class="line"><a name="l02856"></a><span class="lineno"> 2856</span>&#160;      <span class="keywordflow">goto</span> <a class="code" href="../../d2/d2c/pbx__realtime_8c.html#a10b51e1931bd03dd172cbfb9d3d67efb">cleanup</a>;</div><div class="line"><a name="l02857"></a><span class="lineno"> 2857</span>&#160;   }</div><div class="line"><a name="l02858"></a><span class="lineno"> 2858</span>&#160;   usleep(1000);</div><div class="line"><a name="l02859"></a><span class="lineno"> 2859</span>&#160;</div><div class="line"><a name="l02860"></a><span class="lineno"> 2860</span>&#160;   <a class="code" href="../../d7/d30/res__sorcery__memory__cache_8c.html#a751f8dcc38eb8ff1f9aee8b2b0c14db0">sorcery_memory_cache_create</a>(sorcery, cache, alice);</div><div class="line"><a name="l02861"></a><span class="lineno"> 2861</span>&#160;   in_cache[0] = <span class="stringliteral">&quot;bob&quot;</span>;</div><div class="line"><a name="l02862"></a><span class="lineno"> 2862</span>&#160;   in_cache[1] = <span class="stringliteral">&quot;alice&quot;</span>;</div><div class="line"><a name="l02863"></a><span class="lineno"> 2863</span>&#160;   not_in_cache[0] = <span class="stringliteral">&quot;charlie&quot;</span>;</div><div class="line"><a name="l02864"></a><span class="lineno"> 2864</span>&#160;   not_in_cache[1] = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l02865"></a><span class="lineno"> 2865</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d7/d30/res__sorcery__memory__cache_8c.html#adda5136e1f2b6ee965600a082879388e">check_cache_content</a>(<a class="code" href="../../d8/d89/structtest.html">test</a>, sorcery, cache, in_cache, 2, not_in_cache, 1)) {</div><div class="line"><a name="l02866"></a><span class="lineno"> 2866</span>&#160;      <span class="keywordflow">goto</span> <a class="code" href="../../d2/d2c/pbx__realtime_8c.html#a10b51e1931bd03dd172cbfb9d3d67efb">cleanup</a>;</div><div class="line"><a name="l02867"></a><span class="lineno"> 2867</span>&#160;   }</div><div class="line"><a name="l02868"></a><span class="lineno"> 2868</span>&#160;</div><div class="line"><a name="l02869"></a><span class="lineno"> 2869</span>&#160;   res = <a class="code" href="../../d2/ddc/test_8h.html#aad2aec78205d328d23894a6598cc4044a7a3ab73c870a7ce6cf1a0f3cfd42a37b">AST_TEST_PASS</a>;</div><div class="line"><a name="l02870"></a><span class="lineno"> 2870</span>&#160;</div><div class="line"><a name="l02871"></a><span class="lineno"> 2871</span>&#160;<a class="code" href="../../d2/d2c/pbx__realtime_8c.html#a10b51e1931bd03dd172cbfb9d3d67efb">cleanup</a>:</div><div class="line"><a name="l02872"></a><span class="lineno"> 2872</span>&#160;   <span class="keywordflow">if</span> (cache) {</div><div class="line"><a name="l02873"></a><span class="lineno"> 2873</span>&#160;      <a class="code" href="../../d7/d30/res__sorcery__memory__cache_8c.html#a9f6a8b7453ee946fb55fac3b0237f514">sorcery_memory_cache_close</a>(cache);</div><div class="line"><a name="l02874"></a><span class="lineno"> 2874</span>&#160;   }</div><div class="line"><a name="l02875"></a><span class="lineno"> 2875</span>&#160;   <span class="keywordflow">if</span> (sorcery) {</div><div class="line"><a name="l02876"></a><span class="lineno"> 2876</span>&#160;      <a class="code" href="../../d8/d25/sorcery_8h.html#a09cba9c37c702ca2bdcf94052068ed67">ast_sorcery_unref</a>(sorcery);</div><div class="line"><a name="l02877"></a><span class="lineno"> 2877</span>&#160;   }</div><div class="line"><a name="l02878"></a><span class="lineno"> 2878</span>&#160;</div><div class="line"><a name="l02879"></a><span class="lineno"> 2879</span>&#160;   <span class="keywordflow">return</span> res;</div><div class="line"><a name="l02880"></a><span class="lineno"> 2880</span>&#160;}</div><div class="line"><a name="l02881"></a><span class="lineno"> 2881</span>&#160;</div><div class="line"><a name="l02882"></a><span class="lineno"><a class="line" href="../../d7/d30/res__sorcery__memory__cache_8c.html#a4f7ea541cab7725c78ec5fec2600f8b3"> 2882</a></span>&#160;<a class="code" href="../../d7/d30/res__sorcery__memory__cache_8c.html#af6639c66b2a5eff1e659bf57d5938e54">AST_TEST_DEFINE</a>(expiration)</div><div class="line"><a name="l02883"></a><span class="lineno"> 2883</span>&#160;{</div><div class="line"><a name="l02884"></a><span class="lineno"> 2884</span>&#160;   <span class="keywordtype">int</span> res = <a class="code" href="../../d2/ddc/test_8h.html#aad2aec78205d328d23894a6598cc4044a8a11a3a19eb4c9fd2ba654d95df1adb6">AST_TEST_FAIL</a>;</div><div class="line"><a name="l02885"></a><span class="lineno"> 2885</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d2/d88/structast__sorcery.html">ast_sorcery</a> *<a class="code" href="../../d2/d6b/structsorcery__memory__cache.html#aeb33dcb5573e1661c82b5370681fb626">sorcery</a> = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l02886"></a><span class="lineno"> 2886</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d2/d6b/structsorcery__memory__cache.html">sorcery_memory_cache</a> *cache = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l02887"></a><span class="lineno"> 2887</span>&#160;   <span class="keywordtype">int</span> i;</div><div class="line"><a name="l02888"></a><span class="lineno"> 2888</span>&#160;</div><div class="line"><a name="l02889"></a><span class="lineno"> 2889</span>&#160;   <span class="keywordflow">switch</span> (cmd) {</div><div class="line"><a name="l02890"></a><span class="lineno"> 2890</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="../../d2/ddc/test_8h.html#a0689ac4326c7a771e1b6ed1e4cde53e2a21df97525a6ac371a7fb604dfa8ea67b">TEST_INIT</a>:</div><div class="line"><a name="l02891"></a><span class="lineno"> 2891</span>&#160;      <a class="code" href="../../dd/d17/namespacesip__to__pjsip.html#ab82f408a83ecba10ea39afd8abfd371e">info</a>-&gt;name = <span class="stringliteral">&quot;expiration&quot;</span>;</div><div class="line"><a name="l02892"></a><span class="lineno"> 2892</span>&#160;      <a class="code" href="../../dd/d17/namespacesip__to__pjsip.html#ab82f408a83ecba10ea39afd8abfd371e">info</a>-&gt;category = <span class="stringliteral">&quot;/res/res_sorcery_memory_cache/&quot;</span>;</div><div class="line"><a name="l02893"></a><span class="lineno"> 2893</span>&#160;      <a class="code" href="../../dd/d17/namespacesip__to__pjsip.html#ab82f408a83ecba10ea39afd8abfd371e">info</a>-&gt;summary = <span class="stringliteral">&quot;Add objects to a cache configured with maximum lifetime, confirm they are removed&quot;</span>;</div><div class="line"><a name="l02894"></a><span class="lineno"> 2894</span>&#160;      <a class="code" href="../../dd/d17/namespacesip__to__pjsip.html#ab82f408a83ecba10ea39afd8abfd371e">info</a>-&gt;description = <span class="stringliteral">&quot;This test performs the following:\n&quot;</span></div><div class="line"><a name="l02895"></a><span class="lineno"> 2895</span>&#160;         <span class="stringliteral">&quot;\t* Creates a memory cache with a maximum object lifetime of 5 seconds\n&quot;</span></div><div class="line"><a name="l02896"></a><span class="lineno"> 2896</span>&#160;         <span class="stringliteral">&quot;\t* Pushes 10 objects into the memory cache\n&quot;</span></div><div class="line"><a name="l02897"></a><span class="lineno"> 2897</span>&#160;         <span class="stringliteral">&quot;\t* Waits (up to) 10 seconds for expiration to occur\n&quot;</span></div><div class="line"><a name="l02898"></a><span class="lineno"> 2898</span>&#160;         <span class="stringliteral">&quot;\t* Confirms that the objects have been removed from the cache&quot;</span>;</div><div class="line"><a name="l02899"></a><span class="lineno"> 2899</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../d2/ddc/test_8h.html#aad2aec78205d328d23894a6598cc4044a8cf2ae27807baf798d726d630693cc8c">AST_TEST_NOT_RUN</a>;</div><div class="line"><a name="l02900"></a><span class="lineno"> 2900</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="../../d2/ddc/test_8h.html#a0689ac4326c7a771e1b6ed1e4cde53e2adb2586ef58bb9dd2f84a7d592ecf3e0e">TEST_EXECUTE</a>:</div><div class="line"><a name="l02901"></a><span class="lineno"> 2901</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l02902"></a><span class="lineno"> 2902</span>&#160;   }</div><div class="line"><a name="l02903"></a><span class="lineno"> 2903</span>&#160;</div><div class="line"><a name="l02904"></a><span class="lineno"> 2904</span>&#160;   cache = <a class="code" href="../../d7/d30/res__sorcery__memory__cache_8c.html#a73c11b5eb7314f2dbd3f32d18b69b10f">sorcery_memory_cache_open</a>(<span class="stringliteral">&quot;object_lifetime_maximum=5&quot;</span>);</div><div class="line"><a name="l02905"></a><span class="lineno"> 2905</span>&#160;   <span class="keywordflow">if</span> (!cache) {</div><div class="line"><a name="l02906"></a><span class="lineno"> 2906</span>&#160;      <a class="code" href="../../d2/ddc/test_8h.html#a5e8fddded61f6989172c981256e7c9bd">ast_test_status_update</a>(<a class="code" href="../../d8/d89/structtest.html">test</a>, <span class="stringliteral">&quot;Failed to create a sorcery memory cache using default options\n&quot;</span>);</div><div class="line"><a name="l02907"></a><span class="lineno"> 2907</span>&#160;      <span class="keywordflow">goto</span> <a class="code" href="../../d2/d2c/pbx__realtime_8c.html#a10b51e1931bd03dd172cbfb9d3d67efb">cleanup</a>;</div><div class="line"><a name="l02908"></a><span class="lineno"> 2908</span>&#160;   }</div><div class="line"><a name="l02909"></a><span class="lineno"> 2909</span>&#160;</div><div class="line"><a name="l02910"></a><span class="lineno"> 2910</span>&#160;   sorcery = <a class="code" href="../../d7/d30/res__sorcery__memory__cache_8c.html#af9b170dc8108e107601ebfdc5b0ed1ed">alloc_and_initialize_sorcery</a>();</div><div class="line"><a name="l02911"></a><span class="lineno"> 2911</span>&#160;   <span class="keywordflow">if</span> (!sorcery) {</div><div class="line"><a name="l02912"></a><span class="lineno"> 2912</span>&#160;      <a class="code" href="../../d2/ddc/test_8h.html#a5e8fddded61f6989172c981256e7c9bd">ast_test_status_update</a>(<a class="code" href="../../d8/d89/structtest.html">test</a>, <span class="stringliteral">&quot;Failed to create a test sorcery instance\n&quot;</span>);</div><div class="line"><a name="l02913"></a><span class="lineno"> 2913</span>&#160;      <span class="keywordflow">goto</span> <a class="code" href="../../d2/d2c/pbx__realtime_8c.html#a10b51e1931bd03dd172cbfb9d3d67efb">cleanup</a>;</div><div class="line"><a name="l02914"></a><span class="lineno"> 2914</span>&#160;   }</div><div class="line"><a name="l02915"></a><span class="lineno"> 2915</span>&#160;</div><div class="line"><a name="l02916"></a><span class="lineno"> 2916</span>&#160;   cache-&gt;<a class="code" href="../../d2/d6b/structsorcery__memory__cache.html#ac0ac5403988b7156dde84af2b7054766">cache_notify</a> = 1;</div><div class="line"><a name="l02917"></a><span class="lineno"> 2917</span>&#160;   <a class="code" href="../../dd/d42/lock_8h.html#a76e8ed6bb354be6c6dd9e51acc1d7a1b">ast_mutex_init</a>(&amp;cache-&gt;<a class="code" href="../../d2/d6b/structsorcery__memory__cache.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);</div><div class="line"><a name="l02918"></a><span class="lineno"> 2918</span>&#160;   <a class="code" href="../../dd/d42/lock_8h.html#a69e9591803d36f5683eb9b084442be9b">ast_cond_init</a>(&amp;cache-&gt;<a class="code" href="../../d2/d6b/structsorcery__memory__cache.html#a1c7181c39f99ee801943a0d0aa9872b9">cond</a>, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div><div class="line"><a name="l02919"></a><span class="lineno"> 2919</span>&#160;</div><div class="line"><a name="l02920"></a><span class="lineno"> 2920</span>&#160;   <span class="keywordflow">for</span> (i = 0; i &lt; 5; ++i) {</div><div class="line"><a name="l02921"></a><span class="lineno"> 2921</span>&#160;      <span class="keywordtype">char</span> uuid[<a class="code" href="../../dd/d1d/uuid_8h.html#a127408e53d34dca0c589a099fabf1e13">AST_UUID_STR_LEN</a>];</div><div class="line"><a name="l02922"></a><span class="lineno"> 2922</span>&#160;      <span class="keywordtype">void</span> *object;</div><div class="line"><a name="l02923"></a><span class="lineno"> 2923</span>&#160;</div><div class="line"><a name="l02924"></a><span class="lineno"> 2924</span>&#160;      <span class="keywordtype">object</span> = <a class="code" href="../../d8/d25/sorcery_8h.html#acb6c97c18566cf94a7ac95a43dd9a816">ast_sorcery_alloc</a>(sorcery, <span class="stringliteral">&quot;test&quot;</span>, <a class="code" href="../../dd/d1d/uuid_8h.html#abe6d0b550cd9a54964e7891960d1e5bc">ast_uuid_generate_str</a>(uuid, <span class="keyword">sizeof</span>(uuid)));</div><div class="line"><a name="l02925"></a><span class="lineno"> 2925</span>&#160;      <span class="keywordflow">if</span> (!<span class="keywordtype">object</span>) {</div><div class="line"><a name="l02926"></a><span class="lineno"> 2926</span>&#160;         <a class="code" href="../../d2/ddc/test_8h.html#a5e8fddded61f6989172c981256e7c9bd">ast_test_status_update</a>(<a class="code" href="../../d8/d89/structtest.html">test</a>, <span class="stringliteral">&quot;Failed to allocate test object for expiration\n&quot;</span>);</div><div class="line"><a name="l02927"></a><span class="lineno"> 2927</span>&#160;         <span class="keywordflow">goto</span> <a class="code" href="../../d2/d2c/pbx__realtime_8c.html#a10b51e1931bd03dd172cbfb9d3d67efb">cleanup</a>;</div><div class="line"><a name="l02928"></a><span class="lineno"> 2928</span>&#160;      }</div><div class="line"><a name="l02929"></a><span class="lineno"> 2929</span>&#160;</div><div class="line"><a name="l02930"></a><span class="lineno"> 2930</span>&#160;      <a class="code" href="../../d7/d30/res__sorcery__memory__cache_8c.html#a751f8dcc38eb8ff1f9aee8b2b0c14db0">sorcery_memory_cache_create</a>(sorcery, cache, <span class="keywordtype">object</span>);</div><div class="line"><a name="l02931"></a><span class="lineno"> 2931</span>&#160;</div><div class="line"><a name="l02932"></a><span class="lineno"> 2932</span>&#160;      <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(<span class="keywordtype">object</span>, -1);</div><div class="line"><a name="l02933"></a><span class="lineno"> 2933</span>&#160;   }</div><div class="line"><a name="l02934"></a><span class="lineno"> 2934</span>&#160;</div><div class="line"><a name="l02935"></a><span class="lineno"> 2935</span>&#160;   <a class="code" href="../../dd/d42/lock_8h.html#ac5e13c7fe64d3b271a52028b0a78b92b">ast_mutex_lock</a>(&amp;cache-&gt;<a class="code" href="../../d2/d6b/structsorcery__memory__cache.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);</div><div class="line"><a name="l02936"></a><span class="lineno"> 2936</span>&#160;   <span class="keywordflow">while</span> (!cache-&gt;<a class="code" href="../../d2/d6b/structsorcery__memory__cache.html#a1c0f22ced3c7233f3945fcc05219f12a">cache_completed</a>) {</div><div class="line"><a name="l02937"></a><span class="lineno"> 2937</span>&#160;      <span class="keyword">struct </span>timeval start = <a class="code" href="../../de/df7/time_8h.html#ad3899efb6f0e348556ef69f5b16aa7f7">ast_tvnow</a>();</div><div class="line"><a name="l02938"></a><span class="lineno"> 2938</span>&#160;      <span class="keyword">struct </span>timespec end = {</div><div class="line"><a name="l02939"></a><span class="lineno"> 2939</span>&#160;         .tv_sec = start.tv_sec + 10,</div><div class="line"><a name="l02940"></a><span class="lineno"> 2940</span>&#160;         .tv_nsec = start.tv_usec * 1000,</div><div class="line"><a name="l02941"></a><span class="lineno"> 2941</span>&#160;      };</div><div class="line"><a name="l02942"></a><span class="lineno"> 2942</span>&#160;</div><div class="line"><a name="l02943"></a><span class="lineno"> 2943</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="../../dd/d42/lock_8h.html#a6add1f30b2d53ca9384b15529a6f126e">ast_cond_timedwait</a>(&amp;cache-&gt;<a class="code" href="../../d2/d6b/structsorcery__memory__cache.html#a1c7181c39f99ee801943a0d0aa9872b9">cond</a>, &amp;cache-&gt;<a class="code" href="../../d2/d6b/structsorcery__memory__cache.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>, &amp;end) == ETIMEDOUT) {</div><div class="line"><a name="l02944"></a><span class="lineno"> 2944</span>&#160;         <span class="keywordflow">break</span>;</div><div class="line"><a name="l02945"></a><span class="lineno"> 2945</span>&#160;      }</div><div class="line"><a name="l02946"></a><span class="lineno"> 2946</span>&#160;   }</div><div class="line"><a name="l02947"></a><span class="lineno"> 2947</span>&#160;   <a class="code" href="../../dd/d42/lock_8h.html#a873f9ce8c6287a32d48c83133e124418">ast_mutex_unlock</a>(&amp;cache-&gt;<a class="code" href="../../d2/d6b/structsorcery__memory__cache.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);</div><div class="line"><a name="l02948"></a><span class="lineno"> 2948</span>&#160;</div><div class="line"><a name="l02949"></a><span class="lineno"> 2949</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d5/da5/astobj2_8h.html#a512cc40ce96c63b3d5c78040baa4c9cd">ao2_container_count</a>(cache-&gt;<a class="code" href="../../d2/d6b/structsorcery__memory__cache.html#aa0a84e33972901716d6d5a6dcf1a68de">objects</a>)) {</div><div class="line"><a name="l02950"></a><span class="lineno"> 2950</span>&#160;      <a class="code" href="../../d2/ddc/test_8h.html#a5e8fddded61f6989172c981256e7c9bd">ast_test_status_update</a>(<a class="code" href="../../d8/d89/structtest.html">test</a>, <span class="stringliteral">&quot;Objects placed into the memory cache did not expire and get removed\n&quot;</span>);</div><div class="line"><a name="l02951"></a><span class="lineno"> 2951</span>&#160;      <span class="keywordflow">goto</span> <a class="code" href="../../d2/d2c/pbx__realtime_8c.html#a10b51e1931bd03dd172cbfb9d3d67efb">cleanup</a>;</div><div class="line"><a name="l02952"></a><span class="lineno"> 2952</span>&#160;   }</div><div class="line"><a name="l02953"></a><span class="lineno"> 2953</span>&#160;</div><div class="line"><a name="l02954"></a><span class="lineno"> 2954</span>&#160;   res = <a class="code" href="../../d2/ddc/test_8h.html#aad2aec78205d328d23894a6598cc4044a7a3ab73c870a7ce6cf1a0f3cfd42a37b">AST_TEST_PASS</a>;</div><div class="line"><a name="l02955"></a><span class="lineno"> 2955</span>&#160;</div><div class="line"><a name="l02956"></a><span class="lineno"> 2956</span>&#160;<a class="code" href="../../d2/d2c/pbx__realtime_8c.html#a10b51e1931bd03dd172cbfb9d3d67efb">cleanup</a>:</div><div class="line"><a name="l02957"></a><span class="lineno"> 2957</span>&#160;   <span class="keywordflow">if</span> (cache) {</div><div class="line"><a name="l02958"></a><span class="lineno"> 2958</span>&#160;      <span class="keywordflow">if</span> (cache-&gt;<a class="code" href="../../d2/d6b/structsorcery__memory__cache.html#ac0ac5403988b7156dde84af2b7054766">cache_notify</a>) {</div><div class="line"><a name="l02959"></a><span class="lineno"> 2959</span>&#160;         <a class="code" href="../../dd/d42/lock_8h.html#a1ea2f4040a736cddbecea48b30ffedfd">ast_cond_destroy</a>(&amp;cache-&gt;<a class="code" href="../../d2/d6b/structsorcery__memory__cache.html#a1c7181c39f99ee801943a0d0aa9872b9">cond</a>);</div><div class="line"><a name="l02960"></a><span class="lineno"> 2960</span>&#160;         <a class="code" href="../../dd/d42/lock_8h.html#ab8977a71822daa556f19f30ba6eec765">ast_mutex_destroy</a>(&amp;cache-&gt;<a class="code" href="../../d2/d6b/structsorcery__memory__cache.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);</div><div class="line"><a name="l02961"></a><span class="lineno"> 2961</span>&#160;      }</div><div class="line"><a name="l02962"></a><span class="lineno"> 2962</span>&#160;      <a class="code" href="../../d7/d30/res__sorcery__memory__cache_8c.html#a9f6a8b7453ee946fb55fac3b0237f514">sorcery_memory_cache_close</a>(cache);</div><div class="line"><a name="l02963"></a><span class="lineno"> 2963</span>&#160;   }</div><div class="line"><a name="l02964"></a><span class="lineno"> 2964</span>&#160;   <span class="keywordflow">if</span> (sorcery) {</div><div class="line"><a name="l02965"></a><span class="lineno"> 2965</span>&#160;      <a class="code" href="../../d8/d25/sorcery_8h.html#a09cba9c37c702ca2bdcf94052068ed67">ast_sorcery_unref</a>(sorcery);</div><div class="line"><a name="l02966"></a><span class="lineno"> 2966</span>&#160;   }</div><div class="line"><a name="l02967"></a><span class="lineno"> 2967</span>&#160;</div><div class="line"><a name="l02968"></a><span class="lineno"> 2968</span>&#160;   <span class="keywordflow">return</span> res;</div><div class="line"><a name="l02969"></a><span class="lineno"> 2969</span>&#160;}</div><div class="line"><a name="l02970"></a><span class="lineno"> 2970</span>&#160;<span class="comment"></span></div><div class="line"><a name="l02971"></a><span class="lineno"> 2971</span>&#160;<span class="comment">/*!</span></div><div class="line"><a name="l02972"></a><span class="lineno"> 2972</span>&#160;<span class="comment"> * \brief Backend data that the mock sorcery wizard uses to create objects</span></div><div class="line"><a name="l02973"></a><span class="lineno"> 2973</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l02974"></a><span class="lineno"><a class="line" href="../../d2/d13/structbackend__data.html"> 2974</a></span>&#160;<span class="keyword">static</span> <span class="keyword">struct </span><a class="code" href="../../d2/d13/structbackend__data.html">backend_data</a> {<span class="comment"></span></div><div class="line"><a name="l02975"></a><span class="lineno"> 2975</span>&#160;<span class="comment">   /*! An arbitrary data field */</span></div><div class="line"><a name="l02976"></a><span class="lineno"><a class="line" href="../../d2/d13/structbackend__data.html#a0817c9db744a78699e31ca83df2ef709"> 2976</a></span>&#160;   <span class="keywordtype">int</span> <a class="code" href="../../d2/d13/structbackend__data.html#a0817c9db744a78699e31ca83df2ef709">salt</a>;<span class="comment"></span></div><div class="line"><a name="l02977"></a><span class="lineno"> 2977</span>&#160;<span class="comment">   /*! Another arbitrary data field */</span></div><div class="line"><a name="l02978"></a><span class="lineno"><a class="line" href="../../d2/d13/structbackend__data.html#aa1620f4c22693d406d9d5e3bd585695f"> 2978</a></span>&#160;   <span class="keywordtype">int</span> <a class="code" href="../../d2/d13/structbackend__data.html#aa1620f4c22693d406d9d5e3bd585695f">pepper</a>;<span class="comment"></span></div><div class="line"><a name="l02979"></a><span class="lineno"> 2979</span>&#160;<span class="comment">   /*! Indicates whether the backend has data */</span></div><div class="line"><a name="l02980"></a><span class="lineno"><a class="line" href="../../d2/d13/structbackend__data.html#a1c03c47f39cf197ed393df7833ccde95"> 2980</a></span>&#160;   <span class="keywordtype">int</span> <a class="code" href="../../d2/d13/structbackend__data.html#a1c03c47f39cf197ed393df7833ccde95">exists</a>;</div><div class="line"><a name="l02981"></a><span class="lineno"> 2981</span>&#160;} *<a class="code" href="../../d7/d30/res__sorcery__memory__cache_8c.html#a9a5449c09c240371ee234ec151bda8e0">real_backend_data</a>;</div><div class="line"><a name="l02982"></a><span class="lineno"> 2982</span>&#160;<span class="comment"></span></div><div class="line"><a name="l02983"></a><span class="lineno"> 2983</span>&#160;<span class="comment">/*!</span></div><div class="line"><a name="l02984"></a><span class="lineno"> 2984</span>&#160;<span class="comment"> * \brief Sorcery object created based on backend data</span></div><div class="line"><a name="l02985"></a><span class="lineno"> 2985</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l02986"></a><span class="lineno"><a class="line" href="../../dc/d9a/structtest__data.html"> 2986</a></span>&#160;<span class="keyword">struct </span><a class="code" href="../../dc/d9a/structtest__data.html">test_data</a> {</div><div class="line"><a name="l02987"></a><span class="lineno"> 2987</span>&#160;   <a class="code" href="../../d8/d25/sorcery_8h.html#a27ab062271c22bdbc2b6f5d607c980cf">SORCERY_OBJECT</a>(details);<span class="comment"></span></div><div class="line"><a name="l02988"></a><span class="lineno"> 2988</span>&#160;<span class="comment">   /*! Mirrors the backend data&#39;s salt field */</span></div><div class="line"><a name="l02989"></a><span class="lineno"><a class="line" href="../../dc/d9a/structtest__data.html#a0817c9db744a78699e31ca83df2ef709"> 2989</a></span>&#160;   <span class="keywordtype">int</span> <a class="code" href="../../dc/d9a/structtest__data.html#a0817c9db744a78699e31ca83df2ef709">salt</a>;<span class="comment"></span></div><div class="line"><a name="l02990"></a><span class="lineno"> 2990</span>&#160;<span class="comment">   /*! Mirrors the backend data&#39;s pepper field */</span></div><div class="line"><a name="l02991"></a><span class="lineno"><a class="line" href="../../dc/d9a/structtest__data.html#aa1620f4c22693d406d9d5e3bd585695f"> 2991</a></span>&#160;   <span class="keywordtype">int</span> <a class="code" href="../../dc/d9a/structtest__data.html#aa1620f4c22693d406d9d5e3bd585695f">pepper</a>;</div><div class="line"><a name="l02992"></a><span class="lineno"> 2992</span>&#160;};</div><div class="line"><a name="l02993"></a><span class="lineno"> 2993</span>&#160;<span class="comment"></span></div><div class="line"><a name="l02994"></a><span class="lineno"> 2994</span>&#160;<span class="comment">/*!</span></div><div class="line"><a name="l02995"></a><span class="lineno"> 2995</span>&#160;<span class="comment"> * \brief Allocation callback for test_data sorcery object</span></div><div class="line"><a name="l02996"></a><span class="lineno"> 2996</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l02997"></a><span class="lineno"><a class="line" href="../../d7/d30/res__sorcery__memory__cache_8c.html#a42cfb1ae93ed6226126180bc40c3eb7c"> 2997</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> *<a class="code" href="../../d7/d30/res__sorcery__memory__cache_8c.html#a42cfb1ae93ed6226126180bc40c3eb7c">test_data_alloc</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *<span class="keywordtype">id</span>) {</div><div class="line"><a name="l02998"></a><span class="lineno"> 2998</span>&#160;   <span class="keywordflow">return</span> <a class="code" href="../../d8/d25/sorcery_8h.html#a4c03ccef909474831717c93679065508">ast_sorcery_generic_alloc</a>(<span class="keyword">sizeof</span>(<span class="keyword">struct</span> <a class="code" href="../../dc/d9a/structtest__data.html">test_data</a>), <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div><div class="line"><a name="l02999"></a><span class="lineno"> 2999</span>&#160;}</div><div class="line"><a name="l03000"></a><span class="lineno"> 3000</span>&#160;<span class="comment"></span></div><div class="line"><a name="l03001"></a><span class="lineno"> 3001</span>&#160;<span class="comment">/*!</span></div><div class="line"><a name="l03002"></a><span class="lineno"> 3002</span>&#160;<span class="comment"> * \brief Callback for retrieving sorcery object by ID</span></div><div class="line"><a name="l03003"></a><span class="lineno"> 3003</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l03004"></a><span class="lineno"> 3004</span>&#160;<span class="comment"> * The mock wizard uses the \ref real_backend_data in order to construct</span></div><div class="line"><a name="l03005"></a><span class="lineno"> 3005</span>&#160;<span class="comment"> * objects. If the backend data is &quot;nonexisent&quot; then no object is returned.</span></div><div class="line"><a name="l03006"></a><span class="lineno"> 3006</span>&#160;<span class="comment"> * Otherwise, an object is created that has the backend data&#39;s salt and</span></div><div class="line"><a name="l03007"></a><span class="lineno"> 3007</span>&#160;<span class="comment"> * pepper values copied.</span></div><div class="line"><a name="l03008"></a><span class="lineno"> 3008</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l03009"></a><span class="lineno"> 3009</span>&#160;<span class="comment"> * \param sorcery The sorcery instance</span></div><div class="line"><a name="l03010"></a><span class="lineno"> 3010</span>&#160;<span class="comment"> * \param data Unused</span></div><div class="line"><a name="l03011"></a><span class="lineno"> 3011</span>&#160;<span class="comment"> * \param type The object type. Will always be &quot;test&quot;.</span></div><div class="line"><a name="l03012"></a><span class="lineno"> 3012</span>&#160;<span class="comment"> * \param id The object id. Will always be &quot;test&quot;.</span></div><div class="line"><a name="l03013"></a><span class="lineno"> 3013</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l03014"></a><span class="lineno"> 3014</span>&#160;<span class="comment"> * \retval NULL Backend data does not exist</span></div><div class="line"><a name="l03015"></a><span class="lineno"> 3015</span>&#160;<span class="comment"> * \retval non-NULL An object representing the backend data</span></div><div class="line"><a name="l03016"></a><span class="lineno"> 3016</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l03017"></a><span class="lineno"><a class="line" href="../../d7/d30/res__sorcery__memory__cache_8c.html#aab28609572a132139c835e70368bdddb"> 3017</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> *<a class="code" href="../../d7/d30/res__sorcery__memory__cache_8c.html#aab28609572a132139c835e70368bdddb">mock_retrieve_id</a>(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="../../d2/d88/structast__sorcery.html">ast_sorcery</a> *<a class="code" href="../../d2/d6b/structsorcery__memory__cache.html#aeb33dcb5573e1661c82b5370681fb626">sorcery</a>, <span class="keywordtype">void</span> *data,</div><div class="line"><a name="l03018"></a><span class="lineno"> 3018</span>&#160;      <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="../../d7/d49/chan__ooh323_8c.html#a4d63fdfe5451ec2248c16a2739190c56">type</a>, <span class="keyword">const</span> <span class="keywordtype">char</span> *<span class="keywordtype">id</span>)</div><div class="line"><a name="l03019"></a><span class="lineno"> 3019</span>&#160;{</div><div class="line"><a name="l03020"></a><span class="lineno"> 3020</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../dc/d9a/structtest__data.html">test_data</a> *b_data;</div><div class="line"><a name="l03021"></a><span class="lineno"> 3021</span>&#160;</div><div class="line"><a name="l03022"></a><span class="lineno"> 3022</span>&#160;   <span class="keywordflow">if</span> (!<a class="code" href="../../d7/d30/res__sorcery__memory__cache_8c.html#a9a5449c09c240371ee234ec151bda8e0">real_backend_data</a>-&gt;<a class="code" href="../../d2/d13/structbackend__data.html#a1c03c47f39cf197ed393df7833ccde95">exists</a>) {</div><div class="line"><a name="l03023"></a><span class="lineno"> 3023</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l03024"></a><span class="lineno"> 3024</span>&#160;   }</div><div class="line"><a name="l03025"></a><span class="lineno"> 3025</span>&#160;</div><div class="line"><a name="l03026"></a><span class="lineno"> 3026</span>&#160;   b_data = <a class="code" href="../../d8/d25/sorcery_8h.html#acb6c97c18566cf94a7ac95a43dd9a816">ast_sorcery_alloc</a>(sorcery, type, <span class="keywordtype">id</span>);</div><div class="line"><a name="l03027"></a><span class="lineno"> 3027</span>&#160;   <span class="keywordflow">if</span> (!b_data) {</div><div class="line"><a name="l03028"></a><span class="lineno"> 3028</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l03029"></a><span class="lineno"> 3029</span>&#160;   }</div><div class="line"><a name="l03030"></a><span class="lineno"> 3030</span>&#160;</div><div class="line"><a name="l03031"></a><span class="lineno"> 3031</span>&#160;   b_data-&gt;<a class="code" href="../../dc/d9a/structtest__data.html#a0817c9db744a78699e31ca83df2ef709">salt</a> = <a class="code" href="../../d7/d30/res__sorcery__memory__cache_8c.html#a9a5449c09c240371ee234ec151bda8e0">real_backend_data</a>-&gt;<a class="code" href="../../d2/d13/structbackend__data.html#a0817c9db744a78699e31ca83df2ef709">salt</a>;</div><div class="line"><a name="l03032"></a><span class="lineno"> 3032</span>&#160;   b_data-&gt;<a class="code" href="../../dc/d9a/structtest__data.html#aa1620f4c22693d406d9d5e3bd585695f">pepper</a> = <a class="code" href="../../d7/d30/res__sorcery__memory__cache_8c.html#a9a5449c09c240371ee234ec151bda8e0">real_backend_data</a>-&gt;<a class="code" href="../../d2/d13/structbackend__data.html#aa1620f4c22693d406d9d5e3bd585695f">pepper</a>;</div><div class="line"><a name="l03033"></a><span class="lineno"> 3033</span>&#160;   <span class="keywordflow">return</span> b_data;</div><div class="line"><a name="l03034"></a><span class="lineno"> 3034</span>&#160;}</div><div class="line"><a name="l03035"></a><span class="lineno"> 3035</span>&#160;<span class="comment"></span></div><div class="line"><a name="l03036"></a><span class="lineno"> 3036</span>&#160;<span class="comment">/*!</span></div><div class="line"><a name="l03037"></a><span class="lineno"> 3037</span>&#160;<span class="comment"> * \brief Callback for retrieving multiple sorcery objects</span></div><div class="line"><a name="l03038"></a><span class="lineno"> 3038</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l03039"></a><span class="lineno"> 3039</span>&#160;<span class="comment"> * The mock wizard uses the \ref real_backend_data in order to construct</span></div><div class="line"><a name="l03040"></a><span class="lineno"> 3040</span>&#160;<span class="comment"> * objects. If the backend data is &quot;nonexisent&quot; then no object is returned.</span></div><div class="line"><a name="l03041"></a><span class="lineno"> 3041</span>&#160;<span class="comment"> * Otherwise, the number of objects matching the exists value will be returned.</span></div><div class="line"><a name="l03042"></a><span class="lineno"> 3042</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l03043"></a><span class="lineno"> 3043</span>&#160;<span class="comment"> * \param sorcery The sorcery instance</span></div><div class="line"><a name="l03044"></a><span class="lineno"> 3044</span>&#160;<span class="comment"> * \param data Unused</span></div><div class="line"><a name="l03045"></a><span class="lineno"> 3045</span>&#160;<span class="comment"> * \param type The object type. Will always be &quot;test&quot;.</span></div><div class="line"><a name="l03046"></a><span class="lineno"> 3046</span>&#160;<span class="comment"> * \param objects Container to place objects into.</span></div><div class="line"><a name="l03047"></a><span class="lineno"> 3047</span>&#160;<span class="comment"> * \param fields Fields to search for.</span></div><div class="line"><a name="l03048"></a><span class="lineno"> 3048</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l03049"></a><span class="lineno"><a class="line" href="../../d7/d30/res__sorcery__memory__cache_8c.html#ae105be728a4bf9b0644438080f207f9e"> 3049</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d7/d30/res__sorcery__memory__cache_8c.html#ae105be728a4bf9b0644438080f207f9e">mock_retrieve_multiple</a>(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="../../d2/d88/structast__sorcery.html">ast_sorcery</a> *<a class="code" href="../../d2/d6b/structsorcery__memory__cache.html#aeb33dcb5573e1661c82b5370681fb626">sorcery</a>, <span class="keywordtype">void</span> *data,</div><div class="line"><a name="l03050"></a><span class="lineno"> 3050</span>&#160;      <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="../../d7/d49/chan__ooh323_8c.html#a4d63fdfe5451ec2248c16a2739190c56">type</a>, <span class="keyword">struct</span> <a class="code" href="../../d2/da9/structao2__container.html">ao2_container</a> *<a class="code" href="../../d2/d6b/structsorcery__memory__cache.html#aa0a84e33972901716d6d5a6dcf1a68de">objects</a>, <span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="../../dd/d02/structast__variable.html">ast_variable</a> *fields)</div><div class="line"><a name="l03051"></a><span class="lineno"> 3051</span>&#160;{</div><div class="line"><a name="l03052"></a><span class="lineno"> 3052</span>&#160;   <span class="keywordtype">int</span> i;</div><div class="line"><a name="l03053"></a><span class="lineno"> 3053</span>&#160;</div><div class="line"><a name="l03054"></a><span class="lineno"> 3054</span>&#160;   <span class="keywordflow">if</span> (fields) {</div><div class="line"><a name="l03055"></a><span class="lineno"> 3055</span>&#160;      <span class="keywordflow">return</span>;</div><div class="line"><a name="l03056"></a><span class="lineno"> 3056</span>&#160;   }</div><div class="line"><a name="l03057"></a><span class="lineno"> 3057</span>&#160;</div><div class="line"><a name="l03058"></a><span class="lineno"> 3058</span>&#160;   <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="../../d7/d30/res__sorcery__memory__cache_8c.html#a9a5449c09c240371ee234ec151bda8e0">real_backend_data</a>-&gt;<a class="code" href="../../d2/d13/structbackend__data.html#a1c03c47f39cf197ed393df7833ccde95">exists</a>; ++i) {</div><div class="line"><a name="l03059"></a><span class="lineno"> 3059</span>&#160;      <span class="keywordtype">char</span> uuid[<a class="code" href="../../dd/d1d/uuid_8h.html#a127408e53d34dca0c589a099fabf1e13">AST_UUID_STR_LEN</a>];</div><div class="line"><a name="l03060"></a><span class="lineno"> 3060</span>&#160;      <span class="keyword">struct </span><a class="code" href="../../dc/d9a/structtest__data.html">test_data</a> *b_data;</div><div class="line"><a name="l03061"></a><span class="lineno"> 3061</span>&#160;</div><div class="line"><a name="l03062"></a><span class="lineno"> 3062</span>&#160;      b_data = <a class="code" href="../../d8/d25/sorcery_8h.html#acb6c97c18566cf94a7ac95a43dd9a816">ast_sorcery_alloc</a>(sorcery, type, <a class="code" href="../../dd/d1d/uuid_8h.html#abe6d0b550cd9a54964e7891960d1e5bc">ast_uuid_generate_str</a>(uuid, <span class="keyword">sizeof</span>(uuid)));</div><div class="line"><a name="l03063"></a><span class="lineno"> 3063</span>&#160;      <span class="keywordflow">if</span> (!b_data) {</div><div class="line"><a name="l03064"></a><span class="lineno"> 3064</span>&#160;         <span class="keywordflow">continue</span>;</div><div class="line"><a name="l03065"></a><span class="lineno"> 3065</span>&#160;      }</div><div class="line"><a name="l03066"></a><span class="lineno"> 3066</span>&#160;</div><div class="line"><a name="l03067"></a><span class="lineno"> 3067</span>&#160;      b_data-&gt;<a class="code" href="../../dc/d9a/structtest__data.html#a0817c9db744a78699e31ca83df2ef709">salt</a> = <a class="code" href="../../d7/d30/res__sorcery__memory__cache_8c.html#a9a5449c09c240371ee234ec151bda8e0">real_backend_data</a>-&gt;<a class="code" href="../../d2/d13/structbackend__data.html#a0817c9db744a78699e31ca83df2ef709">salt</a>;</div><div class="line"><a name="l03068"></a><span class="lineno"> 3068</span>&#160;      b_data-&gt;<a class="code" href="../../dc/d9a/structtest__data.html#aa1620f4c22693d406d9d5e3bd585695f">pepper</a> = <a class="code" href="../../d7/d30/res__sorcery__memory__cache_8c.html#a9a5449c09c240371ee234ec151bda8e0">real_backend_data</a>-&gt;<a class="code" href="../../d2/d13/structbackend__data.html#aa1620f4c22693d406d9d5e3bd585695f">pepper</a>;</div><div class="line"><a name="l03069"></a><span class="lineno"> 3069</span>&#160;</div><div class="line"><a name="l03070"></a><span class="lineno"> 3070</span>&#160;      <a class="code" href="../../d5/da5/astobj2_8h.html#a1ad9f122bcae95a470639402faa3d2ee">ao2_link</a>(objects, b_data);</div><div class="line"><a name="l03071"></a><span class="lineno"> 3071</span>&#160;      <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(b_data, -1);</div><div class="line"><a name="l03072"></a><span class="lineno"> 3072</span>&#160;   }</div><div class="line"><a name="l03073"></a><span class="lineno"> 3073</span>&#160;}</div><div class="line"><a name="l03074"></a><span class="lineno"> 3074</span>&#160;<span class="comment"></span></div><div class="line"><a name="l03075"></a><span class="lineno"> 3075</span>&#160;<span class="comment">/*!</span></div><div class="line"><a name="l03076"></a><span class="lineno"> 3076</span>&#160;<span class="comment"> * \brief A mock sorcery wizard used for the stale test</span></div><div class="line"><a name="l03077"></a><span class="lineno"> 3077</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l03078"></a><span class="lineno"><a class="line" href="../../d7/d30/res__sorcery__memory__cache_8c.html#a93253ad88664252f13a1eb0650303691"> 3078</a></span>&#160;<span class="keyword">static</span> <span class="keyword">struct </span><a class="code" href="../../dd/d0a/structast__sorcery__wizard.html">ast_sorcery_wizard</a> <a class="code" href="../../d7/d30/res__sorcery__memory__cache_8c.html#a93253ad88664252f13a1eb0650303691">mock_wizard</a> = {</div><div class="line"><a name="l03079"></a><span class="lineno"> 3079</span>&#160;   .<a class="code" href="../../dd/d0a/structast__sorcery__wizard.html#a8f8f80d37794cde9472343e4487ba3eb">name</a> = <span class="stringliteral">&quot;mock&quot;</span>,</div><div class="line"><a name="l03080"></a><span class="lineno"> 3080</span>&#160;   .retrieve_id = <a class="code" href="../../d7/d30/res__sorcery__memory__cache_8c.html#aab28609572a132139c835e70368bdddb">mock_retrieve_id</a>,</div><div class="line"><a name="l03081"></a><span class="lineno"> 3081</span>&#160;   .retrieve_multiple = <a class="code" href="../../d7/d30/res__sorcery__memory__cache_8c.html#ae105be728a4bf9b0644438080f207f9e">mock_retrieve_multiple</a>,</div><div class="line"><a name="l03082"></a><span class="lineno"> 3082</span>&#160;};</div><div class="line"><a name="l03083"></a><span class="lineno"> 3083</span>&#160;<span class="comment"></span></div><div class="line"><a name="l03084"></a><span class="lineno"> 3084</span>&#160;<span class="comment">/*!</span></div><div class="line"><a name="l03085"></a><span class="lineno"> 3085</span>&#160;<span class="comment"> * \brief Wait for the cache to be updated after a stale object is retrieved.</span></div><div class="line"><a name="l03086"></a><span class="lineno"> 3086</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l03087"></a><span class="lineno"> 3087</span>&#160;<span class="comment"> * Since the cache does not know what type of objects it is dealing with, and</span></div><div class="line"><a name="l03088"></a><span class="lineno"> 3088</span>&#160;<span class="comment"> * since we do not have the internals of the cache, the only way to make this</span></div><div class="line"><a name="l03089"></a><span class="lineno"> 3089</span>&#160;<span class="comment"> * determination is to continuously retrieve an object from the cache until</span></div><div class="line"><a name="l03090"></a><span class="lineno"> 3090</span>&#160;<span class="comment"> * we retrieve a different object than we had previously retrieved.</span></div><div class="line"><a name="l03091"></a><span class="lineno"> 3091</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l03092"></a><span class="lineno"> 3092</span>&#160;<span class="comment"> * \param sorcery The sorcery instance</span></div><div class="line"><a name="l03093"></a><span class="lineno"> 3093</span>&#160;<span class="comment"> * \param previous_object The object we had previously retrieved from the cache</span></div><div class="line"><a name="l03094"></a><span class="lineno"> 3094</span>&#160;<span class="comment"> * \param[out] new_object The new object we retrieve from the cache</span></div><div class="line"><a name="l03095"></a><span class="lineno"> 3095</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l03096"></a><span class="lineno"> 3096</span>&#160;<span class="comment"> * \retval 0 Successfully retrieved a new object from the cache</span></div><div class="line"><a name="l03097"></a><span class="lineno"> 3097</span>&#160;<span class="comment"> * \retval non-zero Failed to retrieve a new object from the cache</span></div><div class="line"><a name="l03098"></a><span class="lineno"> 3098</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l03099"></a><span class="lineno"><a class="line" href="../../d7/d30/res__sorcery__memory__cache_8c.html#abdd3c23b47eaf1227982904174a28632"> 3099</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d7/d30/res__sorcery__memory__cache_8c.html#abdd3c23b47eaf1227982904174a28632">wait_for_cache_update</a>(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="../../d2/d88/structast__sorcery.html">ast_sorcery</a> *<a class="code" href="../../d2/d6b/structsorcery__memory__cache.html#aeb33dcb5573e1661c82b5370681fb626">sorcery</a>,</div><div class="line"><a name="l03100"></a><span class="lineno"> 3100</span>&#160;      <span class="keywordtype">void</span> *previous_object, <span class="keyword">struct</span> <a class="code" href="../../dc/d9a/structtest__data.html">test_data</a> **new_object)</div><div class="line"><a name="l03101"></a><span class="lineno"> 3101</span>&#160;{</div><div class="line"><a name="l03102"></a><span class="lineno"> 3102</span>&#160;   <span class="keyword">struct </span>timeval start = <a class="code" href="../../de/df7/time_8h.html#ad3899efb6f0e348556ef69f5b16aa7f7">ast_tvnow</a>();</div><div class="line"><a name="l03103"></a><span class="lineno"> 3103</span>&#160;</div><div class="line"><a name="l03104"></a><span class="lineno"> 3104</span>&#160;   <span class="keywordflow">while</span> (<a class="code" href="../../de/df7/time_8h.html#a904a6933b710e14c7fa2029a0f0cc91a">ast_remaining_ms</a>(start, 5000) &gt; 0) {</div><div class="line"><a name="l03105"></a><span class="lineno"> 3105</span>&#160;      <span class="keywordtype">void</span> *object;</div><div class="line"><a name="l03106"></a><span class="lineno"> 3106</span>&#160;</div><div class="line"><a name="l03107"></a><span class="lineno"> 3107</span>&#160;      <span class="keywordtype">object</span> = <a class="code" href="../../d8/d25/sorcery_8h.html#a100106a82d72aa59a66513ef3ad161c8">ast_sorcery_retrieve_by_id</a>(sorcery, <span class="stringliteral">&quot;test&quot;</span>, <span class="stringliteral">&quot;test&quot;</span>);</div><div class="line"><a name="l03108"></a><span class="lineno"> 3108</span>&#160;      <span class="keywordflow">if</span> (<span class="keywordtype">object</span> != previous_object) {</div><div class="line"><a name="l03109"></a><span class="lineno"> 3109</span>&#160;         *new_object = object;</div><div class="line"><a name="l03110"></a><span class="lineno"> 3110</span>&#160;         <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l03111"></a><span class="lineno"> 3111</span>&#160;      }</div><div class="line"><a name="l03112"></a><span class="lineno"> 3112</span>&#160;      <a class="code" href="../../d5/da5/astobj2_8h.html#a6321ee982370c55ab3c24c72c562cbdd">ao2_cleanup</a>(<span class="keywordtype">object</span>);</div><div class="line"><a name="l03113"></a><span class="lineno"> 3113</span>&#160;   }</div><div class="line"><a name="l03114"></a><span class="lineno"> 3114</span>&#160;</div><div class="line"><a name="l03115"></a><span class="lineno"> 3115</span>&#160;   <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l03116"></a><span class="lineno"> 3116</span>&#160;}</div><div class="line"><a name="l03117"></a><span class="lineno"> 3117</span>&#160;</div><div class="line"><a name="l03118"></a><span class="lineno"><a class="line" href="../../d7/d30/res__sorcery__memory__cache_8c.html#a4085ce66f0614119e3ed7ccdb2826e01"> 3118</a></span>&#160;<a class="code" href="../../d7/d30/res__sorcery__memory__cache_8c.html#af6639c66b2a5eff1e659bf57d5938e54">AST_TEST_DEFINE</a>(stale)</div><div class="line"><a name="l03119"></a><span class="lineno"> 3119</span>&#160;{</div><div class="line"><a name="l03120"></a><span class="lineno"> 3120</span>&#160;   <span class="keywordtype">int</span> res = <a class="code" href="../../d2/ddc/test_8h.html#aad2aec78205d328d23894a6598cc4044a8a11a3a19eb4c9fd2ba654d95df1adb6">AST_TEST_FAIL</a>;</div><div class="line"><a name="l03121"></a><span class="lineno"> 3121</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d2/d88/structast__sorcery.html">ast_sorcery</a> *<a class="code" href="../../d2/d6b/structsorcery__memory__cache.html#aeb33dcb5573e1661c82b5370681fb626">sorcery</a> = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l03122"></a><span class="lineno"> 3122</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../dc/d9a/structtest__data.html">test_data</a> *backend_object;</div><div class="line"><a name="l03123"></a><span class="lineno"> 3123</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d2/d13/structbackend__data.html">backend_data</a> iterations[] = {</div><div class="line"><a name="l03124"></a><span class="lineno"> 3124</span>&#160;      { .<a class="code" href="../../d2/d13/structbackend__data.html#a0817c9db744a78699e31ca83df2ef709">salt</a> = 1,      .pepper = 2,       .exists = 1 },</div><div class="line"><a name="l03125"></a><span class="lineno"> 3125</span>&#160;      { .salt = 568729, .pepper = -234123, .exists = 1 },</div><div class="line"><a name="l03126"></a><span class="lineno"> 3126</span>&#160;      { .salt = 0,      .pepper = 0,       .exists = 0 },</div><div class="line"><a name="l03127"></a><span class="lineno"> 3127</span>&#160;   };</div><div class="line"><a name="l03128"></a><span class="lineno"> 3128</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d2/d13/structbackend__data.html">backend_data</a> initial = {</div><div class="line"><a name="l03129"></a><span class="lineno"> 3129</span>&#160;      .<a class="code" href="../../d2/d13/structbackend__data.html#a0817c9db744a78699e31ca83df2ef709">salt</a> = 0,</div><div class="line"><a name="l03130"></a><span class="lineno"> 3130</span>&#160;      .pepper = 0,</div><div class="line"><a name="l03131"></a><span class="lineno"> 3131</span>&#160;      .exists = 1,</div><div class="line"><a name="l03132"></a><span class="lineno"> 3132</span>&#160;   };</div><div class="line"><a name="l03133"></a><span class="lineno"> 3133</span>&#160;   <span class="keywordtype">int</span> i;</div><div class="line"><a name="l03134"></a><span class="lineno"> 3134</span>&#160;</div><div class="line"><a name="l03135"></a><span class="lineno"> 3135</span>&#160;   <span class="keywordflow">switch</span> (cmd) {</div><div class="line"><a name="l03136"></a><span class="lineno"> 3136</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="../../d2/ddc/test_8h.html#a0689ac4326c7a771e1b6ed1e4cde53e2a21df97525a6ac371a7fb604dfa8ea67b">TEST_INIT</a>:</div><div class="line"><a name="l03137"></a><span class="lineno"> 3137</span>&#160;      <a class="code" href="../../dd/d17/namespacesip__to__pjsip.html#ab82f408a83ecba10ea39afd8abfd371e">info</a>-&gt;name = <span class="stringliteral">&quot;stale&quot;</span>;</div><div class="line"><a name="l03138"></a><span class="lineno"> 3138</span>&#160;      <a class="code" href="../../dd/d17/namespacesip__to__pjsip.html#ab82f408a83ecba10ea39afd8abfd371e">info</a>-&gt;category = <span class="stringliteral">&quot;/res/res_sorcery_memory_cache/&quot;</span>;</div><div class="line"><a name="l03139"></a><span class="lineno"> 3139</span>&#160;      <a class="code" href="../../dd/d17/namespacesip__to__pjsip.html#ab82f408a83ecba10ea39afd8abfd371e">info</a>-&gt;summary = <span class="stringliteral">&quot;Ensure that stale objects are replaced with updated objects&quot;</span>;</div><div class="line"><a name="l03140"></a><span class="lineno"> 3140</span>&#160;      <a class="code" href="../../dd/d17/namespacesip__to__pjsip.html#ab82f408a83ecba10ea39afd8abfd371e">info</a>-&gt;description = <span class="stringliteral">&quot;This test performs the following:\n&quot;</span></div><div class="line"><a name="l03141"></a><span class="lineno"> 3141</span>&#160;         <span class="stringliteral">&quot;\t* Create a sorcery instance with two wizards&quot;</span></div><div class="line"><a name="l03142"></a><span class="lineno"> 3142</span>&#160;         <span class="stringliteral">&quot;\t\t* The first is a memory cache that marks items stale after 3 seconds\n&quot;</span></div><div class="line"><a name="l03143"></a><span class="lineno"> 3143</span>&#160;         <span class="stringliteral">&quot;\t\t* The second is a mock of a back-end\n&quot;</span></div><div class="line"><a name="l03144"></a><span class="lineno"> 3144</span>&#160;         <span class="stringliteral">&quot;\t* Pre-populates the cache by retrieving some initial data from the backend.\n&quot;</span></div><div class="line"><a name="l03145"></a><span class="lineno"> 3145</span>&#160;         <span class="stringliteral">&quot;\t* Performs iterations of the following:\n&quot;</span></div><div class="line"><a name="l03146"></a><span class="lineno"> 3146</span>&#160;         <span class="stringliteral">&quot;\t\t* Update backend data with new values\n&quot;</span></div><div class="line"><a name="l03147"></a><span class="lineno"> 3147</span>&#160;         <span class="stringliteral">&quot;\t\t* Retrieve item from the cache\n&quot;</span></div><div class="line"><a name="l03148"></a><span class="lineno"> 3148</span>&#160;         <span class="stringliteral">&quot;\t\t* Ensure the retrieved item does not have the new backend values\n&quot;</span></div><div class="line"><a name="l03149"></a><span class="lineno"> 3149</span>&#160;         <span class="stringliteral">&quot;\t\t* Wait for cached object to become stale\n&quot;</span></div><div class="line"><a name="l03150"></a><span class="lineno"> 3150</span>&#160;         <span class="stringliteral">&quot;\t\t* Retrieve the stale cached object\n&quot;</span></div><div class="line"><a name="l03151"></a><span class="lineno"> 3151</span>&#160;         <span class="stringliteral">&quot;\t\t* Ensure that the stale object retrieved is the same as the fresh one from earlier\n&quot;</span></div><div class="line"><a name="l03152"></a><span class="lineno"> 3152</span>&#160;         <span class="stringliteral">&quot;\t\t* Wait for the cache to update with new data\n&quot;</span></div><div class="line"><a name="l03153"></a><span class="lineno"> 3153</span>&#160;         <span class="stringliteral">&quot;\t\t* Ensure that new data in the cache matches backend data&quot;</span>;</div><div class="line"><a name="l03154"></a><span class="lineno"> 3154</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../d2/ddc/test_8h.html#aad2aec78205d328d23894a6598cc4044a8cf2ae27807baf798d726d630693cc8c">AST_TEST_NOT_RUN</a>;</div><div class="line"><a name="l03155"></a><span class="lineno"> 3155</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="../../d2/ddc/test_8h.html#a0689ac4326c7a771e1b6ed1e4cde53e2adb2586ef58bb9dd2f84a7d592ecf3e0e">TEST_EXECUTE</a>:</div><div class="line"><a name="l03156"></a><span class="lineno"> 3156</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l03157"></a><span class="lineno"> 3157</span>&#160;   }</div><div class="line"><a name="l03158"></a><span class="lineno"> 3158</span>&#160;</div><div class="line"><a name="l03159"></a><span class="lineno"> 3159</span>&#160;   <a class="code" href="../../d8/d25/sorcery_8h.html#aa2b2d9798c21334810a480fdc3260bb8">ast_sorcery_wizard_register</a>(&amp;mock_wizard);</div><div class="line"><a name="l03160"></a><span class="lineno"> 3160</span>&#160;</div><div class="line"><a name="l03161"></a><span class="lineno"> 3161</span>&#160;   sorcery = <a class="code" href="../../d8/d25/sorcery_8h.html#ad60f3b81bed748245f8045cb48fadee2">ast_sorcery_open</a>();</div><div class="line"><a name="l03162"></a><span class="lineno"> 3162</span>&#160;   <span class="keywordflow">if</span> (!sorcery) {</div><div class="line"><a name="l03163"></a><span class="lineno"> 3163</span>&#160;      <a class="code" href="../../d2/ddc/test_8h.html#a5e8fddded61f6989172c981256e7c9bd">ast_test_status_update</a>(<a class="code" href="../../d8/d89/structtest.html">test</a>, <span class="stringliteral">&quot;Failed to create sorcery instance\n&quot;</span>);</div><div class="line"><a name="l03164"></a><span class="lineno"> 3164</span>&#160;      <span class="keywordflow">goto</span> <a class="code" href="../../d2/d2c/pbx__realtime_8c.html#a10b51e1931bd03dd172cbfb9d3d67efb">cleanup</a>;</div><div class="line"><a name="l03165"></a><span class="lineno"> 3165</span>&#160;   }</div><div class="line"><a name="l03166"></a><span class="lineno"> 3166</span>&#160;</div><div class="line"><a name="l03167"></a><span class="lineno"> 3167</span>&#160;   <a class="code" href="../../d8/d25/sorcery_8h.html#a02d1aa896acd254e31664df39e3086c9">ast_sorcery_apply_wizard_mapping</a>(sorcery, <span class="stringliteral">&quot;test&quot;</span>, <span class="stringliteral">&quot;memory_cache&quot;</span>,</div><div class="line"><a name="l03168"></a><span class="lineno"> 3168</span>&#160;         <span class="stringliteral">&quot;object_lifetime_stale=3&quot;</span>, 1);</div><div class="line"><a name="l03169"></a><span class="lineno"> 3169</span>&#160;   <a class="code" href="../../d8/d25/sorcery_8h.html#a02d1aa896acd254e31664df39e3086c9">ast_sorcery_apply_wizard_mapping</a>(sorcery, <span class="stringliteral">&quot;test&quot;</span>, <span class="stringliteral">&quot;mock&quot;</span>, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, 0);</div><div class="line"><a name="l03170"></a><span class="lineno"> 3170</span>&#160;   <a class="code" href="../../d8/d25/sorcery_8h.html#a6f16dd100bbc816e1d8eb67026ab4ee3">ast_sorcery_internal_object_register</a>(sorcery, <span class="stringliteral">&quot;test&quot;</span>, <a class="code" href="../../d7/d30/res__sorcery__memory__cache_8c.html#a42cfb1ae93ed6226126180bc40c3eb7c">test_data_alloc</a>, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div><div class="line"><a name="l03171"></a><span class="lineno"> 3171</span>&#160;</div><div class="line"><a name="l03172"></a><span class="lineno"> 3172</span>&#160;   <span class="comment">/* Prepopulate the cache */</span></div><div class="line"><a name="l03173"></a><span class="lineno"> 3173</span>&#160;   <a class="code" href="../../d7/d30/res__sorcery__memory__cache_8c.html#a9a5449c09c240371ee234ec151bda8e0">real_backend_data</a> = &amp;initial;</div><div class="line"><a name="l03174"></a><span class="lineno"> 3174</span>&#160;</div><div class="line"><a name="l03175"></a><span class="lineno"> 3175</span>&#160;   backend_object = <a class="code" href="../../d8/d25/sorcery_8h.html#a100106a82d72aa59a66513ef3ad161c8">ast_sorcery_retrieve_by_id</a>(sorcery, <span class="stringliteral">&quot;test&quot;</span>, <span class="stringliteral">&quot;test&quot;</span>);</div><div class="line"><a name="l03176"></a><span class="lineno"> 3176</span>&#160;   <span class="keywordflow">if</span> (!backend_object) {</div><div class="line"><a name="l03177"></a><span class="lineno"> 3177</span>&#160;      <a class="code" href="../../d2/ddc/test_8h.html#a5e8fddded61f6989172c981256e7c9bd">ast_test_status_update</a>(<a class="code" href="../../d8/d89/structtest.html">test</a>, <span class="stringliteral">&quot;Unable to retrieve backend data and populate the cache\n&quot;</span>);</div><div class="line"><a name="l03178"></a><span class="lineno"> 3178</span>&#160;      <span class="keywordflow">goto</span> <a class="code" href="../../d2/d2c/pbx__realtime_8c.html#a10b51e1931bd03dd172cbfb9d3d67efb">cleanup</a>;</div><div class="line"><a name="l03179"></a><span class="lineno"> 3179</span>&#160;   }</div><div class="line"><a name="l03180"></a><span class="lineno"> 3180</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(backend_object, -1);</div><div class="line"><a name="l03181"></a><span class="lineno"> 3181</span>&#160;</div><div class="line"><a name="l03182"></a><span class="lineno"> 3182</span>&#160;   <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="../../de/dfe/isdn__lib_8c.html#ab9129b977a587b50ea801daac75e178f">ARRAY_LEN</a>(iterations); ++i) {</div><div class="line"><a name="l03183"></a><span class="lineno"> 3183</span>&#160;      <a class="code" href="../../d5/d60/utils_8h.html#a1604b4d72144dd3d9f7da668e90337e9">RAII_VAR</a>(<span class="keyword">struct</span> <a class="code" href="../../dc/d9a/structtest__data.html">test_data</a> *, cache_fresh, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../d5/da5/astobj2_8h.html#a6321ee982370c55ab3c24c72c562cbdd">ao2_cleanup</a>);</div><div class="line"><a name="l03184"></a><span class="lineno"> 3184</span>&#160;      <a class="code" href="../../d5/d60/utils_8h.html#a1604b4d72144dd3d9f7da668e90337e9">RAII_VAR</a>(<span class="keyword">struct</span> <a class="code" href="../../dc/d9a/structtest__data.html">test_data</a> *, cache_stale, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../d5/da5/astobj2_8h.html#a6321ee982370c55ab3c24c72c562cbdd">ao2_cleanup</a>);</div><div class="line"><a name="l03185"></a><span class="lineno"> 3185</span>&#160;      <a class="code" href="../../d5/d60/utils_8h.html#a1604b4d72144dd3d9f7da668e90337e9">RAII_VAR</a>(<span class="keyword">struct</span> <a class="code" href="../../dc/d9a/structtest__data.html">test_data</a> *, cache_new, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../d5/da5/astobj2_8h.html#a6321ee982370c55ab3c24c72c562cbdd">ao2_cleanup</a>);</div><div class="line"><a name="l03186"></a><span class="lineno"> 3186</span>&#160;</div><div class="line"><a name="l03187"></a><span class="lineno"> 3187</span>&#160;      <a class="code" href="../../d7/d30/res__sorcery__memory__cache_8c.html#a9a5449c09c240371ee234ec151bda8e0">real_backend_data</a> = &amp;iterations[i];</div><div class="line"><a name="l03188"></a><span class="lineno"> 3188</span>&#160;</div><div class="line"><a name="l03189"></a><span class="lineno"> 3189</span>&#160;      <a class="code" href="../../d2/ddc/test_8h.html#a5e8fddded61f6989172c981256e7c9bd">ast_test_status_update</a>(<a class="code" href="../../d8/d89/structtest.html">test</a>, <span class="stringliteral">&quot;Begininning iteration %d\n&quot;</span>, i);</div><div class="line"><a name="l03190"></a><span class="lineno"> 3190</span>&#160;</div><div class="line"><a name="l03191"></a><span class="lineno"> 3191</span>&#160;      cache_fresh = <a class="code" href="../../d8/d25/sorcery_8h.html#a100106a82d72aa59a66513ef3ad161c8">ast_sorcery_retrieve_by_id</a>(sorcery, <span class="stringliteral">&quot;test&quot;</span>, <span class="stringliteral">&quot;test&quot;</span>);</div><div class="line"><a name="l03192"></a><span class="lineno"> 3192</span>&#160;      <span class="keywordflow">if</span> (!cache_fresh) {</div><div class="line"><a name="l03193"></a><span class="lineno"> 3193</span>&#160;         <a class="code" href="../../d2/ddc/test_8h.html#a5e8fddded61f6989172c981256e7c9bd">ast_test_status_update</a>(<a class="code" href="../../d8/d89/structtest.html">test</a>, <span class="stringliteral">&quot;Unable to retrieve fresh cached object\n&quot;</span>);</div><div class="line"><a name="l03194"></a><span class="lineno"> 3194</span>&#160;         <span class="keywordflow">goto</span> <a class="code" href="../../d2/d2c/pbx__realtime_8c.html#a10b51e1931bd03dd172cbfb9d3d67efb">cleanup</a>;</div><div class="line"><a name="l03195"></a><span class="lineno"> 3195</span>&#160;      }</div><div class="line"><a name="l03196"></a><span class="lineno"> 3196</span>&#160;</div><div class="line"><a name="l03197"></a><span class="lineno"> 3197</span>&#160;      <span class="keywordflow">if</span> (cache_fresh-&gt;salt == iterations[i].<a class="code" href="../../d2/d13/structbackend__data.html#a0817c9db744a78699e31ca83df2ef709">salt</a> || cache_fresh-&gt;pepper == iterations[i].<a class="code" href="../../d2/d13/structbackend__data.html#aa1620f4c22693d406d9d5e3bd585695f">pepper</a>) {</div><div class="line"><a name="l03198"></a><span class="lineno"> 3198</span>&#160;         <a class="code" href="../../d2/ddc/test_8h.html#a5e8fddded61f6989172c981256e7c9bd">ast_test_status_update</a>(<a class="code" href="../../d8/d89/structtest.html">test</a>, <span class="stringliteral">&quot;Fresh cached object has unexpected values. Did we hit the backend?\n&quot;</span>);</div><div class="line"><a name="l03199"></a><span class="lineno"> 3199</span>&#160;         <span class="keywordflow">goto</span> <a class="code" href="../../d2/d2c/pbx__realtime_8c.html#a10b51e1931bd03dd172cbfb9d3d67efb">cleanup</a>;</div><div class="line"><a name="l03200"></a><span class="lineno"> 3200</span>&#160;      }</div><div class="line"><a name="l03201"></a><span class="lineno"> 3201</span>&#160;</div><div class="line"><a name="l03202"></a><span class="lineno"> 3202</span>&#160;      sleep(5);</div><div class="line"><a name="l03203"></a><span class="lineno"> 3203</span>&#160;</div><div class="line"><a name="l03204"></a><span class="lineno"> 3204</span>&#160;      cache_stale = <a class="code" href="../../d8/d25/sorcery_8h.html#a100106a82d72aa59a66513ef3ad161c8">ast_sorcery_retrieve_by_id</a>(sorcery, <span class="stringliteral">&quot;test&quot;</span>, <span class="stringliteral">&quot;test&quot;</span>);</div><div class="line"><a name="l03205"></a><span class="lineno"> 3205</span>&#160;      <span class="keywordflow">if</span> (!cache_stale) {</div><div class="line"><a name="l03206"></a><span class="lineno"> 3206</span>&#160;         <a class="code" href="../../d2/ddc/test_8h.html#a5e8fddded61f6989172c981256e7c9bd">ast_test_status_update</a>(<a class="code" href="../../d8/d89/structtest.html">test</a>, <span class="stringliteral">&quot;Unable to retrieve stale cached object\n&quot;</span>);</div><div class="line"><a name="l03207"></a><span class="lineno"> 3207</span>&#160;         <span class="keywordflow">goto</span> <a class="code" href="../../d2/d2c/pbx__realtime_8c.html#a10b51e1931bd03dd172cbfb9d3d67efb">cleanup</a>;</div><div class="line"><a name="l03208"></a><span class="lineno"> 3208</span>&#160;      }</div><div class="line"><a name="l03209"></a><span class="lineno"> 3209</span>&#160;</div><div class="line"><a name="l03210"></a><span class="lineno"> 3210</span>&#160;      <span class="keywordflow">if</span> (cache_stale != cache_fresh) {</div><div class="line"><a name="l03211"></a><span class="lineno"> 3211</span>&#160;         <a class="code" href="../../d2/ddc/test_8h.html#a5e8fddded61f6989172c981256e7c9bd">ast_test_status_update</a>(<a class="code" href="../../d8/d89/structtest.html">test</a>, <span class="stringliteral">&quot;Stale cache hit retrieved different object than fresh cache hit\n&quot;</span>);</div><div class="line"><a name="l03212"></a><span class="lineno"> 3212</span>&#160;         <span class="keywordflow">goto</span> <a class="code" href="../../d2/d2c/pbx__realtime_8c.html#a10b51e1931bd03dd172cbfb9d3d67efb">cleanup</a>;</div><div class="line"><a name="l03213"></a><span class="lineno"> 3213</span>&#160;      }</div><div class="line"><a name="l03214"></a><span class="lineno"> 3214</span>&#160;</div><div class="line"><a name="l03215"></a><span class="lineno"> 3215</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="../../d7/d30/res__sorcery__memory__cache_8c.html#abdd3c23b47eaf1227982904174a28632">wait_for_cache_update</a>(sorcery, cache_stale, &amp;cache_new)) {</div><div class="line"><a name="l03216"></a><span class="lineno"> 3216</span>&#160;         <a class="code" href="../../d2/ddc/test_8h.html#a5e8fddded61f6989172c981256e7c9bd">ast_test_status_update</a>(<a class="code" href="../../d8/d89/structtest.html">test</a>, <span class="stringliteral">&quot;Cache was not updated\n&quot;</span>);</div><div class="line"><a name="l03217"></a><span class="lineno"> 3217</span>&#160;         <span class="keywordflow">goto</span> <a class="code" href="../../d2/d2c/pbx__realtime_8c.html#a10b51e1931bd03dd172cbfb9d3d67efb">cleanup</a>;</div><div class="line"><a name="l03218"></a><span class="lineno"> 3218</span>&#160;      }</div><div class="line"><a name="l03219"></a><span class="lineno"> 3219</span>&#160;</div><div class="line"><a name="l03220"></a><span class="lineno"> 3220</span>&#160;      <span class="keywordflow">if</span> (iterations[i].<a class="code" href="../../da/dd2/func__logic_8c.html#ad6f8d00a94914824d3b6048722c42332">exists</a>) {</div><div class="line"><a name="l03221"></a><span class="lineno"> 3221</span>&#160;         <span class="keywordflow">if</span> (!cache_new) {</div><div class="line"><a name="l03222"></a><span class="lineno"> 3222</span>&#160;            <a class="code" href="../../d2/ddc/test_8h.html#a5e8fddded61f6989172c981256e7c9bd">ast_test_status_update</a>(<a class="code" href="../../d8/d89/structtest.html">test</a>, <span class="stringliteral">&quot;Failed to retrieve item from cache when there should be one present\n&quot;</span>);</div><div class="line"><a name="l03223"></a><span class="lineno"> 3223</span>&#160;            <span class="keywordflow">goto</span> <a class="code" href="../../d2/d2c/pbx__realtime_8c.html#a10b51e1931bd03dd172cbfb9d3d67efb">cleanup</a>;</div><div class="line"><a name="l03224"></a><span class="lineno"> 3224</span>&#160;         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (cache_new-&gt;salt != iterations[i].<a class="code" href="../../d2/d13/structbackend__data.html#a0817c9db744a78699e31ca83df2ef709">salt</a> ||</div><div class="line"><a name="l03225"></a><span class="lineno"> 3225</span>&#160;               cache_new-&gt;pepper != iterations[i].<a class="code" href="../../d2/d13/structbackend__data.html#aa1620f4c22693d406d9d5e3bd585695f">pepper</a>) {</div><div class="line"><a name="l03226"></a><span class="lineno"> 3226</span>&#160;            <a class="code" href="../../d2/ddc/test_8h.html#a5e8fddded61f6989172c981256e7c9bd">ast_test_status_update</a>(<a class="code" href="../../d8/d89/structtest.html">test</a>, <span class="stringliteral">&quot;New cached item has unexpected values\n&quot;</span>);</div><div class="line"><a name="l03227"></a><span class="lineno"> 3227</span>&#160;            <span class="keywordflow">goto</span> <a class="code" href="../../d2/d2c/pbx__realtime_8c.html#a10b51e1931bd03dd172cbfb9d3d67efb">cleanup</a>;</div><div class="line"><a name="l03228"></a><span class="lineno"> 3228</span>&#160;         }</div><div class="line"><a name="l03229"></a><span class="lineno"> 3229</span>&#160;      } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (cache_new) {</div><div class="line"><a name="l03230"></a><span class="lineno"> 3230</span>&#160;         <a class="code" href="../../d2/ddc/test_8h.html#a5e8fddded61f6989172c981256e7c9bd">ast_test_status_update</a>(<a class="code" href="../../d8/d89/structtest.html">test</a>, <span class="stringliteral">&quot;Retrieved a cached item when there should not have been one present\n&quot;</span>);</div><div class="line"><a name="l03231"></a><span class="lineno"> 3231</span>&#160;         <span class="keywordflow">goto</span> <a class="code" href="../../d2/d2c/pbx__realtime_8c.html#a10b51e1931bd03dd172cbfb9d3d67efb">cleanup</a>;</div><div class="line"><a name="l03232"></a><span class="lineno"> 3232</span>&#160;      }</div><div class="line"><a name="l03233"></a><span class="lineno"> 3233</span>&#160;   }</div><div class="line"><a name="l03234"></a><span class="lineno"> 3234</span>&#160;</div><div class="line"><a name="l03235"></a><span class="lineno"> 3235</span>&#160;   res = <a class="code" href="../../d2/ddc/test_8h.html#aad2aec78205d328d23894a6598cc4044a7a3ab73c870a7ce6cf1a0f3cfd42a37b">AST_TEST_PASS</a>;</div><div class="line"><a name="l03236"></a><span class="lineno"> 3236</span>&#160;</div><div class="line"><a name="l03237"></a><span class="lineno"> 3237</span>&#160;<a class="code" href="../../d2/d2c/pbx__realtime_8c.html#a10b51e1931bd03dd172cbfb9d3d67efb">cleanup</a>:</div><div class="line"><a name="l03238"></a><span class="lineno"> 3238</span>&#160;   <span class="keywordflow">if</span> (sorcery) {</div><div class="line"><a name="l03239"></a><span class="lineno"> 3239</span>&#160;      <a class="code" href="../../d8/d25/sorcery_8h.html#a09cba9c37c702ca2bdcf94052068ed67">ast_sorcery_unref</a>(sorcery);</div><div class="line"><a name="l03240"></a><span class="lineno"> 3240</span>&#160;   }</div><div class="line"><a name="l03241"></a><span class="lineno"> 3241</span>&#160;   <a class="code" href="../../d8/d25/sorcery_8h.html#a14ed6490f3390526922655ab5dbc344f">ast_sorcery_wizard_unregister</a>(&amp;mock_wizard);</div><div class="line"><a name="l03242"></a><span class="lineno"> 3242</span>&#160;   <span class="keywordflow">return</span> res;</div><div class="line"><a name="l03243"></a><span class="lineno"> 3243</span>&#160;}</div><div class="line"><a name="l03244"></a><span class="lineno"> 3244</span>&#160;</div><div class="line"><a name="l03245"></a><span class="lineno"><a class="line" href="../../d7/d30/res__sorcery__memory__cache_8c.html#a5773597a663c03fe76f89010838a2858"> 3245</a></span>&#160;<a class="code" href="../../d7/d30/res__sorcery__memory__cache_8c.html#af6639c66b2a5eff1e659bf57d5938e54">AST_TEST_DEFINE</a>(full_backend_cache_expiration)</div><div class="line"><a name="l03246"></a><span class="lineno"> 3246</span>&#160;{</div><div class="line"><a name="l03247"></a><span class="lineno"> 3247</span>&#160;   <span class="keywordtype">int</span> res = <a class="code" href="../../d2/ddc/test_8h.html#aad2aec78205d328d23894a6598cc4044a8a11a3a19eb4c9fd2ba654d95df1adb6">AST_TEST_FAIL</a>;</div><div class="line"><a name="l03248"></a><span class="lineno"> 3248</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d2/d88/structast__sorcery.html">ast_sorcery</a> *<a class="code" href="../../d2/d6b/structsorcery__memory__cache.html#aeb33dcb5573e1661c82b5370681fb626">sorcery</a> = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l03249"></a><span class="lineno"> 3249</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d2/d13/structbackend__data.html">backend_data</a> initial = {</div><div class="line"><a name="l03250"></a><span class="lineno"> 3250</span>&#160;      .<a class="code" href="../../d2/d13/structbackend__data.html#a0817c9db744a78699e31ca83df2ef709">salt</a> = 0,</div><div class="line"><a name="l03251"></a><span class="lineno"> 3251</span>&#160;      .pepper = 0,</div><div class="line"><a name="l03252"></a><span class="lineno"> 3252</span>&#160;      .exists = 4,</div><div class="line"><a name="l03253"></a><span class="lineno"> 3253</span>&#160;   };</div><div class="line"><a name="l03254"></a><span class="lineno"> 3254</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d2/da9/structao2__container.html">ao2_container</a> *<a class="code" href="../../d2/d6b/structsorcery__memory__cache.html#aa0a84e33972901716d6d5a6dcf1a68de">objects</a>;</div><div class="line"><a name="l03255"></a><span class="lineno"> 3255</span>&#160;   <a class="code" href="../../d8/dc5/structast__mutex__info.html">ast_mutex_t</a> <a class="code" href="../../d2/d6b/structsorcery__memory__cache.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>;</div><div class="line"><a name="l03256"></a><span class="lineno"> 3256</span>&#160;   <a class="code" href="../../dd/d42/lock_8h.html#ab134d98cdfe7de0f7a72b377c0765dc7">ast_cond_t</a> <a class="code" href="../../d2/d6b/structsorcery__memory__cache.html#a1c7181c39f99ee801943a0d0aa9872b9">cond</a>;</div><div class="line"><a name="l03257"></a><span class="lineno"> 3257</span>&#160;   <span class="keyword">struct </span>timeval start;</div><div class="line"><a name="l03258"></a><span class="lineno"> 3258</span>&#160;   <span class="keyword">struct </span>timespec end;</div><div class="line"><a name="l03259"></a><span class="lineno"> 3259</span>&#160;</div><div class="line"><a name="l03260"></a><span class="lineno"> 3260</span>&#160;   <span class="keywordflow">switch</span> (cmd) {</div><div class="line"><a name="l03261"></a><span class="lineno"> 3261</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="../../d2/ddc/test_8h.html#a0689ac4326c7a771e1b6ed1e4cde53e2a21df97525a6ac371a7fb604dfa8ea67b">TEST_INIT</a>:</div><div class="line"><a name="l03262"></a><span class="lineno"> 3262</span>&#160;      <a class="code" href="../../dd/d17/namespacesip__to__pjsip.html#ab82f408a83ecba10ea39afd8abfd371e">info</a>-&gt;name = <span class="stringliteral">&quot;full_backend_cache_expiration&quot;</span>;</div><div class="line"><a name="l03263"></a><span class="lineno"> 3263</span>&#160;      <a class="code" href="../../dd/d17/namespacesip__to__pjsip.html#ab82f408a83ecba10ea39afd8abfd371e">info</a>-&gt;category = <span class="stringliteral">&quot;/res/res_sorcery_memory_cache/&quot;</span>;</div><div class="line"><a name="l03264"></a><span class="lineno"> 3264</span>&#160;      <a class="code" href="../../dd/d17/namespacesip__to__pjsip.html#ab82f408a83ecba10ea39afd8abfd371e">info</a>-&gt;summary = <span class="stringliteral">&quot;Ensure that the full backend cache actually caches the backend&quot;</span>;</div><div class="line"><a name="l03265"></a><span class="lineno"> 3265</span>&#160;      <a class="code" href="../../dd/d17/namespacesip__to__pjsip.html#ab82f408a83ecba10ea39afd8abfd371e">info</a>-&gt;description = <span class="stringliteral">&quot;This test performs the following:\n&quot;</span></div><div class="line"><a name="l03266"></a><span class="lineno"> 3266</span>&#160;         <span class="stringliteral">&quot;\t* Create a sorcery instance with two wizards&quot;</span></div><div class="line"><a name="l03267"></a><span class="lineno"> 3267</span>&#160;         <span class="stringliteral">&quot;\t\t* The first is a memory cache that expires objects after 3 seconds and does full backend caching\n&quot;</span></div><div class="line"><a name="l03268"></a><span class="lineno"> 3268</span>&#160;         <span class="stringliteral">&quot;\t\t* The second is a mock of a back-end\n&quot;</span></div><div class="line"><a name="l03269"></a><span class="lineno"> 3269</span>&#160;         <span class="stringliteral">&quot;\t* Populates the cache by requesting all objects which returns 4.\n&quot;</span></div><div class="line"><a name="l03270"></a><span class="lineno"> 3270</span>&#160;         <span class="stringliteral">&quot;\t* Updates the backend to contain a different number of objects, 8.\n&quot;</span></div><div class="line"><a name="l03271"></a><span class="lineno"> 3271</span>&#160;         <span class="stringliteral">&quot;\t* Requests all objects and confirms the number returned is only 4.\n&quot;</span></div><div class="line"><a name="l03272"></a><span class="lineno"> 3272</span>&#160;         <span class="stringliteral">&quot;\t* Wait for cached objects to expire.\n&quot;</span></div><div class="line"><a name="l03273"></a><span class="lineno"> 3273</span>&#160;         <span class="stringliteral">&quot;\t* Requests all objects and confirms the number returned is 8.&quot;</span>;</div><div class="line"><a name="l03274"></a><span class="lineno"> 3274</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../d2/ddc/test_8h.html#aad2aec78205d328d23894a6598cc4044a8cf2ae27807baf798d726d630693cc8c">AST_TEST_NOT_RUN</a>;</div><div class="line"><a name="l03275"></a><span class="lineno"> 3275</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="../../d2/ddc/test_8h.html#a0689ac4326c7a771e1b6ed1e4cde53e2adb2586ef58bb9dd2f84a7d592ecf3e0e">TEST_EXECUTE</a>:</div><div class="line"><a name="l03276"></a><span class="lineno"> 3276</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l03277"></a><span class="lineno"> 3277</span>&#160;   }</div><div class="line"><a name="l03278"></a><span class="lineno"> 3278</span>&#160;</div><div class="line"><a name="l03279"></a><span class="lineno"> 3279</span>&#160;   <a class="code" href="../../d8/d25/sorcery_8h.html#aa2b2d9798c21334810a480fdc3260bb8">ast_sorcery_wizard_register</a>(&amp;mock_wizard);</div><div class="line"><a name="l03280"></a><span class="lineno"> 3280</span>&#160;</div><div class="line"><a name="l03281"></a><span class="lineno"> 3281</span>&#160;   sorcery = <a class="code" href="../../d8/d25/sorcery_8h.html#ad60f3b81bed748245f8045cb48fadee2">ast_sorcery_open</a>();</div><div class="line"><a name="l03282"></a><span class="lineno"> 3282</span>&#160;   <span class="keywordflow">if</span> (!sorcery) {</div><div class="line"><a name="l03283"></a><span class="lineno"> 3283</span>&#160;      <a class="code" href="../../d2/ddc/test_8h.html#a5e8fddded61f6989172c981256e7c9bd">ast_test_status_update</a>(<a class="code" href="../../d8/d89/structtest.html">test</a>, <span class="stringliteral">&quot;Failed to create sorcery instance\n&quot;</span>);</div><div class="line"><a name="l03284"></a><span class="lineno"> 3284</span>&#160;      <span class="keywordflow">goto</span> <a class="code" href="../../d2/d2c/pbx__realtime_8c.html#a10b51e1931bd03dd172cbfb9d3d67efb">cleanup</a>;</div><div class="line"><a name="l03285"></a><span class="lineno"> 3285</span>&#160;   }</div><div class="line"><a name="l03286"></a><span class="lineno"> 3286</span>&#160;</div><div class="line"><a name="l03287"></a><span class="lineno"> 3287</span>&#160;   <a class="code" href="../../d8/d25/sorcery_8h.html#a02d1aa896acd254e31664df39e3086c9">ast_sorcery_apply_wizard_mapping</a>(sorcery, <span class="stringliteral">&quot;test&quot;</span>, <span class="stringliteral">&quot;memory_cache&quot;</span>,</div><div class="line"><a name="l03288"></a><span class="lineno"> 3288</span>&#160;         <span class="stringliteral">&quot;object_lifetime_maximum=3,full_backend_cache=yes&quot;</span>, 1);</div><div class="line"><a name="l03289"></a><span class="lineno"> 3289</span>&#160;   <a class="code" href="../../d8/d25/sorcery_8h.html#a02d1aa896acd254e31664df39e3086c9">ast_sorcery_apply_wizard_mapping</a>(sorcery, <span class="stringliteral">&quot;test&quot;</span>, <span class="stringliteral">&quot;mock&quot;</span>, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, 0);</div><div class="line"><a name="l03290"></a><span class="lineno"> 3290</span>&#160;   <a class="code" href="../../d8/d25/sorcery_8h.html#a6f16dd100bbc816e1d8eb67026ab4ee3">ast_sorcery_internal_object_register</a>(sorcery, <span class="stringliteral">&quot;test&quot;</span>, <a class="code" href="../../d7/d30/res__sorcery__memory__cache_8c.html#a42cfb1ae93ed6226126180bc40c3eb7c">test_data_alloc</a>, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div><div class="line"><a name="l03291"></a><span class="lineno"> 3291</span>&#160;   <a class="code" href="../../d8/d25/sorcery_8h.html#a126f854c093cec80dd9e89b26db9b016">ast_sorcery_object_field_register_nodoc</a>(sorcery, <span class="stringliteral">&quot;test&quot;</span>, <span class="stringliteral">&quot;salt&quot;</span>, <span class="stringliteral">&quot;0&quot;</span>, <a class="code" href="../../db/dfe/config__options_8h.html#a61bb4940517e7d00e7104de8273c2144a019a75c8729b63787919b2e67331c84f">OPT_UINT_T</a>, 0, <a class="code" href="../../db/dfe/config__options_8h.html#a5793d5d6ccf2df0b2423eb3274af7802">FLDSET</a>(<span class="keyword">struct</span> <a class="code" href="../../dc/d9a/structtest__data.html">test_data</a>, salt));</div><div class="line"><a name="l03292"></a><span class="lineno"> 3292</span>&#160;   <a class="code" href="../../d8/d25/sorcery_8h.html#a126f854c093cec80dd9e89b26db9b016">ast_sorcery_object_field_register_nodoc</a>(sorcery, <span class="stringliteral">&quot;test&quot;</span>, <span class="stringliteral">&quot;pepper&quot;</span>, <span class="stringliteral">&quot;0&quot;</span>, <a class="code" href="../../db/dfe/config__options_8h.html#a61bb4940517e7d00e7104de8273c2144a019a75c8729b63787919b2e67331c84f">OPT_UINT_T</a>, 0, <a class="code" href="../../db/dfe/config__options_8h.html#a5793d5d6ccf2df0b2423eb3274af7802">FLDSET</a>(<span class="keyword">struct</span> <a class="code" href="../../dc/d9a/structtest__data.html">test_data</a>, pepper));</div><div class="line"><a name="l03293"></a><span class="lineno"> 3293</span>&#160;</div><div class="line"><a name="l03294"></a><span class="lineno"> 3294</span>&#160;   <span class="comment">/* Prepopulate the cache */</span></div><div class="line"><a name="l03295"></a><span class="lineno"> 3295</span>&#160;   <a class="code" href="../../d7/d30/res__sorcery__memory__cache_8c.html#a9a5449c09c240371ee234ec151bda8e0">real_backend_data</a> = &amp;initial;</div><div class="line"><a name="l03296"></a><span class="lineno"> 3296</span>&#160;</div><div class="line"><a name="l03297"></a><span class="lineno"> 3297</span>&#160;   <span class="comment">/* Get all current objects in the backend */</span></div><div class="line"><a name="l03298"></a><span class="lineno"> 3298</span>&#160;   objects = <a class="code" href="../../d8/d25/sorcery_8h.html#aaa9cd237841a70862001f580b23212c9">ast_sorcery_retrieve_by_fields</a>(sorcery, <span class="stringliteral">&quot;test&quot;</span>, <a class="code" href="../../d8/d25/sorcery_8h.html#a320e98591a38316a313a3ca83ea8df20a019a4a531b83f4ab0b35a3c788bf8d55">AST_RETRIEVE_FLAG_MULTIPLE</a> | <a class="code" href="../../d8/d25/sorcery_8h.html#a320e98591a38316a313a3ca83ea8df20a643c7c50af2691bb16052509d47b61cd">AST_RETRIEVE_FLAG_ALL</a>, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div><div class="line"><a name="l03299"></a><span class="lineno"> 3299</span>&#160;   <span class="keywordflow">if</span> (!objects) {</div><div class="line"><a name="l03300"></a><span class="lineno"> 3300</span>&#160;      <a class="code" href="../../d2/ddc/test_8h.html#a5e8fddded61f6989172c981256e7c9bd">ast_test_status_update</a>(<a class="code" href="../../d8/d89/structtest.html">test</a>, <span class="stringliteral">&quot;Unable to retrieve all objects in backend and populate cache\n&quot;</span>);</div><div class="line"><a name="l03301"></a><span class="lineno"> 3301</span>&#160;      <span class="keywordflow">goto</span> <a class="code" href="../../d2/d2c/pbx__realtime_8c.html#a10b51e1931bd03dd172cbfb9d3d67efb">cleanup</a>;</div><div class="line"><a name="l03302"></a><span class="lineno"> 3302</span>&#160;   }</div><div class="line"><a name="l03303"></a><span class="lineno"> 3303</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(objects, -1);</div><div class="line"><a name="l03304"></a><span class="lineno"> 3304</span>&#160;</div><div class="line"><a name="l03305"></a><span class="lineno"> 3305</span>&#160;   <span class="comment">/* Update the backend to have a different number of objects */</span></div><div class="line"><a name="l03306"></a><span class="lineno"> 3306</span>&#160;   initial.<a class="code" href="../../d2/d13/structbackend__data.html#a1c03c47f39cf197ed393df7833ccde95">exists</a> = 8;</div><div class="line"><a name="l03307"></a><span class="lineno"> 3307</span>&#160;</div><div class="line"><a name="l03308"></a><span class="lineno"> 3308</span>&#160;   <span class="comment">/* Get all current objects in the backend */</span></div><div class="line"><a name="l03309"></a><span class="lineno"> 3309</span>&#160;   objects = <a class="code" href="../../d8/d25/sorcery_8h.html#aaa9cd237841a70862001f580b23212c9">ast_sorcery_retrieve_by_fields</a>(sorcery, <span class="stringliteral">&quot;test&quot;</span>, <a class="code" href="../../d8/d25/sorcery_8h.html#a320e98591a38316a313a3ca83ea8df20a019a4a531b83f4ab0b35a3c788bf8d55">AST_RETRIEVE_FLAG_MULTIPLE</a> | <a class="code" href="../../d8/d25/sorcery_8h.html#a320e98591a38316a313a3ca83ea8df20a643c7c50af2691bb16052509d47b61cd">AST_RETRIEVE_FLAG_ALL</a>, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div><div class="line"><a name="l03310"></a><span class="lineno"> 3310</span>&#160;   <span class="keywordflow">if</span> (!objects) {</div><div class="line"><a name="l03311"></a><span class="lineno"> 3311</span>&#160;      <a class="code" href="../../d2/ddc/test_8h.html#a5e8fddded61f6989172c981256e7c9bd">ast_test_status_update</a>(<a class="code" href="../../d8/d89/structtest.html">test</a>, <span class="stringliteral">&quot;Unable to retrieve all objects in backend and populate cache\n&quot;</span>);</div><div class="line"><a name="l03312"></a><span class="lineno"> 3312</span>&#160;      <span class="keywordflow">goto</span> <a class="code" href="../../d2/d2c/pbx__realtime_8c.html#a10b51e1931bd03dd172cbfb9d3d67efb">cleanup</a>;</div><div class="line"><a name="l03313"></a><span class="lineno"> 3313</span>&#160;   }</div><div class="line"><a name="l03314"></a><span class="lineno"> 3314</span>&#160;</div><div class="line"><a name="l03315"></a><span class="lineno"> 3315</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d5/da5/astobj2_8h.html#a512cc40ce96c63b3d5c78040baa4c9cd">ao2_container_count</a>(objects) == initial.<a class="code" href="../../d2/d13/structbackend__data.html#a1c03c47f39cf197ed393df7833ccde95">exists</a>) {</div><div class="line"><a name="l03316"></a><span class="lineno"> 3316</span>&#160;      <a class="code" href="../../d2/ddc/test_8h.html#a5e8fddded61f6989172c981256e7c9bd">ast_test_status_update</a>(<a class="code" href="../../d8/d89/structtest.html">test</a>, <span class="stringliteral">&quot;Number of objects returned is of the current backend and not the cache\n&quot;</span>);</div><div class="line"><a name="l03317"></a><span class="lineno"> 3317</span>&#160;      <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(objects, -1);</div><div class="line"><a name="l03318"></a><span class="lineno"> 3318</span>&#160;      <span class="keywordflow">goto</span> <a class="code" href="../../d2/d2c/pbx__realtime_8c.html#a10b51e1931bd03dd172cbfb9d3d67efb">cleanup</a>;</div><div class="line"><a name="l03319"></a><span class="lineno"> 3319</span>&#160;   }</div><div class="line"><a name="l03320"></a><span class="lineno"> 3320</span>&#160;</div><div class="line"><a name="l03321"></a><span class="lineno"> 3321</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(objects, -1);</div><div class="line"><a name="l03322"></a><span class="lineno"> 3322</span>&#160;</div><div class="line"><a name="l03323"></a><span class="lineno"> 3323</span>&#160;   <a class="code" href="../../dd/d42/lock_8h.html#a76e8ed6bb354be6c6dd9e51acc1d7a1b">ast_mutex_init</a>(&amp;lock);</div><div class="line"><a name="l03324"></a><span class="lineno"> 3324</span>&#160;   <a class="code" href="../../dd/d42/lock_8h.html#a69e9591803d36f5683eb9b084442be9b">ast_cond_init</a>(&amp;cond, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div><div class="line"><a name="l03325"></a><span class="lineno"> 3325</span>&#160;</div><div class="line"><a name="l03326"></a><span class="lineno"> 3326</span>&#160;   start = <a class="code" href="../../de/df7/time_8h.html#ad3899efb6f0e348556ef69f5b16aa7f7">ast_tvnow</a>();</div><div class="line"><a name="l03327"></a><span class="lineno"> 3327</span>&#160;   end.tv_sec = start.tv_sec + 5;</div><div class="line"><a name="l03328"></a><span class="lineno"> 3328</span>&#160;   end.tv_nsec = start.tv_usec * 1000;</div><div class="line"><a name="l03329"></a><span class="lineno"> 3329</span>&#160;</div><div class="line"><a name="l03330"></a><span class="lineno"> 3330</span>&#160;   <a class="code" href="../../dd/d42/lock_8h.html#ac5e13c7fe64d3b271a52028b0a78b92b">ast_mutex_lock</a>(&amp;lock);</div><div class="line"><a name="l03331"></a><span class="lineno"> 3331</span>&#160;   <span class="keywordflow">while</span> (<a class="code" href="../../dd/d42/lock_8h.html#a6add1f30b2d53ca9384b15529a6f126e">ast_cond_timedwait</a>(&amp;cond, &amp;lock, &amp;end) != ETIMEDOUT) {</div><div class="line"><a name="l03332"></a><span class="lineno"> 3332</span>&#160;   }</div><div class="line"><a name="l03333"></a><span class="lineno"> 3333</span>&#160;   <a class="code" href="../../dd/d42/lock_8h.html#a873f9ce8c6287a32d48c83133e124418">ast_mutex_unlock</a>(&amp;lock);</div><div class="line"><a name="l03334"></a><span class="lineno"> 3334</span>&#160;</div><div class="line"><a name="l03335"></a><span class="lineno"> 3335</span>&#160;   <a class="code" href="../../dd/d42/lock_8h.html#ab8977a71822daa556f19f30ba6eec765">ast_mutex_destroy</a>(&amp;lock);</div><div class="line"><a name="l03336"></a><span class="lineno"> 3336</span>&#160;   <a class="code" href="../../dd/d42/lock_8h.html#a1ea2f4040a736cddbecea48b30ffedfd">ast_cond_destroy</a>(&amp;cond);</div><div class="line"><a name="l03337"></a><span class="lineno"> 3337</span>&#160;</div><div class="line"><a name="l03338"></a><span class="lineno"> 3338</span>&#160;   <span class="comment">/* Get all current objects in the backend */</span></div><div class="line"><a name="l03339"></a><span class="lineno"> 3339</span>&#160;   objects = <a class="code" href="../../d8/d25/sorcery_8h.html#aaa9cd237841a70862001f580b23212c9">ast_sorcery_retrieve_by_fields</a>(sorcery, <span class="stringliteral">&quot;test&quot;</span>, <a class="code" href="../../d8/d25/sorcery_8h.html#a320e98591a38316a313a3ca83ea8df20a019a4a531b83f4ab0b35a3c788bf8d55">AST_RETRIEVE_FLAG_MULTIPLE</a> | <a class="code" href="../../d8/d25/sorcery_8h.html#a320e98591a38316a313a3ca83ea8df20a643c7c50af2691bb16052509d47b61cd">AST_RETRIEVE_FLAG_ALL</a>, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div><div class="line"><a name="l03340"></a><span class="lineno"> 3340</span>&#160;   <span class="keywordflow">if</span> (!objects) {</div><div class="line"><a name="l03341"></a><span class="lineno"> 3341</span>&#160;      <a class="code" href="../../d2/ddc/test_8h.html#a5e8fddded61f6989172c981256e7c9bd">ast_test_status_update</a>(<a class="code" href="../../d8/d89/structtest.html">test</a>, <span class="stringliteral">&quot;Unable to retrieve all objects in backend and populate cache\n&quot;</span>);</div><div class="line"><a name="l03342"></a><span class="lineno"> 3342</span>&#160;      <span class="keywordflow">goto</span> <a class="code" href="../../d2/d2c/pbx__realtime_8c.html#a10b51e1931bd03dd172cbfb9d3d67efb">cleanup</a>;</div><div class="line"><a name="l03343"></a><span class="lineno"> 3343</span>&#160;   }</div><div class="line"><a name="l03344"></a><span class="lineno"> 3344</span>&#160;</div><div class="line"><a name="l03345"></a><span class="lineno"> 3345</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d5/da5/astobj2_8h.html#a512cc40ce96c63b3d5c78040baa4c9cd">ao2_container_count</a>(objects) != initial.<a class="code" href="../../d2/d13/structbackend__data.html#a1c03c47f39cf197ed393df7833ccde95">exists</a>) {</div><div class="line"><a name="l03346"></a><span class="lineno"> 3346</span>&#160;      <a class="code" href="../../d2/ddc/test_8h.html#a5e8fddded61f6989172c981256e7c9bd">ast_test_status_update</a>(<a class="code" href="../../d8/d89/structtest.html">test</a>, <span class="stringliteral">&quot;Number of objects returned is NOT of the current backend when it should be\n&quot;</span>);</div><div class="line"><a name="l03347"></a><span class="lineno"> 3347</span>&#160;      <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(objects, -1);</div><div class="line"><a name="l03348"></a><span class="lineno"> 3348</span>&#160;      <span class="keywordflow">goto</span> <a class="code" href="../../d2/d2c/pbx__realtime_8c.html#a10b51e1931bd03dd172cbfb9d3d67efb">cleanup</a>;</div><div class="line"><a name="l03349"></a><span class="lineno"> 3349</span>&#160;   }</div><div class="line"><a name="l03350"></a><span class="lineno"> 3350</span>&#160;</div><div class="line"><a name="l03351"></a><span class="lineno"> 3351</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(objects, -1);</div><div class="line"><a name="l03352"></a><span class="lineno"> 3352</span>&#160;</div><div class="line"><a name="l03353"></a><span class="lineno"> 3353</span>&#160;   res = <a class="code" href="../../d2/ddc/test_8h.html#aad2aec78205d328d23894a6598cc4044a7a3ab73c870a7ce6cf1a0f3cfd42a37b">AST_TEST_PASS</a>;</div><div class="line"><a name="l03354"></a><span class="lineno"> 3354</span>&#160;</div><div class="line"><a name="l03355"></a><span class="lineno"> 3355</span>&#160;<a class="code" href="../../d2/d2c/pbx__realtime_8c.html#a10b51e1931bd03dd172cbfb9d3d67efb">cleanup</a>:</div><div class="line"><a name="l03356"></a><span class="lineno"> 3356</span>&#160;   <span class="keywordflow">if</span> (sorcery) {</div><div class="line"><a name="l03357"></a><span class="lineno"> 3357</span>&#160;      <a class="code" href="../../d8/d25/sorcery_8h.html#a09cba9c37c702ca2bdcf94052068ed67">ast_sorcery_unref</a>(sorcery);</div><div class="line"><a name="l03358"></a><span class="lineno"> 3358</span>&#160;   }</div><div class="line"><a name="l03359"></a><span class="lineno"> 3359</span>&#160;   <a class="code" href="../../d8/d25/sorcery_8h.html#a14ed6490f3390526922655ab5dbc344f">ast_sorcery_wizard_unregister</a>(&amp;mock_wizard);</div><div class="line"><a name="l03360"></a><span class="lineno"> 3360</span>&#160;   <span class="keywordflow">return</span> res;</div><div class="line"><a name="l03361"></a><span class="lineno"> 3361</span>&#160;}</div><div class="line"><a name="l03362"></a><span class="lineno"> 3362</span>&#160;</div><div class="line"><a name="l03363"></a><span class="lineno"><a class="line" href="../../d7/d30/res__sorcery__memory__cache_8c.html#a8a18942d4348d7226721798d276a8755"> 3363</a></span>&#160;<a class="code" href="../../d7/d30/res__sorcery__memory__cache_8c.html#af6639c66b2a5eff1e659bf57d5938e54">AST_TEST_DEFINE</a>(full_backend_cache_stale)</div><div class="line"><a name="l03364"></a><span class="lineno"> 3364</span>&#160;{</div><div class="line"><a name="l03365"></a><span class="lineno"> 3365</span>&#160;   <span class="keywordtype">int</span> res = <a class="code" href="../../d2/ddc/test_8h.html#aad2aec78205d328d23894a6598cc4044a8a11a3a19eb4c9fd2ba654d95df1adb6">AST_TEST_FAIL</a>;</div><div class="line"><a name="l03366"></a><span class="lineno"> 3366</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d2/d88/structast__sorcery.html">ast_sorcery</a> *<a class="code" href="../../d2/d6b/structsorcery__memory__cache.html#aeb33dcb5573e1661c82b5370681fb626">sorcery</a> = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l03367"></a><span class="lineno"> 3367</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d2/d13/structbackend__data.html">backend_data</a> initial = {</div><div class="line"><a name="l03368"></a><span class="lineno"> 3368</span>&#160;      .<a class="code" href="../../d2/d13/structbackend__data.html#a0817c9db744a78699e31ca83df2ef709">salt</a> = 0,</div><div class="line"><a name="l03369"></a><span class="lineno"> 3369</span>&#160;      .pepper = 0,</div><div class="line"><a name="l03370"></a><span class="lineno"> 3370</span>&#160;      .exists = 4,</div><div class="line"><a name="l03371"></a><span class="lineno"> 3371</span>&#160;   };</div><div class="line"><a name="l03372"></a><span class="lineno"> 3372</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d2/da9/structao2__container.html">ao2_container</a> *<a class="code" href="../../d2/d6b/structsorcery__memory__cache.html#aa0a84e33972901716d6d5a6dcf1a68de">objects</a>;</div><div class="line"><a name="l03373"></a><span class="lineno"> 3373</span>&#160;   <a class="code" href="../../d8/dc5/structast__mutex__info.html">ast_mutex_t</a> <a class="code" href="../../d2/d6b/structsorcery__memory__cache.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>;</div><div class="line"><a name="l03374"></a><span class="lineno"> 3374</span>&#160;   <a class="code" href="../../dd/d42/lock_8h.html#ab134d98cdfe7de0f7a72b377c0765dc7">ast_cond_t</a> <a class="code" href="../../d2/d6b/structsorcery__memory__cache.html#a1c7181c39f99ee801943a0d0aa9872b9">cond</a>;</div><div class="line"><a name="l03375"></a><span class="lineno"> 3375</span>&#160;   <span class="keyword">struct </span>timeval start;</div><div class="line"><a name="l03376"></a><span class="lineno"> 3376</span>&#160;   <span class="keyword">struct </span>timespec end;</div><div class="line"><a name="l03377"></a><span class="lineno"> 3377</span>&#160;</div><div class="line"><a name="l03378"></a><span class="lineno"> 3378</span>&#160;   <span class="keywordflow">switch</span> (cmd) {</div><div class="line"><a name="l03379"></a><span class="lineno"> 3379</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="../../d2/ddc/test_8h.html#a0689ac4326c7a771e1b6ed1e4cde53e2a21df97525a6ac371a7fb604dfa8ea67b">TEST_INIT</a>:</div><div class="line"><a name="l03380"></a><span class="lineno"> 3380</span>&#160;      <a class="code" href="../../dd/d17/namespacesip__to__pjsip.html#ab82f408a83ecba10ea39afd8abfd371e">info</a>-&gt;name = <span class="stringliteral">&quot;full_backend_cache_stale&quot;</span>;</div><div class="line"><a name="l03381"></a><span class="lineno"> 3381</span>&#160;      <a class="code" href="../../dd/d17/namespacesip__to__pjsip.html#ab82f408a83ecba10ea39afd8abfd371e">info</a>-&gt;category = <span class="stringliteral">&quot;/res/res_sorcery_memory_cache/&quot;</span>;</div><div class="line"><a name="l03382"></a><span class="lineno"> 3382</span>&#160;      <a class="code" href="../../dd/d17/namespacesip__to__pjsip.html#ab82f408a83ecba10ea39afd8abfd371e">info</a>-&gt;summary = <span class="stringliteral">&quot;Ensure that the full backend cache works with staleness&quot;</span>;</div><div class="line"><a name="l03383"></a><span class="lineno"> 3383</span>&#160;      <a class="code" href="../../dd/d17/namespacesip__to__pjsip.html#ab82f408a83ecba10ea39afd8abfd371e">info</a>-&gt;description = <span class="stringliteral">&quot;This test performs the following:\n&quot;</span></div><div class="line"><a name="l03384"></a><span class="lineno"> 3384</span>&#160;         <span class="stringliteral">&quot;\t* Create a sorcery instance with two wizards&quot;</span></div><div class="line"><a name="l03385"></a><span class="lineno"> 3385</span>&#160;         <span class="stringliteral">&quot;\t\t* The first is a memory cache that stales objects after 1 second and does full backend caching\n&quot;</span></div><div class="line"><a name="l03386"></a><span class="lineno"> 3386</span>&#160;         <span class="stringliteral">&quot;\t\t* The second is a mock of a back-end\n&quot;</span></div><div class="line"><a name="l03387"></a><span class="lineno"> 3387</span>&#160;         <span class="stringliteral">&quot;\t* Populates the cache by requesting all objects which returns 4.\n&quot;</span></div><div class="line"><a name="l03388"></a><span class="lineno"> 3388</span>&#160;         <span class="stringliteral">&quot;\t* Wait for objects to go stale.\n&quot;</span></div><div class="line"><a name="l03389"></a><span class="lineno"> 3389</span>&#160;         <span class="stringliteral">&quot;\t* Updates the backend to contain a different number of objects, 8.\&quot;&quot;</span></div><div class="line"><a name="l03390"></a><span class="lineno"> 3390</span>&#160;         <span class="stringliteral">&quot;\t* Requests all objects and confirms the number returned is only 4.\n&quot;</span></div><div class="line"><a name="l03391"></a><span class="lineno"> 3391</span>&#160;         <span class="stringliteral">&quot;\t* Wait for objects to be refreshed from backend.\n&quot;</span></div><div class="line"><a name="l03392"></a><span class="lineno"> 3392</span>&#160;         <span class="stringliteral">&quot;\t* Requests all objects and confirms the number returned is 8.&quot;</span>;</div><div class="line"><a name="l03393"></a><span class="lineno"> 3393</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../d2/ddc/test_8h.html#aad2aec78205d328d23894a6598cc4044a8cf2ae27807baf798d726d630693cc8c">AST_TEST_NOT_RUN</a>;</div><div class="line"><a name="l03394"></a><span class="lineno"> 3394</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="../../d2/ddc/test_8h.html#a0689ac4326c7a771e1b6ed1e4cde53e2adb2586ef58bb9dd2f84a7d592ecf3e0e">TEST_EXECUTE</a>:</div><div class="line"><a name="l03395"></a><span class="lineno"> 3395</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l03396"></a><span class="lineno"> 3396</span>&#160;   }</div><div class="line"><a name="l03397"></a><span class="lineno"> 3397</span>&#160;</div><div class="line"><a name="l03398"></a><span class="lineno"> 3398</span>&#160;   <a class="code" href="../../d8/d25/sorcery_8h.html#aa2b2d9798c21334810a480fdc3260bb8">ast_sorcery_wizard_register</a>(&amp;mock_wizard);</div><div class="line"><a name="l03399"></a><span class="lineno"> 3399</span>&#160;</div><div class="line"><a name="l03400"></a><span class="lineno"> 3400</span>&#160;   <a class="code" href="../../dd/d42/lock_8h.html#a76e8ed6bb354be6c6dd9e51acc1d7a1b">ast_mutex_init</a>(&amp;lock);</div><div class="line"><a name="l03401"></a><span class="lineno"> 3401</span>&#160;   <a class="code" href="../../dd/d42/lock_8h.html#a69e9591803d36f5683eb9b084442be9b">ast_cond_init</a>(&amp;cond, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div><div class="line"><a name="l03402"></a><span class="lineno"> 3402</span>&#160;</div><div class="line"><a name="l03403"></a><span class="lineno"> 3403</span>&#160;   sorcery = <a class="code" href="../../d8/d25/sorcery_8h.html#ad60f3b81bed748245f8045cb48fadee2">ast_sorcery_open</a>();</div><div class="line"><a name="l03404"></a><span class="lineno"> 3404</span>&#160;   <span class="keywordflow">if</span> (!sorcery) {</div><div class="line"><a name="l03405"></a><span class="lineno"> 3405</span>&#160;      <a class="code" href="../../d2/ddc/test_8h.html#a5e8fddded61f6989172c981256e7c9bd">ast_test_status_update</a>(<a class="code" href="../../d8/d89/structtest.html">test</a>, <span class="stringliteral">&quot;Failed to create sorcery instance\n&quot;</span>);</div><div class="line"><a name="l03406"></a><span class="lineno"> 3406</span>&#160;      <span class="keywordflow">goto</span> <a class="code" href="../../d2/d2c/pbx__realtime_8c.html#a10b51e1931bd03dd172cbfb9d3d67efb">cleanup</a>;</div><div class="line"><a name="l03407"></a><span class="lineno"> 3407</span>&#160;   }</div><div class="line"><a name="l03408"></a><span class="lineno"> 3408</span>&#160;</div><div class="line"><a name="l03409"></a><span class="lineno"> 3409</span>&#160;   <a class="code" href="../../d8/d25/sorcery_8h.html#a02d1aa896acd254e31664df39e3086c9">ast_sorcery_apply_wizard_mapping</a>(sorcery, <span class="stringliteral">&quot;test&quot;</span>, <span class="stringliteral">&quot;memory_cache&quot;</span>,</div><div class="line"><a name="l03410"></a><span class="lineno"> 3410</span>&#160;         <span class="stringliteral">&quot;object_lifetime_stale=1,full_backend_cache=yes&quot;</span>, 1);</div><div class="line"><a name="l03411"></a><span class="lineno"> 3411</span>&#160;   <a class="code" href="../../d8/d25/sorcery_8h.html#a02d1aa896acd254e31664df39e3086c9">ast_sorcery_apply_wizard_mapping</a>(sorcery, <span class="stringliteral">&quot;test&quot;</span>, <span class="stringliteral">&quot;mock&quot;</span>, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, 0);</div><div class="line"><a name="l03412"></a><span class="lineno"> 3412</span>&#160;   <a class="code" href="../../d8/d25/sorcery_8h.html#a6f16dd100bbc816e1d8eb67026ab4ee3">ast_sorcery_internal_object_register</a>(sorcery, <span class="stringliteral">&quot;test&quot;</span>, <a class="code" href="../../d7/d30/res__sorcery__memory__cache_8c.html#a42cfb1ae93ed6226126180bc40c3eb7c">test_data_alloc</a>, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div><div class="line"><a name="l03413"></a><span class="lineno"> 3413</span>&#160;   <a class="code" href="../../d8/d25/sorcery_8h.html#a126f854c093cec80dd9e89b26db9b016">ast_sorcery_object_field_register_nodoc</a>(sorcery, <span class="stringliteral">&quot;test&quot;</span>, <span class="stringliteral">&quot;salt&quot;</span>, <span class="stringliteral">&quot;0&quot;</span>, <a class="code" href="../../db/dfe/config__options_8h.html#a61bb4940517e7d00e7104de8273c2144a019a75c8729b63787919b2e67331c84f">OPT_UINT_T</a>, 0, <a class="code" href="../../db/dfe/config__options_8h.html#a5793d5d6ccf2df0b2423eb3274af7802">FLDSET</a>(<span class="keyword">struct</span> <a class="code" href="../../dc/d9a/structtest__data.html">test_data</a>, salt));</div><div class="line"><a name="l03414"></a><span class="lineno"> 3414</span>&#160;   <a class="code" href="../../d8/d25/sorcery_8h.html#a126f854c093cec80dd9e89b26db9b016">ast_sorcery_object_field_register_nodoc</a>(sorcery, <span class="stringliteral">&quot;test&quot;</span>, <span class="stringliteral">&quot;pepper&quot;</span>, <span class="stringliteral">&quot;0&quot;</span>, <a class="code" href="../../db/dfe/config__options_8h.html#a61bb4940517e7d00e7104de8273c2144a019a75c8729b63787919b2e67331c84f">OPT_UINT_T</a>, 0, <a class="code" href="../../db/dfe/config__options_8h.html#a5793d5d6ccf2df0b2423eb3274af7802">FLDSET</a>(<span class="keyword">struct</span> <a class="code" href="../../dc/d9a/structtest__data.html">test_data</a>, pepper));</div><div class="line"><a name="l03415"></a><span class="lineno"> 3415</span>&#160;</div><div class="line"><a name="l03416"></a><span class="lineno"> 3416</span>&#160;   <span class="comment">/* Prepopulate the cache */</span></div><div class="line"><a name="l03417"></a><span class="lineno"> 3417</span>&#160;   <a class="code" href="../../d7/d30/res__sorcery__memory__cache_8c.html#a9a5449c09c240371ee234ec151bda8e0">real_backend_data</a> = &amp;initial;</div><div class="line"><a name="l03418"></a><span class="lineno"> 3418</span>&#160;</div><div class="line"><a name="l03419"></a><span class="lineno"> 3419</span>&#160;   <span class="comment">/* Get all current objects in the backend */</span></div><div class="line"><a name="l03420"></a><span class="lineno"> 3420</span>&#160;   objects = <a class="code" href="../../d8/d25/sorcery_8h.html#aaa9cd237841a70862001f580b23212c9">ast_sorcery_retrieve_by_fields</a>(sorcery, <span class="stringliteral">&quot;test&quot;</span>, <a class="code" href="../../d8/d25/sorcery_8h.html#a320e98591a38316a313a3ca83ea8df20a019a4a531b83f4ab0b35a3c788bf8d55">AST_RETRIEVE_FLAG_MULTIPLE</a> | <a class="code" href="../../d8/d25/sorcery_8h.html#a320e98591a38316a313a3ca83ea8df20a643c7c50af2691bb16052509d47b61cd">AST_RETRIEVE_FLAG_ALL</a>, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div><div class="line"><a name="l03421"></a><span class="lineno"> 3421</span>&#160;   <span class="keywordflow">if</span> (!objects) {</div><div class="line"><a name="l03422"></a><span class="lineno"> 3422</span>&#160;      <a class="code" href="../../d2/ddc/test_8h.html#a5e8fddded61f6989172c981256e7c9bd">ast_test_status_update</a>(<a class="code" href="../../d8/d89/structtest.html">test</a>, <span class="stringliteral">&quot;Unable to retrieve all objects in backend and populate cache\n&quot;</span>);</div><div class="line"><a name="l03423"></a><span class="lineno"> 3423</span>&#160;      <span class="keywordflow">goto</span> <a class="code" href="../../d2/d2c/pbx__realtime_8c.html#a10b51e1931bd03dd172cbfb9d3d67efb">cleanup</a>;</div><div class="line"><a name="l03424"></a><span class="lineno"> 3424</span>&#160;   }</div><div class="line"><a name="l03425"></a><span class="lineno"> 3425</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(objects, -1);</div><div class="line"><a name="l03426"></a><span class="lineno"> 3426</span>&#160;</div><div class="line"><a name="l03427"></a><span class="lineno"> 3427</span>&#160;   start = <a class="code" href="../../de/df7/time_8h.html#ad3899efb6f0e348556ef69f5b16aa7f7">ast_tvnow</a>();</div><div class="line"><a name="l03428"></a><span class="lineno"> 3428</span>&#160;   end.tv_sec = start.tv_sec + 5;</div><div class="line"><a name="l03429"></a><span class="lineno"> 3429</span>&#160;   end.tv_nsec = start.tv_usec * 1000;</div><div class="line"><a name="l03430"></a><span class="lineno"> 3430</span>&#160;</div><div class="line"><a name="l03431"></a><span class="lineno"> 3431</span>&#160;   <a class="code" href="../../dd/d42/lock_8h.html#ac5e13c7fe64d3b271a52028b0a78b92b">ast_mutex_lock</a>(&amp;lock);</div><div class="line"><a name="l03432"></a><span class="lineno"> 3432</span>&#160;   <span class="keywordflow">while</span> (<a class="code" href="../../dd/d42/lock_8h.html#a6add1f30b2d53ca9384b15529a6f126e">ast_cond_timedwait</a>(&amp;cond, &amp;lock, &amp;end) != ETIMEDOUT) {</div><div class="line"><a name="l03433"></a><span class="lineno"> 3433</span>&#160;   }</div><div class="line"><a name="l03434"></a><span class="lineno"> 3434</span>&#160;   <a class="code" href="../../dd/d42/lock_8h.html#a873f9ce8c6287a32d48c83133e124418">ast_mutex_unlock</a>(&amp;lock);</div><div class="line"><a name="l03435"></a><span class="lineno"> 3435</span>&#160;</div><div class="line"><a name="l03436"></a><span class="lineno"> 3436</span>&#160;   initial.<a class="code" href="../../d2/d13/structbackend__data.html#a1c03c47f39cf197ed393df7833ccde95">exists</a> = 8;</div><div class="line"><a name="l03437"></a><span class="lineno"> 3437</span>&#160;</div><div class="line"><a name="l03438"></a><span class="lineno"> 3438</span>&#160;   <span class="comment">/* Get all current objects in the backend */</span></div><div class="line"><a name="l03439"></a><span class="lineno"> 3439</span>&#160;   objects = <a class="code" href="../../d8/d25/sorcery_8h.html#aaa9cd237841a70862001f580b23212c9">ast_sorcery_retrieve_by_fields</a>(sorcery, <span class="stringliteral">&quot;test&quot;</span>, <a class="code" href="../../d8/d25/sorcery_8h.html#a320e98591a38316a313a3ca83ea8df20a019a4a531b83f4ab0b35a3c788bf8d55">AST_RETRIEVE_FLAG_MULTIPLE</a> | <a class="code" href="../../d8/d25/sorcery_8h.html#a320e98591a38316a313a3ca83ea8df20a643c7c50af2691bb16052509d47b61cd">AST_RETRIEVE_FLAG_ALL</a>, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div><div class="line"><a name="l03440"></a><span class="lineno"> 3440</span>&#160;   <span class="keywordflow">if</span> (!objects) {</div><div class="line"><a name="l03441"></a><span class="lineno"> 3441</span>&#160;      <a class="code" href="../../d2/ddc/test_8h.html#a5e8fddded61f6989172c981256e7c9bd">ast_test_status_update</a>(<a class="code" href="../../d8/d89/structtest.html">test</a>, <span class="stringliteral">&quot;Unable to retrieve all objects in backend and populate cache\n&quot;</span>);</div><div class="line"><a name="l03442"></a><span class="lineno"> 3442</span>&#160;      <span class="keywordflow">goto</span> <a class="code" href="../../d2/d2c/pbx__realtime_8c.html#a10b51e1931bd03dd172cbfb9d3d67efb">cleanup</a>;</div><div class="line"><a name="l03443"></a><span class="lineno"> 3443</span>&#160;   }</div><div class="line"><a name="l03444"></a><span class="lineno"> 3444</span>&#160;</div><div class="line"><a name="l03445"></a><span class="lineno"> 3445</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d5/da5/astobj2_8h.html#a512cc40ce96c63b3d5c78040baa4c9cd">ao2_container_count</a>(objects) == initial.<a class="code" href="../../d2/d13/structbackend__data.html#a1c03c47f39cf197ed393df7833ccde95">exists</a>) {</div><div class="line"><a name="l03446"></a><span class="lineno"> 3446</span>&#160;      <a class="code" href="../../d2/ddc/test_8h.html#a5e8fddded61f6989172c981256e7c9bd">ast_test_status_update</a>(<a class="code" href="../../d8/d89/structtest.html">test</a>, <span class="stringliteral">&quot;Number of objects returned is of the backend and not the cache\n&quot;</span>);</div><div class="line"><a name="l03447"></a><span class="lineno"> 3447</span>&#160;      <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(objects, -1);</div><div class="line"><a name="l03448"></a><span class="lineno"> 3448</span>&#160;      <span class="keywordflow">goto</span> <a class="code" href="../../d2/d2c/pbx__realtime_8c.html#a10b51e1931bd03dd172cbfb9d3d67efb">cleanup</a>;</div><div class="line"><a name="l03449"></a><span class="lineno"> 3449</span>&#160;   }</div><div class="line"><a name="l03450"></a><span class="lineno"> 3450</span>&#160;</div><div class="line"><a name="l03451"></a><span class="lineno"> 3451</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(objects, -1);</div><div class="line"><a name="l03452"></a><span class="lineno"> 3452</span>&#160;</div><div class="line"><a name="l03453"></a><span class="lineno"> 3453</span>&#160;   start = <a class="code" href="../../de/df7/time_8h.html#ad3899efb6f0e348556ef69f5b16aa7f7">ast_tvnow</a>();</div><div class="line"><a name="l03454"></a><span class="lineno"> 3454</span>&#160;   end.tv_sec = start.tv_sec + 5;</div><div class="line"><a name="l03455"></a><span class="lineno"> 3455</span>&#160;   end.tv_nsec = start.tv_usec * 1000;</div><div class="line"><a name="l03456"></a><span class="lineno"> 3456</span>&#160;</div><div class="line"><a name="l03457"></a><span class="lineno"> 3457</span>&#160;   <a class="code" href="../../dd/d42/lock_8h.html#ac5e13c7fe64d3b271a52028b0a78b92b">ast_mutex_lock</a>(&amp;lock);</div><div class="line"><a name="l03458"></a><span class="lineno"> 3458</span>&#160;   <span class="keywordflow">while</span> (<a class="code" href="../../dd/d42/lock_8h.html#a6add1f30b2d53ca9384b15529a6f126e">ast_cond_timedwait</a>(&amp;cond, &amp;lock, &amp;end) != ETIMEDOUT) {</div><div class="line"><a name="l03459"></a><span class="lineno"> 3459</span>&#160;   }</div><div class="line"><a name="l03460"></a><span class="lineno"> 3460</span>&#160;   <a class="code" href="../../dd/d42/lock_8h.html#a873f9ce8c6287a32d48c83133e124418">ast_mutex_unlock</a>(&amp;lock);</div><div class="line"><a name="l03461"></a><span class="lineno"> 3461</span>&#160;</div><div class="line"><a name="l03462"></a><span class="lineno"> 3462</span>&#160;   <span class="comment">/* Get all current objects in the backend */</span></div><div class="line"><a name="l03463"></a><span class="lineno"> 3463</span>&#160;   objects = <a class="code" href="../../d8/d25/sorcery_8h.html#aaa9cd237841a70862001f580b23212c9">ast_sorcery_retrieve_by_fields</a>(sorcery, <span class="stringliteral">&quot;test&quot;</span>, <a class="code" href="../../d8/d25/sorcery_8h.html#a320e98591a38316a313a3ca83ea8df20a019a4a531b83f4ab0b35a3c788bf8d55">AST_RETRIEVE_FLAG_MULTIPLE</a> | <a class="code" href="../../d8/d25/sorcery_8h.html#a320e98591a38316a313a3ca83ea8df20a643c7c50af2691bb16052509d47b61cd">AST_RETRIEVE_FLAG_ALL</a>, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div><div class="line"><a name="l03464"></a><span class="lineno"> 3464</span>&#160;   <span class="keywordflow">if</span> (!objects) {</div><div class="line"><a name="l03465"></a><span class="lineno"> 3465</span>&#160;      <a class="code" href="../../d2/ddc/test_8h.html#a5e8fddded61f6989172c981256e7c9bd">ast_test_status_update</a>(<a class="code" href="../../d8/d89/structtest.html">test</a>, <span class="stringliteral">&quot;Unable to retrieve all objects in backend and populate cache\n&quot;</span>);</div><div class="line"><a name="l03466"></a><span class="lineno"> 3466</span>&#160;      <span class="keywordflow">goto</span> <a class="code" href="../../d2/d2c/pbx__realtime_8c.html#a10b51e1931bd03dd172cbfb9d3d67efb">cleanup</a>;</div><div class="line"><a name="l03467"></a><span class="lineno"> 3467</span>&#160;   }</div><div class="line"><a name="l03468"></a><span class="lineno"> 3468</span>&#160;</div><div class="line"><a name="l03469"></a><span class="lineno"> 3469</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d5/da5/astobj2_8h.html#a512cc40ce96c63b3d5c78040baa4c9cd">ao2_container_count</a>(objects) != initial.<a class="code" href="../../d2/d13/structbackend__data.html#a1c03c47f39cf197ed393df7833ccde95">exists</a>) {</div><div class="line"><a name="l03470"></a><span class="lineno"> 3470</span>&#160;      <a class="code" href="../../d2/ddc/test_8h.html#a5e8fddded61f6989172c981256e7c9bd">ast_test_status_update</a>(<a class="code" href="../../d8/d89/structtest.html">test</a>, <span class="stringliteral">&quot;Number of objects returned is not of backend\n&quot;</span>);</div><div class="line"><a name="l03471"></a><span class="lineno"> 3471</span>&#160;      <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(objects, -1);</div><div class="line"><a name="l03472"></a><span class="lineno"> 3472</span>&#160;      <span class="keywordflow">goto</span> <a class="code" href="../../d2/d2c/pbx__realtime_8c.html#a10b51e1931bd03dd172cbfb9d3d67efb">cleanup</a>;</div><div class="line"><a name="l03473"></a><span class="lineno"> 3473</span>&#160;   }</div><div class="line"><a name="l03474"></a><span class="lineno"> 3474</span>&#160;</div><div class="line"><a name="l03475"></a><span class="lineno"> 3475</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(objects, -1);</div><div class="line"><a name="l03476"></a><span class="lineno"> 3476</span>&#160;</div><div class="line"><a name="l03477"></a><span class="lineno"> 3477</span>&#160;   start = <a class="code" href="../../de/df7/time_8h.html#ad3899efb6f0e348556ef69f5b16aa7f7">ast_tvnow</a>();</div><div class="line"><a name="l03478"></a><span class="lineno"> 3478</span>&#160;   end.tv_sec = start.tv_sec + 5;</div><div class="line"><a name="l03479"></a><span class="lineno"> 3479</span>&#160;   end.tv_nsec = start.tv_usec * 1000;</div><div class="line"><a name="l03480"></a><span class="lineno"> 3480</span>&#160;</div><div class="line"><a name="l03481"></a><span class="lineno"> 3481</span>&#160;   <a class="code" href="../../dd/d42/lock_8h.html#ac5e13c7fe64d3b271a52028b0a78b92b">ast_mutex_lock</a>(&amp;lock);</div><div class="line"><a name="l03482"></a><span class="lineno"> 3482</span>&#160;   <span class="keywordflow">while</span> (<a class="code" href="../../dd/d42/lock_8h.html#a6add1f30b2d53ca9384b15529a6f126e">ast_cond_timedwait</a>(&amp;cond, &amp;lock, &amp;end) != ETIMEDOUT) {</div><div class="line"><a name="l03483"></a><span class="lineno"> 3483</span>&#160;   }</div><div class="line"><a name="l03484"></a><span class="lineno"> 3484</span>&#160;   <a class="code" href="../../dd/d42/lock_8h.html#a873f9ce8c6287a32d48c83133e124418">ast_mutex_unlock</a>(&amp;lock);</div><div class="line"><a name="l03485"></a><span class="lineno"> 3485</span>&#160;</div><div class="line"><a name="l03486"></a><span class="lineno"> 3486</span>&#160;   res = <a class="code" href="../../d2/ddc/test_8h.html#aad2aec78205d328d23894a6598cc4044a7a3ab73c870a7ce6cf1a0f3cfd42a37b">AST_TEST_PASS</a>;</div><div class="line"><a name="l03487"></a><span class="lineno"> 3487</span>&#160;</div><div class="line"><a name="l03488"></a><span class="lineno"> 3488</span>&#160;<a class="code" href="../../d2/d2c/pbx__realtime_8c.html#a10b51e1931bd03dd172cbfb9d3d67efb">cleanup</a>:</div><div class="line"><a name="l03489"></a><span class="lineno"> 3489</span>&#160;   <span class="keywordflow">if</span> (sorcery) {</div><div class="line"><a name="l03490"></a><span class="lineno"> 3490</span>&#160;      <a class="code" href="../../d8/d25/sorcery_8h.html#a09cba9c37c702ca2bdcf94052068ed67">ast_sorcery_unref</a>(sorcery);</div><div class="line"><a name="l03491"></a><span class="lineno"> 3491</span>&#160;   }</div><div class="line"><a name="l03492"></a><span class="lineno"> 3492</span>&#160;   <a class="code" href="../../d8/d25/sorcery_8h.html#a14ed6490f3390526922655ab5dbc344f">ast_sorcery_wizard_unregister</a>(&amp;mock_wizard);</div><div class="line"><a name="l03493"></a><span class="lineno"> 3493</span>&#160;   <a class="code" href="../../dd/d42/lock_8h.html#ab8977a71822daa556f19f30ba6eec765">ast_mutex_destroy</a>(&amp;lock);</div><div class="line"><a name="l03494"></a><span class="lineno"> 3494</span>&#160;   <a class="code" href="../../dd/d42/lock_8h.html#a1ea2f4040a736cddbecea48b30ffedfd">ast_cond_destroy</a>(&amp;cond);</div><div class="line"><a name="l03495"></a><span class="lineno"> 3495</span>&#160;   <span class="keywordflow">return</span> res;</div><div class="line"><a name="l03496"></a><span class="lineno"> 3496</span>&#160;}</div><div class="line"><a name="l03497"></a><span class="lineno"> 3497</span>&#160;</div><div class="line"><a name="l03498"></a><span class="lineno"> 3498</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l03499"></a><span class="lineno"> 3499</span>&#160;</div><div class="line"><a name="l03500"></a><span class="lineno"><a class="line" href="../../d7/d30/res__sorcery__memory__cache_8c.html#ad09fa931f468002152a3cc2d5ce25eae"> 3500</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d7/d30/res__sorcery__memory__cache_8c.html#ad09fa931f468002152a3cc2d5ce25eae">unload_module</a>(<span class="keywordtype">void</span>)</div><div class="line"><a name="l03501"></a><span class="lineno"> 3501</span>&#160;{</div><div class="line"><a name="l03502"></a><span class="lineno"> 3502</span>&#160;   <a class="code" href="../../d2/ddc/test_8h.html#a79bc64a935b14b1b181156e5ada58ead">AST_TEST_UNREGISTER</a>(open_with_valid_options);</div><div class="line"><a name="l03503"></a><span class="lineno"> 3503</span>&#160;   <a class="code" href="../../d2/ddc/test_8h.html#a79bc64a935b14b1b181156e5ada58ead">AST_TEST_UNREGISTER</a>(open_with_invalid_options);</div><div class="line"><a name="l03504"></a><span class="lineno"> 3504</span>&#160;   <a class="code" href="../../d2/ddc/test_8h.html#a79bc64a935b14b1b181156e5ada58ead">AST_TEST_UNREGISTER</a>(create_and_retrieve);</div><div class="line"><a name="l03505"></a><span class="lineno"> 3505</span>&#160;   <a class="code" href="../../d2/ddc/test_8h.html#a79bc64a935b14b1b181156e5ada58ead">AST_TEST_UNREGISTER</a>(<a class="code" href="../../d0/d89/codec__g726_8c.html#a8c58a1d1fd9436ff5145385d3ef7a430">update</a>);</div><div class="line"><a name="l03506"></a><span class="lineno"> 3506</span>&#160;   <a class="code" href="../../d2/ddc/test_8h.html#a79bc64a935b14b1b181156e5ada58ead">AST_TEST_UNREGISTER</a>(<span class="keyword">delete</span>);</div><div class="line"><a name="l03507"></a><span class="lineno"> 3507</span>&#160;   <a class="code" href="../../d2/ddc/test_8h.html#a79bc64a935b14b1b181156e5ada58ead">AST_TEST_UNREGISTER</a>(<a class="code" href="../../d2/d6b/structsorcery__memory__cache.html#a73ce7cbebacf7170f054f846300d67ff">maximum_objects</a>);</div><div class="line"><a name="l03508"></a><span class="lineno"> 3508</span>&#160;   <a class="code" href="../../d2/ddc/test_8h.html#a79bc64a935b14b1b181156e5ada58ead">AST_TEST_UNREGISTER</a>(expiration);</div><div class="line"><a name="l03509"></a><span class="lineno"> 3509</span>&#160;   <a class="code" href="../../d2/ddc/test_8h.html#a79bc64a935b14b1b181156e5ada58ead">AST_TEST_UNREGISTER</a>(stale);</div><div class="line"><a name="l03510"></a><span class="lineno"> 3510</span>&#160;   <a class="code" href="../../d2/ddc/test_8h.html#a79bc64a935b14b1b181156e5ada58ead">AST_TEST_UNREGISTER</a>(full_backend_cache_expiration);</div><div class="line"><a name="l03511"></a><span class="lineno"> 3511</span>&#160;   <a class="code" href="../../d2/ddc/test_8h.html#a79bc64a935b14b1b181156e5ada58ead">AST_TEST_UNREGISTER</a>(full_backend_cache_stale);</div><div class="line"><a name="l03512"></a><span class="lineno"> 3512</span>&#160;</div><div class="line"><a name="l03513"></a><span class="lineno"> 3513</span>&#160;   <a class="code" href="../../df/d72/group__Group__AMI.html#gafadf012f66a9fd7ecf985ec5b9dee101">ast_manager_unregister</a>(<span class="stringliteral">&quot;SorceryMemoryCacheExpireObject&quot;</span>);</div><div class="line"><a name="l03514"></a><span class="lineno"> 3514</span>&#160;   <a class="code" href="../../df/d72/group__Group__AMI.html#gafadf012f66a9fd7ecf985ec5b9dee101">ast_manager_unregister</a>(<span class="stringliteral">&quot;SorceryMemoryCacheExpire&quot;</span>);</div><div class="line"><a name="l03515"></a><span class="lineno"> 3515</span>&#160;   <a class="code" href="../../df/d72/group__Group__AMI.html#gafadf012f66a9fd7ecf985ec5b9dee101">ast_manager_unregister</a>(<span class="stringliteral">&quot;SorceryMemoryCacheStaleObject&quot;</span>);</div><div class="line"><a name="l03516"></a><span class="lineno"> 3516</span>&#160;   <a class="code" href="../../df/d72/group__Group__AMI.html#gafadf012f66a9fd7ecf985ec5b9dee101">ast_manager_unregister</a>(<span class="stringliteral">&quot;SorceryMemoryCacheStale&quot;</span>);</div><div class="line"><a name="l03517"></a><span class="lineno"> 3517</span>&#160;   <a class="code" href="../../df/d72/group__Group__AMI.html#gafadf012f66a9fd7ecf985ec5b9dee101">ast_manager_unregister</a>(<span class="stringliteral">&quot;SorceryMemoryCachePopulate&quot;</span>);</div><div class="line"><a name="l03518"></a><span class="lineno"> 3518</span>&#160;</div><div class="line"><a name="l03519"></a><span class="lineno"> 3519</span>&#160;   <a class="code" href="../../dc/db0/cli_8h.html#a56b6b59ee2eaa994597a5b0f4e9f9d09">ast_cli_unregister_multiple</a>(cli_memory_cache, <a class="code" href="../../de/dfe/isdn__lib_8c.html#ab9129b977a587b50ea801daac75e178f">ARRAY_LEN</a>(cli_memory_cache));</div><div class="line"><a name="l03520"></a><span class="lineno"> 3520</span>&#160;</div><div class="line"><a name="l03521"></a><span class="lineno"> 3521</span>&#160;   <a class="code" href="../../d8/d25/sorcery_8h.html#a14ed6490f3390526922655ab5dbc344f">ast_sorcery_wizard_unregister</a>(&amp;memory_cache_object_wizard);</div><div class="line"><a name="l03522"></a><span class="lineno"> 3522</span>&#160;</div><div class="line"><a name="l03523"></a><span class="lineno"> 3523</span>&#160;   <span class="comment">/*</span></div><div class="line"><a name="l03524"></a><span class="lineno"> 3524</span>&#160;<span class="comment">    * XXX There is the potential to leak memory if there are pending</span></div><div class="line"><a name="l03525"></a><span class="lineno"> 3525</span>&#160;<span class="comment">    * next-cache-expiration and stale-cache-update tasks in the scheduler.</span></div><div class="line"><a name="l03526"></a><span class="lineno"> 3526</span>&#160;<span class="comment">    */</span></div><div class="line"><a name="l03527"></a><span class="lineno"> 3527</span>&#160;   <span class="keywordflow">if</span> (sched) {</div><div class="line"><a name="l03528"></a><span class="lineno"> 3528</span>&#160;      <a class="code" href="../../d7/d00/sched_8h.html#a862f869d056628b38e09042f21b54413">ast_sched_context_destroy</a>(sched);</div><div class="line"><a name="l03529"></a><span class="lineno"> 3529</span>&#160;      sched = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l03530"></a><span class="lineno"> 3530</span>&#160;   }</div><div class="line"><a name="l03531"></a><span class="lineno"> 3531</span>&#160;</div><div class="line"><a name="l03532"></a><span class="lineno"> 3532</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#a6321ee982370c55ab3c24c72c562cbdd">ao2_cleanup</a>(caches);</div><div class="line"><a name="l03533"></a><span class="lineno"> 3533</span>&#160;   caches = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l03534"></a><span class="lineno"> 3534</span>&#160;</div><div class="line"><a name="l03535"></a><span class="lineno"> 3535</span>&#160;   <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l03536"></a><span class="lineno"> 3536</span>&#160;}</div><div class="line"><a name="l03537"></a><span class="lineno"> 3537</span>&#160;</div><div class="line"><a name="l03538"></a><span class="lineno"><a class="line" href="../../d7/d30/res__sorcery__memory__cache_8c.html#ac3382bf6da54c56b37069bd76bbdf4f9"> 3538</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d7/d30/res__sorcery__memory__cache_8c.html#ac3382bf6da54c56b37069bd76bbdf4f9">load_module</a>(<span class="keywordtype">void</span>)</div><div class="line"><a name="l03539"></a><span class="lineno"> 3539</span>&#160;{</div><div class="line"><a name="l03540"></a><span class="lineno"> 3540</span>&#160;   <span class="keywordtype">int</span> res;</div><div class="line"><a name="l03541"></a><span class="lineno"> 3541</span>&#160;</div><div class="line"><a name="l03542"></a><span class="lineno"> 3542</span>&#160;   caches = <a class="code" href="../../d5/da5/astobj2_8h.html#aefc16f8aa9087cbc5c55c70cf1dd41b2">ao2_container_alloc_hash</a>(<a class="code" href="../../d5/da5/astobj2_8h.html#a2cf7e3433f08351aafe3b0cd31edf7f8a8ccf751bd6749d062999469f0694e7ad">AO2_ALLOC_OPT_LOCK_MUTEX</a>, 0,</div><div class="line"><a name="l03543"></a><span class="lineno"> 3543</span>&#160;      <a class="code" href="../../d7/d30/res__sorcery__memory__cache_8c.html#a308b0239d5b6189ab1fd75e101a82326">CACHES_CONTAINER_BUCKET_SIZE</a>, <a class="code" href="../../d7/d30/res__sorcery__memory__cache_8c.html#a73ad8004e57b45af60c0303ded1e6862">sorcery_memory_cache_hash</a>, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>,</div><div class="line"><a name="l03544"></a><span class="lineno"> 3544</span>&#160;      <a class="code" href="../../d7/d30/res__sorcery__memory__cache_8c.html#a6ef09b2208df722b2abff81c398c8e46">sorcery_memory_cache_cmp</a>);</div><div class="line"><a name="l03545"></a><span class="lineno"> 3545</span>&#160;   <span class="keywordflow">if</span> (!caches) {</div><div class="line"><a name="l03546"></a><span class="lineno"> 3546</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Failed to create container for configured caches\n&quot;</span>);</div><div class="line"><a name="l03547"></a><span class="lineno"> 3547</span>&#160;      <a class="code" href="../../d7/d30/res__sorcery__memory__cache_8c.html#ad09fa931f468002152a3cc2d5ce25eae">unload_module</a>();</div><div class="line"><a name="l03548"></a><span class="lineno"> 3548</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../d5/d16/module_8h.html#adc09474f0ff557e9925b722ee5b952dfac742921e9f9512d28f62c74ea2affe57">AST_MODULE_LOAD_DECLINE</a>;</div><div class="line"><a name="l03549"></a><span class="lineno"> 3549</span>&#160;   }</div><div class="line"><a name="l03550"></a><span class="lineno"> 3550</span>&#160;</div><div class="line"><a name="l03551"></a><span class="lineno"> 3551</span>&#160;   sched = <a class="code" href="../../d7/d00/sched_8h.html#a5baecc149aeabdbef9b3ed6780c1c4a6">ast_sched_context_create</a>();</div><div class="line"><a name="l03552"></a><span class="lineno"> 3552</span>&#160;   <span class="keywordflow">if</span> (!sched) {</div><div class="line"><a name="l03553"></a><span class="lineno"> 3553</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Failed to create scheduler for cache management\n&quot;</span>);</div><div class="line"><a name="l03554"></a><span class="lineno"> 3554</span>&#160;      <a class="code" href="../../d7/d30/res__sorcery__memory__cache_8c.html#ad09fa931f468002152a3cc2d5ce25eae">unload_module</a>();</div><div class="line"><a name="l03555"></a><span class="lineno"> 3555</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../d5/d16/module_8h.html#adc09474f0ff557e9925b722ee5b952dfac742921e9f9512d28f62c74ea2affe57">AST_MODULE_LOAD_DECLINE</a>;</div><div class="line"><a name="l03556"></a><span class="lineno"> 3556</span>&#160;   }</div><div class="line"><a name="l03557"></a><span class="lineno"> 3557</span>&#160;</div><div class="line"><a name="l03558"></a><span class="lineno"> 3558</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d7/d00/sched_8h.html#a8ae97d1549b62cfbfc78bd92efe48005">ast_sched_start_thread</a>(sched)) {</div><div class="line"><a name="l03559"></a><span class="lineno"> 3559</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Failed to create scheduler thread for cache management\n&quot;</span>);</div><div class="line"><a name="l03560"></a><span class="lineno"> 3560</span>&#160;      <a class="code" href="../../d7/d30/res__sorcery__memory__cache_8c.html#ad09fa931f468002152a3cc2d5ce25eae">unload_module</a>();</div><div class="line"><a name="l03561"></a><span class="lineno"> 3561</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../d5/d16/module_8h.html#adc09474f0ff557e9925b722ee5b952dfac742921e9f9512d28f62c74ea2affe57">AST_MODULE_LOAD_DECLINE</a>;</div><div class="line"><a name="l03562"></a><span class="lineno"> 3562</span>&#160;   }</div><div class="line"><a name="l03563"></a><span class="lineno"> 3563</span>&#160;</div><div class="line"><a name="l03564"></a><span class="lineno"> 3564</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d8/d25/sorcery_8h.html#aa2b2d9798c21334810a480fdc3260bb8">ast_sorcery_wizard_register</a>(&amp;memory_cache_object_wizard)) {</div><div class="line"><a name="l03565"></a><span class="lineno"> 3565</span>&#160;      <a class="code" href="../../d7/d30/res__sorcery__memory__cache_8c.html#ad09fa931f468002152a3cc2d5ce25eae">unload_module</a>();</div><div class="line"><a name="l03566"></a><span class="lineno"> 3566</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../d5/d16/module_8h.html#adc09474f0ff557e9925b722ee5b952dfac742921e9f9512d28f62c74ea2affe57">AST_MODULE_LOAD_DECLINE</a>;</div><div class="line"><a name="l03567"></a><span class="lineno"> 3567</span>&#160;   }</div><div class="line"><a name="l03568"></a><span class="lineno"> 3568</span>&#160;</div><div class="line"><a name="l03569"></a><span class="lineno"> 3569</span>&#160;   res = <a class="code" href="../../dc/db0/cli_8h.html#aea8910ed9e301e7f741f87942c244eac">ast_cli_register_multiple</a>(cli_memory_cache, <a class="code" href="../../de/dfe/isdn__lib_8c.html#ab9129b977a587b50ea801daac75e178f">ARRAY_LEN</a>(cli_memory_cache));</div><div class="line"><a name="l03570"></a><span class="lineno"> 3570</span>&#160;   res |= <a class="code" href="../../db/d45/manager_8h.html#a5b63b8a8faede2d852e071e1f7b31c11">ast_manager_register_xml</a>(<span class="stringliteral">&quot;SorceryMemoryCacheExpireObject&quot;</span>, <a class="code" href="../../db/d45/manager_8h.html#a420f0f755e1c3378b45ca7f6f0669ffa">EVENT_FLAG_SYSTEM</a>, <a class="code" href="../../d7/d30/res__sorcery__memory__cache_8c.html#aee7c26d9d56d476f4a268f293be7fbda">sorcery_memory_cache_ami_expire_object</a>);</div><div class="line"><a name="l03571"></a><span class="lineno"> 3571</span>&#160;   res |= <a class="code" href="../../db/d45/manager_8h.html#a5b63b8a8faede2d852e071e1f7b31c11">ast_manager_register_xml</a>(<span class="stringliteral">&quot;SorceryMemoryCacheExpire&quot;</span>, <a class="code" href="../../db/d45/manager_8h.html#a420f0f755e1c3378b45ca7f6f0669ffa">EVENT_FLAG_SYSTEM</a>, <a class="code" href="../../d7/d30/res__sorcery__memory__cache_8c.html#a761d1c9efa33774cc89405895ed848a1">sorcery_memory_cache_ami_expire</a>);</div><div class="line"><a name="l03572"></a><span class="lineno"> 3572</span>&#160;   res |= <a class="code" href="../../db/d45/manager_8h.html#a5b63b8a8faede2d852e071e1f7b31c11">ast_manager_register_xml</a>(<span class="stringliteral">&quot;SorceryMemoryCacheStaleObject&quot;</span>, <a class="code" href="../../db/d45/manager_8h.html#a420f0f755e1c3378b45ca7f6f0669ffa">EVENT_FLAG_SYSTEM</a>, <a class="code" href="../../d7/d30/res__sorcery__memory__cache_8c.html#a0a8302d60836f9207cb2b3ea36948023">sorcery_memory_cache_ami_stale_object</a>);</div><div class="line"><a name="l03573"></a><span class="lineno"> 3573</span>&#160;   res |= <a class="code" href="../../db/d45/manager_8h.html#a5b63b8a8faede2d852e071e1f7b31c11">ast_manager_register_xml</a>(<span class="stringliteral">&quot;SorceryMemoryCacheStale&quot;</span>, <a class="code" href="../../db/d45/manager_8h.html#a420f0f755e1c3378b45ca7f6f0669ffa">EVENT_FLAG_SYSTEM</a>, <a class="code" href="../../d7/d30/res__sorcery__memory__cache_8c.html#a4161fc89535e551cb44e80ea3b51dadb">sorcery_memory_cache_ami_stale</a>);</div><div class="line"><a name="l03574"></a><span class="lineno"> 3574</span>&#160;   res |= <a class="code" href="../../db/d45/manager_8h.html#a5b63b8a8faede2d852e071e1f7b31c11">ast_manager_register_xml</a>(<span class="stringliteral">&quot;SorceryMemoryCachePopulate&quot;</span>, <a class="code" href="../../db/d45/manager_8h.html#a420f0f755e1c3378b45ca7f6f0669ffa">EVENT_FLAG_SYSTEM</a>, <a class="code" href="../../d7/d30/res__sorcery__memory__cache_8c.html#aa7e1302041b154a0df319fb0abbd6447">sorcery_memory_cache_ami_populate</a>);</div><div class="line"><a name="l03575"></a><span class="lineno"> 3575</span>&#160;</div><div class="line"><a name="l03576"></a><span class="lineno"> 3576</span>&#160;   <span class="keywordflow">if</span> (res) {</div><div class="line"><a name="l03577"></a><span class="lineno"> 3577</span>&#160;      <a class="code" href="../../d7/d30/res__sorcery__memory__cache_8c.html#ad09fa931f468002152a3cc2d5ce25eae">unload_module</a>();</div><div class="line"><a name="l03578"></a><span class="lineno"> 3578</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../d5/d16/module_8h.html#adc09474f0ff557e9925b722ee5b952dfac742921e9f9512d28f62c74ea2affe57">AST_MODULE_LOAD_DECLINE</a>;</div><div class="line"><a name="l03579"></a><span class="lineno"> 3579</span>&#160;   }</div><div class="line"><a name="l03580"></a><span class="lineno"> 3580</span>&#160;</div><div class="line"><a name="l03581"></a><span class="lineno"> 3581</span>&#160;   <span class="comment">/* This causes the stale unit test to execute last, so if a sorcery instance persists</span></div><div class="line"><a name="l03582"></a><span class="lineno"> 3582</span>&#160;<span class="comment">    * longer than expected subsequent unit tests don&#39;t fail when setting it up.</span></div><div class="line"><a name="l03583"></a><span class="lineno"> 3583</span>&#160;<span class="comment">    */</span></div><div class="line"><a name="l03584"></a><span class="lineno"> 3584</span>&#160;   <a class="code" href="../../d2/ddc/test_8h.html#a34f64a69c09d98ceb693b077efd7ef97">AST_TEST_REGISTER</a>(stale);</div><div class="line"><a name="l03585"></a><span class="lineno"> 3585</span>&#160;   <a class="code" href="../../d2/ddc/test_8h.html#a34f64a69c09d98ceb693b077efd7ef97">AST_TEST_REGISTER</a>(open_with_valid_options);</div><div class="line"><a name="l03586"></a><span class="lineno"> 3586</span>&#160;   <a class="code" href="../../d2/ddc/test_8h.html#a34f64a69c09d98ceb693b077efd7ef97">AST_TEST_REGISTER</a>(open_with_invalid_options);</div><div class="line"><a name="l03587"></a><span class="lineno"> 3587</span>&#160;   <a class="code" href="../../d2/ddc/test_8h.html#a34f64a69c09d98ceb693b077efd7ef97">AST_TEST_REGISTER</a>(create_and_retrieve);</div><div class="line"><a name="l03588"></a><span class="lineno"> 3588</span>&#160;   <a class="code" href="../../d2/ddc/test_8h.html#a34f64a69c09d98ceb693b077efd7ef97">AST_TEST_REGISTER</a>(<a class="code" href="../../d0/d89/codec__g726_8c.html#a8c58a1d1fd9436ff5145385d3ef7a430">update</a>);</div><div class="line"><a name="l03589"></a><span class="lineno"> 3589</span>&#160;   <a class="code" href="../../d2/ddc/test_8h.html#a34f64a69c09d98ceb693b077efd7ef97">AST_TEST_REGISTER</a>(<span class="keyword">delete</span>);</div><div class="line"><a name="l03590"></a><span class="lineno"> 3590</span>&#160;   <a class="code" href="../../d2/ddc/test_8h.html#a34f64a69c09d98ceb693b077efd7ef97">AST_TEST_REGISTER</a>(<a class="code" href="../../d2/d6b/structsorcery__memory__cache.html#a73ce7cbebacf7170f054f846300d67ff">maximum_objects</a>);</div><div class="line"><a name="l03591"></a><span class="lineno"> 3591</span>&#160;   <a class="code" href="../../d2/ddc/test_8h.html#a34f64a69c09d98ceb693b077efd7ef97">AST_TEST_REGISTER</a>(expiration);</div><div class="line"><a name="l03592"></a><span class="lineno"> 3592</span>&#160;   <a class="code" href="../../d2/ddc/test_8h.html#a34f64a69c09d98ceb693b077efd7ef97">AST_TEST_REGISTER</a>(full_backend_cache_expiration);</div><div class="line"><a name="l03593"></a><span class="lineno"> 3593</span>&#160;   <a class="code" href="../../d2/ddc/test_8h.html#a34f64a69c09d98ceb693b077efd7ef97">AST_TEST_REGISTER</a>(full_backend_cache_stale);</div><div class="line"><a name="l03594"></a><span class="lineno"> 3594</span>&#160;</div><div class="line"><a name="l03595"></a><span class="lineno"> 3595</span>&#160;   <span class="keywordflow">return</span> <a class="code" href="../../d5/d16/module_8h.html#adc09474f0ff557e9925b722ee5b952dfa89bb877ade9ce418ad6663f3d936f314">AST_MODULE_LOAD_SUCCESS</a>;</div><div class="line"><a name="l03596"></a><span class="lineno"> 3596</span>&#160;}</div><div class="line"><a name="l03597"></a><span class="lineno"> 3597</span>&#160;</div><div class="line"><a name="l03598"></a><span class="lineno"> 3598</span>&#160;<a class="code" href="../../d9/de9/res__phoneprov_8c.html#addaa208b0ed785225e24490fb9f28a80">AST_MODULE_INFO</a>(<a class="code" href="../../d5/d16/module_8h.html#aba2c8d4be709a254658b21a834f8294a">ASTERISK_GPL_KEY</a>, <a class="code" href="../../d5/d16/module_8h.html#a155a0df9c59e04e305d4a2fa3e35f843a835b27a90d895a488e4e14cc3d2dee8c">AST_MODFLAG_GLOBAL_SYMBOLS</a> | <a class="code" href="../../d5/d16/module_8h.html#a155a0df9c59e04e305d4a2fa3e35f843a12c3f60dd7655dfa8d4430cbf04b1223">AST_MODFLAG_LOAD_ORDER</a>, <span class="stringliteral">&quot;Sorcery Memory Cache Object Wizard&quot;</span>,</div><div class="line"><a name="l03599"></a><span class="lineno"> 3599</span>&#160;   .support_level = <a class="code" href="../../d5/d16/module_8h.html#ab35bc4efd9f79706300965c9d36a0ce5a634484c0074e7b6b630756fab09e2c15">AST_MODULE_SUPPORT_CORE</a>,</div><div class="line"><a name="l03600"></a><span class="lineno"> 3600</span>&#160;   .load = <a class="code" href="../../d7/d30/res__sorcery__memory__cache_8c.html#ac3382bf6da54c56b37069bd76bbdf4f9">load_module</a>,</div><div class="line"><a name="l03601"></a><span class="lineno"> 3601</span>&#160;   .unload = <a class="code" href="../../d7/d30/res__sorcery__memory__cache_8c.html#ad09fa931f468002152a3cc2d5ce25eae">unload_module</a>,</div><div class="line"><a name="l03602"></a><span class="lineno"> 3602</span>&#160;   .load_pri = <a class="code" href="../../d5/d16/module_8h.html#aa4f734041ffd9d75b07cefb0291e1e58a8201de64237a41919013d62ae5d6721d">AST_MODPRI_REALTIME_DRIVER</a>,</div><div class="line"><a name="l03603"></a><span class="lineno"><a class="line" href="../../d7/d30/res__sorcery__memory__cache_8c.html#a4fb0aca9bbcdb9709fa52a70aded6cae"> 3603</a></span>&#160;);</div><div class="ttc" id="res__sorcery__memory__cache_8c_html_ac9cca89523a693cbff7bb7c8f1122e11"><div class="ttname"><a href="../../d7/d30/res__sorcery__memory__cache_8c.html#ac9cca89523a693cbff7bb7c8f1122e11">schedule_cache_expiration</a></div><div class="ttdeci">static int schedule_cache_expiration(struct sorcery_memory_cache *cache)</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d30/res__sorcery__memory__cache_8c_source.html#l00648">res_sorcery_memory_cache.c:648</a></div></div>
<div class="ttc" id="sched_8h_html_a8ae97d1549b62cfbfc78bd92efe48005"><div class="ttname"><a href="../../d7/d00/sched_8h.html#a8ae97d1549b62cfbfc78bd92efe48005">ast_sched_start_thread</a></div><div class="ttdeci">int ast_sched_start_thread(struct ast_sched_context *con)</div><div class="ttdoc">Start a thread for processing scheduler entries. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/dbe/sched_8c_source.html#l00195">sched.c:195</a></div></div>
<div class="ttc" id="structbackend__data_html_aa1620f4c22693d406d9d5e3bd585695f"><div class="ttname"><a href="../../d2/d13/structbackend__data.html#aa1620f4c22693d406d9d5e3bd585695f">backend_data::pepper</a></div><div class="ttdeci">int pepper</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d30/res__sorcery__memory__cache_8c_source.html#l02978">res_sorcery_memory_cache.c:2978</a></div></div>
<div class="ttc" id="threadstorage_8h_html_ac268c0a8272ec11e73269392507fb1a6"><div class="ttname"><a href="../../dc/d7d/threadstorage_8h.html#ac268c0a8272ec11e73269392507fb1a6">AST_THREADSTORAGE</a></div><div class="ttdeci">#define AST_THREADSTORAGE(name)</div><div class="ttdoc">Define a thread storage variable. </div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d7d/threadstorage_8h_source.html#l00084">threadstorage.h:84</a></div></div>
<div class="ttc" id="chan__ooh323_8c_html_a4d63fdfe5451ec2248c16a2739190c56"><div class="ttname"><a href="../../d7/d49/chan__ooh323_8c.html#a4d63fdfe5451ec2248c16a2739190c56">type</a></div><div class="ttdeci">static const char type[]</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d49/chan__ooh323_8c_source.html#l00109">chan_ooh323.c:109</a></div></div>
<div class="ttc" id="res__sorcery__memory__cache_8c_html_a04243beb9f66b626e37e214f10746efd"><div class="ttname"><a href="../../d7/d30/res__sorcery__memory__cache_8c.html#a04243beb9f66b626e37e214f10746efd">object_stale_callback</a></div><div class="ttdeci">static int object_stale_callback(void *obj, void *arg, int flags)</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d30/res__sorcery__memory__cache_8c_source.html#l00577">res_sorcery_memory_cache.c:577</a></div></div>
<div class="ttc" id="res__sorcery__memory__cache_8c_html_a0e33561fb1fc08c9366a5a83eb83583e"><div class="ttname"><a href="../../d7/d30/res__sorcery__memory__cache_8c.html#a0e33561fb1fc08c9366a5a83eb83583e">sorcery_memory_cache_retrieve_id</a></div><div class="ttdeci">static void * sorcery_memory_cache_retrieve_id(const struct ast_sorcery *sorcery, void *data, const char *type, const char *id)</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d30/res__sorcery__memory__cache_8c_source.html#l01219">res_sorcery_memory_cache.c:1219</a></div></div>
<div class="ttc" id="res__sorcery__memory__cache_8c_html_a8be072ec91ebdbdbb1153b0a5b03a452"><div class="ttname"><a href="../../d7/d30/res__sorcery__memory__cache_8c.html#a8be072ec91ebdbdbb1153b0a5b03a452">sorcery_memory_cache_delete</a></div><div class="ttdeci">static int sorcery_memory_cache_delete(const struct ast_sorcery *sorcery, void *data, void *object)</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d30/res__sorcery__memory__cache_8c_source.html#l01598">res_sorcery_memory_cache.c:1598</a></div></div>
<div class="ttc" id="res__sorcery__memory__cache_8c_html_a940b3f80c54615cf9a05eec2f99fdf96"><div class="ttname"><a href="../../d7/d30/res__sorcery__memory__cache_8c.html#a940b3f80c54615cf9a05eec2f99fdf96">CACHE_CONTAINER_BUCKET_SIZE</a></div><div class="ttdeci">#define CACHE_CONTAINER_BUCKET_SIZE</div><div class="ttdoc">The default bucket size for the container of objects in the cache. </div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d30/res__sorcery__memory__cache_8c_source.html#l00235">res_sorcery_memory_cache.c:235</a></div></div>
<div class="ttc" id="structsorcery__memory__cache__fields__cmp__params_html_aed2d94a6fe15ec228d25838ea61f6a94"><div class="ttname"><a href="../../d7/d59/structsorcery__memory__cache__fields__cmp__params.html#aed2d94a6fe15ec228d25838ea61f6a94">sorcery_memory_cache_fields_cmp_params::fields</a></div><div class="ttdeci">const struct ast_variable * fields</div><div class="ttdoc">Pointer to the fields to check. </div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d30/res__sorcery__memory__cache_8c_source.html#l00187">res_sorcery_memory_cache.c:187</a></div></div>
<div class="ttc" id="res__sorcery__memory__cache_8c_html_a9e6ba05ab24228b88fabe3520c2055e9"><div class="ttname"><a href="../../d7/d30/res__sorcery__memory__cache_8c.html#a9e6ba05ab24228b88fabe3520c2055e9">sorcery_memory_cached_object_hash</a></div><div class="ttdeci">static int sorcery_memory_cached_object_hash(const void *obj, int flags)</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d30/res__sorcery__memory__cache_8c_source.html#l00360">res_sorcery_memory_cache.c:360</a></div></div>
<div class="ttc" id="cli_8h_html_a5c4130cf8f1e93acfdd84416cebf1aef"><div class="ttname"><a href="../../dc/db0/cli_8h.html#a5c4130cf8f1e93acfdd84416cebf1aef">AST_CLI_DEFINE</a></div><div class="ttdeci">#define AST_CLI_DEFINE(fn, txt,...)</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/db0/cli_8h_source.html#l00197">cli.h:197</a></div></div>
<div class="ttc" id="res__sorcery__memory__cache_8c_html_a8f1f8589c9e03dcae4a7c2eb435be59c"><div class="ttname"><a href="../../d7/d30/res__sorcery__memory__cache_8c.html#a8f1f8589c9e03dcae4a7c2eb435be59c">is_passthru_update</a></div><div class="ttdeci">static int is_passthru_update(void)</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d30/res__sorcery__memory__cache_8c_source.html#l00249">res_sorcery_memory_cache.c:249</a></div></div>
<div class="ttc" id="structmessage_html"><div class="ttname"><a href="../../d8/d9e/structmessage.html">message</a></div><div class="ttdef"><b>Definition:</b> <a href="../../db/d45/manager_8h_source.html#l00144">manager.h:144</a></div></div>
<div class="ttc" id="sorcery_8h_html_a126f854c093cec80dd9e89b26db9b016"><div class="ttname"><a href="../../d8/d25/sorcery_8h.html#a126f854c093cec80dd9e89b26db9b016">ast_sorcery_object_field_register_nodoc</a></div><div class="ttdeci">#define ast_sorcery_object_field_register_nodoc(sorcery, type, name, default_val, opt_type, flags,...)</div><div class="ttdoc">Register a field within an object without documentation. </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d25/sorcery_8h_source.html#l00987">sorcery.h:987</a></div></div>
<div class="ttc" id="structsorcery__memory__cache_html_a73ce7cbebacf7170f054f846300d67ff"><div class="ttname"><a href="../../d2/d6b/structsorcery__memory__cache.html#a73ce7cbebacf7170f054f846300d67ff">sorcery_memory_cache::maximum_objects</a></div><div class="ttdeci">unsigned int maximum_objects</div><div class="ttdoc">The maximum number of objects permitted in the cache, 0 if no limit. </div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d30/res__sorcery__memory__cache_8c_source.html#l00133">res_sorcery_memory_cache.c:133</a></div></div>
<div class="ttc" id="asterisk_8h_html"><div class="ttname"><a href="../../db/db2/asterisk_8h.html">asterisk.h</a></div><div class="ttdoc">Asterisk main include file. File version handling, generic pbx functions. </div></div>
<div class="ttc" id="structtest__sorcery__object_html"><div class="ttname"><a href="../../db/d6c/structtest__sorcery__object.html">test_sorcery_object</a></div><div class="ttdoc">Dummy sorcery object. </div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d30/res__sorcery__memory__cache_8c_source.html#l02275">res_sorcery_memory_cache.c:2275</a></div></div>
<div class="ttc" id="astobj2_8h_html_a512cc40ce96c63b3d5c78040baa4c9cd"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#a512cc40ce96c63b3d5c78040baa4c9cd">ao2_container_count</a></div><div class="ttdeci">int ao2_container_count(struct ao2_container *c)</div><div class="ttdoc">Returns the number of elements in a container. </div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d22/astobj2__container_8c_source.html#l00034">astobj2_container.c:34</a></div></div>
<div class="ttc" id="isdn__lib_8c_html_ab9129b977a587b50ea801daac75e178f"><div class="ttname"><a href="../../de/dfe/isdn__lib_8c.html#ab9129b977a587b50ea801daac75e178f">ARRAY_LEN</a></div><div class="ttdeci">#define ARRAY_LEN(a)</div><div class="ttdef"><b>Definition:</b> <a href="../../de/dfe/isdn__lib_8c_source.html#l00042">isdn_lib.c:42</a></div></div>
<div class="ttc" id="res__sorcery__memory__cache_8c_html_a9114eb0a0bb526616f3ca82bec5e324d"><div class="ttname"><a href="../../d7/d30/res__sorcery__memory__cache_8c.html#a9114eb0a0bb526616f3ca82bec5e324d">stale_cache_update_task_data_alloc</a></div><div class="ttdeci">static struct stale_cache_update_task_data * stale_cache_update_task_data_alloc(struct ast_sorcery *sorcery, struct sorcery_memory_cache *cache, const char *type)</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d30/res__sorcery__memory__cache_8c_source.html#l00886">res_sorcery_memory_cache.c:886</a></div></div>
<div class="ttc" id="astobj2_8h_html_a2cf7e3433f08351aafe3b0cd31edf7f8a23b60f2636bcfbc4dfeea6cc21bf847b"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#a2cf7e3433f08351aafe3b0cd31edf7f8a23b60f2636bcfbc4dfeea6cc21bf847b">AO2_ALLOC_OPT_LOCK_NOLOCK</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l00369">astobj2.h:369</a></div></div>
<div class="ttc" id="threadstorage_8h_html_ab6ff44d2acf6ea45090177cd3141da03"><div class="ttname"><a href="../../dc/d7d/threadstorage_8h.html#ab6ff44d2acf6ea45090177cd3141da03">ast_threadstorage_get</a></div><div class="ttdeci">void * ast_threadstorage_get(struct ast_threadstorage *ts, size_t init_size)</div><div class="ttdoc">Retrieve thread storage. </div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d7d/threadstorage_8h_source.html#l00197">threadstorage.h:197</a></div></div>
<div class="ttc" id="module_8h_html_adc09474f0ff557e9925b722ee5b952dfa89bb877ade9ce418ad6663f3d936f314"><div class="ttname"><a href="../../d5/d16/module_8h.html#adc09474f0ff557e9925b722ee5b952dfa89bb877ade9ce418ad6663f3d936f314">AST_MODULE_LOAD_SUCCESS</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d16/module_8h_source.html#l00070">module.h:70</a></div></div>
<div class="ttc" id="res__sorcery__memory__cache_8c_html_aee7c26d9d56d476f4a268f293be7fbda"><div class="ttname"><a href="../../d7/d30/res__sorcery__memory__cache_8c.html#aee7c26d9d56d476f4a268f293be7fbda">sorcery_memory_cache_ami_expire_object</a></div><div class="ttdeci">static int sorcery_memory_cache_ami_expire_object(struct mansession *s, const struct message *m)</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d30/res__sorcery__memory__cache_8c_source.html#l02069">res_sorcery_memory_cache.c:2069</a></div></div>
<div class="ttc" id="module_8h_html_ab35bc4efd9f79706300965c9d36a0ce5a634484c0074e7b6b630756fab09e2c15"><div class="ttname"><a href="../../d5/d16/module_8h.html#ab35bc4efd9f79706300965c9d36a0ce5a634484c0074e7b6b630756fab09e2c15">AST_MODULE_SUPPORT_CORE</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d16/module_8h_source.html#l00121">module.h:121</a></div></div>
<div class="ttc" id="res__sorcery__memory__cache_8c_html_a7b6e5c518260e60c41a9eda9f7078a07"><div class="ttname"><a href="../../d7/d30/res__sorcery__memory__cache_8c.html#a7b6e5c518260e60c41a9eda9f7078a07">start_passthru_update</a></div><div class="ttdeci">static void start_passthru_update(void)</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d30/res__sorcery__memory__cache_8c_source.html#l00276">res_sorcery_memory_cache.c:276</a></div></div>
<div class="ttc" id="uuid_8h_html_a127408e53d34dca0c589a099fabf1e13"><div class="ttname"><a href="../../dd/d1d/uuid_8h.html#a127408e53d34dca0c589a099fabf1e13">AST_UUID_STR_LEN</a></div><div class="ttdeci">#define AST_UUID_STR_LEN</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d1d/uuid_8h_source.html#l00027">uuid.h:27</a></div></div>
<div class="ttc" id="structstale__update__task__data_html_a077376d12464f945e2414d5499c79b3f"><div class="ttname"><a href="../../da/d04/structstale__update__task__data.html#a077376d12464f945e2414d5499c79b3f">stale_update_task_data::object</a></div><div class="ttdeci">void * object</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d30/res__sorcery__memory__cache_8c_source.html#l00959">res_sorcery_memory_cache.c:959</a></div></div>
<div class="ttc" id="include_2asterisk_2config_8h_html_adea5390496e5477192d86f340d512d04"><div class="ttname"><a href="../../d3/de6/include_2asterisk_2config_8h.html#adea5390496e5477192d86f340d512d04">ast_variables_destroy</a></div><div class="ttdeci">void ast_variables_destroy(struct ast_variable *var)</div><div class="ttdoc">Free variable list. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/dc5/extconf_8c_source.html#l01263">extconf.c:1263</a></div></div>
<div class="ttc" id="sorcery_8h_html_a02d1aa896acd254e31664df39e3086c9"><div class="ttname"><a href="../../d8/d25/sorcery_8h.html#a02d1aa896acd254e31664df39e3086c9">ast_sorcery_apply_wizard_mapping</a></div><div class="ttdeci">#define ast_sorcery_apply_wizard_mapping(sorcery, type, name, data, caching)</div><div class="ttdoc">Apply additional object wizard mappings. </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d25/sorcery_8h_source.html#l00511">sorcery.h:511</a></div></div>
<div class="ttc" id="res__sorcery__memory__cache_8c_html_a71fbafef4114d205d0efb067d84f47f1"><div class="ttname"><a href="../../d7/d30/res__sorcery__memory__cache_8c.html#a71fbafef4114d205d0efb067d84f47f1">sorcery_memory_cache_load</a></div><div class="ttdeci">static void sorcery_memory_cache_load(void *data, const struct ast_sorcery *sorcery, const char *type)</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d30/res__sorcery__memory__cache_8c_source.html#l01436">res_sorcery_memory_cache.c:1436</a></div></div>
<div class="ttc" id="res__sorcery__memory__cache_8c_html_a42a82fa90ac4b7493edfdbffc6c0fac8"><div class="ttname"><a href="../../d7/d30/res__sorcery__memory__cache_8c.html#a42a82fa90ac4b7493edfdbffc6c0fac8">sorcery_memory_cache_dump</a></div><div class="ttdeci">static char * sorcery_memory_cache_dump(struct ast_cli_entry *e, int cmd, struct ast_cli_args *a)</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d30/res__sorcery__memory__cache_8c_source.html#l01768">res_sorcery_memory_cache.c:1768</a></div></div>
<div class="ttc" id="cli_8h_html_a56b6b59ee2eaa994597a5b0f4e9f9d09"><div class="ttname"><a href="../../dc/db0/cli_8h.html#a56b6b59ee2eaa994597a5b0f4e9f9d09">ast_cli_unregister_multiple</a></div><div class="ttdeci">int ast_cli_unregister_multiple(struct ast_cli_entry *e, int len)</div><div class="ttdoc">Unregister multiple commands. </div><div class="ttdef"><b>Definition:</b> <a href="../../da/d4d/clicompat_8c_source.html#l00030">clicompat.c:30</a></div></div>
<div class="ttc" id="astobj2_8h_html_ad9d009e87e737af900825b36db55a35caa13a6e0771cc457e86f425d95c3b8d54"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#ad9d009e87e737af900825b36db55a35caa13a6e0771cc457e86f425d95c3b8d54">OBJ_SEARCH_KEY</a></div><div class="ttdoc">The arg parameter is a search key, but is not an object. </div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l01105">astobj2.h:1105</a></div></div>
<div class="ttc" id="res__sorcery__memory__cache_8c_html_abba21810d1ea3b864abcc57c12eba397"><div class="ttname"><a href="../../d7/d30/res__sorcery__memory__cache_8c.html#abba21810d1ea3b864abcc57c12eba397">stale_cache_update</a></div><div class="ttdeci">static int stale_cache_update(const void *data)</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d30/res__sorcery__memory__cache_8c_source.html#l00908">res_sorcery_memory_cache.c:908</a></div></div>
<div class="ttc" id="func__logic_8c_html_ad6f8d00a94914824d3b6048722c42332"><div class="ttname"><a href="../../da/dd2/func__logic_8c.html#ad6f8d00a94914824d3b6048722c42332">exists</a></div><div class="ttdeci">static int exists(struct ast_channel *chan, const char *cmd, char *data, char *buf, size_t len)</div><div class="ttdef"><b>Definition:</b> <a href="../../da/dd2/func__logic_8c_source.html#l00124">func_logic.c:124</a></div></div>
<div class="ttc" id="codec__g726_8c_html_a8c58a1d1fd9436ff5145385d3ef7a430"><div class="ttname"><a href="../../d0/d89/codec__g726_8c.html#a8c58a1d1fd9436ff5145385d3ef7a430">update</a></div><div class="ttdeci">static void update(int code_size, int y, int wi, int fi, int dq, int sr, int dqsez, struct g726_state *state_ptr)</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d89/codec__g726_8c_source.html#l00367">codec_g726.c:367</a></div></div>
<div class="ttc" id="structsorcery__memory__cached__object_html_a3b444e1155e0c3811c338083c63e5f8a"><div class="ttname"><a href="../../df/d93/structsorcery__memory__cached__object.html#a3b444e1155e0c3811c338083c63e5f8a">sorcery_memory_cached_object::__heap_index</a></div><div class="ttdeci">ssize_t __heap_index</div><div class="ttdoc">index required by heap </div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d30/res__sorcery__memory__cache_8c_source.html#l00173">res_sorcery_memory_cache.c:173</a></div></div>
<div class="ttc" id="astobj2_8h_html_ad9d009e87e737af900825b36db55a35ca5fc59b193d86a0a8ddfe866304be829d"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#ad9d009e87e737af900825b36db55a35ca5fc59b193d86a0a8ddfe866304be829d">OBJ_NODATA</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l01048">astobj2.h:1048</a></div></div>
<div class="ttc" id="res__sorcery__memory__cache_8c_html_acf5c4d16aab69f65543750c6f069fac4"><div class="ttname"><a href="../../d7/d30/res__sorcery__memory__cache_8c.html#acf5c4d16aab69f65543750c6f069fac4">sorcery_memory_cache_retrieve_multiple</a></div><div class="ttdeci">static void sorcery_memory_cache_retrieve_multiple(const struct ast_sorcery *sorcery, void *data, const char *type, struct ao2_container *objects, const struct ast_variable *fields)</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d30/res__sorcery__memory__cache_8c_source.html#l01336">res_sorcery_memory_cache.c:1336</a></div></div>
<div class="ttc" id="test_8h_html_a0689ac4326c7a771e1b6ed1e4cde53e2adb2586ef58bb9dd2f84a7d592ecf3e0e"><div class="ttname"><a href="../../d2/ddc/test_8h.html#a0689ac4326c7a771e1b6ed1e4cde53e2adb2586ef58bb9dd2f84a7d592ecf3e0e">TEST_EXECUTE</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d2/ddc/test_8h_source.html#l00208">test.h:208</a></div></div>
<div class="ttc" id="structsorcery__memory__cache_html_aeb33dcb5573e1661c82b5370681fb626"><div class="ttname"><a href="../../d2/d6b/structsorcery__memory__cache.html#aeb33dcb5573e1661c82b5370681fb626">sorcery_memory_cache::sorcery</a></div><div class="ttdeci">const struct ast_sorcery * sorcery</div><div class="ttdoc">An unreffed pointer to the sorcery instance, accessible only with lock held. </div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d30/res__sorcery__memory__cache_8c_source.html#l00149">res_sorcery_memory_cache.c:149</a></div></div>
<div class="ttc" id="res__sorcery__memory__cache_8c_html_a6eb01814e57ff655e2fc04a6ac96bd8d"><div class="ttname"><a href="../../d7/d30/res__sorcery__memory__cache_8c.html#a6eb01814e57ff655e2fc04a6ac96bd8d">sorcery_memory_cache_complete_object_name</a></div><div class="ttdeci">static char * sorcery_memory_cache_complete_object_name(const char *cache_name, const char *word, int state)</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d30/res__sorcery__memory__cache_8c_source.html#l01825">res_sorcery_memory_cache.c:1825</a></div></div>
<div class="ttc" id="structast__cli__entry_html"><div class="ttname"><a href="../../d8/d07/structast__cli__entry.html">ast_cli_entry</a></div><div class="ttdoc">descriptor for a cli entry. </div><div class="ttdef"><b>Definition:</b> <a href="../../dc/db0/cli_8h_source.html#l00171">cli.h:171</a></div></div>
<div class="ttc" id="structast__cli__args_html_a98e1d8441ca58834f11f7367be4b3345"><div class="ttname"><a href="../../d3/dad/structast__cli__args.html#a98e1d8441ca58834f11f7367be4b3345">ast_cli_args::argc</a></div><div class="ttdeci">const int argc</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/db0/cli_8h_source.html#l00160">cli.h:160</a></div></div>
<div class="ttc" id="logger_8h_html_adf4476a6a4ea6c74231c826e899d7189"><div class="ttname"><a href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a></div><div class="ttdeci">#define LOG_WARNING</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d8c/logger_8h_source.html#l00274">logger.h:274</a></div></div>
<div class="ttc" id="res__sorcery__memory__cache_8c_html_a7754241bba93af948258f9385fb9829a"><div class="ttname"><a href="../../d7/d30/res__sorcery__memory__cache_8c.html#a7754241bba93af948258f9385fb9829a">memory_cache_object_wizard</a></div><div class="ttdeci">static struct ast_sorcery_wizard memory_cache_object_wizard</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d30/res__sorcery__memory__cache_8c_source.html#l00215">res_sorcery_memory_cache.c:215</a></div></div>
<div class="ttc" id="res__sorcery__memory__cache_8c_html_ac8dc47e3b39c930caed4bfd05b4ba805"><div class="ttname"><a href="../../d7/d30/res__sorcery__memory__cache_8c.html#ac8dc47e3b39c930caed4bfd05b4ba805">FORMAT</a></div><div class="ttdeci">#define FORMAT</div></div>
<div class="ttc" id="astobj2_8h_html_a47857055118a703ae87ea5ebaf4842ed"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#a47857055118a703ae87ea5ebaf4842ed">ao2_callback</a></div><div class="ttdeci">#define ao2_callback(c, flags, cb_fn, arg)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l01716">astobj2.h:1716</a></div></div>
<div class="ttc" id="astobj2_8h_html_a7f4dac6f8a1f5d07357acccc55bd370a"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#a7f4dac6f8a1f5d07357acccc55bd370a">ao2_trywrlock</a></div><div class="ttdeci">#define ao2_trywrlock(a)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l00742">astobj2.h:742</a></div></div>
<div class="ttc" id="structsorcery__memory__cache__fields__cmp__params_html_a7ea220e4d14b05876af4430e9832ce47"><div class="ttname"><a href="../../d7/d59/structsorcery__memory__cache__fields__cmp__params.html#a7ea220e4d14b05876af4430e9832ce47">sorcery_memory_cache_fields_cmp_params::container</a></div><div class="ttdeci">struct ao2_container * container</div><div class="ttdoc">Optional container to put object into. </div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d30/res__sorcery__memory__cache_8c_source.html#l00195">res_sorcery_memory_cache.c:195</a></div></div>
<div class="ttc" id="res__sorcery__memory__cache_8c_html_a3a2529b2a452b7589da51c1ad620ffe5"><div class="ttname"><a href="../../d7/d30/res__sorcery__memory__cache_8c.html#a3a2529b2a452b7589da51c1ad620ffe5">sorcery_memory_cached_object_cmp</a></div><div class="ttdeci">static int sorcery_memory_cached_object_cmp(void *obj, void *arg, int flags)</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d30/res__sorcery__memory__cache_8c_source.html#l00394">res_sorcery_memory_cache.c:394</a></div></div>
<div class="ttc" id="structast__variable_html"><div class="ttname"><a href="../../dd/d02/structast__variable.html">ast_variable</a></div><div class="ttdoc">Structure for variables, used for configurations and for channel variables. </div><div class="ttdef"><b>Definition:</b> <a href="../../d3/de6/include_2asterisk_2config_8h_source.html#l00083">include/asterisk/config.h:83</a></div></div>
<div class="ttc" id="test_8h_html"><div class="ttname"><a href="../../d2/ddc/test_8h.html">test.h</a></div><div class="ttdoc">Test Framework API. </div></div>
<div class="ttc" id="sorcery_8h_html_a320e98591a38316a313a3ca83ea8df20a643c7c50af2691bb16052509d47b61cd"><div class="ttname"><a href="../../d8/d25/sorcery_8h.html#a320e98591a38316a313a3ca83ea8df20a643c7c50af2691bb16052509d47b61cd">AST_RETRIEVE_FLAG_ALL</a></div><div class="ttdoc">Perform no matching, return all objects. </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d25/sorcery_8h_source.html#l00123">sorcery.h:123</a></div></div>
<div class="ttc" id="structast__heap_html"><div class="ttname"><a href="../../dc/dec/structast__heap.html">ast_heap</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d2/d29/heap_8c_source.html#l00036">heap.c:36</a></div></div>
<div class="ttc" id="test_8h_html_a34f64a69c09d98ceb693b077efd7ef97"><div class="ttname"><a href="../../d2/ddc/test_8h.html#a34f64a69c09d98ceb693b077efd7ef97">AST_TEST_REGISTER</a></div><div class="ttdeci">#define AST_TEST_REGISTER(cb)</div><div class="ttdef"><b>Definition:</b> <a href="../../d2/ddc/test_8h_source.html#l00127">test.h:127</a></div></div>
<div class="ttc" id="cli_8h_html_ab33e5350a923c3a8cedbeb496cd88ec9a71745eb63dd093f560a1add3e430d2a9"><div class="ttname"><a href="../../dc/db0/cli_8h.html#ab33e5350a923c3a8cedbeb496cd88ec9a71745eb63dd093f560a1add3e430d2a9">CLI_INIT</a></div><div class="ttdef"><b>Definition:</b> <a href="../../dc/db0/cli_8h_source.html#l00152">cli.h:152</a></div></div>
<div class="ttc" id="astobj2_8h_html_ad9d009e87e737af900825b36db55a35ca52efdf13b66ae502e2e20a5f49f068de"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#ad9d009e87e737af900825b36db55a35ca52efdf13b66ae502e2e20a5f49f068de">OBJ_NOLOCK</a></div><div class="ttdoc">Assume that the ao2_container is already locked. </div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l01067">astobj2.h:1067</a></div></div>
<div class="ttc" id="structast__sorcery_html"><div class="ttname"><a href="../../d2/d88/structast__sorcery.html">ast_sorcery</a></div><div class="ttdoc">Full structure for sorcery. </div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d69/sorcery_8c_source.html#l00230">sorcery.c:230</a></div></div>
<div class="ttc" id="heap_8h_html_a66d0a4a9d9e08e704abc44c856407bb8"><div class="ttname"><a href="../../da/ddb/heap_8h.html#a66d0a4a9d9e08e704abc44c856407bb8">ast_heap_destroy</a></div><div class="ttdeci">struct ast_heap * ast_heap_destroy(struct ast_heap *h)</div><div class="ttdoc">Destroy a max heap. </div><div class="ttdef"><b>Definition:</b> <a href="../../d2/d29/heap_8c_source.html#l00146">heap.c:146</a></div></div>
<div class="ttc" id="sched_8h_html_a11e2d4283c11790a27a0f899dab00e93"><div class="ttname"><a href="../../d7/d00/sched_8h.html#a11e2d4283c11790a27a0f899dab00e93">AST_SCHED_DEL_UNREF</a></div><div class="ttdeci">#define AST_SCHED_DEL_UNREF(sched, id, refcall)</div><div class="ttdoc">schedule task to get deleted and call unref function </div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d00/sched_8h_source.html#l00080">sched.h:80</a></div></div>
<div class="ttc" id="structstale__cache__update__task__data_html_a95eb520bdb1abcd2a70b1432d3ecbf4c"><div class="ttname"><a href="../../df/df7/structstale__cache__update__task__data.html#a95eb520bdb1abcd2a70b1432d3ecbf4c">stale_cache_update_task_data::sorcery</a></div><div class="ttdeci">struct ast_sorcery * sorcery</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d30/res__sorcery__memory__cache_8c_source.html#l00872">res_sorcery_memory_cache.c:872</a></div></div>
<div class="ttc" id="lock_8h_html_a69e9591803d36f5683eb9b084442be9b"><div class="ttname"><a href="../../dd/d42/lock_8h.html#a69e9591803d36f5683eb9b084442be9b">ast_cond_init</a></div><div class="ttdeci">#define ast_cond_init(cond, attr)</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d42/lock_8h_source.html#l00199">lock.h:199</a></div></div>
<div class="ttc" id="cli_8h_html_aea8910ed9e301e7f741f87942c244eac"><div class="ttname"><a href="../../dc/db0/cli_8h.html#aea8910ed9e301e7f741f87942c244eac">ast_cli_register_multiple</a></div><div class="ttdeci">#define ast_cli_register_multiple(e, len)</div><div class="ttdoc">Register multiple commands. </div><div class="ttdef"><b>Definition:</b> <a href="../../dc/db0/cli_8h_source.html#l00265">cli.h:265</a></div></div>
<div class="ttc" id="structbackend__data_html_a0817c9db744a78699e31ca83df2ef709"><div class="ttname"><a href="../../d2/d13/structbackend__data.html#a0817c9db744a78699e31ca83df2ef709">backend_data::salt</a></div><div class="ttdeci">int salt</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d30/res__sorcery__memory__cache_8c_source.html#l02976">res_sorcery_memory_cache.c:2976</a></div></div>
<div class="ttc" id="astobj2_8h_html_ad36841ab6daa3997f7ca7047ad2d033a"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#ad36841ab6daa3997f7ca7047ad2d033a">ao2_iterator_destroy</a></div><div class="ttdeci">void ao2_iterator_destroy(struct ao2_iterator *iter)</div><div class="ttdoc">Destroy a container iterator. </div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d22/astobj2__container_8c_source.html#l00534">astobj2_container.c:534</a></div></div>
<div class="ttc" id="time_8h_html_ad3899efb6f0e348556ef69f5b16aa7f7"><div class="ttname"><a href="../../de/df7/time_8h.html#ad3899efb6f0e348556ef69f5b16aa7f7">ast_tvnow</a></div><div class="ttdeci">struct timeval ast_tvnow(void)</div><div class="ttdoc">Returns current timeval. Meant to replace calls to gettimeofday(). </div><div class="ttdef"><b>Definition:</b> <a href="../../de/df7/time_8h_source.html#l00150">time.h:150</a></div></div>
<div class="ttc" id="sorcery_8h_html_a320e98591a38316a313a3ca83ea8df20a019a4a531b83f4ab0b35a3c788bf8d55"><div class="ttname"><a href="../../d8/d25/sorcery_8h.html#a320e98591a38316a313a3ca83ea8df20a019a4a531b83f4ab0b35a3c788bf8d55">AST_RETRIEVE_FLAG_MULTIPLE</a></div><div class="ttdoc">Return all matching objects. </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d25/sorcery_8h_source.html#l00120">sorcery.h:120</a></div></div>
<div class="ttc" id="structsorcery__memory__cached__object_html_a529e497bc965817d03dbcdc5805305c4"><div class="ttname"><a href="../../df/d93/structsorcery__memory__cached__object.html#a529e497bc965817d03dbcdc5805305c4">sorcery_memory_cached_object::created</a></div><div class="ttdeci">struct timeval created</div><div class="ttdoc">The time at which the object was created. </div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d30/res__sorcery__memory__cache_8c_source.html#l00171">res_sorcery_memory_cache.c:171</a></div></div>
<div class="ttc" id="astobj2_8h_html_ab3c44e28d661616129b7819069effe61"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#ab3c44e28d661616129b7819069effe61">ao2_alloc_options</a></div><div class="ttdeci">#define ao2_alloc_options(data_size, destructor_fn, options)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l00406">astobj2.h:406</a></div></div>
<div class="ttc" id="res__sorcery__memory__cache_8c_html_a2e2cc75f11aaadea52350001ec0a1b72"><div class="ttname"><a href="../../d7/d30/res__sorcery__memory__cache_8c.html#a2e2cc75f11aaadea52350001ec0a1b72">sorcery_memory_cache_print_object</a></div><div class="ttdeci">static int sorcery_memory_cache_print_object(void *obj, void *arg, int flags)</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d30/res__sorcery__memory__cache_8c_source.html#l01744">res_sorcery_memory_cache.c:1744</a></div></div>
<div class="ttc" id="utils_8h_html_a24374da24af1931d8a7ccde5b352bb2c"><div class="ttname"><a href="../../d5/d60/utils_8h.html#a24374da24af1931d8a7ccde5b352bb2c">ast_assert</a></div><div class="ttdeci">#define ast_assert(a)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d60/utils_8h_source.html#l00695">utils.h:695</a></div></div>
<div class="ttc" id="astobj2_8h_html_a7ce8563daf84a18540a86504d165b444"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#a7ce8563daf84a18540a86504d165b444">ao2_link_flags</a></div><div class="ttdeci">#define ao2_link_flags(container, obj, flags)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l01572">astobj2.h:1572</a></div></div>
<div class="ttc" id="group__Group__AMI_html_ga77315fa8e29950f0c88120501acda0a3"><div class="ttname"><a href="../../df/d72/group__Group__AMI.html#ga77315fa8e29950f0c88120501acda0a3">astman_send_ack</a></div><div class="ttdeci">void astman_send_ack(struct mansession *s, const struct message *m, char *msg)</div><div class="ttdoc">Send ack in manager transaction. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d10/manager_8c_source.html#l03191">manager.c:3191</a></div></div>
<div class="ttc" id="lock_8h_html_ac5e13c7fe64d3b271a52028b0a78b92b"><div class="ttname"><a href="../../dd/d42/lock_8h.html#ac5e13c7fe64d3b271a52028b0a78b92b">ast_mutex_lock</a></div><div class="ttdeci">#define ast_mutex_lock(a)</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d42/lock_8h_source.html#l00187">lock.h:187</a></div></div>
<div class="ttc" id="res__sorcery__memory__cache_8c_html_ab82ef9b77a071d0ccba6e81eee3cee4a"><div class="ttname"><a href="../../d7/d30/res__sorcery__memory__cache_8c.html#ab82ef9b77a071d0ccba6e81eee3cee4a">sorcery_memory_cache_populate</a></div><div class="ttdeci">static char * sorcery_memory_cache_populate(struct ast_cli_entry *e, int cmd, struct ast_cli_args *a)</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d30/res__sorcery__memory__cache_8c_source.html#l02001">res_sorcery_memory_cache.c:2001</a></div></div>
<div class="ttc" id="structsorcery__memory__cache_html_a890cd2c933f495837f720efe44aa9642"><div class="ttname"><a href="../../d2/d6b/structsorcery__memory__cache.html#a890cd2c933f495837f720efe44aa9642">sorcery_memory_cache::object_lifetime_maximum</a></div><div class="ttdeci">unsigned int object_lifetime_maximum</div><div class="ttdoc">The maximum time (in seconds) an object will stay in the cache, 0 if no limit. </div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d30/res__sorcery__memory__cache_8c_source.html#l00135">res_sorcery_memory_cache.c:135</a></div></div>
<div class="ttc" id="astobj2_8h_html_a9998bd156b936636a8780385e9a910b2"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#a9998bd156b936636a8780385e9a910b2">ao2_unlock</a></div><div class="ttdeci">#define ao2_unlock(a)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l00730">astobj2.h:730</a></div></div>
<div class="ttc" id="time_8h_html_aca4ecdab7d8d3519062aad9a90fcb29d"><div class="ttname"><a href="../../de/df7/time_8h.html#aca4ecdab7d8d3519062aad9a90fcb29d">ast_tvdiff_ms</a></div><div class="ttdeci">int64_t ast_tvdiff_ms(struct timeval end, struct timeval start)</div><div class="ttdoc">Computes the difference (in milliseconds) between two struct timeval instances. </div><div class="ttdef"><b>Definition:</b> <a href="../../de/df7/time_8h_source.html#l00098">time.h:98</a></div></div>
<div class="ttc" id="res__sorcery__memory__cache_8c_html_a79c1852b8824773f75e2988a04c6abbd"><div class="ttname"><a href="../../d7/d30/res__sorcery__memory__cache_8c.html#a79c1852b8824773f75e2988a04c6abbd">test_sorcery_object_alloc</a></div><div class="ttdeci">static void * test_sorcery_object_alloc(const char *id)</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d30/res__sorcery__memory__cache_8c_source.html#l02288">res_sorcery_memory_cache.c:2288</a></div></div>
<div class="ttc" id="astmm_8h_html_ab263849d03fb892847be4986db759737"><div class="ttname"><a href="../../d8/d8a/astmm_8h.html#ab263849d03fb892847be4986db759737">ast_strdup</a></div><div class="ttdeci">#define ast_strdup(str)</div><div class="ttdoc">A wrapper for strdup() </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d8a/astmm_8h_source.html#l00243">astmm.h:243</a></div></div>
<div class="ttc" id="astobj2_8h_html_a1f8b41308be4c47de8ff89a3b9c7e7d1a75382dc9117cc118719edf6c3d2b71df"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#a1f8b41308be4c47de8ff89a3b9c7e7d1a75382dc9117cc118719edf6c3d2b71df">CMP_STOP</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l01032">astobj2.h:1032</a></div></div>
<div class="ttc" id="structsorcery__memory__cache_html_adf04f66344e3fb0a6f6a69bf39d19902"><div class="ttname"><a href="../../d2/d6b/structsorcery__memory__cache.html#adf04f66344e3fb0a6f6a69bf39d19902">sorcery_memory_cache::lock</a></div><div class="ttdeci">ast_mutex_t lock</div><div class="ttdoc">Mutex lock used for signaling when the cache has reached empty. </div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d30/res__sorcery__memory__cache_8c_source.html#l00158">res_sorcery_memory_cache.c:158</a></div></div>
<div class="ttc" id="resample_8c_html_a070d2ce7b6bb7e5c05602aa8c308d0c4"><div class="ttname"><a href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a></div><div class="ttdeci">#define NULL</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d7f/resample_8c_source.html#l00096">resample.c:96</a></div></div>
<div class="ttc" id="structtest__data_html_a0817c9db744a78699e31ca83df2ef709"><div class="ttname"><a href="../../dc/d9a/structtest__data.html#a0817c9db744a78699e31ca83df2ef709">test_data::salt</a></div><div class="ttdeci">int salt</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d30/res__sorcery__memory__cache_8c_source.html#l02989">res_sorcery_memory_cache.c:2989</a></div></div>
<div class="ttc" id="astobj2_8h_html_a3498e30d6154a052e7b64b7a96da8b4b"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#a3498e30d6154a052e7b64b7a96da8b4b">ao2_wrlock</a></div><div class="ttdeci">#define ao2_wrlock(a)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l00720">astobj2.h:720</a></div></div>
<div class="ttc" id="heap_8h_html_ad56625488a481df852f0b13d58b15a93"><div class="ttname"><a href="../../da/ddb/heap_8h.html#ad56625488a481df852f0b13d58b15a93">ast_heap_pop</a></div><div class="ttdeci">void * ast_heap_pop(struct ast_heap *h)</div><div class="ttdoc">Pop the max element off of the heap. </div><div class="ttdef"><b>Definition:</b> <a href="../../d2/d29/heap_8c_source.html#l00262">heap.c:262</a></div></div>
<div class="ttc" id="syslog_8c_html_ac4f474c82e82cbb89ca7c36dd52be0ed"><div class="ttname"><a href="../../d4/d2f/syslog_8c.html#ac4f474c82e82cbb89ca7c36dd52be0ed">value</a></div><div class="ttdeci">int value</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d2f/syslog_8c_source.html#l00037">syslog.c:37</a></div></div>
<div class="ttc" id="cli_8h_html_a791bf9f5637185bee5e8f0907c762130"><div class="ttname"><a href="../../dc/db0/cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a></div><div class="ttdeci">void ast_cli(int fd, const char *fmt,...)</div><div class="ttdef"><b>Definition:</b> <a href="../../da/d4d/clicompat_8c_source.html#l00006">clicompat.c:6</a></div></div>
<div class="ttc" id="res__sorcery__memory__cache_8c_html_a9f6a8b7453ee946fb55fac3b0237f514"><div class="ttname"><a href="../../d7/d30/res__sorcery__memory__cache_8c.html#a9f6a8b7453ee946fb55fac3b0237f514">sorcery_memory_cache_close</a></div><div class="ttdeci">static void sorcery_memory_cache_close(void *data)</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d30/res__sorcery__memory__cache_8c_source.html#l01620">res_sorcery_memory_cache.c:1620</a></div></div>
<div class="ttc" id="res__sorcery__memory__cache_8c_html_aab28609572a132139c835e70368bdddb"><div class="ttname"><a href="../../d7/d30/res__sorcery__memory__cache_8c.html#aab28609572a132139c835e70368bdddb">mock_retrieve_id</a></div><div class="ttdeci">static void * mock_retrieve_id(const struct ast_sorcery *sorcery, void *data, const char *type, const char *id)</div><div class="ttdoc">Callback for retrieving sorcery object by ID. </div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d30/res__sorcery__memory__cache_8c_source.html#l03017">res_sorcery_memory_cache.c:3017</a></div></div>
<div class="ttc" id="structast__sorcery__wizard_html_a8f8f80d37794cde9472343e4487ba3eb"><div class="ttname"><a href="../../dd/d0a/structast__sorcery__wizard.html#a8f8f80d37794cde9472343e4487ba3eb">ast_sorcery_wizard::name</a></div><div class="ttdeci">const char * name</div><div class="ttdoc">Name of the wizard. </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d25/sorcery_8h_source.html#l00278">sorcery.h:278</a></div></div>
<div class="ttc" id="test_8h_html_a0689ac4326c7a771e1b6ed1e4cde53e2a21df97525a6ac371a7fb604dfa8ea67b"><div class="ttname"><a href="../../d2/ddc/test_8h.html#a0689ac4326c7a771e1b6ed1e4cde53e2a21df97525a6ac371a7fb604dfa8ea67b">TEST_INIT</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d2/ddc/test_8h_source.html#l00207">test.h:207</a></div></div>
<div class="ttc" id="res__sorcery__memory__cache_8c_html_a751f8dcc38eb8ff1f9aee8b2b0c14db0"><div class="ttname"><a href="../../d7/d30/res__sorcery__memory__cache_8c.html#a751f8dcc38eb8ff1f9aee8b2b0c14db0">sorcery_memory_cache_create</a></div><div class="ttdeci">static int sorcery_memory_cache_create(const struct ast_sorcery *sorcery, void *data, void *object)</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d30/res__sorcery__memory__cache_8c_source.html#l00805">res_sorcery_memory_cache.c:805</a></div></div>
<div class="ttc" id="lock_8h_html_ae2cdf274a5da241c3ad7324d82bf6af0"><div class="ttname"><a href="../../dd/d42/lock_8h.html#ae2cdf274a5da241c3ad7324d82bf6af0">ast_cond_signal</a></div><div class="ttdeci">#define ast_cond_signal(cond)</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d42/lock_8h_source.html#l00201">lock.h:201</a></div></div>
<div class="ttc" id="astobj2_8h_html_ad9d009e87e737af900825b36db55a35ca71f42ec6460e60eb6e10956c53329e45"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#ad9d009e87e737af900825b36db55a35ca71f42ec6460e60eb6e10956c53329e45">OBJ_UNLINK</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l01043">astobj2.h:1043</a></div></div>
<div class="ttc" id="structsorcery__memory__cache_html_ac2c70d25e5f4a7ef4384b344d4f411ce"><div class="ttname"><a href="../../d2/d6b/structsorcery__memory__cache.html#ac2c70d25e5f4a7ef4384b344d4f411ce">sorcery_memory_cache::object_heap</a></div><div class="ttdeci">struct ast_heap * object_heap</div><div class="ttdoc">Heap of cached objects. Oldest object is at the top. </div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d30/res__sorcery__memory__cache_8c_source.html#l00143">res_sorcery_memory_cache.c:143</a></div></div>
<div class="ttc" id="cli_8h_html_a93bd04b9d331251376fdfb0eda7e7a6c"><div class="ttname"><a href="../../dc/db0/cli_8h.html#a93bd04b9d331251376fdfb0eda7e7a6c">AST_CLI_ONOFF</a></div><div class="ttdeci">#define AST_CLI_ONOFF(x)</div><div class="ttdoc">return On or Off depending on the argument. This is used in many places in CLI command, having a function to generate this helps maintaining a consistent output (and possibly emitting the output in other languages, at some point). </div><div class="ttdef"><b>Definition:</b> <a href="../../dc/db0/cli_8h_source.html#l00078">cli.h:78</a></div></div>
<div class="ttc" id="res__sorcery__memory__cache_8c_html_ac3382bf6da54c56b37069bd76bbdf4f9"><div class="ttname"><a href="../../d7/d30/res__sorcery__memory__cache_8c.html#ac3382bf6da54c56b37069bd76bbdf4f9">load_module</a></div><div class="ttdeci">static int load_module(void)</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d30/res__sorcery__memory__cache_8c_source.html#l03538">res_sorcery_memory_cache.c:3538</a></div></div>
<div class="ttc" id="structstale__cache__update__task__data_html"><div class="ttname"><a href="../../df/df7/structstale__cache__update__task__data.html">stale_cache_update_task_data</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d30/res__sorcery__memory__cache_8c_source.html#l00871">res_sorcery_memory_cache.c:871</a></div></div>
<div class="ttc" id="res__sorcery__memory__cache_8c_html_a275341d3c1b190fdfc2d970dc7a32858"><div class="ttname"><a href="../../d7/d30/res__sorcery__memory__cache_8c.html#a275341d3c1b190fdfc2d970dc7a32858">PASSTHRU_UPDATE_THREAD_ID</a></div><div class="ttdeci">#define PASSTHRU_UPDATE_THREAD_ID</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d30/res__sorcery__memory__cache_8c_source.html#l00246">res_sorcery_memory_cache.c:246</a></div></div>
<div class="ttc" id="test_8h_html_aad2aec78205d328d23894a6598cc4044a8cf2ae27807baf798d726d630693cc8c"><div class="ttname"><a href="../../d2/ddc/test_8h.html#aad2aec78205d328d23894a6598cc4044a8cf2ae27807baf798d726d630693cc8c">AST_TEST_NOT_RUN</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d2/ddc/test_8h_source.html#l00201">test.h:201</a></div></div>
<div class="ttc" id="astmm_8h_html_ada667b6f84a08e6848cb37c5ffb94a5f"><div class="ttname"><a href="../../d8/d8a/astmm_8h.html#ada667b6f84a08e6848cb37c5ffb94a5f">ast_asprintf</a></div><div class="ttdeci">#define ast_asprintf(ret, fmt,...)</div><div class="ttdoc">A wrapper for asprintf() </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d8a/astmm_8h_source.html#l00269">astmm.h:269</a></div></div>
<div class="ttc" id="sorcery_8h_html_ac6d61f7f74e9face6219d1d3f5f0671c"><div class="ttname"><a href="../../d8/d25/sorcery_8h.html#ac6d61f7f74e9face6219d1d3f5f0671c">ast_sorcery_object_get_type</a></div><div class="ttdeci">const char * ast_sorcery_object_get_type(const void *object)</div><div class="ttdoc">Get the type of a sorcery object. </div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d69/sorcery_8c_source.html#l02324">sorcery.c:2324</a></div></div>
<div class="ttc" id="structsorcery__memory__cache__fields__cmp__params_html_a5b41c5ae4505891e6c53e26df197e02b"><div class="ttname"><a href="../../d7/d59/structsorcery__memory__cache__fields__cmp__params.html#a5b41c5ae4505891e6c53e26df197e02b">sorcery_memory_cache_fields_cmp_params::prefix</a></div><div class="ttdeci">const char * prefix</div><div class="ttdoc">Prefix for matching object id. </div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d30/res__sorcery__memory__cache_8c_source.html#l00191">res_sorcery_memory_cache.c:191</a></div></div>
<div class="ttc" id="group__Group__AMI_html_gac6a9f3498f9afffecfd78c485af41556"><div class="ttname"><a href="../../df/d72/group__Group__AMI.html#gac6a9f3498f9afffecfd78c485af41556">astman_get_header</a></div><div class="ttdeci">const char * astman_get_header(const struct message *m, char *var)</div><div class="ttdoc">Get header from mananger transaction. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d10/manager_8c_source.html#l02820">manager.c:2820</a></div></div>
<div class="ttc" id="lock_8h_html_ab134d98cdfe7de0f7a72b377c0765dc7"><div class="ttname"><a href="../../dd/d42/lock_8h.html#ab134d98cdfe7de0f7a72b377c0765dc7">ast_cond_t</a></div><div class="ttdeci">pthread_cond_t ast_cond_t</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d42/lock_8h_source.html#l00176">lock.h:176</a></div></div>
<div class="ttc" id="strings_8h_html_a372554b7a2d69a8bd3adac5157672036"><div class="ttname"><a href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a></div><div class="ttdeci">#define ast_strlen_zero(foo)</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d90/strings_8h_source.html#l00052">strings.h:52</a></div></div>
<div class="ttc" id="sorcery_8h_html_a100106a82d72aa59a66513ef3ad161c8"><div class="ttname"><a href="../../d8/d25/sorcery_8h.html#a100106a82d72aa59a66513ef3ad161c8">ast_sorcery_retrieve_by_id</a></div><div class="ttdeci">void * ast_sorcery_retrieve_by_id(const struct ast_sorcery *sorcery, const char *type, const char *id)</div><div class="ttdoc">Retrieve an object using its unique identifier. </div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d69/sorcery_8c_source.html#l01853">sorcery.c:1853</a></div></div>
<div class="ttc" id="sorcery_8h_html_a4aa06205a33d1fa168299de936451415"><div class="ttname"><a href="../../d8/d25/sorcery_8h.html#a4aa06205a33d1fa168299de936451415">ast_sorcery_get_module</a></div><div class="ttdeci">const char * ast_sorcery_get_module(const struct ast_sorcery *sorcery)</div><div class="ttdoc">Get the module that has opened the provided sorcery instance. </div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d69/sorcery_8c_source.html#l02531">sorcery.c:2531</a></div></div>
<div class="ttc" id="sorcery_8h_html_a09cba9c37c702ca2bdcf94052068ed67"><div class="ttname"><a href="../../d8/d25/sorcery_8h.html#a09cba9c37c702ca2bdcf94052068ed67">ast_sorcery_unref</a></div><div class="ttdeci">#define ast_sorcery_unref(sorcery)</div><div class="ttdoc">Decrease the reference count of a sorcery structure. </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d25/sorcery_8h_source.html#l01502">sorcery.h:1502</a></div></div>
<div class="ttc" id="res__sorcery__memory__cache_8c_html_a73ad8004e57b45af60c0303ded1e6862"><div class="ttname"><a href="../../d7/d30/res__sorcery__memory__cache_8c.html#a73ad8004e57b45af60c0303ded1e6862">sorcery_memory_cache_hash</a></div><div class="ttdeci">static int sorcery_memory_cache_hash(const void *obj, int flags)</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d30/res__sorcery__memory__cache_8c_source.html#l00295">res_sorcery_memory_cache.c:295</a></div></div>
<div class="ttc" id="cli_8h_html_a2a43f82ed19e84f386787154f2f22fc9"><div class="ttname"><a href="../../dc/db0/cli_8h.html#a2a43f82ed19e84f386787154f2f22fc9">ast_cli_complete</a></div><div class="ttdeci">char * ast_cli_complete(const char *word, const char *const choices[], int pos)</div><div class="ttdef"><b>Definition:</b> <a href="../../df/dd3/main_2cli_8c_source.html#l01811">main/cli.c:1811</a></div></div>
<div class="ttc" id="res__sorcery__memory__cache_8c_html_ad09fa931f468002152a3cc2d5ce25eae"><div class="ttname"><a href="../../d7/d30/res__sorcery__memory__cache_8c.html#ad09fa931f468002152a3cc2d5ce25eae">unload_module</a></div><div class="ttdeci">static int unload_module(void)</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d30/res__sorcery__memory__cache_8c_source.html#l03500">res_sorcery_memory_cache.c:3500</a></div></div>
<div class="ttc" id="res__sorcery__memory__cache_8c_html_a6e5cc056cb8ed0f3ff6c59a498b8f974"><div class="ttname"><a href="../../d7/d30/res__sorcery__memory__cache_8c.html#a6e5cc056cb8ed0f3ff6c59a498b8f974">sorcery_memory_cache_reload</a></div><div class="ttdeci">static void sorcery_memory_cache_reload(void *data, const struct ast_sorcery *sorcery, const char *type)</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d30/res__sorcery__memory__cache_8c_source.html#l01461">res_sorcery_memory_cache.c:1461</a></div></div>
<div class="ttc" id="astobj2_8h_html_ac438c3fcd3150481fad38689fd813a15"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#ac438c3fcd3150481fad38689fd813a15">ao2_bump</a></div><div class="ttdeci">#define ao2_bump(obj)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l00491">astobj2.h:491</a></div></div>
<div class="ttc" id="res__sorcery__memory__cache_8c_html_a42e64d7234b0312fee62bb181f81be89"><div class="ttname"><a href="../../d7/d30/res__sorcery__memory__cache_8c.html#a42e64d7234b0312fee62bb181f81be89">set_passthru_update</a></div><div class="ttdeci">static void set_passthru_update(uint32_t value)</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d30/res__sorcery__memory__cache_8c_source.html#l00262">res_sorcery_memory_cache.c:262</a></div></div>
<div class="ttc" id="structbackend__data_html_a1c03c47f39cf197ed393df7833ccde95"><div class="ttname"><a href="../../d2/d13/structbackend__data.html#a1c03c47f39cf197ed393df7833ccde95">backend_data::exists</a></div><div class="ttdeci">int exists</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d30/res__sorcery__memory__cache_8c_source.html#l02980">res_sorcery_memory_cache.c:2980</a></div></div>
<div class="ttc" id="res__sorcery__memory__cache_8c_html_a6ef09b2208df722b2abff81c398c8e46"><div class="ttname"><a href="../../d7/d30/res__sorcery__memory__cache_8c.html#a6ef09b2208df722b2abff81c398c8e46">sorcery_memory_cache_cmp</a></div><div class="ttdeci">static int sorcery_memory_cache_cmp(void *obj, void *arg, int flags)</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d30/res__sorcery__memory__cache_8c_source.html#l00329">res_sorcery_memory_cache.c:329</a></div></div>
<div class="ttc" id="res__sorcery__memory__cache_8c_html_ab1da9230c15ffd14293df53648a90c3d"><div class="ttname"><a href="../../d7/d30/res__sorcery__memory__cache_8c.html#ab1da9230c15ffd14293df53648a90c3d">memory_cache_stale_update_object</a></div><div class="ttdeci">static void memory_cache_stale_update_object(const struct ast_sorcery *sorcery, struct sorcery_memory_cache *cache, struct sorcery_memory_cached_object *cached)</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d30/res__sorcery__memory__cache_8c_source.html#l01126">res_sorcery_memory_cache.c:1126</a></div></div>
<div class="ttc" id="res__sorcery__memory__cache_8c_html_aa7e1302041b154a0df319fb0abbd6447"><div class="ttname"><a href="../../d7/d30/res__sorcery__memory__cache_8c.html#aa7e1302041b154a0df319fb0abbd6447">sorcery_memory_cache_ami_populate</a></div><div class="ttdeci">static int sorcery_memory_cache_ami_populate(struct mansession *s, const struct message *m)</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d30/res__sorcery__memory__cache_8c_source.html#l02230">res_sorcery_memory_cache.c:2230</a></div></div>
<div class="ttc" id="manager_8h_html_a420f0f755e1c3378b45ca7f6f0669ffa"><div class="ttname"><a href="../../db/d45/manager_8h.html#a420f0f755e1c3378b45ca7f6f0669ffa">EVENT_FLAG_SYSTEM</a></div><div class="ttdeci">#define EVENT_FLAG_SYSTEM</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d45/manager_8h_source.html#l00071">manager.h:71</a></div></div>
<div class="ttc" id="logger_8h_html_a3f248112c8d6ce7e3959aa723dade648"><div class="ttname"><a href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a></div><div class="ttdeci">#define ast_debug(level,...)</div><div class="ttdoc">Log a DEBUG message. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d8c/logger_8h_source.html#l00452">logger.h:452</a></div></div>
<div class="ttc" id="heap_8h_html"><div class="ttname"><a href="../../da/ddb/heap_8h.html">heap.h</a></div><div class="ttdoc">Max Heap data structure. </div></div>
<div class="ttc" id="astobj2_8c_html_a96a00b3a518d7f32b6d51dc28f09bf9b"><div class="ttname"><a href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a></div><div class="ttdeci">#define ast_log</div><div class="ttdef"><b>Definition:</b> <a href="../../da/df7/astobj2_8c_source.html#l00042">astobj2.c:42</a></div></div>
<div class="ttc" id="res__sorcery__memory__cache_8c_html_a474ead91b9f86ab23435c2ee0fe1a19d"><div class="ttname"><a href="../../d7/d30/res__sorcery__memory__cache_8c.html#a474ead91b9f86ab23435c2ee0fe1a19d">sorcery_memory_cache_retrieve_regex</a></div><div class="ttdeci">static void sorcery_memory_cache_retrieve_regex(const struct ast_sorcery *sorcery, void *data, const char *type, struct ao2_container *objects, const char *regex)</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d30/res__sorcery__memory__cache_8c_source.html#l01369">res_sorcery_memory_cache.c:1369</a></div></div>
<div class="ttc" id="utils_8h_html_afa99ec4acc4ecb2dc3c2d05da15d0e3f"><div class="ttname"><a href="../../d5/d60/utils_8h.html#afa99ec4acc4ecb2dc3c2d05da15d0e3f">MAX</a></div><div class="ttdeci">#define MAX(a, b)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d60/utils_8h_source.html#l00228">utils.h:228</a></div></div>
<div class="ttc" id="structstale__update__task__data_html"><div class="ttname"><a href="../../da/d04/structstale__update__task__data.html">stale_update_task_data</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d30/res__sorcery__memory__cache_8c_source.html#l00956">res_sorcery_memory_cache.c:956</a></div></div>
<div class="ttc" id="astobj2_8h_html_ad9d009e87e737af900825b36db55a35ca269370d42230fc6aa6700e2948e1eb20"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#ad9d009e87e737af900825b36db55a35ca269370d42230fc6aa6700e2948e1eb20">OBJ_SEARCH_PARTIAL_KEY</a></div><div class="ttdoc">The arg parameter is a partial search key similar to OBJ_SEARCH_KEY. </div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l01120">astobj2.h:1120</a></div></div>
<div class="ttc" id="heap_8h_html_ad181f4df20e6039b37e1b8d128884a81"><div class="ttname"><a href="../../da/ddb/heap_8h.html#ad181f4df20e6039b37e1b8d128884a81">ast_heap_push</a></div><div class="ttdeci">#define ast_heap_push(h, elm)</div><div class="ttdef"><b>Definition:</b> <a href="../../da/ddb/heap_8h_source.html#l00126">heap.h:126</a></div></div>
<div class="ttc" id="config__options_8h_html_a5793d5d6ccf2df0b2423eb3274af7802"><div class="ttname"><a href="../../db/dfe/config__options_8h.html#a5793d5d6ccf2df0b2423eb3274af7802">FLDSET</a></div><div class="ttdeci">#define FLDSET(type,...)</div><div class="ttdoc">Convert a struct and list of fields to an argument list of field offsets. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/dfe/config__options_8h_source.html#l00816">config_options.h:816</a></div></div>
<div class="ttc" id="structsorcery__memory__cache_html"><div class="ttname"><a href="../../d2/d6b/structsorcery__memory__cache.html">sorcery_memory_cache</a></div><div class="ttdoc">Structure for storing a memory cache. </div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d30/res__sorcery__memory__cache_8c_source.html#l00127">res_sorcery_memory_cache.c:127</a></div></div>
<div class="ttc" id="module_8h_html_a155a0df9c59e04e305d4a2fa3e35f843a12c3f60dd7655dfa8d4430cbf04b1223"><div class="ttname"><a href="../../d5/d16/module_8h.html#a155a0df9c59e04e305d4a2fa3e35f843a12c3f60dd7655dfa8d4430cbf04b1223">AST_MODFLAG_LOAD_ORDER</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d16/module_8h_source.html#l00317">module.h:317</a></div></div>
<div class="ttc" id="utils_8h_html_a1604b4d72144dd3d9f7da668e90337e9"><div class="ttname"><a href="../../d5/d60/utils_8h.html#a1604b4d72144dd3d9f7da668e90337e9">RAII_VAR</a></div><div class="ttdeci">#define RAII_VAR(vartype, varname, initval, dtor)</div><div class="ttdoc">Declare a variable that will call a destructor function when it goes out of scope. </div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d60/utils_8h_source.html#l00911">utils.h:911</a></div></div>
<div class="ttc" id="config__options_8h_html_a61bb4940517e7d00e7104de8273c2144a019a75c8729b63787919b2e67331c84f"><div class="ttname"><a href="../../db/dfe/config__options_8h.html#a61bb4940517e7d00e7104de8273c2144a019a75c8729b63787919b2e67331c84f">OPT_UINT_T</a></div><div class="ttdoc">Type for default option handler for unsigned integers. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/dfe/config__options_8h_source.html#l00459">config_options.h:459</a></div></div>
<div class="ttc" id="test_8h_html_a5e8fddded61f6989172c981256e7c9bd"><div class="ttname"><a href="../../d2/ddc/test_8h.html#a5e8fddded61f6989172c981256e7c9bd">ast_test_status_update</a></div><div class="ttdeci">#define ast_test_status_update(a, b, c...)</div><div class="ttdef"><b>Definition:</b> <a href="../../d2/ddc/test_8h_source.html#l00129">test.h:129</a></div></div>
<div class="ttc" id="structast__cli__args_html_acf64f219885421479997667d2ed3f08a"><div class="ttname"><a href="../../d3/dad/structast__cli__args.html#acf64f219885421479997667d2ed3f08a">ast_cli_args::fd</a></div><div class="ttdeci">const int fd</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/db0/cli_8h_source.html#l00159">cli.h:159</a></div></div>
<div class="ttc" id="structsorcery__memory__cache__fields__cmp__params_html_af71a3fad7fee5d731252ce89e56f948f"><div class="ttname"><a href="../../d7/d59/structsorcery__memory__cache__fields__cmp__params.html#af71a3fad7fee5d731252ce89e56f948f">sorcery_memory_cache_fields_cmp_params::regex</a></div><div class="ttdeci">regex_t * regex</div><div class="ttdoc">Regular expression for checking object id. </div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d30/res__sorcery__memory__cache_8c_source.html#l00189">res_sorcery_memory_cache.c:189</a></div></div>
<div class="ttc" id="res__sorcery__memory__cache_8c_html_acd685da136b665d9151211a6b0566689"><div class="ttname"><a href="../../d7/d30/res__sorcery__memory__cache_8c.html#acd685da136b665d9151211a6b0566689">sorcery_memory_cache_show</a></div><div class="ttdeci">static char * sorcery_memory_cache_show(struct ast_cli_entry *e, int cmd, struct ast_cli_args *a)</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d30/res__sorcery__memory__cache_8c_source.html#l01679">res_sorcery_memory_cache.c:1679</a></div></div>
<div class="ttc" id="structast__cli__args_html_acfc02ec89670db29251fda6a66602ce2"><div class="ttname"><a href="../../d3/dad/structast__cli__args.html#acfc02ec89670db29251fda6a66602ce2">ast_cli_args::n</a></div><div class="ttdeci">const int n</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/db0/cli_8h_source.html#l00165">cli.h:165</a></div></div>
<div class="ttc" id="res__sorcery__memory__cache_8c_html_ae105be728a4bf9b0644438080f207f9e"><div class="ttname"><a href="../../d7/d30/res__sorcery__memory__cache_8c.html#ae105be728a4bf9b0644438080f207f9e">mock_retrieve_multiple</a></div><div class="ttdeci">static void mock_retrieve_multiple(const struct ast_sorcery *sorcery, void *data, const char *type, struct ao2_container *objects, const struct ast_variable *fields)</div><div class="ttdoc">Callback for retrieving multiple sorcery objects. </div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d30/res__sorcery__memory__cache_8c_source.html#l03049">res_sorcery_memory_cache.c:3049</a></div></div>
<div class="ttc" id="structsorcery__memory__cache_html_acbaed991b7fd3a4fd5661a99cb304d56"><div class="ttname"><a href="../../d2/d6b/structsorcery__memory__cache.html#acbaed991b7fd3a4fd5661a99cb304d56">sorcery_memory_cache::full_backend_cache</a></div><div class="ttdeci">unsigned int full_backend_cache</div><div class="ttdoc">Whether this is a cache of the entire backend, 0 if disabled. </div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d30/res__sorcery__memory__cache_8c_source.html#l00141">res_sorcery_memory_cache.c:141</a></div></div>
<div class="ttc" id="astobj2_8h_html"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html">astobj2.h</a></div></div>
<div class="ttc" id="structsorcery__memory__cache__fields__cmp__params_html_ae9fc6d86a482d56978b6a7de516da7f8"><div class="ttname"><a href="../../d7/d59/structsorcery__memory__cache__fields__cmp__params.html#ae9fc6d86a482d56978b6a7de516da7f8">sorcery_memory_cache_fields_cmp_params::prefix_len</a></div><div class="ttdeci">const size_t prefix_len</div><div class="ttdoc">Prefix length in bytes for matching object id. </div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d30/res__sorcery__memory__cache_8c_source.html#l00193">res_sorcery_memory_cache.c:193</a></div></div>
<div class="ttc" id="sched_8h_html"><div class="ttname"><a href="../../d7/d00/sched_8h.html">sched.h</a></div><div class="ttdoc">Scheduler Routines (derived from cheops) </div></div>
<div class="ttc" id="structsorcery__memory__cache__fields__cmp__params_html_ada420b1f724d02917b97a9b0d5288086"><div class="ttname"><a href="../../d7/d59/structsorcery__memory__cache__fields__cmp__params.html#ada420b1f724d02917b97a9b0d5288086">sorcery_memory_cache_fields_cmp_params::cache</a></div><div class="ttdeci">struct sorcery_memory_cache * cache</div><div class="ttdoc">The sorcery memory cache. </div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d30/res__sorcery__memory__cache_8c_source.html#l00185">res_sorcery_memory_cache.c:185</a></div></div>
<div class="ttc" id="structsorcery__memory__cache__fields__cmp__params_html_aeb33dcb5573e1661c82b5370681fb626"><div class="ttname"><a href="../../d7/d59/structsorcery__memory__cache__fields__cmp__params.html#aeb33dcb5573e1661c82b5370681fb626">sorcery_memory_cache_fields_cmp_params::sorcery</a></div><div class="ttdeci">const struct ast_sorcery * sorcery</div><div class="ttdoc">Pointer to the sorcery structure. </div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d30/res__sorcery__memory__cache_8c_source.html#l00183">res_sorcery_memory_cache.c:183</a></div></div>
<div class="ttc" id="res__sorcery__memory__cache_8c_html_adda5136e1f2b6ee965600a082879388e"><div class="ttname"><a href="../../d7/d30/res__sorcery__memory__cache_8c.html#adda5136e1f2b6ee965600a082879388e">check_cache_content</a></div><div class="ttdeci">static int check_cache_content(struct ast_test *test, struct ast_sorcery *sorcery, struct sorcery_memory_cache *cache, const char **in_cache, size_t num_in_cache, const char **not_in_cache, size_t num_not_in_cache)</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d30/res__sorcery__memory__cache_8c_source.html#l02725">res_sorcery_memory_cache.c:2725</a></div></div>
<div class="ttc" id="astobj2_8h_html_aaca5e8eac39a22f9da1c36fc6c922270"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a></div><div class="ttdeci">#define ao2_ref(o, delta)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l00464">astobj2.h:464</a></div></div>
<div class="ttc" id="astobj2_8h_html_a1f8b41308be4c47de8ff89a3b9c7e7d1a1959468a3c5d6aecd2fa1272d8e30fbf"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#a1f8b41308be4c47de8ff89a3b9c7e7d1a1959468a3c5d6aecd2fa1272d8e30fbf">CMP_MATCH</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l01031">astobj2.h:1031</a></div></div>
<div class="ttc" id="structmansession_html"><div class="ttname"><a href="../../d2/d8a/structmansession.html">mansession</a></div><div class="ttdoc">In case you didn&amp;#39;t read that giant block of text above the mansession_session struct, the struct mansession is named this solely to keep the API the same in Asterisk. This structure really represents data that is different from Manager action to Manager action. The mansession_session pointer contained within points to session-specific data. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d10/manager_8c_source.html#l01625">manager.c:1625</a></div></div>
<div class="ttc" id="structsorcery__memory__cached__object_html"><div class="ttname"><a href="../../df/d93/structsorcery__memory__cached__object.html">sorcery_memory_cached_object</a></div><div class="ttdoc">Structure for stored a cached object. </div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d30/res__sorcery__memory__cache_8c_source.html#l00167">res_sorcery_memory_cache.c:167</a></div></div>
<div class="ttc" id="astobj2_8h_html_aa9fdb5d0a6157a56060d9f7279fe6c49"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#aa9fdb5d0a6157a56060d9f7279fe6c49">ao2_lock</a></div><div class="ttdeci">#define ao2_lock(a)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l00718">astobj2.h:718</a></div></div>
<div class="ttc" id="time_8h_html_a1d774df72e3dbb623475783e06ce4f61"><div class="ttname"><a href="../../de/df7/time_8h.html#a1d774df72e3dbb623475783e06ce4f61">ast_samp2tv</a></div><div class="ttdeci">struct timeval ast_samp2tv(unsigned int _nsamp, unsigned int _rate)</div><div class="ttdoc">Returns a timeval corresponding to the duration of n samples at rate r. Useful to convert samples to ...</div><div class="ttdef"><b>Definition:</b> <a href="../../de/df7/time_8h_source.html#l00238">time.h:238</a></div></div>
<div class="ttc" id="res__sorcery__memory__cache_8c_html_a5d2a76b3fae4c75ffec13a20241a74e9"><div class="ttname"><a href="../../d7/d30/res__sorcery__memory__cache_8c.html#a5d2a76b3fae4c75ffec13a20241a74e9">sorcery_memory_cache_expire</a></div><div class="ttdeci">static char * sorcery_memory_cache_expire(struct ast_cli_entry *e, int cmd, struct ast_cli_args *a)</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d30/res__sorcery__memory__cache_8c_source.html#l01861">res_sorcery_memory_cache.c:1861</a></div></div>
<div class="ttc" id="sorcery_8h_html_a97706283a06cbb44e4f0f9620dd5cf07"><div class="ttname"><a href="../../d8/d25/sorcery_8h.html#a97706283a06cbb44e4f0f9620dd5cf07">ast_sorcery_object_get_id</a></div><div class="ttdeci">const char * ast_sorcery_object_get_id(const void *object)</div><div class="ttdoc">Get the unique identifier of a sorcery object. </div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d69/sorcery_8c_source.html#l02312">sorcery.c:2312</a></div></div>
<div class="ttc" id="structsorcery__memory__cache_html_a59a79dcdae51e4000f776c4c48b8c7d1"><div class="ttname"><a href="../../d2/d6b/structsorcery__memory__cache.html#a59a79dcdae51e4000f776c4c48b8c7d1">sorcery_memory_cache::stale_update_sched_id</a></div><div class="ttdeci">int stale_update_sched_id</div><div class="ttdoc">scheduler id of stale update task </div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d30/res__sorcery__memory__cache_8c_source.html#l00147">res_sorcery_memory_cache.c:147</a></div></div>
<div class="ttc" id="structast__sched__context_html"><div class="ttname"><a href="../../d7/de8/structast__sched__context.html">ast_sched_context</a></div><div class="ttdef"><b>Definition:</b> <a href="../../db/dbe/sched_8c_source.html#l00109">sched.c:109</a></div></div>
<div class="ttc" id="structsorcery__memory__cache_html_a7e8d8ec709f7bce006b45892fa15fdb7"><div class="ttname"><a href="../../d2/d6b/structsorcery__memory__cache.html#a7e8d8ec709f7bce006b45892fa15fdb7">sorcery_memory_cache::expire_on_reload</a></div><div class="ttdeci">unsigned int expire_on_reload</div><div class="ttdoc">Whether all objects are expired when the object type is reloaded, 0 if disabled. </div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d30/res__sorcery__memory__cache_8c_source.html#l00139">res_sorcery_memory_cache.c:139</a></div></div>
<div class="ttc" id="res__sorcery__memory__cache_8c_html_a761d1c9efa33774cc89405895ed848a1"><div class="ttname"><a href="../../d7/d30/res__sorcery__memory__cache_8c.html#a761d1c9efa33774cc89405895ed848a1">sorcery_memory_cache_ami_expire</a></div><div class="ttdeci">static int sorcery_memory_cache_ami_expire(struct mansession *s, const struct message *m)</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d30/res__sorcery__memory__cache_8c_source.html#l02115">res_sorcery_memory_cache.c:2115</a></div></div>
<div class="ttc" id="structtest__data_html_aa1620f4c22693d406d9d5e3bd585695f"><div class="ttname"><a href="../../dc/d9a/structtest__data.html#aa1620f4c22693d406d9d5e3bd585695f">test_data::pepper</a></div><div class="ttdeci">int pepper</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d30/res__sorcery__memory__cache_8c_source.html#l02991">res_sorcery_memory_cache.c:2991</a></div></div>
<div class="ttc" id="res__sorcery__memory__cache_8c_html_ad3cb017e536622a783cbd0cff96b1ce7"><div class="ttname"><a href="../../d7/d30/res__sorcery__memory__cache_8c.html#ad3cb017e536622a783cbd0cff96b1ce7">sorcery_memory_cache_retrieve_prefix</a></div><div class="ttdeci">static void sorcery_memory_cache_retrieve_prefix(const struct ast_sorcery *sorcery, void *data, const char *type, struct ao2_container *objects, const char *prefix, const size_t prefix_len)</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d30/res__sorcery__memory__cache_8c_source.html#l01404">res_sorcery_memory_cache.c:1404</a></div></div>
<div class="ttc" id="astobj2_8h_html_a2cf7e3433f08351aafe3b0cd31edf7f8a8ccf751bd6749d062999469f0694e7ad"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#a2cf7e3433f08351aafe3b0cd31edf7f8a8ccf751bd6749d062999469f0694e7ad">AO2_ALLOC_OPT_LOCK_MUTEX</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l00365">astobj2.h:365</a></div></div>
<div class="ttc" id="res__sorcery__memory__cache_8c_html_a6046abe86f78c86c1140084831686a25"><div class="ttname"><a href="../../d7/d30/res__sorcery__memory__cache_8c.html#a6046abe86f78c86c1140084831686a25">remove_from_cache</a></div><div class="ttdeci">static int remove_from_cache(struct sorcery_memory_cache *cache, const char *id, int reschedule)</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d30/res__sorcery__memory__cache_8c_source.html#l00465">res_sorcery_memory_cache.c:465</a></div></div>
<div class="ttc" id="res__sorcery__memory__cache_8c_html_af5f9133c11b90356f5a24913b7cd66c5"><div class="ttname"><a href="../../d7/d30/res__sorcery__memory__cache_8c.html#af5f9133c11b90356f5a24913b7cd66c5">sorcery_memory_cached_object_destructor</a></div><div class="ttdeci">static void sorcery_memory_cached_object_destructor(void *obj)</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d30/res__sorcery__memory__cache_8c_source.html#l00440">res_sorcery_memory_cache.c:440</a></div></div>
<div class="ttc" id="res__sorcery__memory__cache_8c_html_a9c1643daa6ed7fa4b16780a45f2beeb1"><div class="ttname"><a href="../../d7/d30/res__sorcery__memory__cache_8c.html#a9c1643daa6ed7fa4b16780a45f2beeb1">memory_cache_populate</a></div><div class="ttdeci">static void memory_cache_populate(const struct ast_sorcery *sorcery, const char *type, struct sorcery_memory_cache *cache)</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d30/res__sorcery__memory__cache_8c_source.html#l01034">res_sorcery_memory_cache.c:1034</a></div></div>
<div class="ttc" id="structsorcery__memory__cache_html_ad6bc34b0274c32a28f0b0803da66ee9e"><div class="ttname"><a href="../../d2/d6b/structsorcery__memory__cache.html#ad6bc34b0274c32a28f0b0803da66ee9e">sorcery_memory_cache::expire_id</a></div><div class="ttdeci">int expire_id</div><div class="ttdoc">Scheduler item for expiring oldest object. </div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d30/res__sorcery__memory__cache_8c_source.html#l00145">res_sorcery_memory_cache.c:145</a></div></div>
<div class="ttc" id="sched_8h_html_a5baecc149aeabdbef9b3ed6780c1c4a6"><div class="ttname"><a href="../../d7/d00/sched_8h.html#a5baecc149aeabdbef9b3ed6780c1c4a6">ast_sched_context_create</a></div><div class="ttdeci">struct ast_sched_context * ast_sched_context_create(void)</div><div class="ttdoc">Create a scheduler context. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/dbe/sched_8c_source.html#l00236">sched.c:236</a></div></div>
<div class="ttc" id="test_8h_html_a9482d93ea3931853331bdbc745ce7cb4"><div class="ttname"><a href="../../d2/ddc/test_8h.html#a9482d93ea3931853331bdbc745ce7cb4">ast_test_suite_event_notify</a></div><div class="ttdeci">#define ast_test_suite_event_notify(s, f,...)</div><div class="ttdef"><b>Definition:</b> <a href="../../d2/ddc/test_8h_source.html#l00196">test.h:196</a></div></div>
<div class="ttc" id="structast__cli__args_html_ad0a19c4d63698f9e9cfd5653e8851452"><div class="ttname"><a href="../../d3/dad/structast__cli__args.html#ad0a19c4d63698f9e9cfd5653e8851452">ast_cli_args::argv</a></div><div class="ttdeci">const char *const  * argv</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/db0/cli_8h_source.html#l00161">cli.h:161</a></div></div>
<div class="ttc" id="group__Group__AMI_html_gafadf012f66a9fd7ecf985ec5b9dee101"><div class="ttname"><a href="../../df/d72/group__Group__AMI.html#gafadf012f66a9fd7ecf985ec5b9dee101">ast_manager_unregister</a></div><div class="ttdeci">int ast_manager_unregister(const char *action)</div><div class="ttdoc">Unregister a registered manager command. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d10/manager_8c_source.html#l07258">manager.c:7258</a></div></div>
<div class="ttc" id="res__sorcery__memory__cache_8c_html_a361b448e9abcfc301602a2573a662d3c"><div class="ttname"><a href="../../d7/d30/res__sorcery__memory__cache_8c.html#a361b448e9abcfc301602a2573a662d3c">sched</a></div><div class="ttdeci">static struct ast_sched_context * sched</div><div class="ttdoc">Scheduler for cache management. </div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d30/res__sorcery__memory__cache_8c_source.html#l00244">res_sorcery_memory_cache.c:244</a></div></div>
<div class="ttc" id="manager_8h_html"><div class="ttname"><a href="../../db/d45/manager_8h.html">manager.h</a></div><div class="ttdoc">The AMI - Asterisk Manager Interface - is a TCP protocol created to manage Asterisk with third-party ...</div></div>
<div class="ttc" id="sorcery_8h_html_aa2b2d9798c21334810a480fdc3260bb8"><div class="ttname"><a href="../../d8/d25/sorcery_8h.html#aa2b2d9798c21334810a480fdc3260bb8">ast_sorcery_wizard_register</a></div><div class="ttdeci">#define ast_sorcery_wizard_register(interface)</div><div class="ttdoc">See __ast_sorcery_wizard_register() </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d25/sorcery_8h_source.html#l00383">sorcery.h:383</a></div></div>
<div class="ttc" id="structsorcery__memory__cache_html_a9e6035463adde27a5c155e5221add7cd"><div class="ttname"><a href="../../d2/d6b/structsorcery__memory__cache.html#a9e6035463adde27a5c155e5221add7cd">sorcery_memory_cache::del_expire</a></div><div class="ttdeci">unsigned int del_expire</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d30/res__sorcery__memory__cache_8c_source.html#l00153">res_sorcery_memory_cache.c:153</a></div></div>
<div class="ttc" id="res__sorcery__memory__cache_8c_html_a556435fe0ff7dea99df054fac75dce8d"><div class="ttname"><a href="../../d7/d30/res__sorcery__memory__cache_8c.html#a556435fe0ff7dea99df054fac75dce8d">memory_cache_stale_check_object</a></div><div class="ttdeci">static void memory_cache_stale_check_object(const struct ast_sorcery *sorcery, struct sorcery_memory_cache *cache, struct sorcery_memory_cached_object *cached)</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d30/res__sorcery__memory__cache_8c_source.html#l01158">res_sorcery_memory_cache.c:1158</a></div></div>
<div class="ttc" id="structstale__cache__update__task__data_html_a23506fc4821ab6d9671f3e6222591a96"><div class="ttname"><a href="../../df/df7/structstale__cache__update__task__data.html#a23506fc4821ab6d9671f3e6222591a96">stale_cache_update_task_data::type</a></div><div class="ttdeci">char * type</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d30/res__sorcery__memory__cache_8c_source.html#l00874">res_sorcery_memory_cache.c:874</a></div></div>
<div class="ttc" id="logger_8h_html_aced66975c154ea0e2a8ec3bc818b4e08"><div class="ttname"><a href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a></div><div class="ttdeci">#define LOG_ERROR</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d8c/logger_8h_source.html#l00285">logger.h:285</a></div></div>
<div class="ttc" id="time_8h_html_a6daa33e2052acd094bb63e78aba29733"><div class="ttname"><a href="../../de/df7/time_8h.html#a6daa33e2052acd094bb63e78aba29733">ast_tvcmp</a></div><div class="ttdeci">int ast_tvcmp(struct timeval _a, struct timeval _b)</div><div class="ttdoc">Compres two struct timeval instances returning -1, 0, 1 if the first arg is smaller, equal or greater to the second. </div><div class="ttdef"><b>Definition:</b> <a href="../../de/df7/time_8h_source.html#l00128">time.h:128</a></div></div>
<div class="ttc" id="astobj2_8h_html_aefc16f8aa9087cbc5c55c70cf1dd41b2"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#aefc16f8aa9087cbc5c55c70cf1dd41b2">ao2_container_alloc_hash</a></div><div class="ttdeci">#define ao2_container_alloc_hash(ao2_options, container_options, n_buckets, hash_fn, sort_fn, cmp_fn)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l01310">astobj2.h:1310</a></div></div>
<div class="ttc" id="sorcery_8h_html_a6f16dd100bbc816e1d8eb67026ab4ee3"><div class="ttname"><a href="../../d8/d25/sorcery_8h.html#a6f16dd100bbc816e1d8eb67026ab4ee3">ast_sorcery_internal_object_register</a></div><div class="ttdeci">#define ast_sorcery_internal_object_register(sorcery, type, alloc, transform, apply)</div><div class="ttdoc">Register an internal, hidden object type. </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d25/sorcery_8h_source.html#l00868">sorcery.h:868</a></div></div>
<div class="ttc" id="strings_8h_html_a387a69b3871ca31061566a73f45d20f4"><div class="ttname"><a href="../../d6/d90/strings_8h.html#a387a69b3871ca31061566a73f45d20f4">ast_true</a></div><div class="ttdeci">int attribute_pure ast_true(const char *val)</div><div class="ttdoc">Make sure something is true. Determine if a string containing a boolean value is &quot;true&quot;. This function checks to see whether a string passed to it is an indication of an &quot;true&quot; value. It checks to see if the string is &quot;yes&quot;, &quot;true&quot;, &quot;y&quot;, &quot;t&quot;, &quot;on&quot; or &quot;1&quot;. </div><div class="ttdef"><b>Definition:</b> <a href="../../de/d1f/main_2utils_8c_source.html#l01951">main/utils.c:1951</a></div></div>
<div class="ttc" id="res__sorcery__memory__cache_8c_html_ab6ca326a1f05631b3e363a4302069c93"><div class="ttname"><a href="../../d7/d30/res__sorcery__memory__cache_8c.html#ab6ca326a1f05631b3e363a4302069c93">remove_all_from_cache</a></div><div class="ttdeci">static void remove_all_from_cache(struct sorcery_memory_cache *cache)</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d30/res__sorcery__memory__cache_8c_source.html#l00554">res_sorcery_memory_cache.c:554</a></div></div>
<div class="ttc" id="structprint__object__details_html"><div class="ttname"><a href="../../d7/d2a/structprint__object__details.html">print_object_details</a></div><div class="ttdoc">Structure used to pass data for printing cached object information. </div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d30/res__sorcery__memory__cache_8c_source.html#l01733">res_sorcery_memory_cache.c:1733</a></div></div>
<div class="ttc" id="sorcery_8h_html_a27ab062271c22bdbc2b6f5d607c980cf"><div class="ttname"><a href="../../d8/d25/sorcery_8h.html#a27ab062271c22bdbc2b6f5d607c980cf">SORCERY_OBJECT</a></div><div class="ttdeci">#define SORCERY_OBJECT(details)</div><div class="ttdoc">Macro which must be used at the beginning of each sorcery capable object. </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d25/sorcery_8h_source.html#l00356">sorcery.h:356</a></div></div>
<div class="ttc" id="res__sorcery__memory__cache_8c_html_a42cfb1ae93ed6226126180bc40c3eb7c"><div class="ttname"><a href="../../d7/d30/res__sorcery__memory__cache_8c.html#a42cfb1ae93ed6226126180bc40c3eb7c">test_data_alloc</a></div><div class="ttdeci">static void * test_data_alloc(const char *id)</div><div class="ttdoc">Allocation callback for test_data sorcery object. </div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d30/res__sorcery__memory__cache_8c_source.html#l02997">res_sorcery_memory_cache.c:2997</a></div></div>
<div class="ttc" id="res__sorcery__memory__cache_8c_html_ac327a9bcce9e826693e6eb851af0f0dc"><div class="ttname"><a href="../../d7/d30/res__sorcery__memory__cache_8c.html#ac327a9bcce9e826693e6eb851af0f0dc">remove_oldest_from_cache</a></div><div class="ttdeci">static int remove_oldest_from_cache(struct sorcery_memory_cache *cache)</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d30/res__sorcery__memory__cache_8c_source.html#l00695">res_sorcery_memory_cache.c:695</a></div></div>
<div class="ttc" id="astobj2_8h_html_a64f51be4bee35c38dbe59b0a788b5ce8"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#a64f51be4bee35c38dbe59b0a788b5ce8">ao2_unlink</a></div><div class="ttdeci">#define ao2_unlink(container, obj)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l01598">astobj2.h:1598</a></div></div>
<div class="ttc" id="res__sorcery__memory__cache_8c_html_ae8c811d7666eaefff6b737ad4b574671"><div class="ttname"><a href="../../d7/d30/res__sorcery__memory__cache_8c.html#ae8c811d7666eaefff6b737ad4b574671">caches</a></div><div class="ttdeci">static struct ao2_container * caches</div><div class="ttdoc">Container of created caches. </div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d30/res__sorcery__memory__cache_8c_source.html#l00241">res_sorcery_memory_cache.c:241</a></div></div>
<div class="ttc" id="cli_8h_html_a0873456096960dab21fff0ce68c95acb"><div class="ttname"><a href="../../dc/db0/cli_8h.html#a0873456096960dab21fff0ce68c95acb">CLI_SHOWUSAGE</a></div><div class="ttdeci">#define CLI_SHOWUSAGE</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/db0/cli_8h_source.html#l00045">cli.h:45</a></div></div>
<div class="ttc" id="sorcery_8h_html_a14ed6490f3390526922655ab5dbc344f"><div class="ttname"><a href="../../d8/d25/sorcery_8h.html#a14ed6490f3390526922655ab5dbc344f">ast_sorcery_wizard_unregister</a></div><div class="ttdeci">int ast_sorcery_wizard_unregister(const struct ast_sorcery_wizard *interface)</div><div class="ttdoc">Unregister a sorcery wizard. </div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d69/sorcery_8c_source.html#l00474">sorcery.c:474</a></div></div>
<div class="ttc" id="res__sorcery__memory__cache_8c_html_a20de7198ad993d1e69f0c4e53bd1cd26"><div class="ttname"><a href="../../d7/d30/res__sorcery__memory__cache_8c.html#a20de7198ad993d1e69f0c4e53bd1cd26">stale_cache_update_task_data_destructor</a></div><div class="ttdeci">static void stale_cache_update_task_data_destructor(void *obj)</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d30/res__sorcery__memory__cache_8c_source.html#l00877">res_sorcery_memory_cache.c:877</a></div></div>
<div class="ttc" id="test_8h_html_a79bc64a935b14b1b181156e5ada58ead"><div class="ttname"><a href="../../d2/ddc/test_8h.html#a79bc64a935b14b1b181156e5ada58ead">AST_TEST_UNREGISTER</a></div><div class="ttdeci">#define AST_TEST_UNREGISTER(cb)</div><div class="ttdef"><b>Definition:</b> <a href="../../d2/ddc/test_8h_source.html#l00128">test.h:128</a></div></div>
<div class="ttc" id="time_8h_html_a904a6933b710e14c7fa2029a0f0cc91a"><div class="ttname"><a href="../../de/df7/time_8h.html#a904a6933b710e14c7fa2029a0f0cc91a">ast_remaining_ms</a></div><div class="ttdeci">int ast_remaining_ms(struct timeval start, int max_ms)</div><div class="ttdoc">Calculate remaining milliseconds given a starting timestamp and upper bound. </div><div class="ttdef"><b>Definition:</b> <a href="../../de/d1f/main_2utils_8c_source.html#l02033">main/utils.c:2033</a></div></div>
<div class="ttc" id="namespacesip__to__pjsip_html_ab82f408a83ecba10ea39afd8abfd371e"><div class="ttname"><a href="../../dd/d17/namespacesip__to__pjsip.html#ab82f408a83ecba10ea39afd8abfd371e">sip_to_pjsip.info</a></div><div class="ttdeci">def info(msg)</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d6f/sip__to__pjsip_8py_source.html#l01313">sip_to_pjsip.py:1313</a></div></div>
<div class="ttc" id="astobj2_8h_html_a24c1bf4b1202c996cf8a793fa6669bc2"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#a24c1bf4b1202c996cf8a793fa6669bc2">ao2_rdlock</a></div><div class="ttdeci">#define ao2_rdlock(a)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l00719">astobj2.h:719</a></div></div>
<div class="ttc" id="sorcery_8h_html_ad1165cf9d45ed5ffa1555371be9ae770"><div class="ttname"><a href="../../d8/d25/sorcery_8h.html#ad1165cf9d45ed5ffa1555371be9ae770">ast_sorcery_apply_default</a></div><div class="ttdeci">#define ast_sorcery_apply_default(sorcery, type, name, data)</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d25/sorcery_8h_source.html#l00477">sorcery.h:477</a></div></div>
<div class="ttc" id="astobj2_8h_html_a63fd831fe48aed32d3ef992ad8e45293"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#a63fd831fe48aed32d3ef992ad8e45293">ao2_callback_data</a></div><div class="ttdeci">#define ao2_callback_data(container, flags, cb_fn, arg, data)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l01743">astobj2.h:1743</a></div></div>
<div class="ttc" id="time_8h_html_a97e1bb8fbd7a103212789e87e7ed6073"><div class="ttname"><a href="../../de/df7/time_8h.html#a97e1bb8fbd7a103212789e87e7ed6073">ast_tvadd</a></div><div class="ttdeci">struct timeval ast_tvadd(struct timeval a, struct timeval b)</div><div class="ttdoc">Returns the sum of two timevals a + b. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/dc5/extconf_8c_source.html#l02283">extconf.c:2283</a></div></div>
<div class="ttc" id="structtest__data_html"><div class="ttname"><a href="../../dc/d9a/structtest__data.html">test_data</a></div><div class="ttdoc">Sorcery object created based on backend data. </div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d30/res__sorcery__memory__cache_8c_source.html#l02986">res_sorcery_memory_cache.c:2986</a></div></div>
<div class="ttc" id="res__sorcery__memory__cache_8c_html_a56cee8e124bf2766c1e1d71ccfb464cd"><div class="ttname"><a href="../../d7/d30/res__sorcery__memory__cache_8c.html#a56cee8e124bf2766c1e1d71ccfb464cd">sorcery_memory_cache_fields_cmp</a></div><div class="ttdeci">static int sorcery_memory_cache_fields_cmp(void *obj, void *arg, int flags)</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d30/res__sorcery__memory__cache_8c_source.html#l01254">res_sorcery_memory_cache.c:1254</a></div></div>
<div class="ttc" id="astobj2_8h_html_a2cf7e3433f08351aafe3b0cd31edf7f8a7016a58d1b7524c186ccc72ec48ef488"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#a2cf7e3433f08351aafe3b0cd31edf7f8a7016a58d1b7524c186ccc72ec48ef488">AO2_ALLOC_OPT_LOCK_RWLOCK</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l00367">astobj2.h:367</a></div></div>
<div class="ttc" id="structtask__data_html"><div class="ttname"><a href="../../d1/dd9/structtask__data.html">task_data</a></div><div class="ttdoc">userdata associated with baseline taskprocessor test </div><div class="ttdef"><b>Definition:</b> <a href="../../df/df7/test__taskprocessor_8c_source.html#l00044">test_taskprocessor.c:44</a></div></div>
<div class="ttc" id="structstale__update__task__data_html_ada420b1f724d02917b97a9b0d5288086"><div class="ttname"><a href="../../da/d04/structstale__update__task__data.html#ada420b1f724d02917b97a9b0d5288086">stale_update_task_data::cache</a></div><div class="ttdeci">struct sorcery_memory_cache * cache</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d30/res__sorcery__memory__cache_8c_source.html#l00958">res_sorcery_memory_cache.c:958</a></div></div>
<div class="ttc" id="astobj2_8h_html_a17990ea630db7dbd1252ef0132133a2b"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#a17990ea630db7dbd1252ef0132133a2b">ao2_iterator_next</a></div><div class="ttdeci">#define ao2_iterator_next(iter)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l01933">astobj2.h:1933</a></div></div>
<div class="ttc" id="lock_8h_html_a1ea2f4040a736cddbecea48b30ffedfd"><div class="ttname"><a href="../../dd/d42/lock_8h.html#a1ea2f4040a736cddbecea48b30ffedfd">ast_cond_destroy</a></div><div class="ttdeci">#define ast_cond_destroy(cond)</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d42/lock_8h_source.html#l00200">lock.h:200</a></div></div>
<div class="ttc" id="astobj2_8h_html_ae0422b60d8e25b6962b2d61ae4ddf724"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#ae0422b60d8e25b6962b2d61ae4ddf724">ao2_alloc</a></div><div class="ttdeci">#define ao2_alloc(data_size, destructor_fn)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l00411">astobj2.h:411</a></div></div>
<div class="ttc" id="sorcery_8h_html_acb6c97c18566cf94a7ac95a43dd9a816"><div class="ttname"><a href="../../d8/d25/sorcery_8h.html#acb6c97c18566cf94a7ac95a43dd9a816">ast_sorcery_alloc</a></div><div class="ttdeci">void * ast_sorcery_alloc(const struct ast_sorcery *sorcery, const char *type, const char *id)</div><div class="ttdoc">Allocate an object. </div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d69/sorcery_8c_source.html#l01744">sorcery.c:1744</a></div></div>
<div class="ttc" id="test_8h_html_aad2aec78205d328d23894a6598cc4044a7a3ab73c870a7ce6cf1a0f3cfd42a37b"><div class="ttname"><a href="../../d2/ddc/test_8h.html#aad2aec78205d328d23894a6598cc4044a7a3ab73c870a7ce6cf1a0f3cfd42a37b">AST_TEST_PASS</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d2/ddc/test_8h_source.html#l00202">test.h:202</a></div></div>
<div class="ttc" id="structbackend__data_html"><div class="ttname"><a href="../../d2/d13/structbackend__data.html">backend_data</a></div><div class="ttdoc">Backend data that the mock sorcery wizard uses to create objects. </div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d30/res__sorcery__memory__cache_8c_source.html#l02974">res_sorcery_memory_cache.c:2974</a></div></div>
<div class="ttc" id="sorcery_8h_html_a197b6724158db0da59852d25d36fa5f1"><div class="ttname"><a href="../../d8/d25/sorcery_8h.html#a197b6724158db0da59852d25d36fa5f1">ast_sorcery_objectset_create</a></div><div class="ttdeci">#define ast_sorcery_objectset_create(sorcery, object)</div><div class="ttdoc">Create an object set (KVP list) for an object. </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d25/sorcery_8h_source.html#l01136">sorcery.h:1136</a></div></div>
<div class="ttc" id="res__sorcery__memory__cache_8c_html_a84a61df59852cbf3d4896f2d7517047e"><div class="ttname"><a href="../../d7/d30/res__sorcery__memory__cache_8c.html#a84a61df59852cbf3d4896f2d7517047e">expire_objects_from_cache</a></div><div class="ttdeci">static int expire_objects_from_cache(const void *data)</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d30/res__sorcery__memory__cache_8c_source.html#l00498">res_sorcery_memory_cache.c:498</a></div></div>
<div class="ttc" id="cli_8h_html_ae47751901c430ebb833e59291a5e0b3f"><div class="ttname"><a href="../../dc/db0/cli_8h.html#ae47751901c430ebb833e59291a5e0b3f">CLI_FAILURE</a></div><div class="ttdeci">#define CLI_FAILURE</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/db0/cli_8h_source.html#l00046">cli.h:46</a></div></div>
<div class="ttc" id="astmm_8h_html_a402072d6789f6ed9e3a81da27504127e"><div class="ttname"><a href="../../d8/d8a/astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a></div><div class="ttdeci">#define ast_free(a)</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d8a/astmm_8h_source.html#l00182">astmm.h:182</a></div></div>
<div class="ttc" id="structast__cli__entry_html_ade9cba72805fe52685a1deea307a8e82"><div class="ttname"><a href="../../d8/d07/structast__cli__entry.html#ade9cba72805fe52685a1deea307a8e82">ast_cli_entry::command</a></div><div class="ttdeci">char * command</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/db0/cli_8h_source.html#l00186">cli.h:186</a></div></div>
<div class="ttc" id="func__strings_8c_html_a1b62eb9e3ebf087509f4301aa6336931"><div class="ttname"><a href="../../d9/d1e/func__strings_8c.html#a1b62eb9e3ebf087509f4301aa6336931">regex</a></div><div class="ttdeci">static int regex(struct ast_channel *chan, const char *cmd, char *parse, char *buf, size_t len)</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d1e/func__strings_8c_source.html#l00948">func_strings.c:948</a></div></div>
<div class="ttc" id="cdr__mysql_8c_html_ad1982509765f4870f1f63412a53ea668"><div class="ttname"><a href="../../d0/d29/cdr__mysql_8c.html#ad1982509765f4870f1f63412a53ea668">reload</a></div><div class="ttdeci">static int reload(void)</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d29/cdr__mysql_8c_source.html#l00741">cdr_mysql.c:741</a></div></div>
<div class="ttc" id="structsorcery__memory__cached__object_html_a077376d12464f945e2414d5499c79b3f"><div class="ttname"><a href="../../df/d93/structsorcery__memory__cached__object.html#a077376d12464f945e2414d5499c79b3f">sorcery_memory_cached_object::object</a></div><div class="ttdeci">void * object</div><div class="ttdoc">The cached object. </div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d30/res__sorcery__memory__cache_8c_source.html#l00169">res_sorcery_memory_cache.c:169</a></div></div>
<div class="ttc" id="res__sorcery__memory__cache_8c_html_ac3d8ebcb3363c9044516347d76393007"><div class="ttname"><a href="../../d7/d30/res__sorcery__memory__cache_8c.html#ac3d8ebcb3363c9044516347d76393007">memory_cache_stale_update_full</a></div><div class="ttdeci">static void memory_cache_stale_update_full(const struct ast_sorcery *sorcery, struct sorcery_memory_cache *cache, const char *type)</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d30/res__sorcery__memory__cache_8c_source.html#l01098">res_sorcery_memory_cache.c:1098</a></div></div>
<div class="ttc" id="uuid_8h_html_abe6d0b550cd9a54964e7891960d1e5bc"><div class="ttname"><a href="../../dd/d1d/uuid_8h.html#abe6d0b550cd9a54964e7891960d1e5bc">ast_uuid_generate_str</a></div><div class="ttdeci">char * ast_uuid_generate_str(char *buf, size_t size)</div><div class="ttdoc">Generate a UUID string. </div><div class="ttdef"><b>Definition:</b> <a href="../../df/da9/uuid_8c_source.html#l00143">uuid.c:143</a></div></div>
<div class="ttc" id="structast__cli__args_html_adc1f34651f7bbfa3ba5af27db5f53817"><div class="ttname"><a href="../../d3/dad/structast__cli__args.html#adc1f34651f7bbfa3ba5af27db5f53817">ast_cli_args::word</a></div><div class="ttdeci">const char * word</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/db0/cli_8h_source.html#l00163">cli.h:163</a></div></div>
<div class="ttc" id="res__sorcery__memory__cache_8c_html_a8c078864ef352717e61f7435221ee7c4"><div class="ttname"><a href="../../d7/d30/res__sorcery__memory__cache_8c.html#a8c078864ef352717e61f7435221ee7c4">memory_cache_full_update</a></div><div class="ttdeci">static void memory_cache_full_update(const struct ast_sorcery *sorcery, const char *type, struct sorcery_memory_cache *cache)</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d30/res__sorcery__memory__cache_8c_source.html#l01077">res_sorcery_memory_cache.c:1077</a></div></div>
<div class="ttc" id="module_8h_html_adc09474f0ff557e9925b722ee5b952dfac742921e9f9512d28f62c74ea2affe57"><div class="ttname"><a href="../../d5/d16/module_8h.html#adc09474f0ff557e9925b722ee5b952dfac742921e9f9512d28f62c74ea2affe57">AST_MODULE_LOAD_DECLINE</a></div><div class="ttdoc">Module has failed to load, may be in an inconsistent state. </div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d16/module_8h_source.html#l00078">module.h:78</a></div></div>
<div class="ttc" id="res__sorcery__memory__cache_8c_html_abdd3c23b47eaf1227982904174a28632"><div class="ttname"><a href="../../d7/d30/res__sorcery__memory__cache_8c.html#abdd3c23b47eaf1227982904174a28632">wait_for_cache_update</a></div><div class="ttdeci">static int wait_for_cache_update(const struct ast_sorcery *sorcery, void *previous_object, struct test_data **new_object)</div><div class="ttdoc">Wait for the cache to be updated after a stale object is retrieved. </div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d30/res__sorcery__memory__cache_8c_source.html#l03099">res_sorcery_memory_cache.c:3099</a></div></div>
<div class="ttc" id="astobj2_8h_html_a911e0703891a9a7aaf73978152092586"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#a911e0703891a9a7aaf73978152092586">ao2_find</a></div><div class="ttdeci">#define ao2_find(container, arg, flags)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l01756">astobj2.h:1756</a></div></div>
<div class="ttc" id="structstate_html"><div class="ttname"><a href="../../d4/d88/structstate.html">state</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d9/df8/localtime_8c_source.html#l00158">localtime.c:158</a></div></div>
<div class="ttc" id="structstale__cache__update__task__data_html_ada420b1f724d02917b97a9b0d5288086"><div class="ttname"><a href="../../df/df7/structstale__cache__update__task__data.html#ada420b1f724d02917b97a9b0d5288086">stale_cache_update_task_data::cache</a></div><div class="ttdeci">struct sorcery_memory_cache * cache</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d30/res__sorcery__memory__cache_8c_source.html#l00873">res_sorcery_memory_cache.c:873</a></div></div>
<div class="ttc" id="sched_8h_html_a7a43dcf8be6b2ed7f96f3867fbcb4082"><div class="ttname"><a href="../../d7/d00/sched_8h.html#a7a43dcf8be6b2ed7f96f3867fbcb4082">ast_sched_add</a></div><div class="ttdeci">int ast_sched_add(struct ast_sched_context *con, int when, ast_sched_cb callback, const void *data) attribute_warn_unused_result</div><div class="ttdoc">Adds a scheduled event. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/dbe/sched_8c_source.html#l00565">sched.c:565</a></div></div>
<div class="ttc" id="pbx__realtime_8c_html_a10b51e1931bd03dd172cbfb9d3d67efb"><div class="ttname"><a href="../../d2/d2c/pbx__realtime_8c.html#a10b51e1931bd03dd172cbfb9d3d67efb">cleanup</a></div><div class="ttdeci">static void * cleanup(void *unused)</div><div class="ttdef"><b>Definition:</b> <a href="../../d2/d2c/pbx__realtime_8c_source.html#l00124">pbx_realtime.c:124</a></div></div>
<div class="ttc" id="heap_8h_html_a42b42e04887dbc86276e590141147f63"><div class="ttname"><a href="../../da/ddb/heap_8h.html#a42b42e04887dbc86276e590141147f63">ast_heap_create</a></div><div class="ttdeci">#define ast_heap_create(init_height, cmp_fn, index_offset)</div><div class="ttdef"><b>Definition:</b> <a href="../../da/ddb/heap_8h_source.html#l00102">heap.h:102</a></div></div>
<div class="ttc" id="res__phoneprov_8c_html_addaa208b0ed785225e24490fb9f28a80"><div class="ttname"><a href="../../d9/de9/res__phoneprov_8c.html#addaa208b0ed785225e24490fb9f28a80">AST_MODULE_INFO</a></div><div class="ttdeci">AST_MODULE_INFO(ASTERISK_GPL_KEY, AST_MODFLAG_GLOBAL_SYMBOLS|AST_MODFLAG_LOAD_ORDER, &quot;HTTP Phone Provisioning&quot;,.support_level=AST_MODULE_SUPPORT_EXTENDED,.load=load_module,.unload=unload_module,.reload=reload,.load_pri=AST_MODPRI_CHANNEL_DEPEND,.requires=&quot;http&quot;,)</div></div>
<div class="ttc" id="structtest_html"><div class="ttname"><a href="../../d8/d89/structtest.html">test</a></div><div class="ttdef"><b>Definition:</b> <a href="../../de/d7d/test__logger_8c_source.html#l00043">test_logger.c:43</a></div></div>
<div class="ttc" id="pbx__realtime_8c_html_aefe318d32c8bb7a9e2025eb146d47781"><div class="ttname"><a href="../../d2/d2c/pbx__realtime_8c.html#aefe318d32c8bb7a9e2025eb146d47781">cache</a></div><div class="ttdeci">struct ao2_container * cache</div><div class="ttdef"><b>Definition:</b> <a href="../../d2/d2c/pbx__realtime_8c_source.html#l00077">pbx_realtime.c:77</a></div></div>
<div class="ttc" id="structast__cli__entry_html_aef1bd6ad890a110b466cb0e8088507a2"><div class="ttname"><a href="../../d8/d07/structast__cli__entry.html#aef1bd6ad890a110b466cb0e8088507a2">ast_cli_entry::usage</a></div><div class="ttdeci">const char * usage</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/db0/cli_8h_source.html#l00177">cli.h:177</a></div></div>
<div class="ttc" id="sorcery_8h_html_aaa9cd237841a70862001f580b23212c9"><div class="ttname"><a href="../../d8/d25/sorcery_8h.html#aaa9cd237841a70862001f580b23212c9">ast_sorcery_retrieve_by_fields</a></div><div class="ttdeci">void * ast_sorcery_retrieve_by_fields(const struct ast_sorcery *sorcery, const char *type, unsigned int flags, struct ast_variable *fields)</div><div class="ttdoc">Retrieve an object or multiple objects using specific fields. </div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d69/sorcery_8c_source.html#l01897">sorcery.c:1897</a></div></div>
<div class="ttc" id="res__sorcery__memory__cache_8c_html_a629f9405d8ea21f16479c4b40197120d"><div class="ttname"><a href="../../d7/d30/res__sorcery__memory__cache_8c.html#a629f9405d8ea21f16479c4b40197120d">cli_memory_cache</a></div><div class="ttdeci">static struct ast_cli_entry cli_memory_cache[]</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d30/res__sorcery__memory__cache_8c_source.html#l02057">res_sorcery_memory_cache.c:2057</a></div></div>
<div class="ttc" id="structast__sorcery__wizard_html"><div class="ttname"><a href="../../dd/d0a/structast__sorcery__wizard.html">ast_sorcery_wizard</a></div><div class="ttdoc">Interface for a sorcery wizard. </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d25/sorcery_8h_source.html#l00276">sorcery.h:276</a></div></div>
<div class="ttc" id="cli_8h_html_a50989f00b32eeb2516a3803cb2ffb766"><div class="ttname"><a href="../../dc/db0/cli_8h.html#a50989f00b32eeb2516a3803cb2ffb766">CLI_SUCCESS</a></div><div class="ttdeci">#define CLI_SUCCESS</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/db0/cli_8h_source.html#l00044">cli.h:44</a></div></div>
<div class="ttc" id="res__sorcery__memory__cache_8c_html_aabdbeb4b0dcc076ebdd36377fce2013d"><div class="ttname"><a href="../../d7/d30/res__sorcery__memory__cache_8c.html#aabdbeb4b0dcc076ebdd36377fce2013d">stale_update_task_data_alloc</a></div><div class="ttdeci">static struct stale_update_task_data * stale_update_task_data_alloc(struct ast_sorcery *sorcery, struct sorcery_memory_cache *cache, const char *type, void *object)</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d30/res__sorcery__memory__cache_8c_source.html#l00971">res_sorcery_memory_cache.c:971</a></div></div>
<div class="ttc" id="cli_8h_html_ab33e5350a923c3a8cedbeb496cd88ec9a76bf33139279b03ec1691f2be2d1be40"><div class="ttname"><a href="../../dc/db0/cli_8h.html#ab33e5350a923c3a8cedbeb496cd88ec9a76bf33139279b03ec1691f2be2d1be40">CLI_GENERATE</a></div><div class="ttdef"><b>Definition:</b> <a href="../../dc/db0/cli_8h_source.html#l00153">cli.h:153</a></div></div>
<div class="ttc" id="astobj2_8h_html_ad9d009e87e737af900825b36db55a35ca4a56217fdad3e940fa6b87dfd296c829"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#ad9d009e87e737af900825b36db55a35ca4a56217fdad3e940fa6b87dfd296c829">OBJ_SEARCH_OBJECT</a></div><div class="ttdoc">The arg parameter is an object of the same type. </div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l01091">astobj2.h:1091</a></div></div>
<div class="ttc" id="heap_8h_html_ac68d03b30bb0adc489ccd67a11873b59"><div class="ttname"><a href="../../da/ddb/heap_8h.html#ac68d03b30bb0adc489ccd67a11873b59">ast_heap_remove</a></div><div class="ttdeci">void * ast_heap_remove(struct ast_heap *h, void *elm)</div><div class="ttdoc">Remove a specific element from a heap. </div><div class="ttdef"><b>Definition:</b> <a href="../../d2/d29/heap_8c_source.html#l00251">heap.c:251</a></div></div>
<div class="ttc" id="include_2asterisk_2compat_8h_html_a40eca58273c74a20a17f137d18ba826c"><div class="ttname"><a href="../../de/da3/include_2asterisk_2compat_8h.html#a40eca58273c74a20a17f137d18ba826c">strsep</a></div><div class="ttdeci">char * strsep(char **str, const char *delims)</div></div>
<div class="ttc" id="res__sorcery__memory__cache_8c_html_a3af131f13cb4426b2bce7a8b077849bb"><div class="ttname"><a href="../../d7/d30/res__sorcery__memory__cache_8c.html#a3af131f13cb4426b2bce7a8b077849bb">sorcery_memory_cache_destructor</a></div><div class="ttdeci">static void sorcery_memory_cache_destructor(void *obj)</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d30/res__sorcery__memory__cache_8c_source.html#l00422">res_sorcery_memory_cache.c:422</a></div></div>
<div class="ttc" id="sorcery_8h_html_af7a3667fd0c15838da1a7bca838f6eeea2f5cefe801ae693345fd663ad71351be"><div class="ttname"><a href="../../d8/d25/sorcery_8h.html#af7a3667fd0c15838da1a7bca838f6eeea2f5cefe801ae693345fd663ad71351be">AST_SORCERY_APPLY_SUCCESS</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d25/sorcery_8h_source.html#l00428">sorcery.h:428</a></div></div>
<div class="ttc" id="include_2asterisk_2config_8h_html_ad25b8d6e1ba6692683c35625e5301c1e"><div class="ttname"><a href="../../d3/de6/include_2asterisk_2config_8h.html#ad25b8d6e1ba6692683c35625e5301c1e">ast_variable_lists_match</a></div><div class="ttdeci">int ast_variable_lists_match(const struct ast_variable *left, const struct ast_variable *right, int exact_match)</div><div class="ttdoc">Tests 2 variable lists to see if they match. </div><div class="ttdef"><b>Definition:</b> <a href="../../d2/d9d/main_2config_8c_source.html#l00772">main/config.c:772</a></div></div>
<div class="ttc" id="structast__test_html"><div class="ttname"><a href="../../d9/d79/structast__test.html">ast_test</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d8/db9/test_8c_source.html#l00065">test.c:65</a></div></div>
<div class="ttc" id="structao2__iterator_html"><div class="ttname"><a href="../../d9/d97/structao2__iterator.html">ao2_iterator</a></div><div class="ttdoc">When we need to walk through a container, we use an ao2_iterator to keep track of the current positio...</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l01841">astobj2.h:1841</a></div></div>
<div class="ttc" id="astobj2_8h_html_a6321ee982370c55ab3c24c72c562cbdd"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#a6321ee982370c55ab3c24c72c562cbdd">ao2_cleanup</a></div><div class="ttdeci">#define ao2_cleanup(obj)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l01958">astobj2.h:1958</a></div></div>
<div class="ttc" id="cli_8h_html"><div class="ttname"><a href="../../dc/db0/cli_8h.html">cli.h</a></div><div class="ttdoc">Standard Command Line Interface. </div></div>
<div class="ttc" id="structast__cli__args_html_a4b911d12699acbbb5a8b62355b35bae8"><div class="ttname"><a href="../../d3/dad/structast__cli__args.html#a4b911d12699acbbb5a8b62355b35bae8">ast_cli_args::pos</a></div><div class="ttdeci">const int pos</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/db0/cli_8h_source.html#l00164">cli.h:164</a></div></div>
<div class="ttc" id="structsorcery__memory__cache_html_aaa0b4796a46428e565991525a543f4f0"><div class="ttname"><a href="../../d2/d6b/structsorcery__memory__cache.html#aaa0b4796a46428e565991525a543f4f0">sorcery_memory_cache::object_type</a></div><div class="ttdeci">char * object_type</div><div class="ttdoc">The type of object we are caching. </div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d30/res__sorcery__memory__cache_8c_source.html#l00151">res_sorcery_memory_cache.c:151</a></div></div>
<div class="ttc" id="res__sorcery__memory__cache_8c_html_a308b0239d5b6189ab1fd75e101a82326"><div class="ttname"><a href="../../d7/d30/res__sorcery__memory__cache_8c.html#a308b0239d5b6189ab1fd75e101a82326">CACHES_CONTAINER_BUCKET_SIZE</a></div><div class="ttdeci">#define CACHES_CONTAINER_BUCKET_SIZE</div><div class="ttdoc">The bucket size for the container of caches. </div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d30/res__sorcery__memory__cache_8c_source.html#l00232">res_sorcery_memory_cache.c:232</a></div></div>
<div class="ttc" id="res__sorcery__memory__cache_8c_html_af9b170dc8108e107601ebfdc5b0ed1ed"><div class="ttname"><a href="../../d7/d30/res__sorcery__memory__cache_8c.html#af9b170dc8108e107601ebfdc5b0ed1ed">alloc_and_initialize_sorcery</a></div><div class="ttdeci">static struct ast_sorcery * alloc_and_initialize_sorcery(void)</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d30/res__sorcery__memory__cache_8c_source.html#l02300">res_sorcery_memory_cache.c:2300</a></div></div>
<div class="ttc" id="res__sorcery__memory__cache_8c_html_ab79b499f6e1269a7b4156fd60467fa27"><div class="ttname"><a href="../../d7/d30/res__sorcery__memory__cache_8c.html#ab79b499f6e1269a7b4156fd60467fa27">sorcery_memory_cache_stale</a></div><div class="ttdeci">static char * sorcery_memory_cache_stale(struct ast_cli_entry *e, int cmd, struct ast_cli_args *a)</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d30/res__sorcery__memory__cache_8c_source.html#l01917">res_sorcery_memory_cache.c:1917</a></div></div>
<div class="ttc" id="structsorcery__memory__cache_html_aa0a84e33972901716d6d5a6dcf1a68de"><div class="ttname"><a href="../../d2/d6b/structsorcery__memory__cache.html#aa0a84e33972901716d6d5a6dcf1a68de">sorcery_memory_cache::objects</a></div><div class="ttdeci">struct ao2_container * objects</div><div class="ttdoc">Objects in the cache. </div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d30/res__sorcery__memory__cache_8c_source.html#l00131">res_sorcery_memory_cache.c:131</a></div></div>
<div class="ttc" id="cel__pgsql_8c_html_ad6c487210772a9b4b0ca04b04b847d4c"><div class="ttname"><a href="../../de/d1b/cel__pgsql_8c.html#ad6c487210772a9b4b0ca04b04b847d4c">result</a></div><div class="ttdeci">static PGresult * result</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d1b/cel__pgsql_8c_source.html#l00088">cel_pgsql.c:88</a></div></div>
<div class="ttc" id="structsorcery__memory__cached__object_html_a269a2854677d498d5b2ffe7cef85a751"><div class="ttname"><a href="../../df/d93/structsorcery__memory__cached__object.html#a269a2854677d498d5b2ffe7cef85a751">sorcery_memory_cached_object::objectset</a></div><div class="ttdeci">struct ast_variable * objectset</div><div class="ttdoc">Cached objectset for field and regex retrieval. </div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d30/res__sorcery__memory__cache_8c_source.html#l00177">res_sorcery_memory_cache.c:177</a></div></div>
<div class="ttc" id="res__sorcery__memory__cache_8c_html_a9a5449c09c240371ee234ec151bda8e0"><div class="ttname"><a href="../../d7/d30/res__sorcery__memory__cache_8c.html#a9a5449c09c240371ee234ec151bda8e0">real_backend_data</a></div><div class="ttdeci">static struct backend_data * real_backend_data</div></div>
<div class="ttc" id="res__sorcery__memory__cache_8c_html_a93253ad88664252f13a1eb0650303691"><div class="ttname"><a href="../../d7/d30/res__sorcery__memory__cache_8c.html#a93253ad88664252f13a1eb0650303691">mock_wizard</a></div><div class="ttdeci">static struct ast_sorcery_wizard mock_wizard</div><div class="ttdoc">A mock sorcery wizard used for the stale test. </div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d30/res__sorcery__memory__cache_8c_source.html#l03078">res_sorcery_memory_cache.c:3078</a></div></div>
<div class="ttc" id="heap_8h_html_aaa326b988236a0841d41cf2af8ec9b7e"><div class="ttname"><a href="../../da/ddb/heap_8h.html#aaa326b988236a0841d41cf2af8ec9b7e">ast_heap_peek</a></div><div class="ttdeci">void * ast_heap_peek(struct ast_heap *h, unsigned int index)</div><div class="ttdoc">Peek at an element on a heap. </div><div class="ttdef"><b>Definition:</b> <a href="../../d2/d29/heap_8c_source.html#l00267">heap.c:267</a></div></div>
<div class="ttc" id="sorcery_8h_html_ad60f3b81bed748245f8045cb48fadee2"><div class="ttname"><a href="../../d8/d25/sorcery_8h.html#ad60f3b81bed748245f8045cb48fadee2">ast_sorcery_open</a></div><div class="ttdeci">#define ast_sorcery_open()</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d25/sorcery_8h_source.html#l00408">sorcery.h:408</a></div></div>
<div class="ttc" id="res__sorcery__memory__cache_8c_html_a43170aa76d29a3c41a32e557acf6c0b1"><div class="ttname"><a href="../../d7/d30/res__sorcery__memory__cache_8c.html#a43170aa76d29a3c41a32e557acf6c0b1">CACHE_HEAP_INIT_HEIGHT</a></div><div class="ttdeci">#define CACHE_HEAP_INIT_HEIGHT</div><div class="ttdoc">Height of heap for cache object heap. Allows 31 initial objects. </div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d30/res__sorcery__memory__cache_8c_source.html#l00238">res_sorcery_memory_cache.c:238</a></div></div>
<div class="ttc" id="structast__cli__args_html"><div class="ttname"><a href="../../d3/dad/structast__cli__args.html">ast_cli_args</a></div><div class="ttdef"><b>Definition:</b> <a href="../../dc/db0/cli_8h_source.html#l00158">cli.h:158</a></div></div>
<div class="ttc" id="res__sorcery__memory__cache_8c_html_a580c75cea0df48f776caecd4e7680dc2"><div class="ttname"><a href="../../d7/d30/res__sorcery__memory__cache_8c.html#a580c75cea0df48f776caecd4e7680dc2">stale_update_task_data_destructor</a></div><div class="ttdeci">static void stale_update_task_data_destructor(void *obj)</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d30/res__sorcery__memory__cache_8c_source.html#l00962">res_sorcery_memory_cache.c:962</a></div></div>
<div class="ttc" id="res__sorcery__memory__cache_8c_html_af6639c66b2a5eff1e659bf57d5938e54"><div class="ttname"><a href="../../d7/d30/res__sorcery__memory__cache_8c.html#af6639c66b2a5eff1e659bf57d5938e54">AST_TEST_DEFINE</a></div><div class="ttdeci">AST_TEST_DEFINE(open_with_valid_options)</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d30/res__sorcery__memory__cache_8c_source.html#l02317">res_sorcery_memory_cache.c:2317</a></div></div>
<div class="ttc" id="res__sorcery__memory__cache_8c_html_aaedaa3e74978866f28fa653c7702edf9"><div class="ttname"><a href="../../d7/d30/res__sorcery__memory__cache_8c.html#aaedaa3e74978866f28fa653c7702edf9">object_add_to_cache_callback</a></div><div class="ttdeci">static int object_add_to_cache_callback(void *obj, void *arg, void *data, int flags)</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d30/res__sorcery__memory__cache_8c_source.html#l00855">res_sorcery_memory_cache.c:855</a></div></div>
<div class="ttc" id="test__linkedlists_8c_html_a025ede890af287961d3a98d0e634a62b"><div class="ttname"><a href="../../d7/d6f/test__linkedlists_8c.html#a025ede890af287961d3a98d0e634a62b">b</a></div><div class="ttdeci">static struct test_val b</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d6f/test__linkedlists_8c_source.html#l00047">test_linkedlists.c:47</a></div></div>
<div class="ttc" id="time_8h_html_aa13b651c18bc6004cab21ac041d44dd8"><div class="ttname"><a href="../../de/df7/time_8h.html#aa13b651c18bc6004cab21ac041d44dd8">ast_tvsub</a></div><div class="ttdeci">struct timeval ast_tvsub(struct timeval a, struct timeval b)</div><div class="ttdoc">Returns the difference of two timevals a - b. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/dc5/extconf_8c_source.html#l02298">extconf.c:2298</a></div></div>
<div class="ttc" id="structsorcery__memory__cache_html_ac0ac5403988b7156dde84af2b7054766"><div class="ttname"><a href="../../d2/d6b/structsorcery__memory__cache.html#ac0ac5403988b7156dde84af2b7054766">sorcery_memory_cache::cache_notify</a></div><div class="ttdeci">unsigned int cache_notify</div><div class="ttdoc">Variable used to indicate we should notify a test when we reach empty. </div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d30/res__sorcery__memory__cache_8c_source.html#l00156">res_sorcery_memory_cache.c:156</a></div></div>
<div class="ttc" id="structstale__update__task__data_html_a95eb520bdb1abcd2a70b1432d3ecbf4c"><div class="ttname"><a href="../../da/d04/structstale__update__task__data.html#a95eb520bdb1abcd2a70b1432d3ecbf4c">stale_update_task_data::sorcery</a></div><div class="ttdeci">struct ast_sorcery * sorcery</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d30/res__sorcery__memory__cache_8c_source.html#l00957">res_sorcery_memory_cache.c:957</a></div></div>
<div class="ttc" id="res__sorcery__memory__cache_8c_html_a4161fc89535e551cb44e80ea3b51dadb"><div class="ttname"><a href="../../d7/d30/res__sorcery__memory__cache_8c.html#a4161fc89535e551cb44e80ea3b51dadb">sorcery_memory_cache_ami_stale</a></div><div class="ttdeci">static int sorcery_memory_cache_ami_stale(struct mansession *s, const struct message *m)</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d30/res__sorcery__memory__cache_8c_source.html#l02199">res_sorcery_memory_cache.c:2199</a></div></div>
<div class="ttc" id="res__sorcery__memory__cache_8c_html_ad0c0e9a4028c7f194b269e7334375ac3"><div class="ttname"><a href="../../d7/d30/res__sorcery__memory__cache_8c.html#ad0c0e9a4028c7f194b269e7334375ac3">add_to_cache</a></div><div class="ttdeci">static int add_to_cache(struct sorcery_memory_cache *cache, struct sorcery_memory_cached_object *cached_object)</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d30/res__sorcery__memory__cache_8c_source.html#l00728">res_sorcery_memory_cache.c:728</a></div></div>
<div class="ttc" id="res__sorcery__memory__cache_8c_html_aeefdfc3206b1465c47f5e7833c3192b6"><div class="ttname"><a href="../../d7/d30/res__sorcery__memory__cache_8c.html#aeefdfc3206b1465c47f5e7833c3192b6">mark_object_as_stale_in_cache</a></div><div class="ttdeci">static int mark_object_as_stale_in_cache(struct sorcery_memory_cache *cache, const char *id)</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d30/res__sorcery__memory__cache_8c_source.html#l00605">res_sorcery_memory_cache.c:605</a></div></div>
<div class="ttc" id="lock_8h_html_a76e8ed6bb354be6c6dd9e51acc1d7a1b"><div class="ttname"><a href="../../dd/d42/lock_8h.html#a76e8ed6bb354be6c6dd9e51acc1d7a1b">ast_mutex_init</a></div><div class="ttdeci">#define ast_mutex_init(pmutex)</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d42/lock_8h_source.html#l00184">lock.h:184</a></div></div>
<div class="ttc" id="structao2__container_html"><div class="ttname"><a href="../../d2/da9/structao2__container.html">ao2_container</a></div><div class="ttdoc">Generic container type. </div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d20/astobj2__container__private_8h_source.html#l00282">astobj2_container_private.h:282</a></div></div>
<div class="ttc" id="test__http__media__cache_8c_html_a80c8e3ae5087d90d422675d034eeebc7"><div class="ttname"><a href="../../d4/d45/test__http__media__cache_8c.html#a80c8e3ae5087d90d422675d034eeebc7">options</a></div><div class="ttdeci">static struct test_options options</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d45/test__http__media__cache_8c_source.html#l00062">test_http_media_cache.c:62</a></div></div>
<div class="ttc" id="astobj2_8h_html_ad9d009e87e737af900825b36db55a35ca61056b5855dc9921faa4f10a67b1a250"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#ad9d009e87e737af900825b36db55a35ca61056b5855dc9921faa4f10a67b1a250">OBJ_SEARCH_MASK</a></div><div class="ttdoc">Search option field mask. </div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l01076">astobj2.h:1076</a></div></div>
<div class="ttc" id="lock_8h_html_ab8977a71822daa556f19f30ba6eec765"><div class="ttname"><a href="../../dd/d42/lock_8h.html#ab8977a71822daa556f19f30ba6eec765">ast_mutex_destroy</a></div><div class="ttdeci">#define ast_mutex_destroy(a)</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d42/lock_8h_source.html#l00186">lock.h:186</a></div></div>
<div class="ttc" id="sorcery_8h_html_a4c03ccef909474831717c93679065508"><div class="ttname"><a href="../../d8/d25/sorcery_8h.html#a4c03ccef909474831717c93679065508">ast_sorcery_generic_alloc</a></div><div class="ttdeci">void * ast_sorcery_generic_alloc(size_t size, ao2_destructor_fn destructor)</div><div class="ttdoc">Allocate a generic sorcery capable object. </div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d69/sorcery_8c_source.html#l01728">sorcery.c:1728</a></div></div>
<div class="ttc" id="res__sorcery__memory__cache_8c_html_a0a8302d60836f9207cb2b3ea36948023"><div class="ttname"><a href="../../d7/d30/res__sorcery__memory__cache_8c.html#a0a8302d60836f9207cb2b3ea36948023">sorcery_memory_cache_ami_stale_object</a></div><div class="ttdeci">static int sorcery_memory_cache_ami_stale_object(struct mansession *s, const struct message *m)</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d30/res__sorcery__memory__cache_8c_source.html#l02146">res_sorcery_memory_cache.c:2146</a></div></div>
<div class="ttc" id="structsorcery__memory__cache__fields__cmp__params_html"><div class="ttname"><a href="../../d7/d59/structsorcery__memory__cache__fields__cmp__params.html">sorcery_memory_cache_fields_cmp_params</a></div><div class="ttdoc">Structure used for fields comparison. </div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d30/res__sorcery__memory__cache_8c_source.html#l00181">res_sorcery_memory_cache.c:181</a></div></div>
<div class="ttc" id="module_8h_html_a155a0df9c59e04e305d4a2fa3e35f843a835b27a90d895a488e4e14cc3d2dee8c"><div class="ttname"><a href="../../d5/d16/module_8h.html#a155a0df9c59e04e305d4a2fa3e35f843a835b27a90d895a488e4e14cc3d2dee8c">AST_MODFLAG_GLOBAL_SYMBOLS</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d16/module_8h_source.html#l00316">module.h:316</a></div></div>
<div class="ttc" id="res__sorcery__memory__cache_8c_html_a73c11b5eb7314f2dbd3f32d18b69b10f"><div class="ttname"><a href="../../d7/d30/res__sorcery__memory__cache_8c.html#a73c11b5eb7314f2dbd3f32d18b69b10f">sorcery_memory_cache_open</a></div><div class="ttdeci">static void * sorcery_memory_cache_open(const char *data)</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d30/res__sorcery__memory__cache_8c_source.html#l01508">res_sorcery_memory_cache.c:1508</a></div></div>
<div class="ttc" id="manager_8h_html_a5b63b8a8faede2d852e071e1f7b31c11"><div class="ttname"><a href="../../db/d45/manager_8h.html#a5b63b8a8faede2d852e071e1f7b31c11">ast_manager_register_xml</a></div><div class="ttdeci">#define ast_manager_register_xml(action, authority, func)</div><div class="ttdoc">Register a manager callback using XML documentation to describe the manager. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/d45/manager_8h_source.html#l00186">manager.h:186</a></div></div>
<div class="ttc" id="module_8h_html_aba2c8d4be709a254658b21a834f8294a"><div class="ttname"><a href="../../d5/d16/module_8h.html#aba2c8d4be709a254658b21a834f8294a">ASTERISK_GPL_KEY</a></div><div class="ttdeci">#define ASTERISK_GPL_KEY</div><div class="ttdoc">The text the key() function should return. </div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d16/module_8h_source.html#l00046">module.h:46</a></div></div>
<div class="ttc" id="res__sorcery__memory__cache_8c_html_abd8e246b3ae983064f28ae743fa2c0f2"><div class="ttname"><a href="../../d7/d30/res__sorcery__memory__cache_8c.html#abd8e246b3ae983064f28ae743fa2c0f2">mark_all_as_stale_in_cache</a></div><div class="ttdeci">static void mark_all_as_stale_in_cache(struct sorcery_memory_cache *cache)</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d30/res__sorcery__memory__cache_8c_source.html#l00632">res_sorcery_memory_cache.c:632</a></div></div>
<div class="ttc" id="res__sorcery__memory__cache_8c_html_a2cb830e802d44a2cf4eb386aaca36db3"><div class="ttname"><a href="../../d7/d30/res__sorcery__memory__cache_8c.html#a2cb830e802d44a2cf4eb386aaca36db3">configuration_parse_unsigned_integer</a></div><div class="ttdeci">static int configuration_parse_unsigned_integer(const char *value, unsigned int *result)</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d30/res__sorcery__memory__cache_8c_source.html#l01484">res_sorcery_memory_cache.c:1484</a></div></div>
<div class="ttc" id="group__Group__AMI_html_ga31a02a7d3cc36aa66ebebdedfc574d1c"><div class="ttname"><a href="../../df/d72/group__Group__AMI.html#ga31a02a7d3cc36aa66ebebdedfc574d1c">astman_send_error</a></div><div class="ttdeci">void astman_send_error(struct mansession *s, const struct message *m, char *error)</div><div class="ttdoc">Send error in manager transaction. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d10/manager_8c_source.html#l03159">manager.c:3159</a></div></div>
<div class="ttc" id="res__sorcery__memory__cache_8c_html_a3ec056ba134c65c1a2326dd4cac57410"><div class="ttname"><a href="../../d7/d30/res__sorcery__memory__cache_8c.html#a3ec056ba134c65c1a2326dd4cac57410">end_passthru_update</a></div><div class="ttdeci">static void end_passthru_update(void)</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d30/res__sorcery__memory__cache_8c_source.html#l00281">res_sorcery_memory_cache.c:281</a></div></div>
<div class="ttc" id="module_8h_html"><div class="ttname"><a href="../../d5/d16/module_8h.html">module.h</a></div><div class="ttdoc">Asterisk module definitions. </div></div>
<div class="ttc" id="structsorcery__memory__cache_html_a1c7181c39f99ee801943a0d0aa9872b9"><div class="ttname"><a href="../../d2/d6b/structsorcery__memory__cache.html#a1c7181c39f99ee801943a0d0aa9872b9">sorcery_memory_cache::cond</a></div><div class="ttdeci">ast_cond_t cond</div><div class="ttdoc">Condition used for signaling when the cache has reached empty. </div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d30/res__sorcery__memory__cache_8c_source.html#l00160">res_sorcery_memory_cache.c:160</a></div></div>
<div class="ttc" id="structprint__object__details_html_ae19846dd61ed50eb0d30e3b8bb915a8f"><div class="ttname"><a href="../../d7/d2a/structprint__object__details.html#ae19846dd61ed50eb0d30e3b8bb915a8f">print_object_details::a</a></div><div class="ttdeci">struct ast_cli_args * a</div><div class="ttdoc">The CLI arguments. </div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d30/res__sorcery__memory__cache_8c_source.html#l01737">res_sorcery_memory_cache.c:1737</a></div></div>
<div class="ttc" id="structsorcery__memory__cache_html_a89b193072cd806e8e239c9a448463efe"><div class="ttname"><a href="../../d2/d6b/structsorcery__memory__cache.html#a89b193072cd806e8e239c9a448463efe">sorcery_memory_cache::object_lifetime_stale</a></div><div class="ttdeci">unsigned int object_lifetime_stale</div><div class="ttdoc">The amount of time (in seconds) before an object is marked as stale, 0 if disabled. </div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d30/res__sorcery__memory__cache_8c_source.html#l00137">res_sorcery_memory_cache.c:137</a></div></div>
<div class="ttc" id="res__sorcery__memory__cache_8c_html_a92ed0802901a8b858f90e33983bab271"><div class="ttname"><a href="../../d7/d30/res__sorcery__memory__cache_8c.html#a92ed0802901a8b858f90e33983bab271">sorcery_memory_cached_object_alloc</a></div><div class="ttdeci">static struct sorcery_memory_cached_object * sorcery_memory_cached_object_alloc(const struct ast_sorcery *sorcery, const struct sorcery_memory_cache *cache, void *object)</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d30/res__sorcery__memory__cache_8c_source.html#l00766">res_sorcery_memory_cache.c:766</a></div></div>
<div class="ttc" id="res__sorcery__memory__cache_8c_html_a0942c70adebf2e7f884ece65e18718ff"><div class="ttname"><a href="../../d7/d30/res__sorcery__memory__cache_8c.html#a0942c70adebf2e7f884ece65e18718ff">stale_item_update</a></div><div class="ttdeci">static int stale_item_update(const void *data)</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d30/res__sorcery__memory__cache_8c_source.html#l00989">res_sorcery_memory_cache.c:989</a></div></div>
<div class="ttc" id="astobj2_8h_html_ad9d009e87e737af900825b36db55a35ca614744a4d36b3189d4ab5b02c8645d47"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#ad9d009e87e737af900825b36db55a35ca614744a4d36b3189d4ab5b02c8645d47">OBJ_MULTIPLE</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l01053">astobj2.h:1053</a></div></div>
<div class="ttc" id="astobj2_8h_html_a91d5d37d00874ae7a92d1a15c0a3b3a6"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#a91d5d37d00874ae7a92d1a15c0a3b3a6">ao2_iterator_init</a></div><div class="ttdeci">struct ao2_iterator ao2_iterator_init(struct ao2_container *c, int flags) attribute_warn_unused_result</div><div class="ttdoc">Create an iterator for a container. </div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d22/astobj2__container_8c_source.html#l00485">astobj2_container.c:485</a></div></div>
<div class="ttc" id="lock_8h_html_a6add1f30b2d53ca9384b15529a6f126e"><div class="ttname"><a href="../../dd/d42/lock_8h.html#a6add1f30b2d53ca9384b15529a6f126e">ast_cond_timedwait</a></div><div class="ttdeci">#define ast_cond_timedwait(cond, mutex, time)</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d42/lock_8h_source.html#l00204">lock.h:204</a></div></div>
<div class="ttc" id="structsorcery__memory__cache_html_a5ac083a645d964373f022d03df4849c8"><div class="ttname"><a href="../../d2/d6b/structsorcery__memory__cache.html#a5ac083a645d964373f022d03df4849c8">sorcery_memory_cache::name</a></div><div class="ttdeci">char * name</div><div class="ttdoc">The name of the memory cache. </div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d30/res__sorcery__memory__cache_8c_source.html#l00129">res_sorcery_memory_cache.c:129</a></div></div>
<div class="ttc" id="sched_8h_html_a862f869d056628b38e09042f21b54413"><div class="ttname"><a href="../../d7/d00/sched_8h.html#a862f869d056628b38e09042f21b54413">ast_sched_context_destroy</a></div><div class="ttdeci">void ast_sched_context_destroy(struct ast_sched_context *c)</div><div class="ttdoc">destroys a schedule context </div><div class="ttdef"><b>Definition:</b> <a href="../../db/dbe/sched_8c_source.html#l00269">sched.c:269</a></div></div>
<div class="ttc" id="res__sorcery__memory__cache_8c_html_a93a10f716c3fc5f0aa7ff0f843e03aca"><div class="ttname"><a href="../../d7/d30/res__sorcery__memory__cache_8c.html#a93a10f716c3fc5f0aa7ff0f843e03aca">age_cmp</a></div><div class="ttdeci">static int age_cmp(void *a, void *b)</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d30/res__sorcery__memory__cache_8c_source.html#l01493">res_sorcery_memory_cache.c:1493</a></div></div>
<div class="ttc" id="module_8h_html_aa4f734041ffd9d75b07cefb0291e1e58a8201de64237a41919013d62ae5d6721d"><div class="ttname"><a href="../../d5/d16/module_8h.html#aa4f734041ffd9d75b07cefb0291e1e58a8201de64237a41919013d62ae5d6721d">AST_MODPRI_REALTIME_DRIVER</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d16/module_8h_source.html#l00323">module.h:323</a></div></div>
<div class="ttc" id="structast__mutex__info_html"><div class="ttname"><a href="../../d8/dc5/structast__mutex__info.html">ast_mutex_info</a></div><div class="ttdoc">Structure for mutex and tracking information. </div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d42/lock_8h_source.html#l00135">lock.h:135</a></div></div>
<div class="ttc" id="res__sorcery__memory__cache_8c_html_a4a0aad57b8dff22d4df96c5000d4fb80"><div class="ttname"><a href="../../d7/d30/res__sorcery__memory__cache_8c.html#a4a0aad57b8dff22d4df96c5000d4fb80">sorcery_memory_cache_retrieve_fields</a></div><div class="ttdeci">static void * sorcery_memory_cache_retrieve_fields(const struct ast_sorcery *sorcery, void *data, const char *type, const struct ast_variable *fields)</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d30/res__sorcery__memory__cache_8c_source.html#l01299">res_sorcery_memory_cache.c:1299</a></div></div>
<div class="ttc" id="res__sorcery__memory__cache_8c_html_a098acef6bba076f66097ff668cc060ff"><div class="ttname"><a href="../../d7/d30/res__sorcery__memory__cache_8c.html#a098acef6bba076f66097ff668cc060ff">sorcery_memory_cache_complete_name</a></div><div class="ttdeci">static char * sorcery_memory_cache_complete_name(const char *word, int state)</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d30/res__sorcery__memory__cache_8c_source.html#l01652">res_sorcery_memory_cache.c:1652</a></div></div>
<div class="ttc" id="res__sorcery__memory__cache_8c_html_a27ec518b8a57a1ea0161d387061145c9"><div class="ttname"><a href="../../d7/d30/res__sorcery__memory__cache_8c.html#a27ec518b8a57a1ea0161d387061145c9">passthru_update_id_storage</a></div><div class="ttdeci">static struct ast_threadstorage passthru_update_id_storage</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d30/res__sorcery__memory__cache_8c_source.html#l00247">res_sorcery_memory_cache.c:247</a></div></div>
<div class="ttc" id="res__sorcery__memory__cache_8c_html_ac2710be96da7280183f8b711e01dc81b"><div class="ttname"><a href="../../d7/d30/res__sorcery__memory__cache_8c.html#ac2710be96da7280183f8b711e01dc81b">memory_cache_stale_check</a></div><div class="ttdeci">static void memory_cache_stale_check(const struct ast_sorcery *sorcery, struct sorcery_memory_cache *cache)</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d30/res__sorcery__memory__cache_8c_source.html#l01191">res_sorcery_memory_cache.c:1191</a></div></div>
<div class="ttc" id="codecs_2gsm_2inc_2private_8h_html_a0b023cbb2bf7d034c2269d58d7455ac8"><div class="ttname"><a href="../../d6/da0/codecs_2gsm_2inc_2private_8h.html#a0b023cbb2bf7d034c2269d58d7455ac8">word</a></div><div class="ttdeci">short word</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/da0/codecs_2gsm_2inc_2private_8h_source.html#l00012">codecs/gsm/inc/private.h:12</a></div></div>
<div class="ttc" id="sorcery_8h_html"><div class="ttname"><a href="../../d8/d25/sorcery_8h.html">sorcery.h</a></div><div class="ttdoc">Sorcery Data Access Layer API. </div></div>
<div class="ttc" id="lock_8h_html_a873f9ce8c6287a32d48c83133e124418"><div class="ttname"><a href="../../dd/d42/lock_8h.html#a873f9ce8c6287a32d48c83133e124418">ast_mutex_unlock</a></div><div class="ttdeci">#define ast_mutex_unlock(a)</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d42/lock_8h_source.html#l00188">lock.h:188</a></div></div>
<div class="ttc" id="http_8c_html_a6f25bc812d09fedb86bf394c01061c56"><div class="ttname"><a href="../../dd/d43/http_8c.html#a6f25bc812d09fedb86bf394c01061c56">prefix</a></div><div class="ttdeci">static char prefix[MAX_PREFIX]</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d43/http_8c_source.html#l00141">http.c:141</a></div></div>
<div class="ttc" id="strings_8h_html_a33ab7fa091d5513d8507d3bd33ef5b55"><div class="ttname"><a href="../../d6/d90/strings_8h.html#a33ab7fa091d5513d8507d3bd33ef5b55">ast_str_hash</a></div><div class="ttdeci">static force_inline int attribute_pure ast_str_hash(const char *str)</div><div class="ttdoc">Compute a hash value on a string. </div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d90/strings_8h_source.html#l01206">strings.h:1206</a></div></div>
<div class="ttc" id="structsorcery__memory__cache_html_a1c0f22ced3c7233f3945fcc05219f12a"><div class="ttname"><a href="../../d2/d6b/structsorcery__memory__cache.html#a1c0f22ced3c7233f3945fcc05219f12a">sorcery_memory_cache::cache_completed</a></div><div class="ttdeci">unsigned int cache_completed</div><div class="ttdoc">Variable that is set when the cache has reached empty. </div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d30/res__sorcery__memory__cache_8c_source.html#l00162">res_sorcery_memory_cache.c:162</a></div></div>
<div class="ttc" id="structprint__object__details_html_ada420b1f724d02917b97a9b0d5288086"><div class="ttname"><a href="../../d7/d2a/structprint__object__details.html#ada420b1f724d02917b97a9b0d5288086">print_object_details::cache</a></div><div class="ttdeci">struct sorcery_memory_cache * cache</div><div class="ttdoc">The sorcery memory cache. </div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d30/res__sorcery__memory__cache_8c_source.html#l01735">res_sorcery_memory_cache.c:1735</a></div></div>
<div class="ttc" id="test__linkedlists_8c_html_a13dd15487fee89a002d17ef3aff62d02"><div class="ttname"><a href="../../d7/d6f/test__linkedlists_8c.html#a13dd15487fee89a002d17ef3aff62d02">a</a></div><div class="ttdeci">static struct test_val a</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d6f/test__linkedlists_8c_source.html#l00046">test_linkedlists.c:46</a></div></div>
<div class="ttc" id="astobj2_8h_html_a1ad9f122bcae95a470639402faa3d2ee"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#a1ad9f122bcae95a470639402faa3d2ee">ao2_link</a></div><div class="ttdeci">#define ao2_link(container, obj)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l01549">astobj2.h:1549</a></div></div>
<div class="ttc" id="test_8h_html_aad2aec78205d328d23894a6598cc4044a8a11a3a19eb4c9fd2ba654d95df1adb6"><div class="ttname"><a href="../../d2/ddc/test_8h.html#aad2aec78205d328d23894a6598cc4044a8a11a3a19eb4c9fd2ba654d95df1adb6">AST_TEST_FAIL</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d2/ddc/test_8h_source.html#l00203">test.h:203</a></div></div>
<div class="ttc" id="structsorcery__memory__cached__object_html_a59a79dcdae51e4000f776c4c48b8c7d1"><div class="ttname"><a href="../../df/d93/structsorcery__memory__cached__object.html#a59a79dcdae51e4000f776c4c48b8c7d1">sorcery_memory_cached_object::stale_update_sched_id</a></div><div class="ttdeci">int stale_update_sched_id</div><div class="ttdoc">scheduler id of stale update task </div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d30/res__sorcery__memory__cache_8c_source.html#l00175">res_sorcery_memory_cache.c:175</a></div></div>
</div><!-- fragment --></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Sun Aug 8 2021 19:44:09 for Asterisk - The Open Source Telephony Project by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="../../doxygen.png" alt="doxygen"/>
</a> 1.8.13
</small></address>
</body>
</html>
