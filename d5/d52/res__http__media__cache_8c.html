<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Asterisk - The Open Source Telephony Project: res_http_media_cache.c File Reference</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Asterisk - The Open Source Telephony Project
   &#160;<span id="projectnumber">18.5.0</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "../../search",false,'Search');
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('../../',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="../../dir_7b47cca4d318623bb4270ab1fb592ef5.html">res</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#nested-classes">Data Structures</a> &#124;
<a href="#define-members">Macros</a> &#124;
<a href="#func-members">Functions</a> &#124;
<a href="#var-members">Variables</a>  </div>
  <div class="headertitle">
<div class="title">res_http_media_cache.c File Reference</div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><code>#include &quot;<a class="el" href="../../db/db2/asterisk_8h_source.html">asterisk.h</a>&quot;</code><br />
<code>#include &lt;curl/curl.h&gt;</code><br />
<code>#include &quot;<a class="el" href="../../d5/d16/module_8h_source.html">asterisk/module.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="../../dd/d94/bucket_8h_source.html">asterisk/bucket.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="../../d8/d25/sorcery_8h_source.html">asterisk/sorcery.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="../../dc/d7d/threadstorage_8h_source.html">asterisk/threadstorage.h</a>&quot;</code><br />
</div><div class="textblock"><div class="dynheader">
Include dependency graph for res_http_media_cache.c:</div>
<div class="dyncontent">
<div class="center"><img src="../../d1/d2a/res__http__media__cache_8c__incl.png" border="0" usemap="#res__http__media__cache_8c" alt=""/></div>
<map name="res__http__media__cache_8c" id="res__http__media__cache_8c">
<area shape="rect" id="node2" href="../../db/db2/asterisk_8h.html" title="Asterisk main include file. File version handling, generic pbx functions. " alt="" coords="464,155,548,181"/>
<area shape="rect" id="node23" href="../../d5/d16/module_8h.html" title="Asterisk module definitions. " alt="" coords="1826,80,1962,107"/>
<area shape="rect" id="node32" href="../../dc/d7d/threadstorage_8h.html" title="Definitions to aid in the use of thread local storage. " alt="" coords="1914,304,2093,331"/>
<area shape="rect" id="node33" href="../../dd/d94/bucket_8h.html" title="Bucket File API. " alt="" coords="2378,80,2509,107"/>
<area shape="rect" id="node34" href="../../d8/d25/sorcery_8h.html" title="Sorcery Data Access Layer API. " alt="" coords="2325,155,2458,181"/>
<area shape="rect" id="node3" href="../../d8/d20/autoconfig_8h.html" title="asterisk/autoconfig.h" alt="" coords="797,379,951,405"/>
<area shape="rect" id="node5" href="../../de/da3/include_2asterisk_2compat_8h.html" title="General Definitions for Asterisk top level program Included by asterisk.h to handle platform&#45;specific..." alt="" coords="807,229,944,256"/>
<area shape="rect" id="node21" href="../../d8/d8a/astmm_8h.html" title="Asterisk memory management routines. " alt="" coords="5,229,140,256"/>
<area shape="rect" id="node4" href="../../dc/dba/buildopts_8h.html" title="asterisk/buildopts.h" alt="" coords="801,453,947,480"/>
<area shape="rect" id="node6" href="../../d4/dd1/compiler_8h.html" title="Compiler&#45;specific macros and other items. " alt="" coords="1417,304,1560,331"/>
<area shape="rect" id="node24" href="../../d5/d60/utils_8h.html" title="Utility functions. " alt="" coords="1705,155,1819,181"/>
<area shape="rect" id="node25" href="../../d9/d94/network_8h.html" title="Wrapper for network related headers, masking differences between various operating systems..." alt="" coords="1954,229,2093,256"/>
<area shape="rect" id="node26" href="../../de/df7/time_8h.html" title="Time&#45;related functions and macros. " alt="" coords="1676,304,1739,331"/>
<area shape="rect" id="node27" href="../../dd/d42/lock_8h.html" title="Asterisk locking&#45;related definitions: " alt="" coords="1509,229,1623,256"/>
<area shape="rect" id="node28" href="../../d1/d8c/logger_8h.html" title="Support for logging to various files, console and syslog Configuration in file logger.conf. " alt="" coords="1763,304,1889,331"/>
<area shape="rect" id="node29" href="../../d5/deb/localtime_8h.html" title="Custom localtime functions for multiple timezones. " alt="" coords="1106,229,1253,256"/>
<area shape="rect" id="node30" href="../../d1/d0f/stringfields_8h.html" title="asterisk/stringfields.h" alt="" coords="1277,229,1434,256"/>
<area shape="rect" id="node31" href="../../d6/d90/strings_8h.html" title="String manipulation functions. " alt="" coords="1749,229,1879,256"/>
<area shape="rect" id="node35" href="../../db/dfe/config__options_8h.html" title="Configuration option&#45;handling. " alt="" coords="2260,229,2440,256"/>
<area shape="rect" id="node36" href="../../dd/d1d/uuid_8h.html" title="Universally unique identifier support. " alt="" coords="2465,229,2579,256"/>
</map>
</div>
</div>
<p><a href="../../d5/d52/res__http__media__cache_8c_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="nested-classes"></a>
Data Structures</h2></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/d50/structcurl__bucket__file__data.html">curl_bucket_file_data</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">Data passed to cURL callbacks.  <a href="../../dd/d50/structcurl__bucket__file__data.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="define-members"></a>
Macros</h2></td></tr>
<tr class="memitem:ad9f74a3dcbfde83a6538a60020059b75"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d5/d52/res__http__media__cache_8c.html#ad9f74a3dcbfde83a6538a60020059b75">GLOBAL_USERAGENT</a>&#160;&#160;&#160;&quot;asterisk-libcurl-agent/1.0&quot;</td></tr>
<tr class="separator:ad9f74a3dcbfde83a6538a60020059b75"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af199a39319b90015d86f3c3ccccf42bc"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d5/d52/res__http__media__cache_8c.html#af199a39319b90015d86f3c3ccccf42bc">MAX_HEADER_LENGTH</a>&#160;&#160;&#160;1023</td></tr>
<tr class="separator:af199a39319b90015d86f3c3ccccf42bc"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a88b7c88fed6b80fd18f34f97757dfc04"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d5/d52/res__http__media__cache_8c.html#a88b7c88fed6b80fd18f34f97757dfc04">__reg_module</a> (void)</td></tr>
<tr class="separator:a88b7c88fed6b80fd18f34f97757dfc04"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:afeab1257bd17282b95875499393a147a"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d5/d52/res__http__media__cache_8c.html#afeab1257bd17282b95875499393a147a">__unreg_module</a> (void)</td></tr>
<tr class="separator:afeab1257bd17282b95875499393a147a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4fb0aca9bbcdb9709fa52a70aded6cae"><td class="memItemLeft" align="right" valign="top">struct <a class="el" href="../../d9/df5/structast__module.html">ast_module</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d5/d52/res__http__media__cache_8c.html#a4fb0aca9bbcdb9709fa52a70aded6cae">AST_MODULE_SELF_SYM</a> (void)</td></tr>
<tr class="separator:a4fb0aca9bbcdb9709fa52a70aded6cae"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac389921d8b67f678c6d79b8490d15f76"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d5/d52/res__http__media__cache_8c.html#ac389921d8b67f678c6d79b8490d15f76">bucket_file_always_revalidate</a> (struct <a class="el" href="../../d9/da9/structast__bucket__file.html">ast_bucket_file</a> *bucket_file)</td></tr>
<tr class="separator:ac389921d8b67f678c6d79b8490d15f76"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4f5082a6ad6c59f1da998114ed6196a2"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d5/d52/res__http__media__cache_8c.html#a4f5082a6ad6c59f1da998114ed6196a2">bucket_file_expired</a> (struct <a class="el" href="../../d9/da9/structast__bucket__file.html">ast_bucket_file</a> *bucket_file)</td></tr>
<tr class="separator:a4f5082a6ad6c59f1da998114ed6196a2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae174aec72bbbe66538d01bf7f717b37c"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d5/d52/res__http__media__cache_8c.html#ae174aec72bbbe66538d01bf7f717b37c">bucket_file_run_curl</a> (struct <a class="el" href="../../d9/da9/structast__bucket__file.html">ast_bucket_file</a> *bucket_file)</td></tr>
<tr class="separator:ae174aec72bbbe66538d01bf7f717b37c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2968d0aefb6b287d88ae1e23fc57f792"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d5/d52/res__http__media__cache_8c.html#a2968d0aefb6b287d88ae1e23fc57f792">bucket_file_set_expiration</a> (struct <a class="el" href="../../d9/da9/structast__bucket__file.html">ast_bucket_file</a> *bucket_file)</td></tr>
<tr class="separator:a2968d0aefb6b287d88ae1e23fc57f792"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac12b04a36b6c297f490c993b61cba30a"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d5/d52/res__http__media__cache_8c.html#ac12b04a36b6c297f490c993b61cba30a">bucket_http_wizard_create</a> (const struct <a class="el" href="../../d2/d88/structast__sorcery.html">ast_sorcery</a> *<a class="el" href="../../d1/dbc/res__pjsip__phoneprov__provider_8c.html#a95eb520bdb1abcd2a70b1432d3ecbf4c">sorcery</a>, void *data, void *object)</td></tr>
<tr class="separator:ac12b04a36b6c297f490c993b61cba30a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa8ab6e21a6fc7fb23808c475fd37cb8e"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d5/d52/res__http__media__cache_8c.html#aa8ab6e21a6fc7fb23808c475fd37cb8e">bucket_http_wizard_delete</a> (const struct <a class="el" href="../../d2/d88/structast__sorcery.html">ast_sorcery</a> *<a class="el" href="../../d1/dbc/res__pjsip__phoneprov__provider_8c.html#a95eb520bdb1abcd2a70b1432d3ecbf4c">sorcery</a>, void *data, void *object)</td></tr>
<tr class="separator:aa8ab6e21a6fc7fb23808c475fd37cb8e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad7bb005f59dbc3638891099126246a95"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d5/d52/res__http__media__cache_8c.html#ad7bb005f59dbc3638891099126246a95">bucket_http_wizard_is_stale</a> (const struct <a class="el" href="../../d2/d88/structast__sorcery.html">ast_sorcery</a> *<a class="el" href="../../d1/dbc/res__pjsip__phoneprov__provider_8c.html#a95eb520bdb1abcd2a70b1432d3ecbf4c">sorcery</a>, void *data, void *object)</td></tr>
<tr class="separator:ad7bb005f59dbc3638891099126246a95"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a39b5069ed30d837ca7283c1b87a266e3"><td class="memItemLeft" align="right" valign="top">static void *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d5/d52/res__http__media__cache_8c.html#a39b5069ed30d837ca7283c1b87a266e3">bucket_http_wizard_retrieve_id</a> (const struct <a class="el" href="../../d2/d88/structast__sorcery.html">ast_sorcery</a> *<a class="el" href="../../d1/dbc/res__pjsip__phoneprov__provider_8c.html#a95eb520bdb1abcd2a70b1432d3ecbf4c">sorcery</a>, void *data, const char *<a class="el" href="../../d1/d6e/main_2stdtime_2private_8h.html#a1c6de65cc31c36fe2ede0d438531d327">type</a>, const char *<a class="el" href="../../d1/da4/res__corosync_8c.html#a2465fd4497a7402ad72da7d6e03f9934">id</a>)</td></tr>
<tr class="separator:a39b5069ed30d837ca7283c1b87a266e3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6e9a040ef6f91676b4a11ac58c04f8a0"><td class="memItemLeft" align="right" valign="top">static size_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d5/d52/res__http__media__cache_8c.html#a6e9a040ef6f91676b4a11ac58c04f8a0">curl_body_callback</a> (void *ptr, size_t size, size_t nitems, void *data)</td></tr>
<tr class="separator:a6e9a040ef6f91676b4a11ac58c04f8a0"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aef1d54398e27b01aabdf12594d2b6fbb"><td class="memItemLeft" align="right" valign="top">static size_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d5/d52/res__http__media__cache_8c.html#aef1d54398e27b01aabdf12594d2b6fbb">curl_header_callback</a> (char *buffer, size_t size, size_t nitems, void *data)</td></tr>
<tr class="separator:aef1d54398e27b01aabdf12594d2b6fbb"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:acf8b5f1fa60f9ca07080ac9ac89c0b9c"><td class="memItemLeft" align="right" valign="top">static long&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d5/d52/res__http__media__cache_8c.html#acf8b5f1fa60f9ca07080ac9ac89c0b9c">execute_curl_instance</a> (CURL *curl)</td></tr>
<tr class="memdesc:acf8b5f1fa60f9ca07080ac9ac89c0b9c"><td class="mdescLeft">&#160;</td><td class="mdescRight">Execute the CURL.  <a href="#acf8b5f1fa60f9ca07080ac9ac89c0b9c">More...</a><br /></td></tr>
<tr class="separator:acf8b5f1fa60f9ca07080ac9ac89c0b9c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a693dad05b109a75ff840b8b39f1dda54"><td class="memItemLeft" align="right" valign="top">static CURL *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d5/d52/res__http__media__cache_8c.html#a693dad05b109a75ff840b8b39f1dda54">get_curl_instance</a> (struct <a class="el" href="../../dd/d50/structcurl__bucket__file__data.html">curl_bucket_file_data</a> *cb_data)</td></tr>
<tr class="separator:a693dad05b109a75ff840b8b39f1dda54"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac3382bf6da54c56b37069bd76bbdf4f9"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d5/d52/res__http__media__cache_8c.html#ac3382bf6da54c56b37069bd76bbdf4f9">load_module</a> (void)</td></tr>
<tr class="separator:ac3382bf6da54c56b37069bd76bbdf4f9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad09fa931f468002152a3cc2d5ce25eae"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d5/d52/res__http__media__cache_8c.html#ad09fa931f468002152a3cc2d5ce25eae">unload_module</a> (void)</td></tr>
<tr class="separator:ad09fa931f468002152a3cc2d5ce25eae"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="var-members"></a>
Variables</h2></td></tr>
<tr class="memitem:ab22f32016155f7f403e7178767163d7d"><td class="memItemLeft" align="right" valign="top">static struct <a class="el" href="../../dd/d5f/structast__module__info.html">ast_module_info</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d5/d52/res__http__media__cache_8c.html#ab22f32016155f7f403e7178767163d7d">__mod_info</a> = { .<a class="el" href="../../d1/da4/res__corosync_8c.html#a8f8f80d37794cde9472343e4487ba3eb">name</a> = <a class="el" href="../../da/ddd/named__acl_8c.html#aec23fc5034c3bb08140fc021f4955877">AST_MODULE</a>, .flags = <a class="el" href="../../d5/d16/module_8h.html#a155a0df9c59e04e305d4a2fa3e35f843a54af2a9b29d140908cc9dffd0618951b">AST_MODFLAG_DEFAULT</a> , .description = &quot;HTTP Media Cache Backend&quot; , .key = &quot;This paragraph is copyright (<a class="el" href="../../d7/d6f/test__linkedlists_8c.html#acd9db00336027462cfb25b97b5356883">c</a>) 2006 by Digium, Inc. \In <a class="el" href="../../d5/d14/voicin_8c.html#aed7ca058008dc3e5ee131e575abed285">order</a> for your module to load, it must return this \key via <a class="el" href="../../d7/d6f/test__linkedlists_8c.html#a13dd15487fee89a002d17ef3aff62d02">a</a> function called \&quot;key\&quot;. Any code which \includes this paragraph must <a class="el" href="../../dd/d7c/eagi__proxy_8c.html#a39730e90126aad69cfc9ca4d6fcdb3a6">be</a> licensed under the GNU \General Public License <a class="el" href="../../da/d7c/utils_2frame_8h.html#a56abfaab87c46691c1ef3ad0df23e864">version</a> 2 or later (at your \option). In addition to Digium's general reservations \of rights, Digium expressly reserves the right to \allow other parties to license this paragraph under \different terms. Any use of Digium, Inc. trademarks or \logos (including \&quot;Asterisk\&quot; or \&quot;Digium\&quot;) without \express written <a class="el" href="../../d4/d4c/structpermission.html">permission</a> of Digium, Inc. is prohibited.\n&quot; , .buildopt_sum = &quot;30ef0c93b36035ec78c9cfd712d36d9b&quot; , .support_level = AST_MODULE_SUPPORT_CORE, .load = load_module, .unload = unload_module, .requires = &quot;res_curl&quot;, }</td></tr>
<tr class="separator:ab22f32016155f7f403e7178767163d7d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad60e83b9aa660040fed4d5377966cc21"><td class="memItemLeft" align="right" valign="top">static const struct <a class="el" href="../../dd/d5f/structast__module__info.html">ast_module_info</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d5/d52/res__http__media__cache_8c.html#ad60e83b9aa660040fed4d5377966cc21">ast_module_info</a> = &amp;<a class="el" href="../../d6/d7a/test__xml__escape_8c.html#ab22f32016155f7f403e7178767163d7d">__mod_info</a></td></tr>
<tr class="separator:ad60e83b9aa660040fed4d5377966cc21"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa9a734dcc11abc593c81b010e8d62a74"><td class="memItemLeft" align="right" valign="top">static struct <a class="el" href="../../dd/d0a/structast__sorcery__wizard.html">ast_sorcery_wizard</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d5/d52/res__http__media__cache_8c.html#aa9a734dcc11abc593c81b010e8d62a74">http_bucket_file_wizard</a></td></tr>
<tr class="separator:aa9a734dcc11abc593c81b010e8d62a74"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6fadbb0500ad47a2e95d57259292ca17"><td class="memItemLeft" align="right" valign="top">static struct <a class="el" href="../../dd/d0a/structast__sorcery__wizard.html">ast_sorcery_wizard</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d5/d52/res__http__media__cache_8c.html#a6fadbb0500ad47a2e95d57259292ca17">http_bucket_wizard</a></td></tr>
<tr class="separator:a6fadbb0500ad47a2e95d57259292ca17"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:abc709e8aaa37e7f11454d2ec2ace3cd6"><td class="memItemLeft" align="right" valign="top">static struct <a class="el" href="../../dd/d0a/structast__sorcery__wizard.html">ast_sorcery_wizard</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d5/d52/res__http__media__cache_8c.html#abc709e8aaa37e7f11454d2ec2ace3cd6">https_bucket_file_wizard</a></td></tr>
<tr class="separator:abc709e8aaa37e7f11454d2ec2ace3cd6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aaf4640e8693ca1809f06535301769ba9"><td class="memItemLeft" align="right" valign="top">static struct <a class="el" href="../../dd/d0a/structast__sorcery__wizard.html">ast_sorcery_wizard</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d5/d52/res__http__media__cache_8c.html#aaf4640e8693ca1809f06535301769ba9">https_bucket_wizard</a></td></tr>
<tr class="separator:aaf4640e8693ca1809f06535301769ba9"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><dl class="section author"><dt>Author</dt><dd><pre class="fragment">Matt Jordan &lt;mjordan@digium.com&gt; </pre></dd></dl>
<p>HTTP backend for the core media cache </p>

<p class="definition">Definition in file <a class="el" href="../../d5/d52/res__http__media__cache_8c_source.html">res_http_media_cache.c</a>.</p>
</div><h2 class="groupheader">Macro Definition Documentation</h2>
<a id="ad9f74a3dcbfde83a6538a60020059b75"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad9f74a3dcbfde83a6538a60020059b75">&#9670;&nbsp;</a></span>GLOBAL_USERAGENT</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define GLOBAL_USERAGENT&#160;&#160;&#160;&quot;asterisk-libcurl-agent/1.0&quot;</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="../../d5/d52/res__http__media__cache_8c_source.html#l00043">43</a> of file <a class="el" href="../../d5/d52/res__http__media__cache_8c_source.html">res_http_media_cache.c</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../d5/d52/res__http__media__cache_8c_source.html#l00204">get_curl_instance()</a>.</p>

</div>
</div>
<a id="af199a39319b90015d86f3c3ccccf42bc"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af199a39319b90015d86f3c3ccccf42bc">&#9670;&nbsp;</a></span>MAX_HEADER_LENGTH</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define MAX_HEADER_LENGTH&#160;&#160;&#160;1023</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="../../d5/d52/res__http__media__cache_8c_source.html#l00045">45</a> of file <a class="el" href="../../d5/d52/res__http__media__cache_8c_source.html">res_http_media_cache.c</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../d5/d52/res__http__media__cache_8c_source.html#l00058">curl_header_callback()</a>.</p>

</div>
</div>
<h2 class="groupheader">Function Documentation</h2>
<a id="a88b7c88fed6b80fd18f34f97757dfc04"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a88b7c88fed6b80fd18f34f97757dfc04">&#9670;&nbsp;</a></span>__reg_module()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void __reg_module </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="../../d5/d52/res__http__media__cache_8c_source.html#l00447">447</a> of file <a class="el" href="../../d5/d52/res__http__media__cache_8c_source.html">res_http_media_cache.c</a>.</p>

</div>
</div>
<a id="afeab1257bd17282b95875499393a147a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#afeab1257bd17282b95875499393a147a">&#9670;&nbsp;</a></span>__unreg_module()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void __unreg_module </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="../../d5/d52/res__http__media__cache_8c_source.html#l00447">447</a> of file <a class="el" href="../../d5/d52/res__http__media__cache_8c_source.html">res_http_media_cache.c</a>.</p>

</div>
</div>
<a id="a4fb0aca9bbcdb9709fa52a70aded6cae"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4fb0aca9bbcdb9709fa52a70aded6cae">&#9670;&nbsp;</a></span>AST_MODULE_SELF_SYM()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="../../d9/df5/structast__module.html">ast_module</a>* AST_MODULE_SELF_SYM </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="../../d5/d52/res__http__media__cache_8c_source.html#l00447">447</a> of file <a class="el" href="../../d5/d52/res__http__media__cache_8c_source.html">res_http_media_cache.c</a>.</p>

</div>
</div>
<a id="ac389921d8b67f678c6d79b8490d15f76"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac389921d8b67f678c6d79b8490d15f76">&#9670;&nbsp;</a></span>bucket_file_always_revalidate()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int bucket_file_always_revalidate </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="../../d9/da9/structast__bucket__file.html">ast_bucket_file</a> *&#160;</td>
          <td class="paramname"><em>bucket_file</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="../../d5/d52/res__http__media__cache_8c_source.html#l00161">161</a> of file <a class="el" href="../../d5/d52/res__http__media__cache_8c_source.html">res_http_media_cache.c</a>.</p>

<p class="reference">References <a class="el" href="../../d5/da5/astobj2_8h_source.html#l01958">ao2_cleanup</a>, <a class="el" href="../../db/d43/bucket_8c_source.html#l00359">ast_bucket_file_metadata_get()</a>, and <a class="el" href="../../d5/d60/utils_8h_source.html#l00911">RAII_VAR</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../d5/d52/res__http__media__cache_8c_source.html#l00290">bucket_http_wizard_is_stale()</a>.</p>
<div class="fragment"><div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;{</div><div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;   <a class="code" href="../../d5/d60/utils_8h.html#a1604b4d72144dd3d9f7da668e90337e9">RAII_VAR</a>(<span class="keyword">struct</span> <a class="code" href="../../de/d33/structast__bucket__metadata.html">ast_bucket_metadata</a> *, metadata,</div><div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;      <a class="code" href="../../dd/d94/bucket_8h.html#a9631c13cf74292833016f67fd06306b9">ast_bucket_file_metadata_get</a>(bucket_file, <span class="stringliteral">&quot;cache-control&quot;</span>),</div><div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;      <a class="code" href="../../d5/da5/astobj2_8h.html#a6321ee982370c55ab3c24c72c562cbdd">ao2_cleanup</a>);</div><div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;</div><div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;   <span class="keywordflow">if</span> (!metadata) {</div><div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;      <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;   }</div><div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;</div><div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;   <span class="keywordflow">if</span> (strstr(metadata-&gt;value, <span class="stringliteral">&quot;no-cache&quot;</span>)</div><div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;      || strstr(metadata-&gt;value, <span class="stringliteral">&quot;must-revalidate&quot;</span>)) {</div><div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;      <span class="keywordflow">return</span> 1;</div><div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;   }</div><div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;</div><div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;   <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;}</div><div class="ttc" id="bucket_8h_html_a9631c13cf74292833016f67fd06306b9"><div class="ttname"><a href="../../dd/d94/bucket_8h.html#a9631c13cf74292833016f67fd06306b9">ast_bucket_file_metadata_get</a></div><div class="ttdeci">struct ast_bucket_metadata * ast_bucket_file_metadata_get(struct ast_bucket_file *file, const char *name)</div><div class="ttdoc">Retrieve a metadata attribute from a file. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/d43/bucket_8c_source.html#l00359">bucket.c:359</a></div></div>
<div class="ttc" id="utils_8h_html_a1604b4d72144dd3d9f7da668e90337e9"><div class="ttname"><a href="../../d5/d60/utils_8h.html#a1604b4d72144dd3d9f7da668e90337e9">RAII_VAR</a></div><div class="ttdeci">#define RAII_VAR(vartype, varname, initval, dtor)</div><div class="ttdoc">Declare a variable that will call a destructor function when it goes out of scope. </div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d60/utils_8h_source.html#l00911">utils.h:911</a></div></div>
<div class="ttc" id="structast__bucket__metadata_html"><div class="ttname"><a href="../../de/d33/structast__bucket__metadata.html">ast_bucket_metadata</a></div><div class="ttdoc">Bucket metadata structure, AO2 key value pair. </div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d94/bucket_8h_source.html#l00047">bucket.h:47</a></div></div>
<div class="ttc" id="astobj2_8h_html_a6321ee982370c55ab3c24c72c562cbdd"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#a6321ee982370c55ab3c24c72c562cbdd">ao2_cleanup</a></div><div class="ttdeci">#define ao2_cleanup(obj)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l01958">astobj2.h:1958</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a4f5082a6ad6c59f1da998114ed6196a2"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4f5082a6ad6c59f1da998114ed6196a2">&#9670;&nbsp;</a></span>bucket_file_expired()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int bucket_file_expired </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="../../d9/da9/structast__bucket__file.html">ast_bucket_file</a> *&#160;</td>
          <td class="paramname"><em>bucket_file</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="../../d5/d52/res__http__media__cache_8c_source.html#l00182">182</a> of file <a class="el" href="../../d5/d52/res__http__media__cache_8c_source.html">res_http_media_cache.c</a>.</p>

<p class="reference">References <a class="el" href="../../d5/da5/astobj2_8h_source.html#l01958">ao2_cleanup</a>, <a class="el" href="../../db/d43/bucket_8c_source.html#l00359">ast_bucket_file_metadata_get()</a>, <a class="el" href="../../de/df7/time_8h_source.html#l00128">ast_tvcmp()</a>, <a class="el" href="../../de/df7/time_8h_source.html#l00150">ast_tvnow()</a>, and <a class="el" href="../../d5/d60/utils_8h_source.html#l00911">RAII_VAR</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../d5/d52/res__http__media__cache_8c_source.html#l00290">bucket_http_wizard_is_stale()</a>.</p>
<div class="fragment"><div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;{</div><div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;   <a class="code" href="../../d5/d60/utils_8h.html#a1604b4d72144dd3d9f7da668e90337e9">RAII_VAR</a>(<span class="keyword">struct</span> <a class="code" href="../../de/d33/structast__bucket__metadata.html">ast_bucket_metadata</a> *, metadata,</div><div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;      <a class="code" href="../../dd/d94/bucket_8h.html#a9631c13cf74292833016f67fd06306b9">ast_bucket_file_metadata_get</a>(bucket_file, <span class="stringliteral">&quot;__actual_expires&quot;</span>),</div><div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;      <a class="code" href="../../d5/da5/astobj2_8h.html#a6321ee982370c55ab3c24c72c562cbdd">ao2_cleanup</a>);</div><div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;   <span class="keyword">struct </span>timeval current_time = <a class="code" href="../../de/df7/time_8h.html#ad3899efb6f0e348556ef69f5b16aa7f7">ast_tvnow</a>();</div><div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;   <span class="keyword">struct </span>timeval expires = { .tv_sec = 0, .tv_usec = 0 };</div><div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;</div><div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;   <span class="keywordflow">if</span> (!metadata) {</div><div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;      <span class="keywordflow">return</span> 1;</div><div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;   }</div><div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;</div><div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;   <span class="keywordflow">if</span> (sscanf(metadata-&gt;value, <span class="stringliteral">&quot;%lu&quot;</span>, &amp;expires.tv_sec) != 1) {</div><div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;      <span class="keywordflow">return</span> 1;</div><div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;   }</div><div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;</div><div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;   <span class="keywordflow">return</span> <a class="code" href="../../de/df7/time_8h.html#a6daa33e2052acd094bb63e78aba29733">ast_tvcmp</a>(current_time, expires) == -1 ? 0 : 1;</div><div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;}</div><div class="ttc" id="bucket_8h_html_a9631c13cf74292833016f67fd06306b9"><div class="ttname"><a href="../../dd/d94/bucket_8h.html#a9631c13cf74292833016f67fd06306b9">ast_bucket_file_metadata_get</a></div><div class="ttdeci">struct ast_bucket_metadata * ast_bucket_file_metadata_get(struct ast_bucket_file *file, const char *name)</div><div class="ttdoc">Retrieve a metadata attribute from a file. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/d43/bucket_8c_source.html#l00359">bucket.c:359</a></div></div>
<div class="ttc" id="time_8h_html_ad3899efb6f0e348556ef69f5b16aa7f7"><div class="ttname"><a href="../../de/df7/time_8h.html#ad3899efb6f0e348556ef69f5b16aa7f7">ast_tvnow</a></div><div class="ttdeci">struct timeval ast_tvnow(void)</div><div class="ttdoc">Returns current timeval. Meant to replace calls to gettimeofday(). </div><div class="ttdef"><b>Definition:</b> <a href="../../de/df7/time_8h_source.html#l00150">time.h:150</a></div></div>
<div class="ttc" id="utils_8h_html_a1604b4d72144dd3d9f7da668e90337e9"><div class="ttname"><a href="../../d5/d60/utils_8h.html#a1604b4d72144dd3d9f7da668e90337e9">RAII_VAR</a></div><div class="ttdeci">#define RAII_VAR(vartype, varname, initval, dtor)</div><div class="ttdoc">Declare a variable that will call a destructor function when it goes out of scope. </div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d60/utils_8h_source.html#l00911">utils.h:911</a></div></div>
<div class="ttc" id="time_8h_html_a6daa33e2052acd094bb63e78aba29733"><div class="ttname"><a href="../../de/df7/time_8h.html#a6daa33e2052acd094bb63e78aba29733">ast_tvcmp</a></div><div class="ttdeci">int ast_tvcmp(struct timeval _a, struct timeval _b)</div><div class="ttdoc">Compres two struct timeval instances returning -1, 0, 1 if the first arg is smaller, equal or greater to the second. </div><div class="ttdef"><b>Definition:</b> <a href="../../de/df7/time_8h_source.html#l00128">time.h:128</a></div></div>
<div class="ttc" id="structast__bucket__metadata_html"><div class="ttname"><a href="../../de/d33/structast__bucket__metadata.html">ast_bucket_metadata</a></div><div class="ttdoc">Bucket metadata structure, AO2 key value pair. </div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d94/bucket_8h_source.html#l00047">bucket.h:47</a></div></div>
<div class="ttc" id="astobj2_8h_html_a6321ee982370c55ab3c24c72c562cbdd"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#a6321ee982370c55ab3c24c72c562cbdd">ao2_cleanup</a></div><div class="ttdeci">#define ao2_cleanup(obj)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l01958">astobj2.h:1958</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="ae174aec72bbbe66538d01bf7f717b37c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae174aec72bbbe66538d01bf7f717b37c">&#9670;&nbsp;</a></span>bucket_file_run_curl()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int bucket_file_run_curl </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="../../d9/da9/structast__bucket__file.html">ast_bucket_file</a> *&#160;</td>
          <td class="paramname"><em>bucket_file</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="../../d5/d52/res__http__media__cache_8c_source.html#l00251">251</a> of file <a class="el" href="../../d5/d52/res__http__media__cache_8c_source.html">res_http_media_cache.c</a>.</p>

<p class="reference">References <a class="el" href="../../da/df7/astobj2_8c_source.html#l00042">ast_log</a>, <a class="el" href="../../d7/d69/sorcery_8c_source.html#l02312">ast_sorcery_object_get_id()</a>, <a class="el" href="../../d5/d52/res__http__media__cache_8c_source.html#l00050">curl_bucket_file_data::bucket_file</a>, <a class="el" href="../../d5/d52/res__http__media__cache_8c_source.html#l00116">bucket_file_set_expiration()</a>, <a class="el" href="../../d5/d52/res__http__media__cache_8c_source.html#l00103">curl_body_callback()</a>, <a class="el" href="../../d1/d6e/main_2stdtime_2private_8h.html#ad65a8842cc674e3ddf69355898c0ecbf">errno</a>, <a class="el" href="../../d5/d52/res__http__media__cache_8c_source.html#l00228">execute_curl_instance()</a>, <a class="el" href="../../d5/d52/res__http__media__cache_8c_source.html#l00204">get_curl_instance()</a>, <a class="el" href="../../d1/d8c/logger_8h_source.html#l00274">LOG_WARNING</a>, <a class="el" href="../../d5/d52/res__http__media__cache_8c_source.html#l00052">curl_bucket_file_data::out_file</a>, and <a class="el" href="../../dd/d94/bucket_8h_source.html#l00095">ast_bucket_file::path</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../d5/d52/res__http__media__cache_8c_source.html#l00333">bucket_http_wizard_create()</a>, and <a class="el" href="../../d5/d52/res__http__media__cache_8c_source.html#l00341">bucket_http_wizard_retrieve_id()</a>.</p>
<div class="fragment"><div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;{</div><div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../dd/d50/structcurl__bucket__file__data.html">curl_bucket_file_data</a> cb_data = {</div><div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;      .<a class="code" href="../../dd/d50/structcurl__bucket__file__data.html#a1be87c09b1286892c389e40582e6175b">bucket_file</a> = <a class="code" href="../../dd/d50/structcurl__bucket__file__data.html#a1be87c09b1286892c389e40582e6175b">bucket_file</a>,</div><div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;   };</div><div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;   <span class="keywordtype">long</span> http_code;</div><div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;   CURL *curl;</div><div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;</div><div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;   cb_data.<a class="code" href="../../dd/d50/structcurl__bucket__file__data.html#ab297e8b6af734888d3dc2cfe335a9d44">out_file</a> = fopen(bucket_file-&gt;<a class="code" href="../../d9/da9/structast__bucket__file.html#ae8592c5c8f37a4598973aaa27f45dc4c">path</a>, <span class="stringliteral">&quot;wb&quot;</span>);</div><div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;   <span class="keywordflow">if</span> (!cb_data.<a class="code" href="../../dd/d50/structcurl__bucket__file__data.html#ab297e8b6af734888d3dc2cfe335a9d44">out_file</a>) {</div><div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Failed to open file &#39;%s&#39; for writing: %s (%d)\n&quot;</span>,</div><div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;         bucket_file-&gt;<a class="code" href="../../d9/da9/structast__bucket__file.html#ae8592c5c8f37a4598973aaa27f45dc4c">path</a>, strerror(<a class="code" href="../../d1/d6e/main_2stdtime_2private_8h.html#ad65a8842cc674e3ddf69355898c0ecbf">errno</a>), <a class="code" href="../../d1/d6e/main_2stdtime_2private_8h.html#ad65a8842cc674e3ddf69355898c0ecbf">errno</a>);</div><div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;   }</div><div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;</div><div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;   curl = <a class="code" href="../../d5/d52/res__http__media__cache_8c.html#a693dad05b109a75ff840b8b39f1dda54">get_curl_instance</a>(&amp;cb_data);</div><div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;   <span class="keywordflow">if</span> (!curl) {</div><div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;      fclose(cb_data.<a class="code" href="../../dd/d50/structcurl__bucket__file__data.html#ab297e8b6af734888d3dc2cfe335a9d44">out_file</a>);</div><div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;   }</div><div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;</div><div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;   curl_easy_setopt(curl, CURLOPT_WRITEFUNCTION, <a class="code" href="../../d5/d52/res__http__media__cache_8c.html#a6e9a040ef6f91676b4a11ac58c04f8a0">curl_body_callback</a>);</div><div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;   curl_easy_setopt(curl, CURLOPT_WRITEDATA, (<span class="keywordtype">void</span>*)&amp;cb_data);</div><div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;</div><div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;   http_code = <a class="code" href="../../d5/d52/res__http__media__cache_8c.html#acf8b5f1fa60f9ca07080ac9ac89c0b9c">execute_curl_instance</a>(curl);</div><div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;</div><div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;   fclose(cb_data.<a class="code" href="../../dd/d50/structcurl__bucket__file__data.html#ab297e8b6af734888d3dc2cfe335a9d44">out_file</a>);</div><div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;</div><div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;   <span class="keywordflow">if</span> (http_code / 100 == 2) {</div><div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;      <a class="code" href="../../d5/d52/res__http__media__cache_8c.html#a2968d0aefb6b287d88ae1e23fc57f792">bucket_file_set_expiration</a>(bucket_file);</div><div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;      <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;   } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Failed to retrieve URL &#39;%s&#39;: server returned %ld\n&quot;</span>,</div><div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;         <a class="code" href="../../d8/d25/sorcery_8h.html#a97706283a06cbb44e4f0f9620dd5cf07">ast_sorcery_object_get_id</a>(bucket_file), http_code);</div><div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;   }</div><div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;</div><div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;   <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;}</div><div class="ttc" id="res__http__media__cache_8c_html_a2968d0aefb6b287d88ae1e23fc57f792"><div class="ttname"><a href="../../d5/d52/res__http__media__cache_8c.html#a2968d0aefb6b287d88ae1e23fc57f792">bucket_file_set_expiration</a></div><div class="ttdeci">static void bucket_file_set_expiration(struct ast_bucket_file *bucket_file)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d52/res__http__media__cache_8c_source.html#l00116">res_http_media_cache.c:116</a></div></div>
<div class="ttc" id="structcurl__bucket__file__data_html_a1be87c09b1286892c389e40582e6175b"><div class="ttname"><a href="../../dd/d50/structcurl__bucket__file__data.html#a1be87c09b1286892c389e40582e6175b">curl_bucket_file_data::bucket_file</a></div><div class="ttdeci">struct ast_bucket_file * bucket_file</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d52/res__http__media__cache_8c_source.html#l00050">res_http_media_cache.c:50</a></div></div>
<div class="ttc" id="logger_8h_html_adf4476a6a4ea6c74231c826e899d7189"><div class="ttname"><a href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a></div><div class="ttdeci">#define LOG_WARNING</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d8c/logger_8h_source.html#l00274">logger.h:274</a></div></div>
<div class="ttc" id="structcurl__bucket__file__data_html_ab297e8b6af734888d3dc2cfe335a9d44"><div class="ttname"><a href="../../dd/d50/structcurl__bucket__file__data.html#ab297e8b6af734888d3dc2cfe335a9d44">curl_bucket_file_data::out_file</a></div><div class="ttdeci">FILE * out_file</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d52/res__http__media__cache_8c_source.html#l00052">res_http_media_cache.c:52</a></div></div>
<div class="ttc" id="astobj2_8c_html_a96a00b3a518d7f32b6d51dc28f09bf9b"><div class="ttname"><a href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a></div><div class="ttdeci">#define ast_log</div><div class="ttdef"><b>Definition:</b> <a href="../../da/df7/astobj2_8c_source.html#l00042">astobj2.c:42</a></div></div>
<div class="ttc" id="sorcery_8h_html_a97706283a06cbb44e4f0f9620dd5cf07"><div class="ttname"><a href="../../d8/d25/sorcery_8h.html#a97706283a06cbb44e4f0f9620dd5cf07">ast_sorcery_object_get_id</a></div><div class="ttdeci">const char * ast_sorcery_object_get_id(const void *object)</div><div class="ttdoc">Get the unique identifier of a sorcery object. </div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d69/sorcery_8c_source.html#l02312">sorcery.c:2312</a></div></div>
<div class="ttc" id="structcurl__bucket__file__data_html"><div class="ttname"><a href="../../dd/d50/structcurl__bucket__file__data.html">curl_bucket_file_data</a></div><div class="ttdoc">Data passed to cURL callbacks. </div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d52/res__http__media__cache_8c_source.html#l00048">res_http_media_cache.c:48</a></div></div>
<div class="ttc" id="res__http__media__cache_8c_html_acf8b5f1fa60f9ca07080ac9ac89c0b9c"><div class="ttname"><a href="../../d5/d52/res__http__media__cache_8c.html#acf8b5f1fa60f9ca07080ac9ac89c0b9c">execute_curl_instance</a></div><div class="ttdeci">static long execute_curl_instance(CURL *curl)</div><div class="ttdoc">Execute the CURL. </div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d52/res__http__media__cache_8c_source.html#l00228">res_http_media_cache.c:228</a></div></div>
<div class="ttc" id="main_2stdtime_2private_8h_html_ad65a8842cc674e3ddf69355898c0ecbf"><div class="ttname"><a href="../../d1/d6e/main_2stdtime_2private_8h.html#ad65a8842cc674e3ddf69355898c0ecbf">errno</a></div><div class="ttdeci">int errno</div></div>
<div class="ttc" id="res__http__media__cache_8c_html_a693dad05b109a75ff840b8b39f1dda54"><div class="ttname"><a href="../../d5/d52/res__http__media__cache_8c.html#a693dad05b109a75ff840b8b39f1dda54">get_curl_instance</a></div><div class="ttdeci">static CURL * get_curl_instance(struct curl_bucket_file_data *cb_data)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d52/res__http__media__cache_8c_source.html#l00204">res_http_media_cache.c:204</a></div></div>
<div class="ttc" id="res__http__media__cache_8c_html_a6e9a040ef6f91676b4a11ac58c04f8a0"><div class="ttname"><a href="../../d5/d52/res__http__media__cache_8c.html#a6e9a040ef6f91676b4a11ac58c04f8a0">curl_body_callback</a></div><div class="ttdeci">static size_t curl_body_callback(void *ptr, size_t size, size_t nitems, void *data)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d52/res__http__media__cache_8c_source.html#l00103">res_http_media_cache.c:103</a></div></div>
<div class="ttc" id="structast__bucket__file_html_ae8592c5c8f37a4598973aaa27f45dc4c"><div class="ttname"><a href="../../d9/da9/structast__bucket__file.html#ae8592c5c8f37a4598973aaa27f45dc4c">ast_bucket_file::path</a></div><div class="ttdeci">char path[PATH_MAX]</div><div class="ttdoc">Local path to this file. </div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d94/bucket_8h_source.html#l00095">bucket.h:95</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a2968d0aefb6b287d88ae1e23fc57f792"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2968d0aefb6b287d88ae1e23fc57f792">&#9670;&nbsp;</a></span>bucket_file_set_expiration()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void bucket_file_set_expiration </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="../../d9/da9/structast__bucket__file.html">ast_bucket_file</a> *&#160;</td>
          <td class="paramname"><em>bucket_file</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="../../d5/d52/res__http__media__cache_8c_source.html#l00116">116</a> of file <a class="el" href="../../d5/d52/res__http__media__cache_8c_source.html">res_http_media_cache.c</a>.</p>

<p class="reference">References <a class="el" href="../../d5/da5/astobj2_8h_source.html#l00464">ao2_ref</a>, <a class="el" href="../../db/d43/bucket_8c_source.html#l00359">ast_bucket_file_metadata_get()</a>, <a class="el" href="../../db/d43/bucket_8c_source.html#l00334">ast_bucket_file_metadata_set()</a>, <a class="el" href="../../de/df7/time_8h_source.html#l00150">ast_tvnow()</a>, and <a class="el" href="../../dd/d94/bucket_8h_source.html#l00051">ast_bucket_metadata::value</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../d5/d52/res__http__media__cache_8c_source.html#l00251">bucket_file_run_curl()</a>, and <a class="el" href="../../d5/d52/res__http__media__cache_8c_source.html#l00290">bucket_http_wizard_is_stale()</a>.</p>
<div class="fragment"><div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;{</div><div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../de/d33/structast__bucket__metadata.html">ast_bucket_metadata</a> *metadata;</div><div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;   <span class="keywordtype">char</span> time_buf[32];</div><div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;   <span class="keyword">struct </span>timeval actual_expires = <a class="code" href="../../de/df7/time_8h.html#ad3899efb6f0e348556ef69f5b16aa7f7">ast_tvnow</a>();</div><div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;</div><div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;   metadata = <a class="code" href="../../dd/d94/bucket_8h.html#a9631c13cf74292833016f67fd06306b9">ast_bucket_file_metadata_get</a>(bucket_file, <span class="stringliteral">&quot;cache-control&quot;</span>);</div><div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;   <span class="keywordflow">if</span> (metadata) {</div><div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;      <span class="keywordtype">char</span> *str_max_age;</div><div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;</div><div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;      str_max_age = strstr(metadata-&gt;<a class="code" href="../../de/d33/structast__bucket__metadata.html#a8556878012feffc9e0beb86cd78f424d">value</a>, <span class="stringliteral">&quot;s-maxage&quot;</span>);</div><div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;      <span class="keywordflow">if</span> (!str_max_age) {</div><div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;         str_max_age = strstr(metadata-&gt;<a class="code" href="../../de/d33/structast__bucket__metadata.html#a8556878012feffc9e0beb86cd78f424d">value</a>, <span class="stringliteral">&quot;max-age&quot;</span>);</div><div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;      }</div><div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;</div><div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;      <span class="keywordflow">if</span> (str_max_age) {</div><div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;         <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> max_age;</div><div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;         <span class="keywordtype">char</span> *equal = strchr(str_max_age, <span class="charliteral">&#39;=&#39;</span>);</div><div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;         <span class="keywordflow">if</span> (equal &amp;&amp; (sscanf(equal + 1, <span class="stringliteral">&quot;%30u&quot;</span>, &amp;max_age) == 1)) {</div><div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;            actual_expires.tv_sec += max_age;</div><div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;         }</div><div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;      }</div><div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;      <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(metadata, -1);</div><div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;   } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;      metadata = <a class="code" href="../../dd/d94/bucket_8h.html#a9631c13cf74292833016f67fd06306b9">ast_bucket_file_metadata_get</a>(bucket_file, <span class="stringliteral">&quot;expires&quot;</span>);</div><div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;      <span class="keywordflow">if</span> (metadata) {</div><div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;         <span class="keyword">struct </span>tm expires_time;</div><div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;</div><div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;         strptime(metadata-&gt;<a class="code" href="../../de/d33/structast__bucket__metadata.html#a8556878012feffc9e0beb86cd78f424d">value</a>, <span class="stringliteral">&quot;%a, %d %b %Y %T %z&quot;</span>, &amp;expires_time);</div><div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;         expires_time.tm_isdst = -1;</div><div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;         actual_expires.tv_sec = mktime(&amp;expires_time);</div><div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;</div><div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;         <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(metadata, -1);</div><div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;      }</div><div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;   }</div><div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;</div><div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;   <span class="comment">/* Use &#39;now&#39; if we didn&#39;t get an expiration time */</span></div><div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;   snprintf(time_buf, <span class="keyword">sizeof</span>(time_buf), <span class="stringliteral">&quot;%30lu&quot;</span>, actual_expires.tv_sec);</div><div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;</div><div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;   <a class="code" href="../../dd/d94/bucket_8h.html#a1b6e8f9435b8b53ce68578c369702980">ast_bucket_file_metadata_set</a>(bucket_file, <span class="stringliteral">&quot;__actual_expires&quot;</span>, time_buf);</div><div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;}</div><div class="ttc" id="bucket_8h_html_a9631c13cf74292833016f67fd06306b9"><div class="ttname"><a href="../../dd/d94/bucket_8h.html#a9631c13cf74292833016f67fd06306b9">ast_bucket_file_metadata_get</a></div><div class="ttdeci">struct ast_bucket_metadata * ast_bucket_file_metadata_get(struct ast_bucket_file *file, const char *name)</div><div class="ttdoc">Retrieve a metadata attribute from a file. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/d43/bucket_8c_source.html#l00359">bucket.c:359</a></div></div>
<div class="ttc" id="bucket_8h_html_a1b6e8f9435b8b53ce68578c369702980"><div class="ttname"><a href="../../dd/d94/bucket_8h.html#a1b6e8f9435b8b53ce68578c369702980">ast_bucket_file_metadata_set</a></div><div class="ttdeci">int ast_bucket_file_metadata_set(struct ast_bucket_file *file, const char *name, const char *value)</div><div class="ttdoc">Set a metadata attribute on a file to a specific value. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/d43/bucket_8c_source.html#l00334">bucket.c:334</a></div></div>
<div class="ttc" id="time_8h_html_ad3899efb6f0e348556ef69f5b16aa7f7"><div class="ttname"><a href="../../de/df7/time_8h.html#ad3899efb6f0e348556ef69f5b16aa7f7">ast_tvnow</a></div><div class="ttdeci">struct timeval ast_tvnow(void)</div><div class="ttdoc">Returns current timeval. Meant to replace calls to gettimeofday(). </div><div class="ttdef"><b>Definition:</b> <a href="../../de/df7/time_8h_source.html#l00150">time.h:150</a></div></div>
<div class="ttc" id="structast__bucket__metadata_html_a8556878012feffc9e0beb86cd78f424d"><div class="ttname"><a href="../../de/d33/structast__bucket__metadata.html#a8556878012feffc9e0beb86cd78f424d">ast_bucket_metadata::value</a></div><div class="ttdeci">const char * value</div><div class="ttdoc">Value of the attribute. </div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d94/bucket_8h_source.html#l00051">bucket.h:51</a></div></div>
<div class="ttc" id="astobj2_8h_html_aaca5e8eac39a22f9da1c36fc6c922270"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a></div><div class="ttdeci">#define ao2_ref(o, delta)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l00464">astobj2.h:464</a></div></div>
<div class="ttc" id="structast__bucket__metadata_html"><div class="ttname"><a href="../../de/d33/structast__bucket__metadata.html">ast_bucket_metadata</a></div><div class="ttdoc">Bucket metadata structure, AO2 key value pair. </div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d94/bucket_8h_source.html#l00047">bucket.h:47</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="ac12b04a36b6c297f490c993b61cba30a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac12b04a36b6c297f490c993b61cba30a">&#9670;&nbsp;</a></span>bucket_http_wizard_create()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int bucket_http_wizard_create </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="../../d2/d88/structast__sorcery.html">ast_sorcery</a> *&#160;</td>
          <td class="paramname"><em>sorcery</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>data</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>object</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="../../d5/d52/res__http__media__cache_8c_source.html#l00333">333</a> of file <a class="el" href="../../d5/d52/res__http__media__cache_8c_source.html">res_http_media_cache.c</a>.</p>

<p class="reference">References <a class="el" href="../../d5/d52/res__http__media__cache_8c_source.html#l00050">curl_bucket_file_data::bucket_file</a>, and <a class="el" href="../../d5/d52/res__http__media__cache_8c_source.html#l00251">bucket_file_run_curl()</a>.</p>
<div class="fragment"><div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;{</div><div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d9/da9/structast__bucket__file.html">ast_bucket_file</a> *bucket_file = object;</div><div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;</div><div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;   <span class="keywordflow">return</span> <a class="code" href="../../d5/d52/res__http__media__cache_8c.html#ae174aec72bbbe66538d01bf7f717b37c">bucket_file_run_curl</a>(bucket_file);</div><div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;}</div><div class="ttc" id="structast__bucket__file_html"><div class="ttname"><a href="../../d9/da9/structast__bucket__file.html">ast_bucket_file</a></div><div class="ttdoc">Bucket file structure, contains reference to file and information about it. </div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d94/bucket_8h_source.html#l00078">bucket.h:78</a></div></div>
<div class="ttc" id="res__http__media__cache_8c_html_ae174aec72bbbe66538d01bf7f717b37c"><div class="ttname"><a href="../../d5/d52/res__http__media__cache_8c.html#ae174aec72bbbe66538d01bf7f717b37c">bucket_file_run_curl</a></div><div class="ttdeci">static int bucket_file_run_curl(struct ast_bucket_file *bucket_file)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d52/res__http__media__cache_8c_source.html#l00251">res_http_media_cache.c:251</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="aa8ab6e21a6fc7fb23808c475fd37cb8e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa8ab6e21a6fc7fb23808c475fd37cb8e">&#9670;&nbsp;</a></span>bucket_http_wizard_delete()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int bucket_http_wizard_delete </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="../../d2/d88/structast__sorcery.html">ast_sorcery</a> *&#160;</td>
          <td class="paramname"><em>sorcery</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>data</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>object</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="../../d5/d52/res__http__media__cache_8c_source.html#l00378">378</a> of file <a class="el" href="../../d5/d52/res__http__media__cache_8c_source.html">res_http_media_cache.c</a>.</p>

<p class="reference">References <a class="el" href="../../d5/d52/res__http__media__cache_8c_source.html#l00050">curl_bucket_file_data::bucket_file</a>, and <a class="el" href="../../dd/d94/bucket_8h_source.html#l00095">ast_bucket_file::path</a>.</p>
<div class="fragment"><div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;{</div><div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d9/da9/structast__bucket__file.html">ast_bucket_file</a> *bucket_file = object;</div><div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;</div><div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;   unlink(bucket_file-&gt;<a class="code" href="../../d9/da9/structast__bucket__file.html#ae8592c5c8f37a4598973aaa27f45dc4c">path</a>);</div><div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;</div><div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;   <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;}</div><div class="ttc" id="structast__bucket__file_html"><div class="ttname"><a href="../../d9/da9/structast__bucket__file.html">ast_bucket_file</a></div><div class="ttdoc">Bucket file structure, contains reference to file and information about it. </div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d94/bucket_8h_source.html#l00078">bucket.h:78</a></div></div>
<div class="ttc" id="structast__bucket__file_html_ae8592c5c8f37a4598973aaa27f45dc4c"><div class="ttname"><a href="../../d9/da9/structast__bucket__file.html#ae8592c5c8f37a4598973aaa27f45dc4c">ast_bucket_file::path</a></div><div class="ttdeci">char path[PATH_MAX]</div><div class="ttdoc">Local path to this file. </div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d94/bucket_8h_source.html#l00095">bucket.h:95</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="ad7bb005f59dbc3638891099126246a95"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad7bb005f59dbc3638891099126246a95">&#9670;&nbsp;</a></span>bucket_http_wizard_is_stale()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int bucket_http_wizard_is_stale </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="../../d2/d88/structast__sorcery.html">ast_sorcery</a> *&#160;</td>
          <td class="paramname"><em>sorcery</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>data</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>object</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="../../d5/d52/res__http__media__cache_8c_source.html#l00290">290</a> of file <a class="el" href="../../d5/d52/res__http__media__cache_8c_source.html">res_http_media_cache.c</a>.</p>

<p class="reference">References <a class="el" href="../../d5/da5/astobj2_8h_source.html#l00464">ao2_ref</a>, <a class="el" href="../../db/d43/bucket_8c_source.html#l00359">ast_bucket_file_metadata_get()</a>, <a class="el" href="../../d5/d52/res__http__media__cache_8c_source.html#l00050">curl_bucket_file_data::bucket_file</a>, <a class="el" href="../../d5/d52/res__http__media__cache_8c_source.html#l00161">bucket_file_always_revalidate()</a>, <a class="el" href="../../d5/d52/res__http__media__cache_8c_source.html#l00182">bucket_file_expired()</a>, <a class="el" href="../../d5/d52/res__http__media__cache_8c_source.html#l00116">bucket_file_set_expiration()</a>, <a class="el" href="../../d5/d52/res__http__media__cache_8c_source.html#l00228">execute_curl_instance()</a>, <a class="el" href="../../d5/d52/res__http__media__cache_8c_source.html#l00204">get_curl_instance()</a>, <a class="el" href="../../dc/d7f/resample_8c_source.html#l00096">NULL</a>, and <a class="el" href="../../dd/d94/bucket_8h_source.html#l00051">ast_bucket_metadata::value</a>.</p>
<div class="fragment"><div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;{</div><div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d9/da9/structast__bucket__file.html">ast_bucket_file</a> *bucket_file = object;</div><div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../de/d33/structast__bucket__metadata.html">ast_bucket_metadata</a> *metadata;</div><div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;   <span class="keyword">struct </span>curl_slist *<a class="code" href="../../db/d28/structheader__list.html">header_list</a> = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;   <span class="keywordtype">long</span> http_code;</div><div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;   CURL *curl;</div><div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../dd/d50/structcurl__bucket__file__data.html">curl_bucket_file_data</a> cb_data = {</div><div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;      .<a class="code" href="../../dd/d50/structcurl__bucket__file__data.html#a1be87c09b1286892c389e40582e6175b">bucket_file</a> = bucket_file</div><div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;   };</div><div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;   <span class="keywordtype">char</span> etag_buf[256];</div><div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;</div><div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;   <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d52/res__http__media__cache_8c.html#a4f5082a6ad6c59f1da998114ed6196a2">bucket_file_expired</a>(bucket_file) &amp;&amp; !<a class="code" href="../../d5/d52/res__http__media__cache_8c.html#ac389921d8b67f678c6d79b8490d15f76">bucket_file_always_revalidate</a>(bucket_file)) {</div><div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;      <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;   }</div><div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;</div><div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;   <span class="comment">/* See if we have an ETag for this item. If not, it&#39;s stale. */</span></div><div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;   metadata = <a class="code" href="../../dd/d94/bucket_8h.html#a9631c13cf74292833016f67fd06306b9">ast_bucket_file_metadata_get</a>(bucket_file, <span class="stringliteral">&quot;etag&quot;</span>);</div><div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;   <span class="keywordflow">if</span> (!metadata) {</div><div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;      <span class="keywordflow">return</span> 1;</div><div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;   }</div><div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;</div><div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;   curl = <a class="code" href="../../d5/d52/res__http__media__cache_8c.html#a693dad05b109a75ff840b8b39f1dda54">get_curl_instance</a>(&amp;cb_data);</div><div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;</div><div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;   <span class="comment">/* Set the ETag header on our outgoing request */</span></div><div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;   snprintf(etag_buf, <span class="keyword">sizeof</span>(etag_buf), <span class="stringliteral">&quot;If-None-Match: %s&quot;</span>, metadata-&gt;<a class="code" href="../../de/d33/structast__bucket__metadata.html#a8556878012feffc9e0beb86cd78f424d">value</a>);</div><div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;   header_list = curl_slist_append(header_list, etag_buf);</div><div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;   curl_easy_setopt(curl, CURLOPT_HTTPHEADER, header_list);</div><div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;   curl_easy_setopt(curl, CURLOPT_NOBODY, 1L);</div><div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(metadata, -1);</div><div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;</div><div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;   http_code = <a class="code" href="../../d5/d52/res__http__media__cache_8c.html#acf8b5f1fa60f9ca07080ac9ac89c0b9c">execute_curl_instance</a>(curl);</div><div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;</div><div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;   curl_slist_free_all(header_list);</div><div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;</div><div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;   <span class="keywordflow">if</span> (http_code == 304) {</div><div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;      <a class="code" href="../../d5/d52/res__http__media__cache_8c.html#a2968d0aefb6b287d88ae1e23fc57f792">bucket_file_set_expiration</a>(bucket_file);</div><div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;      <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;   }</div><div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;</div><div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;   <span class="keywordflow">return</span> 1;</div><div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;}</div><div class="ttc" id="bucket_8h_html_a9631c13cf74292833016f67fd06306b9"><div class="ttname"><a href="../../dd/d94/bucket_8h.html#a9631c13cf74292833016f67fd06306b9">ast_bucket_file_metadata_get</a></div><div class="ttdeci">struct ast_bucket_metadata * ast_bucket_file_metadata_get(struct ast_bucket_file *file, const char *name)</div><div class="ttdoc">Retrieve a metadata attribute from a file. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/d43/bucket_8c_source.html#l00359">bucket.c:359</a></div></div>
<div class="ttc" id="res__http__media__cache_8c_html_a2968d0aefb6b287d88ae1e23fc57f792"><div class="ttname"><a href="../../d5/d52/res__http__media__cache_8c.html#a2968d0aefb6b287d88ae1e23fc57f792">bucket_file_set_expiration</a></div><div class="ttdeci">static void bucket_file_set_expiration(struct ast_bucket_file *bucket_file)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d52/res__http__media__cache_8c_source.html#l00116">res_http_media_cache.c:116</a></div></div>
<div class="ttc" id="structheader__list_html"><div class="ttname"><a href="../../db/d28/structheader__list.html">header_list</a></div><div class="ttdef"><b>Definition:</b> <a href="../../db/d73/pjsip__global__headers_8c_source.html#l00077">pjsip_global_headers.c:77</a></div></div>
<div class="ttc" id="structcurl__bucket__file__data_html_a1be87c09b1286892c389e40582e6175b"><div class="ttname"><a href="../../dd/d50/structcurl__bucket__file__data.html#a1be87c09b1286892c389e40582e6175b">curl_bucket_file_data::bucket_file</a></div><div class="ttdeci">struct ast_bucket_file * bucket_file</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d52/res__http__media__cache_8c_source.html#l00050">res_http_media_cache.c:50</a></div></div>
<div class="ttc" id="resample_8c_html_a070d2ce7b6bb7e5c05602aa8c308d0c4"><div class="ttname"><a href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a></div><div class="ttdeci">#define NULL</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d7f/resample_8c_source.html#l00096">resample.c:96</a></div></div>
<div class="ttc" id="structast__bucket__metadata_html_a8556878012feffc9e0beb86cd78f424d"><div class="ttname"><a href="../../de/d33/structast__bucket__metadata.html#a8556878012feffc9e0beb86cd78f424d">ast_bucket_metadata::value</a></div><div class="ttdeci">const char * value</div><div class="ttdoc">Value of the attribute. </div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d94/bucket_8h_source.html#l00051">bucket.h:51</a></div></div>
<div class="ttc" id="astobj2_8h_html_aaca5e8eac39a22f9da1c36fc6c922270"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a></div><div class="ttdeci">#define ao2_ref(o, delta)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l00464">astobj2.h:464</a></div></div>
<div class="ttc" id="res__http__media__cache_8c_html_a4f5082a6ad6c59f1da998114ed6196a2"><div class="ttname"><a href="../../d5/d52/res__http__media__cache_8c.html#a4f5082a6ad6c59f1da998114ed6196a2">bucket_file_expired</a></div><div class="ttdeci">static int bucket_file_expired(struct ast_bucket_file *bucket_file)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d52/res__http__media__cache_8c_source.html#l00182">res_http_media_cache.c:182</a></div></div>
<div class="ttc" id="structast__bucket__file_html"><div class="ttname"><a href="../../d9/da9/structast__bucket__file.html">ast_bucket_file</a></div><div class="ttdoc">Bucket file structure, contains reference to file and information about it. </div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d94/bucket_8h_source.html#l00078">bucket.h:78</a></div></div>
<div class="ttc" id="structcurl__bucket__file__data_html"><div class="ttname"><a href="../../dd/d50/structcurl__bucket__file__data.html">curl_bucket_file_data</a></div><div class="ttdoc">Data passed to cURL callbacks. </div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d52/res__http__media__cache_8c_source.html#l00048">res_http_media_cache.c:48</a></div></div>
<div class="ttc" id="res__http__media__cache_8c_html_acf8b5f1fa60f9ca07080ac9ac89c0b9c"><div class="ttname"><a href="../../d5/d52/res__http__media__cache_8c.html#acf8b5f1fa60f9ca07080ac9ac89c0b9c">execute_curl_instance</a></div><div class="ttdeci">static long execute_curl_instance(CURL *curl)</div><div class="ttdoc">Execute the CURL. </div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d52/res__http__media__cache_8c_source.html#l00228">res_http_media_cache.c:228</a></div></div>
<div class="ttc" id="structast__bucket__metadata_html"><div class="ttname"><a href="../../de/d33/structast__bucket__metadata.html">ast_bucket_metadata</a></div><div class="ttdoc">Bucket metadata structure, AO2 key value pair. </div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d94/bucket_8h_source.html#l00047">bucket.h:47</a></div></div>
<div class="ttc" id="res__http__media__cache_8c_html_ac389921d8b67f678c6d79b8490d15f76"><div class="ttname"><a href="../../d5/d52/res__http__media__cache_8c.html#ac389921d8b67f678c6d79b8490d15f76">bucket_file_always_revalidate</a></div><div class="ttdeci">static int bucket_file_always_revalidate(struct ast_bucket_file *bucket_file)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d52/res__http__media__cache_8c_source.html#l00161">res_http_media_cache.c:161</a></div></div>
<div class="ttc" id="res__http__media__cache_8c_html_a693dad05b109a75ff840b8b39f1dda54"><div class="ttname"><a href="../../d5/d52/res__http__media__cache_8c.html#a693dad05b109a75ff840b8b39f1dda54">get_curl_instance</a></div><div class="ttdeci">static CURL * get_curl_instance(struct curl_bucket_file_data *cb_data)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d52/res__http__media__cache_8c_source.html#l00204">res_http_media_cache.c:204</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a39b5069ed30d837ca7283c1b87a266e3"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a39b5069ed30d837ca7283c1b87a266e3">&#9670;&nbsp;</a></span>bucket_http_wizard_retrieve_id()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void* bucket_http_wizard_retrieve_id </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="../../d2/d88/structast__sorcery.html">ast_sorcery</a> *&#160;</td>
          <td class="paramname"><em>sorcery</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>data</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>type</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>id</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="../../d5/d52/res__http__media__cache_8c_source.html#l00341">341</a> of file <a class="el" href="../../d5/d52/res__http__media__cache_8c_source.html">res_http_media_cache.c</a>.</p>

<p class="reference">References <a class="el" href="../../d5/da5/astobj2_8h_source.html#l00464">ao2_ref</a>, <a class="el" href="../../db/d43/bucket_8c_source.html#l00663">ast_bucket_file_alloc()</a>, <a class="el" href="../../db/d43/bucket_8c_source.html#l00899">ast_bucket_file_temporary_create()</a>, <a class="el" href="../../da/df7/astobj2_8c_source.html#l00042">ast_log</a>, <a class="el" href="../../d7/d69/sorcery_8c_source.html#l02233">ast_sorcery_delete()</a>, <a class="el" href="../../d6/d90/strings_8h_source.html#l00052">ast_strlen_zero</a>, <a class="el" href="../../d5/d52/res__http__media__cache_8c_source.html#l00050">curl_bucket_file_data::bucket_file</a>, <a class="el" href="../../d5/d52/res__http__media__cache_8c_source.html#l00251">bucket_file_run_curl()</a>, <a class="el" href="../../d1/d8c/logger_8h_source.html#l00274">LOG_WARNING</a>, and <a class="el" href="../../dc/d7f/resample_8c_source.html#l00096">NULL</a>.</p>
<div class="fragment"><div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;{</div><div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d9/da9/structast__bucket__file.html">ast_bucket_file</a> *bucket_file;</div><div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;</div><div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;   <span class="keywordflow">if</span> (strcmp(<a class="code" href="../../d7/d49/chan__ooh323_8c.html#a4d63fdfe5451ec2248c16a2739190c56">type</a>, <span class="stringliteral">&quot;file&quot;</span>)) {</div><div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Failed to create storage: invalid bucket type &#39;%s&#39;\n&quot;</span>, <a class="code" href="../../d7/d49/chan__ooh323_8c.html#a4d63fdfe5451ec2248c16a2739190c56">type</a>);</div><div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;   }</div><div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;</div><div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a>(<span class="keywordtype">id</span>)) {</div><div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Failed to create storage: no URI\n&quot;</span>);</div><div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;   }</div><div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;</div><div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;   bucket_file = <a class="code" href="../../dd/d94/bucket_8h.html#a06c0cb2467dcf37cb1d0a932d1b86ee1">ast_bucket_file_alloc</a>(<span class="keywordtype">id</span>);</div><div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;   <span class="keywordflow">if</span> (!bucket_file) {</div><div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Failed to create storage for &#39;%s&#39;\n&quot;</span>, <span class="keywordtype">id</span>);</div><div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;   }</div><div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;</div><div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../dd/d94/bucket_8h.html#a4eb22b16d39185b0c7c0f5a574abb506">ast_bucket_file_temporary_create</a>(bucket_file)) {</div><div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Failed to create temporary storage for &#39;%s&#39;\n&quot;</span>, <span class="keywordtype">id</span>);</div><div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;      <a class="code" href="../../d8/d25/sorcery_8h.html#aeb9bd9c0bcdaff27ac438a02d472c3b1">ast_sorcery_delete</a>(sorcery, bucket_file);</div><div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;      <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(bucket_file, -1);</div><div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;   }</div><div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;</div><div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d5/d52/res__http__media__cache_8c.html#ae174aec72bbbe66538d01bf7f717b37c">bucket_file_run_curl</a>(bucket_file)) {</div><div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;      <a class="code" href="../../d8/d25/sorcery_8h.html#aeb9bd9c0bcdaff27ac438a02d472c3b1">ast_sorcery_delete</a>(sorcery, bucket_file);</div><div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;      <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(bucket_file, -1);</div><div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;   }</div><div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;</div><div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;   <span class="keywordflow">return</span> bucket_file;</div><div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;}</div><div class="ttc" id="chan__ooh323_8c_html_a4d63fdfe5451ec2248c16a2739190c56"><div class="ttname"><a href="../../d7/d49/chan__ooh323_8c.html#a4d63fdfe5451ec2248c16a2739190c56">type</a></div><div class="ttdeci">static const char type[]</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d49/chan__ooh323_8c_source.html#l00109">chan_ooh323.c:109</a></div></div>
<div class="ttc" id="logger_8h_html_adf4476a6a4ea6c74231c826e899d7189"><div class="ttname"><a href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a></div><div class="ttdeci">#define LOG_WARNING</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d8c/logger_8h_source.html#l00274">logger.h:274</a></div></div>
<div class="ttc" id="resample_8c_html_a070d2ce7b6bb7e5c05602aa8c308d0c4"><div class="ttname"><a href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a></div><div class="ttdeci">#define NULL</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d7f/resample_8c_source.html#l00096">resample.c:96</a></div></div>
<div class="ttc" id="bucket_8h_html_a06c0cb2467dcf37cb1d0a932d1b86ee1"><div class="ttname"><a href="../../dd/d94/bucket_8h.html#a06c0cb2467dcf37cb1d0a932d1b86ee1">ast_bucket_file_alloc</a></div><div class="ttdeci">struct ast_bucket_file * ast_bucket_file_alloc(const char *uri)</div><div class="ttdoc">Allocate a new bucket file. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/d43/bucket_8c_source.html#l00663">bucket.c:663</a></div></div>
<div class="ttc" id="strings_8h_html_a372554b7a2d69a8bd3adac5157672036"><div class="ttname"><a href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a></div><div class="ttdeci">#define ast_strlen_zero(foo)</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d90/strings_8h_source.html#l00052">strings.h:52</a></div></div>
<div class="ttc" id="astobj2_8c_html_a96a00b3a518d7f32b6d51dc28f09bf9b"><div class="ttname"><a href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a></div><div class="ttdeci">#define ast_log</div><div class="ttdef"><b>Definition:</b> <a href="../../da/df7/astobj2_8c_source.html#l00042">astobj2.c:42</a></div></div>
<div class="ttc" id="astobj2_8h_html_aaca5e8eac39a22f9da1c36fc6c922270"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a></div><div class="ttdeci">#define ao2_ref(o, delta)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l00464">astobj2.h:464</a></div></div>
<div class="ttc" id="structast__bucket__file_html"><div class="ttname"><a href="../../d9/da9/structast__bucket__file.html">ast_bucket_file</a></div><div class="ttdoc">Bucket file structure, contains reference to file and information about it. </div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d94/bucket_8h_source.html#l00078">bucket.h:78</a></div></div>
<div class="ttc" id="sorcery_8h_html_aeb9bd9c0bcdaff27ac438a02d472c3b1"><div class="ttname"><a href="../../d8/d25/sorcery_8h.html#aeb9bd9c0bcdaff27ac438a02d472c3b1">ast_sorcery_delete</a></div><div class="ttdeci">int ast_sorcery_delete(const struct ast_sorcery *sorcery, void *object)</div><div class="ttdoc">Delete an object. </div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d69/sorcery_8c_source.html#l02233">sorcery.c:2233</a></div></div>
<div class="ttc" id="res__http__media__cache_8c_html_ae174aec72bbbe66538d01bf7f717b37c"><div class="ttname"><a href="../../d5/d52/res__http__media__cache_8c.html#ae174aec72bbbe66538d01bf7f717b37c">bucket_file_run_curl</a></div><div class="ttdeci">static int bucket_file_run_curl(struct ast_bucket_file *bucket_file)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d52/res__http__media__cache_8c_source.html#l00251">res_http_media_cache.c:251</a></div></div>
<div class="ttc" id="bucket_8h_html_a4eb22b16d39185b0c7c0f5a574abb506"><div class="ttname"><a href="../../dd/d94/bucket_8h.html#a4eb22b16d39185b0c7c0f5a574abb506">ast_bucket_file_temporary_create</a></div><div class="ttdeci">int ast_bucket_file_temporary_create(struct ast_bucket_file *file)</div><div class="ttdoc">Common file snapshot creation callback for creating a temporary file. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/d43/bucket_8c_source.html#l00899">bucket.c:899</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a6e9a040ef6f91676b4a11ac58c04f8a0"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6e9a040ef6f91676b4a11ac58c04f8a0">&#9670;&nbsp;</a></span>curl_body_callback()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static size_t curl_body_callback </td>
          <td>(</td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>ptr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>size</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>nitems</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>data</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="../../d5/d52/res__http__media__cache_8c_source.html#l00103">103</a> of file <a class="el" href="../../d5/d52/res__http__media__cache_8c_source.html">res_http_media_cache.c</a>.</p>

<p class="reference">References <a class="el" href="../../d5/d52/res__http__media__cache_8c_source.html#l00052">curl_bucket_file_data::out_file</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../d5/d52/res__http__media__cache_8c_source.html#l00251">bucket_file_run_curl()</a>.</p>
<div class="fragment"><div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;{</div><div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../dd/d50/structcurl__bucket__file__data.html">curl_bucket_file_data</a> *cb_data = data;</div><div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;   <span class="keywordtype">size_t</span> realsize;</div><div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;</div><div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;   realsize = fwrite(ptr, size, nitems, cb_data-&gt;<a class="code" href="../../dd/d50/structcurl__bucket__file__data.html#ab297e8b6af734888d3dc2cfe335a9d44">out_file</a>);</div><div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;</div><div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;   <span class="keywordflow">return</span> realsize;</div><div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;}</div><div class="ttc" id="structcurl__bucket__file__data_html_ab297e8b6af734888d3dc2cfe335a9d44"><div class="ttname"><a href="../../dd/d50/structcurl__bucket__file__data.html#ab297e8b6af734888d3dc2cfe335a9d44">curl_bucket_file_data::out_file</a></div><div class="ttdeci">FILE * out_file</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d52/res__http__media__cache_8c_source.html#l00052">res_http_media_cache.c:52</a></div></div>
<div class="ttc" id="structcurl__bucket__file__data_html"><div class="ttname"><a href="../../dd/d50/structcurl__bucket__file__data.html">curl_bucket_file_data</a></div><div class="ttdoc">Data passed to cURL callbacks. </div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d52/res__http__media__cache_8c_source.html#l00048">res_http_media_cache.c:48</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="aef1d54398e27b01aabdf12594d2b6fbb"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aef1d54398e27b01aabdf12594d2b6fbb">&#9670;&nbsp;</a></span>curl_header_callback()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static size_t curl_header_callback </td>
          <td>(</td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>buffer</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>size</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>nitems</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>data</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="../../d5/d52/res__http__media__cache_8c_source.html#l00058">58</a> of file <a class="el" href="../../d5/d52/res__http__media__cache_8c_source.html">res_http_media_cache.c</a>.</p>

<p class="reference">References <a class="el" href="../../d8/d8a/astmm_8h_source.html#l00290">ast_alloca</a>, <a class="el" href="../../db/d43/bucket_8c_source.html#l00334">ast_bucket_file_metadata_set()</a>, <a class="el" href="../../da/df7/astobj2_8c_source.html#l00042">ast_log</a>, <a class="el" href="../../d6/d90/strings_8h_source.html#l00157">ast_skip_blanks()</a>, <a class="el" href="../../d6/d90/strings_8h_source.html#l01268">ast_str_to_lower()</a>, <a class="el" href="../../d6/d90/strings_8h_source.html#l00182">ast_trim_blanks()</a>, <a class="el" href="../../d5/d52/res__http__media__cache_8c_source.html#l00050">curl_bucket_file_data::bucket_file</a>, <a class="el" href="../../d1/d8c/logger_8h_source.html#l00274">LOG_WARNING</a>, <a class="el" href="../../d5/d52/res__http__media__cache_8c_source.html#l00045">MAX_HEADER_LENGTH</a>, and <a class="el" href="../../d4/d2f/syslog_8c_source.html#l00037">value</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../d5/d52/res__http__media__cache_8c_source.html#l00204">get_curl_instance()</a>.</p>
<div class="fragment"><div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;{</div><div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../dd/d50/structcurl__bucket__file__data.html">curl_bucket_file_data</a> *cb_data = data;</div><div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;   <span class="keywordtype">size_t</span> realsize;</div><div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;   <span class="keywordtype">char</span> *<a class="code" href="../../d4/d2f/syslog_8c.html#ac4f474c82e82cbb89ca7c36dd52be0ed">value</a>;</div><div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;   <span class="keywordtype">char</span> *<a class="code" href="../../d5/d65/structheader.html">header</a>;</div><div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;</div><div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;   realsize = size * nitems;</div><div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;</div><div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;   <span class="keywordflow">if</span> (realsize &gt; <a class="code" href="../../d5/d52/res__http__media__cache_8c.html#af199a39319b90015d86f3c3ccccf42bc">MAX_HEADER_LENGTH</a>) {</div><div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;cURL header length of &#39;%zu&#39; is too large: max %d\n&quot;</span>,</div><div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;         realsize, <a class="code" href="../../d5/d52/res__http__media__cache_8c.html#af199a39319b90015d86f3c3ccccf42bc">MAX_HEADER_LENGTH</a>);</div><div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;      <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;   }</div><div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;</div><div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;   <span class="comment">/* buffer may not be NULL terminated */</span></div><div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;   header = <a class="code" href="../../d8/d8a/astmm_8h.html#a249282ecc7ba5a1a49fa75e9a33d1717">ast_alloca</a>(realsize + 1);</div><div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;   memcpy(header, buffer, realsize);</div><div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;   header[realsize] = <span class="charliteral">&#39;\0&#39;</span>;</div><div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;   value = strchr(header, <span class="charliteral">&#39;:&#39;</span>);</div><div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;   <span class="keywordflow">if</span> (!value) {</div><div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;      <span class="comment">/* Not a header we care about; bail */</span></div><div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;      <span class="keywordflow">return</span> realsize;</div><div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;   }</div><div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;   *value++ = <span class="charliteral">&#39;\0&#39;</span>;</div><div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;</div><div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;   <span class="keywordflow">if</span> (strcasecmp(header, <span class="stringliteral">&quot;ETag&quot;</span>)</div><div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;      &amp;&amp; strcasecmp(header, <span class="stringliteral">&quot;Cache-Control&quot;</span>)</div><div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;      &amp;&amp; strcasecmp(header, <span class="stringliteral">&quot;Last-Modified&quot;</span>)</div><div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;      &amp;&amp; strcasecmp(header, <span class="stringliteral">&quot;Content-Type&quot;</span>)</div><div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;      &amp;&amp; strcasecmp(header, <span class="stringliteral">&quot;Expires&quot;</span>)) {</div><div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;      <span class="keywordflow">return</span> realsize;</div><div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;   }</div><div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;</div><div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;   value = <a class="code" href="../../d6/d90/strings_8h.html#abe38193be148775f7559f8fff6e0c17e">ast_trim_blanks</a>(<a class="code" href="../../d6/d90/strings_8h.html#af5693da955fa3bc73bc49c47b601fc7a">ast_skip_blanks</a>(value));</div><div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;   header = <a class="code" href="../../d6/d90/strings_8h.html#aa8ab574002a6eb04925efea4c2885059">ast_str_to_lower</a>(header);</div><div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;</div><div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;   <a class="code" href="../../dd/d94/bucket_8h.html#a1b6e8f9435b8b53ce68578c369702980">ast_bucket_file_metadata_set</a>(cb_data-&gt;<a class="code" href="../../dd/d50/structcurl__bucket__file__data.html#a1be87c09b1286892c389e40582e6175b">bucket_file</a>, header, value);</div><div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;</div><div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;   <span class="keywordflow">return</span> realsize;</div><div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;}</div><div class="ttc" id="structcurl__bucket__file__data_html_a1be87c09b1286892c389e40582e6175b"><div class="ttname"><a href="../../dd/d50/structcurl__bucket__file__data.html#a1be87c09b1286892c389e40582e6175b">curl_bucket_file_data::bucket_file</a></div><div class="ttdeci">struct ast_bucket_file * bucket_file</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d52/res__http__media__cache_8c_source.html#l00050">res_http_media_cache.c:50</a></div></div>
<div class="ttc" id="bucket_8h_html_a1b6e8f9435b8b53ce68578c369702980"><div class="ttname"><a href="../../dd/d94/bucket_8h.html#a1b6e8f9435b8b53ce68578c369702980">ast_bucket_file_metadata_set</a></div><div class="ttdeci">int ast_bucket_file_metadata_set(struct ast_bucket_file *file, const char *name, const char *value)</div><div class="ttdoc">Set a metadata attribute on a file to a specific value. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/d43/bucket_8c_source.html#l00334">bucket.c:334</a></div></div>
<div class="ttc" id="logger_8h_html_adf4476a6a4ea6c74231c826e899d7189"><div class="ttname"><a href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a></div><div class="ttdeci">#define LOG_WARNING</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d8c/logger_8h_source.html#l00274">logger.h:274</a></div></div>
<div class="ttc" id="syslog_8c_html_ac4f474c82e82cbb89ca7c36dd52be0ed"><div class="ttname"><a href="../../d4/d2f/syslog_8c.html#ac4f474c82e82cbb89ca7c36dd52be0ed">value</a></div><div class="ttdeci">int value</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d2f/syslog_8c_source.html#l00037">syslog.c:37</a></div></div>
<div class="ttc" id="astobj2_8c_html_a96a00b3a518d7f32b6d51dc28f09bf9b"><div class="ttname"><a href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a></div><div class="ttdeci">#define ast_log</div><div class="ttdef"><b>Definition:</b> <a href="../../da/df7/astobj2_8c_source.html#l00042">astobj2.c:42</a></div></div>
<div class="ttc" id="strings_8h_html_aa8ab574002a6eb04925efea4c2885059"><div class="ttname"><a href="../../d6/d90/strings_8h.html#aa8ab574002a6eb04925efea4c2885059">ast_str_to_lower</a></div><div class="ttdeci">static force_inline char * ast_str_to_lower(char *str)</div><div class="ttdoc">Convert a string to all lower-case. </div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d90/strings_8h_source.html#l01268">strings.h:1268</a></div></div>
<div class="ttc" id="structcurl__bucket__file__data_html"><div class="ttname"><a href="../../dd/d50/structcurl__bucket__file__data.html">curl_bucket_file_data</a></div><div class="ttdoc">Data passed to cURL callbacks. </div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d52/res__http__media__cache_8c_source.html#l00048">res_http_media_cache.c:48</a></div></div>
<div class="ttc" id="astmm_8h_html_a249282ecc7ba5a1a49fa75e9a33d1717"><div class="ttname"><a href="../../d8/d8a/astmm_8h.html#a249282ecc7ba5a1a49fa75e9a33d1717">ast_alloca</a></div><div class="ttdeci">#define ast_alloca(size)</div><div class="ttdoc">call __builtin_alloca to ensure we get gcc builtin semantics </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d8a/astmm_8h_source.html#l00290">astmm.h:290</a></div></div>
<div class="ttc" id="strings_8h_html_af5693da955fa3bc73bc49c47b601fc7a"><div class="ttname"><a href="../../d6/d90/strings_8h.html#af5693da955fa3bc73bc49c47b601fc7a">ast_skip_blanks</a></div><div class="ttdeci">char * ast_skip_blanks(const char *str)</div><div class="ttdoc">Gets a pointer to the first non-whitespace character in a string. </div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d90/strings_8h_source.html#l00157">strings.h:157</a></div></div>
<div class="ttc" id="strings_8h_html_abe38193be148775f7559f8fff6e0c17e"><div class="ttname"><a href="../../d6/d90/strings_8h.html#abe38193be148775f7559f8fff6e0c17e">ast_trim_blanks</a></div><div class="ttdeci">char * ast_trim_blanks(char *str)</div><div class="ttdoc">Trims trailing whitespace characters from a string. </div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d90/strings_8h_source.html#l00182">strings.h:182</a></div></div>
<div class="ttc" id="structheader_html"><div class="ttname"><a href="../../d5/d65/structheader.html">header</a></div><div class="ttdef"><b>Definition:</b> <a href="../../db/d73/pjsip__global__headers_8c_source.html#l00047">pjsip_global_headers.c:47</a></div></div>
<div class="ttc" id="res__http__media__cache_8c_html_af199a39319b90015d86f3c3ccccf42bc"><div class="ttname"><a href="../../d5/d52/res__http__media__cache_8c.html#af199a39319b90015d86f3c3ccccf42bc">MAX_HEADER_LENGTH</a></div><div class="ttdeci">#define MAX_HEADER_LENGTH</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d52/res__http__media__cache_8c_source.html#l00045">res_http_media_cache.c:45</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="acf8b5f1fa60f9ca07080ac9ac89c0b9c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#acf8b5f1fa60f9ca07080ac9ac89c0b9c">&#9670;&nbsp;</a></span>execute_curl_instance()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static long execute_curl_instance </td>
          <td>(</td>
          <td class="paramtype">CURL *&#160;</td>
          <td class="paramname"><em>curl</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Execute the CURL. </p>

<p class="definition">Definition at line <a class="el" href="../../d5/d52/res__http__media__cache_8c_source.html#l00228">228</a> of file <a class="el" href="../../d5/d52/res__http__media__cache_8c_source.html">res_http_media_cache.c</a>.</p>

<p class="reference">References <a class="el" href="../../da/df7/astobj2_8c_source.html#l00042">ast_log</a>, and <a class="el" href="../../d1/d8c/logger_8h_source.html#l00274">LOG_WARNING</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../d5/d52/res__http__media__cache_8c_source.html#l00251">bucket_file_run_curl()</a>, and <a class="el" href="../../d5/d52/res__http__media__cache_8c_source.html#l00290">bucket_http_wizard_is_stale()</a>.</p>
<div class="fragment"><div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;{</div><div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;   <span class="keywordtype">char</span> curl_errbuf[CURL_ERROR_SIZE + 1];</div><div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;   <span class="keywordtype">long</span> http_code;</div><div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;</div><div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;   curl_errbuf[CURL_ERROR_SIZE] = <span class="charliteral">&#39;\0&#39;</span>;</div><div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;   curl_easy_setopt(curl, CURLOPT_ERRORBUFFER, curl_errbuf);</div><div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;</div><div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;   <span class="keywordflow">if</span> (curl_easy_perform(curl)) {</div><div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;%s\n&quot;</span>, curl_errbuf);</div><div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;   }</div><div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;</div><div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;   curl_easy_getinfo(curl, CURLINFO_RESPONSE_CODE, &amp;http_code);</div><div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;</div><div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;   curl_easy_cleanup(curl);</div><div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;</div><div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;   <span class="keywordflow">return</span> http_code;</div><div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;}</div><div class="ttc" id="logger_8h_html_adf4476a6a4ea6c74231c826e899d7189"><div class="ttname"><a href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a></div><div class="ttdeci">#define LOG_WARNING</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d8c/logger_8h_source.html#l00274">logger.h:274</a></div></div>
<div class="ttc" id="astobj2_8c_html_a96a00b3a518d7f32b6d51dc28f09bf9b"><div class="ttname"><a href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a></div><div class="ttdeci">#define ast_log</div><div class="ttdef"><b>Definition:</b> <a href="../../da/df7/astobj2_8c_source.html#l00042">astobj2.c:42</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a693dad05b109a75ff840b8b39f1dda54"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a693dad05b109a75ff840b8b39f1dda54">&#9670;&nbsp;</a></span>get_curl_instance()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static CURL* get_curl_instance </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="../../dd/d50/structcurl__bucket__file__data.html">curl_bucket_file_data</a> *&#160;</td>
          <td class="paramname"><em>cb_data</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="../../d5/d52/res__http__media__cache_8c_source.html#l00204">204</a> of file <a class="el" href="../../d5/d52/res__http__media__cache_8c_source.html">res_http_media_cache.c</a>.</p>

<p class="reference">References <a class="el" href="../../d7/d69/sorcery_8c_source.html#l02312">ast_sorcery_object_get_id()</a>, <a class="el" href="../../d5/d52/res__http__media__cache_8c_source.html#l00050">curl_bucket_file_data::bucket_file</a>, <a class="el" href="../../d5/d52/res__http__media__cache_8c_source.html#l00058">curl_header_callback()</a>, <a class="el" href="../../d5/d52/res__http__media__cache_8c_source.html#l00043">GLOBAL_USERAGENT</a>, and <a class="el" href="../../dc/d7f/resample_8c_source.html#l00096">NULL</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../d5/d52/res__http__media__cache_8c_source.html#l00251">bucket_file_run_curl()</a>, and <a class="el" href="../../d5/d52/res__http__media__cache_8c_source.html#l00290">bucket_http_wizard_is_stale()</a>.</p>
<div class="fragment"><div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;{</div><div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;   CURL *curl;</div><div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;</div><div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;   curl = curl_easy_init();</div><div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;   <span class="keywordflow">if</span> (!curl) {</div><div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;   }</div><div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;</div><div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;   curl_easy_setopt(curl, CURLOPT_NOSIGNAL, 1);</div><div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;   curl_easy_setopt(curl, CURLOPT_TIMEOUT, 180);</div><div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;   curl_easy_setopt(curl, CURLOPT_HEADERFUNCTION, <a class="code" href="../../d5/d52/res__http__media__cache_8c.html#aef1d54398e27b01aabdf12594d2b6fbb">curl_header_callback</a>);</div><div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;   curl_easy_setopt(curl, CURLOPT_USERAGENT, <a class="code" href="../../d5/d52/res__http__media__cache_8c.html#ad9f74a3dcbfde83a6538a60020059b75">GLOBAL_USERAGENT</a>);</div><div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;   curl_easy_setopt(curl, CURLOPT_FOLLOWLOCATION, 1);</div><div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;   curl_easy_setopt(curl, CURLOPT_MAXREDIRS, 8);</div><div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;   curl_easy_setopt(curl, CURLOPT_URL, <a class="code" href="../../d8/d25/sorcery_8h.html#a97706283a06cbb44e4f0f9620dd5cf07">ast_sorcery_object_get_id</a>(cb_data-&gt;<a class="code" href="../../dd/d50/structcurl__bucket__file__data.html#a1be87c09b1286892c389e40582e6175b">bucket_file</a>));</div><div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;   curl_easy_setopt(curl, CURLOPT_HEADERDATA, cb_data);</div><div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;</div><div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;   <span class="keywordflow">return</span> curl;</div><div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;}</div><div class="ttc" id="structcurl__bucket__file__data_html_a1be87c09b1286892c389e40582e6175b"><div class="ttname"><a href="../../dd/d50/structcurl__bucket__file__data.html#a1be87c09b1286892c389e40582e6175b">curl_bucket_file_data::bucket_file</a></div><div class="ttdeci">struct ast_bucket_file * bucket_file</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d52/res__http__media__cache_8c_source.html#l00050">res_http_media_cache.c:50</a></div></div>
<div class="ttc" id="res__http__media__cache_8c_html_ad9f74a3dcbfde83a6538a60020059b75"><div class="ttname"><a href="../../d5/d52/res__http__media__cache_8c.html#ad9f74a3dcbfde83a6538a60020059b75">GLOBAL_USERAGENT</a></div><div class="ttdeci">#define GLOBAL_USERAGENT</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d52/res__http__media__cache_8c_source.html#l00043">res_http_media_cache.c:43</a></div></div>
<div class="ttc" id="resample_8c_html_a070d2ce7b6bb7e5c05602aa8c308d0c4"><div class="ttname"><a href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a></div><div class="ttdeci">#define NULL</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d7f/resample_8c_source.html#l00096">resample.c:96</a></div></div>
<div class="ttc" id="sorcery_8h_html_a97706283a06cbb44e4f0f9620dd5cf07"><div class="ttname"><a href="../../d8/d25/sorcery_8h.html#a97706283a06cbb44e4f0f9620dd5cf07">ast_sorcery_object_get_id</a></div><div class="ttdeci">const char * ast_sorcery_object_get_id(const void *object)</div><div class="ttdoc">Get the unique identifier of a sorcery object. </div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d69/sorcery_8c_source.html#l02312">sorcery.c:2312</a></div></div>
<div class="ttc" id="res__http__media__cache_8c_html_aef1d54398e27b01aabdf12594d2b6fbb"><div class="ttname"><a href="../../d5/d52/res__http__media__cache_8c.html#aef1d54398e27b01aabdf12594d2b6fbb">curl_header_callback</a></div><div class="ttdeci">static size_t curl_header_callback(char *buffer, size_t size, size_t nitems, void *data)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d52/res__http__media__cache_8c_source.html#l00058">res_http_media_cache.c:58</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="ac3382bf6da54c56b37069bd76bbdf4f9"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac3382bf6da54c56b37069bd76bbdf4f9">&#9670;&nbsp;</a></span>load_module()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int load_module </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="../../d5/d52/res__http__media__cache_8c_source.html#l00425">425</a> of file <a class="el" href="../../d5/d52/res__http__media__cache_8c_source.html">res_http_media_cache.c</a>.</p>

<p class="reference">References <a class="el" href="../../dd/d94/bucket_8h_source.html#l00137">ast_bucket_scheme_register</a>, <a class="el" href="../../da/df7/astobj2_8c_source.html#l00042">ast_log</a>, <a class="el" href="../../d5/d16/module_8h_source.html#l00315">AST_MODFLAG_DEFAULT</a>, <a class="el" href="../../d9/de9/res__phoneprov_8c.html#addaa208b0ed785225e24490fb9f28a80">AST_MODULE_INFO()</a>, <a class="el" href="../../d5/d16/module_8h_source.html#l00078">AST_MODULE_LOAD_DECLINE</a>, <a class="el" href="../../d5/d16/module_8h_source.html#l00070">AST_MODULE_LOAD_SUCCESS</a>, <a class="el" href="../../d5/d16/module_8h_source.html#l00121">AST_MODULE_SUPPORT_CORE</a>, <a class="el" href="../../d5/d16/module_8h_source.html#l00046">ASTERISK_GPL_KEY</a>, <a class="el" href="../../d8/d25/sorcery_8h_source.html#l00287">ast_sorcery_wizard::load</a>, <a class="el" href="../../d1/d8c/logger_8h_source.html#l00285">LOG_ERROR</a>, <a class="el" href="../../dc/d7f/resample_8c_source.html#l00096">NULL</a>, and <a class="el" href="../../d5/d52/res__http__media__cache_8c_source.html#l00420">unload_module()</a>.</p>
<div class="fragment"><div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;{</div><div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../dd/d94/bucket_8h.html#a240c41d11c0a5b384a6f4f93885b5ffa">ast_bucket_scheme_register</a>(<span class="stringliteral">&quot;http&quot;</span>, &amp;<a class="code" href="../../d5/d52/res__http__media__cache_8c.html#a6fadbb0500ad47a2e95d57259292ca17">http_bucket_wizard</a>, &amp;<a class="code" href="../../d5/d52/res__http__media__cache_8c.html#aa9a734dcc11abc593c81b010e8d62a74">http_bucket_file_wizard</a>,</div><div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;         <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)) {</div><div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Failed to register Bucket HTTP wizard scheme implementation\n&quot;</span>);</div><div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../d5/d16/module_8h.html#adc09474f0ff557e9925b722ee5b952dfac742921e9f9512d28f62c74ea2affe57">AST_MODULE_LOAD_DECLINE</a>;</div><div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;   }</div><div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;</div><div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../dd/d94/bucket_8h.html#a240c41d11c0a5b384a6f4f93885b5ffa">ast_bucket_scheme_register</a>(<span class="stringliteral">&quot;https&quot;</span>, &amp;<a class="code" href="../../d5/d52/res__http__media__cache_8c.html#aaf4640e8693ca1809f06535301769ba9">https_bucket_wizard</a>, &amp;<a class="code" href="../../d5/d52/res__http__media__cache_8c.html#abc709e8aaa37e7f11454d2ec2ace3cd6">https_bucket_file_wizard</a>,</div><div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;         <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)) {</div><div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Failed to register Bucket HTTPS wizard scheme implementation\n&quot;</span>);</div><div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../d5/d16/module_8h.html#adc09474f0ff557e9925b722ee5b952dfac742921e9f9512d28f62c74ea2affe57">AST_MODULE_LOAD_DECLINE</a>;</div><div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;   }</div><div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;</div><div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;   <span class="keywordflow">return</span> <a class="code" href="../../d5/d16/module_8h.html#adc09474f0ff557e9925b722ee5b952dfa89bb877ade9ce418ad6663f3d936f314">AST_MODULE_LOAD_SUCCESS</a>;</div><div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;}</div><div class="ttc" id="module_8h_html_adc09474f0ff557e9925b722ee5b952dfa89bb877ade9ce418ad6663f3d936f314"><div class="ttname"><a href="../../d5/d16/module_8h.html#adc09474f0ff557e9925b722ee5b952dfa89bb877ade9ce418ad6663f3d936f314">AST_MODULE_LOAD_SUCCESS</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d16/module_8h_source.html#l00070">module.h:70</a></div></div>
<div class="ttc" id="resample_8c_html_a070d2ce7b6bb7e5c05602aa8c308d0c4"><div class="ttname"><a href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a></div><div class="ttdeci">#define NULL</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d7f/resample_8c_source.html#l00096">resample.c:96</a></div></div>
<div class="ttc" id="astobj2_8c_html_a96a00b3a518d7f32b6d51dc28f09bf9b"><div class="ttname"><a href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a></div><div class="ttdeci">#define ast_log</div><div class="ttdef"><b>Definition:</b> <a href="../../da/df7/astobj2_8c_source.html#l00042">astobj2.c:42</a></div></div>
<div class="ttc" id="logger_8h_html_aced66975c154ea0e2a8ec3bc818b4e08"><div class="ttname"><a href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a></div><div class="ttdeci">#define LOG_ERROR</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d8c/logger_8h_source.html#l00285">logger.h:285</a></div></div>
<div class="ttc" id="res__http__media__cache_8c_html_abc709e8aaa37e7f11454d2ec2ace3cd6"><div class="ttname"><a href="../../d5/d52/res__http__media__cache_8c.html#abc709e8aaa37e7f11454d2ec2ace3cd6">https_bucket_file_wizard</a></div><div class="ttdeci">static struct ast_sorcery_wizard https_bucket_file_wizard</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d52/res__http__media__cache_8c_source.html#l00412">res_http_media_cache.c:412</a></div></div>
<div class="ttc" id="module_8h_html_adc09474f0ff557e9925b722ee5b952dfac742921e9f9512d28f62c74ea2affe57"><div class="ttname"><a href="../../d5/d16/module_8h.html#adc09474f0ff557e9925b722ee5b952dfac742921e9f9512d28f62c74ea2affe57">AST_MODULE_LOAD_DECLINE</a></div><div class="ttdoc">Module has failed to load, may be in an inconsistent state. </div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d16/module_8h_source.html#l00078">module.h:78</a></div></div>
<div class="ttc" id="res__http__media__cache_8c_html_a6fadbb0500ad47a2e95d57259292ca17"><div class="ttname"><a href="../../d5/d52/res__http__media__cache_8c.html#a6fadbb0500ad47a2e95d57259292ca17">http_bucket_wizard</a></div><div class="ttdeci">static struct ast_sorcery_wizard http_bucket_wizard</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d52/res__http__media__cache_8c_source.html#l00388">res_http_media_cache.c:388</a></div></div>
<div class="ttc" id="bucket_8h_html_a240c41d11c0a5b384a6f4f93885b5ffa"><div class="ttname"><a href="../../dd/d94/bucket_8h.html#a240c41d11c0a5b384a6f4f93885b5ffa">ast_bucket_scheme_register</a></div><div class="ttdeci">#define ast_bucket_scheme_register(name, bucket, file, create_cb, destroy_cb)</div><div class="ttdoc">Register support for a specific scheme. </div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d94/bucket_8h_source.html#l00137">bucket.h:137</a></div></div>
<div class="ttc" id="res__http__media__cache_8c_html_aaf4640e8693ca1809f06535301769ba9"><div class="ttname"><a href="../../d5/d52/res__http__media__cache_8c.html#aaf4640e8693ca1809f06535301769ba9">https_bucket_wizard</a></div><div class="ttdeci">static struct ast_sorcery_wizard https_bucket_wizard</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d52/res__http__media__cache_8c_source.html#l00404">res_http_media_cache.c:404</a></div></div>
<div class="ttc" id="res__http__media__cache_8c_html_aa9a734dcc11abc593c81b010e8d62a74"><div class="ttname"><a href="../../d5/d52/res__http__media__cache_8c.html#aa9a734dcc11abc593c81b010e8d62a74">http_bucket_file_wizard</a></div><div class="ttdeci">static struct ast_sorcery_wizard http_bucket_file_wizard</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d52/res__http__media__cache_8c_source.html#l00396">res_http_media_cache.c:396</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="ad09fa931f468002152a3cc2d5ce25eae"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad09fa931f468002152a3cc2d5ce25eae">&#9670;&nbsp;</a></span>unload_module()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int unload_module </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="../../d5/d52/res__http__media__cache_8c_source.html#l00420">420</a> of file <a class="el" href="../../d5/d52/res__http__media__cache_8c_source.html">res_http_media_cache.c</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../d5/d52/res__http__media__cache_8c_source.html#l00425">load_module()</a>.</p>
<div class="fragment"><div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;{</div><div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;   <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;}</div></div><!-- fragment -->
</div>
</div>
<h2 class="groupheader">Variable Documentation</h2>
<a id="ab22f32016155f7f403e7178767163d7d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab22f32016155f7f403e7178767163d7d">&#9670;&nbsp;</a></span>__mod_info</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="../../dd/d5f/structast__module__info.html">ast_module_info</a> __mod_info = { .<a class="el" href="../../d1/da4/res__corosync_8c.html#a8f8f80d37794cde9472343e4487ba3eb">name</a> = <a class="el" href="../../da/ddd/named__acl_8c.html#aec23fc5034c3bb08140fc021f4955877">AST_MODULE</a>, .flags = <a class="el" href="../../d5/d16/module_8h.html#a155a0df9c59e04e305d4a2fa3e35f843a54af2a9b29d140908cc9dffd0618951b">AST_MODFLAG_DEFAULT</a> , .description = &quot;HTTP Media Cache Backend&quot; , .key = &quot;This paragraph is copyright (<a class="el" href="../../d7/d6f/test__linkedlists_8c.html#acd9db00336027462cfb25b97b5356883">c</a>) 2006 by Digium, Inc. \In <a class="el" href="../../d5/d14/voicin_8c.html#aed7ca058008dc3e5ee131e575abed285">order</a> for your module to load, it must return this \key via <a class="el" href="../../d7/d6f/test__linkedlists_8c.html#a13dd15487fee89a002d17ef3aff62d02">a</a> function called \&quot;key\&quot;. Any code which \includes this paragraph must <a class="el" href="../../dd/d7c/eagi__proxy_8c.html#a39730e90126aad69cfc9ca4d6fcdb3a6">be</a> licensed under the GNU \General Public License <a class="el" href="../../da/d7c/utils_2frame_8h.html#a56abfaab87c46691c1ef3ad0df23e864">version</a> 2 or later (at your \option). In addition to Digium's general reservations \of rights, Digium expressly reserves the right to \allow other parties to license this paragraph under \different terms. Any use of Digium, Inc. trademarks or \logos (including \&quot;Asterisk\&quot; or \&quot;Digium\&quot;) without \express written <a class="el" href="../../d4/d4c/structpermission.html">permission</a> of Digium, Inc. is prohibited.\n&quot; , .buildopt_sum = &quot;30ef0c93b36035ec78c9cfd712d36d9b&quot; , .support_level = AST_MODULE_SUPPORT_CORE, .load = load_module, .unload = unload_module, .requires = &quot;res_curl&quot;, }</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="../../d5/d52/res__http__media__cache_8c_source.html#l00447">447</a> of file <a class="el" href="../../d5/d52/res__http__media__cache_8c_source.html">res_http_media_cache.c</a>.</p>

</div>
</div>
<a id="ad60e83b9aa660040fed4d5377966cc21"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad60e83b9aa660040fed4d5377966cc21">&#9670;&nbsp;</a></span>ast_module_info</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">const struct <a class="el" href="../../dd/d5f/structast__module__info.html">ast_module_info</a>* <a class="el" href="../../dd/d5f/structast__module__info.html">ast_module_info</a> = &amp;<a class="el" href="../../d6/d7a/test__xml__escape_8c.html#ab22f32016155f7f403e7178767163d7d">__mod_info</a></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="../../d5/d52/res__http__media__cache_8c_source.html#l00447">447</a> of file <a class="el" href="../../d5/d52/res__http__media__cache_8c_source.html">res_http_media_cache.c</a>.</p>

</div>
</div>
<a id="aa9a734dcc11abc593c81b010e8d62a74"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa9a734dcc11abc593c81b010e8d62a74">&#9670;&nbsp;</a></span>http_bucket_file_wizard</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="../../dd/d0a/structast__sorcery__wizard.html">ast_sorcery_wizard</a> http_bucket_file_wizard</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="../../d5/d52/res__http__media__cache_8c_source.html#l00396">396</a> of file <a class="el" href="../../d5/d52/res__http__media__cache_8c_source.html">res_http_media_cache.c</a>.</p>

</div>
</div>
<a id="a6fadbb0500ad47a2e95d57259292ca17"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6fadbb0500ad47a2e95d57259292ca17">&#9670;&nbsp;</a></span>http_bucket_wizard</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="../../dd/d0a/structast__sorcery__wizard.html">ast_sorcery_wizard</a> http_bucket_wizard</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="../../d5/d52/res__http__media__cache_8c_source.html#l00388">388</a> of file <a class="el" href="../../d5/d52/res__http__media__cache_8c_source.html">res_http_media_cache.c</a>.</p>

</div>
</div>
<a id="abc709e8aaa37e7f11454d2ec2ace3cd6"></a>
<h2 class="memtitle"><span class="permalink"><a href="#abc709e8aaa37e7f11454d2ec2ace3cd6">&#9670;&nbsp;</a></span>https_bucket_file_wizard</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="../../dd/d0a/structast__sorcery__wizard.html">ast_sorcery_wizard</a> https_bucket_file_wizard</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="../../d5/d52/res__http__media__cache_8c_source.html#l00412">412</a> of file <a class="el" href="../../d5/d52/res__http__media__cache_8c_source.html">res_http_media_cache.c</a>.</p>

</div>
</div>
<a id="aaf4640e8693ca1809f06535301769ba9"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aaf4640e8693ca1809f06535301769ba9">&#9670;&nbsp;</a></span>https_bucket_wizard</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="../../dd/d0a/structast__sorcery__wizard.html">ast_sorcery_wizard</a> https_bucket_wizard</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="../../d5/d52/res__http__media__cache_8c_source.html#l00404">404</a> of file <a class="el" href="../../d5/d52/res__http__media__cache_8c_source.html">res_http_media_cache.c</a>.</p>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Sun Aug 8 2021 19:46:25 for Asterisk - The Open Source Telephony Project by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="../../doxygen.png" alt="doxygen"/>
</a> 1.8.13
</small></address>
</body>
</html>
