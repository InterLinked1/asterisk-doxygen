<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Asterisk - The Open Source Telephony Project: core_local.h File Reference</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Asterisk - The Open Source Telephony Project
   &#160;<span id="projectnumber">18.5.0</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "../../search",false,'Search');
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('../../',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="../../dir_d44c64559bbebec7f509842c48db8b23.html">include</a></li><li class="navelem"><a class="el" href="../../dir_6d4b1cdb59e2db6ad82005b337288fef.html">asterisk</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">core_local.h File Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>Local proxy channel special access.  
<a href="#details">More...</a></p>
<div class="textblock"><div class="dynheader">
This graph shows which files directly or indirectly include this file:</div>
<div class="dyncontent">
<div class="center"><img src="../../d4/db4/core__local_8h__dep__incl.png" border="0" usemap="#core__local_8hdep" alt=""/></div>
<map name="core__local_8hdep" id="core__local_8hdep">
<area shape="rect" id="node2" href="../../da/dfb/app__queue_8c.html" title="True call queues with optional send URL on answer. " alt="" coords="5,80,109,107"/>
<area shape="rect" id="node3" href="../../d0/d95/bridge_8c.html" title="Bridging API. " alt="" coords="134,80,207,107"/>
<area shape="rect" id="node4" href="../../da/dc9/cel_8c.html" title="Channel Event Logging API. " alt="" coords="232,80,283,107"/>
<area shape="rect" id="node5" href="../../de/d47/core__local_8c.html" title="Local proxy channel driver. " alt="" coords="307,80,405,107"/>
<area shape="rect" id="node6" href="../../da/d49/resource__channels_8c.html" title="Implementation for ARI stubs. " alt="" coords="429,80,582,107"/>
<area shape="rect" id="node7" href="../../d1/db7/parking__bridge__features_8c.html" title="Parking Bridge DTMF and Interval features. " alt="" coords="607,80,793,107"/>
<area shape="rect" id="node8" href="../../db/dc4/test__cel_8c.html" title="CEL unit tests. " alt="" coords="817,80,900,107"/>
</map>
</div>
</div>
<p><a href="../../d5/da6/core__local_8h_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:aacf7aa4abdef7f39643948a814d3e1f9"><td class="memItemLeft" align="right" valign="top">struct <a class="el" href="../../d4/d8f/structstasis__message__type.html">stasis_message_type</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d5/da6/core__local_8h.html#aacf7aa4abdef7f39643948a814d3e1f9">ast_local_bridge_type</a> (void)</td></tr>
<tr class="memdesc:aacf7aa4abdef7f39643948a814d3e1f9"><td class="mdescLeft">&#160;</td><td class="mdescRight">Message type for when two local channel halves are bridged together.  <a href="#aacf7aa4abdef7f39643948a814d3e1f9">More...</a><br /></td></tr>
<tr class="separator:aacf7aa4abdef7f39643948a814d3e1f9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2b73f14ae5dc7e11bafc684936cf26d0"><td class="memItemLeft" align="right" valign="top">struct <a class="el" href="../../df/d3c/structast__channel.html">ast_channel</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d5/da6/core__local_8h.html#a2b73f14ae5dc7e11bafc684936cf26d0">ast_local_get_peer</a> (struct <a class="el" href="../../df/d3c/structast__channel.html">ast_channel</a> *ast)</td></tr>
<tr class="memdesc:a2b73f14ae5dc7e11bafc684936cf26d0"><td class="mdescLeft">&#160;</td><td class="mdescRight">Get the other local channel in the pair.  <a href="#a2b73f14ae5dc7e11bafc684936cf26d0">More...</a><br /></td></tr>
<tr class="separator:a2b73f14ae5dc7e11bafc684936cf26d0"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a973a646143d042b91ec6248ea6ba00f1"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d5/da6/core__local_8h.html#a973a646143d042b91ec6248ea6ba00f1">ast_local_lock_all</a> (struct <a class="el" href="../../df/d3c/structast__channel.html">ast_channel</a> *chan, void **tech_pvt, struct <a class="el" href="../../df/d3c/structast__channel.html">ast_channel</a> **base_chan, struct <a class="el" href="../../df/d3c/structast__channel.html">ast_channel</a> **base_owner)</td></tr>
<tr class="memdesc:a973a646143d042b91ec6248ea6ba00f1"><td class="mdescLeft">&#160;</td><td class="mdescRight">Add a reference to the local channel's private tech, lock the local channel's private base, and add references and lock both sides of the local channel.  <a href="#a973a646143d042b91ec6248ea6ba00f1">More...</a><br /></td></tr>
<tr class="separator:a973a646143d042b91ec6248ea6ba00f1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8f023d0ccc8c7d3365abf4d60412deb5"><td class="memItemLeft" align="right" valign="top">struct <a class="el" href="../../d4/d8f/structstasis__message__type.html">stasis_message_type</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d5/da6/core__local_8h.html#a8f023d0ccc8c7d3365abf4d60412deb5">ast_local_optimization_begin_type</a> (void)</td></tr>
<tr class="memdesc:a8f023d0ccc8c7d3365abf4d60412deb5"><td class="mdescLeft">&#160;</td><td class="mdescRight">Message type for when a local channel optimization begins.  <a href="#a8f023d0ccc8c7d3365abf4d60412deb5">More...</a><br /></td></tr>
<tr class="separator:a8f023d0ccc8c7d3365abf4d60412deb5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6f6f7583dcbd0b63d59bdfe79f654945"><td class="memItemLeft" align="right" valign="top">struct <a class="el" href="../../d4/d8f/structstasis__message__type.html">stasis_message_type</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d5/da6/core__local_8h.html#a6f6f7583dcbd0b63d59bdfe79f654945">ast_local_optimization_end_type</a> (void)</td></tr>
<tr class="memdesc:a6f6f7583dcbd0b63d59bdfe79f654945"><td class="mdescLeft">&#160;</td><td class="mdescRight">Message type for when a local channel optimization completes.  <a href="#a6f6f7583dcbd0b63d59bdfe79f654945">More...</a><br /></td></tr>
<tr class="separator:a6f6f7583dcbd0b63d59bdfe79f654945"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a36ca4008cc93eb1ee59194e732ee6b8a"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d5/da6/core__local_8h.html#a36ca4008cc93eb1ee59194e732ee6b8a">ast_local_setup_bridge</a> (struct <a class="el" href="../../df/d3c/structast__channel.html">ast_channel</a> *ast, struct <a class="el" href="../../d4/d84/structast__bridge.html">ast_bridge</a> *bridge, struct <a class="el" href="../../df/d3c/structast__channel.html">ast_channel</a> *swap, struct <a class="el" href="../../db/dba/structast__bridge__features.html">ast_bridge_features</a> *features)</td></tr>
<tr class="memdesc:a36ca4008cc93eb1ee59194e732ee6b8a"><td class="mdescLeft">&#160;</td><td class="mdescRight">Setup the outgoing local channel to join a bridge on <a class="el" href="../../d5/d7b/channel_8h.html#a1b732eb4ed203140b1a3aae9e7dec2c1" title="Make a call. ">ast_call()</a>.  <a href="#a36ca4008cc93eb1ee59194e732ee6b8a">More...</a><br /></td></tr>
<tr class="separator:a36ca4008cc93eb1ee59194e732ee6b8a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac2e6544ffc24e3c97e1b028c1d5a4957"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d5/da6/core__local_8h.html#ac2e6544ffc24e3c97e1b028c1d5a4957">ast_local_setup_masquerade</a> (struct <a class="el" href="../../df/d3c/structast__channel.html">ast_channel</a> *ast, struct <a class="el" href="../../df/d3c/structast__channel.html">ast_channel</a> *masq)</td></tr>
<tr class="memdesc:ac2e6544ffc24e3c97e1b028c1d5a4957"><td class="mdescLeft">&#160;</td><td class="mdescRight">Setup the outgoing local channel to masquerade into a channel on <a class="el" href="../../d5/d7b/channel_8h.html#a1b732eb4ed203140b1a3aae9e7dec2c1" title="Make a call. ">ast_call()</a>.  <a href="#ac2e6544ffc24e3c97e1b028c1d5a4957">More...</a><br /></td></tr>
<tr class="separator:ac2e6544ffc24e3c97e1b028c1d5a4957"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2ed2a62610af1f7e8c25b89001e35963"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d5/da6/core__local_8h.html#a2ed2a62610af1f7e8c25b89001e35963">ast_local_unlock_all</a> (void *tech_pvt, struct <a class="el" href="../../df/d3c/structast__channel.html">ast_channel</a> *base_chan, struct <a class="el" href="../../df/d3c/structast__channel.html">ast_channel</a> *base_owner)</td></tr>
<tr class="memdesc:a2ed2a62610af1f7e8c25b89001e35963"><td class="mdescLeft">&#160;</td><td class="mdescRight">Remove a reference to the given local channel's private tech, unlock the given local channel's private base, and remove references and unlock both sides of given the local channel.  <a href="#a2ed2a62610af1f7e8c25b89001e35963">More...</a><br /></td></tr>
<tr class="separator:a2ed2a62610af1f7e8c25b89001e35963"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Local proxy channel special access. </p>
<dl class="section author"><dt>Author</dt><dd>Richard Mudgett <a href="#" onclick="location.href='mai'+'lto:'+'rmu'+'dg'+'ett'+'@d'+'igi'+'um'+'.co'+'m'; return false;">rmudg<span style="display: none;">.nosp@m.</span>ett@<span style="display: none;">.nosp@m.</span>digiu<span style="display: none;">.nosp@m.</span>m.co<span style="display: none;">.nosp@m.</span>m</a></dd></dl>
<p>See Also: </p><ul>
<li><a class="el" href="../../d8/d87/AstCREDITS.html">CREDITS</a> </li>
</ul>

<p class="definition">Definition in file <a class="el" href="../../d5/da6/core__local_8h_source.html">core_local.h</a>.</p>
</div><h2 class="groupheader">Function Documentation</h2>
<a id="aacf7aa4abdef7f39643948a814d3e1f9"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aacf7aa4abdef7f39643948a814d3e1f9">&#9670;&nbsp;</a></span>ast_local_bridge_type()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="../../d4/d8f/structstasis__message__type.html">stasis_message_type</a>* ast_local_bridge_type </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Message type for when two local channel halves are bridged together. </p>
<dl class="section since"><dt>Since</dt><dd>12.0.0</dd></dl>
<dl class="section note"><dt>Note</dt><dd>Payloads for the <a class="el" href="../../d5/da6/core__local_8h.html#aacf7aa4abdef7f39643948a814d3e1f9">ast_local_bridge_type</a> are a <a class="el" href="../../df/dcb/structast__multi__channel__blob.html">ast_multi_channel_blob</a>. Roles for the channels in the <a class="el" href="../../df/dcb/structast__multi__channel__blob.html">ast_multi_channel_blob</a> are "1" and "2", reflecting the two halves. Unlike most other bridges, the 'bridge' between two local channels is not part of the bridge framework; as such, the message simply references the two local channel halves that are now bridged.</dd></dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">A</td><td><a class="el" href="../../dd/dfd/stasis.html">Stasis Message Bus API</a> message type </td></tr>
  </table>
  </dd>
</dl>

<p class="reference">Referenced by <a class="el" href="../../de/d47/core__local_8c_source.html#l01140">ast_local_init()</a>, <a class="el" href="../../de/d47/core__local_8c_source.html#l00463">local_message_to_ami()</a>, <a class="el" href="../../de/d47/core__local_8c_source.html#l01122">local_shutdown()</a>, and <a class="el" href="../../de/d47/core__local_8c_source.html#l00540">publish_local_bridge_message()</a>.</p>

</div>
</div>
<a id="a2b73f14ae5dc7e11bafc684936cf26d0"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2b73f14ae5dc7e11bafc684936cf26d0">&#9670;&nbsp;</a></span>ast_local_get_peer()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="../../df/d3c/structast__channel.html">ast_channel</a>* ast_local_get_peer </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="../../df/d3c/structast__channel.html">ast_channel</a> *&#160;</td>
          <td class="paramname"><em>ast</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Get the other local channel in the pair. </p>
<dl class="section since"><dt>Since</dt><dd>12.0.0</dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">ast</td><td>Local channel to get peer.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section note"><dt>Note</dt><dd>On entry, ast must be locked.</dd></dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">peer</td><td>reffed on success. </td></tr>
    <tr><td class="paramname">NULL</td><td>if no peer or error. </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="../../de/d47/core__local_8c_source.html#l00276">276</a> of file <a class="el" href="../../de/d47/core__local_8c_source.html">core_local.c</a>.</p>

<p class="reference">References <a class="el" href="../../d5/da5/astobj2_8h_source.html#l01756">ao2_find</a>, <a class="el" href="../../d5/da5/astobj2_8h_source.html#l00718">ao2_lock</a>, <a class="el" href="../../d5/da5/astobj2_8h_source.html#l00464">ao2_ref</a>, <a class="el" href="../../d5/da5/astobj2_8h_source.html#l00730">ao2_unlock</a>, <a class="el" href="../../d5/d7b/channel_8h_source.html#l02970">ast_channel_ref</a>, <a class="el" href="../../db/de2/channel__internal__api_8c_source.html#l00565">ast_channel_tech_pvt()</a>, <a class="el" href="../../de/d47/core__local_8c_source.html#l00225">local_pvt::base</a>, <a class="el" href="../../de/dea/core__unreal_8h_source.html#l00094">ast_unreal_pvt::chan</a>, <a class="el" href="../../dc/d7f/resample_8c_source.html#l00096">NULL</a>, and <a class="el" href="../../de/dea/core__unreal_8h_source.html#l00093">ast_unreal_pvt::owner</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../da/d49/resource__channels_8c_source.html#l01063">ari_channels_handle_originate_with_id()</a>, and <a class="el" href="../../d1/db7/parking__bridge__features_8c_source.html#l00244">park_local_transfer()</a>.</p>
<div class="fragment"><div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;{</div><div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../dc/dd4/structlocal__pvt.html">local_pvt</a> *p = <a class="code" href="../../d5/d7b/channel_8h.html#a3dc9d235c0e16ab0a6812b4aa6572cce">ast_channel_tech_pvt</a>(ast);</div><div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../dc/dd4/structlocal__pvt.html">local_pvt</a> *found;</div><div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../df/d3c/structast__channel.html">ast_channel</a> *peer;</div><div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;</div><div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;   <span class="keywordflow">if</span> (!p) {</div><div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;   }</div><div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;</div><div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;   found = p ? <a class="code" href="../../d5/da5/astobj2_8h.html#a911e0703891a9a7aaf73978152092586">ao2_find</a>(<a class="code" href="../../de/d47/core__local_8c.html#aef9f33a8f0b0099c02a84d0c01d77aab">locals</a>, p, 0) : <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;   <span class="keywordflow">if</span> (!found) {</div><div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;      <span class="comment">/* ast is either not a local channel or it has alredy been hungup */</span></div><div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;   }</div><div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#aa9fdb5d0a6157a56060d9f7279fe6c49">ao2_lock</a>(found);</div><div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;   <span class="keywordflow">if</span> (ast == p-&gt;<a class="code" href="../../dc/dd4/structlocal__pvt.html#a01ac602361510301b3613f38b600f36e">base</a>.<a class="code" href="../../d6/df3/structast__unreal__pvt.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>) {</div><div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;      peer = p-&gt;<a class="code" href="../../dc/dd4/structlocal__pvt.html#a01ac602361510301b3613f38b600f36e">base</a>.<a class="code" href="../../d6/df3/structast__unreal__pvt.html#a84d1435c5b8d387806714ea7079304b7">chan</a>;</div><div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;   } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (ast == p-&gt;<a class="code" href="../../dc/dd4/structlocal__pvt.html#a01ac602361510301b3613f38b600f36e">base</a>.<a class="code" href="../../d6/df3/structast__unreal__pvt.html#a84d1435c5b8d387806714ea7079304b7">chan</a>) {</div><div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;      peer = p-&gt;<a class="code" href="../../dc/dd4/structlocal__pvt.html#a01ac602361510301b3613f38b600f36e">base</a>.<a class="code" href="../../d6/df3/structast__unreal__pvt.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a>;</div><div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;   } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;      peer = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;   }</div><div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;   <span class="keywordflow">if</span> (peer) {</div><div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;      <a class="code" href="../../d5/d7b/channel_8h.html#a6801c703e767d6f760c54c8b86a30024">ast_channel_ref</a>(peer);</div><div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;   }</div><div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#a9998bd156b936636a8780385e9a910b2">ao2_unlock</a>(found);</div><div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(found, -1);</div><div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;   <span class="keywordflow">return</span> peer;</div><div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;}</div><div class="ttc" id="structast__channel_html"><div class="ttname"><a href="../../df/d3c/structast__channel.html">ast_channel</a></div><div class="ttdoc">Main Channel structure associated with a channel. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/de2/channel__internal__api_8c_source.html#l00073">channel_internal_api.c:73</a></div></div>
<div class="ttc" id="channel_8h_html_a3dc9d235c0e16ab0a6812b4aa6572cce"><div class="ttname"><a href="../../d5/d7b/channel_8h.html#a3dc9d235c0e16ab0a6812b4aa6572cce">ast_channel_tech_pvt</a></div><div class="ttdeci">void * ast_channel_tech_pvt(const struct ast_channel *chan)</div><div class="ttdef"><b>Definition:</b> <a href="../../db/de2/channel__internal__api_8c_source.html#l00565">channel_internal_api.c:565</a></div></div>
<div class="ttc" id="structast__unreal__pvt_html_a9241175b397dfd032c4cadbc8c9c2d05"><div class="ttname"><a href="../../d6/df3/structast__unreal__pvt.html#a9241175b397dfd032c4cadbc8c9c2d05">ast_unreal_pvt::owner</a></div><div class="ttdeci">struct ast_channel * owner</div><div class="ttdef"><b>Definition:</b> <a href="../../de/dea/core__unreal_8h_source.html#l00093">core_unreal.h:93</a></div></div>
<div class="ttc" id="astobj2_8h_html_a9998bd156b936636a8780385e9a910b2"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#a9998bd156b936636a8780385e9a910b2">ao2_unlock</a></div><div class="ttdeci">#define ao2_unlock(a)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l00730">astobj2.h:730</a></div></div>
<div class="ttc" id="resample_8c_html_a070d2ce7b6bb7e5c05602aa8c308d0c4"><div class="ttname"><a href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a></div><div class="ttdeci">#define NULL</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d7f/resample_8c_source.html#l00096">resample.c:96</a></div></div>
<div class="ttc" id="structlocal__pvt_html_a01ac602361510301b3613f38b600f36e"><div class="ttname"><a href="../../dc/dd4/structlocal__pvt.html#a01ac602361510301b3613f38b600f36e">local_pvt::base</a></div><div class="ttdeci">struct ast_unreal_pvt base</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d47/core__local_8c_source.html#l00225">core_local.c:225</a></div></div>
<div class="ttc" id="astobj2_8h_html_aaca5e8eac39a22f9da1c36fc6c922270"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a></div><div class="ttdeci">#define ao2_ref(o, delta)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l00464">astobj2.h:464</a></div></div>
<div class="ttc" id="astobj2_8h_html_aa9fdb5d0a6157a56060d9f7279fe6c49"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#aa9fdb5d0a6157a56060d9f7279fe6c49">ao2_lock</a></div><div class="ttdeci">#define ao2_lock(a)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l00718">astobj2.h:718</a></div></div>
<div class="ttc" id="structast__unreal__pvt_html_a84d1435c5b8d387806714ea7079304b7"><div class="ttname"><a href="../../d6/df3/structast__unreal__pvt.html#a84d1435c5b8d387806714ea7079304b7">ast_unreal_pvt::chan</a></div><div class="ttdeci">struct ast_channel * chan</div><div class="ttdef"><b>Definition:</b> <a href="../../de/dea/core__unreal_8h_source.html#l00094">core_unreal.h:94</a></div></div>
<div class="ttc" id="astobj2_8h_html_a911e0703891a9a7aaf73978152092586"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#a911e0703891a9a7aaf73978152092586">ao2_find</a></div><div class="ttdeci">#define ao2_find(container, arg, flags)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l01756">astobj2.h:1756</a></div></div>
<div class="ttc" id="channel_8h_html_a6801c703e767d6f760c54c8b86a30024"><div class="ttname"><a href="../../d5/d7b/channel_8h.html#a6801c703e767d6f760c54c8b86a30024">ast_channel_ref</a></div><div class="ttdeci">#define ast_channel_ref(c)</div><div class="ttdoc">Increase channel reference count. </div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d7b/channel_8h_source.html#l02970">channel.h:2970</a></div></div>
<div class="ttc" id="structlocal__pvt_html"><div class="ttname"><a href="../../dc/dd4/structlocal__pvt.html">local_pvt</a></div><div class="ttdoc">the local pvt structure for all channels </div><div class="ttdef"><b>Definition:</b> <a href="../../de/d47/core__local_8c_source.html#l00223">core_local.c:223</a></div></div>
<div class="ttc" id="core__local_8c_html_aef9f33a8f0b0099c02a84d0c01d77aab"><div class="ttname"><a href="../../de/d47/core__local_8c.html#aef9f33a8f0b0099c02a84d0c01d77aab">locals</a></div><div class="ttdeci">static struct ao2_container * locals</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d47/core__local_8c_source.html#l00138">core_local.c:138</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a973a646143d042b91ec6248ea6ba00f1"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a973a646143d042b91ec6248ea6ba00f1">&#9670;&nbsp;</a></span>ast_local_lock_all()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ast_local_lock_all </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="../../df/d3c/structast__channel.html">ast_channel</a> *&#160;</td>
          <td class="paramname"><em>chan</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void **&#160;</td>
          <td class="paramname"><em>tech_pvt</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="../../df/d3c/structast__channel.html">ast_channel</a> **&#160;</td>
          <td class="paramname"><em>base_chan</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="../../df/d3c/structast__channel.html">ast_channel</a> **&#160;</td>
          <td class="paramname"><em>base_owner</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Add a reference to the local channel's private tech, lock the local channel's private base, and add references and lock both sides of the local channel. </p>
<dl class="section note"><dt>Note</dt><dd>None of these locks should be held prior to calling this function. </dd>
<dd>
To undo this process call ast_local_unlock_all2.</dd></dl>
<dl class="section since"><dt>Since</dt><dd>13.17.0, 14.6.0</dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">chan</td><td>Must be a local channel </td></tr>
    <tr><td class="paramname">tech_pvt</td><td>[out] channel's private tech (ref and lock added) </td></tr>
    <tr><td class="paramname">base_chan</td><td>[out] One side of the local channel (ref and lock added) </td></tr>
    <tr><td class="paramname">base_owner</td><td>[out] Other side of the local channel (ref and lock added) </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="../../de/d47/core__local_8c_source.html#l00241">241</a> of file <a class="el" href="../../de/d47/core__local_8c_source.html">core_local.c</a>.</p>

<p class="reference">References <a class="el" href="../../d5/da5/astobj2_8h_source.html#l00491">ao2_bump</a>, <a class="el" href="../../db/de2/channel__internal__api_8c_source.html#l00565">ast_channel_tech_pvt()</a>, <a class="el" href="../../df/d2e/core__unreal_8c_source.html#l00047">ast_unreal_lock_all()</a>, <a class="el" href="../../de/d47/core__local_8c_source.html#l00225">local_pvt::base</a>, and <a class="el" href="../../dc/d7f/resample_8c_source.html#l00096">NULL</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../d0/d95/bridge_8c_source.html#l04280">attended_transfer_bridge()</a>.</p>
<div class="fragment"><div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;{</div><div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../dc/dd4/structlocal__pvt.html">local_pvt</a> *p = <a class="code" href="../../d5/d7b/channel_8h.html#a3dc9d235c0e16ab0a6812b4aa6572cce">ast_channel_tech_pvt</a>(chan);</div><div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;</div><div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;   *tech_pvt = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;   *base_chan = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;   *base_owner = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;</div><div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;   <span class="keywordflow">if</span> (p) {</div><div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;      *tech_pvt = <a class="code" href="../../d5/da5/astobj2_8h.html#ac438c3fcd3150481fad38689fd813a15">ao2_bump</a>(p);</div><div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;      <a class="code" href="../../de/dea/core__unreal_8h.html#aee6431a3ba70b90b669de8bd0d3334ab">ast_unreal_lock_all</a>(&amp;p-&gt;<a class="code" href="../../dc/dd4/structlocal__pvt.html#a01ac602361510301b3613f38b600f36e">base</a>, base_chan, base_owner);</div><div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;   }</div><div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;}</div><div class="ttc" id="channel_8h_html_a3dc9d235c0e16ab0a6812b4aa6572cce"><div class="ttname"><a href="../../d5/d7b/channel_8h.html#a3dc9d235c0e16ab0a6812b4aa6572cce">ast_channel_tech_pvt</a></div><div class="ttdeci">void * ast_channel_tech_pvt(const struct ast_channel *chan)</div><div class="ttdef"><b>Definition:</b> <a href="../../db/de2/channel__internal__api_8c_source.html#l00565">channel_internal_api.c:565</a></div></div>
<div class="ttc" id="resample_8c_html_a070d2ce7b6bb7e5c05602aa8c308d0c4"><div class="ttname"><a href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a></div><div class="ttdeci">#define NULL</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d7f/resample_8c_source.html#l00096">resample.c:96</a></div></div>
<div class="ttc" id="astobj2_8h_html_ac438c3fcd3150481fad38689fd813a15"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#ac438c3fcd3150481fad38689fd813a15">ao2_bump</a></div><div class="ttdeci">#define ao2_bump(obj)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l00491">astobj2.h:491</a></div></div>
<div class="ttc" id="structlocal__pvt_html_a01ac602361510301b3613f38b600f36e"><div class="ttname"><a href="../../dc/dd4/structlocal__pvt.html#a01ac602361510301b3613f38b600f36e">local_pvt::base</a></div><div class="ttdeci">struct ast_unreal_pvt base</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d47/core__local_8c_source.html#l00225">core_local.c:225</a></div></div>
<div class="ttc" id="structlocal__pvt_html"><div class="ttname"><a href="../../dc/dd4/structlocal__pvt.html">local_pvt</a></div><div class="ttdoc">the local pvt structure for all channels </div><div class="ttdef"><b>Definition:</b> <a href="../../de/d47/core__local_8c_source.html#l00223">core_local.c:223</a></div></div>
<div class="ttc" id="core__unreal_8h_html_aee6431a3ba70b90b669de8bd0d3334ab"><div class="ttname"><a href="../../de/dea/core__unreal_8h.html#aee6431a3ba70b90b669de8bd0d3334ab">ast_unreal_lock_all</a></div><div class="ttdeci">void ast_unreal_lock_all(struct ast_unreal_pvt *p, struct ast_channel **outchan, struct ast_channel **outowner)</div><div class="ttdoc">Send an unreal pvt in with no locks held and get all locks. </div><div class="ttdef"><b>Definition:</b> <a href="../../df/d2e/core__unreal_8c_source.html#l00047">core_unreal.c:47</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a8f023d0ccc8c7d3365abf4d60412deb5"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8f023d0ccc8c7d3365abf4d60412deb5">&#9670;&nbsp;</a></span>ast_local_optimization_begin_type()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="../../d4/d8f/structstasis__message__type.html">stasis_message_type</a>* ast_local_optimization_begin_type </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Message type for when a local channel optimization begins. </p>
<dl class="section since"><dt>Since</dt><dd>12.0.0</dd></dl>
<dl class="section note"><dt>Note</dt><dd>Payloads for the <a class="el" href="../../d5/da6/core__local_8h.html#a8f023d0ccc8c7d3365abf4d60412deb5">ast_local_optimization_begin_type</a> are a <a class="el" href="../../df/dcb/structast__multi__channel__blob.html">ast_multi_channel_blob</a>. Roles for the channels in the <a class="el" href="../../df/dcb/structast__multi__channel__blob.html">ast_multi_channel_blob</a> are "1" and "2", reflecting the two halves.</dd></dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">A</td><td><a class="el" href="../../dd/dfd/stasis.html">Stasis Message Bus API</a> message type </td></tr>
  </table>
  </dd>
</dl>

<p class="reference">Referenced by <a class="el" href="../../de/d47/core__local_8c_source.html#l01140">ast_local_init()</a>, <a class="el" href="../../db/dc4/test__cel_8c_source.html#l01616">AST_TEST_DEFINE()</a>, <a class="el" href="../../de/d47/core__local_8c_source.html#l00463">local_message_to_ami()</a>, <a class="el" href="../../de/d47/core__local_8c_source.html#l00390">local_optimization_started_cb()</a>, <a class="el" href="../../de/d47/core__local_8c_source.html#l01122">local_shutdown()</a>, and <a class="el" href="../../da/dfb/app__queue_8c_source.html#l06514">setup_stasis_subs()</a>.</p>

</div>
</div>
<a id="a6f6f7583dcbd0b63d59bdfe79f654945"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6f6f7583dcbd0b63d59bdfe79f654945">&#9670;&nbsp;</a></span>ast_local_optimization_end_type()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="../../d4/d8f/structstasis__message__type.html">stasis_message_type</a>* ast_local_optimization_end_type </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Message type for when a local channel optimization completes. </p>
<dl class="section since"><dt>Since</dt><dd>12.0.0</dd></dl>
<dl class="section note"><dt>Note</dt><dd>Payloads for the <a class="el" href="../../d5/da6/core__local_8h.html#a6f6f7583dcbd0b63d59bdfe79f654945">ast_local_optimization_end_type</a> are a <a class="el" href="../../df/dcb/structast__multi__channel__blob.html">ast_multi_channel_blob</a>. Roles for the channels in the <a class="el" href="../../df/dcb/structast__multi__channel__blob.html">ast_multi_channel_blob</a> are "1" and "2", reflecting the two halves.</dd></dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">A</td><td><a class="el" href="../../dd/dfd/stasis.html">Stasis Message Bus API</a> message type </td></tr>
  </table>
  </dd>
</dl>

<p class="reference">Referenced by <a class="el" href="../../de/d47/core__local_8c_source.html#l01140">ast_local_init()</a>, <a class="el" href="../../db/dc4/test__cel_8c_source.html#l01616">AST_TEST_DEFINE()</a>, <a class="el" href="../../da/dc9/cel_8c_source.html#l01500">create_routes()</a>, <a class="el" href="../../de/d47/core__local_8c_source.html#l00463">local_message_to_ami()</a>, <a class="el" href="../../de/d47/core__local_8c_source.html#l00433">local_optimization_finished_cb()</a>, <a class="el" href="../../de/d47/core__local_8c_source.html#l01122">local_shutdown()</a>, and <a class="el" href="../../da/dfb/app__queue_8c_source.html#l06514">setup_stasis_subs()</a>.</p>

</div>
</div>
<a id="a36ca4008cc93eb1ee59194e732ee6b8a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a36ca4008cc93eb1ee59194e732ee6b8a">&#9670;&nbsp;</a></span>ast_local_setup_bridge()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ast_local_setup_bridge </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="../../df/d3c/structast__channel.html">ast_channel</a> *&#160;</td>
          <td class="paramname"><em>ast</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="../../d4/d84/structast__bridge.html">ast_bridge</a> *&#160;</td>
          <td class="paramname"><em>bridge</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="../../df/d3c/structast__channel.html">ast_channel</a> *&#160;</td>
          <td class="paramname"><em>swap</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="../../db/dba/structast__bridge__features.html">ast_bridge_features</a> *&#160;</td>
          <td class="paramname"><em>features</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Setup the outgoing local channel to join a bridge on <a class="el" href="../../d5/d7b/channel_8h.html#a1b732eb4ed203140b1a3aae9e7dec2c1" title="Make a call. ">ast_call()</a>. </p>
<dl class="section since"><dt>Since</dt><dd>12.0.0</dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">ast</td><td>Either channel of a local channel pair. </td></tr>
    <tr><td class="paramname">bridge</td><td>Bridge to join. </td></tr>
    <tr><td class="paramname">swap</td><td>Channel to swap with when joining. </td></tr>
    <tr><td class="paramname">features</td><td>Bridge features structure.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section note"><dt>Note</dt><dd>The features parameter must be NULL or obtained by <a class="el" href="../../dc/d7a/bridge__features_8h.html#abf9e5d393615c63d27e0bd530301a1ed" title="Allocate a new bridge features struct. ">ast_bridge_features_new()</a>. You must not dereference features after calling even if the call fails.</dd>
<dd>
Intended to be called after <a class="el" href="../../d5/d7b/channel_8h.html#a39fc055500e09810d0afd0bff87407c5" title="Requests a channel. ">ast_request()</a> and before <a class="el" href="../../d5/d7b/channel_8h.html#a1b732eb4ed203140b1a3aae9e7dec2c1" title="Make a call. ">ast_call()</a> on a local channel.</dd></dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">0</td><td>on success. </td></tr>
    <tr><td class="paramname">-1</td><td>on error. </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="../../de/d47/core__local_8c_source.html#l00599">599</a> of file <a class="el" href="../../de/d47/core__local_8c_source.html">core_local.c</a>.</p>

<p class="reference">References <a class="el" href="../../dc/dd4/structlocal__pvt.html#a740364e243c4edddf4260922922bd163">local_pvt::action</a>, <a class="el" href="../../d5/da5/astobj2_8h_source.html#l01756">ao2_find</a>, <a class="el" href="../../d5/da5/astobj2_8h_source.html#l00718">ao2_lock</a>, <a class="el" href="../../d5/da5/astobj2_8h_source.html#l00464">ao2_ref</a>, <a class="el" href="../../d5/da5/astobj2_8h_source.html#l00730">ao2_unlock</a>, <a class="el" href="../../d0/d95/bridge_8c_source.html#l03741">ast_bridge_features_destroy()</a>, <a class="el" href="../../d5/d7b/channel_8h_source.html#l02945">ast_channel_lock</a>, <a class="el" href="../../d5/d7b/channel_8h_source.html#l02970">ast_channel_ref</a>, <a class="el" href="../../db/de2/channel__internal__api_8c_source.html#l00565">ast_channel_tech_pvt()</a>, <a class="el" href="../../d5/d7b/channel_8h_source.html#l02946">ast_channel_unlock</a>, <a class="el" href="../../d5/d60/utils_8h_source.html#l00063">ast_test_flag</a>, <a class="el" href="../../de/dea/core__unreal_8h_source.html#l00107">AST_UNREAL_CARETAKER_THREAD</a>, <a class="el" href="../../de/d47/core__local_8c_source.html#l00225">local_pvt::base</a>, <a class="el" href="../../de/d47/core__local_8c_source.html#l00229">local_pvt::bridge</a>, <a class="el" href="../../de/dea/core__unreal_8h_source.html#l00094">ast_unreal_pvt::chan</a>, <a class="el" href="../../de/d47/core__local_8c_source.html#l00213">local_bridge::features</a>, <a class="el" href="../../de/d47/core__local_8c_source.html#l00209">local_bridge::join</a>, <a class="el" href="../../de/d47/core__local_8c_source.html#l00201">LOCAL_CALL_ACTION_BRIDGE</a>, <a class="el" href="../../de/d47/core__local_8c_source.html#l00199">LOCAL_CALL_ACTION_DIALPLAN</a>, <a class="el" href="../../dc/d7f/resample_8c_source.html#l00096">NULL</a>, <a class="el" href="../../de/dea/core__unreal_8h_source.html#l00093">ast_unreal_pvt::owner</a>, <a class="el" href="../../de/d47/core__local_8c_source.html#l00211">local_bridge::swap</a>, and <a class="el" href="../../de/d47/core__local_8c_source.html#l00234">local_pvt::type</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../d0/d95/bridge_8c_source.html#l04280">attended_transfer_bridge()</a>.</p>
<div class="fragment"><div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;{</div><div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../dc/dd4/structlocal__pvt.html">local_pvt</a> *p;</div><div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../dc/dd4/structlocal__pvt.html">local_pvt</a> *found;</div><div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;   <span class="keywordtype">int</span> res = -1;</div><div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;</div><div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;   <span class="comment">/* Sanity checks. */</span></div><div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;   <span class="keywordflow">if</span> (!ast || !bridge) {</div><div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;      <a class="code" href="../../dc/d7a/bridge__features_8h.html#ad3debd15062b4b9463e5703724dd9a1f">ast_bridge_features_destroy</a>(features);</div><div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;   }</div><div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;</div><div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;   <a class="code" href="../../d5/d7b/channel_8h.html#a493bdebe876caafb8ee535853310364a">ast_channel_lock</a>(ast);</div><div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;   p = <a class="code" href="../../d5/d7b/channel_8h.html#a3dc9d235c0e16ab0a6812b4aa6572cce">ast_channel_tech_pvt</a>(ast);</div><div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160;   <a class="code" href="../../d5/d7b/channel_8h.html#af476c537b29be3f29240489032f9db39">ast_channel_unlock</a>(ast);</div><div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;</div><div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;   found = p ? <a class="code" href="../../d5/da5/astobj2_8h.html#a911e0703891a9a7aaf73978152092586">ao2_find</a>(<a class="code" href="../../de/d47/core__local_8c.html#aef9f33a8f0b0099c02a84d0c01d77aab">locals</a>, p, 0) : <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;   <span class="keywordflow">if</span> (found) {</div><div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160;      <a class="code" href="../../d5/da5/astobj2_8h.html#aa9fdb5d0a6157a56060d9f7279fe6c49">ao2_lock</a>(found);</div><div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160;      <span class="keywordflow">if</span> (found-&gt;<a class="code" href="../../dc/dd4/structlocal__pvt.html#aca731531d68f5a15cd5d927abb5740c5">type</a> == <a class="code" href="../../de/d47/core__local_8c.html#adc07bb06c3ca3a6ebb11ad83e9a2cc7da90d3c5d66511308989ef4545d72adc5f">LOCAL_CALL_ACTION_DIALPLAN</a></div><div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160;         &amp;&amp; found-&gt;<a class="code" href="../../dc/dd4/structlocal__pvt.html#a01ac602361510301b3613f38b600f36e">base</a>.<a class="code" href="../../d6/df3/structast__unreal__pvt.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a></div><div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160;         &amp;&amp; found-&gt;<a class="code" href="../../dc/dd4/structlocal__pvt.html#a01ac602361510301b3613f38b600f36e">base</a>.<a class="code" href="../../d6/df3/structast__unreal__pvt.html#a84d1435c5b8d387806714ea7079304b7">chan</a></div><div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;         &amp;&amp; !<a class="code" href="../../d5/d60/utils_8h.html#a00d4c9254c9827d6fa44f17a326744a5">ast_test_flag</a>(&amp;found-&gt;<a class="code" href="../../dc/dd4/structlocal__pvt.html#a01ac602361510301b3613f38b600f36e">base</a>, <a class="code" href="../../de/dea/core__unreal_8h.html#aeccb8e47f59ed0393a2755e0e7d927e1">AST_UNREAL_CARETAKER_THREAD</a>)) {</div><div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;         <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(bridge, +1);</div><div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;         <span class="keywordflow">if</span> (swap) {</div><div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;            <a class="code" href="../../d5/d7b/channel_8h.html#a6801c703e767d6f760c54c8b86a30024">ast_channel_ref</a>(swap);</div><div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160;         }</div><div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160;         found-&gt;<a class="code" href="../../dc/dd4/structlocal__pvt.html#aca731531d68f5a15cd5d927abb5740c5">type</a> = <a class="code" href="../../de/d47/core__local_8c.html#adc07bb06c3ca3a6ebb11ad83e9a2cc7da1d8347c3eb33285a4f2e2dd57a41a978">LOCAL_CALL_ACTION_BRIDGE</a>;</div><div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160;         found-&gt;<a class="code" href="../../dc/dd4/structlocal__pvt.html#a740364e243c4edddf4260922922bd163">action</a>.<a class="code" href="../../dc/dd4/structlocal__pvt.html#a742d27f540faf87b545a0fcf2df50596">bridge</a>.<a class="code" href="../../d2/d17/structlocal__bridge.html#a41e600f905922b7a8225f1da337a62ed">join</a> = <a class="code" href="../../dc/dd4/structlocal__pvt.html#a742d27f540faf87b545a0fcf2df50596">bridge</a>;</div><div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;         found-&gt;<a class="code" href="../../dc/dd4/structlocal__pvt.html#a740364e243c4edddf4260922922bd163">action</a>.<a class="code" href="../../dc/dd4/structlocal__pvt.html#a742d27f540faf87b545a0fcf2df50596">bridge</a>.<a class="code" href="../../d2/d17/structlocal__bridge.html#a3bf3c4e34892d0033814ab5fec0e006f">swap</a> = swap;</div><div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160;         found-&gt;<a class="code" href="../../dc/dd4/structlocal__pvt.html#a740364e243c4edddf4260922922bd163">action</a>.<a class="code" href="../../dc/dd4/structlocal__pvt.html#a742d27f540faf87b545a0fcf2df50596">bridge</a>.<a class="code" href="../../d2/d17/structlocal__bridge.html#a65633fdc6178dc8d9f754fda0166d16e">features</a> = features;</div><div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;         res = 0;</div><div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160;      } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160;         <a class="code" href="../../dc/d7a/bridge__features_8h.html#ad3debd15062b4b9463e5703724dd9a1f">ast_bridge_features_destroy</a>(features);</div><div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160;      }</div><div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160;      <a class="code" href="../../d5/da5/astobj2_8h.html#a9998bd156b936636a8780385e9a910b2">ao2_unlock</a>(found);</div><div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160;      <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(found, -1);</div><div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160;   }</div><div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160;</div><div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160;   <span class="keywordflow">return</span> res;</div><div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160;}</div><div class="ttc" id="channel_8h_html_a493bdebe876caafb8ee535853310364a"><div class="ttname"><a href="../../d5/d7b/channel_8h.html#a493bdebe876caafb8ee535853310364a">ast_channel_lock</a></div><div class="ttdeci">#define ast_channel_lock(chan)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d7b/channel_8h_source.html#l02945">channel.h:2945</a></div></div>
<div class="ttc" id="channel_8h_html_a3dc9d235c0e16ab0a6812b4aa6572cce"><div class="ttname"><a href="../../d5/d7b/channel_8h.html#a3dc9d235c0e16ab0a6812b4aa6572cce">ast_channel_tech_pvt</a></div><div class="ttdeci">void * ast_channel_tech_pvt(const struct ast_channel *chan)</div><div class="ttdef"><b>Definition:</b> <a href="../../db/de2/channel__internal__api_8c_source.html#l00565">channel_internal_api.c:565</a></div></div>
<div class="ttc" id="core__local_8c_html_adc07bb06c3ca3a6ebb11ad83e9a2cc7da90d3c5d66511308989ef4545d72adc5f"><div class="ttname"><a href="../../de/d47/core__local_8c.html#adc07bb06c3ca3a6ebb11ad83e9a2cc7da90d3c5d66511308989ef4545d72adc5f">LOCAL_CALL_ACTION_DIALPLAN</a></div><div class="ttdef"><b>Definition:</b> <a href="../../de/d47/core__local_8c_source.html#l00199">core_local.c:199</a></div></div>
<div class="ttc" id="utils_8h_html_a00d4c9254c9827d6fa44f17a326744a5"><div class="ttname"><a href="../../d5/d60/utils_8h.html#a00d4c9254c9827d6fa44f17a326744a5">ast_test_flag</a></div><div class="ttdeci">#define ast_test_flag(p, flag)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d60/utils_8h_source.html#l00063">utils.h:63</a></div></div>
<div class="ttc" id="structast__unreal__pvt_html_a9241175b397dfd032c4cadbc8c9c2d05"><div class="ttname"><a href="../../d6/df3/structast__unreal__pvt.html#a9241175b397dfd032c4cadbc8c9c2d05">ast_unreal_pvt::owner</a></div><div class="ttdeci">struct ast_channel * owner</div><div class="ttdef"><b>Definition:</b> <a href="../../de/dea/core__unreal_8h_source.html#l00093">core_unreal.h:93</a></div></div>
<div class="ttc" id="structlocal__bridge_html_a3bf3c4e34892d0033814ab5fec0e006f"><div class="ttname"><a href="../../d2/d17/structlocal__bridge.html#a3bf3c4e34892d0033814ab5fec0e006f">local_bridge::swap</a></div><div class="ttdeci">struct ast_channel * swap</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d47/core__local_8c_source.html#l00211">core_local.c:211</a></div></div>
<div class="ttc" id="core__unreal_8h_html_aeccb8e47f59ed0393a2755e0e7d927e1"><div class="ttname"><a href="../../de/dea/core__unreal_8h.html#aeccb8e47f59ed0393a2755e0e7d927e1">AST_UNREAL_CARETAKER_THREAD</a></div><div class="ttdeci">#define AST_UNREAL_CARETAKER_THREAD</div><div class="ttdef"><b>Definition:</b> <a href="../../de/dea/core__unreal_8h_source.html#l00107">core_unreal.h:107</a></div></div>
<div class="ttc" id="astobj2_8h_html_a9998bd156b936636a8780385e9a910b2"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#a9998bd156b936636a8780385e9a910b2">ao2_unlock</a></div><div class="ttdeci">#define ao2_unlock(a)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l00730">astobj2.h:730</a></div></div>
<div class="ttc" id="resample_8c_html_a070d2ce7b6bb7e5c05602aa8c308d0c4"><div class="ttname"><a href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a></div><div class="ttdeci">#define NULL</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d7f/resample_8c_source.html#l00096">resample.c:96</a></div></div>
<div class="ttc" id="bridge__features_8h_html_ad3debd15062b4b9463e5703724dd9a1f"><div class="ttname"><a href="../../dc/d7a/bridge__features_8h.html#ad3debd15062b4b9463e5703724dd9a1f">ast_bridge_features_destroy</a></div><div class="ttdeci">void ast_bridge_features_destroy(struct ast_bridge_features *features)</div><div class="ttdoc">Destroy an allocated bridge features struct. </div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d95/bridge_8c_source.html#l03741">bridge.c:3741</a></div></div>
<div class="ttc" id="structlocal__pvt_html_a01ac602361510301b3613f38b600f36e"><div class="ttname"><a href="../../dc/dd4/structlocal__pvt.html#a01ac602361510301b3613f38b600f36e">local_pvt::base</a></div><div class="ttdeci">struct ast_unreal_pvt base</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d47/core__local_8c_source.html#l00225">core_local.c:225</a></div></div>
<div class="ttc" id="structlocal__bridge_html_a65633fdc6178dc8d9f754fda0166d16e"><div class="ttname"><a href="../../d2/d17/structlocal__bridge.html#a65633fdc6178dc8d9f754fda0166d16e">local_bridge::features</a></div><div class="ttdeci">struct ast_bridge_features * features</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d47/core__local_8c_source.html#l00213">core_local.c:213</a></div></div>
<div class="ttc" id="astobj2_8h_html_aaca5e8eac39a22f9da1c36fc6c922270"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a></div><div class="ttdeci">#define ao2_ref(o, delta)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l00464">astobj2.h:464</a></div></div>
<div class="ttc" id="astobj2_8h_html_aa9fdb5d0a6157a56060d9f7279fe6c49"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#aa9fdb5d0a6157a56060d9f7279fe6c49">ao2_lock</a></div><div class="ttdeci">#define ao2_lock(a)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l00718">astobj2.h:718</a></div></div>
<div class="ttc" id="structast__unreal__pvt_html_a84d1435c5b8d387806714ea7079304b7"><div class="ttname"><a href="../../d6/df3/structast__unreal__pvt.html#a84d1435c5b8d387806714ea7079304b7">ast_unreal_pvt::chan</a></div><div class="ttdeci">struct ast_channel * chan</div><div class="ttdef"><b>Definition:</b> <a href="../../de/dea/core__unreal_8h_source.html#l00094">core_unreal.h:94</a></div></div>
<div class="ttc" id="structlocal__pvt_html_aca731531d68f5a15cd5d927abb5740c5"><div class="ttname"><a href="../../dc/dd4/structlocal__pvt.html#aca731531d68f5a15cd5d927abb5740c5">local_pvt::type</a></div><div class="ttdeci">enum local_call_action type</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d47/core__local_8c_source.html#l00234">core_local.c:234</a></div></div>
<div class="ttc" id="structlocal__pvt_html_a740364e243c4edddf4260922922bd163"><div class="ttname"><a href="../../dc/dd4/structlocal__pvt.html#a740364e243c4edddf4260922922bd163">local_pvt::action</a></div><div class="ttdeci">union local_pvt::@376 action</div></div>
<div class="ttc" id="channel_8h_html_af476c537b29be3f29240489032f9db39"><div class="ttname"><a href="../../d5/d7b/channel_8h.html#af476c537b29be3f29240489032f9db39">ast_channel_unlock</a></div><div class="ttdeci">#define ast_channel_unlock(chan)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d7b/channel_8h_source.html#l02946">channel.h:2946</a></div></div>
<div class="ttc" id="structlocal__bridge_html_a41e600f905922b7a8225f1da337a62ed"><div class="ttname"><a href="../../d2/d17/structlocal__bridge.html#a41e600f905922b7a8225f1da337a62ed">local_bridge::join</a></div><div class="ttdeci">struct ast_bridge * join</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d47/core__local_8c_source.html#l00209">core_local.c:209</a></div></div>
<div class="ttc" id="astobj2_8h_html_a911e0703891a9a7aaf73978152092586"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#a911e0703891a9a7aaf73978152092586">ao2_find</a></div><div class="ttdeci">#define ao2_find(container, arg, flags)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l01756">astobj2.h:1756</a></div></div>
<div class="ttc" id="channel_8h_html_a6801c703e767d6f760c54c8b86a30024"><div class="ttname"><a href="../../d5/d7b/channel_8h.html#a6801c703e767d6f760c54c8b86a30024">ast_channel_ref</a></div><div class="ttdeci">#define ast_channel_ref(c)</div><div class="ttdoc">Increase channel reference count. </div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d7b/channel_8h_source.html#l02970">channel.h:2970</a></div></div>
<div class="ttc" id="structlocal__pvt_html"><div class="ttname"><a href="../../dc/dd4/structlocal__pvt.html">local_pvt</a></div><div class="ttdoc">the local pvt structure for all channels </div><div class="ttdef"><b>Definition:</b> <a href="../../de/d47/core__local_8c_source.html#l00223">core_local.c:223</a></div></div>
<div class="ttc" id="core__local_8c_html_adc07bb06c3ca3a6ebb11ad83e9a2cc7da1d8347c3eb33285a4f2e2dd57a41a978"><div class="ttname"><a href="../../de/d47/core__local_8c.html#adc07bb06c3ca3a6ebb11ad83e9a2cc7da1d8347c3eb33285a4f2e2dd57a41a978">LOCAL_CALL_ACTION_BRIDGE</a></div><div class="ttdef"><b>Definition:</b> <a href="../../de/d47/core__local_8c_source.html#l00201">core_local.c:201</a></div></div>
<div class="ttc" id="core__local_8c_html_aef9f33a8f0b0099c02a84d0c01d77aab"><div class="ttname"><a href="../../de/d47/core__local_8c.html#aef9f33a8f0b0099c02a84d0c01d77aab">locals</a></div><div class="ttdeci">static struct ao2_container * locals</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d47/core__local_8c_source.html#l00138">core_local.c:138</a></div></div>
<div class="ttc" id="structlocal__pvt_html_a742d27f540faf87b545a0fcf2df50596"><div class="ttname"><a href="../../dc/dd4/structlocal__pvt.html#a742d27f540faf87b545a0fcf2df50596">local_pvt::bridge</a></div><div class="ttdeci">struct local_bridge bridge</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d47/core__local_8c_source.html#l00229">core_local.c:229</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="ac2e6544ffc24e3c97e1b028c1d5a4957"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac2e6544ffc24e3c97e1b028c1d5a4957">&#9670;&nbsp;</a></span>ast_local_setup_masquerade()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ast_local_setup_masquerade </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="../../df/d3c/structast__channel.html">ast_channel</a> *&#160;</td>
          <td class="paramname"><em>ast</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="../../df/d3c/structast__channel.html">ast_channel</a> *&#160;</td>
          <td class="paramname"><em>masq</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Setup the outgoing local channel to masquerade into a channel on <a class="el" href="../../d5/d7b/channel_8h.html#a1b732eb4ed203140b1a3aae9e7dec2c1" title="Make a call. ">ast_call()</a>. </p>
<dl class="section since"><dt>Since</dt><dd>12.0.0</dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">ast</td><td>Either channel of a local channel pair. </td></tr>
    <tr><td class="paramname">masq</td><td>Channel to masquerade into.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section note"><dt>Note</dt><dd>Intended to be called after <a class="el" href="../../d5/d7b/channel_8h.html#a39fc055500e09810d0afd0bff87407c5" title="Requests a channel. ">ast_request()</a> and before <a class="el" href="../../d5/d7b/channel_8h.html#a1b732eb4ed203140b1a3aae9e7dec2c1" title="Make a call. ">ast_call()</a> on a local channel.</dd></dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">0</td><td>on success. </td></tr>
    <tr><td class="paramname">-1</td><td>on error. </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="../../de/d47/core__local_8c_source.html#l00641">641</a> of file <a class="el" href="../../de/d47/core__local_8c_source.html">core_local.c</a>.</p>

<p class="reference">References <a class="el" href="../../dc/dd4/structlocal__pvt.html#a740364e243c4edddf4260922922bd163">local_pvt::action</a>, <a class="el" href="../../d5/da5/astobj2_8h_source.html#l01756">ao2_find</a>, <a class="el" href="../../d5/da5/astobj2_8h_source.html#l00718">ao2_lock</a>, <a class="el" href="../../d5/da5/astobj2_8h_source.html#l00464">ao2_ref</a>, <a class="el" href="../../d5/da5/astobj2_8h_source.html#l00730">ao2_unlock</a>, <a class="el" href="../../d5/d7b/channel_8h_source.html#l02945">ast_channel_lock</a>, <a class="el" href="../../d5/d7b/channel_8h_source.html#l02970">ast_channel_ref</a>, <a class="el" href="../../db/de2/channel__internal__api_8c_source.html#l00565">ast_channel_tech_pvt()</a>, <a class="el" href="../../d5/d7b/channel_8h_source.html#l02946">ast_channel_unlock</a>, <a class="el" href="../../d5/d60/utils_8h_source.html#l00063">ast_test_flag</a>, <a class="el" href="../../de/dea/core__unreal_8h_source.html#l00107">AST_UNREAL_CARETAKER_THREAD</a>, <a class="el" href="../../de/d47/core__local_8c_source.html#l00225">local_pvt::base</a>, <a class="el" href="../../de/dea/core__unreal_8h_source.html#l00094">ast_unreal_pvt::chan</a>, <a class="el" href="../../de/d47/core__local_8c_source.html#l00199">LOCAL_CALL_ACTION_DIALPLAN</a>, <a class="el" href="../../de/d47/core__local_8c_source.html#l00203">LOCAL_CALL_ACTION_MASQUERADE</a>, <a class="el" href="../../de/d47/core__local_8c_source.html#l00231">local_pvt::masq</a>, <a class="el" href="../../dc/d7f/resample_8c_source.html#l00096">NULL</a>, <a class="el" href="../../de/dea/core__unreal_8h_source.html#l00093">ast_unreal_pvt::owner</a>, and <a class="el" href="../../de/d47/core__local_8c_source.html#l00234">local_pvt::type</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../d0/d95/bridge_8c_source.html#l04280">attended_transfer_bridge()</a>.</p>
<div class="fragment"><div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160;{</div><div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../dc/dd4/structlocal__pvt.html">local_pvt</a> *p;</div><div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../dc/dd4/structlocal__pvt.html">local_pvt</a> *found;</div><div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160;   <span class="keywordtype">int</span> res = -1;</div><div class="line"><a name="l00646"></a><span class="lineno">  646</span>&#160;</div><div class="line"><a name="l00647"></a><span class="lineno">  647</span>&#160;   <span class="comment">/* Sanity checks. */</span></div><div class="line"><a name="l00648"></a><span class="lineno">  648</span>&#160;   <span class="keywordflow">if</span> (!ast || !masq) {</div><div class="line"><a name="l00649"></a><span class="lineno">  649</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l00650"></a><span class="lineno">  650</span>&#160;   }</div><div class="line"><a name="l00651"></a><span class="lineno">  651</span>&#160;</div><div class="line"><a name="l00652"></a><span class="lineno">  652</span>&#160;   <a class="code" href="../../d5/d7b/channel_8h.html#a493bdebe876caafb8ee535853310364a">ast_channel_lock</a>(ast);</div><div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160;   p = <a class="code" href="../../d5/d7b/channel_8h.html#a3dc9d235c0e16ab0a6812b4aa6572cce">ast_channel_tech_pvt</a>(ast);</div><div class="line"><a name="l00654"></a><span class="lineno">  654</span>&#160;   <a class="code" href="../../d5/d7b/channel_8h.html#af476c537b29be3f29240489032f9db39">ast_channel_unlock</a>(ast);</div><div class="line"><a name="l00655"></a><span class="lineno">  655</span>&#160;</div><div class="line"><a name="l00656"></a><span class="lineno">  656</span>&#160;   found = p ? <a class="code" href="../../d5/da5/astobj2_8h.html#a911e0703891a9a7aaf73978152092586">ao2_find</a>(<a class="code" href="../../de/d47/core__local_8c.html#aef9f33a8f0b0099c02a84d0c01d77aab">locals</a>, p, 0) : <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l00657"></a><span class="lineno">  657</span>&#160;   <span class="keywordflow">if</span> (found) {</div><div class="line"><a name="l00658"></a><span class="lineno">  658</span>&#160;      <a class="code" href="../../d5/da5/astobj2_8h.html#aa9fdb5d0a6157a56060d9f7279fe6c49">ao2_lock</a>(found);</div><div class="line"><a name="l00659"></a><span class="lineno">  659</span>&#160;      <span class="keywordflow">if</span> (found-&gt;<a class="code" href="../../dc/dd4/structlocal__pvt.html#aca731531d68f5a15cd5d927abb5740c5">type</a> == <a class="code" href="../../de/d47/core__local_8c.html#adc07bb06c3ca3a6ebb11ad83e9a2cc7da90d3c5d66511308989ef4545d72adc5f">LOCAL_CALL_ACTION_DIALPLAN</a></div><div class="line"><a name="l00660"></a><span class="lineno">  660</span>&#160;         &amp;&amp; found-&gt;<a class="code" href="../../dc/dd4/structlocal__pvt.html#a01ac602361510301b3613f38b600f36e">base</a>.<a class="code" href="../../d6/df3/structast__unreal__pvt.html#a9241175b397dfd032c4cadbc8c9c2d05">owner</a></div><div class="line"><a name="l00661"></a><span class="lineno">  661</span>&#160;         &amp;&amp; found-&gt;<a class="code" href="../../dc/dd4/structlocal__pvt.html#a01ac602361510301b3613f38b600f36e">base</a>.<a class="code" href="../../d6/df3/structast__unreal__pvt.html#a84d1435c5b8d387806714ea7079304b7">chan</a></div><div class="line"><a name="l00662"></a><span class="lineno">  662</span>&#160;         &amp;&amp; !<a class="code" href="../../d5/d60/utils_8h.html#a00d4c9254c9827d6fa44f17a326744a5">ast_test_flag</a>(&amp;found-&gt;<a class="code" href="../../dc/dd4/structlocal__pvt.html#a01ac602361510301b3613f38b600f36e">base</a>, <a class="code" href="../../de/dea/core__unreal_8h.html#aeccb8e47f59ed0393a2755e0e7d927e1">AST_UNREAL_CARETAKER_THREAD</a>)) {</div><div class="line"><a name="l00663"></a><span class="lineno">  663</span>&#160;         <a class="code" href="../../d5/d7b/channel_8h.html#a6801c703e767d6f760c54c8b86a30024">ast_channel_ref</a>(masq);</div><div class="line"><a name="l00664"></a><span class="lineno">  664</span>&#160;         found-&gt;<a class="code" href="../../dc/dd4/structlocal__pvt.html#aca731531d68f5a15cd5d927abb5740c5">type</a> = <a class="code" href="../../de/d47/core__local_8c.html#adc07bb06c3ca3a6ebb11ad83e9a2cc7da36557343c7753f1e969383a5921dbec9">LOCAL_CALL_ACTION_MASQUERADE</a>;</div><div class="line"><a name="l00665"></a><span class="lineno">  665</span>&#160;         found-&gt;<a class="code" href="../../dc/dd4/structlocal__pvt.html#a740364e243c4edddf4260922922bd163">action</a>.<a class="code" href="../../dc/dd4/structlocal__pvt.html#ae38ae730b987d648a6fe1c84c8a13442">masq</a> = <a class="code" href="../../dc/dd4/structlocal__pvt.html#ae38ae730b987d648a6fe1c84c8a13442">masq</a>;</div><div class="line"><a name="l00666"></a><span class="lineno">  666</span>&#160;         res = 0;</div><div class="line"><a name="l00667"></a><span class="lineno">  667</span>&#160;      }</div><div class="line"><a name="l00668"></a><span class="lineno">  668</span>&#160;      <a class="code" href="../../d5/da5/astobj2_8h.html#a9998bd156b936636a8780385e9a910b2">ao2_unlock</a>(found);</div><div class="line"><a name="l00669"></a><span class="lineno">  669</span>&#160;      <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(found, -1);</div><div class="line"><a name="l00670"></a><span class="lineno">  670</span>&#160;   }</div><div class="line"><a name="l00671"></a><span class="lineno">  671</span>&#160;</div><div class="line"><a name="l00672"></a><span class="lineno">  672</span>&#160;   <span class="keywordflow">return</span> res;</div><div class="line"><a name="l00673"></a><span class="lineno">  673</span>&#160;}</div><div class="ttc" id="channel_8h_html_a493bdebe876caafb8ee535853310364a"><div class="ttname"><a href="../../d5/d7b/channel_8h.html#a493bdebe876caafb8ee535853310364a">ast_channel_lock</a></div><div class="ttdeci">#define ast_channel_lock(chan)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d7b/channel_8h_source.html#l02945">channel.h:2945</a></div></div>
<div class="ttc" id="channel_8h_html_a3dc9d235c0e16ab0a6812b4aa6572cce"><div class="ttname"><a href="../../d5/d7b/channel_8h.html#a3dc9d235c0e16ab0a6812b4aa6572cce">ast_channel_tech_pvt</a></div><div class="ttdeci">void * ast_channel_tech_pvt(const struct ast_channel *chan)</div><div class="ttdef"><b>Definition:</b> <a href="../../db/de2/channel__internal__api_8c_source.html#l00565">channel_internal_api.c:565</a></div></div>
<div class="ttc" id="core__local_8c_html_adc07bb06c3ca3a6ebb11ad83e9a2cc7da90d3c5d66511308989ef4545d72adc5f"><div class="ttname"><a href="../../de/d47/core__local_8c.html#adc07bb06c3ca3a6ebb11ad83e9a2cc7da90d3c5d66511308989ef4545d72adc5f">LOCAL_CALL_ACTION_DIALPLAN</a></div><div class="ttdef"><b>Definition:</b> <a href="../../de/d47/core__local_8c_source.html#l00199">core_local.c:199</a></div></div>
<div class="ttc" id="utils_8h_html_a00d4c9254c9827d6fa44f17a326744a5"><div class="ttname"><a href="../../d5/d60/utils_8h.html#a00d4c9254c9827d6fa44f17a326744a5">ast_test_flag</a></div><div class="ttdeci">#define ast_test_flag(p, flag)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d60/utils_8h_source.html#l00063">utils.h:63</a></div></div>
<div class="ttc" id="structast__unreal__pvt_html_a9241175b397dfd032c4cadbc8c9c2d05"><div class="ttname"><a href="../../d6/df3/structast__unreal__pvt.html#a9241175b397dfd032c4cadbc8c9c2d05">ast_unreal_pvt::owner</a></div><div class="ttdeci">struct ast_channel * owner</div><div class="ttdef"><b>Definition:</b> <a href="../../de/dea/core__unreal_8h_source.html#l00093">core_unreal.h:93</a></div></div>
<div class="ttc" id="core__unreal_8h_html_aeccb8e47f59ed0393a2755e0e7d927e1"><div class="ttname"><a href="../../de/dea/core__unreal_8h.html#aeccb8e47f59ed0393a2755e0e7d927e1">AST_UNREAL_CARETAKER_THREAD</a></div><div class="ttdeci">#define AST_UNREAL_CARETAKER_THREAD</div><div class="ttdef"><b>Definition:</b> <a href="../../de/dea/core__unreal_8h_source.html#l00107">core_unreal.h:107</a></div></div>
<div class="ttc" id="astobj2_8h_html_a9998bd156b936636a8780385e9a910b2"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#a9998bd156b936636a8780385e9a910b2">ao2_unlock</a></div><div class="ttdeci">#define ao2_unlock(a)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l00730">astobj2.h:730</a></div></div>
<div class="ttc" id="resample_8c_html_a070d2ce7b6bb7e5c05602aa8c308d0c4"><div class="ttname"><a href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a></div><div class="ttdeci">#define NULL</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d7f/resample_8c_source.html#l00096">resample.c:96</a></div></div>
<div class="ttc" id="structlocal__pvt_html_a01ac602361510301b3613f38b600f36e"><div class="ttname"><a href="../../dc/dd4/structlocal__pvt.html#a01ac602361510301b3613f38b600f36e">local_pvt::base</a></div><div class="ttdeci">struct ast_unreal_pvt base</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d47/core__local_8c_source.html#l00225">core_local.c:225</a></div></div>
<div class="ttc" id="astobj2_8h_html_aaca5e8eac39a22f9da1c36fc6c922270"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a></div><div class="ttdeci">#define ao2_ref(o, delta)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l00464">astobj2.h:464</a></div></div>
<div class="ttc" id="astobj2_8h_html_aa9fdb5d0a6157a56060d9f7279fe6c49"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#aa9fdb5d0a6157a56060d9f7279fe6c49">ao2_lock</a></div><div class="ttdeci">#define ao2_lock(a)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l00718">astobj2.h:718</a></div></div>
<div class="ttc" id="structast__unreal__pvt_html_a84d1435c5b8d387806714ea7079304b7"><div class="ttname"><a href="../../d6/df3/structast__unreal__pvt.html#a84d1435c5b8d387806714ea7079304b7">ast_unreal_pvt::chan</a></div><div class="ttdeci">struct ast_channel * chan</div><div class="ttdef"><b>Definition:</b> <a href="../../de/dea/core__unreal_8h_source.html#l00094">core_unreal.h:94</a></div></div>
<div class="ttc" id="structlocal__pvt_html_aca731531d68f5a15cd5d927abb5740c5"><div class="ttname"><a href="../../dc/dd4/structlocal__pvt.html#aca731531d68f5a15cd5d927abb5740c5">local_pvt::type</a></div><div class="ttdeci">enum local_call_action type</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d47/core__local_8c_source.html#l00234">core_local.c:234</a></div></div>
<div class="ttc" id="structlocal__pvt_html_a740364e243c4edddf4260922922bd163"><div class="ttname"><a href="../../dc/dd4/structlocal__pvt.html#a740364e243c4edddf4260922922bd163">local_pvt::action</a></div><div class="ttdeci">union local_pvt::@376 action</div></div>
<div class="ttc" id="channel_8h_html_af476c537b29be3f29240489032f9db39"><div class="ttname"><a href="../../d5/d7b/channel_8h.html#af476c537b29be3f29240489032f9db39">ast_channel_unlock</a></div><div class="ttdeci">#define ast_channel_unlock(chan)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d7b/channel_8h_source.html#l02946">channel.h:2946</a></div></div>
<div class="ttc" id="astobj2_8h_html_a911e0703891a9a7aaf73978152092586"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#a911e0703891a9a7aaf73978152092586">ao2_find</a></div><div class="ttdeci">#define ao2_find(container, arg, flags)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l01756">astobj2.h:1756</a></div></div>
<div class="ttc" id="channel_8h_html_a6801c703e767d6f760c54c8b86a30024"><div class="ttname"><a href="../../d5/d7b/channel_8h.html#a6801c703e767d6f760c54c8b86a30024">ast_channel_ref</a></div><div class="ttdeci">#define ast_channel_ref(c)</div><div class="ttdoc">Increase channel reference count. </div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d7b/channel_8h_source.html#l02970">channel.h:2970</a></div></div>
<div class="ttc" id="structlocal__pvt_html"><div class="ttname"><a href="../../dc/dd4/structlocal__pvt.html">local_pvt</a></div><div class="ttdoc">the local pvt structure for all channels </div><div class="ttdef"><b>Definition:</b> <a href="../../de/d47/core__local_8c_source.html#l00223">core_local.c:223</a></div></div>
<div class="ttc" id="core__local_8c_html_adc07bb06c3ca3a6ebb11ad83e9a2cc7da36557343c7753f1e969383a5921dbec9"><div class="ttname"><a href="../../de/d47/core__local_8c.html#adc07bb06c3ca3a6ebb11ad83e9a2cc7da36557343c7753f1e969383a5921dbec9">LOCAL_CALL_ACTION_MASQUERADE</a></div><div class="ttdef"><b>Definition:</b> <a href="../../de/d47/core__local_8c_source.html#l00203">core_local.c:203</a></div></div>
<div class="ttc" id="structlocal__pvt_html_ae38ae730b987d648a6fe1c84c8a13442"><div class="ttname"><a href="../../dc/dd4/structlocal__pvt.html#ae38ae730b987d648a6fe1c84c8a13442">local_pvt::masq</a></div><div class="ttdeci">struct ast_channel * masq</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d47/core__local_8c_source.html#l00231">core_local.c:231</a></div></div>
<div class="ttc" id="core__local_8c_html_aef9f33a8f0b0099c02a84d0c01d77aab"><div class="ttname"><a href="../../de/d47/core__local_8c.html#aef9f33a8f0b0099c02a84d0c01d77aab">locals</a></div><div class="ttdeci">static struct ao2_container * locals</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d47/core__local_8c_source.html#l00138">core_local.c:138</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a2ed2a62610af1f7e8c25b89001e35963"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2ed2a62610af1f7e8c25b89001e35963">&#9670;&nbsp;</a></span>ast_local_unlock_all()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ast_local_unlock_all </td>
          <td>(</td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>tech_pvt</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="../../df/d3c/structast__channel.html">ast_channel</a> *&#160;</td>
          <td class="paramname"><em>base_chan</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="../../df/d3c/structast__channel.html">ast_channel</a> *&#160;</td>
          <td class="paramname"><em>base_owner</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Remove a reference to the given local channel's private tech, unlock the given local channel's private base, and remove references and unlock both sides of given the local channel. </p>
<dl class="section note"><dt>Note</dt><dd>This function should be used in conjunction with ast_local_lock_all2.</dd></dl>
<dl class="section since"><dt>Since</dt><dd>13.17.0, 14.6.0</dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">tech_pvt</td><td>channel's private tech (ref and lock removed) </td></tr>
    <tr><td class="paramname">base_chan</td><td>One side of the local channel (ref and lock removed) </td></tr>
    <tr><td class="paramname">base_owner</td><td>Other side of the local channel (ref and lock removed) </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="../../de/d47/core__local_8c_source.html#l00256">256</a> of file <a class="el" href="../../de/d47/core__local_8c_source.html">core_local.c</a>.</p>

<p class="reference">References <a class="el" href="../../d5/da5/astobj2_8h_source.html#l00464">ao2_ref</a>, <a class="el" href="../../d5/da5/astobj2_8h_source.html#l00730">ao2_unlock</a>, <a class="el" href="../../d5/d7b/channel_8h_source.html#l02946">ast_channel_unlock</a>, <a class="el" href="../../d5/d7b/channel_8h_source.html#l02981">ast_channel_unref</a>, and <a class="el" href="../../de/d47/core__local_8c_source.html#l00225">local_pvt::base</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../d0/d95/bridge_8c_source.html#l04280">attended_transfer_bridge()</a>.</p>
<div class="fragment"><div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;{</div><div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;   <span class="keywordflow">if</span> (base_chan) {</div><div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;      <a class="code" href="../../d5/d7b/channel_8h.html#af476c537b29be3f29240489032f9db39">ast_channel_unlock</a>(base_chan);</div><div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;      <a class="code" href="../../d5/d7b/channel_8h.html#ab733a7825810b895a89b629e0ea89380">ast_channel_unref</a>(base_chan);</div><div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;   }</div><div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;</div><div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;   <span class="keywordflow">if</span> (base_owner) {</div><div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;      <a class="code" href="../../d5/d7b/channel_8h.html#af476c537b29be3f29240489032f9db39">ast_channel_unlock</a>(base_owner);</div><div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;      <a class="code" href="../../d5/d7b/channel_8h.html#ab733a7825810b895a89b629e0ea89380">ast_channel_unref</a>(base_owner);</div><div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;   }</div><div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;</div><div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;   <span class="keywordflow">if</span> (tech_pvt) {</div><div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;      <span class="keyword">struct </span><a class="code" href="../../dc/dd4/structlocal__pvt.html">local_pvt</a> *p = tech_pvt;</div><div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;      <a class="code" href="../../d5/da5/astobj2_8h.html#a9998bd156b936636a8780385e9a910b2">ao2_unlock</a>(&amp;p-&gt;<a class="code" href="../../dc/dd4/structlocal__pvt.html#a01ac602361510301b3613f38b600f36e">base</a>);</div><div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;      <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(tech_pvt, -1);</div><div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;   }</div><div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;}</div><div class="ttc" id="channel_8h_html_ab733a7825810b895a89b629e0ea89380"><div class="ttname"><a href="../../d5/d7b/channel_8h.html#ab733a7825810b895a89b629e0ea89380">ast_channel_unref</a></div><div class="ttdeci">#define ast_channel_unref(c)</div><div class="ttdoc">Decrease channel reference count. </div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d7b/channel_8h_source.html#l02981">channel.h:2981</a></div></div>
<div class="ttc" id="astobj2_8h_html_a9998bd156b936636a8780385e9a910b2"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#a9998bd156b936636a8780385e9a910b2">ao2_unlock</a></div><div class="ttdeci">#define ao2_unlock(a)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l00730">astobj2.h:730</a></div></div>
<div class="ttc" id="structlocal__pvt_html_a01ac602361510301b3613f38b600f36e"><div class="ttname"><a href="../../dc/dd4/structlocal__pvt.html#a01ac602361510301b3613f38b600f36e">local_pvt::base</a></div><div class="ttdeci">struct ast_unreal_pvt base</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d47/core__local_8c_source.html#l00225">core_local.c:225</a></div></div>
<div class="ttc" id="astobj2_8h_html_aaca5e8eac39a22f9da1c36fc6c922270"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a></div><div class="ttdeci">#define ao2_ref(o, delta)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l00464">astobj2.h:464</a></div></div>
<div class="ttc" id="channel_8h_html_af476c537b29be3f29240489032f9db39"><div class="ttname"><a href="../../d5/d7b/channel_8h.html#af476c537b29be3f29240489032f9db39">ast_channel_unlock</a></div><div class="ttdeci">#define ast_channel_unlock(chan)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d7b/channel_8h_source.html#l02946">channel.h:2946</a></div></div>
<div class="ttc" id="structlocal__pvt_html"><div class="ttname"><a href="../../dc/dd4/structlocal__pvt.html">local_pvt</a></div><div class="ttdoc">the local pvt structure for all channels </div><div class="ttdef"><b>Definition:</b> <a href="../../de/d47/core__local_8c_source.html#l00223">core_local.c:223</a></div></div>
</div><!-- fragment -->
</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Sun Aug 8 2021 19:45:45 for Asterisk - The Open Source Telephony Project by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="../../doxygen.png" alt="doxygen"/>
</a> 1.8.13
</small></address>
</body>
</html>
