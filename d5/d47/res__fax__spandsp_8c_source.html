<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Asterisk - The Open Source Telephony Project: res_fax_spandsp.c Source File</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Asterisk - The Open Source Telephony Project
   &#160;<span id="projectnumber">18.5.0</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "../../search",false,'Search');
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('../../',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="../../dir_7b47cca4d318623bb4270ab1fb592ef5.html">res</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">res_fax_spandsp.c</div>  </div>
</div><!--header-->
<div class="contents">
<a href="../../d5/d47/res__fax__spandsp_8c.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="comment">/*</span></div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="comment"> * Asterisk -- An open source telephony toolkit.</span></div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="comment"> * Copyright (C) 2009-2010, Digium, Inc.</span></div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="comment"> * Matthew Nicholson &lt;mnicholson@digium.com&gt;</span></div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="comment"> * Initial T.38-gateway code</span></div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="comment"> * 2008, Daniel Ferenci &lt;daniel.ferenci@nethemba.com&gt;</span></div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;<span class="comment"> * Created by Nethemba s.r.o. http://www.nethemba.com</span></div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;<span class="comment"> * Sponsored by IPEX a.s. http://www.ipex.cz</span></div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;<span class="comment"> * T.38-gateway integration into asterisk app_fax and rework</span></div><div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;<span class="comment"> * 2008, Gregory Hinton Nietsky &lt;gregory@dnstelecom.co.za&gt;</span></div><div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;<span class="comment"> * dns Telecom http://www.dnstelecom.co.za</span></div><div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;<span class="comment"> * Modified to make T.38-gateway compatible with Asterisk 1.6.2</span></div><div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;<span class="comment"> * 2010, Anton Verevkin &lt;mymail@verevkin.it&gt;</span></div><div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;<span class="comment"> * ViaNetTV http://www.vianettv.com</span></div><div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;<span class="comment"> * Modified to make T.38-gateway work</span></div><div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;<span class="comment"> * 2010, Klaus Darilion, IPCom GmbH, www.ipcom.at</span></div><div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;<span class="comment"> * See http://www.asterisk.org for more information about</span></div><div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;<span class="comment"> * the Asterisk project. Please do not directly contact</span></div><div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;<span class="comment"> * any of the maintainers of this project for assistance;</span></div><div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;<span class="comment"> * the project provides a web site, mailing lists and IRC</span></div><div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;<span class="comment"> * channels for your use.</span></div><div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;<span class="comment"> * This program is free software, distributed under the terms of</span></div><div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;<span class="comment"> * the GNU General Public License Version 2. See the LICENSE file</span></div><div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;<span class="comment"> * at the top of the source tree.</span></div><div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;<span class="comment">/*! \file</span></div><div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;<span class="comment"> * \brief Spandsp T.38 and G.711 FAX Resource</span></div><div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;<span class="comment"> * \author Matthew Nicholson &lt;mnicholson@digium.com&gt;</span></div><div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;<span class="comment"> * \author Gregory H. Nietsky &lt;gregory@distrotech.co.za&gt;</span></div><div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;<span class="comment"> * This module registers the Spandsp FAX technology with the res_fax module.</span></div><div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;</div><div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;<span class="comment">/*** MODULEINFO</span></div><div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;<span class="comment">   &lt;depend&gt;spandsp&lt;/depend&gt;</span></div><div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;<span class="comment">   &lt;depend&gt;res_fax&lt;/depend&gt;</span></div><div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;<span class="comment">   &lt;support_level&gt;extended&lt;/support_level&gt;</span></div><div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;<span class="comment">***/</span></div><div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;</div><div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;<span class="comment">/* Needed for spandsp headers */</span></div><div class="line"><a name="l00052"></a><span class="lineno"><a class="line" href="../../d5/d47/res__fax__spandsp_8c.html#aa836e459bb9e806a058d3189a8d70a08">   52</a></span>&#160;<span class="preprocessor">#define ASTMM_LIBC ASTMM_IGNORE</span></div><div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../db/db2/asterisk_8h.html">asterisk.h</a>&quot;</span></div><div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;</div><div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../d1/d8c/logger_8h.html">asterisk/logger.h</a>&quot;</span></div><div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../d5/d16/module_8h.html">asterisk/module.h</a>&quot;</span></div><div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../d6/d90/strings_8h.html">asterisk/strings.h</a>&quot;</span></div><div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../dc/db0/cli_8h.html">asterisk/cli.h</a>&quot;</span></div><div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../d5/d60/utils_8h.html">asterisk/utils.h</a>&quot;</span></div><div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../db/d41/timing_8h.html">asterisk/timing.h</a>&quot;</span></div><div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../d5/da5/astobj2_8h.html">asterisk/astobj2.h</a>&quot;</span></div><div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../db/d6a/res__fax_8h.html">asterisk/res_fax.h</a>&quot;</span></div><div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../d5/d7b/channel_8h.html">asterisk/channel.h</a>&quot;</span></div><div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../db/d1c/format__cache_8h.html">asterisk/format_cache.h</a>&quot;</span></div><div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;</div><div class="line"><a name="l00066"></a><span class="lineno"><a class="line" href="../../d5/d47/res__fax__spandsp_8c.html#a4dbcfe9986d8f3d4d39f3e395fc96c0c">   66</a></span>&#160;<span class="preprocessor">#define SPANDSP_EXPOSE_INTERNAL_STRUCTURES</span></div><div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;<span class="preprocessor">#include &lt;spandsp.h&gt;</span></div><div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;<span class="preprocessor">#include &lt;spandsp/version.h&gt;</span></div><div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;</div><div class="line"><a name="l00070"></a><span class="lineno"><a class="line" href="../../d5/d47/res__fax__spandsp_8c.html#a26afae7dd9d256776976330e21298e68">   70</a></span>&#160;<span class="preprocessor">#define SPANDSP_FAX_SAMPLES 160</span></div><div class="line"><a name="l00071"></a><span class="lineno"><a class="line" href="../../d5/d47/res__fax__spandsp_8c.html#a9865dea3c8d3c70c21e466560f339210">   71</a></span>&#160;<span class="preprocessor">#define SPANDSP_FAX_TIMER_RATE 8000 / SPANDSP_FAX_SAMPLES   </span><span class="comment">/* 50 ticks per second, 20ms, 160 samples per second */</span><span class="preprocessor"></span></div><div class="line"><a name="l00072"></a><span class="lineno"><a class="line" href="../../d5/d47/res__fax__spandsp_8c.html#ac7fd98ac3a6b6d9a649dc1a7df2e6b25">   72</a></span>&#160;<span class="preprocessor">#define SPANDSP_ENGAGE_UDPTL_NAT_RETRY 3</span></div><div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;</div><div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> *<a class="code" href="../../d5/d47/res__fax__spandsp_8c.html#a6db78b000e8a71a5d7f7efba26639e41">spandsp_fax_new</a>(<span class="keyword">struct</span> <a class="code" href="../../d1/d16/structast__fax__session.html">ast_fax_session</a> *s, <span class="keyword">struct</span> ast_fax_tech_token *token);</div><div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d5/d47/res__fax__spandsp_8c.html#aff3bb506c68bf48a84a242b915c91758">spandsp_fax_destroy</a>(<span class="keyword">struct</span> <a class="code" href="../../d1/d16/structast__fax__session.html">ast_fax_session</a> *s);</div><div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;<span class="keyword">static</span> <span class="keyword">struct </span><a class="code" href="../../d0/d99/structast__frame.html">ast_frame</a> *<a class="code" href="../../d5/d47/res__fax__spandsp_8c.html#a7b40a2b701ed0e7b0486409c8e3bc03f">spandsp_fax_read</a>(<span class="keyword">struct</span> <a class="code" href="../../d1/d16/structast__fax__session.html">ast_fax_session</a> *s);</div><div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d5/d47/res__fax__spandsp_8c.html#aed0bd5d9c0943587312263618faaf6c3">spandsp_fax_write</a>(<span class="keyword">struct</span> <a class="code" href="../../d1/d16/structast__fax__session.html">ast_fax_session</a> *s, <span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="../../d0/d99/structast__frame.html">ast_frame</a> *f);</div><div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d5/d47/res__fax__spandsp_8c.html#ae8ab5a74bae7f83dd7cad98eb9deeb98">spandsp_fax_start</a>(<span class="keyword">struct</span> <a class="code" href="../../d1/d16/structast__fax__session.html">ast_fax_session</a> *s);</div><div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d5/d47/res__fax__spandsp_8c.html#aaae8190167c94ac97553e0377398eb6c">spandsp_fax_cancel</a>(<span class="keyword">struct</span> <a class="code" href="../../d1/d16/structast__fax__session.html">ast_fax_session</a> *s);</div><div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d5/d47/res__fax__spandsp_8c.html#a41b864f49450e34700ff878ffc337192">spandsp_fax_switch_to_t38</a>(<span class="keyword">struct</span> <a class="code" href="../../d1/d16/structast__fax__session.html">ast_fax_session</a> *s);</div><div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d5/d47/res__fax__spandsp_8c.html#aca5062a395eb7c74d0109ba1f4d11b89">spandsp_fax_gateway_start</a>(<span class="keyword">struct</span> <a class="code" href="../../d1/d16/structast__fax__session.html">ast_fax_session</a> *s);</div><div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d5/d47/res__fax__spandsp_8c.html#a8162670509872b734477d174e39a073e">spandsp_fax_gateway_process</a>(<span class="keyword">struct</span> <a class="code" href="../../d1/d16/structast__fax__session.html">ast_fax_session</a> *s, <span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="../../d0/d99/structast__frame.html">ast_frame</a> *f);</div><div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d5/d47/res__fax__spandsp_8c.html#ad19e873d8a667de24f4cb593a05b45fb">spandsp_fax_gateway_cleanup</a>(<span class="keyword">struct</span> <a class="code" href="../../d1/d16/structast__fax__session.html">ast_fax_session</a> *s);</div><div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d5/d47/res__fax__spandsp_8c.html#adaa7af133c27e45f416759d9552f0775">spandsp_v21_detect</a>(<span class="keyword">struct</span> <a class="code" href="../../d1/d16/structast__fax__session.html">ast_fax_session</a> *s, <span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="../../d0/d99/structast__frame.html">ast_frame</a> *f);</div><div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d5/d47/res__fax__spandsp_8c.html#addd7277ae067b27b98632539c158c6bf">spandsp_v21_cleanup</a>(<span class="keyword">struct</span> <a class="code" href="../../d1/d16/structast__fax__session.html">ast_fax_session</a> *s);</div><div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d5/d47/res__fax__spandsp_8c.html#a42d6e20cfd39f4a22d9ea31270f45ebf">spandsp_v21_tone</a>(<span class="keywordtype">void</span> *<a class="code" href="../../d0/d99/structast__frame.html#a4027905f872af30d910929b07e261ca5">data</a>, <span class="keywordtype">int</span> code, <span class="keywordtype">int</span> level, <span class="keywordtype">int</span> delay);</div><div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;</div><div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;<span class="keyword">static</span> <span class="keywordtype">char</span> *<a class="code" href="../../d5/d47/res__fax__spandsp_8c.html#a83441be7baa98d2b8382dc027a8f2dee">spandsp_fax_cli_show_capabilities</a>(<span class="keywordtype">int</span> fd);</div><div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;<span class="keyword">static</span> <span class="keywordtype">char</span> *<a class="code" href="../../d5/d47/res__fax__spandsp_8c.html#a193ec436c3481c1121eb872cd2e9ad0d">spandsp_fax_cli_show_session</a>(<span class="keyword">struct</span> <a class="code" href="../../d1/d16/structast__fax__session.html">ast_fax_session</a> *s, <span class="keywordtype">int</span> fd);</div><div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d5/d47/res__fax__spandsp_8c.html#a46ff23b63408b9b6d29a0ed01cdb424d">spandsp_manager_fax_session</a>(<span class="keyword">struct</span> <a class="code" href="../../d2/d8a/structmansession.html">mansession</a> *s,</div><div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;   <span class="keyword">const</span> <span class="keywordtype">char</span> *id_text, <span class="keyword">struct</span> <a class="code" href="../../d1/d16/structast__fax__session.html">ast_fax_session</a> *<a class="code" href="../../d2/d4d/astman_8c.html#ac4a6ae0400e4457f0b35beddec80c93d">session</a>);</div><div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;<span class="keyword">static</span> <span class="keywordtype">char</span> *<a class="code" href="../../d5/d47/res__fax__spandsp_8c.html#a632e62933ba50a9269eeeede6e8db7e5">spandsp_fax_cli_show_stats</a>(<span class="keywordtype">int</span> fd);</div><div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;<span class="keyword">static</span> <span class="keywordtype">char</span> *<a class="code" href="../../d5/d47/res__fax__spandsp_8c.html#acb07657df8ed42dd62966c531f1bee62">spandsp_fax_cli_show_settings</a>(<span class="keywordtype">int</span> fd);</div><div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;</div><div class="line"><a name="l00095"></a><span class="lineno"><a class="line" href="../../d5/d47/res__fax__spandsp_8c.html#a2519968d99ee93a67244dd8c53a92dad">   95</a></span>&#160;<span class="keyword">static</span> <span class="keyword">struct </span><a class="code" href="../../d9/d0e/structast__fax__tech.html">ast_fax_tech</a> <a class="code" href="../../d5/d47/res__fax__spandsp_8c.html#a2519968d99ee93a67244dd8c53a92dad">spandsp_fax_tech</a> = {</div><div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;   .<a class="code" href="../../d9/d0e/structast__fax__tech.html#a8ff938fb2f815be425fd2859a21e6d61">type</a> = <span class="stringliteral">&quot;Spandsp&quot;</span>,</div><div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;   .description = <span class="stringliteral">&quot;Spandsp FAX Driver&quot;</span>,</div><div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;<span class="preprocessor">#if SPANDSP_RELEASE_DATE &gt;= 20090220</span></div><div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;   <span class="comment">/* spandsp 0.0.6 */</span></div><div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;   .version = SPANDSP_RELEASE_DATETIME_STRING,</div><div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;<span class="preprocessor">#else</span></div><div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;   <span class="comment">/* spandsp 0.0.5</span></div><div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;<span class="comment">    * TODO: maybe we should determine the version better way</span></div><div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;<span class="comment">    */</span></div><div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;   .version = <span class="stringliteral">&quot;pre-20090220&quot;</span>,</div><div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;   .caps = <a class="code" href="../../db/d6a/res__fax_8h.html#a54eb45ad548b874cf12d0a599631e3f6a76fa4111df51955a949e95fadbccd48b">AST_FAX_TECH_AUDIO</a> | <a class="code" href="../../db/d6a/res__fax_8h.html#a54eb45ad548b874cf12d0a599631e3f6a6868445e2802e5b71068ae883366f635">AST_FAX_TECH_T38</a> | <a class="code" href="../../db/d6a/res__fax_8h.html#a54eb45ad548b874cf12d0a599631e3f6adbf07d8224b1a548ccae3b994653003b">AST_FAX_TECH_SEND</a></div><div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;      | <a class="code" href="../../db/d6a/res__fax_8h.html#a54eb45ad548b874cf12d0a599631e3f6a77bcc28b15614142ddbf4a180d263602">AST_FAX_TECH_RECEIVE</a> | <a class="code" href="../../db/d6a/res__fax_8h.html#a54eb45ad548b874cf12d0a599631e3f6add135550dca7400fb80e250a63a54887">AST_FAX_TECH_GATEWAY</a></div><div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;      | <a class="code" href="../../db/d6a/res__fax_8h.html#a54eb45ad548b874cf12d0a599631e3f6a9138c48a79016bfccdd7cee6197cb21c">AST_FAX_TECH_V21_DETECT</a>,</div><div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;   .new_session = <a class="code" href="../../d5/d47/res__fax__spandsp_8c.html#a6db78b000e8a71a5d7f7efba26639e41">spandsp_fax_new</a>,</div><div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;   .destroy_session = <a class="code" href="../../d5/d47/res__fax__spandsp_8c.html#aff3bb506c68bf48a84a242b915c91758">spandsp_fax_destroy</a>,</div><div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;   .read = <a class="code" href="../../d5/d47/res__fax__spandsp_8c.html#a7b40a2b701ed0e7b0486409c8e3bc03f">spandsp_fax_read</a>,</div><div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;   .write = <a class="code" href="../../d5/d47/res__fax__spandsp_8c.html#aed0bd5d9c0943587312263618faaf6c3">spandsp_fax_write</a>,</div><div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;   .start_session = <a class="code" href="../../d5/d47/res__fax__spandsp_8c.html#ae8ab5a74bae7f83dd7cad98eb9deeb98">spandsp_fax_start</a>,</div><div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;   .cancel_session = <a class="code" href="../../d5/d47/res__fax__spandsp_8c.html#aaae8190167c94ac97553e0377398eb6c">spandsp_fax_cancel</a>,</div><div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;   .switch_to_t38 = <a class="code" href="../../d5/d47/res__fax__spandsp_8c.html#a41b864f49450e34700ff878ffc337192">spandsp_fax_switch_to_t38</a>,</div><div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;   .cli_show_capabilities = <a class="code" href="../../d5/d47/res__fax__spandsp_8c.html#a83441be7baa98d2b8382dc027a8f2dee">spandsp_fax_cli_show_capabilities</a>,</div><div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;   .cli_show_session = <a class="code" href="../../d5/d47/res__fax__spandsp_8c.html#a193ec436c3481c1121eb872cd2e9ad0d">spandsp_fax_cli_show_session</a>,</div><div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;   .manager_fax_session = <a class="code" href="../../d5/d47/res__fax__spandsp_8c.html#a46ff23b63408b9b6d29a0ed01cdb424d">spandsp_manager_fax_session</a>,</div><div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;   .cli_show_stats = <a class="code" href="../../d5/d47/res__fax__spandsp_8c.html#a632e62933ba50a9269eeeede6e8db7e5">spandsp_fax_cli_show_stats</a>,</div><div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;   .cli_show_settings = <a class="code" href="../../d5/d47/res__fax__spandsp_8c.html#acb07657df8ed42dd62966c531f1bee62">spandsp_fax_cli_show_settings</a>,</div><div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;};</div><div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;</div><div class="line"><a name="l00124"></a><span class="lineno"><a class="line" href="../../dd/df2/structspandsp__fax__stats.html">  124</a></span>&#160;<span class="keyword">struct </span><a class="code" href="../../dd/df2/structspandsp__fax__stats.html">spandsp_fax_stats</a> {</div><div class="line"><a name="l00125"></a><span class="lineno"><a class="line" href="../../dd/df2/structspandsp__fax__stats.html#a6538a52840afd2ad6aba6a1ea5d89e50">  125</a></span>&#160;   <span class="keywordtype">int</span> <a class="code" href="../../dd/df2/structspandsp__fax__stats.html#a6538a52840afd2ad6aba6a1ea5d89e50">success</a>;</div><div class="line"><a name="l00126"></a><span class="lineno"><a class="line" href="../../dd/df2/structspandsp__fax__stats.html#a7156cb5e1d68d88369be68ad26ba8502">  126</a></span>&#160;   <span class="keywordtype">int</span> <a class="code" href="../../dd/df2/structspandsp__fax__stats.html#a7156cb5e1d68d88369be68ad26ba8502">nofax</a>;</div><div class="line"><a name="l00127"></a><span class="lineno"><a class="line" href="../../dd/df2/structspandsp__fax__stats.html#a4072f28e52076d5ac4bcb6d3ddd5d30b">  127</a></span>&#160;   <span class="keywordtype">int</span> <a class="code" href="../../dd/df2/structspandsp__fax__stats.html#a4072f28e52076d5ac4bcb6d3ddd5d30b">neg_failed</a>;</div><div class="line"><a name="l00128"></a><span class="lineno"><a class="line" href="../../dd/df2/structspandsp__fax__stats.html#a4962a14c99b722d1f2a27ecc05811166">  128</a></span>&#160;   <span class="keywordtype">int</span> <a class="code" href="../../dd/df2/structspandsp__fax__stats.html#a4962a14c99b722d1f2a27ecc05811166">failed_to_train</a>;</div><div class="line"><a name="l00129"></a><span class="lineno"><a class="line" href="../../dd/df2/structspandsp__fax__stats.html#a7592938aeab0c3337363075cb27e3a3e">  129</a></span>&#160;   <span class="keywordtype">int</span> <a class="code" href="../../dd/df2/structspandsp__fax__stats.html#a7592938aeab0c3337363075cb27e3a3e">rx_protocol_error</a>;</div><div class="line"><a name="l00130"></a><span class="lineno"><a class="line" href="../../dd/df2/structspandsp__fax__stats.html#ad1e948fb3a2a49d70040c6c7470f00f4">  130</a></span>&#160;   <span class="keywordtype">int</span> <a class="code" href="../../dd/df2/structspandsp__fax__stats.html#ad1e948fb3a2a49d70040c6c7470f00f4">tx_protocol_error</a>;</div><div class="line"><a name="l00131"></a><span class="lineno"><a class="line" href="../../dd/df2/structspandsp__fax__stats.html#ac41507da01dbee3fa458c4eebb085bce">  131</a></span>&#160;   <span class="keywordtype">int</span> <a class="code" href="../../dd/df2/structspandsp__fax__stats.html#ac41507da01dbee3fa458c4eebb085bce">protocol_error</a>;</div><div class="line"><a name="l00132"></a><span class="lineno"><a class="line" href="../../dd/df2/structspandsp__fax__stats.html#a8f4d51f1065dae0b6d2544dc53572177">  132</a></span>&#160;   <span class="keywordtype">int</span> <a class="code" href="../../dd/df2/structspandsp__fax__stats.html#a8f4d51f1065dae0b6d2544dc53572177">retries_exceeded</a>;</div><div class="line"><a name="l00133"></a><span class="lineno"><a class="line" href="../../dd/df2/structspandsp__fax__stats.html#a90dbed02abe7da6da26595204c44758e">  133</a></span>&#160;   <span class="keywordtype">int</span> <a class="code" href="../../dd/df2/structspandsp__fax__stats.html#a90dbed02abe7da6da26595204c44758e">file_error</a>;</div><div class="line"><a name="l00134"></a><span class="lineno"><a class="line" href="../../dd/df2/structspandsp__fax__stats.html#a5b41c47056e4587415bbf70507281a72">  134</a></span>&#160;   <span class="keywordtype">int</span> <a class="code" href="../../dd/df2/structspandsp__fax__stats.html#a5b41c47056e4587415bbf70507281a72">mem_error</a>;</div><div class="line"><a name="l00135"></a><span class="lineno"><a class="line" href="../../dd/df2/structspandsp__fax__stats.html#a9c107baadbd6f9d2dba24b4337422f85">  135</a></span>&#160;   <span class="keywordtype">int</span> <a class="code" href="../../dd/df2/structspandsp__fax__stats.html#a9c107baadbd6f9d2dba24b4337422f85">call_dropped</a>;</div><div class="line"><a name="l00136"></a><span class="lineno"><a class="line" href="../../dd/df2/structspandsp__fax__stats.html#ab2fe1c75b626347f20ab4c37ac6d4c60">  136</a></span>&#160;   <span class="keywordtype">int</span> <a class="code" href="../../dd/df2/structspandsp__fax__stats.html#ab2fe1c75b626347f20ab4c37ac6d4c60">unknown_error</a>;</div><div class="line"><a name="l00137"></a><span class="lineno"><a class="line" href="../../dd/df2/structspandsp__fax__stats.html#a38e2c3144ba423a7ddfdcbea40cc798c">  137</a></span>&#160;   <span class="keywordtype">int</span> <a class="code" href="../../dd/df2/structspandsp__fax__stats.html#a38e2c3144ba423a7ddfdcbea40cc798c">switched</a>;</div><div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;};</div><div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;</div><div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;<span class="keyword">static</span> <span class="keyword">struct </span>{</div><div class="line"><a name="l00141"></a><span class="lineno"><a class="line" href="../../d5/d47/res__fax__spandsp_8c.html#adf04f66344e3fb0a6f6a69bf39d19902">  141</a></span>&#160;   <a class="code" href="../../d8/dc5/structast__mutex__info.html">ast_mutex_t</a> <a class="code" href="../../d5/d47/res__fax__spandsp_8c.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>;</div><div class="line"><a name="l00142"></a><span class="lineno"><a class="line" href="../../d5/d47/res__fax__spandsp_8c.html#a28cf77eecd22cd8b53d3ec4e967c13c2">  142</a></span>&#160;   <span class="keyword">struct </span><a class="code" href="../../dd/df2/structspandsp__fax__stats.html">spandsp_fax_stats</a> <a class="code" href="../../d5/d47/res__fax__spandsp_8c.html#a28cf77eecd22cd8b53d3ec4e967c13c2">g711</a>;</div><div class="line"><a name="l00143"></a><span class="lineno"><a class="line" href="../../d5/d47/res__fax__spandsp_8c.html#ae948616ce1a6c11f9ffebbdd0239aa6f">  143</a></span>&#160;   <span class="keyword">struct </span><a class="code" href="../../dd/df2/structspandsp__fax__stats.html">spandsp_fax_stats</a> <a class="code" href="../../d5/d47/res__fax__spandsp_8c.html#ae948616ce1a6c11f9ffebbdd0239aa6f">t38</a>;</div><div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;} <a class="code" href="../../d5/d47/res__fax__spandsp_8c.html#a589319dce057e148f17f370ca3ba2a95">spandsp_global_stats</a>;</div><div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;</div><div class="line"><a name="l00146"></a><span class="lineno"><a class="line" href="../../d2/d70/structspandsp__pvt.html">  146</a></span>&#160;<span class="keyword">struct </span><a class="code" href="../../d2/d70/structspandsp__pvt.html">spandsp_pvt</a> {</div><div class="line"><a name="l00147"></a><span class="lineno"><a class="line" href="../../d2/d70/structspandsp__pvt.html#a9e04fe7f94b31b90af8617c4114973c6">  147</a></span>&#160;   <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="../../d2/d70/structspandsp__pvt.html#a9e04fe7f94b31b90af8617c4114973c6">ist38</a>:1;</div><div class="line"><a name="l00148"></a><span class="lineno"><a class="line" href="../../d2/d70/structspandsp__pvt.html#af2bd73f7c4fe9e40a5d5cb75dcbca598">  148</a></span>&#160;   <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="../../d2/d70/structspandsp__pvt.html#af2bd73f7c4fe9e40a5d5cb75dcbca598">isdone</a>:1;</div><div class="line"><a name="l00149"></a><span class="lineno"><a class="line" href="../../d2/d70/structspandsp__pvt.html#add1eaf99c12ebcef83fa7c1d4ca52f9f">  149</a></span>&#160;   <span class="keyword">enum</span> <a class="code" href="../../d5/d7b/channel_8h.html#a4cd990f4c1cd0c2af6e4c63f6d15b4e1">ast_t38_state</a> <a class="code" href="../../d5/d7b/channel_8h.html#a4cd990f4c1cd0c2af6e4c63f6d15b4e1">ast_t38_state</a>;</div><div class="line"><a name="l00150"></a><span class="lineno"><a class="line" href="../../d2/d70/structspandsp__pvt.html#a6209294447011868d1a0ec7373bb90b5">  150</a></span>&#160;   fax_state_t <a class="code" href="../../d2/d70/structspandsp__pvt.html#a6209294447011868d1a0ec7373bb90b5">fax_state</a>;</div><div class="line"><a name="l00151"></a><span class="lineno"><a class="line" href="../../d2/d70/structspandsp__pvt.html#aa32b12a7baab4b773f3aee19dc640fdb">  151</a></span>&#160;   t38_terminal_state_t <a class="code" href="../../d2/d70/structspandsp__pvt.html#aa32b12a7baab4b773f3aee19dc640fdb">t38_state</a>;</div><div class="line"><a name="l00152"></a><span class="lineno"><a class="line" href="../../d2/d70/structspandsp__pvt.html#adcd6f30baf585999693211a967c2db61">  152</a></span>&#160;   t30_state_t *<a class="code" href="../../d2/d70/structspandsp__pvt.html#adcd6f30baf585999693211a967c2db61">t30_state</a>;</div><div class="line"><a name="l00153"></a><span class="lineno"><a class="line" href="../../d2/d70/structspandsp__pvt.html#a2771e36a55ef2406a468f480426f3f90">  153</a></span>&#160;   t38_core_state_t *<a class="code" href="../../d2/d70/structspandsp__pvt.html#a2771e36a55ef2406a468f480426f3f90">t38_core_state</a>;</div><div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;</div><div class="line"><a name="l00155"></a><span class="lineno"><a class="line" href="../../d2/d70/structspandsp__pvt.html#a1b5003edd88843375153c462a72343f3">  155</a></span>&#160;   <span class="keyword">struct </span><a class="code" href="../../dd/df2/structspandsp__fax__stats.html">spandsp_fax_stats</a> *<a class="code" href="../../d2/d70/structspandsp__pvt.html#a1b5003edd88843375153c462a72343f3">stats</a>;</div><div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;</div><div class="line"><a name="l00157"></a><span class="lineno"><a class="line" href="../../d2/d70/structspandsp__pvt.html#a60d0506eeae2ef6636db3bd311cdc5b5">  157</a></span>&#160;   <span class="keyword">struct </span>spandsp_fax_gw_stats *<a class="code" href="../../d2/d70/structspandsp__pvt.html#a60d0506eeae2ef6636db3bd311cdc5b5">t38stats</a>;</div><div class="line"><a name="l00158"></a><span class="lineno"><a class="line" href="../../d2/d70/structspandsp__pvt.html#ad8cd454d1a02eee0cc27ea8819530ecd">  158</a></span>&#160;   t38_gateway_state_t <a class="code" href="../../d2/d70/structspandsp__pvt.html#ad8cd454d1a02eee0cc27ea8819530ecd">t38_gw_state</a>;</div><div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;</div><div class="line"><a name="l00160"></a><span class="lineno"><a class="line" href="../../d2/d70/structspandsp__pvt.html#a9aed6490b63794e6c9c00af4533f255f">  160</a></span>&#160;   <span class="keyword">struct </span><a class="code" href="../../da/def/structast__timer.html">ast_timer</a> *<a class="code" href="../../d2/d70/structspandsp__pvt.html#a9aed6490b63794e6c9c00af4533f255f">timer</a>;</div><div class="line"><a name="l00161"></a><span class="lineno"><a class="line" href="../../d1/dbe/structspandsp__pvt_1_1frame__queue.html#adf04f66344e3fb0a6f6a69bf39d19902">  161</a></span>&#160;   <a class="code" href="../../df/d90/linkedlists_8h.html#acdb4f56da6b3071d02dcce20072852b0">AST_LIST_HEAD</a>(<a class="code" href="../../d1/dbe/structspandsp__pvt_1_1frame__queue.html">frame_queue</a>, <a class="code" href="../../d0/d99/structast__frame.html">ast_frame</a>) read_frames;</div><div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;</div><div class="line"><a name="l00163"></a><span class="lineno"><a class="line" href="../../d2/d70/structspandsp__pvt.html#aef5d68740b9dc01c4950275c22ae81f4">  163</a></span>&#160;   <span class="keywordtype">int</span> <a class="code" href="../../d2/d70/structspandsp__pvt.html#aef5d68740b9dc01c4950275c22ae81f4">v21_detected</a>;</div><div class="line"><a name="l00164"></a><span class="lineno"><a class="line" href="../../d2/d70/structspandsp__pvt.html#a7a6ac9a55317a92c59f3542dea61cdae">  164</a></span>&#160;   modem_connect_tones_rx_state_t *<a class="code" href="../../d2/d70/structspandsp__pvt.html#a7a6ac9a55317a92c59f3542dea61cdae">tone_state</a>;</div><div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;};</div><div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;</div><div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d5/d47/res__fax__spandsp_8c.html#ac663d21c565affc72b520a9581181897">spandsp_v21_new</a>(<span class="keyword">struct</span> <a class="code" href="../../d2/d70/structspandsp__pvt.html">spandsp_pvt</a> *p);</div><div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d5/d47/res__fax__spandsp_8c.html#a26dae05b6eb59eb758e6bf0f55b6e396">session_destroy</a>(<span class="keyword">struct</span> <a class="code" href="../../d2/d70/structspandsp__pvt.html">spandsp_pvt</a> *p);</div><div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d5/d47/res__fax__spandsp_8c.html#a24efd6f18c67b0deb9973607e23f2bac">t38_tx_packet_handler</a>(t38_core_state_t *t38_core_state, <span class="keywordtype">void</span> *<a class="code" href="../../da/def/structast__timer.html#a735984d41155bc1032e09bece8f8d66d">data</a>, <span class="keyword">const</span> uint8_t *<a class="code" href="../../dd/d7c/eagi__proxy_8c.html#ac95651d79c608a3148973b5b1fc9e525">buf</a>, <span class="keywordtype">int</span> <a class="code" href="../../d9/d1e/func__strings_8c.html#af24e73aaf92f3000fda15d285e66df24">len</a>, <span class="keywordtype">int</span> count);</div><div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d5/d47/res__fax__spandsp_8c.html#a12890f182233a7dfd042518081c71cce">t30_phase_e_handler</a>(t30_state_t *t30_state, <span class="keywordtype">void</span> *<a class="code" href="../../da/def/structast__timer.html#a735984d41155bc1032e09bece8f8d66d">data</a>, <span class="keywordtype">int</span> completion_code);</div><div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d5/d47/res__fax__spandsp_8c.html#a1358377ae5cb4e9a6f1b2f03c5555b0e">spandsp_log</a>(<span class="keywordtype">int</span> level, <span class="keyword">const</span> <span class="keywordtype">char</span> *msg);</div><div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d5/d47/res__fax__spandsp_8c.html#adf5e0a963a0c910f4affa63d1ba1353e">update_stats</a>(<span class="keyword">struct</span> <a class="code" href="../../d2/d70/structspandsp__pvt.html">spandsp_pvt</a> *p, <span class="keywordtype">int</span> completion_code);</div><div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d5/d47/res__fax__spandsp_8c.html#a727760f4638f2c84101218ce5e89d567">spandsp_modems</a>(<span class="keyword">struct</span> <a class="code" href="../../d8/dc2/structast__fax__session__details.html">ast_fax_session_details</a> *details);</div><div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;</div><div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d5/d47/res__fax__spandsp_8c.html#a7a848b476ce6571398d94f5eb74f3182">set_logging</a>(logging_state_t *<a class="code" href="../../d4/d88/structstate.html">state</a>, <span class="keyword">struct</span> <a class="code" href="../../d8/dc2/structast__fax__session__details.html">ast_fax_session_details</a> *details);</div><div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d5/d47/res__fax__spandsp_8c.html#a985020177397f3b53f8c375b9f5555a9">set_local_info</a>(t30_state_t *t30_state, <span class="keyword">struct</span> <a class="code" href="../../d8/dc2/structast__fax__session__details.html">ast_fax_session_details</a> *details);</div><div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d5/d47/res__fax__spandsp_8c.html#a5fa4f4dc494fc66a1764e00783006b75">set_file</a>(t30_state_t *t30_state, <span class="keyword">struct</span> <a class="code" href="../../d8/dc2/structast__fax__session__details.html">ast_fax_session_details</a> *details);</div><div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d5/d47/res__fax__spandsp_8c.html#ae4ab2698fa08f5133c8241c9d2c3bfa4">set_ecm</a>(t30_state_t *t30_state, <span class="keyword">struct</span> <a class="code" href="../../d8/dc2/structast__fax__session__details.html">ast_fax_session_details</a> *details);</div><div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;</div><div class="line"><a name="l00180"></a><span class="lineno"><a class="line" href="../../d5/d47/res__fax__spandsp_8c.html#a26dae05b6eb59eb758e6bf0f55b6e396">  180</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d5/d47/res__fax__spandsp_8c.html#a26dae05b6eb59eb758e6bf0f55b6e396">session_destroy</a>(<span class="keyword">struct</span> <a class="code" href="../../d2/d70/structspandsp__pvt.html">spandsp_pvt</a> *p)</div><div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;{</div><div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d0/d99/structast__frame.html">ast_frame</a> *f;</div><div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;   t30_state_t *t30_to_terminate;</div><div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;</div><div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;   <span class="keywordflow">if</span> (p-&gt;<a class="code" href="../../d2/d70/structspandsp__pvt.html#adcd6f30baf585999693211a967c2db61">t30_state</a>) {</div><div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;      t30_to_terminate = p-&gt;<a class="code" href="../../d2/d70/structspandsp__pvt.html#adcd6f30baf585999693211a967c2db61">t30_state</a>;</div><div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;   } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (p-&gt;<a class="code" href="../../d2/d70/structspandsp__pvt.html#a9e04fe7f94b31b90af8617c4114973c6">ist38</a>) {</div><div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;<span class="preprocessor">#if SPANDSP_RELEASE_DATE &gt;= 20080725</span></div><div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;      t30_to_terminate = &amp;p-&gt;<a class="code" href="../../d2/d70/structspandsp__pvt.html#aa32b12a7baab4b773f3aee19dc640fdb">t38_state</a>.t30;</div><div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;<span class="preprocessor">#else</span></div><div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;      t30_to_terminate = &amp;p-&gt;<a class="code" href="../../d2/d70/structspandsp__pvt.html#aa32b12a7baab4b773f3aee19dc640fdb">t38_state</a>.t30_state;</div><div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;   } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;<span class="preprocessor">#if SPANDSP_RELEASE_DATE &gt;= 20080725</span></div><div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;      t30_to_terminate = &amp;p-&gt;<a class="code" href="../../d2/d70/structspandsp__pvt.html#a6209294447011868d1a0ec7373bb90b5">fax_state</a>.t30;</div><div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;<span class="preprocessor">#else</span></div><div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;      t30_to_terminate = &amp;p-&gt;<a class="code" href="../../d2/d70/structspandsp__pvt.html#a6209294447011868d1a0ec7373bb90b5">fax_state</a>.t30_state;</div><div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;   }</div><div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;</div><div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;   t30_terminate(t30_to_terminate);</div><div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;   p-&gt;<a class="code" href="../../d2/d70/structspandsp__pvt.html#af2bd73f7c4fe9e40a5d5cb75dcbca598">isdone</a> = 1;</div><div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;</div><div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;   <a class="code" href="../../db/d41/timing_8h.html#a2a5968baf9962dedeeda855fd5ed9c75">ast_timer_close</a>(p-&gt;<a class="code" href="../../d2/d70/structspandsp__pvt.html#a9aed6490b63794e6c9c00af4533f255f">timer</a>);</div><div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;   p-&gt;<a class="code" href="../../d2/d70/structspandsp__pvt.html#a9aed6490b63794e6c9c00af4533f255f">timer</a> = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;   fax_release(&amp;p-&gt;<a class="code" href="../../d2/d70/structspandsp__pvt.html#a6209294447011868d1a0ec7373bb90b5">fax_state</a>);</div><div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;   t38_terminal_release(&amp;p-&gt;<a class="code" href="../../d2/d70/structspandsp__pvt.html#aa32b12a7baab4b773f3aee19dc640fdb">t38_state</a>);</div><div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;</div><div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;   <span class="keywordflow">while</span> ((f = <a class="code" href="../../df/d90/linkedlists_8h.html#aadfe2a69fbba4f27c201266a2ca5f989">AST_LIST_REMOVE_HEAD</a>(&amp;p-&gt;<a class="code" href="../../d2/d70/structspandsp__pvt.html#a2ae422e03f0063ccdd76b75bad9624ec">read_frames</a>, <a class="code" href="../../d9/d42/structframe__list.html">frame_list</a>))) {</div><div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;      <a class="code" href="../../d6/d66/include_2asterisk_2frame_8h.html#a6440d070425a2efe8e0aa71e8d9e47b7">ast_frfree</a>(f);</div><div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;   }</div><div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;}</div><div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;<span class="comment">/*! \brief</span></div><div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00217"></a><span class="lineno"><a class="line" href="../../d5/d47/res__fax__spandsp_8c.html#a24efd6f18c67b0deb9973607e23f2bac">  217</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d5/d47/res__fax__spandsp_8c.html#a24efd6f18c67b0deb9973607e23f2bac">t38_tx_packet_handler</a>(t38_core_state_t *t38_core_state, <span class="keywordtype">void</span> *<a class="code" href="../../d0/d99/structast__frame.html#a4027905f872af30d910929b07e261ca5">data</a>, <span class="keyword">const</span> uint8_t *<a class="code" href="../../dd/d7c/eagi__proxy_8c.html#ac95651d79c608a3148973b5b1fc9e525">buf</a>, <span class="keywordtype">int</span> <a class="code" href="../../d9/d1e/func__strings_8c.html#af24e73aaf92f3000fda15d285e66df24">len</a>, <span class="keywordtype">int</span> count)</div><div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;{</div><div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;   <span class="keywordtype">int</span> res = -1;</div><div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d1/d16/structast__fax__session.html">ast_fax_session</a> *s = data;</div><div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d2/d70/structspandsp__pvt.html">spandsp_pvt</a> *p = s-&gt;<a class="code" href="../../d1/d16/structast__fax__session.html#a19aa04db5508cf9496602e694dc69e2f">tech_pvt</a>;</div><div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d0/d99/structast__frame.html">ast_frame</a> fax_frame = {</div><div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;      .<a class="code" href="../../d0/d99/structast__frame.html#a6937b93c56cb473b547eda454dca7b4c">frametype</a> = <a class="code" href="../../d6/d66/include_2asterisk_2frame_8h.html#ae2e1a9c4e048da387b761f619312d6e0ad99b86353343f422bda01163898b2eea">AST_FRAME_MODEM</a>,</div><div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;      .subclass.integer = <a class="code" href="../../d6/d66/include_2asterisk_2frame_8h.html#a3a510e4e2673c6870ed5fe0f1eb53732">AST_MODEM_T38</a>,</div><div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;      .src = <span class="stringliteral">&quot;res_fax_spandsp_t38&quot;</span>,</div><div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;   };</div><div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;</div><div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d0/d99/structast__frame.html">ast_frame</a> *f = &amp;fax_frame;</div><div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;</div><div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;</div><div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;   <span class="comment">/* TODO: Asterisk does not provide means of resending the same packet multiple</span></div><div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;<span class="comment">     times so count is ignored at the moment */</span></div><div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;</div><div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;   <a class="code" href="../../d6/d66/include_2asterisk_2frame_8h.html#ac8bc210573f6b9c55ef38662bddc4675">AST_FRAME_SET_BUFFER</a>(f, buf, 0, len);</div><div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;</div><div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;   <span class="keywordflow">if</span> (!(f = <a class="code" href="../../d6/d66/include_2asterisk_2frame_8h.html#a314496ce1d74ed7fdb9c5319c5e2e953">ast_frisolate</a>(f))) {</div><div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;      <span class="keywordflow">return</span> res;</div><div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;   }</div><div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;</div><div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;   <span class="keywordflow">if</span> (s-&gt;<a class="code" href="../../d1/d16/structast__fax__session.html#ae7b633178d301df70e8612b4ce1aeb77">details</a>-&gt;<a class="code" href="../../d8/dc2/structast__fax__session__details.html#ad75375cdd336e91cbcee4a829fcdabfe">caps</a> &amp; <a class="code" href="../../db/d6a/res__fax_8h.html#a54eb45ad548b874cf12d0a599631e3f6add135550dca7400fb80e250a63a54887">AST_FAX_TECH_GATEWAY</a>) {</div><div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;      <a class="code" href="../../d5/d60/utils_8h.html#ab5033a1f3d781d45e7ccc27598114510">ast_set_flag</a>(f, <a class="code" href="../../db/d6a/res__fax_8h.html#a748e0695940b2d6145b9646387daa4db">AST_FAX_FRFLAG_GATEWAY</a>);</div><div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;      <span class="keywordflow">if</span> (p-&gt;<a class="code" href="../../d2/d70/structspandsp__pvt.html#add1eaf99c12ebcef83fa7c1d4ca52f9f">ast_t38_state</a> == <a class="code" href="../../d5/d7b/channel_8h.html#a4cd990f4c1cd0c2af6e4c63f6d15b4e1af142c79721a025bd65edad812f0725e0">T38_STATE_NEGOTIATED</a>) {</div><div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;         res = <a class="code" href="../../d5/d7b/channel_8h.html#a79c413d51b7135404d5cacf811649a61">ast_write</a>(s-&gt;<a class="code" href="../../d1/d16/structast__fax__session.html#a84d1435c5b8d387806714ea7079304b7">chan</a>, f);</div><div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;      } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;         res = <a class="code" href="../../d5/d7b/channel_8h.html#a6cbcba5661d55216968cde8fdf913c89">ast_queue_frame</a>(s-&gt;<a class="code" href="../../d1/d16/structast__fax__session.html#a84d1435c5b8d387806714ea7079304b7">chan</a>, f);</div><div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;      }</div><div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;      <a class="code" href="../../d6/d66/include_2asterisk_2frame_8h.html#a6440d070425a2efe8e0aa71e8d9e47b7">ast_frfree</a>(f);</div><div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;   } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;      <span class="comment">/* no need to lock, this all runs in the same thread */</span></div><div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;      <a class="code" href="../../df/d90/linkedlists_8h.html#a4d258b4525e63c435d7de579d3f46960">AST_LIST_INSERT_TAIL</a>(&amp;p-&gt;<a class="code" href="../../d2/d70/structspandsp__pvt.html#a2ae422e03f0063ccdd76b75bad9624ec">read_frames</a>, f, <a class="code" href="../../d9/d42/structframe__list.html">frame_list</a>);</div><div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;      res = 0;</div><div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;   }</div><div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;</div><div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;   <span class="keywordflow">return</span> res;</div><div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;}</div><div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;</div><div class="line"><a name="l00257"></a><span class="lineno"><a class="line" href="../../d5/d47/res__fax__spandsp_8c.html#adf5e0a963a0c910f4affa63d1ba1353e">  257</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d5/d47/res__fax__spandsp_8c.html#adf5e0a963a0c910f4affa63d1ba1353e">update_stats</a>(<span class="keyword">struct</span> <a class="code" href="../../d2/d70/structspandsp__pvt.html">spandsp_pvt</a> *p, <span class="keywordtype">int</span> completion_code)</div><div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;{</div><div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;   <span class="keywordflow">switch</span> (completion_code) {</div><div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;   <span class="keywordflow">case</span> T30_ERR_OK:</div><div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;      <a class="code" href="../../dd/d42/lock_8h.html#a8a3bd496edfec04a95683ace66676200">ast_atomic_fetchadd_int</a>(&amp;p-&gt;<a class="code" href="../../d2/d70/structspandsp__pvt.html#a1b5003edd88843375153c462a72343f3">stats</a>-&gt;<a class="code" href="../../dd/df2/structspandsp__fax__stats.html#a6538a52840afd2ad6aba6a1ea5d89e50">success</a>, 1);</div><div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;</div><div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;   <span class="comment">/* Link problems */</span></div><div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;   <span class="keywordflow">case</span> T30_ERR_CEDTONE:            <span class="comment">/*! The CED tone exceeded 5s */</span></div><div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;   <span class="keywordflow">case</span> T30_ERR_T0_EXPIRED:         <span class="comment">/*! Timed out waiting for initial communication */</span></div><div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;   <span class="keywordflow">case</span> T30_ERR_T1_EXPIRED:         <span class="comment">/*! Timed out waiting for the first message */</span></div><div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;   <span class="keywordflow">case</span> T30_ERR_T3_EXPIRED:         <span class="comment">/*! Timed out waiting for procedural interrupt */</span></div><div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;   <span class="keywordflow">case</span> T30_ERR_HDLC_CARRIER:       <span class="comment">/*! The HDLC carrier did not stop in a timely manner */</span></div><div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;   <span class="keywordflow">case</span> T30_ERR_CANNOT_TRAIN:       <span class="comment">/*! Failed to train with any of the compatible modems */</span></div><div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;      <a class="code" href="../../dd/d42/lock_8h.html#a8a3bd496edfec04a95683ace66676200">ast_atomic_fetchadd_int</a>(&amp;p-&gt;<a class="code" href="../../d2/d70/structspandsp__pvt.html#a1b5003edd88843375153c462a72343f3">stats</a>-&gt;<a class="code" href="../../dd/df2/structspandsp__fax__stats.html#a4962a14c99b722d1f2a27ecc05811166">failed_to_train</a>, 1);</div><div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;</div><div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;   <span class="keywordflow">case</span> T30_ERR_OPER_INT_FAIL:      <span class="comment">/*! Operator intervention failed */</span></div><div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;   <span class="keywordflow">case</span> T30_ERR_INCOMPATIBLE:       <span class="comment">/*! Far end is not compatible */</span></div><div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;   <span class="keywordflow">case</span> T30_ERR_RX_INCAPABLE:       <span class="comment">/*! Far end is not able to receive */</span></div><div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;   <span class="keywordflow">case</span> T30_ERR_TX_INCAPABLE:       <span class="comment">/*! Far end is not able to transmit */</span></div><div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;   <span class="keywordflow">case</span> T30_ERR_NORESSUPPORT:       <span class="comment">/*! Far end cannot receive at the resolution of the image */</span></div><div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;   <span class="keywordflow">case</span> T30_ERR_NOSIZESUPPORT:      <span class="comment">/*! Far end cannot receive at the size of image */</span></div><div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;      <a class="code" href="../../dd/d42/lock_8h.html#a8a3bd496edfec04a95683ace66676200">ast_atomic_fetchadd_int</a>(&amp;p-&gt;<a class="code" href="../../d2/d70/structspandsp__pvt.html#a1b5003edd88843375153c462a72343f3">stats</a>-&gt;<a class="code" href="../../dd/df2/structspandsp__fax__stats.html#a4072f28e52076d5ac4bcb6d3ddd5d30b">neg_failed</a>, 1);</div><div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;</div><div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;   <span class="keywordflow">case</span> T30_ERR_UNEXPECTED:         <span class="comment">/*! Unexpected message received */</span></div><div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;      <a class="code" href="../../dd/d42/lock_8h.html#a8a3bd496edfec04a95683ace66676200">ast_atomic_fetchadd_int</a>(&amp;p-&gt;<a class="code" href="../../d2/d70/structspandsp__pvt.html#a1b5003edd88843375153c462a72343f3">stats</a>-&gt;<a class="code" href="../../dd/df2/structspandsp__fax__stats.html#ac41507da01dbee3fa458c4eebb085bce">protocol_error</a>, 1);</div><div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;</div><div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;   <span class="comment">/* Phase E status values returned to a transmitter */</span></div><div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;   <span class="keywordflow">case</span> T30_ERR_TX_BADDCS:          <span class="comment">/*! Received bad response to DCS or training */</span></div><div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;   <span class="keywordflow">case</span> T30_ERR_TX_BADPG:           <span class="comment">/*! Received a DCN from remote after sending a page */</span></div><div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;   <span class="keywordflow">case</span> T30_ERR_TX_ECMPHD:          <span class="comment">/*! Invalid ECM response received from receiver */</span></div><div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;   <span class="keywordflow">case</span> T30_ERR_TX_GOTDCN:          <span class="comment">/*! Received a DCN while waiting for a DIS */</span></div><div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;   <span class="keywordflow">case</span> T30_ERR_TX_INVALRSP:        <span class="comment">/*! Invalid response after sending a page */</span></div><div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;   <span class="keywordflow">case</span> T30_ERR_TX_NODIS:           <span class="comment">/*! Received other than DIS while waiting for DIS */</span></div><div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;   <span class="keywordflow">case</span> T30_ERR_TX_PHBDEAD:         <span class="comment">/*! Received no response to DCS, training or TCF */</span></div><div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;   <span class="keywordflow">case</span> T30_ERR_TX_PHDDEAD:         <span class="comment">/*! No response after sending a page */</span></div><div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;   <span class="keywordflow">case</span> T30_ERR_TX_T5EXP:           <span class="comment">/*! Timed out waiting for receiver ready (ECM mode) */</span></div><div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;      <a class="code" href="../../dd/d42/lock_8h.html#a8a3bd496edfec04a95683ace66676200">ast_atomic_fetchadd_int</a>(&amp;p-&gt;<a class="code" href="../../d2/d70/structspandsp__pvt.html#a1b5003edd88843375153c462a72343f3">stats</a>-&gt;<a class="code" href="../../dd/df2/structspandsp__fax__stats.html#ad1e948fb3a2a49d70040c6c7470f00f4">tx_protocol_error</a>, 1);</div><div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;</div><div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;   <span class="comment">/* Phase E status values returned to a receiver */</span></div><div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;   <span class="keywordflow">case</span> T30_ERR_RX_ECMPHD:          <span class="comment">/*! Invalid ECM response received from transmitter */</span></div><div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;   <span class="keywordflow">case</span> T30_ERR_RX_GOTDCS:          <span class="comment">/*! DCS received while waiting for DTC */</span></div><div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;   <span class="keywordflow">case</span> T30_ERR_RX_INVALCMD:        <span class="comment">/*! Unexpected command after page received */</span></div><div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;   <span class="keywordflow">case</span> T30_ERR_RX_NOCARRIER:       <span class="comment">/*! Carrier lost during fax receive */</span></div><div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;   <span class="keywordflow">case</span> T30_ERR_RX_NOEOL:           <span class="comment">/*! Timed out while waiting for EOL (end Of line) */</span></div><div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;      <a class="code" href="../../dd/d42/lock_8h.html#a8a3bd496edfec04a95683ace66676200">ast_atomic_fetchadd_int</a>(&amp;p-&gt;<a class="code" href="../../d2/d70/structspandsp__pvt.html#a1b5003edd88843375153c462a72343f3">stats</a>-&gt;<a class="code" href="../../dd/df2/structspandsp__fax__stats.html#a7592938aeab0c3337363075cb27e3a3e">rx_protocol_error</a>, 1);</div><div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;   <span class="keywordflow">case</span> T30_ERR_RX_NOFAX:           <span class="comment">/*! Timed out while waiting for first line */</span></div><div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;      <a class="code" href="../../dd/d42/lock_8h.html#a8a3bd496edfec04a95683ace66676200">ast_atomic_fetchadd_int</a>(&amp;p-&gt;<a class="code" href="../../d2/d70/structspandsp__pvt.html#a1b5003edd88843375153c462a72343f3">stats</a>-&gt;<a class="code" href="../../dd/df2/structspandsp__fax__stats.html#a7156cb5e1d68d88369be68ad26ba8502">nofax</a>, 1);</div><div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;   <span class="keywordflow">case</span> T30_ERR_RX_T2EXPDCN:        <span class="comment">/*! Timer T2 expired while waiting for DCN */</span></div><div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;   <span class="keywordflow">case</span> T30_ERR_RX_T2EXPD:          <span class="comment">/*! Timer T2 expired while waiting for phase D */</span></div><div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;   <span class="keywordflow">case</span> T30_ERR_RX_T2EXPFAX:        <span class="comment">/*! Timer T2 expired while waiting for fax page */</span></div><div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;   <span class="keywordflow">case</span> T30_ERR_RX_T2EXPMPS:        <span class="comment">/*! Timer T2 expired while waiting for next fax page */</span></div><div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;   <span class="keywordflow">case</span> T30_ERR_RX_T2EXPRR:         <span class="comment">/*! Timer T2 expired while waiting for RR command */</span></div><div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;   <span class="keywordflow">case</span> T30_ERR_RX_T2EXP:           <span class="comment">/*! Timer T2 expired while waiting for NSS, DCS or MCF */</span></div><div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;   <span class="keywordflow">case</span> T30_ERR_RX_DCNWHY:          <span class="comment">/*! Unexpected DCN while waiting for DCS or DIS */</span></div><div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;   <span class="keywordflow">case</span> T30_ERR_RX_DCNDATA:         <span class="comment">/*! Unexpected DCN while waiting for image data */</span></div><div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;   <span class="keywordflow">case</span> T30_ERR_RX_DCNFAX:          <span class="comment">/*! Unexpected DCN while waiting for EOM, EOP or MPS */</span></div><div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;   <span class="keywordflow">case</span> T30_ERR_RX_DCNPHD:          <span class="comment">/*! Unexpected DCN after EOM or MPS sequence */</span></div><div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;   <span class="keywordflow">case</span> T30_ERR_RX_DCNRRD:          <span class="comment">/*! Unexpected DCN after RR/RNR sequence */</span></div><div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;   <span class="keywordflow">case</span> T30_ERR_RX_DCNNORTN:        <span class="comment">/*! Unexpected DCN after requested retransmission */</span></div><div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;      <a class="code" href="../../dd/d42/lock_8h.html#a8a3bd496edfec04a95683ace66676200">ast_atomic_fetchadd_int</a>(&amp;p-&gt;<a class="code" href="../../d2/d70/structspandsp__pvt.html#a1b5003edd88843375153c462a72343f3">stats</a>-&gt;<a class="code" href="../../dd/df2/structspandsp__fax__stats.html#a7592938aeab0c3337363075cb27e3a3e">rx_protocol_error</a>, 1);</div><div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;</div><div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;   <span class="comment">/* TIFF file problems */</span></div><div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;   <span class="keywordflow">case</span> T30_ERR_FILEERROR:          <span class="comment">/*! TIFF/F file cannot be opened */</span></div><div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;   <span class="keywordflow">case</span> T30_ERR_NOPAGE:             <span class="comment">/*! TIFF/F page not found */</span></div><div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;   <span class="keywordflow">case</span> T30_ERR_BADTIFF:            <span class="comment">/*! TIFF/F format is not compatible */</span></div><div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;   <span class="keywordflow">case</span> T30_ERR_BADPAGE:            <span class="comment">/*! TIFF/F page number tag missing */</span></div><div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;   <span class="keywordflow">case</span> T30_ERR_BADTAG:             <span class="comment">/*! Incorrect values for TIFF/F tags */</span></div><div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;   <span class="keywordflow">case</span> T30_ERR_BADTIFFHDR:         <span class="comment">/*! Bad TIFF/F header - incorrect values in fields */</span></div><div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;      <a class="code" href="../../dd/d42/lock_8h.html#a8a3bd496edfec04a95683ace66676200">ast_atomic_fetchadd_int</a>(&amp;p-&gt;<a class="code" href="../../d2/d70/structspandsp__pvt.html#a1b5003edd88843375153c462a72343f3">stats</a>-&gt;<a class="code" href="../../dd/df2/structspandsp__fax__stats.html#a90dbed02abe7da6da26595204c44758e">file_error</a>, 1);</div><div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;   <span class="keywordflow">case</span> T30_ERR_NOMEM:              <span class="comment">/*! Cannot allocate memory for more pages */</span></div><div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;      <a class="code" href="../../dd/d42/lock_8h.html#a8a3bd496edfec04a95683ace66676200">ast_atomic_fetchadd_int</a>(&amp;p-&gt;<a class="code" href="../../d2/d70/structspandsp__pvt.html#a1b5003edd88843375153c462a72343f3">stats</a>-&gt;<a class="code" href="../../dd/df2/structspandsp__fax__stats.html#a5b41c47056e4587415bbf70507281a72">mem_error</a>, 1);</div><div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;</div><div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;   <span class="comment">/* General problems */</span></div><div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;   <span class="keywordflow">case</span> T30_ERR_RETRYDCN:           <span class="comment">/*! Disconnected after permitted retries */</span></div><div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;      <a class="code" href="../../dd/d42/lock_8h.html#a8a3bd496edfec04a95683ace66676200">ast_atomic_fetchadd_int</a>(&amp;p-&gt;<a class="code" href="../../d2/d70/structspandsp__pvt.html#a1b5003edd88843375153c462a72343f3">stats</a>-&gt;<a class="code" href="../../dd/df2/structspandsp__fax__stats.html#a8f4d51f1065dae0b6d2544dc53572177">retries_exceeded</a>, 1);</div><div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;   <span class="keywordflow">case</span> T30_ERR_CALLDROPPED:        <span class="comment">/*! The call dropped prematurely */</span></div><div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;      <a class="code" href="../../dd/d42/lock_8h.html#a8a3bd496edfec04a95683ace66676200">ast_atomic_fetchadd_int</a>(&amp;p-&gt;<a class="code" href="../../d2/d70/structspandsp__pvt.html#a1b5003edd88843375153c462a72343f3">stats</a>-&gt;<a class="code" href="../../dd/df2/structspandsp__fax__stats.html#a9c107baadbd6f9d2dba24b4337422f85">call_dropped</a>, 1);</div><div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;</div><div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;   <span class="comment">/* Feature negotiation issues */</span></div><div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;   <span class="keywordflow">case</span> T30_ERR_NOPOLL:             <span class="comment">/*! Poll not accepted */</span></div><div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;   <span class="keywordflow">case</span> T30_ERR_IDENT_UNACCEPTABLE: <span class="comment">/*! Far end&#39;s ident is not acceptable */</span></div><div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;   <span class="keywordflow">case</span> T30_ERR_SUB_UNACCEPTABLE:   <span class="comment">/*! Far end&#39;s sub-address is not acceptable */</span></div><div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;   <span class="keywordflow">case</span> T30_ERR_SEP_UNACCEPTABLE:   <span class="comment">/*! Far end&#39;s selective polling address is not acceptable */</span></div><div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;   <span class="keywordflow">case</span> T30_ERR_PSA_UNACCEPTABLE:   <span class="comment">/*! Far end&#39;s polled sub-address is not acceptable */</span></div><div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;   <span class="keywordflow">case</span> T30_ERR_SID_UNACCEPTABLE:   <span class="comment">/*! Far end&#39;s sender identification is not acceptable */</span></div><div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;   <span class="keywordflow">case</span> T30_ERR_PWD_UNACCEPTABLE:   <span class="comment">/*! Far end&#39;s password is not acceptable */</span></div><div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;   <span class="keywordflow">case</span> T30_ERR_TSA_UNACCEPTABLE:   <span class="comment">/*! Far end&#39;s transmitting subscriber internet address is not acceptable */</span></div><div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;   <span class="keywordflow">case</span> T30_ERR_IRA_UNACCEPTABLE:   <span class="comment">/*! Far end&#39;s internet routing address is not acceptable */</span></div><div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;   <span class="keywordflow">case</span> T30_ERR_CIA_UNACCEPTABLE:   <span class="comment">/*! Far end&#39;s calling subscriber internet address is not acceptable */</span></div><div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;   <span class="keywordflow">case</span> T30_ERR_ISP_UNACCEPTABLE:   <span class="comment">/*! Far end&#39;s internet selective polling address is not acceptable */</span></div><div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;   <span class="keywordflow">case</span> T30_ERR_CSA_UNACCEPTABLE:   <span class="comment">/*! Far end&#39;s called subscriber internet address is not acceptable */</span></div><div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;      <a class="code" href="../../dd/d42/lock_8h.html#a8a3bd496edfec04a95683ace66676200">ast_atomic_fetchadd_int</a>(&amp;p-&gt;<a class="code" href="../../d2/d70/structspandsp__pvt.html#a1b5003edd88843375153c462a72343f3">stats</a>-&gt;<a class="code" href="../../dd/df2/structspandsp__fax__stats.html#a4072f28e52076d5ac4bcb6d3ddd5d30b">neg_failed</a>, 1);</div><div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;   <span class="keywordflow">default</span>:</div><div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;      <a class="code" href="../../dd/d42/lock_8h.html#a8a3bd496edfec04a95683ace66676200">ast_atomic_fetchadd_int</a>(&amp;p-&gt;<a class="code" href="../../d2/d70/structspandsp__pvt.html#a1b5003edd88843375153c462a72343f3">stats</a>-&gt;<a class="code" href="../../dd/df2/structspandsp__fax__stats.html#ab2fe1c75b626347f20ab4c37ac6d4c60">unknown_error</a>, 1);</div><div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;unknown FAX session result &#39;%d&#39; (%s)\n&quot;</span>, completion_code, t30_completion_code_to_str(completion_code));</div><div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;   }</div><div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;   <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;}</div><div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;<span class="comment">/*! \brief Phase E handler callback.</span></div><div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;<span class="comment"> * \param t30_state the span t30 state</span></div><div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;<span class="comment"> * \param data this will be the ast_fax_session</span></div><div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;<span class="comment"> * \param completion_code the result of the fax session</span></div><div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;<span class="comment"> * This function pulls stats from the spandsp stack and stores them for res_fax</span></div><div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;<span class="comment"> * to use later.</span></div><div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00378"></a><span class="lineno"><a class="line" href="../../d5/d47/res__fax__spandsp_8c.html#a12890f182233a7dfd042518081c71cce">  378</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d5/d47/res__fax__spandsp_8c.html#a12890f182233a7dfd042518081c71cce">t30_phase_e_handler</a>(t30_state_t *t30_state, <span class="keywordtype">void</span> *<a class="code" href="../../d0/d99/structast__frame.html#a4027905f872af30d910929b07e261ca5">data</a>, <span class="keywordtype">int</span> completion_code)</div><div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;{</div><div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d1/d16/structast__fax__session.html">ast_fax_session</a> *s = data;</div><div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d2/d70/structspandsp__pvt.html">spandsp_pvt</a> *p = s-&gt;<a class="code" href="../../d1/d16/structast__fax__session.html#a19aa04db5508cf9496602e694dc69e2f">tech_pvt</a>;</div><div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;   <span class="keywordtype">char</span> headerinfo[T30_MAX_PAGE_HEADER_INFO + 1];</div><div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;   <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="../../d7/d6f/test__linkedlists_8c.html#acd9db00336027462cfb25b97b5356883">c</a>;</div><div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;   t30_stats_t <a class="code" href="../../d2/d70/structspandsp__pvt.html#a1b5003edd88843375153c462a72343f3">stats</a>;</div><div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;</div><div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;   <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(5, <span class="stringliteral">&quot;FAX session &#39;%u&#39; entering phase E\n&quot;</span>, s-&gt;<a class="code" href="../../d1/d16/structast__fax__session.html#ab7ce6f462afaf105224b0ca772a33c43">id</a>);</div><div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;</div><div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;   p-&gt;<a class="code" href="../../d2/d70/structspandsp__pvt.html#af2bd73f7c4fe9e40a5d5cb75dcbca598">isdone</a> = 1;</div><div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;</div><div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;   <a class="code" href="../../d5/d47/res__fax__spandsp_8c.html#adf5e0a963a0c910f4affa63d1ba1353e">update_stats</a>(p, completion_code);</div><div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;</div><div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;   t30_get_transfer_statistics(t30_state, &amp;stats);</div><div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;</div><div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;   <span class="keywordflow">if</span> (completion_code == T30_ERR_OK) {</div><div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;      <a class="code" href="../../d1/d0f/stringfields_8h.html#a653461abd6e0d16e4e3326ab90e0501d">ast_string_field_set</a>(s-&gt;<a class="code" href="../../d1/d16/structast__fax__session.html#ae7b633178d301df70e8612b4ce1aeb77">details</a>, <a class="code" href="../../de/d1b/cel__pgsql_8c.html#ad6c487210772a9b4b0ca04b04b847d4c">result</a>, <span class="stringliteral">&quot;SUCCESS&quot;</span>);</div><div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;   } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;      <a class="code" href="../../d1/d0f/stringfields_8h.html#a653461abd6e0d16e4e3326ab90e0501d">ast_string_field_set</a>(s-&gt;<a class="code" href="../../d1/d16/structast__fax__session.html#ae7b633178d301df70e8612b4ce1aeb77">details</a>, <a class="code" href="../../de/d1b/cel__pgsql_8c.html#ad6c487210772a9b4b0ca04b04b847d4c">result</a>, <span class="stringliteral">&quot;FAILED&quot;</span>);</div><div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;      <a class="code" href="../../d1/d0f/stringfields_8h.html#a653461abd6e0d16e4e3326ab90e0501d">ast_string_field_set</a>(s-&gt;<a class="code" href="../../d1/d16/structast__fax__session.html#ae7b633178d301df70e8612b4ce1aeb77">details</a>, <a class="code" href="../../d6/d47/utils_2frame_8c.html#a4a9391ee88e57361b613c4c2fd2bf4aa">error</a>, t30_completion_code_to_str(completion_code));</div><div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;   }</div><div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;</div><div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;   <a class="code" href="../../d1/d0f/stringfields_8h.html#a653461abd6e0d16e4e3326ab90e0501d">ast_string_field_set</a>(s-&gt;<a class="code" href="../../d1/d16/structast__fax__session.html#ae7b633178d301df70e8612b4ce1aeb77">details</a>, resultstr, t30_completion_code_to_str(completion_code));</div><div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;</div><div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;   <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(5, <span class="stringliteral">&quot;FAX session &#39;%u&#39; completed with result: %s (%s)\n&quot;</span>, s-&gt;<a class="code" href="../../d1/d16/structast__fax__session.html#ab7ce6f462afaf105224b0ca772a33c43">id</a>, s-&gt;<a class="code" href="../../d1/d16/structast__fax__session.html#ae7b633178d301df70e8612b4ce1aeb77">details</a>-&gt;<a class="code" href="../../d8/dc2/structast__fax__session__details.html#a17c89d9cdcac0df0f2039f065b7cf0ed">result</a>, s-&gt;<a class="code" href="../../d1/d16/structast__fax__session.html#ae7b633178d301df70e8612b4ce1aeb77">details</a>-&gt;<a class="code" href="../../d8/dc2/structast__fax__session__details.html#a8e155783a5296f8607948dfbe5783933">resultstr</a>);</div><div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;</div><div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;   <span class="keywordflow">if</span> ((c = t30_get_tx_ident(t30_state))) {</div><div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;      <a class="code" href="../../d1/d0f/stringfields_8h.html#a653461abd6e0d16e4e3326ab90e0501d">ast_string_field_set</a>(s-&gt;<a class="code" href="../../d1/d16/structast__fax__session.html#ae7b633178d301df70e8612b4ce1aeb77">details</a>, localstationid, c);</div><div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;   }</div><div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;</div><div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;   <span class="keywordflow">if</span> ((c = t30_get_rx_ident(t30_state))) {</div><div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;      <a class="code" href="../../d1/d0f/stringfields_8h.html#a653461abd6e0d16e4e3326ab90e0501d">ast_string_field_set</a>(s-&gt;<a class="code" href="../../d1/d16/structast__fax__session.html#ae7b633178d301df70e8612b4ce1aeb77">details</a>, remotestationid, c);</div><div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;   }</div><div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;</div><div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;<span class="preprocessor">#if SPANDSP_RELEASE_DATE &gt;= 20090220</span></div><div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;   s-&gt;<a class="code" href="../../d1/d16/structast__fax__session.html#ae7b633178d301df70e8612b4ce1aeb77">details</a>-&gt;<a class="code" href="../../d8/dc2/structast__fax__session__details.html#ac579558087dfa900a4c5384cb6e09dd8">pages_transferred</a> = (s-&gt;<a class="code" href="../../d1/d16/structast__fax__session.html#ae7b633178d301df70e8612b4ce1aeb77">details</a>-&gt;<a class="code" href="../../d8/dc2/structast__fax__session__details.html#ad75375cdd336e91cbcee4a829fcdabfe">caps</a> &amp; <a class="code" href="../../db/d6a/res__fax_8h.html#a54eb45ad548b874cf12d0a599631e3f6a77bcc28b15614142ddbf4a180d263602">AST_FAX_TECH_RECEIVE</a>) ? stats.pages_rx : stats.pages_tx;</div><div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;#<span class="keywordflow">else</span></div><div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;   s-&gt;<a class="code" href="../../d1/d16/structast__fax__session.html#ae7b633178d301df70e8612b4ce1aeb77">details</a>-&gt;<a class="code" href="../../d8/dc2/structast__fax__session__details.html#ac579558087dfa900a4c5384cb6e09dd8">pages_transferred</a> = stats.pages_transferred;</div><div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;#endif</div><div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;</div><div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;   <a class="code" href="../../d1/d0f/stringfields_8h.html#a8b9f4347fc72720cc5cead952b54abe9">ast_string_field_build</a>(s-&gt;<a class="code" href="../../d1/d16/structast__fax__session.html#ae7b633178d301df70e8612b4ce1aeb77">details</a>, transfer_rate, <span class="stringliteral">&quot;%d&quot;</span>, stats.bit_rate);</div><div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;</div><div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;   <a class="code" href="../../d1/d0f/stringfields_8h.html#a8b9f4347fc72720cc5cead952b54abe9">ast_string_field_build</a>(s-&gt;<a class="code" href="../../d1/d16/structast__fax__session.html#ae7b633178d301df70e8612b4ce1aeb77">details</a>, resolution, <span class="stringliteral">&quot;%dx%d&quot;</span>, stats.x_resolution, stats.y_resolution);</div><div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;</div><div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;   t30_get_tx_page_header_info(t30_state, headerinfo);</div><div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;   <a class="code" href="../../d1/d0f/stringfields_8h.html#a653461abd6e0d16e4e3326ab90e0501d">ast_string_field_set</a>(s-&gt;<a class="code" href="../../d1/d16/structast__fax__session.html#ae7b633178d301df70e8612b4ce1aeb77">details</a>, headerinfo, headerinfo);</div><div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;}</div><div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;<span class="comment">/*! \brief Send spandsp log messages to asterisk.</span></div><div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;<span class="comment"> * \param level the spandsp logging level</span></div><div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;<span class="comment"> * \param msg the log message</span></div><div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;<span class="comment"> * \note This function is a callback function called by spandsp.</span></div><div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00433"></a><span class="lineno"><a class="line" href="../../d5/d47/res__fax__spandsp_8c.html#a1358377ae5cb4e9a6f1b2f03c5555b0e">  433</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d5/d47/res__fax__spandsp_8c.html#a1358377ae5cb4e9a6f1b2f03c5555b0e">spandsp_log</a>(<span class="keywordtype">int</span> level, <span class="keyword">const</span> <span class="keywordtype">char</span> *msg)</div><div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;{</div><div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;   <span class="keywordflow">if</span> (level == SPAN_LOG_ERROR) {</div><div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;%s&quot;</span>, msg);</div><div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;   } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (level == SPAN_LOG_WARNING) {</div><div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;%s&quot;</span>, msg);</div><div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;   } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;      <a class="code" href="../../db/d6a/res__fax_8h.html#abb5f973c1052179a51f936be5c43a852">ast_fax_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#a6ff63e8955665c4a58b1598f2b07c51a">LOG_DEBUG</a>, msg);</div><div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;   }</div><div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;}</div><div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;</div><div class="line"><a name="l00444"></a><span class="lineno"><a class="line" href="../../d5/d47/res__fax__spandsp_8c.html#a7a848b476ce6571398d94f5eb74f3182">  444</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d5/d47/res__fax__spandsp_8c.html#a7a848b476ce6571398d94f5eb74f3182">set_logging</a>(logging_state_t *<a class="code" href="../../d4/d88/structstate.html">state</a>, <span class="keyword">struct</span> <a class="code" href="../../d8/dc2/structast__fax__session__details.html">ast_fax_session_details</a> *details)</div><div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;{</div><div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;   <span class="keywordtype">int</span> level = SPAN_LOG_WARNING;</div><div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;</div><div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;        <span class="keywordflow">if</span> (details-&gt;<a class="code" href="../../d8/dc2/structast__fax__session__details.html#a3ab211dbe8780b7292257f6b3dba1952">option</a>.<a class="code" href="../../d8/dc2/structast__fax__session__details.html#a84360ac08d9be11f221466122d8cdc65">debug</a>) {</div><div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;      level = SPAN_LOG_DEBUG_3;</div><div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;   }</div><div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;</div><div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;   span_log_set_message_handler(state, <a class="code" href="../../d5/d47/res__fax__spandsp_8c.html#a1358377ae5cb4e9a6f1b2f03c5555b0e">spandsp_log</a>);</div><div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;   span_log_set_level(state, SPAN_LOG_SHOW_SEVERITY | SPAN_LOG_SHOW_PROTOCOL | level);</div><div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;}</div><div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;</div><div class="line"><a name="l00456"></a><span class="lineno"><a class="line" href="../../d5/d47/res__fax__spandsp_8c.html#a985020177397f3b53f8c375b9f5555a9">  456</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d5/d47/res__fax__spandsp_8c.html#a985020177397f3b53f8c375b9f5555a9">set_local_info</a>(t30_state_t *<a class="code" href="../../d2/d70/structspandsp__pvt.html#adcd6f30baf585999693211a967c2db61">t30_state</a>, <span class="keyword">struct</span> <a class="code" href="../../d8/dc2/structast__fax__session__details.html">ast_fax_session_details</a> *details)</div><div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;{</div><div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;   <span class="keywordflow">if</span> (!<a class="code" href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a>(details-&gt;<a class="code" href="../../d8/dc2/structast__fax__session__details.html#a045d24c59f1a8a85e8fbc745fff88140">localstationid</a>)) {</div><div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;      t30_set_tx_ident(t30_state, details-&gt;<a class="code" href="../../d8/dc2/structast__fax__session__details.html#a045d24c59f1a8a85e8fbc745fff88140">localstationid</a>);</div><div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;   }</div><div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;</div><div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;   <span class="keywordflow">if</span> (!<a class="code" href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a>(details-&gt;<a class="code" href="../../d8/dc2/structast__fax__session__details.html#a6e3b307f2cde58ca9c7ed2c150e4c53c">headerinfo</a>)) {</div><div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;      t30_set_tx_page_header_info(t30_state, details-&gt;<a class="code" href="../../d8/dc2/structast__fax__session__details.html#a6e3b307f2cde58ca9c7ed2c150e4c53c">headerinfo</a>);</div><div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;   }</div><div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;}</div><div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;</div><div class="line"><a name="l00467"></a><span class="lineno"><a class="line" href="../../d5/d47/res__fax__spandsp_8c.html#a5fa4f4dc494fc66a1764e00783006b75">  467</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d5/d47/res__fax__spandsp_8c.html#a5fa4f4dc494fc66a1764e00783006b75">set_file</a>(t30_state_t *<a class="code" href="../../d2/d70/structspandsp__pvt.html#adcd6f30baf585999693211a967c2db61">t30_state</a>, <span class="keyword">struct</span> <a class="code" href="../../d8/dc2/structast__fax__session__details.html">ast_fax_session_details</a> *details)</div><div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;{</div><div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;   <span class="keywordflow">if</span> (details-&gt;<a class="code" href="../../d8/dc2/structast__fax__session__details.html#ad75375cdd336e91cbcee4a829fcdabfe">caps</a> &amp; <a class="code" href="../../db/d6a/res__fax_8h.html#a54eb45ad548b874cf12d0a599631e3f6a77bcc28b15614142ddbf4a180d263602">AST_FAX_TECH_RECEIVE</a>) {</div><div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;      t30_set_rx_file(t30_state, <a class="code" href="../../df/d90/linkedlists_8h.html#adf1959c5c03a3a706da97ad2f49617e5">AST_LIST_FIRST</a>(&amp;details-&gt;<a class="code" href="../../d8/dc2/structast__fax__session__details.html#a14c20eed7d6d03b484ebc2cc7a447ea2">documents</a>)-&gt;filename, -1);</div><div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;   } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;      <span class="comment">/* if not AST_FAX_TECH_RECEIVE, assume AST_FAX_TECH_SEND, this</span></div><div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;<span class="comment">       * should be safe because we ensure either RECEIVE or SEND is</span></div><div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;<span class="comment">       * indicated in spandsp_fax_new() */</span></div><div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;      t30_set_tx_file(t30_state, <a class="code" href="../../df/d90/linkedlists_8h.html#adf1959c5c03a3a706da97ad2f49617e5">AST_LIST_FIRST</a>(&amp;details-&gt;<a class="code" href="../../d8/dc2/structast__fax__session__details.html#a14c20eed7d6d03b484ebc2cc7a447ea2">documents</a>)-&gt;filename, -1, -1);</div><div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;   }</div><div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;}</div><div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;</div><div class="line"><a name="l00479"></a><span class="lineno"><a class="line" href="../../d5/d47/res__fax__spandsp_8c.html#ae4ab2698fa08f5133c8241c9d2c3bfa4">  479</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d5/d47/res__fax__spandsp_8c.html#ae4ab2698fa08f5133c8241c9d2c3bfa4">set_ecm</a>(t30_state_t *<a class="code" href="../../d2/d70/structspandsp__pvt.html#adcd6f30baf585999693211a967c2db61">t30_state</a>, <span class="keyword">struct</span> <a class="code" href="../../d8/dc2/structast__fax__session__details.html">ast_fax_session_details</a> *details)</div><div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;{</div><div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;   t30_set_ecm_capability(t30_state, details-&gt;<a class="code" href="../../d8/dc2/structast__fax__session__details.html#a3ab211dbe8780b7292257f6b3dba1952">option</a>.<a class="code" href="../../d8/dc2/structast__fax__session__details.html#af766692698b742acddbc42494d323a9f">ecm</a>);</div><div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;   t30_set_supported_compressions(t30_state, T30_SUPPORT_T4_1D_COMPRESSION | T30_SUPPORT_T4_2D_COMPRESSION | T30_SUPPORT_T6_COMPRESSION);</div><div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;}</div><div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;</div><div class="line"><a name="l00485"></a><span class="lineno"><a class="line" href="../../d5/d47/res__fax__spandsp_8c.html#ac663d21c565affc72b520a9581181897">  485</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d5/d47/res__fax__spandsp_8c.html#ac663d21c565affc72b520a9581181897">spandsp_v21_new</a>(<span class="keyword">struct</span> <a class="code" href="../../d2/d70/structspandsp__pvt.html">spandsp_pvt</a> *p)</div><div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;{</div><div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;   <span class="comment">/* XXX Here we use MODEM_CONNECT_TONES_FAX_CED_OR_PREAMBLE even though</span></div><div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;<span class="comment">    * we don&#39;t care about CED tones. Using MODEM_CONNECT_TONES_PREAMBLE</span></div><div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;<span class="comment">    * doesn&#39;t seem to work right all the time.</span></div><div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;<span class="comment">    */</span></div><div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;   p-&gt;<a class="code" href="../../d2/d70/structspandsp__pvt.html#a7a6ac9a55317a92c59f3542dea61cdae">tone_state</a> = modem_connect_tones_rx_init(<a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, MODEM_CONNECT_TONES_FAX_CED_OR_PREAMBLE, <a class="code" href="../../d5/d47/res__fax__spandsp_8c.html#a42d6e20cfd39f4a22d9ea31270f45ebf">spandsp_v21_tone</a>, p);</div><div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;   <span class="keywordflow">if</span> (!p-&gt;<a class="code" href="../../d2/d70/structspandsp__pvt.html#a7a6ac9a55317a92c59f3542dea61cdae">tone_state</a>) {</div><div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;   }</div><div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;</div><div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;   <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;}</div><div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;</div><div class="line"><a name="l00499"></a><span class="lineno"><a class="line" href="../../d5/d47/res__fax__spandsp_8c.html#a727760f4638f2c84101218ce5e89d567">  499</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d5/d47/res__fax__spandsp_8c.html#a727760f4638f2c84101218ce5e89d567">spandsp_modems</a>(<span class="keyword">struct</span> <a class="code" href="../../d8/dc2/structast__fax__session__details.html">ast_fax_session_details</a> *details)</div><div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;{</div><div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;   <span class="keywordtype">int</span> modems = 0;</div><div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../db/d6a/res__fax_8h.html#ab9287e81dc5d3047da0bcb1f6c89bd57a2faab4efa2a8027ed56a92cc758a7bb0">AST_FAX_MODEM_V17</a> &amp; details-&gt;<a class="code" href="../../d8/dc2/structast__fax__session__details.html#a38b557eee45ee4c0d92d514c04823f84">modems</a>) {</div><div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;      modems |= T30_SUPPORT_V17;</div><div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;   }</div><div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../db/d6a/res__fax_8h.html#ab9287e81dc5d3047da0bcb1f6c89bd57ae3b2fd3e12f8b526273b642e0c0a342a">AST_FAX_MODEM_V27TER</a> &amp; details-&gt;<a class="code" href="../../d8/dc2/structast__fax__session__details.html#a38b557eee45ee4c0d92d514c04823f84">modems</a>) {</div><div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;      modems |= T30_SUPPORT_V27TER;</div><div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;   }</div><div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../db/d6a/res__fax_8h.html#ab9287e81dc5d3047da0bcb1f6c89bd57a7f0a2c297f96556e6d4af522930d1ccc">AST_FAX_MODEM_V29</a> &amp; details-&gt;<a class="code" href="../../d8/dc2/structast__fax__session__details.html#a38b557eee45ee4c0d92d514c04823f84">modems</a>) {</div><div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;      modems |= T30_SUPPORT_V29;</div><div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;   }</div><div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../db/d6a/res__fax_8h.html#ab9287e81dc5d3047da0bcb1f6c89bd57af68d38a189351562faca6609a162b5a6">AST_FAX_MODEM_V34</a> &amp; details-&gt;<a class="code" href="../../d8/dc2/structast__fax__session__details.html#a38b557eee45ee4c0d92d514c04823f84">modems</a>) {</div><div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;<span class="preprocessor">#if defined(T30_SUPPORT_V34)</span></div><div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;      modems |= T30_SUPPORT_V34;</div><div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;<span class="preprocessor">#elif defined(T30_SUPPORT_V34HDX)</span></div><div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;      modems |= T30_SUPPORT_V34HDX;</div><div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;<span class="preprocessor">#else</span></div><div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;v34 not supported in this version of spandsp\n&quot;</span>);</div><div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;   }</div><div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;</div><div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;   <span class="keywordflow">return</span> modems;</div><div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;}</div><div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;<span class="comment">/*! \brief create an instance of the spandsp tech_pvt for a fax session */</span></div><div class="line"><a name="l00525"></a><span class="lineno"><a class="line" href="../../d5/d47/res__fax__spandsp_8c.html#a6db78b000e8a71a5d7f7efba26639e41">  525</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> *<a class="code" href="../../d5/d47/res__fax__spandsp_8c.html#a6db78b000e8a71a5d7f7efba26639e41">spandsp_fax_new</a>(<span class="keyword">struct</span> <a class="code" href="../../d1/d16/structast__fax__session.html">ast_fax_session</a> *s, <span class="keyword">struct</span> ast_fax_tech_token *token)</div><div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;{</div><div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d2/d70/structspandsp__pvt.html">spandsp_pvt</a> *p;</div><div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;   <span class="keywordtype">int</span> caller_mode;</div><div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;</div><div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;   <span class="keywordflow">if</span> ((!(p = <a class="code" href="../../d8/d8a/astmm_8h.html#ae0cd4c5524b01287ab19cbe233d9cebb">ast_calloc</a>(1, <span class="keyword">sizeof</span>(*p))))) {</div><div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Cannot initialize the spandsp private FAX technology structure.\n&quot;</span>);</div><div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;      <span class="keywordflow">goto</span> e_return;</div><div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;   }</div><div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;</div><div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;   <span class="keywordflow">if</span> (s-&gt;<a class="code" href="../../d1/d16/structast__fax__session.html#ae7b633178d301df70e8612b4ce1aeb77">details</a>-&gt;<a class="code" href="../../d8/dc2/structast__fax__session__details.html#ad75375cdd336e91cbcee4a829fcdabfe">caps</a> &amp; <a class="code" href="../../db/d6a/res__fax_8h.html#a54eb45ad548b874cf12d0a599631e3f6a9138c48a79016bfccdd7cee6197cb21c">AST_FAX_TECH_V21_DETECT</a>) {</div><div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="../../d5/d47/res__fax__spandsp_8c.html#ac663d21c565affc72b520a9581181897">spandsp_v21_new</a>(p)) {</div><div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;         <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Cannot initialize the spandsp private v21 technology structure.\n&quot;</span>);</div><div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;         <span class="keywordflow">goto</span> e_return;</div><div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;      }</div><div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;      s-&gt;<a class="code" href="../../d1/d16/structast__fax__session.html#ad8f346e1752edcc0b1a6b431b1749f0e">state</a> = <a class="code" href="../../db/d6a/res__fax_8h.html#ab34810136037068a0847bcca2518112ca59afc86be1c4be9a01c3cd178c4337b2">AST_FAX_STATE_ACTIVE</a>;</div><div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;      <span class="keywordflow">return</span> p;</div><div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;   }</div><div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;</div><div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;   <span class="keywordflow">if</span> (s-&gt;<a class="code" href="../../d1/d16/structast__fax__session.html#ae7b633178d301df70e8612b4ce1aeb77">details</a>-&gt;<a class="code" href="../../d8/dc2/structast__fax__session__details.html#ad75375cdd336e91cbcee4a829fcdabfe">caps</a> &amp; <a class="code" href="../../db/d6a/res__fax_8h.html#a54eb45ad548b874cf12d0a599631e3f6add135550dca7400fb80e250a63a54887">AST_FAX_TECH_GATEWAY</a>) {</div><div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;      s-&gt;<a class="code" href="../../d1/d16/structast__fax__session.html#ad8f346e1752edcc0b1a6b431b1749f0e">state</a> = <a class="code" href="../../db/d6a/res__fax_8h.html#ab34810136037068a0847bcca2518112ca11037f2ac950e3e5281b419aef13e3dc">AST_FAX_STATE_INITIALIZED</a>;</div><div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;      <span class="keywordflow">return</span> p;</div><div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;   }</div><div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;</div><div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;   <a class="code" href="../../df/d90/linkedlists_8h.html#a6f42d3bf45cc9af6f794d9d1cf8c45ca">AST_LIST_HEAD_INIT</a>(&amp;p-&gt;<a class="code" href="../../d2/d70/structspandsp__pvt.html#a2ae422e03f0063ccdd76b75bad9624ec">read_frames</a>);</div><div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;</div><div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;   <span class="keywordflow">if</span> (s-&gt;<a class="code" href="../../d1/d16/structast__fax__session.html#ae7b633178d301df70e8612b4ce1aeb77">details</a>-&gt;<a class="code" href="../../d8/dc2/structast__fax__session__details.html#ad75375cdd336e91cbcee4a829fcdabfe">caps</a> &amp; <a class="code" href="../../db/d6a/res__fax_8h.html#a54eb45ad548b874cf12d0a599631e3f6a77bcc28b15614142ddbf4a180d263602">AST_FAX_TECH_RECEIVE</a>) {</div><div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;      caller_mode = 0;</div><div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;   } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (s-&gt;<a class="code" href="../../d1/d16/structast__fax__session.html#ae7b633178d301df70e8612b4ce1aeb77">details</a>-&gt;<a class="code" href="../../d8/dc2/structast__fax__session__details.html#ad75375cdd336e91cbcee4a829fcdabfe">caps</a> &amp; <a class="code" href="../../db/d6a/res__fax_8h.html#a54eb45ad548b874cf12d0a599631e3f6adbf07d8224b1a548ccae3b994653003b">AST_FAX_TECH_SEND</a>) {</div><div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;      caller_mode = 1;</div><div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;   } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Are we sending or receiving? The FAX requirements (capabilities: 0x%X) were not properly set.\n&quot;</span>, s-&gt;<a class="code" href="../../d1/d16/structast__fax__session.html#ae7b633178d301df70e8612b4ce1aeb77">details</a>-&gt;<a class="code" href="../../d8/dc2/structast__fax__session__details.html#ad75375cdd336e91cbcee4a829fcdabfe">caps</a>);</div><div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;      <span class="keywordflow">goto</span> e_free;</div><div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;   }</div><div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;</div><div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;   <span class="keywordflow">if</span> (!(p-&gt;<a class="code" href="../../d2/d70/structspandsp__pvt.html#a9aed6490b63794e6c9c00af4533f255f">timer</a> = <a class="code" href="../../db/d41/timing_8h.html#aacc341f127efc0dc0d62f6415694174a">ast_timer_open</a>())) {</div><div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Channel &#39;%s&#39; FAX session &#39;%u&#39; failed to create timing source.\n&quot;</span>, s-&gt;<a class="code" href="../../d1/d16/structast__fax__session.html#a9f716886b5b2a50ad6d2b9119502b152">channame</a>, s-&gt;<a class="code" href="../../d1/d16/structast__fax__session.html#ab7ce6f462afaf105224b0ca772a33c43">id</a>);</div><div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;      <span class="keywordflow">goto</span> e_free;</div><div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;   }</div><div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;</div><div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;   s-&gt;<a class="code" href="../../d1/d16/structast__fax__session.html#a6f8059414f0228f0256115e024eeed4b">fd</a> = <a class="code" href="../../db/d41/timing_8h.html#aa3aa7580d76e1d3f7927b3f34764dec2">ast_timer_fd</a>(p-&gt;<a class="code" href="../../d2/d70/structspandsp__pvt.html#a9aed6490b63794e6c9c00af4533f255f">timer</a>);</div><div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;</div><div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;   p-&gt;<a class="code" href="../../d2/d70/structspandsp__pvt.html#a1b5003edd88843375153c462a72343f3">stats</a> = &amp;<a class="code" href="../../d5/d47/res__fax__spandsp_8c.html#a589319dce057e148f17f370ca3ba2a95">spandsp_global_stats</a>.g711;</div><div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;</div><div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;   <span class="keywordflow">if</span> (s-&gt;<a class="code" href="../../d1/d16/structast__fax__session.html#ae7b633178d301df70e8612b4ce1aeb77">details</a>-&gt;<a class="code" href="../../d8/dc2/structast__fax__session__details.html#ad75375cdd336e91cbcee4a829fcdabfe">caps</a> &amp; (<a class="code" href="../../db/d6a/res__fax_8h.html#a54eb45ad548b874cf12d0a599631e3f6a6868445e2802e5b71068ae883366f635">AST_FAX_TECH_T38</a> | <a class="code" href="../../db/d6a/res__fax_8h.html#a54eb45ad548b874cf12d0a599631e3f6a76fa4111df51955a949e95fadbccd48b">AST_FAX_TECH_AUDIO</a>)) {</div><div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;      <span class="keywordflow">if</span> ((s-&gt;<a class="code" href="../../d1/d16/structast__fax__session.html#ae7b633178d301df70e8612b4ce1aeb77">details</a>-&gt;<a class="code" href="../../d8/dc2/structast__fax__session__details.html#ad75375cdd336e91cbcee4a829fcdabfe">caps</a> &amp; <a class="code" href="../../db/d6a/res__fax_8h.html#a54eb45ad548b874cf12d0a599631e3f6a76fa4111df51955a949e95fadbccd48b">AST_FAX_TECH_AUDIO</a>) == 0) {</div><div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;         <span class="comment">/* audio mode was not requested, start in T.38 mode */</span></div><div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;         p-&gt;<a class="code" href="../../d2/d70/structspandsp__pvt.html#a9e04fe7f94b31b90af8617c4114973c6">ist38</a> = 1;</div><div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;         p-&gt;<a class="code" href="../../d2/d70/structspandsp__pvt.html#a1b5003edd88843375153c462a72343f3">stats</a> = &amp;<a class="code" href="../../d5/d47/res__fax__spandsp_8c.html#a589319dce057e148f17f370ca3ba2a95">spandsp_global_stats</a>.t38;</div><div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;      }</div><div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;</div><div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;      <span class="comment">/* init t38 stuff */</span></div><div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;      t38_terminal_init(&amp;p-&gt;<a class="code" href="../../d2/d70/structspandsp__pvt.html#aa32b12a7baab4b773f3aee19dc640fdb">t38_state</a>, caller_mode, <a class="code" href="../../d5/d47/res__fax__spandsp_8c.html#a24efd6f18c67b0deb9973607e23f2bac">t38_tx_packet_handler</a>, s);</div><div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;      <a class="code" href="../../d5/d47/res__fax__spandsp_8c.html#a7a848b476ce6571398d94f5eb74f3182">set_logging</a>(&amp;p-&gt;<a class="code" href="../../d2/d70/structspandsp__pvt.html#aa32b12a7baab4b773f3aee19dc640fdb">t38_state</a>.logging, s-&gt;<a class="code" href="../../d1/d16/structast__fax__session.html#ae7b633178d301df70e8612b4ce1aeb77">details</a>);</div><div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;</div><div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;      <span class="comment">/* init audio stuff */</span></div><div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;      fax_init(&amp;p-&gt;<a class="code" href="../../d2/d70/structspandsp__pvt.html#a6209294447011868d1a0ec7373bb90b5">fax_state</a>, caller_mode);</div><div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;      <a class="code" href="../../d5/d47/res__fax__spandsp_8c.html#a7a848b476ce6571398d94f5eb74f3182">set_logging</a>(&amp;p-&gt;<a class="code" href="../../d2/d70/structspandsp__pvt.html#a6209294447011868d1a0ec7373bb90b5">fax_state</a>.logging, s-&gt;<a class="code" href="../../d1/d16/structast__fax__session.html#ae7b633178d301df70e8612b4ce1aeb77">details</a>);</div><div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;   }</div><div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;</div><div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;   s-&gt;<a class="code" href="../../d1/d16/structast__fax__session.html#ad8f346e1752edcc0b1a6b431b1749f0e">state</a> = <a class="code" href="../../db/d6a/res__fax_8h.html#ab34810136037068a0847bcca2518112ca11037f2ac950e3e5281b419aef13e3dc">AST_FAX_STATE_INITIALIZED</a>;</div><div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;   <span class="keywordflow">return</span> p;</div><div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;</div><div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;e_free:</div><div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;   <a class="code" href="../../d8/d8a/astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(p);</div><div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;e_return:</div><div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;   <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;}</div><div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;</div><div class="line"><a name="l00594"></a><span class="lineno"><a class="line" href="../../d5/d47/res__fax__spandsp_8c.html#addd7277ae067b27b98632539c158c6bf">  594</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d5/d47/res__fax__spandsp_8c.html#addd7277ae067b27b98632539c158c6bf">spandsp_v21_cleanup</a>(<span class="keyword">struct</span> <a class="code" href="../../d1/d16/structast__fax__session.html">ast_fax_session</a> *s)</div><div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;{</div><div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d2/d70/structspandsp__pvt.html">spandsp_pvt</a> *p = s-&gt;<a class="code" href="../../d1/d16/structast__fax__session.html#a19aa04db5508cf9496602e694dc69e2f">tech_pvt</a>;</div><div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;</div><div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;   modem_connect_tones_rx_free(p-&gt;<a class="code" href="../../d2/d70/structspandsp__pvt.html#a7a6ac9a55317a92c59f3542dea61cdae">tone_state</a>);</div><div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;}</div><div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;<span class="comment">/*! \brief Destroy a spandsp fax session.</span></div><div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00603"></a><span class="lineno"><a class="line" href="../../d5/d47/res__fax__spandsp_8c.html#aff3bb506c68bf48a84a242b915c91758">  603</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d5/d47/res__fax__spandsp_8c.html#aff3bb506c68bf48a84a242b915c91758">spandsp_fax_destroy</a>(<span class="keyword">struct</span> <a class="code" href="../../d1/d16/structast__fax__session.html">ast_fax_session</a> *s)</div><div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;{</div><div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d2/d70/structspandsp__pvt.html">spandsp_pvt</a> *p = s-&gt;<a class="code" href="../../d1/d16/structast__fax__session.html#a19aa04db5508cf9496602e694dc69e2f">tech_pvt</a>;</div><div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;</div><div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;   <span class="keywordflow">if</span> (s-&gt;<a class="code" href="../../d1/d16/structast__fax__session.html#ae7b633178d301df70e8612b4ce1aeb77">details</a>-&gt;<a class="code" href="../../d8/dc2/structast__fax__session__details.html#ad75375cdd336e91cbcee4a829fcdabfe">caps</a> &amp; <a class="code" href="../../db/d6a/res__fax_8h.html#a54eb45ad548b874cf12d0a599631e3f6add135550dca7400fb80e250a63a54887">AST_FAX_TECH_GATEWAY</a>) {</div><div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;      <a class="code" href="../../d5/d47/res__fax__spandsp_8c.html#ad19e873d8a667de24f4cb593a05b45fb">spandsp_fax_gateway_cleanup</a>(s);</div><div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;   } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (s-&gt;<a class="code" href="../../d1/d16/structast__fax__session.html#ae7b633178d301df70e8612b4ce1aeb77">details</a>-&gt;<a class="code" href="../../d8/dc2/structast__fax__session__details.html#ad75375cdd336e91cbcee4a829fcdabfe">caps</a> &amp; <a class="code" href="../../db/d6a/res__fax_8h.html#a54eb45ad548b874cf12d0a599631e3f6a9138c48a79016bfccdd7cee6197cb21c">AST_FAX_TECH_V21_DETECT</a>) {</div><div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;      <a class="code" href="../../d5/d47/res__fax__spandsp_8c.html#addd7277ae067b27b98632539c158c6bf">spandsp_v21_cleanup</a>(s);</div><div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;   } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;      <a class="code" href="../../d5/d47/res__fax__spandsp_8c.html#a26dae05b6eb59eb758e6bf0f55b6e396">session_destroy</a>(p);</div><div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160;   }</div><div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;</div><div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;   <a class="code" href="../../d8/d8a/astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(p);</div><div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;   s-&gt;<a class="code" href="../../d1/d16/structast__fax__session.html#a19aa04db5508cf9496602e694dc69e2f">tech_pvt</a> = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160;   s-&gt;<a class="code" href="../../d1/d16/structast__fax__session.html#a6f8059414f0228f0256115e024eeed4b">fd</a> = -1;</div><div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160;}</div><div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160;<span class="comment">/*! \brief Read a frame from the spandsp fax stack.</span></div><div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00622"></a><span class="lineno"><a class="line" href="../../d5/d47/res__fax__spandsp_8c.html#a7b40a2b701ed0e7b0486409c8e3bc03f">  622</a></span>&#160;<span class="keyword">static</span> <span class="keyword">struct </span><a class="code" href="../../d0/d99/structast__frame.html">ast_frame</a> *<a class="code" href="../../d5/d47/res__fax__spandsp_8c.html#a7b40a2b701ed0e7b0486409c8e3bc03f">spandsp_fax_read</a>(<span class="keyword">struct</span> <a class="code" href="../../d1/d16/structast__fax__session.html">ast_fax_session</a> *s)</div><div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;{</div><div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d2/d70/structspandsp__pvt.html">spandsp_pvt</a> *p = s-&gt;<a class="code" href="../../d1/d16/structast__fax__session.html#a19aa04db5508cf9496602e694dc69e2f">tech_pvt</a>;</div><div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160;   uint8_t buffer[<a class="code" href="../../d6/d66/include_2asterisk_2frame_8h.html#ac8f7380b8620c80443286b44481f641c">AST_FRIENDLY_OFFSET</a> + <a class="code" href="../../d5/d47/res__fax__spandsp_8c.html#a26afae7dd9d256776976330e21298e68">SPANDSP_FAX_SAMPLES</a> * <span class="keyword">sizeof</span>(uint16_t)];</div><div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160;   <a class="code" href="../../da/d4e/db_8h.html#aa343fa3b3d06292b959ffdd4c4703b06">int16_t</a> *<a class="code" href="../../dd/d7c/eagi__proxy_8c.html#ac95651d79c608a3148973b5b1fc9e525">buf</a> = (<a class="code" href="../../da/d4e/db_8h.html#aa343fa3b3d06292b959ffdd4c4703b06">int16_t</a> *) (buffer + <a class="code" href="../../d6/d66/include_2asterisk_2frame_8h.html#ac8f7380b8620c80443286b44481f641c">AST_FRIENDLY_OFFSET</a>);</div><div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160;   <span class="keywordtype">int</span> samples;</div><div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;</div><div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d0/d99/structast__frame.html">ast_frame</a> fax_frame = {</div><div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;      .<a class="code" href="../../d0/d99/structast__frame.html#a6937b93c56cb473b547eda454dca7b4c">frametype</a> = <a class="code" href="../../d6/d66/include_2asterisk_2frame_8h.html#ae2e1a9c4e048da387b761f619312d6e0aa457fe7005f11bb7b21453f9bb4caa8f">AST_FRAME_VOICE</a>,</div><div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160;      .src = <span class="stringliteral">&quot;res_fax_spandsp_g711&quot;</span>,</div><div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160;      .subclass.format = <a class="code" href="../../db/d1c/format__cache_8h.html#a771d7c34570e8e492c25a0c2eb41889d">ast_format_slin</a>,</div><div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160;   };</div><div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d0/d99/structast__frame.html">ast_frame</a> *f = &amp;fax_frame;</div><div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160;</div><div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../db/d41/timing_8h.html#a338edb7e927b891ef4aba288d9c07e56">ast_timer_ack</a>(p-&gt;<a class="code" href="../../d2/d70/structspandsp__pvt.html#a9aed6490b63794e6c9c00af4533f255f">timer</a>, 1) &lt; 0) {</div><div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Failed to acknowledge timer for FAX session &#39;%u&#39;\n&quot;</span>, s-&gt;<a class="code" href="../../d1/d16/structast__fax__session.html#ab7ce6f462afaf105224b0ca772a33c43">id</a>);</div><div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160;   }</div><div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160;</div><div class="line"><a name="l00641"></a><span class="lineno">  641</span>&#160;   <span class="comment">/* XXX do we need to lock here? */</span></div><div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160;   <span class="keywordflow">if</span> (p-&gt;<a class="code" href="../../d2/d70/structspandsp__pvt.html#af2bd73f7c4fe9e40a5d5cb75dcbca598">isdone</a>) {</div><div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160;      s-&gt;<a class="code" href="../../d1/d16/structast__fax__session.html#ad8f346e1752edcc0b1a6b431b1749f0e">state</a> = <a class="code" href="../../db/d6a/res__fax_8h.html#ab34810136037068a0847bcca2518112ca89690cf17e4dd810bc40e657ac1d6213">AST_FAX_STATE_COMPLETE</a>;</div><div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160;      <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(5, <span class="stringliteral">&quot;FAX session &#39;%u&#39; is complete.\n&quot;</span>, s-&gt;<a class="code" href="../../d1/d16/structast__fax__session.html#ab7ce6f462afaf105224b0ca772a33c43">id</a>);</div><div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l00646"></a><span class="lineno">  646</span>&#160;   }</div><div class="line"><a name="l00647"></a><span class="lineno">  647</span>&#160;</div><div class="line"><a name="l00648"></a><span class="lineno">  648</span>&#160;   <span class="keywordflow">if</span> (p-&gt;<a class="code" href="../../d2/d70/structspandsp__pvt.html#a9e04fe7f94b31b90af8617c4114973c6">ist38</a>) {</div><div class="line"><a name="l00649"></a><span class="lineno">  649</span>&#160;      t38_terminal_send_timeout(&amp;p-&gt;<a class="code" href="../../d2/d70/structspandsp__pvt.html#aa32b12a7baab4b773f3aee19dc640fdb">t38_state</a>, <a class="code" href="../../d5/d47/res__fax__spandsp_8c.html#a26afae7dd9d256776976330e21298e68">SPANDSP_FAX_SAMPLES</a>);</div><div class="line"><a name="l00650"></a><span class="lineno">  650</span>&#160;      <span class="keywordflow">if</span> ((f = <a class="code" href="../../df/d90/linkedlists_8h.html#aadfe2a69fbba4f27c201266a2ca5f989">AST_LIST_REMOVE_HEAD</a>(&amp;p-&gt;<a class="code" href="../../d2/d70/structspandsp__pvt.html#a2ae422e03f0063ccdd76b75bad9624ec">read_frames</a>, <a class="code" href="../../d9/d42/structframe__list.html">frame_list</a>))) {</div><div class="line"><a name="l00651"></a><span class="lineno">  651</span>&#160;         <span class="keywordflow">return</span> f;</div><div class="line"><a name="l00652"></a><span class="lineno">  652</span>&#160;      }</div><div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160;   } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00654"></a><span class="lineno">  654</span>&#160;      <span class="keywordflow">if</span> ((samples = fax_tx(&amp;p-&gt;<a class="code" href="../../d2/d70/structspandsp__pvt.html#a6209294447011868d1a0ec7373bb90b5">fax_state</a>, buf, <a class="code" href="../../d5/d47/res__fax__spandsp_8c.html#a26afae7dd9d256776976330e21298e68">SPANDSP_FAX_SAMPLES</a>)) &gt; 0) {</div><div class="line"><a name="l00655"></a><span class="lineno">  655</span>&#160;         f-&gt;<a class="code" href="../../d0/d99/structast__frame.html#a37672e6b906143604cefd3e959777b31">samples</a> = <a class="code" href="../../d0/d99/structast__frame.html#a37672e6b906143604cefd3e959777b31">samples</a>;</div><div class="line"><a name="l00656"></a><span class="lineno">  656</span>&#160;         <a class="code" href="../../d6/d66/include_2asterisk_2frame_8h.html#ac8bc210573f6b9c55ef38662bddc4675">AST_FRAME_SET_BUFFER</a>(f, buffer, <a class="code" href="../../d6/d66/include_2asterisk_2frame_8h.html#ac8f7380b8620c80443286b44481f641c">AST_FRIENDLY_OFFSET</a>, samples * <span class="keyword">sizeof</span>(<a class="code" href="../../da/d4e/db_8h.html#aa343fa3b3d06292b959ffdd4c4703b06">int16_t</a>));</div><div class="line"><a name="l00657"></a><span class="lineno">  657</span>&#160;         <span class="keywordflow">return</span> <a class="code" href="../../d6/d66/include_2asterisk_2frame_8h.html#a314496ce1d74ed7fdb9c5319c5e2e953">ast_frisolate</a>(f);</div><div class="line"><a name="l00658"></a><span class="lineno">  658</span>&#160;      }</div><div class="line"><a name="l00659"></a><span class="lineno">  659</span>&#160;   }</div><div class="line"><a name="l00660"></a><span class="lineno">  660</span>&#160;</div><div class="line"><a name="l00661"></a><span class="lineno">  661</span>&#160;   <span class="keywordflow">return</span> &amp;<a class="code" href="../../d6/d66/include_2asterisk_2frame_8h.html#af203379aca2fd704fe8d86a9445596b6">ast_null_frame</a>;</div><div class="line"><a name="l00662"></a><span class="lineno">  662</span>&#160;}</div><div class="line"><a name="l00663"></a><span class="lineno">  663</span>&#160;</div><div class="line"><a name="l00664"></a><span class="lineno"><a class="line" href="../../d5/d47/res__fax__spandsp_8c.html#a42d6e20cfd39f4a22d9ea31270f45ebf">  664</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d5/d47/res__fax__spandsp_8c.html#a42d6e20cfd39f4a22d9ea31270f45ebf">spandsp_v21_tone</a>(<span class="keywordtype">void</span> *<a class="code" href="../../d0/d99/structast__frame.html#a4027905f872af30d910929b07e261ca5">data</a>, <span class="keywordtype">int</span> code, <span class="keywordtype">int</span> level, <span class="keywordtype">int</span> delay)</div><div class="line"><a name="l00665"></a><span class="lineno">  665</span>&#160;{</div><div class="line"><a name="l00666"></a><span class="lineno">  666</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d2/d70/structspandsp__pvt.html">spandsp_pvt</a> *p = data;</div><div class="line"><a name="l00667"></a><span class="lineno">  667</span>&#160;</div><div class="line"><a name="l00668"></a><span class="lineno">  668</span>&#160;   <span class="keywordflow">if</span> (code == MODEM_CONNECT_TONES_FAX_PREAMBLE) {</div><div class="line"><a name="l00669"></a><span class="lineno">  669</span>&#160;      p-&gt;<a class="code" href="../../d2/d70/structspandsp__pvt.html#aef5d68740b9dc01c4950275c22ae81f4">v21_detected</a> = 1;</div><div class="line"><a name="l00670"></a><span class="lineno">  670</span>&#160;   }</div><div class="line"><a name="l00671"></a><span class="lineno">  671</span>&#160;}</div><div class="line"><a name="l00672"></a><span class="lineno">  672</span>&#160;</div><div class="line"><a name="l00673"></a><span class="lineno"><a class="line" href="../../d5/d47/res__fax__spandsp_8c.html#adaa7af133c27e45f416759d9552f0775">  673</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d5/d47/res__fax__spandsp_8c.html#adaa7af133c27e45f416759d9552f0775">spandsp_v21_detect</a>(<span class="keyword">struct</span> <a class="code" href="../../d1/d16/structast__fax__session.html">ast_fax_session</a> *s, <span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="../../d0/d99/structast__frame.html">ast_frame</a> *f)</div><div class="line"><a name="l00674"></a><span class="lineno">  674</span>&#160;{</div><div class="line"><a name="l00675"></a><span class="lineno">  675</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d2/d70/structspandsp__pvt.html">spandsp_pvt</a> *p = s-&gt;<a class="code" href="../../d1/d16/structast__fax__session.html#a19aa04db5508cf9496602e694dc69e2f">tech_pvt</a>;</div><div class="line"><a name="l00676"></a><span class="lineno">  676</span>&#160;   <a class="code" href="../../da/d4e/db_8h.html#aa343fa3b3d06292b959ffdd4c4703b06">int16_t</a> *slndata;</div><div class="line"><a name="l00677"></a><span class="lineno">  677</span>&#160;   g711_state_t *decoder;</div><div class="line"><a name="l00678"></a><span class="lineno">  678</span>&#160;</div><div class="line"><a name="l00679"></a><span class="lineno">  679</span>&#160;   <span class="keywordflow">if</span> (p-&gt;<a class="code" href="../../d2/d70/structspandsp__pvt.html#aef5d68740b9dc01c4950275c22ae81f4">v21_detected</a>) {</div><div class="line"><a name="l00680"></a><span class="lineno">  680</span>&#160;      <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00681"></a><span class="lineno">  681</span>&#160;   }</div><div class="line"><a name="l00682"></a><span class="lineno">  682</span>&#160;</div><div class="line"><a name="l00683"></a><span class="lineno">  683</span>&#160;   <span class="comment">/*invalid frame*/</span></div><div class="line"><a name="l00684"></a><span class="lineno">  684</span>&#160;   <span class="keywordflow">if</span> (!f-&gt;<a class="code" href="../../d0/d99/structast__frame.html#a4027905f872af30d910929b07e261ca5">data</a>.<a class="code" href="../../d0/d99/structast__frame.html#add9af9569af79ec26dd741fb226b38ba">ptr</a> || !f-&gt;<a class="code" href="../../d0/d99/structast__frame.html#ad67e07841d1233e596e6f822a3c81f6b">datalen</a>) {</div><div class="line"><a name="l00685"></a><span class="lineno">  685</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l00686"></a><span class="lineno">  686</span>&#160;   }</div><div class="line"><a name="l00687"></a><span class="lineno">  687</span>&#160;</div><div class="line"><a name="l00688"></a><span class="lineno">  688</span>&#160;   <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(5, <span class="stringliteral">&quot;frame={ datalen=%d, samples=%d, mallocd=%d, src=%s, flags=%u, ts=%ld, len=%ld, seqno=%d, data.ptr=%p, subclass.format=%s  }\n&quot;</span>, f-&gt;<a class="code" href="../../d0/d99/structast__frame.html#ad67e07841d1233e596e6f822a3c81f6b">datalen</a>, f-&gt;<a class="code" href="../../d0/d99/structast__frame.html#a37672e6b906143604cefd3e959777b31">samples</a>, f-&gt;<a class="code" href="../../d0/d99/structast__frame.html#aed16590d48f41d89f31e0cf347f5cd99">mallocd</a>, f-&gt;<a class="code" href="../../d0/d99/structast__frame.html#af51e37c9331049b1e3d250a7c8bc3c26">src</a>, f-&gt;<a class="code" href="../../d0/d99/structast__frame.html#ac92588540e8c1d014a08cd8a45462b19">flags</a>, f-&gt;<a class="code" href="../../d0/d99/structast__frame.html#a1eb46dcb363821328c0d2a758549216b">ts</a>, f-&gt;<a class="code" href="../../d0/d99/structast__frame.html#aaccba9d5adc3f6c39aad767db95ba484">len</a>, f-&gt;<a class="code" href="../../d0/d99/structast__frame.html#ab793262012344621455faf9266acbac2">seqno</a>, f-&gt;<a class="code" href="../../d0/d99/structast__frame.html#a4027905f872af30d910929b07e261ca5">data</a>.<a class="code" href="../../d0/d99/structast__frame.html#add9af9569af79ec26dd741fb226b38ba">ptr</a>, <a class="code" href="../../d0/d0a/format_8h.html#a082f0fca94b18ba466f6e28d3ccb2fc8">ast_format_get_name</a>(f-&gt;<a class="code" href="../../d0/d99/structast__frame.html#a27237c48fdcd22556401f20c693811db">subclass</a>.<a class="code" href="../../d1/d9f/structast__frame__subclass.html#ab425a484a0916077c5a30d9d7b229b44">format</a>));</div><div class="line"><a name="l00689"></a><span class="lineno">  689</span>&#160;</div><div class="line"><a name="l00690"></a><span class="lineno">  690</span>&#160;   <span class="comment">/* slinear frame can be passed to spandsp */</span></div><div class="line"><a name="l00691"></a><span class="lineno">  691</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0a/format_8h.html#a738c58eca291b71de4422e95bff27400">ast_format_cmp</a>(f-&gt;<a class="code" href="../../d0/d99/structast__frame.html#a27237c48fdcd22556401f20c693811db">subclass</a>.<a class="code" href="../../d1/d9f/structast__frame__subclass.html#ab425a484a0916077c5a30d9d7b229b44">format</a>, <a class="code" href="../../db/d1c/format__cache_8h.html#a771d7c34570e8e492c25a0c2eb41889d">ast_format_slin</a>) == <a class="code" href="../../d0/d0a/format_8h.html#a79bdf0b3c0616d9950d00cfeb62295c3ab1e8c1a0f8b4a1ecb6a2109992636859">AST_FORMAT_CMP_EQUAL</a>) {</div><div class="line"><a name="l00692"></a><span class="lineno">  692</span>&#160;      modem_connect_tones_rx(p-&gt;<a class="code" href="../../d2/d70/structspandsp__pvt.html#a7a6ac9a55317a92c59f3542dea61cdae">tone_state</a>, f-&gt;<a class="code" href="../../d0/d99/structast__frame.html#a4027905f872af30d910929b07e261ca5">data</a>.<a class="code" href="../../d0/d99/structast__frame.html#add9af9569af79ec26dd741fb226b38ba">ptr</a>, f-&gt;<a class="code" href="../../d0/d99/structast__frame.html#a37672e6b906143604cefd3e959777b31">samples</a>);</div><div class="line"><a name="l00693"></a><span class="lineno">  693</span>&#160;</div><div class="line"><a name="l00694"></a><span class="lineno">  694</span>&#160;   <span class="comment">/* alaw/ulaw frame must be converted to slinear before passing to spandsp */</span></div><div class="line"><a name="l00695"></a><span class="lineno">  695</span>&#160;   } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="../../d0/d0a/format_8h.html#a738c58eca291b71de4422e95bff27400">ast_format_cmp</a>(f-&gt;<a class="code" href="../../d0/d99/structast__frame.html#a27237c48fdcd22556401f20c693811db">subclass</a>.<a class="code" href="../../d1/d9f/structast__frame__subclass.html#ab425a484a0916077c5a30d9d7b229b44">format</a>, <a class="code" href="../../db/d1c/format__cache_8h.html#a95c058fe6adef68780f026d6aec2481c">ast_format_alaw</a>) == <a class="code" href="../../d0/d0a/format_8h.html#a79bdf0b3c0616d9950d00cfeb62295c3ab1e8c1a0f8b4a1ecb6a2109992636859">AST_FORMAT_CMP_EQUAL</a> ||</div><div class="line"><a name="l00696"></a><span class="lineno">  696</span>&#160;              <a class="code" href="../../d0/d0a/format_8h.html#a738c58eca291b71de4422e95bff27400">ast_format_cmp</a>(f-&gt;<a class="code" href="../../d0/d99/structast__frame.html#a27237c48fdcd22556401f20c693811db">subclass</a>.<a class="code" href="../../d1/d9f/structast__frame__subclass.html#ab425a484a0916077c5a30d9d7b229b44">format</a>, <a class="code" href="../../db/d1c/format__cache_8h.html#a568c3f5838b53c38f11996dbe5ff5785">ast_format_ulaw</a>) == <a class="code" href="../../d0/d0a/format_8h.html#a79bdf0b3c0616d9950d00cfeb62295c3ab1e8c1a0f8b4a1ecb6a2109992636859">AST_FORMAT_CMP_EQUAL</a>) {</div><div class="line"><a name="l00697"></a><span class="lineno">  697</span>&#160;      <span class="keywordflow">if</span> (!(slndata = <a class="code" href="../../d8/d8a/astmm_8h.html#ae63d4f486bcf6eac7c1593f867717d91">ast_malloc</a>(<span class="keyword">sizeof</span>(*slndata) * f-&gt;<a class="code" href="../../d0/d99/structast__frame.html#a37672e6b906143604cefd3e959777b31">samples</a>))) {</div><div class="line"><a name="l00698"></a><span class="lineno">  698</span>&#160;         <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l00699"></a><span class="lineno">  699</span>&#160;      }</div><div class="line"><a name="l00700"></a><span class="lineno">  700</span>&#160;      decoder = g711_init(<a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, (<a class="code" href="../../d0/d0a/format_8h.html#a738c58eca291b71de4422e95bff27400">ast_format_cmp</a>(f-&gt;<a class="code" href="../../d0/d99/structast__frame.html#a27237c48fdcd22556401f20c693811db">subclass</a>.<a class="code" href="../../d1/d9f/structast__frame__subclass.html#ab425a484a0916077c5a30d9d7b229b44">format</a>, <a class="code" href="../../db/d1c/format__cache_8h.html#a95c058fe6adef68780f026d6aec2481c">ast_format_alaw</a>) == <a class="code" href="../../d0/d0a/format_8h.html#a79bdf0b3c0616d9950d00cfeb62295c3ab1e8c1a0f8b4a1ecb6a2109992636859">AST_FORMAT_CMP_EQUAL</a> ? G711_ALAW : G711_ULAW));</div><div class="line"><a name="l00701"></a><span class="lineno">  701</span>&#160;      g711_decode(decoder, slndata, f-&gt;<a class="code" href="../../d0/d99/structast__frame.html#a4027905f872af30d910929b07e261ca5">data</a>.<a class="code" href="../../d0/d99/structast__frame.html#add9af9569af79ec26dd741fb226b38ba">ptr</a>, f-&gt;<a class="code" href="../../d0/d99/structast__frame.html#a37672e6b906143604cefd3e959777b31">samples</a>);</div><div class="line"><a name="l00702"></a><span class="lineno">  702</span>&#160;      <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(5, <span class="stringliteral">&quot;spandsp transcoding frame from %s to slinear for v21 detection\n&quot;</span>, <a class="code" href="../../d0/d0a/format_8h.html#a082f0fca94b18ba466f6e28d3ccb2fc8">ast_format_get_name</a>(f-&gt;<a class="code" href="../../d0/d99/structast__frame.html#a27237c48fdcd22556401f20c693811db">subclass</a>.<a class="code" href="../../d1/d9f/structast__frame__subclass.html#ab425a484a0916077c5a30d9d7b229b44">format</a>));</div><div class="line"><a name="l00703"></a><span class="lineno">  703</span>&#160;      modem_connect_tones_rx(p-&gt;<a class="code" href="../../d2/d70/structspandsp__pvt.html#a7a6ac9a55317a92c59f3542dea61cdae">tone_state</a>, slndata, f-&gt;<a class="code" href="../../d0/d99/structast__frame.html#a37672e6b906143604cefd3e959777b31">samples</a>);</div><div class="line"><a name="l00704"></a><span class="lineno">  704</span>&#160;      g711_release(decoder);</div><div class="line"><a name="l00705"></a><span class="lineno">  705</span>&#160;<span class="preprocessor">#if SPANDSP_RELEASE_DATE &gt;= 20090220</span></div><div class="line"><a name="l00706"></a><span class="lineno">  706</span>&#160;      g711_free(decoder);</div><div class="line"><a name="l00707"></a><span class="lineno">  707</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00708"></a><span class="lineno">  708</span>&#160;      <a class="code" href="../../d8/d8a/astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(slndata);</div><div class="line"><a name="l00709"></a><span class="lineno">  709</span>&#160;</div><div class="line"><a name="l00710"></a><span class="lineno">  710</span>&#160;   <span class="comment">/* frame in other formats cannot be passed to spandsp, it could cause segfault */</span></div><div class="line"><a name="l00711"></a><span class="lineno">  711</span>&#160;   } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00712"></a><span class="lineno">  712</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Frame format %s not supported, v.21 detection skipped\n&quot;</span>, <a class="code" href="../../d0/d0a/format_8h.html#a082f0fca94b18ba466f6e28d3ccb2fc8">ast_format_get_name</a>(f-&gt;<a class="code" href="../../d0/d99/structast__frame.html#a27237c48fdcd22556401f20c693811db">subclass</a>.<a class="code" href="../../d1/d9f/structast__frame__subclass.html#ab425a484a0916077c5a30d9d7b229b44">format</a>));</div><div class="line"><a name="l00713"></a><span class="lineno">  713</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l00714"></a><span class="lineno">  714</span>&#160;   }</div><div class="line"><a name="l00715"></a><span class="lineno">  715</span>&#160;</div><div class="line"><a name="l00716"></a><span class="lineno">  716</span>&#160;   <span class="keywordflow">if</span> (p-&gt;<a class="code" href="../../d2/d70/structspandsp__pvt.html#aef5d68740b9dc01c4950275c22ae81f4">v21_detected</a>) {</div><div class="line"><a name="l00717"></a><span class="lineno">  717</span>&#160;      s-&gt;<a class="code" href="../../d1/d16/structast__fax__session.html#ae7b633178d301df70e8612b4ce1aeb77">details</a>-&gt;<a class="code" href="../../d8/dc2/structast__fax__session__details.html#a3ab211dbe8780b7292257f6b3dba1952">option</a>.<a class="code" href="../../d8/dc2/structast__fax__session__details.html#aed36280452b10bbcf7cb35873db02762">v21_detected</a> = 1;</div><div class="line"><a name="l00718"></a><span class="lineno">  718</span>&#160;      <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(5, <span class="stringliteral">&quot;v.21 detected\n&quot;</span>);</div><div class="line"><a name="l00719"></a><span class="lineno">  719</span>&#160;   }</div><div class="line"><a name="l00720"></a><span class="lineno">  720</span>&#160;</div><div class="line"><a name="l00721"></a><span class="lineno">  721</span>&#160;   <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00722"></a><span class="lineno">  722</span>&#160;}</div><div class="line"><a name="l00723"></a><span class="lineno">  723</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00724"></a><span class="lineno">  724</span>&#160;<span class="comment">/*! \brief Write a frame to the spandsp fax stack.</span></div><div class="line"><a name="l00725"></a><span class="lineno">  725</span>&#160;<span class="comment"> * \param s a fax session</span></div><div class="line"><a name="l00726"></a><span class="lineno">  726</span>&#160;<span class="comment"> * \param f the frame to write</span></div><div class="line"><a name="l00727"></a><span class="lineno">  727</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00728"></a><span class="lineno">  728</span>&#160;<span class="comment"> * \note res_fax does not currently use the return value of this function.</span></div><div class="line"><a name="l00729"></a><span class="lineno">  729</span>&#160;<span class="comment"> * Also the fax_rx() function never fails.</span></div><div class="line"><a name="l00730"></a><span class="lineno">  730</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00731"></a><span class="lineno">  731</span>&#160;<span class="comment"> * \retval 0 success</span></div><div class="line"><a name="l00732"></a><span class="lineno">  732</span>&#160;<span class="comment"> * \retval -1 failure</span></div><div class="line"><a name="l00733"></a><span class="lineno">  733</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00734"></a><span class="lineno"><a class="line" href="../../d5/d47/res__fax__spandsp_8c.html#aed0bd5d9c0943587312263618faaf6c3">  734</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d5/d47/res__fax__spandsp_8c.html#aed0bd5d9c0943587312263618faaf6c3">spandsp_fax_write</a>(<span class="keyword">struct</span> <a class="code" href="../../d1/d16/structast__fax__session.html">ast_fax_session</a> *s, <span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="../../d0/d99/structast__frame.html">ast_frame</a> *f)</div><div class="line"><a name="l00735"></a><span class="lineno">  735</span>&#160;{</div><div class="line"><a name="l00736"></a><span class="lineno">  736</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d2/d70/structspandsp__pvt.html">spandsp_pvt</a> *p = s-&gt;<a class="code" href="../../d1/d16/structast__fax__session.html#a19aa04db5508cf9496602e694dc69e2f">tech_pvt</a>;</div><div class="line"><a name="l00737"></a><span class="lineno">  737</span>&#160;</div><div class="line"><a name="l00738"></a><span class="lineno">  738</span>&#160;   <span class="keywordflow">if</span> (s-&gt;<a class="code" href="../../d1/d16/structast__fax__session.html#ae7b633178d301df70e8612b4ce1aeb77">details</a>-&gt;<a class="code" href="../../d8/dc2/structast__fax__session__details.html#ad75375cdd336e91cbcee4a829fcdabfe">caps</a> &amp; <a class="code" href="../../db/d6a/res__fax_8h.html#a54eb45ad548b874cf12d0a599631e3f6a9138c48a79016bfccdd7cee6197cb21c">AST_FAX_TECH_V21_DETECT</a>) {</div><div class="line"><a name="l00739"></a><span class="lineno">  739</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../d5/d47/res__fax__spandsp_8c.html#adaa7af133c27e45f416759d9552f0775">spandsp_v21_detect</a>(s, f);</div><div class="line"><a name="l00740"></a><span class="lineno">  740</span>&#160;   }</div><div class="line"><a name="l00741"></a><span class="lineno">  741</span>&#160;</div><div class="line"><a name="l00742"></a><span class="lineno">  742</span>&#160;   <span class="keywordflow">if</span> (s-&gt;<a class="code" href="../../d1/d16/structast__fax__session.html#ae7b633178d301df70e8612b4ce1aeb77">details</a>-&gt;<a class="code" href="../../d8/dc2/structast__fax__session__details.html#ad75375cdd336e91cbcee4a829fcdabfe">caps</a> &amp; <a class="code" href="../../db/d6a/res__fax_8h.html#a54eb45ad548b874cf12d0a599631e3f6add135550dca7400fb80e250a63a54887">AST_FAX_TECH_GATEWAY</a>) {</div><div class="line"><a name="l00743"></a><span class="lineno">  743</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../d5/d47/res__fax__spandsp_8c.html#a8162670509872b734477d174e39a073e">spandsp_fax_gateway_process</a>(s, f);</div><div class="line"><a name="l00744"></a><span class="lineno">  744</span>&#160;   }</div><div class="line"><a name="l00745"></a><span class="lineno">  745</span>&#160;</div><div class="line"><a name="l00746"></a><span class="lineno">  746</span>&#160;   <span class="comment">/* XXX do we need to lock here? */</span></div><div class="line"><a name="l00747"></a><span class="lineno">  747</span>&#160;   <span class="keywordflow">if</span> (s-&gt;<a class="code" href="../../d1/d16/structast__fax__session.html#ad8f346e1752edcc0b1a6b431b1749f0e">state</a> == <a class="code" href="../../db/d6a/res__fax_8h.html#ab34810136037068a0847bcca2518112ca89690cf17e4dd810bc40e657ac1d6213">AST_FAX_STATE_COMPLETE</a>) {</div><div class="line"><a name="l00748"></a><span class="lineno">  748</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;FAX session &#39;%u&#39; is in the &#39;%s&#39; state.\n&quot;</span>, s-&gt;<a class="code" href="../../d1/d16/structast__fax__session.html#ab7ce6f462afaf105224b0ca772a33c43">id</a>, <a class="code" href="../../db/d6a/res__fax_8h.html#a70598462f8d1c09bb43e7a7091498e53">ast_fax_state_to_str</a>(s-&gt;<a class="code" href="../../d1/d16/structast__fax__session.html#ad8f346e1752edcc0b1a6b431b1749f0e">state</a>));</div><div class="line"><a name="l00749"></a><span class="lineno">  749</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l00750"></a><span class="lineno">  750</span>&#160;   }</div><div class="line"><a name="l00751"></a><span class="lineno">  751</span>&#160;</div><div class="line"><a name="l00752"></a><span class="lineno">  752</span>&#160;   <span class="keywordflow">if</span> (p-&gt;<a class="code" href="../../d2/d70/structspandsp__pvt.html#a9e04fe7f94b31b90af8617c4114973c6">ist38</a>) {</div><div class="line"><a name="l00753"></a><span class="lineno">  753</span>&#160;      <span class="keywordflow">return</span> t38_core_rx_ifp_packet(p-&gt;<a class="code" href="../../d2/d70/structspandsp__pvt.html#a2771e36a55ef2406a468f480426f3f90">t38_core_state</a>, f-&gt;<a class="code" href="../../d0/d99/structast__frame.html#a4027905f872af30d910929b07e261ca5">data</a>.<a class="code" href="../../d0/d99/structast__frame.html#add9af9569af79ec26dd741fb226b38ba">ptr</a>, f-&gt;<a class="code" href="../../d0/d99/structast__frame.html#ad67e07841d1233e596e6f822a3c81f6b">datalen</a>, f-&gt;<a class="code" href="../../d0/d99/structast__frame.html#ab793262012344621455faf9266acbac2">seqno</a>);</div><div class="line"><a name="l00754"></a><span class="lineno">  754</span>&#160;   } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00755"></a><span class="lineno">  755</span>&#160;      <span class="keywordflow">return</span> fax_rx(&amp;p-&gt;<a class="code" href="../../d2/d70/structspandsp__pvt.html#a6209294447011868d1a0ec7373bb90b5">fax_state</a>, f-&gt;<a class="code" href="../../d0/d99/structast__frame.html#a4027905f872af30d910929b07e261ca5">data</a>.<a class="code" href="../../d0/d99/structast__frame.html#add9af9569af79ec26dd741fb226b38ba">ptr</a>, f-&gt;<a class="code" href="../../d0/d99/structast__frame.html#a37672e6b906143604cefd3e959777b31">samples</a>);</div><div class="line"><a name="l00756"></a><span class="lineno">  756</span>&#160;   }</div><div class="line"><a name="l00757"></a><span class="lineno">  757</span>&#160;}</div><div class="line"><a name="l00758"></a><span class="lineno">  758</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00759"></a><span class="lineno">  759</span>&#160;<span class="comment">/*! \brief generate T.30 packets sent to the T.30 leg of gateway</span></div><div class="line"><a name="l00760"></a><span class="lineno">  760</span>&#160;<span class="comment"> * \param chan T.30 channel</span></div><div class="line"><a name="l00761"></a><span class="lineno">  761</span>&#160;<span class="comment"> * \param data fax session structure</span></div><div class="line"><a name="l00762"></a><span class="lineno">  762</span>&#160;<span class="comment"> * \param len not used</span></div><div class="line"><a name="l00763"></a><span class="lineno">  763</span>&#160;<span class="comment"> * \param samples no of samples generated</span></div><div class="line"><a name="l00764"></a><span class="lineno">  764</span>&#160;<span class="comment"> * \return -1 on failure or 0 on sucess*/</span></div><div class="line"><a name="l00765"></a><span class="lineno"><a class="line" href="../../d5/d47/res__fax__spandsp_8c.html#afe4b8983331a6ebf8b794f6cdb318b2f">  765</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d5/d47/res__fax__spandsp_8c.html#afe4b8983331a6ebf8b794f6cdb318b2f">spandsp_fax_gw_t30_gen</a>(<span class="keyword">struct</span> <a class="code" href="../../df/d3c/structast__channel.html">ast_channel</a> *chan, <span class="keywordtype">void</span> *data, <span class="keywordtype">int</span> <a class="code" href="../../d9/d1e/func__strings_8c.html#af24e73aaf92f3000fda15d285e66df24">len</a>, <span class="keywordtype">int</span> samples)</div><div class="line"><a name="l00766"></a><span class="lineno">  766</span>&#160;{</div><div class="line"><a name="l00767"></a><span class="lineno">  767</span>&#160;   <span class="keywordtype">int</span> res = -1;</div><div class="line"><a name="l00768"></a><span class="lineno">  768</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d1/d16/structast__fax__session.html">ast_fax_session</a> *s = data;</div><div class="line"><a name="l00769"></a><span class="lineno">  769</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d2/d70/structspandsp__pvt.html">spandsp_pvt</a> *p = s-&gt;<a class="code" href="../../d1/d16/structast__fax__session.html#a19aa04db5508cf9496602e694dc69e2f">tech_pvt</a>;</div><div class="line"><a name="l00770"></a><span class="lineno">  770</span>&#160;   uint8_t buffer[<a class="code" href="../../d6/d66/include_2asterisk_2frame_8h.html#ac8f7380b8620c80443286b44481f641c">AST_FRIENDLY_OFFSET</a> + samples * <span class="keyword">sizeof</span>(uint16_t)];</div><div class="line"><a name="l00771"></a><span class="lineno">  771</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d0/d99/structast__frame.html">ast_frame</a> *f;</div><div class="line"><a name="l00772"></a><span class="lineno">  772</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d0/d99/structast__frame.html">ast_frame</a> t30_frame = {</div><div class="line"><a name="l00773"></a><span class="lineno">  773</span>&#160;      .<a class="code" href="../../d0/d99/structast__frame.html#a6937b93c56cb473b547eda454dca7b4c">frametype</a> = <a class="code" href="../../d6/d66/include_2asterisk_2frame_8h.html#ae2e1a9c4e048da387b761f619312d6e0aa457fe7005f11bb7b21453f9bb4caa8f">AST_FRAME_VOICE</a>,</div><div class="line"><a name="l00774"></a><span class="lineno">  774</span>&#160;      .subclass.format = <a class="code" href="../../db/d1c/format__cache_8h.html#a771d7c34570e8e492c25a0c2eb41889d">ast_format_slin</a>,</div><div class="line"><a name="l00775"></a><span class="lineno">  775</span>&#160;      .src = <span class="stringliteral">&quot;res_fax_spandsp_g711&quot;</span>,</div><div class="line"><a name="l00776"></a><span class="lineno">  776</span>&#160;      .samples = <a class="code" href="../../d0/d99/structast__frame.html#a37672e6b906143604cefd3e959777b31">samples</a>,</div><div class="line"><a name="l00777"></a><span class="lineno">  777</span>&#160;      .flags = <a class="code" href="../../db/d6a/res__fax_8h.html#a748e0695940b2d6145b9646387daa4db">AST_FAX_FRFLAG_GATEWAY</a>,</div><div class="line"><a name="l00778"></a><span class="lineno">  778</span>&#160;   };</div><div class="line"><a name="l00779"></a><span class="lineno">  779</span>&#160;</div><div class="line"><a name="l00780"></a><span class="lineno">  780</span>&#160;   <a class="code" href="../../d6/d66/include_2asterisk_2frame_8h.html#ac8bc210573f6b9c55ef38662bddc4675">AST_FRAME_SET_BUFFER</a>(&amp;t30_frame, buffer, <a class="code" href="../../d6/d66/include_2asterisk_2frame_8h.html#ac8f7380b8620c80443286b44481f641c">AST_FRIENDLY_OFFSET</a>, t30_frame.<a class="code" href="../../d0/d99/structast__frame.html#a37672e6b906143604cefd3e959777b31">samples</a> * <span class="keyword">sizeof</span>(<a class="code" href="../../da/d4e/db_8h.html#aa343fa3b3d06292b959ffdd4c4703b06">int16_t</a>));</div><div class="line"><a name="l00781"></a><span class="lineno">  781</span>&#160;</div><div class="line"><a name="l00782"></a><span class="lineno">  782</span>&#160;   <span class="keywordflow">if</span> (!(f = <a class="code" href="../../d6/d66/include_2asterisk_2frame_8h.html#a314496ce1d74ed7fdb9c5319c5e2e953">ast_frisolate</a>(&amp;t30_frame))) {</div><div class="line"><a name="l00783"></a><span class="lineno">  783</span>&#160;      <span class="keywordflow">return</span> p-&gt;<a class="code" href="../../d2/d70/structspandsp__pvt.html#af2bd73f7c4fe9e40a5d5cb75dcbca598">isdone</a> ? -1 : res;</div><div class="line"><a name="l00784"></a><span class="lineno">  784</span>&#160;   }</div><div class="line"><a name="l00785"></a><span class="lineno">  785</span>&#160;</div><div class="line"><a name="l00786"></a><span class="lineno">  786</span>&#160;   <span class="comment">/* generate a T.30 packet */</span></div><div class="line"><a name="l00787"></a><span class="lineno">  787</span>&#160;   <span class="keywordflow">if</span> ((f-&gt;<a class="code" href="../../d0/d99/structast__frame.html#a37672e6b906143604cefd3e959777b31">samples</a> = t38_gateway_tx(&amp;p-&gt;<a class="code" href="../../d2/d70/structspandsp__pvt.html#ad8cd454d1a02eee0cc27ea8819530ecd">t38_gw_state</a>, f-&gt;<a class="code" href="../../d0/d99/structast__frame.html#a4027905f872af30d910929b07e261ca5">data</a>.<a class="code" href="../../d0/d99/structast__frame.html#add9af9569af79ec26dd741fb226b38ba">ptr</a>, f-&gt;<a class="code" href="../../d0/d99/structast__frame.html#a37672e6b906143604cefd3e959777b31">samples</a>))) {</div><div class="line"><a name="l00788"></a><span class="lineno">  788</span>&#160;      f-&gt;<a class="code" href="../../d0/d99/structast__frame.html#ad67e07841d1233e596e6f822a3c81f6b">datalen</a> = f-&gt;<a class="code" href="../../d0/d99/structast__frame.html#a37672e6b906143604cefd3e959777b31">samples</a> * <span class="keyword">sizeof</span>(<a class="code" href="../../da/d4e/db_8h.html#aa343fa3b3d06292b959ffdd4c4703b06">int16_t</a>);</div><div class="line"><a name="l00789"></a><span class="lineno">  789</span>&#160;      res = <a class="code" href="../../d5/d7b/channel_8h.html#a79c413d51b7135404d5cacf811649a61">ast_write</a>(chan, f);</div><div class="line"><a name="l00790"></a><span class="lineno">  790</span>&#160;   }</div><div class="line"><a name="l00791"></a><span class="lineno">  791</span>&#160;   <a class="code" href="../../d6/d66/include_2asterisk_2frame_8h.html#a6440d070425a2efe8e0aa71e8d9e47b7">ast_frfree</a>(f);</div><div class="line"><a name="l00792"></a><span class="lineno">  792</span>&#160;   <span class="keywordflow">return</span> p-&gt;<a class="code" href="../../d2/d70/structspandsp__pvt.html#af2bd73f7c4fe9e40a5d5cb75dcbca598">isdone</a> ? -1 : res;</div><div class="line"><a name="l00793"></a><span class="lineno">  793</span>&#160;}</div><div class="line"><a name="l00794"></a><span class="lineno">  794</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00795"></a><span class="lineno">  795</span>&#160;<span class="comment">/*! \brief simple routine to allocate data to generator</span></div><div class="line"><a name="l00796"></a><span class="lineno">  796</span>&#160;<span class="comment"> * \param chan channel</span></div><div class="line"><a name="l00797"></a><span class="lineno">  797</span>&#160;<span class="comment"> * \param params generator data</span></div><div class="line"><a name="l00798"></a><span class="lineno">  798</span>&#160;<span class="comment"> * \return data to use in generator call*/</span></div><div class="line"><a name="l00799"></a><span class="lineno"><a class="line" href="../../d5/d47/res__fax__spandsp_8c.html#ad7634e872ab24fc86bb8237a6d2f4463">  799</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> *<a class="code" href="../../d5/d47/res__fax__spandsp_8c.html#ad7634e872ab24fc86bb8237a6d2f4463">spandsp_fax_gw_gen_alloc</a>(<span class="keyword">struct</span> <a class="code" href="../../df/d3c/structast__channel.html">ast_channel</a> *chan, <span class="keywordtype">void</span> *params)</div><div class="line"><a name="l00800"></a><span class="lineno">  800</span>&#160;{</div><div class="line"><a name="l00801"></a><span class="lineno">  801</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(params, +1);</div><div class="line"><a name="l00802"></a><span class="lineno">  802</span>&#160;   <span class="keywordflow">return</span> params;</div><div class="line"><a name="l00803"></a><span class="lineno">  803</span>&#160;}</div><div class="line"><a name="l00804"></a><span class="lineno">  804</span>&#160;</div><div class="line"><a name="l00805"></a><span class="lineno"><a class="line" href="../../d5/d47/res__fax__spandsp_8c.html#ad7ba83daf725125984d525ed1d2461cc">  805</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d5/d47/res__fax__spandsp_8c.html#ad7ba83daf725125984d525ed1d2461cc">spandsp_fax_gw_gen_release</a>(<span class="keyword">struct</span> <a class="code" href="../../df/d3c/structast__channel.html">ast_channel</a> *chan, <span class="keywordtype">void</span> *<a class="code" href="../../d0/d99/structast__frame.html#a4027905f872af30d910929b07e261ca5">data</a>)</div><div class="line"><a name="l00806"></a><span class="lineno">  806</span>&#160;{</div><div class="line"><a name="l00807"></a><span class="lineno">  807</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(data, -1);</div><div class="line"><a name="l00808"></a><span class="lineno">  808</span>&#160;}</div><div class="line"><a name="l00809"></a><span class="lineno">  809</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00810"></a><span class="lineno">  810</span>&#160;<span class="comment">/*! \brief activate a spandsp gateway based on the information in the given fax session</span></div><div class="line"><a name="l00811"></a><span class="lineno">  811</span>&#160;<span class="comment"> * \param s fax session</span></div><div class="line"><a name="l00812"></a><span class="lineno">  812</span>&#160;<span class="comment"> * \return -1 on error 0 on sucess*/</span></div><div class="line"><a name="l00813"></a><span class="lineno"><a class="line" href="../../d5/d47/res__fax__spandsp_8c.html#aca5062a395eb7c74d0109ba1f4d11b89">  813</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d5/d47/res__fax__spandsp_8c.html#aca5062a395eb7c74d0109ba1f4d11b89">spandsp_fax_gateway_start</a>(<span class="keyword">struct</span> <a class="code" href="../../d1/d16/structast__fax__session.html">ast_fax_session</a> *s)</div><div class="line"><a name="l00814"></a><span class="lineno">  814</span>&#160;{</div><div class="line"><a name="l00815"></a><span class="lineno">  815</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d2/d70/structspandsp__pvt.html">spandsp_pvt</a> *p = s-&gt;<a class="code" href="../../d1/d16/structast__fax__session.html#a19aa04db5508cf9496602e694dc69e2f">tech_pvt</a>;</div><div class="line"><a name="l00816"></a><span class="lineno">  816</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d3/df6/structast__fax__t38__parameters.html">ast_fax_t38_parameters</a> *t38_param;</div><div class="line"><a name="l00817"></a><span class="lineno">  817</span>&#160;   <span class="keywordtype">int</span> i;</div><div class="line"><a name="l00818"></a><span class="lineno">  818</span>&#160;   <a class="code" href="../../d5/d60/utils_8h.html#a1604b4d72144dd3d9f7da668e90337e9">RAII_VAR</a>(<span class="keyword">struct</span> <a class="code" href="../../df/d3c/structast__channel.html">ast_channel</a> *, peer, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../d5/da5/astobj2_8h.html#a6321ee982370c55ab3c24c72c562cbdd">ao2_cleanup</a>);</div><div class="line"><a name="l00819"></a><span class="lineno">  819</span>&#160;   <span class="keyword">static</span> <span class="keyword">struct </span><a class="code" href="../../de/d2a/structast__generator.html">ast_generator</a> t30_gen = {</div><div class="line"><a name="l00820"></a><span class="lineno">  820</span>&#160;      .<a class="code" href="../../de/d2a/structast__generator.html#a77c293dc8108e06e2a81a1fdafc8fd97">alloc</a> = <a class="code" href="../../d5/d47/res__fax__spandsp_8c.html#ad7634e872ab24fc86bb8237a6d2f4463">spandsp_fax_gw_gen_alloc</a>,</div><div class="line"><a name="l00821"></a><span class="lineno">  821</span>&#160;      .release = <a class="code" href="../../d5/d47/res__fax__spandsp_8c.html#ad7ba83daf725125984d525ed1d2461cc">spandsp_fax_gw_gen_release</a>,</div><div class="line"><a name="l00822"></a><span class="lineno">  822</span>&#160;      .generate = <a class="code" href="../../d5/d47/res__fax__spandsp_8c.html#afe4b8983331a6ebf8b794f6cdb318b2f">spandsp_fax_gw_t30_gen</a>,</div><div class="line"><a name="l00823"></a><span class="lineno">  823</span>&#160;   };</div><div class="line"><a name="l00824"></a><span class="lineno">  824</span>&#160;</div><div class="line"><a name="l00825"></a><span class="lineno">  825</span>&#160;<span class="preprocessor">#if SPANDSP_RELEASE_DATE &gt;= 20081012</span></div><div class="line"><a name="l00826"></a><span class="lineno">  826</span>&#160;   <span class="comment">/* for spandsp shaphots 0.0.6 and higher */</span></div><div class="line"><a name="l00827"></a><span class="lineno">  827</span>&#160;   p-&gt;<a class="code" href="../../d2/d70/structspandsp__pvt.html#a2771e36a55ef2406a468f480426f3f90">t38_core_state</a>=&amp;p-&gt;<a class="code" href="../../d2/d70/structspandsp__pvt.html#ad8cd454d1a02eee0cc27ea8819530ecd">t38_gw_state</a>.t38x.t38;</div><div class="line"><a name="l00828"></a><span class="lineno">  828</span>&#160;<span class="preprocessor">#else</span></div><div class="line"><a name="l00829"></a><span class="lineno">  829</span>&#160;   <span class="comment">/* for spandsp release 0.0.5 */</span></div><div class="line"><a name="l00830"></a><span class="lineno">  830</span>&#160;   p-&gt;<a class="code" href="../../d2/d70/structspandsp__pvt.html#a2771e36a55ef2406a468f480426f3f90">t38_core_state</a>=&amp;p-&gt;<a class="code" href="../../d2/d70/structspandsp__pvt.html#ad8cd454d1a02eee0cc27ea8819530ecd">t38_gw_state</a>.t38;</div><div class="line"><a name="l00831"></a><span class="lineno">  831</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00832"></a><span class="lineno">  832</span>&#160;</div><div class="line"><a name="l00833"></a><span class="lineno">  833</span>&#160;   <span class="keywordflow">if</span> (!t38_gateway_init(&amp;p-&gt;<a class="code" href="../../d2/d70/structspandsp__pvt.html#ad8cd454d1a02eee0cc27ea8819530ecd">t38_gw_state</a>, <a class="code" href="../../d5/d47/res__fax__spandsp_8c.html#a24efd6f18c67b0deb9973607e23f2bac">t38_tx_packet_handler</a>, s)) {</div><div class="line"><a name="l00834"></a><span class="lineno">  834</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l00835"></a><span class="lineno">  835</span>&#160;   }</div><div class="line"><a name="l00836"></a><span class="lineno">  836</span>&#160;</div><div class="line"><a name="l00837"></a><span class="lineno">  837</span>&#160;   p-&gt;<a class="code" href="../../d2/d70/structspandsp__pvt.html#a9e04fe7f94b31b90af8617c4114973c6">ist38</a> = 1;</div><div class="line"><a name="l00838"></a><span class="lineno">  838</span>&#160;   p-&gt;<a class="code" href="../../d2/d70/structspandsp__pvt.html#add1eaf99c12ebcef83fa7c1d4ca52f9f">ast_t38_state</a> = <a class="code" href="../../d5/d7b/channel_8h.html#a1b22ea5302ef183fa68bc45bfb0659c9">ast_channel_get_t38_state</a>(s-&gt;<a class="code" href="../../d1/d16/structast__fax__session.html#a84d1435c5b8d387806714ea7079304b7">chan</a>);</div><div class="line"><a name="l00839"></a><span class="lineno">  839</span>&#160;   peer = <a class="code" href="../../d5/d7b/channel_8h.html#af9e27ecd92ff5aa897c9e058dfbd6510">ast_channel_bridge_peer</a>(s-&gt;<a class="code" href="../../d1/d16/structast__fax__session.html#a84d1435c5b8d387806714ea7079304b7">chan</a>);</div><div class="line"><a name="l00840"></a><span class="lineno">  840</span>&#160;   <span class="keywordflow">if</span> (!peer) {</div><div class="line"><a name="l00841"></a><span class="lineno">  841</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l00842"></a><span class="lineno">  842</span>&#160;   }</div><div class="line"><a name="l00843"></a><span class="lineno">  843</span>&#160;</div><div class="line"><a name="l00844"></a><span class="lineno">  844</span>&#160;   <span class="comment">/* we can be in T38_STATE_NEGOTIATING or T38_STATE_NEGOTIATED when the</span></div><div class="line"><a name="l00845"></a><span class="lineno">  845</span>&#160;<span class="comment">    * gateway is started. We treat both states the same. */</span></div><div class="line"><a name="l00846"></a><span class="lineno">  846</span>&#160;   <span class="keywordflow">if</span> (p-&gt;<a class="code" href="../../d2/d70/structspandsp__pvt.html#add1eaf99c12ebcef83fa7c1d4ca52f9f">ast_t38_state</a> == <a class="code" href="../../d5/d7b/channel_8h.html#a4cd990f4c1cd0c2af6e4c63f6d15b4e1afa1eab36050476591f803c3e234c2ed1">T38_STATE_NEGOTIATING</a>) {</div><div class="line"><a name="l00847"></a><span class="lineno">  847</span>&#160;      p-&gt;<a class="code" href="../../d2/d70/structspandsp__pvt.html#add1eaf99c12ebcef83fa7c1d4ca52f9f">ast_t38_state</a> = <a class="code" href="../../d5/d7b/channel_8h.html#a4cd990f4c1cd0c2af6e4c63f6d15b4e1af142c79721a025bd65edad812f0725e0">T38_STATE_NEGOTIATED</a>;</div><div class="line"><a name="l00848"></a><span class="lineno">  848</span>&#160;   }</div><div class="line"><a name="l00849"></a><span class="lineno">  849</span>&#160;</div><div class="line"><a name="l00850"></a><span class="lineno">  850</span>&#160;   <a class="code" href="../../d5/d7b/channel_8h.html#a12a58dda74a19f383f6b77cf7fa88b54">ast_activate_generator</a>(p-&gt;<a class="code" href="../../d2/d70/structspandsp__pvt.html#add1eaf99c12ebcef83fa7c1d4ca52f9f">ast_t38_state</a> == <a class="code" href="../../d5/d7b/channel_8h.html#a4cd990f4c1cd0c2af6e4c63f6d15b4e1af142c79721a025bd65edad812f0725e0">T38_STATE_NEGOTIATED</a> ? peer : s-&gt;<a class="code" href="../../d1/d16/structast__fax__session.html#a84d1435c5b8d387806714ea7079304b7">chan</a>, &amp;t30_gen , s);</div><div class="line"><a name="l00851"></a><span class="lineno">  851</span>&#160;</div><div class="line"><a name="l00852"></a><span class="lineno">  852</span>&#160;   <a class="code" href="../../d5/d47/res__fax__spandsp_8c.html#a7a848b476ce6571398d94f5eb74f3182">set_logging</a>(&amp;p-&gt;<a class="code" href="../../d2/d70/structspandsp__pvt.html#ad8cd454d1a02eee0cc27ea8819530ecd">t38_gw_state</a>.logging, s-&gt;<a class="code" href="../../d1/d16/structast__fax__session.html#ae7b633178d301df70e8612b4ce1aeb77">details</a>);</div><div class="line"><a name="l00853"></a><span class="lineno">  853</span>&#160;   <a class="code" href="../../d5/d47/res__fax__spandsp_8c.html#a7a848b476ce6571398d94f5eb74f3182">set_logging</a>(&amp;p-&gt;<a class="code" href="../../d2/d70/structspandsp__pvt.html#a2771e36a55ef2406a468f480426f3f90">t38_core_state</a>-&gt;logging, s-&gt;<a class="code" href="../../d1/d16/structast__fax__session.html#ae7b633178d301df70e8612b4ce1aeb77">details</a>);</div><div class="line"><a name="l00854"></a><span class="lineno">  854</span>&#160;</div><div class="line"><a name="l00855"></a><span class="lineno">  855</span>&#160;   t38_param = (p-&gt;<a class="code" href="../../d2/d70/structspandsp__pvt.html#add1eaf99c12ebcef83fa7c1d4ca52f9f">ast_t38_state</a> == <a class="code" href="../../d5/d7b/channel_8h.html#a4cd990f4c1cd0c2af6e4c63f6d15b4e1af142c79721a025bd65edad812f0725e0">T38_STATE_NEGOTIATED</a>) ? &amp;s-&gt;<a class="code" href="../../d1/d16/structast__fax__session.html#ae7b633178d301df70e8612b4ce1aeb77">details</a>-&gt;<a class="code" href="../../d8/dc2/structast__fax__session__details.html#a80632865b575d06f319ef95c42645b2c">our_t38_parameters</a> : &amp;s-&gt;<a class="code" href="../../d1/d16/structast__fax__session.html#ae7b633178d301df70e8612b4ce1aeb77">details</a>-&gt;<a class="code" href="../../d8/dc2/structast__fax__session__details.html#a12cc2bfdcc88e94984d001cca6fefdc5">their_t38_parameters</a>;</div><div class="line"><a name="l00856"></a><span class="lineno">  856</span>&#160;   t38_set_t38_version(p-&gt;<a class="code" href="../../d2/d70/structspandsp__pvt.html#a2771e36a55ef2406a468f480426f3f90">t38_core_state</a>, t38_param-&gt;<a class="code" href="../../d3/df6/structast__fax__t38__parameters.html#a5408ac5df4c170828874e1b10b4c35a0">version</a>);</div><div class="line"><a name="l00857"></a><span class="lineno">  857</span>&#160;   t38_gateway_set_ecm_capability(&amp;p-&gt;<a class="code" href="../../d2/d70/structspandsp__pvt.html#ad8cd454d1a02eee0cc27ea8819530ecd">t38_gw_state</a>, s-&gt;<a class="code" href="../../d1/d16/structast__fax__session.html#ae7b633178d301df70e8612b4ce1aeb77">details</a>-&gt;<a class="code" href="../../d8/dc2/structast__fax__session__details.html#a3ab211dbe8780b7292257f6b3dba1952">option</a>.<a class="code" href="../../d8/dc2/structast__fax__session__details.html#af766692698b742acddbc42494d323a9f">ecm</a>);</div><div class="line"><a name="l00858"></a><span class="lineno">  858</span>&#160;   t38_set_max_datagram_size(p-&gt;<a class="code" href="../../d2/d70/structspandsp__pvt.html#a2771e36a55ef2406a468f480426f3f90">t38_core_state</a>, t38_param-&gt;<a class="code" href="../../d3/df6/structast__fax__t38__parameters.html#a7924cc45cde640e779a902c4aadaf180">max_ifp</a>);</div><div class="line"><a name="l00859"></a><span class="lineno">  859</span>&#160;   t38_set_fill_bit_removal(p-&gt;<a class="code" href="../../d2/d70/structspandsp__pvt.html#a2771e36a55ef2406a468f480426f3f90">t38_core_state</a>, t38_param-&gt;<a class="code" href="../../d3/df6/structast__fax__t38__parameters.html#addb721c952a7144f0a6a9ac5f621d2bc">fill_bit_removal</a>);</div><div class="line"><a name="l00860"></a><span class="lineno">  860</span>&#160;   t38_set_mmr_transcoding(p-&gt;<a class="code" href="../../d2/d70/structspandsp__pvt.html#a2771e36a55ef2406a468f480426f3f90">t38_core_state</a>, t38_param-&gt;<a class="code" href="../../d3/df6/structast__fax__t38__parameters.html#ad2b3d53474db70e3ff2058da953b7b82">transcoding_mmr</a>);</div><div class="line"><a name="l00861"></a><span class="lineno">  861</span>&#160;   t38_set_jbig_transcoding(p-&gt;<a class="code" href="../../d2/d70/structspandsp__pvt.html#a2771e36a55ef2406a468f480426f3f90">t38_core_state</a>, t38_param-&gt;<a class="code" href="../../d3/df6/structast__fax__t38__parameters.html#a07676322ec48c4872f9a208a6248d034">transcoding_jbig</a>);</div><div class="line"><a name="l00862"></a><span class="lineno">  862</span>&#160;   t38_set_data_rate_management_method(p-&gt;<a class="code" href="../../d2/d70/structspandsp__pvt.html#a2771e36a55ef2406a468f480426f3f90">t38_core_state</a>,</div><div class="line"><a name="l00863"></a><span class="lineno">  863</span>&#160;         (t38_param-&gt;<a class="code" href="../../d3/df6/structast__fax__t38__parameters.html#ad39f48f545d7c8962dfa0ae83a61c21f">rate_management</a> == <a class="code" href="../../d6/d66/include_2asterisk_2frame_8h.html#a9db3df106b7deebbee4c5106a880ec33abbb1b9b329ded73597a5c2eefe13a34c">AST_T38_RATE_MANAGEMENT_TRANSFERRED_TCF</a>)? 1 : 2);</div><div class="line"><a name="l00864"></a><span class="lineno">  864</span>&#160;</div><div class="line"><a name="l00865"></a><span class="lineno">  865</span>&#160;   t38_gateway_set_transmit_on_idle(&amp;p-&gt;<a class="code" href="../../d2/d70/structspandsp__pvt.html#ad8cd454d1a02eee0cc27ea8819530ecd">t38_gw_state</a>, <a class="code" href="../../de/dfe/app__minivm_8c.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>);</div><div class="line"><a name="l00866"></a><span class="lineno">  866</span>&#160;   t38_set_sequence_number_handling(p-&gt;<a class="code" href="../../d2/d70/structspandsp__pvt.html#a2771e36a55ef2406a468f480426f3f90">t38_core_state</a>, <a class="code" href="../../de/dfe/app__minivm_8c.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>);</div><div class="line"><a name="l00867"></a><span class="lineno">  867</span>&#160;</div><div class="line"><a name="l00868"></a><span class="lineno">  868</span>&#160;</div><div class="line"><a name="l00869"></a><span class="lineno">  869</span>&#160;   t38_gateway_set_supported_modems(&amp;p-&gt;<a class="code" href="../../d2/d70/structspandsp__pvt.html#ad8cd454d1a02eee0cc27ea8819530ecd">t38_gw_state</a>, <a class="code" href="../../d5/d47/res__fax__spandsp_8c.html#a727760f4638f2c84101218ce5e89d567">spandsp_modems</a>(s-&gt;<a class="code" href="../../d1/d16/structast__fax__session.html#ae7b633178d301df70e8612b4ce1aeb77">details</a>));</div><div class="line"><a name="l00870"></a><span class="lineno">  870</span>&#160;</div><div class="line"><a name="l00871"></a><span class="lineno">  871</span>&#160;   <span class="comment">/* engage udptl nat on other side of T38 line</span></div><div class="line"><a name="l00872"></a><span class="lineno">  872</span>&#160;<span class="comment">    * (Asterisk changes media ports thus we send a few packets to reinitialize</span></div><div class="line"><a name="l00873"></a><span class="lineno">  873</span>&#160;<span class="comment">    * pinholes in NATs and FWs</span></div><div class="line"><a name="l00874"></a><span class="lineno">  874</span>&#160;<span class="comment">    */</span></div><div class="line"><a name="l00875"></a><span class="lineno">  875</span>&#160;   <span class="keywordflow">for</span> (i=0; i &lt; <a class="code" href="../../d5/d47/res__fax__spandsp_8c.html#ac7fd98ac3a6b6d9a649dc1a7df2e6b25">SPANDSP_ENGAGE_UDPTL_NAT_RETRY</a>; i++) {</div><div class="line"><a name="l00876"></a><span class="lineno">  876</span>&#160;<span class="preprocessor">#if SPANDSP_RELEASE_DATE &gt;= 20091228</span></div><div class="line"><a name="l00877"></a><span class="lineno">  877</span>&#160;      t38_core_send_indicator(&amp;p-&gt;<a class="code" href="../../d2/d70/structspandsp__pvt.html#ad8cd454d1a02eee0cc27ea8819530ecd">t38_gw_state</a>.t38x.t38, T38_IND_NO_SIGNAL);</div><div class="line"><a name="l00878"></a><span class="lineno">  878</span>&#160;<span class="preprocessor">#elif SPANDSP_RELEASE_DATE &gt;= 20081012</span></div><div class="line"><a name="l00879"></a><span class="lineno">  879</span>&#160;      t38_core_send_indicator(&amp;p-&gt;<a class="code" href="../../d2/d70/structspandsp__pvt.html#ad8cd454d1a02eee0cc27ea8819530ecd">t38_gw_state</a>.t38x.t38, T38_IND_NO_SIGNAL, p-&gt;<a class="code" href="../../d2/d70/structspandsp__pvt.html#ad8cd454d1a02eee0cc27ea8819530ecd">t38_gw_state</a>.t38x.t38.indicator_tx_count);</div><div class="line"><a name="l00880"></a><span class="lineno">  880</span>&#160;<span class="preprocessor">#else</span></div><div class="line"><a name="l00881"></a><span class="lineno">  881</span>&#160;      t38_core_send_indicator(&amp;p-&gt;<a class="code" href="../../d2/d70/structspandsp__pvt.html#ad8cd454d1a02eee0cc27ea8819530ecd">t38_gw_state</a>.t38, T38_IND_NO_SIGNAL, p-&gt;<a class="code" href="../../d2/d70/structspandsp__pvt.html#ad8cd454d1a02eee0cc27ea8819530ecd">t38_gw_state</a>.t38.indicator_tx_count);</div><div class="line"><a name="l00882"></a><span class="lineno">  882</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00883"></a><span class="lineno">  883</span>&#160;   }</div><div class="line"><a name="l00884"></a><span class="lineno">  884</span>&#160;</div><div class="line"><a name="l00885"></a><span class="lineno">  885</span>&#160;   s-&gt;<a class="code" href="../../d1/d16/structast__fax__session.html#ad8f346e1752edcc0b1a6b431b1749f0e">state</a> = <a class="code" href="../../db/d6a/res__fax_8h.html#ab34810136037068a0847bcca2518112ca59afc86be1c4be9a01c3cd178c4337b2">AST_FAX_STATE_ACTIVE</a>;</div><div class="line"><a name="l00886"></a><span class="lineno">  886</span>&#160;</div><div class="line"><a name="l00887"></a><span class="lineno">  887</span>&#160;   <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00888"></a><span class="lineno">  888</span>&#160;}</div><div class="line"><a name="l00889"></a><span class="lineno">  889</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00890"></a><span class="lineno">  890</span>&#160;<span class="comment">/*! \brief process a frame from the bridge</span></div><div class="line"><a name="l00891"></a><span class="lineno">  891</span>&#160;<span class="comment"> * \param s fax session</span></div><div class="line"><a name="l00892"></a><span class="lineno">  892</span>&#160;<span class="comment"> * \param f frame to process</span></div><div class="line"><a name="l00893"></a><span class="lineno">  893</span>&#160;<span class="comment"> * \return 1 on sucess 0 on incorect packet*/</span></div><div class="line"><a name="l00894"></a><span class="lineno"><a class="line" href="../../d5/d47/res__fax__spandsp_8c.html#a8162670509872b734477d174e39a073e">  894</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d5/d47/res__fax__spandsp_8c.html#a8162670509872b734477d174e39a073e">spandsp_fax_gateway_process</a>(<span class="keyword">struct</span> <a class="code" href="../../d1/d16/structast__fax__session.html">ast_fax_session</a> *s, <span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="../../d0/d99/structast__frame.html">ast_frame</a> *f)</div><div class="line"><a name="l00895"></a><span class="lineno">  895</span>&#160;{</div><div class="line"><a name="l00896"></a><span class="lineno">  896</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d2/d70/structspandsp__pvt.html">spandsp_pvt</a> *p = s-&gt;<a class="code" href="../../d1/d16/structast__fax__session.html#a19aa04db5508cf9496602e694dc69e2f">tech_pvt</a>;</div><div class="line"><a name="l00897"></a><span class="lineno">  897</span>&#160;</div><div class="line"><a name="l00898"></a><span class="lineno">  898</span>&#160;   <span class="comment">/*invalid frame*/</span></div><div class="line"><a name="l00899"></a><span class="lineno">  899</span>&#160;   <span class="keywordflow">if</span> (!f-&gt;<a class="code" href="../../d0/d99/structast__frame.html#a4027905f872af30d910929b07e261ca5">data</a>.<a class="code" href="../../d0/d99/structast__frame.html#add9af9569af79ec26dd741fb226b38ba">ptr</a> || !f-&gt;<a class="code" href="../../d0/d99/structast__frame.html#ad67e07841d1233e596e6f822a3c81f6b">datalen</a>) {</div><div class="line"><a name="l00900"></a><span class="lineno">  900</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l00901"></a><span class="lineno">  901</span>&#160;   }</div><div class="line"><a name="l00902"></a><span class="lineno">  902</span>&#160;</div><div class="line"><a name="l00903"></a><span class="lineno">  903</span>&#160;   <span class="comment">/* Process a IFP packet */</span></div><div class="line"><a name="l00904"></a><span class="lineno">  904</span>&#160;   <span class="keywordflow">if</span> ((f-&gt;<a class="code" href="../../d0/d99/structast__frame.html#a6937b93c56cb473b547eda454dca7b4c">frametype</a> == <a class="code" href="../../d6/d66/include_2asterisk_2frame_8h.html#ae2e1a9c4e048da387b761f619312d6e0ad99b86353343f422bda01163898b2eea">AST_FRAME_MODEM</a>) &amp;&amp; (f-&gt;<a class="code" href="../../d0/d99/structast__frame.html#a27237c48fdcd22556401f20c693811db">subclass</a>.<a class="code" href="../../d1/d9f/structast__frame__subclass.html#adece183191b0e700e039e59101e06105">integer</a> == <a class="code" href="../../d6/d66/include_2asterisk_2frame_8h.html#a3a510e4e2673c6870ed5fe0f1eb53732">AST_MODEM_T38</a>)) {</div><div class="line"><a name="l00905"></a><span class="lineno">  905</span>&#160;      <span class="keywordflow">return</span> t38_core_rx_ifp_packet(p-&gt;<a class="code" href="../../d2/d70/structspandsp__pvt.html#a2771e36a55ef2406a468f480426f3f90">t38_core_state</a>, f-&gt;<a class="code" href="../../d0/d99/structast__frame.html#a4027905f872af30d910929b07e261ca5">data</a>.<a class="code" href="../../d0/d99/structast__frame.html#add9af9569af79ec26dd741fb226b38ba">ptr</a>, f-&gt;<a class="code" href="../../d0/d99/structast__frame.html#ad67e07841d1233e596e6f822a3c81f6b">datalen</a>, f-&gt;<a class="code" href="../../d0/d99/structast__frame.html#ab793262012344621455faf9266acbac2">seqno</a>);</div><div class="line"><a name="l00906"></a><span class="lineno">  906</span>&#160;   } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((f-&gt;<a class="code" href="../../d0/d99/structast__frame.html#a6937b93c56cb473b547eda454dca7b4c">frametype</a> == <a class="code" href="../../d6/d66/include_2asterisk_2frame_8h.html#ae2e1a9c4e048da387b761f619312d6e0aa457fe7005f11bb7b21453f9bb4caa8f">AST_FRAME_VOICE</a>) &amp;&amp;</div><div class="line"><a name="l00907"></a><span class="lineno">  907</span>&#160;      (<a class="code" href="../../d0/d0a/format_8h.html#a738c58eca291b71de4422e95bff27400">ast_format_cmp</a>(f-&gt;<a class="code" href="../../d0/d99/structast__frame.html#a27237c48fdcd22556401f20c693811db">subclass</a>.<a class="code" href="../../d1/d9f/structast__frame__subclass.html#ab425a484a0916077c5a30d9d7b229b44">format</a>, <a class="code" href="../../db/d1c/format__cache_8h.html#a771d7c34570e8e492c25a0c2eb41889d">ast_format_slin</a>) == <a class="code" href="../../d0/d0a/format_8h.html#a79bdf0b3c0616d9950d00cfeb62295c3ab1e8c1a0f8b4a1ecb6a2109992636859">AST_FORMAT_CMP_EQUAL</a>)) {</div><div class="line"><a name="l00908"></a><span class="lineno">  908</span>&#160;      <span class="keywordflow">return</span> t38_gateway_rx(&amp;p-&gt;<a class="code" href="../../d2/d70/structspandsp__pvt.html#ad8cd454d1a02eee0cc27ea8819530ecd">t38_gw_state</a>, f-&gt;<a class="code" href="../../d0/d99/structast__frame.html#a4027905f872af30d910929b07e261ca5">data</a>.<a class="code" href="../../d0/d99/structast__frame.html#add9af9569af79ec26dd741fb226b38ba">ptr</a>, f-&gt;<a class="code" href="../../d0/d99/structast__frame.html#a37672e6b906143604cefd3e959777b31">samples</a>);</div><div class="line"><a name="l00909"></a><span class="lineno">  909</span>&#160;   }</div><div class="line"><a name="l00910"></a><span class="lineno">  910</span>&#160;</div><div class="line"><a name="l00911"></a><span class="lineno">  911</span>&#160;   <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l00912"></a><span class="lineno">  912</span>&#160;}</div><div class="line"><a name="l00913"></a><span class="lineno">  913</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00914"></a><span class="lineno">  914</span>&#160;<span class="comment">/*! \brief gather data and clean up after gateway ends</span></div><div class="line"><a name="l00915"></a><span class="lineno">  915</span>&#160;<span class="comment"> * \param s fax session*/</span></div><div class="line"><a name="l00916"></a><span class="lineno"><a class="line" href="../../d5/d47/res__fax__spandsp_8c.html#ad19e873d8a667de24f4cb593a05b45fb">  916</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d5/d47/res__fax__spandsp_8c.html#ad19e873d8a667de24f4cb593a05b45fb">spandsp_fax_gateway_cleanup</a>(<span class="keyword">struct</span> <a class="code" href="../../d1/d16/structast__fax__session.html">ast_fax_session</a> *s)</div><div class="line"><a name="l00917"></a><span class="lineno">  917</span>&#160;{</div><div class="line"><a name="l00918"></a><span class="lineno">  918</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d2/d70/structspandsp__pvt.html">spandsp_pvt</a> *p = s-&gt;<a class="code" href="../../d1/d16/structast__fax__session.html#a19aa04db5508cf9496602e694dc69e2f">tech_pvt</a>;</div><div class="line"><a name="l00919"></a><span class="lineno">  919</span>&#160;   t38_stats_t t38_stats;</div><div class="line"><a name="l00920"></a><span class="lineno">  920</span>&#160;</div><div class="line"><a name="l00921"></a><span class="lineno">  921</span>&#160;   t38_gateway_get_transfer_statistics(&amp;p-&gt;<a class="code" href="../../d2/d70/structspandsp__pvt.html#ad8cd454d1a02eee0cc27ea8819530ecd">t38_gw_state</a>, &amp;t38_stats);</div><div class="line"><a name="l00922"></a><span class="lineno">  922</span>&#160;</div><div class="line"><a name="l00923"></a><span class="lineno">  923</span>&#160;   s-&gt;<a class="code" href="../../d1/d16/structast__fax__session.html#ae7b633178d301df70e8612b4ce1aeb77">details</a>-&gt;<a class="code" href="../../d8/dc2/structast__fax__session__details.html#a3ab211dbe8780b7292257f6b3dba1952">option</a>.<a class="code" href="../../d8/dc2/structast__fax__session__details.html#af766692698b742acddbc42494d323a9f">ecm</a> = t38_stats.error_correcting_mode ? <a class="code" href="../../db/d6a/res__fax_8h.html#a1838c71fcf68c3cfe0ce37e35e77406dabd9b4a57405ba5c0c884ac98746a8bd7">AST_FAX_OPTFLAG_TRUE</a> : <a class="code" href="../../db/d6a/res__fax_8h.html#a1838c71fcf68c3cfe0ce37e35e77406daa2151729c413238bea86a4b62e7865bd">AST_FAX_OPTFLAG_FALSE</a>;</div><div class="line"><a name="l00924"></a><span class="lineno">  924</span>&#160;   s-&gt;<a class="code" href="../../d1/d16/structast__fax__session.html#ae7b633178d301df70e8612b4ce1aeb77">details</a>-&gt;<a class="code" href="../../d8/dc2/structast__fax__session__details.html#ac579558087dfa900a4c5384cb6e09dd8">pages_transferred</a> = t38_stats.pages_transferred;</div><div class="line"><a name="l00925"></a><span class="lineno">  925</span>&#160;   <a class="code" href="../../d1/d0f/stringfields_8h.html#a8b9f4347fc72720cc5cead952b54abe9">ast_string_field_build</a>(s-&gt;<a class="code" href="../../d1/d16/structast__fax__session.html#ae7b633178d301df70e8612b4ce1aeb77">details</a>, transfer_rate, <span class="stringliteral">&quot;%d&quot;</span>, t38_stats.bit_rate);</div><div class="line"><a name="l00926"></a><span class="lineno">  926</span>&#160;}</div><div class="line"><a name="l00927"></a><span class="lineno">  927</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00928"></a><span class="lineno">  928</span>&#160;<span class="comment">/*! \brief */</span></div><div class="line"><a name="l00929"></a><span class="lineno"><a class="line" href="../../d5/d47/res__fax__spandsp_8c.html#ae8ab5a74bae7f83dd7cad98eb9deeb98">  929</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d5/d47/res__fax__spandsp_8c.html#ae8ab5a74bae7f83dd7cad98eb9deeb98">spandsp_fax_start</a>(<span class="keyword">struct</span> <a class="code" href="../../d1/d16/structast__fax__session.html">ast_fax_session</a> *s)</div><div class="line"><a name="l00930"></a><span class="lineno">  930</span>&#160;{</div><div class="line"><a name="l00931"></a><span class="lineno">  931</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d2/d70/structspandsp__pvt.html">spandsp_pvt</a> *p = s-&gt;<a class="code" href="../../d1/d16/structast__fax__session.html#a19aa04db5508cf9496602e694dc69e2f">tech_pvt</a>;</div><div class="line"><a name="l00932"></a><span class="lineno">  932</span>&#160;</div><div class="line"><a name="l00933"></a><span class="lineno">  933</span>&#160;   s-&gt;<a class="code" href="../../d1/d16/structast__fax__session.html#ad8f346e1752edcc0b1a6b431b1749f0e">state</a> = <a class="code" href="../../db/d6a/res__fax_8h.html#ab34810136037068a0847bcca2518112cad0225f93f7c72e6071a0e2c459ec213c">AST_FAX_STATE_OPEN</a>;</div><div class="line"><a name="l00934"></a><span class="lineno">  934</span>&#160;</div><div class="line"><a name="l00935"></a><span class="lineno">  935</span>&#160;   <span class="keywordflow">if</span> (s-&gt;<a class="code" href="../../d1/d16/structast__fax__session.html#ae7b633178d301df70e8612b4ce1aeb77">details</a>-&gt;<a class="code" href="../../d8/dc2/structast__fax__session__details.html#ad75375cdd336e91cbcee4a829fcdabfe">caps</a> &amp; <a class="code" href="../../db/d6a/res__fax_8h.html#a54eb45ad548b874cf12d0a599631e3f6add135550dca7400fb80e250a63a54887">AST_FAX_TECH_GATEWAY</a>) {</div><div class="line"><a name="l00936"></a><span class="lineno">  936</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../d5/d47/res__fax__spandsp_8c.html#aca5062a395eb7c74d0109ba1f4d11b89">spandsp_fax_gateway_start</a>(s);</div><div class="line"><a name="l00937"></a><span class="lineno">  937</span>&#160;   }</div><div class="line"><a name="l00938"></a><span class="lineno">  938</span>&#160;</div><div class="line"><a name="l00939"></a><span class="lineno">  939</span>&#160;   <span class="keywordflow">if</span> (p-&gt;<a class="code" href="../../d2/d70/structspandsp__pvt.html#a9e04fe7f94b31b90af8617c4114973c6">ist38</a>) {</div><div class="line"><a name="l00940"></a><span class="lineno">  940</span>&#160;<span class="preprocessor">#if SPANDSP_RELEASE_DATE &gt;= 20080725</span></div><div class="line"><a name="l00941"></a><span class="lineno">  941</span>&#160;      <span class="comment">/* for spandsp shaphots 0.0.6 and higher */</span></div><div class="line"><a name="l00942"></a><span class="lineno">  942</span>&#160;      p-&gt;<a class="code" href="../../d2/d70/structspandsp__pvt.html#adcd6f30baf585999693211a967c2db61">t30_state</a> = &amp;p-&gt;<a class="code" href="../../d2/d70/structspandsp__pvt.html#aa32b12a7baab4b773f3aee19dc640fdb">t38_state</a>.t30;</div><div class="line"><a name="l00943"></a><span class="lineno">  943</span>&#160;      p-&gt;<a class="code" href="../../d2/d70/structspandsp__pvt.html#a2771e36a55ef2406a468f480426f3f90">t38_core_state</a> = &amp;p-&gt;<a class="code" href="../../d2/d70/structspandsp__pvt.html#aa32b12a7baab4b773f3aee19dc640fdb">t38_state</a>.t38_fe.t38;</div><div class="line"><a name="l00944"></a><span class="lineno">  944</span>&#160;<span class="preprocessor">#else</span></div><div class="line"><a name="l00945"></a><span class="lineno">  945</span>&#160;      <span class="comment">/* for spandsp releases 0.0.5 */</span></div><div class="line"><a name="l00946"></a><span class="lineno">  946</span>&#160;      p-&gt;<a class="code" href="../../d2/d70/structspandsp__pvt.html#adcd6f30baf585999693211a967c2db61">t30_state</a> = &amp;p-&gt;<a class="code" href="../../d2/d70/structspandsp__pvt.html#aa32b12a7baab4b773f3aee19dc640fdb">t38_state</a>.t30_state;</div><div class="line"><a name="l00947"></a><span class="lineno">  947</span>&#160;      p-&gt;<a class="code" href="../../d2/d70/structspandsp__pvt.html#a2771e36a55ef2406a468f480426f3f90">t38_core_state</a> = &amp;p-&gt;<a class="code" href="../../d2/d70/structspandsp__pvt.html#aa32b12a7baab4b773f3aee19dc640fdb">t38_state</a>.t38;</div><div class="line"><a name="l00948"></a><span class="lineno">  948</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00949"></a><span class="lineno">  949</span>&#160;   } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00950"></a><span class="lineno">  950</span>&#160;<span class="preprocessor">#if SPANDSP_RELEASE_DATE &gt;= 20080725</span></div><div class="line"><a name="l00951"></a><span class="lineno">  951</span>&#160;      <span class="comment">/* for spandsp shaphots 0.0.6 and higher */</span></div><div class="line"><a name="l00952"></a><span class="lineno">  952</span>&#160;      p-&gt;<a class="code" href="../../d2/d70/structspandsp__pvt.html#adcd6f30baf585999693211a967c2db61">t30_state</a> = &amp;p-&gt;<a class="code" href="../../d2/d70/structspandsp__pvt.html#a6209294447011868d1a0ec7373bb90b5">fax_state</a>.t30;</div><div class="line"><a name="l00953"></a><span class="lineno">  953</span>&#160;<span class="preprocessor">#else</span></div><div class="line"><a name="l00954"></a><span class="lineno">  954</span>&#160;      <span class="comment">/* for spandsp release 0.0.5 */</span></div><div class="line"><a name="l00955"></a><span class="lineno">  955</span>&#160;      p-&gt;<a class="code" href="../../d2/d70/structspandsp__pvt.html#adcd6f30baf585999693211a967c2db61">t30_state</a> = &amp;p-&gt;<a class="code" href="../../d2/d70/structspandsp__pvt.html#a6209294447011868d1a0ec7373bb90b5">fax_state</a>.t30_state;</div><div class="line"><a name="l00956"></a><span class="lineno">  956</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00957"></a><span class="lineno">  957</span>&#160;   }</div><div class="line"><a name="l00958"></a><span class="lineno">  958</span>&#160;</div><div class="line"><a name="l00959"></a><span class="lineno">  959</span>&#160;   <a class="code" href="../../d5/d47/res__fax__spandsp_8c.html#a7a848b476ce6571398d94f5eb74f3182">set_logging</a>(&amp;p-&gt;<a class="code" href="../../d2/d70/structspandsp__pvt.html#adcd6f30baf585999693211a967c2db61">t30_state</a>-&gt;logging, s-&gt;<a class="code" href="../../d1/d16/structast__fax__session.html#ae7b633178d301df70e8612b4ce1aeb77">details</a>);</div><div class="line"><a name="l00960"></a><span class="lineno">  960</span>&#160;</div><div class="line"><a name="l00961"></a><span class="lineno">  961</span>&#160;   <span class="comment">/* set some parameters */</span></div><div class="line"><a name="l00962"></a><span class="lineno">  962</span>&#160;   <a class="code" href="../../d5/d47/res__fax__spandsp_8c.html#a985020177397f3b53f8c375b9f5555a9">set_local_info</a>(p-&gt;<a class="code" href="../../d2/d70/structspandsp__pvt.html#adcd6f30baf585999693211a967c2db61">t30_state</a>, s-&gt;<a class="code" href="../../d1/d16/structast__fax__session.html#ae7b633178d301df70e8612b4ce1aeb77">details</a>);</div><div class="line"><a name="l00963"></a><span class="lineno">  963</span>&#160;   <a class="code" href="../../d5/d47/res__fax__spandsp_8c.html#a5fa4f4dc494fc66a1764e00783006b75">set_file</a>(p-&gt;<a class="code" href="../../d2/d70/structspandsp__pvt.html#adcd6f30baf585999693211a967c2db61">t30_state</a>, s-&gt;<a class="code" href="../../d1/d16/structast__fax__session.html#ae7b633178d301df70e8612b4ce1aeb77">details</a>);</div><div class="line"><a name="l00964"></a><span class="lineno">  964</span>&#160;   <a class="code" href="../../d5/d47/res__fax__spandsp_8c.html#ae4ab2698fa08f5133c8241c9d2c3bfa4">set_ecm</a>(p-&gt;<a class="code" href="../../d2/d70/structspandsp__pvt.html#adcd6f30baf585999693211a967c2db61">t30_state</a>, s-&gt;<a class="code" href="../../d1/d16/structast__fax__session.html#ae7b633178d301df70e8612b4ce1aeb77">details</a>);</div><div class="line"><a name="l00965"></a><span class="lineno">  965</span>&#160;   t30_set_supported_modems(p-&gt;<a class="code" href="../../d2/d70/structspandsp__pvt.html#adcd6f30baf585999693211a967c2db61">t30_state</a>, <a class="code" href="../../d5/d47/res__fax__spandsp_8c.html#a727760f4638f2c84101218ce5e89d567">spandsp_modems</a>(s-&gt;<a class="code" href="../../d1/d16/structast__fax__session.html#ae7b633178d301df70e8612b4ce1aeb77">details</a>));</div><div class="line"><a name="l00966"></a><span class="lineno">  966</span>&#160;</div><div class="line"><a name="l00967"></a><span class="lineno">  967</span>&#160;   <span class="comment">/* perhaps set_transmit_on_idle() should be called */</span></div><div class="line"><a name="l00968"></a><span class="lineno">  968</span>&#160;</div><div class="line"><a name="l00969"></a><span class="lineno">  969</span>&#160;   t30_set_phase_e_handler(p-&gt;<a class="code" href="../../d2/d70/structspandsp__pvt.html#adcd6f30baf585999693211a967c2db61">t30_state</a>, <a class="code" href="../../d5/d47/res__fax__spandsp_8c.html#a12890f182233a7dfd042518081c71cce">t30_phase_e_handler</a>, s);</div><div class="line"><a name="l00970"></a><span class="lineno">  970</span>&#160;</div><div class="line"><a name="l00971"></a><span class="lineno">  971</span>&#160;   <span class="comment">/* set T.38 parameters */</span></div><div class="line"><a name="l00972"></a><span class="lineno">  972</span>&#160;   <span class="keywordflow">if</span> (p-&gt;<a class="code" href="../../d2/d70/structspandsp__pvt.html#a9e04fe7f94b31b90af8617c4114973c6">ist38</a>) {</div><div class="line"><a name="l00973"></a><span class="lineno">  973</span>&#160;      <a class="code" href="../../d5/d47/res__fax__spandsp_8c.html#a7a848b476ce6571398d94f5eb74f3182">set_logging</a>(&amp;p-&gt;<a class="code" href="../../d2/d70/structspandsp__pvt.html#a2771e36a55ef2406a468f480426f3f90">t38_core_state</a>-&gt;logging, s-&gt;<a class="code" href="../../d1/d16/structast__fax__session.html#ae7b633178d301df70e8612b4ce1aeb77">details</a>);</div><div class="line"><a name="l00974"></a><span class="lineno">  974</span>&#160;</div><div class="line"><a name="l00975"></a><span class="lineno">  975</span>&#160;      t38_set_max_datagram_size(p-&gt;<a class="code" href="../../d2/d70/structspandsp__pvt.html#a2771e36a55ef2406a468f480426f3f90">t38_core_state</a>, s-&gt;<a class="code" href="../../d1/d16/structast__fax__session.html#ae7b633178d301df70e8612b4ce1aeb77">details</a>-&gt;<a class="code" href="../../d8/dc2/structast__fax__session__details.html#a12cc2bfdcc88e94984d001cca6fefdc5">their_t38_parameters</a>.<a class="code" href="../../d3/df6/structast__fax__t38__parameters.html#a7924cc45cde640e779a902c4aadaf180">max_ifp</a>);</div><div class="line"><a name="l00976"></a><span class="lineno">  976</span>&#160;</div><div class="line"><a name="l00977"></a><span class="lineno">  977</span>&#160;      <span class="keywordflow">if</span> (s-&gt;<a class="code" href="../../d1/d16/structast__fax__session.html#ae7b633178d301df70e8612b4ce1aeb77">details</a>-&gt;<a class="code" href="../../d8/dc2/structast__fax__session__details.html#a12cc2bfdcc88e94984d001cca6fefdc5">their_t38_parameters</a>.<a class="code" href="../../d3/df6/structast__fax__t38__parameters.html#addb721c952a7144f0a6a9ac5f621d2bc">fill_bit_removal</a>) {</div><div class="line"><a name="l00978"></a><span class="lineno">  978</span>&#160;         t38_set_fill_bit_removal(p-&gt;<a class="code" href="../../d2/d70/structspandsp__pvt.html#a2771e36a55ef2406a468f480426f3f90">t38_core_state</a>, <a class="code" href="../../de/dfe/app__minivm_8c.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>);</div><div class="line"><a name="l00979"></a><span class="lineno">  979</span>&#160;      }</div><div class="line"><a name="l00980"></a><span class="lineno">  980</span>&#160;</div><div class="line"><a name="l00981"></a><span class="lineno">  981</span>&#160;      <span class="keywordflow">if</span> (s-&gt;<a class="code" href="../../d1/d16/structast__fax__session.html#ae7b633178d301df70e8612b4ce1aeb77">details</a>-&gt;<a class="code" href="../../d8/dc2/structast__fax__session__details.html#a12cc2bfdcc88e94984d001cca6fefdc5">their_t38_parameters</a>.<a class="code" href="../../d3/df6/structast__fax__t38__parameters.html#ad2b3d53474db70e3ff2058da953b7b82">transcoding_mmr</a>) {</div><div class="line"><a name="l00982"></a><span class="lineno">  982</span>&#160;         t38_set_mmr_transcoding(p-&gt;<a class="code" href="../../d2/d70/structspandsp__pvt.html#a2771e36a55ef2406a468f480426f3f90">t38_core_state</a>, <a class="code" href="../../de/dfe/app__minivm_8c.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>);</div><div class="line"><a name="l00983"></a><span class="lineno">  983</span>&#160;      }</div><div class="line"><a name="l00984"></a><span class="lineno">  984</span>&#160;</div><div class="line"><a name="l00985"></a><span class="lineno">  985</span>&#160;      <span class="keywordflow">if</span> (s-&gt;<a class="code" href="../../d1/d16/structast__fax__session.html#ae7b633178d301df70e8612b4ce1aeb77">details</a>-&gt;<a class="code" href="../../d8/dc2/structast__fax__session__details.html#a12cc2bfdcc88e94984d001cca6fefdc5">their_t38_parameters</a>.<a class="code" href="../../d3/df6/structast__fax__t38__parameters.html#a07676322ec48c4872f9a208a6248d034">transcoding_jbig</a>) {</div><div class="line"><a name="l00986"></a><span class="lineno">  986</span>&#160;         t38_set_jbig_transcoding(p-&gt;<a class="code" href="../../d2/d70/structspandsp__pvt.html#a2771e36a55ef2406a468f480426f3f90">t38_core_state</a>, <a class="code" href="../../de/dfe/app__minivm_8c.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>);</div><div class="line"><a name="l00987"></a><span class="lineno">  987</span>&#160;      }</div><div class="line"><a name="l00988"></a><span class="lineno">  988</span>&#160;   } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00989"></a><span class="lineno">  989</span>&#160;      <span class="comment">/* have the fax stack generate silence if it has no data to send */</span></div><div class="line"><a name="l00990"></a><span class="lineno">  990</span>&#160;      fax_set_transmit_on_idle(&amp;p-&gt;<a class="code" href="../../d2/d70/structspandsp__pvt.html#a6209294447011868d1a0ec7373bb90b5">fax_state</a>, 1);</div><div class="line"><a name="l00991"></a><span class="lineno">  991</span>&#160;   }</div><div class="line"><a name="l00992"></a><span class="lineno">  992</span>&#160;</div><div class="line"><a name="l00993"></a><span class="lineno">  993</span>&#160;</div><div class="line"><a name="l00994"></a><span class="lineno">  994</span>&#160;   <span class="comment">/* start the timer */</span></div><div class="line"><a name="l00995"></a><span class="lineno">  995</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../db/d41/timing_8h.html#a4dae39fb5fb680a48a05d7567053eb03">ast_timer_set_rate</a>(p-&gt;<a class="code" href="../../d2/d70/structspandsp__pvt.html#a9aed6490b63794e6c9c00af4533f255f">timer</a>, <a class="code" href="../../d5/d47/res__fax__spandsp_8c.html#a9865dea3c8d3c70c21e466560f339210">SPANDSP_FAX_TIMER_RATE</a>)) {</div><div class="line"><a name="l00996"></a><span class="lineno">  996</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;FAX session &#39;%u&#39; error setting rate on timing source.\n&quot;</span>, s-&gt;<a class="code" href="../../d1/d16/structast__fax__session.html#ab7ce6f462afaf105224b0ca772a33c43">id</a>);</div><div class="line"><a name="l00997"></a><span class="lineno">  997</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l00998"></a><span class="lineno">  998</span>&#160;   }</div><div class="line"><a name="l00999"></a><span class="lineno">  999</span>&#160;</div><div class="line"><a name="l01000"></a><span class="lineno"> 1000</span>&#160;   s-&gt;<a class="code" href="../../d1/d16/structast__fax__session.html#ad8f346e1752edcc0b1a6b431b1749f0e">state</a> = <a class="code" href="../../db/d6a/res__fax_8h.html#ab34810136037068a0847bcca2518112ca59afc86be1c4be9a01c3cd178c4337b2">AST_FAX_STATE_ACTIVE</a>;</div><div class="line"><a name="l01001"></a><span class="lineno"> 1001</span>&#160;</div><div class="line"><a name="l01002"></a><span class="lineno"> 1002</span>&#160;   <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l01003"></a><span class="lineno"> 1003</span>&#160;}</div><div class="line"><a name="l01004"></a><span class="lineno"> 1004</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01005"></a><span class="lineno"> 1005</span>&#160;<span class="comment">/*! \brief */</span></div><div class="line"><a name="l01006"></a><span class="lineno"><a class="line" href="../../d5/d47/res__fax__spandsp_8c.html#aaae8190167c94ac97553e0377398eb6c"> 1006</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d5/d47/res__fax__spandsp_8c.html#aaae8190167c94ac97553e0377398eb6c">spandsp_fax_cancel</a>(<span class="keyword">struct</span> <a class="code" href="../../d1/d16/structast__fax__session.html">ast_fax_session</a> *s)</div><div class="line"><a name="l01007"></a><span class="lineno"> 1007</span>&#160;{</div><div class="line"><a name="l01008"></a><span class="lineno"> 1008</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d2/d70/structspandsp__pvt.html">spandsp_pvt</a> *p = s-&gt;<a class="code" href="../../d1/d16/structast__fax__session.html#a19aa04db5508cf9496602e694dc69e2f">tech_pvt</a>;</div><div class="line"><a name="l01009"></a><span class="lineno"> 1009</span>&#160;</div><div class="line"><a name="l01010"></a><span class="lineno"> 1010</span>&#160;   <span class="keywordflow">if</span> (s-&gt;<a class="code" href="../../d1/d16/structast__fax__session.html#ae7b633178d301df70e8612b4ce1aeb77">details</a>-&gt;<a class="code" href="../../d8/dc2/structast__fax__session__details.html#ad75375cdd336e91cbcee4a829fcdabfe">caps</a> &amp; <a class="code" href="../../db/d6a/res__fax_8h.html#a54eb45ad548b874cf12d0a599631e3f6add135550dca7400fb80e250a63a54887">AST_FAX_TECH_GATEWAY</a>) {</div><div class="line"><a name="l01011"></a><span class="lineno"> 1011</span>&#160;      p-&gt;<a class="code" href="../../d2/d70/structspandsp__pvt.html#af2bd73f7c4fe9e40a5d5cb75dcbca598">isdone</a> = 1;</div><div class="line"><a name="l01012"></a><span class="lineno"> 1012</span>&#160;      <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l01013"></a><span class="lineno"> 1013</span>&#160;   }</div><div class="line"><a name="l01014"></a><span class="lineno"> 1014</span>&#160;</div><div class="line"><a name="l01015"></a><span class="lineno"> 1015</span>&#160;   t30_terminate(p-&gt;<a class="code" href="../../d2/d70/structspandsp__pvt.html#adcd6f30baf585999693211a967c2db61">t30_state</a>);</div><div class="line"><a name="l01016"></a><span class="lineno"> 1016</span>&#160;   p-&gt;<a class="code" href="../../d2/d70/structspandsp__pvt.html#af2bd73f7c4fe9e40a5d5cb75dcbca598">isdone</a> = 1;</div><div class="line"><a name="l01017"></a><span class="lineno"> 1017</span>&#160;   <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l01018"></a><span class="lineno"> 1018</span>&#160;}</div><div class="line"><a name="l01019"></a><span class="lineno"> 1019</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01020"></a><span class="lineno"> 1020</span>&#160;<span class="comment">/*! \brief */</span></div><div class="line"><a name="l01021"></a><span class="lineno"><a class="line" href="../../d5/d47/res__fax__spandsp_8c.html#a41b864f49450e34700ff878ffc337192"> 1021</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d5/d47/res__fax__spandsp_8c.html#a41b864f49450e34700ff878ffc337192">spandsp_fax_switch_to_t38</a>(<span class="keyword">struct</span> <a class="code" href="../../d1/d16/structast__fax__session.html">ast_fax_session</a> *s)</div><div class="line"><a name="l01022"></a><span class="lineno"> 1022</span>&#160;{</div><div class="line"><a name="l01023"></a><span class="lineno"> 1023</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d2/d70/structspandsp__pvt.html">spandsp_pvt</a> *p = s-&gt;<a class="code" href="../../d1/d16/structast__fax__session.html#a19aa04db5508cf9496602e694dc69e2f">tech_pvt</a>;</div><div class="line"><a name="l01024"></a><span class="lineno"> 1024</span>&#160;</div><div class="line"><a name="l01025"></a><span class="lineno"> 1025</span>&#160;   <span class="comment">/* prevent the phase E handler from running, this is not a real termination */</span></div><div class="line"><a name="l01026"></a><span class="lineno"> 1026</span>&#160;   t30_set_phase_e_handler(p-&gt;<a class="code" href="../../d2/d70/structspandsp__pvt.html#adcd6f30baf585999693211a967c2db61">t30_state</a>, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div><div class="line"><a name="l01027"></a><span class="lineno"> 1027</span>&#160;</div><div class="line"><a name="l01028"></a><span class="lineno"> 1028</span>&#160;   t30_terminate(p-&gt;<a class="code" href="../../d2/d70/structspandsp__pvt.html#adcd6f30baf585999693211a967c2db61">t30_state</a>);</div><div class="line"><a name="l01029"></a><span class="lineno"> 1029</span>&#160;</div><div class="line"><a name="l01030"></a><span class="lineno"> 1030</span>&#160;   s-&gt;<a class="code" href="../../d1/d16/structast__fax__session.html#ae7b633178d301df70e8612b4ce1aeb77">details</a>-&gt;<a class="code" href="../../d8/dc2/structast__fax__session__details.html#a3ab211dbe8780b7292257f6b3dba1952">option</a>.<a class="code" href="../../d8/dc2/structast__fax__session__details.html#a84169e19a7a3f0c9401ad500f0c50f54">switch_to_t38</a> = 1;</div><div class="line"><a name="l01031"></a><span class="lineno"> 1031</span>&#160;   <a class="code" href="../../dd/d42/lock_8h.html#a8a3bd496edfec04a95683ace66676200">ast_atomic_fetchadd_int</a>(&amp;p-&gt;<a class="code" href="../../d2/d70/structspandsp__pvt.html#a1b5003edd88843375153c462a72343f3">stats</a>-&gt;<a class="code" href="../../dd/df2/structspandsp__fax__stats.html#a38e2c3144ba423a7ddfdcbea40cc798c">switched</a>, 1);</div><div class="line"><a name="l01032"></a><span class="lineno"> 1032</span>&#160;</div><div class="line"><a name="l01033"></a><span class="lineno"> 1033</span>&#160;   p-&gt;<a class="code" href="../../d2/d70/structspandsp__pvt.html#a9e04fe7f94b31b90af8617c4114973c6">ist38</a> = 1;</div><div class="line"><a name="l01034"></a><span class="lineno"> 1034</span>&#160;   p-&gt;<a class="code" href="../../d2/d70/structspandsp__pvt.html#a1b5003edd88843375153c462a72343f3">stats</a> = &amp;<a class="code" href="../../d5/d47/res__fax__spandsp_8c.html#a589319dce057e148f17f370ca3ba2a95">spandsp_global_stats</a>.t38;</div><div class="line"><a name="l01035"></a><span class="lineno"> 1035</span>&#160;   <a class="code" href="../../d5/d47/res__fax__spandsp_8c.html#ae8ab5a74bae7f83dd7cad98eb9deeb98">spandsp_fax_start</a>(s);</div><div class="line"><a name="l01036"></a><span class="lineno"> 1036</span>&#160;</div><div class="line"><a name="l01037"></a><span class="lineno"> 1037</span>&#160;   <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l01038"></a><span class="lineno"> 1038</span>&#160;}</div><div class="line"><a name="l01039"></a><span class="lineno"> 1039</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01040"></a><span class="lineno"> 1040</span>&#160;<span class="comment">/*! \brief */</span></div><div class="line"><a name="l01041"></a><span class="lineno"><a class="line" href="../../d5/d47/res__fax__spandsp_8c.html#a83441be7baa98d2b8382dc027a8f2dee"> 1041</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">char</span> *<a class="code" href="../../d5/d47/res__fax__spandsp_8c.html#a83441be7baa98d2b8382dc027a8f2dee">spandsp_fax_cli_show_capabilities</a>(<span class="keywordtype">int</span> fd)</div><div class="line"><a name="l01042"></a><span class="lineno"> 1042</span>&#160;{</div><div class="line"><a name="l01043"></a><span class="lineno"> 1043</span>&#160;   <a class="code" href="../../dc/db0/cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(fd, <span class="stringliteral">&quot;SEND RECEIVE T.38 G.711 GATEWAY\n\n&quot;</span>);</div><div class="line"><a name="l01044"></a><span class="lineno"> 1044</span>&#160;   <span class="keywordflow">return</span>  <a class="code" href="../../dc/db0/cli_8h.html#a50989f00b32eeb2516a3803cb2ffb766">CLI_SUCCESS</a>;</div><div class="line"><a name="l01045"></a><span class="lineno"> 1045</span>&#160;}</div><div class="line"><a name="l01046"></a><span class="lineno"> 1046</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01047"></a><span class="lineno"> 1047</span>&#160;<span class="comment">/*! \brief */</span></div><div class="line"><a name="l01048"></a><span class="lineno"><a class="line" href="../../d5/d47/res__fax__spandsp_8c.html#a193ec436c3481c1121eb872cd2e9ad0d"> 1048</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">char</span> *<a class="code" href="../../d5/d47/res__fax__spandsp_8c.html#a193ec436c3481c1121eb872cd2e9ad0d">spandsp_fax_cli_show_session</a>(<span class="keyword">struct</span> <a class="code" href="../../d1/d16/structast__fax__session.html">ast_fax_session</a> *s, <span class="keywordtype">int</span> fd)</div><div class="line"><a name="l01049"></a><span class="lineno"> 1049</span>&#160;{</div><div class="line"><a name="l01050"></a><span class="lineno"> 1050</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#aa9fdb5d0a6157a56060d9f7279fe6c49">ao2_lock</a>(s);</div><div class="line"><a name="l01051"></a><span class="lineno"> 1051</span>&#160;   <span class="keywordflow">if</span> (s-&gt;<a class="code" href="../../d1/d16/structast__fax__session.html#ae7b633178d301df70e8612b4ce1aeb77">details</a>-&gt;<a class="code" href="../../d8/dc2/structast__fax__session__details.html#ad75375cdd336e91cbcee4a829fcdabfe">caps</a> &amp; <a class="code" href="../../db/d6a/res__fax_8h.html#a54eb45ad548b874cf12d0a599631e3f6add135550dca7400fb80e250a63a54887">AST_FAX_TECH_GATEWAY</a>) {</div><div class="line"><a name="l01052"></a><span class="lineno"> 1052</span>&#160;      <span class="keyword">struct </span><a class="code" href="../../d2/d70/structspandsp__pvt.html">spandsp_pvt</a> *p = s-&gt;<a class="code" href="../../d1/d16/structast__fax__session.html#a19aa04db5508cf9496602e694dc69e2f">tech_pvt</a>;</div><div class="line"><a name="l01053"></a><span class="lineno"> 1053</span>&#160;</div><div class="line"><a name="l01054"></a><span class="lineno"> 1054</span>&#160;      <a class="code" href="../../dc/db0/cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(fd, <span class="stringliteral">&quot;%-22s : %u\n&quot;</span>, <span class="stringliteral">&quot;session&quot;</span>, s-&gt;<a class="code" href="../../d1/d16/structast__fax__session.html#ab7ce6f462afaf105224b0ca772a33c43">id</a>);</div><div class="line"><a name="l01055"></a><span class="lineno"> 1055</span>&#160;      <a class="code" href="../../dc/db0/cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(fd, <span class="stringliteral">&quot;%-22s : %s\n&quot;</span>, <span class="stringliteral">&quot;operation&quot;</span>, <span class="stringliteral">&quot;Gateway&quot;</span>);</div><div class="line"><a name="l01056"></a><span class="lineno"> 1056</span>&#160;      <a class="code" href="../../dc/db0/cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(fd, <span class="stringliteral">&quot;%-22s : %s\n&quot;</span>, <span class="stringliteral">&quot;state&quot;</span>, <a class="code" href="../../db/d6a/res__fax_8h.html#a70598462f8d1c09bb43e7a7091498e53">ast_fax_state_to_str</a>(s-&gt;<a class="code" href="../../d1/d16/structast__fax__session.html#ad8f346e1752edcc0b1a6b431b1749f0e">state</a>));</div><div class="line"><a name="l01057"></a><span class="lineno"> 1057</span>&#160;      <span class="keywordflow">if</span> (s-&gt;<a class="code" href="../../d1/d16/structast__fax__session.html#ad8f346e1752edcc0b1a6b431b1749f0e">state</a> != <a class="code" href="../../db/d6a/res__fax_8h.html#ab34810136037068a0847bcca2518112cad2e2632aa1b6333fcd0e89c554d0df54">AST_FAX_STATE_UNINITIALIZED</a>) {</div><div class="line"><a name="l01058"></a><span class="lineno"> 1058</span>&#160;         t38_stats_t <a class="code" href="../../d2/d70/structspandsp__pvt.html#a1b5003edd88843375153c462a72343f3">stats</a>;</div><div class="line"><a name="l01059"></a><span class="lineno"> 1059</span>&#160;         t38_gateway_get_transfer_statistics(&amp;p-&gt;<a class="code" href="../../d2/d70/structspandsp__pvt.html#ad8cd454d1a02eee0cc27ea8819530ecd">t38_gw_state</a>, &amp;stats);</div><div class="line"><a name="l01060"></a><span class="lineno"> 1060</span>&#160;         <a class="code" href="../../dc/db0/cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(fd, <span class="stringliteral">&quot;%-22s : %s\n&quot;</span>, <span class="stringliteral">&quot;ECM Mode&quot;</span>, stats.error_correcting_mode ? <span class="stringliteral">&quot;Yes&quot;</span> : <span class="stringliteral">&quot;No&quot;</span>);</div><div class="line"><a name="l01061"></a><span class="lineno"> 1061</span>&#160;         <a class="code" href="../../dc/db0/cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(fd, <span class="stringliteral">&quot;%-22s : %d\n&quot;</span>, <span class="stringliteral">&quot;Data Rate&quot;</span>, stats.bit_rate);</div><div class="line"><a name="l01062"></a><span class="lineno"> 1062</span>&#160;         <a class="code" href="../../dc/db0/cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(fd, <span class="stringliteral">&quot;%-22s : %d\n&quot;</span>, <span class="stringliteral">&quot;Page Number&quot;</span>, stats.pages_transferred + 1);</div><div class="line"><a name="l01063"></a><span class="lineno"> 1063</span>&#160;      }</div><div class="line"><a name="l01064"></a><span class="lineno"> 1064</span>&#160;   } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (s-&gt;<a class="code" href="../../d1/d16/structast__fax__session.html#ae7b633178d301df70e8612b4ce1aeb77">details</a>-&gt;<a class="code" href="../../d8/dc2/structast__fax__session__details.html#ad75375cdd336e91cbcee4a829fcdabfe">caps</a> &amp; <a class="code" href="../../db/d6a/res__fax_8h.html#a54eb45ad548b874cf12d0a599631e3f6a9138c48a79016bfccdd7cee6197cb21c">AST_FAX_TECH_V21_DETECT</a>) {</div><div class="line"><a name="l01065"></a><span class="lineno"> 1065</span>&#160;      <a class="code" href="../../dc/db0/cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(fd, <span class="stringliteral">&quot;%-22s : %u\n&quot;</span>, <span class="stringliteral">&quot;session&quot;</span>, s-&gt;<a class="code" href="../../d1/d16/structast__fax__session.html#ab7ce6f462afaf105224b0ca772a33c43">id</a>);</div><div class="line"><a name="l01066"></a><span class="lineno"> 1066</span>&#160;      <a class="code" href="../../dc/db0/cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(fd, <span class="stringliteral">&quot;%-22s : %s\n&quot;</span>, <span class="stringliteral">&quot;operation&quot;</span>, <span class="stringliteral">&quot;V.21 Detect&quot;</span>);</div><div class="line"><a name="l01067"></a><span class="lineno"> 1067</span>&#160;      <a class="code" href="../../dc/db0/cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(fd, <span class="stringliteral">&quot;%-22s : %s\n&quot;</span>, <span class="stringliteral">&quot;state&quot;</span>, <a class="code" href="../../db/d6a/res__fax_8h.html#a70598462f8d1c09bb43e7a7091498e53">ast_fax_state_to_str</a>(s-&gt;<a class="code" href="../../d1/d16/structast__fax__session.html#ad8f346e1752edcc0b1a6b431b1749f0e">state</a>));</div><div class="line"><a name="l01068"></a><span class="lineno"> 1068</span>&#160;   } <span class="keywordflow">else</span> {</div><div class="line"><a name="l01069"></a><span class="lineno"> 1069</span>&#160;      <span class="keyword">struct </span><a class="code" href="../../d2/d70/structspandsp__pvt.html">spandsp_pvt</a> *p = s-&gt;<a class="code" href="../../d1/d16/structast__fax__session.html#a19aa04db5508cf9496602e694dc69e2f">tech_pvt</a>;</div><div class="line"><a name="l01070"></a><span class="lineno"> 1070</span>&#160;</div><div class="line"><a name="l01071"></a><span class="lineno"> 1071</span>&#160;      <a class="code" href="../../dc/db0/cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(fd, <span class="stringliteral">&quot;%-22s : %u\n&quot;</span>, <span class="stringliteral">&quot;session&quot;</span>, s-&gt;<a class="code" href="../../d1/d16/structast__fax__session.html#ab7ce6f462afaf105224b0ca772a33c43">id</a>);</div><div class="line"><a name="l01072"></a><span class="lineno"> 1072</span>&#160;      <a class="code" href="../../dc/db0/cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(fd, <span class="stringliteral">&quot;%-22s : %s\n&quot;</span>, <span class="stringliteral">&quot;operation&quot;</span>, (s-&gt;<a class="code" href="../../d1/d16/structast__fax__session.html#ae7b633178d301df70e8612b4ce1aeb77">details</a>-&gt;<a class="code" href="../../d8/dc2/structast__fax__session__details.html#ad75375cdd336e91cbcee4a829fcdabfe">caps</a> &amp; <a class="code" href="../../db/d6a/res__fax_8h.html#a54eb45ad548b874cf12d0a599631e3f6a77bcc28b15614142ddbf4a180d263602">AST_FAX_TECH_RECEIVE</a>) ? <span class="stringliteral">&quot;Receive&quot;</span> : <span class="stringliteral">&quot;Transmit&quot;</span>);</div><div class="line"><a name="l01073"></a><span class="lineno"> 1073</span>&#160;      <a class="code" href="../../dc/db0/cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(fd, <span class="stringliteral">&quot;%-22s : %s\n&quot;</span>, <span class="stringliteral">&quot;state&quot;</span>, <a class="code" href="../../db/d6a/res__fax_8h.html#a70598462f8d1c09bb43e7a7091498e53">ast_fax_state_to_str</a>(s-&gt;<a class="code" href="../../d1/d16/structast__fax__session.html#ad8f346e1752edcc0b1a6b431b1749f0e">state</a>));</div><div class="line"><a name="l01074"></a><span class="lineno"> 1074</span>&#160;      <span class="keywordflow">if</span> (s-&gt;<a class="code" href="../../d1/d16/structast__fax__session.html#ad8f346e1752edcc0b1a6b431b1749f0e">state</a> != <a class="code" href="../../db/d6a/res__fax_8h.html#ab34810136037068a0847bcca2518112cad2e2632aa1b6333fcd0e89c554d0df54">AST_FAX_STATE_UNINITIALIZED</a>) {</div><div class="line"><a name="l01075"></a><span class="lineno"> 1075</span>&#160;         t30_stats_t <a class="code" href="../../d2/d70/structspandsp__pvt.html#a1b5003edd88843375153c462a72343f3">stats</a>;</div><div class="line"><a name="l01076"></a><span class="lineno"> 1076</span>&#160;         t30_get_transfer_statistics(p-&gt;<a class="code" href="../../d2/d70/structspandsp__pvt.html#adcd6f30baf585999693211a967c2db61">t30_state</a>, &amp;stats);</div><div class="line"><a name="l01077"></a><span class="lineno"> 1077</span>&#160;         <a class="code" href="../../dc/db0/cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(fd, <span class="stringliteral">&quot;%-22s : %s\n&quot;</span>, <span class="stringliteral">&quot;Last Status&quot;</span>, t30_completion_code_to_str(stats.current_status));</div><div class="line"><a name="l01078"></a><span class="lineno"> 1078</span>&#160;         <a class="code" href="../../dc/db0/cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(fd, <span class="stringliteral">&quot;%-22s : %s\n&quot;</span>, <span class="stringliteral">&quot;ECM Mode&quot;</span>, stats.error_correcting_mode ? <span class="stringliteral">&quot;Yes&quot;</span> : <span class="stringliteral">&quot;No&quot;</span>);</div><div class="line"><a name="l01079"></a><span class="lineno"> 1079</span>&#160;         <a class="code" href="../../dc/db0/cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(fd, <span class="stringliteral">&quot;%-22s : %d\n&quot;</span>, <span class="stringliteral">&quot;Data Rate&quot;</span>, stats.bit_rate);</div><div class="line"><a name="l01080"></a><span class="lineno"> 1080</span>&#160;         <a class="code" href="../../dc/db0/cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(fd, <span class="stringliteral">&quot;%-22s : %dx%d\n&quot;</span>, <span class="stringliteral">&quot;Image Resolution&quot;</span>, stats.x_resolution, stats.y_resolution);</div><div class="line"><a name="l01081"></a><span class="lineno"> 1081</span>&#160;<span class="preprocessor">#if SPANDSP_RELEASE_DATE &gt;= 20090220</span></div><div class="line"><a name="l01082"></a><span class="lineno"> 1082</span>&#160;         <a class="code" href="../../dc/db0/cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(fd, <span class="stringliteral">&quot;%-22s : %d\n&quot;</span>, <span class="stringliteral">&quot;Page Number&quot;</span>, ((s-&gt;<a class="code" href="../../d1/d16/structast__fax__session.html#ae7b633178d301df70e8612b4ce1aeb77">details</a>-&gt;<a class="code" href="../../d8/dc2/structast__fax__session__details.html#ad75375cdd336e91cbcee4a829fcdabfe">caps</a> &amp; <a class="code" href="../../db/d6a/res__fax_8h.html#a54eb45ad548b874cf12d0a599631e3f6a77bcc28b15614142ddbf4a180d263602">AST_FAX_TECH_RECEIVE</a>) ? stats.pages_rx : stats.pages_tx) + 1);</div><div class="line"><a name="l01083"></a><span class="lineno"> 1083</span>&#160;<span class="preprocessor">#else</span></div><div class="line"><a name="l01084"></a><span class="lineno"> 1084</span>&#160;         <a class="code" href="../../dc/db0/cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(fd, <span class="stringliteral">&quot;%-22s : %d\n&quot;</span>, <span class="stringliteral">&quot;Page Number&quot;</span>, stats.pages_transferred + 1);</div><div class="line"><a name="l01085"></a><span class="lineno"> 1085</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l01086"></a><span class="lineno"> 1086</span>&#160;         <a class="code" href="../../dc/db0/cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(fd, <span class="stringliteral">&quot;%-22s : %s\n&quot;</span>, <span class="stringliteral">&quot;File Name&quot;</span>, s-&gt;<a class="code" href="../../d1/d16/structast__fax__session.html#ae7b633178d301df70e8612b4ce1aeb77">details</a>-&gt;<a class="code" href="../../d8/dc2/structast__fax__session__details.html#ad75375cdd336e91cbcee4a829fcdabfe">caps</a> &amp; <a class="code" href="../../db/d6a/res__fax_8h.html#a54eb45ad548b874cf12d0a599631e3f6a77bcc28b15614142ddbf4a180d263602">AST_FAX_TECH_RECEIVE</a> ? p-&gt;<a class="code" href="../../d2/d70/structspandsp__pvt.html#adcd6f30baf585999693211a967c2db61">t30_state</a>-&gt;rx_file : p-&gt;<a class="code" href="../../d2/d70/structspandsp__pvt.html#adcd6f30baf585999693211a967c2db61">t30_state</a>-&gt;tx_file);</div><div class="line"><a name="l01087"></a><span class="lineno"> 1087</span>&#160;</div><div class="line"><a name="l01088"></a><span class="lineno"> 1088</span>&#160;         <a class="code" href="../../dc/db0/cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(fd, <span class="stringliteral">&quot;\nData Statistics:\n&quot;</span>);</div><div class="line"><a name="l01089"></a><span class="lineno"> 1089</span>&#160;<span class="preprocessor">#if SPANDSP_RELEASE_DATE &gt;= 20090220</span></div><div class="line"><a name="l01090"></a><span class="lineno"> 1090</span>&#160;         <a class="code" href="../../dc/db0/cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(fd, <span class="stringliteral">&quot;%-22s : %d\n&quot;</span>, <span class="stringliteral">&quot;Tx Pages&quot;</span>, stats.pages_tx);</div><div class="line"><a name="l01091"></a><span class="lineno"> 1091</span>&#160;         <a class="code" href="../../dc/db0/cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(fd, <span class="stringliteral">&quot;%-22s : %d\n&quot;</span>, <span class="stringliteral">&quot;Rx Pages&quot;</span>, stats.pages_rx);</div><div class="line"><a name="l01092"></a><span class="lineno"> 1092</span>&#160;<span class="preprocessor">#else</span></div><div class="line"><a name="l01093"></a><span class="lineno"> 1093</span>&#160;         <a class="code" href="../../dc/db0/cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(fd, <span class="stringliteral">&quot;%-22s : %d\n&quot;</span>, <span class="stringliteral">&quot;Tx Pages&quot;</span>, (s-&gt;<a class="code" href="../../d1/d16/structast__fax__session.html#ae7b633178d301df70e8612b4ce1aeb77">details</a>-&gt;<a class="code" href="../../d8/dc2/structast__fax__session__details.html#ad75375cdd336e91cbcee4a829fcdabfe">caps</a> &amp; <a class="code" href="../../db/d6a/res__fax_8h.html#a54eb45ad548b874cf12d0a599631e3f6adbf07d8224b1a548ccae3b994653003b">AST_FAX_TECH_SEND</a>) ? stats.pages_transferred : 0);</div><div class="line"><a name="l01094"></a><span class="lineno"> 1094</span>&#160;         <a class="code" href="../../dc/db0/cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(fd, <span class="stringliteral">&quot;%-22s : %d\n&quot;</span>, <span class="stringliteral">&quot;Rx Pages&quot;</span>, (s-&gt;<a class="code" href="../../d1/d16/structast__fax__session.html#ae7b633178d301df70e8612b4ce1aeb77">details</a>-&gt;<a class="code" href="../../d8/dc2/structast__fax__session__details.html#ad75375cdd336e91cbcee4a829fcdabfe">caps</a> &amp; <a class="code" href="../../db/d6a/res__fax_8h.html#a54eb45ad548b874cf12d0a599631e3f6a77bcc28b15614142ddbf4a180d263602">AST_FAX_TECH_RECEIVE</a>) ? stats.pages_transferred : 0);</div><div class="line"><a name="l01095"></a><span class="lineno"> 1095</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l01096"></a><span class="lineno"> 1096</span>&#160;         <a class="code" href="../../dc/db0/cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(fd, <span class="stringliteral">&quot;%-22s : %d\n&quot;</span>, <span class="stringliteral">&quot;Longest Bad Line Run&quot;</span>, stats.longest_bad_row_run);</div><div class="line"><a name="l01097"></a><span class="lineno"> 1097</span>&#160;         <a class="code" href="../../dc/db0/cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(fd, <span class="stringliteral">&quot;%-22s : %d\n&quot;</span>, <span class="stringliteral">&quot;Total Bad Lines&quot;</span>, stats.bad_rows);</div><div class="line"><a name="l01098"></a><span class="lineno"> 1098</span>&#160;      }</div><div class="line"><a name="l01099"></a><span class="lineno"> 1099</span>&#160;   }</div><div class="line"><a name="l01100"></a><span class="lineno"> 1100</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#a9998bd156b936636a8780385e9a910b2">ao2_unlock</a>(s);</div><div class="line"><a name="l01101"></a><span class="lineno"> 1101</span>&#160;   <a class="code" href="../../dc/db0/cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(fd, <span class="stringliteral">&quot;\n\n&quot;</span>);</div><div class="line"><a name="l01102"></a><span class="lineno"> 1102</span>&#160;   <span class="keywordflow">return</span> <a class="code" href="../../dc/db0/cli_8h.html#a50989f00b32eeb2516a3803cb2ffb766">CLI_SUCCESS</a>;</div><div class="line"><a name="l01103"></a><span class="lineno"> 1103</span>&#160;}</div><div class="line"><a name="l01104"></a><span class="lineno"> 1104</span>&#160;</div><div class="line"><a name="l01105"></a><span class="lineno"><a class="line" href="../../d5/d47/res__fax__spandsp_8c.html#a46ff23b63408b9b6d29a0ed01cdb424d"> 1105</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d5/d47/res__fax__spandsp_8c.html#a46ff23b63408b9b6d29a0ed01cdb424d">spandsp_manager_fax_session</a>(<span class="keyword">struct</span> <a class="code" href="../../d2/d8a/structmansession.html">mansession</a> *s,</div><div class="line"><a name="l01106"></a><span class="lineno"> 1106</span>&#160;   <span class="keyword">const</span> <span class="keywordtype">char</span> *id_text, <span class="keyword">struct</span> <a class="code" href="../../d1/d16/structast__fax__session.html">ast_fax_session</a> *<a class="code" href="../../d2/d4d/astman_8c.html#ac4a6ae0400e4457f0b35beddec80c93d">session</a>)</div><div class="line"><a name="l01107"></a><span class="lineno"> 1107</span>&#160;{</div><div class="line"><a name="l01108"></a><span class="lineno"> 1108</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../dd/da2/structast__str.html">ast_str</a> *message_string;</div><div class="line"><a name="l01109"></a><span class="lineno"> 1109</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d2/d70/structspandsp__pvt.html">spandsp_pvt</a> *span_pvt = session-&gt;<a class="code" href="../../d1/d16/structast__fax__session.html#a19aa04db5508cf9496602e694dc69e2f">tech_pvt</a>;</div><div class="line"><a name="l01110"></a><span class="lineno"> 1110</span>&#160;   <span class="keywordtype">int</span> res;</div><div class="line"><a name="l01111"></a><span class="lineno"> 1111</span>&#160;</div><div class="line"><a name="l01112"></a><span class="lineno"> 1112</span>&#160;   message_string = <a class="code" href="../../d6/d90/strings_8h.html#a9c34c6c6b8daaba24c0406270f3cf697">ast_str_create</a>(128);</div><div class="line"><a name="l01113"></a><span class="lineno"> 1113</span>&#160;</div><div class="line"><a name="l01114"></a><span class="lineno"> 1114</span>&#160;   <span class="keywordflow">if</span> (!message_string) {</div><div class="line"><a name="l01115"></a><span class="lineno"> 1115</span>&#160;      <span class="keywordflow">return</span>;</div><div class="line"><a name="l01116"></a><span class="lineno"> 1116</span>&#160;   }</div><div class="line"><a name="l01117"></a><span class="lineno"> 1117</span>&#160;</div><div class="line"><a name="l01118"></a><span class="lineno"> 1118</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#aa9fdb5d0a6157a56060d9f7279fe6c49">ao2_lock</a>(session);</div><div class="line"><a name="l01119"></a><span class="lineno"> 1119</span>&#160;   res = <a class="code" href="../../d6/d90/strings_8h.html#a1088afdd862a49b0fce34ebe02df8ca1">ast_str_append</a>(&amp;message_string, 0, <span class="stringliteral">&quot;SessionNumber: %u\r\n&quot;</span>, session-&gt;<a class="code" href="../../d1/d16/structast__fax__session.html#ab7ce6f462afaf105224b0ca772a33c43">id</a>);</div><div class="line"><a name="l01120"></a><span class="lineno"> 1120</span>&#160;   res |= <a class="code" href="../../d6/d90/strings_8h.html#a1088afdd862a49b0fce34ebe02df8ca1">ast_str_append</a>(&amp;message_string, 0, <span class="stringliteral">&quot;Operation: %s\r\n&quot;</span>, <a class="code" href="../../db/d6a/res__fax_8h.html#a1b9314c7e94b0f3b703c975b0854519f">ast_fax_session_operation_str</a>(session));</div><div class="line"><a name="l01121"></a><span class="lineno"> 1121</span>&#160;   res |= <a class="code" href="../../d6/d90/strings_8h.html#a1088afdd862a49b0fce34ebe02df8ca1">ast_str_append</a>(&amp;message_string, 0, <span class="stringliteral">&quot;State: %s\r\n&quot;</span>, <a class="code" href="../../db/d6a/res__fax_8h.html#a70598462f8d1c09bb43e7a7091498e53">ast_fax_state_to_str</a>(session-&gt;<a class="code" href="../../d1/d16/structast__fax__session.html#ad8f346e1752edcc0b1a6b431b1749f0e">state</a>));</div><div class="line"><a name="l01122"></a><span class="lineno"> 1122</span>&#160;</div><div class="line"><a name="l01123"></a><span class="lineno"> 1123</span>&#160;   <span class="keywordflow">if</span> (session-&gt;<a class="code" href="../../d1/d16/structast__fax__session.html#ae7b633178d301df70e8612b4ce1aeb77">details</a>-&gt;<a class="code" href="../../d8/dc2/structast__fax__session__details.html#ad75375cdd336e91cbcee4a829fcdabfe">caps</a> &amp; <a class="code" href="../../db/d6a/res__fax_8h.html#a54eb45ad548b874cf12d0a599631e3f6add135550dca7400fb80e250a63a54887">AST_FAX_TECH_GATEWAY</a>) {</div><div class="line"><a name="l01124"></a><span class="lineno"> 1124</span>&#160;      t38_stats_t <a class="code" href="../../d2/d70/structspandsp__pvt.html#a1b5003edd88843375153c462a72343f3">stats</a>;</div><div class="line"><a name="l01125"></a><span class="lineno"> 1125</span>&#160;</div><div class="line"><a name="l01126"></a><span class="lineno"> 1126</span>&#160;      <span class="keywordflow">if</span> (session-&gt;<a class="code" href="../../d1/d16/structast__fax__session.html#ad8f346e1752edcc0b1a6b431b1749f0e">state</a> == <a class="code" href="../../db/d6a/res__fax_8h.html#ab34810136037068a0847bcca2518112cad2e2632aa1b6333fcd0e89c554d0df54">AST_FAX_STATE_UNINITIALIZED</a>) {</div><div class="line"><a name="l01127"></a><span class="lineno"> 1127</span>&#160;         <span class="keywordflow">goto</span> skip_cap_additions;</div><div class="line"><a name="l01128"></a><span class="lineno"> 1128</span>&#160;      }</div><div class="line"><a name="l01129"></a><span class="lineno"> 1129</span>&#160;</div><div class="line"><a name="l01130"></a><span class="lineno"> 1130</span>&#160;      t38_gateway_get_transfer_statistics(&amp;span_pvt-&gt;<a class="code" href="../../d2/d70/structspandsp__pvt.html#ad8cd454d1a02eee0cc27ea8819530ecd">t38_gw_state</a>, &amp;stats);</div><div class="line"><a name="l01131"></a><span class="lineno"> 1131</span>&#160;      res |= <a class="code" href="../../d6/d90/strings_8h.html#a1088afdd862a49b0fce34ebe02df8ca1">ast_str_append</a>(&amp;message_string, 0, <span class="stringliteral">&quot;ErrorCorrectionMode: %s\r\n&quot;</span>,</div><div class="line"><a name="l01132"></a><span class="lineno"> 1132</span>&#160;         stats.error_correcting_mode ? <span class="stringliteral">&quot;yes&quot;</span> : <span class="stringliteral">&quot;no&quot;</span>);</div><div class="line"><a name="l01133"></a><span class="lineno"> 1133</span>&#160;      res |= <a class="code" href="../../d6/d90/strings_8h.html#a1088afdd862a49b0fce34ebe02df8ca1">ast_str_append</a>(&amp;message_string, 0, <span class="stringliteral">&quot;DataRate: %d\r\n&quot;</span>,</div><div class="line"><a name="l01134"></a><span class="lineno"> 1134</span>&#160;         stats.bit_rate);</div><div class="line"><a name="l01135"></a><span class="lineno"> 1135</span>&#160;      res |= <a class="code" href="../../d6/d90/strings_8h.html#a1088afdd862a49b0fce34ebe02df8ca1">ast_str_append</a>(&amp;message_string, 0, <span class="stringliteral">&quot;PageNumber: %d\r\n&quot;</span>,</div><div class="line"><a name="l01136"></a><span class="lineno"> 1136</span>&#160;         stats.pages_transferred + 1);</div><div class="line"><a name="l01137"></a><span class="lineno"> 1137</span>&#160;   } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!(session-&gt;<a class="code" href="../../d1/d16/structast__fax__session.html#ae7b633178d301df70e8612b4ce1aeb77">details</a>-&gt;<a class="code" href="../../d8/dc2/structast__fax__session__details.html#ad75375cdd336e91cbcee4a829fcdabfe">caps</a> &amp; <a class="code" href="../../db/d6a/res__fax_8h.html#a54eb45ad548b874cf12d0a599631e3f6a9138c48a79016bfccdd7cee6197cb21c">AST_FAX_TECH_V21_DETECT</a>)) { <span class="comment">/* caps is SEND/RECEIVE */</span></div><div class="line"><a name="l01138"></a><span class="lineno"> 1138</span>&#160;      t30_stats_t <a class="code" href="../../d2/d70/structspandsp__pvt.html#a1b5003edd88843375153c462a72343f3">stats</a>;</div><div class="line"><a name="l01139"></a><span class="lineno"> 1139</span>&#160;</div><div class="line"><a name="l01140"></a><span class="lineno"> 1140</span>&#160;      <span class="keywordflow">if</span> (session-&gt;<a class="code" href="../../d1/d16/structast__fax__session.html#ad8f346e1752edcc0b1a6b431b1749f0e">state</a> == <a class="code" href="../../db/d6a/res__fax_8h.html#ab34810136037068a0847bcca2518112cad2e2632aa1b6333fcd0e89c554d0df54">AST_FAX_STATE_UNINITIALIZED</a>) {</div><div class="line"><a name="l01141"></a><span class="lineno"> 1141</span>&#160;         <span class="keywordflow">goto</span> skip_cap_additions;</div><div class="line"><a name="l01142"></a><span class="lineno"> 1142</span>&#160;      }</div><div class="line"><a name="l01143"></a><span class="lineno"> 1143</span>&#160;</div><div class="line"><a name="l01144"></a><span class="lineno"> 1144</span>&#160;      t30_get_transfer_statistics(span_pvt-&gt;<a class="code" href="../../d2/d70/structspandsp__pvt.html#adcd6f30baf585999693211a967c2db61">t30_state</a>, &amp;stats);</div><div class="line"><a name="l01145"></a><span class="lineno"> 1145</span>&#160;      res |= <a class="code" href="../../d6/d90/strings_8h.html#a1088afdd862a49b0fce34ebe02df8ca1">ast_str_append</a>(&amp;message_string, 0, <span class="stringliteral">&quot;ErrorCorrectionMode: %s\r\n&quot;</span>,</div><div class="line"><a name="l01146"></a><span class="lineno"> 1146</span>&#160;         stats.error_correcting_mode ? <span class="stringliteral">&quot;Yes&quot;</span> : <span class="stringliteral">&quot;No&quot;</span>);</div><div class="line"><a name="l01147"></a><span class="lineno"> 1147</span>&#160;      res |= <a class="code" href="../../d6/d90/strings_8h.html#a1088afdd862a49b0fce34ebe02df8ca1">ast_str_append</a>(&amp;message_string, 0, <span class="stringliteral">&quot;DataRate: %d\r\n&quot;</span>,</div><div class="line"><a name="l01148"></a><span class="lineno"> 1148</span>&#160;         stats.bit_rate);</div><div class="line"><a name="l01149"></a><span class="lineno"> 1149</span>&#160;      res |= <a class="code" href="../../d6/d90/strings_8h.html#a1088afdd862a49b0fce34ebe02df8ca1">ast_str_append</a>(&amp;message_string, 0, <span class="stringliteral">&quot;ImageResolution: %dx%d\r\n&quot;</span>,</div><div class="line"><a name="l01150"></a><span class="lineno"> 1150</span>&#160;         stats.x_resolution, stats.y_resolution);</div><div class="line"><a name="l01151"></a><span class="lineno"> 1151</span>&#160;<span class="preprocessor">#if SPANDSP_RELEASE_DATE &gt;= 20090220</span></div><div class="line"><a name="l01152"></a><span class="lineno"> 1152</span>&#160;      res |= <a class="code" href="../../d6/d90/strings_8h.html#a1088afdd862a49b0fce34ebe02df8ca1">ast_str_append</a>(&amp;message_string, 0, <span class="stringliteral">&quot;PageNumber: %d\r\n&quot;</span>,</div><div class="line"><a name="l01153"></a><span class="lineno"> 1153</span>&#160;         ((session-&gt;<a class="code" href="../../d1/d16/structast__fax__session.html#ae7b633178d301df70e8612b4ce1aeb77">details</a>-&gt;<a class="code" href="../../d8/dc2/structast__fax__session__details.html#ad75375cdd336e91cbcee4a829fcdabfe">caps</a> &amp; <a class="code" href="../../db/d6a/res__fax_8h.html#a54eb45ad548b874cf12d0a599631e3f6a77bcc28b15614142ddbf4a180d263602">AST_FAX_TECH_RECEIVE</a>) ? stats.pages_rx : stats.pages_tx) + 1);</div><div class="line"><a name="l01154"></a><span class="lineno"> 1154</span>&#160;<span class="preprocessor">#else</span></div><div class="line"><a name="l01155"></a><span class="lineno"> 1155</span>&#160;      res |= <a class="code" href="../../d6/d90/strings_8h.html#a1088afdd862a49b0fce34ebe02df8ca1">ast_str_append</a>(&amp;message_string, 0, <span class="stringliteral">&quot;PageNumber: %d\r\n&quot;</span>,</div><div class="line"><a name="l01156"></a><span class="lineno"> 1156</span>&#160;         stats.pages_transferred + 1);</div><div class="line"><a name="l01157"></a><span class="lineno"> 1157</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l01158"></a><span class="lineno"> 1158</span>&#160;      res |= <a class="code" href="../../d6/d90/strings_8h.html#a1088afdd862a49b0fce34ebe02df8ca1">ast_str_append</a>(&amp;message_string, 0, <span class="stringliteral">&quot;FileName: %s\r\n&quot;</span>,</div><div class="line"><a name="l01159"></a><span class="lineno"> 1159</span>&#160;         session-&gt;<a class="code" href="../../d1/d16/structast__fax__session.html#ae7b633178d301df70e8612b4ce1aeb77">details</a>-&gt;<a class="code" href="../../d8/dc2/structast__fax__session__details.html#ad75375cdd336e91cbcee4a829fcdabfe">caps</a> &amp; <a class="code" href="../../db/d6a/res__fax_8h.html#a54eb45ad548b874cf12d0a599631e3f6a77bcc28b15614142ddbf4a180d263602">AST_FAX_TECH_RECEIVE</a> ? span_pvt-&gt;<a class="code" href="../../d2/d70/structspandsp__pvt.html#adcd6f30baf585999693211a967c2db61">t30_state</a>-&gt;rx_file :</div><div class="line"><a name="l01160"></a><span class="lineno"> 1160</span>&#160;         span_pvt-&gt;<a class="code" href="../../d2/d70/structspandsp__pvt.html#adcd6f30baf585999693211a967c2db61">t30_state</a>-&gt;tx_file);</div><div class="line"><a name="l01161"></a><span class="lineno"> 1161</span>&#160;<span class="preprocessor">#if SPANDSP_RELEASE_DATE &gt;= 20090220</span></div><div class="line"><a name="l01162"></a><span class="lineno"> 1162</span>&#160;      res |= <a class="code" href="../../d6/d90/strings_8h.html#a1088afdd862a49b0fce34ebe02df8ca1">ast_str_append</a>(&amp;message_string, 0, <span class="stringliteral">&quot;PagesTransmitted: %d\r\n&quot;</span>,</div><div class="line"><a name="l01163"></a><span class="lineno"> 1163</span>&#160;         stats.pages_tx);</div><div class="line"><a name="l01164"></a><span class="lineno"> 1164</span>&#160;      res |= <a class="code" href="../../d6/d90/strings_8h.html#a1088afdd862a49b0fce34ebe02df8ca1">ast_str_append</a>(&amp;message_string, 0, <span class="stringliteral">&quot;PagesReceived: %d\r\n&quot;</span>,</div><div class="line"><a name="l01165"></a><span class="lineno"> 1165</span>&#160;         stats.pages_rx);</div><div class="line"><a name="l01166"></a><span class="lineno"> 1166</span>&#160;<span class="preprocessor">#else</span></div><div class="line"><a name="l01167"></a><span class="lineno"> 1167</span>&#160;      res |= <a class="code" href="../../d6/d90/strings_8h.html#a1088afdd862a49b0fce34ebe02df8ca1">ast_str_append</a>(&amp;message_string, 0, <span class="stringliteral">&quot;PagesTransmitted: %d\r\n&quot;</span>,</div><div class="line"><a name="l01168"></a><span class="lineno"> 1168</span>&#160;         (session-&gt;<a class="code" href="../../d1/d16/structast__fax__session.html#ae7b633178d301df70e8612b4ce1aeb77">details</a>-&gt;<a class="code" href="../../d8/dc2/structast__fax__session__details.html#ad75375cdd336e91cbcee4a829fcdabfe">caps</a> &amp; <a class="code" href="../../db/d6a/res__fax_8h.html#a54eb45ad548b874cf12d0a599631e3f6adbf07d8224b1a548ccae3b994653003b">AST_FAX_TECH_SEND</a>) ? stats.pages_transferred : 0);</div><div class="line"><a name="l01169"></a><span class="lineno"> 1169</span>&#160;      res |= <a class="code" href="../../d6/d90/strings_8h.html#a1088afdd862a49b0fce34ebe02df8ca1">ast_str_append</a>(&amp;message_string, 0, <span class="stringliteral">&quot;PagesReceived: %d\r\n&quot;</span>,</div><div class="line"><a name="l01170"></a><span class="lineno"> 1170</span>&#160;         (session-&gt;<a class="code" href="../../d1/d16/structast__fax__session.html#ae7b633178d301df70e8612b4ce1aeb77">details</a>-&gt;<a class="code" href="../../d8/dc2/structast__fax__session__details.html#ad75375cdd336e91cbcee4a829fcdabfe">caps</a> &amp; <a class="code" href="../../db/d6a/res__fax_8h.html#a54eb45ad548b874cf12d0a599631e3f6a77bcc28b15614142ddbf4a180d263602">AST_FAX_TECH_RECEIVE</a>) ? stats.pages_transferred : 0);</div><div class="line"><a name="l01171"></a><span class="lineno"> 1171</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l01172"></a><span class="lineno"> 1172</span>&#160;      res |= <a class="code" href="../../d6/d90/strings_8h.html#a1088afdd862a49b0fce34ebe02df8ca1">ast_str_append</a>(&amp;message_string, 0, <span class="stringliteral">&quot;TotalBadLines: %d\r\n&quot;</span>,</div><div class="line"><a name="l01173"></a><span class="lineno"> 1173</span>&#160;         stats.bad_rows);</div><div class="line"><a name="l01174"></a><span class="lineno"> 1174</span>&#160;   }</div><div class="line"><a name="l01175"></a><span class="lineno"> 1175</span>&#160;</div><div class="line"><a name="l01176"></a><span class="lineno"> 1176</span>&#160;skip_cap_additions:</div><div class="line"><a name="l01177"></a><span class="lineno"> 1177</span>&#160;</div><div class="line"><a name="l01178"></a><span class="lineno"> 1178</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#a9998bd156b936636a8780385e9a910b2">ao2_unlock</a>(session);</div><div class="line"><a name="l01179"></a><span class="lineno"> 1179</span>&#160;</div><div class="line"><a name="l01180"></a><span class="lineno"> 1180</span>&#160;   <span class="keywordflow">if</span> (res &lt; 0) {</div><div class="line"><a name="l01181"></a><span class="lineno"> 1181</span>&#160;      <span class="comment">/* One or more of the ast_str_append attempts failed, cancel the message */</span></div><div class="line"><a name="l01182"></a><span class="lineno"> 1182</span>&#160;      <a class="code" href="../../d8/d8a/astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(message_string);</div><div class="line"><a name="l01183"></a><span class="lineno"> 1183</span>&#160;      <span class="keywordflow">return</span>;</div><div class="line"><a name="l01184"></a><span class="lineno"> 1184</span>&#160;   }</div><div class="line"><a name="l01185"></a><span class="lineno"> 1185</span>&#160;</div><div class="line"><a name="l01186"></a><span class="lineno"> 1186</span>&#160;   <a class="code" href="../../df/d72/group__Group__AMI.html#gac2d42f7be13c532b6a70d50f1b8983d2">astman_append</a>(s, <span class="stringliteral">&quot;Event: FAXSession\r\n&quot;</span></div><div class="line"><a name="l01187"></a><span class="lineno"> 1187</span>&#160;      <span class="stringliteral">&quot;%s&quot;</span></div><div class="line"><a name="l01188"></a><span class="lineno"> 1188</span>&#160;      <span class="stringliteral">&quot;%s&quot;</span></div><div class="line"><a name="l01189"></a><span class="lineno"> 1189</span>&#160;      <span class="stringliteral">&quot;\r\n&quot;</span>,</div><div class="line"><a name="l01190"></a><span class="lineno"> 1190</span>&#160;      id_text,</div><div class="line"><a name="l01191"></a><span class="lineno"> 1191</span>&#160;      <a class="code" href="../../d6/d90/strings_8h.html#a1ef7e2644ca7258070db316fdc0a465b">ast_str_buffer</a>(message_string));</div><div class="line"><a name="l01192"></a><span class="lineno"> 1192</span>&#160;</div><div class="line"><a name="l01193"></a><span class="lineno"> 1193</span>&#160;   <a class="code" href="../../d8/d8a/astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(message_string);</div><div class="line"><a name="l01194"></a><span class="lineno"> 1194</span>&#160;}</div><div class="line"><a name="l01195"></a><span class="lineno"> 1195</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01196"></a><span class="lineno"> 1196</span>&#160;<span class="comment">/*! \brief */</span></div><div class="line"><a name="l01197"></a><span class="lineno"><a class="line" href="../../d5/d47/res__fax__spandsp_8c.html#a632e62933ba50a9269eeeede6e8db7e5"> 1197</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">char</span> *<a class="code" href="../../d5/d47/res__fax__spandsp_8c.html#a632e62933ba50a9269eeeede6e8db7e5">spandsp_fax_cli_show_stats</a>(<span class="keywordtype">int</span> fd)</div><div class="line"><a name="l01198"></a><span class="lineno"> 1198</span>&#160;{</div><div class="line"><a name="l01199"></a><span class="lineno"> 1199</span>&#160;   <a class="code" href="../../dd/d42/lock_8h.html#ac5e13c7fe64d3b271a52028b0a78b92b">ast_mutex_lock</a>(&amp;<a class="code" href="../../d5/d47/res__fax__spandsp_8c.html#a589319dce057e148f17f370ca3ba2a95">spandsp_global_stats</a>.lock);</div><div class="line"><a name="l01200"></a><span class="lineno"> 1200</span>&#160;   <a class="code" href="../../dc/db0/cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(fd, <span class="stringliteral">&quot;\n%-20.20s\n&quot;</span>, <span class="stringliteral">&quot;Spandsp G.711&quot;</span>);</div><div class="line"><a name="l01201"></a><span class="lineno"> 1201</span>&#160;   <a class="code" href="../../dc/db0/cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(fd, <span class="stringliteral">&quot;%-20.20s : %d\n&quot;</span>, <span class="stringliteral">&quot;Success&quot;</span>, <a class="code" href="../../d5/d47/res__fax__spandsp_8c.html#a589319dce057e148f17f370ca3ba2a95">spandsp_global_stats</a>.g711.success);</div><div class="line"><a name="l01202"></a><span class="lineno"> 1202</span>&#160;   <a class="code" href="../../dc/db0/cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(fd, <span class="stringliteral">&quot;%-20.20s : %d\n&quot;</span>, <span class="stringliteral">&quot;Switched to T.38&quot;</span>, <a class="code" href="../../d5/d47/res__fax__spandsp_8c.html#a589319dce057e148f17f370ca3ba2a95">spandsp_global_stats</a>.g711.switched);</div><div class="line"><a name="l01203"></a><span class="lineno"> 1203</span>&#160;   <a class="code" href="../../dc/db0/cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(fd, <span class="stringliteral">&quot;%-20.20s : %d\n&quot;</span>, <span class="stringliteral">&quot;Call Dropped&quot;</span>, <a class="code" href="../../d5/d47/res__fax__spandsp_8c.html#a589319dce057e148f17f370ca3ba2a95">spandsp_global_stats</a>.g711.call_dropped);</div><div class="line"><a name="l01204"></a><span class="lineno"> 1204</span>&#160;   <a class="code" href="../../dc/db0/cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(fd, <span class="stringliteral">&quot;%-20.20s : %d\n&quot;</span>, <span class="stringliteral">&quot;No FAX&quot;</span>, <a class="code" href="../../d5/d47/res__fax__spandsp_8c.html#a589319dce057e148f17f370ca3ba2a95">spandsp_global_stats</a>.g711.nofax);</div><div class="line"><a name="l01205"></a><span class="lineno"> 1205</span>&#160;   <a class="code" href="../../dc/db0/cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(fd, <span class="stringliteral">&quot;%-20.20s : %d\n&quot;</span>, <span class="stringliteral">&quot;Negotiation Failed&quot;</span>, <a class="code" href="../../d5/d47/res__fax__spandsp_8c.html#a589319dce057e148f17f370ca3ba2a95">spandsp_global_stats</a>.g711.neg_failed);</div><div class="line"><a name="l01206"></a><span class="lineno"> 1206</span>&#160;   <a class="code" href="../../dc/db0/cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(fd, <span class="stringliteral">&quot;%-20.20s : %d\n&quot;</span>, <span class="stringliteral">&quot;Train Failure&quot;</span>, <a class="code" href="../../d5/d47/res__fax__spandsp_8c.html#a589319dce057e148f17f370ca3ba2a95">spandsp_global_stats</a>.g711.failed_to_train);</div><div class="line"><a name="l01207"></a><span class="lineno"> 1207</span>&#160;   <a class="code" href="../../dc/db0/cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(fd, <span class="stringliteral">&quot;%-20.20s : %d\n&quot;</span>, <span class="stringliteral">&quot;Retries Exceeded&quot;</span>, <a class="code" href="../../d5/d47/res__fax__spandsp_8c.html#a589319dce057e148f17f370ca3ba2a95">spandsp_global_stats</a>.g711.retries_exceeded);</div><div class="line"><a name="l01208"></a><span class="lineno"> 1208</span>&#160;   <a class="code" href="../../dc/db0/cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(fd, <span class="stringliteral">&quot;%-20.20s : %d\n&quot;</span>, <span class="stringliteral">&quot;Protocol Error&quot;</span>, <a class="code" href="../../d5/d47/res__fax__spandsp_8c.html#a589319dce057e148f17f370ca3ba2a95">spandsp_global_stats</a>.g711.protocol_error);</div><div class="line"><a name="l01209"></a><span class="lineno"> 1209</span>&#160;   <a class="code" href="../../dc/db0/cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(fd, <span class="stringliteral">&quot;%-20.20s : %d\n&quot;</span>, <span class="stringliteral">&quot;TX Protocol Error&quot;</span>, <a class="code" href="../../d5/d47/res__fax__spandsp_8c.html#a589319dce057e148f17f370ca3ba2a95">spandsp_global_stats</a>.g711.tx_protocol_error);</div><div class="line"><a name="l01210"></a><span class="lineno"> 1210</span>&#160;   <a class="code" href="../../dc/db0/cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(fd, <span class="stringliteral">&quot;%-20.20s : %d\n&quot;</span>, <span class="stringliteral">&quot;RX Protocol Error&quot;</span>, <a class="code" href="../../d5/d47/res__fax__spandsp_8c.html#a589319dce057e148f17f370ca3ba2a95">spandsp_global_stats</a>.g711.rx_protocol_error);</div><div class="line"><a name="l01211"></a><span class="lineno"> 1211</span>&#160;   <a class="code" href="../../dc/db0/cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(fd, <span class="stringliteral">&quot;%-20.20s : %d\n&quot;</span>, <span class="stringliteral">&quot;File Error&quot;</span>, <a class="code" href="../../d5/d47/res__fax__spandsp_8c.html#a589319dce057e148f17f370ca3ba2a95">spandsp_global_stats</a>.g711.file_error);</div><div class="line"><a name="l01212"></a><span class="lineno"> 1212</span>&#160;   <a class="code" href="../../dc/db0/cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(fd, <span class="stringliteral">&quot;%-20.20s : %d\n&quot;</span>, <span class="stringliteral">&quot;Memory Error&quot;</span>, <a class="code" href="../../d5/d47/res__fax__spandsp_8c.html#a589319dce057e148f17f370ca3ba2a95">spandsp_global_stats</a>.g711.mem_error);</div><div class="line"><a name="l01213"></a><span class="lineno"> 1213</span>&#160;   <a class="code" href="../../dc/db0/cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(fd, <span class="stringliteral">&quot;%-20.20s : %d\n&quot;</span>, <span class="stringliteral">&quot;Unknown Error&quot;</span>, <a class="code" href="../../d5/d47/res__fax__spandsp_8c.html#a589319dce057e148f17f370ca3ba2a95">spandsp_global_stats</a>.g711.unknown_error);</div><div class="line"><a name="l01214"></a><span class="lineno"> 1214</span>&#160;</div><div class="line"><a name="l01215"></a><span class="lineno"> 1215</span>&#160;   <a class="code" href="../../dc/db0/cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(fd, <span class="stringliteral">&quot;\n%-20.20s\n&quot;</span>, <span class="stringliteral">&quot;Spandsp T.38&quot;</span>);</div><div class="line"><a name="l01216"></a><span class="lineno"> 1216</span>&#160;   <a class="code" href="../../dc/db0/cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(fd, <span class="stringliteral">&quot;%-20.20s : %d\n&quot;</span>, <span class="stringliteral">&quot;Success&quot;</span>, <a class="code" href="../../d5/d47/res__fax__spandsp_8c.html#a589319dce057e148f17f370ca3ba2a95">spandsp_global_stats</a>.t38.success);</div><div class="line"><a name="l01217"></a><span class="lineno"> 1217</span>&#160;   <a class="code" href="../../dc/db0/cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(fd, <span class="stringliteral">&quot;%-20.20s : %d\n&quot;</span>, <span class="stringliteral">&quot;Call Dropped&quot;</span>, <a class="code" href="../../d5/d47/res__fax__spandsp_8c.html#a589319dce057e148f17f370ca3ba2a95">spandsp_global_stats</a>.t38.call_dropped);</div><div class="line"><a name="l01218"></a><span class="lineno"> 1218</span>&#160;   <a class="code" href="../../dc/db0/cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(fd, <span class="stringliteral">&quot;%-20.20s : %d\n&quot;</span>, <span class="stringliteral">&quot;No FAX&quot;</span>, <a class="code" href="../../d5/d47/res__fax__spandsp_8c.html#a589319dce057e148f17f370ca3ba2a95">spandsp_global_stats</a>.t38.nofax);</div><div class="line"><a name="l01219"></a><span class="lineno"> 1219</span>&#160;   <a class="code" href="../../dc/db0/cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(fd, <span class="stringliteral">&quot;%-20.20s : %d\n&quot;</span>, <span class="stringliteral">&quot;Negotiation Failed&quot;</span>, <a class="code" href="../../d5/d47/res__fax__spandsp_8c.html#a589319dce057e148f17f370ca3ba2a95">spandsp_global_stats</a>.t38.neg_failed);</div><div class="line"><a name="l01220"></a><span class="lineno"> 1220</span>&#160;   <a class="code" href="../../dc/db0/cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(fd, <span class="stringliteral">&quot;%-20.20s : %d\n&quot;</span>, <span class="stringliteral">&quot;Train Failure&quot;</span>, <a class="code" href="../../d5/d47/res__fax__spandsp_8c.html#a589319dce057e148f17f370ca3ba2a95">spandsp_global_stats</a>.t38.failed_to_train);</div><div class="line"><a name="l01221"></a><span class="lineno"> 1221</span>&#160;   <a class="code" href="../../dc/db0/cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(fd, <span class="stringliteral">&quot;%-20.20s : %d\n&quot;</span>, <span class="stringliteral">&quot;Retries Exceeded&quot;</span>, <a class="code" href="../../d5/d47/res__fax__spandsp_8c.html#a589319dce057e148f17f370ca3ba2a95">spandsp_global_stats</a>.t38.retries_exceeded);</div><div class="line"><a name="l01222"></a><span class="lineno"> 1222</span>&#160;   <a class="code" href="../../dc/db0/cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(fd, <span class="stringliteral">&quot;%-20.20s : %d\n&quot;</span>, <span class="stringliteral">&quot;Protocol Error&quot;</span>, <a class="code" href="../../d5/d47/res__fax__spandsp_8c.html#a589319dce057e148f17f370ca3ba2a95">spandsp_global_stats</a>.t38.protocol_error);</div><div class="line"><a name="l01223"></a><span class="lineno"> 1223</span>&#160;   <a class="code" href="../../dc/db0/cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(fd, <span class="stringliteral">&quot;%-20.20s : %d\n&quot;</span>, <span class="stringliteral">&quot;TX Protocol Error&quot;</span>, <a class="code" href="../../d5/d47/res__fax__spandsp_8c.html#a589319dce057e148f17f370ca3ba2a95">spandsp_global_stats</a>.t38.tx_protocol_error);</div><div class="line"><a name="l01224"></a><span class="lineno"> 1224</span>&#160;   <a class="code" href="../../dc/db0/cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(fd, <span class="stringliteral">&quot;%-20.20s : %d\n&quot;</span>, <span class="stringliteral">&quot;RX Protocol Error&quot;</span>, <a class="code" href="../../d5/d47/res__fax__spandsp_8c.html#a589319dce057e148f17f370ca3ba2a95">spandsp_global_stats</a>.t38.rx_protocol_error);</div><div class="line"><a name="l01225"></a><span class="lineno"> 1225</span>&#160;   <a class="code" href="../../dc/db0/cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(fd, <span class="stringliteral">&quot;%-20.20s : %d\n&quot;</span>, <span class="stringliteral">&quot;File Error&quot;</span>, <a class="code" href="../../d5/d47/res__fax__spandsp_8c.html#a589319dce057e148f17f370ca3ba2a95">spandsp_global_stats</a>.t38.file_error);</div><div class="line"><a name="l01226"></a><span class="lineno"> 1226</span>&#160;   <a class="code" href="../../dc/db0/cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(fd, <span class="stringliteral">&quot;%-20.20s : %d\n&quot;</span>, <span class="stringliteral">&quot;Memory Error&quot;</span>, <a class="code" href="../../d5/d47/res__fax__spandsp_8c.html#a589319dce057e148f17f370ca3ba2a95">spandsp_global_stats</a>.t38.mem_error);</div><div class="line"><a name="l01227"></a><span class="lineno"> 1227</span>&#160;   <a class="code" href="../../dc/db0/cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(fd, <span class="stringliteral">&quot;%-20.20s : %d\n&quot;</span>, <span class="stringliteral">&quot;Unknown Error&quot;</span>, <a class="code" href="../../d5/d47/res__fax__spandsp_8c.html#a589319dce057e148f17f370ca3ba2a95">spandsp_global_stats</a>.t38.unknown_error);</div><div class="line"><a name="l01228"></a><span class="lineno"> 1228</span>&#160;   <a class="code" href="../../dd/d42/lock_8h.html#a873f9ce8c6287a32d48c83133e124418">ast_mutex_unlock</a>(&amp;<a class="code" href="../../d5/d47/res__fax__spandsp_8c.html#a589319dce057e148f17f370ca3ba2a95">spandsp_global_stats</a>.lock);</div><div class="line"><a name="l01229"></a><span class="lineno"> 1229</span>&#160;</div><div class="line"><a name="l01230"></a><span class="lineno"> 1230</span>&#160;   <span class="keywordflow">return</span> <a class="code" href="../../dc/db0/cli_8h.html#a50989f00b32eeb2516a3803cb2ffb766">CLI_SUCCESS</a>;</div><div class="line"><a name="l01231"></a><span class="lineno"> 1231</span>&#160;}</div><div class="line"><a name="l01232"></a><span class="lineno"> 1232</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01233"></a><span class="lineno"> 1233</span>&#160;<span class="comment">/*! \brief Show res_fax_spandsp settings */</span></div><div class="line"><a name="l01234"></a><span class="lineno"><a class="line" href="../../d5/d47/res__fax__spandsp_8c.html#acb07657df8ed42dd62966c531f1bee62"> 1234</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">char</span> *<a class="code" href="../../d5/d47/res__fax__spandsp_8c.html#acb07657df8ed42dd62966c531f1bee62">spandsp_fax_cli_show_settings</a>(<span class="keywordtype">int</span> fd)</div><div class="line"><a name="l01235"></a><span class="lineno"> 1235</span>&#160;{</div><div class="line"><a name="l01236"></a><span class="lineno"> 1236</span>&#160;   <span class="comment">/* no settings at the moment */</span></div><div class="line"><a name="l01237"></a><span class="lineno"> 1237</span>&#160;   <span class="keywordflow">return</span> <a class="code" href="../../dc/db0/cli_8h.html#a50989f00b32eeb2516a3803cb2ffb766">CLI_SUCCESS</a>;</div><div class="line"><a name="l01238"></a><span class="lineno"> 1238</span>&#160;}</div><div class="line"><a name="l01239"></a><span class="lineno"> 1239</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01240"></a><span class="lineno"> 1240</span>&#160;<span class="comment">/*! \brief unload res_fax_spandsp */</span></div><div class="line"><a name="l01241"></a><span class="lineno"><a class="line" href="../../d5/d47/res__fax__spandsp_8c.html#ad09fa931f468002152a3cc2d5ce25eae"> 1241</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d5/d47/res__fax__spandsp_8c.html#ad09fa931f468002152a3cc2d5ce25eae">unload_module</a>(<span class="keywordtype">void</span>)</div><div class="line"><a name="l01242"></a><span class="lineno"> 1242</span>&#160;{</div><div class="line"><a name="l01243"></a><span class="lineno"> 1243</span>&#160;   <a class="code" href="../../db/d6a/res__fax_8h.html#a0212d23b36bd4b0777c0002ef6758bd9">ast_fax_tech_unregister</a>(&amp;spandsp_fax_tech);</div><div class="line"><a name="l01244"></a><span class="lineno"> 1244</span>&#160;   <a class="code" href="../../dd/d42/lock_8h.html#ab8977a71822daa556f19f30ba6eec765">ast_mutex_destroy</a>(&amp;<a class="code" href="../../d5/d47/res__fax__spandsp_8c.html#a589319dce057e148f17f370ca3ba2a95">spandsp_global_stats</a>.lock);</div><div class="line"><a name="l01245"></a><span class="lineno"> 1245</span>&#160;   <span class="keywordflow">return</span> <a class="code" href="../../d5/d16/module_8h.html#adc09474f0ff557e9925b722ee5b952dfa89bb877ade9ce418ad6663f3d936f314">AST_MODULE_LOAD_SUCCESS</a>;</div><div class="line"><a name="l01246"></a><span class="lineno"> 1246</span>&#160;}</div><div class="line"><a name="l01247"></a><span class="lineno"> 1247</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01248"></a><span class="lineno"> 1248</span>&#160;<span class="comment">/*! \brief load res_fax_spandsp */</span></div><div class="line"><a name="l01249"></a><span class="lineno"><a class="line" href="../../d5/d47/res__fax__spandsp_8c.html#ac3382bf6da54c56b37069bd76bbdf4f9"> 1249</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d5/d47/res__fax__spandsp_8c.html#ac3382bf6da54c56b37069bd76bbdf4f9">load_module</a>(<span class="keywordtype">void</span>)</div><div class="line"><a name="l01250"></a><span class="lineno"> 1250</span>&#160;{</div><div class="line"><a name="l01251"></a><span class="lineno"> 1251</span>&#160;   <a class="code" href="../../dd/d42/lock_8h.html#a76e8ed6bb354be6c6dd9e51acc1d7a1b">ast_mutex_init</a>(&amp;<a class="code" href="../../d5/d47/res__fax__spandsp_8c.html#a589319dce057e148f17f370ca3ba2a95">spandsp_global_stats</a>.lock);</div><div class="line"><a name="l01252"></a><span class="lineno"> 1252</span>&#160;   spandsp_fax_tech.<a class="code" href="../../d9/d0e/structast__fax__tech.html#a8637433cfbb88aeb10ce2ed5dcba0eb1">module</a> = <a class="code" href="../../dd/d5f/structast__module__info.html">ast_module_info</a>-&gt;<a class="code" href="../../dd/d5f/structast__module__info.html#a1aff0615d43e1dfa5c72c1c7d1c6d709">self</a>;</div><div class="line"><a name="l01253"></a><span class="lineno"> 1253</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../db/d6a/res__fax_8h.html#aa1e6a64120757501a2e6a1a076e070ff">ast_fax_tech_register</a>(&amp;spandsp_fax_tech) &lt; 0) {</div><div class="line"><a name="l01254"></a><span class="lineno"> 1254</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;failed to register FAX technology\n&quot;</span>);</div><div class="line"><a name="l01255"></a><span class="lineno"> 1255</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../d5/d16/module_8h.html#adc09474f0ff557e9925b722ee5b952dfac742921e9f9512d28f62c74ea2affe57">AST_MODULE_LOAD_DECLINE</a>;</div><div class="line"><a name="l01256"></a><span class="lineno"> 1256</span>&#160;   }</div><div class="line"><a name="l01257"></a><span class="lineno"> 1257</span>&#160;</div><div class="line"><a name="l01258"></a><span class="lineno"> 1258</span>&#160;   <span class="comment">/* prevent logging to stderr */</span></div><div class="line"><a name="l01259"></a><span class="lineno"> 1259</span>&#160;   span_set_message_handler(<a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div><div class="line"><a name="l01260"></a><span class="lineno"> 1260</span>&#160;</div><div class="line"><a name="l01261"></a><span class="lineno"> 1261</span>&#160;   <span class="keywordflow">return</span> <a class="code" href="../../d5/d16/module_8h.html#adc09474f0ff557e9925b722ee5b952dfa89bb877ade9ce418ad6663f3d936f314">AST_MODULE_LOAD_SUCCESS</a>;</div><div class="line"><a name="l01262"></a><span class="lineno"> 1262</span>&#160;}</div><div class="line"><a name="l01263"></a><span class="lineno"> 1263</span>&#160;</div><div class="line"><a name="l01264"></a><span class="lineno"> 1264</span>&#160;</div><div class="line"><a name="l01265"></a><span class="lineno"> 1265</span>&#160;<a class="code" href="../../d9/de9/res__phoneprov_8c.html#addaa208b0ed785225e24490fb9f28a80">AST_MODULE_INFO</a>(<a class="code" href="../../d5/d16/module_8h.html#aba2c8d4be709a254658b21a834f8294a">ASTERISK_GPL_KEY</a>, <a class="code" href="../../d5/d16/module_8h.html#a155a0df9c59e04e305d4a2fa3e35f843a54af2a9b29d140908cc9dffd0618951b">AST_MODFLAG_DEFAULT</a>, <span class="stringliteral">&quot;Spandsp G.711 and T.38 FAX Technologies&quot;</span>,</div><div class="line"><a name="l01266"></a><span class="lineno"> 1266</span>&#160;   .support_level = <a class="code" href="../../d5/d16/module_8h.html#ab35bc4efd9f79706300965c9d36a0ce5a9f8870a5687abe3d9a6b0b3fbc89a800">AST_MODULE_SUPPORT_EXTENDED</a>,</div><div class="line"><a name="l01267"></a><span class="lineno"> 1267</span>&#160;   .load = <a class="code" href="../../d5/d47/res__fax__spandsp_8c.html#ac3382bf6da54c56b37069bd76bbdf4f9">load_module</a>,</div><div class="line"><a name="l01268"></a><span class="lineno"> 1268</span>&#160;   .unload = <a class="code" href="../../d5/d47/res__fax__spandsp_8c.html#ad09fa931f468002152a3cc2d5ce25eae">unload_module</a>,</div><div class="line"><a name="l01269"></a><span class="lineno"> 1269</span>&#160;   .enhances = <span class="stringliteral">&quot;res_fax&quot;</span>,</div><div class="line"><a name="l01270"></a><span class="lineno"><a class="line" href="../../d5/d47/res__fax__spandsp_8c.html#a4fb0aca9bbcdb9709fa52a70aded6cae"> 1270</a></span>&#160;);</div><div class="ttc" id="channel_8h_html_a1b22ea5302ef183fa68bc45bfb0659c9"><div class="ttname"><a href="../../d5/d7b/channel_8h.html#a1b22ea5302ef183fa68bc45bfb0659c9">ast_channel_get_t38_state</a></div><div class="ttdeci">static enum ast_t38_state ast_channel_get_t38_state(struct ast_channel *chan)</div><div class="ttdoc">Retrieves the current T38 state of a channel. </div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d7b/channel_8h_source.html#l02873">channel.h:2873</a></div></div>
<div class="ttc" id="structast__fax__session__details_html_a17c89d9cdcac0df0f2039f065b7cf0ed"><div class="ttname"><a href="../../d8/dc2/structast__fax__session__details.html#a17c89d9cdcac0df0f2039f065b7cf0ed">ast_fax_session_details::result</a></div><div class="ttdeci">const ast_string_field result</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d6a/res__fax_8h_source.html#l00142">res_fax.h:142</a></div></div>
<div class="ttc" id="res__fax__spandsp_8c_html_a26dae05b6eb59eb758e6bf0f55b6e396"><div class="ttname"><a href="../../d5/d47/res__fax__spandsp_8c.html#a26dae05b6eb59eb758e6bf0f55b6e396">session_destroy</a></div><div class="ttdeci">static void session_destroy(struct spandsp_pvt *p)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d47/res__fax__spandsp_8c_source.html#l00180">res_fax_spandsp.c:180</a></div></div>
<div class="ttc" id="format_8h_html_a79bdf0b3c0616d9950d00cfeb62295c3ab1e8c1a0f8b4a1ecb6a2109992636859"><div class="ttname"><a href="../../d0/d0a/format_8h.html#a79bdf0b3c0616d9950d00cfeb62295c3ab1e8c1a0f8b4a1ecb6a2109992636859">AST_FORMAT_CMP_EQUAL</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d0a/format_8h_source.html#l00036">format.h:36</a></div></div>
<div class="ttc" id="structast__channel_html"><div class="ttname"><a href="../../df/d3c/structast__channel.html">ast_channel</a></div><div class="ttdoc">Main Channel structure associated with a channel. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/de2/channel__internal__api_8c_source.html#l00073">channel_internal_api.c:73</a></div></div>
<div class="ttc" id="structspandsp__fax__stats_html_a4072f28e52076d5ac4bcb6d3ddd5d30b"><div class="ttname"><a href="../../dd/df2/structspandsp__fax__stats.html#a4072f28e52076d5ac4bcb6d3ddd5d30b">spandsp_fax_stats::neg_failed</a></div><div class="ttdeci">int neg_failed</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d47/res__fax__spandsp_8c_source.html#l00127">res_fax_spandsp.c:127</a></div></div>
<div class="ttc" id="res__fax_8h_html_a54eb45ad548b874cf12d0a599631e3f6add135550dca7400fb80e250a63a54887"><div class="ttname"><a href="../../db/d6a/res__fax_8h.html#a54eb45ad548b874cf12d0a599631e3f6add135550dca7400fb80e250a63a54887">AST_FAX_TECH_GATEWAY</a></div><div class="ttdef"><b>Definition:</b> <a href="../../db/d6a/res__fax_8h_source.html#l00047">res_fax.h:47</a></div></div>
<div class="ttc" id="res__fax__spandsp_8c_html_a28cf77eecd22cd8b53d3ec4e967c13c2"><div class="ttname"><a href="../../d5/d47/res__fax__spandsp_8c.html#a28cf77eecd22cd8b53d3ec4e967c13c2">g711</a></div><div class="ttdeci">struct spandsp_fax_stats g711</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d47/res__fax__spandsp_8c_source.html#l00142">res_fax_spandsp.c:142</a></div></div>
<div class="ttc" id="res__fax_8h_html_a748e0695940b2d6145b9646387daa4db"><div class="ttname"><a href="../../db/d6a/res__fax_8h.html#a748e0695940b2d6145b9646387daa4db">AST_FAX_FRFLAG_GATEWAY</a></div><div class="ttdeci">#define AST_FAX_FRFLAG_GATEWAY</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d6a/res__fax_8h_source.html#l00232">res_fax.h:232</a></div></div>
<div class="ttc" id="res__fax__spandsp_8c_html_adaa7af133c27e45f416759d9552f0775"><div class="ttname"><a href="../../d5/d47/res__fax__spandsp_8c.html#adaa7af133c27e45f416759d9552f0775">spandsp_v21_detect</a></div><div class="ttdeci">static int spandsp_v21_detect(struct ast_fax_session *s, const struct ast_frame *f)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d47/res__fax__spandsp_8c_source.html#l00673">res_fax_spandsp.c:673</a></div></div>
<div class="ttc" id="group__Group__AMI_html_gac2d42f7be13c532b6a70d50f1b8983d2"><div class="ttname"><a href="../../df/d72/group__Group__AMI.html#gac2d42f7be13c532b6a70d50f1b8983d2">astman_append</a></div><div class="ttdeci">void astman_append(struct mansession *s, const char *fmt,...)</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d10/manager_8c_source.html#l03080">manager.c:3080</a></div></div>
<div class="ttc" id="asterisk_8h_html"><div class="ttname"><a href="../../db/db2/asterisk_8h.html">asterisk.h</a></div><div class="ttdoc">Asterisk main include file. File version handling, generic pbx functions. </div></div>
<div class="ttc" id="res__fax__spandsp_8c_html_a727760f4638f2c84101218ce5e89d567"><div class="ttname"><a href="../../d5/d47/res__fax__spandsp_8c.html#a727760f4638f2c84101218ce5e89d567">spandsp_modems</a></div><div class="ttdeci">static int spandsp_modems(struct ast_fax_session_details *details)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d47/res__fax__spandsp_8c_source.html#l00499">res_fax_spandsp.c:499</a></div></div>
<div class="ttc" id="linkedlists_8h_html_adf1959c5c03a3a706da97ad2f49617e5"><div class="ttname"><a href="../../df/d90/linkedlists_8h.html#adf1959c5c03a3a706da97ad2f49617e5">AST_LIST_FIRST</a></div><div class="ttdeci">#define AST_LIST_FIRST(head)</div><div class="ttdoc">Returns the first entry contained in a list. </div><div class="ttdef"><b>Definition:</b> <a href="../../df/d90/linkedlists_8h_source.html#l00420">linkedlists.h:420</a></div></div>
<div class="ttc" id="res__fax__spandsp_8c_html_ad19e873d8a667de24f4cb593a05b45fb"><div class="ttname"><a href="../../d5/d47/res__fax__spandsp_8c.html#ad19e873d8a667de24f4cb593a05b45fb">spandsp_fax_gateway_cleanup</a></div><div class="ttdeci">static void spandsp_fax_gateway_cleanup(struct ast_fax_session *s)</div><div class="ttdoc">gather data and clean up after gateway ends </div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d47/res__fax__spandsp_8c_source.html#l00916">res_fax_spandsp.c:916</a></div></div>
<div class="ttc" id="structspandsp__pvt_html_aa32b12a7baab4b773f3aee19dc640fdb"><div class="ttname"><a href="../../d2/d70/structspandsp__pvt.html#aa32b12a7baab4b773f3aee19dc640fdb">spandsp_pvt::t38_state</a></div><div class="ttdeci">t38_terminal_state_t t38_state</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d47/res__fax__spandsp_8c_source.html#l00151">res_fax_spandsp.c:151</a></div></div>
<div class="ttc" id="res__fax_8h_html_a0212d23b36bd4b0777c0002ef6758bd9"><div class="ttname"><a href="../../db/d6a/res__fax_8h.html#a0212d23b36bd4b0777c0002ef6758bd9">ast_fax_tech_unregister</a></div><div class="ttdeci">void ast_fax_tech_unregister(struct ast_fax_tech *tech)</div><div class="ttdoc">unregister a fax technology </div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d60/res__fax_8c_source.html#l00992">res_fax.c:992</a></div></div>
<div class="ttc" id="linkedlists_8h_html_acdb4f56da6b3071d02dcce20072852b0"><div class="ttname"><a href="../../df/d90/linkedlists_8h.html#acdb4f56da6b3071d02dcce20072852b0">AST_LIST_HEAD</a></div><div class="ttdeci">#define AST_LIST_HEAD(name, type)</div><div class="ttdoc">Defines a structure to be used to hold a list of specified type. </div><div class="ttdef"><b>Definition:</b> <a href="../../df/d90/linkedlists_8h_source.html#l00172">linkedlists.h:172</a></div></div>
<div class="ttc" id="structspandsp__fax__stats_html_a4962a14c99b722d1f2a27ecc05811166"><div class="ttname"><a href="../../dd/df2/structspandsp__fax__stats.html#a4962a14c99b722d1f2a27ecc05811166">spandsp_fax_stats::failed_to_train</a></div><div class="ttdeci">int failed_to_train</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d47/res__fax__spandsp_8c_source.html#l00128">res_fax_spandsp.c:128</a></div></div>
<div class="ttc" id="res__fax_8h_html_a1838c71fcf68c3cfe0ce37e35e77406dabd9b4a57405ba5c0c884ac98746a8bd7"><div class="ttname"><a href="../../db/d6a/res__fax_8h.html#a1838c71fcf68c3cfe0ce37e35e77406dabd9b4a57405ba5c0c884ac98746a8bd7">AST_FAX_OPTFLAG_TRUE</a></div><div class="ttdef"><b>Definition:</b> <a href="../../db/d6a/res__fax_8h_source.html#l00087">res_fax.h:87</a></div></div>
<div class="ttc" id="structspandsp__fax__stats_html_a7592938aeab0c3337363075cb27e3a3e"><div class="ttname"><a href="../../dd/df2/structspandsp__fax__stats.html#a7592938aeab0c3337363075cb27e3a3e">spandsp_fax_stats::rx_protocol_error</a></div><div class="ttdeci">int rx_protocol_error</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d47/res__fax__spandsp_8c_source.html#l00129">res_fax_spandsp.c:129</a></div></div>
<div class="ttc" id="module_8h_html_adc09474f0ff557e9925b722ee5b952dfa89bb877ade9ce418ad6663f3d936f314"><div class="ttname"><a href="../../d5/d16/module_8h.html#adc09474f0ff557e9925b722ee5b952dfa89bb877ade9ce418ad6663f3d936f314">AST_MODULE_LOAD_SUCCESS</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d16/module_8h_source.html#l00070">module.h:70</a></div></div>
<div class="ttc" id="res__fax__spandsp_8c_html_afe4b8983331a6ebf8b794f6cdb318b2f"><div class="ttname"><a href="../../d5/d47/res__fax__spandsp_8c.html#afe4b8983331a6ebf8b794f6cdb318b2f">spandsp_fax_gw_t30_gen</a></div><div class="ttdeci">static int spandsp_fax_gw_t30_gen(struct ast_channel *chan, void *data, int len, int samples)</div><div class="ttdoc">generate T.30 packets sent to the T.30 leg of gateway </div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d47/res__fax__spandsp_8c_source.html#l00765">res_fax_spandsp.c:765</a></div></div>
<div class="ttc" id="strings_8h_html"><div class="ttname"><a href="../../d6/d90/strings_8h.html">strings.h</a></div><div class="ttdoc">String manipulation functions. </div></div>
<div class="ttc" id="structast__frame_html_ab793262012344621455faf9266acbac2"><div class="ttname"><a href="../../d0/d99/structast__frame.html#ab793262012344621455faf9266acbac2">ast_frame::seqno</a></div><div class="ttdeci">int seqno</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d66/include_2asterisk_2frame_8h_source.html#l00195">include/asterisk/frame.h:195</a></div></div>
<div class="ttc" id="res__fax__spandsp_8c_html_acb07657df8ed42dd62966c531f1bee62"><div class="ttname"><a href="../../d5/d47/res__fax__spandsp_8c.html#acb07657df8ed42dd62966c531f1bee62">spandsp_fax_cli_show_settings</a></div><div class="ttdeci">static char * spandsp_fax_cli_show_settings(int fd)</div><div class="ttdoc">Show res_fax_spandsp settings. </div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d47/res__fax__spandsp_8c_source.html#l01234">res_fax_spandsp.c:1234</a></div></div>
<div class="ttc" id="res__fax__spandsp_8c_html_a83441be7baa98d2b8382dc027a8f2dee"><div class="ttname"><a href="../../d5/d47/res__fax__spandsp_8c.html#a83441be7baa98d2b8382dc027a8f2dee">spandsp_fax_cli_show_capabilities</a></div><div class="ttdeci">static char * spandsp_fax_cli_show_capabilities(int fd)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d47/res__fax__spandsp_8c_source.html#l01041">res_fax_spandsp.c:1041</a></div></div>
<div class="ttc" id="structast__fax__session__details_html_a6e3b307f2cde58ca9c7ed2c150e4c53c"><div class="ttname"><a href="../../d8/dc2/structast__fax__session__details.html#a6e3b307f2cde58ca9c7ed2c150e4c53c">ast_fax_session_details::headerinfo</a></div><div class="ttdeci">const ast_string_field headerinfo</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d6a/res__fax_8h_source.html#l00142">res_fax.h:142</a></div></div>
<div class="ttc" id="structast__generator_html_a77c293dc8108e06e2a81a1fdafc8fd97"><div class="ttname"><a href="../../de/d2a/structast__generator.html#a77c293dc8108e06e2a81a1fdafc8fd97">ast_generator::alloc</a></div><div class="ttdeci">void *(* alloc)(struct ast_channel *chan, void *params)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d7b/channel_8h_source.html#l00227">channel.h:227</a></div></div>
<div class="ttc" id="db_8h_html_aa343fa3b3d06292b959ffdd4c4703b06"><div class="ttname"><a href="../../da/d4e/db_8h.html#aa343fa3b3d06292b959ffdd4c4703b06">int16_t</a></div><div class="ttdeci">short int16_t</div><div class="ttdef"><b>Definition:</b> <a href="../../da/d4e/db_8h_source.html#l00059">db.h:59</a></div></div>
<div class="ttc" id="res__fax_8h_html_a54eb45ad548b874cf12d0a599631e3f6adbf07d8224b1a548ccae3b994653003b"><div class="ttname"><a href="../../db/d6a/res__fax_8h.html#a54eb45ad548b874cf12d0a599631e3f6adbf07d8224b1a548ccae3b994653003b">AST_FAX_TECH_SEND</a></div><div class="ttdef"><b>Definition:</b> <a href="../../db/d6a/res__fax_8h_source.html#l00037">res_fax.h:37</a></div></div>
<div class="ttc" id="module_8h_html_ab35bc4efd9f79706300965c9d36a0ce5a9f8870a5687abe3d9a6b0b3fbc89a800"><div class="ttname"><a href="../../d5/d16/module_8h.html#ab35bc4efd9f79706300965c9d36a0ce5a9f8870a5687abe3d9a6b0b3fbc89a800">AST_MODULE_SUPPORT_EXTENDED</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d16/module_8h_source.html#l00122">module.h:122</a></div></div>
<div class="ttc" id="res__fax_8h_html_a54eb45ad548b874cf12d0a599631e3f6a9138c48a79016bfccdd7cee6197cb21c"><div class="ttname"><a href="../../db/d6a/res__fax_8h.html#a54eb45ad548b874cf12d0a599631e3f6a9138c48a79016bfccdd7cee6197cb21c">AST_FAX_TECH_V21_DETECT</a></div><div class="ttdef"><b>Definition:</b> <a href="../../db/d6a/res__fax_8h_source.html#l00049">res_fax.h:49</a></div></div>
<div class="ttc" id="structast__fax__session_html_ab7ce6f462afaf105224b0ca772a33c43"><div class="ttname"><a href="../../d1/d16/structast__fax__session.html#ab7ce6f462afaf105224b0ca772a33c43">ast_fax_session::id</a></div><div class="ttdeci">unsigned int id</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d6a/res__fax_8h_source.html#l00204">res_fax.h:204</a></div></div>
<div class="ttc" id="structspandsp__pvt_html_aef5d68740b9dc01c4950275c22ae81f4"><div class="ttname"><a href="../../d2/d70/structspandsp__pvt.html#aef5d68740b9dc01c4950275c22ae81f4">spandsp_pvt::v21_detected</a></div><div class="ttdeci">int v21_detected</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d47/res__fax__spandsp_8c_source.html#l00163">res_fax_spandsp.c:163</a></div></div>
<div class="ttc" id="structast__fax__session__details_html_a84360ac08d9be11f221466122d8cdc65"><div class="ttname"><a href="../../d8/dc2/structast__fax__session__details.html#a84360ac08d9be11f221466122d8cdc65">ast_fax_session_details::debug</a></div><div class="ttdeci">uint32_t debug</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d6a/res__fax_8h_source.html#l00151">res_fax.h:151</a></div></div>
<div class="ttc" id="channel_8h_html_a12a58dda74a19f383f6b77cf7fa88b54"><div class="ttname"><a href="../../d5/d7b/channel_8h.html#a12a58dda74a19f383f6b77cf7fa88b54">ast_activate_generator</a></div><div class="ttdeci">int ast_activate_generator(struct ast_channel *chan, struct ast_generator *gen, void *params)</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d28/channel_8c_source.html#l02960">channel.c:2960</a></div></div>
<div class="ttc" id="res__fax__spandsp_8c_html_a589319dce057e148f17f370ca3ba2a95"><div class="ttname"><a href="../../d5/d47/res__fax__spandsp_8c.html#a589319dce057e148f17f370ca3ba2a95">spandsp_global_stats</a></div><div class="ttdeci">static struct @462 spandsp_global_stats</div></div>
<div class="ttc" id="structast__frame_html_add9af9569af79ec26dd741fb226b38ba"><div class="ttname"><a href="../../d0/d99/structast__frame.html#add9af9569af79ec26dd741fb226b38ba">ast_frame::ptr</a></div><div class="ttdeci">void * ptr</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d66/include_2asterisk_2frame_8h_source.html#l00183">include/asterisk/frame.h:183</a></div></div>
<div class="ttc" id="eagi__proxy_8c_html_ac95651d79c608a3148973b5b1fc9e525"><div class="ttname"><a href="../../dd/d7c/eagi__proxy_8c.html#ac95651d79c608a3148973b5b1fc9e525">buf</a></div><div class="ttdeci">char buf[BUFSIZE]</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d7c/eagi__proxy_8c_source.html#l00066">eagi_proxy.c:66</a></div></div>
<div class="ttc" id="res__fax__spandsp_8c_html_ae8ab5a74bae7f83dd7cad98eb9deeb98"><div class="ttname"><a href="../../d5/d47/res__fax__spandsp_8c.html#ae8ab5a74bae7f83dd7cad98eb9deeb98">spandsp_fax_start</a></div><div class="ttdeci">static int spandsp_fax_start(struct ast_fax_session *s)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d47/res__fax__spandsp_8c_source.html#l00929">res_fax_spandsp.c:929</a></div></div>
<div class="ttc" id="res__fax_8h_html"><div class="ttname"><a href="../../db/d6a/res__fax_8h.html">res_fax.h</a></div></div>
<div class="ttc" id="utils_8h_html_ab5033a1f3d781d45e7ccc27598114510"><div class="ttname"><a href="../../d5/d60/utils_8h.html#ab5033a1f3d781d45e7ccc27598114510">ast_set_flag</a></div><div class="ttdeci">#define ast_set_flag(p, flag)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d60/utils_8h_source.html#l00070">utils.h:70</a></div></div>
<div class="ttc" id="format__cache_8h_html_a568c3f5838b53c38f11996dbe5ff5785"><div class="ttname"><a href="../../db/d1c/format__cache_8h.html#a568c3f5838b53c38f11996dbe5ff5785">ast_format_ulaw</a></div><div class="ttdeci">struct ast_format * ast_format_ulaw</div><div class="ttdoc">Built-in cached ulaw format. </div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d29/format__cache_8c_source.html#l00086">format_cache.c:86</a></div></div>
<div class="ttc" id="structast__fax__session__details_html_a84169e19a7a3f0c9401ad500f0c50f54"><div class="ttname"><a href="../../d8/dc2/structast__fax__session__details.html#a84169e19a7a3f0c9401ad500f0c50f54">ast_fax_session_details::switch_to_t38</a></div><div class="ttdeci">uint32_t switch_to_t38</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d6a/res__fax_8h_source.html#l00159">res_fax.h:159</a></div></div>
<div class="ttc" id="structast__module__info_html"><div class="ttname"><a href="../../dd/d5f/structast__module__info.html">ast_module_info</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d16/module_8h_source.html#l00336">module.h:336</a></div></div>
<div class="ttc" id="res__fax__spandsp_8c_html_ad7ba83daf725125984d525ed1d2461cc"><div class="ttname"><a href="../../d5/d47/res__fax__spandsp_8c.html#ad7ba83daf725125984d525ed1d2461cc">spandsp_fax_gw_gen_release</a></div><div class="ttdeci">static void spandsp_fax_gw_gen_release(struct ast_channel *chan, void *data)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d47/res__fax__spandsp_8c_source.html#l00805">res_fax_spandsp.c:805</a></div></div>
<div class="ttc" id="logger_8h_html_adf4476a6a4ea6c74231c826e899d7189"><div class="ttname"><a href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a></div><div class="ttdeci">#define LOG_WARNING</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d8c/logger_8h_source.html#l00274">logger.h:274</a></div></div>
<div class="ttc" id="strings_8h_html_a1ef7e2644ca7258070db316fdc0a465b"><div class="ttname"><a href="../../d6/d90/strings_8h.html#a1ef7e2644ca7258070db316fdc0a465b">ast_str_buffer</a></div><div class="ttdeci">char * ast_str_buffer(const struct ast_str *buf)</div><div class="ttdoc">Returns the string buffer within the ast_str buf. </div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d90/strings_8h_source.html#l00714">strings.h:714</a></div></div>
<div class="ttc" id="res__fax__spandsp_8c_html_ae4ab2698fa08f5133c8241c9d2c3bfa4"><div class="ttname"><a href="../../d5/d47/res__fax__spandsp_8c.html#ae4ab2698fa08f5133c8241c9d2c3bfa4">set_ecm</a></div><div class="ttdeci">static void set_ecm(t30_state_t *t30_state, struct ast_fax_session_details *details)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d47/res__fax__spandsp_8c_source.html#l00479">res_fax_spandsp.c:479</a></div></div>
<div class="ttc" id="structast__fax__tech_html_a8ff938fb2f815be425fd2859a21e6d61"><div class="ttname"><a href="../../d9/d0e/structast__fax__tech.html#a8ff938fb2f815be425fd2859a21e6d61">ast_fax_tech::type</a></div><div class="ttdeci">const char *const type</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d6a/res__fax_8h_source.html#l00237">res_fax.h:237</a></div></div>
<div class="ttc" id="res__fax_8h_html_ab34810136037068a0847bcca2518112ca59afc86be1c4be9a01c3cd178c4337b2"><div class="ttname"><a href="../../db/d6a/res__fax_8h.html#ab34810136037068a0847bcca2518112ca59afc86be1c4be9a01c3cd178c4337b2">AST_FAX_STATE_ACTIVE</a></div><div class="ttdef"><b>Definition:</b> <a href="../../db/d6a/res__fax_8h_source.html#l00073">res_fax.h:73</a></div></div>
<div class="ttc" id="res__fax__spandsp_8c_html_a41b864f49450e34700ff878ffc337192"><div class="ttname"><a href="../../d5/d47/res__fax__spandsp_8c.html#a41b864f49450e34700ff878ffc337192">spandsp_fax_switch_to_t38</a></div><div class="ttdeci">static int spandsp_fax_switch_to_t38(struct ast_fax_session *s)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d47/res__fax__spandsp_8c_source.html#l01021">res_fax_spandsp.c:1021</a></div></div>
<div class="ttc" id="structast__generator_html"><div class="ttname"><a href="../../de/d2a/structast__generator.html">ast_generator</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d7b/channel_8h_source.html#l00226">channel.h:226</a></div></div>
<div class="ttc" id="res__fax__spandsp_8c_html_a42d6e20cfd39f4a22d9ea31270f45ebf"><div class="ttname"><a href="../../d5/d47/res__fax__spandsp_8c.html#a42d6e20cfd39f4a22d9ea31270f45ebf">spandsp_v21_tone</a></div><div class="ttdeci">static void spandsp_v21_tone(void *data, int code, int level, int delay)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d47/res__fax__spandsp_8c_source.html#l00664">res_fax_spandsp.c:664</a></div></div>
<div class="ttc" id="include_2asterisk_2frame_8h_html_ae2e1a9c4e048da387b761f619312d6e0aa457fe7005f11bb7b21453f9bb4caa8f"><div class="ttname"><a href="../../d6/d66/include_2asterisk_2frame_8h.html#ae2e1a9c4e048da387b761f619312d6e0aa457fe7005f11bb7b21453f9bb4caa8f">AST_FRAME_VOICE</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d66/include_2asterisk_2frame_8h_source.html#l00101">include/asterisk/frame.h:101</a></div></div>
<div class="ttc" id="structspandsp__pvt_html_a9aed6490b63794e6c9c00af4533f255f"><div class="ttname"><a href="../../d2/d70/structspandsp__pvt.html#a9aed6490b63794e6c9c00af4533f255f">spandsp_pvt::timer</a></div><div class="ttdeci">struct ast_timer * timer</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d47/res__fax__spandsp_8c_source.html#l00160">res_fax_spandsp.c:160</a></div></div>
<div class="ttc" id="timing_8h_html_a2a5968baf9962dedeeda855fd5ed9c75"><div class="ttname"><a href="../../db/d41/timing_8h.html#a2a5968baf9962dedeeda855fd5ed9c75">ast_timer_close</a></div><div class="ttdeci">void ast_timer_close(struct ast_timer *handle)</div><div class="ttdoc">Close an opened timing handle. </div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d62/timing_8c_source.html#l00154">timing.c:154</a></div></div>
<div class="ttc" id="structspandsp__fax__stats_html_ac41507da01dbee3fa458c4eebb085bce"><div class="ttname"><a href="../../dd/df2/structspandsp__fax__stats.html#ac41507da01dbee3fa458c4eebb085bce">spandsp_fax_stats::protocol_error</a></div><div class="ttdeci">int protocol_error</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d47/res__fax__spandsp_8c_source.html#l00131">res_fax_spandsp.c:131</a></div></div>
<div class="ttc" id="structast__frame_html_a1eb46dcb363821328c0d2a758549216b"><div class="ttname"><a href="../../d0/d99/structast__frame.html#a1eb46dcb363821328c0d2a758549216b">ast_frame::ts</a></div><div class="ttdeci">long ts</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d66/include_2asterisk_2frame_8h_source.html#l00191">include/asterisk/frame.h:191</a></div></div>
<div class="ttc" id="timing_8h_html_aacc341f127efc0dc0d62f6415694174a"><div class="ttname"><a href="../../db/d41/timing_8h.html#aacc341f127efc0dc0d62f6415694174a">ast_timer_open</a></div><div class="ttdeci">struct ast_timer * ast_timer_open(void)</div><div class="ttdoc">Open a timer. </div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d62/timing_8c_source.html#l00122">timing.c:122</a></div></div>
<div class="ttc" id="channel_8h_html_a4cd990f4c1cd0c2af6e4c63f6d15b4e1"><div class="ttname"><a href="../../d5/d7b/channel_8h.html#a4cd990f4c1cd0c2af6e4c63f6d15b4e1">ast_t38_state</a></div><div class="ttdeci">ast_t38_state</div><div class="ttdoc">Possible T38 states on channels. </div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d7b/channel_8h_source.html#l00879">channel.h:879</a></div></div>
<div class="ttc" id="structspandsp__fax__stats_html_a9c107baadbd6f9d2dba24b4337422f85"><div class="ttname"><a href="../../dd/df2/structspandsp__fax__stats.html#a9c107baadbd6f9d2dba24b4337422f85">spandsp_fax_stats::call_dropped</a></div><div class="ttdeci">int call_dropped</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d47/res__fax__spandsp_8c_source.html#l00135">res_fax_spandsp.c:135</a></div></div>
<div class="ttc" id="strings_8h_html_a1088afdd862a49b0fce34ebe02df8ca1"><div class="ttname"><a href="../../d6/d90/strings_8h.html#a1088afdd862a49b0fce34ebe02df8ca1">ast_str_append</a></div><div class="ttdeci">int ast_str_append(struct ast_str **buf, ssize_t max_len, const char *fmt,...)</div><div class="ttdoc">Append to a thread local dynamic string. </div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d90/strings_8h_source.html#l01091">strings.h:1091</a></div></div>
<div class="ttc" id="res__fax__spandsp_8c_html_a7b40a2b701ed0e7b0486409c8e3bc03f"><div class="ttname"><a href="../../d5/d47/res__fax__spandsp_8c.html#a7b40a2b701ed0e7b0486409c8e3bc03f">spandsp_fax_read</a></div><div class="ttdeci">static struct ast_frame * spandsp_fax_read(struct ast_fax_session *s)</div><div class="ttdoc">Read a frame from the spandsp fax stack. </div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d47/res__fax__spandsp_8c_source.html#l00622">res_fax_spandsp.c:622</a></div></div>
<div class="ttc" id="structspandsp__pvt_html_a9e04fe7f94b31b90af8617c4114973c6"><div class="ttname"><a href="../../d2/d70/structspandsp__pvt.html#a9e04fe7f94b31b90af8617c4114973c6">spandsp_pvt::ist38</a></div><div class="ttdeci">unsigned int ist38</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d47/res__fax__spandsp_8c_source.html#l00147">res_fax_spandsp.c:147</a></div></div>
<div class="ttc" id="structspandsp__fax__stats_html_ab2fe1c75b626347f20ab4c37ac6d4c60"><div class="ttname"><a href="../../dd/df2/structspandsp__fax__stats.html#ab2fe1c75b626347f20ab4c37ac6d4c60">spandsp_fax_stats::unknown_error</a></div><div class="ttdeci">int unknown_error</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d47/res__fax__spandsp_8c_source.html#l00136">res_fax_spandsp.c:136</a></div></div>
<div class="ttc" id="res__fax__spandsp_8c_html_a2519968d99ee93a67244dd8c53a92dad"><div class="ttname"><a href="../../d5/d47/res__fax__spandsp_8c.html#a2519968d99ee93a67244dd8c53a92dad">spandsp_fax_tech</a></div><div class="ttdeci">static struct ast_fax_tech spandsp_fax_tech</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d47/res__fax__spandsp_8c_source.html#l00095">res_fax_spandsp.c:95</a></div></div>
<div class="ttc" id="lock_8h_html_ac5e13c7fe64d3b271a52028b0a78b92b"><div class="ttname"><a href="../../dd/d42/lock_8h.html#ac5e13c7fe64d3b271a52028b0a78b92b">ast_mutex_lock</a></div><div class="ttdeci">#define ast_mutex_lock(a)</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d42/lock_8h_source.html#l00187">lock.h:187</a></div></div>
<div class="ttc" id="astobj2_8h_html_a9998bd156b936636a8780385e9a910b2"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#a9998bd156b936636a8780385e9a910b2">ao2_unlock</a></div><div class="ttdeci">#define ao2_unlock(a)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l00730">astobj2.h:730</a></div></div>
<div class="ttc" id="test__linkedlists_8c_html_acd9db00336027462cfb25b97b5356883"><div class="ttname"><a href="../../d7/d6f/test__linkedlists_8c.html#acd9db00336027462cfb25b97b5356883">c</a></div><div class="ttdeci">static struct test_val c</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d6f/test__linkedlists_8c_source.html#l00048">test_linkedlists.c:48</a></div></div>
<div class="ttc" id="format_8h_html_a082f0fca94b18ba466f6e28d3ccb2fc8"><div class="ttname"><a href="../../d0/d0a/format_8h.html#a082f0fca94b18ba466f6e28d3ccb2fc8">ast_format_get_name</a></div><div class="ttdeci">const char * ast_format_get_name(const struct ast_format *format)</div><div class="ttdoc">Get the name associated with a format. </div><div class="ttdef"><b>Definition:</b> <a href="../../de/da6/format_8c_source.html#l00334">format.c:334</a></div></div>
<div class="ttc" id="res__fax_8h_html_a54eb45ad548b874cf12d0a599631e3f6a76fa4111df51955a949e95fadbccd48b"><div class="ttname"><a href="../../db/d6a/res__fax_8h.html#a54eb45ad548b874cf12d0a599631e3f6a76fa4111df51955a949e95fadbccd48b">AST_FAX_TECH_AUDIO</a></div><div class="ttdef"><b>Definition:</b> <a href="../../db/d6a/res__fax_8h_source.html#l00041">res_fax.h:41</a></div></div>
<div class="ttc" id="structast__timer_html"><div class="ttname"><a href="../../da/def/structast__timer.html">ast_timer</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d62/timing_8c_source.html#l00054">timing.c:54</a></div></div>
<div class="ttc" id="structast__timer_html_a735984d41155bc1032e09bece8f8d66d"><div class="ttname"><a href="../../da/def/structast__timer.html#a735984d41155bc1032e09bece8f8d66d">ast_timer::data</a></div><div class="ttdeci">void * data</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d62/timing_8c_source.html#l00055">timing.c:55</a></div></div>
<div class="ttc" id="res__fax__spandsp_8c_html_a24efd6f18c67b0deb9973607e23f2bac"><div class="ttname"><a href="../../d5/d47/res__fax__spandsp_8c.html#a24efd6f18c67b0deb9973607e23f2bac">t38_tx_packet_handler</a></div><div class="ttdeci">static int t38_tx_packet_handler(t38_core_state_t *t38_core_state, void *data, const uint8_t *buf, int len, int count)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d47/res__fax__spandsp_8c_source.html#l00217">res_fax_spandsp.c:217</a></div></div>
<div class="ttc" id="res__fax__spandsp_8c_html_aaae8190167c94ac97553e0377398eb6c"><div class="ttname"><a href="../../d5/d47/res__fax__spandsp_8c.html#aaae8190167c94ac97553e0377398eb6c">spandsp_fax_cancel</a></div><div class="ttdeci">static int spandsp_fax_cancel(struct ast_fax_session *s)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d47/res__fax__spandsp_8c_source.html#l01006">res_fax_spandsp.c:1006</a></div></div>
<div class="ttc" id="resample_8c_html_a070d2ce7b6bb7e5c05602aa8c308d0c4"><div class="ttname"><a href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a></div><div class="ttdeci">#define NULL</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d7f/resample_8c_source.html#l00096">resample.c:96</a></div></div>
<div class="ttc" id="res__fax__spandsp_8c_html_ae948616ce1a6c11f9ffebbdd0239aa6f"><div class="ttname"><a href="../../d5/d47/res__fax__spandsp_8c.html#ae948616ce1a6c11f9ffebbdd0239aa6f">t38</a></div><div class="ttdeci">struct spandsp_fax_stats t38</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d47/res__fax__spandsp_8c_source.html#l00143">res_fax_spandsp.c:143</a></div></div>
<div class="ttc" id="structast__fax__session_html_a84d1435c5b8d387806714ea7079304b7"><div class="ttname"><a href="../../d1/d16/structast__fax__session.html#a84d1435c5b8d387806714ea7079304b7">ast_fax_session::chan</a></div><div class="ttdeci">struct ast_channel * chan</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d6a/res__fax_8h_source.html#l00224">res_fax.h:224</a></div></div>
<div class="ttc" id="cli_8h_html_a791bf9f5637185bee5e8f0907c762130"><div class="ttname"><a href="../../dc/db0/cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a></div><div class="ttdeci">void ast_cli(int fd, const char *fmt,...)</div><div class="ttdef"><b>Definition:</b> <a href="../../da/d4d/clicompat_8c_source.html#l00006">clicompat.c:6</a></div></div>
<div class="ttc" id="logger_8h_html_a6ff63e8955665c4a58b1598f2b07c51a"><div class="ttname"><a href="../../d1/d8c/logger_8h.html#a6ff63e8955665c4a58b1598f2b07c51a">LOG_DEBUG</a></div><div class="ttdeci">#define LOG_DEBUG</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d8c/logger_8h_source.html#l00241">logger.h:241</a></div></div>
<div class="ttc" id="res__fax__spandsp_8c_html_a8162670509872b734477d174e39a073e"><div class="ttname"><a href="../../d5/d47/res__fax__spandsp_8c.html#a8162670509872b734477d174e39a073e">spandsp_fax_gateway_process</a></div><div class="ttdeci">static int spandsp_fax_gateway_process(struct ast_fax_session *s, const struct ast_frame *f)</div><div class="ttdoc">process a frame from the bridge </div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d47/res__fax__spandsp_8c_source.html#l00894">res_fax_spandsp.c:894</a></div></div>
<div class="ttc" id="res__fax__spandsp_8c_html_aca5062a395eb7c74d0109ba1f4d11b89"><div class="ttname"><a href="../../d5/d47/res__fax__spandsp_8c.html#aca5062a395eb7c74d0109ba1f4d11b89">spandsp_fax_gateway_start</a></div><div class="ttdeci">static int spandsp_fax_gateway_start(struct ast_fax_session *s)</div><div class="ttdoc">activate a spandsp gateway based on the information in the given fax session </div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d47/res__fax__spandsp_8c_source.html#l00813">res_fax_spandsp.c:813</a></div></div>
<div class="ttc" id="lock_8h_html_a8a3bd496edfec04a95683ace66676200"><div class="ttname"><a href="../../dd/d42/lock_8h.html#a8a3bd496edfec04a95683ace66676200">ast_atomic_fetchadd_int</a></div><div class="ttdeci">int ast_atomic_fetchadd_int(volatile int *p, int v)</div><div class="ttdoc">Atomically add v to *p and return the previous value of *p. </div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d42/lock_8h_source.html#l00755">lock.h:755</a></div></div>
<div class="ttc" id="structspandsp__pvt_html_a2ae422e03f0063ccdd76b75bad9624ec"><div class="ttname"><a href="../../d2/d70/structspandsp__pvt.html#a2ae422e03f0063ccdd76b75bad9624ec">spandsp_pvt::read_frames</a></div><div class="ttdeci">struct spandsp_pvt::frame_queue read_frames</div></div>
<div class="ttc" id="structast__frame_html_a27237c48fdcd22556401f20c693811db"><div class="ttname"><a href="../../d0/d99/structast__frame.html#a27237c48fdcd22556401f20c693811db">ast_frame::subclass</a></div><div class="ttdeci">struct ast_frame_subclass subclass</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d66/include_2asterisk_2frame_8h_source.html#l00169">include/asterisk/frame.h:169</a></div></div>
<div class="ttc" id="res__fax__spandsp_8c_html_addd7277ae067b27b98632539c158c6bf"><div class="ttname"><a href="../../d5/d47/res__fax__spandsp_8c.html#addd7277ae067b27b98632539c158c6bf">spandsp_v21_cleanup</a></div><div class="ttdeci">static void spandsp_v21_cleanup(struct ast_fax_session *s)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d47/res__fax__spandsp_8c_source.html#l00594">res_fax_spandsp.c:594</a></div></div>
<div class="ttc" id="structspandsp__pvt_html_a2771e36a55ef2406a468f480426f3f90"><div class="ttname"><a href="../../d2/d70/structspandsp__pvt.html#a2771e36a55ef2406a468f480426f3f90">spandsp_pvt::t38_core_state</a></div><div class="ttdeci">t38_core_state_t * t38_core_state</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d47/res__fax__spandsp_8c_source.html#l00153">res_fax_spandsp.c:153</a></div></div>
<div class="ttc" id="utils_8h_html"><div class="ttname"><a href="../../d5/d60/utils_8h.html">utils.h</a></div><div class="ttdoc">Utility functions. </div></div>
<div class="ttc" id="strings_8h_html_a372554b7a2d69a8bd3adac5157672036"><div class="ttname"><a href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a></div><div class="ttdeci">#define ast_strlen_zero(foo)</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d90/strings_8h_source.html#l00052">strings.h:52</a></div></div>
<div class="ttc" id="structspandsp__pvt_1_1frame__queue_html"><div class="ttname"><a href="../../d1/dbe/structspandsp__pvt_1_1frame__queue.html">spandsp_pvt::frame_queue</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d47/res__fax__spandsp_8c_source.html#l00161">res_fax_spandsp.c:161</a></div></div>
<div class="ttc" id="res__fax_8h_html_a1b9314c7e94b0f3b703c975b0854519f"><div class="ttname"><a href="../../db/d6a/res__fax_8h.html#a1b9314c7e94b0f3b703c975b0854519f">ast_fax_session_operation_str</a></div><div class="ttdeci">const char * ast_fax_session_operation_str(struct ast_fax_session *s)</div><div class="ttdoc">get string representation of a FAX session&amp;#39;s operation </div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d60/res__fax_8c_source.html#l04254">res_fax.c:4254</a></div></div>
<div class="ttc" id="res__fax_8h_html_ab9287e81dc5d3047da0bcb1f6c89bd57a7f0a2c297f96556e6d4af522930d1ccc"><div class="ttname"><a href="../../db/d6a/res__fax_8h.html#ab9287e81dc5d3047da0bcb1f6c89bd57a7f0a2c297f96556e6d4af522930d1ccc">AST_FAX_MODEM_V29</a></div><div class="ttdef"><b>Definition:</b> <a href="../../db/d6a/res__fax_8h_source.html#l00059">res_fax.h:59</a></div></div>
<div class="ttc" id="structast__fax__session__details_html_a3ab211dbe8780b7292257f6b3dba1952"><div class="ttname"><a href="../../d8/dc2/structast__fax__session__details.html#a3ab211dbe8780b7292257f6b3dba1952">ast_fax_session_details::option</a></div><div class="ttdeci">union ast_fax_session_details::@290 option</div></div>
<div class="ttc" id="res__fax_8h_html_ab34810136037068a0847bcca2518112ca11037f2ac950e3e5281b419aef13e3dc"><div class="ttname"><a href="../../db/d6a/res__fax_8h.html#ab34810136037068a0847bcca2518112ca11037f2ac950e3e5281b419aef13e3dc">AST_FAX_STATE_INITIALIZED</a></div><div class="ttdef"><b>Definition:</b> <a href="../../db/d6a/res__fax_8h_source.html#l00069">res_fax.h:69</a></div></div>
<div class="ttc" id="structspandsp__pvt_html_a60d0506eeae2ef6636db3bd311cdc5b5"><div class="ttname"><a href="../../d2/d70/structspandsp__pvt.html#a60d0506eeae2ef6636db3bd311cdc5b5">spandsp_pvt::t38stats</a></div><div class="ttdeci">struct spandsp_fax_gw_stats * t38stats</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d47/res__fax__spandsp_8c_source.html#l00157">res_fax_spandsp.c:157</a></div></div>
<div class="ttc" id="structast__frame__subclass_html_adece183191b0e700e039e59101e06105"><div class="ttname"><a href="../../d1/d9f/structast__frame__subclass.html#adece183191b0e700e039e59101e06105">ast_frame_subclass::integer</a></div><div class="ttdeci">int integer</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d66/include_2asterisk_2frame_8h_source.html#l00152">include/asterisk/frame.h:152</a></div></div>
<div class="ttc" id="logger_8h_html_a3f248112c8d6ce7e3959aa723dade648"><div class="ttname"><a href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a></div><div class="ttdeci">#define ast_debug(level,...)</div><div class="ttdoc">Log a DEBUG message. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d8c/logger_8h_source.html#l00452">logger.h:452</a></div></div>
<div class="ttc" id="astobj2_8c_html_a96a00b3a518d7f32b6d51dc28f09bf9b"><div class="ttname"><a href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a></div><div class="ttdeci">#define ast_log</div><div class="ttdef"><b>Definition:</b> <a href="../../da/df7/astobj2_8c_source.html#l00042">astobj2.c:42</a></div></div>
<div class="ttc" id="res__fax_8h_html_a54eb45ad548b874cf12d0a599631e3f6a77bcc28b15614142ddbf4a180d263602"><div class="ttname"><a href="../../db/d6a/res__fax_8h.html#a54eb45ad548b874cf12d0a599631e3f6a77bcc28b15614142ddbf4a180d263602">AST_FAX_TECH_RECEIVE</a></div><div class="ttdef"><b>Definition:</b> <a href="../../db/d6a/res__fax_8h_source.html#l00039">res_fax.h:39</a></div></div>
<div class="ttc" id="structast__fax__session__details_html_a80632865b575d06f319ef95c42645b2c"><div class="ttname"><a href="../../d8/dc2/structast__fax__session__details.html#a80632865b575d06f319ef95c42645b2c">ast_fax_session_details::our_t38_parameters</a></div><div class="ttdeci">struct ast_fax_t38_parameters our_t38_parameters</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d6a/res__fax_8h_source.html#l00175">res_fax.h:175</a></div></div>
<div class="ttc" id="include_2asterisk_2frame_8h_html_a9db3df106b7deebbee4c5106a880ec33abbb1b9b329ded73597a5c2eefe13a34c"><div class="ttname"><a href="../../d6/d66/include_2asterisk_2frame_8h.html#a9db3df106b7deebbee4c5106a880ec33abbb1b9b329ded73597a5c2eefe13a34c">AST_T38_RATE_MANAGEMENT_TRANSFERRED_TCF</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d66/include_2asterisk_2frame_8h_source.html#l00393">include/asterisk/frame.h:393</a></div></div>
<div class="ttc" id="format_8h_html_a738c58eca291b71de4422e95bff27400"><div class="ttname"><a href="../../d0/d0a/format_8h.html#a738c58eca291b71de4422e95bff27400">ast_format_cmp</a></div><div class="ttdeci">enum ast_format_cmp_res ast_format_cmp(const struct ast_format *format1, const struct ast_format *format2)</div><div class="ttdoc">Compare two formats. </div><div class="ttdef"><b>Definition:</b> <a href="../../de/da6/format_8c_source.html#l00201">format.c:201</a></div></div>
<div class="ttc" id="res__fax__spandsp_8c_html_a46ff23b63408b9b6d29a0ed01cdb424d"><div class="ttname"><a href="../../d5/d47/res__fax__spandsp_8c.html#a46ff23b63408b9b6d29a0ed01cdb424d">spandsp_manager_fax_session</a></div><div class="ttdeci">static void spandsp_manager_fax_session(struct mansession *s, const char *id_text, struct ast_fax_session *session)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d47/res__fax__spandsp_8c_source.html#l01105">res_fax_spandsp.c:1105</a></div></div>
<div class="ttc" id="structast__module__info_html_a1aff0615d43e1dfa5c72c1c7d1c6d709"><div class="ttname"><a href="../../dd/d5f/structast__module__info.html#a1aff0615d43e1dfa5c72c1c7d1c6d709">ast_module_info::self</a></div><div class="ttdeci">struct ast_module * self</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d16/module_8h_source.html#l00342">module.h:342</a></div></div>
<div class="ttc" id="res__fax_8h_html_ab9287e81dc5d3047da0bcb1f6c89bd57a2faab4efa2a8027ed56a92cc758a7bb0"><div class="ttname"><a href="../../db/d6a/res__fax_8h.html#ab9287e81dc5d3047da0bcb1f6c89bd57a2faab4efa2a8027ed56a92cc758a7bb0">AST_FAX_MODEM_V17</a></div><div class="ttdef"><b>Definition:</b> <a href="../../db/d6a/res__fax_8h_source.html#l00055">res_fax.h:55</a></div></div>
<div class="ttc" id="channel_8h_html"><div class="ttname"><a href="../../d5/d7b/channel_8h.html">channel.h</a></div><div class="ttdoc">General Asterisk PBX channel definitions. </div></div>
<div class="ttc" id="structspandsp__fax__stats_html"><div class="ttname"><a href="../../dd/df2/structspandsp__fax__stats.html">spandsp_fax_stats</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d47/res__fax__spandsp_8c_source.html#l00124">res_fax_spandsp.c:124</a></div></div>
<div class="ttc" id="include_2asterisk_2frame_8h_html_ac8f7380b8620c80443286b44481f641c"><div class="ttname"><a href="../../d6/d66/include_2asterisk_2frame_8h.html#ac8f7380b8620c80443286b44481f641c">AST_FRIENDLY_OFFSET</a></div><div class="ttdeci">#define AST_FRIENDLY_OFFSET</div><div class="ttdoc">Offset into a frame&amp;#39;s data buffer. </div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d66/include_2asterisk_2frame_8h_source.html#l00229">include/asterisk/frame.h:229</a></div></div>
<div class="ttc" id="structast__frame_html_af51e37c9331049b1e3d250a7c8bc3c26"><div class="ttname"><a href="../../d0/d99/structast__frame.html#af51e37c9331049b1e3d250a7c8bc3c26">ast_frame::src</a></div><div class="ttdeci">const char * src</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d66/include_2asterisk_2frame_8h_source.html#l00181">include/asterisk/frame.h:181</a></div></div>
<div class="ttc" id="utils_8h_html_a1604b4d72144dd3d9f7da668e90337e9"><div class="ttname"><a href="../../d5/d60/utils_8h.html#a1604b4d72144dd3d9f7da668e90337e9">RAII_VAR</a></div><div class="ttdeci">#define RAII_VAR(vartype, varname, initval, dtor)</div><div class="ttdoc">Declare a variable that will call a destructor function when it goes out of scope. </div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d60/utils_8h_source.html#l00911">utils.h:911</a></div></div>
<div class="ttc" id="structast__fax__t38__parameters_html"><div class="ttname"><a href="../../d3/df6/structast__fax__t38__parameters.html">ast_fax_t38_parameters</a></div><div class="ttdef"><b>Definition:</b> <a href="../../db/d6a/res__fax_8h_source.html#l00092">res_fax.h:92</a></div></div>
<div class="ttc" id="astman_8c_html_ac4a6ae0400e4457f0b35beddec80c93d"><div class="ttname"><a href="../../d2/d4d/astman_8c.html#ac4a6ae0400e4457f0b35beddec80c93d">session</a></div><div class="ttdeci">static struct ast_mansession session</div></div>
<div class="ttc" id="astobj2_8h_html"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html">astobj2.h</a></div></div>
<div class="ttc" id="structast__frame_html_ad67e07841d1233e596e6f822a3c81f6b"><div class="ttname"><a href="../../d0/d99/structast__frame.html#ad67e07841d1233e596e6f822a3c81f6b">ast_frame::datalen</a></div><div class="ttdeci">int datalen</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d66/include_2asterisk_2frame_8h_source.html#l00171">include/asterisk/frame.h:171</a></div></div>
<div class="ttc" id="astobj2_8h_html_aaca5e8eac39a22f9da1c36fc6c922270"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a></div><div class="ttdeci">#define ao2_ref(o, delta)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l00464">astobj2.h:464</a></div></div>
<div class="ttc" id="structast__fax__session_html_ae7b633178d301df70e8612b4ce1aeb77"><div class="ttname"><a href="../../d1/d16/structast__fax__session.html#ae7b633178d301df70e8612b4ce1aeb77">ast_fax_session::details</a></div><div class="ttdeci">struct ast_fax_session_details * details</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d6a/res__fax_8h_source.html#l00208">res_fax.h:208</a></div></div>
<div class="ttc" id="structmansession_html"><div class="ttname"><a href="../../d2/d8a/structmansession.html">mansession</a></div><div class="ttdoc">In case you didn&amp;#39;t read that giant block of text above the mansession_session struct, the struct mansession is named this solely to keep the API the same in Asterisk. This structure really represents data that is different from Manager action to Manager action. The mansession_session pointer contained within points to session-specific data. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d10/manager_8c_source.html#l01625">manager.c:1625</a></div></div>
<div class="ttc" id="astobj2_8h_html_aa9fdb5d0a6157a56060d9f7279fe6c49"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#aa9fdb5d0a6157a56060d9f7279fe6c49">ao2_lock</a></div><div class="ttdeci">#define ao2_lock(a)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l00718">astobj2.h:718</a></div></div>
<div class="ttc" id="structspandsp__fax__stats_html_a5b41c47056e4587415bbf70507281a72"><div class="ttname"><a href="../../dd/df2/structspandsp__fax__stats.html#a5b41c47056e4587415bbf70507281a72">spandsp_fax_stats::mem_error</a></div><div class="ttdeci">int mem_error</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d47/res__fax__spandsp_8c_source.html#l00134">res_fax_spandsp.c:134</a></div></div>
<div class="ttc" id="res__fax__spandsp_8c_html_a193ec436c3481c1121eb872cd2e9ad0d"><div class="ttname"><a href="../../d5/d47/res__fax__spandsp_8c.html#a193ec436c3481c1121eb872cd2e9ad0d">spandsp_fax_cli_show_session</a></div><div class="ttdeci">static char * spandsp_fax_cli_show_session(struct ast_fax_session *s, int fd)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d47/res__fax__spandsp_8c_source.html#l01048">res_fax_spandsp.c:1048</a></div></div>
<div class="ttc" id="structspandsp__pvt_html_ad8cd454d1a02eee0cc27ea8819530ecd"><div class="ttname"><a href="../../d2/d70/structspandsp__pvt.html#ad8cd454d1a02eee0cc27ea8819530ecd">spandsp_pvt::t38_gw_state</a></div><div class="ttdeci">t38_gateway_state_t t38_gw_state</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d47/res__fax__spandsp_8c_source.html#l00158">res_fax_spandsp.c:158</a></div></div>
<div class="ttc" id="structast__fax__session_html_a9f716886b5b2a50ad6d2b9119502b152"><div class="ttname"><a href="../../d1/d16/structast__fax__session.html#a9f716886b5b2a50ad6d2b9119502b152">ast_fax_session::channame</a></div><div class="ttdeci">char * channame</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d6a/res__fax_8h_source.html#l00220">res_fax.h:220</a></div></div>
<div class="ttc" id="structast__fax__session__details_html"><div class="ttname"><a href="../../d8/dc2/structast__fax__session__details.html">ast_fax_session_details</a></div><div class="ttdoc">The data communicated between the high level applications and the generic fax function. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/d6a/res__fax_8h_source.html#l00110">res_fax.h:110</a></div></div>
<div class="ttc" id="astmm_8h_html_ae63d4f486bcf6eac7c1593f867717d91"><div class="ttname"><a href="../../d8/d8a/astmm_8h.html#ae63d4f486bcf6eac7c1593f867717d91">ast_malloc</a></div><div class="ttdeci">#define ast_malloc(len)</div><div class="ttdoc">A wrapper for malloc() </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d8a/astmm_8h_source.html#l00193">astmm.h:193</a></div></div>
<div class="ttc" id="channel_8h_html_a4cd990f4c1cd0c2af6e4c63f6d15b4e1afa1eab36050476591f803c3e234c2ed1"><div class="ttname"><a href="../../d5/d7b/channel_8h.html#a4cd990f4c1cd0c2af6e4c63f6d15b4e1afa1eab36050476591f803c3e234c2ed1">T38_STATE_NEGOTIATING</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d7b/channel_8h_source.html#l00882">channel.h:882</a></div></div>
<div class="ttc" id="linkedlists_8h_html_aadfe2a69fbba4f27c201266a2ca5f989"><div class="ttname"><a href="../../df/d90/linkedlists_8h.html#aadfe2a69fbba4f27c201266a2ca5f989">AST_LIST_REMOVE_HEAD</a></div><div class="ttdeci">#define AST_LIST_REMOVE_HEAD(head, field)</div><div class="ttdoc">Removes and returns the head entry from a list. </div><div class="ttdef"><b>Definition:</b> <a href="../../df/d90/linkedlists_8h_source.html#l00832">linkedlists.h:832</a></div></div>
<div class="ttc" id="structast__fax__tech_html_a8637433cfbb88aeb10ce2ed5dcba0eb1"><div class="ttname"><a href="../../d9/d0e/structast__fax__tech.html#a8637433cfbb88aeb10ce2ed5dcba0eb1">ast_fax_tech::module</a></div><div class="ttdeci">struct ast_module * module</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d6a/res__fax_8h_source.html#l00245">res_fax.h:245</a></div></div>
<div class="ttc" id="res__fax_8h_html_a54eb45ad548b874cf12d0a599631e3f6a6868445e2802e5b71068ae883366f635"><div class="ttname"><a href="../../db/d6a/res__fax_8h.html#a54eb45ad548b874cf12d0a599631e3f6a6868445e2802e5b71068ae883366f635">AST_FAX_TECH_T38</a></div><div class="ttdef"><b>Definition:</b> <a href="../../db/d6a/res__fax_8h_source.html#l00043">res_fax.h:43</a></div></div>
<div class="ttc" id="channel_8h_html_a6cbcba5661d55216968cde8fdf913c89"><div class="ttname"><a href="../../d5/d7b/channel_8h.html#a6cbcba5661d55216968cde8fdf913c89">ast_queue_frame</a></div><div class="ttdeci">int ast_queue_frame(struct ast_channel *chan, struct ast_frame *f)</div><div class="ttdoc">Queue one or more frames to a channel&amp;#39;s frame queue. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d28/channel_8c_source.html#l01139">channel.c:1139</a></div></div>
<div class="ttc" id="res__fax__spandsp_8c_html_a12890f182233a7dfd042518081c71cce"><div class="ttname"><a href="../../d5/d47/res__fax__spandsp_8c.html#a12890f182233a7dfd042518081c71cce">t30_phase_e_handler</a></div><div class="ttdeci">static void t30_phase_e_handler(t30_state_t *t30_state, void *data, int completion_code)</div><div class="ttdoc">Phase E handler callback. </div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d47/res__fax__spandsp_8c_source.html#l00378">res_fax_spandsp.c:378</a></div></div>
<div class="ttc" id="res__fax__spandsp_8c_html_a7a848b476ce6571398d94f5eb74f3182"><div class="ttname"><a href="../../d5/d47/res__fax__spandsp_8c.html#a7a848b476ce6571398d94f5eb74f3182">set_logging</a></div><div class="ttdeci">static void set_logging(logging_state_t *state, struct ast_fax_session_details *details)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d47/res__fax__spandsp_8c_source.html#l00444">res_fax_spandsp.c:444</a></div></div>
<div class="ttc" id="structframe__list_html"><div class="ttname"><a href="../../d9/d42/structframe__list.html">frame_list</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d21/res__rtp__asterisk_8c_source.html#l00590">res_rtp_asterisk.c:590</a></div></div>
<div class="ttc" id="structast__fax__t38__parameters_html_ad2b3d53474db70e3ff2058da953b7b82"><div class="ttname"><a href="../../d3/df6/structast__fax__t38__parameters.html#ad2b3d53474db70e3ff2058da953b7b82">ast_fax_t38_parameters::transcoding_mmr</a></div><div class="ttdeci">unsigned int transcoding_mmr</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d6a/res__fax_8h_source.html#l00098">res_fax.h:98</a></div></div>
<div class="ttc" id="structast__fax__t38__parameters_html_a07676322ec48c4872f9a208a6248d034"><div class="ttname"><a href="../../d3/df6/structast__fax__t38__parameters.html#a07676322ec48c4872f9a208a6248d034">ast_fax_t38_parameters::transcoding_jbig</a></div><div class="ttdeci">unsigned int transcoding_jbig</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d6a/res__fax_8h_source.html#l00099">res_fax.h:99</a></div></div>
<div class="ttc" id="include_2asterisk_2frame_8h_html_ae2e1a9c4e048da387b761f619312d6e0ad99b86353343f422bda01163898b2eea"><div class="ttname"><a href="../../d6/d66/include_2asterisk_2frame_8h.html#ae2e1a9c4e048da387b761f619312d6e0ad99b86353343f422bda01163898b2eea">AST_FRAME_MODEM</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d66/include_2asterisk_2frame_8h_source.html#l00123">include/asterisk/frame.h:123</a></div></div>
<div class="ttc" id="structspandsp__pvt_html_a7a6ac9a55317a92c59f3542dea61cdae"><div class="ttname"><a href="../../d2/d70/structspandsp__pvt.html#a7a6ac9a55317a92c59f3542dea61cdae">spandsp_pvt::tone_state</a></div><div class="ttdeci">modem_connect_tones_rx_state_t * tone_state</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d47/res__fax__spandsp_8c_source.html#l00164">res_fax_spandsp.c:164</a></div></div>
<div class="ttc" id="timing_8h_html_a338edb7e927b891ef4aba288d9c07e56"><div class="ttname"><a href="../../db/d41/timing_8h.html#a338edb7e927b891ef4aba288d9c07e56">ast_timer_ack</a></div><div class="ttdeci">int ast_timer_ack(const struct ast_timer *handle, unsigned int quantity)</div><div class="ttdoc">Acknowledge a timer event. </div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d62/timing_8c_source.html#l00171">timing.c:171</a></div></div>
<div class="ttc" id="logger_8h_html_aced66975c154ea0e2a8ec3bc818b4e08"><div class="ttname"><a href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a></div><div class="ttdeci">#define LOG_ERROR</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d8c/logger_8h_source.html#l00285">logger.h:285</a></div></div>
<div class="ttc" id="linkedlists_8h_html_a4d258b4525e63c435d7de579d3f46960"><div class="ttname"><a href="../../df/d90/linkedlists_8h.html#a4d258b4525e63c435d7de579d3f46960">AST_LIST_INSERT_TAIL</a></div><div class="ttdeci">#define AST_LIST_INSERT_TAIL(head, elm, field)</div><div class="ttdoc">Appends a list entry to the tail of a list. </div><div class="ttdef"><b>Definition:</b> <a href="../../df/d90/linkedlists_8h_source.html#l00730">linkedlists.h:730</a></div></div>
<div class="ttc" id="include_2asterisk_2frame_8h_html_ac8bc210573f6b9c55ef38662bddc4675"><div class="ttname"><a href="../../d6/d66/include_2asterisk_2frame_8h.html#ac8bc210573f6b9c55ef38662bddc4675">AST_FRAME_SET_BUFFER</a></div><div class="ttdeci">#define AST_FRAME_SET_BUFFER(fr, _base, _ofs, _datalen)</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d66/include_2asterisk_2frame_8h_source.html#l00208">include/asterisk/frame.h:208</a></div></div>
<div class="ttc" id="structspandsp__pvt_html_a1b5003edd88843375153c462a72343f3"><div class="ttname"><a href="../../d2/d70/structspandsp__pvt.html#a1b5003edd88843375153c462a72343f3">spandsp_pvt::stats</a></div><div class="ttdeci">struct spandsp_fax_stats * stats</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d47/res__fax__spandsp_8c_source.html#l00155">res_fax_spandsp.c:155</a></div></div>
<div class="ttc" id="res__fax_8h_html_ab9287e81dc5d3047da0bcb1f6c89bd57ae3b2fd3e12f8b526273b642e0c0a342a"><div class="ttname"><a href="../../db/d6a/res__fax_8h.html#ab9287e81dc5d3047da0bcb1f6c89bd57ae3b2fd3e12f8b526273b642e0c0a342a">AST_FAX_MODEM_V27TER</a></div><div class="ttdef"><b>Definition:</b> <a href="../../db/d6a/res__fax_8h_source.html#l00057">res_fax.h:57</a></div></div>
<div class="ttc" id="structast__fax__session__details_html_ac579558087dfa900a4c5384cb6e09dd8"><div class="ttname"><a href="../../d8/dc2/structast__fax__session__details.html#ac579558087dfa900a4c5384cb6e09dd8">ast_fax_session_details::pages_transferred</a></div><div class="ttdeci">unsigned int pages_transferred</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d6a/res__fax_8h_source.html#l00144">res_fax.h:144</a></div></div>
<div class="ttc" id="structast__str_html"><div class="ttname"><a href="../../dd/da2/structast__str.html">ast_str</a></div><div class="ttdoc">The descriptor of a dynamic string XXX storage will be optimized later if needed We use the ts field ...</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d90/strings_8h_source.html#l00584">strings.h:584</a></div></div>
<div class="ttc" id="structast__fax__session__details_html_aed36280452b10bbcf7cb35873db02762"><div class="ttname"><a href="../../d8/dc2/structast__fax__session__details.html#aed36280452b10bbcf7cb35873db02762">ast_fax_session_details::v21_detected</a></div><div class="ttdeci">uint32_t v21_detected</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d6a/res__fax_8h_source.html#l00167">res_fax.h:167</a></div></div>
<div class="ttc" id="res__fax__spandsp_8c_html_aff3bb506c68bf48a84a242b915c91758"><div class="ttname"><a href="../../d5/d47/res__fax__spandsp_8c.html#aff3bb506c68bf48a84a242b915c91758">spandsp_fax_destroy</a></div><div class="ttdeci">static void spandsp_fax_destroy(struct ast_fax_session *s)</div><div class="ttdoc">Destroy a spandsp fax session. </div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d47/res__fax__spandsp_8c_source.html#l00603">res_fax_spandsp.c:603</a></div></div>
<div class="ttc" id="res__fax__spandsp_8c_html_ac3382bf6da54c56b37069bd76bbdf4f9"><div class="ttname"><a href="../../d5/d47/res__fax__spandsp_8c.html#ac3382bf6da54c56b37069bd76bbdf4f9">load_module</a></div><div class="ttdeci">static int load_module(void)</div><div class="ttdoc">load res_fax_spandsp </div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d47/res__fax__spandsp_8c_source.html#l01249">res_fax_spandsp.c:1249</a></div></div>
<div class="ttc" id="structast__fax__t38__parameters_html_a7924cc45cde640e779a902c4aadaf180"><div class="ttname"><a href="../../d3/df6/structast__fax__t38__parameters.html#a7924cc45cde640e779a902c4aadaf180">ast_fax_t38_parameters::max_ifp</a></div><div class="ttdeci">unsigned int max_ifp</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d6a/res__fax_8h_source.html#l00094">res_fax.h:94</a></div></div>
<div class="ttc" id="structspandsp__fax__stats_html_a7156cb5e1d68d88369be68ad26ba8502"><div class="ttname"><a href="../../dd/df2/structspandsp__fax__stats.html#a7156cb5e1d68d88369be68ad26ba8502">spandsp_fax_stats::nofax</a></div><div class="ttdeci">int nofax</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d47/res__fax__spandsp_8c_source.html#l00126">res_fax_spandsp.c:126</a></div></div>
<div class="ttc" id="structast__fax__session__details_html_a14c20eed7d6d03b484ebc2cc7a447ea2"><div class="ttname"><a href="../../d8/dc2/structast__fax__session__details.html#a14c20eed7d6d03b484ebc2cc7a447ea2">ast_fax_session_details::documents</a></div><div class="ttdeci">struct ast_fax_documents documents</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d6a/res__fax_8h_source.html#l00119">res_fax.h:119</a></div></div>
<div class="ttc" id="func__strings_8c_html_af24e73aaf92f3000fda15d285e66df24"><div class="ttname"><a href="../../d9/d1e/func__strings_8c.html#af24e73aaf92f3000fda15d285e66df24">len</a></div><div class="ttdeci">static int len(struct ast_channel *chan, const char *cmd, char *data, char *buf, size_t buflen)</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d1e/func__strings_8c_source.html#l01344">func_strings.c:1344</a></div></div>
<div class="ttc" id="res__fax_8h_html_ab9287e81dc5d3047da0bcb1f6c89bd57af68d38a189351562faca6609a162b5a6"><div class="ttname"><a href="../../db/d6a/res__fax_8h.html#ab9287e81dc5d3047da0bcb1f6c89bd57af68d38a189351562faca6609a162b5a6">AST_FAX_MODEM_V34</a></div><div class="ttdef"><b>Definition:</b> <a href="../../db/d6a/res__fax_8h_source.html#l00061">res_fax.h:61</a></div></div>
<div class="ttc" id="structast__fax__tech_html"><div class="ttname"><a href="../../d9/d0e/structast__fax__tech.html">ast_fax_tech</a></div><div class="ttdoc">used to register a FAX technology module with res_fax </div><div class="ttdef"><b>Definition:</b> <a href="../../db/d6a/res__fax_8h_source.html#l00235">res_fax.h:235</a></div></div>
<div class="ttc" id="res__fax__spandsp_8c_html_adf5e0a963a0c910f4affa63d1ba1353e"><div class="ttname"><a href="../../d5/d47/res__fax__spandsp_8c.html#adf5e0a963a0c910f4affa63d1ba1353e">update_stats</a></div><div class="ttdeci">static int update_stats(struct spandsp_pvt *p, int completion_code)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d47/res__fax__spandsp_8c_source.html#l00257">res_fax_spandsp.c:257</a></div></div>
<div class="ttc" id="structspandsp__pvt_html_add1eaf99c12ebcef83fa7c1d4ca52f9f"><div class="ttname"><a href="../../d2/d70/structspandsp__pvt.html#add1eaf99c12ebcef83fa7c1d4ca52f9f">spandsp_pvt::ast_t38_state</a></div><div class="ttdeci">enum ast_t38_state ast_t38_state</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d47/res__fax__spandsp_8c_source.html#l00149">res_fax_spandsp.c:149</a></div></div>
<div class="ttc" id="linkedlists_8h_html_a6f42d3bf45cc9af6f794d9d1cf8c45ca"><div class="ttname"><a href="../../df/d90/linkedlists_8h.html#a6f42d3bf45cc9af6f794d9d1cf8c45ca">AST_LIST_HEAD_INIT</a></div><div class="ttdeci">#define AST_LIST_HEAD_INIT(head)</div><div class="ttdoc">Initializes a list head structure. </div><div class="ttdef"><b>Definition:</b> <a href="../../df/d90/linkedlists_8h_source.html#l00625">linkedlists.h:625</a></div></div>
<div class="ttc" id="astmm_8h_html_a402072d6789f6ed9e3a81da27504127e"><div class="ttname"><a href="../../d8/d8a/astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a></div><div class="ttdeci">#define ast_free(a)</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d8a/astmm_8h_source.html#l00182">astmm.h:182</a></div></div>
<div class="ttc" id="astmm_8h_html_ae0cd4c5524b01287ab19cbe233d9cebb"><div class="ttname"><a href="../../d8/d8a/astmm_8h.html#ae0cd4c5524b01287ab19cbe233d9cebb">ast_calloc</a></div><div class="ttdeci">#define ast_calloc(num, len)</div><div class="ttdoc">A wrapper for calloc() </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d8a/astmm_8h_source.html#l00204">astmm.h:204</a></div></div>
<div class="ttc" id="structast__fax__session__details_html_af766692698b742acddbc42494d323a9f"><div class="ttname"><a href="../../d8/dc2/structast__fax__session__details.html#af766692698b742acddbc42494d323a9f">ast_fax_session_details::ecm</a></div><div class="ttdeci">uint32_t ecm</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d6a/res__fax_8h_source.html#l00153">res_fax.h:153</a></div></div>
<div class="ttc" id="res__fax__spandsp_8c_html_a5fa4f4dc494fc66a1764e00783006b75"><div class="ttname"><a href="../../d5/d47/res__fax__spandsp_8c.html#a5fa4f4dc494fc66a1764e00783006b75">set_file</a></div><div class="ttdeci">static void set_file(t30_state_t *t30_state, struct ast_fax_session_details *details)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d47/res__fax__spandsp_8c_source.html#l00467">res_fax_spandsp.c:467</a></div></div>
<div class="ttc" id="structspandsp__pvt_html_af2bd73f7c4fe9e40a5d5cb75dcbca598"><div class="ttname"><a href="../../d2/d70/structspandsp__pvt.html#af2bd73f7c4fe9e40a5d5cb75dcbca598">spandsp_pvt::isdone</a></div><div class="ttdeci">unsigned int isdone</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d47/res__fax__spandsp_8c_source.html#l00148">res_fax_spandsp.c:148</a></div></div>
<div class="ttc" id="structast__frame_html_ac92588540e8c1d014a08cd8a45462b19"><div class="ttname"><a href="../../d0/d99/structast__frame.html#ac92588540e8c1d014a08cd8a45462b19">ast_frame::flags</a></div><div class="ttdeci">unsigned int flags</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d66/include_2asterisk_2frame_8h_source.html#l00189">include/asterisk/frame.h:189</a></div></div>
<div class="ttc" id="structspandsp__pvt_html_adcd6f30baf585999693211a967c2db61"><div class="ttname"><a href="../../d2/d70/structspandsp__pvt.html#adcd6f30baf585999693211a967c2db61">spandsp_pvt::t30_state</a></div><div class="ttdeci">t30_state_t * t30_state</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d47/res__fax__spandsp_8c_source.html#l00152">res_fax_spandsp.c:152</a></div></div>
<div class="ttc" id="structast__fax__session__details_html_a38b557eee45ee4c0d92d514c04823f84"><div class="ttname"><a href="../../d8/dc2/structast__fax__session__details.html#a38b557eee45ee4c0d92d514c04823f84">ast_fax_session_details::modems</a></div><div class="ttdeci">enum ast_fax_modems modems</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d6a/res__fax_8h_source.html#l00115">res_fax.h:115</a></div></div>
<div class="ttc" id="channel_8h_html_a79c413d51b7135404d5cacf811649a61"><div class="ttname"><a href="../../d5/d7b/channel_8h.html#a79c413d51b7135404d5cacf811649a61">ast_write</a></div><div class="ttdeci">int ast_write(struct ast_channel *chan, struct ast_frame *frame)</div><div class="ttdoc">Write a frame to a channel This function writes the given frame to the indicated channel. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d28/channel_8c_source.html#l05189">channel.c:5189</a></div></div>
<div class="ttc" id="structast__fax__session_html_ad8f346e1752edcc0b1a6b431b1749f0e"><div class="ttname"><a href="../../d1/d16/structast__fax__session.html#ad8f346e1752edcc0b1a6b431b1749f0e">ast_fax_session::state</a></div><div class="ttdeci">enum ast_fax_state state</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d6a/res__fax_8h_source.html#l00218">res_fax.h:218</a></div></div>
<div class="ttc" id="module_8h_html_adc09474f0ff557e9925b722ee5b952dfac742921e9f9512d28f62c74ea2affe57"><div class="ttname"><a href="../../d5/d16/module_8h.html#adc09474f0ff557e9925b722ee5b952dfac742921e9f9512d28f62c74ea2affe57">AST_MODULE_LOAD_DECLINE</a></div><div class="ttdoc">Module has failed to load, may be in an inconsistent state. </div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d16/module_8h_source.html#l00078">module.h:78</a></div></div>
<div class="ttc" id="structast__fax__session_html_a6f8059414f0228f0256115e024eeed4b"><div class="ttname"><a href="../../d1/d16/structast__fax__session.html#a6f8059414f0228f0256115e024eeed4b">ast_fax_session::fd</a></div><div class="ttdeci">int fd</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d6a/res__fax_8h_source.html#l00206">res_fax.h:206</a></div></div>
<div class="ttc" id="res__fax_8h_html_abb5f973c1052179a51f936be5c43a852"><div class="ttname"><a href="../../db/d6a/res__fax_8h.html#abb5f973c1052179a51f936be5c43a852">ast_fax_log</a></div><div class="ttdeci">void ast_fax_log(int level, const char *file, const int line, const char *function, const char *msg)</div><div class="ttdoc">Log message at FAX or recommended level. </div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d60/res__fax_8c_source.html#l01036">res_fax.c:1036</a></div></div>
<div class="ttc" id="include_2asterisk_2frame_8h_html_a314496ce1d74ed7fdb9c5319c5e2e953"><div class="ttname"><a href="../../d6/d66/include_2asterisk_2frame_8h.html#a314496ce1d74ed7fdb9c5319c5e2e953">ast_frisolate</a></div><div class="ttdeci">#define ast_frisolate(fr)</div><div class="ttdoc">Makes a frame independent of any static storage. </div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d66/include_2asterisk_2frame_8h_source.html#l00577">include/asterisk/frame.h:577</a></div></div>
<div class="ttc" id="structstate_html"><div class="ttname"><a href="../../d4/d88/structstate.html">state</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d9/df8/localtime_8c_source.html#l00158">localtime.c:158</a></div></div>
<div class="ttc" id="channel_8h_html_a4cd990f4c1cd0c2af6e4c63f6d15b4e1af142c79721a025bd65edad812f0725e0"><div class="ttname"><a href="../../d5/d7b/channel_8h.html#a4cd990f4c1cd0c2af6e4c63f6d15b4e1af142c79721a025bd65edad812f0725e0">T38_STATE_NEGOTIATED</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d7b/channel_8h_source.html#l00884">channel.h:884</a></div></div>
<div class="ttc" id="timing_8h_html_aa3aa7580d76e1d3f7927b3f34764dec2"><div class="ttname"><a href="../../db/d41/timing_8h.html#aa3aa7580d76e1d3f7927b3f34764dec2">ast_timer_fd</a></div><div class="ttdeci">int ast_timer_fd(const struct ast_timer *handle)</div><div class="ttdoc">Get a poll()-able file descriptor for a timer. </div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d62/timing_8c_source.html#l00161">timing.c:161</a></div></div>
<div class="ttc" id="timing_8h_html_a4dae39fb5fb680a48a05d7567053eb03"><div class="ttname"><a href="../../db/d41/timing_8h.html#a4dae39fb5fb680a48a05d7567053eb03">ast_timer_set_rate</a></div><div class="ttdeci">int ast_timer_set_rate(const struct ast_timer *handle, unsigned int rate)</div><div class="ttdoc">Set the timing tick rate. </div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d62/timing_8c_source.html#l00166">timing.c:166</a></div></div>
<div class="ttc" id="res__fax_8h_html_ab34810136037068a0847bcca2518112cad0225f93f7c72e6071a0e2c459ec213c"><div class="ttname"><a href="../../db/d6a/res__fax_8h.html#ab34810136037068a0847bcca2518112cad0225f93f7c72e6071a0e2c459ec213c">AST_FAX_STATE_OPEN</a></div><div class="ttdef"><b>Definition:</b> <a href="../../db/d6a/res__fax_8h_source.html#l00071">res_fax.h:71</a></div></div>
<div class="ttc" id="res__fax__spandsp_8c_html_ad09fa931f468002152a3cc2d5ce25eae"><div class="ttname"><a href="../../d5/d47/res__fax__spandsp_8c.html#ad09fa931f468002152a3cc2d5ce25eae">unload_module</a></div><div class="ttdeci">static int unload_module(void)</div><div class="ttdoc">unload res_fax_spandsp </div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d47/res__fax__spandsp_8c_source.html#l01241">res_fax_spandsp.c:1241</a></div></div>
<div class="ttc" id="stringfields_8h_html_a8b9f4347fc72720cc5cead952b54abe9"><div class="ttname"><a href="../../d1/d0f/stringfields_8h.html#a8b9f4347fc72720cc5cead952b54abe9">ast_string_field_build</a></div><div class="ttdeci">#define ast_string_field_build(x, field, fmt, args...)</div><div class="ttdoc">Set a field to a complex (built) value. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d0f/stringfields_8h_source.html#l00550">stringfields.h:550</a></div></div>
<div class="ttc" id="res__fax__spandsp_8c_html_aed0bd5d9c0943587312263618faaf6c3"><div class="ttname"><a href="../../d5/d47/res__fax__spandsp_8c.html#aed0bd5d9c0943587312263618faaf6c3">spandsp_fax_write</a></div><div class="ttdeci">static int spandsp_fax_write(struct ast_fax_session *s, const struct ast_frame *f)</div><div class="ttdoc">Write a frame to the spandsp fax stack. </div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d47/res__fax__spandsp_8c_source.html#l00734">res_fax_spandsp.c:734</a></div></div>
<div class="ttc" id="res__fax__spandsp_8c_html_a985020177397f3b53f8c375b9f5555a9"><div class="ttname"><a href="../../d5/d47/res__fax__spandsp_8c.html#a985020177397f3b53f8c375b9f5555a9">set_local_info</a></div><div class="ttdeci">static void set_local_info(t30_state_t *t30_state, struct ast_fax_session_details *details)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d47/res__fax__spandsp_8c_source.html#l00456">res_fax_spandsp.c:456</a></div></div>
<div class="ttc" id="logger_8h_html"><div class="ttname"><a href="../../d1/d8c/logger_8h.html">logger.h</a></div><div class="ttdoc">Support for logging to various files, console and syslog Configuration in file logger.conf. </div></div>
<div class="ttc" id="res__phoneprov_8c_html_addaa208b0ed785225e24490fb9f28a80"><div class="ttname"><a href="../../d9/de9/res__phoneprov_8c.html#addaa208b0ed785225e24490fb9f28a80">AST_MODULE_INFO</a></div><div class="ttdeci">AST_MODULE_INFO(ASTERISK_GPL_KEY, AST_MODFLAG_GLOBAL_SYMBOLS|AST_MODFLAG_LOAD_ORDER, &quot;HTTP Phone Provisioning&quot;,.support_level=AST_MODULE_SUPPORT_EXTENDED,.load=load_module,.unload=unload_module,.reload=reload,.load_pri=AST_MODPRI_CHANNEL_DEPEND,.requires=&quot;http&quot;,)</div></div>
<div class="ttc" id="structast__frame_html_aed16590d48f41d89f31e0cf347f5cd99"><div class="ttname"><a href="../../d0/d99/structast__frame.html#aed16590d48f41d89f31e0cf347f5cd99">ast_frame::mallocd</a></div><div class="ttdeci">int mallocd</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d66/include_2asterisk_2frame_8h_source.html#l00175">include/asterisk/frame.h:175</a></div></div>
<div class="ttc" id="module_8h_html_a155a0df9c59e04e305d4a2fa3e35f843a54af2a9b29d140908cc9dffd0618951b"><div class="ttname"><a href="../../d5/d16/module_8h.html#a155a0df9c59e04e305d4a2fa3e35f843a54af2a9b29d140908cc9dffd0618951b">AST_MODFLAG_DEFAULT</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d16/module_8h_source.html#l00315">module.h:315</a></div></div>
<div class="ttc" id="res__fax__spandsp_8c_html_a632e62933ba50a9269eeeede6e8db7e5"><div class="ttname"><a href="../../d5/d47/res__fax__spandsp_8c.html#a632e62933ba50a9269eeeede6e8db7e5">spandsp_fax_cli_show_stats</a></div><div class="ttdeci">static char * spandsp_fax_cli_show_stats(int fd)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d47/res__fax__spandsp_8c_source.html#l01197">res_fax_spandsp.c:1197</a></div></div>
<div class="ttc" id="include_2asterisk_2frame_8h_html_af203379aca2fd704fe8d86a9445596b6"><div class="ttname"><a href="../../d6/d66/include_2asterisk_2frame_8h.html#af203379aca2fd704fe8d86a9445596b6">ast_null_frame</a></div><div class="ttdeci">struct ast_frame ast_null_frame</div><div class="ttdef"><b>Definition:</b> <a href="../../df/d55/main_2frame_8c_source.html#l00079">main/frame.c:79</a></div></div>
<div class="ttc" id="structast__fax__t38__parameters_html_a5408ac5df4c170828874e1b10b4c35a0"><div class="ttname"><a href="../../d3/df6/structast__fax__t38__parameters.html#a5408ac5df4c170828874e1b10b4c35a0">ast_fax_t38_parameters::version</a></div><div class="ttdeci">unsigned int version</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d6a/res__fax_8h_source.html#l00093">res_fax.h:93</a></div></div>
<div class="ttc" id="res__fax__spandsp_8c_html_a1358377ae5cb4e9a6f1b2f03c5555b0e"><div class="ttname"><a href="../../d5/d47/res__fax__spandsp_8c.html#a1358377ae5cb4e9a6f1b2f03c5555b0e">spandsp_log</a></div><div class="ttdeci">static void spandsp_log(int level, const char *msg)</div><div class="ttdoc">Send spandsp log messages to asterisk. </div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d47/res__fax__spandsp_8c_source.html#l00433">res_fax_spandsp.c:433</a></div></div>
<div class="ttc" id="cli_8h_html_a50989f00b32eeb2516a3803cb2ffb766"><div class="ttname"><a href="../../dc/db0/cli_8h.html#a50989f00b32eeb2516a3803cb2ffb766">CLI_SUCCESS</a></div><div class="ttdeci">#define CLI_SUCCESS</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/db0/cli_8h_source.html#l00044">cli.h:44</a></div></div>
<div class="ttc" id="res__fax__spandsp_8c_html_ac7fd98ac3a6b6d9a649dc1a7df2e6b25"><div class="ttname"><a href="../../d5/d47/res__fax__spandsp_8c.html#ac7fd98ac3a6b6d9a649dc1a7df2e6b25">SPANDSP_ENGAGE_UDPTL_NAT_RETRY</a></div><div class="ttdeci">#define SPANDSP_ENGAGE_UDPTL_NAT_RETRY</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d47/res__fax__spandsp_8c_source.html#l00072">res_fax_spandsp.c:72</a></div></div>
<div class="ttc" id="res__fax__spandsp_8c_html_adf04f66344e3fb0a6f6a69bf39d19902"><div class="ttname"><a href="../../d5/d47/res__fax__spandsp_8c.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a></div><div class="ttdeci">ast_mutex_t lock</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d47/res__fax__spandsp_8c_source.html#l00141">res_fax_spandsp.c:141</a></div></div>
<div class="ttc" id="astobj2_8h_html_a6321ee982370c55ab3c24c72c562cbdd"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#a6321ee982370c55ab3c24c72c562cbdd">ao2_cleanup</a></div><div class="ttdeci">#define ao2_cleanup(obj)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l01958">astobj2.h:1958</a></div></div>
<div class="ttc" id="cli_8h_html"><div class="ttname"><a href="../../dc/db0/cli_8h.html">cli.h</a></div><div class="ttdoc">Standard Command Line Interface. </div></div>
<div class="ttc" id="res__fax__spandsp_8c_html_a9865dea3c8d3c70c21e466560f339210"><div class="ttname"><a href="../../d5/d47/res__fax__spandsp_8c.html#a9865dea3c8d3c70c21e466560f339210">SPANDSP_FAX_TIMER_RATE</a></div><div class="ttdeci">#define SPANDSP_FAX_TIMER_RATE</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d47/res__fax__spandsp_8c_source.html#l00071">res_fax_spandsp.c:71</a></div></div>
<div class="ttc" id="format__cache_8h_html_a95c058fe6adef68780f026d6aec2481c"><div class="ttname"><a href="../../db/d1c/format__cache_8h.html#a95c058fe6adef68780f026d6aec2481c">ast_format_alaw</a></div><div class="ttdeci">struct ast_format * ast_format_alaw</div><div class="ttdoc">Built-in cached alaw format. </div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d29/format__cache_8c_source.html#l00091">format_cache.c:91</a></div></div>
<div class="ttc" id="res__fax__spandsp_8c_html_a26afae7dd9d256776976330e21298e68"><div class="ttname"><a href="../../d5/d47/res__fax__spandsp_8c.html#a26afae7dd9d256776976330e21298e68">SPANDSP_FAX_SAMPLES</a></div><div class="ttdeci">#define SPANDSP_FAX_SAMPLES</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d47/res__fax__spandsp_8c_source.html#l00070">res_fax_spandsp.c:70</a></div></div>
<div class="ttc" id="structspandsp__fax__stats_html_a90dbed02abe7da6da26595204c44758e"><div class="ttname"><a href="../../dd/df2/structspandsp__fax__stats.html#a90dbed02abe7da6da26595204c44758e">spandsp_fax_stats::file_error</a></div><div class="ttdeci">int file_error</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d47/res__fax__spandsp_8c_source.html#l00133">res_fax_spandsp.c:133</a></div></div>
<div class="ttc" id="channel_8h_html_af9e27ecd92ff5aa897c9e058dfbd6510"><div class="ttname"><a href="../../d5/d7b/channel_8h.html#af9e27ecd92ff5aa897c9e058dfbd6510">ast_channel_bridge_peer</a></div><div class="ttdeci">struct ast_channel * ast_channel_bridge_peer(struct ast_channel *chan)</div><div class="ttdoc">Get the channel&amp;#39;s bridge peer only if the bridge is two-party. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d28/channel_8c_source.html#l10765">channel.c:10765</a></div></div>
<div class="ttc" id="app__minivm_8c_html_aa8cecfc5c5c054d2875c03e77b7be15d"><div class="ttname"><a href="../../de/dfe/app__minivm_8c.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a></div><div class="ttdeci">#define TRUE</div><div class="ttdef"><b>Definition:</b> <a href="../../de/dfe/app__minivm_8c_source.html#l00518">app_minivm.c:518</a></div></div>
<div class="ttc" id="res__fax_8h_html_ab34810136037068a0847bcca2518112ca89690cf17e4dd810bc40e657ac1d6213"><div class="ttname"><a href="../../db/d6a/res__fax_8h.html#ab34810136037068a0847bcca2518112ca89690cf17e4dd810bc40e657ac1d6213">AST_FAX_STATE_COMPLETE</a></div><div class="ttdef"><b>Definition:</b> <a href="../../db/d6a/res__fax_8h_source.html#l00075">res_fax.h:75</a></div></div>
<div class="ttc" id="include_2asterisk_2frame_8h_html_a6440d070425a2efe8e0aa71e8d9e47b7"><div class="ttname"><a href="../../d6/d66/include_2asterisk_2frame_8h.html#a6440d070425a2efe8e0aa71e8d9e47b7">ast_frfree</a></div><div class="ttdeci">#define ast_frfree(fr)</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d66/include_2asterisk_2frame_8h_source.html#l00556">include/asterisk/frame.h:556</a></div></div>
<div class="ttc" id="cel__pgsql_8c_html_ad6c487210772a9b4b0ca04b04b847d4c"><div class="ttname"><a href="../../de/d1b/cel__pgsql_8c.html#ad6c487210772a9b4b0ca04b04b847d4c">result</a></div><div class="ttdeci">static PGresult * result</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d1b/cel__pgsql_8c_source.html#l00088">cel_pgsql.c:88</a></div></div>
<div class="ttc" id="structast__fax__session_html"><div class="ttname"><a href="../../d1/d16/structast__fax__session.html">ast_fax_session</a></div><div class="ttdoc">The data required to handle a fax session. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/d6a/res__fax_8h_source.html#l00202">res_fax.h:202</a></div></div>
<div class="ttc" id="include_2asterisk_2frame_8h_html_a3a510e4e2673c6870ed5fe0f1eb53732"><div class="ttname"><a href="../../d6/d66/include_2asterisk_2frame_8h.html#a3a510e4e2673c6870ed5fe0f1eb53732">AST_MODEM_T38</a></div><div class="ttdeci">#define AST_MODEM_T38</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d66/include_2asterisk_2frame_8h_source.html#l00241">include/asterisk/frame.h:241</a></div></div>
<div class="ttc" id="res__fax_8h_html_a70598462f8d1c09bb43e7a7091498e53"><div class="ttname"><a href="../../db/d6a/res__fax_8h.html#a70598462f8d1c09bb43e7a7091498e53">ast_fax_state_to_str</a></div><div class="ttdeci">const char * ast_fax_state_to_str(enum ast_fax_state state)</div><div class="ttdoc">convert an ast_fax_state to a string </div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d60/res__fax_8c_source.html#l01013">res_fax.c:1013</a></div></div>
<div class="ttc" id="structast__frame_html"><div class="ttname"><a href="../../d0/d99/structast__frame.html">ast_frame</a></div><div class="ttdoc">Data structure associated with a single frame of data. </div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d66/include_2asterisk_2frame_8h_source.html#l00165">include/asterisk/frame.h:165</a></div></div>
<div class="ttc" id="structast__fax__t38__parameters_html_ad39f48f545d7c8962dfa0ae83a61c21f"><div class="ttname"><a href="../../d3/df6/structast__fax__t38__parameters.html#ad39f48f545d7c8962dfa0ae83a61c21f">ast_fax_t38_parameters::rate_management</a></div><div class="ttdeci">enum ast_control_t38_rate_management rate_management</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d6a/res__fax_8h_source.html#l00096">res_fax.h:96</a></div></div>
<div class="ttc" id="structast__fax__session__details_html_ad75375cdd336e91cbcee4a829fcdabfe"><div class="ttname"><a href="../../d8/dc2/structast__fax__session__details.html#ad75375cdd336e91cbcee4a829fcdabfe">ast_fax_session_details::caps</a></div><div class="ttdeci">enum ast_fax_capabilities caps</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d6a/res__fax_8h_source.html#l00113">res_fax.h:113</a></div></div>
<div class="ttc" id="structast__fax__session_html_a19aa04db5508cf9496602e694dc69e2f"><div class="ttname"><a href="../../d1/d16/structast__fax__session.html#a19aa04db5508cf9496602e694dc69e2f">ast_fax_session::tech_pvt</a></div><div class="ttdeci">void * tech_pvt</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d6a/res__fax_8h_source.html#l00216">res_fax.h:216</a></div></div>
<div class="ttc" id="utils_2frame_8c_html_a4a9391ee88e57361b613c4c2fd2bf4aa"><div class="ttname"><a href="../../d6/d47/utils_2frame_8c.html#a4a9391ee88e57361b613c4c2fd2bf4aa">error</a></div><div class="ttdeci">int error(const char *format,...)</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d47/utils_2frame_8c_source.html#l00999">utils/frame.c:999</a></div></div>
<div class="ttc" id="structast__fax__session__details_html_a8e155783a5296f8607948dfbe5783933"><div class="ttname"><a href="../../d8/dc2/structast__fax__session__details.html#a8e155783a5296f8607948dfbe5783933">ast_fax_session_details::resultstr</a></div><div class="ttdeci">const ast_string_field resultstr</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d6a/res__fax_8h_source.html#l00142">res_fax.h:142</a></div></div>
<div class="ttc" id="structast__frame_html_a4027905f872af30d910929b07e261ca5"><div class="ttname"><a href="../../d0/d99/structast__frame.html#a4027905f872af30d910929b07e261ca5">ast_frame::data</a></div><div class="ttdeci">union ast_frame::@263 data</div></div>
<div class="ttc" id="structast__frame_html_a6937b93c56cb473b547eda454dca7b4c"><div class="ttname"><a href="../../d0/d99/structast__frame.html#a6937b93c56cb473b547eda454dca7b4c">ast_frame::frametype</a></div><div class="ttdeci">enum ast_frame_type frametype</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d66/include_2asterisk_2frame_8h_source.html#l00167">include/asterisk/frame.h:167</a></div></div>
<div class="ttc" id="structast__fax__session__details_html_a045d24c59f1a8a85e8fbc745fff88140"><div class="ttname"><a href="../../d8/dc2/structast__fax__session__details.html#a045d24c59f1a8a85e8fbc745fff88140">ast_fax_session_details::localstationid</a></div><div class="ttdeci">const ast_string_field localstationid</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d6a/res__fax_8h_source.html#l00142">res_fax.h:142</a></div></div>
<div class="ttc" id="lock_8h_html_a76e8ed6bb354be6c6dd9e51acc1d7a1b"><div class="ttname"><a href="../../dd/d42/lock_8h.html#a76e8ed6bb354be6c6dd9e51acc1d7a1b">ast_mutex_init</a></div><div class="ttdeci">#define ast_mutex_init(pmutex)</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d42/lock_8h_source.html#l00184">lock.h:184</a></div></div>
<div class="ttc" id="structspandsp__fax__stats_html_a38e2c3144ba423a7ddfdcbea40cc798c"><div class="ttname"><a href="../../dd/df2/structspandsp__fax__stats.html#a38e2c3144ba423a7ddfdcbea40cc798c">spandsp_fax_stats::switched</a></div><div class="ttdeci">int switched</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d47/res__fax__spandsp_8c_source.html#l00137">res_fax_spandsp.c:137</a></div></div>
<div class="ttc" id="structspandsp__fax__stats_html_a6538a52840afd2ad6aba6a1ea5d89e50"><div class="ttname"><a href="../../dd/df2/structspandsp__fax__stats.html#a6538a52840afd2ad6aba6a1ea5d89e50">spandsp_fax_stats::success</a></div><div class="ttdeci">int success</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d47/res__fax__spandsp_8c_source.html#l00125">res_fax_spandsp.c:125</a></div></div>
<div class="ttc" id="lock_8h_html_ab8977a71822daa556f19f30ba6eec765"><div class="ttname"><a href="../../dd/d42/lock_8h.html#ab8977a71822daa556f19f30ba6eec765">ast_mutex_destroy</a></div><div class="ttdeci">#define ast_mutex_destroy(a)</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d42/lock_8h_source.html#l00186">lock.h:186</a></div></div>
<div class="ttc" id="structast__frame__subclass_html_ab425a484a0916077c5a30d9d7b229b44"><div class="ttname"><a href="../../d1/d9f/structast__frame__subclass.html#ab425a484a0916077c5a30d9d7b229b44">ast_frame_subclass::format</a></div><div class="ttdeci">struct ast_format * format</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d66/include_2asterisk_2frame_8h_source.html#l00155">include/asterisk/frame.h:155</a></div></div>
<div class="ttc" id="res__fax_8h_html_a1838c71fcf68c3cfe0ce37e35e77406daa2151729c413238bea86a4b62e7865bd"><div class="ttname"><a href="../../db/d6a/res__fax_8h.html#a1838c71fcf68c3cfe0ce37e35e77406daa2151729c413238bea86a4b62e7865bd">AST_FAX_OPTFLAG_FALSE</a></div><div class="ttdef"><b>Definition:</b> <a href="../../db/d6a/res__fax_8h_source.html#l00085">res_fax.h:85</a></div></div>
<div class="ttc" id="res__fax__spandsp_8c_html_a6db78b000e8a71a5d7f7efba26639e41"><div class="ttname"><a href="../../d5/d47/res__fax__spandsp_8c.html#a6db78b000e8a71a5d7f7efba26639e41">spandsp_fax_new</a></div><div class="ttdeci">static void * spandsp_fax_new(struct ast_fax_session *s, struct ast_fax_tech_token *token)</div><div class="ttdoc">create an instance of the spandsp tech_pvt for a fax session </div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d47/res__fax__spandsp_8c_source.html#l00525">res_fax_spandsp.c:525</a></div></div>
<div class="ttc" id="module_8h_html_aba2c8d4be709a254658b21a834f8294a"><div class="ttname"><a href="../../d5/d16/module_8h.html#aba2c8d4be709a254658b21a834f8294a">ASTERISK_GPL_KEY</a></div><div class="ttdeci">#define ASTERISK_GPL_KEY</div><div class="ttdoc">The text the key() function should return. </div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d16/module_8h_source.html#l00046">module.h:46</a></div></div>
<div class="ttc" id="format__cache_8h_html_a771d7c34570e8e492c25a0c2eb41889d"><div class="ttname"><a href="../../db/d1c/format__cache_8h.html#a771d7c34570e8e492c25a0c2eb41889d">ast_format_slin</a></div><div class="ttdeci">struct ast_format * ast_format_slin</div><div class="ttdoc">Built-in cached signed linear 8kHz format. </div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d29/format__cache_8c_source.html#l00041">format_cache.c:41</a></div></div>
<div class="ttc" id="module_8h_html"><div class="ttname"><a href="../../d5/d16/module_8h.html">module.h</a></div><div class="ttdoc">Asterisk module definitions. </div></div>
<div class="ttc" id="structast__fax__t38__parameters_html_addb721c952a7144f0a6a9ac5f621d2bc"><div class="ttname"><a href="../../d3/df6/structast__fax__t38__parameters.html#addb721c952a7144f0a6a9ac5f621d2bc">ast_fax_t38_parameters::fill_bit_removal</a></div><div class="ttdeci">unsigned int fill_bit_removal</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d6a/res__fax_8h_source.html#l00097">res_fax.h:97</a></div></div>
<div class="ttc" id="structast__fax__session__details_html_a12cc2bfdcc88e94984d001cca6fefdc5"><div class="ttname"><a href="../../d8/dc2/structast__fax__session__details.html#a12cc2bfdcc88e94984d001cca6fefdc5">ast_fax_session_details::their_t38_parameters</a></div><div class="ttdeci">struct ast_fax_t38_parameters their_t38_parameters</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d6a/res__fax_8h_source.html#l00177">res_fax.h:177</a></div></div>
<div class="ttc" id="structspandsp__pvt_html"><div class="ttname"><a href="../../d2/d70/structspandsp__pvt.html">spandsp_pvt</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d47/res__fax__spandsp_8c_source.html#l00146">res_fax_spandsp.c:146</a></div></div>
<div class="ttc" id="res__fax_8h_html_ab34810136037068a0847bcca2518112cad2e2632aa1b6333fcd0e89c554d0df54"><div class="ttname"><a href="../../db/d6a/res__fax_8h.html#ab34810136037068a0847bcca2518112cad2e2632aa1b6333fcd0e89c554d0df54">AST_FAX_STATE_UNINITIALIZED</a></div><div class="ttdef"><b>Definition:</b> <a href="../../db/d6a/res__fax_8h_source.html#l00067">res_fax.h:67</a></div></div>
<div class="ttc" id="structast__frame_html_aaccba9d5adc3f6c39aad767db95ba484"><div class="ttname"><a href="../../d0/d99/structast__frame.html#aaccba9d5adc3f6c39aad767db95ba484">ast_frame::len</a></div><div class="ttdeci">long len</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d66/include_2asterisk_2frame_8h_source.html#l00193">include/asterisk/frame.h:193</a></div></div>
<div class="ttc" id="res__fax__spandsp_8c_html_ac663d21c565affc72b520a9581181897"><div class="ttname"><a href="../../d5/d47/res__fax__spandsp_8c.html#ac663d21c565affc72b520a9581181897">spandsp_v21_new</a></div><div class="ttdeci">static int spandsp_v21_new(struct spandsp_pvt *p)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d47/res__fax__spandsp_8c_source.html#l00485">res_fax_spandsp.c:485</a></div></div>
<div class="ttc" id="timing_8h_html"><div class="ttname"><a href="../../db/d41/timing_8h.html">timing.h</a></div><div class="ttdoc">Timing source management. </div></div>
<div class="ttc" id="structspandsp__fax__stats_html_ad1e948fb3a2a49d70040c6c7470f00f4"><div class="ttname"><a href="../../dd/df2/structspandsp__fax__stats.html#ad1e948fb3a2a49d70040c6c7470f00f4">spandsp_fax_stats::tx_protocol_error</a></div><div class="ttdeci">int tx_protocol_error</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d47/res__fax__spandsp_8c_source.html#l00130">res_fax_spandsp.c:130</a></div></div>
<div class="ttc" id="structast__mutex__info_html"><div class="ttname"><a href="../../d8/dc5/structast__mutex__info.html">ast_mutex_info</a></div><div class="ttdoc">Structure for mutex and tracking information. </div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d42/lock_8h_source.html#l00135">lock.h:135</a></div></div>
<div class="ttc" id="structast__frame_html_a37672e6b906143604cefd3e959777b31"><div class="ttname"><a href="../../d0/d99/structast__frame.html#a37672e6b906143604cefd3e959777b31">ast_frame::samples</a></div><div class="ttdeci">int samples</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d66/include_2asterisk_2frame_8h_source.html#l00173">include/asterisk/frame.h:173</a></div></div>
<div class="ttc" id="res__fax__spandsp_8c_html_ad7634e872ab24fc86bb8237a6d2f4463"><div class="ttname"><a href="../../d5/d47/res__fax__spandsp_8c.html#ad7634e872ab24fc86bb8237a6d2f4463">spandsp_fax_gw_gen_alloc</a></div><div class="ttdeci">static void * spandsp_fax_gw_gen_alloc(struct ast_channel *chan, void *params)</div><div class="ttdoc">simple routine to allocate data to generator </div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d47/res__fax__spandsp_8c_source.html#l00799">res_fax_spandsp.c:799</a></div></div>
<div class="ttc" id="format__cache_8h_html"><div class="ttname"><a href="../../db/d1c/format__cache_8h.html">format_cache.h</a></div><div class="ttdoc">Media Format Cache API. </div></div>
<div class="ttc" id="strings_8h_html_a9c34c6c6b8daaba24c0406270f3cf697"><div class="ttname"><a href="../../d6/d90/strings_8h.html#a9c34c6c6b8daaba24c0406270f3cf697">ast_str_create</a></div><div class="ttdeci">#define ast_str_create(init_len)</div><div class="ttdoc">Create a malloc&amp;#39;ed dynamic length string. </div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d90/strings_8h_source.html#l00620">strings.h:620</a></div></div>
<div class="ttc" id="res__fax_8h_html_aa1e6a64120757501a2e6a1a076e070ff"><div class="ttname"><a href="../../db/d6a/res__fax_8h.html#aa1e6a64120757501a2e6a1a076e070ff">ast_fax_tech_register</a></div><div class="ttdeci">int ast_fax_tech_register(struct ast_fax_tech *tech)</div><div class="ttdoc">register a fax technology </div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d60/res__fax_8c_source.html#l00974">res_fax.c:974</a></div></div>
<div class="ttc" id="lock_8h_html_a873f9ce8c6287a32d48c83133e124418"><div class="ttname"><a href="../../dd/d42/lock_8h.html#a873f9ce8c6287a32d48c83133e124418">ast_mutex_unlock</a></div><div class="ttdeci">#define ast_mutex_unlock(a)</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d42/lock_8h_source.html#l00188">lock.h:188</a></div></div>
<div class="ttc" id="structspandsp__fax__stats_html_a8f4d51f1065dae0b6d2544dc53572177"><div class="ttname"><a href="../../dd/df2/structspandsp__fax__stats.html#a8f4d51f1065dae0b6d2544dc53572177">spandsp_fax_stats::retries_exceeded</a></div><div class="ttdeci">int retries_exceeded</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d47/res__fax__spandsp_8c_source.html#l00132">res_fax_spandsp.c:132</a></div></div>
<div class="ttc" id="structspandsp__pvt_html_a6209294447011868d1a0ec7373bb90b5"><div class="ttname"><a href="../../d2/d70/structspandsp__pvt.html#a6209294447011868d1a0ec7373bb90b5">spandsp_pvt::fax_state</a></div><div class="ttdeci">fax_state_t fax_state</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d47/res__fax__spandsp_8c_source.html#l00150">res_fax_spandsp.c:150</a></div></div>
<div class="ttc" id="stringfields_8h_html_a653461abd6e0d16e4e3326ab90e0501d"><div class="ttname"><a href="../../d1/d0f/stringfields_8h.html#a653461abd6e0d16e4e3326ab90e0501d">ast_string_field_set</a></div><div class="ttdeci">#define ast_string_field_set(x, field, data)</div><div class="ttdoc">Set a field to a simple string value. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d0f/stringfields_8h_source.html#l00514">stringfields.h:514</a></div></div>
</div><!-- fragment --></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Sun Aug 8 2021 19:44:01 for Asterisk - The Open Source Telephony Project by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="../../doxygen.png" alt="doxygen"/>
</a> 1.8.13
</small></address>
</body>
</html>
