<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Asterisk - The Open Source Telephony Project: Named mutex and read-write locks</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Asterisk - The Open Source Telephony Project
   &#160;<span id="projectnumber">18.5.0</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "../../search",false,'Search');
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('../../',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#define-members">Macros</a> &#124;
<a href="#enum-members">Enumerations</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">Named mutex and read-write locks</div>  </div>
</div><!--header-->
<div class="contents">
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="define-members"></a>
Macros</h2></td></tr>
<tr class="memitem:ga2322f66e9b72ca5cc591a556c567d3e0"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d0/db9/group__named__locks.html#ga2322f66e9b72ca5cc591a556c567d3e0">ast_named_lock_get</a>(lock_type,  keyspace,  key)</td></tr>
<tr class="memdesc:ga2322f66e9b72ca5cc591a556c567d3e0"><td class="mdescLeft">&#160;</td><td class="mdescRight">Geta named lock handle.  <a href="#ga2322f66e9b72ca5cc591a556c567d3e0">More...</a><br /></td></tr>
<tr class="separator:ga2322f66e9b72ca5cc591a556c567d3e0"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga16b38cbe1bbd5caee828393d0299f463"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d0/db9/group__named__locks.html#ga16b38cbe1bbd5caee828393d0299f463">ast_named_lock_put</a>(<a class="el" href="../../d7/d8e/test__cdr_8c.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>)&#160;&#160;&#160;<a class="el" href="../../d5/da5/astobj2_8h.html#a6321ee982370c55ab3c24c72c562cbdd">ao2_cleanup</a>(<a class="el" href="../../d7/d8e/test__cdr_8c.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>)</td></tr>
<tr class="memdesc:ga16b38cbe1bbd5caee828393d0299f463"><td class="mdescLeft">&#160;</td><td class="mdescRight">Put a named lock handle away.  <a href="#ga16b38cbe1bbd5caee828393d0299f463">More...</a><br /></td></tr>
<tr class="separator:ga16b38cbe1bbd5caee828393d0299f463"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="enum-members"></a>
Enumerations</h2></td></tr>
<tr class="memitem:ga9536e506e987386496d90bb12f1da9c7"><td class="memItemLeft" align="right" valign="top">enum &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d0/db9/group__named__locks.html#ga9536e506e987386496d90bb12f1da9c7">ast_named_lock_type</a> { <a class="el" href="../../d0/db9/group__named__locks.html#gga9536e506e987386496d90bb12f1da9c7a4320f5fc7cf75e313ebddce649562d83">AST_NAMED_LOCK_TYPE_MUTEX</a> = AO2_ALLOC_OPT_LOCK_MUTEX, 
<a class="el" href="../../d0/db9/group__named__locks.html#gga9536e506e987386496d90bb12f1da9c7a054abefe3bc1b1f8f8d67256ba31248b">AST_NAMED_LOCK_TYPE_RWLOCK</a> = AO2_ALLOC_OPT_LOCK_RWLOCK
 }<tr class="memdesc:ga9536e506e987386496d90bb12f1da9c7"><td class="mdescLeft">&#160;</td><td class="mdescRight">Which type of lock to request.  <a href="../../d0/db9/group__named__locks.html#ga9536e506e987386496d90bb12f1da9c7">More...</a><br /></td></tr>
</td></tr>
<tr class="separator:ga9536e506e987386496d90bb12f1da9c7"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:ga7bf75e9abc0b115d760aa256805ec582"><td class="memItemLeft" align="right" valign="top">struct <a class="el" href="../../d0/d55/structast__named__lock.html">ast_named_lock</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d0/db9/group__named__locks.html#ga7bf75e9abc0b115d760aa256805ec582">__ast_named_lock_get</a> (const char *filename, int lineno, const char *func, enum <a class="el" href="../../d0/db9/group__named__locks.html#ga9536e506e987386496d90bb12f1da9c7">ast_named_lock_type</a> lock_type, const char *keyspace, const char *key)</td></tr>
<tr class="separator:ga7bf75e9abc0b115d760aa256805ec582"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>


<h3><a id="NamedLocks"></a>Named mutex and read-write locks</h3><div class="textblock"><dl class="section since"><dt>Since</dt><dd>13.9.0</dd></dl>
<p>Locking some objects like sorcery objects can be tricky because the underlying ao2 object may not be the same for all callers. For instance, two threads that call ast_sorcery_retrieve_by_id on the same aor name might actually get 2 different ao2 objects if the underlying wizard had to rehydrate the aor from a database. Locking one ao2 object doesn't have any effect on the other even if those objects had locks in the first placeNamed locks allow access control by name. Now an aor named "1000" can be locked and any other thread attempting to lock the aor named "1000" will wait regardless of whether the underlying ao2 object is the same or not.To use a named lock: Call ast_named_lock_get with the appropriate keyspace and key. Use the standard ao2 lock/unlock functions as needed. Call ao2_cleanup when you're finished with it. </div><h2 class="groupheader">Macro Definition Documentation</h2>
<a id="ga2322f66e9b72ca5cc591a556c567d3e0"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga2322f66e9b72ca5cc591a556c567d3e0">&#9670;&nbsp;</a></span>ast_named_lock_get</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define ast_named_lock_get</td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">lock_type, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">keyspace, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">key&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<b>Value:</b><div class="fragment"><div class="line"><a class="code" href="../../d0/db9/group__named__locks.html#ga7bf75e9abc0b115d760aa256805ec582">__ast_named_lock_get</a>(__FILE__, __LINE__, __PRETTY_FUNCTION__, lock_type, \</div><div class="line">      keyspace, key)</div><div class="ttc" id="group__named__locks_html_ga7bf75e9abc0b115d760aa256805ec582"><div class="ttname"><a href="../../d0/db9/group__named__locks.html#ga7bf75e9abc0b115d760aa256805ec582">__ast_named_lock_get</a></div><div class="ttdeci">struct ast_named_lock * __ast_named_lock_get(const char *filename, int lineno, const char *func, enum ast_named_lock_type lock_type, const char *keyspace, const char *key)</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/db9/named__locks_8c_source.html#l00070">named_locks.c:70</a></div></div>
</div><!-- fragment -->
<p>Geta named lock handle. </p>
<dl class="section since"><dt>Since</dt><dd>13.9.0</dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">lock_type</td><td>One of ast_named_lock_type </td></tr>
    <tr><td class="paramname">keyspace</td><td></td></tr>
    <tr><td class="paramname">key</td><td></td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">A</td><td>pointer to an <a class="el" href="../../d0/d55/structast__named__lock.html">ast_named_lock</a> structure </td></tr>
    <tr><td class="paramname">NULL</td><td>on error</td></tr>
  </table>
  </dd>
</dl>
<dl class="section note"><dt>Note</dt><dd>keyspace and key can be anything. For sorcery objects, keyspace could be the object type and key could be the object id. </dd></dl>

<p class="definition">Definition at line <a class="el" href="../../d1/d32/named__locks_8h_source.html#l00083">83</a> of file <a class="el" href="../../d1/d32/named__locks_8h_source.html">named_locks.h</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../d0/dad/location_8c_source.html#l00050">aor_alloc()</a>, <a class="el" href="../../db/dd1/test__named__lock_8c_source.html#l00058">AST_TEST_DEFINE()</a>, <a class="el" href="../../d3/db0/res__pjsip__registrar_8c_source.html#l01242">expire_contact()</a>, and <a class="el" href="../../db/dd1/test__named__lock_8c_source.html#l00041">lock_thread()</a>.</p>

</div>
</div>
<a id="ga16b38cbe1bbd5caee828393d0299f463"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga16b38cbe1bbd5caee828393d0299f463">&#9670;&nbsp;</a></span>ast_named_lock_put</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define ast_named_lock_put</td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><a class="el" href="../../d7/d8e/test__cdr_8c.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a></td><td>)</td>
          <td>&#160;&#160;&#160;<a class="el" href="../../d5/da5/astobj2_8h.html#a6321ee982370c55ab3c24c72c562cbdd">ao2_cleanup</a>(<a class="el" href="../../d7/d8e/test__cdr_8c.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Put a named lock handle away. </p>
<dl class="section since"><dt>Since</dt><dd>13.9.0</dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">lock</td><td>The pointer to the <a class="el" href="../../d0/d55/structast__named__lock.html">ast_named_lock</a> structure returned by ast_named_lock_get </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="../../d1/d32/named__locks_8h_source.html#l00093">93</a> of file <a class="el" href="../../d1/d32/named__locks_8h_source.html">named_locks.h</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../db/dd1/test__named__lock_8c_source.html#l00058">AST_TEST_DEFINE()</a>, <a class="el" href="../../d3/db0/res__pjsip__registrar_8c_source.html#l01242">expire_contact()</a>, and <a class="el" href="../../db/dd1/test__named__lock_8c_source.html#l00041">lock_thread()</a>.</p>

</div>
</div>
<h2 class="groupheader">Enumeration Type Documentation</h2>
<a id="ga9536e506e987386496d90bb12f1da9c7"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga9536e506e987386496d90bb12f1da9c7">&#9670;&nbsp;</a></span>ast_named_lock_type</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">enum <a class="el" href="../../d0/db9/group__named__locks.html#ga9536e506e987386496d90bb12f1da9c7">ast_named_lock_type</a></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Which type of lock to request. </p>
<table class="fieldtable">
<tr><th colspan="2">Enumerator</th></tr><tr><td class="fieldname"><a id="gga9536e506e987386496d90bb12f1da9c7a4320f5fc7cf75e313ebddce649562d83"></a>AST_NAMED_LOCK_TYPE_MUTEX&#160;</td><td class="fielddoc"><p>Request a named mutex. </p>
</td></tr>
<tr><td class="fieldname"><a id="gga9536e506e987386496d90bb12f1da9c7a054abefe3bc1b1f8f8d67256ba31248b"></a>AST_NAMED_LOCK_TYPE_RWLOCK&#160;</td><td class="fielddoc"><p>Request a named read/write lock. </p>
</td></tr>
</table>

<p class="definition">Definition at line <a class="el" href="../../d1/d32/named__locks_8h_source.html#l00057">57</a> of file <a class="el" href="../../d1/d32/named__locks_8h_source.html">named_locks.h</a>.</p>
<div class="fragment"><div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;                         {<span class="comment"></span></div><div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;<span class="comment">   /*! Request a named mutex. */</span></div><div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;   <a class="code" href="../../d0/db9/group__named__locks.html#gga9536e506e987386496d90bb12f1da9c7a4320f5fc7cf75e313ebddce649562d83">AST_NAMED_LOCK_TYPE_MUTEX</a> = <a class="code" href="../../d5/da5/astobj2_8h.html#a2cf7e3433f08351aafe3b0cd31edf7f8a8ccf751bd6749d062999469f0694e7ad">AO2_ALLOC_OPT_LOCK_MUTEX</a>,<span class="comment"></span></div><div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;<span class="comment">   /*! Request a named read/write lock. */</span></div><div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;   <a class="code" href="../../d0/db9/group__named__locks.html#gga9536e506e987386496d90bb12f1da9c7a054abefe3bc1b1f8f8d67256ba31248b">AST_NAMED_LOCK_TYPE_RWLOCK</a> = <a class="code" href="../../d5/da5/astobj2_8h.html#a2cf7e3433f08351aafe3b0cd31edf7f8a7016a58d1b7524c186ccc72ec48ef488">AO2_ALLOC_OPT_LOCK_RWLOCK</a>,</div><div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;};</div><div class="ttc" id="group__named__locks_html_gga9536e506e987386496d90bb12f1da9c7a054abefe3bc1b1f8f8d67256ba31248b"><div class="ttname"><a href="../../d0/db9/group__named__locks.html#gga9536e506e987386496d90bb12f1da9c7a054abefe3bc1b1f8f8d67256ba31248b">AST_NAMED_LOCK_TYPE_RWLOCK</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d32/named__locks_8h_source.html#l00061">named_locks.h:61</a></div></div>
<div class="ttc" id="astobj2_8h_html_a2cf7e3433f08351aafe3b0cd31edf7f8a8ccf751bd6749d062999469f0694e7ad"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#a2cf7e3433f08351aafe3b0cd31edf7f8a8ccf751bd6749d062999469f0694e7ad">AO2_ALLOC_OPT_LOCK_MUTEX</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l00365">astobj2.h:365</a></div></div>
<div class="ttc" id="group__named__locks_html_gga9536e506e987386496d90bb12f1da9c7a4320f5fc7cf75e313ebddce649562d83"><div class="ttname"><a href="../../d0/db9/group__named__locks.html#gga9536e506e987386496d90bb12f1da9c7a4320f5fc7cf75e313ebddce649562d83">AST_NAMED_LOCK_TYPE_MUTEX</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d32/named__locks_8h_source.html#l00059">named_locks.h:59</a></div></div>
<div class="ttc" id="astobj2_8h_html_a2cf7e3433f08351aafe3b0cd31edf7f8a7016a58d1b7524c186ccc72ec48ef488"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#a2cf7e3433f08351aafe3b0cd31edf7f8a7016a58d1b7524c186ccc72ec48ef488">AO2_ALLOC_OPT_LOCK_RWLOCK</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l00367">astobj2.h:367</a></div></div>
</div><!-- fragment -->
</div>
</div>
<h2 class="groupheader">Function Documentation</h2>
<a id="ga7bf75e9abc0b115d760aa256805ec582"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga7bf75e9abc0b115d760aa256805ec582">&#9670;&nbsp;</a></span>__ast_named_lock_get()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="../../d0/d55/structast__named__lock.html">ast_named_lock</a>* __ast_named_lock_get </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>filename</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>lineno</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>func</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">enum <a class="el" href="../../d0/db9/group__named__locks.html#ga9536e506e987386496d90bb12f1da9c7">ast_named_lock_type</a>&#160;</td>
          <td class="paramname"><em>lock_type</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>keyspace</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>key</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="../../d7/db9/named__locks_8c_source.html#l00070">70</a> of file <a class="el" href="../../d7/db9/named__locks_8c_source.html">named_locks.c</a>.</p>

<p class="reference">References <a class="el" href="../../da/df7/astobj2_8c_source.html#l00765">__ao2_alloc()</a>, <a class="el" href="../../d7/d22/astobj2__container_8c_source.html#l00440">__ao2_weakproxy_find()</a>, <a class="el" href="../../d5/da5/astobj2_8h_source.html#l00371">AO2_ALLOC_OPT_LOCK_MASK</a>, <a class="el" href="../../d5/da5/astobj2_8h_source.html#l01958">ao2_cleanup</a>, <a class="el" href="../../d5/da5/astobj2_8h_source.html#l01572">ao2_link_flags</a>, <a class="el" href="../../d5/da5/astobj2_8h_source.html#l00718">ao2_lock</a>, <a class="el" href="../../da/df7/astobj2_8c_source.html#l00778">ao2_options_get()</a>, <a class="el" href="../../d5/da5/astobj2_8h_source.html#l00463">ao2_t_ref</a>, <a class="el" href="../../d5/da5/astobj2_8h_source.html#l00557">ao2_t_weakproxy_alloc</a>, <a class="el" href="../../d5/da5/astobj2_8h_source.html#l00730">ao2_unlock</a>, <a class="el" href="../../d5/da5/astobj2_8h_source.html#l00583">ao2_weakproxy_set_object</a>, <a class="el" href="../../da/df7/astobj2_8c_source.html#l00931">ao2_weakproxy_subscribe()</a>, <a class="el" href="../../d8/d8a/astmm_8h_source.html#l00290">ast_alloca</a>, <a class="el" href="../../d5/d60/utils_8h_source.html#l00695">ast_assert</a>, <a class="el" href="../../d7/db9/named__locks_8c_source.html#l00038">named_lock_proxy::key</a>, <a class="el" href="../../df/d44/app__meetme_8c_source.html#l01091">lock</a>, <a class="el" href="../../d7/db9/named__locks_8c_source.html#l00065">named_lock_proxy_cb()</a>, <a class="el" href="../../dc/d7f/resample_8c_source.html#l00096">NULL</a>, <a class="el" href="../../d5/da5/astobj2_8h_source.html#l01067">OBJ_NOLOCK</a>, and <a class="el" href="../../d5/da5/astobj2_8h_source.html#l01105">OBJ_SEARCH_KEY</a>.</p>
<div class="fragment"><div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;{</div><div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d7/d2b/structnamed__lock__proxy.html">named_lock_proxy</a> *proxy;</div><div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d0/d55/structast__named__lock.html">ast_named_lock</a> *<a class="code" href="../../df/d44/app__meetme_8c.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>;</div><div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;   <span class="keywordtype">int</span> keylen = strlen(keyspace) + strlen(key) + 2;</div><div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;   <span class="keywordtype">char</span> *concat_key = <a class="code" href="../../d8/d8a/astmm_8h.html#a249282ecc7ba5a1a49fa75e9a33d1717">ast_alloca</a>(keylen);</div><div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;</div><div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;   sprintf(concat_key, <span class="stringliteral">&quot;%s-%s&quot;</span>, keyspace, key); <span class="comment">/* Safe */</span></div><div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;</div><div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#aa9fdb5d0a6157a56060d9f7279fe6c49">ao2_lock</a>(<a class="code" href="../../d7/db9/named__locks_8c.html#accb691943f2d3314af5e29a528665e0c">named_locks</a>);</div><div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;   lock = <a class="code" href="../../d5/da5/astobj2_8h.html#ad79a0846c5df92a70b282a62e6d5e708">__ao2_weakproxy_find</a>(<a class="code" href="../../d7/db9/named__locks_8c.html#accb691943f2d3314af5e29a528665e0c">named_locks</a>, concat_key, <a class="code" href="../../d5/da5/astobj2_8h.html#ad9d009e87e737af900825b36db55a35caa13a6e0771cc457e86f425d95c3b8d54">OBJ_SEARCH_KEY</a> | <a class="code" href="../../d5/da5/astobj2_8h.html#ad9d009e87e737af900825b36db55a35ca52efdf13b66ae502e2e20a5f49f068de">OBJ_NOLOCK</a>,</div><div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;      __PRETTY_FUNCTION__, filename, lineno, func);</div><div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;   <span class="keywordflow">if</span> (lock) {</div><div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;      <a class="code" href="../../d5/d60/utils_8h.html#a24374da24af1931d8a7ccde5b352bb2c">ast_assert</a>((<a class="code" href="../../d5/da5/astobj2_8h.html#a1e3333ded530a38de14dfd1b61893a55">ao2_options_get</a>(lock) &amp; <a class="code" href="../../d5/da5/astobj2_8h.html#a2cf7e3433f08351aafe3b0cd31edf7f8ac08617f2ab082fd8d6d4b96a99f90aae">AO2_ALLOC_OPT_LOCK_MASK</a>) == lock_type);</div><div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;      <a class="code" href="../../d5/da5/astobj2_8h.html#a9998bd156b936636a8780385e9a910b2">ao2_unlock</a>(<a class="code" href="../../d7/db9/named__locks_8c.html#accb691943f2d3314af5e29a528665e0c">named_locks</a>);</div><div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;</div><div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../df/d44/app__meetme_8c.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>;</div><div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;   }</div><div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;</div><div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;   proxy = <a class="code" href="../../d5/da5/astobj2_8h.html#a927c9a5bce40a0164c297325eea4a562">ao2_t_weakproxy_alloc</a>(<span class="keyword">sizeof</span>(*proxy) + keylen, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, concat_key);</div><div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;   <span class="keywordflow">if</span> (!proxy) {</div><div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;      <span class="keywordflow">goto</span> failure_cleanup;</div><div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;   }</div><div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;</div><div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;   lock = <a class="code" href="../../d5/da5/astobj2_8h.html#aefc036c9ca7cf5266f1058d67b8ef541">__ao2_alloc</a>(<span class="keyword">sizeof</span>(*lock) + keylen, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, lock_type, concat_key, filename, lineno, func);</div><div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;   <span class="keywordflow">if</span> (!lock) {</div><div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;      <span class="keywordflow">goto</span> failure_cleanup;</div><div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;   }</div><div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;</div><div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;   <span class="comment">/* We have exclusive access to proxy and lock, no need for locking here. */</span></div><div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d5/da5/astobj2_8h.html#a0216e3d4898d0a5062bd88c9970e7835">ao2_weakproxy_set_object</a>(proxy, lock, <a class="code" href="../../d5/da5/astobj2_8h.html#ad9d009e87e737af900825b36db55a35ca52efdf13b66ae502e2e20a5f49f068de">OBJ_NOLOCK</a>)) {</div><div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;      <span class="keywordflow">goto</span> failure_cleanup;</div><div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;   }</div><div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;</div><div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d5/da5/astobj2_8h.html#a0f7c2d3037d7c36c8c88fdb2cb65c6e1">ao2_weakproxy_subscribe</a>(proxy, <a class="code" href="../../d7/db9/named__locks_8c.html#a4f9026df39b8defdcc313b3d1eb1a677">named_lock_proxy_cb</a>, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../d5/da5/astobj2_8h.html#ad9d009e87e737af900825b36db55a35ca52efdf13b66ae502e2e20a5f49f068de">OBJ_NOLOCK</a>)) {</div><div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;      <span class="keywordflow">goto</span> failure_cleanup;</div><div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;   }</div><div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;</div><div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;   strcpy(proxy-&gt;<a class="code" href="../../d7/d2b/structnamed__lock__proxy.html#a667e79aefb650051c9e6787155fc3dd2">key</a>, concat_key); <span class="comment">/* Safe */</span></div><div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#a7ce8563daf84a18540a86504d165b444">ao2_link_flags</a>(<a class="code" href="../../d7/db9/named__locks_8c.html#accb691943f2d3314af5e29a528665e0c">named_locks</a>, proxy, <a class="code" href="../../d5/da5/astobj2_8h.html#ad9d009e87e737af900825b36db55a35ca52efdf13b66ae502e2e20a5f49f068de">OBJ_NOLOCK</a>);</div><div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#a9998bd156b936636a8780385e9a910b2">ao2_unlock</a>(<a class="code" href="../../d7/db9/named__locks_8c.html#accb691943f2d3314af5e29a528665e0c">named_locks</a>);</div><div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#a14c61bcab109a520a96d30c56ba5fcde">ao2_t_ref</a>(proxy, -1, <span class="stringliteral">&quot;Release allocation reference&quot;</span>);</div><div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;</div><div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;   <span class="keywordflow">return</span> <a class="code" href="../../df/d44/app__meetme_8c.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>;</div><div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;</div><div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;failure_cleanup:</div><div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#a9998bd156b936636a8780385e9a910b2">ao2_unlock</a>(<a class="code" href="../../d7/db9/named__locks_8c.html#accb691943f2d3314af5e29a528665e0c">named_locks</a>);</div><div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;</div><div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#a6321ee982370c55ab3c24c72c562cbdd">ao2_cleanup</a>(proxy);</div><div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#a6321ee982370c55ab3c24c72c562cbdd">ao2_cleanup</a>(lock);</div><div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;</div><div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;   <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;}</div><div class="ttc" id="astobj2_8h_html_a14c61bcab109a520a96d30c56ba5fcde"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#a14c61bcab109a520a96d30c56ba5fcde">ao2_t_ref</a></div><div class="ttdeci">#define ao2_t_ref(o, delta, tag)</div><div class="ttdoc">Reference/unreference an object and return the old refcount. </div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l00463">astobj2.h:463</a></div></div>
<div class="ttc" id="named__locks_8c_html_a4f9026df39b8defdcc313b3d1eb1a677"><div class="ttname"><a href="../../d7/db9/named__locks_8c.html#a4f9026df39b8defdcc313b3d1eb1a677">named_lock_proxy_cb</a></div><div class="ttdeci">static void named_lock_proxy_cb(void *weakproxy, void *data)</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/db9/named__locks_8c_source.html#l00065">named_locks.c:65</a></div></div>
<div class="ttc" id="astobj2_8h_html_a0216e3d4898d0a5062bd88c9970e7835"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#a0216e3d4898d0a5062bd88c9970e7835">ao2_weakproxy_set_object</a></div><div class="ttdeci">#define ao2_weakproxy_set_object(weakproxy, obj, flags)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l00583">astobj2.h:583</a></div></div>
<div class="ttc" id="astobj2_8h_html_ad9d009e87e737af900825b36db55a35caa13a6e0771cc457e86f425d95c3b8d54"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#ad9d009e87e737af900825b36db55a35caa13a6e0771cc457e86f425d95c3b8d54">OBJ_SEARCH_KEY</a></div><div class="ttdoc">The arg parameter is a search key, but is not an object. </div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l01105">astobj2.h:1105</a></div></div>
<div class="ttc" id="astobj2_8h_html_aefc036c9ca7cf5266f1058d67b8ef541"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#aefc036c9ca7cf5266f1058d67b8ef541">__ao2_alloc</a></div><div class="ttdeci">void * __ao2_alloc(size_t data_size, ao2_destructor_fn destructor_fn, unsigned int options, const char *tag, const char *file, int line, const char *func) attribute_warn_unused_result</div><div class="ttdef"><b>Definition:</b> <a href="../../da/df7/astobj2_8c_source.html#l00765">astobj2.c:765</a></div></div>
<div class="ttc" id="astobj2_8h_html_ad9d009e87e737af900825b36db55a35ca52efdf13b66ae502e2e20a5f49f068de"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#ad9d009e87e737af900825b36db55a35ca52efdf13b66ae502e2e20a5f49f068de">OBJ_NOLOCK</a></div><div class="ttdoc">Assume that the ao2_container is already locked. </div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l01067">astobj2.h:1067</a></div></div>
<div class="ttc" id="utils_8h_html_a24374da24af1931d8a7ccde5b352bb2c"><div class="ttname"><a href="../../d5/d60/utils_8h.html#a24374da24af1931d8a7ccde5b352bb2c">ast_assert</a></div><div class="ttdeci">#define ast_assert(a)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d60/utils_8h_source.html#l00695">utils.h:695</a></div></div>
<div class="ttc" id="astobj2_8h_html_a7ce8563daf84a18540a86504d165b444"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#a7ce8563daf84a18540a86504d165b444">ao2_link_flags</a></div><div class="ttdeci">#define ao2_link_flags(container, obj, flags)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l01572">astobj2.h:1572</a></div></div>
<div class="ttc" id="astobj2_8h_html_a0f7c2d3037d7c36c8c88fdb2cb65c6e1"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#a0f7c2d3037d7c36c8c88fdb2cb65c6e1">ao2_weakproxy_subscribe</a></div><div class="ttdeci">int ao2_weakproxy_subscribe(void *weakproxy, ao2_weakproxy_notification_cb cb, void *data, int flags)</div><div class="ttdoc">Request notification when weakproxy points to NULL. </div><div class="ttdef"><b>Definition:</b> <a href="../../da/df7/astobj2_8c_source.html#l00931">astobj2.c:931</a></div></div>
<div class="ttc" id="astobj2_8h_html_a9998bd156b936636a8780385e9a910b2"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#a9998bd156b936636a8780385e9a910b2">ao2_unlock</a></div><div class="ttdeci">#define ao2_unlock(a)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l00730">astobj2.h:730</a></div></div>
<div class="ttc" id="resample_8c_html_a070d2ce7b6bb7e5c05602aa8c308d0c4"><div class="ttname"><a href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a></div><div class="ttdeci">#define NULL</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d7f/resample_8c_source.html#l00096">resample.c:96</a></div></div>
<div class="ttc" id="named__locks_8c_html_accb691943f2d3314af5e29a528665e0c"><div class="ttname"><a href="../../d7/db9/named__locks_8c.html#accb691943f2d3314af5e29a528665e0c">named_locks</a></div><div class="ttdeci">struct ao2_container * named_locks</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/db9/named__locks_8c_source.html#l00033">named_locks.c:33</a></div></div>
<div class="ttc" id="app__meetme_8c_html_adf04f66344e3fb0a6f6a69bf39d19902"><div class="ttname"><a href="../../df/d44/app__meetme_8c.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a></div><div class="ttdeci">ast_mutex_t lock</div><div class="ttdef"><b>Definition:</b> <a href="../../df/d44/app__meetme_8c_source.html#l01091">app_meetme.c:1091</a></div></div>
<div class="ttc" id="astobj2_8h_html_aa9fdb5d0a6157a56060d9f7279fe6c49"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#aa9fdb5d0a6157a56060d9f7279fe6c49">ao2_lock</a></div><div class="ttdeci">#define ao2_lock(a)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l00718">astobj2.h:718</a></div></div>
<div class="ttc" id="structnamed__lock__proxy_html_a667e79aefb650051c9e6787155fc3dd2"><div class="ttname"><a href="../../d7/d2b/structnamed__lock__proxy.html#a667e79aefb650051c9e6787155fc3dd2">named_lock_proxy::key</a></div><div class="ttdeci">char key[0]</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/db9/named__locks_8c_source.html#l00038">named_locks.c:38</a></div></div>
<div class="ttc" id="astobj2_8h_html_ad79a0846c5df92a70b282a62e6d5e708"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#ad79a0846c5df92a70b282a62e6d5e708">__ao2_weakproxy_find</a></div><div class="ttdeci">void * __ao2_weakproxy_find(struct ao2_container *c, const void *arg, enum search_flags flags, const char *tag, const char *file, int line, const char *func)</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d22/astobj2__container_8c_source.html#l00440">astobj2_container.c:440</a></div></div>
<div class="ttc" id="astmm_8h_html_a249282ecc7ba5a1a49fa75e9a33d1717"><div class="ttname"><a href="../../d8/d8a/astmm_8h.html#a249282ecc7ba5a1a49fa75e9a33d1717">ast_alloca</a></div><div class="ttdeci">#define ast_alloca(size)</div><div class="ttdoc">call __builtin_alloca to ensure we get gcc builtin semantics </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d8a/astmm_8h_source.html#l00290">astmm.h:290</a></div></div>
<div class="ttc" id="structast__named__lock_html"><div class="ttname"><a href="../../d0/d55/structast__named__lock.html">ast_named_lock</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d7/db9/named__locks_8c_source.html#l00041">named_locks.c:41</a></div></div>
<div class="ttc" id="structnamed__lock__proxy_html"><div class="ttname"><a href="../../d7/d2b/structnamed__lock__proxy.html">named_lock_proxy</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d7/db9/named__locks_8c_source.html#l00036">named_locks.c:36</a></div></div>
<div class="ttc" id="astobj2_8h_html_a6321ee982370c55ab3c24c72c562cbdd"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#a6321ee982370c55ab3c24c72c562cbdd">ao2_cleanup</a></div><div class="ttdeci">#define ao2_cleanup(obj)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l01958">astobj2.h:1958</a></div></div>
<div class="ttc" id="astobj2_8h_html_a1e3333ded530a38de14dfd1b61893a55"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#a1e3333ded530a38de14dfd1b61893a55">ao2_options_get</a></div><div class="ttdeci">unsigned int ao2_options_get(void *obj)</div><div class="ttdoc">Retrieve the ao2 options used to create the object. </div><div class="ttdef"><b>Definition:</b> <a href="../../da/df7/astobj2_8c_source.html#l00778">astobj2.c:778</a></div></div>
<div class="ttc" id="astobj2_8h_html_a927c9a5bce40a0164c297325eea4a562"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#a927c9a5bce40a0164c297325eea4a562">ao2_t_weakproxy_alloc</a></div><div class="ttdeci">#define ao2_t_weakproxy_alloc(data_size, destructor_fn, tag)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l00557">astobj2.h:557</a></div></div>
<div class="ttc" id="astobj2_8h_html_a2cf7e3433f08351aafe3b0cd31edf7f8ac08617f2ab082fd8d6d4b96a99f90aae"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#a2cf7e3433f08351aafe3b0cd31edf7f8ac08617f2ab082fd8d6d4b96a99f90aae">AO2_ALLOC_OPT_LOCK_MASK</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l00371">astobj2.h:371</a></div></div>
</div><!-- fragment -->
</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Sun Aug 8 2021 19:47:15 for Asterisk - The Open Source Telephony Project by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="../../doxygen.png" alt="doxygen"/>
</a> 1.8.13
</small></address>
</body>
</html>
