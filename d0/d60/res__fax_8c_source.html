<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Asterisk - The Open Source Telephony Project: res_fax.c Source File</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Asterisk - The Open Source Telephony Project
   &#160;<span id="projectnumber">18.5.0</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "../../search",false,'Search');
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('../../',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="../../dir_7b47cca4d318623bb4270ab1fb592ef5.html">res</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">res_fax.c</div>  </div>
</div><!--header-->
<div class="contents">
<a href="../../d0/d60/res__fax_8c.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="comment">/*</span></div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="comment"> * Asterisk -- An open source telephony toolkit.</span></div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="comment"> * Copyright (C) 2008-2009, Digium, Inc.</span></div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="comment"> * Dwayne M. Hubbard &lt;dhubbard@digium.com&gt;</span></div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="comment"> * Kevin P. Fleming &lt;kpfleming@digium.com&gt;</span></div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="comment"> * Matthew Nicholson &lt;mnicholson@digium.com&gt;</span></div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;<span class="comment"> * Initial T.38-gateway code</span></div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;<span class="comment"> * 2008, Daniel Ferenci &lt;daniel.ferenci@nethemba.com&gt;</span></div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;<span class="comment"> * Created by Nethemba s.r.o. http://www.nethemba.com</span></div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;<span class="comment"> * Sponsored by IPEX a.s. http://www.ipex.cz</span></div><div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;<span class="comment"> * T.38-gateway integration into asterisk app_fax and rework</span></div><div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;<span class="comment"> * 2008-2011, Gregory Hinton Nietsky &lt;gregory@distrotech.co.za&gt;</span></div><div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;<span class="comment"> * dns Telecom http://www.dnstelecom.co.za</span></div><div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;<span class="comment"> * Modified to make T.38-gateway compatible with Asterisk 1.6.2</span></div><div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;<span class="comment"> * 2010, Anton Verevkin &lt;mymail@verevkin.it&gt;</span></div><div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;<span class="comment"> * ViaNetTV http://www.vianettv.com</span></div><div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;<span class="comment"> * Modified to make T.38-gateway work</span></div><div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;<span class="comment"> * 2010, Klaus Darilion, IPCom GmbH, www.ipcom.at</span></div><div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;<span class="comment"> * See http://www.asterisk.org for more information about</span></div><div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;<span class="comment"> * the Asterisk project. Please do not directly contact</span></div><div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;<span class="comment"> * any of the maintainers of this project for assistance;</span></div><div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;<span class="comment"> * the project provides a web site, mailing lists and IRC</span></div><div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;<span class="comment"> * channels for your use.</span></div><div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;<span class="comment"> * This program is free software, distributed under the terms of</span></div><div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;<span class="comment"> * the GNU General Public License Version 2. See the LICENSE file</span></div><div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;<span class="comment"> * at the top of the source tree.</span></div><div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;</div><div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;<span class="comment">/*** MODULEINFO</span></div><div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;<span class="comment">   &lt;conflict&gt;app_fax&lt;/conflict&gt;</span></div><div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;<span class="comment">   &lt;support_level&gt;core&lt;/support_level&gt;</span></div><div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;<span class="comment">***/</span></div><div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;<span class="comment">/*! \file</span></div><div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;<span class="comment"> * \brief Generic FAX Resource for FAX technology resource modules</span></div><div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;<span class="comment"> * \author Dwayne M. Hubbard &lt;dhubbard@digium.com&gt;</span></div><div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;<span class="comment"> * \author Kevin P. Fleming &lt;kpfleming@digium.com&gt;</span></div><div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;<span class="comment"> * \author Matthew Nicholson &lt;mnicholson@digium.com&gt;</span></div><div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;<span class="comment"> * \author Gregory H. Nietsky  &lt;gregory@distrotech.co.za&gt;</span></div><div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;<span class="comment"> * A generic FAX resource module that provides SendFAX and ReceiveFAX applications.</span></div><div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;<span class="comment"> * This module requires FAX technology modules, like res_fax_spandsp, to register with it</span></div><div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;<span class="comment"> * so it can use the technology modules to perform the actual FAX transmissions.</span></div><div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;<span class="comment"> * \ingroup applications</span></div><div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;<span class="comment">/*! \li \ref res_fax.c uses the configuration file \ref res_fax.conf</span></div><div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;<span class="comment"> * \addtogroup configuration_file Configuration Files</span></div><div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;<span class="comment">/*!</span></div><div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;<span class="comment"> * \page res_fax.conf res_fax.conf</span></div><div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;<span class="comment"> * \verbinclude res_fax.conf.sample</span></div><div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;</div><div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../db/db2/asterisk_8h.html">asterisk.h</a>&quot;</span></div><div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;</div><div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../dc/dac/io_8h.html">asterisk/io.h</a>&quot;</span></div><div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../d2/d4d/file_8h.html">asterisk/file.h</a>&quot;</span></div><div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../d1/d8c/logger_8h.html">asterisk/logger.h</a>&quot;</span></div><div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../d5/d16/module_8h.html">asterisk/module.h</a>&quot;</span></div><div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../d3/d93/include_2asterisk_2app_8h.html">asterisk/app.h</a>&quot;</span></div><div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../dd/d42/lock_8h.html">asterisk/lock.h</a>&quot;</span></div><div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../d7/d5b/options_8h.html">asterisk/options.h</a>&quot;</span></div><div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../d6/d90/strings_8h.html">asterisk/strings.h</a>&quot;</span></div><div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../dc/db0/cli_8h.html">asterisk/cli.h</a>&quot;</span></div><div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../d5/d60/utils_8h.html">asterisk/utils.h</a>&quot;</span></div><div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../d3/de6/include_2asterisk_2config_8h.html">asterisk/config.h</a>&quot;</span></div><div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../d5/da5/astobj2_8h.html">asterisk/astobj2.h</a>&quot;</span></div><div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../db/d6a/res__fax_8h.html">asterisk/res_fax.h</a>&quot;</span></div><div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../d2/d4d/file_8h.html">asterisk/file.h</a>&quot;</span></div><div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../d5/d7b/channel_8h.html">asterisk/channel.h</a>&quot;</span></div><div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../db/de0/pbx_8h.html">asterisk/pbx.h</a>&quot;</span></div><div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../d3/d08/dsp_8h.html">asterisk/dsp.h</a>&quot;</span></div><div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../d2/d0f/indications_8h.html">asterisk/indications.h</a>&quot;</span></div><div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../d5/db9/ast__version_8h.html">asterisk/ast_version.h</a>&quot;</span></div><div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../db/d39/translate_8h.html">asterisk/translate.h</a>&quot;</span></div><div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../dd/d79/stasis_8h.html">asterisk/stasis.h</a>&quot;</span></div><div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../d9/d4a/stasis__channels_8h.html">asterisk/stasis_channels.h</a>&quot;</span></div><div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../d6/d7f/smoother_8h.html">asterisk/smoother.h</a>&quot;</span></div><div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../db/d1c/format__cache_8h.html">asterisk/format_cache.h</a>&quot;</span></div><div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;</div><div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;<span class="comment">/*** DOCUMENTATION</span></div><div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;<span class="comment">   &lt;application name=&quot;ReceiveFAX&quot; language=&quot;en_US&quot; module=&quot;res_fax&quot;&gt;</span></div><div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;<span class="comment">      &lt;synopsis&gt;</span></div><div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;<span class="comment">         Receive a FAX and save as a TIFF/F file.</span></div><div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;<span class="comment">      &lt;/synopsis&gt;</span></div><div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;<span class="comment">      &lt;syntax&gt;</span></div><div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;<span class="comment">         &lt;parameter name=&quot;filename&quot; required=&quot;true&quot; /&gt;</span></div><div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;<span class="comment">         &lt;parameter name=&quot;options&quot;&gt;</span></div><div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;<span class="comment">            &lt;optionlist&gt;</span></div><div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;<span class="comment">               &lt;option name=&quot;d&quot;&gt;</span></div><div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;<span class="comment">                  &lt;para&gt;Enable FAX debugging.&lt;/para&gt;</span></div><div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;<span class="comment">               &lt;/option&gt;</span></div><div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;<span class="comment">               &lt;option name=&quot;f&quot;&gt;</span></div><div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;<span class="comment">                  &lt;para&gt;Allow audio fallback FAX transfer on T.38 capable channels.&lt;/para&gt;</span></div><div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;<span class="comment">               &lt;/option&gt;</span></div><div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;<span class="comment">               &lt;option name=&quot;F&quot;&gt;</span></div><div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;<span class="comment">                  &lt;para&gt;Force usage of audio mode on T.38 capable channels.&lt;/para&gt;</span></div><div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;<span class="comment">               &lt;/option&gt;</span></div><div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;<span class="comment">               &lt;option name=&quot;s&quot;&gt;</span></div><div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;<span class="comment">                  &lt;para&gt;Send progress Manager events (overrides statusevents setting in res_fax.conf).&lt;/para&gt;</span></div><div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;<span class="comment">               &lt;/option&gt;</span></div><div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;<span class="comment">            &lt;/optionlist&gt;</span></div><div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;<span class="comment">         &lt;/parameter&gt;</span></div><div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;<span class="comment">      &lt;/syntax&gt;</span></div><div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;<span class="comment">      &lt;description&gt;</span></div><div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;<span class="comment">         &lt;para&gt;This application is provided by res_fax, which is a FAX technology agnostic module</span></div><div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;<span class="comment">         that utilizes FAX technology resource modules to complete a FAX transmission.&lt;/para&gt;</span></div><div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;<span class="comment">         &lt;para&gt;Session arguments can be set by the FAXOPT function and to check results of the ReceiveFax() application.&lt;/para&gt;</span></div><div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;<span class="comment">      &lt;/description&gt;</span></div><div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;<span class="comment">      &lt;see-also&gt;</span></div><div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;<span class="comment">         &lt;ref type=&quot;function&quot;&gt;FAXOPT&lt;/ref&gt;</span></div><div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;<span class="comment">      &lt;/see-also&gt;</span></div><div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;<span class="comment">   &lt;/application&gt;</span></div><div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;<span class="comment">   &lt;application name=&quot;SendFAX&quot; language=&quot;en_US&quot; module=&quot;res_fax&quot;&gt;</span></div><div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;<span class="comment">      &lt;synopsis&gt;</span></div><div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;<span class="comment">         Sends a specified TIFF/F file as a FAX.</span></div><div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;<span class="comment">      &lt;/synopsis&gt;</span></div><div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;<span class="comment">      &lt;syntax&gt;</span></div><div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;<span class="comment">         &lt;parameter name=&quot;filename&quot; required=&quot;true&quot; argsep=&quot;&amp;amp;&quot;&gt;</span></div><div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;<span class="comment">            &lt;argument name=&quot;filename2&quot; multiple=&quot;true&quot;&gt;</span></div><div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;<span class="comment">               &lt;para&gt;TIFF file to send as a FAX.&lt;/para&gt;</span></div><div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;<span class="comment">            &lt;/argument&gt;</span></div><div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;<span class="comment">         &lt;/parameter&gt;</span></div><div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;<span class="comment">         &lt;parameter name=&quot;options&quot;&gt;</span></div><div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;<span class="comment">            &lt;optionlist&gt;</span></div><div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;<span class="comment">               &lt;option name=&quot;d&quot;&gt;</span></div><div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;<span class="comment">                  &lt;para&gt;Enable FAX debugging.&lt;/para&gt;</span></div><div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;<span class="comment">               &lt;/option&gt;</span></div><div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;<span class="comment">               &lt;option name=&quot;f&quot;&gt;</span></div><div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;<span class="comment">                  &lt;para&gt;Allow audio fallback FAX transfer on T.38 capable channels.&lt;/para&gt;</span></div><div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;<span class="comment">               &lt;/option&gt;</span></div><div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;<span class="comment">               &lt;option name=&quot;F&quot;&gt;</span></div><div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;<span class="comment">                  &lt;para&gt;Force usage of audio mode on T.38 capable channels.&lt;/para&gt;</span></div><div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;<span class="comment">               &lt;/option&gt;</span></div><div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;<span class="comment">               &lt;option name=&quot;s&quot;&gt;</span></div><div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;<span class="comment">                  &lt;para&gt;Send progress Manager events (overrides statusevents setting in res_fax.conf).&lt;/para&gt;</span></div><div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;<span class="comment">               &lt;/option&gt;</span></div><div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;<span class="comment">               &lt;option name=&quot;z&quot;&gt;</span></div><div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;<span class="comment">                  &lt;para&gt;Initiate a T.38 reinvite on the channel if the remote end does not.&lt;/para&gt;</span></div><div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;<span class="comment">               &lt;/option&gt;</span></div><div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;<span class="comment">            &lt;/optionlist&gt;</span></div><div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;<span class="comment">         &lt;/parameter&gt;</span></div><div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;<span class="comment">      &lt;/syntax&gt;</span></div><div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;<span class="comment">      &lt;description&gt;</span></div><div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;<span class="comment">         &lt;para&gt;This application is provided by res_fax, which is a FAX technology agnostic module</span></div><div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;<span class="comment">         that utilizes FAX technology resource modules to complete a FAX transmission.&lt;/para&gt;</span></div><div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;<span class="comment">         &lt;para&gt;Session arguments can be set by the FAXOPT function and to check results of the SendFax() application.&lt;/para&gt;</span></div><div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;<span class="comment">      &lt;/description&gt;</span></div><div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;<span class="comment">      &lt;see-also&gt;</span></div><div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;<span class="comment">         &lt;ref type=&quot;function&quot;&gt;FAXOPT&lt;/ref&gt;</span></div><div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;<span class="comment">      &lt;/see-also&gt;</span></div><div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;<span class="comment">   &lt;/application&gt;</span></div><div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;<span class="comment">   &lt;function name=&quot;FAXOPT&quot; language=&quot;en_US&quot; module=&quot;res_fax&quot;&gt;</span></div><div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;<span class="comment">      &lt;synopsis&gt;</span></div><div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;<span class="comment">         Gets/sets various pieces of information about a fax session.</span></div><div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;<span class="comment">      &lt;/synopsis&gt;</span></div><div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;<span class="comment">      &lt;syntax&gt;</span></div><div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;<span class="comment">         &lt;parameter name=&quot;item&quot; required=&quot;true&quot;&gt;</span></div><div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;<span class="comment">            &lt;enumlist&gt;</span></div><div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;<span class="comment">               &lt;enum name=&quot;ecm&quot;&gt;</span></div><div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;<span class="comment">                  &lt;para&gt;R/W Error Correction Mode (ECM) enable with &#39;yes&#39;, disable with &#39;no&#39;.&lt;/para&gt;</span></div><div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;<span class="comment">               &lt;/enum&gt;</span></div><div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;<span class="comment">               &lt;enum name=&quot;error&quot;&gt;</span></div><div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;<span class="comment">                  &lt;para&gt;R/O FAX transmission error code upon failure.&lt;/para&gt;</span></div><div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;<span class="comment">               &lt;/enum&gt;</span></div><div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;<span class="comment">               &lt;enum name=&quot;filename&quot;&gt;</span></div><div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;<span class="comment">                  &lt;para&gt;R/O Filename of the first file of the FAX transmission.&lt;/para&gt;</span></div><div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;<span class="comment">               &lt;/enum&gt;</span></div><div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;<span class="comment">               &lt;enum name=&quot;filenames&quot;&gt;</span></div><div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;<span class="comment">                  &lt;para&gt;R/O Filenames of all of the files in the FAX transmission (comma separated).&lt;/para&gt;</span></div><div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;<span class="comment">               &lt;/enum&gt;</span></div><div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;<span class="comment">               &lt;enum name=&quot;headerinfo&quot;&gt;</span></div><div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;<span class="comment">                  &lt;para&gt;R/W FAX header information.&lt;/para&gt;</span></div><div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;<span class="comment">               &lt;/enum&gt;</span></div><div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;<span class="comment">               &lt;enum name=&quot;localstationid&quot;&gt;</span></div><div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;<span class="comment">                  &lt;para&gt;R/W Local Station Identification.&lt;/para&gt;</span></div><div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;<span class="comment">               &lt;/enum&gt;</span></div><div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;<span class="comment">               &lt;enum name=&quot;minrate&quot;&gt;</span></div><div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;<span class="comment">                  &lt;para&gt;R/W Minimum transfer rate set before transmission.&lt;/para&gt;</span></div><div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;<span class="comment">               &lt;/enum&gt;</span></div><div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;<span class="comment">               &lt;enum name=&quot;maxrate&quot;&gt;</span></div><div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;<span class="comment">                  &lt;para&gt;R/W Maximum transfer rate set before transmission.&lt;/para&gt;</span></div><div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;<span class="comment">               &lt;/enum&gt;</span></div><div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;<span class="comment">               &lt;enum name=&quot;modem&quot;&gt;</span></div><div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;<span class="comment">                  &lt;para&gt;R/W Modem type (v17/v27/v29).&lt;/para&gt;</span></div><div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;<span class="comment">               &lt;/enum&gt;</span></div><div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;<span class="comment">               &lt;enum name=&quot;gateway&quot;&gt;</span></div><div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;<span class="comment">                  &lt;para&gt;R/W T38 fax gateway, with optional fax activity timeout in seconds (yes[,timeout]/no)&lt;/para&gt;</span></div><div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;<span class="comment">               &lt;/enum&gt;</span></div><div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;<span class="comment">               &lt;enum name=&quot;faxdetect&quot;&gt;</span></div><div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;<span class="comment">                  &lt;para&gt;R/W Enable FAX detect with optional timeout in seconds (yes,t38,cng[,timeout]/no)&lt;/para&gt;</span></div><div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;<span class="comment">               &lt;/enum&gt;</span></div><div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;<span class="comment">               &lt;enum name=&quot;pages&quot;&gt;</span></div><div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;<span class="comment">                  &lt;para&gt;R/O Number of pages transferred.&lt;/para&gt;</span></div><div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;<span class="comment">               &lt;/enum&gt;</span></div><div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;<span class="comment">               &lt;enum name=&quot;rate&quot;&gt;</span></div><div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;<span class="comment">                  &lt;para&gt;R/O Negotiated transmission rate.&lt;/para&gt;</span></div><div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;<span class="comment">               &lt;/enum&gt;</span></div><div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;<span class="comment">               &lt;enum name=&quot;remotestationid&quot;&gt;</span></div><div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;<span class="comment">                  &lt;para&gt;R/O Remote Station Identification after transmission.&lt;/para&gt;</span></div><div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;<span class="comment">               &lt;/enum&gt;</span></div><div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;<span class="comment">               &lt;enum name=&quot;resolution&quot;&gt;</span></div><div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;<span class="comment">                  &lt;para&gt;R/O Negotiated image resolution after transmission.&lt;/para&gt;</span></div><div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;<span class="comment">               &lt;/enum&gt;</span></div><div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;<span class="comment">               &lt;enum name=&quot;sessionid&quot;&gt;</span></div><div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;<span class="comment">                  &lt;para&gt;R/O Session ID of the FAX transmission.&lt;/para&gt;</span></div><div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;<span class="comment">               &lt;/enum&gt;</span></div><div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;<span class="comment">               &lt;enum name=&quot;status&quot;&gt;</span></div><div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;<span class="comment">                  &lt;para&gt;R/O Result Status of the FAX transmission.&lt;/para&gt;</span></div><div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;<span class="comment">               &lt;/enum&gt;</span></div><div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;<span class="comment">               &lt;enum name=&quot;statusstr&quot;&gt;</span></div><div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;<span class="comment">                  &lt;para&gt;R/O Verbose Result Status of the FAX transmission.&lt;/para&gt;</span></div><div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;<span class="comment">               &lt;/enum&gt;</span></div><div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;<span class="comment">               &lt;enum name=&quot;t38timeout&quot;&gt;</span></div><div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;<span class="comment">                  &lt;para&gt;R/W The timeout used for T.38 negotiation.&lt;/para&gt;</span></div><div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;<span class="comment">               &lt;/enum&gt;</span></div><div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;<span class="comment">               &lt;enum name=&quot;negotiate_both&quot;&gt;</span></div><div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;<span class="comment">                  &lt;para&gt;R/W Upon v21 detection allow gateway to send negotiation requests to both T.38 endpoints, and do not wait on the &quot;other&quot; side to initiate (yes|no)&lt;/para&gt;</span></div><div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;<span class="comment">               &lt;/enum&gt;</span></div><div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;<span class="comment">            &lt;/enumlist&gt;</span></div><div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;<span class="comment">         &lt;/parameter&gt;</span></div><div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;<span class="comment">      &lt;/syntax&gt;</span></div><div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;<span class="comment">      &lt;description&gt;</span></div><div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;<span class="comment">         &lt;para&gt;FAXOPT can be used to override the settings for a FAX session listed in &lt;filename&gt;res_fax.conf&lt;/filename&gt;,</span></div><div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;<span class="comment">            it can also be used to retrieve information about a FAX session that has finished eg. pages/status.&lt;/para&gt;</span></div><div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;<span class="comment">      &lt;/description&gt;</span></div><div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;<span class="comment">      &lt;see-also&gt;</span></div><div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;<span class="comment">         &lt;ref type=&quot;application&quot;&gt;ReceiveFax&lt;/ref&gt;</span></div><div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;<span class="comment">         &lt;ref type=&quot;application&quot;&gt;SendFax&lt;/ref&gt;</span></div><div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;<span class="comment">      &lt;/see-also&gt;</span></div><div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;<span class="comment">   &lt;/function&gt;</span></div><div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;<span class="comment">   &lt;manager name=&quot;FAXSessions&quot; language=&quot;en_US&quot;&gt;</span></div><div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;<span class="comment">      &lt;synopsis&gt;</span></div><div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;<span class="comment">         Lists active FAX sessions</span></div><div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;<span class="comment">      &lt;/synopsis&gt;</span></div><div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;<span class="comment">      &lt;syntax&gt;</span></div><div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;<span class="comment">         &lt;xi:include xpointer=&quot;xpointer(/docs/manager[@name=&#39;Login&#39;]/syntax/parameter[@name=&#39;ActionID&#39;])&quot; /&gt;</span></div><div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;<span class="comment">      &lt;/syntax&gt;</span></div><div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;<span class="comment">      &lt;description&gt;</span></div><div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;<span class="comment">         &lt;para&gt;Will generate a series of FAXSession events with information about each FAXSession. Closes with</span></div><div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;<span class="comment">         a FAXSessionsComplete event which includes a count of the included FAX sessions. This action works in</span></div><div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;<span class="comment">         the same manner as the CLI command &#39;fax show sessions&#39;&lt;/para&gt;</span></div><div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;<span class="comment">      &lt;/description&gt;</span></div><div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;<span class="comment">   &lt;/manager&gt;</span></div><div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;<span class="comment">   &lt;managerEvent language=&quot;en_US&quot; name=&quot;FAXSessionsEntry&quot;&gt;</span></div><div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;<span class="comment">      &lt;managerEventInstance class=&quot;EVENT_FLAG_REPORTING&quot;&gt;</span></div><div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;<span class="comment">         &lt;synopsis&gt;A single list item for the FAXSessions AMI command&lt;/synopsis&gt;</span></div><div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;<span class="comment">         &lt;syntax&gt;</span></div><div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;<span class="comment">            &lt;parameter name=&quot;ActionID&quot; required=&quot;false&quot;/&gt;</span></div><div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;<span class="comment">            &lt;parameter name=&quot;Channel&quot;&gt;</span></div><div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;<span class="comment">               &lt;para&gt;Name of the channel responsible for the FAX session&lt;/para&gt;</span></div><div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;<span class="comment">            &lt;/parameter&gt;</span></div><div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;<span class="comment">            &lt;parameter name=&quot;Technology&quot;&gt;</span></div><div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;<span class="comment">               &lt;para&gt;The FAX technology that the FAX session is using&lt;/para&gt;</span></div><div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;<span class="comment">            &lt;/parameter&gt;</span></div><div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;<span class="comment">            &lt;parameter name=&quot;SessionNumber&quot;&gt;</span></div><div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;<span class="comment">               &lt;para&gt;The numerical identifier for this particular session&lt;/para&gt;</span></div><div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;<span class="comment">            &lt;/parameter&gt;</span></div><div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;<span class="comment">            &lt;parameter name=&quot;SessionType&quot;&gt;</span></div><div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;<span class="comment">               &lt;para&gt;FAX session passthru/relay type&lt;/para&gt;</span></div><div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;<span class="comment">               &lt;enumlist&gt;</span></div><div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;<span class="comment">                  &lt;enum name=&quot;G.711&quot; /&gt;</span></div><div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;<span class="comment">                  &lt;enum name=&quot;T.38&quot; /&gt;</span></div><div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;<span class="comment">               &lt;/enumlist&gt;</span></div><div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;<span class="comment">            &lt;/parameter&gt;</span></div><div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;<span class="comment">            &lt;parameter name=&quot;Operation&quot;&gt;</span></div><div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;<span class="comment">               &lt;para&gt;FAX session operation type&lt;/para&gt;</span></div><div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;<span class="comment">               &lt;enumlist&gt;</span></div><div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;<span class="comment">                  &lt;enum name=&quot;gateway&quot; /&gt;</span></div><div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;<span class="comment">                  &lt;enum name=&quot;V.21&quot; /&gt;</span></div><div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;<span class="comment">                  &lt;enum name=&quot;send&quot; /&gt;</span></div><div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;<span class="comment">                  &lt;enum name=&quot;receive&quot; /&gt;</span></div><div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;<span class="comment">                  &lt;enum name=&quot;none&quot; /&gt;</span></div><div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;<span class="comment">               &lt;/enumlist&gt;</span></div><div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;<span class="comment">            &lt;/parameter&gt;</span></div><div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;<span class="comment">            &lt;parameter name=&quot;State&quot;&gt;</span></div><div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;<span class="comment">               &lt;para&gt;Current state of the FAX session&lt;/para&gt;</span></div><div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;<span class="comment">               &lt;enumlist&gt;</span></div><div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;<span class="comment">                  &lt;enum name=&quot;Uninitialized&quot; /&gt;</span></div><div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;<span class="comment">                  &lt;enum name=&quot;Initialized&quot; /&gt;</span></div><div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;<span class="comment">                  &lt;enum name=&quot;Open&quot; /&gt;</span></div><div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;<span class="comment">                  &lt;enum name=&quot;Active&quot; /&gt;</span></div><div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;<span class="comment">                  &lt;enum name=&quot;Complete&quot; /&gt;</span></div><div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;<span class="comment">                  &lt;enum name=&quot;Reserved&quot; /&gt;</span></div><div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;<span class="comment">                  &lt;enum name=&quot;Inactive&quot; /&gt;</span></div><div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;<span class="comment">                  &lt;enum name=&quot;Unknown&quot; /&gt;</span></div><div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;<span class="comment">               &lt;/enumlist&gt;</span></div><div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;<span class="comment">            &lt;/parameter&gt;</span></div><div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;<span class="comment">            &lt;parameter name=&quot;Files&quot;&gt;</span></div><div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;<span class="comment">               &lt;para&gt;File or list of files associated with this FAX session&lt;/para&gt;</span></div><div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;<span class="comment">            &lt;/parameter&gt;</span></div><div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;<span class="comment">         &lt;/syntax&gt;</span></div><div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;<span class="comment">      &lt;/managerEventInstance&gt;</span></div><div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;<span class="comment">   &lt;/managerEvent&gt;</span></div><div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;<span class="comment">   &lt;managerEvent language=&quot;en_US&quot; name=&quot;FAXSessionsComplete&quot;&gt;</span></div><div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;<span class="comment">      &lt;managerEventInstance class=&quot;EVENT_FLAG_CALL&quot;&gt;</span></div><div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;<span class="comment">         &lt;synopsis&gt;Raised when all FAXSession events are completed for a FAXSessions command&lt;/synopsis&gt;</span></div><div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;<span class="comment">         &lt;syntax&gt;</span></div><div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;<span class="comment">            &lt;parameter name=&quot;ActionID&quot; required=&quot;false&quot;/&gt;</span></div><div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;<span class="comment">            &lt;parameter name=&quot;Total&quot;&gt;</span></div><div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;<span class="comment">               &lt;para&gt;Count of FAXSession events sent in response to FAXSessions action&lt;/para&gt;</span></div><div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;<span class="comment">            &lt;/parameter&gt;</span></div><div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;<span class="comment">         &lt;/syntax&gt;</span></div><div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;<span class="comment">      &lt;/managerEventInstance&gt;</span></div><div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;<span class="comment">   &lt;/managerEvent&gt;</span></div><div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;<span class="comment">   &lt;manager name=&quot;FAXSession&quot; language=&quot;en_US&quot;&gt;</span></div><div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;<span class="comment">      &lt;synopsis&gt;</span></div><div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;<span class="comment">         Responds with a detailed description of a single FAX session</span></div><div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;<span class="comment">      &lt;/synopsis&gt;</span></div><div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;<span class="comment">      &lt;syntax&gt;</span></div><div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;<span class="comment">         &lt;xi:include xpointer=&quot;xpointer(/docs/manager[@name=&#39;Login&#39;]/syntax/parameter[@name=&#39;ActionID&#39;])&quot; /&gt;</span></div><div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;<span class="comment">         &lt;parameter name=&quot;SessionNumber&quot; required=&quot;true&quot;&gt;</span></div><div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;<span class="comment">            &lt;para&gt;The session ID of the fax the user is interested in.&lt;/para&gt;</span></div><div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;<span class="comment">         &lt;/parameter&gt;</span></div><div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;<span class="comment">      &lt;/syntax&gt;</span></div><div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;<span class="comment">      &lt;description&gt;</span></div><div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;<span class="comment">         &lt;para&gt;Provides details about a specific FAX session. The response will include a common subset of</span></div><div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;<span class="comment">         the output from the CLI command &#39;fax show session &amp;lt;session_number&amp;gt;&#39; for each technology. If the</span></div><div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;<span class="comment">         FAX technolgy used by this session does not include a handler for FAXSession, then this action</span></div><div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;<span class="comment">         will fail.&lt;/para&gt;</span></div><div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;<span class="comment">      &lt;/description&gt;</span></div><div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;<span class="comment">   &lt;/manager&gt;</span></div><div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;<span class="comment">   &lt;managerEvent language=&quot;en_US&quot; name=&quot;FAXSession&quot;&gt;</span></div><div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;<span class="comment">      &lt;managerEventInstance class=&quot;EVENT_FLAG_REPORTING&quot;&gt;</span></div><div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;<span class="comment">         &lt;synopsis&gt;Raised in response to FAXSession manager command&lt;/synopsis&gt;</span></div><div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;<span class="comment">         &lt;syntax&gt;</span></div><div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;<span class="comment">            &lt;parameter name=&quot;ActionID&quot; required=&quot;false&quot;/&gt;</span></div><div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;<span class="comment">            &lt;parameter name=&quot;SessionNumber&quot;&gt;</span></div><div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;<span class="comment">               &lt;para&gt;The numerical identifier for this particular session&lt;/para&gt;</span></div><div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;<span class="comment">            &lt;/parameter&gt;</span></div><div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;<span class="comment">            &lt;xi:include xpointer=&quot;xpointer(/docs/managerEvent[@name=&#39;FAXSessionsEntry&#39;]/managerEventInstance/syntax/parameter[@name=&#39;Operation&#39;])&quot; /&gt;</span></div><div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;<span class="comment">            &lt;xi:include xpointer=&quot;xpointer(/docs/managerEvent[@name=&#39;FAXSessionsEntry&#39;]/managerEventInstance/syntax/parameter[@name=&#39;State&#39;])&quot; /&gt;</span></div><div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;<span class="comment">            &lt;parameter name=&quot;ErrorCorrectionMode&quot; required=&quot;false&quot;&gt;</span></div><div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;<span class="comment">               &lt;para&gt;Whether error correcting mode is enabled for the FAX session. This field is not</span></div><div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;<span class="comment">               included when operation is &#39;V.21 Detect&#39; or if operation is &#39;gateway&#39; and state is</span></div><div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;<span class="comment">               &#39;Uninitialized&#39;</span></div><div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;<span class="comment">               &lt;/para&gt;</span></div><div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;<span class="comment">               &lt;enumlist&gt;</span></div><div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;<span class="comment">                  &lt;enum name=&quot;yes&quot; /&gt;</span></div><div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;<span class="comment">                  &lt;enum name=&quot;no&quot; /&gt;</span></div><div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;<span class="comment">               &lt;/enumlist&gt;</span></div><div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;<span class="comment">            &lt;/parameter&gt;</span></div><div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;<span class="comment">            &lt;parameter name=&quot;DataRate&quot; required=&quot;false&quot;&gt;</span></div><div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;<span class="comment">               &lt;para&gt;Bit rate of the FAX. This field is not included when operation is &#39;V.21 Detect&#39; or</span></div><div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;<span class="comment">               if operation is &#39;gateway&#39; and state is &#39;Uninitialized&#39;.&lt;/para&gt;</span></div><div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;<span class="comment">            &lt;/parameter&gt;</span></div><div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;<span class="comment">            &lt;parameter name=&quot;ImageResolution&quot; required=&quot;false&quot;&gt;</span></div><div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;<span class="comment">               &lt;para&gt;Resolution of each page of the FAX. Will be in the format of X_RESxY_RES. This field</span></div><div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;<span class="comment">               is not included if the operation is anything other than Receive/Transmit.&lt;/para&gt;</span></div><div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;<span class="comment">            &lt;/parameter&gt;</span></div><div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;<span class="comment">            &lt;parameter name=&quot;PageNumber&quot; required=&quot;false&quot;&gt;</span></div><div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;<span class="comment">               &lt;para&gt;Current number of pages transferred during this FAX session. May change as the FAX</span></div><div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;<span class="comment">               progresses. This field is not included when operation is &#39;V.21 Detect&#39; or if operation is</span></div><div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;<span class="comment">               &#39;gateway&#39; and state is &#39;Uninitialized&#39;.&lt;/para&gt;</span></div><div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;<span class="comment">            &lt;/parameter&gt;</span></div><div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;<span class="comment">            &lt;parameter name=&quot;FileName&quot; required=&quot;false&quot;&gt;</span></div><div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;<span class="comment">               &lt;para&gt;Filename of the image being sent/received for this FAX session. This field is not</span></div><div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;<span class="comment">               included if Operation isn&#39;t &#39;send&#39; or &#39;receive&#39;.&lt;/para&gt;</span></div><div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;<span class="comment">            &lt;/parameter&gt;</span></div><div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;<span class="comment">            &lt;parameter name=&quot;PagesTransmitted&quot; required=&quot;false&quot;&gt;</span></div><div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;<span class="comment">               &lt;para&gt;Total number of pages sent during this session. This field is not included if</span></div><div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;<span class="comment">               Operation isn&#39;t &#39;send&#39; or &#39;receive&#39;. Will always be 0 for &#39;receive&#39;.&lt;/para&gt;</span></div><div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;<span class="comment">            &lt;/parameter&gt;</span></div><div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;<span class="comment">            &lt;parameter name=&quot;PagesReceived&quot; required=&quot;false&quot;&gt;</span></div><div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;<span class="comment">               &lt;para&gt;Total number of pages received during this session. This field is not included if</span></div><div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;<span class="comment">               Operation is not &#39;send&#39; or &#39;receive&#39;. Will be 0 for &#39;send&#39;.&lt;/para&gt;</span></div><div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;<span class="comment">            &lt;/parameter&gt;</span></div><div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;<span class="comment">            &lt;parameter name=&quot;TotalBadLines&quot; required=&quot;false&quot;&gt;</span></div><div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;<span class="comment">               &lt;para&gt;Total number of bad lines sent/received during this session. This field is not</span></div><div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;<span class="comment">               included if Operation is not &#39;send&#39; or &#39;received&#39;.&lt;/para&gt;</span></div><div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;<span class="comment">            &lt;/parameter&gt;</span></div><div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;<span class="comment">         &lt;/syntax&gt;</span></div><div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;<span class="comment">      &lt;/managerEventInstance&gt;</span></div><div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;<span class="comment">   &lt;/managerEvent&gt;</span></div><div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;<span class="comment">   &lt;manager name=&quot;FAXStats&quot; language=&quot;en_US&quot;&gt;</span></div><div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;<span class="comment">      &lt;synopsis&gt;</span></div><div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;<span class="comment">         Responds with fax statistics</span></div><div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;<span class="comment">      &lt;/synopsis&gt;</span></div><div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;<span class="comment">      &lt;syntax&gt;</span></div><div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;<span class="comment">         &lt;xi:include xpointer=&quot;xpointer(/docs/manager[@name=&#39;Login&#39;]/syntax/parameter[@name=&#39;ActionID&#39;])&quot; /&gt;</span></div><div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;<span class="comment">      &lt;/syntax&gt;</span></div><div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;<span class="comment">      &lt;description&gt;</span></div><div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;<span class="comment">         &lt;para&gt;Provides FAX statistics including the number of active sessions, reserved sessions, completed</span></div><div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;<span class="comment">         sessions, failed sessions, and the number of receive/transmit attempts. This command provides all</span></div><div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;<span class="comment">         of the non-technology specific information provided by the CLI command &#39;fax show stats&#39;&lt;/para&gt;</span></div><div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;<span class="comment">      &lt;/description&gt;</span></div><div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;<span class="comment">   &lt;/manager&gt;</span></div><div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;<span class="comment">   &lt;managerEvent language=&quot;en_US&quot; name=&quot;FAXStats&quot;&gt;</span></div><div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;<span class="comment">      &lt;managerEventInstance class=&quot;EVENT_FLAG_REPORTING&quot;&gt;</span></div><div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;<span class="comment">         &lt;synopsis&gt;Raised in response to FAXStats manager command&lt;/synopsis&gt;</span></div><div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;<span class="comment">         &lt;syntax&gt;</span></div><div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;<span class="comment">            &lt;parameter name=&quot;ActionID&quot; required=&quot;false&quot;/&gt;</span></div><div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;<span class="comment">            &lt;parameter name=&quot;CurrentSessions&quot; required=&quot;true&quot;&gt;</span></div><div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;<span class="comment">               &lt;para&gt;Number of active FAX sessions&lt;/para&gt;</span></div><div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;<span class="comment">            &lt;/parameter&gt;</span></div><div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;<span class="comment">            &lt;parameter name=&quot;ReservedSessions&quot; required=&quot;true&quot;&gt;</span></div><div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;<span class="comment">               &lt;para&gt;Number of reserved FAX sessions&lt;/para&gt;</span></div><div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;<span class="comment">            &lt;/parameter&gt;</span></div><div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;<span class="comment">            &lt;parameter name=&quot;TransmitAttempts&quot; required=&quot;true&quot;&gt;</span></div><div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;<span class="comment">               &lt;para&gt;Total FAX sessions for which Asterisk is/was the transmitter&lt;/para&gt;</span></div><div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;<span class="comment">            &lt;/parameter&gt;</span></div><div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;<span class="comment">            &lt;parameter name=&quot;ReceiveAttempts&quot; required=&quot;true&quot;&gt;</span></div><div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;<span class="comment">               &lt;para&gt;Total FAX sessions for which Asterisk is/was the recipient&lt;/para&gt;</span></div><div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;<span class="comment">            &lt;/parameter&gt;</span></div><div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;<span class="comment">            &lt;parameter name=&quot;CompletedFAXes&quot; required=&quot;true&quot;&gt;</span></div><div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;<span class="comment">               &lt;para&gt;Total FAX sessions which have been completed successfully&lt;/para&gt;</span></div><div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;<span class="comment">            &lt;/parameter&gt;</span></div><div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;<span class="comment">            &lt;parameter name=&quot;FailedFAXes&quot; required=&quot;true&quot;&gt;</span></div><div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;<span class="comment">               &lt;para&gt;Total FAX sessions which failed to complete successfully&lt;/para&gt;</span></div><div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;<span class="comment">            &lt;/parameter&gt;</span></div><div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;<span class="comment">         &lt;/syntax&gt;</span></div><div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;<span class="comment">      &lt;/managerEventInstance&gt;</span></div><div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;<span class="comment">   &lt;/managerEvent&gt;</span></div><div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;<span class="comment">***/</span></div><div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;</div><div class="line"><a name="l00428"></a><span class="lineno"><a class="line" href="../../d0/d60/res__fax_8c.html#a39b1d432fa7056aa4737e302b608f8ee">  428</a></span>&#160;<span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span> <a class="code" href="../../d0/d60/res__fax_8c.html#a39b1d432fa7056aa4737e302b608f8ee">app_receivefax</a>[] = <span class="stringliteral">&quot;ReceiveFAX&quot;</span>;</div><div class="line"><a name="l00429"></a><span class="lineno"><a class="line" href="../../d0/d60/res__fax_8c.html#a9029b2196b8587ea85bad4ac4b6174d7">  429</a></span>&#160;<span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span> <a class="code" href="../../d0/d60/res__fax_8c.html#a9029b2196b8587ea85bad4ac4b6174d7">app_sendfax</a>[] = <span class="stringliteral">&quot;SendFAX&quot;</span>;</div><div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;</div><div class="line"><a name="l00431"></a><span class="lineno"><a class="line" href="../../d2/d1c/structdebug__info__history.html">  431</a></span>&#160;<span class="keyword">struct </span><a class="code" href="../../d2/d1c/structdebug__info__history.html">debug_info_history</a> {</div><div class="line"><a name="l00432"></a><span class="lineno"><a class="line" href="../../d2/d1c/structdebug__info__history.html#a956be2e6e0911206ed31a587010be4da">  432</a></span>&#160;   <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="../../d2/d1c/structdebug__info__history.html#a956be2e6e0911206ed31a587010be4da">consec_frames</a>;</div><div class="line"><a name="l00433"></a><span class="lineno"><a class="line" href="../../d2/d1c/structdebug__info__history.html#a0e129d2262db03fd0da1b365ea05fdc5">  433</a></span>&#160;   <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="../../d2/d1c/structdebug__info__history.html#a0e129d2262db03fd0da1b365ea05fdc5">consec_ms</a>;</div><div class="line"><a name="l00434"></a><span class="lineno"><a class="line" href="../../d2/d1c/structdebug__info__history.html#a99f01a0b4f6b3afa5bf25e98c550bcc1">  434</a></span>&#160;   <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> <a class="code" href="../../d2/d1c/structdebug__info__history.html#a99f01a0b4f6b3afa5bf25e98c550bcc1">silence</a>;</div><div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;};</div><div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;</div><div class="line"><a name="l00437"></a><span class="lineno"><a class="line" href="../../d3/d84/structast__fax__debug__info.html">  437</a></span>&#160;<span class="keyword">struct </span><a class="code" href="../../d3/d84/structast__fax__debug__info.html">ast_fax_debug_info</a> {</div><div class="line"><a name="l00438"></a><span class="lineno"><a class="line" href="../../d3/d84/structast__fax__debug__info.html#a223334851a9df6368db714953c25990e">  438</a></span>&#160;   <span class="keyword">struct </span>timeval base_tv;</div><div class="line"><a name="l00439"></a><span class="lineno"><a class="line" href="../../d3/d84/structast__fax__debug__info.html#a16b8f82ab064d3b55a11bc9059805bf5">  439</a></span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d2/d1c/structdebug__info__history.html">debug_info_history</a> c2s, s2c;</div><div class="line"><a name="l00440"></a><span class="lineno"><a class="line" href="../../d3/d84/structast__fax__debug__info.html#ab9deccb020b39c3f7ac94b1af99cac5d">  440</a></span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d6/de5/structast__dsp.html">ast_dsp</a> *<a class="code" href="../../d3/d84/structast__fax__debug__info.html#ab9deccb020b39c3f7ac94b1af99cac5d">dsp</a>;</div><div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;};</div><div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;<span class="comment">/*! \brief used for gateway framehook */</span></div><div class="line"><a name="l00444"></a><span class="lineno"><a class="line" href="../../dd/dd2/structfax__gateway.html">  444</a></span>&#160;<span class="keyword">struct </span><a class="code" href="../../dd/dd2/structfax__gateway.html">fax_gateway</a> {<span class="comment"></span></div><div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;<span class="comment">   /*! \brief FAX Session */</span></div><div class="line"><a name="l00446"></a><span class="lineno"><a class="line" href="../../dd/dd2/structfax__gateway.html#acf7d6ff8498e4c50ee13ac0711210c72">  446</a></span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d1/d16/structast__fax__session.html">ast_fax_session</a> *<a class="code" href="../../dd/dd2/structfax__gateway.html#acf7d6ff8498e4c50ee13ac0711210c72">s</a>;</div><div class="line"><a name="l00447"></a><span class="lineno"><a class="line" href="../../dd/dd2/structfax__gateway.html#a08eb33d553223ed90af3397a850b3af1">  447</a></span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d1/d16/structast__fax__session.html">ast_fax_session</a> *<a class="code" href="../../dd/dd2/structfax__gateway.html#a08eb33d553223ed90af3397a850b3af1">peer_v21_session</a>;</div><div class="line"><a name="l00448"></a><span class="lineno"><a class="line" href="../../dd/dd2/structfax__gateway.html#a8bb543c7fdbaf19b5a07e0154727228d">  448</a></span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d1/d16/structast__fax__session.html">ast_fax_session</a> *<a class="code" href="../../dd/dd2/structfax__gateway.html#a8bb543c7fdbaf19b5a07e0154727228d">chan_v21_session</a>;<span class="comment"></span></div><div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;<span class="comment">   /*! \brief reserved fax session token */</span></div><div class="line"><a name="l00450"></a><span class="lineno"><a class="line" href="../../dd/dd2/structfax__gateway.html#aed7ead71b14c348cd4a72ffbced30989">  450</a></span>&#160;   <span class="keyword">struct </span>ast_fax_tech_token *<a class="code" href="../../dd/dd2/structfax__gateway.html#aed7ead71b14c348cd4a72ffbced30989">token</a>;<span class="comment"></span></div><div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;<span class="comment">   /*! \brief the start of our timeout counter */</span></div><div class="line"><a name="l00452"></a><span class="lineno"><a class="line" href="../../dd/dd2/structfax__gateway.html#a23b38dad7025290be3461b4b3208b4e6">  452</a></span>&#160;   <span class="keyword">struct </span>timeval timeout_start;<span class="comment"></span></div><div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;<span class="comment">   /*! \brief framehook used in gateway mode */</span></div><div class="line"><a name="l00454"></a><span class="lineno"><a class="line" href="../../dd/dd2/structfax__gateway.html#ae25f61b5aa8877dfb396fd378c6b7722">  454</a></span>&#160;   <span class="keywordtype">int</span> <a class="code" href="../../dd/dd2/structfax__gateway.html#ae25f61b5aa8877dfb396fd378c6b7722">framehook</a>;<span class="comment"></span></div><div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;<span class="comment">   /*! \brief bridged */</span></div><div class="line"><a name="l00456"></a><span class="lineno"><a class="line" href="../../dd/dd2/structfax__gateway.html#a0d2ac6150d9d6ec10389a84148a4425f">  456</a></span>&#160;   <span class="keywordtype">int</span> <a class="code" href="../../dd/dd2/structfax__gateway.html#a0d2ac6150d9d6ec10389a84148a4425f">bridged</a>:1;<span class="comment"></span></div><div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;<span class="comment">   /*! \brief 1 if a v21 preamble has been detected */</span></div><div class="line"><a name="l00458"></a><span class="lineno"><a class="line" href="../../dd/dd2/structfax__gateway.html#af2cb1e09b1af5d5bebdec7471555c940">  458</a></span>&#160;   <span class="keywordtype">int</span> <a class="code" href="../../dd/dd2/structfax__gateway.html#af2cb1e09b1af5d5bebdec7471555c940">detected_v21</a>:1;<span class="comment"></span></div><div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;<span class="comment">   /*! \brief a flag to track the state of our negotiation */</span></div><div class="line"><a name="l00460"></a><span class="lineno"><a class="line" href="../../dd/dd2/structfax__gateway.html#a37f4333f3e7eaf12966069b77dac704e">  460</a></span>&#160;   <span class="keyword">enum</span> <a class="code" href="../../d5/d7b/channel_8h.html#a4cd990f4c1cd0c2af6e4c63f6d15b4e1">ast_t38_state</a> <a class="code" href="../../de/d6f/structt38__state.html">t38_state</a>;<span class="comment"></span></div><div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;<span class="comment">   /*! \brief original audio formats */</span></div><div class="line"><a name="l00462"></a><span class="lineno"><a class="line" href="../../dd/dd2/structfax__gateway.html#a59e020b75f0a03b00bfad6332fa53b9e">  462</a></span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d0/d98/structast__format.html">ast_format</a> *<a class="code" href="../../dd/dd2/structfax__gateway.html#a59e020b75f0a03b00bfad6332fa53b9e">chan_read_format</a>;</div><div class="line"><a name="l00463"></a><span class="lineno"><a class="line" href="../../dd/dd2/structfax__gateway.html#a6157ce6a6b99804070b09723d9dcf05d">  463</a></span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d0/d98/structast__format.html">ast_format</a> *<a class="code" href="../../dd/dd2/structfax__gateway.html#a6157ce6a6b99804070b09723d9dcf05d">chan_write_format</a>;</div><div class="line"><a name="l00464"></a><span class="lineno"><a class="line" href="../../dd/dd2/structfax__gateway.html#ac11fd22af311685dee2ccb296221cc86">  464</a></span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d0/d98/structast__format.html">ast_format</a> *<a class="code" href="../../dd/dd2/structfax__gateway.html#ac11fd22af311685dee2ccb296221cc86">peer_read_format</a>;</div><div class="line"><a name="l00465"></a><span class="lineno"><a class="line" href="../../dd/dd2/structfax__gateway.html#a997059bcc0230f25cde254408e405d02">  465</a></span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d0/d98/structast__format.html">ast_format</a> *<a class="code" href="../../dd/dd2/structfax__gateway.html#a997059bcc0230f25cde254408e405d02">peer_write_format</a>;</div><div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;};</div><div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;<span class="comment">/*! \brief used for fax detect framehook */</span></div><div class="line"><a name="l00469"></a><span class="lineno"><a class="line" href="../../da/df6/structfax__detect.html">  469</a></span>&#160;<span class="keyword">struct </span><a class="code" href="../../da/df6/structfax__detect.html">fax_detect</a> {<span class="comment"></span></div><div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;<span class="comment">   /*! \brief the start of our timeout counter */</span></div><div class="line"><a name="l00471"></a><span class="lineno"><a class="line" href="../../da/df6/structfax__detect.html#a23b38dad7025290be3461b4b3208b4e6">  471</a></span>&#160;   <span class="keyword">struct </span>timeval timeout_start;<span class="comment"></span></div><div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;<span class="comment">   /*! \brief DSP Processor */</span></div><div class="line"><a name="l00473"></a><span class="lineno"><a class="line" href="../../da/df6/structfax__detect.html#ab9deccb020b39c3f7ac94b1af99cac5d">  473</a></span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d6/de5/structast__dsp.html">ast_dsp</a> *<a class="code" href="../../da/df6/structfax__detect.html#ab9deccb020b39c3f7ac94b1af99cac5d">dsp</a>;<span class="comment"></span></div><div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;<span class="comment">   /*! \brief original audio formats */</span></div><div class="line"><a name="l00475"></a><span class="lineno"><a class="line" href="../../da/df6/structfax__detect.html#ae5329584b2cf034725f675183f6bd391">  475</a></span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d0/d98/structast__format.html">ast_format</a> *<a class="code" href="../../da/df6/structfax__detect.html#ae5329584b2cf034725f675183f6bd391">orig_format</a>;<span class="comment"></span></div><div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;<span class="comment">   /*! \brief fax session details */</span></div><div class="line"><a name="l00477"></a><span class="lineno"><a class="line" href="../../da/df6/structfax__detect.html#ae7b633178d301df70e8612b4ce1aeb77">  477</a></span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d8/dc2/structast__fax__session__details.html">ast_fax_session_details</a> *<a class="code" href="../../da/df6/structfax__detect.html#ae7b633178d301df70e8612b4ce1aeb77">details</a>;<span class="comment"></span></div><div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;<span class="comment">   /*! \brief mode */</span></div><div class="line"><a name="l00479"></a><span class="lineno"><a class="line" href="../../da/df6/structfax__detect.html#ac8bf36fe0577cba66bccda3a6f7e80a4">  479</a></span>&#160;   <span class="keywordtype">int</span> <a class="code" href="../../da/df6/structfax__detect.html#ac8bf36fe0577cba66bccda3a6f7e80a4">flags</a>;</div><div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;};</div><div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;<span class="comment">/*! \brief FAX Detect flags */</span></div><div class="line"><a name="l00483"></a><span class="lineno"><a class="line" href="../../d0/d60/res__fax_8c.html#af4165a00608b669d97f5acbe873dc1f7">  483</a></span>&#160;<span class="preprocessor">#define FAX_DETECT_MODE_CNG   (1 &lt;&lt; 0)</span></div><div class="line"><a name="l00484"></a><span class="lineno"><a class="line" href="../../d0/d60/res__fax_8c.html#a9612f65fe4e81e83a12136c6b9e89553">  484</a></span>&#160;<span class="preprocessor">#define FAX_DETECT_MODE_T38   (1 &lt;&lt; 1)</span></div><div class="line"><a name="l00485"></a><span class="lineno"><a class="line" href="../../d0/d60/res__fax_8c.html#a23c423fff7dbf2e50800db8be4ae26ed">  485</a></span>&#160;<span class="preprocessor">#define FAX_DETECT_MODE_BOTH  (FAX_DETECT_MODE_CNG | FAX_DETECT_MODE_T38)</span></div><div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;</div><div class="line"><a name="l00487"></a><span class="lineno"><a class="line" href="../../d0/d60/res__fax_8c.html#a3e8bec5eeb0e707450d6dab929fe3436">  487</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d0/d60/res__fax_8c.html#a3e8bec5eeb0e707450d6dab929fe3436">fax_logger_level</a> = -1;</div><div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;<span class="comment">/*! \brief maximum buckets for res_fax ao2 containers */</span></div><div class="line"><a name="l00490"></a><span class="lineno"><a class="line" href="../../d0/d60/res__fax_8c.html#a714cd8f82d821052b5bbd4b6234b5950">  490</a></span>&#160;<span class="preprocessor">#define FAX_MAXBUCKETS 10</span></div><div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;</div><div class="line"><a name="l00492"></a><span class="lineno"><a class="line" href="../../d0/d60/res__fax_8c.html#affb9d2b3b67e36e7e7ad9b4055de7630">  492</a></span>&#160;<span class="preprocessor">#define RES_FAX_TIMEOUT 10000</span></div><div class="line"><a name="l00493"></a><span class="lineno"><a class="line" href="../../d0/d60/res__fax_8c.html#ac63658a749ab21cd75126580a69a789a">  493</a></span>&#160;<span class="preprocessor">#define FAX_GATEWAY_TIMEOUT RES_FAX_TIMEOUT</span></div><div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;<span class="comment">/*! \brief The faxregistry is used to manage information and statistics for all FAX sessions. */</span></div><div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;<span class="keyword">static</span> <span class="keyword">struct </span>{<span class="comment"></span></div><div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;<span class="comment">   /*! The number of active FAX sessions */</span></div><div class="line"><a name="l00498"></a><span class="lineno"><a class="line" href="../../d0/d60/res__fax_8c.html#ab801f87cf8e5b82381bec2e68c73ffbf">  498</a></span>&#160;   <span class="keywordtype">int</span> <a class="code" href="../../d0/d60/res__fax_8c.html#ab801f87cf8e5b82381bec2e68c73ffbf">active_sessions</a>;<span class="comment"></span></div><div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;<span class="comment">   /*! The number of reserved FAX sessions */</span></div><div class="line"><a name="l00500"></a><span class="lineno"><a class="line" href="../../d0/d60/res__fax_8c.html#afa20e50d2a685b5bb4d13ca0bb62d4c8">  500</a></span>&#160;   <span class="keywordtype">int</span> <a class="code" href="../../d0/d60/res__fax_8c.html#afa20e50d2a685b5bb4d13ca0bb62d4c8">reserved_sessions</a>;<span class="comment"></span></div><div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;<span class="comment">   /*! active sessions are astobj2 objects */</span></div><div class="line"><a name="l00502"></a><span class="lineno"><a class="line" href="../../d0/d60/res__fax_8c.html#a7ea220e4d14b05876af4430e9832ce47">  502</a></span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d2/da9/structao2__container.html">ao2_container</a> *<a class="code" href="../../d0/d60/res__fax_8c.html#a7ea220e4d14b05876af4430e9832ce47">container</a>;<span class="comment"></span></div><div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;<span class="comment">   /*! Total number of Tx FAX attempts */</span></div><div class="line"><a name="l00504"></a><span class="lineno"><a class="line" href="../../d0/d60/res__fax_8c.html#a578823f8ca07fcdd9b31030679259c47">  504</a></span>&#160;   <span class="keywordtype">int</span> <a class="code" href="../../d0/d60/res__fax_8c.html#a578823f8ca07fcdd9b31030679259c47">fax_tx_attempts</a>;<span class="comment"></span></div><div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;<span class="comment">   /*! Total number of Rx FAX attempts */</span></div><div class="line"><a name="l00506"></a><span class="lineno"><a class="line" href="../../d0/d60/res__fax_8c.html#a3b513e2bd3454f5e5077c0ca8f748142">  506</a></span>&#160;   <span class="keywordtype">int</span> <a class="code" href="../../d0/d60/res__fax_8c.html#a3b513e2bd3454f5e5077c0ca8f748142">fax_rx_attempts</a>;<span class="comment"></span></div><div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;<span class="comment">   /*! Number of successful FAX transmissions */</span></div><div class="line"><a name="l00508"></a><span class="lineno"><a class="line" href="../../d0/d60/res__fax_8c.html#ac80e2d8faf47cb500e4b85bb8d2c97ee">  508</a></span>&#160;   <span class="keywordtype">int</span> <a class="code" href="../../d0/d60/res__fax_8c.html#ac80e2d8faf47cb500e4b85bb8d2c97ee">fax_complete</a>;<span class="comment"></span></div><div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;<span class="comment">   /*! Number of failed FAX transmissions */</span></div><div class="line"><a name="l00510"></a><span class="lineno"><a class="line" href="../../d0/d60/res__fax_8c.html#af76343c79cdf15a8e524457455fc2d20">  510</a></span>&#160;   <span class="keywordtype">int</span> <a class="code" href="../../d0/d60/res__fax_8c.html#af76343c79cdf15a8e524457455fc2d20">fax_failures</a>;<span class="comment"></span></div><div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;<span class="comment">   /*! the next unique session name */</span></div><div class="line"><a name="l00512"></a><span class="lineno"><a class="line" href="../../d0/d60/res__fax_8c.html#ae3fd81a0a9b66a52b821e2a795395000">  512</a></span>&#160;   <span class="keywordtype">int</span> <a class="code" href="../../d0/d60/res__fax_8c.html#ae3fd81a0a9b66a52b821e2a795395000">nextsessionname</a>;</div><div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;} <a class="code" href="../../d0/d60/res__fax_8c.html#a058b6772fcfe1ce5a1a0957e2f11d367">faxregistry</a>;</div><div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;<span class="comment">/*! \brief registered FAX technology modules are put into this list */</span></div><div class="line"><a name="l00516"></a><span class="lineno"><a class="line" href="../../d9/d07/structfax__module.html">  516</a></span>&#160;<span class="keyword">struct </span><a class="code" href="../../d9/d07/structfax__module.html">fax_module</a> {</div><div class="line"><a name="l00517"></a><span class="lineno"><a class="line" href="../../d9/d07/structfax__module.html#a4ac6ff3775e67c710cd55bc7dfd592fe">  517</a></span>&#160;   <span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="../../d9/d0e/structast__fax__tech.html">ast_fax_tech</a> *<a class="code" href="../../d9/d07/structfax__module.html#a4ac6ff3775e67c710cd55bc7dfd592fe">tech</a>;</div><div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;   <a class="code" href="../../df/d90/linkedlists_8h.html#ac63e9e237da22b6faf3be4edfc4f5a11">AST_RWLIST_ENTRY</a>(<a class="code" href="../../d9/d07/structfax__module.html">fax_module</a>) list;</div><div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;};</div><div class="line"><a name="l00520"></a><span class="lineno"><a class="line" href="../../df/d07/structfaxmodules.html#ace4e0066a5b24f84b90536e9906619f6">  520</a></span>&#160;<span class="keyword">static</span> <a class="code" href="../../df/d90/linkedlists_8h.html#a39918fd433ac42184b152c86016ef139">AST_RWLIST_HEAD_STATIC</a>(<a class="code" href="../../df/d07/structfaxmodules.html">faxmodules</a>, <a class="code" href="../../d9/d07/structfax__module.html">fax_module</a>);</div><div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;</div><div class="line"><a name="l00522"></a><span class="lineno"><a class="line" href="../../d0/d60/res__fax_8c.html#a73bbffb792649ab5cb9278a0476a7ddd">  522</a></span>&#160;<span class="preprocessor">#define RES_FAX_MINRATE 4800</span></div><div class="line"><a name="l00523"></a><span class="lineno"><a class="line" href="../../d0/d60/res__fax_8c.html#a0551bf04899fb222ec7b425200049a6f">  523</a></span>&#160;<span class="preprocessor">#define RES_FAX_MAXRATE 14400</span></div><div class="line"><a name="l00524"></a><span class="lineno"><a class="line" href="../../d0/d60/res__fax_8c.html#ab42fd8bc63ac1571556fa571dcc1c91c">  524</a></span>&#160;<span class="preprocessor">#define RES_FAX_STATUSEVENTS 0</span></div><div class="line"><a name="l00525"></a><span class="lineno"><a class="line" href="../../d0/d60/res__fax_8c.html#a543460599793e883a0b4d4a99c639722">  525</a></span>&#160;<span class="preprocessor">#define RES_FAX_MODEM (AST_FAX_MODEM_V17 | AST_FAX_MODEM_V27TER | AST_FAX_MODEM_V29)</span></div><div class="line"><a name="l00526"></a><span class="lineno"><a class="line" href="../../d0/d60/res__fax_8c.html#ab7db9bae692cd3e60f2413df1e0e978a">  526</a></span>&#160;<span class="preprocessor">#define RES_FAX_T38TIMEOUT 5000</span></div><div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;</div><div class="line"><a name="l00528"></a><span class="lineno"><a class="line" href="../../d0/d28/structfax__options.html">  528</a></span>&#160;<span class="keyword">struct </span><a class="code" href="../../d0/d28/structfax__options.html">fax_options</a> {</div><div class="line"><a name="l00529"></a><span class="lineno"><a class="line" href="../../d0/d28/structfax__options.html#a38b557eee45ee4c0d92d514c04823f84">  529</a></span>&#160;   <span class="keyword">enum</span> <a class="code" href="../../db/d6a/res__fax_8h.html#ab9287e81dc5d3047da0bcb1f6c89bd57">ast_fax_modems</a> modems;</div><div class="line"><a name="l00530"></a><span class="lineno"><a class="line" href="../../d0/d28/structfax__options.html#a7f633c7bc4fe667e873649afa4d44640">  530</a></span>&#160;   uint32_t <a class="code" href="../../d0/d28/structfax__options.html#a7f633c7bc4fe667e873649afa4d44640">statusevents</a>:1;</div><div class="line"><a name="l00531"></a><span class="lineno"><a class="line" href="../../d0/d28/structfax__options.html#af766692698b742acddbc42494d323a9f">  531</a></span>&#160;   uint32_t <a class="code" href="../../d0/d28/structfax__options.html#af766692698b742acddbc42494d323a9f">ecm</a>:1;</div><div class="line"><a name="l00532"></a><span class="lineno"><a class="line" href="../../d0/d28/structfax__options.html#a8bff16fb9ab2254b86636f6fac166a66">  532</a></span>&#160;   <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="../../d0/d28/structfax__options.html#a8bff16fb9ab2254b86636f6fac166a66">minrate</a>;</div><div class="line"><a name="l00533"></a><span class="lineno"><a class="line" href="../../d0/d28/structfax__options.html#a975b0a45868387d13867daeac314978a">  533</a></span>&#160;   <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="../../d0/d28/structfax__options.html#a975b0a45868387d13867daeac314978a">maxrate</a>;</div><div class="line"><a name="l00534"></a><span class="lineno"><a class="line" href="../../d0/d28/structfax__options.html#a50d4d0d4e0ae5aae877a0e6d2faa9517">  534</a></span>&#160;   <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="../../d0/d28/structfax__options.html#a50d4d0d4e0ae5aae877a0e6d2faa9517">t38timeout</a>;</div><div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;};</div><div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;</div><div class="line"><a name="l00537"></a><span class="lineno"><a class="line" href="../../d0/d60/res__fax_8c.html#affdd90b9debbbb9add90b87c27b38de0">  537</a></span>&#160;<span class="keyword">static</span> <span class="keyword">struct </span><a class="code" href="../../d0/d28/structfax__options.html">fax_options</a> <a class="code" href="../../d0/d60/res__fax_8c.html#affdd90b9debbbb9add90b87c27b38de0">general_options</a>;</div><div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;</div><div class="line"><a name="l00539"></a><span class="lineno"><a class="line" href="../../d0/d60/res__fax_8c.html#a4ca79c149a1ff5fdc17dbce18e8371f8">  539</a></span>&#160;<span class="keyword">static</span> <span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="../../d0/d28/structfax__options.html">fax_options</a> <a class="code" href="../../d0/d60/res__fax_8c.html#a4ca79c149a1ff5fdc17dbce18e8371f8">default_options</a> = {</div><div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;   .<a class="code" href="../../d0/d28/structfax__options.html#a8bff16fb9ab2254b86636f6fac166a66">minrate</a> = <a class="code" href="../../d0/d60/res__fax_8c.html#a73bbffb792649ab5cb9278a0476a7ddd">RES_FAX_MINRATE</a>,</div><div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;   .maxrate = <a class="code" href="../../d0/d60/res__fax_8c.html#a0551bf04899fb222ec7b425200049a6f">RES_FAX_MAXRATE</a>,</div><div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;   .statusevents = <a class="code" href="../../d0/d60/res__fax_8c.html#ab42fd8bc63ac1571556fa571dcc1c91c">RES_FAX_STATUSEVENTS</a>,</div><div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;   .modems = <a class="code" href="../../d0/d60/res__fax_8c.html#a543460599793e883a0b4d4a99c639722">RES_FAX_MODEM</a>,</div><div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;   .ecm = <a class="code" href="../../db/d6a/res__fax_8h.html#a1838c71fcf68c3cfe0ce37e35e77406dabd9b4a57405ba5c0c884ac98746a8bd7">AST_FAX_OPTFLAG_TRUE</a>,</div><div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;   .t38timeout = <a class="code" href="../../d0/d60/res__fax_8c.html#ab7db9bae692cd3e60f2413df1e0e978a">RES_FAX_T38TIMEOUT</a>,</div><div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;};</div><div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;</div><div class="line"><a name="l00548"></a><span class="lineno"><a class="line" href="../../d0/d60/res__fax_8c.html#a75acaa938bee74395e4decb810ab7789">  548</a></span>&#160;<a class="code" href="../../dd/d42/lock_8h.html#a7443635fb39ae2aa946e2373dada3ac7">AST_RWLOCK_DEFINE_STATIC</a>(<a class="code" href="../../d0/d60/res__fax_8c.html#a75acaa938bee74395e4decb810ab7789">options_lock</a>);</div><div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;</div><div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d0/d60/res__fax_8c.html#aa4691aa21eb58ad524c6418d9f252b7d">get_general_options</a>(<span class="keyword">struct</span> <a class="code" href="../../d0/d28/structfax__options.html">fax_options</a>* <a class="code" href="../../d4/d45/test__http__media__cache_8c.html#a80c8e3ae5087d90d422675d034eeebc7">options</a>);</div><div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d0/d60/res__fax_8c.html#a235464080ba7708ab425f6074d9a2bda">set_general_options</a>(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="../../d0/d28/structfax__options.html">fax_options</a>* <a class="code" href="../../d4/d45/test__http__media__cache_8c.html#a80c8e3ae5087d90d422675d034eeebc7">options</a>);</div><div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;</div><div class="line"><a name="l00553"></a><span class="lineno"><a class="line" href="../../d0/d60/res__fax_8c.html#a65e5109273690c9fa64f70d4860c6647">  553</a></span>&#160;<span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="../../d0/d60/res__fax_8c.html#a65e5109273690c9fa64f70d4860c6647">config</a> = <span class="stringliteral">&quot;res_fax.conf&quot;</span>;</div><div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;</div><div class="line"><a name="l00555"></a><span class="lineno"><a class="line" href="../../d0/d60/res__fax_8c.html#afb6be9ca0b6c0d09211b5c4e55fa2291">  555</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d0/d60/res__fax_8c.html#afb6be9ca0b6c0d09211b5c4e55fa2291">global_fax_debug</a> = 0;</div><div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;</div><div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;<span class="keyword">enum</span> {</div><div class="line"><a name="l00558"></a><span class="lineno"><a class="line" href="../../d0/d60/res__fax_8c.html#a46275621a3d3846d089a092249fb8c37a2ffdf9172bc4ad9ae1ee477d90078ef0">  558</a></span>&#160;   <a class="code" href="../../d0/d60/res__fax_8c.html#a46275621a3d3846d089a092249fb8c37a2ffdf9172bc4ad9ae1ee477d90078ef0">OPT_CALLEDMODE</a>  = (1 &lt;&lt; 0),</div><div class="line"><a name="l00559"></a><span class="lineno"><a class="line" href="../../d0/d60/res__fax_8c.html#a46275621a3d3846d089a092249fb8c37a8e81c5ccb5474dde66440f846fdfdd90">  559</a></span>&#160;   <a class="code" href="../../d0/d60/res__fax_8c.html#a46275621a3d3846d089a092249fb8c37a8e81c5ccb5474dde66440f846fdfdd90">OPT_CALLERMODE</a>  = (1 &lt;&lt; 1),</div><div class="line"><a name="l00560"></a><span class="lineno"><a class="line" href="../../d0/d60/res__fax_8c.html#a46275621a3d3846d089a092249fb8c37ae18c66c85f5c325308846289886981d7">  560</a></span>&#160;   <a class="code" href="../../d0/d60/res__fax_8c.html#a46275621a3d3846d089a092249fb8c37ae18c66c85f5c325308846289886981d7">OPT_DEBUG</a>       = (1 &lt;&lt; 2),</div><div class="line"><a name="l00561"></a><span class="lineno"><a class="line" href="../../d0/d60/res__fax_8c.html#a46275621a3d3846d089a092249fb8c37ac50e4902aa670a5a0ad1927d8fef741a">  561</a></span>&#160;   <a class="code" href="../../d0/d60/res__fax_8c.html#a46275621a3d3846d089a092249fb8c37ac50e4902aa670a5a0ad1927d8fef741a">OPT_STATUS</a>      = (1 &lt;&lt; 3),</div><div class="line"><a name="l00562"></a><span class="lineno"><a class="line" href="../../d0/d60/res__fax_8c.html#a46275621a3d3846d089a092249fb8c37a98a16270534ab6ed19ac7935f6ab5730">  562</a></span>&#160;   <a class="code" href="../../d0/d60/res__fax_8c.html#a46275621a3d3846d089a092249fb8c37a98a16270534ab6ed19ac7935f6ab5730">OPT_ALLOWAUDIO</a>  = (1 &lt;&lt; 5),</div><div class="line"><a name="l00563"></a><span class="lineno"><a class="line" href="../../d0/d60/res__fax_8c.html#a46275621a3d3846d089a092249fb8c37a580250f89769e79e089f734549526a37">  563</a></span>&#160;   <a class="code" href="../../d0/d60/res__fax_8c.html#a46275621a3d3846d089a092249fb8c37a580250f89769e79e089f734549526a37">OPT_REQUEST_T38</a> = (1 &lt;&lt; 6),</div><div class="line"><a name="l00564"></a><span class="lineno"><a class="line" href="../../d0/d60/res__fax_8c.html#a46275621a3d3846d089a092249fb8c37a87052b571961ef8c1192a196d329ea1d">  564</a></span>&#160;   <a class="code" href="../../d0/d60/res__fax_8c.html#a46275621a3d3846d089a092249fb8c37a87052b571961ef8c1192a196d329ea1d">OPT_FORCE_AUDIO</a> = (1 &lt;&lt; 7),</div><div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;};</div><div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;</div><div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;<a class="code" href="../../d3/d93/include_2asterisk_2app_8h.html#a520a3c6b7d57903d9a616051da1a019d">AST_APP_OPTIONS</a>(<a class="code" href="../../d0/d60/res__fax_8c.html#a2fccc15f81746e2ae5f88df9e88f3a7a">fax_exec_options</a>, <a class="code" href="../../d3/d93/include_2asterisk_2app_8h.html#ab451a4653176c211d131b899e1f91bde">BEGIN_OPTIONS</a></div><div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;   <a class="code" href="../../d3/d93/include_2asterisk_2app_8h.html#aca036489931bf5571e2472331c8ac80b">AST_APP_OPTION</a>(<span class="charliteral">&#39;a&#39;</span>, <a class="code" href="../../d0/d60/res__fax_8c.html#a46275621a3d3846d089a092249fb8c37a2ffdf9172bc4ad9ae1ee477d90078ef0">OPT_CALLEDMODE</a>),</div><div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;   <a class="code" href="../../d3/d93/include_2asterisk_2app_8h.html#aca036489931bf5571e2472331c8ac80b">AST_APP_OPTION</a>(<span class="charliteral">&#39;c&#39;</span>, <a class="code" href="../../d0/d60/res__fax_8c.html#a46275621a3d3846d089a092249fb8c37a8e81c5ccb5474dde66440f846fdfdd90">OPT_CALLERMODE</a>),</div><div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;   <a class="code" href="../../d3/d93/include_2asterisk_2app_8h.html#aca036489931bf5571e2472331c8ac80b">AST_APP_OPTION</a>(<span class="charliteral">&#39;d&#39;</span>, <a class="code" href="../../d0/d60/res__fax_8c.html#a46275621a3d3846d089a092249fb8c37ae18c66c85f5c325308846289886981d7">OPT_DEBUG</a>),</div><div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;   <a class="code" href="../../d3/d93/include_2asterisk_2app_8h.html#aca036489931bf5571e2472331c8ac80b">AST_APP_OPTION</a>(<span class="charliteral">&#39;f&#39;</span>, <a class="code" href="../../d0/d60/res__fax_8c.html#a46275621a3d3846d089a092249fb8c37a98a16270534ab6ed19ac7935f6ab5730">OPT_ALLOWAUDIO</a>),</div><div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;   <a class="code" href="../../d3/d93/include_2asterisk_2app_8h.html#aca036489931bf5571e2472331c8ac80b">AST_APP_OPTION</a>(<span class="charliteral">&#39;F&#39;</span>, <a class="code" href="../../d0/d60/res__fax_8c.html#a46275621a3d3846d089a092249fb8c37a87052b571961ef8c1192a196d329ea1d">OPT_FORCE_AUDIO</a>),</div><div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;   <a class="code" href="../../d3/d93/include_2asterisk_2app_8h.html#aca036489931bf5571e2472331c8ac80b">AST_APP_OPTION</a>(<span class="charliteral">&#39;s&#39;</span>, <a class="code" href="../../d0/d60/res__fax_8c.html#a46275621a3d3846d089a092249fb8c37ac50e4902aa670a5a0ad1927d8fef741a">OPT_STATUS</a>),</div><div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;   <a class="code" href="../../d3/d93/include_2asterisk_2app_8h.html#aca036489931bf5571e2472331c8ac80b">AST_APP_OPTION</a>(<span class="charliteral">&#39;z&#39;</span>, <a class="code" href="../../d0/d60/res__fax_8c.html#a46275621a3d3846d089a092249fb8c37a580250f89769e79e089f734549526a37">OPT_REQUEST_T38</a>),</div><div class="line"><a name="l00575"></a><span class="lineno"><a class="line" href="../../d0/d60/res__fax_8c.html#a2fccc15f81746e2ae5f88df9e88f3a7a">  575</a></span>&#160;<a class="code" href="../../d3/d93/include_2asterisk_2app_8h.html#a2a1890787b3e55318c417c0a3e1432c7">END_OPTIONS</a>);</div><div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;</div><div class="line"><a name="l00577"></a><span class="lineno"><a class="line" href="../../d0/d60/res__fax_8c.html#aae683f9221ef32fd1fdc2f52e94857e0">  577</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d0/d60/res__fax_8c.html#aae683f9221ef32fd1fdc2f52e94857e0">debug_check_frame_for_silence</a>(<span class="keyword">struct</span> <a class="code" href="../../d1/d16/structast__fax__session.html">ast_fax_session</a> *s, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> c2s, <span class="keyword">struct</span> <a class="code" href="../../d0/d99/structast__frame.html">ast_frame</a> *frame)</div><div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;{</div><div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d2/d1c/structdebug__info__history.html">debug_info_history</a> *history = c2s ? &amp;s-&gt;<a class="code" href="../../d1/d16/structast__fax__session.html#a881c40036288d692235f426586f2352b">debug_info</a>-&gt;c2s : &amp;s-&gt;<a class="code" href="../../d1/d16/structast__fax__session.html#a881c40036288d692235f426586f2352b">debug_info</a>-&gt;<a class="code" href="../../d3/d84/structast__fax__debug__info.html#a16b8f82ab064d3b55a11bc9059805bf5">s2c</a>;</div><div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;   <span class="keywordtype">int</span> dspsilence;</div><div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;   <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> last_consec_frames, last_consec_ms;</div><div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;   <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> wassil;</div><div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;   <span class="keyword">struct </span>timeval diff;</div><div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;</div><div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;   diff = <a class="code" href="../../de/df7/time_8h.html#aa13b651c18bc6004cab21ac041d44dd8">ast_tvsub</a>(<a class="code" href="../../de/df7/time_8h.html#ad3899efb6f0e348556ef69f5b16aa7f7">ast_tvnow</a>(), s-&gt;<a class="code" href="../../d1/d16/structast__fax__session.html#a881c40036288d692235f426586f2352b">debug_info</a>-&gt;<a class="code" href="../../d3/d84/structast__fax__debug__info.html#a223334851a9df6368db714953c25990e">base_tv</a>);</div><div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;</div><div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;   <a class="code" href="../../d3/d08/dsp_8h.html#a673744da45e35463b6500a17c360bebe">ast_dsp_reset</a>(s-&gt;<a class="code" href="../../d1/d16/structast__fax__session.html#a881c40036288d692235f426586f2352b">debug_info</a>-&gt;<a class="code" href="../../d3/d84/structast__fax__debug__info.html#ab9deccb020b39c3f7ac94b1af99cac5d">dsp</a>);</div><div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;   <a class="code" href="../../d3/d08/dsp_8h.html#a3f3b67988bffb3addfbc8a4688fa466d">ast_dsp_silence</a>(s-&gt;<a class="code" href="../../d1/d16/structast__fax__session.html#a881c40036288d692235f426586f2352b">debug_info</a>-&gt;<a class="code" href="../../d3/d84/structast__fax__debug__info.html#ab9deccb020b39c3f7ac94b1af99cac5d">dsp</a>, frame, &amp;dspsilence);</div><div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;</div><div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;   wassil = history-&gt;<a class="code" href="../../d2/d1c/structdebug__info__history.html#a99f01a0b4f6b3afa5bf25e98c550bcc1">silence</a>;</div><div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;   history-&gt;<a class="code" href="../../d2/d1c/structdebug__info__history.html#a99f01a0b4f6b3afa5bf25e98c550bcc1">silence</a> = (dspsilence != 0) ? 1 : 0;</div><div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;   <span class="keywordflow">if</span> (history-&gt;<a class="code" href="../../d2/d1c/structdebug__info__history.html#a99f01a0b4f6b3afa5bf25e98c550bcc1">silence</a> != wassil) {</div><div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;      last_consec_frames = history-&gt;<a class="code" href="../../d2/d1c/structdebug__info__history.html#a956be2e6e0911206ed31a587010be4da">consec_frames</a>;</div><div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;      last_consec_ms = history-&gt;<a class="code" href="../../d2/d1c/structdebug__info__history.html#a0e129d2262db03fd0da1b365ea05fdc5">consec_ms</a>;</div><div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;      history-&gt;<a class="code" href="../../d2/d1c/structdebug__info__history.html#a956be2e6e0911206ed31a587010be4da">consec_frames</a> = 0;</div><div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;      history-&gt;<a class="code" href="../../d2/d1c/structdebug__info__history.html#a0e129d2262db03fd0da1b365ea05fdc5">consec_ms</a> = 0;</div><div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;</div><div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;      <span class="keywordflow">if</span> ((last_consec_frames != 0)) {</div><div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;         <a class="code" href="../../d1/d8c/logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(0, <span class="stringliteral">&quot;Channel &#39;%s&#39; fax session &#39;%u&#39;, [ %.3ld.%.6ld ], %s sent %u frames (%u ms) of %s.\n&quot;</span>,</div><div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;             s-&gt;<a class="code" href="../../d1/d16/structast__fax__session.html#a9f716886b5b2a50ad6d2b9119502b152">channame</a>, s-&gt;<a class="code" href="../../d1/d16/structast__fax__session.html#ab7ce6f462afaf105224b0ca772a33c43">id</a>, (<span class="keywordtype">long</span>) diff.tv_sec, (<span class="keywordtype">long</span> <span class="keywordtype">int</span>) diff.tv_usec,</div><div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;             (c2s) ? <span class="stringliteral">&quot;channel&quot;</span> : <span class="stringliteral">&quot;stack&quot;</span>, last_consec_frames, last_consec_ms,</div><div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;             (wassil) ? <span class="stringliteral">&quot;silence&quot;</span> : <span class="stringliteral">&quot;energy&quot;</span>);</div><div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;      }</div><div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;   }</div><div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;</div><div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;   history-&gt;<a class="code" href="../../d2/d1c/structdebug__info__history.html#a956be2e6e0911206ed31a587010be4da">consec_frames</a>++;</div><div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;   history-&gt;<a class="code" href="../../d2/d1c/structdebug__info__history.html#a0e129d2262db03fd0da1b365ea05fdc5">consec_ms</a> += (frame-&gt;<a class="code" href="../../d0/d99/structast__frame.html#a37672e6b906143604cefd3e959777b31">samples</a> / 8);</div><div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;}</div><div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;</div><div class="line"><a name="l00610"></a><span class="lineno"><a class="line" href="../../d0/d60/res__fax_8c.html#abdefdbe1ecf335759235651298ad70b2">  610</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d0/d60/res__fax_8c.html#abdefdbe1ecf335759235651298ad70b2">destroy_callback</a>(<span class="keywordtype">void</span> *data)</div><div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;{</div><div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;   <span class="keywordflow">if</span> (data) {</div><div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160;      <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(data, -1);</div><div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;   }</div><div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;}</div><div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;</div><div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d0/d60/res__fax_8c.html#a6268c89f90792764152ddfa24154a78e">fixup_callback</a>(<span class="keywordtype">void</span> *data, <span class="keyword">struct</span> <a class="code" href="../../df/d3c/structast__channel.html">ast_channel</a> *old_chan, <span class="keyword">struct</span> <a class="code" href="../../df/d3c/structast__channel.html">ast_channel</a> *new_chan);</div><div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160;</div><div class="line"><a name="l00619"></a><span class="lineno"><a class="line" href="../../d0/d60/res__fax_8c.html#a51e58bc93624e847e900cdc13b7bfa5a">  619</a></span>&#160;<span class="keyword">static</span> <span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="../../d9/dfb/structast__datastore__info.html">ast_datastore_info</a> <a class="code" href="../../d0/d60/res__fax_8c.html#a51e58bc93624e847e900cdc13b7bfa5a">fax_datastore</a> = {</div><div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160;   .<a class="code" href="../../d9/dfb/structast__datastore__info.html#a763fd8db6bba8fbbbc113ca0d61c47c2">type</a> = <span class="stringliteral">&quot;res_fax&quot;</span>,</div><div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;   .destroy = <a class="code" href="../../d0/d60/res__fax_8c.html#abdefdbe1ecf335759235651298ad70b2">destroy_callback</a>,</div><div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;   .chan_fixup = <a class="code" href="../../d0/d60/res__fax_8c.html#a6268c89f90792764152ddfa24154a78e">fixup_callback</a>,</div><div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;};</div><div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;</div><div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d0/d60/res__fax_8c.html#a87718f9b64d50c694da714f631626807">fax_gateway_attach</a>(<span class="keyword">struct</span> <a class="code" href="../../df/d3c/structast__channel.html">ast_channel</a> *chan, <span class="keyword">struct</span> <a class="code" href="../../d8/dc2/structast__fax__session__details.html">ast_fax_session_details</a> *details);</div><div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d0/d60/res__fax_8c.html#a72074e43459dce843bd53cf52f186861">fax_detect_attach</a>(<span class="keyword">struct</span> <a class="code" href="../../df/d3c/structast__channel.html">ast_channel</a> *chan, <span class="keywordtype">int</span> <a class="code" href="../../d0/d29/cdr__mysql_8c.html#a493b57f443cc38b3d3df9c1e584d9d82">timeout</a>, <span class="keywordtype">int</span> flags);</div><div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160;<span class="keyword">static</span> <span class="keyword">struct </span><a class="code" href="../../d8/dc2/structast__fax__session__details.html">ast_fax_session_details</a> *<a class="code" href="../../d0/d60/res__fax_8c.html#ac4310e981e9db76dfc3e85c51f4c6e1e">find_or_create_details</a>(<span class="keyword">struct</span> <a class="code" href="../../df/d3c/structast__channel.html">ast_channel</a> *chan);</div><div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;<span class="keyword">static</span> <span class="keyword">struct </span><a class="code" href="../../d1/d16/structast__fax__session.html">ast_fax_session</a> *<a class="code" href="../../d0/d60/res__fax_8c.html#a563b007e45c3114b00faab5a9577fda1">fax_v21_session_new</a> (<span class="keyword">struct</span> <a class="code" href="../../df/d3c/structast__channel.html">ast_channel</a> *chan);</div><div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160;</div><div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160;<span class="comment">/*! \brief Copies fax detection and gateway framehooks during masquerades</span></div><div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160;<span class="comment"> * \note must be called with both old_chan and new_chan locked. Since this</span></div><div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160;<span class="comment"> *       is only called by do_masquerade, that shouldn&#39;t be an issue.</span></div><div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00636"></a><span class="lineno"><a class="line" href="../../d0/d60/res__fax_8c.html#a6268c89f90792764152ddfa24154a78e">  636</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d0/d60/res__fax_8c.html#a6268c89f90792764152ddfa24154a78e">fixup_callback</a>(<span class="keywordtype">void</span> *data, <span class="keyword">struct</span> <a class="code" href="../../df/d3c/structast__channel.html">ast_channel</a> *old_chan, <span class="keyword">struct</span> <a class="code" href="../../df/d3c/structast__channel.html">ast_channel</a> *new_chan)</div><div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160;{</div><div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d8/dc2/structast__fax__session__details.html">ast_fax_session_details</a> *old_details = data;</div><div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d4/d5d/structast__datastore.html">ast_datastore</a> *datastore = <a class="code" href="../../d5/d7b/channel_8h.html#aad1e09cd7c79237d05cffb45d6cdfd7c">ast_channel_datastore_find</a>(old_chan, &amp;fax_datastore, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div><div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160;</div><div class="line"><a name="l00641"></a><span class="lineno">  641</span>&#160;   <span class="keywordflow">if</span> (old_details-&gt;<a class="code" href="../../d8/dc2/structast__fax__session__details.html#a2a669261b0b8c26d26573c678149d312">gateway_id</a> &gt;= 0) {</div><div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160;      <span class="keyword">struct </span><a class="code" href="../../d8/dc2/structast__fax__session__details.html">ast_fax_session_details</a> *new_details = <a class="code" href="../../d0/d60/res__fax_8c.html#ac4310e981e9db76dfc3e85c51f4c6e1e">find_or_create_details</a>(new_chan);</div><div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160;</div><div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160;      <a class="code" href="../../db/d3c/framehook_8h.html#a6e116259cae8c1e5cca074d05f0a3475">ast_framehook_detach</a>(old_chan, old_details-&gt;<a class="code" href="../../d8/dc2/structast__fax__session__details.html#a2a669261b0b8c26d26573c678149d312">gateway_id</a>);</div><div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160;      new_details-&gt;<a class="code" href="../../d8/dc2/structast__fax__session__details.html#aa3cf325797b2746fbd79f34b2fd45370">is_t38_negotiated</a> = old_details-&gt;<a class="code" href="../../d8/dc2/structast__fax__session__details.html#aa3cf325797b2746fbd79f34b2fd45370">is_t38_negotiated</a>;</div><div class="line"><a name="l00646"></a><span class="lineno">  646</span>&#160;      <a class="code" href="../../d0/d60/res__fax_8c.html#a87718f9b64d50c694da714f631626807">fax_gateway_attach</a>(new_chan, new_details);</div><div class="line"><a name="l00647"></a><span class="lineno">  647</span>&#160;      <a class="code" href="../../d5/da5/astobj2_8h.html#a6321ee982370c55ab3c24c72c562cbdd">ao2_cleanup</a>(new_details);</div><div class="line"><a name="l00648"></a><span class="lineno">  648</span>&#160;   }</div><div class="line"><a name="l00649"></a><span class="lineno">  649</span>&#160;</div><div class="line"><a name="l00650"></a><span class="lineno">  650</span>&#160;   <span class="keywordflow">if</span> (old_details-&gt;<a class="code" href="../../d8/dc2/structast__fax__session__details.html#aaa69733356239747f442b9543b38cfba">faxdetect_id</a> &gt;= 0) {</div><div class="line"><a name="l00651"></a><span class="lineno">  651</span>&#160;      <a class="code" href="../../db/d3c/framehook_8h.html#a6e116259cae8c1e5cca074d05f0a3475">ast_framehook_detach</a>(old_chan, old_details-&gt;<a class="code" href="../../d8/dc2/structast__fax__session__details.html#aaa69733356239747f442b9543b38cfba">faxdetect_id</a>);</div><div class="line"><a name="l00652"></a><span class="lineno">  652</span>&#160;      <a class="code" href="../../d0/d60/res__fax_8c.html#a72074e43459dce843bd53cf52f186861">fax_detect_attach</a>(new_chan, old_details-&gt;<a class="code" href="../../d8/dc2/structast__fax__session__details.html#ab3f309860ee36512bc8bba783df26b1c">faxdetect_timeout</a>, old_details-&gt;<a class="code" href="../../d8/dc2/structast__fax__session__details.html#a6147f275a3ab3a425ab9da2b9d754241">faxdetect_flags</a>);</div><div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160;   }</div><div class="line"><a name="l00654"></a><span class="lineno">  654</span>&#160;</div><div class="line"><a name="l00655"></a><span class="lineno">  655</span>&#160;   <span class="keywordflow">if</span> (datastore) {</div><div class="line"><a name="l00656"></a><span class="lineno">  656</span>&#160;      <a class="code" href="../../d5/d7b/channel_8h.html#a1ff1c62b6d50823da93a920575c9c0c9">ast_channel_datastore_remove</a>(old_chan, datastore);</div><div class="line"><a name="l00657"></a><span class="lineno">  657</span>&#160;      <a class="code" href="../../d9/db6/datastore_8h.html#aee27286888b30c6448a9bce928040a14">ast_datastore_free</a>(datastore);</div><div class="line"><a name="l00658"></a><span class="lineno">  658</span>&#160;   }</div><div class="line"><a name="l00659"></a><span class="lineno">  659</span>&#160;}</div><div class="line"><a name="l00660"></a><span class="lineno">  660</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00661"></a><span class="lineno">  661</span>&#160;<span class="comment">/*! \brief returns a reference counted pointer to a fax datastore, if it exists */</span></div><div class="line"><a name="l00662"></a><span class="lineno"><a class="line" href="../../d0/d60/res__fax_8c.html#aa42f3331d32fc2fd92010023c6100322">  662</a></span>&#160;<span class="keyword">static</span> <span class="keyword">struct </span><a class="code" href="../../d8/dc2/structast__fax__session__details.html">ast_fax_session_details</a> *<a class="code" href="../../d0/d60/res__fax_8c.html#aa42f3331d32fc2fd92010023c6100322">find_details</a>(<span class="keyword">struct</span> <a class="code" href="../../df/d3c/structast__channel.html">ast_channel</a> *chan)</div><div class="line"><a name="l00663"></a><span class="lineno">  663</span>&#160;{</div><div class="line"><a name="l00664"></a><span class="lineno">  664</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d8/dc2/structast__fax__session__details.html">ast_fax_session_details</a> *details;</div><div class="line"><a name="l00665"></a><span class="lineno">  665</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d4/d5d/structast__datastore.html">ast_datastore</a> *datastore;</div><div class="line"><a name="l00666"></a><span class="lineno">  666</span>&#160;</div><div class="line"><a name="l00667"></a><span class="lineno">  667</span>&#160;   <a class="code" href="../../d5/d7b/channel_8h.html#a493bdebe876caafb8ee535853310364a">ast_channel_lock</a>(chan);</div><div class="line"><a name="l00668"></a><span class="lineno">  668</span>&#160;   <span class="keywordflow">if</span> (!(datastore = <a class="code" href="../../d5/d7b/channel_8h.html#aad1e09cd7c79237d05cffb45d6cdfd7c">ast_channel_datastore_find</a>(chan, &amp;fax_datastore, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>))) {</div><div class="line"><a name="l00669"></a><span class="lineno">  669</span>&#160;      <a class="code" href="../../d5/d7b/channel_8h.html#af476c537b29be3f29240489032f9db39">ast_channel_unlock</a>(chan);</div><div class="line"><a name="l00670"></a><span class="lineno">  670</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l00671"></a><span class="lineno">  671</span>&#160;   }</div><div class="line"><a name="l00672"></a><span class="lineno">  672</span>&#160;   <span class="keywordflow">if</span> (!(details = datastore-&gt;<a class="code" href="../../d4/d5d/structast__datastore.html#a735984d41155bc1032e09bece8f8d66d">data</a>)) {</div><div class="line"><a name="l00673"></a><span class="lineno">  673</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Huh?  channel &#39;%s&#39; has a FAX datastore without data!\n&quot;</span>, <a class="code" href="../../d5/d7b/channel_8h.html#a7ca2fda13b129a55c251b56729de285b">ast_channel_name</a>(chan));</div><div class="line"><a name="l00674"></a><span class="lineno">  674</span>&#160;      <a class="code" href="../../d5/d7b/channel_8h.html#af476c537b29be3f29240489032f9db39">ast_channel_unlock</a>(chan);</div><div class="line"><a name="l00675"></a><span class="lineno">  675</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l00676"></a><span class="lineno">  676</span>&#160;   }</div><div class="line"><a name="l00677"></a><span class="lineno">  677</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(details, 1);</div><div class="line"><a name="l00678"></a><span class="lineno">  678</span>&#160;   <a class="code" href="../../d5/d7b/channel_8h.html#af476c537b29be3f29240489032f9db39">ast_channel_unlock</a>(chan);</div><div class="line"><a name="l00679"></a><span class="lineno">  679</span>&#160;</div><div class="line"><a name="l00680"></a><span class="lineno">  680</span>&#160;   <span class="keywordflow">return</span> details;</div><div class="line"><a name="l00681"></a><span class="lineno">  681</span>&#160;}</div><div class="line"><a name="l00682"></a><span class="lineno">  682</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00683"></a><span class="lineno">  683</span>&#160;<span class="comment">/*! \brief destroy a FAX session details structure */</span></div><div class="line"><a name="l00684"></a><span class="lineno"><a class="line" href="../../d0/d60/res__fax_8c.html#a40f6174b24063f05bea58bf6288b14e0">  684</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d0/d60/res__fax_8c.html#a40f6174b24063f05bea58bf6288b14e0">destroy_session_details</a>(<span class="keywordtype">void</span> *details)</div><div class="line"><a name="l00685"></a><span class="lineno">  685</span>&#160;{</div><div class="line"><a name="l00686"></a><span class="lineno">  686</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d8/dc2/structast__fax__session__details.html">ast_fax_session_details</a> *<a class="code" href="../../d7/d6f/test__linkedlists_8c.html#a156f09c32102fa036620ad75c3ee4fbf">d</a> = details;</div><div class="line"><a name="l00687"></a><span class="lineno">  687</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d2/db8/structast__fax__document.html">ast_fax_document</a> *doc;</div><div class="line"><a name="l00688"></a><span class="lineno">  688</span>&#160;</div><div class="line"><a name="l00689"></a><span class="lineno">  689</span>&#160;   <span class="keywordflow">while</span> ((doc = <a class="code" href="../../df/d90/linkedlists_8h.html#aadfe2a69fbba4f27c201266a2ca5f989">AST_LIST_REMOVE_HEAD</a>(&amp;d-&gt;<a class="code" href="../../d8/dc2/structast__fax__session__details.html#a14c20eed7d6d03b484ebc2cc7a447ea2">documents</a>, <a class="code" href="../../d2/db8/structast__fax__document.html#a7d18bbe79e0371242e10316471016b3d">next</a>))) {</div><div class="line"><a name="l00690"></a><span class="lineno">  690</span>&#160;      <a class="code" href="../../d8/d8a/astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(doc);</div><div class="line"><a name="l00691"></a><span class="lineno">  691</span>&#160;   }</div><div class="line"><a name="l00692"></a><span class="lineno">  692</span>&#160;   <a class="code" href="../../d1/d0f/stringfields_8h.html#abf60f862ae6a141d2f86a0f5e82792de">ast_string_field_free_memory</a>(d);</div><div class="line"><a name="l00693"></a><span class="lineno">  693</span>&#160;}</div><div class="line"><a name="l00694"></a><span class="lineno">  694</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00695"></a><span class="lineno">  695</span>&#160;<span class="comment">/*! \brief create a FAX session details structure */</span></div><div class="line"><a name="l00696"></a><span class="lineno"><a class="line" href="../../d0/d60/res__fax_8c.html#a51a502192456037fec6aa542707fcfe4">  696</a></span>&#160;<span class="keyword">static</span> <span class="keyword">struct </span><a class="code" href="../../d8/dc2/structast__fax__session__details.html">ast_fax_session_details</a> *<a class="code" href="../../d0/d60/res__fax_8c.html#a51a502192456037fec6aa542707fcfe4">session_details_new</a>(<span class="keywordtype">void</span>)</div><div class="line"><a name="l00697"></a><span class="lineno">  697</span>&#160;{</div><div class="line"><a name="l00698"></a><span class="lineno">  698</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d8/dc2/structast__fax__session__details.html">ast_fax_session_details</a> *<a class="code" href="../../d7/d6f/test__linkedlists_8c.html#a156f09c32102fa036620ad75c3ee4fbf">d</a>;</div><div class="line"><a name="l00699"></a><span class="lineno">  699</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d0/d28/structfax__options.html">fax_options</a> options;</div><div class="line"><a name="l00700"></a><span class="lineno">  700</span>&#160;</div><div class="line"><a name="l00701"></a><span class="lineno">  701</span>&#160;   <span class="keywordflow">if</span> (!(d = <a class="code" href="../../d5/da5/astobj2_8h.html#ae0422b60d8e25b6962b2d61ae4ddf724">ao2_alloc</a>(<span class="keyword">sizeof</span>(*d), <a class="code" href="../../d0/d60/res__fax_8c.html#a40f6174b24063f05bea58bf6288b14e0">destroy_session_details</a>))) {</div><div class="line"><a name="l00702"></a><span class="lineno">  702</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l00703"></a><span class="lineno">  703</span>&#160;   }</div><div class="line"><a name="l00704"></a><span class="lineno">  704</span>&#160;</div><div class="line"><a name="l00705"></a><span class="lineno">  705</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d1/d0f/stringfields_8h.html#a871274fa4fd2687c7a44849a84df3665">ast_string_field_init</a>(d, 512)) {</div><div class="line"><a name="l00706"></a><span class="lineno">  706</span>&#160;      <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(d, -1);</div><div class="line"><a name="l00707"></a><span class="lineno">  707</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l00708"></a><span class="lineno">  708</span>&#160;   }</div><div class="line"><a name="l00709"></a><span class="lineno">  709</span>&#160;</div><div class="line"><a name="l00710"></a><span class="lineno">  710</span>&#160;   <a class="code" href="../../d0/d60/res__fax_8c.html#aa4691aa21eb58ad524c6418d9f252b7d">get_general_options</a>(&amp;options);</div><div class="line"><a name="l00711"></a><span class="lineno">  711</span>&#160;</div><div class="line"><a name="l00712"></a><span class="lineno">  712</span>&#160;   <a class="code" href="../../df/d90/linkedlists_8h.html#a0d1f922e093ac18824a7863fe3f5fa27">AST_LIST_HEAD_INIT_NOLOCK</a>(&amp;d-&gt;<a class="code" href="../../d8/dc2/structast__fax__session__details.html#a14c20eed7d6d03b484ebc2cc7a447ea2">documents</a>);</div><div class="line"><a name="l00713"></a><span class="lineno">  713</span>&#160;</div><div class="line"><a name="l00714"></a><span class="lineno">  714</span>&#160;   <span class="comment">/* These options need to be set to the configured default and may be overridden by</span></div><div class="line"><a name="l00715"></a><span class="lineno">  715</span>&#160;<span class="comment">    * SendFAX, ReceiveFAX, or FAXOPT */</span></div><div class="line"><a name="l00716"></a><span class="lineno">  716</span>&#160;   d-&gt;<a class="code" href="../../d8/dc2/structast__fax__session__details.html#a3ab211dbe8780b7292257f6b3dba1952">option</a>.<a class="code" href="../../d8/dc2/structast__fax__session__details.html#a9f26ae9d27415acd75d11e5cf606dd92">request_t38</a> = <a class="code" href="../../db/d6a/res__fax_8h.html#a1838c71fcf68c3cfe0ce37e35e77406daa2151729c413238bea86a4b62e7865bd">AST_FAX_OPTFLAG_FALSE</a>;</div><div class="line"><a name="l00717"></a><span class="lineno">  717</span>&#160;   d-&gt;<a class="code" href="../../d8/dc2/structast__fax__session__details.html#a3ab211dbe8780b7292257f6b3dba1952">option</a>.<a class="code" href="../../d8/dc2/structast__fax__session__details.html#ad3795f2a4b1e30b36f642bdcc0ec4586">send_cng</a> = <a class="code" href="../../db/d6a/res__fax_8h.html#a1838c71fcf68c3cfe0ce37e35e77406daa2151729c413238bea86a4b62e7865bd">AST_FAX_OPTFLAG_FALSE</a>;</div><div class="line"><a name="l00718"></a><span class="lineno">  718</span>&#160;   d-&gt;<a class="code" href="../../d8/dc2/structast__fax__session__details.html#a3ab211dbe8780b7292257f6b3dba1952">option</a>.<a class="code" href="../../d8/dc2/structast__fax__session__details.html#a71957d41c126c8b61cb93b69894d21fe">send_ced</a> = <a class="code" href="../../db/d6a/res__fax_8h.html#a1838c71fcf68c3cfe0ce37e35e77406daa2151729c413238bea86a4b62e7865bd">AST_FAX_OPTFLAG_FALSE</a>;</div><div class="line"><a name="l00719"></a><span class="lineno">  719</span>&#160;   d-&gt;<a class="code" href="../../d8/dc2/structast__fax__session__details.html#a3ab211dbe8780b7292257f6b3dba1952">option</a>.<a class="code" href="../../d8/dc2/structast__fax__session__details.html#af766692698b742acddbc42494d323a9f">ecm</a> = options.<a class="code" href="../../d0/d28/structfax__options.html#af766692698b742acddbc42494d323a9f">ecm</a>;</div><div class="line"><a name="l00720"></a><span class="lineno">  720</span>&#160;   d-&gt;<a class="code" href="../../d8/dc2/structast__fax__session__details.html#a3ab211dbe8780b7292257f6b3dba1952">option</a>.<a class="code" href="../../d8/dc2/structast__fax__session__details.html#a7f633c7bc4fe667e873649afa4d44640">statusevents</a> = options.<a class="code" href="../../d0/d28/structfax__options.html#a7f633c7bc4fe667e873649afa4d44640">statusevents</a>;</div><div class="line"><a name="l00721"></a><span class="lineno">  721</span>&#160;   d-&gt;<a class="code" href="../../d8/dc2/structast__fax__session__details.html#a38b557eee45ee4c0d92d514c04823f84">modems</a> = options.<a class="code" href="../../d0/d28/structfax__options.html#a38b557eee45ee4c0d92d514c04823f84">modems</a>;</div><div class="line"><a name="l00722"></a><span class="lineno">  722</span>&#160;   d-&gt;<a class="code" href="../../d8/dc2/structast__fax__session__details.html#a8bff16fb9ab2254b86636f6fac166a66">minrate</a> = options.<a class="code" href="../../d0/d28/structfax__options.html#a8bff16fb9ab2254b86636f6fac166a66">minrate</a>;</div><div class="line"><a name="l00723"></a><span class="lineno">  723</span>&#160;   d-&gt;<a class="code" href="../../d8/dc2/structast__fax__session__details.html#a975b0a45868387d13867daeac314978a">maxrate</a> = options.<a class="code" href="../../d0/d28/structfax__options.html#a975b0a45868387d13867daeac314978a">maxrate</a>;</div><div class="line"><a name="l00724"></a><span class="lineno">  724</span>&#160;   d-&gt;<a class="code" href="../../d8/dc2/structast__fax__session__details.html#a50d4d0d4e0ae5aae877a0e6d2faa9517">t38timeout</a> = options.<a class="code" href="../../d0/d28/structfax__options.html#a50d4d0d4e0ae5aae877a0e6d2faa9517">t38timeout</a>;</div><div class="line"><a name="l00725"></a><span class="lineno">  725</span>&#160;   d-&gt;<a class="code" href="../../d8/dc2/structast__fax__session__details.html#a2a669261b0b8c26d26573c678149d312">gateway_id</a> = -1;</div><div class="line"><a name="l00726"></a><span class="lineno">  726</span>&#160;   d-&gt;<a class="code" href="../../d8/dc2/structast__fax__session__details.html#aaa69733356239747f442b9543b38cfba">faxdetect_id</a> = -1;</div><div class="line"><a name="l00727"></a><span class="lineno">  727</span>&#160;   d-&gt;<a class="code" href="../../d8/dc2/structast__fax__session__details.html#a3ef48556ce45595f874faa2368bc3cfa">gateway_timeout</a> = 0;</div><div class="line"><a name="l00728"></a><span class="lineno">  728</span>&#160;   d-&gt;<a class="code" href="../../d8/dc2/structast__fax__session__details.html#a40311ef8f9bd5a1a7d7bf32f3b019148">negotiate_both</a> = 0;</div><div class="line"><a name="l00729"></a><span class="lineno">  729</span>&#160;</div><div class="line"><a name="l00730"></a><span class="lineno">  730</span>&#160;   <span class="keywordflow">return</span> <a class="code" href="../../d7/d6f/test__linkedlists_8c.html#a156f09c32102fa036620ad75c3ee4fbf">d</a>;</div><div class="line"><a name="l00731"></a><span class="lineno">  731</span>&#160;}</div><div class="line"><a name="l00732"></a><span class="lineno">  732</span>&#160;</div><div class="line"><a name="l00733"></a><span class="lineno"><a class="line" href="../../d0/d60/res__fax_8c.html#a8b3821747db8167c6ff68a5fdf3b073e">  733</a></span>&#160;<span class="keyword">static</span> <span class="keyword">struct </span><a class="code" href="../../d5/def/structast__control__t38__parameters.html">ast_control_t38_parameters</a> <a class="code" href="../../d0/d60/res__fax_8c.html#a8b3821747db8167c6ff68a5fdf3b073e">our_t38_parameters</a> = {</div><div class="line"><a name="l00734"></a><span class="lineno">  734</span>&#160;   .<a class="code" href="../../d5/def/structast__control__t38__parameters.html#a5408ac5df4c170828874e1b10b4c35a0">version</a> = 0,</div><div class="line"><a name="l00735"></a><span class="lineno">  735</span>&#160;   .max_ifp = 400,</div><div class="line"><a name="l00736"></a><span class="lineno">  736</span>&#160;   .rate = <a class="code" href="../../d6/d66/include_2asterisk_2frame_8h.html#a8d9ee156e6e29222a8fc1383f2832b07a2956ffa9b3fdde7ffc800fbd6e6a5482">AST_T38_RATE_14400</a>,</div><div class="line"><a name="l00737"></a><span class="lineno">  737</span>&#160;   .rate_management = <a class="code" href="../../d6/d66/include_2asterisk_2frame_8h.html#a9db3df106b7deebbee4c5106a880ec33abbb1b9b329ded73597a5c2eefe13a34c">AST_T38_RATE_MANAGEMENT_TRANSFERRED_TCF</a>,</div><div class="line"><a name="l00738"></a><span class="lineno">  738</span>&#160;};</div><div class="line"><a name="l00739"></a><span class="lineno">  739</span>&#160;</div><div class="line"><a name="l00740"></a><span class="lineno"><a class="line" href="../../d0/d60/res__fax_8c.html#aa9ea5a83822d7365075730ddb8490d23">  740</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d0/d60/res__fax_8c.html#aa9ea5a83822d7365075730ddb8490d23">t38_parameters_ast_to_fax</a>(<span class="keyword">struct</span> <a class="code" href="../../d3/df6/structast__fax__t38__parameters.html">ast_fax_t38_parameters</a> *dst, <span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="../../d5/def/structast__control__t38__parameters.html">ast_control_t38_parameters</a> *src)</div><div class="line"><a name="l00741"></a><span class="lineno">  741</span>&#160;{</div><div class="line"><a name="l00742"></a><span class="lineno">  742</span>&#160;   dst-&gt;<a class="code" href="../../d3/df6/structast__fax__t38__parameters.html#a5408ac5df4c170828874e1b10b4c35a0">version</a> = src-&gt;<a class="code" href="../../d5/def/structast__control__t38__parameters.html#a5408ac5df4c170828874e1b10b4c35a0">version</a>;</div><div class="line"><a name="l00743"></a><span class="lineno">  743</span>&#160;   dst-&gt;<a class="code" href="../../d3/df6/structast__fax__t38__parameters.html#a7924cc45cde640e779a902c4aadaf180">max_ifp</a> = src-&gt;<a class="code" href="../../d5/def/structast__control__t38__parameters.html#a7924cc45cde640e779a902c4aadaf180">max_ifp</a>;</div><div class="line"><a name="l00744"></a><span class="lineno">  744</span>&#160;   dst-&gt;<a class="code" href="../../d3/df6/structast__fax__t38__parameters.html#a124b43d7f331e00aad39c964ea523329">rate</a> = src-&gt;<a class="code" href="../../d5/def/structast__control__t38__parameters.html#a124b43d7f331e00aad39c964ea523329">rate</a>;</div><div class="line"><a name="l00745"></a><span class="lineno">  745</span>&#160;   dst-&gt;<a class="code" href="../../d3/df6/structast__fax__t38__parameters.html#ad39f48f545d7c8962dfa0ae83a61c21f">rate_management</a> = src-&gt;<a class="code" href="../../d5/def/structast__control__t38__parameters.html#ad39f48f545d7c8962dfa0ae83a61c21f">rate_management</a>;</div><div class="line"><a name="l00746"></a><span class="lineno">  746</span>&#160;   dst-&gt;<a class="code" href="../../d3/df6/structast__fax__t38__parameters.html#addb721c952a7144f0a6a9ac5f621d2bc">fill_bit_removal</a> = src-&gt;<a class="code" href="../../d5/def/structast__control__t38__parameters.html#addb721c952a7144f0a6a9ac5f621d2bc">fill_bit_removal</a>;</div><div class="line"><a name="l00747"></a><span class="lineno">  747</span>&#160;   dst-&gt;<a class="code" href="../../d3/df6/structast__fax__t38__parameters.html#ad2b3d53474db70e3ff2058da953b7b82">transcoding_mmr</a> = src-&gt;<a class="code" href="../../d5/def/structast__control__t38__parameters.html#ad2b3d53474db70e3ff2058da953b7b82">transcoding_mmr</a>;</div><div class="line"><a name="l00748"></a><span class="lineno">  748</span>&#160;   dst-&gt;<a class="code" href="../../d3/df6/structast__fax__t38__parameters.html#a07676322ec48c4872f9a208a6248d034">transcoding_jbig</a> = src-&gt;<a class="code" href="../../d5/def/structast__control__t38__parameters.html#a07676322ec48c4872f9a208a6248d034">transcoding_jbig</a>;</div><div class="line"><a name="l00749"></a><span class="lineno">  749</span>&#160;}</div><div class="line"><a name="l00750"></a><span class="lineno">  750</span>&#160;</div><div class="line"><a name="l00751"></a><span class="lineno"><a class="line" href="../../d0/d60/res__fax_8c.html#a624525cc48cff52d5ae4e5e50895e81e">  751</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d0/d60/res__fax_8c.html#a624525cc48cff52d5ae4e5e50895e81e">t38_parameters_fax_to_ast</a>(<span class="keyword">struct</span> <a class="code" href="../../d5/def/structast__control__t38__parameters.html">ast_control_t38_parameters</a> *dst, <span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="../../d3/df6/structast__fax__t38__parameters.html">ast_fax_t38_parameters</a> *src)</div><div class="line"><a name="l00752"></a><span class="lineno">  752</span>&#160;{</div><div class="line"><a name="l00753"></a><span class="lineno">  753</span>&#160;   dst-&gt;<a class="code" href="../../d5/def/structast__control__t38__parameters.html#a5408ac5df4c170828874e1b10b4c35a0">version</a> = src-&gt;<a class="code" href="../../d3/df6/structast__fax__t38__parameters.html#a5408ac5df4c170828874e1b10b4c35a0">version</a>;</div><div class="line"><a name="l00754"></a><span class="lineno">  754</span>&#160;   dst-&gt;<a class="code" href="../../d5/def/structast__control__t38__parameters.html#a7924cc45cde640e779a902c4aadaf180">max_ifp</a> = src-&gt;<a class="code" href="../../d3/df6/structast__fax__t38__parameters.html#a7924cc45cde640e779a902c4aadaf180">max_ifp</a>;</div><div class="line"><a name="l00755"></a><span class="lineno">  755</span>&#160;   dst-&gt;<a class="code" href="../../d5/def/structast__control__t38__parameters.html#a124b43d7f331e00aad39c964ea523329">rate</a> = src-&gt;<a class="code" href="../../d3/df6/structast__fax__t38__parameters.html#a124b43d7f331e00aad39c964ea523329">rate</a>;</div><div class="line"><a name="l00756"></a><span class="lineno">  756</span>&#160;   dst-&gt;<a class="code" href="../../d5/def/structast__control__t38__parameters.html#ad39f48f545d7c8962dfa0ae83a61c21f">rate_management</a> = src-&gt;<a class="code" href="../../d3/df6/structast__fax__t38__parameters.html#ad39f48f545d7c8962dfa0ae83a61c21f">rate_management</a>;</div><div class="line"><a name="l00757"></a><span class="lineno">  757</span>&#160;   dst-&gt;<a class="code" href="../../d5/def/structast__control__t38__parameters.html#addb721c952a7144f0a6a9ac5f621d2bc">fill_bit_removal</a> = src-&gt;<a class="code" href="../../d3/df6/structast__fax__t38__parameters.html#addb721c952a7144f0a6a9ac5f621d2bc">fill_bit_removal</a>;</div><div class="line"><a name="l00758"></a><span class="lineno">  758</span>&#160;   dst-&gt;<a class="code" href="../../d5/def/structast__control__t38__parameters.html#ad2b3d53474db70e3ff2058da953b7b82">transcoding_mmr</a> = src-&gt;<a class="code" href="../../d3/df6/structast__fax__t38__parameters.html#ad2b3d53474db70e3ff2058da953b7b82">transcoding_mmr</a>;</div><div class="line"><a name="l00759"></a><span class="lineno">  759</span>&#160;   dst-&gt;<a class="code" href="../../d5/def/structast__control__t38__parameters.html#a07676322ec48c4872f9a208a6248d034">transcoding_jbig</a> = src-&gt;<a class="code" href="../../d3/df6/structast__fax__t38__parameters.html#a07676322ec48c4872f9a208a6248d034">transcoding_jbig</a>;</div><div class="line"><a name="l00760"></a><span class="lineno">  760</span>&#160;}</div><div class="line"><a name="l00761"></a><span class="lineno">  761</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00762"></a><span class="lineno">  762</span>&#160;<span class="comment">/*! \brief returns a reference counted details structure from the channel&#39;s fax datastore.  If the datastore</span></div><div class="line"><a name="l00763"></a><span class="lineno">  763</span>&#160;<span class="comment"> * does not exist it will be created */</span></div><div class="line"><a name="l00764"></a><span class="lineno"><a class="line" href="../../d0/d60/res__fax_8c.html#ac4310e981e9db76dfc3e85c51f4c6e1e">  764</a></span>&#160;<span class="keyword">static</span> <span class="keyword">struct </span><a class="code" href="../../d8/dc2/structast__fax__session__details.html">ast_fax_session_details</a> *<a class="code" href="../../d0/d60/res__fax_8c.html#ac4310e981e9db76dfc3e85c51f4c6e1e">find_or_create_details</a>(<span class="keyword">struct</span> <a class="code" href="../../df/d3c/structast__channel.html">ast_channel</a> *chan)</div><div class="line"><a name="l00765"></a><span class="lineno">  765</span>&#160;{</div><div class="line"><a name="l00766"></a><span class="lineno">  766</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d8/dc2/structast__fax__session__details.html">ast_fax_session_details</a> *details;</div><div class="line"><a name="l00767"></a><span class="lineno">  767</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d4/d5d/structast__datastore.html">ast_datastore</a> *datastore;</div><div class="line"><a name="l00768"></a><span class="lineno">  768</span>&#160;</div><div class="line"><a name="l00769"></a><span class="lineno">  769</span>&#160;   <span class="keywordflow">if</span> ((details = <a class="code" href="../../d0/d60/res__fax_8c.html#aa42f3331d32fc2fd92010023c6100322">find_details</a>(chan))) {</div><div class="line"><a name="l00770"></a><span class="lineno">  770</span>&#160;      <span class="keywordflow">return</span> details;</div><div class="line"><a name="l00771"></a><span class="lineno">  771</span>&#160;   }</div><div class="line"><a name="l00772"></a><span class="lineno">  772</span>&#160;   <span class="comment">/* channel does not have one so we must create one */</span></div><div class="line"><a name="l00773"></a><span class="lineno">  773</span>&#160;   <span class="keywordflow">if</span> (!(details = <a class="code" href="../../d0/d60/res__fax_8c.html#a51a502192456037fec6aa542707fcfe4">session_details_new</a>())) {</div><div class="line"><a name="l00774"></a><span class="lineno">  774</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;channel &#39;%s&#39; can&#39;t get a FAX details structure for the datastore!\n&quot;</span>, <a class="code" href="../../d5/d7b/channel_8h.html#a7ca2fda13b129a55c251b56729de285b">ast_channel_name</a>(chan));</div><div class="line"><a name="l00775"></a><span class="lineno">  775</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l00776"></a><span class="lineno">  776</span>&#160;   }</div><div class="line"><a name="l00777"></a><span class="lineno">  777</span>&#160;   <span class="keywordflow">if</span> (!(datastore = <a class="code" href="../../d9/db6/datastore_8h.html#a666afb07fd77d50782cc10f83e029159">ast_datastore_alloc</a>(&amp;fax_datastore, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>))) {</div><div class="line"><a name="l00778"></a><span class="lineno">  778</span>&#160;      <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(details, -1);</div><div class="line"><a name="l00779"></a><span class="lineno">  779</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;channel &#39;%s&#39; can&#39;t get a datastore!\n&quot;</span>, <a class="code" href="../../d5/d7b/channel_8h.html#a7ca2fda13b129a55c251b56729de285b">ast_channel_name</a>(chan));</div><div class="line"><a name="l00780"></a><span class="lineno">  780</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l00781"></a><span class="lineno">  781</span>&#160;   }</div><div class="line"><a name="l00782"></a><span class="lineno">  782</span>&#160;   <span class="comment">/* add the datastore to the channel and increment the refcount */</span></div><div class="line"><a name="l00783"></a><span class="lineno">  783</span>&#160;   datastore-&gt;<a class="code" href="../../d4/d5d/structast__datastore.html#a735984d41155bc1032e09bece8f8d66d">data</a> = details;</div><div class="line"><a name="l00784"></a><span class="lineno">  784</span>&#160;</div><div class="line"><a name="l00785"></a><span class="lineno">  785</span>&#160;   <span class="comment">/* initialize default T.38 parameters */</span></div><div class="line"><a name="l00786"></a><span class="lineno">  786</span>&#160;   <a class="code" href="../../d0/d60/res__fax_8c.html#aa9ea5a83822d7365075730ddb8490d23">t38_parameters_ast_to_fax</a>(&amp;details-&gt;<a class="code" href="../../d8/dc2/structast__fax__session__details.html#a80632865b575d06f319ef95c42645b2c">our_t38_parameters</a>, &amp;our_t38_parameters);</div><div class="line"><a name="l00787"></a><span class="lineno">  787</span>&#160;   <a class="code" href="../../d0/d60/res__fax_8c.html#aa9ea5a83822d7365075730ddb8490d23">t38_parameters_ast_to_fax</a>(&amp;details-&gt;<a class="code" href="../../d8/dc2/structast__fax__session__details.html#a12cc2bfdcc88e94984d001cca6fefdc5">their_t38_parameters</a>, &amp;our_t38_parameters);</div><div class="line"><a name="l00788"></a><span class="lineno">  788</span>&#160;</div><div class="line"><a name="l00789"></a><span class="lineno">  789</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(details, 1);</div><div class="line"><a name="l00790"></a><span class="lineno">  790</span>&#160;   <a class="code" href="../../d5/d7b/channel_8h.html#a493bdebe876caafb8ee535853310364a">ast_channel_lock</a>(chan);</div><div class="line"><a name="l00791"></a><span class="lineno">  791</span>&#160;   <a class="code" href="../../d5/d7b/channel_8h.html#a1ed3e98d33d5587948a0e2ef67a81f52">ast_channel_datastore_add</a>(chan, datastore);</div><div class="line"><a name="l00792"></a><span class="lineno">  792</span>&#160;   <a class="code" href="../../d5/d7b/channel_8h.html#af476c537b29be3f29240489032f9db39">ast_channel_unlock</a>(chan);</div><div class="line"><a name="l00793"></a><span class="lineno">  793</span>&#160;   <span class="keywordflow">return</span> details;</div><div class="line"><a name="l00794"></a><span class="lineno">  794</span>&#160;}</div><div class="line"><a name="l00795"></a><span class="lineno">  795</span>&#160;</div><div class="line"><a name="l00796"></a><span class="lineno"><a class="line" href="../../d0/d60/res__fax_8c.html#aa0da952373da5653cfc4b62964aa6286">  796</a></span>&#160;<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="../../d0/d60/res__fax_8c.html#aa0da952373da5653cfc4b62964aa6286">ast_fax_maxrate</a>(<span class="keywordtype">void</span>)</div><div class="line"><a name="l00797"></a><span class="lineno">  797</span>&#160;{</div><div class="line"><a name="l00798"></a><span class="lineno">  798</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d0/d28/structfax__options.html">fax_options</a> options;</div><div class="line"><a name="l00799"></a><span class="lineno">  799</span>&#160;   <a class="code" href="../../d0/d60/res__fax_8c.html#aa4691aa21eb58ad524c6418d9f252b7d">get_general_options</a>(&amp;options);</div><div class="line"><a name="l00800"></a><span class="lineno">  800</span>&#160;</div><div class="line"><a name="l00801"></a><span class="lineno">  801</span>&#160;   <span class="keywordflow">return</span> options.<a class="code" href="../../d0/d28/structfax__options.html#a975b0a45868387d13867daeac314978a">maxrate</a>;</div><div class="line"><a name="l00802"></a><span class="lineno">  802</span>&#160;}</div><div class="line"><a name="l00803"></a><span class="lineno">  803</span>&#160;</div><div class="line"><a name="l00804"></a><span class="lineno"><a class="line" href="../../d0/d60/res__fax_8c.html#a137ec11e07e82ed4c27374909f9ac965">  804</a></span>&#160;<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="../../d0/d60/res__fax_8c.html#a137ec11e07e82ed4c27374909f9ac965">ast_fax_minrate</a>(<span class="keywordtype">void</span>)</div><div class="line"><a name="l00805"></a><span class="lineno">  805</span>&#160;{</div><div class="line"><a name="l00806"></a><span class="lineno">  806</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d0/d28/structfax__options.html">fax_options</a> options;</div><div class="line"><a name="l00807"></a><span class="lineno">  807</span>&#160;   <a class="code" href="../../d0/d60/res__fax_8c.html#aa4691aa21eb58ad524c6418d9f252b7d">get_general_options</a>(&amp;options);</div><div class="line"><a name="l00808"></a><span class="lineno">  808</span>&#160;</div><div class="line"><a name="l00809"></a><span class="lineno">  809</span>&#160;   <span class="keywordflow">return</span> options.<a class="code" href="../../d0/d28/structfax__options.html#a8bff16fb9ab2254b86636f6fac166a66">minrate</a>;</div><div class="line"><a name="l00810"></a><span class="lineno">  810</span>&#160;}</div><div class="line"><a name="l00811"></a><span class="lineno">  811</span>&#160;</div><div class="line"><a name="l00812"></a><span class="lineno"><a class="line" href="../../d0/d60/res__fax_8c.html#a1e8694b9fd8a3141f361235450a323ab">  812</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d0/d60/res__fax_8c.html#a1e8694b9fd8a3141f361235450a323ab">update_modem_bits</a>(<span class="keyword">enum</span> <a class="code" href="../../db/d6a/res__fax_8h.html#ab9287e81dc5d3047da0bcb1f6c89bd57">ast_fax_modems</a> *bits, <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="../../d4/d2f/syslog_8c.html#ac4f474c82e82cbb89ca7c36dd52be0ed">value</a>)</div><div class="line"><a name="l00813"></a><span class="lineno">  813</span>&#160;{</div><div class="line"><a name="l00814"></a><span class="lineno">  814</span>&#160;   <span class="keywordtype">char</span> *m[5], *tok, *v = (<span class="keywordtype">char</span> *) value, *rest;</div><div class="line"><a name="l00815"></a><span class="lineno">  815</span>&#160;   <span class="keywordtype">int</span> i = 0, j;</div><div class="line"><a name="l00816"></a><span class="lineno">  816</span>&#160;</div><div class="line"><a name="l00817"></a><span class="lineno">  817</span>&#160;   <span class="keywordflow">if</span> (!strchr(v, <span class="charliteral">&#39;,&#39;</span>)) {</div><div class="line"><a name="l00818"></a><span class="lineno">  818</span>&#160;      m[i++] = v;</div><div class="line"><a name="l00819"></a><span class="lineno">  819</span>&#160;      m[i] = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l00820"></a><span class="lineno">  820</span>&#160;   } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00821"></a><span class="lineno">  821</span>&#160;      tok = strtok_r(v, <span class="stringliteral">&quot;, &quot;</span>, &amp;rest);</div><div class="line"><a name="l00822"></a><span class="lineno">  822</span>&#160;      <span class="keywordflow">while</span> (tok &amp;&amp; i &lt; <a class="code" href="../../de/dfe/isdn__lib_8c.html#ab9129b977a587b50ea801daac75e178f">ARRAY_LEN</a>(m) - 1) {</div><div class="line"><a name="l00823"></a><span class="lineno">  823</span>&#160;         m[i++] = tok;</div><div class="line"><a name="l00824"></a><span class="lineno">  824</span>&#160;         tok = strtok_r(<a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <span class="stringliteral">&quot;, &quot;</span>, &amp;rest);</div><div class="line"><a name="l00825"></a><span class="lineno">  825</span>&#160;      }</div><div class="line"><a name="l00826"></a><span class="lineno">  826</span>&#160;      m[i] = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l00827"></a><span class="lineno">  827</span>&#160;   }</div><div class="line"><a name="l00828"></a><span class="lineno">  828</span>&#160;</div><div class="line"><a name="l00829"></a><span class="lineno">  829</span>&#160;   *bits = 0;</div><div class="line"><a name="l00830"></a><span class="lineno">  830</span>&#160;   <span class="keywordflow">for</span> (j = 0; j &lt; i; j++) {</div><div class="line"><a name="l00831"></a><span class="lineno">  831</span>&#160;      <span class="keywordflow">if</span> (!strcasecmp(m[j], <span class="stringliteral">&quot;v17&quot;</span>)) {</div><div class="line"><a name="l00832"></a><span class="lineno">  832</span>&#160;         *bits |= <a class="code" href="../../db/d6a/res__fax_8h.html#ab9287e81dc5d3047da0bcb1f6c89bd57a2faab4efa2a8027ed56a92cc758a7bb0">AST_FAX_MODEM_V17</a>;</div><div class="line"><a name="l00833"></a><span class="lineno">  833</span>&#160;      } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(m[j], <span class="stringliteral">&quot;v27&quot;</span>)) {</div><div class="line"><a name="l00834"></a><span class="lineno">  834</span>&#160;         *bits |= <a class="code" href="../../db/d6a/res__fax_8h.html#ab9287e81dc5d3047da0bcb1f6c89bd57ae3b2fd3e12f8b526273b642e0c0a342a">AST_FAX_MODEM_V27TER</a>;</div><div class="line"><a name="l00835"></a><span class="lineno">  835</span>&#160;      } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(m[j], <span class="stringliteral">&quot;v29&quot;</span>)) {</div><div class="line"><a name="l00836"></a><span class="lineno">  836</span>&#160;         *bits |= <a class="code" href="../../db/d6a/res__fax_8h.html#ab9287e81dc5d3047da0bcb1f6c89bd57a7f0a2c297f96556e6d4af522930d1ccc">AST_FAX_MODEM_V29</a>;</div><div class="line"><a name="l00837"></a><span class="lineno">  837</span>&#160;      } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(m[j], <span class="stringliteral">&quot;v34&quot;</span>)) {</div><div class="line"><a name="l00838"></a><span class="lineno">  838</span>&#160;         *bits |= <a class="code" href="../../db/d6a/res__fax_8h.html#ab9287e81dc5d3047da0bcb1f6c89bd57af68d38a189351562faca6609a162b5a6">AST_FAX_MODEM_V34</a>;</div><div class="line"><a name="l00839"></a><span class="lineno">  839</span>&#160;      } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00840"></a><span class="lineno">  840</span>&#160;         <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;ignoring invalid modem setting: &#39;%s&#39;, valid options {v17 | v27 | v29 | v34}\n&quot;</span>, m[j]);</div><div class="line"><a name="l00841"></a><span class="lineno">  841</span>&#160;      }</div><div class="line"><a name="l00842"></a><span class="lineno">  842</span>&#160;   }</div><div class="line"><a name="l00843"></a><span class="lineno">  843</span>&#160;   <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00844"></a><span class="lineno">  844</span>&#160;}</div><div class="line"><a name="l00845"></a><span class="lineno">  845</span>&#160;</div><div class="line"><a name="l00846"></a><span class="lineno"><a class="line" href="../../d0/d60/res__fax_8c.html#a40d89bb1e84698fe43b2813c44587cef">  846</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">char</span> *<a class="code" href="../../d0/d60/res__fax_8c.html#a40d89bb1e84698fe43b2813c44587cef">ast_fax_caps_to_str</a>(<span class="keyword">enum</span> <a class="code" href="../../db/d6a/res__fax_8h.html#a54eb45ad548b874cf12d0a599631e3f6">ast_fax_capabilities</a> caps, <span class="keywordtype">char</span> *<a class="code" href="../../dd/d7c/eagi__proxy_8c.html#ac95651d79c608a3148973b5b1fc9e525">buf</a>, <span class="keywordtype">size_t</span> bufsize)</div><div class="line"><a name="l00847"></a><span class="lineno">  847</span>&#160;{</div><div class="line"><a name="l00848"></a><span class="lineno">  848</span>&#160;   <span class="keywordtype">char</span> *<a class="code" href="../../d6/d47/utils_2frame_8c.html#a48bc11919b2752df9d14ce89557cfb25">out</a> = <a class="code" href="../../dd/d7c/eagi__proxy_8c.html#ac95651d79c608a3148973b5b1fc9e525">buf</a>;</div><div class="line"><a name="l00849"></a><span class="lineno">  849</span>&#160;   <span class="keywordtype">size_t</span> size = bufsize;</div><div class="line"><a name="l00850"></a><span class="lineno">  850</span>&#160;   <span class="keywordtype">int</span> <a class="code" href="../../df/d44/app__meetme_8c.html#a18b6f1cf748d864dd085819a7d4e6680">first</a> = 1;</div><div class="line"><a name="l00851"></a><span class="lineno">  851</span>&#160;</div><div class="line"><a name="l00852"></a><span class="lineno">  852</span>&#160;   <span class="keywordflow">if</span> (caps &amp; <a class="code" href="../../db/d6a/res__fax_8h.html#a54eb45ad548b874cf12d0a599631e3f6adbf07d8224b1a548ccae3b994653003b">AST_FAX_TECH_SEND</a>) {</div><div class="line"><a name="l00853"></a><span class="lineno">  853</span>&#160;      <span class="keywordflow">if</span> (!first) {</div><div class="line"><a name="l00854"></a><span class="lineno">  854</span>&#160;         <a class="code" href="../../d6/d90/strings_8h.html#a603020160399d4876ec09fd299ebcaf9">ast_build_string</a>(&amp;buf, &amp;size, <span class="stringliteral">&quot;,&quot;</span>);</div><div class="line"><a name="l00855"></a><span class="lineno">  855</span>&#160;      }</div><div class="line"><a name="l00856"></a><span class="lineno">  856</span>&#160;      <a class="code" href="../../d6/d90/strings_8h.html#a603020160399d4876ec09fd299ebcaf9">ast_build_string</a>(&amp;buf, &amp;size, <span class="stringliteral">&quot;SEND&quot;</span>);</div><div class="line"><a name="l00857"></a><span class="lineno">  857</span>&#160;      first = 0;</div><div class="line"><a name="l00858"></a><span class="lineno">  858</span>&#160;   }</div><div class="line"><a name="l00859"></a><span class="lineno">  859</span>&#160;   <span class="keywordflow">if</span> (caps &amp; <a class="code" href="../../db/d6a/res__fax_8h.html#a54eb45ad548b874cf12d0a599631e3f6a77bcc28b15614142ddbf4a180d263602">AST_FAX_TECH_RECEIVE</a>) {</div><div class="line"><a name="l00860"></a><span class="lineno">  860</span>&#160;      <span class="keywordflow">if</span> (!first) {</div><div class="line"><a name="l00861"></a><span class="lineno">  861</span>&#160;         <a class="code" href="../../d6/d90/strings_8h.html#a603020160399d4876ec09fd299ebcaf9">ast_build_string</a>(&amp;buf, &amp;size, <span class="stringliteral">&quot;,&quot;</span>);</div><div class="line"><a name="l00862"></a><span class="lineno">  862</span>&#160;      }</div><div class="line"><a name="l00863"></a><span class="lineno">  863</span>&#160;      <a class="code" href="../../d6/d90/strings_8h.html#a603020160399d4876ec09fd299ebcaf9">ast_build_string</a>(&amp;buf, &amp;size, <span class="stringliteral">&quot;RECEIVE&quot;</span>);</div><div class="line"><a name="l00864"></a><span class="lineno">  864</span>&#160;      first = 0;</div><div class="line"><a name="l00865"></a><span class="lineno">  865</span>&#160;   }</div><div class="line"><a name="l00866"></a><span class="lineno">  866</span>&#160;   <span class="keywordflow">if</span> (caps &amp; <a class="code" href="../../db/d6a/res__fax_8h.html#a54eb45ad548b874cf12d0a599631e3f6a76fa4111df51955a949e95fadbccd48b">AST_FAX_TECH_AUDIO</a>) {</div><div class="line"><a name="l00867"></a><span class="lineno">  867</span>&#160;      <span class="keywordflow">if</span> (!first) {</div><div class="line"><a name="l00868"></a><span class="lineno">  868</span>&#160;         <a class="code" href="../../d6/d90/strings_8h.html#a603020160399d4876ec09fd299ebcaf9">ast_build_string</a>(&amp;buf, &amp;size, <span class="stringliteral">&quot;,&quot;</span>);</div><div class="line"><a name="l00869"></a><span class="lineno">  869</span>&#160;      }</div><div class="line"><a name="l00870"></a><span class="lineno">  870</span>&#160;      <a class="code" href="../../d6/d90/strings_8h.html#a603020160399d4876ec09fd299ebcaf9">ast_build_string</a>(&amp;buf, &amp;size, <span class="stringliteral">&quot;AUDIO&quot;</span>);</div><div class="line"><a name="l00871"></a><span class="lineno">  871</span>&#160;      first = 0;</div><div class="line"><a name="l00872"></a><span class="lineno">  872</span>&#160;   }</div><div class="line"><a name="l00873"></a><span class="lineno">  873</span>&#160;   <span class="keywordflow">if</span> (caps &amp; <a class="code" href="../../db/d6a/res__fax_8h.html#a54eb45ad548b874cf12d0a599631e3f6a6868445e2802e5b71068ae883366f635">AST_FAX_TECH_T38</a>) {</div><div class="line"><a name="l00874"></a><span class="lineno">  874</span>&#160;      <span class="keywordflow">if</span> (!first) {</div><div class="line"><a name="l00875"></a><span class="lineno">  875</span>&#160;         <a class="code" href="../../d6/d90/strings_8h.html#a603020160399d4876ec09fd299ebcaf9">ast_build_string</a>(&amp;buf, &amp;size, <span class="stringliteral">&quot;,&quot;</span>);</div><div class="line"><a name="l00876"></a><span class="lineno">  876</span>&#160;      }</div><div class="line"><a name="l00877"></a><span class="lineno">  877</span>&#160;      <a class="code" href="../../d6/d90/strings_8h.html#a603020160399d4876ec09fd299ebcaf9">ast_build_string</a>(&amp;buf, &amp;size, <span class="stringliteral">&quot;T38&quot;</span>);</div><div class="line"><a name="l00878"></a><span class="lineno">  878</span>&#160;      first = 0;</div><div class="line"><a name="l00879"></a><span class="lineno">  879</span>&#160;   }</div><div class="line"><a name="l00880"></a><span class="lineno">  880</span>&#160;   <span class="keywordflow">if</span> (caps &amp; <a class="code" href="../../db/d6a/res__fax_8h.html#a54eb45ad548b874cf12d0a599631e3f6a9f71e042b26b9d7b671a3771bef6db64">AST_FAX_TECH_MULTI_DOC</a>) {</div><div class="line"><a name="l00881"></a><span class="lineno">  881</span>&#160;      <span class="keywordflow">if</span> (!first) {</div><div class="line"><a name="l00882"></a><span class="lineno">  882</span>&#160;         <a class="code" href="../../d6/d90/strings_8h.html#a603020160399d4876ec09fd299ebcaf9">ast_build_string</a>(&amp;buf, &amp;size, <span class="stringliteral">&quot;,&quot;</span>);</div><div class="line"><a name="l00883"></a><span class="lineno">  883</span>&#160;      }</div><div class="line"><a name="l00884"></a><span class="lineno">  884</span>&#160;      <a class="code" href="../../d6/d90/strings_8h.html#a603020160399d4876ec09fd299ebcaf9">ast_build_string</a>(&amp;buf, &amp;size, <span class="stringliteral">&quot;MULTI_DOC&quot;</span>);</div><div class="line"><a name="l00885"></a><span class="lineno">  885</span>&#160;      first = 0;</div><div class="line"><a name="l00886"></a><span class="lineno">  886</span>&#160;   }</div><div class="line"><a name="l00887"></a><span class="lineno">  887</span>&#160;   <span class="keywordflow">if</span> (caps &amp; <a class="code" href="../../db/d6a/res__fax_8h.html#a54eb45ad548b874cf12d0a599631e3f6add135550dca7400fb80e250a63a54887">AST_FAX_TECH_GATEWAY</a>) {</div><div class="line"><a name="l00888"></a><span class="lineno">  888</span>&#160;      <span class="keywordflow">if</span> (!first) {</div><div class="line"><a name="l00889"></a><span class="lineno">  889</span>&#160;         <a class="code" href="../../d6/d90/strings_8h.html#a603020160399d4876ec09fd299ebcaf9">ast_build_string</a>(&amp;buf, &amp;size, <span class="stringliteral">&quot;,&quot;</span>);</div><div class="line"><a name="l00890"></a><span class="lineno">  890</span>&#160;      }</div><div class="line"><a name="l00891"></a><span class="lineno">  891</span>&#160;      <a class="code" href="../../d6/d90/strings_8h.html#a603020160399d4876ec09fd299ebcaf9">ast_build_string</a>(&amp;buf, &amp;size, <span class="stringliteral">&quot;GATEWAY&quot;</span>);</div><div class="line"><a name="l00892"></a><span class="lineno">  892</span>&#160;      first = 0;</div><div class="line"><a name="l00893"></a><span class="lineno">  893</span>&#160;   }</div><div class="line"><a name="l00894"></a><span class="lineno">  894</span>&#160;   <span class="keywordflow">if</span> (caps &amp; <a class="code" href="../../db/d6a/res__fax_8h.html#a54eb45ad548b874cf12d0a599631e3f6a9138c48a79016bfccdd7cee6197cb21c">AST_FAX_TECH_V21_DETECT</a>) {</div><div class="line"><a name="l00895"></a><span class="lineno">  895</span>&#160;      <span class="keywordflow">if</span> (!first) {</div><div class="line"><a name="l00896"></a><span class="lineno">  896</span>&#160;         <a class="code" href="../../d6/d90/strings_8h.html#a603020160399d4876ec09fd299ebcaf9">ast_build_string</a>(&amp;buf, &amp;size, <span class="stringliteral">&quot;,&quot;</span>);</div><div class="line"><a name="l00897"></a><span class="lineno">  897</span>&#160;      }</div><div class="line"><a name="l00898"></a><span class="lineno">  898</span>&#160;      <a class="code" href="../../d6/d90/strings_8h.html#a603020160399d4876ec09fd299ebcaf9">ast_build_string</a>(&amp;buf, &amp;size, <span class="stringliteral">&quot;V21&quot;</span>);</div><div class="line"><a name="l00899"></a><span class="lineno">  899</span>&#160;      first = 0;</div><div class="line"><a name="l00900"></a><span class="lineno">  900</span>&#160;   }</div><div class="line"><a name="l00901"></a><span class="lineno">  901</span>&#160;</div><div class="line"><a name="l00902"></a><span class="lineno">  902</span>&#160;   <span class="keywordflow">return</span> <a class="code" href="../../d6/d47/utils_2frame_8c.html#a48bc11919b2752df9d14ce89557cfb25">out</a>;</div><div class="line"><a name="l00903"></a><span class="lineno">  903</span>&#160;}</div><div class="line"><a name="l00904"></a><span class="lineno">  904</span>&#160;</div><div class="line"><a name="l00905"></a><span class="lineno"><a class="line" href="../../d0/d60/res__fax_8c.html#a9310358a6223a275dce64548ab625062">  905</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d0/d60/res__fax_8c.html#a9310358a6223a275dce64548ab625062">ast_fax_modem_to_str</a>(<span class="keyword">enum</span> <a class="code" href="../../db/d6a/res__fax_8h.html#ab9287e81dc5d3047da0bcb1f6c89bd57">ast_fax_modems</a> bits, <span class="keywordtype">char</span> *tbuf, <span class="keywordtype">size_t</span> bufsize)</div><div class="line"><a name="l00906"></a><span class="lineno">  906</span>&#160;{</div><div class="line"><a name="l00907"></a><span class="lineno">  907</span>&#160;   <span class="keywordtype">int</span> count = 0;</div><div class="line"><a name="l00908"></a><span class="lineno">  908</span>&#160;</div><div class="line"><a name="l00909"></a><span class="lineno">  909</span>&#160;   <span class="keywordflow">if</span> (bits &amp; <a class="code" href="../../db/d6a/res__fax_8h.html#ab9287e81dc5d3047da0bcb1f6c89bd57a2faab4efa2a8027ed56a92cc758a7bb0">AST_FAX_MODEM_V17</a>) {</div><div class="line"><a name="l00910"></a><span class="lineno">  910</span>&#160;      strcat(tbuf, <span class="stringliteral">&quot;V17&quot;</span>);</div><div class="line"><a name="l00911"></a><span class="lineno">  911</span>&#160;      count++;</div><div class="line"><a name="l00912"></a><span class="lineno">  912</span>&#160;   }</div><div class="line"><a name="l00913"></a><span class="lineno">  913</span>&#160;   <span class="keywordflow">if</span> (bits &amp; <a class="code" href="../../db/d6a/res__fax_8h.html#ab9287e81dc5d3047da0bcb1f6c89bd57ae3b2fd3e12f8b526273b642e0c0a342a">AST_FAX_MODEM_V27TER</a>) {</div><div class="line"><a name="l00914"></a><span class="lineno">  914</span>&#160;      <span class="keywordflow">if</span> (count) {</div><div class="line"><a name="l00915"></a><span class="lineno">  915</span>&#160;         strcat(tbuf, <span class="stringliteral">&quot;,&quot;</span>);</div><div class="line"><a name="l00916"></a><span class="lineno">  916</span>&#160;      }</div><div class="line"><a name="l00917"></a><span class="lineno">  917</span>&#160;      strcat(tbuf, <span class="stringliteral">&quot;V27&quot;</span>);</div><div class="line"><a name="l00918"></a><span class="lineno">  918</span>&#160;      count++;</div><div class="line"><a name="l00919"></a><span class="lineno">  919</span>&#160;   }</div><div class="line"><a name="l00920"></a><span class="lineno">  920</span>&#160;   <span class="keywordflow">if</span> (bits &amp; <a class="code" href="../../db/d6a/res__fax_8h.html#ab9287e81dc5d3047da0bcb1f6c89bd57a7f0a2c297f96556e6d4af522930d1ccc">AST_FAX_MODEM_V29</a>) {</div><div class="line"><a name="l00921"></a><span class="lineno">  921</span>&#160;      <span class="keywordflow">if</span> (count) {</div><div class="line"><a name="l00922"></a><span class="lineno">  922</span>&#160;         strcat(tbuf, <span class="stringliteral">&quot;,&quot;</span>);</div><div class="line"><a name="l00923"></a><span class="lineno">  923</span>&#160;      }</div><div class="line"><a name="l00924"></a><span class="lineno">  924</span>&#160;      strcat(tbuf, <span class="stringliteral">&quot;V29&quot;</span>);</div><div class="line"><a name="l00925"></a><span class="lineno">  925</span>&#160;      count++;</div><div class="line"><a name="l00926"></a><span class="lineno">  926</span>&#160;   }</div><div class="line"><a name="l00927"></a><span class="lineno">  927</span>&#160;   <span class="keywordflow">if</span> (bits &amp; <a class="code" href="../../db/d6a/res__fax_8h.html#ab9287e81dc5d3047da0bcb1f6c89bd57af68d38a189351562faca6609a162b5a6">AST_FAX_MODEM_V34</a>) {</div><div class="line"><a name="l00928"></a><span class="lineno">  928</span>&#160;      <span class="keywordflow">if</span> (count) {</div><div class="line"><a name="l00929"></a><span class="lineno">  929</span>&#160;         strcat(tbuf, <span class="stringliteral">&quot;,&quot;</span>);</div><div class="line"><a name="l00930"></a><span class="lineno">  930</span>&#160;      }</div><div class="line"><a name="l00931"></a><span class="lineno">  931</span>&#160;      strcat(tbuf, <span class="stringliteral">&quot;V34&quot;</span>);</div><div class="line"><a name="l00932"></a><span class="lineno">  932</span>&#160;      count++;</div><div class="line"><a name="l00933"></a><span class="lineno">  933</span>&#160;   }</div><div class="line"><a name="l00934"></a><span class="lineno">  934</span>&#160;</div><div class="line"><a name="l00935"></a><span class="lineno">  935</span>&#160;   <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00936"></a><span class="lineno">  936</span>&#160;}</div><div class="line"><a name="l00937"></a><span class="lineno">  937</span>&#160;</div><div class="line"><a name="l00938"></a><span class="lineno"><a class="line" href="../../d0/d60/res__fax_8c.html#a693b0f3ff5d9020fe797cdc46e9489d4">  938</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d0/d60/res__fax_8c.html#a693b0f3ff5d9020fe797cdc46e9489d4">check_modem_rate</a>(<span class="keyword">enum</span> <a class="code" href="../../db/d6a/res__fax_8h.html#ab9287e81dc5d3047da0bcb1f6c89bd57">ast_fax_modems</a> <a class="code" href="../../d0/d28/structfax__options.html#a38b557eee45ee4c0d92d514c04823f84">modems</a>, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> rate)</div><div class="line"><a name="l00939"></a><span class="lineno">  939</span>&#160;{</div><div class="line"><a name="l00940"></a><span class="lineno">  940</span>&#160;   <span class="keywordflow">switch</span> (rate) {</div><div class="line"><a name="l00941"></a><span class="lineno">  941</span>&#160;   <span class="keywordflow">case</span> 2400:</div><div class="line"><a name="l00942"></a><span class="lineno">  942</span>&#160;   <span class="keywordflow">case</span> 4800:</div><div class="line"><a name="l00943"></a><span class="lineno">  943</span>&#160;      <span class="keywordflow">if</span> (!(modems &amp; (<a class="code" href="../../db/d6a/res__fax_8h.html#ab9287e81dc5d3047da0bcb1f6c89bd57ae3b2fd3e12f8b526273b642e0c0a342a">AST_FAX_MODEM_V27TER</a> | <a class="code" href="../../db/d6a/res__fax_8h.html#ab9287e81dc5d3047da0bcb1f6c89bd57af68d38a189351562faca6609a162b5a6">AST_FAX_MODEM_V34</a>))) {</div><div class="line"><a name="l00944"></a><span class="lineno">  944</span>&#160;         <span class="keywordflow">return</span> 1;</div><div class="line"><a name="l00945"></a><span class="lineno">  945</span>&#160;      }</div><div class="line"><a name="l00946"></a><span class="lineno">  946</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00947"></a><span class="lineno">  947</span>&#160;   <span class="keywordflow">case</span> 7200:</div><div class="line"><a name="l00948"></a><span class="lineno">  948</span>&#160;   <span class="keywordflow">case</span> 9600:</div><div class="line"><a name="l00949"></a><span class="lineno">  949</span>&#160;      <span class="keywordflow">if</span> (!(modems &amp; (<a class="code" href="../../db/d6a/res__fax_8h.html#ab9287e81dc5d3047da0bcb1f6c89bd57a2faab4efa2a8027ed56a92cc758a7bb0">AST_FAX_MODEM_V17</a> | <a class="code" href="../../db/d6a/res__fax_8h.html#ab9287e81dc5d3047da0bcb1f6c89bd57a7f0a2c297f96556e6d4af522930d1ccc">AST_FAX_MODEM_V29</a> | <a class="code" href="../../db/d6a/res__fax_8h.html#ab9287e81dc5d3047da0bcb1f6c89bd57af68d38a189351562faca6609a162b5a6">AST_FAX_MODEM_V34</a>))) {</div><div class="line"><a name="l00950"></a><span class="lineno">  950</span>&#160;         <span class="keywordflow">return</span> 1;</div><div class="line"><a name="l00951"></a><span class="lineno">  951</span>&#160;      }</div><div class="line"><a name="l00952"></a><span class="lineno">  952</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00953"></a><span class="lineno">  953</span>&#160;   <span class="keywordflow">case</span> 12000:</div><div class="line"><a name="l00954"></a><span class="lineno">  954</span>&#160;   <span class="keywordflow">case</span> 14400:</div><div class="line"><a name="l00955"></a><span class="lineno">  955</span>&#160;      <span class="keywordflow">if</span> (!(modems &amp; (<a class="code" href="../../db/d6a/res__fax_8h.html#ab9287e81dc5d3047da0bcb1f6c89bd57a2faab4efa2a8027ed56a92cc758a7bb0">AST_FAX_MODEM_V17</a> | <a class="code" href="../../db/d6a/res__fax_8h.html#ab9287e81dc5d3047da0bcb1f6c89bd57af68d38a189351562faca6609a162b5a6">AST_FAX_MODEM_V34</a>))) {</div><div class="line"><a name="l00956"></a><span class="lineno">  956</span>&#160;         <span class="keywordflow">return</span> 1;</div><div class="line"><a name="l00957"></a><span class="lineno">  957</span>&#160;      }</div><div class="line"><a name="l00958"></a><span class="lineno">  958</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00959"></a><span class="lineno">  959</span>&#160;   <span class="keywordflow">case</span> 28800:</div><div class="line"><a name="l00960"></a><span class="lineno">  960</span>&#160;   <span class="keywordflow">case</span> 33600:</div><div class="line"><a name="l00961"></a><span class="lineno">  961</span>&#160;      <span class="keywordflow">if</span> (!(modems &amp; <a class="code" href="../../db/d6a/res__fax_8h.html#ab9287e81dc5d3047da0bcb1f6c89bd57af68d38a189351562faca6609a162b5a6">AST_FAX_MODEM_V34</a>)) {</div><div class="line"><a name="l00962"></a><span class="lineno">  962</span>&#160;         <span class="keywordflow">return</span> 1;</div><div class="line"><a name="l00963"></a><span class="lineno">  963</span>&#160;      }</div><div class="line"><a name="l00964"></a><span class="lineno">  964</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00965"></a><span class="lineno">  965</span>&#160;   <span class="keywordflow">default</span>:</div><div class="line"><a name="l00966"></a><span class="lineno">  966</span>&#160;      <span class="comment">/* this should never happen */</span></div><div class="line"><a name="l00967"></a><span class="lineno">  967</span>&#160;      <span class="keywordflow">return</span> 1;</div><div class="line"><a name="l00968"></a><span class="lineno">  968</span>&#160;   }</div><div class="line"><a name="l00969"></a><span class="lineno">  969</span>&#160;</div><div class="line"><a name="l00970"></a><span class="lineno">  970</span>&#160;   <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00971"></a><span class="lineno">  971</span>&#160;}</div><div class="line"><a name="l00972"></a><span class="lineno">  972</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00973"></a><span class="lineno">  973</span>&#160;<span class="comment">/*! \brief register a FAX technology module */</span></div><div class="line"><a name="l00974"></a><span class="lineno"><a class="line" href="../../d0/d60/res__fax_8c.html#aa1e6a64120757501a2e6a1a076e070ff">  974</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="../../d0/d60/res__fax_8c.html#aa1e6a64120757501a2e6a1a076e070ff">ast_fax_tech_register</a>(<span class="keyword">struct</span> <a class="code" href="../../d9/d0e/structast__fax__tech.html">ast_fax_tech</a> *tech)</div><div class="line"><a name="l00975"></a><span class="lineno">  975</span>&#160;{</div><div class="line"><a name="l00976"></a><span class="lineno">  976</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d9/d07/structfax__module.html">fax_module</a> *fax;</div><div class="line"><a name="l00977"></a><span class="lineno">  977</span>&#160;</div><div class="line"><a name="l00978"></a><span class="lineno">  978</span>&#160;   <span class="keywordflow">if</span> (!(fax = <a class="code" href="../../d8/d8a/astmm_8h.html#ae0cd4c5524b01287ab19cbe233d9cebb">ast_calloc</a>(1, <span class="keyword">sizeof</span>(*fax)))) {</div><div class="line"><a name="l00979"></a><span class="lineno">  979</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l00980"></a><span class="lineno">  980</span>&#160;   }</div><div class="line"><a name="l00981"></a><span class="lineno">  981</span>&#160;   fax-&gt;<a class="code" href="../../d9/d07/structfax__module.html#a4ac6ff3775e67c710cd55bc7dfd592fe">tech</a> = <a class="code" href="../../d9/d07/structfax__module.html#a4ac6ff3775e67c710cd55bc7dfd592fe">tech</a>;</div><div class="line"><a name="l00982"></a><span class="lineno">  982</span>&#160;   <a class="code" href="../../df/d90/linkedlists_8h.html#a2d0cf4182bade9f773fb16ff12abe595">AST_RWLIST_WRLOCK</a>(&amp;<a class="code" href="../../df/d07/structfaxmodules.html">faxmodules</a>);</div><div class="line"><a name="l00983"></a><span class="lineno">  983</span>&#160;   <a class="code" href="../../df/d90/linkedlists_8h.html#aadda916488b2d151af4426e2f06ad332">AST_RWLIST_INSERT_TAIL</a>(&amp;<a class="code" href="../../df/d07/structfaxmodules.html">faxmodules</a>, fax, list);</div><div class="line"><a name="l00984"></a><span class="lineno">  984</span>&#160;   <a class="code" href="../../df/d90/linkedlists_8h.html#a2e9a2518b5029b96671aff6701bd5138">AST_RWLIST_UNLOCK</a>(&amp;<a class="code" href="../../df/d07/structfaxmodules.html">faxmodules</a>);</div><div class="line"><a name="l00985"></a><span class="lineno">  985</span>&#160;</div><div class="line"><a name="l00986"></a><span class="lineno">  986</span>&#160;   <a class="code" href="../../d1/d8c/logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(3, <span class="stringliteral">&quot;Registered handler for &#39;%s&#39; (%s)\n&quot;</span>, fax-&gt;<a class="code" href="../../d9/d07/structfax__module.html#a4ac6ff3775e67c710cd55bc7dfd592fe">tech</a>-&gt;<a class="code" href="../../d9/d0e/structast__fax__tech.html#a8ff938fb2f815be425fd2859a21e6d61">type</a>, fax-&gt;<a class="code" href="../../d9/d07/structfax__module.html#a4ac6ff3775e67c710cd55bc7dfd592fe">tech</a>-&gt;<a class="code" href="../../d9/d0e/structast__fax__tech.html#ac57ec035c076b222b9420a68ddab3bf1">description</a>);</div><div class="line"><a name="l00987"></a><span class="lineno">  987</span>&#160;</div><div class="line"><a name="l00988"></a><span class="lineno">  988</span>&#160;   <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00989"></a><span class="lineno">  989</span>&#160;}</div><div class="line"><a name="l00990"></a><span class="lineno">  990</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00991"></a><span class="lineno">  991</span>&#160;<span class="comment">/*! \brief unregister a FAX technology module */</span></div><div class="line"><a name="l00992"></a><span class="lineno"><a class="line" href="../../d0/d60/res__fax_8c.html#a0212d23b36bd4b0777c0002ef6758bd9">  992</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../d0/d60/res__fax_8c.html#a0212d23b36bd4b0777c0002ef6758bd9">ast_fax_tech_unregister</a>(<span class="keyword">struct</span> <a class="code" href="../../d9/d0e/structast__fax__tech.html">ast_fax_tech</a> *<a class="code" href="../../d9/d07/structfax__module.html#a4ac6ff3775e67c710cd55bc7dfd592fe">tech</a>)</div><div class="line"><a name="l00993"></a><span class="lineno">  993</span>&#160;{</div><div class="line"><a name="l00994"></a><span class="lineno">  994</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d9/d07/structfax__module.html">fax_module</a> *fax;</div><div class="line"><a name="l00995"></a><span class="lineno">  995</span>&#160;</div><div class="line"><a name="l00996"></a><span class="lineno">  996</span>&#160;   <a class="code" href="../../d1/d8c/logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(3, <span class="stringliteral">&quot;Unregistering FAX module type &#39;%s&#39;\n&quot;</span>, tech-&gt;<a class="code" href="../../d9/d0e/structast__fax__tech.html#a8ff938fb2f815be425fd2859a21e6d61">type</a>);</div><div class="line"><a name="l00997"></a><span class="lineno">  997</span>&#160;</div><div class="line"><a name="l00998"></a><span class="lineno">  998</span>&#160;   <a class="code" href="../../df/d90/linkedlists_8h.html#a2d0cf4182bade9f773fb16ff12abe595">AST_RWLIST_WRLOCK</a>(&amp;<a class="code" href="../../df/d07/structfaxmodules.html">faxmodules</a>);</div><div class="line"><a name="l00999"></a><span class="lineno">  999</span>&#160;   <a class="code" href="../../df/d90/linkedlists_8h.html#a21be6da4b2146b04b4868c2be5cae750">AST_RWLIST_TRAVERSE_SAFE_BEGIN</a>(&amp;<a class="code" href="../../df/d07/structfaxmodules.html">faxmodules</a>, fax, list) {</div><div class="line"><a name="l01000"></a><span class="lineno"> 1000</span>&#160;      <span class="keywordflow">if</span> (fax-&gt;<a class="code" href="../../d9/d07/structfax__module.html#a4ac6ff3775e67c710cd55bc7dfd592fe">tech</a> != tech) {</div><div class="line"><a name="l01001"></a><span class="lineno"> 1001</span>&#160;         <span class="keywordflow">continue</span>;</div><div class="line"><a name="l01002"></a><span class="lineno"> 1002</span>&#160;      }</div><div class="line"><a name="l01003"></a><span class="lineno"> 1003</span>&#160;      <a class="code" href="../../df/d90/linkedlists_8h.html#a02212548652c9eb0f3db38dc4e4bd285">AST_RWLIST_REMOVE_CURRENT</a>(list);</div><div class="line"><a name="l01004"></a><span class="lineno"> 1004</span>&#160;      <a class="code" href="../../d8/d8a/astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(fax);</div><div class="line"><a name="l01005"></a><span class="lineno"> 1005</span>&#160;      <a class="code" href="../../d1/d8c/logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(4, <span class="stringliteral">&quot;Unregistered FAX module type &#39;%s&#39;\n&quot;</span>, tech-&gt;<a class="code" href="../../d9/d0e/structast__fax__tech.html#a8ff938fb2f815be425fd2859a21e6d61">type</a>);</div><div class="line"><a name="l01006"></a><span class="lineno"> 1006</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l01007"></a><span class="lineno"> 1007</span>&#160;   }</div><div class="line"><a name="l01008"></a><span class="lineno"> 1008</span>&#160;   <a class="code" href="../../df/d90/linkedlists_8h.html#a6bf0e81cb6ef01532ddebaba68f6de28">AST_RWLIST_TRAVERSE_SAFE_END</a>;</div><div class="line"><a name="l01009"></a><span class="lineno"> 1009</span>&#160;   <a class="code" href="../../df/d90/linkedlists_8h.html#a2e9a2518b5029b96671aff6701bd5138">AST_RWLIST_UNLOCK</a>(&amp;<a class="code" href="../../df/d07/structfaxmodules.html">faxmodules</a>);</div><div class="line"><a name="l01010"></a><span class="lineno"> 1010</span>&#160;}</div><div class="line"><a name="l01011"></a><span class="lineno"> 1011</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01012"></a><span class="lineno"> 1012</span>&#160;<span class="comment">/*! \brief convert a ast_fax_state to a string */</span></div><div class="line"><a name="l01013"></a><span class="lineno"><a class="line" href="../../d0/d60/res__fax_8c.html#a70598462f8d1c09bb43e7a7091498e53"> 1013</a></span>&#160;<span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="../../d0/d60/res__fax_8c.html#a70598462f8d1c09bb43e7a7091498e53">ast_fax_state_to_str</a>(<span class="keyword">enum</span> <a class="code" href="../../db/d6a/res__fax_8h.html#ab34810136037068a0847bcca2518112c">ast_fax_state</a> <a class="code" href="../../d4/d88/structstate.html">state</a>)</div><div class="line"><a name="l01014"></a><span class="lineno"> 1014</span>&#160;{</div><div class="line"><a name="l01015"></a><span class="lineno"> 1015</span>&#160;   <span class="keywordflow">switch</span> (state) {</div><div class="line"><a name="l01016"></a><span class="lineno"> 1016</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="../../db/d6a/res__fax_8h.html#ab34810136037068a0847bcca2518112cad2e2632aa1b6333fcd0e89c554d0df54">AST_FAX_STATE_UNINITIALIZED</a>:</div><div class="line"><a name="l01017"></a><span class="lineno"> 1017</span>&#160;      <span class="keywordflow">return</span> <span class="stringliteral">&quot;Uninitialized&quot;</span>;</div><div class="line"><a name="l01018"></a><span class="lineno"> 1018</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="../../db/d6a/res__fax_8h.html#ab34810136037068a0847bcca2518112ca11037f2ac950e3e5281b419aef13e3dc">AST_FAX_STATE_INITIALIZED</a>:</div><div class="line"><a name="l01019"></a><span class="lineno"> 1019</span>&#160;      <span class="keywordflow">return</span> <span class="stringliteral">&quot;Initialized&quot;</span>;</div><div class="line"><a name="l01020"></a><span class="lineno"> 1020</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="../../db/d6a/res__fax_8h.html#ab34810136037068a0847bcca2518112cad0225f93f7c72e6071a0e2c459ec213c">AST_FAX_STATE_OPEN</a>:</div><div class="line"><a name="l01021"></a><span class="lineno"> 1021</span>&#160;      <span class="keywordflow">return</span> <span class="stringliteral">&quot;Open&quot;</span>;</div><div class="line"><a name="l01022"></a><span class="lineno"> 1022</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="../../db/d6a/res__fax_8h.html#ab34810136037068a0847bcca2518112ca59afc86be1c4be9a01c3cd178c4337b2">AST_FAX_STATE_ACTIVE</a>:</div><div class="line"><a name="l01023"></a><span class="lineno"> 1023</span>&#160;      <span class="keywordflow">return</span> <span class="stringliteral">&quot;Active&quot;</span>;</div><div class="line"><a name="l01024"></a><span class="lineno"> 1024</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="../../db/d6a/res__fax_8h.html#ab34810136037068a0847bcca2518112ca89690cf17e4dd810bc40e657ac1d6213">AST_FAX_STATE_COMPLETE</a>:</div><div class="line"><a name="l01025"></a><span class="lineno"> 1025</span>&#160;      <span class="keywordflow">return</span> <span class="stringliteral">&quot;Complete&quot;</span>;</div><div class="line"><a name="l01026"></a><span class="lineno"> 1026</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="../../db/d6a/res__fax_8h.html#ab34810136037068a0847bcca2518112cae3dc111580a7a9ef050b638a3da10790">AST_FAX_STATE_RESERVED</a>:</div><div class="line"><a name="l01027"></a><span class="lineno"> 1027</span>&#160;      <span class="keywordflow">return</span> <span class="stringliteral">&quot;Reserved&quot;</span>;</div><div class="line"><a name="l01028"></a><span class="lineno"> 1028</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="../../db/d6a/res__fax_8h.html#ab34810136037068a0847bcca2518112ca522d0463615626bcc42a3dd5716651dd">AST_FAX_STATE_INACTIVE</a>:</div><div class="line"><a name="l01029"></a><span class="lineno"> 1029</span>&#160;      <span class="keywordflow">return</span> <span class="stringliteral">&quot;Inactive&quot;</span>;</div><div class="line"><a name="l01030"></a><span class="lineno"> 1030</span>&#160;   <span class="keywordflow">default</span>:</div><div class="line"><a name="l01031"></a><span class="lineno"> 1031</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;unhandled FAX state: %u\n&quot;</span>, state);</div><div class="line"><a name="l01032"></a><span class="lineno"> 1032</span>&#160;      <span class="keywordflow">return</span> <span class="stringliteral">&quot;Unknown&quot;</span>;</div><div class="line"><a name="l01033"></a><span class="lineno"> 1033</span>&#160;   }</div><div class="line"><a name="l01034"></a><span class="lineno"> 1034</span>&#160;}</div><div class="line"><a name="l01035"></a><span class="lineno"> 1035</span>&#160;</div><div class="line"><a name="l01036"></a><span class="lineno"><a class="line" href="../../d0/d60/res__fax_8c.html#abb5f973c1052179a51f936be5c43a852"> 1036</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../d0/d60/res__fax_8c.html#abb5f973c1052179a51f936be5c43a852">ast_fax_log</a>(<span class="keywordtype">int</span> level, <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="../../d2/dc8/namespacemake__ari__stubs.html#a40a5d58ffa6e88aa578d6683ac413105">file</a>, <span class="keyword">const</span> <span class="keywordtype">int</span> line, <span class="keyword">const</span> <span class="keywordtype">char</span> *<span class="keyword">function</span>, <span class="keyword">const</span> <span class="keywordtype">char</span> *msg)</div><div class="line"><a name="l01037"></a><span class="lineno"> 1037</span>&#160;{</div><div class="line"><a name="l01038"></a><span class="lineno"> 1038</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d0/d60/res__fax_8c.html#a3e8bec5eeb0e707450d6dab929fe3436">fax_logger_level</a> != -1) {</div><div class="line"><a name="l01039"></a><span class="lineno"> 1039</span>&#160;      <a class="code" href="../../d1/d8c/logger_8h.html#aa27e6ab6364e8aea74c77f858ccd231e">ast_log_dynamic_level</a>(<a class="code" href="../../d0/d60/res__fax_8c.html#a3e8bec5eeb0e707450d6dab929fe3436">fax_logger_level</a>, <span class="stringliteral">&quot;%s&quot;</span>, msg);</div><div class="line"><a name="l01040"></a><span class="lineno"> 1040</span>&#160;   } <span class="keywordflow">else</span> {</div><div class="line"><a name="l01041"></a><span class="lineno"> 1041</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(level, file, line, <span class="keyword">function</span>, <span class="stringliteral">&quot;%s&quot;</span>, msg);</div><div class="line"><a name="l01042"></a><span class="lineno"> 1042</span>&#160;   }</div><div class="line"><a name="l01043"></a><span class="lineno"> 1043</span>&#160;}</div><div class="line"><a name="l01044"></a><span class="lineno"> 1044</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01045"></a><span class="lineno"> 1045</span>&#160;<span class="comment">/*! \brief convert a rate string to a rate */</span></div><div class="line"><a name="l01046"></a><span class="lineno"><a class="line" href="../../d0/d60/res__fax_8c.html#aca0e59fc667e8d921853204d2b511d98"> 1046</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="../../d0/d60/res__fax_8c.html#aca0e59fc667e8d921853204d2b511d98">fax_rate_str_to_int</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *ratestr)</div><div class="line"><a name="l01047"></a><span class="lineno"> 1047</span>&#160;{</div><div class="line"><a name="l01048"></a><span class="lineno"> 1048</span>&#160;   <span class="keywordtype">int</span> rate;</div><div class="line"><a name="l01049"></a><span class="lineno"> 1049</span>&#160;</div><div class="line"><a name="l01050"></a><span class="lineno"> 1050</span>&#160;   <span class="keywordflow">if</span> (sscanf(ratestr, <span class="stringliteral">&quot;%d&quot;</span>, &amp;rate) != 1) {</div><div class="line"><a name="l01051"></a><span class="lineno"> 1051</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;failed to sscanf &#39;%s&#39; to rate\n&quot;</span>, ratestr);</div><div class="line"><a name="l01052"></a><span class="lineno"> 1052</span>&#160;      <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l01053"></a><span class="lineno"> 1053</span>&#160;   }</div><div class="line"><a name="l01054"></a><span class="lineno"> 1054</span>&#160;   <span class="keywordflow">switch</span> (rate) {</div><div class="line"><a name="l01055"></a><span class="lineno"> 1055</span>&#160;   <span class="keywordflow">case</span> 2400:</div><div class="line"><a name="l01056"></a><span class="lineno"> 1056</span>&#160;   <span class="keywordflow">case</span> 4800:</div><div class="line"><a name="l01057"></a><span class="lineno"> 1057</span>&#160;   <span class="keywordflow">case</span> 7200:</div><div class="line"><a name="l01058"></a><span class="lineno"> 1058</span>&#160;   <span class="keywordflow">case</span> 9600:</div><div class="line"><a name="l01059"></a><span class="lineno"> 1059</span>&#160;   <span class="keywordflow">case</span> 12000:</div><div class="line"><a name="l01060"></a><span class="lineno"> 1060</span>&#160;   <span class="keywordflow">case</span> 14400:</div><div class="line"><a name="l01061"></a><span class="lineno"> 1061</span>&#160;   <span class="keywordflow">case</span> 28800:</div><div class="line"><a name="l01062"></a><span class="lineno"> 1062</span>&#160;   <span class="keywordflow">case</span> 33600:</div><div class="line"><a name="l01063"></a><span class="lineno"> 1063</span>&#160;      <span class="keywordflow">return</span> rate;</div><div class="line"><a name="l01064"></a><span class="lineno"> 1064</span>&#160;   <span class="keywordflow">default</span>:</div><div class="line"><a name="l01065"></a><span class="lineno"> 1065</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;ignoring invalid rate &#39;%s&#39;.  Valid options are {2400 | 4800 | 7200 | 9600 | 12000 | 14400 | 28800 | 33600}\n&quot;</span>, ratestr);</div><div class="line"><a name="l01066"></a><span class="lineno"> 1066</span>&#160;      <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l01067"></a><span class="lineno"> 1067</span>&#160;   }</div><div class="line"><a name="l01068"></a><span class="lineno"> 1068</span>&#160;}</div><div class="line"><a name="l01069"></a><span class="lineno"> 1069</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01070"></a><span class="lineno"> 1070</span>&#160;<span class="comment">/*! \brief Release a session token.</span></div><div class="line"><a name="l01071"></a><span class="lineno"> 1071</span>&#160;<span class="comment"> * \param s a session returned from fax_session_reserve()</span></div><div class="line"><a name="l01072"></a><span class="lineno"> 1072</span>&#160;<span class="comment"> * \param token a token generated from fax_session_reserve()</span></div><div class="line"><a name="l01073"></a><span class="lineno"> 1073</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l01074"></a><span class="lineno"> 1074</span>&#160;<span class="comment"> * This function releases the given token and marks the given session as no</span></div><div class="line"><a name="l01075"></a><span class="lineno"> 1075</span>&#160;<span class="comment"> * longer reserved. It is safe to call on a session that is not actually</span></div><div class="line"><a name="l01076"></a><span class="lineno"> 1076</span>&#160;<span class="comment"> * reserved and with a NULL token. This is so that sessions returned by</span></div><div class="line"><a name="l01077"></a><span class="lineno"> 1077</span>&#160;<span class="comment"> * technologies that do not support reserved sessions don&#39;t require extra logic</span></div><div class="line"><a name="l01078"></a><span class="lineno"> 1078</span>&#160;<span class="comment"> * to handle.</span></div><div class="line"><a name="l01079"></a><span class="lineno"> 1079</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l01080"></a><span class="lineno"> 1080</span>&#160;<span class="comment"> * \note This function DOES NOT release the given fax session, only the given</span></div><div class="line"><a name="l01081"></a><span class="lineno"> 1081</span>&#160;<span class="comment"> * token.</span></div><div class="line"><a name="l01082"></a><span class="lineno"> 1082</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l01083"></a><span class="lineno"><a class="line" href="../../d0/d60/res__fax_8c.html#a049f9f29f5e7c99af20888026f84c5c1"> 1083</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d0/d60/res__fax_8c.html#a049f9f29f5e7c99af20888026f84c5c1">fax_session_release</a>(<span class="keyword">struct</span> <a class="code" href="../../d1/d16/structast__fax__session.html">ast_fax_session</a> *s, <span class="keyword">struct</span> ast_fax_tech_token *token)</div><div class="line"><a name="l01084"></a><span class="lineno"> 1084</span>&#160;{</div><div class="line"><a name="l01085"></a><span class="lineno"> 1085</span>&#160;   <span class="keywordflow">if</span> (token) {</div><div class="line"><a name="l01086"></a><span class="lineno"> 1086</span>&#160;      s-&gt;<a class="code" href="../../d1/d16/structast__fax__session.html#a4ac6ff3775e67c710cd55bc7dfd592fe">tech</a>-&gt;<a class="code" href="../../d9/d0e/structast__fax__tech.html#abc5dcf4e27ad698c7907dbcc15b8d1cc">release_token</a>(token);</div><div class="line"><a name="l01087"></a><span class="lineno"> 1087</span>&#160;   }</div><div class="line"><a name="l01088"></a><span class="lineno"> 1088</span>&#160;</div><div class="line"><a name="l01089"></a><span class="lineno"> 1089</span>&#160;   <span class="keywordflow">if</span> (s-&gt;<a class="code" href="../../d1/d16/structast__fax__session.html#ad8f346e1752edcc0b1a6b431b1749f0e">state</a> == <a class="code" href="../../db/d6a/res__fax_8h.html#ab34810136037068a0847bcca2518112cae3dc111580a7a9ef050b638a3da10790">AST_FAX_STATE_RESERVED</a>) {</div><div class="line"><a name="l01090"></a><span class="lineno"> 1090</span>&#160;      <a class="code" href="../../dd/d42/lock_8h.html#a8a3bd496edfec04a95683ace66676200">ast_atomic_fetchadd_int</a>(&amp;<a class="code" href="../../d0/d60/res__fax_8c.html#a058b6772fcfe1ce5a1a0957e2f11d367">faxregistry</a>.reserved_sessions, -1);</div><div class="line"><a name="l01091"></a><span class="lineno"> 1091</span>&#160;      s-&gt;<a class="code" href="../../d1/d16/structast__fax__session.html#ad8f346e1752edcc0b1a6b431b1749f0e">state</a> = <a class="code" href="../../db/d6a/res__fax_8h.html#ab34810136037068a0847bcca2518112ca522d0463615626bcc42a3dd5716651dd">AST_FAX_STATE_INACTIVE</a>;</div><div class="line"><a name="l01092"></a><span class="lineno"> 1092</span>&#160;   }</div><div class="line"><a name="l01093"></a><span class="lineno"> 1093</span>&#160;}</div><div class="line"><a name="l01094"></a><span class="lineno"> 1094</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01095"></a><span class="lineno"> 1095</span>&#160;<span class="comment">/*! \brief destroy a FAX session structure */</span></div><div class="line"><a name="l01096"></a><span class="lineno"><a class="line" href="../../d0/d60/res__fax_8c.html#aa2dc9cc8d6f1e82d281acbcc292b28b5"> 1096</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d0/d60/res__fax_8c.html#aa2dc9cc8d6f1e82d281acbcc292b28b5">destroy_session</a>(<span class="keywordtype">void</span> *<a class="code" href="../../d2/d4d/astman_8c.html#ac4a6ae0400e4457f0b35beddec80c93d">session</a>)</div><div class="line"><a name="l01097"></a><span class="lineno"> 1097</span>&#160;{</div><div class="line"><a name="l01098"></a><span class="lineno"> 1098</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d1/d16/structast__fax__session.html">ast_fax_session</a> *s = <a class="code" href="../../d2/d4d/astman_8c.html#ac4a6ae0400e4457f0b35beddec80c93d">session</a>;</div><div class="line"><a name="l01099"></a><span class="lineno"> 1099</span>&#160;</div><div class="line"><a name="l01100"></a><span class="lineno"> 1100</span>&#160;   <span class="keywordflow">if</span> (s-&gt;<a class="code" href="../../d1/d16/structast__fax__session.html#a4ac6ff3775e67c710cd55bc7dfd592fe">tech</a>) {</div><div class="line"><a name="l01101"></a><span class="lineno"> 1101</span>&#160;      <a class="code" href="../../d0/d60/res__fax_8c.html#a049f9f29f5e7c99af20888026f84c5c1">fax_session_release</a>(s, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div><div class="line"><a name="l01102"></a><span class="lineno"> 1102</span>&#160;      <span class="keywordflow">if</span> (s-&gt;<a class="code" href="../../d1/d16/structast__fax__session.html#a19aa04db5508cf9496602e694dc69e2f">tech_pvt</a>) {</div><div class="line"><a name="l01103"></a><span class="lineno"> 1103</span>&#160;         s-&gt;<a class="code" href="../../d1/d16/structast__fax__session.html#a4ac6ff3775e67c710cd55bc7dfd592fe">tech</a>-&gt;<a class="code" href="../../d9/d0e/structast__fax__tech.html#ad048a85b941a47dc602ff04b6a3a5f01">destroy_session</a>(s);</div><div class="line"><a name="l01104"></a><span class="lineno"> 1104</span>&#160;      }</div><div class="line"><a name="l01105"></a><span class="lineno"> 1105</span>&#160;      <a class="code" href="../../d5/d16/module_8h.html#a15896c26e51e8162df5eb9a0124c841f">ast_module_unref</a>(s-&gt;<a class="code" href="../../d1/d16/structast__fax__session.html#a4ac6ff3775e67c710cd55bc7dfd592fe">tech</a>-&gt;<a class="code" href="../../d9/d0e/structast__fax__tech.html#a8637433cfbb88aeb10ce2ed5dcba0eb1">module</a>);</div><div class="line"><a name="l01106"></a><span class="lineno"> 1106</span>&#160;   }</div><div class="line"><a name="l01107"></a><span class="lineno"> 1107</span>&#160;</div><div class="line"><a name="l01108"></a><span class="lineno"> 1108</span>&#160;   <span class="keywordflow">if</span> (s-&gt;<a class="code" href="../../d1/d16/structast__fax__session.html#ae7b633178d301df70e8612b4ce1aeb77">details</a>) {</div><div class="line"><a name="l01109"></a><span class="lineno"> 1109</span>&#160;      <span class="keywordflow">if</span> (s-&gt;<a class="code" href="../../d1/d16/structast__fax__session.html#ae7b633178d301df70e8612b4ce1aeb77">details</a>-&gt;<a class="code" href="../../d8/dc2/structast__fax__session__details.html#ad75375cdd336e91cbcee4a829fcdabfe">caps</a> &amp; <a class="code" href="../../db/d6a/res__fax_8h.html#a54eb45ad548b874cf12d0a599631e3f6add135550dca7400fb80e250a63a54887">AST_FAX_TECH_GATEWAY</a>) {</div><div class="line"><a name="l01110"></a><span class="lineno"> 1110</span>&#160;         s-&gt;<a class="code" href="../../d1/d16/structast__fax__session.html#ae7b633178d301df70e8612b4ce1aeb77">details</a>-&gt;<a class="code" href="../../d8/dc2/structast__fax__session__details.html#ad75375cdd336e91cbcee4a829fcdabfe">caps</a> &amp;= ~<a class="code" href="../../db/d6a/res__fax_8h.html#a54eb45ad548b874cf12d0a599631e3f6add135550dca7400fb80e250a63a54887">AST_FAX_TECH_GATEWAY</a>;</div><div class="line"><a name="l01111"></a><span class="lineno"> 1111</span>&#160;      }</div><div class="line"><a name="l01112"></a><span class="lineno"> 1112</span>&#160;      <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(s-&gt;<a class="code" href="../../d1/d16/structast__fax__session.html#ae7b633178d301df70e8612b4ce1aeb77">details</a>, -1);</div><div class="line"><a name="l01113"></a><span class="lineno"> 1113</span>&#160;      s-&gt;<a class="code" href="../../d1/d16/structast__fax__session.html#ae7b633178d301df70e8612b4ce1aeb77">details</a> = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l01114"></a><span class="lineno"> 1114</span>&#160;   }</div><div class="line"><a name="l01115"></a><span class="lineno"> 1115</span>&#160;</div><div class="line"><a name="l01116"></a><span class="lineno"> 1116</span>&#160;   <span class="keywordflow">if</span> (s-&gt;<a class="code" href="../../d1/d16/structast__fax__session.html#a881c40036288d692235f426586f2352b">debug_info</a>) {</div><div class="line"><a name="l01117"></a><span class="lineno"> 1117</span>&#160;      <a class="code" href="../../d3/d08/dsp_8h.html#a0a57a1e374549eb2705068688f4046db">ast_dsp_free</a>(s-&gt;<a class="code" href="../../d1/d16/structast__fax__session.html#a881c40036288d692235f426586f2352b">debug_info</a>-&gt;<a class="code" href="../../d3/d84/structast__fax__debug__info.html#ab9deccb020b39c3f7ac94b1af99cac5d">dsp</a>);</div><div class="line"><a name="l01118"></a><span class="lineno"> 1118</span>&#160;      <a class="code" href="../../d8/d8a/astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(s-&gt;<a class="code" href="../../d1/d16/structast__fax__session.html#a881c40036288d692235f426586f2352b">debug_info</a>);</div><div class="line"><a name="l01119"></a><span class="lineno"> 1119</span>&#160;   }</div><div class="line"><a name="l01120"></a><span class="lineno"> 1120</span>&#160;</div><div class="line"><a name="l01121"></a><span class="lineno"> 1121</span>&#160;   <span class="keywordflow">if</span> (s-&gt;<a class="code" href="../../d1/d16/structast__fax__session.html#a34ee6625e0f7d45c4e35cd409cb42e21">smoother</a>) {</div><div class="line"><a name="l01122"></a><span class="lineno"> 1122</span>&#160;      <a class="code" href="../../d6/d7f/smoother_8h.html#a6d3b71e0a81af743bae6c33c02b64f1f">ast_smoother_free</a>(s-&gt;<a class="code" href="../../d1/d16/structast__fax__session.html#a34ee6625e0f7d45c4e35cd409cb42e21">smoother</a>);</div><div class="line"><a name="l01123"></a><span class="lineno"> 1123</span>&#160;   }</div><div class="line"><a name="l01124"></a><span class="lineno"> 1124</span>&#160;</div><div class="line"><a name="l01125"></a><span class="lineno"> 1125</span>&#160;   <span class="keywordflow">if</span> (s-&gt;<a class="code" href="../../d1/d16/structast__fax__session.html#ad8f346e1752edcc0b1a6b431b1749f0e">state</a> != <a class="code" href="../../db/d6a/res__fax_8h.html#ab34810136037068a0847bcca2518112ca522d0463615626bcc42a3dd5716651dd">AST_FAX_STATE_INACTIVE</a>) {</div><div class="line"><a name="l01126"></a><span class="lineno"> 1126</span>&#160;      <a class="code" href="../../dd/d42/lock_8h.html#a8a3bd496edfec04a95683ace66676200">ast_atomic_fetchadd_int</a>(&amp;<a class="code" href="../../d0/d60/res__fax_8c.html#a058b6772fcfe1ce5a1a0957e2f11d367">faxregistry</a>.active_sessions, -1);</div><div class="line"><a name="l01127"></a><span class="lineno"> 1127</span>&#160;   }</div><div class="line"><a name="l01128"></a><span class="lineno"> 1128</span>&#160;</div><div class="line"><a name="l01129"></a><span class="lineno"> 1129</span>&#160;   <a class="code" href="../../d8/d8a/astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(s-&gt;<a class="code" href="../../d1/d16/structast__fax__session.html#a9f716886b5b2a50ad6d2b9119502b152">channame</a>);</div><div class="line"><a name="l01130"></a><span class="lineno"> 1130</span>&#160;   <a class="code" href="../../d8/d8a/astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(s-&gt;<a class="code" href="../../d1/d16/structast__fax__session.html#a2e10a6e79b985bcf3fe9aef1c176f0a1">chan_uniqueid</a>);</div><div class="line"><a name="l01131"></a><span class="lineno"> 1131</span>&#160;}</div><div class="line"><a name="l01132"></a><span class="lineno"> 1132</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01133"></a><span class="lineno"> 1133</span>&#160;<span class="comment">/*! \brief Reserve a fax session.</span></div><div class="line"><a name="l01134"></a><span class="lineno"> 1134</span>&#160;<span class="comment"> * \param details the fax session details</span></div><div class="line"><a name="l01135"></a><span class="lineno"> 1135</span>&#160;<span class="comment"> * \param token a pointer to a place to store a token to be passed to fax_session_new() later</span></div><div class="line"><a name="l01136"></a><span class="lineno"> 1136</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l01137"></a><span class="lineno"> 1137</span>&#160;<span class="comment"> * This function reserves a fax session for use later. If the selected fax</span></div><div class="line"><a name="l01138"></a><span class="lineno"> 1138</span>&#160;<span class="comment"> * technology does not support reserving sessions a session will still be</span></div><div class="line"><a name="l01139"></a><span class="lineno"> 1139</span>&#160;<span class="comment"> * returned but token will not be set.</span></div><div class="line"><a name="l01140"></a><span class="lineno"> 1140</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l01141"></a><span class="lineno"> 1141</span>&#160;<span class="comment"> * \note The reference returned by this function does not get consumed by</span></div><div class="line"><a name="l01142"></a><span class="lineno"> 1142</span>&#160;<span class="comment"> * fax_session_new() and must always be dereferenced separately.</span></div><div class="line"><a name="l01143"></a><span class="lineno"> 1143</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l01144"></a><span class="lineno"> 1144</span>&#160;<span class="comment"> * \return NULL or an uninitialized and possibly reserved session</span></div><div class="line"><a name="l01145"></a><span class="lineno"> 1145</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l01146"></a><span class="lineno"><a class="line" href="../../d0/d60/res__fax_8c.html#aa71e4f978e47d124ee1f87b340fdfb78"> 1146</a></span>&#160;<span class="keyword">static</span> <span class="keyword">struct </span><a class="code" href="../../d1/d16/structast__fax__session.html">ast_fax_session</a> *<a class="code" href="../../d0/d60/res__fax_8c.html#aa71e4f978e47d124ee1f87b340fdfb78">fax_session_reserve</a>(<span class="keyword">struct</span> <a class="code" href="../../d8/dc2/structast__fax__session__details.html">ast_fax_session_details</a> *details, <span class="keyword">struct</span> ast_fax_tech_token **token)</div><div class="line"><a name="l01147"></a><span class="lineno"> 1147</span>&#160;{</div><div class="line"><a name="l01148"></a><span class="lineno"> 1148</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d1/d16/structast__fax__session.html">ast_fax_session</a> *s;</div><div class="line"><a name="l01149"></a><span class="lineno"> 1149</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d9/d07/structfax__module.html">fax_module</a> *faxmod;</div><div class="line"><a name="l01150"></a><span class="lineno"> 1150</span>&#160;</div><div class="line"><a name="l01151"></a><span class="lineno"> 1151</span>&#160;   <span class="keywordflow">if</span> (!(s = <a class="code" href="../../d5/da5/astobj2_8h.html#ae0422b60d8e25b6962b2d61ae4ddf724">ao2_alloc</a>(<span class="keyword">sizeof</span>(*s), <a class="code" href="../../d0/d60/res__fax_8c.html#aa2dc9cc8d6f1e82d281acbcc292b28b5">destroy_session</a>))) {</div><div class="line"><a name="l01152"></a><span class="lineno"> 1152</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l01153"></a><span class="lineno"> 1153</span>&#160;   }</div><div class="line"><a name="l01154"></a><span class="lineno"> 1154</span>&#160;</div><div class="line"><a name="l01155"></a><span class="lineno"> 1155</span>&#160;   s-&gt;<a class="code" href="../../d1/d16/structast__fax__session.html#ad8f346e1752edcc0b1a6b431b1749f0e">state</a> = <a class="code" href="../../db/d6a/res__fax_8h.html#ab34810136037068a0847bcca2518112ca522d0463615626bcc42a3dd5716651dd">AST_FAX_STATE_INACTIVE</a>;</div><div class="line"><a name="l01156"></a><span class="lineno"> 1156</span>&#160;   s-&gt;<a class="code" href="../../d1/d16/structast__fax__session.html#ae7b633178d301df70e8612b4ce1aeb77">details</a> = details;</div><div class="line"><a name="l01157"></a><span class="lineno"> 1157</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(s-&gt;<a class="code" href="../../d1/d16/structast__fax__session.html#ae7b633178d301df70e8612b4ce1aeb77">details</a>, 1);</div><div class="line"><a name="l01158"></a><span class="lineno"> 1158</span>&#160;</div><div class="line"><a name="l01159"></a><span class="lineno"> 1159</span>&#160;   <span class="comment">/* locate a FAX technology module that can handle said requirements</span></div><div class="line"><a name="l01160"></a><span class="lineno"> 1160</span>&#160;<span class="comment">    * Note: the requirements have not yet been finalized as T.38</span></div><div class="line"><a name="l01161"></a><span class="lineno"> 1161</span>&#160;<span class="comment">    * negotiation has not yet occured. */</span></div><div class="line"><a name="l01162"></a><span class="lineno"> 1162</span>&#160;   <a class="code" href="../../df/d90/linkedlists_8h.html#a0a0fe104cc2cc36a43784f886f3ae7dc">AST_RWLIST_RDLOCK</a>(&amp;<a class="code" href="../../df/d07/structfaxmodules.html">faxmodules</a>);</div><div class="line"><a name="l01163"></a><span class="lineno"> 1163</span>&#160;   <a class="code" href="../../df/d90/linkedlists_8h.html#a944b82566722f2247aa35f1328402c98">AST_RWLIST_TRAVERSE</a>(&amp;<a class="code" href="../../df/d07/structfaxmodules.html">faxmodules</a>, faxmod, list) {</div><div class="line"><a name="l01164"></a><span class="lineno"> 1164</span>&#160;      <span class="keywordflow">if</span> ((faxmod-&gt;<a class="code" href="../../d9/d07/structfax__module.html#a4ac6ff3775e67c710cd55bc7dfd592fe">tech</a>-&gt;<a class="code" href="../../d9/d0e/structast__fax__tech.html#ad75375cdd336e91cbcee4a829fcdabfe">caps</a> &amp; details-&gt;<a class="code" href="../../d8/dc2/structast__fax__session__details.html#ad75375cdd336e91cbcee4a829fcdabfe">caps</a>) != details-&gt;<a class="code" href="../../d8/dc2/structast__fax__session__details.html#ad75375cdd336e91cbcee4a829fcdabfe">caps</a>) {</div><div class="line"><a name="l01165"></a><span class="lineno"> 1165</span>&#160;         <span class="keywordflow">continue</span>;</div><div class="line"><a name="l01166"></a><span class="lineno"> 1166</span>&#160;      }</div><div class="line"><a name="l01167"></a><span class="lineno"> 1167</span>&#160;      <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d16/module_8h.html#ad2dd3dce05926913c40b883cc7cff0a8">ast_module_running_ref</a>(faxmod-&gt;<a class="code" href="../../d9/d07/structfax__module.html#a4ac6ff3775e67c710cd55bc7dfd592fe">tech</a>-&gt;<a class="code" href="../../d9/d0e/structast__fax__tech.html#a8637433cfbb88aeb10ce2ed5dcba0eb1">module</a>)) {</div><div class="line"><a name="l01168"></a><span class="lineno"> 1168</span>&#160;         <span class="keywordflow">continue</span>;</div><div class="line"><a name="l01169"></a><span class="lineno"> 1169</span>&#160;      }</div><div class="line"><a name="l01170"></a><span class="lineno"> 1170</span>&#160;      <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(4, <span class="stringliteral">&quot;Reserving a FAX session from &#39;%s&#39;.\n&quot;</span>, faxmod-&gt;<a class="code" href="../../d9/d07/structfax__module.html#a4ac6ff3775e67c710cd55bc7dfd592fe">tech</a>-&gt;<a class="code" href="../../d9/d0e/structast__fax__tech.html#ac57ec035c076b222b9420a68ddab3bf1">description</a>);</div><div class="line"><a name="l01171"></a><span class="lineno"> 1171</span>&#160;      s-&gt;<a class="code" href="../../d1/d16/structast__fax__session.html#a4ac6ff3775e67c710cd55bc7dfd592fe">tech</a> = faxmod-&gt;<a class="code" href="../../d9/d07/structfax__module.html#a4ac6ff3775e67c710cd55bc7dfd592fe">tech</a>;</div><div class="line"><a name="l01172"></a><span class="lineno"> 1172</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l01173"></a><span class="lineno"> 1173</span>&#160;   }</div><div class="line"><a name="l01174"></a><span class="lineno"> 1174</span>&#160;   <a class="code" href="../../df/d90/linkedlists_8h.html#a2e9a2518b5029b96671aff6701bd5138">AST_RWLIST_UNLOCK</a>(&amp;<a class="code" href="../../df/d07/structfaxmodules.html">faxmodules</a>);</div><div class="line"><a name="l01175"></a><span class="lineno"> 1175</span>&#160;</div><div class="line"><a name="l01176"></a><span class="lineno"> 1176</span>&#160;   <span class="keywordflow">if</span> (!faxmod) {</div><div class="line"><a name="l01177"></a><span class="lineno"> 1177</span>&#160;      <span class="keywordtype">char</span> caps[128] = <span class="stringliteral">&quot;&quot;</span>;</div><div class="line"><a name="l01178"></a><span class="lineno"> 1178</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Could not locate a FAX technology module with capabilities (%s)\n&quot;</span>, <a class="code" href="../../d0/d60/res__fax_8c.html#a40d89bb1e84698fe43b2813c44587cef">ast_fax_caps_to_str</a>(details-&gt;<a class="code" href="../../d8/dc2/structast__fax__session__details.html#ad75375cdd336e91cbcee4a829fcdabfe">caps</a>, caps, <span class="keyword">sizeof</span>(caps)));</div><div class="line"><a name="l01179"></a><span class="lineno"> 1179</span>&#160;      <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(s, -1);</div><div class="line"><a name="l01180"></a><span class="lineno"> 1180</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l01181"></a><span class="lineno"> 1181</span>&#160;   }</div><div class="line"><a name="l01182"></a><span class="lineno"> 1182</span>&#160;</div><div class="line"><a name="l01183"></a><span class="lineno"> 1183</span>&#160;   <span class="keywordflow">if</span> (!s-&gt;<a class="code" href="../../d1/d16/structast__fax__session.html#a4ac6ff3775e67c710cd55bc7dfd592fe">tech</a>-&gt;<a class="code" href="../../d9/d0e/structast__fax__tech.html#ac543607ff0378532fea1bc788b9dce08">reserve_session</a>) {</div><div class="line"><a name="l01184"></a><span class="lineno"> 1184</span>&#160;      <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(1, <span class="stringliteral">&quot;Selected FAX technology module (%s) does not support reserving sessions.\n&quot;</span>, s-&gt;<a class="code" href="../../d1/d16/structast__fax__session.html#a4ac6ff3775e67c710cd55bc7dfd592fe">tech</a>-&gt;<a class="code" href="../../d9/d0e/structast__fax__tech.html#ac57ec035c076b222b9420a68ddab3bf1">description</a>);</div><div class="line"><a name="l01185"></a><span class="lineno"> 1185</span>&#160;      <span class="keywordflow">return</span> s;</div><div class="line"><a name="l01186"></a><span class="lineno"> 1186</span>&#160;   }</div><div class="line"><a name="l01187"></a><span class="lineno"> 1187</span>&#160;</div><div class="line"><a name="l01188"></a><span class="lineno"> 1188</span>&#160;   <span class="keywordflow">if</span> (!(*token = s-&gt;<a class="code" href="../../d1/d16/structast__fax__session.html#a4ac6ff3775e67c710cd55bc7dfd592fe">tech</a>-&gt;<a class="code" href="../../d9/d0e/structast__fax__tech.html#ac543607ff0378532fea1bc788b9dce08">reserve_session</a>(s))) {</div><div class="line"><a name="l01189"></a><span class="lineno"> 1189</span>&#160;      <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(s, -1);</div><div class="line"><a name="l01190"></a><span class="lineno"> 1190</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l01191"></a><span class="lineno"> 1191</span>&#160;   }</div><div class="line"><a name="l01192"></a><span class="lineno"> 1192</span>&#160;</div><div class="line"><a name="l01193"></a><span class="lineno"> 1193</span>&#160;   s-&gt;<a class="code" href="../../d1/d16/structast__fax__session.html#ad8f346e1752edcc0b1a6b431b1749f0e">state</a> = <a class="code" href="../../db/d6a/res__fax_8h.html#ab34810136037068a0847bcca2518112cae3dc111580a7a9ef050b638a3da10790">AST_FAX_STATE_RESERVED</a>;</div><div class="line"><a name="l01194"></a><span class="lineno"> 1194</span>&#160;   <a class="code" href="../../dd/d42/lock_8h.html#a8a3bd496edfec04a95683ace66676200">ast_atomic_fetchadd_int</a>(&amp;<a class="code" href="../../d0/d60/res__fax_8c.html#a058b6772fcfe1ce5a1a0957e2f11d367">faxregistry</a>.reserved_sessions, 1);</div><div class="line"><a name="l01195"></a><span class="lineno"> 1195</span>&#160;</div><div class="line"><a name="l01196"></a><span class="lineno"> 1196</span>&#160;   <span class="keywordflow">return</span> s;</div><div class="line"><a name="l01197"></a><span class="lineno"> 1197</span>&#160;}</div><div class="line"><a name="l01198"></a><span class="lineno"> 1198</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01199"></a><span class="lineno"> 1199</span>&#160;<span class="comment">/*! \brief create a FAX session</span></div><div class="line"><a name="l01200"></a><span class="lineno"> 1200</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l01201"></a><span class="lineno"> 1201</span>&#160;<span class="comment"> * \param details details for the session</span></div><div class="line"><a name="l01202"></a><span class="lineno"> 1202</span>&#160;<span class="comment"> * \param chan the channel the session will run on</span></div><div class="line"><a name="l01203"></a><span class="lineno"> 1203</span>&#160;<span class="comment"> * \param reserved a reserved session to base this session on (can be NULL)</span></div><div class="line"><a name="l01204"></a><span class="lineno"> 1204</span>&#160;<span class="comment"> * \param token the token for a reserved session (can be NULL)</span></div><div class="line"><a name="l01205"></a><span class="lineno"> 1205</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l01206"></a><span class="lineno"> 1206</span>&#160;<span class="comment"> * Create a new fax session based on the given details structure.</span></div><div class="line"><a name="l01207"></a><span class="lineno"> 1207</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l01208"></a><span class="lineno"> 1208</span>&#160;<span class="comment"> * \note The given token is always consumed (by tech-&gt;new_session() or by</span></div><div class="line"><a name="l01209"></a><span class="lineno"> 1209</span>&#160;<span class="comment"> * fax_session_release() in the event of a failure). The given reference to a</span></div><div class="line"><a name="l01210"></a><span class="lineno"> 1210</span>&#160;<span class="comment"> * reserved session is never consumed and must be dereferenced separately from</span></div><div class="line"><a name="l01211"></a><span class="lineno"> 1211</span>&#160;<span class="comment"> * the reference returned by this function.</span></div><div class="line"><a name="l01212"></a><span class="lineno"> 1212</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l01213"></a><span class="lineno"> 1213</span>&#160;<span class="comment"> * \return NULL or a reference to a new fax session</span></div><div class="line"><a name="l01214"></a><span class="lineno"> 1214</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l01215"></a><span class="lineno"><a class="line" href="../../d0/d60/res__fax_8c.html#a7ca6ede68de97a21f49d381ef9014ae1"> 1215</a></span>&#160;<span class="keyword">static</span> <span class="keyword">struct </span><a class="code" href="../../d1/d16/structast__fax__session.html">ast_fax_session</a> *<a class="code" href="../../d0/d60/res__fax_8c.html#a7ca6ede68de97a21f49d381ef9014ae1">fax_session_new</a>(<span class="keyword">struct</span> <a class="code" href="../../d8/dc2/structast__fax__session__details.html">ast_fax_session_details</a> *details, <span class="keyword">struct</span> <a class="code" href="../../df/d3c/structast__channel.html">ast_channel</a> *chan, <span class="keyword">struct</span> <a class="code" href="../../d1/d16/structast__fax__session.html">ast_fax_session</a> *reserved, <span class="keyword">struct</span> ast_fax_tech_token *token)</div><div class="line"><a name="l01216"></a><span class="lineno"> 1216</span>&#160;{</div><div class="line"><a name="l01217"></a><span class="lineno"> 1217</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d1/d16/structast__fax__session.html">ast_fax_session</a> *s = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l01218"></a><span class="lineno"> 1218</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d9/d07/structfax__module.html">fax_module</a> *faxmod;</div><div class="line"><a name="l01219"></a><span class="lineno"> 1219</span>&#160;</div><div class="line"><a name="l01220"></a><span class="lineno"> 1220</span>&#160;   <span class="keywordflow">if</span> (reserved) {</div><div class="line"><a name="l01221"></a><span class="lineno"> 1221</span>&#160;      s = reserved;</div><div class="line"><a name="l01222"></a><span class="lineno"> 1222</span>&#160;      <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(reserved, +1);</div><div class="line"><a name="l01223"></a><span class="lineno"> 1223</span>&#160;      <a class="code" href="../../d5/da5/astobj2_8h.html#a64f51be4bee35c38dbe59b0a788b5ce8">ao2_unlink</a>(<a class="code" href="../../d0/d60/res__fax_8c.html#a058b6772fcfe1ce5a1a0957e2f11d367">faxregistry</a>.container, reserved);</div><div class="line"><a name="l01224"></a><span class="lineno"> 1224</span>&#160;</div><div class="line"><a name="l01225"></a><span class="lineno"> 1225</span>&#160;      <span class="comment">/* NOTE: we don&#39;t consume the reference to the reserved</span></div><div class="line"><a name="l01226"></a><span class="lineno"> 1226</span>&#160;<span class="comment">       * session. The session returned from fax_session_new() is a</span></div><div class="line"><a name="l01227"></a><span class="lineno"> 1227</span>&#160;<span class="comment">       * new reference and must be derefed in addition to the</span></div><div class="line"><a name="l01228"></a><span class="lineno"> 1228</span>&#160;<span class="comment">       * reserved session.</span></div><div class="line"><a name="l01229"></a><span class="lineno"> 1229</span>&#160;<span class="comment">       */</span></div><div class="line"><a name="l01230"></a><span class="lineno"> 1230</span>&#160;</div><div class="line"><a name="l01231"></a><span class="lineno"> 1231</span>&#160;      <span class="keywordflow">if</span> (s-&gt;<a class="code" href="../../d1/d16/structast__fax__session.html#ad8f346e1752edcc0b1a6b431b1749f0e">state</a> == <a class="code" href="../../db/d6a/res__fax_8h.html#ab34810136037068a0847bcca2518112cae3dc111580a7a9ef050b638a3da10790">AST_FAX_STATE_RESERVED</a>) {</div><div class="line"><a name="l01232"></a><span class="lineno"> 1232</span>&#160;         <a class="code" href="../../dd/d42/lock_8h.html#a8a3bd496edfec04a95683ace66676200">ast_atomic_fetchadd_int</a>(&amp;<a class="code" href="../../d0/d60/res__fax_8c.html#a058b6772fcfe1ce5a1a0957e2f11d367">faxregistry</a>.reserved_sessions, -1);</div><div class="line"><a name="l01233"></a><span class="lineno"> 1233</span>&#160;         s-&gt;<a class="code" href="../../d1/d16/structast__fax__session.html#ad8f346e1752edcc0b1a6b431b1749f0e">state</a> = <a class="code" href="../../db/d6a/res__fax_8h.html#ab34810136037068a0847bcca2518112cad2e2632aa1b6333fcd0e89c554d0df54">AST_FAX_STATE_UNINITIALIZED</a>;</div><div class="line"><a name="l01234"></a><span class="lineno"> 1234</span>&#160;      }</div><div class="line"><a name="l01235"></a><span class="lineno"> 1235</span>&#160;   }</div><div class="line"><a name="l01236"></a><span class="lineno"> 1236</span>&#160;</div><div class="line"><a name="l01237"></a><span class="lineno"> 1237</span>&#160;   <span class="keywordflow">if</span> (!s &amp;&amp; !(s = <a class="code" href="../../d5/da5/astobj2_8h.html#ae0422b60d8e25b6962b2d61ae4ddf724">ao2_alloc</a>(<span class="keyword">sizeof</span>(*s), <a class="code" href="../../d0/d60/res__fax_8c.html#aa2dc9cc8d6f1e82d281acbcc292b28b5">destroy_session</a>))) {</div><div class="line"><a name="l01238"></a><span class="lineno"> 1238</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l01239"></a><span class="lineno"> 1239</span>&#160;   }</div><div class="line"><a name="l01240"></a><span class="lineno"> 1240</span>&#160;</div><div class="line"><a name="l01241"></a><span class="lineno"> 1241</span>&#160;   <a class="code" href="../../dd/d42/lock_8h.html#a8a3bd496edfec04a95683ace66676200">ast_atomic_fetchadd_int</a>(&amp;<a class="code" href="../../d0/d60/res__fax_8c.html#a058b6772fcfe1ce5a1a0957e2f11d367">faxregistry</a>.active_sessions, 1);</div><div class="line"><a name="l01242"></a><span class="lineno"> 1242</span>&#160;   s-&gt;<a class="code" href="../../d1/d16/structast__fax__session.html#ad8f346e1752edcc0b1a6b431b1749f0e">state</a> = <a class="code" href="../../db/d6a/res__fax_8h.html#ab34810136037068a0847bcca2518112cad2e2632aa1b6333fcd0e89c554d0df54">AST_FAX_STATE_UNINITIALIZED</a>;</div><div class="line"><a name="l01243"></a><span class="lineno"> 1243</span>&#160;</div><div class="line"><a name="l01244"></a><span class="lineno"> 1244</span>&#160;   <span class="keywordflow">if</span> (details-&gt;<a class="code" href="../../d8/dc2/structast__fax__session__details.html#a3ab211dbe8780b7292257f6b3dba1952">option</a>.<a class="code" href="../../d8/dc2/structast__fax__session__details.html#a84360ac08d9be11f221466122d8cdc65">debug</a> &amp;&amp; (details-&gt;<a class="code" href="../../d8/dc2/structast__fax__session__details.html#ad75375cdd336e91cbcee4a829fcdabfe">caps</a> &amp; <a class="code" href="../../db/d6a/res__fax_8h.html#a54eb45ad548b874cf12d0a599631e3f6a76fa4111df51955a949e95fadbccd48b">AST_FAX_TECH_AUDIO</a>)) {</div><div class="line"><a name="l01245"></a><span class="lineno"> 1245</span>&#160;      <span class="keywordflow">if</span> (!(s-&gt;<a class="code" href="../../d1/d16/structast__fax__session.html#a881c40036288d692235f426586f2352b">debug_info</a> = <a class="code" href="../../d8/d8a/astmm_8h.html#ae0cd4c5524b01287ab19cbe233d9cebb">ast_calloc</a>(1, <span class="keyword">sizeof</span>(*(s-&gt;<a class="code" href="../../d1/d16/structast__fax__session.html#a881c40036288d692235f426586f2352b">debug_info</a>))))) {</div><div class="line"><a name="l01246"></a><span class="lineno"> 1246</span>&#160;         <a class="code" href="../../d0/d60/res__fax_8c.html#a049f9f29f5e7c99af20888026f84c5c1">fax_session_release</a>(s, token);</div><div class="line"><a name="l01247"></a><span class="lineno"> 1247</span>&#160;         <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(s, -1);</div><div class="line"><a name="l01248"></a><span class="lineno"> 1248</span>&#160;         <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l01249"></a><span class="lineno"> 1249</span>&#160;      }</div><div class="line"><a name="l01250"></a><span class="lineno"> 1250</span>&#160;      <span class="keywordflow">if</span> (!(s-&gt;<a class="code" href="../../d1/d16/structast__fax__session.html#a881c40036288d692235f426586f2352b">debug_info</a>-&gt;<a class="code" href="../../d3/d84/structast__fax__debug__info.html#ab9deccb020b39c3f7ac94b1af99cac5d">dsp</a> = <a class="code" href="../../d3/d08/dsp_8h.html#a0a60e93006c8e1ca8fda922ae0e0da2c">ast_dsp_new</a>())) {</div><div class="line"><a name="l01251"></a><span class="lineno"> 1251</span>&#160;         <a class="code" href="../../d8/d8a/astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(s-&gt;<a class="code" href="../../d1/d16/structast__fax__session.html#a881c40036288d692235f426586f2352b">debug_info</a>);</div><div class="line"><a name="l01252"></a><span class="lineno"> 1252</span>&#160;         s-&gt;<a class="code" href="../../d1/d16/structast__fax__session.html#a881c40036288d692235f426586f2352b">debug_info</a> = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l01253"></a><span class="lineno"> 1253</span>&#160;         <a class="code" href="../../d0/d60/res__fax_8c.html#a049f9f29f5e7c99af20888026f84c5c1">fax_session_release</a>(s, token);</div><div class="line"><a name="l01254"></a><span class="lineno"> 1254</span>&#160;         <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(s, -1);</div><div class="line"><a name="l01255"></a><span class="lineno"> 1255</span>&#160;         <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l01256"></a><span class="lineno"> 1256</span>&#160;      }</div><div class="line"><a name="l01257"></a><span class="lineno"> 1257</span>&#160;      <a class="code" href="../../d3/d08/dsp_8h.html#a06a0b883127ba1f853e9e0fa5f29d81b">ast_dsp_set_threshold</a>(s-&gt;<a class="code" href="../../d1/d16/structast__fax__session.html#a881c40036288d692235f426586f2352b">debug_info</a>-&gt;<a class="code" href="../../d3/d84/structast__fax__debug__info.html#ab9deccb020b39c3f7ac94b1af99cac5d">dsp</a>, 128);</div><div class="line"><a name="l01258"></a><span class="lineno"> 1258</span>&#160;   }</div><div class="line"><a name="l01259"></a><span class="lineno"> 1259</span>&#160;</div><div class="line"><a name="l01260"></a><span class="lineno"> 1260</span>&#160;   <span class="keywordflow">if</span> (!(s-&gt;<a class="code" href="../../d1/d16/structast__fax__session.html#a9f716886b5b2a50ad6d2b9119502b152">channame</a> = <a class="code" href="../../d8/d8a/astmm_8h.html#ab263849d03fb892847be4986db759737">ast_strdup</a>(<a class="code" href="../../d5/d7b/channel_8h.html#a7ca2fda13b129a55c251b56729de285b">ast_channel_name</a>(chan)))) {</div><div class="line"><a name="l01261"></a><span class="lineno"> 1261</span>&#160;      <a class="code" href="../../d0/d60/res__fax_8c.html#a049f9f29f5e7c99af20888026f84c5c1">fax_session_release</a>(s, token);</div><div class="line"><a name="l01262"></a><span class="lineno"> 1262</span>&#160;      <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(s, -1);</div><div class="line"><a name="l01263"></a><span class="lineno"> 1263</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l01264"></a><span class="lineno"> 1264</span>&#160;   }</div><div class="line"><a name="l01265"></a><span class="lineno"> 1265</span>&#160;</div><div class="line"><a name="l01266"></a><span class="lineno"> 1266</span>&#160;   <span class="keywordflow">if</span> (!(s-&gt;<a class="code" href="../../d1/d16/structast__fax__session.html#a2e10a6e79b985bcf3fe9aef1c176f0a1">chan_uniqueid</a> = <a class="code" href="../../d8/d8a/astmm_8h.html#ab263849d03fb892847be4986db759737">ast_strdup</a>(<a class="code" href="../../d5/d7b/channel_8h.html#a3b6254f6d3832ef928f0a727113b1c63">ast_channel_uniqueid</a>(chan)))) {</div><div class="line"><a name="l01267"></a><span class="lineno"> 1267</span>&#160;      <a class="code" href="../../d0/d60/res__fax_8c.html#a049f9f29f5e7c99af20888026f84c5c1">fax_session_release</a>(s, token);</div><div class="line"><a name="l01268"></a><span class="lineno"> 1268</span>&#160;      <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(s, -1);</div><div class="line"><a name="l01269"></a><span class="lineno"> 1269</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l01270"></a><span class="lineno"> 1270</span>&#160;   }</div><div class="line"><a name="l01271"></a><span class="lineno"> 1271</span>&#160;</div><div class="line"><a name="l01272"></a><span class="lineno"> 1272</span>&#160;   s-&gt;<a class="code" href="../../d1/d16/structast__fax__session.html#a84d1435c5b8d387806714ea7079304b7">chan</a> = chan;</div><div class="line"><a name="l01273"></a><span class="lineno"> 1273</span>&#160;   <span class="keywordflow">if</span> (!s-&gt;<a class="code" href="../../d1/d16/structast__fax__session.html#ae7b633178d301df70e8612b4ce1aeb77">details</a>) {</div><div class="line"><a name="l01274"></a><span class="lineno"> 1274</span>&#160;      s-&gt;<a class="code" href="../../d1/d16/structast__fax__session.html#ae7b633178d301df70e8612b4ce1aeb77">details</a> = details;</div><div class="line"><a name="l01275"></a><span class="lineno"> 1275</span>&#160;      <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(s-&gt;<a class="code" href="../../d1/d16/structast__fax__session.html#ae7b633178d301df70e8612b4ce1aeb77">details</a>, 1);</div><div class="line"><a name="l01276"></a><span class="lineno"> 1276</span>&#160;   }</div><div class="line"><a name="l01277"></a><span class="lineno"> 1277</span>&#160;</div><div class="line"><a name="l01278"></a><span class="lineno"> 1278</span>&#160;   details-&gt;<a class="code" href="../../d8/dc2/structast__fax__session__details.html#ab7ce6f462afaf105224b0ca772a33c43">id</a> = s-&gt;<a class="code" href="../../d1/d16/structast__fax__session.html#ab7ce6f462afaf105224b0ca772a33c43">id</a> = <a class="code" href="../../dd/d42/lock_8h.html#a8a3bd496edfec04a95683ace66676200">ast_atomic_fetchadd_int</a>(&amp;<a class="code" href="../../d0/d60/res__fax_8c.html#a058b6772fcfe1ce5a1a0957e2f11d367">faxregistry</a>.nextsessionname, 1);</div><div class="line"><a name="l01279"></a><span class="lineno"> 1279</span>&#160;</div><div class="line"><a name="l01280"></a><span class="lineno"> 1280</span>&#160;   <span class="keywordflow">if</span> (!token) {</div><div class="line"><a name="l01281"></a><span class="lineno"> 1281</span>&#160;      <span class="comment">/* locate a FAX technology module that can handle said requirements */</span></div><div class="line"><a name="l01282"></a><span class="lineno"> 1282</span>&#160;      <a class="code" href="../../df/d90/linkedlists_8h.html#a0a0fe104cc2cc36a43784f886f3ae7dc">AST_RWLIST_RDLOCK</a>(&amp;<a class="code" href="../../df/d07/structfaxmodules.html">faxmodules</a>);</div><div class="line"><a name="l01283"></a><span class="lineno"> 1283</span>&#160;      <a class="code" href="../../df/d90/linkedlists_8h.html#a944b82566722f2247aa35f1328402c98">AST_RWLIST_TRAVERSE</a>(&amp;<a class="code" href="../../df/d07/structfaxmodules.html">faxmodules</a>, faxmod, list) {</div><div class="line"><a name="l01284"></a><span class="lineno"> 1284</span>&#160;         <span class="keywordflow">if</span> ((faxmod-&gt;<a class="code" href="../../d9/d07/structfax__module.html#a4ac6ff3775e67c710cd55bc7dfd592fe">tech</a>-&gt;<a class="code" href="../../d9/d0e/structast__fax__tech.html#ad75375cdd336e91cbcee4a829fcdabfe">caps</a> &amp; details-&gt;<a class="code" href="../../d8/dc2/structast__fax__session__details.html#ad75375cdd336e91cbcee4a829fcdabfe">caps</a>) != details-&gt;<a class="code" href="../../d8/dc2/structast__fax__session__details.html#ad75375cdd336e91cbcee4a829fcdabfe">caps</a>) {</div><div class="line"><a name="l01285"></a><span class="lineno"> 1285</span>&#160;            <span class="keywordflow">continue</span>;</div><div class="line"><a name="l01286"></a><span class="lineno"> 1286</span>&#160;         }</div><div class="line"><a name="l01287"></a><span class="lineno"> 1287</span>&#160;         <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d16/module_8h.html#ad2dd3dce05926913c40b883cc7cff0a8">ast_module_running_ref</a>(faxmod-&gt;<a class="code" href="../../d9/d07/structfax__module.html#a4ac6ff3775e67c710cd55bc7dfd592fe">tech</a>-&gt;<a class="code" href="../../d9/d0e/structast__fax__tech.html#a8637433cfbb88aeb10ce2ed5dcba0eb1">module</a>)) {</div><div class="line"><a name="l01288"></a><span class="lineno"> 1288</span>&#160;            <span class="keywordflow">continue</span>;</div><div class="line"><a name="l01289"></a><span class="lineno"> 1289</span>&#160;         }</div><div class="line"><a name="l01290"></a><span class="lineno"> 1290</span>&#160;         <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(4, <span class="stringliteral">&quot;Requesting a new FAX session from &#39;%s&#39;.\n&quot;</span>, faxmod-&gt;<a class="code" href="../../d9/d07/structfax__module.html#a4ac6ff3775e67c710cd55bc7dfd592fe">tech</a>-&gt;<a class="code" href="../../d9/d0e/structast__fax__tech.html#ac57ec035c076b222b9420a68ddab3bf1">description</a>);</div><div class="line"><a name="l01291"></a><span class="lineno"> 1291</span>&#160;         <span class="keywordflow">if</span> (reserved) {</div><div class="line"><a name="l01292"></a><span class="lineno"> 1292</span>&#160;            <span class="comment">/* Balance module ref from reserved session */</span></div><div class="line"><a name="l01293"></a><span class="lineno"> 1293</span>&#160;            <a class="code" href="../../d5/d16/module_8h.html#a15896c26e51e8162df5eb9a0124c841f">ast_module_unref</a>(reserved-&gt;<a class="code" href="../../d1/d16/structast__fax__session.html#a4ac6ff3775e67c710cd55bc7dfd592fe">tech</a>-&gt;<a class="code" href="../../d9/d0e/structast__fax__tech.html#a8637433cfbb88aeb10ce2ed5dcba0eb1">module</a>);</div><div class="line"><a name="l01294"></a><span class="lineno"> 1294</span>&#160;         }</div><div class="line"><a name="l01295"></a><span class="lineno"> 1295</span>&#160;         s-&gt;<a class="code" href="../../d1/d16/structast__fax__session.html#a4ac6ff3775e67c710cd55bc7dfd592fe">tech</a> = faxmod-&gt;<a class="code" href="../../d9/d07/structfax__module.html#a4ac6ff3775e67c710cd55bc7dfd592fe">tech</a>;</div><div class="line"><a name="l01296"></a><span class="lineno"> 1296</span>&#160;         <span class="keywordflow">break</span>;</div><div class="line"><a name="l01297"></a><span class="lineno"> 1297</span>&#160;      }</div><div class="line"><a name="l01298"></a><span class="lineno"> 1298</span>&#160;      <a class="code" href="../../df/d90/linkedlists_8h.html#a2e9a2518b5029b96671aff6701bd5138">AST_RWLIST_UNLOCK</a>(&amp;<a class="code" href="../../df/d07/structfaxmodules.html">faxmodules</a>);</div><div class="line"><a name="l01299"></a><span class="lineno"> 1299</span>&#160;</div><div class="line"><a name="l01300"></a><span class="lineno"> 1300</span>&#160;      <span class="keywordflow">if</span> (!faxmod) {</div><div class="line"><a name="l01301"></a><span class="lineno"> 1301</span>&#160;         <span class="keywordtype">char</span> caps[128] = <span class="stringliteral">&quot;&quot;</span>;</div><div class="line"><a name="l01302"></a><span class="lineno"> 1302</span>&#160;         <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Could not locate a FAX technology module with capabilities (%s)\n&quot;</span>, <a class="code" href="../../d0/d60/res__fax_8c.html#a40d89bb1e84698fe43b2813c44587cef">ast_fax_caps_to_str</a>(details-&gt;<a class="code" href="../../d8/dc2/structast__fax__session__details.html#ad75375cdd336e91cbcee4a829fcdabfe">caps</a>, caps, <span class="keyword">sizeof</span>(caps)));</div><div class="line"><a name="l01303"></a><span class="lineno"> 1303</span>&#160;         <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(s, -1);</div><div class="line"><a name="l01304"></a><span class="lineno"> 1304</span>&#160;         <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l01305"></a><span class="lineno"> 1305</span>&#160;      }</div><div class="line"><a name="l01306"></a><span class="lineno"> 1306</span>&#160;   }</div><div class="line"><a name="l01307"></a><span class="lineno"> 1307</span>&#160;</div><div class="line"><a name="l01308"></a><span class="lineno"> 1308</span>&#160;   <span class="keywordflow">if</span> (!(s-&gt;<a class="code" href="../../d1/d16/structast__fax__session.html#a19aa04db5508cf9496602e694dc69e2f">tech_pvt</a> = s-&gt;<a class="code" href="../../d1/d16/structast__fax__session.html#a4ac6ff3775e67c710cd55bc7dfd592fe">tech</a>-&gt;<a class="code" href="../../d9/d0e/structast__fax__tech.html#af6a106ce28aa76aef5f65fa63d1cb129">new_session</a>(s, token))) {</div><div class="line"><a name="l01309"></a><span class="lineno"> 1309</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;FAX session failed to initialize.\n&quot;</span>);</div><div class="line"><a name="l01310"></a><span class="lineno"> 1310</span>&#160;      <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(s, -1);</div><div class="line"><a name="l01311"></a><span class="lineno"> 1311</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l01312"></a><span class="lineno"> 1312</span>&#160;   }</div><div class="line"><a name="l01313"></a><span class="lineno"> 1313</span>&#160;   <span class="comment">/* link the session to the session container */</span></div><div class="line"><a name="l01314"></a><span class="lineno"> 1314</span>&#160;   <span class="keywordflow">if</span> (!(<a class="code" href="../../d5/da5/astobj2_8h.html#a1ad9f122bcae95a470639402faa3d2ee">ao2_link</a>(<a class="code" href="../../d0/d60/res__fax_8c.html#a058b6772fcfe1ce5a1a0957e2f11d367">faxregistry</a>.container, s))) {</div><div class="line"><a name="l01315"></a><span class="lineno"> 1315</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;failed to add FAX session &#39;%u&#39; to container.\n&quot;</span>, s-&gt;<a class="code" href="../../d1/d16/structast__fax__session.html#ab7ce6f462afaf105224b0ca772a33c43">id</a>);</div><div class="line"><a name="l01316"></a><span class="lineno"> 1316</span>&#160;      <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(s, -1);</div><div class="line"><a name="l01317"></a><span class="lineno"> 1317</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l01318"></a><span class="lineno"> 1318</span>&#160;   }</div><div class="line"><a name="l01319"></a><span class="lineno"> 1319</span>&#160;   <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(4, <span class="stringliteral">&quot;channel &#39;%s&#39; using FAX session &#39;%u&#39;\n&quot;</span>, s-&gt;<a class="code" href="../../d1/d16/structast__fax__session.html#a9f716886b5b2a50ad6d2b9119502b152">channame</a>, s-&gt;<a class="code" href="../../d1/d16/structast__fax__session.html#ab7ce6f462afaf105224b0ca772a33c43">id</a>);</div><div class="line"><a name="l01320"></a><span class="lineno"> 1320</span>&#160;</div><div class="line"><a name="l01321"></a><span class="lineno"> 1321</span>&#160;   <span class="keywordflow">return</span> s;</div><div class="line"><a name="l01322"></a><span class="lineno"> 1322</span>&#160;}</div><div class="line"><a name="l01323"></a><span class="lineno"> 1323</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01324"></a><span class="lineno"> 1324</span>&#160;<span class="comment">/*!</span></div><div class="line"><a name="l01325"></a><span class="lineno"> 1325</span>&#160;<span class="comment"> * \internal</span></div><div class="line"><a name="l01326"></a><span class="lineno"> 1326</span>&#160;<span class="comment"> * \brief Convert the filenames in a fax session into a JSON array</span></div><div class="line"><a name="l01327"></a><span class="lineno"> 1327</span>&#160;<span class="comment"> * \retval NULL on error</span></div><div class="line"><a name="l01328"></a><span class="lineno"> 1328</span>&#160;<span class="comment"> * \retval A \ref ast_json array on success</span></div><div class="line"><a name="l01329"></a><span class="lineno"> 1329</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l01330"></a><span class="lineno"><a class="line" href="../../d0/d60/res__fax_8c.html#a8dfe16760634f2d87db5508787023ef5"> 1330</a></span>&#160;<span class="keyword">static</span> <span class="keyword">struct </span><a class="code" href="../../d1/da1/structast__json.html">ast_json</a> *<a class="code" href="../../d0/d60/res__fax_8c.html#a8dfe16760634f2d87db5508787023ef5">generate_filenames_json</a>(<span class="keyword">struct</span> <a class="code" href="../../d8/dc2/structast__fax__session__details.html">ast_fax_session_details</a> *details)</div><div class="line"><a name="l01331"></a><span class="lineno"> 1331</span>&#160;{</div><div class="line"><a name="l01332"></a><span class="lineno"> 1332</span>&#160;   <a class="code" href="../../d5/d60/utils_8h.html#a1604b4d72144dd3d9f7da668e90337e9">RAII_VAR</a>(<span class="keyword">struct</span> <a class="code" href="../../d1/da1/structast__json.html">ast_json</a> *, json_array, <a class="code" href="../../d4/d05/json_8h.html#a48d874eed79fb2bbeb0557440e33ae67">ast_json_array_create</a>(), <a class="code" href="../../d4/d05/json_8h.html#a33bcd9181e613a659eefe411ec42c87c">ast_json_unref</a>);</div><div class="line"><a name="l01333"></a><span class="lineno"> 1333</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d2/db8/structast__fax__document.html">ast_fax_document</a> *doc;</div><div class="line"><a name="l01334"></a><span class="lineno"> 1334</span>&#160;</div><div class="line"><a name="l01335"></a><span class="lineno"> 1335</span>&#160;   <span class="keywordflow">if</span> (!details || !json_array) {</div><div class="line"><a name="l01336"></a><span class="lineno"> 1336</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l01337"></a><span class="lineno"> 1337</span>&#160;   }</div><div class="line"><a name="l01338"></a><span class="lineno"> 1338</span>&#160;</div><div class="line"><a name="l01339"></a><span class="lineno"> 1339</span>&#160;   <span class="comment">/* don&#39;t process empty lists */</span></div><div class="line"><a name="l01340"></a><span class="lineno"> 1340</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../df/d90/linkedlists_8h.html#a4a1884cde93e53bef32ca85c194a1d05">AST_LIST_EMPTY</a>(&amp;details-&gt;<a class="code" href="../../d8/dc2/structast__fax__session__details.html#a14c20eed7d6d03b484ebc2cc7a447ea2">documents</a>)) {</div><div class="line"><a name="l01341"></a><span class="lineno"> 1341</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l01342"></a><span class="lineno"> 1342</span>&#160;   }</div><div class="line"><a name="l01343"></a><span class="lineno"> 1343</span>&#160;</div><div class="line"><a name="l01344"></a><span class="lineno"> 1344</span>&#160;   <a class="code" href="../../df/d90/linkedlists_8h.html#a3008b2f4f236b72d8bcfb80e346324ef">AST_LIST_TRAVERSE</a>(&amp;details-&gt;<a class="code" href="../../d8/dc2/structast__fax__session__details.html#a14c20eed7d6d03b484ebc2cc7a447ea2">documents</a>, doc, <a class="code" href="../../d2/db8/structast__fax__document.html#a7d18bbe79e0371242e10316471016b3d">next</a>) {</div><div class="line"><a name="l01345"></a><span class="lineno"> 1345</span>&#160;      <span class="keyword">struct </span><a class="code" href="../../d1/da1/structast__json.html">ast_json</a> *<a class="code" href="../../d3/d96/structentry.html">entry</a> = <a class="code" href="../../d4/d05/json_8h.html#adc52f8d76b7fdd0c8d12987981fd5bf5">ast_json_string_create</a>(doc-&gt;<a class="code" href="../../d2/db8/structast__fax__document.html#afae8c108f5d360038fa8b099eb4ab2f3">filename</a>);</div><div class="line"><a name="l01346"></a><span class="lineno"> 1346</span>&#160;      <span class="keywordflow">if</span> (!entry) {</div><div class="line"><a name="l01347"></a><span class="lineno"> 1347</span>&#160;         <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l01348"></a><span class="lineno"> 1348</span>&#160;      }</div><div class="line"><a name="l01349"></a><span class="lineno"> 1349</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="../../d4/d05/json_8h.html#a3d675e52f866630a6a03302df2712b8d">ast_json_array_append</a>(json_array, entry)) {</div><div class="line"><a name="l01350"></a><span class="lineno"> 1350</span>&#160;         <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l01351"></a><span class="lineno"> 1351</span>&#160;      }</div><div class="line"><a name="l01352"></a><span class="lineno"> 1352</span>&#160;   }</div><div class="line"><a name="l01353"></a><span class="lineno"> 1353</span>&#160;</div><div class="line"><a name="l01354"></a><span class="lineno"> 1354</span>&#160;   <a class="code" href="../../d4/d05/json_8h.html#a0ca956b7df20127f7e38993c3c06cb2c">ast_json_ref</a>(json_array);</div><div class="line"><a name="l01355"></a><span class="lineno"> 1355</span>&#160;   <span class="keywordflow">return</span> json_array;</div><div class="line"><a name="l01356"></a><span class="lineno"> 1356</span>&#160;}</div><div class="line"><a name="l01357"></a><span class="lineno"> 1357</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01358"></a><span class="lineno"> 1358</span>&#160;<span class="comment">/*!</span></div><div class="line"><a name="l01359"></a><span class="lineno"> 1359</span>&#160;<span class="comment"> * \brief Generate a string of filenames using the given prefix and separator.</span></div><div class="line"><a name="l01360"></a><span class="lineno"> 1360</span>&#160;<span class="comment"> * \param details the fax session details</span></div><div class="line"><a name="l01361"></a><span class="lineno"> 1361</span>&#160;<span class="comment"> * \param prefix the prefix to each filename</span></div><div class="line"><a name="l01362"></a><span class="lineno"> 1362</span>&#160;<span class="comment"> * \param separator the separator between filenames</span></div><div class="line"><a name="l01363"></a><span class="lineno"> 1363</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l01364"></a><span class="lineno"> 1364</span>&#160;<span class="comment"> * This function generates a string of filenames from the given details</span></div><div class="line"><a name="l01365"></a><span class="lineno"> 1365</span>&#160;<span class="comment"> * structure and using the given prefix and separator.</span></div><div class="line"><a name="l01366"></a><span class="lineno"> 1366</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l01367"></a><span class="lineno"> 1367</span>&#160;<span class="comment"> * \retval NULL there was an error generating the string</span></div><div class="line"><a name="l01368"></a><span class="lineno"> 1368</span>&#160;<span class="comment"> * \return the string generated string</span></div><div class="line"><a name="l01369"></a><span class="lineno"> 1369</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l01370"></a><span class="lineno"><a class="line" href="../../d0/d60/res__fax_8c.html#aea322d9ee9a565a0f53e6fa1f1f34e66"> 1370</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">char</span> *<a class="code" href="../../d0/d60/res__fax_8c.html#aea322d9ee9a565a0f53e6fa1f1f34e66">generate_filenames_string</a>(<span class="keyword">struct</span> <a class="code" href="../../d8/dc2/structast__fax__session__details.html">ast_fax_session_details</a> *details, <span class="keywordtype">char</span> *<a class="code" href="../../dd/d43/http_8c.html#a6f25bc812d09fedb86bf394c01061c56">prefix</a>, <span class="keywordtype">char</span> *separator)</div><div class="line"><a name="l01371"></a><span class="lineno"> 1371</span>&#160;{</div><div class="line"><a name="l01372"></a><span class="lineno"> 1372</span>&#160;   <span class="keywordtype">char</span> *filenames, *<a class="code" href="../../d7/d6f/test__linkedlists_8c.html#acd9db00336027462cfb25b97b5356883">c</a>;</div><div class="line"><a name="l01373"></a><span class="lineno"> 1373</span>&#160;   <span class="keywordtype">size_t</span> size = 0;</div><div class="line"><a name="l01374"></a><span class="lineno"> 1374</span>&#160;   <span class="keywordtype">int</span> <a class="code" href="../../df/d44/app__meetme_8c.html#a18b6f1cf748d864dd085819a7d4e6680">first</a> = 1;</div><div class="line"><a name="l01375"></a><span class="lineno"> 1375</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d2/db8/structast__fax__document.html">ast_fax_document</a> *doc;</div><div class="line"><a name="l01376"></a><span class="lineno"> 1376</span>&#160;</div><div class="line"><a name="l01377"></a><span class="lineno"> 1377</span>&#160;   <span class="comment">/* don&#39;t process empty lists */</span></div><div class="line"><a name="l01378"></a><span class="lineno"> 1378</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../df/d90/linkedlists_8h.html#a4a1884cde93e53bef32ca85c194a1d05">AST_LIST_EMPTY</a>(&amp;details-&gt;<a class="code" href="../../d8/dc2/structast__fax__session__details.html#a14c20eed7d6d03b484ebc2cc7a447ea2">documents</a>)) {</div><div class="line"><a name="l01379"></a><span class="lineno"> 1379</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../d8/d8a/astmm_8h.html#ab263849d03fb892847be4986db759737">ast_strdup</a>(<span class="stringliteral">&quot;&quot;</span>);</div><div class="line"><a name="l01380"></a><span class="lineno"> 1380</span>&#160;   }</div><div class="line"><a name="l01381"></a><span class="lineno"> 1381</span>&#160;</div><div class="line"><a name="l01382"></a><span class="lineno"> 1382</span>&#160;   <span class="comment">/* Calculate the total length of all of the file names */</span></div><div class="line"><a name="l01383"></a><span class="lineno"> 1383</span>&#160;   <a class="code" href="../../df/d90/linkedlists_8h.html#a3008b2f4f236b72d8bcfb80e346324ef">AST_LIST_TRAVERSE</a>(&amp;details-&gt;<a class="code" href="../../d8/dc2/structast__fax__session__details.html#a14c20eed7d6d03b484ebc2cc7a447ea2">documents</a>, doc, <a class="code" href="../../d2/db8/structast__fax__document.html#a7d18bbe79e0371242e10316471016b3d">next</a>) {</div><div class="line"><a name="l01384"></a><span class="lineno"> 1384</span>&#160;      size += strlen(separator) + strlen(prefix) + strlen(doc-&gt;<a class="code" href="../../d2/db8/structast__fax__document.html#afae8c108f5d360038fa8b099eb4ab2f3">filename</a>);</div><div class="line"><a name="l01385"></a><span class="lineno"> 1385</span>&#160;   }</div><div class="line"><a name="l01386"></a><span class="lineno"> 1386</span>&#160;   size += 1; <span class="comment">/* add space for the terminating null */</span></div><div class="line"><a name="l01387"></a><span class="lineno"> 1387</span>&#160;</div><div class="line"><a name="l01388"></a><span class="lineno"> 1388</span>&#160;   <span class="keywordflow">if</span> (!(filenames = <a class="code" href="../../d8/d8a/astmm_8h.html#ae63d4f486bcf6eac7c1593f867717d91">ast_malloc</a>(size))) {</div><div class="line"><a name="l01389"></a><span class="lineno"> 1389</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l01390"></a><span class="lineno"> 1390</span>&#160;   }</div><div class="line"><a name="l01391"></a><span class="lineno"> 1391</span>&#160;   c = filenames;</div><div class="line"><a name="l01392"></a><span class="lineno"> 1392</span>&#160;</div><div class="line"><a name="l01393"></a><span class="lineno"> 1393</span>&#160;   <a class="code" href="../../d6/d90/strings_8h.html#a603020160399d4876ec09fd299ebcaf9">ast_build_string</a>(&amp;c, &amp;size, <span class="stringliteral">&quot;%s%s&quot;</span>, prefix, <a class="code" href="../../df/d90/linkedlists_8h.html#adf1959c5c03a3a706da97ad2f49617e5">AST_LIST_FIRST</a>(&amp;details-&gt;<a class="code" href="../../d8/dc2/structast__fax__session__details.html#a14c20eed7d6d03b484ebc2cc7a447ea2">documents</a>)-&gt;filename);</div><div class="line"><a name="l01394"></a><span class="lineno"> 1394</span>&#160;   <a class="code" href="../../df/d90/linkedlists_8h.html#a3008b2f4f236b72d8bcfb80e346324ef">AST_LIST_TRAVERSE</a>(&amp;details-&gt;<a class="code" href="../../d8/dc2/structast__fax__session__details.html#a14c20eed7d6d03b484ebc2cc7a447ea2">documents</a>, doc, <a class="code" href="../../d2/db8/structast__fax__document.html#a7d18bbe79e0371242e10316471016b3d">next</a>) {</div><div class="line"><a name="l01395"></a><span class="lineno"> 1395</span>&#160;      <span class="keywordflow">if</span> (first) {</div><div class="line"><a name="l01396"></a><span class="lineno"> 1396</span>&#160;         first = 0;</div><div class="line"><a name="l01397"></a><span class="lineno"> 1397</span>&#160;         <span class="keywordflow">continue</span>;</div><div class="line"><a name="l01398"></a><span class="lineno"> 1398</span>&#160;      }</div><div class="line"><a name="l01399"></a><span class="lineno"> 1399</span>&#160;</div><div class="line"><a name="l01400"></a><span class="lineno"> 1400</span>&#160;      <a class="code" href="../../d6/d90/strings_8h.html#a603020160399d4876ec09fd299ebcaf9">ast_build_string</a>(&amp;c, &amp;size, <span class="stringliteral">&quot;%s%s%s&quot;</span>, separator, prefix, doc-&gt;<a class="code" href="../../d2/db8/structast__fax__document.html#afae8c108f5d360038fa8b099eb4ab2f3">filename</a>);</div><div class="line"><a name="l01401"></a><span class="lineno"> 1401</span>&#160;   }</div><div class="line"><a name="l01402"></a><span class="lineno"> 1402</span>&#160;</div><div class="line"><a name="l01403"></a><span class="lineno"> 1403</span>&#160;   <span class="keywordflow">return</span> filenames;</div><div class="line"><a name="l01404"></a><span class="lineno"> 1404</span>&#160;}</div><div class="line"><a name="l01405"></a><span class="lineno"> 1405</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01406"></a><span class="lineno"> 1406</span>&#160;<span class="comment">/*! \brief send a FAX status manager event */</span></div><div class="line"><a name="l01407"></a><span class="lineno"><a class="line" href="../../d0/d60/res__fax_8c.html#a38d73af44b480b7cad7a654f75926777"> 1407</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d0/d60/res__fax_8c.html#a38d73af44b480b7cad7a654f75926777">report_fax_status</a>(<span class="keyword">struct</span> <a class="code" href="../../df/d3c/structast__channel.html">ast_channel</a> *chan, <span class="keyword">struct</span> <a class="code" href="../../d8/dc2/structast__fax__session__details.html">ast_fax_session_details</a> *details, <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="../../de/dcd/app__jack_8c.html#ac191e5810fa65e63095409471eb5648f">status</a>)</div><div class="line"><a name="l01408"></a><span class="lineno"> 1408</span>&#160;{</div><div class="line"><a name="l01409"></a><span class="lineno"> 1409</span>&#160;   <a class="code" href="../../d5/d60/utils_8h.html#a1604b4d72144dd3d9f7da668e90337e9">RAII_VAR</a>(<span class="keyword">struct</span> <a class="code" href="../../d1/da1/structast__json.html">ast_json</a> *, json_object, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../d4/d05/json_8h.html#a33bcd9181e613a659eefe411ec42c87c">ast_json_unref</a>);</div><div class="line"><a name="l01410"></a><span class="lineno"> 1410</span>&#160;   <a class="code" href="../../d5/d60/utils_8h.html#a1604b4d72144dd3d9f7da668e90337e9">RAII_VAR</a>(<span class="keyword">struct</span> <a class="code" href="../../d7/d55/structstasis__message.html">stasis_message</a> *, <a class="code" href="../../d8/d9e/structmessage.html">message</a>, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../d5/da5/astobj2_8h.html#a6321ee982370c55ab3c24c72c562cbdd">ao2_cleanup</a>);</div><div class="line"><a name="l01411"></a><span class="lineno"> 1411</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d1/da1/structast__json.html">ast_json</a> *json_filenames = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l01412"></a><span class="lineno"> 1412</span>&#160;</div><div class="line"><a name="l01413"></a><span class="lineno"> 1413</span>&#160;   <span class="keywordflow">if</span> (!details-&gt;<a class="code" href="../../d8/dc2/structast__fax__session__details.html#a3ab211dbe8780b7292257f6b3dba1952">option</a>.<a class="code" href="../../d8/dc2/structast__fax__session__details.html#a7f633c7bc4fe667e873649afa4d44640">statusevents</a>) {</div><div class="line"><a name="l01414"></a><span class="lineno"> 1414</span>&#160;      <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l01415"></a><span class="lineno"> 1415</span>&#160;   }</div><div class="line"><a name="l01416"></a><span class="lineno"> 1416</span>&#160;</div><div class="line"><a name="l01417"></a><span class="lineno"> 1417</span>&#160;   json_filenames = <a class="code" href="../../d0/d60/res__fax_8c.html#a8dfe16760634f2d87db5508787023ef5">generate_filenames_json</a>(details);</div><div class="line"><a name="l01418"></a><span class="lineno"> 1418</span>&#160;   <span class="keywordflow">if</span> (!json_filenames) {</div><div class="line"><a name="l01419"></a><span class="lineno"> 1419</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l01420"></a><span class="lineno"> 1420</span>&#160;   }</div><div class="line"><a name="l01421"></a><span class="lineno"> 1421</span>&#160;</div><div class="line"><a name="l01422"></a><span class="lineno"> 1422</span>&#160;   json_object = <a class="code" href="../../d4/d05/json_8h.html#a99715667e822b2ad409b34ca041e535d">ast_json_pack</a>(<span class="stringliteral">&quot;{s: s, s: s, s: s, s: s, s: o}&quot;</span>,</div><div class="line"><a name="l01423"></a><span class="lineno"> 1423</span>&#160;      <span class="stringliteral">&quot;type&quot;</span>, <span class="stringliteral">&quot;status&quot;</span>,</div><div class="line"><a name="l01424"></a><span class="lineno"> 1424</span>&#160;      <span class="stringliteral">&quot;operation&quot;</span>, (details-&gt;<a class="code" href="../../d8/dc2/structast__fax__session__details.html#ad75375cdd336e91cbcee4a829fcdabfe">caps</a> &amp; <a class="code" href="../../db/d6a/res__fax_8h.html#a54eb45ad548b874cf12d0a599631e3f6add135550dca7400fb80e250a63a54887">AST_FAX_TECH_GATEWAY</a>)</div><div class="line"><a name="l01425"></a><span class="lineno"> 1425</span>&#160;         ? <span class="stringliteral">&quot;gateway&quot;</span></div><div class="line"><a name="l01426"></a><span class="lineno"> 1426</span>&#160;         : (details-&gt;<a class="code" href="../../d8/dc2/structast__fax__session__details.html#ad75375cdd336e91cbcee4a829fcdabfe">caps</a> &amp; <a class="code" href="../../db/d6a/res__fax_8h.html#a54eb45ad548b874cf12d0a599631e3f6a77bcc28b15614142ddbf4a180d263602">AST_FAX_TECH_RECEIVE</a>) ? <span class="stringliteral">&quot;receive&quot;</span> : <span class="stringliteral">&quot;send&quot;</span>,</div><div class="line"><a name="l01427"></a><span class="lineno"> 1427</span>&#160;      <span class="stringliteral">&quot;status&quot;</span>, status,</div><div class="line"><a name="l01428"></a><span class="lineno"> 1428</span>&#160;      <span class="stringliteral">&quot;local_station_id&quot;</span>, <a class="code" href="../../d4/d05/json_8h.html#ac319d5898e86709f7e25b1b2d73b7b12">AST_JSON_UTF8_VALIDATE</a>(details-&gt;<a class="code" href="../../d8/dc2/structast__fax__session__details.html#a045d24c59f1a8a85e8fbc745fff88140">localstationid</a>),</div><div class="line"><a name="l01429"></a><span class="lineno"> 1429</span>&#160;      <span class="stringliteral">&quot;filenames&quot;</span>, json_filenames);</div><div class="line"><a name="l01430"></a><span class="lineno"> 1430</span>&#160;   <span class="keywordflow">if</span> (!json_object) {</div><div class="line"><a name="l01431"></a><span class="lineno"> 1431</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l01432"></a><span class="lineno"> 1432</span>&#160;   }</div><div class="line"><a name="l01433"></a><span class="lineno"> 1433</span>&#160;</div><div class="line"><a name="l01434"></a><span class="lineno"> 1434</span>&#160;   {</div><div class="line"><a name="l01435"></a><span class="lineno"> 1435</span>&#160;      <a class="code" href="../../dd/d42/lock_8h.html#aa11d2e2d6aaa7048d48491842c1de738">SCOPED_CHANNELLOCK</a>(<a class="code" href="../../df/d44/app__meetme_8c.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>, chan);</div><div class="line"><a name="l01436"></a><span class="lineno"> 1436</span>&#160;</div><div class="line"><a name="l01437"></a><span class="lineno"> 1437</span>&#160;      <a class="code" href="../../d8/d9e/structmessage.html">message</a> = <a class="code" href="../../df/deb/group__StasisTopicsAndMessages.html#gafe8b123e0c124e44c3bff016591d3f9c">ast_channel_blob_create_from_cache</a>(<a class="code" href="../../d5/d7b/channel_8h.html#a3b6254f6d3832ef928f0a727113b1c63">ast_channel_uniqueid</a>(chan), <a class="code" href="../../df/deb/group__StasisTopicsAndMessages.html#ga6d11307e605e80f977bde354a11d7902">ast_channel_fax_type</a>(), json_object);</div><div class="line"><a name="l01438"></a><span class="lineno"> 1438</span>&#160;      <span class="keywordflow">if</span> (!<a class="code" href="../../d8/d9e/structmessage.html">message</a>) {</div><div class="line"><a name="l01439"></a><span class="lineno"> 1439</span>&#160;         <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l01440"></a><span class="lineno"> 1440</span>&#160;      }</div><div class="line"><a name="l01441"></a><span class="lineno"> 1441</span>&#160;      <a class="code" href="../../dd/d79/stasis_8h.html#ac43d0a33d111e9f34b441b285c166cfc">stasis_publish</a>(<a class="code" href="../../d5/d7b/channel_8h.html#afdeaf9abb1aecc715313a4f62c1cf9c9">ast_channel_topic</a>(chan), <a class="code" href="../../d8/d9e/structmessage.html">message</a>);</div><div class="line"><a name="l01442"></a><span class="lineno"> 1442</span>&#160;   }</div><div class="line"><a name="l01443"></a><span class="lineno"> 1443</span>&#160;   <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l01444"></a><span class="lineno"> 1444</span>&#160;}</div><div class="line"><a name="l01445"></a><span class="lineno"> 1445</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01446"></a><span class="lineno"> 1446</span>&#160;<span class="comment">/*! \brief Set fax related channel variables. */</span></div><div class="line"><a name="l01447"></a><span class="lineno"><a class="line" href="../../d0/d60/res__fax_8c.html#ad7732b5ae304d39afa2dacb20187cf04"> 1447</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d0/d60/res__fax_8c.html#ad7732b5ae304d39afa2dacb20187cf04">set_channel_variables</a>(<span class="keyword">struct</span> <a class="code" href="../../df/d3c/structast__channel.html">ast_channel</a> *chan, <span class="keyword">struct</span> <a class="code" href="../../d8/dc2/structast__fax__session__details.html">ast_fax_session_details</a> *details)</div><div class="line"><a name="l01448"></a><span class="lineno"> 1448</span>&#160;{</div><div class="line"><a name="l01449"></a><span class="lineno"> 1449</span>&#160;   <span class="keywordtype">char</span> <a class="code" href="../../dd/d7c/eagi__proxy_8c.html#ac95651d79c608a3148973b5b1fc9e525">buf</a>[10];</div><div class="line"><a name="l01450"></a><span class="lineno"> 1450</span>&#160;</div><div class="line"><a name="l01451"></a><span class="lineno"> 1451</span>&#160;   <a class="code" href="../../db/de0/pbx_8h.html#a6e5b90edb84d216267148dddcffe9b9a">pbx_builtin_setvar_helper</a>(chan, <span class="stringliteral">&quot;FAXSTATUS&quot;</span>, <a class="code" href="../../d6/d90/strings_8h.html#a2faaa16929951bfd2802b7829a100ba2">S_OR</a>(details-&gt;<a class="code" href="../../d8/dc2/structast__fax__session__details.html#a17c89d9cdcac0df0f2039f065b7cf0ed">result</a>, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>));</div><div class="line"><a name="l01452"></a><span class="lineno"> 1452</span>&#160;   <a class="code" href="../../db/de0/pbx_8h.html#a6e5b90edb84d216267148dddcffe9b9a">pbx_builtin_setvar_helper</a>(chan, <span class="stringliteral">&quot;FAXERROR&quot;</span>, <a class="code" href="../../d6/d90/strings_8h.html#a2faaa16929951bfd2802b7829a100ba2">S_OR</a>(details-&gt;<a class="code" href="../../d8/dc2/structast__fax__session__details.html#a9b0934c83ded1da0aa05bd8eb4677f93">error</a>, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>));</div><div class="line"><a name="l01453"></a><span class="lineno"> 1453</span>&#160;   <a class="code" href="../../db/de0/pbx_8h.html#a6e5b90edb84d216267148dddcffe9b9a">pbx_builtin_setvar_helper</a>(chan, <span class="stringliteral">&quot;FAXSTATUSSTRING&quot;</span>, <a class="code" href="../../d6/d90/strings_8h.html#a2faaa16929951bfd2802b7829a100ba2">S_OR</a>(details-&gt;<a class="code" href="../../d8/dc2/structast__fax__session__details.html#a8e155783a5296f8607948dfbe5783933">resultstr</a>, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>));</div><div class="line"><a name="l01454"></a><span class="lineno"> 1454</span>&#160;   <a class="code" href="../../db/de0/pbx_8h.html#a6e5b90edb84d216267148dddcffe9b9a">pbx_builtin_setvar_helper</a>(chan, <span class="stringliteral">&quot;REMOTESTATIONID&quot;</span>, <a class="code" href="../../d4/d05/json_8h.html#ac319d5898e86709f7e25b1b2d73b7b12">AST_JSON_UTF8_VALIDATE</a>(details-&gt;<a class="code" href="../../d8/dc2/structast__fax__session__details.html#acab313697f3cc547dbfede01ee743aa6">remotestationid</a>));</div><div class="line"><a name="l01455"></a><span class="lineno"> 1455</span>&#160;   <a class="code" href="../../db/de0/pbx_8h.html#a6e5b90edb84d216267148dddcffe9b9a">pbx_builtin_setvar_helper</a>(chan, <span class="stringliteral">&quot;LOCALSTATIONID&quot;</span>, <a class="code" href="../../d4/d05/json_8h.html#ac319d5898e86709f7e25b1b2d73b7b12">AST_JSON_UTF8_VALIDATE</a>(details-&gt;<a class="code" href="../../d8/dc2/structast__fax__session__details.html#a045d24c59f1a8a85e8fbc745fff88140">localstationid</a>));</div><div class="line"><a name="l01456"></a><span class="lineno"> 1456</span>&#160;   <a class="code" href="../../db/de0/pbx_8h.html#a6e5b90edb84d216267148dddcffe9b9a">pbx_builtin_setvar_helper</a>(chan, <span class="stringliteral">&quot;FAXBITRATE&quot;</span>, <a class="code" href="../../d6/d90/strings_8h.html#a2faaa16929951bfd2802b7829a100ba2">S_OR</a>(details-&gt;<a class="code" href="../../d8/dc2/structast__fax__session__details.html#acabbc07223706b9f471213b8e5dc1d58">transfer_rate</a>, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>));</div><div class="line"><a name="l01457"></a><span class="lineno"> 1457</span>&#160;   <a class="code" href="../../db/de0/pbx_8h.html#a6e5b90edb84d216267148dddcffe9b9a">pbx_builtin_setvar_helper</a>(chan, <span class="stringliteral">&quot;FAXRESOLUTION&quot;</span>, <a class="code" href="../../d6/d90/strings_8h.html#a2faaa16929951bfd2802b7829a100ba2">S_OR</a>(details-&gt;<a class="code" href="../../d8/dc2/structast__fax__session__details.html#ac832ac88c8237d922dfeba836a8d77ce">resolution</a>, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>));</div><div class="line"><a name="l01458"></a><span class="lineno"> 1458</span>&#160;</div><div class="line"><a name="l01459"></a><span class="lineno"> 1459</span>&#160;   <span class="keywordflow">if</span> (details-&gt;<a class="code" href="../../d8/dc2/structast__fax__session__details.html#aa3cf325797b2746fbd79f34b2fd45370">is_t38_negotiated</a>) {</div><div class="line"><a name="l01460"></a><span class="lineno"> 1460</span>&#160;      <a class="code" href="../../db/de0/pbx_8h.html#a6e5b90edb84d216267148dddcffe9b9a">pbx_builtin_setvar_helper</a>(chan, <span class="stringliteral">&quot;FAXMODE&quot;</span>, <span class="stringliteral">&quot;T38&quot;</span>);</div><div class="line"><a name="l01461"></a><span class="lineno"> 1461</span>&#160;   } <span class="keywordflow">else</span> {</div><div class="line"><a name="l01462"></a><span class="lineno"> 1462</span>&#160;      <a class="code" href="../../db/de0/pbx_8h.html#a6e5b90edb84d216267148dddcffe9b9a">pbx_builtin_setvar_helper</a>(chan, <span class="stringliteral">&quot;FAXMODE&quot;</span>, <span class="stringliteral">&quot;audio&quot;</span>);</div><div class="line"><a name="l01463"></a><span class="lineno"> 1463</span>&#160;   }</div><div class="line"><a name="l01464"></a><span class="lineno"> 1464</span>&#160;</div><div class="line"><a name="l01465"></a><span class="lineno"> 1465</span>&#160;   snprintf(buf, <span class="keyword">sizeof</span>(buf), <span class="stringliteral">&quot;%u&quot;</span>, details-&gt;<a class="code" href="../../d8/dc2/structast__fax__session__details.html#ac579558087dfa900a4c5384cb6e09dd8">pages_transferred</a>);</div><div class="line"><a name="l01466"></a><span class="lineno"> 1466</span>&#160;   <a class="code" href="../../db/de0/pbx_8h.html#a6e5b90edb84d216267148dddcffe9b9a">pbx_builtin_setvar_helper</a>(chan, <span class="stringliteral">&quot;FAXPAGES&quot;</span>, buf);</div><div class="line"><a name="l01467"></a><span class="lineno"> 1467</span>&#160;}</div><div class="line"><a name="l01468"></a><span class="lineno"> 1468</span>&#160;</div><div class="line"><a name="l01469"></a><span class="lineno"><a class="line" href="../../d0/d60/res__fax_8c.html#ac6fce80bf868971a37f69e9db4111924"> 1469</a></span>&#160;<span class="preprocessor">#define GENERIC_FAX_EXEC_SET_VARS(fax, chan, errorstr, reason) \</span></div><div class="line"><a name="l01470"></a><span class="lineno"> 1470</span>&#160;<span class="preprocessor">   do {  \</span></div><div class="line"><a name="l01471"></a><span class="lineno"> 1471</span>&#160;<span class="preprocessor">      if (ast_strlen_zero(fax-&gt;details-&gt;result)) \</span></div><div class="line"><a name="l01472"></a><span class="lineno"> 1472</span>&#160;<span class="preprocessor">         ast_string_field_set(fax-&gt;details, result, &quot;FAILED&quot;); \</span></div><div class="line"><a name="l01473"></a><span class="lineno"> 1473</span>&#160;<span class="preprocessor">      if (ast_strlen_zero(fax-&gt;details-&gt;resultstr)) \</span></div><div class="line"><a name="l01474"></a><span class="lineno"> 1474</span>&#160;<span class="preprocessor">         ast_string_field_set(fax-&gt;details, resultstr, reason); \</span></div><div class="line"><a name="l01475"></a><span class="lineno"> 1475</span>&#160;<span class="preprocessor">      if (ast_strlen_zero(fax-&gt;details-&gt;error)) \</span></div><div class="line"><a name="l01476"></a><span class="lineno"> 1476</span>&#160;<span class="preprocessor">         ast_string_field_set(fax-&gt;details, error, errorstr); \</span></div><div class="line"><a name="l01477"></a><span class="lineno"> 1477</span>&#160;<span class="preprocessor">      set_channel_variables(chan, fax-&gt;details); \</span></div><div class="line"><a name="l01478"></a><span class="lineno"> 1478</span>&#160;<span class="preprocessor">   } while (0)</span></div><div class="line"><a name="l01479"></a><span class="lineno"> 1479</span>&#160;</div><div class="line"><a name="l01480"></a><span class="lineno"><a class="line" href="../../d0/d60/res__fax_8c.html#a0915299f0fe9f1cc95bf988b7c554d81"> 1480</a></span>&#160;<span class="preprocessor">#define GENERIC_FAX_EXEC_ERROR_QUIET(fax, chan, errorstr, reason) \</span></div><div class="line"><a name="l01481"></a><span class="lineno"> 1481</span>&#160;<span class="preprocessor">   do {  \</span></div><div class="line"><a name="l01482"></a><span class="lineno"> 1482</span>&#160;<span class="preprocessor">      GENERIC_FAX_EXEC_SET_VARS(fax, chan, errorstr, reason); \</span></div><div class="line"><a name="l01483"></a><span class="lineno"> 1483</span>&#160;<span class="preprocessor">   } while (0)</span></div><div class="line"><a name="l01484"></a><span class="lineno"> 1484</span>&#160;</div><div class="line"><a name="l01485"></a><span class="lineno"><a class="line" href="../../d0/d60/res__fax_8c.html#aaf76f6af8369f4ef489b676433f3e255"> 1485</a></span>&#160;<span class="preprocessor">#define GENERIC_FAX_EXEC_ERROR(fax, chan, errorstr, reason) \</span></div><div class="line"><a name="l01486"></a><span class="lineno"> 1486</span>&#160;<span class="preprocessor">   do {  \</span></div><div class="line"><a name="l01487"></a><span class="lineno"> 1487</span>&#160;<span class="preprocessor">      ast_log(LOG_ERROR, &quot;channel &#39;%s&#39; FAX session &#39;%u&#39; failure, reason: &#39;%s&#39; (%s)\n&quot;, ast_channel_name(chan), fax-&gt;id, reason, errorstr); \</span></div><div class="line"><a name="l01488"></a><span class="lineno"> 1488</span>&#160;<span class="preprocessor">      GENERIC_FAX_EXEC_ERROR_QUIET(fax, chan, errorstr, reason); \</span></div><div class="line"><a name="l01489"></a><span class="lineno"> 1489</span>&#160;<span class="preprocessor">   } while (0)</span></div><div class="line"><a name="l01490"></a><span class="lineno"> 1490</span>&#160;</div><div class="line"><a name="l01491"></a><span class="lineno"><a class="line" href="../../d0/d60/res__fax_8c.html#abadd563fd124df50869cc1bdebf712be"> 1491</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d0/d60/res__fax_8c.html#abadd563fd124df50869cc1bdebf712be">set_fax_t38_caps</a>(<span class="keyword">struct</span> <a class="code" href="../../df/d3c/structast__channel.html">ast_channel</a> *chan, <span class="keyword">struct</span> <a class="code" href="../../d8/dc2/structast__fax__session__details.html">ast_fax_session_details</a> *details)</div><div class="line"><a name="l01492"></a><span class="lineno"> 1492</span>&#160;{</div><div class="line"><a name="l01493"></a><span class="lineno"> 1493</span>&#160;   <span class="keywordflow">switch</span> (<a class="code" href="../../d5/d7b/channel_8h.html#a1b22ea5302ef183fa68bc45bfb0659c9">ast_channel_get_t38_state</a>(chan)) {</div><div class="line"><a name="l01494"></a><span class="lineno"> 1494</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="../../d5/d7b/channel_8h.html#a4cd990f4c1cd0c2af6e4c63f6d15b4e1ab6834ded836bd85b489322f04984d274">T38_STATE_UNKNOWN</a>:</div><div class="line"><a name="l01495"></a><span class="lineno"> 1495</span>&#160;      details-&gt;<a class="code" href="../../d8/dc2/structast__fax__session__details.html#ad75375cdd336e91cbcee4a829fcdabfe">caps</a> |= <a class="code" href="../../db/d6a/res__fax_8h.html#a54eb45ad548b874cf12d0a599631e3f6a6868445e2802e5b71068ae883366f635">AST_FAX_TECH_T38</a>;</div><div class="line"><a name="l01496"></a><span class="lineno"> 1496</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l01497"></a><span class="lineno"> 1497</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="../../d5/d7b/channel_8h.html#a4cd990f4c1cd0c2af6e4c63f6d15b4e1ad3745918c0830d3816e5ce5561814e7e">T38_STATE_REJECTED</a>:</div><div class="line"><a name="l01498"></a><span class="lineno"> 1498</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="../../d5/d7b/channel_8h.html#a4cd990f4c1cd0c2af6e4c63f6d15b4e1a8bd9e539fb6a17b095fb24a75e0b4d21">T38_STATE_UNAVAILABLE</a>:</div><div class="line"><a name="l01499"></a><span class="lineno"> 1499</span>&#160;      details-&gt;<a class="code" href="../../d8/dc2/structast__fax__session__details.html#ad75375cdd336e91cbcee4a829fcdabfe">caps</a> |= <a class="code" href="../../db/d6a/res__fax_8h.html#a54eb45ad548b874cf12d0a599631e3f6a76fa4111df51955a949e95fadbccd48b">AST_FAX_TECH_AUDIO</a>;</div><div class="line"><a name="l01500"></a><span class="lineno"> 1500</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l01501"></a><span class="lineno"> 1501</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="../../d5/d7b/channel_8h.html#a4cd990f4c1cd0c2af6e4c63f6d15b4e1af142c79721a025bd65edad812f0725e0">T38_STATE_NEGOTIATED</a>:</div><div class="line"><a name="l01502"></a><span class="lineno"> 1502</span>&#160;      <span class="comment">/* already in T.38 mode? This should not happen. */</span></div><div class="line"><a name="l01503"></a><span class="lineno"> 1503</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="../../d5/d7b/channel_8h.html#a4cd990f4c1cd0c2af6e4c63f6d15b4e1afa1eab36050476591f803c3e234c2ed1">T38_STATE_NEGOTIATING</a>: {</div><div class="line"><a name="l01504"></a><span class="lineno"> 1504</span>&#160;      <span class="comment">/* the other end already sent us a T.38 reinvite, so we need to prod the channel</span></div><div class="line"><a name="l01505"></a><span class="lineno"> 1505</span>&#160;<span class="comment">       * driver into resending their parameters to us if it supports doing so... if</span></div><div class="line"><a name="l01506"></a><span class="lineno"> 1506</span>&#160;<span class="comment">       * not, we can&#39;t proceed, because we can&#39;t create a proper reply without them.</span></div><div class="line"><a name="l01507"></a><span class="lineno"> 1507</span>&#160;<span class="comment">       * if it does work, the channel driver will send an AST_CONTROL_T38_PARAMETERS</span></div><div class="line"><a name="l01508"></a><span class="lineno"> 1508</span>&#160;<span class="comment">       * with a request of AST_T38_REQUEST_NEGOTIATE, which will be read by the function</span></div><div class="line"><a name="l01509"></a><span class="lineno"> 1509</span>&#160;<span class="comment">       * that gets called after this one completes</span></div><div class="line"><a name="l01510"></a><span class="lineno"> 1510</span>&#160;<span class="comment">       */</span></div><div class="line"><a name="l01511"></a><span class="lineno"> 1511</span>&#160;      <span class="keyword">struct </span><a class="code" href="../../d5/def/structast__control__t38__parameters.html">ast_control_t38_parameters</a> parameters = { .<a class="code" href="../../d5/def/structast__control__t38__parameters.html#adb36822366e10ce64ca8337c512732a6">request_response</a> = <a class="code" href="../../d6/d66/include_2asterisk_2frame_8h.html#a168d496bdac09ece3ce49cf473bbdb4ba6763b3f21dd07811168f6959ee2d2082">AST_T38_REQUEST_PARMS</a>, };</div><div class="line"><a name="l01512"></a><span class="lineno"> 1512</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="../../d5/d7b/channel_8h.html#aa8c3522af1bc639cbd5b38f5fdf171fa">ast_indicate_data</a>(chan, <a class="code" href="../../d6/d66/include_2asterisk_2frame_8h.html#aedda41918e992000fe921f8f7363b390a7334c9d27a6d70fe7c85b60b864788fc">AST_CONTROL_T38_PARAMETERS</a>, &amp;parameters, <span class="keyword">sizeof</span>(parameters)) != <a class="code" href="../../d6/d66/include_2asterisk_2frame_8h.html#a168d496bdac09ece3ce49cf473bbdb4ba6763b3f21dd07811168f6959ee2d2082">AST_T38_REQUEST_PARMS</a>) {</div><div class="line"><a name="l01513"></a><span class="lineno"> 1513</span>&#160;         <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;channel &#39;%s&#39; is in an unsupported T.38 negotiation state, cannot continue.\n&quot;</span>, <a class="code" href="../../d5/d7b/channel_8h.html#a7ca2fda13b129a55c251b56729de285b">ast_channel_name</a>(chan));</div><div class="line"><a name="l01514"></a><span class="lineno"> 1514</span>&#160;         <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l01515"></a><span class="lineno"> 1515</span>&#160;      }</div><div class="line"><a name="l01516"></a><span class="lineno"> 1516</span>&#160;      details-&gt;<a class="code" href="../../d8/dc2/structast__fax__session__details.html#ad75375cdd336e91cbcee4a829fcdabfe">caps</a> |= <a class="code" href="../../db/d6a/res__fax_8h.html#a54eb45ad548b874cf12d0a599631e3f6a6868445e2802e5b71068ae883366f635">AST_FAX_TECH_T38</a>;</div><div class="line"><a name="l01517"></a><span class="lineno"> 1517</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l01518"></a><span class="lineno"> 1518</span>&#160;   }</div><div class="line"><a name="l01519"></a><span class="lineno"> 1519</span>&#160;   <span class="keywordflow">default</span>:</div><div class="line"><a name="l01520"></a><span class="lineno"> 1520</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;channel &#39;%s&#39; is in an unsupported T.38 negotiation state, cannot continue.\n&quot;</span>, <a class="code" href="../../d5/d7b/channel_8h.html#a7ca2fda13b129a55c251b56729de285b">ast_channel_name</a>(chan));</div><div class="line"><a name="l01521"></a><span class="lineno"> 1521</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l01522"></a><span class="lineno"> 1522</span>&#160;   }</div><div class="line"><a name="l01523"></a><span class="lineno"> 1523</span>&#160;</div><div class="line"><a name="l01524"></a><span class="lineno"> 1524</span>&#160;   <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l01525"></a><span class="lineno"> 1525</span>&#160;}</div><div class="line"><a name="l01526"></a><span class="lineno"> 1526</span>&#160;</div><div class="line"><a name="l01527"></a><span class="lineno"><a class="line" href="../../d0/d60/res__fax_8c.html#ae3ee13924d0059d65a340212b5117a48"> 1527</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d0/d60/res__fax_8c.html#ae3ee13924d0059d65a340212b5117a48">disable_t38</a>(<span class="keyword">struct</span> <a class="code" href="../../df/d3c/structast__channel.html">ast_channel</a> *chan)</div><div class="line"><a name="l01528"></a><span class="lineno"> 1528</span>&#160;{</div><div class="line"><a name="l01529"></a><span class="lineno"> 1529</span>&#160;   <span class="keywordtype">int</span> timeout_ms;</div><div class="line"><a name="l01530"></a><span class="lineno"> 1530</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d0/d99/structast__frame.html">ast_frame</a> *frame = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l01531"></a><span class="lineno"> 1531</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d5/def/structast__control__t38__parameters.html">ast_control_t38_parameters</a> t38_parameters = { .<a class="code" href="../../d5/def/structast__control__t38__parameters.html#adb36822366e10ce64ca8337c512732a6">request_response</a> = <a class="code" href="../../d6/d66/include_2asterisk_2frame_8h.html#a168d496bdac09ece3ce49cf473bbdb4bab75e46d3212a2a886143d874c78a1e3c">AST_T38_REQUEST_TERMINATE</a>, };</div><div class="line"><a name="l01532"></a><span class="lineno"> 1532</span>&#160;   <span class="keyword">struct </span>timeval start;</div><div class="line"><a name="l01533"></a><span class="lineno"> 1533</span>&#160;   <span class="keywordtype">int</span> ms;</div><div class="line"><a name="l01534"></a><span class="lineno"> 1534</span>&#160;</div><div class="line"><a name="l01535"></a><span class="lineno"> 1535</span>&#160;   <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(1, <span class="stringliteral">&quot;Shutting down T.38 on %s\n&quot;</span>, <a class="code" href="../../d5/d7b/channel_8h.html#a7ca2fda13b129a55c251b56729de285b">ast_channel_name</a>(chan));</div><div class="line"><a name="l01536"></a><span class="lineno"> 1536</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d5/d7b/channel_8h.html#aa8c3522af1bc639cbd5b38f5fdf171fa">ast_indicate_data</a>(chan, <a class="code" href="../../d6/d66/include_2asterisk_2frame_8h.html#aedda41918e992000fe921f8f7363b390a7334c9d27a6d70fe7c85b60b864788fc">AST_CONTROL_T38_PARAMETERS</a>, &amp;t38_parameters, <span class="keyword">sizeof</span>(t38_parameters)) != 0) {</div><div class="line"><a name="l01537"></a><span class="lineno"> 1537</span>&#160;      <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(1, <span class="stringliteral">&quot;error while disabling T.38 on channel &#39;%s&#39;\n&quot;</span>, <a class="code" href="../../d5/d7b/channel_8h.html#a7ca2fda13b129a55c251b56729de285b">ast_channel_name</a>(chan));</div><div class="line"><a name="l01538"></a><span class="lineno"> 1538</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l01539"></a><span class="lineno"> 1539</span>&#160;   }</div><div class="line"><a name="l01540"></a><span class="lineno"> 1540</span>&#160;</div><div class="line"><a name="l01541"></a><span class="lineno"> 1541</span>&#160;   <span class="comment">/* wait up to five seconds for negotiation to complete */</span></div><div class="line"><a name="l01542"></a><span class="lineno"> 1542</span>&#160;   timeout_ms = 5000;</div><div class="line"><a name="l01543"></a><span class="lineno"> 1543</span>&#160;   start = <a class="code" href="../../de/df7/time_8h.html#ad3899efb6f0e348556ef69f5b16aa7f7">ast_tvnow</a>();</div><div class="line"><a name="l01544"></a><span class="lineno"> 1544</span>&#160;   <span class="keywordflow">while</span> ((ms = <a class="code" href="../../de/df7/time_8h.html#a904a6933b710e14c7fa2029a0f0cc91a">ast_remaining_ms</a>(start, timeout_ms))) {</div><div class="line"><a name="l01545"></a><span class="lineno"> 1545</span>&#160;      ms = <a class="code" href="../../d5/d7b/channel_8h.html#a60e0bcaed001e8d5ed1ba0eb2644b3cc">ast_waitfor</a>(chan, ms);</div><div class="line"><a name="l01546"></a><span class="lineno"> 1546</span>&#160;</div><div class="line"><a name="l01547"></a><span class="lineno"> 1547</span>&#160;      <span class="keywordflow">if</span> (ms == 0) {</div><div class="line"><a name="l01548"></a><span class="lineno"> 1548</span>&#160;         <span class="keywordflow">break</span>;</div><div class="line"><a name="l01549"></a><span class="lineno"> 1549</span>&#160;      }</div><div class="line"><a name="l01550"></a><span class="lineno"> 1550</span>&#160;      <span class="keywordflow">if</span> (ms &lt; 0) {</div><div class="line"><a name="l01551"></a><span class="lineno"> 1551</span>&#160;         <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(1, <span class="stringliteral">&quot;error while disabling T.38 on channel &#39;%s&#39;\n&quot;</span>, <a class="code" href="../../d5/d7b/channel_8h.html#a7ca2fda13b129a55c251b56729de285b">ast_channel_name</a>(chan));</div><div class="line"><a name="l01552"></a><span class="lineno"> 1552</span>&#160;         <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l01553"></a><span class="lineno"> 1553</span>&#160;      }</div><div class="line"><a name="l01554"></a><span class="lineno"> 1554</span>&#160;</div><div class="line"><a name="l01555"></a><span class="lineno"> 1555</span>&#160;      <span class="keywordflow">if</span> (!(frame = <a class="code" href="../../d5/d7b/channel_8h.html#a7ef6737309dc9e8b6c4a7cb4800638b1">ast_read</a>(chan))) {</div><div class="line"><a name="l01556"></a><span class="lineno"> 1556</span>&#160;         <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l01557"></a><span class="lineno"> 1557</span>&#160;      }</div><div class="line"><a name="l01558"></a><span class="lineno"> 1558</span>&#160;      <span class="keywordflow">if</span> ((frame-&gt;<a class="code" href="../../d0/d99/structast__frame.html#a6937b93c56cb473b547eda454dca7b4c">frametype</a> == <a class="code" href="../../d6/d66/include_2asterisk_2frame_8h.html#ae2e1a9c4e048da387b761f619312d6e0ae1dae388b0d70825876e137ae95bb0c1">AST_FRAME_CONTROL</a>) &amp;&amp;</div><div class="line"><a name="l01559"></a><span class="lineno"> 1559</span>&#160;          (frame-&gt;<a class="code" href="../../d0/d99/structast__frame.html#a27237c48fdcd22556401f20c693811db">subclass</a>.<a class="code" href="../../d1/d9f/structast__frame__subclass.html#adece183191b0e700e039e59101e06105">integer</a> == <a class="code" href="../../d6/d66/include_2asterisk_2frame_8h.html#aedda41918e992000fe921f8f7363b390a7334c9d27a6d70fe7c85b60b864788fc">AST_CONTROL_T38_PARAMETERS</a>) &amp;&amp;</div><div class="line"><a name="l01560"></a><span class="lineno"> 1560</span>&#160;          (frame-&gt;<a class="code" href="../../d0/d99/structast__frame.html#ad67e07841d1233e596e6f822a3c81f6b">datalen</a> == <span class="keyword">sizeof</span>(t38_parameters))) {</div><div class="line"><a name="l01561"></a><span class="lineno"> 1561</span>&#160;         <span class="keyword">struct </span><a class="code" href="../../d5/def/structast__control__t38__parameters.html">ast_control_t38_parameters</a> *parameters = frame-&gt;<a class="code" href="../../d0/d99/structast__frame.html#a4027905f872af30d910929b07e261ca5">data</a>.<a class="code" href="../../d0/d99/structast__frame.html#add9af9569af79ec26dd741fb226b38ba">ptr</a>;</div><div class="line"><a name="l01562"></a><span class="lineno"> 1562</span>&#160;</div><div class="line"><a name="l01563"></a><span class="lineno"> 1563</span>&#160;         <span class="keywordflow">switch</span> (parameters-&gt;<a class="code" href="../../d5/def/structast__control__t38__parameters.html#adb36822366e10ce64ca8337c512732a6">request_response</a>) {</div><div class="line"><a name="l01564"></a><span class="lineno"> 1564</span>&#160;         <span class="keywordflow">case</span> <a class="code" href="../../d6/d66/include_2asterisk_2frame_8h.html#a168d496bdac09ece3ce49cf473bbdb4ba9df578b4287c86673d7f40f9abcdc86f">AST_T38_TERMINATED</a>:</div><div class="line"><a name="l01565"></a><span class="lineno"> 1565</span>&#160;            <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(1, <span class="stringliteral">&quot;Shut down T.38 on %s\n&quot;</span>, <a class="code" href="../../d5/d7b/channel_8h.html#a7ca2fda13b129a55c251b56729de285b">ast_channel_name</a>(chan));</div><div class="line"><a name="l01566"></a><span class="lineno"> 1566</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l01567"></a><span class="lineno"> 1567</span>&#160;         <span class="keywordflow">case</span> <a class="code" href="../../d6/d66/include_2asterisk_2frame_8h.html#a168d496bdac09ece3ce49cf473bbdb4baa02b30f25621f20396d06f5ac8aa7a2e">AST_T38_REFUSED</a>:</div><div class="line"><a name="l01568"></a><span class="lineno"> 1568</span>&#160;            <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;channel &#39;%s&#39; refused to disable T.38\n&quot;</span>, <a class="code" href="../../d5/d7b/channel_8h.html#a7ca2fda13b129a55c251b56729de285b">ast_channel_name</a>(chan));</div><div class="line"><a name="l01569"></a><span class="lineno"> 1569</span>&#160;            <a class="code" href="../../d6/d66/include_2asterisk_2frame_8h.html#a6440d070425a2efe8e0aa71e8d9e47b7">ast_frfree</a>(frame);</div><div class="line"><a name="l01570"></a><span class="lineno"> 1570</span>&#160;            <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l01571"></a><span class="lineno"> 1571</span>&#160;         <span class="keywordflow">default</span>:</div><div class="line"><a name="l01572"></a><span class="lineno"> 1572</span>&#160;            <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;channel &#39;%s&#39; failed to disable T.38\n&quot;</span>, <a class="code" href="../../d5/d7b/channel_8h.html#a7ca2fda13b129a55c251b56729de285b">ast_channel_name</a>(chan));</div><div class="line"><a name="l01573"></a><span class="lineno"> 1573</span>&#160;            <a class="code" href="../../d6/d66/include_2asterisk_2frame_8h.html#a6440d070425a2efe8e0aa71e8d9e47b7">ast_frfree</a>(frame);</div><div class="line"><a name="l01574"></a><span class="lineno"> 1574</span>&#160;            <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l01575"></a><span class="lineno"> 1575</span>&#160;         }</div><div class="line"><a name="l01576"></a><span class="lineno"> 1576</span>&#160;         <a class="code" href="../../d6/d66/include_2asterisk_2frame_8h.html#a6440d070425a2efe8e0aa71e8d9e47b7">ast_frfree</a>(frame);</div><div class="line"><a name="l01577"></a><span class="lineno"> 1577</span>&#160;         <span class="keywordflow">break</span>;</div><div class="line"><a name="l01578"></a><span class="lineno"> 1578</span>&#160;      }</div><div class="line"><a name="l01579"></a><span class="lineno"> 1579</span>&#160;      <a class="code" href="../../d6/d66/include_2asterisk_2frame_8h.html#a6440d070425a2efe8e0aa71e8d9e47b7">ast_frfree</a>(frame);</div><div class="line"><a name="l01580"></a><span class="lineno"> 1580</span>&#160;   }</div><div class="line"><a name="l01581"></a><span class="lineno"> 1581</span>&#160;</div><div class="line"><a name="l01582"></a><span class="lineno"> 1582</span>&#160;   <span class="keywordflow">if</span> (ms == 0) { <span class="comment">/* all done, nothing happened */</span></div><div class="line"><a name="l01583"></a><span class="lineno"> 1583</span>&#160;      <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(1, <span class="stringliteral">&quot;channel &#39;%s&#39; timed-out during T.38 shutdown\n&quot;</span>, <a class="code" href="../../d5/d7b/channel_8h.html#a7ca2fda13b129a55c251b56729de285b">ast_channel_name</a>(chan));</div><div class="line"><a name="l01584"></a><span class="lineno"> 1584</span>&#160;   }</div><div class="line"><a name="l01585"></a><span class="lineno"> 1585</span>&#160;</div><div class="line"><a name="l01586"></a><span class="lineno"> 1586</span>&#160;   <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l01587"></a><span class="lineno"> 1587</span>&#160;}</div><div class="line"><a name="l01588"></a><span class="lineno"> 1588</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01589"></a><span class="lineno"> 1589</span>&#160;<span class="comment">/*! \brief this is the generic FAX session handling function */</span></div><div class="line"><a name="l01590"></a><span class="lineno"><a class="line" href="../../d0/d60/res__fax_8c.html#a779e8d2cf3518f35900b9089a2c344ec"> 1590</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d0/d60/res__fax_8c.html#a779e8d2cf3518f35900b9089a2c344ec">generic_fax_exec</a>(<span class="keyword">struct</span> <a class="code" href="../../df/d3c/structast__channel.html">ast_channel</a> *chan, <span class="keyword">struct</span> <a class="code" href="../../d8/dc2/structast__fax__session__details.html">ast_fax_session_details</a> *details, <span class="keyword">struct</span> <a class="code" href="../../d1/d16/structast__fax__session.html">ast_fax_session</a> *reserved, <span class="keyword">struct</span> ast_fax_tech_token *token)</div><div class="line"><a name="l01591"></a><span class="lineno"> 1591</span>&#160;{</div><div class="line"><a name="l01592"></a><span class="lineno"> 1592</span>&#160;   <span class="keywordtype">int</span> ms;</div><div class="line"><a name="l01593"></a><span class="lineno"> 1593</span>&#160;   <span class="keywordtype">int</span> timeout = <a class="code" href="../../d0/d60/res__fax_8c.html#affb9d2b3b67e36e7e7ad9b4055de7630">RES_FAX_TIMEOUT</a>;</div><div class="line"><a name="l01594"></a><span class="lineno"> 1594</span>&#160;   <span class="keywordtype">int</span> <a class="code" href="../../d4/d28/channel_8c.html#a5cb129ce1d580dbb22ec9573dcb62f7f">chancount</a>;</div><div class="line"><a name="l01595"></a><span class="lineno"> 1595</span>&#160;   <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> expected_frametype = -1;</div><div class="line"><a name="l01596"></a><span class="lineno"> 1596</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d1/d9f/structast__frame__subclass.html">ast_frame_subclass</a> expected_framesubclass = { .<a class="code" href="../../d1/d9f/structast__frame__subclass.html#adece183191b0e700e039e59101e06105">integer</a> = 0, };</div><div class="line"><a name="l01597"></a><span class="lineno"> 1597</span>&#160;   <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> t38negotiated = (<a class="code" href="../../d5/d7b/channel_8h.html#a1b22ea5302ef183fa68bc45bfb0659c9">ast_channel_get_t38_state</a>(chan) == <a class="code" href="../../d5/d7b/channel_8h.html#a4cd990f4c1cd0c2af6e4c63f6d15b4e1af142c79721a025bd65edad812f0725e0">T38_STATE_NEGOTIATED</a>);</div><div class="line"><a name="l01598"></a><span class="lineno"> 1598</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d5/def/structast__control__t38__parameters.html">ast_control_t38_parameters</a> t38_parameters;</div><div class="line"><a name="l01599"></a><span class="lineno"> 1599</span>&#160;   <span class="keyword">const</span> <span class="keywordtype">char</span> *tempvar;</div><div class="line"><a name="l01600"></a><span class="lineno"> 1600</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d1/d16/structast__fax__session.html">ast_fax_session</a> *fax = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l01601"></a><span class="lineno"> 1601</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d0/d99/structast__frame.html">ast_frame</a> *frame = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l01602"></a><span class="lineno"> 1602</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../df/d3c/structast__channel.html">ast_channel</a> *<a class="code" href="../../d7/d6f/test__linkedlists_8c.html#acd9db00336027462cfb25b97b5356883">c</a> = chan;</div><div class="line"><a name="l01603"></a><span class="lineno"> 1603</span>&#160;   <a class="code" href="../../d5/d60/utils_8h.html#a1604b4d72144dd3d9f7da668e90337e9">RAII_VAR</a>(<span class="keyword">struct</span> <a class="code" href="../../d0/d98/structast__format.html">ast_format</a> *, orig_write_format, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../d5/da5/astobj2_8h.html#a6321ee982370c55ab3c24c72c562cbdd">ao2_cleanup</a>);</div><div class="line"><a name="l01604"></a><span class="lineno"> 1604</span>&#160;   <a class="code" href="../../d5/d60/utils_8h.html#a1604b4d72144dd3d9f7da668e90337e9">RAII_VAR</a>(<span class="keyword">struct</span> <a class="code" href="../../d0/d98/structast__format.html">ast_format</a> *, orig_read_format, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../d5/da5/astobj2_8h.html#a6321ee982370c55ab3c24c72c562cbdd">ao2_cleanup</a>);</div><div class="line"><a name="l01605"></a><span class="lineno"> 1605</span>&#160;   <span class="keywordtype">int</span> remaining_time;</div><div class="line"><a name="l01606"></a><span class="lineno"> 1606</span>&#160;   <span class="keyword">struct </span>timeval start;</div><div class="line"><a name="l01607"></a><span class="lineno"> 1607</span>&#160;</div><div class="line"><a name="l01608"></a><span class="lineno"> 1608</span>&#160;   chancount = 1;</div><div class="line"><a name="l01609"></a><span class="lineno"> 1609</span>&#160;</div><div class="line"><a name="l01610"></a><span class="lineno"> 1610</span>&#160;   <span class="comment">/* Make sure one or the other is set to avoid race condition */</span></div><div class="line"><a name="l01611"></a><span class="lineno"> 1611</span>&#160;   <span class="keywordflow">if</span> (t38negotiated) {</div><div class="line"><a name="l01612"></a><span class="lineno"> 1612</span>&#160;      details-&gt;<a class="code" href="../../d8/dc2/structast__fax__session__details.html#ad75375cdd336e91cbcee4a829fcdabfe">caps</a> |= <a class="code" href="../../db/d6a/res__fax_8h.html#a54eb45ad548b874cf12d0a599631e3f6a6868445e2802e5b71068ae883366f635">AST_FAX_TECH_T38</a>;</div><div class="line"><a name="l01613"></a><span class="lineno"> 1613</span>&#160;   } <span class="keywordflow">else</span> {</div><div class="line"><a name="l01614"></a><span class="lineno"> 1614</span>&#160;      details-&gt;<a class="code" href="../../d8/dc2/structast__fax__session__details.html#ad75375cdd336e91cbcee4a829fcdabfe">caps</a> |= <a class="code" href="../../db/d6a/res__fax_8h.html#a54eb45ad548b874cf12d0a599631e3f6a76fa4111df51955a949e95fadbccd48b">AST_FAX_TECH_AUDIO</a>;</div><div class="line"><a name="l01615"></a><span class="lineno"> 1615</span>&#160;   }</div><div class="line"><a name="l01616"></a><span class="lineno"> 1616</span>&#160;</div><div class="line"><a name="l01617"></a><span class="lineno"> 1617</span>&#160;   <span class="comment">/* create the FAX session */</span></div><div class="line"><a name="l01618"></a><span class="lineno"> 1618</span>&#160;   <span class="keywordflow">if</span> (!(fax = <a class="code" href="../../d0/d60/res__fax_8c.html#a7ca6ede68de97a21f49d381ef9014ae1">fax_session_new</a>(details, chan, reserved, token))) {</div><div class="line"><a name="l01619"></a><span class="lineno"> 1619</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Can&#39;t create a FAX session, FAX attempt failed.\n&quot;</span>);</div><div class="line"><a name="l01620"></a><span class="lineno"> 1620</span>&#160;      <a class="code" href="../../d0/d60/res__fax_8c.html#a38d73af44b480b7cad7a654f75926777">report_fax_status</a>(chan, details, <span class="stringliteral">&quot;No Available Resource&quot;</span>);</div><div class="line"><a name="l01621"></a><span class="lineno"> 1621</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l01622"></a><span class="lineno"> 1622</span>&#160;   }</div><div class="line"><a name="l01623"></a><span class="lineno"> 1623</span>&#160;</div><div class="line"><a name="l01624"></a><span class="lineno"> 1624</span>&#160;   <a class="code" href="../../d5/d7b/channel_8h.html#a493bdebe876caafb8ee535853310364a">ast_channel_lock</a>(chan);</div><div class="line"><a name="l01625"></a><span class="lineno"> 1625</span>&#160;   <span class="comment">/* update session details */</span></div><div class="line"><a name="l01626"></a><span class="lineno"> 1626</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a>(details-&gt;<a class="code" href="../../d8/dc2/structast__fax__session__details.html#a6e3b307f2cde58ca9c7ed2c150e4c53c">headerinfo</a>) &amp;&amp; (tempvar = <a class="code" href="../../db/de0/pbx_8h.html#a98c5425b90ec7c5e136a40f529170b1b">pbx_builtin_getvar_helper</a>(chan, <span class="stringliteral">&quot;LOCALHEADERINFO&quot;</span>))) {</div><div class="line"><a name="l01627"></a><span class="lineno"> 1627</span>&#160;      <a class="code" href="../../d1/d0f/stringfields_8h.html#a653461abd6e0d16e4e3326ab90e0501d">ast_string_field_set</a>(details, headerinfo, tempvar);</div><div class="line"><a name="l01628"></a><span class="lineno"> 1628</span>&#160;   }</div><div class="line"><a name="l01629"></a><span class="lineno"> 1629</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a>(details-&gt;<a class="code" href="../../d8/dc2/structast__fax__session__details.html#a045d24c59f1a8a85e8fbc745fff88140">localstationid</a>)) {</div><div class="line"><a name="l01630"></a><span class="lineno"> 1630</span>&#160;      tempvar = <a class="code" href="../../db/de0/pbx_8h.html#a98c5425b90ec7c5e136a40f529170b1b">pbx_builtin_getvar_helper</a>(chan, <span class="stringliteral">&quot;LOCALSTATIONID&quot;</span>);</div><div class="line"><a name="l01631"></a><span class="lineno"> 1631</span>&#160;      <a class="code" href="../../d1/d0f/stringfields_8h.html#a653461abd6e0d16e4e3326ab90e0501d">ast_string_field_set</a>(details, localstationid, tempvar ? tempvar : <span class="stringliteral">&quot;unknown&quot;</span>);</div><div class="line"><a name="l01632"></a><span class="lineno"> 1632</span>&#160;   }</div><div class="line"><a name="l01633"></a><span class="lineno"> 1633</span>&#160;   <a class="code" href="../../d5/d7b/channel_8h.html#af476c537b29be3f29240489032f9db39">ast_channel_unlock</a>(chan);</div><div class="line"><a name="l01634"></a><span class="lineno"> 1634</span>&#160;</div><div class="line"><a name="l01635"></a><span class="lineno"> 1635</span>&#160;   <a class="code" href="../../d0/d60/res__fax_8c.html#a38d73af44b480b7cad7a654f75926777">report_fax_status</a>(chan, details, <span class="stringliteral">&quot;Allocating Resources&quot;</span>);</div><div class="line"><a name="l01636"></a><span class="lineno"> 1636</span>&#160;</div><div class="line"><a name="l01637"></a><span class="lineno"> 1637</span>&#160;   <span class="keywordflow">if</span> (details-&gt;<a class="code" href="../../d8/dc2/structast__fax__session__details.html#ad75375cdd336e91cbcee4a829fcdabfe">caps</a> &amp; <a class="code" href="../../db/d6a/res__fax_8h.html#a54eb45ad548b874cf12d0a599631e3f6a76fa4111df51955a949e95fadbccd48b">AST_FAX_TECH_AUDIO</a>) {</div><div class="line"><a name="l01638"></a><span class="lineno"> 1638</span>&#160;      expected_frametype = <a class="code" href="../../d6/d66/include_2asterisk_2frame_8h.html#ae2e1a9c4e048da387b761f619312d6e0aa457fe7005f11bb7b21453f9bb4caa8f">AST_FRAME_VOICE</a>;</div><div class="line"><a name="l01639"></a><span class="lineno"> 1639</span>&#160;      expected_framesubclass.<a class="code" href="../../d1/d9f/structast__frame__subclass.html#ab425a484a0916077c5a30d9d7b229b44">format</a> = <a class="code" href="../../db/d1c/format__cache_8h.html#a771d7c34570e8e492c25a0c2eb41889d">ast_format_slin</a>;</div><div class="line"><a name="l01640"></a><span class="lineno"> 1640</span>&#160;      orig_write_format = <a class="code" href="../../d5/da5/astobj2_8h.html#ac438c3fcd3150481fad38689fd813a15">ao2_bump</a>(<a class="code" href="../../d5/d7b/channel_8h.html#a1dc625bd14a7875b04bfe0c388858929">ast_channel_writeformat</a>(chan));</div><div class="line"><a name="l01641"></a><span class="lineno"> 1641</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="../../d5/d7b/channel_8h.html#abbdfb98077180544657b2d16c5d25f74">ast_set_write_format</a>(chan, <a class="code" href="../../db/d1c/format__cache_8h.html#a771d7c34570e8e492c25a0c2eb41889d">ast_format_slin</a>) &lt; 0) {</div><div class="line"><a name="l01642"></a><span class="lineno"> 1642</span>&#160;         <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;channel &#39;%s&#39; failed to set write format to signed linear&#39;.\n&quot;</span>, <a class="code" href="../../d5/d7b/channel_8h.html#a7ca2fda13b129a55c251b56729de285b">ast_channel_name</a>(chan));</div><div class="line"><a name="l01643"></a><span class="lineno"> 1643</span>&#160;         <a class="code" href="../../d5/da5/astobj2_8h.html#a64f51be4bee35c38dbe59b0a788b5ce8">ao2_unlink</a>(<a class="code" href="../../d0/d60/res__fax_8c.html#a058b6772fcfe1ce5a1a0957e2f11d367">faxregistry</a>.container, fax);</div><div class="line"><a name="l01644"></a><span class="lineno"> 1644</span>&#160;         <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(fax, -1);</div><div class="line"><a name="l01645"></a><span class="lineno"> 1645</span>&#160;         <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l01646"></a><span class="lineno"> 1646</span>&#160;      }</div><div class="line"><a name="l01647"></a><span class="lineno"> 1647</span>&#160;      orig_read_format = <a class="code" href="../../d5/da5/astobj2_8h.html#ac438c3fcd3150481fad38689fd813a15">ao2_bump</a>(<a class="code" href="../../d5/d7b/channel_8h.html#aaced431562223538a94e0e69cf94151a">ast_channel_readformat</a>(chan));</div><div class="line"><a name="l01648"></a><span class="lineno"> 1648</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="../../d5/d7b/channel_8h.html#a9107a83365cbf327cc0d12cb0dbd28d8">ast_set_read_format</a>(chan, <a class="code" href="../../db/d1c/format__cache_8h.html#a771d7c34570e8e492c25a0c2eb41889d">ast_format_slin</a>) &lt; 0) {</div><div class="line"><a name="l01649"></a><span class="lineno"> 1649</span>&#160;         <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;channel &#39;%s&#39; failed to set read format to signed linear.\n&quot;</span>, <a class="code" href="../../d5/d7b/channel_8h.html#a7ca2fda13b129a55c251b56729de285b">ast_channel_name</a>(chan));</div><div class="line"><a name="l01650"></a><span class="lineno"> 1650</span>&#160;         <a class="code" href="../../d5/da5/astobj2_8h.html#a64f51be4bee35c38dbe59b0a788b5ce8">ao2_unlink</a>(<a class="code" href="../../d0/d60/res__fax_8c.html#a058b6772fcfe1ce5a1a0957e2f11d367">faxregistry</a>.container, fax);</div><div class="line"><a name="l01651"></a><span class="lineno"> 1651</span>&#160;         <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(fax, -1);</div><div class="line"><a name="l01652"></a><span class="lineno"> 1652</span>&#160;         <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l01653"></a><span class="lineno"> 1653</span>&#160;      }</div><div class="line"><a name="l01654"></a><span class="lineno"> 1654</span>&#160;      <span class="keywordflow">if</span> (fax-&gt;<a class="code" href="../../d1/d16/structast__fax__session.html#a34ee6625e0f7d45c4e35cd409cb42e21">smoother</a>) {</div><div class="line"><a name="l01655"></a><span class="lineno"> 1655</span>&#160;         <a class="code" href="../../d6/d7f/smoother_8h.html#a6d3b71e0a81af743bae6c33c02b64f1f">ast_smoother_free</a>(fax-&gt;<a class="code" href="../../d1/d16/structast__fax__session.html#a34ee6625e0f7d45c4e35cd409cb42e21">smoother</a>);</div><div class="line"><a name="l01656"></a><span class="lineno"> 1656</span>&#160;         fax-&gt;<a class="code" href="../../d1/d16/structast__fax__session.html#a34ee6625e0f7d45c4e35cd409cb42e21">smoother</a> = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l01657"></a><span class="lineno"> 1657</span>&#160;      }</div><div class="line"><a name="l01658"></a><span class="lineno"> 1658</span>&#160;      <span class="keywordflow">if</span> (!(fax-&gt;<a class="code" href="../../d1/d16/structast__fax__session.html#a34ee6625e0f7d45c4e35cd409cb42e21">smoother</a> = <a class="code" href="../../d6/d7f/smoother_8h.html#a6f1c795e5db00c9eb553e540dce7a503">ast_smoother_new</a>(320))) {</div><div class="line"><a name="l01659"></a><span class="lineno"> 1659</span>&#160;         <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Channel &#39;%s&#39; FAX session &#39;%u&#39; failed to obtain a smoother.\n&quot;</span>, <a class="code" href="../../d5/d7b/channel_8h.html#a7ca2fda13b129a55c251b56729de285b">ast_channel_name</a>(chan), fax-&gt;<a class="code" href="../../d1/d16/structast__fax__session.html#ab7ce6f462afaf105224b0ca772a33c43">id</a>);</div><div class="line"><a name="l01660"></a><span class="lineno"> 1660</span>&#160;      }</div><div class="line"><a name="l01661"></a><span class="lineno"> 1661</span>&#160;   } <span class="keywordflow">else</span> {</div><div class="line"><a name="l01662"></a><span class="lineno"> 1662</span>&#160;      expected_frametype = <a class="code" href="../../d6/d66/include_2asterisk_2frame_8h.html#ae2e1a9c4e048da387b761f619312d6e0ad99b86353343f422bda01163898b2eea">AST_FRAME_MODEM</a>;</div><div class="line"><a name="l01663"></a><span class="lineno"> 1663</span>&#160;      expected_framesubclass.<a class="code" href="../../d1/d9f/structast__frame__subclass.html#adece183191b0e700e039e59101e06105">integer</a> = <a class="code" href="../../d6/d66/include_2asterisk_2frame_8h.html#a3a510e4e2673c6870ed5fe0f1eb53732">AST_MODEM_T38</a>;</div><div class="line"><a name="l01664"></a><span class="lineno"> 1664</span>&#160;   }</div><div class="line"><a name="l01665"></a><span class="lineno"> 1665</span>&#160;</div><div class="line"><a name="l01666"></a><span class="lineno"> 1666</span>&#160;   <span class="keywordflow">if</span> (fax-&gt;<a class="code" href="../../d1/d16/structast__fax__session.html#a881c40036288d692235f426586f2352b">debug_info</a>) {</div><div class="line"><a name="l01667"></a><span class="lineno"> 1667</span>&#160;      fax-&gt;<a class="code" href="../../d1/d16/structast__fax__session.html#a881c40036288d692235f426586f2352b">debug_info</a>-&gt;<a class="code" href="../../d3/d84/structast__fax__debug__info.html#a223334851a9df6368db714953c25990e">base_tv</a> = <a class="code" href="../../de/df7/time_8h.html#ad3899efb6f0e348556ef69f5b16aa7f7">ast_tvnow</a>();</div><div class="line"><a name="l01668"></a><span class="lineno"> 1668</span>&#160;   }</div><div class="line"><a name="l01669"></a><span class="lineno"> 1669</span>&#160;</div><div class="line"><a name="l01670"></a><span class="lineno"> 1670</span>&#160;   <span class="comment">/* reset our result fields just in case the fax tech driver wants to</span></div><div class="line"><a name="l01671"></a><span class="lineno"> 1671</span>&#160;<span class="comment">    * set custom error messages */</span></div><div class="line"><a name="l01672"></a><span class="lineno"> 1672</span>&#160;   <a class="code" href="../../d1/d0f/stringfields_8h.html#a653461abd6e0d16e4e3326ab90e0501d">ast_string_field_set</a>(details, <a class="code" href="../../de/d1b/cel__pgsql_8c.html#ad6c487210772a9b4b0ca04b04b847d4c">result</a>, <span class="stringliteral">&quot;&quot;</span>);</div><div class="line"><a name="l01673"></a><span class="lineno"> 1673</span>&#160;   <a class="code" href="../../d1/d0f/stringfields_8h.html#a653461abd6e0d16e4e3326ab90e0501d">ast_string_field_set</a>(details, resultstr, <span class="stringliteral">&quot;&quot;</span>);</div><div class="line"><a name="l01674"></a><span class="lineno"> 1674</span>&#160;   <a class="code" href="../../d1/d0f/stringfields_8h.html#a653461abd6e0d16e4e3326ab90e0501d">ast_string_field_set</a>(details, <a class="code" href="../../d6/d47/utils_2frame_8c.html#a4a9391ee88e57361b613c4c2fd2bf4aa">error</a>, <span class="stringliteral">&quot;&quot;</span>);</div><div class="line"><a name="l01675"></a><span class="lineno"> 1675</span>&#160;   details-&gt;<a class="code" href="../../d8/dc2/structast__fax__session__details.html#aa3cf325797b2746fbd79f34b2fd45370">is_t38_negotiated</a> = t38negotiated;</div><div class="line"><a name="l01676"></a><span class="lineno"> 1676</span>&#160;   <a class="code" href="../../d0/d60/res__fax_8c.html#ad7732b5ae304d39afa2dacb20187cf04">set_channel_variables</a>(chan, details);</div><div class="line"><a name="l01677"></a><span class="lineno"> 1677</span>&#160;</div><div class="line"><a name="l01678"></a><span class="lineno"> 1678</span>&#160;   <span class="keywordflow">if</span> (fax-&gt;<a class="code" href="../../d1/d16/structast__fax__session.html#a4ac6ff3775e67c710cd55bc7dfd592fe">tech</a>-&gt;<a class="code" href="../../d9/d0e/structast__fax__tech.html#a020b7b790b06e12b73b1ca66d1eda3e7">start_session</a>(fax) &lt; 0) {</div><div class="line"><a name="l01679"></a><span class="lineno"> 1679</span>&#160;      <a class="code" href="../../d0/d60/res__fax_8c.html#aaf76f6af8369f4ef489b676433f3e255">GENERIC_FAX_EXEC_ERROR</a>(fax, chan, <span class="stringliteral">&quot;INIT_ERROR&quot;</span>, <span class="stringliteral">&quot;failed to start FAX session&quot;</span>);</div><div class="line"><a name="l01680"></a><span class="lineno"> 1680</span>&#160;   }</div><div class="line"><a name="l01681"></a><span class="lineno"> 1681</span>&#160;</div><div class="line"><a name="l01682"></a><span class="lineno"> 1682</span>&#160;   <a class="code" href="../../d0/d60/res__fax_8c.html#a38d73af44b480b7cad7a654f75926777">report_fax_status</a>(chan, details, <span class="stringliteral">&quot;FAX Transmission In Progress&quot;</span>);</div><div class="line"><a name="l01683"></a><span class="lineno"> 1683</span>&#160;</div><div class="line"><a name="l01684"></a><span class="lineno"> 1684</span>&#160;   <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(5, <span class="stringliteral">&quot;channel %s will wait on FAX fd %d\n&quot;</span>, <a class="code" href="../../d5/d7b/channel_8h.html#a7ca2fda13b129a55c251b56729de285b">ast_channel_name</a>(chan), fax-&gt;<a class="code" href="../../d1/d16/structast__fax__session.html#a6f8059414f0228f0256115e024eeed4b">fd</a>);</div><div class="line"><a name="l01685"></a><span class="lineno"> 1685</span>&#160;</div><div class="line"><a name="l01686"></a><span class="lineno"> 1686</span>&#160;   <span class="comment">/* handle frames for the session */</span></div><div class="line"><a name="l01687"></a><span class="lineno"> 1687</span>&#160;   remaining_time = <a class="code" href="../../d0/d29/cdr__mysql_8c.html#a493b57f443cc38b3d3df9c1e584d9d82">timeout</a>;</div><div class="line"><a name="l01688"></a><span class="lineno"> 1688</span>&#160;   start = <a class="code" href="../../de/df7/time_8h.html#ad3899efb6f0e348556ef69f5b16aa7f7">ast_tvnow</a>();</div><div class="line"><a name="l01689"></a><span class="lineno"> 1689</span>&#160;   <span class="keywordflow">while</span> (remaining_time &gt; 0) {</div><div class="line"><a name="l01690"></a><span class="lineno"> 1690</span>&#160;      <span class="keyword">struct </span><a class="code" href="../../df/d3c/structast__channel.html">ast_channel</a> *ready_chan;</div><div class="line"><a name="l01691"></a><span class="lineno"> 1691</span>&#160;      <span class="keywordtype">int</span> ofd, exception;</div><div class="line"><a name="l01692"></a><span class="lineno"> 1692</span>&#160;</div><div class="line"><a name="l01693"></a><span class="lineno"> 1693</span>&#160;      ms = 1000;</div><div class="line"><a name="l01694"></a><span class="lineno"> 1694</span>&#160;      <a class="code" href="../../d1/d6e/main_2stdtime_2private_8h.html#ad65a8842cc674e3ddf69355898c0ecbf">errno</a> = 0;</div><div class="line"><a name="l01695"></a><span class="lineno"> 1695</span>&#160;      ready_chan = <a class="code" href="../../d5/d7b/channel_8h.html#a5e62602ca9e229304f60ab5c2b32e13b">ast_waitfor_nandfds</a>(&amp;c, chancount, &amp;fax-&gt;<a class="code" href="../../d1/d16/structast__fax__session.html#a6f8059414f0228f0256115e024eeed4b">fd</a>, 1, &amp;exception, &amp;ofd, &amp;ms);</div><div class="line"><a name="l01696"></a><span class="lineno"> 1696</span>&#160;      <span class="keywordflow">if</span> (ready_chan) {</div><div class="line"><a name="l01697"></a><span class="lineno"> 1697</span>&#160;         <span class="keywordflow">if</span> (!(frame = <a class="code" href="../../d5/d7b/channel_8h.html#a7ef6737309dc9e8b6c4a7cb4800638b1">ast_read</a>(chan))) {</div><div class="line"><a name="l01698"></a><span class="lineno"> 1698</span>&#160;            <span class="comment">/* the channel is probably gone, so lets stop polling on it and let the</span></div><div class="line"><a name="l01699"></a><span class="lineno"> 1699</span>&#160;<span class="comment">             * FAX session complete before we exit the application.  if needed,</span></div><div class="line"><a name="l01700"></a><span class="lineno"> 1700</span>&#160;<span class="comment">             * send the FAX stack silence so the modems can finish their session without</span></div><div class="line"><a name="l01701"></a><span class="lineno"> 1701</span>&#160;<span class="comment">             * any problems */</span></div><div class="line"><a name="l01702"></a><span class="lineno"> 1702</span>&#160;            <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(1, <span class="stringliteral">&quot;Channel &#39;%s&#39; did not return a frame; probably hung up.\n&quot;</span>, <a class="code" href="../../d5/d7b/channel_8h.html#a7ca2fda13b129a55c251b56729de285b">ast_channel_name</a>(chan));</div><div class="line"><a name="l01703"></a><span class="lineno"> 1703</span>&#160;            <a class="code" href="../../d0/d60/res__fax_8c.html#ac6fce80bf868971a37f69e9db4111924">GENERIC_FAX_EXEC_SET_VARS</a>(fax, chan, <span class="stringliteral">&quot;HANGUP&quot;</span>, <span class="stringliteral">&quot;remote channel hungup&quot;</span>);</div><div class="line"><a name="l01704"></a><span class="lineno"> 1704</span>&#160;            c = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l01705"></a><span class="lineno"> 1705</span>&#160;            chancount = 0;</div><div class="line"><a name="l01706"></a><span class="lineno"> 1706</span>&#160;            remaining_time = <a class="code" href="../../de/df7/time_8h.html#a904a6933b710e14c7fa2029a0f0cc91a">ast_remaining_ms</a>(start, timeout);</div><div class="line"><a name="l01707"></a><span class="lineno"> 1707</span>&#160;            fax-&gt;<a class="code" href="../../d1/d16/structast__fax__session.html#a4ac6ff3775e67c710cd55bc7dfd592fe">tech</a>-&gt;<a class="code" href="../../d9/d0e/structast__fax__tech.html#a794f785a8ae4c97642fd20ff8ef83c34">cancel_session</a>(fax);</div><div class="line"><a name="l01708"></a><span class="lineno"> 1708</span>&#160;            <span class="keywordflow">if</span> (fax-&gt;<a class="code" href="../../d1/d16/structast__fax__session.html#a4ac6ff3775e67c710cd55bc7dfd592fe">tech</a>-&gt;<a class="code" href="../../d9/d0e/structast__fax__tech.html#a591895ebcfb08392338b8836c5afa281">generate_silence</a>) {</div><div class="line"><a name="l01709"></a><span class="lineno"> 1709</span>&#160;               fax-&gt;<a class="code" href="../../d1/d16/structast__fax__session.html#a4ac6ff3775e67c710cd55bc7dfd592fe">tech</a>-&gt;<a class="code" href="../../d9/d0e/structast__fax__tech.html#a591895ebcfb08392338b8836c5afa281">generate_silence</a>(fax);</div><div class="line"><a name="l01710"></a><span class="lineno"> 1710</span>&#160;            }</div><div class="line"><a name="l01711"></a><span class="lineno"> 1711</span>&#160;            <span class="keywordflow">continue</span>;</div><div class="line"><a name="l01712"></a><span class="lineno"> 1712</span>&#160;         }</div><div class="line"><a name="l01713"></a><span class="lineno"> 1713</span>&#160;</div><div class="line"><a name="l01714"></a><span class="lineno"> 1714</span>&#160;         <span class="keywordflow">if</span> ((frame-&gt;<a class="code" href="../../d0/d99/structast__frame.html#a6937b93c56cb473b547eda454dca7b4c">frametype</a> == <a class="code" href="../../d6/d66/include_2asterisk_2frame_8h.html#ae2e1a9c4e048da387b761f619312d6e0ae1dae388b0d70825876e137ae95bb0c1">AST_FRAME_CONTROL</a>) &amp;&amp;</div><div class="line"><a name="l01715"></a><span class="lineno"> 1715</span>&#160;             (frame-&gt;<a class="code" href="../../d0/d99/structast__frame.html#a27237c48fdcd22556401f20c693811db">subclass</a>.<a class="code" href="../../d1/d9f/structast__frame__subclass.html#adece183191b0e700e039e59101e06105">integer</a> == <a class="code" href="../../d6/d66/include_2asterisk_2frame_8h.html#aedda41918e992000fe921f8f7363b390a7334c9d27a6d70fe7c85b60b864788fc">AST_CONTROL_T38_PARAMETERS</a>) &amp;&amp;</div><div class="line"><a name="l01716"></a><span class="lineno"> 1716</span>&#160;             (frame-&gt;<a class="code" href="../../d0/d99/structast__frame.html#ad67e07841d1233e596e6f822a3c81f6b">datalen</a> == <span class="keyword">sizeof</span>(t38_parameters))) {</div><div class="line"><a name="l01717"></a><span class="lineno"> 1717</span>&#160;            <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> was_t38 = t38negotiated;</div><div class="line"><a name="l01718"></a><span class="lineno"> 1718</span>&#160;            <span class="keyword">struct </span><a class="code" href="../../d5/def/structast__control__t38__parameters.html">ast_control_t38_parameters</a> *parameters = frame-&gt;<a class="code" href="../../d0/d99/structast__frame.html#a4027905f872af30d910929b07e261ca5">data</a>.<a class="code" href="../../d0/d99/structast__frame.html#add9af9569af79ec26dd741fb226b38ba">ptr</a>;</div><div class="line"><a name="l01719"></a><span class="lineno"> 1719</span>&#160;</div><div class="line"><a name="l01720"></a><span class="lineno"> 1720</span>&#160;            <span class="keywordflow">switch</span> (parameters-&gt;<a class="code" href="../../d5/def/structast__control__t38__parameters.html#adb36822366e10ce64ca8337c512732a6">request_response</a>) {</div><div class="line"><a name="l01721"></a><span class="lineno"> 1721</span>&#160;            <span class="keywordflow">case</span> <a class="code" href="../../d6/d66/include_2asterisk_2frame_8h.html#a168d496bdac09ece3ce49cf473bbdb4bafdb1ca68d683c64301c4cf07463a9975">AST_T38_REQUEST_NEGOTIATE</a>:</div><div class="line"><a name="l01722"></a><span class="lineno"> 1722</span>&#160;               <span class="comment">/* the other end has requested a switch to T.38, so reply that we are willing, if we can</span></div><div class="line"><a name="l01723"></a><span class="lineno"> 1723</span>&#160;<span class="comment">                * do T.38 as well</span></div><div class="line"><a name="l01724"></a><span class="lineno"> 1724</span>&#160;<span class="comment">                */</span></div><div class="line"><a name="l01725"></a><span class="lineno"> 1725</span>&#160;               <a class="code" href="../../d0/d60/res__fax_8c.html#a624525cc48cff52d5ae4e5e50895e81e">t38_parameters_fax_to_ast</a>(&amp;t38_parameters, &amp;details-&gt;<a class="code" href="../../d8/dc2/structast__fax__session__details.html#a80632865b575d06f319ef95c42645b2c">our_t38_parameters</a>);</div><div class="line"><a name="l01726"></a><span class="lineno"> 1726</span>&#160;               <span class="keywordflow">if</span> (details-&gt;<a class="code" href="../../d8/dc2/structast__fax__session__details.html#ad75375cdd336e91cbcee4a829fcdabfe">caps</a> &amp; <a class="code" href="../../db/d6a/res__fax_8h.html#a54eb45ad548b874cf12d0a599631e3f6a6868445e2802e5b71068ae883366f635">AST_FAX_TECH_T38</a>) {</div><div class="line"><a name="l01727"></a><span class="lineno"> 1727</span>&#160;                  details-&gt;<a class="code" href="../../d8/dc2/structast__fax__session__details.html#aa3cf325797b2746fbd79f34b2fd45370">is_t38_negotiated</a> = 1;</div><div class="line"><a name="l01728"></a><span class="lineno"> 1728</span>&#160;                  t38_parameters.<a class="code" href="../../d5/def/structast__control__t38__parameters.html#adb36822366e10ce64ca8337c512732a6">request_response</a> = <a class="code" href="../../d6/d66/include_2asterisk_2frame_8h.html#a168d496bdac09ece3ce49cf473bbdb4bad501e0d5fe272eaba466507a686a2df5">AST_T38_NEGOTIATED</a>;</div><div class="line"><a name="l01729"></a><span class="lineno"> 1729</span>&#160;               } <span class="keywordflow">else</span> {</div><div class="line"><a name="l01730"></a><span class="lineno"> 1730</span>&#160;                  t38_parameters.<a class="code" href="../../d5/def/structast__control__t38__parameters.html#adb36822366e10ce64ca8337c512732a6">request_response</a> = <a class="code" href="../../d6/d66/include_2asterisk_2frame_8h.html#a168d496bdac09ece3ce49cf473bbdb4baa02b30f25621f20396d06f5ac8aa7a2e">AST_T38_REFUSED</a>;</div><div class="line"><a name="l01731"></a><span class="lineno"> 1731</span>&#160;               }</div><div class="line"><a name="l01732"></a><span class="lineno"> 1732</span>&#160;               <a class="code" href="../../d5/d7b/channel_8h.html#aa8c3522af1bc639cbd5b38f5fdf171fa">ast_indicate_data</a>(chan, <a class="code" href="../../d6/d66/include_2asterisk_2frame_8h.html#aedda41918e992000fe921f8f7363b390a7334c9d27a6d70fe7c85b60b864788fc">AST_CONTROL_T38_PARAMETERS</a>, &amp;t38_parameters, <span class="keyword">sizeof</span>(t38_parameters));</div><div class="line"><a name="l01733"></a><span class="lineno"> 1733</span>&#160;               <span class="keywordflow">break</span>;</div><div class="line"><a name="l01734"></a><span class="lineno"> 1734</span>&#160;            <span class="keywordflow">case</span> <a class="code" href="../../d6/d66/include_2asterisk_2frame_8h.html#a168d496bdac09ece3ce49cf473bbdb4bad501e0d5fe272eaba466507a686a2df5">AST_T38_NEGOTIATED</a>:</div><div class="line"><a name="l01735"></a><span class="lineno"> 1735</span>&#160;               <a class="code" href="../../d0/d60/res__fax_8c.html#aa9ea5a83822d7365075730ddb8490d23">t38_parameters_ast_to_fax</a>(&amp;details-&gt;<a class="code" href="../../d8/dc2/structast__fax__session__details.html#a12cc2bfdcc88e94984d001cca6fefdc5">their_t38_parameters</a>, parameters);</div><div class="line"><a name="l01736"></a><span class="lineno"> 1736</span>&#160;               t38negotiated = 1;</div><div class="line"><a name="l01737"></a><span class="lineno"> 1737</span>&#160;               details-&gt;<a class="code" href="../../d8/dc2/structast__fax__session__details.html#aa3cf325797b2746fbd79f34b2fd45370">is_t38_negotiated</a> = 1;</div><div class="line"><a name="l01738"></a><span class="lineno"> 1738</span>&#160;               <span class="keywordflow">break</span>;</div><div class="line"><a name="l01739"></a><span class="lineno"> 1739</span>&#160;            <span class="keywordflow">default</span>:</div><div class="line"><a name="l01740"></a><span class="lineno"> 1740</span>&#160;               <span class="keywordflow">break</span>;</div><div class="line"><a name="l01741"></a><span class="lineno"> 1741</span>&#160;            }</div><div class="line"><a name="l01742"></a><span class="lineno"> 1742</span>&#160;            <span class="keywordflow">if</span> (t38negotiated &amp;&amp; !was_t38) {</div><div class="line"><a name="l01743"></a><span class="lineno"> 1743</span>&#160;               <span class="keywordflow">if</span> (fax-&gt;<a class="code" href="../../d1/d16/structast__fax__session.html#a4ac6ff3775e67c710cd55bc7dfd592fe">tech</a>-&gt;<a class="code" href="../../d9/d0e/structast__fax__tech.html#a5c75cdace0414b0bafc3c946980d7417">switch_to_t38</a>(fax)) {</div><div class="line"><a name="l01744"></a><span class="lineno"> 1744</span>&#160;                  <a class="code" href="../../d0/d60/res__fax_8c.html#aaf76f6af8369f4ef489b676433f3e255">GENERIC_FAX_EXEC_ERROR</a>(fax, chan, <span class="stringliteral">&quot;UNKNOWN&quot;</span>, <span class="stringliteral">&quot;T.38 switch failed&quot;</span>);</div><div class="line"><a name="l01745"></a><span class="lineno"> 1745</span>&#160;                  <span class="keywordflow">break</span>;</div><div class="line"><a name="l01746"></a><span class="lineno"> 1746</span>&#160;               }</div><div class="line"><a name="l01747"></a><span class="lineno"> 1747</span>&#160;               details-&gt;<a class="code" href="../../d8/dc2/structast__fax__session__details.html#ad75375cdd336e91cbcee4a829fcdabfe">caps</a> &amp;= ~<a class="code" href="../../db/d6a/res__fax_8h.html#a54eb45ad548b874cf12d0a599631e3f6a76fa4111df51955a949e95fadbccd48b">AST_FAX_TECH_AUDIO</a>;</div><div class="line"><a name="l01748"></a><span class="lineno"> 1748</span>&#160;               expected_frametype = <a class="code" href="../../d6/d66/include_2asterisk_2frame_8h.html#ae2e1a9c4e048da387b761f619312d6e0ad99b86353343f422bda01163898b2eea">AST_FRAME_MODEM</a>;</div><div class="line"><a name="l01749"></a><span class="lineno"> 1749</span>&#160;               expected_framesubclass.<a class="code" href="../../d1/d9f/structast__frame__subclass.html#adece183191b0e700e039e59101e06105">integer</a> = <a class="code" href="../../d6/d66/include_2asterisk_2frame_8h.html#a3a510e4e2673c6870ed5fe0f1eb53732">AST_MODEM_T38</a>;</div><div class="line"><a name="l01750"></a><span class="lineno"> 1750</span>&#160;               <span class="keywordflow">if</span> (fax-&gt;<a class="code" href="../../d1/d16/structast__fax__session.html#a34ee6625e0f7d45c4e35cd409cb42e21">smoother</a>) {</div><div class="line"><a name="l01751"></a><span class="lineno"> 1751</span>&#160;                  <a class="code" href="../../d6/d7f/smoother_8h.html#a6d3b71e0a81af743bae6c33c02b64f1f">ast_smoother_free</a>(fax-&gt;<a class="code" href="../../d1/d16/structast__fax__session.html#a34ee6625e0f7d45c4e35cd409cb42e21">smoother</a>);</div><div class="line"><a name="l01752"></a><span class="lineno"> 1752</span>&#160;                  fax-&gt;<a class="code" href="../../d1/d16/structast__fax__session.html#a34ee6625e0f7d45c4e35cd409cb42e21">smoother</a> = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l01753"></a><span class="lineno"> 1753</span>&#160;               }</div><div class="line"><a name="l01754"></a><span class="lineno"> 1754</span>&#160;</div><div class="line"><a name="l01755"></a><span class="lineno"> 1755</span>&#160;               <a class="code" href="../../d0/d60/res__fax_8c.html#a38d73af44b480b7cad7a654f75926777">report_fax_status</a>(chan, details, <span class="stringliteral">&quot;T.38 Negotiated&quot;</span>);</div><div class="line"><a name="l01756"></a><span class="lineno"> 1756</span>&#160;</div><div class="line"><a name="l01757"></a><span class="lineno"> 1757</span>&#160;               <a class="code" href="../../d1/d8c/logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(3, <span class="stringliteral">&quot;Channel &#39;%s&#39; switched to T.38 FAX session &#39;%u&#39;.\n&quot;</span>, <a class="code" href="../../d5/d7b/channel_8h.html#a7ca2fda13b129a55c251b56729de285b">ast_channel_name</a>(chan), fax-&gt;<a class="code" href="../../d1/d16/structast__fax__session.html#ab7ce6f462afaf105224b0ca772a33c43">id</a>);</div><div class="line"><a name="l01758"></a><span class="lineno"> 1758</span>&#160;            }</div><div class="line"><a name="l01759"></a><span class="lineno"> 1759</span>&#160;         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((frame-&gt;<a class="code" href="../../d0/d99/structast__frame.html#a6937b93c56cb473b547eda454dca7b4c">frametype</a> == expected_frametype) &amp;&amp; (expected_framesubclass.<a class="code" href="../../d1/d9f/structast__frame__subclass.html#adece183191b0e700e039e59101e06105">integer</a> == frame-&gt;<a class="code" href="../../d0/d99/structast__frame.html#a27237c48fdcd22556401f20c693811db">subclass</a>.<a class="code" href="../../d1/d9f/structast__frame__subclass.html#adece183191b0e700e039e59101e06105">integer</a>) &amp;&amp;</div><div class="line"><a name="l01760"></a><span class="lineno"> 1760</span>&#160;            ((!frame-&gt;<a class="code" href="../../d0/d99/structast__frame.html#a27237c48fdcd22556401f20c693811db">subclass</a>.<a class="code" href="../../d1/d9f/structast__frame__subclass.html#ab425a484a0916077c5a30d9d7b229b44">format</a> &amp;&amp; !expected_framesubclass.<a class="code" href="../../d1/d9f/structast__frame__subclass.html#ab425a484a0916077c5a30d9d7b229b44">format</a>) ||</div><div class="line"><a name="l01761"></a><span class="lineno"> 1761</span>&#160;            (frame-&gt;<a class="code" href="../../d0/d99/structast__frame.html#a27237c48fdcd22556401f20c693811db">subclass</a>.<a class="code" href="../../d1/d9f/structast__frame__subclass.html#ab425a484a0916077c5a30d9d7b229b44">format</a> &amp;&amp; expected_framesubclass.<a class="code" href="../../d1/d9f/structast__frame__subclass.html#ab425a484a0916077c5a30d9d7b229b44">format</a> &amp;&amp;</div><div class="line"><a name="l01762"></a><span class="lineno"> 1762</span>&#160;               (<a class="code" href="../../d0/d0a/format_8h.html#a738c58eca291b71de4422e95bff27400">ast_format_cmp</a>(frame-&gt;<a class="code" href="../../d0/d99/structast__frame.html#a27237c48fdcd22556401f20c693811db">subclass</a>.<a class="code" href="../../d1/d9f/structast__frame__subclass.html#ab425a484a0916077c5a30d9d7b229b44">format</a>, expected_framesubclass.<a class="code" href="../../d1/d9f/structast__frame__subclass.html#ab425a484a0916077c5a30d9d7b229b44">format</a>) != <a class="code" href="../../d0/d0a/format_8h.html#a79bdf0b3c0616d9950d00cfeb62295c3ad88eb6e1d9b89b5e60412393b887391c">AST_FORMAT_CMP_NOT_EQUAL</a>)))) {</div><div class="line"><a name="l01763"></a><span class="lineno"> 1763</span>&#160;            <span class="keyword">struct </span><a class="code" href="../../d0/d99/structast__frame.html">ast_frame</a> *f;</div><div class="line"><a name="l01764"></a><span class="lineno"> 1764</span>&#160;</div><div class="line"><a name="l01765"></a><span class="lineno"> 1765</span>&#160;            <span class="keywordflow">if</span> (fax-&gt;<a class="code" href="../../d1/d16/structast__fax__session.html#a34ee6625e0f7d45c4e35cd409cb42e21">smoother</a>) {</div><div class="line"><a name="l01766"></a><span class="lineno"> 1766</span>&#160;               <span class="comment">/* push the frame into a smoother */</span></div><div class="line"><a name="l01767"></a><span class="lineno"> 1767</span>&#160;               <span class="keywordflow">if</span> (<a class="code" href="../../d6/d7f/smoother_8h.html#aab5808a118c74febd13f39746bcce96c">ast_smoother_feed</a>(fax-&gt;<a class="code" href="../../d1/d16/structast__fax__session.html#a34ee6625e0f7d45c4e35cd409cb42e21">smoother</a>, frame) &lt; 0) {</div><div class="line"><a name="l01768"></a><span class="lineno"> 1768</span>&#160;                  <a class="code" href="../../d0/d60/res__fax_8c.html#aaf76f6af8369f4ef489b676433f3e255">GENERIC_FAX_EXEC_ERROR</a>(fax, chan, <span class="stringliteral">&quot;UNKNOWN&quot;</span>, <span class="stringliteral">&quot;Failed to feed the smoother&quot;</span>);</div><div class="line"><a name="l01769"></a><span class="lineno"> 1769</span>&#160;               }</div><div class="line"><a name="l01770"></a><span class="lineno"> 1770</span>&#160;               <span class="keywordflow">while</span> ((f = <a class="code" href="../../d6/d7f/smoother_8h.html#af8d6dcd265eaf403b1b1139770c885d8">ast_smoother_read</a>(fax-&gt;<a class="code" href="../../d1/d16/structast__fax__session.html#a34ee6625e0f7d45c4e35cd409cb42e21">smoother</a>)) &amp;&amp; (f-&gt;<a class="code" href="../../d0/d99/structast__frame.html#a4027905f872af30d910929b07e261ca5">data</a>.<a class="code" href="../../d0/d99/structast__frame.html#add9af9569af79ec26dd741fb226b38ba">ptr</a>)) {</div><div class="line"><a name="l01771"></a><span class="lineno"> 1771</span>&#160;                  <span class="keywordflow">if</span> (fax-&gt;<a class="code" href="../../d1/d16/structast__fax__session.html#a881c40036288d692235f426586f2352b">debug_info</a>) {</div><div class="line"><a name="l01772"></a><span class="lineno"> 1772</span>&#160;                     <a class="code" href="../../d0/d60/res__fax_8c.html#aae683f9221ef32fd1fdc2f52e94857e0">debug_check_frame_for_silence</a>(fax, 1, f);</div><div class="line"><a name="l01773"></a><span class="lineno"> 1773</span>&#160;                  }</div><div class="line"><a name="l01774"></a><span class="lineno"> 1774</span>&#160;                  <span class="comment">/* write the frame to the FAX stack */</span></div><div class="line"><a name="l01775"></a><span class="lineno"> 1775</span>&#160;                  fax-&gt;<a class="code" href="../../d1/d16/structast__fax__session.html#a4ac6ff3775e67c710cd55bc7dfd592fe">tech</a>-&gt;<a class="code" href="../../d9/d0e/structast__fax__tech.html#a7014a7b1d150a523cf1273e6fee5bdd6">write</a>(fax, f);</div><div class="line"><a name="l01776"></a><span class="lineno"> 1776</span>&#160;                  fax-&gt;<a class="code" href="../../d1/d16/structast__fax__session.html#a642958d63ff66872cbdcc0dc9795b4a3">frames_received</a>++;</div><div class="line"><a name="l01777"></a><span class="lineno"> 1777</span>&#160;                  <span class="keywordflow">if</span> (f != frame) {</div><div class="line"><a name="l01778"></a><span class="lineno"> 1778</span>&#160;                     <a class="code" href="../../d6/d66/include_2asterisk_2frame_8h.html#a6440d070425a2efe8e0aa71e8d9e47b7">ast_frfree</a>(f);</div><div class="line"><a name="l01779"></a><span class="lineno"> 1779</span>&#160;                  }</div><div class="line"><a name="l01780"></a><span class="lineno"> 1780</span>&#160;               }</div><div class="line"><a name="l01781"></a><span class="lineno"> 1781</span>&#160;            } <span class="keywordflow">else</span> {</div><div class="line"><a name="l01782"></a><span class="lineno"> 1782</span>&#160;               <span class="comment">/* write the frame to the FAX stack */</span></div><div class="line"><a name="l01783"></a><span class="lineno"> 1783</span>&#160;               fax-&gt;<a class="code" href="../../d1/d16/structast__fax__session.html#a4ac6ff3775e67c710cd55bc7dfd592fe">tech</a>-&gt;<a class="code" href="../../d9/d0e/structast__fax__tech.html#a7014a7b1d150a523cf1273e6fee5bdd6">write</a>(fax, frame);</div><div class="line"><a name="l01784"></a><span class="lineno"> 1784</span>&#160;               fax-&gt;<a class="code" href="../../d1/d16/structast__fax__session.html#a642958d63ff66872cbdcc0dc9795b4a3">frames_received</a>++;</div><div class="line"><a name="l01785"></a><span class="lineno"> 1785</span>&#160;            }</div><div class="line"><a name="l01786"></a><span class="lineno"> 1786</span>&#160;            start = <a class="code" href="../../de/df7/time_8h.html#ad3899efb6f0e348556ef69f5b16aa7f7">ast_tvnow</a>();</div><div class="line"><a name="l01787"></a><span class="lineno"> 1787</span>&#160;         }</div><div class="line"><a name="l01788"></a><span class="lineno"> 1788</span>&#160;         <a class="code" href="../../d6/d66/include_2asterisk_2frame_8h.html#a6440d070425a2efe8e0aa71e8d9e47b7">ast_frfree</a>(frame);</div><div class="line"><a name="l01789"></a><span class="lineno"> 1789</span>&#160;      } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (ofd == fax-&gt;<a class="code" href="../../d1/d16/structast__fax__session.html#a6f8059414f0228f0256115e024eeed4b">fd</a>) {</div><div class="line"><a name="l01790"></a><span class="lineno"> 1790</span>&#160;         <span class="comment">/* read a frame from the FAX stack and send it out the channel.</span></div><div class="line"><a name="l01791"></a><span class="lineno"> 1791</span>&#160;<span class="comment">          * the FAX stack will return a NULL if the FAX session has already completed */</span></div><div class="line"><a name="l01792"></a><span class="lineno"> 1792</span>&#160;         <span class="keywordflow">if</span> (!(frame = fax-&gt;<a class="code" href="../../d1/d16/structast__fax__session.html#a4ac6ff3775e67c710cd55bc7dfd592fe">tech</a>-&gt;<a class="code" href="../../d9/d0e/structast__fax__tech.html#aa44dffb52a00b5f1f5ccb493d81fb659">read</a>(fax))) {</div><div class="line"><a name="l01793"></a><span class="lineno"> 1793</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l01794"></a><span class="lineno"> 1794</span>&#160;         }</div><div class="line"><a name="l01795"></a><span class="lineno"> 1795</span>&#160;</div><div class="line"><a name="l01796"></a><span class="lineno"> 1796</span>&#160;         <span class="keywordflow">if</span> (fax-&gt;<a class="code" href="../../d1/d16/structast__fax__session.html#a881c40036288d692235f426586f2352b">debug_info</a> &amp;&amp; (frame-&gt;<a class="code" href="../../d0/d99/structast__frame.html#a6937b93c56cb473b547eda454dca7b4c">frametype</a> == <a class="code" href="../../d6/d66/include_2asterisk_2frame_8h.html#ae2e1a9c4e048da387b761f619312d6e0aa457fe7005f11bb7b21453f9bb4caa8f">AST_FRAME_VOICE</a>)) {</div><div class="line"><a name="l01797"></a><span class="lineno"> 1797</span>&#160;            <a class="code" href="../../d0/d60/res__fax_8c.html#aae683f9221ef32fd1fdc2f52e94857e0">debug_check_frame_for_silence</a>(fax, 0, frame);</div><div class="line"><a name="l01798"></a><span class="lineno"> 1798</span>&#160;         }</div><div class="line"><a name="l01799"></a><span class="lineno"> 1799</span>&#160;</div><div class="line"><a name="l01800"></a><span class="lineno"> 1800</span>&#160;         <a class="code" href="../../d5/d7b/channel_8h.html#a79c413d51b7135404d5cacf811649a61">ast_write</a>(chan, frame);</div><div class="line"><a name="l01801"></a><span class="lineno"> 1801</span>&#160;         fax-&gt;<a class="code" href="../../d1/d16/structast__fax__session.html#a7322779fdf9224c1354c795981079ee3">frames_sent</a>++;</div><div class="line"><a name="l01802"></a><span class="lineno"> 1802</span>&#160;         <a class="code" href="../../d6/d66/include_2asterisk_2frame_8h.html#a6440d070425a2efe8e0aa71e8d9e47b7">ast_frfree</a>(frame);</div><div class="line"><a name="l01803"></a><span class="lineno"> 1803</span>&#160;         start = <a class="code" href="../../de/df7/time_8h.html#ad3899efb6f0e348556ef69f5b16aa7f7">ast_tvnow</a>();</div><div class="line"><a name="l01804"></a><span class="lineno"> 1804</span>&#160;      } <span class="keywordflow">else</span> {</div><div class="line"><a name="l01805"></a><span class="lineno"> 1805</span>&#160;         <span class="keywordflow">if</span> (ms &amp;&amp; (ofd &lt; 0)) {</div><div class="line"><a name="l01806"></a><span class="lineno"> 1806</span>&#160;            <span class="keywordflow">if</span> ((<a class="code" href="../../d1/d6e/main_2stdtime_2private_8h.html#ad65a8842cc674e3ddf69355898c0ecbf">errno</a> == 0) || (<a class="code" href="../../d1/d6e/main_2stdtime_2private_8h.html#ad65a8842cc674e3ddf69355898c0ecbf">errno</a> == EINTR)) {</div><div class="line"><a name="l01807"></a><span class="lineno"> 1807</span>&#160;               remaining_time = <a class="code" href="../../de/df7/time_8h.html#a904a6933b710e14c7fa2029a0f0cc91a">ast_remaining_ms</a>(start, timeout);</div><div class="line"><a name="l01808"></a><span class="lineno"> 1808</span>&#160;               <span class="keywordflow">if</span> (remaining_time &lt;= 0)</div><div class="line"><a name="l01809"></a><span class="lineno"> 1809</span>&#160;                  <a class="code" href="../../d0/d60/res__fax_8c.html#aaf76f6af8369f4ef489b676433f3e255">GENERIC_FAX_EXEC_ERROR</a>(fax, chan, <span class="stringliteral">&quot;TIMEOUT&quot;</span>, <span class="stringliteral">&quot;fax session timed-out&quot;</span>);</div><div class="line"><a name="l01810"></a><span class="lineno"> 1810</span>&#160;               <span class="keywordflow">continue</span>;</div><div class="line"><a name="l01811"></a><span class="lineno"> 1811</span>&#160;            } <span class="keywordflow">else</span> {</div><div class="line"><a name="l01812"></a><span class="lineno"> 1812</span>&#160;               <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;something bad happened while channel &#39;%s&#39; was polling.\n&quot;</span>, <a class="code" href="../../d5/d7b/channel_8h.html#a7ca2fda13b129a55c251b56729de285b">ast_channel_name</a>(chan));</div><div class="line"><a name="l01813"></a><span class="lineno"> 1813</span>&#160;               <a class="code" href="../../d0/d60/res__fax_8c.html#aaf76f6af8369f4ef489b676433f3e255">GENERIC_FAX_EXEC_ERROR</a>(fax, chan, <span class="stringliteral">&quot;UNKNOWN&quot;</span>, <span class="stringliteral">&quot;error polling data&quot;</span>);</div><div class="line"><a name="l01814"></a><span class="lineno"> 1814</span>&#160;               <span class="keywordflow">break</span>;</div><div class="line"><a name="l01815"></a><span class="lineno"> 1815</span>&#160;            }</div><div class="line"><a name="l01816"></a><span class="lineno"> 1816</span>&#160;         } <span class="keywordflow">else</span> {</div><div class="line"><a name="l01817"></a><span class="lineno"> 1817</span>&#160;            <span class="comment">/* nothing happened */</span></div><div class="line"><a name="l01818"></a><span class="lineno"> 1818</span>&#160;            remaining_time = <a class="code" href="../../de/df7/time_8h.html#a904a6933b710e14c7fa2029a0f0cc91a">ast_remaining_ms</a>(start, timeout);</div><div class="line"><a name="l01819"></a><span class="lineno"> 1819</span>&#160;            <span class="keywordflow">if</span> (remaining_time &lt;= 0) {</div><div class="line"><a name="l01820"></a><span class="lineno"> 1820</span>&#160;               <a class="code" href="../../d0/d60/res__fax_8c.html#aaf76f6af8369f4ef489b676433f3e255">GENERIC_FAX_EXEC_ERROR</a>(fax, chan, <span class="stringliteral">&quot;TIMEOUT&quot;</span>, <span class="stringliteral">&quot;fax session timed-out&quot;</span>);</div><div class="line"><a name="l01821"></a><span class="lineno"> 1821</span>&#160;               <span class="keywordflow">break</span>;</div><div class="line"><a name="l01822"></a><span class="lineno"> 1822</span>&#160;            }</div><div class="line"><a name="l01823"></a><span class="lineno"> 1823</span>&#160;         }</div><div class="line"><a name="l01824"></a><span class="lineno"> 1824</span>&#160;      }</div><div class="line"><a name="l01825"></a><span class="lineno"> 1825</span>&#160;   }</div><div class="line"><a name="l01826"></a><span class="lineno"> 1826</span>&#160;   <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(3, <span class="stringliteral">&quot;channel &#39;%s&#39; - event loop stopped { timeout: %d, remaining_time: %d }\n&quot;</span>, <a class="code" href="../../d5/d7b/channel_8h.html#a7ca2fda13b129a55c251b56729de285b">ast_channel_name</a>(chan), timeout, remaining_time);</div><div class="line"><a name="l01827"></a><span class="lineno"> 1827</span>&#160;</div><div class="line"><a name="l01828"></a><span class="lineno"> 1828</span>&#160;   <a class="code" href="../../d0/d60/res__fax_8c.html#ad7732b5ae304d39afa2dacb20187cf04">set_channel_variables</a>(chan, details);</div><div class="line"><a name="l01829"></a><span class="lineno"> 1829</span>&#160;</div><div class="line"><a name="l01830"></a><span class="lineno"> 1830</span>&#160;   <a class="code" href="../../dd/d42/lock_8h.html#a8a3bd496edfec04a95683ace66676200">ast_atomic_fetchadd_int</a>(&amp;<a class="code" href="../../d0/d60/res__fax_8c.html#a058b6772fcfe1ce5a1a0957e2f11d367">faxregistry</a>.fax_complete, 1);</div><div class="line"><a name="l01831"></a><span class="lineno"> 1831</span>&#160;   <span class="keywordflow">if</span> (!strcasecmp(details-&gt;<a class="code" href="../../d8/dc2/structast__fax__session__details.html#a17c89d9cdcac0df0f2039f065b7cf0ed">result</a>, <span class="stringliteral">&quot;FAILED&quot;</span>)) {</div><div class="line"><a name="l01832"></a><span class="lineno"> 1832</span>&#160;      <a class="code" href="../../dd/d42/lock_8h.html#a8a3bd496edfec04a95683ace66676200">ast_atomic_fetchadd_int</a>(&amp;<a class="code" href="../../d0/d60/res__fax_8c.html#a058b6772fcfe1ce5a1a0957e2f11d367">faxregistry</a>.fax_failures, 1);</div><div class="line"><a name="l01833"></a><span class="lineno"> 1833</span>&#160;   }</div><div class="line"><a name="l01834"></a><span class="lineno"> 1834</span>&#160;</div><div class="line"><a name="l01835"></a><span class="lineno"> 1835</span>&#160;   <span class="keywordflow">if</span> (fax) {</div><div class="line"><a name="l01836"></a><span class="lineno"> 1836</span>&#160;      <a class="code" href="../../d5/da5/astobj2_8h.html#a64f51be4bee35c38dbe59b0a788b5ce8">ao2_unlink</a>(<a class="code" href="../../d0/d60/res__fax_8c.html#a058b6772fcfe1ce5a1a0957e2f11d367">faxregistry</a>.container, fax);</div><div class="line"><a name="l01837"></a><span class="lineno"> 1837</span>&#160;      <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(fax, -1);</div><div class="line"><a name="l01838"></a><span class="lineno"> 1838</span>&#160;   }</div><div class="line"><a name="l01839"></a><span class="lineno"> 1839</span>&#160;</div><div class="line"><a name="l01840"></a><span class="lineno"> 1840</span>&#160;   <span class="comment">/* if the channel is still alive, and we changed its read/write formats,</span></div><div class="line"><a name="l01841"></a><span class="lineno"> 1841</span>&#160;<span class="comment">    * restore them now</span></div><div class="line"><a name="l01842"></a><span class="lineno"> 1842</span>&#160;<span class="comment">    */</span></div><div class="line"><a name="l01843"></a><span class="lineno"> 1843</span>&#160;   <span class="keywordflow">if</span> (chancount) {</div><div class="line"><a name="l01844"></a><span class="lineno"> 1844</span>&#160;      <span class="keywordflow">if</span> (orig_read_format) {</div><div class="line"><a name="l01845"></a><span class="lineno"> 1845</span>&#160;         <a class="code" href="../../d5/d7b/channel_8h.html#a9107a83365cbf327cc0d12cb0dbd28d8">ast_set_read_format</a>(chan, orig_read_format);</div><div class="line"><a name="l01846"></a><span class="lineno"> 1846</span>&#160;      }</div><div class="line"><a name="l01847"></a><span class="lineno"> 1847</span>&#160;      <span class="keywordflow">if</span> (orig_write_format) {</div><div class="line"><a name="l01848"></a><span class="lineno"> 1848</span>&#160;         <a class="code" href="../../d5/d7b/channel_8h.html#abbdfb98077180544657b2d16c5d25f74">ast_set_write_format</a>(chan, orig_write_format);</div><div class="line"><a name="l01849"></a><span class="lineno"> 1849</span>&#160;      }</div><div class="line"><a name="l01850"></a><span class="lineno"> 1850</span>&#160;   }</div><div class="line"><a name="l01851"></a><span class="lineno"> 1851</span>&#160;</div><div class="line"><a name="l01852"></a><span class="lineno"> 1852</span>&#160;   <span class="comment">/* return the chancount so the calling function can determine if the channel hungup during this FAX session or not */</span></div><div class="line"><a name="l01853"></a><span class="lineno"> 1853</span>&#160;   <span class="keywordflow">return</span> <a class="code" href="../../d4/d28/channel_8c.html#a5cb129ce1d580dbb22ec9573dcb62f7f">chancount</a>;</div><div class="line"><a name="l01854"></a><span class="lineno"> 1854</span>&#160;}</div><div class="line"><a name="l01855"></a><span class="lineno"> 1855</span>&#160;</div><div class="line"><a name="l01856"></a><span class="lineno"><a class="line" href="../../d0/d60/res__fax_8c.html#a24d642cdb140e5795c10802786bf991f"> 1856</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d0/d60/res__fax_8c.html#a24d642cdb140e5795c10802786bf991f">receivefax_t38_init</a>(<span class="keyword">struct</span> <a class="code" href="../../df/d3c/structast__channel.html">ast_channel</a> *chan, <span class="keyword">struct</span> <a class="code" href="../../d8/dc2/structast__fax__session__details.html">ast_fax_session_details</a> *details)</div><div class="line"><a name="l01857"></a><span class="lineno"> 1857</span>&#160;{</div><div class="line"><a name="l01858"></a><span class="lineno"> 1858</span>&#160;   <span class="keywordtype">int</span> timeout_ms;</div><div class="line"><a name="l01859"></a><span class="lineno"> 1859</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d0/d99/structast__frame.html">ast_frame</a> *frame = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l01860"></a><span class="lineno"> 1860</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d5/def/structast__control__t38__parameters.html">ast_control_t38_parameters</a> t38_parameters;</div><div class="line"><a name="l01861"></a><span class="lineno"> 1861</span>&#160;   <span class="keyword">struct </span>timeval start;</div><div class="line"><a name="l01862"></a><span class="lineno"> 1862</span>&#160;   <span class="keywordtype">int</span> ms;</div><div class="line"><a name="l01863"></a><span class="lineno"> 1863</span>&#160;</div><div class="line"><a name="l01864"></a><span class="lineno"> 1864</span>&#160;   <span class="comment">/* don&#39;t send any audio if we&#39;ve already received a T.38 reinvite */</span></div><div class="line"><a name="l01865"></a><span class="lineno"> 1865</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d5/d7b/channel_8h.html#a1b22ea5302ef183fa68bc45bfb0659c9">ast_channel_get_t38_state</a>(chan) != <a class="code" href="../../d5/d7b/channel_8h.html#a4cd990f4c1cd0c2af6e4c63f6d15b4e1afa1eab36050476591f803c3e234c2ed1">T38_STATE_NEGOTIATING</a>) {</div><div class="line"><a name="l01866"></a><span class="lineno"> 1866</span>&#160;      <span class="comment">/* generate 3 seconds of CED */</span></div><div class="line"><a name="l01867"></a><span class="lineno"> 1867</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="../../d2/d0f/indications_8h.html#a544e8a1dd4a986b00754103dda6a7d3b">ast_playtones_start</a>(chan, 1024, <span class="stringliteral">&quot;!2100/3000&quot;</span>, 1)) {</div><div class="line"><a name="l01868"></a><span class="lineno"> 1868</span>&#160;         <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;error generating CED tone on %s\n&quot;</span>, <a class="code" href="../../d5/d7b/channel_8h.html#a7ca2fda13b129a55c251b56729de285b">ast_channel_name</a>(chan));</div><div class="line"><a name="l01869"></a><span class="lineno"> 1869</span>&#160;         <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l01870"></a><span class="lineno"> 1870</span>&#160;      }</div><div class="line"><a name="l01871"></a><span class="lineno"> 1871</span>&#160;</div><div class="line"><a name="l01872"></a><span class="lineno"> 1872</span>&#160;      timeout_ms = 3000;</div><div class="line"><a name="l01873"></a><span class="lineno"> 1873</span>&#160;      start = <a class="code" href="../../de/df7/time_8h.html#ad3899efb6f0e348556ef69f5b16aa7f7">ast_tvnow</a>();</div><div class="line"><a name="l01874"></a><span class="lineno"> 1874</span>&#160;      <span class="keywordflow">while</span> ((ms = <a class="code" href="../../de/df7/time_8h.html#a904a6933b710e14c7fa2029a0f0cc91a">ast_remaining_ms</a>(start, timeout_ms))) {</div><div class="line"><a name="l01875"></a><span class="lineno"> 1875</span>&#160;         ms = <a class="code" href="../../d5/d7b/channel_8h.html#a60e0bcaed001e8d5ed1ba0eb2644b3cc">ast_waitfor</a>(chan, ms);</div><div class="line"><a name="l01876"></a><span class="lineno"> 1876</span>&#160;</div><div class="line"><a name="l01877"></a><span class="lineno"> 1877</span>&#160;         <span class="keywordflow">if</span> (ms &lt; 0) {</div><div class="line"><a name="l01878"></a><span class="lineno"> 1878</span>&#160;            <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;error while generating CED tone on %s\n&quot;</span>, <a class="code" href="../../d5/d7b/channel_8h.html#a7ca2fda13b129a55c251b56729de285b">ast_channel_name</a>(chan));</div><div class="line"><a name="l01879"></a><span class="lineno"> 1879</span>&#160;            <a class="code" href="../../d2/d0f/indications_8h.html#a9d5be069b7060d326a213f5d60b8dc77">ast_playtones_stop</a>(chan);</div><div class="line"><a name="l01880"></a><span class="lineno"> 1880</span>&#160;            <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l01881"></a><span class="lineno"> 1881</span>&#160;         }</div><div class="line"><a name="l01882"></a><span class="lineno"> 1882</span>&#160;</div><div class="line"><a name="l01883"></a><span class="lineno"> 1883</span>&#160;         <span class="keywordflow">if</span> (ms == 0) { <span class="comment">/* all done, nothing happened */</span></div><div class="line"><a name="l01884"></a><span class="lineno"> 1884</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l01885"></a><span class="lineno"> 1885</span>&#160;         }</div><div class="line"><a name="l01886"></a><span class="lineno"> 1886</span>&#160;</div><div class="line"><a name="l01887"></a><span class="lineno"> 1887</span>&#160;         <span class="keywordflow">if</span> (!(frame = <a class="code" href="../../d5/d7b/channel_8h.html#a7ef6737309dc9e8b6c4a7cb4800638b1">ast_read</a>(chan))) {</div><div class="line"><a name="l01888"></a><span class="lineno"> 1888</span>&#160;            <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;error reading frame while generating CED tone on %s\n&quot;</span>, <a class="code" href="../../d5/d7b/channel_8h.html#a7ca2fda13b129a55c251b56729de285b">ast_channel_name</a>(chan));</div><div class="line"><a name="l01889"></a><span class="lineno"> 1889</span>&#160;            <a class="code" href="../../d2/d0f/indications_8h.html#a9d5be069b7060d326a213f5d60b8dc77">ast_playtones_stop</a>(chan);</div><div class="line"><a name="l01890"></a><span class="lineno"> 1890</span>&#160;            <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l01891"></a><span class="lineno"> 1891</span>&#160;         }</div><div class="line"><a name="l01892"></a><span class="lineno"> 1892</span>&#160;</div><div class="line"><a name="l01893"></a><span class="lineno"> 1893</span>&#160;         <span class="keywordflow">if</span> ((frame-&gt;<a class="code" href="../../d0/d99/structast__frame.html#a6937b93c56cb473b547eda454dca7b4c">frametype</a> == <a class="code" href="../../d6/d66/include_2asterisk_2frame_8h.html#ae2e1a9c4e048da387b761f619312d6e0ae1dae388b0d70825876e137ae95bb0c1">AST_FRAME_CONTROL</a>) &amp;&amp;</div><div class="line"><a name="l01894"></a><span class="lineno"> 1894</span>&#160;             (frame-&gt;<a class="code" href="../../d0/d99/structast__frame.html#a27237c48fdcd22556401f20c693811db">subclass</a>.<a class="code" href="../../d1/d9f/structast__frame__subclass.html#adece183191b0e700e039e59101e06105">integer</a> == <a class="code" href="../../d6/d66/include_2asterisk_2frame_8h.html#aedda41918e992000fe921f8f7363b390a7334c9d27a6d70fe7c85b60b864788fc">AST_CONTROL_T38_PARAMETERS</a>) &amp;&amp;</div><div class="line"><a name="l01895"></a><span class="lineno"> 1895</span>&#160;             (frame-&gt;<a class="code" href="../../d0/d99/structast__frame.html#ad67e07841d1233e596e6f822a3c81f6b">datalen</a> == <span class="keyword">sizeof</span>(t38_parameters))) {</div><div class="line"><a name="l01896"></a><span class="lineno"> 1896</span>&#160;            <span class="keyword">struct </span><a class="code" href="../../d5/def/structast__control__t38__parameters.html">ast_control_t38_parameters</a> *parameters = frame-&gt;<a class="code" href="../../d0/d99/structast__frame.html#a4027905f872af30d910929b07e261ca5">data</a>.<a class="code" href="../../d0/d99/structast__frame.html#add9af9569af79ec26dd741fb226b38ba">ptr</a>;</div><div class="line"><a name="l01897"></a><span class="lineno"> 1897</span>&#160;</div><div class="line"><a name="l01898"></a><span class="lineno"> 1898</span>&#160;            <span class="keywordflow">switch</span> (parameters-&gt;<a class="code" href="../../d5/def/structast__control__t38__parameters.html#adb36822366e10ce64ca8337c512732a6">request_response</a>) {</div><div class="line"><a name="l01899"></a><span class="lineno"> 1899</span>&#160;            <span class="keywordflow">case</span> <a class="code" href="../../d6/d66/include_2asterisk_2frame_8h.html#a168d496bdac09ece3ce49cf473bbdb4bafdb1ca68d683c64301c4cf07463a9975">AST_T38_REQUEST_NEGOTIATE</a>:</div><div class="line"><a name="l01900"></a><span class="lineno"> 1900</span>&#160;               <span class="comment">/* the other end has requested a switch to T.38, so reply that we are willing, if we can</span></div><div class="line"><a name="l01901"></a><span class="lineno"> 1901</span>&#160;<span class="comment">                * do T.38 as well</span></div><div class="line"><a name="l01902"></a><span class="lineno"> 1902</span>&#160;<span class="comment">                */</span></div><div class="line"><a name="l01903"></a><span class="lineno"> 1903</span>&#160;               <a class="code" href="../../d0/d60/res__fax_8c.html#a624525cc48cff52d5ae4e5e50895e81e">t38_parameters_fax_to_ast</a>(&amp;t38_parameters, &amp;details-&gt;<a class="code" href="../../d8/dc2/structast__fax__session__details.html#a80632865b575d06f319ef95c42645b2c">our_t38_parameters</a>);</div><div class="line"><a name="l01904"></a><span class="lineno"> 1904</span>&#160;               t38_parameters.<a class="code" href="../../d5/def/structast__control__t38__parameters.html#adb36822366e10ce64ca8337c512732a6">request_response</a> = (details-&gt;<a class="code" href="../../d8/dc2/structast__fax__session__details.html#ad75375cdd336e91cbcee4a829fcdabfe">caps</a> &amp; <a class="code" href="../../db/d6a/res__fax_8h.html#a54eb45ad548b874cf12d0a599631e3f6a6868445e2802e5b71068ae883366f635">AST_FAX_TECH_T38</a>) ? <a class="code" href="../../d6/d66/include_2asterisk_2frame_8h.html#a168d496bdac09ece3ce49cf473bbdb4bad501e0d5fe272eaba466507a686a2df5">AST_T38_NEGOTIATED</a> : <a class="code" href="../../d6/d66/include_2asterisk_2frame_8h.html#a168d496bdac09ece3ce49cf473bbdb4baa02b30f25621f20396d06f5ac8aa7a2e">AST_T38_REFUSED</a>;</div><div class="line"><a name="l01905"></a><span class="lineno"> 1905</span>&#160;               <a class="code" href="../../d5/d7b/channel_8h.html#aa8c3522af1bc639cbd5b38f5fdf171fa">ast_indicate_data</a>(chan, <a class="code" href="../../d6/d66/include_2asterisk_2frame_8h.html#aedda41918e992000fe921f8f7363b390a7334c9d27a6d70fe7c85b60b864788fc">AST_CONTROL_T38_PARAMETERS</a>, &amp;t38_parameters, <span class="keyword">sizeof</span>(t38_parameters));</div><div class="line"><a name="l01906"></a><span class="lineno"> 1906</span>&#160;               <a class="code" href="../../d2/d0f/indications_8h.html#a9d5be069b7060d326a213f5d60b8dc77">ast_playtones_stop</a>(chan);</div><div class="line"><a name="l01907"></a><span class="lineno"> 1907</span>&#160;               <span class="keywordflow">break</span>;</div><div class="line"><a name="l01908"></a><span class="lineno"> 1908</span>&#160;            <span class="keywordflow">case</span> <a class="code" href="../../d6/d66/include_2asterisk_2frame_8h.html#a168d496bdac09ece3ce49cf473bbdb4bad501e0d5fe272eaba466507a686a2df5">AST_T38_NEGOTIATED</a>:</div><div class="line"><a name="l01909"></a><span class="lineno"> 1909</span>&#160;               <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(1, <span class="stringliteral">&quot;Negotiated T.38 for receive on %s\n&quot;</span>, <a class="code" href="../../d5/d7b/channel_8h.html#a7ca2fda13b129a55c251b56729de285b">ast_channel_name</a>(chan));</div><div class="line"><a name="l01910"></a><span class="lineno"> 1910</span>&#160;               <a class="code" href="../../d0/d60/res__fax_8c.html#aa9ea5a83822d7365075730ddb8490d23">t38_parameters_ast_to_fax</a>(&amp;details-&gt;<a class="code" href="../../d8/dc2/structast__fax__session__details.html#a12cc2bfdcc88e94984d001cca6fefdc5">their_t38_parameters</a>, parameters);</div><div class="line"><a name="l01911"></a><span class="lineno"> 1911</span>&#160;               details-&gt;<a class="code" href="../../d8/dc2/structast__fax__session__details.html#ad75375cdd336e91cbcee4a829fcdabfe">caps</a> &amp;= ~<a class="code" href="../../db/d6a/res__fax_8h.html#a54eb45ad548b874cf12d0a599631e3f6a76fa4111df51955a949e95fadbccd48b">AST_FAX_TECH_AUDIO</a>;</div><div class="line"><a name="l01912"></a><span class="lineno"> 1912</span>&#160;               <a class="code" href="../../d0/d60/res__fax_8c.html#a38d73af44b480b7cad7a654f75926777">report_fax_status</a>(chan, details, <span class="stringliteral">&quot;T.38 Negotiated&quot;</span>);</div><div class="line"><a name="l01913"></a><span class="lineno"> 1913</span>&#160;               <span class="keywordflow">break</span>;</div><div class="line"><a name="l01914"></a><span class="lineno"> 1914</span>&#160;            <span class="keywordflow">default</span>:</div><div class="line"><a name="l01915"></a><span class="lineno"> 1915</span>&#160;               <span class="keywordflow">break</span>;</div><div class="line"><a name="l01916"></a><span class="lineno"> 1916</span>&#160;            }</div><div class="line"><a name="l01917"></a><span class="lineno"> 1917</span>&#160;         }</div><div class="line"><a name="l01918"></a><span class="lineno"> 1918</span>&#160;         <a class="code" href="../../d6/d66/include_2asterisk_2frame_8h.html#a6440d070425a2efe8e0aa71e8d9e47b7">ast_frfree</a>(frame);</div><div class="line"><a name="l01919"></a><span class="lineno"> 1919</span>&#160;      }</div><div class="line"><a name="l01920"></a><span class="lineno"> 1920</span>&#160;</div><div class="line"><a name="l01921"></a><span class="lineno"> 1921</span>&#160;      <a class="code" href="../../d2/d0f/indications_8h.html#a9d5be069b7060d326a213f5d60b8dc77">ast_playtones_stop</a>(chan);</div><div class="line"><a name="l01922"></a><span class="lineno"> 1922</span>&#160;   }</div><div class="line"><a name="l01923"></a><span class="lineno"> 1923</span>&#160;</div><div class="line"><a name="l01924"></a><span class="lineno"> 1924</span>&#160;   <span class="comment">/* if T.38 was negotiated, we are done initializing */</span></div><div class="line"><a name="l01925"></a><span class="lineno"> 1925</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d5/d7b/channel_8h.html#a1b22ea5302ef183fa68bc45bfb0659c9">ast_channel_get_t38_state</a>(chan) == <a class="code" href="../../d5/d7b/channel_8h.html#a4cd990f4c1cd0c2af6e4c63f6d15b4e1af142c79721a025bd65edad812f0725e0">T38_STATE_NEGOTIATED</a>) {</div><div class="line"><a name="l01926"></a><span class="lineno"> 1926</span>&#160;      <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l01927"></a><span class="lineno"> 1927</span>&#160;   }</div><div class="line"><a name="l01928"></a><span class="lineno"> 1928</span>&#160;</div><div class="line"><a name="l01929"></a><span class="lineno"> 1929</span>&#160;   <span class="comment">/* request T.38 */</span></div><div class="line"><a name="l01930"></a><span class="lineno"> 1930</span>&#160;   <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(1, <span class="stringliteral">&quot;Negotiating T.38 for receive on %s\n&quot;</span>, <a class="code" href="../../d5/d7b/channel_8h.html#a7ca2fda13b129a55c251b56729de285b">ast_channel_name</a>(chan));</div><div class="line"><a name="l01931"></a><span class="lineno"> 1931</span>&#160;</div><div class="line"><a name="l01932"></a><span class="lineno"> 1932</span>&#160;   <span class="comment">/* wait for negotiation to complete */</span></div><div class="line"><a name="l01933"></a><span class="lineno"> 1933</span>&#160;   timeout_ms = details-&gt;<a class="code" href="../../d8/dc2/structast__fax__session__details.html#a50d4d0d4e0ae5aae877a0e6d2faa9517">t38timeout</a>;</div><div class="line"><a name="l01934"></a><span class="lineno"> 1934</span>&#160;</div><div class="line"><a name="l01935"></a><span class="lineno"> 1935</span>&#160;   <span class="comment">/* set parameters based on the session&#39;s parameters */</span></div><div class="line"><a name="l01936"></a><span class="lineno"> 1936</span>&#160;   <a class="code" href="../../d0/d60/res__fax_8c.html#a624525cc48cff52d5ae4e5e50895e81e">t38_parameters_fax_to_ast</a>(&amp;t38_parameters, &amp;details-&gt;<a class="code" href="../../d8/dc2/structast__fax__session__details.html#a80632865b575d06f319ef95c42645b2c">our_t38_parameters</a>);</div><div class="line"><a name="l01937"></a><span class="lineno"> 1937</span>&#160;   t38_parameters.<a class="code" href="../../d5/def/structast__control__t38__parameters.html#adb36822366e10ce64ca8337c512732a6">request_response</a> = <a class="code" href="../../d6/d66/include_2asterisk_2frame_8h.html#a168d496bdac09ece3ce49cf473bbdb4bafdb1ca68d683c64301c4cf07463a9975">AST_T38_REQUEST_NEGOTIATE</a>;</div><div class="line"><a name="l01938"></a><span class="lineno"> 1938</span>&#160;   <span class="keywordflow">if</span> ((<a class="code" href="../../d5/d7b/channel_8h.html#aa8c3522af1bc639cbd5b38f5fdf171fa">ast_indicate_data</a>(chan, <a class="code" href="../../d6/d66/include_2asterisk_2frame_8h.html#aedda41918e992000fe921f8f7363b390a7334c9d27a6d70fe7c85b60b864788fc">AST_CONTROL_T38_PARAMETERS</a>, &amp;t38_parameters, <span class="keyword">sizeof</span>(t38_parameters)) != 0)) {</div><div class="line"><a name="l01939"></a><span class="lineno"> 1939</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l01940"></a><span class="lineno"> 1940</span>&#160;   }</div><div class="line"><a name="l01941"></a><span class="lineno"> 1941</span>&#160;</div><div class="line"><a name="l01942"></a><span class="lineno"> 1942</span>&#160;   start = <a class="code" href="../../de/df7/time_8h.html#ad3899efb6f0e348556ef69f5b16aa7f7">ast_tvnow</a>();</div><div class="line"><a name="l01943"></a><span class="lineno"> 1943</span>&#160;   <span class="keywordflow">while</span> ((ms = <a class="code" href="../../de/df7/time_8h.html#a904a6933b710e14c7fa2029a0f0cc91a">ast_remaining_ms</a>(start, timeout_ms))) {</div><div class="line"><a name="l01944"></a><span class="lineno"> 1944</span>&#160;      <span class="keywordtype">int</span> break_loop = 0;</div><div class="line"><a name="l01945"></a><span class="lineno"> 1945</span>&#160;</div><div class="line"><a name="l01946"></a><span class="lineno"> 1946</span>&#160;      ms = <a class="code" href="../../d5/d7b/channel_8h.html#a60e0bcaed001e8d5ed1ba0eb2644b3cc">ast_waitfor</a>(chan, ms);</div><div class="line"><a name="l01947"></a><span class="lineno"> 1947</span>&#160;      <span class="keywordflow">if</span> (ms &lt; 0) {</div><div class="line"><a name="l01948"></a><span class="lineno"> 1948</span>&#160;         <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;error on &#39;%s&#39; while waiting for T.38 negotiation.\n&quot;</span>, <a class="code" href="../../d5/d7b/channel_8h.html#a7ca2fda13b129a55c251b56729de285b">ast_channel_name</a>(chan));</div><div class="line"><a name="l01949"></a><span class="lineno"> 1949</span>&#160;         <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l01950"></a><span class="lineno"> 1950</span>&#160;      }</div><div class="line"><a name="l01951"></a><span class="lineno"> 1951</span>&#160;      <span class="keywordflow">if</span> (ms == 0) { <span class="comment">/* all done, nothing happened */</span></div><div class="line"><a name="l01952"></a><span class="lineno"> 1952</span>&#160;         <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;channel &#39;%s&#39; timed-out during the T.38 negotiation.\n&quot;</span>, <a class="code" href="../../d5/d7b/channel_8h.html#a7ca2fda13b129a55c251b56729de285b">ast_channel_name</a>(chan));</div><div class="line"><a name="l01953"></a><span class="lineno"> 1953</span>&#160;         details-&gt;<a class="code" href="../../d8/dc2/structast__fax__session__details.html#ad75375cdd336e91cbcee4a829fcdabfe">caps</a> &amp;= ~<a class="code" href="../../db/d6a/res__fax_8h.html#a54eb45ad548b874cf12d0a599631e3f6a6868445e2802e5b71068ae883366f635">AST_FAX_TECH_T38</a>;</div><div class="line"><a name="l01954"></a><span class="lineno"> 1954</span>&#160;         <span class="keywordflow">break</span>;</div><div class="line"><a name="l01955"></a><span class="lineno"> 1955</span>&#160;      }</div><div class="line"><a name="l01956"></a><span class="lineno"> 1956</span>&#160;</div><div class="line"><a name="l01957"></a><span class="lineno"> 1957</span>&#160;      <span class="keywordflow">if</span> (!(frame = <a class="code" href="../../d5/d7b/channel_8h.html#a7ef6737309dc9e8b6c4a7cb4800638b1">ast_read</a>(chan))) {</div><div class="line"><a name="l01958"></a><span class="lineno"> 1958</span>&#160;         <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;error on &#39;%s&#39; while waiting for T.38 negotiation.\n&quot;</span>, <a class="code" href="../../d5/d7b/channel_8h.html#a7ca2fda13b129a55c251b56729de285b">ast_channel_name</a>(chan));</div><div class="line"><a name="l01959"></a><span class="lineno"> 1959</span>&#160;         <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l01960"></a><span class="lineno"> 1960</span>&#160;      }</div><div class="line"><a name="l01961"></a><span class="lineno"> 1961</span>&#160;</div><div class="line"><a name="l01962"></a><span class="lineno"> 1962</span>&#160;      <span class="keywordflow">if</span> ((frame-&gt;<a class="code" href="../../d0/d99/structast__frame.html#a6937b93c56cb473b547eda454dca7b4c">frametype</a> == <a class="code" href="../../d6/d66/include_2asterisk_2frame_8h.html#ae2e1a9c4e048da387b761f619312d6e0ae1dae388b0d70825876e137ae95bb0c1">AST_FRAME_CONTROL</a>) &amp;&amp;</div><div class="line"><a name="l01963"></a><span class="lineno"> 1963</span>&#160;            (frame-&gt;<a class="code" href="../../d0/d99/structast__frame.html#a27237c48fdcd22556401f20c693811db">subclass</a>.<a class="code" href="../../d1/d9f/structast__frame__subclass.html#adece183191b0e700e039e59101e06105">integer</a> == <a class="code" href="../../d6/d66/include_2asterisk_2frame_8h.html#aedda41918e992000fe921f8f7363b390a7334c9d27a6d70fe7c85b60b864788fc">AST_CONTROL_T38_PARAMETERS</a>) &amp;&amp;</div><div class="line"><a name="l01964"></a><span class="lineno"> 1964</span>&#160;            (frame-&gt;<a class="code" href="../../d0/d99/structast__frame.html#ad67e07841d1233e596e6f822a3c81f6b">datalen</a> == <span class="keyword">sizeof</span>(t38_parameters))) {</div><div class="line"><a name="l01965"></a><span class="lineno"> 1965</span>&#160;         <span class="keyword">struct </span><a class="code" href="../../d5/def/structast__control__t38__parameters.html">ast_control_t38_parameters</a> *parameters = frame-&gt;<a class="code" href="../../d0/d99/structast__frame.html#a4027905f872af30d910929b07e261ca5">data</a>.<a class="code" href="../../d0/d99/structast__frame.html#add9af9569af79ec26dd741fb226b38ba">ptr</a>;</div><div class="line"><a name="l01966"></a><span class="lineno"> 1966</span>&#160;</div><div class="line"><a name="l01967"></a><span class="lineno"> 1967</span>&#160;         <span class="keywordflow">switch</span> (parameters-&gt;<a class="code" href="../../d5/def/structast__control__t38__parameters.html#adb36822366e10ce64ca8337c512732a6">request_response</a>) {</div><div class="line"><a name="l01968"></a><span class="lineno"> 1968</span>&#160;         <span class="keywordflow">case</span> <a class="code" href="../../d6/d66/include_2asterisk_2frame_8h.html#a168d496bdac09ece3ce49cf473bbdb4bafdb1ca68d683c64301c4cf07463a9975">AST_T38_REQUEST_NEGOTIATE</a>:</div><div class="line"><a name="l01969"></a><span class="lineno"> 1969</span>&#160;            <a class="code" href="../../d0/d60/res__fax_8c.html#a624525cc48cff52d5ae4e5e50895e81e">t38_parameters_fax_to_ast</a>(&amp;t38_parameters, &amp;details-&gt;<a class="code" href="../../d8/dc2/structast__fax__session__details.html#a80632865b575d06f319ef95c42645b2c">our_t38_parameters</a>);</div><div class="line"><a name="l01970"></a><span class="lineno"> 1970</span>&#160;            t38_parameters.<a class="code" href="../../d5/def/structast__control__t38__parameters.html#adb36822366e10ce64ca8337c512732a6">request_response</a> = <a class="code" href="../../d6/d66/include_2asterisk_2frame_8h.html#a168d496bdac09ece3ce49cf473bbdb4bad501e0d5fe272eaba466507a686a2df5">AST_T38_NEGOTIATED</a>;</div><div class="line"><a name="l01971"></a><span class="lineno"> 1971</span>&#160;            <a class="code" href="../../d5/d7b/channel_8h.html#aa8c3522af1bc639cbd5b38f5fdf171fa">ast_indicate_data</a>(chan, <a class="code" href="../../d6/d66/include_2asterisk_2frame_8h.html#aedda41918e992000fe921f8f7363b390a7334c9d27a6d70fe7c85b60b864788fc">AST_CONTROL_T38_PARAMETERS</a>, &amp;t38_parameters, <span class="keyword">sizeof</span>(t38_parameters));</div><div class="line"><a name="l01972"></a><span class="lineno"> 1972</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l01973"></a><span class="lineno"> 1973</span>&#160;         <span class="keywordflow">case</span> <a class="code" href="../../d6/d66/include_2asterisk_2frame_8h.html#a168d496bdac09ece3ce49cf473bbdb4bad501e0d5fe272eaba466507a686a2df5">AST_T38_NEGOTIATED</a>:</div><div class="line"><a name="l01974"></a><span class="lineno"> 1974</span>&#160;            <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(1, <span class="stringliteral">&quot;Negotiated T.38 for receive on %s\n&quot;</span>, <a class="code" href="../../d5/d7b/channel_8h.html#a7ca2fda13b129a55c251b56729de285b">ast_channel_name</a>(chan));</div><div class="line"><a name="l01975"></a><span class="lineno"> 1975</span>&#160;            <a class="code" href="../../d0/d60/res__fax_8c.html#aa9ea5a83822d7365075730ddb8490d23">t38_parameters_ast_to_fax</a>(&amp;details-&gt;<a class="code" href="../../d8/dc2/structast__fax__session__details.html#a12cc2bfdcc88e94984d001cca6fefdc5">their_t38_parameters</a>, parameters);</div><div class="line"><a name="l01976"></a><span class="lineno"> 1976</span>&#160;            details-&gt;<a class="code" href="../../d8/dc2/structast__fax__session__details.html#ad75375cdd336e91cbcee4a829fcdabfe">caps</a> &amp;= ~<a class="code" href="../../db/d6a/res__fax_8h.html#a54eb45ad548b874cf12d0a599631e3f6a76fa4111df51955a949e95fadbccd48b">AST_FAX_TECH_AUDIO</a>;</div><div class="line"><a name="l01977"></a><span class="lineno"> 1977</span>&#160;            <a class="code" href="../../d0/d60/res__fax_8c.html#a38d73af44b480b7cad7a654f75926777">report_fax_status</a>(chan, details, <span class="stringliteral">&quot;T.38 Negotiated&quot;</span>);</div><div class="line"><a name="l01978"></a><span class="lineno"> 1978</span>&#160;            break_loop = 1;</div><div class="line"><a name="l01979"></a><span class="lineno"> 1979</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l01980"></a><span class="lineno"> 1980</span>&#160;         <span class="keywordflow">case</span> <a class="code" href="../../d6/d66/include_2asterisk_2frame_8h.html#a168d496bdac09ece3ce49cf473bbdb4baa02b30f25621f20396d06f5ac8aa7a2e">AST_T38_REFUSED</a>:</div><div class="line"><a name="l01981"></a><span class="lineno"> 1981</span>&#160;            <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;channel &#39;%s&#39; refused to negotiate T.38\n&quot;</span>, <a class="code" href="../../d5/d7b/channel_8h.html#a7ca2fda13b129a55c251b56729de285b">ast_channel_name</a>(chan));</div><div class="line"><a name="l01982"></a><span class="lineno"> 1982</span>&#160;            details-&gt;<a class="code" href="../../d8/dc2/structast__fax__session__details.html#ad75375cdd336e91cbcee4a829fcdabfe">caps</a> &amp;= ~<a class="code" href="../../db/d6a/res__fax_8h.html#a54eb45ad548b874cf12d0a599631e3f6a6868445e2802e5b71068ae883366f635">AST_FAX_TECH_T38</a>;</div><div class="line"><a name="l01983"></a><span class="lineno"> 1983</span>&#160;            break_loop = 1;</div><div class="line"><a name="l01984"></a><span class="lineno"> 1984</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l01985"></a><span class="lineno"> 1985</span>&#160;         <span class="keywordflow">default</span>:</div><div class="line"><a name="l01986"></a><span class="lineno"> 1986</span>&#160;            <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;channel &#39;%s&#39; failed to negotiate T.38\n&quot;</span>, <a class="code" href="../../d5/d7b/channel_8h.html#a7ca2fda13b129a55c251b56729de285b">ast_channel_name</a>(chan));</div><div class="line"><a name="l01987"></a><span class="lineno"> 1987</span>&#160;            details-&gt;<a class="code" href="../../d8/dc2/structast__fax__session__details.html#ad75375cdd336e91cbcee4a829fcdabfe">caps</a> &amp;= ~<a class="code" href="../../db/d6a/res__fax_8h.html#a54eb45ad548b874cf12d0a599631e3f6a6868445e2802e5b71068ae883366f635">AST_FAX_TECH_T38</a>;</div><div class="line"><a name="l01988"></a><span class="lineno"> 1988</span>&#160;            break_loop = 1;</div><div class="line"><a name="l01989"></a><span class="lineno"> 1989</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l01990"></a><span class="lineno"> 1990</span>&#160;         }</div><div class="line"><a name="l01991"></a><span class="lineno"> 1991</span>&#160;      }</div><div class="line"><a name="l01992"></a><span class="lineno"> 1992</span>&#160;      <a class="code" href="../../d6/d66/include_2asterisk_2frame_8h.html#a6440d070425a2efe8e0aa71e8d9e47b7">ast_frfree</a>(frame);</div><div class="line"><a name="l01993"></a><span class="lineno"> 1993</span>&#160;      <span class="keywordflow">if</span> (break_loop) {</div><div class="line"><a name="l01994"></a><span class="lineno"> 1994</span>&#160;         <span class="keywordflow">break</span>;</div><div class="line"><a name="l01995"></a><span class="lineno"> 1995</span>&#160;      }</div><div class="line"><a name="l01996"></a><span class="lineno"> 1996</span>&#160;   }</div><div class="line"><a name="l01997"></a><span class="lineno"> 1997</span>&#160;</div><div class="line"><a name="l01998"></a><span class="lineno"> 1998</span>&#160;   <span class="comment">/* if T.38 was negotiated, we are done initializing */</span></div><div class="line"><a name="l01999"></a><span class="lineno"> 1999</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d5/d7b/channel_8h.html#a1b22ea5302ef183fa68bc45bfb0659c9">ast_channel_get_t38_state</a>(chan) == <a class="code" href="../../d5/d7b/channel_8h.html#a4cd990f4c1cd0c2af6e4c63f6d15b4e1af142c79721a025bd65edad812f0725e0">T38_STATE_NEGOTIATED</a>) {</div><div class="line"><a name="l02000"></a><span class="lineno"> 2000</span>&#160;      <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l02001"></a><span class="lineno"> 2001</span>&#160;   }</div><div class="line"><a name="l02002"></a><span class="lineno"> 2002</span>&#160;</div><div class="line"><a name="l02003"></a><span class="lineno"> 2003</span>&#160;   <span class="comment">/* if we made it here, then T.38 failed, check the &#39;f&#39; flag */</span></div><div class="line"><a name="l02004"></a><span class="lineno"> 2004</span>&#160;   <span class="keywordflow">if</span> (details-&gt;<a class="code" href="../../d8/dc2/structast__fax__session__details.html#a3ab211dbe8780b7292257f6b3dba1952">option</a>.<a class="code" href="../../d8/dc2/structast__fax__session__details.html#a2bdd8d6f48911b41e094440799e00bd2">allow_audio</a> != <a class="code" href="../../db/d6a/res__fax_8h.html#a1838c71fcf68c3cfe0ce37e35e77406dabd9b4a57405ba5c0c884ac98746a8bd7">AST_FAX_OPTFLAG_TRUE</a>) {</div><div class="line"><a name="l02005"></a><span class="lineno"> 2005</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Audio FAX not allowed on channel &#39;%s&#39; and T.38 negotiation failed; aborting.\n&quot;</span>, <a class="code" href="../../d5/d7b/channel_8h.html#a7ca2fda13b129a55c251b56729de285b">ast_channel_name</a>(chan));</div><div class="line"><a name="l02006"></a><span class="lineno"> 2006</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l02007"></a><span class="lineno"> 2007</span>&#160;   }</div><div class="line"><a name="l02008"></a><span class="lineno"> 2008</span>&#160;</div><div class="line"><a name="l02009"></a><span class="lineno"> 2009</span>&#160;   <span class="comment">/* ok, audio fallback is allowed */</span></div><div class="line"><a name="l02010"></a><span class="lineno"> 2010</span>&#160;   details-&gt;<a class="code" href="../../d8/dc2/structast__fax__session__details.html#ad75375cdd336e91cbcee4a829fcdabfe">caps</a> |= <a class="code" href="../../db/d6a/res__fax_8h.html#a54eb45ad548b874cf12d0a599631e3f6a76fa4111df51955a949e95fadbccd48b">AST_FAX_TECH_AUDIO</a>;</div><div class="line"><a name="l02011"></a><span class="lineno"> 2011</span>&#160;</div><div class="line"><a name="l02012"></a><span class="lineno"> 2012</span>&#160;   <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l02013"></a><span class="lineno"> 2013</span>&#160;}</div><div class="line"><a name="l02014"></a><span class="lineno"> 2014</span>&#160;<span class="comment"></span></div><div class="line"><a name="l02015"></a><span class="lineno"> 2015</span>&#160;<span class="comment">/*! \brief Report on the final state of a receive fax operation</span></div><div class="line"><a name="l02016"></a><span class="lineno"> 2016</span>&#160;<span class="comment"> * \note This will lock the \ref ast_channel</span></div><div class="line"><a name="l02017"></a><span class="lineno"> 2017</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l02018"></a><span class="lineno"><a class="line" href="../../d0/d60/res__fax_8c.html#af822150a9af5748af190c5f66979aae0"> 2018</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d0/d60/res__fax_8c.html#af822150a9af5748af190c5f66979aae0">report_receive_fax_status</a>(<span class="keyword">struct</span> <a class="code" href="../../df/d3c/structast__channel.html">ast_channel</a> *chan, <span class="keyword">const</span> <span class="keywordtype">char</span> *filename)</div><div class="line"><a name="l02019"></a><span class="lineno"> 2019</span>&#160;{</div><div class="line"><a name="l02020"></a><span class="lineno"> 2020</span>&#160;   <a class="code" href="../../d5/d60/utils_8h.html#a1604b4d72144dd3d9f7da668e90337e9">RAII_VAR</a>(<span class="keyword">struct</span> <a class="code" href="../../d1/da1/structast__json.html">ast_json</a> *, json_object, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../d4/d05/json_8h.html#a33bcd9181e613a659eefe411ec42c87c">ast_json_unref</a>);</div><div class="line"><a name="l02021"></a><span class="lineno"> 2021</span>&#160;   <a class="code" href="../../d5/d60/utils_8h.html#a1604b4d72144dd3d9f7da668e90337e9">RAII_VAR</a>(<span class="keyword">struct</span> <a class="code" href="../../d7/d55/structstasis__message.html">stasis_message</a> *, <a class="code" href="../../d8/d9e/structmessage.html">message</a>, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../d5/da5/astobj2_8h.html#a6321ee982370c55ab3c24c72c562cbdd">ao2_cleanup</a>);</div><div class="line"><a name="l02022"></a><span class="lineno"> 2022</span>&#160;   <a class="code" href="../../d5/d60/utils_8h.html#a1604b4d72144dd3d9f7da668e90337e9">RAII_VAR</a>(<span class="keyword">struct</span> <a class="code" href="../../d1/da1/structast__json.html">ast_json</a> *, json_array, <a class="code" href="../../d4/d05/json_8h.html#a48d874eed79fb2bbeb0557440e33ae67">ast_json_array_create</a>(), <a class="code" href="../../d4/d05/json_8h.html#a33bcd9181e613a659eefe411ec42c87c">ast_json_unref</a>);</div><div class="line"><a name="l02023"></a><span class="lineno"> 2023</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d1/da1/structast__json.html">ast_json</a> *json_filename = <a class="code" href="../../d4/d05/json_8h.html#adc52f8d76b7fdd0c8d12987981fd5bf5">ast_json_string_create</a>(filename);</div><div class="line"><a name="l02024"></a><span class="lineno"> 2024</span>&#160;</div><div class="line"><a name="l02025"></a><span class="lineno"> 2025</span>&#160;   <span class="keywordflow">if</span> (!json_array || !json_filename) {</div><div class="line"><a name="l02026"></a><span class="lineno"> 2026</span>&#160;      <a class="code" href="../../d4/d05/json_8h.html#a33bcd9181e613a659eefe411ec42c87c">ast_json_unref</a>(json_filename);</div><div class="line"><a name="l02027"></a><span class="lineno"> 2027</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l02028"></a><span class="lineno"> 2028</span>&#160;   }</div><div class="line"><a name="l02029"></a><span class="lineno"> 2029</span>&#160;   <a class="code" href="../../d4/d05/json_8h.html#a3d675e52f866630a6a03302df2712b8d">ast_json_array_append</a>(json_array, json_filename);</div><div class="line"><a name="l02030"></a><span class="lineno"> 2030</span>&#160;</div><div class="line"><a name="l02031"></a><span class="lineno"> 2031</span>&#160;   {</div><div class="line"><a name="l02032"></a><span class="lineno"> 2032</span>&#160;      <span class="keyword">const</span> <span class="keywordtype">char</span> *remote_station_id;</div><div class="line"><a name="l02033"></a><span class="lineno"> 2033</span>&#160;      <span class="keyword">const</span> <span class="keywordtype">char</span> *local_station_id;</div><div class="line"><a name="l02034"></a><span class="lineno"> 2034</span>&#160;      <span class="keyword">const</span> <span class="keywordtype">char</span> *fax_pages;</div><div class="line"><a name="l02035"></a><span class="lineno"> 2035</span>&#160;      <span class="keyword">const</span> <span class="keywordtype">char</span> *fax_resolution;</div><div class="line"><a name="l02036"></a><span class="lineno"> 2036</span>&#160;      <span class="keyword">const</span> <span class="keywordtype">char</span> *fax_bitrate;</div><div class="line"><a name="l02037"></a><span class="lineno"> 2037</span>&#160;      <a class="code" href="../../dd/d42/lock_8h.html#aa11d2e2d6aaa7048d48491842c1de738">SCOPED_CHANNELLOCK</a>(<a class="code" href="../../df/d44/app__meetme_8c.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>, chan);</div><div class="line"><a name="l02038"></a><span class="lineno"> 2038</span>&#160;</div><div class="line"><a name="l02039"></a><span class="lineno"> 2039</span>&#160;      remote_station_id = <a class="code" href="../../d4/d05/json_8h.html#ac319d5898e86709f7e25b1b2d73b7b12">AST_JSON_UTF8_VALIDATE</a>(<a class="code" href="../../db/de0/pbx_8h.html#a98c5425b90ec7c5e136a40f529170b1b">pbx_builtin_getvar_helper</a>(chan, <span class="stringliteral">&quot;REMOTESTATIONID&quot;</span>));</div><div class="line"><a name="l02040"></a><span class="lineno"> 2040</span>&#160;      <span class="keywordflow">if</span> (!<a class="code" href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a>(remote_station_id)) {</div><div class="line"><a name="l02041"></a><span class="lineno"> 2041</span>&#160;         remote_station_id = <a class="code" href="../../d8/d8a/astmm_8h.html#ab5f0750cc80ba337fdcbddea2d3a1ee6">ast_strdupa</a>(remote_station_id);</div><div class="line"><a name="l02042"></a><span class="lineno"> 2042</span>&#160;      }</div><div class="line"><a name="l02043"></a><span class="lineno"> 2043</span>&#160;      local_station_id = <a class="code" href="../../d4/d05/json_8h.html#ac319d5898e86709f7e25b1b2d73b7b12">AST_JSON_UTF8_VALIDATE</a>(<a class="code" href="../../db/de0/pbx_8h.html#a98c5425b90ec7c5e136a40f529170b1b">pbx_builtin_getvar_helper</a>(chan, <span class="stringliteral">&quot;LOCALSTATIONID&quot;</span>));</div><div class="line"><a name="l02044"></a><span class="lineno"> 2044</span>&#160;      <span class="keywordflow">if</span> (!<a class="code" href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a>(local_station_id)) {</div><div class="line"><a name="l02045"></a><span class="lineno"> 2045</span>&#160;         local_station_id = <a class="code" href="../../d8/d8a/astmm_8h.html#ab5f0750cc80ba337fdcbddea2d3a1ee6">ast_strdupa</a>(local_station_id);</div><div class="line"><a name="l02046"></a><span class="lineno"> 2046</span>&#160;      }</div><div class="line"><a name="l02047"></a><span class="lineno"> 2047</span>&#160;      fax_pages = <a class="code" href="../../d6/d90/strings_8h.html#a2faaa16929951bfd2802b7829a100ba2">S_OR</a>(<a class="code" href="../../db/de0/pbx_8h.html#a98c5425b90ec7c5e136a40f529170b1b">pbx_builtin_getvar_helper</a>(chan, <span class="stringliteral">&quot;FAXPAGES&quot;</span>), <span class="stringliteral">&quot;&quot;</span>);</div><div class="line"><a name="l02048"></a><span class="lineno"> 2048</span>&#160;      <span class="keywordflow">if</span> (!<a class="code" href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a>(fax_pages)) {</div><div class="line"><a name="l02049"></a><span class="lineno"> 2049</span>&#160;         fax_pages = <a class="code" href="../../d8/d8a/astmm_8h.html#ab5f0750cc80ba337fdcbddea2d3a1ee6">ast_strdupa</a>(fax_pages);</div><div class="line"><a name="l02050"></a><span class="lineno"> 2050</span>&#160;      }</div><div class="line"><a name="l02051"></a><span class="lineno"> 2051</span>&#160;      fax_resolution = <a class="code" href="../../d6/d90/strings_8h.html#a2faaa16929951bfd2802b7829a100ba2">S_OR</a>(<a class="code" href="../../db/de0/pbx_8h.html#a98c5425b90ec7c5e136a40f529170b1b">pbx_builtin_getvar_helper</a>(chan, <span class="stringliteral">&quot;FAXRESOLUTION&quot;</span>), <span class="stringliteral">&quot;&quot;</span>);</div><div class="line"><a name="l02052"></a><span class="lineno"> 2052</span>&#160;      <span class="keywordflow">if</span> (!<a class="code" href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a>(fax_resolution)) {</div><div class="line"><a name="l02053"></a><span class="lineno"> 2053</span>&#160;         fax_resolution = <a class="code" href="../../d8/d8a/astmm_8h.html#ab5f0750cc80ba337fdcbddea2d3a1ee6">ast_strdupa</a>(fax_resolution);</div><div class="line"><a name="l02054"></a><span class="lineno"> 2054</span>&#160;      }</div><div class="line"><a name="l02055"></a><span class="lineno"> 2055</span>&#160;      fax_bitrate = <a class="code" href="../../d6/d90/strings_8h.html#a2faaa16929951bfd2802b7829a100ba2">S_OR</a>(<a class="code" href="../../db/de0/pbx_8h.html#a98c5425b90ec7c5e136a40f529170b1b">pbx_builtin_getvar_helper</a>(chan, <span class="stringliteral">&quot;FAXBITRATE&quot;</span>), <span class="stringliteral">&quot;&quot;</span>);</div><div class="line"><a name="l02056"></a><span class="lineno"> 2056</span>&#160;      <span class="keywordflow">if</span> (!<a class="code" href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a>(fax_bitrate)) {</div><div class="line"><a name="l02057"></a><span class="lineno"> 2057</span>&#160;         fax_bitrate = <a class="code" href="../../d8/d8a/astmm_8h.html#ab5f0750cc80ba337fdcbddea2d3a1ee6">ast_strdupa</a>(fax_bitrate);</div><div class="line"><a name="l02058"></a><span class="lineno"> 2058</span>&#160;      }</div><div class="line"><a name="l02059"></a><span class="lineno"> 2059</span>&#160;</div><div class="line"><a name="l02060"></a><span class="lineno"> 2060</span>&#160;      json_object = <a class="code" href="../../d4/d05/json_8h.html#a99715667e822b2ad409b34ca041e535d">ast_json_pack</a>(<span class="stringliteral">&quot;{s: s, s: s, s: s, s: s, s: s, s: s, s: o}&quot;</span>,</div><div class="line"><a name="l02061"></a><span class="lineno"> 2061</span>&#160;            <span class="stringliteral">&quot;type&quot;</span>, <span class="stringliteral">&quot;receive&quot;</span>,</div><div class="line"><a name="l02062"></a><span class="lineno"> 2062</span>&#160;            <span class="stringliteral">&quot;remote_station_id&quot;</span>, <a class="code" href="../../d6/d90/strings_8h.html#a2faaa16929951bfd2802b7829a100ba2">S_OR</a>(remote_station_id, <span class="stringliteral">&quot;&quot;</span>),</div><div class="line"><a name="l02063"></a><span class="lineno"> 2063</span>&#160;            <span class="stringliteral">&quot;local_station_id&quot;</span>, <a class="code" href="../../d6/d90/strings_8h.html#a2faaa16929951bfd2802b7829a100ba2">S_OR</a>(local_station_id, <span class="stringliteral">&quot;&quot;</span>),</div><div class="line"><a name="l02064"></a><span class="lineno"> 2064</span>&#160;            <span class="stringliteral">&quot;fax_pages&quot;</span>, <a class="code" href="../../d6/d90/strings_8h.html#a2faaa16929951bfd2802b7829a100ba2">S_OR</a>(fax_pages, <span class="stringliteral">&quot;&quot;</span>),</div><div class="line"><a name="l02065"></a><span class="lineno"> 2065</span>&#160;            <span class="stringliteral">&quot;fax_resolution&quot;</span>, <a class="code" href="../../d6/d90/strings_8h.html#a2faaa16929951bfd2802b7829a100ba2">S_OR</a>(fax_resolution, <span class="stringliteral">&quot;&quot;</span>),</div><div class="line"><a name="l02066"></a><span class="lineno"> 2066</span>&#160;            <span class="stringliteral">&quot;fax_bitrate&quot;</span>, <a class="code" href="../../d6/d90/strings_8h.html#a2faaa16929951bfd2802b7829a100ba2">S_OR</a>(fax_bitrate, <span class="stringliteral">&quot;&quot;</span>),</div><div class="line"><a name="l02067"></a><span class="lineno"> 2067</span>&#160;            <span class="stringliteral">&quot;filenames&quot;</span>, <a class="code" href="../../d4/d05/json_8h.html#a0ca956b7df20127f7e38993c3c06cb2c">ast_json_ref</a>(json_array));</div><div class="line"><a name="l02068"></a><span class="lineno"> 2068</span>&#160;      <span class="keywordflow">if</span> (!json_object) {</div><div class="line"><a name="l02069"></a><span class="lineno"> 2069</span>&#160;         <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l02070"></a><span class="lineno"> 2070</span>&#160;      }</div><div class="line"><a name="l02071"></a><span class="lineno"> 2071</span>&#160;</div><div class="line"><a name="l02072"></a><span class="lineno"> 2072</span>&#160;      <a class="code" href="../../d8/d9e/structmessage.html">message</a> = <a class="code" href="../../df/deb/group__StasisTopicsAndMessages.html#gafe8b123e0c124e44c3bff016591d3f9c">ast_channel_blob_create_from_cache</a>(<a class="code" href="../../d5/d7b/channel_8h.html#a3b6254f6d3832ef928f0a727113b1c63">ast_channel_uniqueid</a>(chan), <a class="code" href="../../df/deb/group__StasisTopicsAndMessages.html#ga6d11307e605e80f977bde354a11d7902">ast_channel_fax_type</a>(), json_object);</div><div class="line"><a name="l02073"></a><span class="lineno"> 2073</span>&#160;      <span class="keywordflow">if</span> (!<a class="code" href="../../d8/d9e/structmessage.html">message</a>) {</div><div class="line"><a name="l02074"></a><span class="lineno"> 2074</span>&#160;         <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l02075"></a><span class="lineno"> 2075</span>&#160;      }</div><div class="line"><a name="l02076"></a><span class="lineno"> 2076</span>&#160;      <a class="code" href="../../dd/d79/stasis_8h.html#ac43d0a33d111e9f34b441b285c166cfc">stasis_publish</a>(<a class="code" href="../../d5/d7b/channel_8h.html#afdeaf9abb1aecc715313a4f62c1cf9c9">ast_channel_topic</a>(chan), <a class="code" href="../../d8/d9e/structmessage.html">message</a>);</div><div class="line"><a name="l02077"></a><span class="lineno"> 2077</span>&#160;   }</div><div class="line"><a name="l02078"></a><span class="lineno"> 2078</span>&#160;   <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l02079"></a><span class="lineno"> 2079</span>&#160;}</div><div class="line"><a name="l02080"></a><span class="lineno"> 2080</span>&#160;<span class="comment"></span></div><div class="line"><a name="l02081"></a><span class="lineno"> 2081</span>&#160;<span class="comment">/*! \brief initiate a receive FAX session */</span></div><div class="line"><a name="l02082"></a><span class="lineno"><a class="line" href="../../d0/d60/res__fax_8c.html#a73c65030688bef51d1d09e342f261a0f"> 2082</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d0/d60/res__fax_8c.html#a73c65030688bef51d1d09e342f261a0f">receivefax_exec</a>(<span class="keyword">struct</span> <a class="code" href="../../df/d3c/structast__channel.html">ast_channel</a> *chan, <span class="keyword">const</span> <span class="keywordtype">char</span> *data)</div><div class="line"><a name="l02083"></a><span class="lineno"> 2083</span>&#160;{</div><div class="line"><a name="l02084"></a><span class="lineno"> 2084</span>&#160;   <span class="keywordtype">char</span> *<a class="code" href="../../d0/dd6/chan__mgcp_8c.html#a2e006acff60d9b3d65d7d60f975d6747">parse</a>, modems[128] = <span class="stringliteral">&quot;&quot;</span>;</div><div class="line"><a name="l02085"></a><span class="lineno"> 2085</span>&#160;   <span class="keywordtype">int</span> channel_alive;</div><div class="line"><a name="l02086"></a><span class="lineno"> 2086</span>&#160;   <a class="code" href="../../d5/d60/utils_8h.html#a1604b4d72144dd3d9f7da668e90337e9">RAII_VAR</a>(<span class="keyword">struct</span> <a class="code" href="../../d1/d16/structast__fax__session.html">ast_fax_session</a> *, s, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../d5/da5/astobj2_8h.html#a6321ee982370c55ab3c24c72c562cbdd">ao2_cleanup</a>);</div><div class="line"><a name="l02087"></a><span class="lineno"> 2087</span>&#160;   <a class="code" href="../../d5/d60/utils_8h.html#a1604b4d72144dd3d9f7da668e90337e9">RAII_VAR</a>(<span class="keyword">struct</span> <a class="code" href="../../d8/dc2/structast__fax__session__details.html">ast_fax_session_details</a> *, details, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../d5/da5/astobj2_8h.html#a6321ee982370c55ab3c24c72c562cbdd">ao2_cleanup</a>);</div><div class="line"><a name="l02088"></a><span class="lineno"> 2088</span>&#160;   <span class="keyword">struct </span>ast_fax_tech_token *token = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l02089"></a><span class="lineno"> 2089</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d2/db8/structast__fax__document.html">ast_fax_document</a> *doc;</div><div class="line"><a name="l02090"></a><span class="lineno"> 2090</span>&#160;   <a class="code" href="../../d3/d93/include_2asterisk_2app_8h.html#a80cd3f6f786b59b742bcecfc0b3be7c2">AST_DECLARE_APP_ARGS</a>(<a class="code" href="../../d5/dde/test__func__file_8c.html#a7df83d295429a2562396f1ec127a46c0">args</a>,</div><div class="line"><a name="l02091"></a><span class="lineno"> 2091</span>&#160;      <a class="code" href="../../d3/d93/include_2asterisk_2app_8h.html#a037e9a5b28477b17e7c9acbe7ecb21d5">AST_APP_ARG</a>(<a class="code" href="../../d2/db8/structast__fax__document.html#afae8c108f5d360038fa8b099eb4ab2f3">filename</a>);</div><div class="line"><a name="l02092"></a><span class="lineno"> 2092</span>&#160;      <a class="code" href="../../d3/d93/include_2asterisk_2app_8h.html#a037e9a5b28477b17e7c9acbe7ecb21d5">AST_APP_ARG</a>(<a class="code" href="../../d4/d45/test__http__media__cache_8c.html#a80c8e3ae5087d90d422675d034eeebc7">options</a>);</div><div class="line"><a name="l02093"></a><span class="lineno"> 2093</span>&#160;   );</div><div class="line"><a name="l02094"></a><span class="lineno"> 2094</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../dc/dac/structast__flags.html">ast_flags</a> opts = { 0, };</div><div class="line"><a name="l02095"></a><span class="lineno"> 2095</span>&#160;   <span class="keyword">enum</span> <a class="code" href="../../d5/d7b/channel_8h.html#a4cd990f4c1cd0c2af6e4c63f6d15b4e1">ast_t38_state</a> <a class="code" href="../../d1/d94/sip_8h.html#ada584ef2e7f77c8dfe0315d05fa49e1c">t38state</a>;</div><div class="line"><a name="l02096"></a><span class="lineno"> 2096</span>&#160;</div><div class="line"><a name="l02097"></a><span class="lineno"> 2097</span>&#160;   <span class="comment">/* initialize output channel variables */</span></div><div class="line"><a name="l02098"></a><span class="lineno"> 2098</span>&#160;   <a class="code" href="../../db/de0/pbx_8h.html#a6e5b90edb84d216267148dddcffe9b9a">pbx_builtin_setvar_helper</a>(chan, <span class="stringliteral">&quot;FAXSTATUS&quot;</span>, <span class="stringliteral">&quot;FAILED&quot;</span>);</div><div class="line"><a name="l02099"></a><span class="lineno"> 2099</span>&#160;   <a class="code" href="../../db/de0/pbx_8h.html#a6e5b90edb84d216267148dddcffe9b9a">pbx_builtin_setvar_helper</a>(chan, <span class="stringliteral">&quot;REMOTESTATIONID&quot;</span>, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div><div class="line"><a name="l02100"></a><span class="lineno"> 2100</span>&#160;   <a class="code" href="../../db/de0/pbx_8h.html#a6e5b90edb84d216267148dddcffe9b9a">pbx_builtin_setvar_helper</a>(chan, <span class="stringliteral">&quot;FAXPAGES&quot;</span>, <span class="stringliteral">&quot;0&quot;</span>);</div><div class="line"><a name="l02101"></a><span class="lineno"> 2101</span>&#160;   <a class="code" href="../../db/de0/pbx_8h.html#a6e5b90edb84d216267148dddcffe9b9a">pbx_builtin_setvar_helper</a>(chan, <span class="stringliteral">&quot;FAXBITRATE&quot;</span>, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div><div class="line"><a name="l02102"></a><span class="lineno"> 2102</span>&#160;   <a class="code" href="../../db/de0/pbx_8h.html#a6e5b90edb84d216267148dddcffe9b9a">pbx_builtin_setvar_helper</a>(chan, <span class="stringliteral">&quot;FAXRESOLUTION&quot;</span>, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div><div class="line"><a name="l02103"></a><span class="lineno"> 2103</span>&#160;   <a class="code" href="../../db/de0/pbx_8h.html#a6e5b90edb84d216267148dddcffe9b9a">pbx_builtin_setvar_helper</a>(chan, <span class="stringliteral">&quot;FAXMODE&quot;</span>, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div><div class="line"><a name="l02104"></a><span class="lineno"> 2104</span>&#160;</div><div class="line"><a name="l02105"></a><span class="lineno"> 2105</span>&#160;   <span class="comment">/* Get a FAX session details structure from the channel&#39;s FAX datastore and create one if</span></div><div class="line"><a name="l02106"></a><span class="lineno"> 2106</span>&#160;<span class="comment">    * it does not already exist. */</span></div><div class="line"><a name="l02107"></a><span class="lineno"> 2107</span>&#160;   <span class="keywordflow">if</span> (!(details = <a class="code" href="../../d0/d60/res__fax_8c.html#ac4310e981e9db76dfc3e85c51f4c6e1e">find_or_create_details</a>(chan))) {</div><div class="line"><a name="l02108"></a><span class="lineno"> 2108</span>&#160;      <a class="code" href="../../db/de0/pbx_8h.html#a6e5b90edb84d216267148dddcffe9b9a">pbx_builtin_setvar_helper</a>(chan, <span class="stringliteral">&quot;FAXERROR&quot;</span>, <span class="stringliteral">&quot;MEMORY_ERROR&quot;</span>);</div><div class="line"><a name="l02109"></a><span class="lineno"> 2109</span>&#160;      <a class="code" href="../../db/de0/pbx_8h.html#a6e5b90edb84d216267148dddcffe9b9a">pbx_builtin_setvar_helper</a>(chan, <span class="stringliteral">&quot;FAXSTATUSSTRING&quot;</span>, <span class="stringliteral">&quot;error allocating memory&quot;</span>);</div><div class="line"><a name="l02110"></a><span class="lineno"> 2110</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;System cannot provide memory for session requirements.\n&quot;</span>);</div><div class="line"><a name="l02111"></a><span class="lineno"> 2111</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l02112"></a><span class="lineno"> 2112</span>&#160;   }</div><div class="line"><a name="l02113"></a><span class="lineno"> 2113</span>&#160;</div><div class="line"><a name="l02114"></a><span class="lineno"> 2114</span>&#160;   <a class="code" href="../../d1/d0f/stringfields_8h.html#a653461abd6e0d16e4e3326ab90e0501d">ast_string_field_set</a>(details, <a class="code" href="../../de/d1b/cel__pgsql_8c.html#ad6c487210772a9b4b0ca04b04b847d4c">result</a>, <span class="stringliteral">&quot;FAILED&quot;</span>);</div><div class="line"><a name="l02115"></a><span class="lineno"> 2115</span>&#160;   <a class="code" href="../../d1/d0f/stringfields_8h.html#a653461abd6e0d16e4e3326ab90e0501d">ast_string_field_set</a>(details, resultstr, <span class="stringliteral">&quot;error starting fax session&quot;</span>);</div><div class="line"><a name="l02116"></a><span class="lineno"> 2116</span>&#160;   <a class="code" href="../../d1/d0f/stringfields_8h.html#a653461abd6e0d16e4e3326ab90e0501d">ast_string_field_set</a>(details, <a class="code" href="../../d6/d47/utils_2frame_8c.html#a4a9391ee88e57361b613c4c2fd2bf4aa">error</a>, <span class="stringliteral">&quot;INIT_ERROR&quot;</span>);</div><div class="line"><a name="l02117"></a><span class="lineno"> 2117</span>&#160;   <a class="code" href="../../d0/d60/res__fax_8c.html#ad7732b5ae304d39afa2dacb20187cf04">set_channel_variables</a>(chan, details);</div><div class="line"><a name="l02118"></a><span class="lineno"> 2118</span>&#160;</div><div class="line"><a name="l02119"></a><span class="lineno"> 2119</span>&#160;   <span class="keywordflow">if</span> (details-&gt;<a class="code" href="../../d8/dc2/structast__fax__session__details.html#a2a669261b0b8c26d26573c678149d312">gateway_id</a> &gt; 0) {</div><div class="line"><a name="l02120"></a><span class="lineno"> 2120</span>&#160;      <a class="code" href="../../d1/d0f/stringfields_8h.html#a653461abd6e0d16e4e3326ab90e0501d">ast_string_field_set</a>(details, resultstr, <span class="stringliteral">&quot;can&#39;t receive a fax on a channel with a T.38 gateway&quot;</span>);</div><div class="line"><a name="l02121"></a><span class="lineno"> 2121</span>&#160;      <a class="code" href="../../d0/d60/res__fax_8c.html#ad7732b5ae304d39afa2dacb20187cf04">set_channel_variables</a>(chan, details);</div><div class="line"><a name="l02122"></a><span class="lineno"> 2122</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;executing ReceiveFAX on a channel with a T.38 Gateway is not supported\n&quot;</span>);</div><div class="line"><a name="l02123"></a><span class="lineno"> 2123</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l02124"></a><span class="lineno"> 2124</span>&#160;   }</div><div class="line"><a name="l02125"></a><span class="lineno"> 2125</span>&#160;</div><div class="line"><a name="l02126"></a><span class="lineno"> 2126</span>&#160;   <span class="keywordflow">if</span> (details-&gt;<a class="code" href="../../d8/dc2/structast__fax__session__details.html#a975b0a45868387d13867daeac314978a">maxrate</a> &lt; details-&gt;<a class="code" href="../../d8/dc2/structast__fax__session__details.html#a8bff16fb9ab2254b86636f6fac166a66">minrate</a>) {</div><div class="line"><a name="l02127"></a><span class="lineno"> 2127</span>&#160;      <a class="code" href="../../d1/d0f/stringfields_8h.html#a653461abd6e0d16e4e3326ab90e0501d">ast_string_field_set</a>(details, <a class="code" href="../../d6/d47/utils_2frame_8c.html#a4a9391ee88e57361b613c4c2fd2bf4aa">error</a>, <span class="stringliteral">&quot;INVALID_ARGUMENTS&quot;</span>);</div><div class="line"><a name="l02128"></a><span class="lineno"> 2128</span>&#160;      <a class="code" href="../../d1/d0f/stringfields_8h.html#a653461abd6e0d16e4e3326ab90e0501d">ast_string_field_set</a>(details, resultstr, <span class="stringliteral">&quot;maxrate is less than minrate&quot;</span>);</div><div class="line"><a name="l02129"></a><span class="lineno"> 2129</span>&#160;      <a class="code" href="../../d0/d60/res__fax_8c.html#ad7732b5ae304d39afa2dacb20187cf04">set_channel_variables</a>(chan, details);</div><div class="line"><a name="l02130"></a><span class="lineno"> 2130</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;maxrate %u is less than minrate %u\n&quot;</span>, details-&gt;<a class="code" href="../../d8/dc2/structast__fax__session__details.html#a975b0a45868387d13867daeac314978a">maxrate</a>, details-&gt;<a class="code" href="../../d8/dc2/structast__fax__session__details.html#a8bff16fb9ab2254b86636f6fac166a66">minrate</a>);</div><div class="line"><a name="l02131"></a><span class="lineno"> 2131</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l02132"></a><span class="lineno"> 2132</span>&#160;   }</div><div class="line"><a name="l02133"></a><span class="lineno"> 2133</span>&#160;</div><div class="line"><a name="l02134"></a><span class="lineno"> 2134</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d0/d60/res__fax_8c.html#a693b0f3ff5d9020fe797cdc46e9489d4">check_modem_rate</a>(details-&gt;<a class="code" href="../../d8/dc2/structast__fax__session__details.html#a38b557eee45ee4c0d92d514c04823f84">modems</a>, details-&gt;<a class="code" href="../../d8/dc2/structast__fax__session__details.html#a8bff16fb9ab2254b86636f6fac166a66">minrate</a>)) {</div><div class="line"><a name="l02135"></a><span class="lineno"> 2135</span>&#160;      <a class="code" href="../../d0/d60/res__fax_8c.html#a9310358a6223a275dce64548ab625062">ast_fax_modem_to_str</a>(details-&gt;<a class="code" href="../../d8/dc2/structast__fax__session__details.html#a38b557eee45ee4c0d92d514c04823f84">modems</a>, modems, <span class="keyword">sizeof</span>(modems));</div><div class="line"><a name="l02136"></a><span class="lineno"> 2136</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;&#39;modems&#39; setting &#39;%s&#39; is incompatible with &#39;minrate&#39; setting %u\n&quot;</span>, modems, details-&gt;<a class="code" href="../../d8/dc2/structast__fax__session__details.html#a8bff16fb9ab2254b86636f6fac166a66">minrate</a>);</div><div class="line"><a name="l02137"></a><span class="lineno"> 2137</span>&#160;      <a class="code" href="../../d1/d0f/stringfields_8h.html#a653461abd6e0d16e4e3326ab90e0501d">ast_string_field_set</a>(details, <a class="code" href="../../d6/d47/utils_2frame_8c.html#a4a9391ee88e57361b613c4c2fd2bf4aa">error</a>, <span class="stringliteral">&quot;INVALID_ARGUMENTS&quot;</span>);</div><div class="line"><a name="l02138"></a><span class="lineno"> 2138</span>&#160;      <a class="code" href="../../d1/d0f/stringfields_8h.html#a653461abd6e0d16e4e3326ab90e0501d">ast_string_field_set</a>(details, resultstr, <span class="stringliteral">&quot;incompatible &#39;modems&#39; and &#39;minrate&#39; settings&quot;</span>);</div><div class="line"><a name="l02139"></a><span class="lineno"> 2139</span>&#160;      <a class="code" href="../../d0/d60/res__fax_8c.html#ad7732b5ae304d39afa2dacb20187cf04">set_channel_variables</a>(chan, details);</div><div class="line"><a name="l02140"></a><span class="lineno"> 2140</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l02141"></a><span class="lineno"> 2141</span>&#160;   }</div><div class="line"><a name="l02142"></a><span class="lineno"> 2142</span>&#160;</div><div class="line"><a name="l02143"></a><span class="lineno"> 2143</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d0/d60/res__fax_8c.html#a693b0f3ff5d9020fe797cdc46e9489d4">check_modem_rate</a>(details-&gt;<a class="code" href="../../d8/dc2/structast__fax__session__details.html#a38b557eee45ee4c0d92d514c04823f84">modems</a>, details-&gt;<a class="code" href="../../d8/dc2/structast__fax__session__details.html#a975b0a45868387d13867daeac314978a">maxrate</a>)) {</div><div class="line"><a name="l02144"></a><span class="lineno"> 2144</span>&#160;      <a class="code" href="../../d0/d60/res__fax_8c.html#a9310358a6223a275dce64548ab625062">ast_fax_modem_to_str</a>(details-&gt;<a class="code" href="../../d8/dc2/structast__fax__session__details.html#a38b557eee45ee4c0d92d514c04823f84">modems</a>, modems, <span class="keyword">sizeof</span>(modems));</div><div class="line"><a name="l02145"></a><span class="lineno"> 2145</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;&#39;modems&#39; setting &#39;%s&#39; is incompatible with &#39;maxrate&#39; setting %u\n&quot;</span>, modems, details-&gt;<a class="code" href="../../d8/dc2/structast__fax__session__details.html#a975b0a45868387d13867daeac314978a">maxrate</a>);</div><div class="line"><a name="l02146"></a><span class="lineno"> 2146</span>&#160;      <a class="code" href="../../d1/d0f/stringfields_8h.html#a653461abd6e0d16e4e3326ab90e0501d">ast_string_field_set</a>(details, <a class="code" href="../../d6/d47/utils_2frame_8c.html#a4a9391ee88e57361b613c4c2fd2bf4aa">error</a>, <span class="stringliteral">&quot;INVALID_ARGUMENTS&quot;</span>);</div><div class="line"><a name="l02147"></a><span class="lineno"> 2147</span>&#160;      <a class="code" href="../../d1/d0f/stringfields_8h.html#a653461abd6e0d16e4e3326ab90e0501d">ast_string_field_set</a>(details, resultstr, <span class="stringliteral">&quot;incompatible &#39;modems&#39; and &#39;maxrate&#39; settings&quot;</span>);</div><div class="line"><a name="l02148"></a><span class="lineno"> 2148</span>&#160;      <a class="code" href="../../d0/d60/res__fax_8c.html#ad7732b5ae304d39afa2dacb20187cf04">set_channel_variables</a>(chan, details);</div><div class="line"><a name="l02149"></a><span class="lineno"> 2149</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l02150"></a><span class="lineno"> 2150</span>&#160;   }</div><div class="line"><a name="l02151"></a><span class="lineno"> 2151</span>&#160;</div><div class="line"><a name="l02152"></a><span class="lineno"> 2152</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a>(data)) {</div><div class="line"><a name="l02153"></a><span class="lineno"> 2153</span>&#160;      <a class="code" href="../../d1/d0f/stringfields_8h.html#a653461abd6e0d16e4e3326ab90e0501d">ast_string_field_set</a>(details, <a class="code" href="../../d6/d47/utils_2frame_8c.html#a4a9391ee88e57361b613c4c2fd2bf4aa">error</a>, <span class="stringliteral">&quot;INVALID_ARGUMENTS&quot;</span>);</div><div class="line"><a name="l02154"></a><span class="lineno"> 2154</span>&#160;      <a class="code" href="../../d1/d0f/stringfields_8h.html#a653461abd6e0d16e4e3326ab90e0501d">ast_string_field_set</a>(details, resultstr, <span class="stringliteral">&quot;invalid arguments&quot;</span>);</div><div class="line"><a name="l02155"></a><span class="lineno"> 2155</span>&#160;      <a class="code" href="../../d0/d60/res__fax_8c.html#ad7732b5ae304d39afa2dacb20187cf04">set_channel_variables</a>(chan, details);</div><div class="line"><a name="l02156"></a><span class="lineno"> 2156</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;%s requires an argument (filename[,options])\n&quot;</span>, <a class="code" href="../../d0/d60/res__fax_8c.html#a39b1d432fa7056aa4737e302b608f8ee">app_receivefax</a>);</div><div class="line"><a name="l02157"></a><span class="lineno"> 2157</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l02158"></a><span class="lineno"> 2158</span>&#160;   }</div><div class="line"><a name="l02159"></a><span class="lineno"> 2159</span>&#160;   parse = <a class="code" href="../../d8/d8a/astmm_8h.html#ab5f0750cc80ba337fdcbddea2d3a1ee6">ast_strdupa</a>(data);</div><div class="line"><a name="l02160"></a><span class="lineno"> 2160</span>&#160;   <a class="code" href="../../d3/d93/include_2asterisk_2app_8h.html#ac08f7eb1eb9476b30987c73e1052ada8">AST_STANDARD_APP_ARGS</a>(<a class="code" href="../../d5/dde/test__func__file_8c.html#a7df83d295429a2562396f1ec127a46c0">args</a>, parse);</div><div class="line"><a name="l02161"></a><span class="lineno"> 2161</span>&#160;</div><div class="line"><a name="l02162"></a><span class="lineno"> 2162</span>&#160;   <span class="keywordflow">if</span> (!<a class="code" href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a>(<a class="code" href="../../d5/dde/test__func__file_8c.html#a7df83d295429a2562396f1ec127a46c0">args</a>.options) &amp;&amp;</div><div class="line"><a name="l02163"></a><span class="lineno"> 2163</span>&#160;       <a class="code" href="../../d3/d93/include_2asterisk_2app_8h.html#af40039f1c49c16d0f6fa33fe9c43a0cb">ast_app_parse_options</a>(<a class="code" href="../../d0/d60/res__fax_8c.html#a2fccc15f81746e2ae5f88df9e88f3a7a">fax_exec_options</a>, &amp;opts, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../d5/dde/test__func__file_8c.html#a7df83d295429a2562396f1ec127a46c0">args</a>.options)) {</div><div class="line"><a name="l02164"></a><span class="lineno"> 2164</span>&#160;      <a class="code" href="../../d1/d0f/stringfields_8h.html#a653461abd6e0d16e4e3326ab90e0501d">ast_string_field_set</a>(details, <a class="code" href="../../d6/d47/utils_2frame_8c.html#a4a9391ee88e57361b613c4c2fd2bf4aa">error</a>, <span class="stringliteral">&quot;INVALID_ARGUMENTS&quot;</span>);</div><div class="line"><a name="l02165"></a><span class="lineno"> 2165</span>&#160;      <a class="code" href="../../d1/d0f/stringfields_8h.html#a653461abd6e0d16e4e3326ab90e0501d">ast_string_field_set</a>(details, resultstr, <span class="stringliteral">&quot;invalid arguments&quot;</span>);</div><div class="line"><a name="l02166"></a><span class="lineno"> 2166</span>&#160;      <a class="code" href="../../d0/d60/res__fax_8c.html#ad7732b5ae304d39afa2dacb20187cf04">set_channel_variables</a>(chan, details);</div><div class="line"><a name="l02167"></a><span class="lineno"> 2167</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l02168"></a><span class="lineno"> 2168</span>&#160;   }</div><div class="line"><a name="l02169"></a><span class="lineno"> 2169</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a>(<a class="code" href="../../d5/dde/test__func__file_8c.html#a7df83d295429a2562396f1ec127a46c0">args</a>.filename)) {</div><div class="line"><a name="l02170"></a><span class="lineno"> 2170</span>&#160;      <a class="code" href="../../d1/d0f/stringfields_8h.html#a653461abd6e0d16e4e3326ab90e0501d">ast_string_field_set</a>(details, <a class="code" href="../../d6/d47/utils_2frame_8c.html#a4a9391ee88e57361b613c4c2fd2bf4aa">error</a>, <span class="stringliteral">&quot;INVALID_ARGUMENTS&quot;</span>);</div><div class="line"><a name="l02171"></a><span class="lineno"> 2171</span>&#160;      <a class="code" href="../../d1/d0f/stringfields_8h.html#a653461abd6e0d16e4e3326ab90e0501d">ast_string_field_set</a>(details, resultstr, <span class="stringliteral">&quot;invalid arguments&quot;</span>);</div><div class="line"><a name="l02172"></a><span class="lineno"> 2172</span>&#160;      <a class="code" href="../../d0/d60/res__fax_8c.html#ad7732b5ae304d39afa2dacb20187cf04">set_channel_variables</a>(chan, details);</div><div class="line"><a name="l02173"></a><span class="lineno"> 2173</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;%s requires an argument (filename[,options])\n&quot;</span>, <a class="code" href="../../d0/d60/res__fax_8c.html#a39b1d432fa7056aa4737e302b608f8ee">app_receivefax</a>);</div><div class="line"><a name="l02174"></a><span class="lineno"> 2174</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l02175"></a><span class="lineno"> 2175</span>&#160;   }</div><div class="line"><a name="l02176"></a><span class="lineno"> 2176</span>&#160;</div><div class="line"><a name="l02177"></a><span class="lineno"> 2177</span>&#160;   <span class="comment">/* check for unsupported FAX application options */</span></div><div class="line"><a name="l02178"></a><span class="lineno"> 2178</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d5/d60/utils_8h.html#a00d4c9254c9827d6fa44f17a326744a5">ast_test_flag</a>(&amp;opts, <a class="code" href="../../d0/d60/res__fax_8c.html#a46275621a3d3846d089a092249fb8c37a8e81c5ccb5474dde66440f846fdfdd90">OPT_CALLERMODE</a>) || <a class="code" href="../../d5/d60/utils_8h.html#a00d4c9254c9827d6fa44f17a326744a5">ast_test_flag</a>(&amp;opts, <a class="code" href="../../d0/d60/res__fax_8c.html#a46275621a3d3846d089a092249fb8c37a2ffdf9172bc4ad9ae1ee477d90078ef0">OPT_CALLEDMODE</a>)) {</div><div class="line"><a name="l02179"></a><span class="lineno"> 2179</span>&#160;      <a class="code" href="../../d1/d0f/stringfields_8h.html#a653461abd6e0d16e4e3326ab90e0501d">ast_string_field_set</a>(details, <a class="code" href="../../d6/d47/utils_2frame_8c.html#a4a9391ee88e57361b613c4c2fd2bf4aa">error</a>, <span class="stringliteral">&quot;INVALID_ARGUMENTS&quot;</span>);</div><div class="line"><a name="l02180"></a><span class="lineno"> 2180</span>&#160;      <a class="code" href="../../d1/d0f/stringfields_8h.html#a653461abd6e0d16e4e3326ab90e0501d">ast_string_field_set</a>(details, resultstr, <span class="stringliteral">&quot;invalid arguments&quot;</span>);</div><div class="line"><a name="l02181"></a><span class="lineno"> 2181</span>&#160;      <a class="code" href="../../d0/d60/res__fax_8c.html#ad7732b5ae304d39afa2dacb20187cf04">set_channel_variables</a>(chan, details);</div><div class="line"><a name="l02182"></a><span class="lineno"> 2182</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;%s does not support polling\n&quot;</span>, <a class="code" href="../../d0/d60/res__fax_8c.html#a39b1d432fa7056aa4737e302b608f8ee">app_receivefax</a>);</div><div class="line"><a name="l02183"></a><span class="lineno"> 2183</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l02184"></a><span class="lineno"> 2184</span>&#160;   }</div><div class="line"><a name="l02185"></a><span class="lineno"> 2185</span>&#160;</div><div class="line"><a name="l02186"></a><span class="lineno"> 2186</span>&#160;   <a class="code" href="../../dd/d42/lock_8h.html#a8a3bd496edfec04a95683ace66676200">ast_atomic_fetchadd_int</a>(&amp;<a class="code" href="../../d0/d60/res__fax_8c.html#a058b6772fcfe1ce5a1a0957e2f11d367">faxregistry</a>.fax_rx_attempts, 1);</div><div class="line"><a name="l02187"></a><span class="lineno"> 2187</span>&#160;</div><div class="line"><a name="l02188"></a><span class="lineno"> 2188</span>&#160;   <a class="code" href="../../db/de0/pbx_8h.html#a6e5b90edb84d216267148dddcffe9b9a">pbx_builtin_setvar_helper</a>(chan, <span class="stringliteral">&quot;FAXERROR&quot;</span>, <span class="stringliteral">&quot;Channel Problems&quot;</span>);</div><div class="line"><a name="l02189"></a><span class="lineno"> 2189</span>&#160;   <a class="code" href="../../db/de0/pbx_8h.html#a6e5b90edb84d216267148dddcffe9b9a">pbx_builtin_setvar_helper</a>(chan, <span class="stringliteral">&quot;FAXSTATUSSTRING&quot;</span>, <span class="stringliteral">&quot;Error before FAX transmission started.&quot;</span>);</div><div class="line"><a name="l02190"></a><span class="lineno"> 2190</span>&#160;</div><div class="line"><a name="l02191"></a><span class="lineno"> 2191</span>&#160;   <span class="keywordflow">if</span> (!(doc = <a class="code" href="../../d8/d8a/astmm_8h.html#ae0cd4c5524b01287ab19cbe233d9cebb">ast_calloc</a>(1, <span class="keyword">sizeof</span>(*doc) + strlen(<a class="code" href="../../d5/dde/test__func__file_8c.html#a7df83d295429a2562396f1ec127a46c0">args</a>.filename) + 1))) {</div><div class="line"><a name="l02192"></a><span class="lineno"> 2192</span>&#160;      <a class="code" href="../../d1/d0f/stringfields_8h.html#a653461abd6e0d16e4e3326ab90e0501d">ast_string_field_set</a>(details, <a class="code" href="../../d6/d47/utils_2frame_8c.html#a4a9391ee88e57361b613c4c2fd2bf4aa">error</a>, <span class="stringliteral">&quot;MEMORY_ERROR&quot;</span>);</div><div class="line"><a name="l02193"></a><span class="lineno"> 2193</span>&#160;      <a class="code" href="../../d1/d0f/stringfields_8h.html#a653461abd6e0d16e4e3326ab90e0501d">ast_string_field_set</a>(details, resultstr, <span class="stringliteral">&quot;error allocating memory&quot;</span>);</div><div class="line"><a name="l02194"></a><span class="lineno"> 2194</span>&#160;      <a class="code" href="../../d0/d60/res__fax_8c.html#ad7732b5ae304d39afa2dacb20187cf04">set_channel_variables</a>(chan, details);</div><div class="line"><a name="l02195"></a><span class="lineno"> 2195</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;System cannot provide memory for session requirements.\n&quot;</span>);</div><div class="line"><a name="l02196"></a><span class="lineno"> 2196</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l02197"></a><span class="lineno"> 2197</span>&#160;   }</div><div class="line"><a name="l02198"></a><span class="lineno"> 2198</span>&#160;</div><div class="line"><a name="l02199"></a><span class="lineno"> 2199</span>&#160;   strcpy(doc-&gt;<a class="code" href="../../d2/db8/structast__fax__document.html#afae8c108f5d360038fa8b099eb4ab2f3">filename</a>, <a class="code" href="../../d5/dde/test__func__file_8c.html#a7df83d295429a2562396f1ec127a46c0">args</a>.filename);</div><div class="line"><a name="l02200"></a><span class="lineno"> 2200</span>&#160;   <a class="code" href="../../df/d90/linkedlists_8h.html#a4d258b4525e63c435d7de579d3f46960">AST_LIST_INSERT_TAIL</a>(&amp;details-&gt;<a class="code" href="../../d8/dc2/structast__fax__session__details.html#a14c20eed7d6d03b484ebc2cc7a447ea2">documents</a>, doc, next);</div><div class="line"><a name="l02201"></a><span class="lineno"> 2201</span>&#160;</div><div class="line"><a name="l02202"></a><span class="lineno"> 2202</span>&#160;   <a class="code" href="../../d1/d8c/logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(3, <span class="stringliteral">&quot;Channel &#39;%s&#39; receiving FAX &#39;%s&#39;\n&quot;</span>, <a class="code" href="../../d5/d7b/channel_8h.html#a7ca2fda13b129a55c251b56729de285b">ast_channel_name</a>(chan), <a class="code" href="../../d5/dde/test__func__file_8c.html#a7df83d295429a2562396f1ec127a46c0">args</a>.filename);</div><div class="line"><a name="l02203"></a><span class="lineno"> 2203</span>&#160;</div><div class="line"><a name="l02204"></a><span class="lineno"> 2204</span>&#160;   details-&gt;<a class="code" href="../../d8/dc2/structast__fax__session__details.html#ad75375cdd336e91cbcee4a829fcdabfe">caps</a> = <a class="code" href="../../db/d6a/res__fax_8h.html#a54eb45ad548b874cf12d0a599631e3f6a77bcc28b15614142ddbf4a180d263602">AST_FAX_TECH_RECEIVE</a>;</div><div class="line"><a name="l02205"></a><span class="lineno"> 2205</span>&#160;   details-&gt;<a class="code" href="../../d8/dc2/structast__fax__session__details.html#a3ab211dbe8780b7292257f6b3dba1952">option</a>.<a class="code" href="../../d8/dc2/structast__fax__session__details.html#a71957d41c126c8b61cb93b69894d21fe">send_ced</a> = <a class="code" href="../../db/d6a/res__fax_8h.html#a1838c71fcf68c3cfe0ce37e35e77406dabd9b4a57405ba5c0c884ac98746a8bd7">AST_FAX_OPTFLAG_TRUE</a>;</div><div class="line"><a name="l02206"></a><span class="lineno"> 2206</span>&#160;</div><div class="line"><a name="l02207"></a><span class="lineno"> 2207</span>&#160;   <span class="comment">/* check for debug */</span></div><div class="line"><a name="l02208"></a><span class="lineno"> 2208</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d5/d60/utils_8h.html#a00d4c9254c9827d6fa44f17a326744a5">ast_test_flag</a>(&amp;opts, <a class="code" href="../../d0/d60/res__fax_8c.html#a46275621a3d3846d089a092249fb8c37ae18c66c85f5c325308846289886981d7">OPT_DEBUG</a>) || <a class="code" href="../../d0/d60/res__fax_8c.html#afb6be9ca0b6c0d09211b5c4e55fa2291">global_fax_debug</a>) {</div><div class="line"><a name="l02209"></a><span class="lineno"> 2209</span>&#160;      details-&gt;<a class="code" href="../../d8/dc2/structast__fax__session__details.html#a3ab211dbe8780b7292257f6b3dba1952">option</a>.<a class="code" href="../../d8/dc2/structast__fax__session__details.html#a84360ac08d9be11f221466122d8cdc65">debug</a> = <a class="code" href="../../db/d6a/res__fax_8h.html#a1838c71fcf68c3cfe0ce37e35e77406dabd9b4a57405ba5c0c884ac98746a8bd7">AST_FAX_OPTFLAG_TRUE</a>;</div><div class="line"><a name="l02210"></a><span class="lineno"> 2210</span>&#160;   }</div><div class="line"><a name="l02211"></a><span class="lineno"> 2211</span>&#160;</div><div class="line"><a name="l02212"></a><span class="lineno"> 2212</span>&#160;   <span class="comment">/* check for request for status events */</span></div><div class="line"><a name="l02213"></a><span class="lineno"> 2213</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d5/d60/utils_8h.html#a00d4c9254c9827d6fa44f17a326744a5">ast_test_flag</a>(&amp;opts, <a class="code" href="../../d0/d60/res__fax_8c.html#a46275621a3d3846d089a092249fb8c37ac50e4902aa670a5a0ad1927d8fef741a">OPT_STATUS</a>)) {</div><div class="line"><a name="l02214"></a><span class="lineno"> 2214</span>&#160;      details-&gt;<a class="code" href="../../d8/dc2/structast__fax__session__details.html#a3ab211dbe8780b7292257f6b3dba1952">option</a>.<a class="code" href="../../d8/dc2/structast__fax__session__details.html#a7f633c7bc4fe667e873649afa4d44640">statusevents</a> = <a class="code" href="../../db/d6a/res__fax_8h.html#a1838c71fcf68c3cfe0ce37e35e77406dabd9b4a57405ba5c0c884ac98746a8bd7">AST_FAX_OPTFLAG_TRUE</a>;</div><div class="line"><a name="l02215"></a><span class="lineno"> 2215</span>&#160;   }</div><div class="line"><a name="l02216"></a><span class="lineno"> 2216</span>&#160;</div><div class="line"><a name="l02217"></a><span class="lineno"> 2217</span>&#160;   t38state = <a class="code" href="../../d5/d7b/channel_8h.html#a1b22ea5302ef183fa68bc45bfb0659c9">ast_channel_get_t38_state</a>(chan);</div><div class="line"><a name="l02218"></a><span class="lineno"> 2218</span>&#160;   <span class="keywordflow">if</span> ((t38state == <a class="code" href="../../d5/d7b/channel_8h.html#a4cd990f4c1cd0c2af6e4c63f6d15b4e1a8bd9e539fb6a17b095fb24a75e0b4d21">T38_STATE_UNAVAILABLE</a>) || (t38state == <a class="code" href="../../d5/d7b/channel_8h.html#a4cd990f4c1cd0c2af6e4c63f6d15b4e1ad3745918c0830d3816e5ce5561814e7e">T38_STATE_REJECTED</a>) ||</div><div class="line"><a name="l02219"></a><span class="lineno"> 2219</span>&#160;       <a class="code" href="../../d5/d60/utils_8h.html#a00d4c9254c9827d6fa44f17a326744a5">ast_test_flag</a>(&amp;opts, <a class="code" href="../../d0/d60/res__fax_8c.html#a46275621a3d3846d089a092249fb8c37a98a16270534ab6ed19ac7935f6ab5730">OPT_ALLOWAUDIO</a>) ||</div><div class="line"><a name="l02220"></a><span class="lineno"> 2220</span>&#160;       <a class="code" href="../../d5/d60/utils_8h.html#a00d4c9254c9827d6fa44f17a326744a5">ast_test_flag</a>(&amp;opts, <a class="code" href="../../d0/d60/res__fax_8c.html#a46275621a3d3846d089a092249fb8c37a87052b571961ef8c1192a196d329ea1d">OPT_FORCE_AUDIO</a>)) {</div><div class="line"><a name="l02221"></a><span class="lineno"> 2221</span>&#160;      details-&gt;<a class="code" href="../../d8/dc2/structast__fax__session__details.html#a3ab211dbe8780b7292257f6b3dba1952">option</a>.<a class="code" href="../../d8/dc2/structast__fax__session__details.html#a2bdd8d6f48911b41e094440799e00bd2">allow_audio</a> = <a class="code" href="../../db/d6a/res__fax_8h.html#a1838c71fcf68c3cfe0ce37e35e77406dabd9b4a57405ba5c0c884ac98746a8bd7">AST_FAX_OPTFLAG_TRUE</a>;</div><div class="line"><a name="l02222"></a><span class="lineno"> 2222</span>&#160;   }</div><div class="line"><a name="l02223"></a><span class="lineno"> 2223</span>&#160;</div><div class="line"><a name="l02224"></a><span class="lineno"> 2224</span>&#160;   <span class="keywordflow">if</span> (!(s = <a class="code" href="../../d0/d60/res__fax_8c.html#aa71e4f978e47d124ee1f87b340fdfb78">fax_session_reserve</a>(details, &amp;token))) {</div><div class="line"><a name="l02225"></a><span class="lineno"> 2225</span>&#160;      <a class="code" href="../../d1/d0f/stringfields_8h.html#a653461abd6e0d16e4e3326ab90e0501d">ast_string_field_set</a>(details, resultstr, <span class="stringliteral">&quot;error reserving fax session&quot;</span>);</div><div class="line"><a name="l02226"></a><span class="lineno"> 2226</span>&#160;      <a class="code" href="../../d0/d60/res__fax_8c.html#ad7732b5ae304d39afa2dacb20187cf04">set_channel_variables</a>(chan, details);</div><div class="line"><a name="l02227"></a><span class="lineno"> 2227</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Unable to reserve FAX session.\n&quot;</span>);</div><div class="line"><a name="l02228"></a><span class="lineno"> 2228</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l02229"></a><span class="lineno"> 2229</span>&#160;   }</div><div class="line"><a name="l02230"></a><span class="lineno"> 2230</span>&#160;</div><div class="line"><a name="l02231"></a><span class="lineno"> 2231</span>&#160;   <span class="comment">/* make sure the channel is up */</span></div><div class="line"><a name="l02232"></a><span class="lineno"> 2232</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d9/d95/channelstate_8h.html#a03585bc87e5bbd0f4d11bc789734c660">ast_channel_state</a>(chan) != <a class="code" href="../../d9/d95/channelstate_8h.html#a03585bc87e5bbd0f4d11bc789734c660aa8ab4bcda7378ccc17c39dfd880cba3d">AST_STATE_UP</a>) {</div><div class="line"><a name="l02233"></a><span class="lineno"> 2233</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="../../d5/d7b/channel_8h.html#aec583a3e25358ee552a4f3df53914cd0">ast_answer</a>(chan)) {</div><div class="line"><a name="l02234"></a><span class="lineno"> 2234</span>&#160;         <a class="code" href="../../d1/d0f/stringfields_8h.html#a653461abd6e0d16e4e3326ab90e0501d">ast_string_field_set</a>(details, resultstr, <span class="stringliteral">&quot;error answering channel&quot;</span>);</div><div class="line"><a name="l02235"></a><span class="lineno"> 2235</span>&#160;         <a class="code" href="../../d0/d60/res__fax_8c.html#ad7732b5ae304d39afa2dacb20187cf04">set_channel_variables</a>(chan, details);</div><div class="line"><a name="l02236"></a><span class="lineno"> 2236</span>&#160;         <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Channel &#39;%s&#39; failed answer attempt.\n&quot;</span>, <a class="code" href="../../d5/d7b/channel_8h.html#a7ca2fda13b129a55c251b56729de285b">ast_channel_name</a>(chan));</div><div class="line"><a name="l02237"></a><span class="lineno"> 2237</span>&#160;         <a class="code" href="../../d0/d60/res__fax_8c.html#a049f9f29f5e7c99af20888026f84c5c1">fax_session_release</a>(s, token);</div><div class="line"><a name="l02238"></a><span class="lineno"> 2238</span>&#160;         <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l02239"></a><span class="lineno"> 2239</span>&#160;      }</div><div class="line"><a name="l02240"></a><span class="lineno"> 2240</span>&#160;   }</div><div class="line"><a name="l02241"></a><span class="lineno"> 2241</span>&#160;</div><div class="line"><a name="l02242"></a><span class="lineno"> 2242</span>&#160;   <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d60/utils_8h.html#a00d4c9254c9827d6fa44f17a326744a5">ast_test_flag</a>(&amp;opts, <a class="code" href="../../d0/d60/res__fax_8c.html#a46275621a3d3846d089a092249fb8c37a87052b571961ef8c1192a196d329ea1d">OPT_FORCE_AUDIO</a>)) {</div><div class="line"><a name="l02243"></a><span class="lineno"> 2243</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="../../d0/d60/res__fax_8c.html#abadd563fd124df50869cc1bdebf712be">set_fax_t38_caps</a>(chan, details)) {</div><div class="line"><a name="l02244"></a><span class="lineno"> 2244</span>&#160;         <a class="code" href="../../d1/d0f/stringfields_8h.html#a653461abd6e0d16e4e3326ab90e0501d">ast_string_field_set</a>(details, <a class="code" href="../../d6/d47/utils_2frame_8c.html#a4a9391ee88e57361b613c4c2fd2bf4aa">error</a>, <span class="stringliteral">&quot;T38_NEG_ERROR&quot;</span>);</div><div class="line"><a name="l02245"></a><span class="lineno"> 2245</span>&#160;         <a class="code" href="../../d1/d0f/stringfields_8h.html#a653461abd6e0d16e4e3326ab90e0501d">ast_string_field_set</a>(details, resultstr, <span class="stringliteral">&quot;error negotiating T.38&quot;</span>);</div><div class="line"><a name="l02246"></a><span class="lineno"> 2246</span>&#160;         <a class="code" href="../../d0/d60/res__fax_8c.html#ad7732b5ae304d39afa2dacb20187cf04">set_channel_variables</a>(chan, details);</div><div class="line"><a name="l02247"></a><span class="lineno"> 2247</span>&#160;         <a class="code" href="../../d0/d60/res__fax_8c.html#a049f9f29f5e7c99af20888026f84c5c1">fax_session_release</a>(s, token);</div><div class="line"><a name="l02248"></a><span class="lineno"> 2248</span>&#160;         <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l02249"></a><span class="lineno"> 2249</span>&#160;      }</div><div class="line"><a name="l02250"></a><span class="lineno"> 2250</span>&#160;   } <span class="keywordflow">else</span> {</div><div class="line"><a name="l02251"></a><span class="lineno"> 2251</span>&#160;      details-&gt;<a class="code" href="../../d8/dc2/structast__fax__session__details.html#ad75375cdd336e91cbcee4a829fcdabfe">caps</a> |= <a class="code" href="../../db/d6a/res__fax_8h.html#a54eb45ad548b874cf12d0a599631e3f6a76fa4111df51955a949e95fadbccd48b">AST_FAX_TECH_AUDIO</a>;</div><div class="line"><a name="l02252"></a><span class="lineno"> 2252</span>&#160;   }</div><div class="line"><a name="l02253"></a><span class="lineno"> 2253</span>&#160;</div><div class="line"><a name="l02254"></a><span class="lineno"> 2254</span>&#160;   <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d60/utils_8h.html#a00d4c9254c9827d6fa44f17a326744a5">ast_test_flag</a>(&amp;opts, <a class="code" href="../../d0/d60/res__fax_8c.html#a46275621a3d3846d089a092249fb8c37a87052b571961ef8c1192a196d329ea1d">OPT_FORCE_AUDIO</a>) &amp;&amp; (details-&gt;<a class="code" href="../../d8/dc2/structast__fax__session__details.html#ad75375cdd336e91cbcee4a829fcdabfe">caps</a> &amp; <a class="code" href="../../db/d6a/res__fax_8h.html#a54eb45ad548b874cf12d0a599631e3f6a6868445e2802e5b71068ae883366f635">AST_FAX_TECH_T38</a>)) {</div><div class="line"><a name="l02255"></a><span class="lineno"> 2255</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="../../d0/d60/res__fax_8c.html#a24d642cdb140e5795c10802786bf991f">receivefax_t38_init</a>(chan, details)) {</div><div class="line"><a name="l02256"></a><span class="lineno"> 2256</span>&#160;         <a class="code" href="../../d1/d0f/stringfields_8h.html#a653461abd6e0d16e4e3326ab90e0501d">ast_string_field_set</a>(details, <a class="code" href="../../d6/d47/utils_2frame_8c.html#a4a9391ee88e57361b613c4c2fd2bf4aa">error</a>, <span class="stringliteral">&quot;T38_NEG_ERROR&quot;</span>);</div><div class="line"><a name="l02257"></a><span class="lineno"> 2257</span>&#160;         <a class="code" href="../../d1/d0f/stringfields_8h.html#a653461abd6e0d16e4e3326ab90e0501d">ast_string_field_set</a>(details, resultstr, <span class="stringliteral">&quot;error negotiating T.38&quot;</span>);</div><div class="line"><a name="l02258"></a><span class="lineno"> 2258</span>&#160;         <a class="code" href="../../d0/d60/res__fax_8c.html#ad7732b5ae304d39afa2dacb20187cf04">set_channel_variables</a>(chan, details);</div><div class="line"><a name="l02259"></a><span class="lineno"> 2259</span>&#160;         <a class="code" href="../../d0/d60/res__fax_8c.html#a049f9f29f5e7c99af20888026f84c5c1">fax_session_release</a>(s, token);</div><div class="line"><a name="l02260"></a><span class="lineno"> 2260</span>&#160;         <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;error initializing channel &#39;%s&#39; in T.38 mode\n&quot;</span>, <a class="code" href="../../d5/d7b/channel_8h.html#a7ca2fda13b129a55c251b56729de285b">ast_channel_name</a>(chan));</div><div class="line"><a name="l02261"></a><span class="lineno"> 2261</span>&#160;         <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l02262"></a><span class="lineno"> 2262</span>&#160;      }</div><div class="line"><a name="l02263"></a><span class="lineno"> 2263</span>&#160;   }</div><div class="line"><a name="l02264"></a><span class="lineno"> 2264</span>&#160;</div><div class="line"><a name="l02265"></a><span class="lineno"> 2265</span>&#160;   <span class="keywordflow">if</span> ((channel_alive = <a class="code" href="../../d0/d60/res__fax_8c.html#a779e8d2cf3518f35900b9089a2c344ec">generic_fax_exec</a>(chan, details, s, token)) &lt; 0) {</div><div class="line"><a name="l02266"></a><span class="lineno"> 2266</span>&#160;      <a class="code" href="../../dd/d42/lock_8h.html#a8a3bd496edfec04a95683ace66676200">ast_atomic_fetchadd_int</a>(&amp;<a class="code" href="../../d0/d60/res__fax_8c.html#a058b6772fcfe1ce5a1a0957e2f11d367">faxregistry</a>.fax_failures, 1);</div><div class="line"><a name="l02267"></a><span class="lineno"> 2267</span>&#160;   }</div><div class="line"><a name="l02268"></a><span class="lineno"> 2268</span>&#160;</div><div class="line"><a name="l02269"></a><span class="lineno"> 2269</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d5/d7b/channel_8h.html#a1b22ea5302ef183fa68bc45bfb0659c9">ast_channel_get_t38_state</a>(chan) == <a class="code" href="../../d5/d7b/channel_8h.html#a4cd990f4c1cd0c2af6e4c63f6d15b4e1af142c79721a025bd65edad812f0725e0">T38_STATE_NEGOTIATED</a>) {</div><div class="line"><a name="l02270"></a><span class="lineno"> 2270</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="../../d0/d60/res__fax_8c.html#ae3ee13924d0059d65a340212b5117a48">disable_t38</a>(chan)) {</div><div class="line"><a name="l02271"></a><span class="lineno"> 2271</span>&#160;         <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(1, <span class="stringliteral">&quot;error disabling T.38 mode on %s\n&quot;</span>, <a class="code" href="../../d5/d7b/channel_8h.html#a7ca2fda13b129a55c251b56729de285b">ast_channel_name</a>(chan));</div><div class="line"><a name="l02272"></a><span class="lineno"> 2272</span>&#160;      }</div><div class="line"><a name="l02273"></a><span class="lineno"> 2273</span>&#160;   }</div><div class="line"><a name="l02274"></a><span class="lineno"> 2274</span>&#160;</div><div class="line"><a name="l02275"></a><span class="lineno"> 2275</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d0/d60/res__fax_8c.html#af822150a9af5748af190c5f66979aae0">report_receive_fax_status</a>(chan, <a class="code" href="../../d5/dde/test__func__file_8c.html#a7df83d295429a2562396f1ec127a46c0">args</a>.filename)) {</div><div class="line"><a name="l02276"></a><span class="lineno"> 2276</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#a2fdd5bff193a29ec6c7278da2851ea56">AST_LOG_ERROR</a>, <span class="stringliteral">&quot;Error publishing ReceiveFax status message\n&quot;</span>);</div><div class="line"><a name="l02277"></a><span class="lineno"> 2277</span>&#160;   }</div><div class="line"><a name="l02278"></a><span class="lineno"> 2278</span>&#160;</div><div class="line"><a name="l02279"></a><span class="lineno"> 2279</span>&#160;   <span class="comment">/* If the channel hungup return -1; otherwise, return 0 to continue in the dialplan */</span></div><div class="line"><a name="l02280"></a><span class="lineno"> 2280</span>&#160;   <span class="keywordflow">return</span> (!channel_alive) ? -1 : 0;</div><div class="line"><a name="l02281"></a><span class="lineno"> 2281</span>&#160;}</div><div class="line"><a name="l02282"></a><span class="lineno"> 2282</span>&#160;</div><div class="line"><a name="l02283"></a><span class="lineno"><a class="line" href="../../d0/d60/res__fax_8c.html#ac4e0560b06c338fc643710d3dc6bc6f7"> 2283</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d0/d60/res__fax_8c.html#ac4e0560b06c338fc643710d3dc6bc6f7">sendfax_t38_init</a>(<span class="keyword">struct</span> <a class="code" href="../../df/d3c/structast__channel.html">ast_channel</a> *chan, <span class="keyword">struct</span> <a class="code" href="../../d8/dc2/structast__fax__session__details.html">ast_fax_session_details</a> *details)</div><div class="line"><a name="l02284"></a><span class="lineno"> 2284</span>&#160;{</div><div class="line"><a name="l02285"></a><span class="lineno"> 2285</span>&#160;   <span class="keywordtype">int</span> timeout_ms;</div><div class="line"><a name="l02286"></a><span class="lineno"> 2286</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d0/d99/structast__frame.html">ast_frame</a> *frame = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l02287"></a><span class="lineno"> 2287</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d5/def/structast__control__t38__parameters.html">ast_control_t38_parameters</a> t38_parameters;</div><div class="line"><a name="l02288"></a><span class="lineno"> 2288</span>&#160;   <span class="keyword">struct </span>timeval start;</div><div class="line"><a name="l02289"></a><span class="lineno"> 2289</span>&#160;   <span class="keywordtype">int</span> ms;</div><div class="line"><a name="l02290"></a><span class="lineno"> 2290</span>&#160;</div><div class="line"><a name="l02291"></a><span class="lineno"> 2291</span>&#160;   <span class="comment">/* send CNG tone while listening for the receiver to initiate a switch</span></div><div class="line"><a name="l02292"></a><span class="lineno"> 2292</span>&#160;<span class="comment">    * to T.38 mode; if they do, stop sending the CNG tone and proceed with</span></div><div class="line"><a name="l02293"></a><span class="lineno"> 2293</span>&#160;<span class="comment">    * the switch.</span></div><div class="line"><a name="l02294"></a><span class="lineno"> 2294</span>&#160;<span class="comment">    *</span></div><div class="line"><a name="l02295"></a><span class="lineno"> 2295</span>&#160;<span class="comment">    * 10500 is enough time for 3 CNG tones</span></div><div class="line"><a name="l02296"></a><span class="lineno"> 2296</span>&#160;<span class="comment">    */</span></div><div class="line"><a name="l02297"></a><span class="lineno"> 2297</span>&#160;   timeout_ms = 10500;</div><div class="line"><a name="l02298"></a><span class="lineno"> 2298</span>&#160;</div><div class="line"><a name="l02299"></a><span class="lineno"> 2299</span>&#160;   <span class="comment">/* don&#39;t send any audio if we&#39;ve already received a T.38 reinvite */</span></div><div class="line"><a name="l02300"></a><span class="lineno"> 2300</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d5/d7b/channel_8h.html#a1b22ea5302ef183fa68bc45bfb0659c9">ast_channel_get_t38_state</a>(chan) != <a class="code" href="../../d5/d7b/channel_8h.html#a4cd990f4c1cd0c2af6e4c63f6d15b4e1afa1eab36050476591f803c3e234c2ed1">T38_STATE_NEGOTIATING</a>) {</div><div class="line"><a name="l02301"></a><span class="lineno"> 2301</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="../../d2/d0f/indications_8h.html#a544e8a1dd4a986b00754103dda6a7d3b">ast_playtones_start</a>(chan, 1024, <span class="stringliteral">&quot;!1100/500,!0/3000,!1100/500,!0/3000,!1100/500,!0/3000&quot;</span>, 1)) {</div><div class="line"><a name="l02302"></a><span class="lineno"> 2302</span>&#160;         <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;error generating CNG tone on %s\n&quot;</span>, <a class="code" href="../../d5/d7b/channel_8h.html#a7ca2fda13b129a55c251b56729de285b">ast_channel_name</a>(chan));</div><div class="line"><a name="l02303"></a><span class="lineno"> 2303</span>&#160;         <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l02304"></a><span class="lineno"> 2304</span>&#160;      }</div><div class="line"><a name="l02305"></a><span class="lineno"> 2305</span>&#160;   }</div><div class="line"><a name="l02306"></a><span class="lineno"> 2306</span>&#160;</div><div class="line"><a name="l02307"></a><span class="lineno"> 2307</span>&#160;   start = <a class="code" href="../../de/df7/time_8h.html#ad3899efb6f0e348556ef69f5b16aa7f7">ast_tvnow</a>();</div><div class="line"><a name="l02308"></a><span class="lineno"> 2308</span>&#160;   <span class="keywordflow">while</span> ((ms = <a class="code" href="../../de/df7/time_8h.html#a904a6933b710e14c7fa2029a0f0cc91a">ast_remaining_ms</a>(start, timeout_ms))) {</div><div class="line"><a name="l02309"></a><span class="lineno"> 2309</span>&#160;      <span class="keywordtype">int</span> break_loop = 0;</div><div class="line"><a name="l02310"></a><span class="lineno"> 2310</span>&#160;      ms = <a class="code" href="../../d5/d7b/channel_8h.html#a60e0bcaed001e8d5ed1ba0eb2644b3cc">ast_waitfor</a>(chan, ms);</div><div class="line"><a name="l02311"></a><span class="lineno"> 2311</span>&#160;</div><div class="line"><a name="l02312"></a><span class="lineno"> 2312</span>&#160;      <span class="keywordflow">if</span> (ms &lt; 0) {</div><div class="line"><a name="l02313"></a><span class="lineno"> 2313</span>&#160;         <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;error while generating CNG tone on %s\n&quot;</span>, <a class="code" href="../../d5/d7b/channel_8h.html#a7ca2fda13b129a55c251b56729de285b">ast_channel_name</a>(chan));</div><div class="line"><a name="l02314"></a><span class="lineno"> 2314</span>&#160;         <a class="code" href="../../d2/d0f/indications_8h.html#a9d5be069b7060d326a213f5d60b8dc77">ast_playtones_stop</a>(chan);</div><div class="line"><a name="l02315"></a><span class="lineno"> 2315</span>&#160;         <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l02316"></a><span class="lineno"> 2316</span>&#160;      }</div><div class="line"><a name="l02317"></a><span class="lineno"> 2317</span>&#160;</div><div class="line"><a name="l02318"></a><span class="lineno"> 2318</span>&#160;      <span class="keywordflow">if</span> (ms == 0) { <span class="comment">/* all done, nothing happened */</span></div><div class="line"><a name="l02319"></a><span class="lineno"> 2319</span>&#160;         <span class="keywordflow">break</span>;</div><div class="line"><a name="l02320"></a><span class="lineno"> 2320</span>&#160;      }</div><div class="line"><a name="l02321"></a><span class="lineno"> 2321</span>&#160;</div><div class="line"><a name="l02322"></a><span class="lineno"> 2322</span>&#160;      <span class="keywordflow">if</span> (!(frame = <a class="code" href="../../d5/d7b/channel_8h.html#a7ef6737309dc9e8b6c4a7cb4800638b1">ast_read</a>(chan))) {</div><div class="line"><a name="l02323"></a><span class="lineno"> 2323</span>&#160;         <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;error reading frame while generating CNG tone on %s\n&quot;</span>, <a class="code" href="../../d5/d7b/channel_8h.html#a7ca2fda13b129a55c251b56729de285b">ast_channel_name</a>(chan));</div><div class="line"><a name="l02324"></a><span class="lineno"> 2324</span>&#160;         <a class="code" href="../../d2/d0f/indications_8h.html#a9d5be069b7060d326a213f5d60b8dc77">ast_playtones_stop</a>(chan);</div><div class="line"><a name="l02325"></a><span class="lineno"> 2325</span>&#160;         <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l02326"></a><span class="lineno"> 2326</span>&#160;      }</div><div class="line"><a name="l02327"></a><span class="lineno"> 2327</span>&#160;</div><div class="line"><a name="l02328"></a><span class="lineno"> 2328</span>&#160;      <span class="keywordflow">if</span> ((frame-&gt;<a class="code" href="../../d0/d99/structast__frame.html#a6937b93c56cb473b547eda454dca7b4c">frametype</a> == <a class="code" href="../../d6/d66/include_2asterisk_2frame_8h.html#ae2e1a9c4e048da387b761f619312d6e0ae1dae388b0d70825876e137ae95bb0c1">AST_FRAME_CONTROL</a>) &amp;&amp;</div><div class="line"><a name="l02329"></a><span class="lineno"> 2329</span>&#160;            (frame-&gt;<a class="code" href="../../d0/d99/structast__frame.html#a27237c48fdcd22556401f20c693811db">subclass</a>.<a class="code" href="../../d1/d9f/structast__frame__subclass.html#adece183191b0e700e039e59101e06105">integer</a> == <a class="code" href="../../d6/d66/include_2asterisk_2frame_8h.html#aedda41918e992000fe921f8f7363b390a7334c9d27a6d70fe7c85b60b864788fc">AST_CONTROL_T38_PARAMETERS</a>) &amp;&amp;</div><div class="line"><a name="l02330"></a><span class="lineno"> 2330</span>&#160;            (frame-&gt;<a class="code" href="../../d0/d99/structast__frame.html#ad67e07841d1233e596e6f822a3c81f6b">datalen</a> == <span class="keyword">sizeof</span>(t38_parameters))) {</div><div class="line"><a name="l02331"></a><span class="lineno"> 2331</span>&#160;         <span class="keyword">struct </span><a class="code" href="../../d5/def/structast__control__t38__parameters.html">ast_control_t38_parameters</a> *parameters = frame-&gt;<a class="code" href="../../d0/d99/structast__frame.html#a4027905f872af30d910929b07e261ca5">data</a>.<a class="code" href="../../d0/d99/structast__frame.html#add9af9569af79ec26dd741fb226b38ba">ptr</a>;</div><div class="line"><a name="l02332"></a><span class="lineno"> 2332</span>&#160;</div><div class="line"><a name="l02333"></a><span class="lineno"> 2333</span>&#160;         <span class="keywordflow">switch</span> (parameters-&gt;<a class="code" href="../../d5/def/structast__control__t38__parameters.html#adb36822366e10ce64ca8337c512732a6">request_response</a>) {</div><div class="line"><a name="l02334"></a><span class="lineno"> 2334</span>&#160;         <span class="keywordflow">case</span> <a class="code" href="../../d6/d66/include_2asterisk_2frame_8h.html#a168d496bdac09ece3ce49cf473bbdb4bafdb1ca68d683c64301c4cf07463a9975">AST_T38_REQUEST_NEGOTIATE</a>:</div><div class="line"><a name="l02335"></a><span class="lineno"> 2335</span>&#160;            <span class="comment">/* the other end has requested a switch to T.38, so reply that we are willing, if we can</span></div><div class="line"><a name="l02336"></a><span class="lineno"> 2336</span>&#160;<span class="comment">             * do T.38 as well</span></div><div class="line"><a name="l02337"></a><span class="lineno"> 2337</span>&#160;<span class="comment">             */</span></div><div class="line"><a name="l02338"></a><span class="lineno"> 2338</span>&#160;            <a class="code" href="../../d0/d60/res__fax_8c.html#a624525cc48cff52d5ae4e5e50895e81e">t38_parameters_fax_to_ast</a>(&amp;t38_parameters, &amp;details-&gt;<a class="code" href="../../d8/dc2/structast__fax__session__details.html#a80632865b575d06f319ef95c42645b2c">our_t38_parameters</a>);</div><div class="line"><a name="l02339"></a><span class="lineno"> 2339</span>&#160;            t38_parameters.<a class="code" href="../../d5/def/structast__control__t38__parameters.html#adb36822366e10ce64ca8337c512732a6">request_response</a> = (details-&gt;<a class="code" href="../../d8/dc2/structast__fax__session__details.html#ad75375cdd336e91cbcee4a829fcdabfe">caps</a> &amp; <a class="code" href="../../db/d6a/res__fax_8h.html#a54eb45ad548b874cf12d0a599631e3f6a6868445e2802e5b71068ae883366f635">AST_FAX_TECH_T38</a>) ? <a class="code" href="../../d6/d66/include_2asterisk_2frame_8h.html#a168d496bdac09ece3ce49cf473bbdb4bad501e0d5fe272eaba466507a686a2df5">AST_T38_NEGOTIATED</a> : <a class="code" href="../../d6/d66/include_2asterisk_2frame_8h.html#a168d496bdac09ece3ce49cf473bbdb4baa02b30f25621f20396d06f5ac8aa7a2e">AST_T38_REFUSED</a>;</div><div class="line"><a name="l02340"></a><span class="lineno"> 2340</span>&#160;            <a class="code" href="../../d5/d7b/channel_8h.html#aa8c3522af1bc639cbd5b38f5fdf171fa">ast_indicate_data</a>(chan, <a class="code" href="../../d6/d66/include_2asterisk_2frame_8h.html#aedda41918e992000fe921f8f7363b390a7334c9d27a6d70fe7c85b60b864788fc">AST_CONTROL_T38_PARAMETERS</a>, &amp;t38_parameters, <span class="keyword">sizeof</span>(t38_parameters));</div><div class="line"><a name="l02341"></a><span class="lineno"> 2341</span>&#160;            <a class="code" href="../../d2/d0f/indications_8h.html#a9d5be069b7060d326a213f5d60b8dc77">ast_playtones_stop</a>(chan);</div><div class="line"><a name="l02342"></a><span class="lineno"> 2342</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l02343"></a><span class="lineno"> 2343</span>&#160;         <span class="keywordflow">case</span> <a class="code" href="../../d6/d66/include_2asterisk_2frame_8h.html#a168d496bdac09ece3ce49cf473bbdb4bad501e0d5fe272eaba466507a686a2df5">AST_T38_NEGOTIATED</a>:</div><div class="line"><a name="l02344"></a><span class="lineno"> 2344</span>&#160;            <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(1, <span class="stringliteral">&quot;Negotiated T.38 for send on %s\n&quot;</span>, <a class="code" href="../../d5/d7b/channel_8h.html#a7ca2fda13b129a55c251b56729de285b">ast_channel_name</a>(chan));</div><div class="line"><a name="l02345"></a><span class="lineno"> 2345</span>&#160;            <a class="code" href="../../d0/d60/res__fax_8c.html#aa9ea5a83822d7365075730ddb8490d23">t38_parameters_ast_to_fax</a>(&amp;details-&gt;<a class="code" href="../../d8/dc2/structast__fax__session__details.html#a12cc2bfdcc88e94984d001cca6fefdc5">their_t38_parameters</a>, parameters);</div><div class="line"><a name="l02346"></a><span class="lineno"> 2346</span>&#160;            details-&gt;<a class="code" href="../../d8/dc2/structast__fax__session__details.html#ad75375cdd336e91cbcee4a829fcdabfe">caps</a> &amp;= ~<a class="code" href="../../db/d6a/res__fax_8h.html#a54eb45ad548b874cf12d0a599631e3f6a76fa4111df51955a949e95fadbccd48b">AST_FAX_TECH_AUDIO</a>;</div><div class="line"><a name="l02347"></a><span class="lineno"> 2347</span>&#160;            <a class="code" href="../../d0/d60/res__fax_8c.html#a38d73af44b480b7cad7a654f75926777">report_fax_status</a>(chan, details, <span class="stringliteral">&quot;T.38 Negotiated&quot;</span>);</div><div class="line"><a name="l02348"></a><span class="lineno"> 2348</span>&#160;            break_loop = 1;</div><div class="line"><a name="l02349"></a><span class="lineno"> 2349</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l02350"></a><span class="lineno"> 2350</span>&#160;         <span class="keywordflow">default</span>:</div><div class="line"><a name="l02351"></a><span class="lineno"> 2351</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l02352"></a><span class="lineno"> 2352</span>&#160;         }</div><div class="line"><a name="l02353"></a><span class="lineno"> 2353</span>&#160;      }</div><div class="line"><a name="l02354"></a><span class="lineno"> 2354</span>&#160;      <a class="code" href="../../d6/d66/include_2asterisk_2frame_8h.html#a6440d070425a2efe8e0aa71e8d9e47b7">ast_frfree</a>(frame);</div><div class="line"><a name="l02355"></a><span class="lineno"> 2355</span>&#160;      <span class="keywordflow">if</span> (break_loop) {</div><div class="line"><a name="l02356"></a><span class="lineno"> 2356</span>&#160;         <span class="keywordflow">break</span>;</div><div class="line"><a name="l02357"></a><span class="lineno"> 2357</span>&#160;      }</div><div class="line"><a name="l02358"></a><span class="lineno"> 2358</span>&#160;   }</div><div class="line"><a name="l02359"></a><span class="lineno"> 2359</span>&#160;</div><div class="line"><a name="l02360"></a><span class="lineno"> 2360</span>&#160;   <a class="code" href="../../d2/d0f/indications_8h.html#a9d5be069b7060d326a213f5d60b8dc77">ast_playtones_stop</a>(chan);</div><div class="line"><a name="l02361"></a><span class="lineno"> 2361</span>&#160;</div><div class="line"><a name="l02362"></a><span class="lineno"> 2362</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d5/d7b/channel_8h.html#a1b22ea5302ef183fa68bc45bfb0659c9">ast_channel_get_t38_state</a>(chan) == <a class="code" href="../../d5/d7b/channel_8h.html#a4cd990f4c1cd0c2af6e4c63f6d15b4e1af142c79721a025bd65edad812f0725e0">T38_STATE_NEGOTIATED</a>) {</div><div class="line"><a name="l02363"></a><span class="lineno"> 2363</span>&#160;      <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l02364"></a><span class="lineno"> 2364</span>&#160;   }</div><div class="line"><a name="l02365"></a><span class="lineno"> 2365</span>&#160;</div><div class="line"><a name="l02366"></a><span class="lineno"> 2366</span>&#160;   <span class="comment">/* T.38 negotiation did not happen, initiate a switch if requested */</span></div><div class="line"><a name="l02367"></a><span class="lineno"> 2367</span>&#160;   <span class="keywordflow">if</span> (details-&gt;<a class="code" href="../../d8/dc2/structast__fax__session__details.html#a3ab211dbe8780b7292257f6b3dba1952">option</a>.<a class="code" href="../../d8/dc2/structast__fax__session__details.html#a9f26ae9d27415acd75d11e5cf606dd92">request_t38</a> == <a class="code" href="../../db/d6a/res__fax_8h.html#a1838c71fcf68c3cfe0ce37e35e77406dabd9b4a57405ba5c0c884ac98746a8bd7">AST_FAX_OPTFLAG_TRUE</a>) {</div><div class="line"><a name="l02368"></a><span class="lineno"> 2368</span>&#160;      <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(1, <span class="stringliteral">&quot;Negotiating T.38 for send on %s\n&quot;</span>, <a class="code" href="../../d5/d7b/channel_8h.html#a7ca2fda13b129a55c251b56729de285b">ast_channel_name</a>(chan));</div><div class="line"><a name="l02369"></a><span class="lineno"> 2369</span>&#160;</div><div class="line"><a name="l02370"></a><span class="lineno"> 2370</span>&#160;      <span class="comment">/* wait up to five seconds for negotiation to complete */</span></div><div class="line"><a name="l02371"></a><span class="lineno"> 2371</span>&#160;      timeout_ms = 5000;</div><div class="line"><a name="l02372"></a><span class="lineno"> 2372</span>&#160;</div><div class="line"><a name="l02373"></a><span class="lineno"> 2373</span>&#160;      <span class="comment">/* set parameters based on the session&#39;s parameters */</span></div><div class="line"><a name="l02374"></a><span class="lineno"> 2374</span>&#160;      <a class="code" href="../../d0/d60/res__fax_8c.html#a624525cc48cff52d5ae4e5e50895e81e">t38_parameters_fax_to_ast</a>(&amp;t38_parameters, &amp;details-&gt;<a class="code" href="../../d8/dc2/structast__fax__session__details.html#a80632865b575d06f319ef95c42645b2c">our_t38_parameters</a>);</div><div class="line"><a name="l02375"></a><span class="lineno"> 2375</span>&#160;      t38_parameters.<a class="code" href="../../d5/def/structast__control__t38__parameters.html#adb36822366e10ce64ca8337c512732a6">request_response</a> = <a class="code" href="../../d6/d66/include_2asterisk_2frame_8h.html#a168d496bdac09ece3ce49cf473bbdb4bafdb1ca68d683c64301c4cf07463a9975">AST_T38_REQUEST_NEGOTIATE</a>;</div><div class="line"><a name="l02376"></a><span class="lineno"> 2376</span>&#160;      <span class="keywordflow">if</span> ((<a class="code" href="../../d5/d7b/channel_8h.html#aa8c3522af1bc639cbd5b38f5fdf171fa">ast_indicate_data</a>(chan, <a class="code" href="../../d6/d66/include_2asterisk_2frame_8h.html#aedda41918e992000fe921f8f7363b390a7334c9d27a6d70fe7c85b60b864788fc">AST_CONTROL_T38_PARAMETERS</a>, &amp;t38_parameters, <span class="keyword">sizeof</span>(t38_parameters)) != 0)) {</div><div class="line"><a name="l02377"></a><span class="lineno"> 2377</span>&#160;         <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l02378"></a><span class="lineno"> 2378</span>&#160;      }</div><div class="line"><a name="l02379"></a><span class="lineno"> 2379</span>&#160;</div><div class="line"><a name="l02380"></a><span class="lineno"> 2380</span>&#160;      start = <a class="code" href="../../de/df7/time_8h.html#ad3899efb6f0e348556ef69f5b16aa7f7">ast_tvnow</a>();</div><div class="line"><a name="l02381"></a><span class="lineno"> 2381</span>&#160;      <span class="keywordflow">while</span> ((ms = <a class="code" href="../../de/df7/time_8h.html#a904a6933b710e14c7fa2029a0f0cc91a">ast_remaining_ms</a>(start, timeout_ms))) {</div><div class="line"><a name="l02382"></a><span class="lineno"> 2382</span>&#160;         <span class="keywordtype">int</span> break_loop = 0;</div><div class="line"><a name="l02383"></a><span class="lineno"> 2383</span>&#160;</div><div class="line"><a name="l02384"></a><span class="lineno"> 2384</span>&#160;         ms = <a class="code" href="../../d5/d7b/channel_8h.html#a60e0bcaed001e8d5ed1ba0eb2644b3cc">ast_waitfor</a>(chan, ms);</div><div class="line"><a name="l02385"></a><span class="lineno"> 2385</span>&#160;         <span class="keywordflow">if</span> (ms &lt; 0) {</div><div class="line"><a name="l02386"></a><span class="lineno"> 2386</span>&#160;            <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;error on &#39;%s&#39; while waiting for T.38 negotiation.\n&quot;</span>, <a class="code" href="../../d5/d7b/channel_8h.html#a7ca2fda13b129a55c251b56729de285b">ast_channel_name</a>(chan));</div><div class="line"><a name="l02387"></a><span class="lineno"> 2387</span>&#160;            <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l02388"></a><span class="lineno"> 2388</span>&#160;         }</div><div class="line"><a name="l02389"></a><span class="lineno"> 2389</span>&#160;         <span class="keywordflow">if</span> (ms == 0) { <span class="comment">/* all done, nothing happened */</span></div><div class="line"><a name="l02390"></a><span class="lineno"> 2390</span>&#160;            <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;channel &#39;%s&#39; timed-out during the T.38 negotiation.\n&quot;</span>, <a class="code" href="../../d5/d7b/channel_8h.html#a7ca2fda13b129a55c251b56729de285b">ast_channel_name</a>(chan));</div><div class="line"><a name="l02391"></a><span class="lineno"> 2391</span>&#160;            details-&gt;<a class="code" href="../../d8/dc2/structast__fax__session__details.html#ad75375cdd336e91cbcee4a829fcdabfe">caps</a> &amp;= ~<a class="code" href="../../db/d6a/res__fax_8h.html#a54eb45ad548b874cf12d0a599631e3f6a6868445e2802e5b71068ae883366f635">AST_FAX_TECH_T38</a>;</div><div class="line"><a name="l02392"></a><span class="lineno"> 2392</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l02393"></a><span class="lineno"> 2393</span>&#160;         }</div><div class="line"><a name="l02394"></a><span class="lineno"> 2394</span>&#160;</div><div class="line"><a name="l02395"></a><span class="lineno"> 2395</span>&#160;         <span class="keywordflow">if</span> (!(frame = <a class="code" href="../../d5/d7b/channel_8h.html#a7ef6737309dc9e8b6c4a7cb4800638b1">ast_read</a>(chan))) {</div><div class="line"><a name="l02396"></a><span class="lineno"> 2396</span>&#160;            <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;error on &#39;%s&#39; while waiting for T.38 negotiation.\n&quot;</span>, <a class="code" href="../../d5/d7b/channel_8h.html#a7ca2fda13b129a55c251b56729de285b">ast_channel_name</a>(chan));</div><div class="line"><a name="l02397"></a><span class="lineno"> 2397</span>&#160;            <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l02398"></a><span class="lineno"> 2398</span>&#160;         }</div><div class="line"><a name="l02399"></a><span class="lineno"> 2399</span>&#160;</div><div class="line"><a name="l02400"></a><span class="lineno"> 2400</span>&#160;         <span class="keywordflow">if</span> ((frame-&gt;<a class="code" href="../../d0/d99/structast__frame.html#a6937b93c56cb473b547eda454dca7b4c">frametype</a> == <a class="code" href="../../d6/d66/include_2asterisk_2frame_8h.html#ae2e1a9c4e048da387b761f619312d6e0ae1dae388b0d70825876e137ae95bb0c1">AST_FRAME_CONTROL</a>) &amp;&amp;</div><div class="line"><a name="l02401"></a><span class="lineno"> 2401</span>&#160;               (frame-&gt;<a class="code" href="../../d0/d99/structast__frame.html#a27237c48fdcd22556401f20c693811db">subclass</a>.<a class="code" href="../../d1/d9f/structast__frame__subclass.html#adece183191b0e700e039e59101e06105">integer</a> == <a class="code" href="../../d6/d66/include_2asterisk_2frame_8h.html#aedda41918e992000fe921f8f7363b390a7334c9d27a6d70fe7c85b60b864788fc">AST_CONTROL_T38_PARAMETERS</a>) &amp;&amp;</div><div class="line"><a name="l02402"></a><span class="lineno"> 2402</span>&#160;               (frame-&gt;<a class="code" href="../../d0/d99/structast__frame.html#ad67e07841d1233e596e6f822a3c81f6b">datalen</a> == <span class="keyword">sizeof</span>(t38_parameters))) {</div><div class="line"><a name="l02403"></a><span class="lineno"> 2403</span>&#160;            <span class="keyword">struct </span><a class="code" href="../../d5/def/structast__control__t38__parameters.html">ast_control_t38_parameters</a> *parameters = frame-&gt;<a class="code" href="../../d0/d99/structast__frame.html#a4027905f872af30d910929b07e261ca5">data</a>.<a class="code" href="../../d0/d99/structast__frame.html#add9af9569af79ec26dd741fb226b38ba">ptr</a>;</div><div class="line"><a name="l02404"></a><span class="lineno"> 2404</span>&#160;</div><div class="line"><a name="l02405"></a><span class="lineno"> 2405</span>&#160;            <span class="keywordflow">switch</span> (parameters-&gt;<a class="code" href="../../d5/def/structast__control__t38__parameters.html#adb36822366e10ce64ca8337c512732a6">request_response</a>) {</div><div class="line"><a name="l02406"></a><span class="lineno"> 2406</span>&#160;            <span class="keywordflow">case</span> <a class="code" href="../../d6/d66/include_2asterisk_2frame_8h.html#a168d496bdac09ece3ce49cf473bbdb4bafdb1ca68d683c64301c4cf07463a9975">AST_T38_REQUEST_NEGOTIATE</a>:</div><div class="line"><a name="l02407"></a><span class="lineno"> 2407</span>&#160;               <a class="code" href="../../d0/d60/res__fax_8c.html#a624525cc48cff52d5ae4e5e50895e81e">t38_parameters_fax_to_ast</a>(&amp;t38_parameters, &amp;details-&gt;<a class="code" href="../../d8/dc2/structast__fax__session__details.html#a80632865b575d06f319ef95c42645b2c">our_t38_parameters</a>);</div><div class="line"><a name="l02408"></a><span class="lineno"> 2408</span>&#160;               t38_parameters.<a class="code" href="../../d5/def/structast__control__t38__parameters.html#adb36822366e10ce64ca8337c512732a6">request_response</a> = <a class="code" href="../../d6/d66/include_2asterisk_2frame_8h.html#a168d496bdac09ece3ce49cf473bbdb4bad501e0d5fe272eaba466507a686a2df5">AST_T38_NEGOTIATED</a>;</div><div class="line"><a name="l02409"></a><span class="lineno"> 2409</span>&#160;               <a class="code" href="../../d5/d7b/channel_8h.html#aa8c3522af1bc639cbd5b38f5fdf171fa">ast_indicate_data</a>(chan, <a class="code" href="../../d6/d66/include_2asterisk_2frame_8h.html#aedda41918e992000fe921f8f7363b390a7334c9d27a6d70fe7c85b60b864788fc">AST_CONTROL_T38_PARAMETERS</a>, &amp;t38_parameters, <span class="keyword">sizeof</span>(t38_parameters));</div><div class="line"><a name="l02410"></a><span class="lineno"> 2410</span>&#160;               <span class="keywordflow">break</span>;</div><div class="line"><a name="l02411"></a><span class="lineno"> 2411</span>&#160;            <span class="keywordflow">case</span> <a class="code" href="../../d6/d66/include_2asterisk_2frame_8h.html#a168d496bdac09ece3ce49cf473bbdb4bad501e0d5fe272eaba466507a686a2df5">AST_T38_NEGOTIATED</a>:</div><div class="line"><a name="l02412"></a><span class="lineno"> 2412</span>&#160;               <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(1, <span class="stringliteral">&quot;Negotiated T.38 for receive on %s\n&quot;</span>, <a class="code" href="../../d5/d7b/channel_8h.html#a7ca2fda13b129a55c251b56729de285b">ast_channel_name</a>(chan));</div><div class="line"><a name="l02413"></a><span class="lineno"> 2413</span>&#160;               <a class="code" href="../../d0/d60/res__fax_8c.html#aa9ea5a83822d7365075730ddb8490d23">t38_parameters_ast_to_fax</a>(&amp;details-&gt;<a class="code" href="../../d8/dc2/structast__fax__session__details.html#a12cc2bfdcc88e94984d001cca6fefdc5">their_t38_parameters</a>, parameters);</div><div class="line"><a name="l02414"></a><span class="lineno"> 2414</span>&#160;               details-&gt;<a class="code" href="../../d8/dc2/structast__fax__session__details.html#ad75375cdd336e91cbcee4a829fcdabfe">caps</a> &amp;= ~<a class="code" href="../../db/d6a/res__fax_8h.html#a54eb45ad548b874cf12d0a599631e3f6a76fa4111df51955a949e95fadbccd48b">AST_FAX_TECH_AUDIO</a>;</div><div class="line"><a name="l02415"></a><span class="lineno"> 2415</span>&#160;               <a class="code" href="../../d0/d60/res__fax_8c.html#a38d73af44b480b7cad7a654f75926777">report_fax_status</a>(chan, details, <span class="stringliteral">&quot;T.38 Negotiated&quot;</span>);</div><div class="line"><a name="l02416"></a><span class="lineno"> 2416</span>&#160;               break_loop = 1;</div><div class="line"><a name="l02417"></a><span class="lineno"> 2417</span>&#160;               <span class="keywordflow">break</span>;</div><div class="line"><a name="l02418"></a><span class="lineno"> 2418</span>&#160;            <span class="keywordflow">case</span> <a class="code" href="../../d6/d66/include_2asterisk_2frame_8h.html#a168d496bdac09ece3ce49cf473bbdb4baa02b30f25621f20396d06f5ac8aa7a2e">AST_T38_REFUSED</a>:</div><div class="line"><a name="l02419"></a><span class="lineno"> 2419</span>&#160;               <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;channel &#39;%s&#39; refused to negotiate T.38\n&quot;</span>, <a class="code" href="../../d5/d7b/channel_8h.html#a7ca2fda13b129a55c251b56729de285b">ast_channel_name</a>(chan));</div><div class="line"><a name="l02420"></a><span class="lineno"> 2420</span>&#160;               details-&gt;<a class="code" href="../../d8/dc2/structast__fax__session__details.html#ad75375cdd336e91cbcee4a829fcdabfe">caps</a> &amp;= ~<a class="code" href="../../db/d6a/res__fax_8h.html#a54eb45ad548b874cf12d0a599631e3f6a6868445e2802e5b71068ae883366f635">AST_FAX_TECH_T38</a>;</div><div class="line"><a name="l02421"></a><span class="lineno"> 2421</span>&#160;               break_loop = 1;</div><div class="line"><a name="l02422"></a><span class="lineno"> 2422</span>&#160;               <span class="keywordflow">break</span>;</div><div class="line"><a name="l02423"></a><span class="lineno"> 2423</span>&#160;            <span class="keywordflow">default</span>:</div><div class="line"><a name="l02424"></a><span class="lineno"> 2424</span>&#160;               <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;channel &#39;%s&#39; failed to negotiate T.38\n&quot;</span>, <a class="code" href="../../d5/d7b/channel_8h.html#a7ca2fda13b129a55c251b56729de285b">ast_channel_name</a>(chan));</div><div class="line"><a name="l02425"></a><span class="lineno"> 2425</span>&#160;               details-&gt;<a class="code" href="../../d8/dc2/structast__fax__session__details.html#ad75375cdd336e91cbcee4a829fcdabfe">caps</a> &amp;= ~<a class="code" href="../../db/d6a/res__fax_8h.html#a54eb45ad548b874cf12d0a599631e3f6a6868445e2802e5b71068ae883366f635">AST_FAX_TECH_T38</a>;</div><div class="line"><a name="l02426"></a><span class="lineno"> 2426</span>&#160;               break_loop = 1;</div><div class="line"><a name="l02427"></a><span class="lineno"> 2427</span>&#160;               <span class="keywordflow">break</span>;</div><div class="line"><a name="l02428"></a><span class="lineno"> 2428</span>&#160;            }</div><div class="line"><a name="l02429"></a><span class="lineno"> 2429</span>&#160;         }</div><div class="line"><a name="l02430"></a><span class="lineno"> 2430</span>&#160;         <a class="code" href="../../d6/d66/include_2asterisk_2frame_8h.html#a6440d070425a2efe8e0aa71e8d9e47b7">ast_frfree</a>(frame);</div><div class="line"><a name="l02431"></a><span class="lineno"> 2431</span>&#160;         <span class="keywordflow">if</span> (break_loop) {</div><div class="line"><a name="l02432"></a><span class="lineno"> 2432</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l02433"></a><span class="lineno"> 2433</span>&#160;         }</div><div class="line"><a name="l02434"></a><span class="lineno"> 2434</span>&#160;      }</div><div class="line"><a name="l02435"></a><span class="lineno"> 2435</span>&#160;</div><div class="line"><a name="l02436"></a><span class="lineno"> 2436</span>&#160;      <span class="comment">/* if T.38 was negotiated, we are done initializing */</span></div><div class="line"><a name="l02437"></a><span class="lineno"> 2437</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="../../d5/d7b/channel_8h.html#a1b22ea5302ef183fa68bc45bfb0659c9">ast_channel_get_t38_state</a>(chan) == <a class="code" href="../../d5/d7b/channel_8h.html#a4cd990f4c1cd0c2af6e4c63f6d15b4e1af142c79721a025bd65edad812f0725e0">T38_STATE_NEGOTIATED</a>) {</div><div class="line"><a name="l02438"></a><span class="lineno"> 2438</span>&#160;         <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l02439"></a><span class="lineno"> 2439</span>&#160;      }</div><div class="line"><a name="l02440"></a><span class="lineno"> 2440</span>&#160;</div><div class="line"><a name="l02441"></a><span class="lineno"> 2441</span>&#160;      <span class="comment">/* send one more CNG tone to get audio going again for some</span></div><div class="line"><a name="l02442"></a><span class="lineno"> 2442</span>&#160;<span class="comment">       * carriers if we are going to fall back to audio mode */</span></div><div class="line"><a name="l02443"></a><span class="lineno"> 2443</span>&#160;      <span class="keywordflow">if</span> (details-&gt;<a class="code" href="../../d8/dc2/structast__fax__session__details.html#a3ab211dbe8780b7292257f6b3dba1952">option</a>.<a class="code" href="../../d8/dc2/structast__fax__session__details.html#a2bdd8d6f48911b41e094440799e00bd2">allow_audio</a> == <a class="code" href="../../db/d6a/res__fax_8h.html#a1838c71fcf68c3cfe0ce37e35e77406dabd9b4a57405ba5c0c884ac98746a8bd7">AST_FAX_OPTFLAG_TRUE</a>) {</div><div class="line"><a name="l02444"></a><span class="lineno"> 2444</span>&#160;         <span class="keywordflow">if</span> (<a class="code" href="../../d2/d0f/indications_8h.html#a544e8a1dd4a986b00754103dda6a7d3b">ast_playtones_start</a>(chan, 1024, <span class="stringliteral">&quot;!1100/500,!0/3000&quot;</span>, 1)) {</div><div class="line"><a name="l02445"></a><span class="lineno"> 2445</span>&#160;            <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;error generating second CNG tone on %s\n&quot;</span>, <a class="code" href="../../d5/d7b/channel_8h.html#a7ca2fda13b129a55c251b56729de285b">ast_channel_name</a>(chan));</div><div class="line"><a name="l02446"></a><span class="lineno"> 2446</span>&#160;            <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l02447"></a><span class="lineno"> 2447</span>&#160;         }</div><div class="line"><a name="l02448"></a><span class="lineno"> 2448</span>&#160;</div><div class="line"><a name="l02449"></a><span class="lineno"> 2449</span>&#160;         timeout_ms = 3500;</div><div class="line"><a name="l02450"></a><span class="lineno"> 2450</span>&#160;         start = <a class="code" href="../../de/df7/time_8h.html#ad3899efb6f0e348556ef69f5b16aa7f7">ast_tvnow</a>();</div><div class="line"><a name="l02451"></a><span class="lineno"> 2451</span>&#160;         <span class="keywordflow">while</span> ((ms = <a class="code" href="../../de/df7/time_8h.html#a904a6933b710e14c7fa2029a0f0cc91a">ast_remaining_ms</a>(start, timeout_ms))) {</div><div class="line"><a name="l02452"></a><span class="lineno"> 2452</span>&#160;            <span class="keywordtype">int</span> break_loop = 0;</div><div class="line"><a name="l02453"></a><span class="lineno"> 2453</span>&#160;</div><div class="line"><a name="l02454"></a><span class="lineno"> 2454</span>&#160;            ms = <a class="code" href="../../d5/d7b/channel_8h.html#a60e0bcaed001e8d5ed1ba0eb2644b3cc">ast_waitfor</a>(chan, ms);</div><div class="line"><a name="l02455"></a><span class="lineno"> 2455</span>&#160;            <span class="keywordflow">if</span> (ms &lt; 0) {</div><div class="line"><a name="l02456"></a><span class="lineno"> 2456</span>&#160;               <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;error while generating second CNG tone on %s\n&quot;</span>, <a class="code" href="../../d5/d7b/channel_8h.html#a7ca2fda13b129a55c251b56729de285b">ast_channel_name</a>(chan));</div><div class="line"><a name="l02457"></a><span class="lineno"> 2457</span>&#160;               <a class="code" href="../../d2/d0f/indications_8h.html#a9d5be069b7060d326a213f5d60b8dc77">ast_playtones_stop</a>(chan);</div><div class="line"><a name="l02458"></a><span class="lineno"> 2458</span>&#160;               <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l02459"></a><span class="lineno"> 2459</span>&#160;            }</div><div class="line"><a name="l02460"></a><span class="lineno"> 2460</span>&#160;            <span class="keywordflow">if</span> (ms == 0) { <span class="comment">/* all done, nothing happened */</span></div><div class="line"><a name="l02461"></a><span class="lineno"> 2461</span>&#160;               <span class="keywordflow">break</span>;</div><div class="line"><a name="l02462"></a><span class="lineno"> 2462</span>&#160;            }</div><div class="line"><a name="l02463"></a><span class="lineno"> 2463</span>&#160;</div><div class="line"><a name="l02464"></a><span class="lineno"> 2464</span>&#160;            <span class="keywordflow">if</span> (!(frame = <a class="code" href="../../d5/d7b/channel_8h.html#a7ef6737309dc9e8b6c4a7cb4800638b1">ast_read</a>(chan))) {</div><div class="line"><a name="l02465"></a><span class="lineno"> 2465</span>&#160;               <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;error reading frame while generating second CNG tone on %s\n&quot;</span>, <a class="code" href="../../d5/d7b/channel_8h.html#a7ca2fda13b129a55c251b56729de285b">ast_channel_name</a>(chan));</div><div class="line"><a name="l02466"></a><span class="lineno"> 2466</span>&#160;               <a class="code" href="../../d2/d0f/indications_8h.html#a9d5be069b7060d326a213f5d60b8dc77">ast_playtones_stop</a>(chan);</div><div class="line"><a name="l02467"></a><span class="lineno"> 2467</span>&#160;               <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l02468"></a><span class="lineno"> 2468</span>&#160;            }</div><div class="line"><a name="l02469"></a><span class="lineno"> 2469</span>&#160;</div><div class="line"><a name="l02470"></a><span class="lineno"> 2470</span>&#160;            <span class="keywordflow">if</span> ((frame-&gt;<a class="code" href="../../d0/d99/structast__frame.html#a6937b93c56cb473b547eda454dca7b4c">frametype</a> == <a class="code" href="../../d6/d66/include_2asterisk_2frame_8h.html#ae2e1a9c4e048da387b761f619312d6e0ae1dae388b0d70825876e137ae95bb0c1">AST_FRAME_CONTROL</a>) &amp;&amp;</div><div class="line"><a name="l02471"></a><span class="lineno"> 2471</span>&#160;                  (frame-&gt;<a class="code" href="../../d0/d99/structast__frame.html#a27237c48fdcd22556401f20c693811db">subclass</a>.<a class="code" href="../../d1/d9f/structast__frame__subclass.html#adece183191b0e700e039e59101e06105">integer</a> == <a class="code" href="../../d6/d66/include_2asterisk_2frame_8h.html#aedda41918e992000fe921f8f7363b390a7334c9d27a6d70fe7c85b60b864788fc">AST_CONTROL_T38_PARAMETERS</a>) &amp;&amp;</div><div class="line"><a name="l02472"></a><span class="lineno"> 2472</span>&#160;                  (frame-&gt;<a class="code" href="../../d0/d99/structast__frame.html#ad67e07841d1233e596e6f822a3c81f6b">datalen</a> == <span class="keyword">sizeof</span>(t38_parameters))) {</div><div class="line"><a name="l02473"></a><span class="lineno"> 2473</span>&#160;               <span class="keyword">struct </span><a class="code" href="../../d5/def/structast__control__t38__parameters.html">ast_control_t38_parameters</a> *parameters = frame-&gt;<a class="code" href="../../d0/d99/structast__frame.html#a4027905f872af30d910929b07e261ca5">data</a>.<a class="code" href="../../d0/d99/structast__frame.html#add9af9569af79ec26dd741fb226b38ba">ptr</a>;</div><div class="line"><a name="l02474"></a><span class="lineno"> 2474</span>&#160;</div><div class="line"><a name="l02475"></a><span class="lineno"> 2475</span>&#160;               <span class="keywordflow">switch</span> (parameters-&gt;<a class="code" href="../../d5/def/structast__control__t38__parameters.html#adb36822366e10ce64ca8337c512732a6">request_response</a>) {</div><div class="line"><a name="l02476"></a><span class="lineno"> 2476</span>&#160;               <span class="keywordflow">case</span> <a class="code" href="../../d6/d66/include_2asterisk_2frame_8h.html#a168d496bdac09ece3ce49cf473bbdb4bafdb1ca68d683c64301c4cf07463a9975">AST_T38_REQUEST_NEGOTIATE</a>:</div><div class="line"><a name="l02477"></a><span class="lineno"> 2477</span>&#160;                  <span class="comment">/* the other end has requested a switch to T.38, so reply that we are willing, if we can</span></div><div class="line"><a name="l02478"></a><span class="lineno"> 2478</span>&#160;<span class="comment">                   * do T.38 as well</span></div><div class="line"><a name="l02479"></a><span class="lineno"> 2479</span>&#160;<span class="comment">                   */</span></div><div class="line"><a name="l02480"></a><span class="lineno"> 2480</span>&#160;                  <a class="code" href="../../d0/d60/res__fax_8c.html#a624525cc48cff52d5ae4e5e50895e81e">t38_parameters_fax_to_ast</a>(&amp;t38_parameters, &amp;details-&gt;<a class="code" href="../../d8/dc2/structast__fax__session__details.html#a80632865b575d06f319ef95c42645b2c">our_t38_parameters</a>);</div><div class="line"><a name="l02481"></a><span class="lineno"> 2481</span>&#160;                  t38_parameters.<a class="code" href="../../d5/def/structast__control__t38__parameters.html#adb36822366e10ce64ca8337c512732a6">request_response</a> = (details-&gt;<a class="code" href="../../d8/dc2/structast__fax__session__details.html#ad75375cdd336e91cbcee4a829fcdabfe">caps</a> &amp; <a class="code" href="../../db/d6a/res__fax_8h.html#a54eb45ad548b874cf12d0a599631e3f6a6868445e2802e5b71068ae883366f635">AST_FAX_TECH_T38</a>) ? <a class="code" href="../../d6/d66/include_2asterisk_2frame_8h.html#a168d496bdac09ece3ce49cf473bbdb4bad501e0d5fe272eaba466507a686a2df5">AST_T38_NEGOTIATED</a> : <a class="code" href="../../d6/d66/include_2asterisk_2frame_8h.html#a168d496bdac09ece3ce49cf473bbdb4baa02b30f25621f20396d06f5ac8aa7a2e">AST_T38_REFUSED</a>;</div><div class="line"><a name="l02482"></a><span class="lineno"> 2482</span>&#160;                  <a class="code" href="../../d5/d7b/channel_8h.html#aa8c3522af1bc639cbd5b38f5fdf171fa">ast_indicate_data</a>(chan, <a class="code" href="../../d6/d66/include_2asterisk_2frame_8h.html#aedda41918e992000fe921f8f7363b390a7334c9d27a6d70fe7c85b60b864788fc">AST_CONTROL_T38_PARAMETERS</a>, &amp;t38_parameters, <span class="keyword">sizeof</span>(t38_parameters));</div><div class="line"><a name="l02483"></a><span class="lineno"> 2483</span>&#160;                  <a class="code" href="../../d2/d0f/indications_8h.html#a9d5be069b7060d326a213f5d60b8dc77">ast_playtones_stop</a>(chan);</div><div class="line"><a name="l02484"></a><span class="lineno"> 2484</span>&#160;                  <span class="keywordflow">break</span>;</div><div class="line"><a name="l02485"></a><span class="lineno"> 2485</span>&#160;               <span class="keywordflow">case</span> <a class="code" href="../../d6/d66/include_2asterisk_2frame_8h.html#a168d496bdac09ece3ce49cf473bbdb4bad501e0d5fe272eaba466507a686a2df5">AST_T38_NEGOTIATED</a>:</div><div class="line"><a name="l02486"></a><span class="lineno"> 2486</span>&#160;                  <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(1, <span class="stringliteral">&quot;Negotiated T.38 for send on %s\n&quot;</span>, <a class="code" href="../../d5/d7b/channel_8h.html#a7ca2fda13b129a55c251b56729de285b">ast_channel_name</a>(chan));</div><div class="line"><a name="l02487"></a><span class="lineno"> 2487</span>&#160;                  <a class="code" href="../../d0/d60/res__fax_8c.html#aa9ea5a83822d7365075730ddb8490d23">t38_parameters_ast_to_fax</a>(&amp;details-&gt;<a class="code" href="../../d8/dc2/structast__fax__session__details.html#a12cc2bfdcc88e94984d001cca6fefdc5">their_t38_parameters</a>, parameters);</div><div class="line"><a name="l02488"></a><span class="lineno"> 2488</span>&#160;                  details-&gt;<a class="code" href="../../d8/dc2/structast__fax__session__details.html#ad75375cdd336e91cbcee4a829fcdabfe">caps</a> &amp;= ~<a class="code" href="../../db/d6a/res__fax_8h.html#a54eb45ad548b874cf12d0a599631e3f6a76fa4111df51955a949e95fadbccd48b">AST_FAX_TECH_AUDIO</a>;</div><div class="line"><a name="l02489"></a><span class="lineno"> 2489</span>&#160;                  <a class="code" href="../../d0/d60/res__fax_8c.html#a38d73af44b480b7cad7a654f75926777">report_fax_status</a>(chan, details, <span class="stringliteral">&quot;T.38 Negotiated&quot;</span>);</div><div class="line"><a name="l02490"></a><span class="lineno"> 2490</span>&#160;                  break_loop = 1;</div><div class="line"><a name="l02491"></a><span class="lineno"> 2491</span>&#160;                  <span class="keywordflow">break</span>;</div><div class="line"><a name="l02492"></a><span class="lineno"> 2492</span>&#160;               <span class="keywordflow">default</span>:</div><div class="line"><a name="l02493"></a><span class="lineno"> 2493</span>&#160;                  <span class="keywordflow">break</span>;</div><div class="line"><a name="l02494"></a><span class="lineno"> 2494</span>&#160;               }</div><div class="line"><a name="l02495"></a><span class="lineno"> 2495</span>&#160;            }</div><div class="line"><a name="l02496"></a><span class="lineno"> 2496</span>&#160;            <a class="code" href="../../d6/d66/include_2asterisk_2frame_8h.html#a6440d070425a2efe8e0aa71e8d9e47b7">ast_frfree</a>(frame);</div><div class="line"><a name="l02497"></a><span class="lineno"> 2497</span>&#160;            <span class="keywordflow">if</span> (break_loop) {</div><div class="line"><a name="l02498"></a><span class="lineno"> 2498</span>&#160;               <span class="keywordflow">break</span>;</div><div class="line"><a name="l02499"></a><span class="lineno"> 2499</span>&#160;            }</div><div class="line"><a name="l02500"></a><span class="lineno"> 2500</span>&#160;         }</div><div class="line"><a name="l02501"></a><span class="lineno"> 2501</span>&#160;</div><div class="line"><a name="l02502"></a><span class="lineno"> 2502</span>&#160;         <a class="code" href="../../d2/d0f/indications_8h.html#a9d5be069b7060d326a213f5d60b8dc77">ast_playtones_stop</a>(chan);</div><div class="line"><a name="l02503"></a><span class="lineno"> 2503</span>&#160;</div><div class="line"><a name="l02504"></a><span class="lineno"> 2504</span>&#160;         <span class="comment">/* if T.38 was negotiated, we are done initializing */</span></div><div class="line"><a name="l02505"></a><span class="lineno"> 2505</span>&#160;         <span class="keywordflow">if</span> (<a class="code" href="../../d5/d7b/channel_8h.html#a1b22ea5302ef183fa68bc45bfb0659c9">ast_channel_get_t38_state</a>(chan) == <a class="code" href="../../d5/d7b/channel_8h.html#a4cd990f4c1cd0c2af6e4c63f6d15b4e1af142c79721a025bd65edad812f0725e0">T38_STATE_NEGOTIATED</a>) {</div><div class="line"><a name="l02506"></a><span class="lineno"> 2506</span>&#160;            <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l02507"></a><span class="lineno"> 2507</span>&#160;         }</div><div class="line"><a name="l02508"></a><span class="lineno"> 2508</span>&#160;      }</div><div class="line"><a name="l02509"></a><span class="lineno"> 2509</span>&#160;   }</div><div class="line"><a name="l02510"></a><span class="lineno"> 2510</span>&#160;</div><div class="line"><a name="l02511"></a><span class="lineno"> 2511</span>&#160;   <span class="comment">/* if we made it here, then T.38 failed, check the &#39;f&#39; flag */</span></div><div class="line"><a name="l02512"></a><span class="lineno"> 2512</span>&#160;   <span class="keywordflow">if</span> (details-&gt;<a class="code" href="../../d8/dc2/structast__fax__session__details.html#a3ab211dbe8780b7292257f6b3dba1952">option</a>.<a class="code" href="../../d8/dc2/structast__fax__session__details.html#a2bdd8d6f48911b41e094440799e00bd2">allow_audio</a> == <a class="code" href="../../db/d6a/res__fax_8h.html#a1838c71fcf68c3cfe0ce37e35e77406daa2151729c413238bea86a4b62e7865bd">AST_FAX_OPTFLAG_FALSE</a>) {</div><div class="line"><a name="l02513"></a><span class="lineno"> 2513</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Audio FAX not allowed on channel &#39;%s&#39; and T.38 negotiation failed; aborting.\n&quot;</span>, <a class="code" href="../../d5/d7b/channel_8h.html#a7ca2fda13b129a55c251b56729de285b">ast_channel_name</a>(chan));</div><div class="line"><a name="l02514"></a><span class="lineno"> 2514</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l02515"></a><span class="lineno"> 2515</span>&#160;   }</div><div class="line"><a name="l02516"></a><span class="lineno"> 2516</span>&#160;</div><div class="line"><a name="l02517"></a><span class="lineno"> 2517</span>&#160;   <span class="comment">/* ok, audio fallback is allowed */</span></div><div class="line"><a name="l02518"></a><span class="lineno"> 2518</span>&#160;   details-&gt;<a class="code" href="../../d8/dc2/structast__fax__session__details.html#ad75375cdd336e91cbcee4a829fcdabfe">caps</a> |= <a class="code" href="../../db/d6a/res__fax_8h.html#a54eb45ad548b874cf12d0a599631e3f6a76fa4111df51955a949e95fadbccd48b">AST_FAX_TECH_AUDIO</a>;</div><div class="line"><a name="l02519"></a><span class="lineno"> 2519</span>&#160;</div><div class="line"><a name="l02520"></a><span class="lineno"> 2520</span>&#160;   <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l02521"></a><span class="lineno"> 2521</span>&#160;}</div><div class="line"><a name="l02522"></a><span class="lineno"> 2522</span>&#160;<span class="comment"></span></div><div class="line"><a name="l02523"></a><span class="lineno"> 2523</span>&#160;<span class="comment">/*!</span></div><div class="line"><a name="l02524"></a><span class="lineno"> 2524</span>&#160;<span class="comment"> * \brief Report on the status of a completed fax send attempt</span></div><div class="line"><a name="l02525"></a><span class="lineno"> 2525</span>&#160;<span class="comment"> * \note This will lock the \ref ast_channel</span></div><div class="line"><a name="l02526"></a><span class="lineno"> 2526</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l02527"></a><span class="lineno"><a class="line" href="../../d0/d60/res__fax_8c.html#afd17b7bdd81198a94df9503cc9f10291"> 2527</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d0/d60/res__fax_8c.html#afd17b7bdd81198a94df9503cc9f10291">report_send_fax_status</a>(<span class="keyword">struct</span> <a class="code" href="../../df/d3c/structast__channel.html">ast_channel</a> *chan, <span class="keyword">struct</span> <a class="code" href="../../d8/dc2/structast__fax__session__details.html">ast_fax_session_details</a> *details)</div><div class="line"><a name="l02528"></a><span class="lineno"> 2528</span>&#160;{</div><div class="line"><a name="l02529"></a><span class="lineno"> 2529</span>&#160;   <a class="code" href="../../d5/d60/utils_8h.html#a1604b4d72144dd3d9f7da668e90337e9">RAII_VAR</a>(<span class="keyword">struct</span> <a class="code" href="../../d1/da1/structast__json.html">ast_json</a> *, json_obj, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../d4/d05/json_8h.html#a33bcd9181e613a659eefe411ec42c87c">ast_json_unref</a>);</div><div class="line"><a name="l02530"></a><span class="lineno"> 2530</span>&#160;   <a class="code" href="../../d5/d60/utils_8h.html#a1604b4d72144dd3d9f7da668e90337e9">RAII_VAR</a>(<span class="keyword">struct</span> <a class="code" href="../../d7/d55/structstasis__message.html">stasis_message</a> *, <a class="code" href="../../d8/d9e/structmessage.html">message</a>, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../d5/da5/astobj2_8h.html#a6321ee982370c55ab3c24c72c562cbdd">ao2_cleanup</a>);</div><div class="line"><a name="l02531"></a><span class="lineno"> 2531</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d1/da1/structast__json.html">ast_json</a> *json_filenames;</div><div class="line"><a name="l02532"></a><span class="lineno"> 2532</span>&#160;</div><div class="line"><a name="l02533"></a><span class="lineno"> 2533</span>&#160;   json_filenames = <a class="code" href="../../d0/d60/res__fax_8c.html#a8dfe16760634f2d87db5508787023ef5">generate_filenames_json</a>(details);</div><div class="line"><a name="l02534"></a><span class="lineno"> 2534</span>&#160;   <span class="keywordflow">if</span> (!json_filenames) {</div><div class="line"><a name="l02535"></a><span class="lineno"> 2535</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l02536"></a><span class="lineno"> 2536</span>&#160;   }</div><div class="line"><a name="l02537"></a><span class="lineno"> 2537</span>&#160;</div><div class="line"><a name="l02538"></a><span class="lineno"> 2538</span>&#160;   {</div><div class="line"><a name="l02539"></a><span class="lineno"> 2539</span>&#160;      <span class="keyword">const</span> <span class="keywordtype">char</span> *remote_station_id;</div><div class="line"><a name="l02540"></a><span class="lineno"> 2540</span>&#160;      <span class="keyword">const</span> <span class="keywordtype">char</span> *local_station_id;</div><div class="line"><a name="l02541"></a><span class="lineno"> 2541</span>&#160;      <span class="keyword">const</span> <span class="keywordtype">char</span> *fax_pages;</div><div class="line"><a name="l02542"></a><span class="lineno"> 2542</span>&#160;      <span class="keyword">const</span> <span class="keywordtype">char</span> *fax_resolution;</div><div class="line"><a name="l02543"></a><span class="lineno"> 2543</span>&#160;      <span class="keyword">const</span> <span class="keywordtype">char</span> *fax_bitrate;</div><div class="line"><a name="l02544"></a><span class="lineno"> 2544</span>&#160;      <a class="code" href="../../dd/d42/lock_8h.html#aa11d2e2d6aaa7048d48491842c1de738">SCOPED_CHANNELLOCK</a>(<a class="code" href="../../df/d44/app__meetme_8c.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>, chan);</div><div class="line"><a name="l02545"></a><span class="lineno"> 2545</span>&#160;</div><div class="line"><a name="l02546"></a><span class="lineno"> 2546</span>&#160;      remote_station_id = <a class="code" href="../../d4/d05/json_8h.html#ac319d5898e86709f7e25b1b2d73b7b12">AST_JSON_UTF8_VALIDATE</a>(<a class="code" href="../../db/de0/pbx_8h.html#a98c5425b90ec7c5e136a40f529170b1b">pbx_builtin_getvar_helper</a>(chan, <span class="stringliteral">&quot;REMOTESTATIONID&quot;</span>));</div><div class="line"><a name="l02547"></a><span class="lineno"> 2547</span>&#160;      <span class="keywordflow">if</span> (!<a class="code" href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a>(remote_station_id)) {</div><div class="line"><a name="l02548"></a><span class="lineno"> 2548</span>&#160;         remote_station_id = <a class="code" href="../../d8/d8a/astmm_8h.html#ab5f0750cc80ba337fdcbddea2d3a1ee6">ast_strdupa</a>(remote_station_id);</div><div class="line"><a name="l02549"></a><span class="lineno"> 2549</span>&#160;      }</div><div class="line"><a name="l02550"></a><span class="lineno"> 2550</span>&#160;      local_station_id = <a class="code" href="../../d4/d05/json_8h.html#ac319d5898e86709f7e25b1b2d73b7b12">AST_JSON_UTF8_VALIDATE</a>(<a class="code" href="../../db/de0/pbx_8h.html#a98c5425b90ec7c5e136a40f529170b1b">pbx_builtin_getvar_helper</a>(chan, <span class="stringliteral">&quot;LOCALSTATIONID&quot;</span>));</div><div class="line"><a name="l02551"></a><span class="lineno"> 2551</span>&#160;      <span class="keywordflow">if</span> (!<a class="code" href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a>(local_station_id)) {</div><div class="line"><a name="l02552"></a><span class="lineno"> 2552</span>&#160;         local_station_id = <a class="code" href="../../d8/d8a/astmm_8h.html#ab5f0750cc80ba337fdcbddea2d3a1ee6">ast_strdupa</a>(local_station_id);</div><div class="line"><a name="l02553"></a><span class="lineno"> 2553</span>&#160;      }</div><div class="line"><a name="l02554"></a><span class="lineno"> 2554</span>&#160;      fax_pages = <a class="code" href="../../d6/d90/strings_8h.html#a2faaa16929951bfd2802b7829a100ba2">S_OR</a>(<a class="code" href="../../db/de0/pbx_8h.html#a98c5425b90ec7c5e136a40f529170b1b">pbx_builtin_getvar_helper</a>(chan, <span class="stringliteral">&quot;FAXPAGES&quot;</span>), <span class="stringliteral">&quot;&quot;</span>);</div><div class="line"><a name="l02555"></a><span class="lineno"> 2555</span>&#160;      <span class="keywordflow">if</span> (!<a class="code" href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a>(fax_pages)) {</div><div class="line"><a name="l02556"></a><span class="lineno"> 2556</span>&#160;         fax_pages = <a class="code" href="../../d8/d8a/astmm_8h.html#ab5f0750cc80ba337fdcbddea2d3a1ee6">ast_strdupa</a>(fax_pages);</div><div class="line"><a name="l02557"></a><span class="lineno"> 2557</span>&#160;      }</div><div class="line"><a name="l02558"></a><span class="lineno"> 2558</span>&#160;      fax_resolution = <a class="code" href="../../d6/d90/strings_8h.html#a2faaa16929951bfd2802b7829a100ba2">S_OR</a>(<a class="code" href="../../db/de0/pbx_8h.html#a98c5425b90ec7c5e136a40f529170b1b">pbx_builtin_getvar_helper</a>(chan, <span class="stringliteral">&quot;FAXRESOLUTION&quot;</span>), <span class="stringliteral">&quot;&quot;</span>);</div><div class="line"><a name="l02559"></a><span class="lineno"> 2559</span>&#160;      <span class="keywordflow">if</span> (!<a class="code" href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a>(fax_resolution)) {</div><div class="line"><a name="l02560"></a><span class="lineno"> 2560</span>&#160;         fax_resolution = <a class="code" href="../../d8/d8a/astmm_8h.html#ab5f0750cc80ba337fdcbddea2d3a1ee6">ast_strdupa</a>(fax_resolution);</div><div class="line"><a name="l02561"></a><span class="lineno"> 2561</span>&#160;      }</div><div class="line"><a name="l02562"></a><span class="lineno"> 2562</span>&#160;      fax_bitrate = <a class="code" href="../../d6/d90/strings_8h.html#a2faaa16929951bfd2802b7829a100ba2">S_OR</a>(<a class="code" href="../../db/de0/pbx_8h.html#a98c5425b90ec7c5e136a40f529170b1b">pbx_builtin_getvar_helper</a>(chan, <span class="stringliteral">&quot;FAXBITRATE&quot;</span>), <span class="stringliteral">&quot;&quot;</span>);</div><div class="line"><a name="l02563"></a><span class="lineno"> 2563</span>&#160;      <span class="keywordflow">if</span> (!<a class="code" href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a>(fax_bitrate)) {</div><div class="line"><a name="l02564"></a><span class="lineno"> 2564</span>&#160;         fax_bitrate = <a class="code" href="../../d8/d8a/astmm_8h.html#ab5f0750cc80ba337fdcbddea2d3a1ee6">ast_strdupa</a>(fax_bitrate);</div><div class="line"><a name="l02565"></a><span class="lineno"> 2565</span>&#160;      }</div><div class="line"><a name="l02566"></a><span class="lineno"> 2566</span>&#160;      json_obj = <a class="code" href="../../d4/d05/json_8h.html#a99715667e822b2ad409b34ca041e535d">ast_json_pack</a>(<span class="stringliteral">&quot;{s: s, s: s, s: s, s: s, s: s, s: s, s: o}&quot;</span>,</div><div class="line"><a name="l02567"></a><span class="lineno"> 2567</span>&#160;            <span class="stringliteral">&quot;type&quot;</span>, <span class="stringliteral">&quot;send&quot;</span>,</div><div class="line"><a name="l02568"></a><span class="lineno"> 2568</span>&#160;            <span class="stringliteral">&quot;remote_station_id&quot;</span>, <a class="code" href="../../d6/d90/strings_8h.html#a2faaa16929951bfd2802b7829a100ba2">S_OR</a>(remote_station_id, <span class="stringliteral">&quot;&quot;</span>),</div><div class="line"><a name="l02569"></a><span class="lineno"> 2569</span>&#160;            <span class="stringliteral">&quot;local_station_id&quot;</span>, <a class="code" href="../../d6/d90/strings_8h.html#a2faaa16929951bfd2802b7829a100ba2">S_OR</a>(local_station_id, <span class="stringliteral">&quot;&quot;</span>),</div><div class="line"><a name="l02570"></a><span class="lineno"> 2570</span>&#160;            <span class="stringliteral">&quot;fax_pages&quot;</span>, <a class="code" href="../../d6/d90/strings_8h.html#a2faaa16929951bfd2802b7829a100ba2">S_OR</a>(fax_pages, <span class="stringliteral">&quot;&quot;</span>),</div><div class="line"><a name="l02571"></a><span class="lineno"> 2571</span>&#160;            <span class="stringliteral">&quot;fax_resolution&quot;</span>, <a class="code" href="../../d6/d90/strings_8h.html#a2faaa16929951bfd2802b7829a100ba2">S_OR</a>(fax_resolution, <span class="stringliteral">&quot;&quot;</span>),</div><div class="line"><a name="l02572"></a><span class="lineno"> 2572</span>&#160;            <span class="stringliteral">&quot;fax_bitrate&quot;</span>, <a class="code" href="../../d6/d90/strings_8h.html#a2faaa16929951bfd2802b7829a100ba2">S_OR</a>(fax_bitrate, <span class="stringliteral">&quot;&quot;</span>),</div><div class="line"><a name="l02573"></a><span class="lineno"> 2573</span>&#160;            <span class="stringliteral">&quot;filenames&quot;</span>, json_filenames);</div><div class="line"><a name="l02574"></a><span class="lineno"> 2574</span>&#160;      <span class="keywordflow">if</span> (!json_obj) {</div><div class="line"><a name="l02575"></a><span class="lineno"> 2575</span>&#160;         <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l02576"></a><span class="lineno"> 2576</span>&#160;      }</div><div class="line"><a name="l02577"></a><span class="lineno"> 2577</span>&#160;</div><div class="line"><a name="l02578"></a><span class="lineno"> 2578</span>&#160;      <a class="code" href="../../d8/d9e/structmessage.html">message</a> = <a class="code" href="../../df/deb/group__StasisTopicsAndMessages.html#gafe8b123e0c124e44c3bff016591d3f9c">ast_channel_blob_create_from_cache</a>(<a class="code" href="../../d5/d7b/channel_8h.html#a3b6254f6d3832ef928f0a727113b1c63">ast_channel_uniqueid</a>(chan), <a class="code" href="../../df/deb/group__StasisTopicsAndMessages.html#ga6d11307e605e80f977bde354a11d7902">ast_channel_fax_type</a>(), json_obj);</div><div class="line"><a name="l02579"></a><span class="lineno"> 2579</span>&#160;      <span class="keywordflow">if</span> (!<a class="code" href="../../d8/d9e/structmessage.html">message</a>) {</div><div class="line"><a name="l02580"></a><span class="lineno"> 2580</span>&#160;         <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l02581"></a><span class="lineno"> 2581</span>&#160;      }</div><div class="line"><a name="l02582"></a><span class="lineno"> 2582</span>&#160;      <a class="code" href="../../dd/d79/stasis_8h.html#ac43d0a33d111e9f34b441b285c166cfc">stasis_publish</a>(<a class="code" href="../../d5/d7b/channel_8h.html#afdeaf9abb1aecc715313a4f62c1cf9c9">ast_channel_topic</a>(chan), <a class="code" href="../../d8/d9e/structmessage.html">message</a>);</div><div class="line"><a name="l02583"></a><span class="lineno"> 2583</span>&#160;   }</div><div class="line"><a name="l02584"></a><span class="lineno"> 2584</span>&#160;   <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l02585"></a><span class="lineno"> 2585</span>&#160;}</div><div class="line"><a name="l02586"></a><span class="lineno"> 2586</span>&#160;</div><div class="line"><a name="l02587"></a><span class="lineno"> 2587</span>&#160;</div><div class="line"><a name="l02588"></a><span class="lineno"> 2588</span>&#160;<span class="comment"></span></div><div class="line"><a name="l02589"></a><span class="lineno"> 2589</span>&#160;<span class="comment">/*! \brief initiate a send FAX session */</span></div><div class="line"><a name="l02590"></a><span class="lineno"><a class="line" href="../../d0/d60/res__fax_8c.html#a69d3cd379ff7db5b4f5689f515f9a2ce"> 2590</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d0/d60/res__fax_8c.html#a69d3cd379ff7db5b4f5689f515f9a2ce">sendfax_exec</a>(<span class="keyword">struct</span> <a class="code" href="../../df/d3c/structast__channel.html">ast_channel</a> *chan, <span class="keyword">const</span> <span class="keywordtype">char</span> *data)</div><div class="line"><a name="l02591"></a><span class="lineno"> 2591</span>&#160;{</div><div class="line"><a name="l02592"></a><span class="lineno"> 2592</span>&#160;   <span class="keywordtype">char</span> *<a class="code" href="../../d0/dd6/chan__mgcp_8c.html#a2e006acff60d9b3d65d7d60f975d6747">parse</a>, *filenames, *<a class="code" href="../../d7/d6f/test__linkedlists_8c.html#acd9db00336027462cfb25b97b5356883">c</a>, modems[128] = <span class="stringliteral">&quot;&quot;</span>;</div><div class="line"><a name="l02593"></a><span class="lineno"> 2593</span>&#160;   <span class="keywordtype">int</span> channel_alive, file_count;</div><div class="line"><a name="l02594"></a><span class="lineno"> 2594</span>&#160;   <a class="code" href="../../d5/d60/utils_8h.html#a1604b4d72144dd3d9f7da668e90337e9">RAII_VAR</a>(<span class="keyword">struct</span> <a class="code" href="../../d8/dc2/structast__fax__session__details.html">ast_fax_session_details</a> *, details, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../d5/da5/astobj2_8h.html#a6321ee982370c55ab3c24c72c562cbdd">ao2_cleanup</a>);</div><div class="line"><a name="l02595"></a><span class="lineno"> 2595</span>&#160;   <a class="code" href="../../d5/d60/utils_8h.html#a1604b4d72144dd3d9f7da668e90337e9">RAII_VAR</a>(<span class="keyword">struct</span> <a class="code" href="../../d1/d16/structast__fax__session.html">ast_fax_session</a> *, s, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../d5/da5/astobj2_8h.html#a6321ee982370c55ab3c24c72c562cbdd">ao2_cleanup</a>);</div><div class="line"><a name="l02596"></a><span class="lineno"> 2596</span>&#160;   <span class="keyword">struct </span>ast_fax_tech_token *token = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l02597"></a><span class="lineno"> 2597</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d2/db8/structast__fax__document.html">ast_fax_document</a> *doc;</div><div class="line"><a name="l02598"></a><span class="lineno"> 2598</span>&#160;   <a class="code" href="../../d3/d93/include_2asterisk_2app_8h.html#a80cd3f6f786b59b742bcecfc0b3be7c2">AST_DECLARE_APP_ARGS</a>(<a class="code" href="../../d5/dde/test__func__file_8c.html#a7df83d295429a2562396f1ec127a46c0">args</a>,</div><div class="line"><a name="l02599"></a><span class="lineno"> 2599</span>&#160;      <a class="code" href="../../d3/d93/include_2asterisk_2app_8h.html#a037e9a5b28477b17e7c9acbe7ecb21d5">AST_APP_ARG</a>(filenames);</div><div class="line"><a name="l02600"></a><span class="lineno"> 2600</span>&#160;      <a class="code" href="../../d3/d93/include_2asterisk_2app_8h.html#a037e9a5b28477b17e7c9acbe7ecb21d5">AST_APP_ARG</a>(<a class="code" href="../../d4/d45/test__http__media__cache_8c.html#a80c8e3ae5087d90d422675d034eeebc7">options</a>);</div><div class="line"><a name="l02601"></a><span class="lineno"> 2601</span>&#160;   );</div><div class="line"><a name="l02602"></a><span class="lineno"> 2602</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../dc/dac/structast__flags.html">ast_flags</a> opts = { 0, };</div><div class="line"><a name="l02603"></a><span class="lineno"> 2603</span>&#160;   <span class="keyword">enum</span> <a class="code" href="../../d5/d7b/channel_8h.html#a4cd990f4c1cd0c2af6e4c63f6d15b4e1">ast_t38_state</a> <a class="code" href="../../d1/d94/sip_8h.html#ada584ef2e7f77c8dfe0315d05fa49e1c">t38state</a>;</div><div class="line"><a name="l02604"></a><span class="lineno"> 2604</span>&#160;</div><div class="line"><a name="l02605"></a><span class="lineno"> 2605</span>&#160;   <span class="comment">/* initialize output channel variables */</span></div><div class="line"><a name="l02606"></a><span class="lineno"> 2606</span>&#160;   <a class="code" href="../../db/de0/pbx_8h.html#a6e5b90edb84d216267148dddcffe9b9a">pbx_builtin_setvar_helper</a>(chan, <span class="stringliteral">&quot;FAXSTATUS&quot;</span>, <span class="stringliteral">&quot;FAILED&quot;</span>);</div><div class="line"><a name="l02607"></a><span class="lineno"> 2607</span>&#160;   <a class="code" href="../../db/de0/pbx_8h.html#a6e5b90edb84d216267148dddcffe9b9a">pbx_builtin_setvar_helper</a>(chan, <span class="stringliteral">&quot;REMOTESTATIONID&quot;</span>, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div><div class="line"><a name="l02608"></a><span class="lineno"> 2608</span>&#160;   <a class="code" href="../../db/de0/pbx_8h.html#a6e5b90edb84d216267148dddcffe9b9a">pbx_builtin_setvar_helper</a>(chan, <span class="stringliteral">&quot;FAXPAGES&quot;</span>, <span class="stringliteral">&quot;0&quot;</span>);</div><div class="line"><a name="l02609"></a><span class="lineno"> 2609</span>&#160;   <a class="code" href="../../db/de0/pbx_8h.html#a6e5b90edb84d216267148dddcffe9b9a">pbx_builtin_setvar_helper</a>(chan, <span class="stringliteral">&quot;FAXBITRATE&quot;</span>, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div><div class="line"><a name="l02610"></a><span class="lineno"> 2610</span>&#160;   <a class="code" href="../../db/de0/pbx_8h.html#a6e5b90edb84d216267148dddcffe9b9a">pbx_builtin_setvar_helper</a>(chan, <span class="stringliteral">&quot;FAXRESOLUTION&quot;</span>, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div><div class="line"><a name="l02611"></a><span class="lineno"> 2611</span>&#160;   <a class="code" href="../../db/de0/pbx_8h.html#a6e5b90edb84d216267148dddcffe9b9a">pbx_builtin_setvar_helper</a>(chan, <span class="stringliteral">&quot;FAXMODE&quot;</span>, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div><div class="line"><a name="l02612"></a><span class="lineno"> 2612</span>&#160;</div><div class="line"><a name="l02613"></a><span class="lineno"> 2613</span>&#160;   <span class="comment">/* Get a requirement structure and set it.  This structure is used</span></div><div class="line"><a name="l02614"></a><span class="lineno"> 2614</span>&#160;<span class="comment">    * to tell the FAX technology module about the higher level FAX session */</span></div><div class="line"><a name="l02615"></a><span class="lineno"> 2615</span>&#160;   <span class="keywordflow">if</span> (!(details = <a class="code" href="../../d0/d60/res__fax_8c.html#ac4310e981e9db76dfc3e85c51f4c6e1e">find_or_create_details</a>(chan))) {</div><div class="line"><a name="l02616"></a><span class="lineno"> 2616</span>&#160;      <a class="code" href="../../db/de0/pbx_8h.html#a6e5b90edb84d216267148dddcffe9b9a">pbx_builtin_setvar_helper</a>(chan, <span class="stringliteral">&quot;FAXERROR&quot;</span>, <span class="stringliteral">&quot;MEMORY_ERROR&quot;</span>);</div><div class="line"><a name="l02617"></a><span class="lineno"> 2617</span>&#160;      <a class="code" href="../../db/de0/pbx_8h.html#a6e5b90edb84d216267148dddcffe9b9a">pbx_builtin_setvar_helper</a>(chan, <span class="stringliteral">&quot;FAXSTATUSSTRING&quot;</span>, <span class="stringliteral">&quot;error allocating memory&quot;</span>);</div><div class="line"><a name="l02618"></a><span class="lineno"> 2618</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;System cannot provide memory for session requirements.\n&quot;</span>);</div><div class="line"><a name="l02619"></a><span class="lineno"> 2619</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l02620"></a><span class="lineno"> 2620</span>&#160;   }</div><div class="line"><a name="l02621"></a><span class="lineno"> 2621</span>&#160;</div><div class="line"><a name="l02622"></a><span class="lineno"> 2622</span>&#160;   <a class="code" href="../../d1/d0f/stringfields_8h.html#a653461abd6e0d16e4e3326ab90e0501d">ast_string_field_set</a>(details, <a class="code" href="../../de/d1b/cel__pgsql_8c.html#ad6c487210772a9b4b0ca04b04b847d4c">result</a>, <span class="stringliteral">&quot;FAILED&quot;</span>);</div><div class="line"><a name="l02623"></a><span class="lineno"> 2623</span>&#160;   <a class="code" href="../../d1/d0f/stringfields_8h.html#a653461abd6e0d16e4e3326ab90e0501d">ast_string_field_set</a>(details, resultstr, <span class="stringliteral">&quot;error starting fax session&quot;</span>);</div><div class="line"><a name="l02624"></a><span class="lineno"> 2624</span>&#160;   <a class="code" href="../../d1/d0f/stringfields_8h.html#a653461abd6e0d16e4e3326ab90e0501d">ast_string_field_set</a>(details, <a class="code" href="../../d6/d47/utils_2frame_8c.html#a4a9391ee88e57361b613c4c2fd2bf4aa">error</a>, <span class="stringliteral">&quot;INIT_ERROR&quot;</span>);</div><div class="line"><a name="l02625"></a><span class="lineno"> 2625</span>&#160;   <a class="code" href="../../d0/d60/res__fax_8c.html#ad7732b5ae304d39afa2dacb20187cf04">set_channel_variables</a>(chan, details);</div><div class="line"><a name="l02626"></a><span class="lineno"> 2626</span>&#160;</div><div class="line"><a name="l02627"></a><span class="lineno"> 2627</span>&#160;   <span class="keywordflow">if</span> (details-&gt;<a class="code" href="../../d8/dc2/structast__fax__session__details.html#a2a669261b0b8c26d26573c678149d312">gateway_id</a> &gt; 0) {</div><div class="line"><a name="l02628"></a><span class="lineno"> 2628</span>&#160;      <a class="code" href="../../d1/d0f/stringfields_8h.html#a653461abd6e0d16e4e3326ab90e0501d">ast_string_field_set</a>(details, resultstr, <span class="stringliteral">&quot;can&#39;t send a fax on a channel with a T.38 gateway&quot;</span>);</div><div class="line"><a name="l02629"></a><span class="lineno"> 2629</span>&#160;      <a class="code" href="../../d0/d60/res__fax_8c.html#ad7732b5ae304d39afa2dacb20187cf04">set_channel_variables</a>(chan, details);</div><div class="line"><a name="l02630"></a><span class="lineno"> 2630</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;executing SendFAX on a channel with a T.38 Gateway is not supported\n&quot;</span>);</div><div class="line"><a name="l02631"></a><span class="lineno"> 2631</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l02632"></a><span class="lineno"> 2632</span>&#160;   }</div><div class="line"><a name="l02633"></a><span class="lineno"> 2633</span>&#160;</div><div class="line"><a name="l02634"></a><span class="lineno"> 2634</span>&#160;   <span class="keywordflow">if</span> (details-&gt;<a class="code" href="../../d8/dc2/structast__fax__session__details.html#a975b0a45868387d13867daeac314978a">maxrate</a> &lt; details-&gt;<a class="code" href="../../d8/dc2/structast__fax__session__details.html#a8bff16fb9ab2254b86636f6fac166a66">minrate</a>) {</div><div class="line"><a name="l02635"></a><span class="lineno"> 2635</span>&#160;      <a class="code" href="../../d1/d0f/stringfields_8h.html#a653461abd6e0d16e4e3326ab90e0501d">ast_string_field_set</a>(details, <a class="code" href="../../d6/d47/utils_2frame_8c.html#a4a9391ee88e57361b613c4c2fd2bf4aa">error</a>, <span class="stringliteral">&quot;INVALID_ARGUMENTS&quot;</span>);</div><div class="line"><a name="l02636"></a><span class="lineno"> 2636</span>&#160;      <a class="code" href="../../d1/d0f/stringfields_8h.html#a653461abd6e0d16e4e3326ab90e0501d">ast_string_field_set</a>(details, resultstr, <span class="stringliteral">&quot;maxrate is less than minrate&quot;</span>);</div><div class="line"><a name="l02637"></a><span class="lineno"> 2637</span>&#160;      <a class="code" href="../../d0/d60/res__fax_8c.html#ad7732b5ae304d39afa2dacb20187cf04">set_channel_variables</a>(chan, details);</div><div class="line"><a name="l02638"></a><span class="lineno"> 2638</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;maxrate %u is less than minrate %u\n&quot;</span>, details-&gt;<a class="code" href="../../d8/dc2/structast__fax__session__details.html#a975b0a45868387d13867daeac314978a">maxrate</a>, details-&gt;<a class="code" href="../../d8/dc2/structast__fax__session__details.html#a8bff16fb9ab2254b86636f6fac166a66">minrate</a>);</div><div class="line"><a name="l02639"></a><span class="lineno"> 2639</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l02640"></a><span class="lineno"> 2640</span>&#160;   }</div><div class="line"><a name="l02641"></a><span class="lineno"> 2641</span>&#160;</div><div class="line"><a name="l02642"></a><span class="lineno"> 2642</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d0/d60/res__fax_8c.html#a693b0f3ff5d9020fe797cdc46e9489d4">check_modem_rate</a>(details-&gt;<a class="code" href="../../d8/dc2/structast__fax__session__details.html#a38b557eee45ee4c0d92d514c04823f84">modems</a>, details-&gt;<a class="code" href="../../d8/dc2/structast__fax__session__details.html#a8bff16fb9ab2254b86636f6fac166a66">minrate</a>)) {</div><div class="line"><a name="l02643"></a><span class="lineno"> 2643</span>&#160;      <a class="code" href="../../d0/d60/res__fax_8c.html#a9310358a6223a275dce64548ab625062">ast_fax_modem_to_str</a>(details-&gt;<a class="code" href="../../d8/dc2/structast__fax__session__details.html#a38b557eee45ee4c0d92d514c04823f84">modems</a>, modems, <span class="keyword">sizeof</span>(modems));</div><div class="line"><a name="l02644"></a><span class="lineno"> 2644</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;&#39;modems&#39; setting &#39;%s&#39; is incompatible with &#39;minrate&#39; setting %u\n&quot;</span>, modems, details-&gt;<a class="code" href="../../d8/dc2/structast__fax__session__details.html#a8bff16fb9ab2254b86636f6fac166a66">minrate</a>);</div><div class="line"><a name="l02645"></a><span class="lineno"> 2645</span>&#160;      <a class="code" href="../../d1/d0f/stringfields_8h.html#a653461abd6e0d16e4e3326ab90e0501d">ast_string_field_set</a>(details, <a class="code" href="../../d6/d47/utils_2frame_8c.html#a4a9391ee88e57361b613c4c2fd2bf4aa">error</a>, <span class="stringliteral">&quot;INVALID_ARGUMENTS&quot;</span>);</div><div class="line"><a name="l02646"></a><span class="lineno"> 2646</span>&#160;      <a class="code" href="../../d1/d0f/stringfields_8h.html#a653461abd6e0d16e4e3326ab90e0501d">ast_string_field_set</a>(details, resultstr, <span class="stringliteral">&quot;incompatible &#39;modems&#39; and &#39;minrate&#39; settings&quot;</span>);</div><div class="line"><a name="l02647"></a><span class="lineno"> 2647</span>&#160;      <a class="code" href="../../d0/d60/res__fax_8c.html#ad7732b5ae304d39afa2dacb20187cf04">set_channel_variables</a>(chan, details);</div><div class="line"><a name="l02648"></a><span class="lineno"> 2648</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l02649"></a><span class="lineno"> 2649</span>&#160;   }</div><div class="line"><a name="l02650"></a><span class="lineno"> 2650</span>&#160;</div><div class="line"><a name="l02651"></a><span class="lineno"> 2651</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d0/d60/res__fax_8c.html#a693b0f3ff5d9020fe797cdc46e9489d4">check_modem_rate</a>(details-&gt;<a class="code" href="../../d8/dc2/structast__fax__session__details.html#a38b557eee45ee4c0d92d514c04823f84">modems</a>, details-&gt;<a class="code" href="../../d8/dc2/structast__fax__session__details.html#a975b0a45868387d13867daeac314978a">maxrate</a>)) {</div><div class="line"><a name="l02652"></a><span class="lineno"> 2652</span>&#160;      <a class="code" href="../../d0/d60/res__fax_8c.html#a9310358a6223a275dce64548ab625062">ast_fax_modem_to_str</a>(details-&gt;<a class="code" href="../../d8/dc2/structast__fax__session__details.html#a38b557eee45ee4c0d92d514c04823f84">modems</a>, modems, <span class="keyword">sizeof</span>(modems));</div><div class="line"><a name="l02653"></a><span class="lineno"> 2653</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;&#39;modems&#39; setting &#39;%s&#39; is incompatible with &#39;maxrate&#39; setting %u\n&quot;</span>, modems, details-&gt;<a class="code" href="../../d8/dc2/structast__fax__session__details.html#a975b0a45868387d13867daeac314978a">maxrate</a>);</div><div class="line"><a name="l02654"></a><span class="lineno"> 2654</span>&#160;      <a class="code" href="../../d1/d0f/stringfields_8h.html#a653461abd6e0d16e4e3326ab90e0501d">ast_string_field_set</a>(details, <a class="code" href="../../d6/d47/utils_2frame_8c.html#a4a9391ee88e57361b613c4c2fd2bf4aa">error</a>, <span class="stringliteral">&quot;INVALID_ARGUMENTS&quot;</span>);</div><div class="line"><a name="l02655"></a><span class="lineno"> 2655</span>&#160;      <a class="code" href="../../d1/d0f/stringfields_8h.html#a653461abd6e0d16e4e3326ab90e0501d">ast_string_field_set</a>(details, resultstr, <span class="stringliteral">&quot;incompatible &#39;modems&#39; and &#39;maxrate&#39; settings&quot;</span>);</div><div class="line"><a name="l02656"></a><span class="lineno"> 2656</span>&#160;      <a class="code" href="../../d0/d60/res__fax_8c.html#ad7732b5ae304d39afa2dacb20187cf04">set_channel_variables</a>(chan, details);</div><div class="line"><a name="l02657"></a><span class="lineno"> 2657</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l02658"></a><span class="lineno"> 2658</span>&#160;   }</div><div class="line"><a name="l02659"></a><span class="lineno"> 2659</span>&#160;</div><div class="line"><a name="l02660"></a><span class="lineno"> 2660</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a>(data)) {</div><div class="line"><a name="l02661"></a><span class="lineno"> 2661</span>&#160;      <a class="code" href="../../d1/d0f/stringfields_8h.html#a653461abd6e0d16e4e3326ab90e0501d">ast_string_field_set</a>(details, <a class="code" href="../../d6/d47/utils_2frame_8c.html#a4a9391ee88e57361b613c4c2fd2bf4aa">error</a>, <span class="stringliteral">&quot;INVALID_ARGUMENTS&quot;</span>);</div><div class="line"><a name="l02662"></a><span class="lineno"> 2662</span>&#160;      <a class="code" href="../../d1/d0f/stringfields_8h.html#a653461abd6e0d16e4e3326ab90e0501d">ast_string_field_set</a>(details, resultstr, <span class="stringliteral">&quot;invalid arguments&quot;</span>);</div><div class="line"><a name="l02663"></a><span class="lineno"> 2663</span>&#160;      <a class="code" href="../../d0/d60/res__fax_8c.html#ad7732b5ae304d39afa2dacb20187cf04">set_channel_variables</a>(chan, details);</div><div class="line"><a name="l02664"></a><span class="lineno"> 2664</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;%s requires an argument (filename[&amp;filename[&amp;filename]][,options])\n&quot;</span>, <a class="code" href="../../d0/d60/res__fax_8c.html#a9029b2196b8587ea85bad4ac4b6174d7">app_sendfax</a>);</div><div class="line"><a name="l02665"></a><span class="lineno"> 2665</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l02666"></a><span class="lineno"> 2666</span>&#160;   }</div><div class="line"><a name="l02667"></a><span class="lineno"> 2667</span>&#160;   parse = <a class="code" href="../../d8/d8a/astmm_8h.html#ab5f0750cc80ba337fdcbddea2d3a1ee6">ast_strdupa</a>(data);</div><div class="line"><a name="l02668"></a><span class="lineno"> 2668</span>&#160;   <a class="code" href="../../d3/d93/include_2asterisk_2app_8h.html#ac08f7eb1eb9476b30987c73e1052ada8">AST_STANDARD_APP_ARGS</a>(<a class="code" href="../../d5/dde/test__func__file_8c.html#a7df83d295429a2562396f1ec127a46c0">args</a>, parse);</div><div class="line"><a name="l02669"></a><span class="lineno"> 2669</span>&#160;</div><div class="line"><a name="l02670"></a><span class="lineno"> 2670</span>&#160;</div><div class="line"><a name="l02671"></a><span class="lineno"> 2671</span>&#160;   <span class="keywordflow">if</span> (!<a class="code" href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a>(<a class="code" href="../../d5/dde/test__func__file_8c.html#a7df83d295429a2562396f1ec127a46c0">args</a>.options) &amp;&amp;</div><div class="line"><a name="l02672"></a><span class="lineno"> 2672</span>&#160;      <a class="code" href="../../d3/d93/include_2asterisk_2app_8h.html#af40039f1c49c16d0f6fa33fe9c43a0cb">ast_app_parse_options</a>(<a class="code" href="../../d0/d60/res__fax_8c.html#a2fccc15f81746e2ae5f88df9e88f3a7a">fax_exec_options</a>, &amp;opts, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../d5/dde/test__func__file_8c.html#a7df83d295429a2562396f1ec127a46c0">args</a>.options)) {</div><div class="line"><a name="l02673"></a><span class="lineno"> 2673</span>&#160;      <a class="code" href="../../d1/d0f/stringfields_8h.html#a653461abd6e0d16e4e3326ab90e0501d">ast_string_field_set</a>(details, <a class="code" href="../../d6/d47/utils_2frame_8c.html#a4a9391ee88e57361b613c4c2fd2bf4aa">error</a>, <span class="stringliteral">&quot;INVALID_ARGUMENTS&quot;</span>);</div><div class="line"><a name="l02674"></a><span class="lineno"> 2674</span>&#160;      <a class="code" href="../../d1/d0f/stringfields_8h.html#a653461abd6e0d16e4e3326ab90e0501d">ast_string_field_set</a>(details, resultstr, <span class="stringliteral">&quot;invalid arguments&quot;</span>);</div><div class="line"><a name="l02675"></a><span class="lineno"> 2675</span>&#160;      <a class="code" href="../../d0/d60/res__fax_8c.html#ad7732b5ae304d39afa2dacb20187cf04">set_channel_variables</a>(chan, details);</div><div class="line"><a name="l02676"></a><span class="lineno"> 2676</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l02677"></a><span class="lineno"> 2677</span>&#160;   }</div><div class="line"><a name="l02678"></a><span class="lineno"> 2678</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a>(<a class="code" href="../../d5/dde/test__func__file_8c.html#a7df83d295429a2562396f1ec127a46c0">args</a>.filenames)) {</div><div class="line"><a name="l02679"></a><span class="lineno"> 2679</span>&#160;      <a class="code" href="../../d1/d0f/stringfields_8h.html#a653461abd6e0d16e4e3326ab90e0501d">ast_string_field_set</a>(details, <a class="code" href="../../d6/d47/utils_2frame_8c.html#a4a9391ee88e57361b613c4c2fd2bf4aa">error</a>, <span class="stringliteral">&quot;INVALID_ARGUMENTS&quot;</span>);</div><div class="line"><a name="l02680"></a><span class="lineno"> 2680</span>&#160;      <a class="code" href="../../d1/d0f/stringfields_8h.html#a653461abd6e0d16e4e3326ab90e0501d">ast_string_field_set</a>(details, resultstr, <span class="stringliteral">&quot;invalid arguments&quot;</span>);</div><div class="line"><a name="l02681"></a><span class="lineno"> 2681</span>&#160;      <a class="code" href="../../d0/d60/res__fax_8c.html#ad7732b5ae304d39afa2dacb20187cf04">set_channel_variables</a>(chan, details);</div><div class="line"><a name="l02682"></a><span class="lineno"> 2682</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;%s requires an argument (filename[&amp;filename[&amp;filename]],options])\n&quot;</span>, <a class="code" href="../../d0/d60/res__fax_8c.html#a9029b2196b8587ea85bad4ac4b6174d7">app_sendfax</a>);</div><div class="line"><a name="l02683"></a><span class="lineno"> 2683</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l02684"></a><span class="lineno"> 2684</span>&#160;   }</div><div class="line"><a name="l02685"></a><span class="lineno"> 2685</span>&#160;</div><div class="line"><a name="l02686"></a><span class="lineno"> 2686</span>&#160;   <span class="comment">/* check for unsupported FAX application options */</span></div><div class="line"><a name="l02687"></a><span class="lineno"> 2687</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d5/d60/utils_8h.html#a00d4c9254c9827d6fa44f17a326744a5">ast_test_flag</a>(&amp;opts, <a class="code" href="../../d0/d60/res__fax_8c.html#a46275621a3d3846d089a092249fb8c37a8e81c5ccb5474dde66440f846fdfdd90">OPT_CALLERMODE</a>) || <a class="code" href="../../d5/d60/utils_8h.html#a00d4c9254c9827d6fa44f17a326744a5">ast_test_flag</a>(&amp;opts, <a class="code" href="../../d0/d60/res__fax_8c.html#a46275621a3d3846d089a092249fb8c37a2ffdf9172bc4ad9ae1ee477d90078ef0">OPT_CALLEDMODE</a>)) {</div><div class="line"><a name="l02688"></a><span class="lineno"> 2688</span>&#160;      <a class="code" href="../../d1/d0f/stringfields_8h.html#a653461abd6e0d16e4e3326ab90e0501d">ast_string_field_set</a>(details, <a class="code" href="../../d6/d47/utils_2frame_8c.html#a4a9391ee88e57361b613c4c2fd2bf4aa">error</a>, <span class="stringliteral">&quot;INVALID_ARGUMENTS&quot;</span>);</div><div class="line"><a name="l02689"></a><span class="lineno"> 2689</span>&#160;      <a class="code" href="../../d1/d0f/stringfields_8h.html#a653461abd6e0d16e4e3326ab90e0501d">ast_string_field_set</a>(details, resultstr, <span class="stringliteral">&quot;invalid arguments&quot;</span>);</div><div class="line"><a name="l02690"></a><span class="lineno"> 2690</span>&#160;      <a class="code" href="../../d0/d60/res__fax_8c.html#ad7732b5ae304d39afa2dacb20187cf04">set_channel_variables</a>(chan, details);</div><div class="line"><a name="l02691"></a><span class="lineno"> 2691</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;%s does not support polling\n&quot;</span>, <a class="code" href="../../d0/d60/res__fax_8c.html#a9029b2196b8587ea85bad4ac4b6174d7">app_sendfax</a>);</div><div class="line"><a name="l02692"></a><span class="lineno"> 2692</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l02693"></a><span class="lineno"> 2693</span>&#160;   }</div><div class="line"><a name="l02694"></a><span class="lineno"> 2694</span>&#160;</div><div class="line"><a name="l02695"></a><span class="lineno"> 2695</span>&#160;   <a class="code" href="../../dd/d42/lock_8h.html#a8a3bd496edfec04a95683ace66676200">ast_atomic_fetchadd_int</a>(&amp;<a class="code" href="../../d0/d60/res__fax_8c.html#a058b6772fcfe1ce5a1a0957e2f11d367">faxregistry</a>.fax_tx_attempts, 1);</div><div class="line"><a name="l02696"></a><span class="lineno"> 2696</span>&#160;</div><div class="line"><a name="l02697"></a><span class="lineno"> 2697</span>&#160;   file_count = 0;</div><div class="line"><a name="l02698"></a><span class="lineno"> 2698</span>&#160;   filenames = <a class="code" href="../../d5/dde/test__func__file_8c.html#a7df83d295429a2562396f1ec127a46c0">args</a>.filenames;</div><div class="line"><a name="l02699"></a><span class="lineno"> 2699</span>&#160;   <span class="keywordflow">while</span> ((c = <a class="code" href="../../de/da3/include_2asterisk_2compat_8h.html#a40eca58273c74a20a17f137d18ba826c">strsep</a>(&amp;filenames, <span class="stringliteral">&quot;&amp;&quot;</span>))) {</div><div class="line"><a name="l02700"></a><span class="lineno"> 2700</span>&#160;      <span class="keywordflow">if</span> (access(c, (F_OK | R_OK)) &lt; 0) {</div><div class="line"><a name="l02701"></a><span class="lineno"> 2701</span>&#160;         <a class="code" href="../../d1/d0f/stringfields_8h.html#a653461abd6e0d16e4e3326ab90e0501d">ast_string_field_set</a>(details, <a class="code" href="../../d6/d47/utils_2frame_8c.html#a4a9391ee88e57361b613c4c2fd2bf4aa">error</a>, <span class="stringliteral">&quot;FILE_ERROR&quot;</span>);</div><div class="line"><a name="l02702"></a><span class="lineno"> 2702</span>&#160;         <a class="code" href="../../d1/d0f/stringfields_8h.html#a653461abd6e0d16e4e3326ab90e0501d">ast_string_field_set</a>(details, resultstr, <span class="stringliteral">&quot;error reading file&quot;</span>);</div><div class="line"><a name="l02703"></a><span class="lineno"> 2703</span>&#160;         <a class="code" href="../../d0/d60/res__fax_8c.html#ad7732b5ae304d39afa2dacb20187cf04">set_channel_variables</a>(chan, details);</div><div class="line"><a name="l02704"></a><span class="lineno"> 2704</span>&#160;         <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;access failure.  Verify &#39;%s&#39; exists and check permissions.\n&quot;</span>, <a class="code" href="../../d5/dde/test__func__file_8c.html#a7df83d295429a2562396f1ec127a46c0">args</a>.filenames);</div><div class="line"><a name="l02705"></a><span class="lineno"> 2705</span>&#160;         <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l02706"></a><span class="lineno"> 2706</span>&#160;      }</div><div class="line"><a name="l02707"></a><span class="lineno"> 2707</span>&#160;</div><div class="line"><a name="l02708"></a><span class="lineno"> 2708</span>&#160;      <span class="keywordflow">if</span> (!(doc = <a class="code" href="../../d8/d8a/astmm_8h.html#ae0cd4c5524b01287ab19cbe233d9cebb">ast_calloc</a>(1, <span class="keyword">sizeof</span>(*doc) + strlen(c) + 1))) {</div><div class="line"><a name="l02709"></a><span class="lineno"> 2709</span>&#160;         <a class="code" href="../../d1/d0f/stringfields_8h.html#a653461abd6e0d16e4e3326ab90e0501d">ast_string_field_set</a>(details, <a class="code" href="../../d6/d47/utils_2frame_8c.html#a4a9391ee88e57361b613c4c2fd2bf4aa">error</a>, <span class="stringliteral">&quot;MEMORY_ERROR&quot;</span>);</div><div class="line"><a name="l02710"></a><span class="lineno"> 2710</span>&#160;         <a class="code" href="../../d1/d0f/stringfields_8h.html#a653461abd6e0d16e4e3326ab90e0501d">ast_string_field_set</a>(details, resultstr, <span class="stringliteral">&quot;error allocating memory&quot;</span>);</div><div class="line"><a name="l02711"></a><span class="lineno"> 2711</span>&#160;         <a class="code" href="../../d0/d60/res__fax_8c.html#ad7732b5ae304d39afa2dacb20187cf04">set_channel_variables</a>(chan, details);</div><div class="line"><a name="l02712"></a><span class="lineno"> 2712</span>&#160;         <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;System cannot provide memory for session requirements.\n&quot;</span>);</div><div class="line"><a name="l02713"></a><span class="lineno"> 2713</span>&#160;         <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l02714"></a><span class="lineno"> 2714</span>&#160;      }</div><div class="line"><a name="l02715"></a><span class="lineno"> 2715</span>&#160;</div><div class="line"><a name="l02716"></a><span class="lineno"> 2716</span>&#160;      strcpy(doc-&gt;<a class="code" href="../../d2/db8/structast__fax__document.html#afae8c108f5d360038fa8b099eb4ab2f3">filename</a>, c);</div><div class="line"><a name="l02717"></a><span class="lineno"> 2717</span>&#160;      <a class="code" href="../../df/d90/linkedlists_8h.html#a4d258b4525e63c435d7de579d3f46960">AST_LIST_INSERT_TAIL</a>(&amp;details-&gt;<a class="code" href="../../d8/dc2/structast__fax__session__details.html#a14c20eed7d6d03b484ebc2cc7a447ea2">documents</a>, doc, next);</div><div class="line"><a name="l02718"></a><span class="lineno"> 2718</span>&#160;      file_count++;</div><div class="line"><a name="l02719"></a><span class="lineno"> 2719</span>&#160;   }</div><div class="line"><a name="l02720"></a><span class="lineno"> 2720</span>&#160;</div><div class="line"><a name="l02721"></a><span class="lineno"> 2721</span>&#160;   <a class="code" href="../../d1/d8c/logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(3, <span class="stringliteral">&quot;Channel &#39;%s&#39; sending FAX:\n&quot;</span>, <a class="code" href="../../d5/d7b/channel_8h.html#a7ca2fda13b129a55c251b56729de285b">ast_channel_name</a>(chan));</div><div class="line"><a name="l02722"></a><span class="lineno"> 2722</span>&#160;   <a class="code" href="../../df/d90/linkedlists_8h.html#a3008b2f4f236b72d8bcfb80e346324ef">AST_LIST_TRAVERSE</a>(&amp;details-&gt;<a class="code" href="../../d8/dc2/structast__fax__session__details.html#a14c20eed7d6d03b484ebc2cc7a447ea2">documents</a>, doc, next) {</div><div class="line"><a name="l02723"></a><span class="lineno"> 2723</span>&#160;      <a class="code" href="../../d1/d8c/logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(3, <span class="stringliteral">&quot;   %s\n&quot;</span>, doc-&gt;<a class="code" href="../../d2/db8/structast__fax__document.html#afae8c108f5d360038fa8b099eb4ab2f3">filename</a>);</div><div class="line"><a name="l02724"></a><span class="lineno"> 2724</span>&#160;   }</div><div class="line"><a name="l02725"></a><span class="lineno"> 2725</span>&#160;</div><div class="line"><a name="l02726"></a><span class="lineno"> 2726</span>&#160;   details-&gt;<a class="code" href="../../d8/dc2/structast__fax__session__details.html#ad75375cdd336e91cbcee4a829fcdabfe">caps</a> = <a class="code" href="../../db/d6a/res__fax_8h.html#a54eb45ad548b874cf12d0a599631e3f6adbf07d8224b1a548ccae3b994653003b">AST_FAX_TECH_SEND</a>;</div><div class="line"><a name="l02727"></a><span class="lineno"> 2727</span>&#160;</div><div class="line"><a name="l02728"></a><span class="lineno"> 2728</span>&#160;   <span class="keywordflow">if</span> (file_count &gt; 1) {</div><div class="line"><a name="l02729"></a><span class="lineno"> 2729</span>&#160;      details-&gt;<a class="code" href="../../d8/dc2/structast__fax__session__details.html#ad75375cdd336e91cbcee4a829fcdabfe">caps</a> |= <a class="code" href="../../db/d6a/res__fax_8h.html#a54eb45ad548b874cf12d0a599631e3f6a9f71e042b26b9d7b671a3771bef6db64">AST_FAX_TECH_MULTI_DOC</a>;</div><div class="line"><a name="l02730"></a><span class="lineno"> 2730</span>&#160;   }</div><div class="line"><a name="l02731"></a><span class="lineno"> 2731</span>&#160;</div><div class="line"><a name="l02732"></a><span class="lineno"> 2732</span>&#160;   <span class="comment">/* check for debug */</span></div><div class="line"><a name="l02733"></a><span class="lineno"> 2733</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d5/d60/utils_8h.html#a00d4c9254c9827d6fa44f17a326744a5">ast_test_flag</a>(&amp;opts, <a class="code" href="../../d0/d60/res__fax_8c.html#a46275621a3d3846d089a092249fb8c37ae18c66c85f5c325308846289886981d7">OPT_DEBUG</a>) || <a class="code" href="../../d0/d60/res__fax_8c.html#afb6be9ca0b6c0d09211b5c4e55fa2291">global_fax_debug</a>) {</div><div class="line"><a name="l02734"></a><span class="lineno"> 2734</span>&#160;      details-&gt;<a class="code" href="../../d8/dc2/structast__fax__session__details.html#a3ab211dbe8780b7292257f6b3dba1952">option</a>.<a class="code" href="../../d8/dc2/structast__fax__session__details.html#a84360ac08d9be11f221466122d8cdc65">debug</a> = <a class="code" href="../../db/d6a/res__fax_8h.html#a1838c71fcf68c3cfe0ce37e35e77406dabd9b4a57405ba5c0c884ac98746a8bd7">AST_FAX_OPTFLAG_TRUE</a>;</div><div class="line"><a name="l02735"></a><span class="lineno"> 2735</span>&#160;   }</div><div class="line"><a name="l02736"></a><span class="lineno"> 2736</span>&#160;</div><div class="line"><a name="l02737"></a><span class="lineno"> 2737</span>&#160;   <span class="comment">/* check for request for status events */</span></div><div class="line"><a name="l02738"></a><span class="lineno"> 2738</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d5/d60/utils_8h.html#a00d4c9254c9827d6fa44f17a326744a5">ast_test_flag</a>(&amp;opts, <a class="code" href="../../d0/d60/res__fax_8c.html#a46275621a3d3846d089a092249fb8c37ac50e4902aa670a5a0ad1927d8fef741a">OPT_STATUS</a>)) {</div><div class="line"><a name="l02739"></a><span class="lineno"> 2739</span>&#160;      details-&gt;<a class="code" href="../../d8/dc2/structast__fax__session__details.html#a3ab211dbe8780b7292257f6b3dba1952">option</a>.<a class="code" href="../../d8/dc2/structast__fax__session__details.html#a7f633c7bc4fe667e873649afa4d44640">statusevents</a> = <a class="code" href="../../db/d6a/res__fax_8h.html#a1838c71fcf68c3cfe0ce37e35e77406dabd9b4a57405ba5c0c884ac98746a8bd7">AST_FAX_OPTFLAG_TRUE</a>;</div><div class="line"><a name="l02740"></a><span class="lineno"> 2740</span>&#160;   }</div><div class="line"><a name="l02741"></a><span class="lineno"> 2741</span>&#160;</div><div class="line"><a name="l02742"></a><span class="lineno"> 2742</span>&#160;   t38state = <a class="code" href="../../d5/d7b/channel_8h.html#a1b22ea5302ef183fa68bc45bfb0659c9">ast_channel_get_t38_state</a>(chan);</div><div class="line"><a name="l02743"></a><span class="lineno"> 2743</span>&#160;   <span class="keywordflow">if</span> ((t38state == <a class="code" href="../../d5/d7b/channel_8h.html#a4cd990f4c1cd0c2af6e4c63f6d15b4e1a8bd9e539fb6a17b095fb24a75e0b4d21">T38_STATE_UNAVAILABLE</a>) || (t38state == <a class="code" href="../../d5/d7b/channel_8h.html#a4cd990f4c1cd0c2af6e4c63f6d15b4e1ad3745918c0830d3816e5ce5561814e7e">T38_STATE_REJECTED</a>) ||</div><div class="line"><a name="l02744"></a><span class="lineno"> 2744</span>&#160;       <a class="code" href="../../d5/d60/utils_8h.html#a00d4c9254c9827d6fa44f17a326744a5">ast_test_flag</a>(&amp;opts, <a class="code" href="../../d0/d60/res__fax_8c.html#a46275621a3d3846d089a092249fb8c37a98a16270534ab6ed19ac7935f6ab5730">OPT_ALLOWAUDIO</a>) ||</div><div class="line"><a name="l02745"></a><span class="lineno"> 2745</span>&#160;       <a class="code" href="../../d5/d60/utils_8h.html#a00d4c9254c9827d6fa44f17a326744a5">ast_test_flag</a>(&amp;opts, <a class="code" href="../../d0/d60/res__fax_8c.html#a46275621a3d3846d089a092249fb8c37a87052b571961ef8c1192a196d329ea1d">OPT_FORCE_AUDIO</a>)) {</div><div class="line"><a name="l02746"></a><span class="lineno"> 2746</span>&#160;      details-&gt;<a class="code" href="../../d8/dc2/structast__fax__session__details.html#a3ab211dbe8780b7292257f6b3dba1952">option</a>.<a class="code" href="../../d8/dc2/structast__fax__session__details.html#a2bdd8d6f48911b41e094440799e00bd2">allow_audio</a> = <a class="code" href="../../db/d6a/res__fax_8h.html#a1838c71fcf68c3cfe0ce37e35e77406dabd9b4a57405ba5c0c884ac98746a8bd7">AST_FAX_OPTFLAG_TRUE</a>;</div><div class="line"><a name="l02747"></a><span class="lineno"> 2747</span>&#160;   }</div><div class="line"><a name="l02748"></a><span class="lineno"> 2748</span>&#160;</div><div class="line"><a name="l02749"></a><span class="lineno"> 2749</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d5/d60/utils_8h.html#a00d4c9254c9827d6fa44f17a326744a5">ast_test_flag</a>(&amp;opts, <a class="code" href="../../d0/d60/res__fax_8c.html#a46275621a3d3846d089a092249fb8c37a580250f89769e79e089f734549526a37">OPT_REQUEST_T38</a>)) {</div><div class="line"><a name="l02750"></a><span class="lineno"> 2750</span>&#160;      details-&gt;<a class="code" href="../../d8/dc2/structast__fax__session__details.html#a3ab211dbe8780b7292257f6b3dba1952">option</a>.<a class="code" href="../../d8/dc2/structast__fax__session__details.html#a9f26ae9d27415acd75d11e5cf606dd92">request_t38</a> = <a class="code" href="../../db/d6a/res__fax_8h.html#a1838c71fcf68c3cfe0ce37e35e77406dabd9b4a57405ba5c0c884ac98746a8bd7">AST_FAX_OPTFLAG_TRUE</a>;</div><div class="line"><a name="l02751"></a><span class="lineno"> 2751</span>&#160;   }</div><div class="line"><a name="l02752"></a><span class="lineno"> 2752</span>&#160;</div><div class="line"><a name="l02753"></a><span class="lineno"> 2753</span>&#160;   <span class="keywordflow">if</span> (!(s = <a class="code" href="../../d0/d60/res__fax_8c.html#aa71e4f978e47d124ee1f87b340fdfb78">fax_session_reserve</a>(details, &amp;token))) {</div><div class="line"><a name="l02754"></a><span class="lineno"> 2754</span>&#160;      <a class="code" href="../../d1/d0f/stringfields_8h.html#a653461abd6e0d16e4e3326ab90e0501d">ast_string_field_set</a>(details, resultstr, <span class="stringliteral">&quot;error reserving fax session&quot;</span>);</div><div class="line"><a name="l02755"></a><span class="lineno"> 2755</span>&#160;      <a class="code" href="../../d0/d60/res__fax_8c.html#ad7732b5ae304d39afa2dacb20187cf04">set_channel_variables</a>(chan, details);</div><div class="line"><a name="l02756"></a><span class="lineno"> 2756</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Unable to reserve FAX session.\n&quot;</span>);</div><div class="line"><a name="l02757"></a><span class="lineno"> 2757</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l02758"></a><span class="lineno"> 2758</span>&#160;   }</div><div class="line"><a name="l02759"></a><span class="lineno"> 2759</span>&#160;</div><div class="line"><a name="l02760"></a><span class="lineno"> 2760</span>&#160;   <span class="comment">/* make sure the channel is up */</span></div><div class="line"><a name="l02761"></a><span class="lineno"> 2761</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d9/d95/channelstate_8h.html#a03585bc87e5bbd0f4d11bc789734c660">ast_channel_state</a>(chan) != <a class="code" href="../../d9/d95/channelstate_8h.html#a03585bc87e5bbd0f4d11bc789734c660aa8ab4bcda7378ccc17c39dfd880cba3d">AST_STATE_UP</a>) {</div><div class="line"><a name="l02762"></a><span class="lineno"> 2762</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="../../d5/d7b/channel_8h.html#aec583a3e25358ee552a4f3df53914cd0">ast_answer</a>(chan)) {</div><div class="line"><a name="l02763"></a><span class="lineno"> 2763</span>&#160;         <a class="code" href="../../d1/d0f/stringfields_8h.html#a653461abd6e0d16e4e3326ab90e0501d">ast_string_field_set</a>(details, resultstr, <span class="stringliteral">&quot;error answering channel&quot;</span>);</div><div class="line"><a name="l02764"></a><span class="lineno"> 2764</span>&#160;         <a class="code" href="../../d0/d60/res__fax_8c.html#ad7732b5ae304d39afa2dacb20187cf04">set_channel_variables</a>(chan, details);</div><div class="line"><a name="l02765"></a><span class="lineno"> 2765</span>&#160;         <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Channel &#39;%s&#39; failed answer attempt.\n&quot;</span>, <a class="code" href="../../d5/d7b/channel_8h.html#a7ca2fda13b129a55c251b56729de285b">ast_channel_name</a>(chan));</div><div class="line"><a name="l02766"></a><span class="lineno"> 2766</span>&#160;         <a class="code" href="../../d0/d60/res__fax_8c.html#a049f9f29f5e7c99af20888026f84c5c1">fax_session_release</a>(s, token);</div><div class="line"><a name="l02767"></a><span class="lineno"> 2767</span>&#160;         <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l02768"></a><span class="lineno"> 2768</span>&#160;      }</div><div class="line"><a name="l02769"></a><span class="lineno"> 2769</span>&#160;   }</div><div class="line"><a name="l02770"></a><span class="lineno"> 2770</span>&#160;</div><div class="line"><a name="l02771"></a><span class="lineno"> 2771</span>&#160;   <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d60/utils_8h.html#a00d4c9254c9827d6fa44f17a326744a5">ast_test_flag</a>(&amp;opts, <a class="code" href="../../d0/d60/res__fax_8c.html#a46275621a3d3846d089a092249fb8c37a87052b571961ef8c1192a196d329ea1d">OPT_FORCE_AUDIO</a>)) {</div><div class="line"><a name="l02772"></a><span class="lineno"> 2772</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="../../d0/d60/res__fax_8c.html#abadd563fd124df50869cc1bdebf712be">set_fax_t38_caps</a>(chan, details)) {</div><div class="line"><a name="l02773"></a><span class="lineno"> 2773</span>&#160;         <a class="code" href="../../d1/d0f/stringfields_8h.html#a653461abd6e0d16e4e3326ab90e0501d">ast_string_field_set</a>(details, <a class="code" href="../../d6/d47/utils_2frame_8c.html#a4a9391ee88e57361b613c4c2fd2bf4aa">error</a>, <span class="stringliteral">&quot;T38_NEG_ERROR&quot;</span>);</div><div class="line"><a name="l02774"></a><span class="lineno"> 2774</span>&#160;         <a class="code" href="../../d1/d0f/stringfields_8h.html#a653461abd6e0d16e4e3326ab90e0501d">ast_string_field_set</a>(details, resultstr, <span class="stringliteral">&quot;error negotiating T.38&quot;</span>);</div><div class="line"><a name="l02775"></a><span class="lineno"> 2775</span>&#160;         <a class="code" href="../../d0/d60/res__fax_8c.html#ad7732b5ae304d39afa2dacb20187cf04">set_channel_variables</a>(chan, details);</div><div class="line"><a name="l02776"></a><span class="lineno"> 2776</span>&#160;         <a class="code" href="../../d0/d60/res__fax_8c.html#a049f9f29f5e7c99af20888026f84c5c1">fax_session_release</a>(s, token);</div><div class="line"><a name="l02777"></a><span class="lineno"> 2777</span>&#160;         <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l02778"></a><span class="lineno"> 2778</span>&#160;      }</div><div class="line"><a name="l02779"></a><span class="lineno"> 2779</span>&#160;   } <span class="keywordflow">else</span> {</div><div class="line"><a name="l02780"></a><span class="lineno"> 2780</span>&#160;      details-&gt;<a class="code" href="../../d8/dc2/structast__fax__session__details.html#ad75375cdd336e91cbcee4a829fcdabfe">caps</a> |= <a class="code" href="../../db/d6a/res__fax_8h.html#a54eb45ad548b874cf12d0a599631e3f6a76fa4111df51955a949e95fadbccd48b">AST_FAX_TECH_AUDIO</a>;</div><div class="line"><a name="l02781"></a><span class="lineno"> 2781</span>&#160;   }</div><div class="line"><a name="l02782"></a><span class="lineno"> 2782</span>&#160;</div><div class="line"><a name="l02783"></a><span class="lineno"> 2783</span>&#160;   <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d60/utils_8h.html#a00d4c9254c9827d6fa44f17a326744a5">ast_test_flag</a>(&amp;opts, <a class="code" href="../../d0/d60/res__fax_8c.html#a46275621a3d3846d089a092249fb8c37a87052b571961ef8c1192a196d329ea1d">OPT_FORCE_AUDIO</a>) &amp;&amp; (details-&gt;<a class="code" href="../../d8/dc2/structast__fax__session__details.html#ad75375cdd336e91cbcee4a829fcdabfe">caps</a> &amp; <a class="code" href="../../db/d6a/res__fax_8h.html#a54eb45ad548b874cf12d0a599631e3f6a6868445e2802e5b71068ae883366f635">AST_FAX_TECH_T38</a>)) {</div><div class="line"><a name="l02784"></a><span class="lineno"> 2784</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="../../d0/d60/res__fax_8c.html#ac4e0560b06c338fc643710d3dc6bc6f7">sendfax_t38_init</a>(chan, details)) {</div><div class="line"><a name="l02785"></a><span class="lineno"> 2785</span>&#160;         <a class="code" href="../../d1/d0f/stringfields_8h.html#a653461abd6e0d16e4e3326ab90e0501d">ast_string_field_set</a>(details, <a class="code" href="../../d6/d47/utils_2frame_8c.html#a4a9391ee88e57361b613c4c2fd2bf4aa">error</a>, <span class="stringliteral">&quot;T38_NEG_ERROR&quot;</span>);</div><div class="line"><a name="l02786"></a><span class="lineno"> 2786</span>&#160;         <a class="code" href="../../d1/d0f/stringfields_8h.html#a653461abd6e0d16e4e3326ab90e0501d">ast_string_field_set</a>(details, resultstr, <span class="stringliteral">&quot;error negotiating T.38&quot;</span>);</div><div class="line"><a name="l02787"></a><span class="lineno"> 2787</span>&#160;         <a class="code" href="../../d0/d60/res__fax_8c.html#ad7732b5ae304d39afa2dacb20187cf04">set_channel_variables</a>(chan, details);</div><div class="line"><a name="l02788"></a><span class="lineno"> 2788</span>&#160;         <a class="code" href="../../d0/d60/res__fax_8c.html#a049f9f29f5e7c99af20888026f84c5c1">fax_session_release</a>(s, token);</div><div class="line"><a name="l02789"></a><span class="lineno"> 2789</span>&#160;         <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;error initializing channel &#39;%s&#39; in T.38 mode\n&quot;</span>, <a class="code" href="../../d5/d7b/channel_8h.html#a7ca2fda13b129a55c251b56729de285b">ast_channel_name</a>(chan));</div><div class="line"><a name="l02790"></a><span class="lineno"> 2790</span>&#160;         <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l02791"></a><span class="lineno"> 2791</span>&#160;      }</div><div class="line"><a name="l02792"></a><span class="lineno"> 2792</span>&#160;   } <span class="keywordflow">else</span> {</div><div class="line"><a name="l02793"></a><span class="lineno"> 2793</span>&#160;      details-&gt;<a class="code" href="../../d8/dc2/structast__fax__session__details.html#a3ab211dbe8780b7292257f6b3dba1952">option</a>.<a class="code" href="../../d8/dc2/structast__fax__session__details.html#ad3795f2a4b1e30b36f642bdcc0ec4586">send_cng</a> = 1;</div><div class="line"><a name="l02794"></a><span class="lineno"> 2794</span>&#160;   }</div><div class="line"><a name="l02795"></a><span class="lineno"> 2795</span>&#160;</div><div class="line"><a name="l02796"></a><span class="lineno"> 2796</span>&#160;   <span class="keywordflow">if</span> ((channel_alive = <a class="code" href="../../d0/d60/res__fax_8c.html#a779e8d2cf3518f35900b9089a2c344ec">generic_fax_exec</a>(chan, details, s, token)) &lt; 0) {</div><div class="line"><a name="l02797"></a><span class="lineno"> 2797</span>&#160;      <a class="code" href="../../dd/d42/lock_8h.html#a8a3bd496edfec04a95683ace66676200">ast_atomic_fetchadd_int</a>(&amp;<a class="code" href="../../d0/d60/res__fax_8c.html#a058b6772fcfe1ce5a1a0957e2f11d367">faxregistry</a>.fax_failures, 1);</div><div class="line"><a name="l02798"></a><span class="lineno"> 2798</span>&#160;   }</div><div class="line"><a name="l02799"></a><span class="lineno"> 2799</span>&#160;</div><div class="line"><a name="l02800"></a><span class="lineno"> 2800</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d5/d7b/channel_8h.html#a1b22ea5302ef183fa68bc45bfb0659c9">ast_channel_get_t38_state</a>(chan) == <a class="code" href="../../d5/d7b/channel_8h.html#a4cd990f4c1cd0c2af6e4c63f6d15b4e1af142c79721a025bd65edad812f0725e0">T38_STATE_NEGOTIATED</a>) {</div><div class="line"><a name="l02801"></a><span class="lineno"> 2801</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="../../d0/d60/res__fax_8c.html#ae3ee13924d0059d65a340212b5117a48">disable_t38</a>(chan)) {</div><div class="line"><a name="l02802"></a><span class="lineno"> 2802</span>&#160;         <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(1, <span class="stringliteral">&quot;error disabling T.38 mode on %s\n&quot;</span>, <a class="code" href="../../d5/d7b/channel_8h.html#a7ca2fda13b129a55c251b56729de285b">ast_channel_name</a>(chan));</div><div class="line"><a name="l02803"></a><span class="lineno"> 2803</span>&#160;      }</div><div class="line"><a name="l02804"></a><span class="lineno"> 2804</span>&#160;   }</div><div class="line"><a name="l02805"></a><span class="lineno"> 2805</span>&#160;</div><div class="line"><a name="l02806"></a><span class="lineno"> 2806</span>&#160;   <span class="keywordflow">if</span> (!(filenames = <a class="code" href="../../d0/d60/res__fax_8c.html#aea322d9ee9a565a0f53e6fa1f1f34e66">generate_filenames_string</a>(details, <span class="stringliteral">&quot;FileName: &quot;</span>, <span class="stringliteral">&quot;\r\n&quot;</span>))) {</div><div class="line"><a name="l02807"></a><span class="lineno"> 2807</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Error generating SendFAX manager event\n&quot;</span>);</div><div class="line"><a name="l02808"></a><span class="lineno"> 2808</span>&#160;      <span class="keywordflow">return</span> (!channel_alive) ? -1 : 0;</div><div class="line"><a name="l02809"></a><span class="lineno"> 2809</span>&#160;   }</div><div class="line"><a name="l02810"></a><span class="lineno"> 2810</span>&#160;</div><div class="line"><a name="l02811"></a><span class="lineno"> 2811</span>&#160;   <span class="comment">/* send out the AMI completion event */</span></div><div class="line"><a name="l02812"></a><span class="lineno"> 2812</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d0/d60/res__fax_8c.html#afd17b7bdd81198a94df9503cc9f10291">report_send_fax_status</a>(chan, details)) {</div><div class="line"><a name="l02813"></a><span class="lineno"> 2813</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#a2fdd5bff193a29ec6c7278da2851ea56">AST_LOG_ERROR</a>, <span class="stringliteral">&quot;Error publishing SendFAX status message\n&quot;</span>);</div><div class="line"><a name="l02814"></a><span class="lineno"> 2814</span>&#160;   }</div><div class="line"><a name="l02815"></a><span class="lineno"> 2815</span>&#160;</div><div class="line"><a name="l02816"></a><span class="lineno"> 2816</span>&#160;   <span class="comment">/* If the channel hungup return -1; otherwise, return 0 to continue in the dialplan */</span></div><div class="line"><a name="l02817"></a><span class="lineno"> 2817</span>&#160;   <span class="keywordflow">return</span> (!channel_alive) ? -1 : 0;</div><div class="line"><a name="l02818"></a><span class="lineno"> 2818</span>&#160;}</div><div class="line"><a name="l02819"></a><span class="lineno"> 2819</span>&#160;<span class="comment"></span></div><div class="line"><a name="l02820"></a><span class="lineno"> 2820</span>&#160;<span class="comment">/*! \brief destroy the v21 detection parts of a fax gateway session */</span></div><div class="line"><a name="l02821"></a><span class="lineno"><a class="line" href="../../d0/d60/res__fax_8c.html#a3d942985befce033fb70506848199758"> 2821</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d0/d60/res__fax_8c.html#a3d942985befce033fb70506848199758">destroy_v21_sessions</a>(<span class="keyword">struct</span> <a class="code" href="../../dd/dd2/structfax__gateway.html">fax_gateway</a> *gateway)</div><div class="line"><a name="l02822"></a><span class="lineno"> 2822</span>&#160;{</div><div class="line"><a name="l02823"></a><span class="lineno"> 2823</span>&#160;   <span class="keywordflow">if</span> (gateway-&gt;<a class="code" href="../../dd/dd2/structfax__gateway.html#a8bb543c7fdbaf19b5a07e0154727228d">chan_v21_session</a>) {</div><div class="line"><a name="l02824"></a><span class="lineno"> 2824</span>&#160;      <a class="code" href="../../d5/da5/astobj2_8h.html#a64f51be4bee35c38dbe59b0a788b5ce8">ao2_unlink</a>(<a class="code" href="../../d0/d60/res__fax_8c.html#a058b6772fcfe1ce5a1a0957e2f11d367">faxregistry</a>.container, gateway-&gt;<a class="code" href="../../dd/dd2/structfax__gateway.html#a8bb543c7fdbaf19b5a07e0154727228d">chan_v21_session</a>);</div><div class="line"><a name="l02825"></a><span class="lineno"> 2825</span>&#160;</div><div class="line"><a name="l02826"></a><span class="lineno"> 2826</span>&#160;      <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(gateway-&gt;<a class="code" href="../../dd/dd2/structfax__gateway.html#a8bb543c7fdbaf19b5a07e0154727228d">chan_v21_session</a>, -1);</div><div class="line"><a name="l02827"></a><span class="lineno"> 2827</span>&#160;      gateway-&gt;<a class="code" href="../../dd/dd2/structfax__gateway.html#a8bb543c7fdbaf19b5a07e0154727228d">chan_v21_session</a> = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l02828"></a><span class="lineno"> 2828</span>&#160;   }</div><div class="line"><a name="l02829"></a><span class="lineno"> 2829</span>&#160;</div><div class="line"><a name="l02830"></a><span class="lineno"> 2830</span>&#160;   <span class="keywordflow">if</span> (gateway-&gt;<a class="code" href="../../dd/dd2/structfax__gateway.html#a08eb33d553223ed90af3397a850b3af1">peer_v21_session</a>) {</div><div class="line"><a name="l02831"></a><span class="lineno"> 2831</span>&#160;      <a class="code" href="../../d5/da5/astobj2_8h.html#a64f51be4bee35c38dbe59b0a788b5ce8">ao2_unlink</a>(<a class="code" href="../../d0/d60/res__fax_8c.html#a058b6772fcfe1ce5a1a0957e2f11d367">faxregistry</a>.container, gateway-&gt;<a class="code" href="../../dd/dd2/structfax__gateway.html#a08eb33d553223ed90af3397a850b3af1">peer_v21_session</a>);</div><div class="line"><a name="l02832"></a><span class="lineno"> 2832</span>&#160;</div><div class="line"><a name="l02833"></a><span class="lineno"> 2833</span>&#160;      <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(gateway-&gt;<a class="code" href="../../dd/dd2/structfax__gateway.html#a08eb33d553223ed90af3397a850b3af1">peer_v21_session</a>, -1);</div><div class="line"><a name="l02834"></a><span class="lineno"> 2834</span>&#160;      gateway-&gt;<a class="code" href="../../dd/dd2/structfax__gateway.html#a08eb33d553223ed90af3397a850b3af1">peer_v21_session</a> = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l02835"></a><span class="lineno"> 2835</span>&#160;   }</div><div class="line"><a name="l02836"></a><span class="lineno"> 2836</span>&#160;}</div><div class="line"><a name="l02837"></a><span class="lineno"> 2837</span>&#160;<span class="comment"></span></div><div class="line"><a name="l02838"></a><span class="lineno"> 2838</span>&#160;<span class="comment">/*! \brief destroy a FAX gateway session structure */</span></div><div class="line"><a name="l02839"></a><span class="lineno"><a class="line" href="../../d0/d60/res__fax_8c.html#a387384e096d0670b954f14891a26be61"> 2839</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d0/d60/res__fax_8c.html#a387384e096d0670b954f14891a26be61">destroy_gateway</a>(<span class="keywordtype">void</span> *data)</div><div class="line"><a name="l02840"></a><span class="lineno"> 2840</span>&#160;{</div><div class="line"><a name="l02841"></a><span class="lineno"> 2841</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../dd/dd2/structfax__gateway.html">fax_gateway</a> *gateway = data;</div><div class="line"><a name="l02842"></a><span class="lineno"> 2842</span>&#160;</div><div class="line"><a name="l02843"></a><span class="lineno"> 2843</span>&#160;   <a class="code" href="../../d0/d60/res__fax_8c.html#a3d942985befce033fb70506848199758">destroy_v21_sessions</a>(gateway);</div><div class="line"><a name="l02844"></a><span class="lineno"> 2844</span>&#160;</div><div class="line"><a name="l02845"></a><span class="lineno"> 2845</span>&#160;   <span class="keywordflow">if</span> (gateway-&gt;<a class="code" href="../../dd/dd2/structfax__gateway.html#acf7d6ff8498e4c50ee13ac0711210c72">s</a>) {</div><div class="line"><a name="l02846"></a><span class="lineno"> 2846</span>&#160;      <a class="code" href="../../d0/d60/res__fax_8c.html#a049f9f29f5e7c99af20888026f84c5c1">fax_session_release</a>(gateway-&gt;<a class="code" href="../../dd/dd2/structfax__gateway.html#acf7d6ff8498e4c50ee13ac0711210c72">s</a>, gateway-&gt;<a class="code" href="../../dd/dd2/structfax__gateway.html#aed7ead71b14c348cd4a72ffbced30989">token</a>);</div><div class="line"><a name="l02847"></a><span class="lineno"> 2847</span>&#160;      gateway-&gt;<a class="code" href="../../dd/dd2/structfax__gateway.html#aed7ead71b14c348cd4a72ffbced30989">token</a> = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l02848"></a><span class="lineno"> 2848</span>&#160;</div><div class="line"><a name="l02849"></a><span class="lineno"> 2849</span>&#160;      <a class="code" href="../../d5/da5/astobj2_8h.html#a64f51be4bee35c38dbe59b0a788b5ce8">ao2_unlink</a>(<a class="code" href="../../d0/d60/res__fax_8c.html#a058b6772fcfe1ce5a1a0957e2f11d367">faxregistry</a>.container, gateway-&gt;<a class="code" href="../../dd/dd2/structfax__gateway.html#acf7d6ff8498e4c50ee13ac0711210c72">s</a>);</div><div class="line"><a name="l02850"></a><span class="lineno"> 2850</span>&#160;</div><div class="line"><a name="l02851"></a><span class="lineno"> 2851</span>&#160;      <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(gateway-&gt;<a class="code" href="../../dd/dd2/structfax__gateway.html#acf7d6ff8498e4c50ee13ac0711210c72">s</a>, -1);</div><div class="line"><a name="l02852"></a><span class="lineno"> 2852</span>&#160;      gateway-&gt;<a class="code" href="../../dd/dd2/structfax__gateway.html#acf7d6ff8498e4c50ee13ac0711210c72">s</a> = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l02853"></a><span class="lineno"> 2853</span>&#160;   }</div><div class="line"><a name="l02854"></a><span class="lineno"> 2854</span>&#160;</div><div class="line"><a name="l02855"></a><span class="lineno"> 2855</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#a6321ee982370c55ab3c24c72c562cbdd">ao2_cleanup</a>(gateway-&gt;<a class="code" href="../../dd/dd2/structfax__gateway.html#a59e020b75f0a03b00bfad6332fa53b9e">chan_read_format</a>);</div><div class="line"><a name="l02856"></a><span class="lineno"> 2856</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#a6321ee982370c55ab3c24c72c562cbdd">ao2_cleanup</a>(gateway-&gt;<a class="code" href="../../dd/dd2/structfax__gateway.html#a6157ce6a6b99804070b09723d9dcf05d">chan_write_format</a>);</div><div class="line"><a name="l02857"></a><span class="lineno"> 2857</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#a6321ee982370c55ab3c24c72c562cbdd">ao2_cleanup</a>(gateway-&gt;<a class="code" href="../../dd/dd2/structfax__gateway.html#ac11fd22af311685dee2ccb296221cc86">peer_read_format</a>);</div><div class="line"><a name="l02858"></a><span class="lineno"> 2858</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#a6321ee982370c55ab3c24c72c562cbdd">ao2_cleanup</a>(gateway-&gt;<a class="code" href="../../dd/dd2/structfax__gateway.html#a997059bcc0230f25cde254408e405d02">peer_write_format</a>);</div><div class="line"><a name="l02859"></a><span class="lineno"> 2859</span>&#160;}</div><div class="line"><a name="l02860"></a><span class="lineno"> 2860</span>&#160;</div><div class="line"><a name="l02861"></a><span class="lineno"><a class="line" href="../../d0/d60/res__fax_8c.html#a563b007e45c3114b00faab5a9577fda1"> 2861</a></span>&#160;<span class="keyword">static</span> <span class="keyword">struct </span><a class="code" href="../../d1/d16/structast__fax__session.html">ast_fax_session</a> *<a class="code" href="../../d0/d60/res__fax_8c.html#a563b007e45c3114b00faab5a9577fda1">fax_v21_session_new</a> (<span class="keyword">struct</span> <a class="code" href="../../df/d3c/structast__channel.html">ast_channel</a> *chan) {</div><div class="line"><a name="l02862"></a><span class="lineno"> 2862</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d8/dc2/structast__fax__session__details.html">ast_fax_session_details</a> *v21_details;</div><div class="line"><a name="l02863"></a><span class="lineno"> 2863</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d1/d16/structast__fax__session.html">ast_fax_session</a> *v21_session;</div><div class="line"><a name="l02864"></a><span class="lineno"> 2864</span>&#160;</div><div class="line"><a name="l02865"></a><span class="lineno"> 2865</span>&#160;   <span class="keywordflow">if</span> (!chan || !(v21_details = <a class="code" href="../../d0/d60/res__fax_8c.html#a51a502192456037fec6aa542707fcfe4">session_details_new</a>())) {</div><div class="line"><a name="l02866"></a><span class="lineno"> 2866</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l02867"></a><span class="lineno"> 2867</span>&#160;   }</div><div class="line"><a name="l02868"></a><span class="lineno"> 2868</span>&#160;</div><div class="line"><a name="l02869"></a><span class="lineno"> 2869</span>&#160;   v21_details-&gt;<a class="code" href="../../d8/dc2/structast__fax__session__details.html#ad75375cdd336e91cbcee4a829fcdabfe">caps</a> = <a class="code" href="../../db/d6a/res__fax_8h.html#a54eb45ad548b874cf12d0a599631e3f6a9138c48a79016bfccdd7cee6197cb21c">AST_FAX_TECH_V21_DETECT</a>;</div><div class="line"><a name="l02870"></a><span class="lineno"> 2870</span>&#160;   v21_session = <a class="code" href="../../d0/d60/res__fax_8c.html#a7ca6ede68de97a21f49d381ef9014ae1">fax_session_new</a>(v21_details, chan, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div><div class="line"><a name="l02871"></a><span class="lineno"> 2871</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(v21_details, -1);</div><div class="line"><a name="l02872"></a><span class="lineno"> 2872</span>&#160;   <span class="keywordflow">return</span> v21_session;</div><div class="line"><a name="l02873"></a><span class="lineno"> 2873</span>&#160;}</div><div class="line"><a name="l02874"></a><span class="lineno"> 2874</span>&#160;<span class="comment"></span></div><div class="line"><a name="l02875"></a><span class="lineno"> 2875</span>&#160;<span class="comment">/*! \brief Create a new fax gateway object.</span></div><div class="line"><a name="l02876"></a><span class="lineno"> 2876</span>&#160;<span class="comment"> * \param chan the channel the gateway object will be attached to</span></div><div class="line"><a name="l02877"></a><span class="lineno"> 2877</span>&#160;<span class="comment"> * \param details the fax session details</span></div><div class="line"><a name="l02878"></a><span class="lineno"> 2878</span>&#160;<span class="comment"> * \return NULL or a fax gateway object</span></div><div class="line"><a name="l02879"></a><span class="lineno"> 2879</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l02880"></a><span class="lineno"><a class="line" href="../../d0/d60/res__fax_8c.html#a47e8837147c2482dcde5be39f354e03c"> 2880</a></span>&#160;<span class="keyword">static</span> <span class="keyword">struct </span><a class="code" href="../../dd/dd2/structfax__gateway.html">fax_gateway</a> *<a class="code" href="../../d0/d60/res__fax_8c.html#a47e8837147c2482dcde5be39f354e03c">fax_gateway_new</a>(<span class="keyword">struct</span> <a class="code" href="../../df/d3c/structast__channel.html">ast_channel</a> *chan, <span class="keyword">struct</span> <a class="code" href="../../d8/dc2/structast__fax__session__details.html">ast_fax_session_details</a> *details)</div><div class="line"><a name="l02881"></a><span class="lineno"> 2881</span>&#160;{</div><div class="line"><a name="l02882"></a><span class="lineno"> 2882</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../dd/dd2/structfax__gateway.html">fax_gateway</a> *gateway = <a class="code" href="../../d5/da5/astobj2_8h.html#ae0422b60d8e25b6962b2d61ae4ddf724">ao2_alloc</a>(<span class="keyword">sizeof</span>(*gateway), <a class="code" href="../../d0/d60/res__fax_8c.html#a387384e096d0670b954f14891a26be61">destroy_gateway</a>);</div><div class="line"><a name="l02883"></a><span class="lineno"> 2883</span>&#160;   <span class="keywordflow">if</span> (!gateway) {</div><div class="line"><a name="l02884"></a><span class="lineno"> 2884</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l02885"></a><span class="lineno"> 2885</span>&#160;   }</div><div class="line"><a name="l02886"></a><span class="lineno"> 2886</span>&#160;</div><div class="line"><a name="l02887"></a><span class="lineno"> 2887</span>&#160;   <span class="keywordflow">if</span> (!(gateway-&gt;<a class="code" href="../../dd/dd2/structfax__gateway.html#a8bb543c7fdbaf19b5a07e0154727228d">chan_v21_session</a> = fax_v21_session_new(chan))) {</div><div class="line"><a name="l02888"></a><span class="lineno"> 2888</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Can&#39;t create V21 session on chan %s for T.38 gateway session\n&quot;</span>, <a class="code" href="../../d5/d7b/channel_8h.html#a7ca2fda13b129a55c251b56729de285b">ast_channel_name</a>(chan));</div><div class="line"><a name="l02889"></a><span class="lineno"> 2889</span>&#160;      <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(gateway, -1);</div><div class="line"><a name="l02890"></a><span class="lineno"> 2890</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l02891"></a><span class="lineno"> 2891</span>&#160;   }</div><div class="line"><a name="l02892"></a><span class="lineno"> 2892</span>&#160;</div><div class="line"><a name="l02893"></a><span class="lineno"> 2893</span>&#160;   gateway-&gt;<a class="code" href="../../dd/dd2/structfax__gateway.html#ae25f61b5aa8877dfb396fd378c6b7722">framehook</a> = -1;</div><div class="line"><a name="l02894"></a><span class="lineno"> 2894</span>&#160;</div><div class="line"><a name="l02895"></a><span class="lineno"> 2895</span>&#160;   details-&gt;<a class="code" href="../../d8/dc2/structast__fax__session__details.html#ad75375cdd336e91cbcee4a829fcdabfe">caps</a> = <a class="code" href="../../db/d6a/res__fax_8h.html#a54eb45ad548b874cf12d0a599631e3f6add135550dca7400fb80e250a63a54887">AST_FAX_TECH_GATEWAY</a>;</div><div class="line"><a name="l02896"></a><span class="lineno"> 2896</span>&#160;   <span class="keywordflow">if</span> (details-&gt;<a class="code" href="../../d8/dc2/structast__fax__session__details.html#a3ef48556ce45595f874faa2368bc3cfa">gateway_timeout</a> &amp;&amp; !(gateway-&gt;<a class="code" href="../../dd/dd2/structfax__gateway.html#acf7d6ff8498e4c50ee13ac0711210c72">s</a> = <a class="code" href="../../d0/d60/res__fax_8c.html#aa71e4f978e47d124ee1f87b340fdfb78">fax_session_reserve</a>(details, &amp;gateway-&gt;<a class="code" href="../../dd/dd2/structfax__gateway.html#aed7ead71b14c348cd4a72ffbced30989">token</a>))) {</div><div class="line"><a name="l02897"></a><span class="lineno"> 2897</span>&#160;      details-&gt;<a class="code" href="../../d8/dc2/structast__fax__session__details.html#ad75375cdd336e91cbcee4a829fcdabfe">caps</a> &amp;= ~<a class="code" href="../../db/d6a/res__fax_8h.html#a54eb45ad548b874cf12d0a599631e3f6add135550dca7400fb80e250a63a54887">AST_FAX_TECH_GATEWAY</a>;</div><div class="line"><a name="l02898"></a><span class="lineno"> 2898</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Can&#39;t reserve a FAX session, gateway attempt failed.\n&quot;</span>);</div><div class="line"><a name="l02899"></a><span class="lineno"> 2899</span>&#160;      <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(gateway, -1);</div><div class="line"><a name="l02900"></a><span class="lineno"> 2900</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l02901"></a><span class="lineno"> 2901</span>&#160;   }</div><div class="line"><a name="l02902"></a><span class="lineno"> 2902</span>&#160;</div><div class="line"><a name="l02903"></a><span class="lineno"> 2903</span>&#160;   <span class="keywordflow">return</span> gateway;</div><div class="line"><a name="l02904"></a><span class="lineno"> 2904</span>&#160;}</div><div class="line"><a name="l02905"></a><span class="lineno"> 2905</span>&#160;<span class="comment"></span></div><div class="line"><a name="l02906"></a><span class="lineno"> 2906</span>&#160;<span class="comment">/*!</span></div><div class="line"><a name="l02907"></a><span class="lineno"> 2907</span>&#160;<span class="comment"> * \brief Create a fax session and start T.30&lt;-&gt;T.38 gateway mode</span></div><div class="line"><a name="l02908"></a><span class="lineno"> 2908</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l02909"></a><span class="lineno"> 2909</span>&#160;<span class="comment"> * \param gateway a fax gateway object</span></div><div class="line"><a name="l02910"></a><span class="lineno"> 2910</span>&#160;<span class="comment"> * \param details fax session details</span></div><div class="line"><a name="l02911"></a><span class="lineno"> 2911</span>&#160;<span class="comment"> * \param chan active channel</span></div><div class="line"><a name="l02912"></a><span class="lineno"> 2912</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l02913"></a><span class="lineno"> 2913</span>&#160;<span class="comment"> * \pre chan is locked on entry</span></div><div class="line"><a name="l02914"></a><span class="lineno"> 2914</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l02915"></a><span class="lineno"> 2915</span>&#160;<span class="comment"> * \return 0 on error 1 on success</span></div><div class="line"><a name="l02916"></a><span class="lineno"> 2916</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l02917"></a><span class="lineno"><a class="line" href="../../d0/d60/res__fax_8c.html#a0a1efd136d28f11d18bfa7cf927ff5ea"> 2917</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d0/d60/res__fax_8c.html#a0a1efd136d28f11d18bfa7cf927ff5ea">fax_gateway_start</a>(<span class="keyword">struct</span> <a class="code" href="../../dd/dd2/structfax__gateway.html">fax_gateway</a> *gateway, <span class="keyword">struct</span> <a class="code" href="../../d8/dc2/structast__fax__session__details.html">ast_fax_session_details</a> *details, <span class="keyword">struct</span> <a class="code" href="../../df/d3c/structast__channel.html">ast_channel</a> *chan)</div><div class="line"><a name="l02918"></a><span class="lineno"> 2918</span>&#160;{</div><div class="line"><a name="l02919"></a><span class="lineno"> 2919</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d1/d16/structast__fax__session.html">ast_fax_session</a> *s;</div><div class="line"><a name="l02920"></a><span class="lineno"> 2920</span>&#160;   <span class="keywordtype">int</span> start_res;</div><div class="line"><a name="l02921"></a><span class="lineno"> 2921</span>&#160;</div><div class="line"><a name="l02922"></a><span class="lineno"> 2922</span>&#160;   <span class="comment">/* if the fax gateway is already started then do nothing */</span></div><div class="line"><a name="l02923"></a><span class="lineno"> 2923</span>&#160;   <span class="keywordflow">if</span> (gateway-&gt;<a class="code" href="../../dd/dd2/structfax__gateway.html#acf7d6ff8498e4c50ee13ac0711210c72">s</a> &amp;&amp;</div><div class="line"><a name="l02924"></a><span class="lineno"> 2924</span>&#160;      gateway-&gt;<a class="code" href="../../dd/dd2/structfax__gateway.html#acf7d6ff8498e4c50ee13ac0711210c72">s</a>-&gt;<a class="code" href="../../d1/d16/structast__fax__session.html#ad8f346e1752edcc0b1a6b431b1749f0e">state</a> != <a class="code" href="../../db/d6a/res__fax_8h.html#ab34810136037068a0847bcca2518112cae3dc111580a7a9ef050b638a3da10790">AST_FAX_STATE_RESERVED</a> &amp;&amp; gateway-&gt;<a class="code" href="../../dd/dd2/structfax__gateway.html#acf7d6ff8498e4c50ee13ac0711210c72">s</a>-&gt;<a class="code" href="../../d1/d16/structast__fax__session.html#ad8f346e1752edcc0b1a6b431b1749f0e">state</a> != <a class="code" href="../../db/d6a/res__fax_8h.html#ab34810136037068a0847bcca2518112ca522d0463615626bcc42a3dd5716651dd">AST_FAX_STATE_INACTIVE</a>) {</div><div class="line"><a name="l02925"></a><span class="lineno"> 2925</span>&#160;      <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l02926"></a><span class="lineno"> 2926</span>&#160;   }</div><div class="line"><a name="l02927"></a><span class="lineno"> 2927</span>&#160;</div><div class="line"><a name="l02928"></a><span class="lineno"> 2928</span>&#160;   <span class="comment">/* if we start gateway we don&#39;t need v21 detection sessions any more */</span></div><div class="line"><a name="l02929"></a><span class="lineno"> 2929</span>&#160;   <a class="code" href="../../d0/d60/res__fax_8c.html#a3d942985befce033fb70506848199758">destroy_v21_sessions</a>(gateway);</div><div class="line"><a name="l02930"></a><span class="lineno"> 2930</span>&#160;</div><div class="line"><a name="l02931"></a><span class="lineno"> 2931</span>&#160;   <span class="comment">/* create the FAX session */</span></div><div class="line"><a name="l02932"></a><span class="lineno"> 2932</span>&#160;   <span class="keywordflow">if</span> (!(s = <a class="code" href="../../d0/d60/res__fax_8c.html#a7ca6ede68de97a21f49d381ef9014ae1">fax_session_new</a>(details, chan, gateway-&gt;<a class="code" href="../../dd/dd2/structfax__gateway.html#acf7d6ff8498e4c50ee13ac0711210c72">s</a>, gateway-&gt;<a class="code" href="../../dd/dd2/structfax__gateway.html#aed7ead71b14c348cd4a72ffbced30989">token</a>))) {</div><div class="line"><a name="l02933"></a><span class="lineno"> 2933</span>&#160;      gateway-&gt;<a class="code" href="../../dd/dd2/structfax__gateway.html#aed7ead71b14c348cd4a72ffbced30989">token</a> = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l02934"></a><span class="lineno"> 2934</span>&#160;      <a class="code" href="../../d1/d0f/stringfields_8h.html#a653461abd6e0d16e4e3326ab90e0501d">ast_string_field_set</a>(details, <a class="code" href="../../de/d1b/cel__pgsql_8c.html#ad6c487210772a9b4b0ca04b04b847d4c">result</a>, <span class="stringliteral">&quot;FAILED&quot;</span>);</div><div class="line"><a name="l02935"></a><span class="lineno"> 2935</span>&#160;      <a class="code" href="../../d1/d0f/stringfields_8h.html#a653461abd6e0d16e4e3326ab90e0501d">ast_string_field_set</a>(details, resultstr, <span class="stringliteral">&quot;error starting gateway session&quot;</span>);</div><div class="line"><a name="l02936"></a><span class="lineno"> 2936</span>&#160;      <a class="code" href="../../d1/d0f/stringfields_8h.html#a653461abd6e0d16e4e3326ab90e0501d">ast_string_field_set</a>(details, <a class="code" href="../../d6/d47/utils_2frame_8c.html#a4a9391ee88e57361b613c4c2fd2bf4aa">error</a>, <span class="stringliteral">&quot;INIT_ERROR&quot;</span>);</div><div class="line"><a name="l02937"></a><span class="lineno"> 2937</span>&#160;      details-&gt;<a class="code" href="../../d8/dc2/structast__fax__session__details.html#aa3cf325797b2746fbd79f34b2fd45370">is_t38_negotiated</a> = 0;</div><div class="line"><a name="l02938"></a><span class="lineno"> 2938</span>&#160;      <a class="code" href="../../d0/d60/res__fax_8c.html#ad7732b5ae304d39afa2dacb20187cf04">set_channel_variables</a>(chan, details);</div><div class="line"><a name="l02939"></a><span class="lineno"> 2939</span>&#160;      <a class="code" href="../../d0/d60/res__fax_8c.html#a38d73af44b480b7cad7a654f75926777">report_fax_status</a>(chan, details, <span class="stringliteral">&quot;No Available Resource&quot;</span>);</div><div class="line"><a name="l02940"></a><span class="lineno"> 2940</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Can&#39;t create a FAX session, gateway attempt failed.\n&quot;</span>);</div><div class="line"><a name="l02941"></a><span class="lineno"> 2941</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l02942"></a><span class="lineno"> 2942</span>&#160;   }</div><div class="line"><a name="l02943"></a><span class="lineno"> 2943</span>&#160;   <span class="comment">/* release the reference for the reserved session and replace it with</span></div><div class="line"><a name="l02944"></a><span class="lineno"> 2944</span>&#160;<span class="comment">    * the real session */</span></div><div class="line"><a name="l02945"></a><span class="lineno"> 2945</span>&#160;   <span class="keywordflow">if</span> (gateway-&gt;<a class="code" href="../../dd/dd2/structfax__gateway.html#acf7d6ff8498e4c50ee13ac0711210c72">s</a>) {</div><div class="line"><a name="l02946"></a><span class="lineno"> 2946</span>&#160;      <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(gateway-&gt;<a class="code" href="../../dd/dd2/structfax__gateway.html#acf7d6ff8498e4c50ee13ac0711210c72">s</a>, -1);</div><div class="line"><a name="l02947"></a><span class="lineno"> 2947</span>&#160;   }</div><div class="line"><a name="l02948"></a><span class="lineno"> 2948</span>&#160;   gateway-&gt;<a class="code" href="../../dd/dd2/structfax__gateway.html#acf7d6ff8498e4c50ee13ac0711210c72">s</a> = s;</div><div class="line"><a name="l02949"></a><span class="lineno"> 2949</span>&#160;   gateway-&gt;<a class="code" href="../../dd/dd2/structfax__gateway.html#aed7ead71b14c348cd4a72ffbced30989">token</a> = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l02950"></a><span class="lineno"> 2950</span>&#160;</div><div class="line"><a name="l02951"></a><span class="lineno"> 2951</span>&#160;   <a class="code" href="../../d5/d7b/channel_8h.html#af476c537b29be3f29240489032f9db39">ast_channel_unlock</a>(chan);</div><div class="line"><a name="l02952"></a><span class="lineno"> 2952</span>&#160;   start_res = gateway-&gt;<a class="code" href="../../dd/dd2/structfax__gateway.html#acf7d6ff8498e4c50ee13ac0711210c72">s</a>-&gt;<a class="code" href="../../d1/d16/structast__fax__session.html#a4ac6ff3775e67c710cd55bc7dfd592fe">tech</a>-&gt;<a class="code" href="../../d9/d0e/structast__fax__tech.html#a020b7b790b06e12b73b1ca66d1eda3e7">start_session</a>(gateway-&gt;<a class="code" href="../../dd/dd2/structfax__gateway.html#acf7d6ff8498e4c50ee13ac0711210c72">s</a>);</div><div class="line"><a name="l02953"></a><span class="lineno"> 2953</span>&#160;   <a class="code" href="../../d5/d7b/channel_8h.html#a493bdebe876caafb8ee535853310364a">ast_channel_lock</a>(chan);</div><div class="line"><a name="l02954"></a><span class="lineno"> 2954</span>&#160;   <span class="keywordflow">if</span> (start_res &lt; 0) {</div><div class="line"><a name="l02955"></a><span class="lineno"> 2955</span>&#160;      <a class="code" href="../../d1/d0f/stringfields_8h.html#a653461abd6e0d16e4e3326ab90e0501d">ast_string_field_set</a>(details, <a class="code" href="../../de/d1b/cel__pgsql_8c.html#ad6c487210772a9b4b0ca04b04b847d4c">result</a>, <span class="stringliteral">&quot;FAILED&quot;</span>);</div><div class="line"><a name="l02956"></a><span class="lineno"> 2956</span>&#160;      <a class="code" href="../../d1/d0f/stringfields_8h.html#a653461abd6e0d16e4e3326ab90e0501d">ast_string_field_set</a>(details, resultstr, <span class="stringliteral">&quot;error starting gateway session&quot;</span>);</div><div class="line"><a name="l02957"></a><span class="lineno"> 2957</span>&#160;      <a class="code" href="../../d1/d0f/stringfields_8h.html#a653461abd6e0d16e4e3326ab90e0501d">ast_string_field_set</a>(details, <a class="code" href="../../d6/d47/utils_2frame_8c.html#a4a9391ee88e57361b613c4c2fd2bf4aa">error</a>, <span class="stringliteral">&quot;INIT_ERROR&quot;</span>);</div><div class="line"><a name="l02958"></a><span class="lineno"> 2958</span>&#160;      details-&gt;<a class="code" href="../../d8/dc2/structast__fax__session__details.html#aa3cf325797b2746fbd79f34b2fd45370">is_t38_negotiated</a> = 0;</div><div class="line"><a name="l02959"></a><span class="lineno"> 2959</span>&#160;      <a class="code" href="../../d0/d60/res__fax_8c.html#ad7732b5ae304d39afa2dacb20187cf04">set_channel_variables</a>(chan, details);</div><div class="line"><a name="l02960"></a><span class="lineno"> 2960</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l02961"></a><span class="lineno"> 2961</span>&#160;   }</div><div class="line"><a name="l02962"></a><span class="lineno"> 2962</span>&#160;</div><div class="line"><a name="l02963"></a><span class="lineno"> 2963</span>&#160;   gateway-&gt;<a class="code" href="../../dd/dd2/structfax__gateway.html#a23b38dad7025290be3461b4b3208b4e6">timeout_start</a>.tv_sec = 0;</div><div class="line"><a name="l02964"></a><span class="lineno"> 2964</span>&#160;   gateway-&gt;<a class="code" href="../../dd/dd2/structfax__gateway.html#a23b38dad7025290be3461b4b3208b4e6">timeout_start</a>.tv_usec = 0;</div><div class="line"><a name="l02965"></a><span class="lineno"> 2965</span>&#160;</div><div class="line"><a name="l02966"></a><span class="lineno"> 2966</span>&#160;   <a class="code" href="../../d0/d60/res__fax_8c.html#a38d73af44b480b7cad7a654f75926777">report_fax_status</a>(chan, details, <span class="stringliteral">&quot;FAX Transmission In Progress&quot;</span>);</div><div class="line"><a name="l02967"></a><span class="lineno"> 2967</span>&#160;</div><div class="line"><a name="l02968"></a><span class="lineno"> 2968</span>&#160;   <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l02969"></a><span class="lineno"> 2969</span>&#160;}</div><div class="line"><a name="l02970"></a><span class="lineno"> 2970</span>&#160;<span class="comment"></span></div><div class="line"><a name="l02971"></a><span class="lineno"> 2971</span>&#160;<span class="comment">/*! \pre chan is locked on entry */</span></div><div class="line"><a name="l02972"></a><span class="lineno"><a class="line" href="../../d0/d60/res__fax_8c.html#a37d092c7d520ee77021a0d9ce53af421"> 2972</a></span>&#160;<span class="keyword">static</span> <span class="keyword">struct </span><a class="code" href="../../d0/d99/structast__frame.html">ast_frame</a> *<a class="code" href="../../d0/d60/res__fax_8c.html#a37d092c7d520ee77021a0d9ce53af421">fax_gateway_request_t38</a>(<span class="keyword">struct</span> <a class="code" href="../../dd/dd2/structfax__gateway.html">fax_gateway</a> *gateway, <span class="keyword">struct</span> <a class="code" href="../../df/d3c/structast__channel.html">ast_channel</a> *chan)</div><div class="line"><a name="l02973"></a><span class="lineno"> 2973</span>&#160;{</div><div class="line"><a name="l02974"></a><span class="lineno"> 2974</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d0/d99/structast__frame.html">ast_frame</a> *fp;</div><div class="line"><a name="l02975"></a><span class="lineno"> 2975</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d5/def/structast__control__t38__parameters.html">ast_control_t38_parameters</a> t38_parameters = {</div><div class="line"><a name="l02976"></a><span class="lineno"> 2976</span>&#160;      .<a class="code" href="../../d5/def/structast__control__t38__parameters.html#adb36822366e10ce64ca8337c512732a6">request_response</a> = <a class="code" href="../../d6/d66/include_2asterisk_2frame_8h.html#a168d496bdac09ece3ce49cf473bbdb4bafdb1ca68d683c64301c4cf07463a9975">AST_T38_REQUEST_NEGOTIATE</a>,</div><div class="line"><a name="l02977"></a><span class="lineno"> 2977</span>&#160;   };</div><div class="line"><a name="l02978"></a><span class="lineno"> 2978</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d0/d99/structast__frame.html">ast_frame</a> control_frame = {</div><div class="line"><a name="l02979"></a><span class="lineno"> 2979</span>&#160;      .<a class="code" href="../../d0/d99/structast__frame.html#af51e37c9331049b1e3d250a7c8bc3c26">src</a> = <span class="stringliteral">&quot;res_fax&quot;</span>,</div><div class="line"><a name="l02980"></a><span class="lineno"> 2980</span>&#160;      .frametype = <a class="code" href="../../d6/d66/include_2asterisk_2frame_8h.html#ae2e1a9c4e048da387b761f619312d6e0ae1dae388b0d70825876e137ae95bb0c1">AST_FRAME_CONTROL</a>,</div><div class="line"><a name="l02981"></a><span class="lineno"> 2981</span>&#160;      .datalen = <span class="keyword">sizeof</span>(t38_parameters),</div><div class="line"><a name="l02982"></a><span class="lineno"> 2982</span>&#160;      .<a class="code" href="../../d0/d99/structast__frame.html#a27237c48fdcd22556401f20c693811db">subclass</a>.<a class="code" href="../../d1/d9f/structast__frame__subclass.html#adece183191b0e700e039e59101e06105">integer</a> = <a class="code" href="../../d6/d66/include_2asterisk_2frame_8h.html#aedda41918e992000fe921f8f7363b390a7334c9d27a6d70fe7c85b60b864788fc">AST_CONTROL_T38_PARAMETERS</a>,</div><div class="line"><a name="l02983"></a><span class="lineno"> 2983</span>&#160;      .data.ptr = &amp;t38_parameters,</div><div class="line"><a name="l02984"></a><span class="lineno"> 2984</span>&#160;   };</div><div class="line"><a name="l02985"></a><span class="lineno"> 2985</span>&#160;</div><div class="line"><a name="l02986"></a><span class="lineno"> 2986</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d8/dc2/structast__fax__session__details.html">ast_fax_session_details</a> *details = <a class="code" href="../../d0/d60/res__fax_8c.html#aa42f3331d32fc2fd92010023c6100322">find_details</a>(chan);</div><div class="line"><a name="l02987"></a><span class="lineno"> 2987</span>&#160;</div><div class="line"><a name="l02988"></a><span class="lineno"> 2988</span>&#160;   <span class="keywordflow">if</span> (!details) {</div><div class="line"><a name="l02989"></a><span class="lineno"> 2989</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;no FAX session details found on chan %s for T.38 gateway session, odd\n&quot;</span>, <a class="code" href="../../d5/d7b/channel_8h.html#a7ca2fda13b129a55c251b56729de285b">ast_channel_name</a>(chan));</div><div class="line"><a name="l02990"></a><span class="lineno"> 2990</span>&#160;      <a class="code" href="../../db/d3c/framehook_8h.html#a6e116259cae8c1e5cca074d05f0a3475">ast_framehook_detach</a>(chan, gateway-&gt;<a class="code" href="../../dd/dd2/structfax__gateway.html#ae25f61b5aa8877dfb396fd378c6b7722">framehook</a>);</div><div class="line"><a name="l02991"></a><span class="lineno"> 2991</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l02992"></a><span class="lineno"> 2992</span>&#160;   }</div><div class="line"><a name="l02993"></a><span class="lineno"> 2993</span>&#160;</div><div class="line"><a name="l02994"></a><span class="lineno"> 2994</span>&#160;   <a class="code" href="../../d0/d60/res__fax_8c.html#a624525cc48cff52d5ae4e5e50895e81e">t38_parameters_fax_to_ast</a>(&amp;t38_parameters, &amp;details-&gt;<a class="code" href="../../d8/dc2/structast__fax__session__details.html#a80632865b575d06f319ef95c42645b2c">our_t38_parameters</a>);</div><div class="line"><a name="l02995"></a><span class="lineno"> 2995</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(details, -1);</div><div class="line"><a name="l02996"></a><span class="lineno"> 2996</span>&#160;</div><div class="line"><a name="l02997"></a><span class="lineno"> 2997</span>&#160;   <span class="keywordflow">if</span> (!(fp = <a class="code" href="../../d6/d66/include_2asterisk_2frame_8h.html#a314496ce1d74ed7fdb9c5319c5e2e953">ast_frisolate</a>(&amp;control_frame))) {</div><div class="line"><a name="l02998"></a><span class="lineno"> 2998</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;error generating T.38 request control frame on chan %s for T.38 gateway session\n&quot;</span>, <a class="code" href="../../d5/d7b/channel_8h.html#a7ca2fda13b129a55c251b56729de285b">ast_channel_name</a>(chan));</div><div class="line"><a name="l02999"></a><span class="lineno"> 2999</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l03000"></a><span class="lineno"> 3000</span>&#160;   }</div><div class="line"><a name="l03001"></a><span class="lineno"> 3001</span>&#160;</div><div class="line"><a name="l03002"></a><span class="lineno"> 3002</span>&#160;   gateway-&gt;<a class="code" href="../../dd/dd2/structfax__gateway.html#a37f4333f3e7eaf12966069b77dac704e">t38_state</a> = <a class="code" href="../../d5/d7b/channel_8h.html#a4cd990f4c1cd0c2af6e4c63f6d15b4e1afa1eab36050476591f803c3e234c2ed1">T38_STATE_NEGOTIATING</a>;</div><div class="line"><a name="l03003"></a><span class="lineno"> 3003</span>&#160;   gateway-&gt;<a class="code" href="../../dd/dd2/structfax__gateway.html#a23b38dad7025290be3461b4b3208b4e6">timeout_start</a> = <a class="code" href="../../de/df7/time_8h.html#ad3899efb6f0e348556ef69f5b16aa7f7">ast_tvnow</a>();</div><div class="line"><a name="l03004"></a><span class="lineno"> 3004</span>&#160;   details-&gt;<a class="code" href="../../d8/dc2/structast__fax__session__details.html#aa3cf325797b2746fbd79f34b2fd45370">is_t38_negotiated</a> = 0;</div><div class="line"><a name="l03005"></a><span class="lineno"> 3005</span>&#160;   details-&gt;<a class="code" href="../../d8/dc2/structast__fax__session__details.html#a3ef48556ce45595f874faa2368bc3cfa">gateway_timeout</a> = <a class="code" href="../../d0/d60/res__fax_8c.html#ac63658a749ab21cd75126580a69a789a">FAX_GATEWAY_TIMEOUT</a>;</div><div class="line"><a name="l03006"></a><span class="lineno"> 3006</span>&#160;</div><div class="line"><a name="l03007"></a><span class="lineno"> 3007</span>&#160;   <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(1, <span class="stringliteral">&quot;requesting T.38 for gateway session for %s\n&quot;</span>, <a class="code" href="../../d5/d7b/channel_8h.html#a7ca2fda13b129a55c251b56729de285b">ast_channel_name</a>(chan));</div><div class="line"><a name="l03008"></a><span class="lineno"> 3008</span>&#160;   <span class="keywordflow">return</span> fp;</div><div class="line"><a name="l03009"></a><span class="lineno"> 3009</span>&#160;}</div><div class="line"><a name="l03010"></a><span class="lineno"> 3010</span>&#160;<span class="comment"></span></div><div class="line"><a name="l03011"></a><span class="lineno"> 3011</span>&#160;<span class="comment">/*! \pre chan is locked on entry */</span></div><div class="line"><a name="l03012"></a><span class="lineno"><a class="line" href="../../d0/d60/res__fax_8c.html#aa1d6811868ccbb842dde66cf8060a5fb"> 3012</a></span>&#160;<span class="keyword">static</span> <span class="keyword">struct </span><a class="code" href="../../d0/d99/structast__frame.html">ast_frame</a> *<a class="code" href="../../d0/d60/res__fax_8c.html#aa1d6811868ccbb842dde66cf8060a5fb">fax_gateway_detect_v21</a>(<span class="keyword">struct</span> <a class="code" href="../../dd/dd2/structfax__gateway.html">fax_gateway</a> *gateway, <span class="keyword">struct</span> <a class="code" href="../../df/d3c/structast__channel.html">ast_channel</a> *chan, <span class="keyword">struct</span> <a class="code" href="../../df/d3c/structast__channel.html">ast_channel</a> *peer, <span class="keyword">struct</span> <a class="code" href="../../df/d3c/structast__channel.html">ast_channel</a> *active, <span class="keyword">struct</span> <a class="code" href="../../d0/d99/structast__frame.html">ast_frame</a> *f)</div><div class="line"><a name="l03013"></a><span class="lineno"> 3013</span>&#160;{</div><div class="line"><a name="l03014"></a><span class="lineno"> 3014</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../df/d3c/structast__channel.html">ast_channel</a> *other = (active == chan) ? peer : chan;</div><div class="line"><a name="l03015"></a><span class="lineno"> 3015</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d1/d16/structast__fax__session.html">ast_fax_session</a> *active_v21_session = (active == <a class="code" href="../../d1/d16/structast__fax__session.html#a84d1435c5b8d387806714ea7079304b7">chan</a>) ? gateway-&gt;<a class="code" href="../../dd/dd2/structfax__gateway.html#a8bb543c7fdbaf19b5a07e0154727228d">chan_v21_session</a> : gateway-&gt;<a class="code" href="../../dd/dd2/structfax__gateway.html#a08eb33d553223ed90af3397a850b3af1">peer_v21_session</a>;</div><div class="line"><a name="l03016"></a><span class="lineno"> 3016</span>&#160;</div><div class="line"><a name="l03017"></a><span class="lineno"> 3017</span>&#160;   <a class="code" href="../../dc/df2/ast__expr2f_8c.html#a33e91cd0cef6786e9e3a27ac67707207">if</a> (!active_v21_session || gateway-&gt;<a class="code" href="../../dd/dd2/structfax__gateway.html#af2cb1e09b1af5d5bebdec7471555c940">detected_v21</a>) {</div><div class="line"><a name="l03018"></a><span class="lineno"> 3018</span>&#160;      <span class="keywordflow">return</span> f;</div><div class="line"><a name="l03019"></a><span class="lineno"> 3019</span>&#160;   }</div><div class="line"><a name="l03020"></a><span class="lineno"> 3020</span>&#160;</div><div class="line"><a name="l03021"></a><span class="lineno"> 3021</span>&#160;   <span class="keywordflow">if</span> (active_v21_session-&gt;<a class="code" href="../../d1/d16/structast__fax__session.html#a4ac6ff3775e67c710cd55bc7dfd592fe">tech</a>-&gt;<a class="code" href="../../d9/d0e/structast__fax__tech.html#a7014a7b1d150a523cf1273e6fee5bdd6">write</a>(active_v21_session, f) == 0 &amp;&amp;</div><div class="line"><a name="l03022"></a><span class="lineno"> 3022</span>&#160;       active_v21_session-&gt;<a class="code" href="../../d1/d16/structast__fax__session.html#ae7b633178d301df70e8612b4ce1aeb77">details</a>-&gt;<a class="code" href="../../d8/dc2/structast__fax__session__details.html#a3ab211dbe8780b7292257f6b3dba1952">option</a>.<a class="code" href="../../d8/dc2/structast__fax__session__details.html#aed36280452b10bbcf7cb35873db02762">v21_detected</a>) {</div><div class="line"><a name="l03023"></a><span class="lineno"> 3023</span>&#160;      gateway-&gt;<a class="code" href="../../dd/dd2/structfax__gateway.html#af2cb1e09b1af5d5bebdec7471555c940">detected_v21</a> = 1;</div><div class="line"><a name="l03024"></a><span class="lineno"> 3024</span>&#160;   }</div><div class="line"><a name="l03025"></a><span class="lineno"> 3025</span>&#160;</div><div class="line"><a name="l03026"></a><span class="lineno"> 3026</span>&#160;   <span class="keywordflow">if</span> (gateway-&gt;<a class="code" href="../../dd/dd2/structfax__gateway.html#af2cb1e09b1af5d5bebdec7471555c940">detected_v21</a>) {</div><div class="line"><a name="l03027"></a><span class="lineno"> 3027</span>&#160;      <span class="keyword">enum</span> <a class="code" href="../../d5/d7b/channel_8h.html#a4cd990f4c1cd0c2af6e4c63f6d15b4e1">ast_t38_state</a> state_other;</div><div class="line"><a name="l03028"></a><span class="lineno"> 3028</span>&#160;      <span class="keyword">enum</span> <a class="code" href="../../d5/d7b/channel_8h.html#a4cd990f4c1cd0c2af6e4c63f6d15b4e1">ast_t38_state</a> state_active;</div><div class="line"><a name="l03029"></a><span class="lineno"> 3029</span>&#160;      <span class="keyword">struct </span><a class="code" href="../../d0/d99/structast__frame.html">ast_frame</a> *fp;</div><div class="line"><a name="l03030"></a><span class="lineno"> 3030</span>&#160;      <span class="keyword">struct </span><a class="code" href="../../d8/dc2/structast__fax__session__details.html">ast_fax_session_details</a> *details;</div><div class="line"><a name="l03031"></a><span class="lineno"> 3031</span>&#160;      <span class="keywordtype">int</span> <a class="code" href="../../d8/dc2/structast__fax__session__details.html#a40311ef8f9bd5a1a7d7bf32f3b019148">negotiate_both</a> = 0;</div><div class="line"><a name="l03032"></a><span class="lineno"> 3032</span>&#160;</div><div class="line"><a name="l03033"></a><span class="lineno"> 3033</span>&#160;      <span class="comment">/*</span></div><div class="line"><a name="l03034"></a><span class="lineno"> 3034</span>&#160;<span class="comment">       * The default behavior is to wait for the active endpoint to initiate negotiation.</span></div><div class="line"><a name="l03035"></a><span class="lineno"> 3035</span>&#160;<span class="comment">       * Find out if this has been overridden. If so, instead of waiting have Asterisk</span></div><div class="line"><a name="l03036"></a><span class="lineno"> 3036</span>&#160;<span class="comment">       * initiate the negotiation requests out to both endpoints.</span></div><div class="line"><a name="l03037"></a><span class="lineno"> 3037</span>&#160;<span class="comment">       */</span></div><div class="line"><a name="l03038"></a><span class="lineno"> 3038</span>&#160;      details = <a class="code" href="../../d0/d60/res__fax_8c.html#ac4310e981e9db76dfc3e85c51f4c6e1e">find_or_create_details</a>(active);</div><div class="line"><a name="l03039"></a><span class="lineno"> 3039</span>&#160;      <span class="keywordflow">if</span> (details) {</div><div class="line"><a name="l03040"></a><span class="lineno"> 3040</span>&#160;         negotiate_both = details-&gt;<a class="code" href="../../d8/dc2/structast__fax__session__details.html#a40311ef8f9bd5a1a7d7bf32f3b019148">negotiate_both</a>;</div><div class="line"><a name="l03041"></a><span class="lineno"> 3041</span>&#160;         <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(details, -1);</div><div class="line"><a name="l03042"></a><span class="lineno"> 3042</span>&#160;      } <span class="keywordflow">else</span> {</div><div class="line"><a name="l03043"></a><span class="lineno"> 3043</span>&#160;         <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Detect v21 - no session details for channel &#39;%s&#39;\n&quot;</span>,</div><div class="line"><a name="l03044"></a><span class="lineno"> 3044</span>&#160;               <a class="code" href="../../d5/d7b/channel_8h.html#a7ca2fda13b129a55c251b56729de285b">ast_channel_name</a>(chan));</div><div class="line"><a name="l03045"></a><span class="lineno"> 3045</span>&#160;      }</div><div class="line"><a name="l03046"></a><span class="lineno"> 3046</span>&#160;</div><div class="line"><a name="l03047"></a><span class="lineno"> 3047</span>&#160;      <a class="code" href="../../d0/d60/res__fax_8c.html#a3d942985befce033fb70506848199758">destroy_v21_sessions</a>(gateway);</div><div class="line"><a name="l03048"></a><span class="lineno"> 3048</span>&#160;</div><div class="line"><a name="l03049"></a><span class="lineno"> 3049</span>&#160;      <a class="code" href="../../d5/d7b/channel_8h.html#af476c537b29be3f29240489032f9db39">ast_channel_unlock</a>(chan);</div><div class="line"><a name="l03050"></a><span class="lineno"> 3050</span>&#160;      state_active = <a class="code" href="../../d5/d7b/channel_8h.html#a1b22ea5302ef183fa68bc45bfb0659c9">ast_channel_get_t38_state</a>(active);</div><div class="line"><a name="l03051"></a><span class="lineno"> 3051</span>&#160;      state_other = <a class="code" href="../../d5/d7b/channel_8h.html#a1b22ea5302ef183fa68bc45bfb0659c9">ast_channel_get_t38_state</a>(other);</div><div class="line"><a name="l03052"></a><span class="lineno"> 3052</span>&#160;      <a class="code" href="../../d5/d7b/channel_8h.html#a493bdebe876caafb8ee535853310364a">ast_channel_lock</a>(chan);</div><div class="line"><a name="l03053"></a><span class="lineno"> 3053</span>&#160;</div><div class="line"><a name="l03054"></a><span class="lineno"> 3054</span>&#160;      <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(1, <span class="stringliteral">&quot;detected v21 preamble from %s\n&quot;</span>, <a class="code" href="../../d5/d7b/channel_8h.html#a7ca2fda13b129a55c251b56729de285b">ast_channel_name</a>(active));</div><div class="line"><a name="l03055"></a><span class="lineno"> 3055</span>&#160;</div><div class="line"><a name="l03056"></a><span class="lineno"> 3056</span>&#160;      <span class="keywordflow">if</span> (state_active == <a class="code" href="../../d5/d7b/channel_8h.html#a4cd990f4c1cd0c2af6e4c63f6d15b4e1ab6834ded836bd85b489322f04984d274">T38_STATE_UNKNOWN</a> || state_other == <a class="code" href="../../d5/d7b/channel_8h.html#a4cd990f4c1cd0c2af6e4c63f6d15b4e1ab6834ded836bd85b489322f04984d274">T38_STATE_UNKNOWN</a>) {</div><div class="line"><a name="l03057"></a><span class="lineno"> 3057</span>&#160;         <span class="keywordflow">if</span> (!(fp = <a class="code" href="../../d0/d60/res__fax_8c.html#a37d092c7d520ee77021a0d9ce53af421">fax_gateway_request_t38</a>(gateway, chan))) {</div><div class="line"><a name="l03058"></a><span class="lineno"> 3058</span>&#160;            <span class="keywordflow">return</span> f;</div><div class="line"><a name="l03059"></a><span class="lineno"> 3059</span>&#160;         }</div><div class="line"><a name="l03060"></a><span class="lineno"> 3060</span>&#160;         <span class="comment">/* May be called endpoint is improperly configured to rely on the calling endpoint</span></div><div class="line"><a name="l03061"></a><span class="lineno"> 3061</span>&#160;<span class="comment">          * to initiate T.38 re-INVITEs, send T.38 negotiation request to called endpoint */</span></div><div class="line"><a name="l03062"></a><span class="lineno"> 3062</span>&#160;         <span class="keywordflow">if</span> (negotiate_both &amp;&amp; state_active == <a class="code" href="../../d5/d7b/channel_8h.html#a4cd990f4c1cd0c2af6e4c63f6d15b4e1ab6834ded836bd85b489322f04984d274">T38_STATE_UNKNOWN</a>) {</div><div class="line"><a name="l03063"></a><span class="lineno"> 3063</span>&#160;            <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(1, <span class="stringliteral">&quot;sending T.38 negotiation request to %s\n&quot;</span>, <a class="code" href="../../d5/d7b/channel_8h.html#a7ca2fda13b129a55c251b56729de285b">ast_channel_name</a>(active));</div><div class="line"><a name="l03064"></a><span class="lineno"> 3064</span>&#160;            <span class="keywordflow">if</span> (active == chan) {</div><div class="line"><a name="l03065"></a><span class="lineno"> 3065</span>&#160;               <a class="code" href="../../d5/d7b/channel_8h.html#af476c537b29be3f29240489032f9db39">ast_channel_unlock</a>(chan);</div><div class="line"><a name="l03066"></a><span class="lineno"> 3066</span>&#160;            }</div><div class="line"><a name="l03067"></a><span class="lineno"> 3067</span>&#160;            <a class="code" href="../../d5/d7b/channel_8h.html#a79c413d51b7135404d5cacf811649a61">ast_write</a>(active, fp);</div><div class="line"><a name="l03068"></a><span class="lineno"> 3068</span>&#160;            <span class="keywordflow">if</span> (active == chan) {</div><div class="line"><a name="l03069"></a><span class="lineno"> 3069</span>&#160;               <a class="code" href="../../d5/d7b/channel_8h.html#a493bdebe876caafb8ee535853310364a">ast_channel_lock</a>(chan);</div><div class="line"><a name="l03070"></a><span class="lineno"> 3070</span>&#160;            }</div><div class="line"><a name="l03071"></a><span class="lineno"> 3071</span>&#160;         }</div><div class="line"><a name="l03072"></a><span class="lineno"> 3072</span>&#160;         <span class="keywordflow">if</span> (state_other == <a class="code" href="../../d5/d7b/channel_8h.html#a4cd990f4c1cd0c2af6e4c63f6d15b4e1ab6834ded836bd85b489322f04984d274">T38_STATE_UNKNOWN</a>) {</div><div class="line"><a name="l03073"></a><span class="lineno"> 3073</span>&#160;            <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(1, <span class="stringliteral">&quot;sending T.38 negotiation request to %s\n&quot;</span>, <a class="code" href="../../d5/d7b/channel_8h.html#a7ca2fda13b129a55c251b56729de285b">ast_channel_name</a>(other));</div><div class="line"><a name="l03074"></a><span class="lineno"> 3074</span>&#160;            <span class="keywordflow">return</span> fp;</div><div class="line"><a name="l03075"></a><span class="lineno"> 3075</span>&#160;         }</div><div class="line"><a name="l03076"></a><span class="lineno"> 3076</span>&#160;      } <span class="keywordflow">else</span> {</div><div class="line"><a name="l03077"></a><span class="lineno"> 3077</span>&#160;         <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(1, <span class="stringliteral">&quot;neither %s nor %s support T.38 for T.38 gateway session\n&quot;</span>, <a class="code" href="../../d5/d7b/channel_8h.html#a7ca2fda13b129a55c251b56729de285b">ast_channel_name</a>(active), <a class="code" href="../../d5/d7b/channel_8h.html#a7ca2fda13b129a55c251b56729de285b">ast_channel_name</a>(other));</div><div class="line"><a name="l03078"></a><span class="lineno"> 3078</span>&#160;      }</div><div class="line"><a name="l03079"></a><span class="lineno"> 3079</span>&#160;   }</div><div class="line"><a name="l03080"></a><span class="lineno"> 3080</span>&#160;</div><div class="line"><a name="l03081"></a><span class="lineno"> 3081</span>&#160;   <span class="keywordflow">return</span> f;</div><div class="line"><a name="l03082"></a><span class="lineno"> 3082</span>&#160;}</div><div class="line"><a name="l03083"></a><span class="lineno"> 3083</span>&#160;<span class="comment"></span></div><div class="line"><a name="l03084"></a><span class="lineno"> 3084</span>&#160;<span class="comment">/*! \pre chan is locked on entry */</span></div><div class="line"><a name="l03085"></a><span class="lineno"><a class="line" href="../../d0/d60/res__fax_8c.html#a23b5336ddff8d963dbeb84251845721d"> 3085</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d0/d60/res__fax_8c.html#a23b5336ddff8d963dbeb84251845721d">fax_gateway_indicate_t38</a>(<span class="keyword">struct</span> <a class="code" href="../../df/d3c/structast__channel.html">ast_channel</a> *chan, <span class="keyword">struct</span> <a class="code" href="../../df/d3c/structast__channel.html">ast_channel</a> *active, <span class="keyword">struct</span> <a class="code" href="../../d5/def/structast__control__t38__parameters.html">ast_control_t38_parameters</a> *control_params)</div><div class="line"><a name="l03086"></a><span class="lineno"> 3086</span>&#160;{</div><div class="line"><a name="l03087"></a><span class="lineno"> 3087</span>&#160;   <span class="keywordflow">if</span> (active == chan) {</div><div class="line"><a name="l03088"></a><span class="lineno"> 3088</span>&#160;      <a class="code" href="../../d5/d7b/channel_8h.html#af476c537b29be3f29240489032f9db39">ast_channel_unlock</a>(chan);</div><div class="line"><a name="l03089"></a><span class="lineno"> 3089</span>&#160;      <a class="code" href="../../d5/d7b/channel_8h.html#aa8c3522af1bc639cbd5b38f5fdf171fa">ast_indicate_data</a>(chan, <a class="code" href="../../d6/d66/include_2asterisk_2frame_8h.html#aedda41918e992000fe921f8f7363b390a7334c9d27a6d70fe7c85b60b864788fc">AST_CONTROL_T38_PARAMETERS</a>, control_params, <span class="keyword">sizeof</span>(*control_params));</div><div class="line"><a name="l03090"></a><span class="lineno"> 3090</span>&#160;      <a class="code" href="../../d5/d7b/channel_8h.html#a493bdebe876caafb8ee535853310364a">ast_channel_lock</a>(chan);</div><div class="line"><a name="l03091"></a><span class="lineno"> 3091</span>&#160;   } <span class="keywordflow">else</span> {</div><div class="line"><a name="l03092"></a><span class="lineno"> 3092</span>&#160;      <a class="code" href="../../d5/d7b/channel_8h.html#a7e5e15c22564fd66351d332ad10658b5">ast_queue_control_data</a>(chan, <a class="code" href="../../d6/d66/include_2asterisk_2frame_8h.html#aedda41918e992000fe921f8f7363b390a7334c9d27a6d70fe7c85b60b864788fc">AST_CONTROL_T38_PARAMETERS</a>, control_params, <span class="keyword">sizeof</span>(*control_params));</div><div class="line"><a name="l03093"></a><span class="lineno"> 3093</span>&#160;   }</div><div class="line"><a name="l03094"></a><span class="lineno"> 3094</span>&#160;}</div><div class="line"><a name="l03095"></a><span class="lineno"> 3095</span>&#160;<span class="comment"></span></div><div class="line"><a name="l03096"></a><span class="lineno"> 3096</span>&#160;<span class="comment">/*!</span></div><div class="line"><a name="l03097"></a><span class="lineno"> 3097</span>&#160;<span class="comment"> * \brief T38 Gateway Negotiate t38 parameters</span></div><div class="line"><a name="l03098"></a><span class="lineno"> 3098</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l03099"></a><span class="lineno"> 3099</span>&#160;<span class="comment"> * \param gateway gateway object</span></div><div class="line"><a name="l03100"></a><span class="lineno"> 3100</span>&#160;<span class="comment"> * \param chan channel running the gateway</span></div><div class="line"><a name="l03101"></a><span class="lineno"> 3101</span>&#160;<span class="comment"> * \param peer channel im bridged too</span></div><div class="line"><a name="l03102"></a><span class="lineno"> 3102</span>&#160;<span class="comment"> * \param active channel the frame originated on</span></div><div class="line"><a name="l03103"></a><span class="lineno"> 3103</span>&#160;<span class="comment"> * \param f the control frame to process</span></div><div class="line"><a name="l03104"></a><span class="lineno"> 3104</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l03105"></a><span class="lineno"> 3105</span>&#160;<span class="comment"> * \pre chan is locked on entry</span></div><div class="line"><a name="l03106"></a><span class="lineno"> 3106</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l03107"></a><span class="lineno"> 3107</span>&#160;<span class="comment"> * \return processed control frame or null frame</span></div><div class="line"><a name="l03108"></a><span class="lineno"> 3108</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l03109"></a><span class="lineno"><a class="line" href="../../d0/d60/res__fax_8c.html#a522499b2966b304ec995720f3815e8f6"> 3109</a></span>&#160;<span class="keyword">static</span> <span class="keyword">struct </span><a class="code" href="../../d0/d99/structast__frame.html">ast_frame</a> *<a class="code" href="../../d0/d60/res__fax_8c.html#a522499b2966b304ec995720f3815e8f6">fax_gateway_detect_t38</a>(<span class="keyword">struct</span> <a class="code" href="../../dd/dd2/structfax__gateway.html">fax_gateway</a> *gateway, <span class="keyword">struct</span> <a class="code" href="../../df/d3c/structast__channel.html">ast_channel</a> *chan, <span class="keyword">struct</span> <a class="code" href="../../df/d3c/structast__channel.html">ast_channel</a> *peer, <span class="keyword">struct</span> <a class="code" href="../../df/d3c/structast__channel.html">ast_channel</a> *active, <span class="keyword">struct</span> <a class="code" href="../../d0/d99/structast__frame.html">ast_frame</a> *f)</div><div class="line"><a name="l03110"></a><span class="lineno"> 3110</span>&#160;{</div><div class="line"><a name="l03111"></a><span class="lineno"> 3111</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d5/def/structast__control__t38__parameters.html">ast_control_t38_parameters</a> *control_params = f-&gt;<a class="code" href="../../d0/d99/structast__frame.html#a4027905f872af30d910929b07e261ca5">data</a>.<a class="code" href="../../d0/d99/structast__frame.html#add9af9569af79ec26dd741fb226b38ba">ptr</a>;</div><div class="line"><a name="l03112"></a><span class="lineno"> 3112</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../df/d3c/structast__channel.html">ast_channel</a> *other = (active == chan) ? peer : chan;</div><div class="line"><a name="l03113"></a><span class="lineno"> 3113</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d8/dc2/structast__fax__session__details.html">ast_fax_session_details</a> *details;</div><div class="line"><a name="l03114"></a><span class="lineno"> 3114</span>&#160;   <span class="keyword">enum</span> <a class="code" href="../../d5/d7b/channel_8h.html#a4cd990f4c1cd0c2af6e4c63f6d15b4e1">ast_t38_state</a> state_other;</div><div class="line"><a name="l03115"></a><span class="lineno"> 3115</span>&#160;</div><div class="line"><a name="l03116"></a><span class="lineno"> 3116</span>&#160;   <span class="keywordflow">if</span> (f-&gt;<a class="code" href="../../d0/d99/structast__frame.html#ad67e07841d1233e596e6f822a3c81f6b">datalen</a> != <span class="keyword">sizeof</span>(<span class="keyword">struct</span> <a class="code" href="../../d5/def/structast__control__t38__parameters.html">ast_control_t38_parameters</a>)) {</div><div class="line"><a name="l03117"></a><span class="lineno"> 3117</span>&#160;      <span class="comment">/* invalaid AST_CONTROL_T38_PARAMETERS frame, we can&#39;t</span></div><div class="line"><a name="l03118"></a><span class="lineno"> 3118</span>&#160;<span class="comment">       * do anything with it, pass it on */</span></div><div class="line"><a name="l03119"></a><span class="lineno"> 3119</span>&#160;      <span class="keywordflow">return</span> f;</div><div class="line"><a name="l03120"></a><span class="lineno"> 3120</span>&#160;   }</div><div class="line"><a name="l03121"></a><span class="lineno"> 3121</span>&#160;</div><div class="line"><a name="l03122"></a><span class="lineno"> 3122</span>&#160;   <span class="comment">/* ignore frames from ourselves */</span></div><div class="line"><a name="l03123"></a><span class="lineno"> 3123</span>&#160;   <span class="keywordflow">if</span> ((gateway-&gt;<a class="code" href="../../dd/dd2/structfax__gateway.html#a37f4333f3e7eaf12966069b77dac704e">t38_state</a> == <a class="code" href="../../d5/d7b/channel_8h.html#a4cd990f4c1cd0c2af6e4c63f6d15b4e1af142c79721a025bd65edad812f0725e0">T38_STATE_NEGOTIATED</a> &amp;&amp; control_params-&gt;<a class="code" href="../../d5/def/structast__control__t38__parameters.html#adb36822366e10ce64ca8337c512732a6">request_response</a> == <a class="code" href="../../d6/d66/include_2asterisk_2frame_8h.html#a168d496bdac09ece3ce49cf473bbdb4bad501e0d5fe272eaba466507a686a2df5">AST_T38_NEGOTIATED</a>)</div><div class="line"><a name="l03124"></a><span class="lineno"> 3124</span>&#160;      || (gateway-&gt;<a class="code" href="../../dd/dd2/structfax__gateway.html#a37f4333f3e7eaf12966069b77dac704e">t38_state</a> == <a class="code" href="../../d5/d7b/channel_8h.html#a4cd990f4c1cd0c2af6e4c63f6d15b4e1ad3745918c0830d3816e5ce5561814e7e">T38_STATE_REJECTED</a> &amp;&amp; control_params-&gt;<a class="code" href="../../d5/def/structast__control__t38__parameters.html#adb36822366e10ce64ca8337c512732a6">request_response</a> == <a class="code" href="../../d6/d66/include_2asterisk_2frame_8h.html#a168d496bdac09ece3ce49cf473bbdb4baa02b30f25621f20396d06f5ac8aa7a2e">AST_T38_REFUSED</a>)</div><div class="line"><a name="l03125"></a><span class="lineno"> 3125</span>&#160;      || (gateway-&gt;<a class="code" href="../../dd/dd2/structfax__gateway.html#a37f4333f3e7eaf12966069b77dac704e">t38_state</a> == <a class="code" href="../../d5/d7b/channel_8h.html#a4cd990f4c1cd0c2af6e4c63f6d15b4e1afa1eab36050476591f803c3e234c2ed1">T38_STATE_NEGOTIATING</a> &amp;&amp; control_params-&gt;<a class="code" href="../../d5/def/structast__control__t38__parameters.html#adb36822366e10ce64ca8337c512732a6">request_response</a> == <a class="code" href="../../d6/d66/include_2asterisk_2frame_8h.html#a168d496bdac09ece3ce49cf473bbdb4bab75e46d3212a2a886143d874c78a1e3c">AST_T38_REQUEST_TERMINATE</a>)) {</div><div class="line"><a name="l03126"></a><span class="lineno"> 3126</span>&#160;</div><div class="line"><a name="l03127"></a><span class="lineno"> 3127</span>&#160;      <span class="keywordflow">return</span> f;</div><div class="line"><a name="l03128"></a><span class="lineno"> 3128</span>&#160;   }</div><div class="line"><a name="l03129"></a><span class="lineno"> 3129</span>&#160;</div><div class="line"><a name="l03130"></a><span class="lineno"> 3130</span>&#160;   <span class="keywordflow">if</span> (!(details = <a class="code" href="../../d0/d60/res__fax_8c.html#aa42f3331d32fc2fd92010023c6100322">find_details</a>(chan))) {</div><div class="line"><a name="l03131"></a><span class="lineno"> 3131</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;no FAX session details found on chan %s for T.38 gateway session, odd\n&quot;</span>, <a class="code" href="../../d5/d7b/channel_8h.html#a7ca2fda13b129a55c251b56729de285b">ast_channel_name</a>(chan));</div><div class="line"><a name="l03132"></a><span class="lineno"> 3132</span>&#160;      <a class="code" href="../../db/d3c/framehook_8h.html#a6e116259cae8c1e5cca074d05f0a3475">ast_framehook_detach</a>(chan, gateway-&gt;<a class="code" href="../../dd/dd2/structfax__gateway.html#ae25f61b5aa8877dfb396fd378c6b7722">framehook</a>);</div><div class="line"><a name="l03133"></a><span class="lineno"> 3133</span>&#160;      <span class="keywordflow">return</span> f;</div><div class="line"><a name="l03134"></a><span class="lineno"> 3134</span>&#160;   }</div><div class="line"><a name="l03135"></a><span class="lineno"> 3135</span>&#160;</div><div class="line"><a name="l03136"></a><span class="lineno"> 3136</span>&#160;   <span class="keywordflow">if</span> (control_params-&gt;<a class="code" href="../../d5/def/structast__control__t38__parameters.html#adb36822366e10ce64ca8337c512732a6">request_response</a> == <a class="code" href="../../d6/d66/include_2asterisk_2frame_8h.html#a168d496bdac09ece3ce49cf473bbdb4bafdb1ca68d683c64301c4cf07463a9975">AST_T38_REQUEST_NEGOTIATE</a>) {</div><div class="line"><a name="l03137"></a><span class="lineno"> 3137</span>&#160;      <a class="code" href="../../d5/d7b/channel_8h.html#af476c537b29be3f29240489032f9db39">ast_channel_unlock</a>(chan);</div><div class="line"><a name="l03138"></a><span class="lineno"> 3138</span>&#160;      state_other = <a class="code" href="../../d5/d7b/channel_8h.html#a1b22ea5302ef183fa68bc45bfb0659c9">ast_channel_get_t38_state</a>(other);</div><div class="line"><a name="l03139"></a><span class="lineno"> 3139</span>&#160;      <a class="code" href="../../d5/d7b/channel_8h.html#a493bdebe876caafb8ee535853310364a">ast_channel_lock</a>(chan);</div><div class="line"><a name="l03140"></a><span class="lineno"> 3140</span>&#160;</div><div class="line"><a name="l03141"></a><span class="lineno"> 3141</span>&#160;      <span class="keywordflow">if</span> (state_other == <a class="code" href="../../d5/d7b/channel_8h.html#a4cd990f4c1cd0c2af6e4c63f6d15b4e1ab6834ded836bd85b489322f04984d274">T38_STATE_UNKNOWN</a>) {</div><div class="line"><a name="l03142"></a><span class="lineno"> 3142</span>&#160;         <span class="comment">/* we detected a request to negotiate T.38 and the</span></div><div class="line"><a name="l03143"></a><span class="lineno"> 3143</span>&#160;<span class="comment">          * other channel appears to support T.38, we&#39;ll pass</span></div><div class="line"><a name="l03144"></a><span class="lineno"> 3144</span>&#160;<span class="comment">          * the request through and only step in if the other</span></div><div class="line"><a name="l03145"></a><span class="lineno"> 3145</span>&#160;<span class="comment">          * channel rejects the request */</span></div><div class="line"><a name="l03146"></a><span class="lineno"> 3146</span>&#160;         <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(1, <span class="stringliteral">&quot;%s is attempting to negotiate T.38 with %s, we&#39;ll see what happens\n&quot;</span>, <a class="code" href="../../d5/d7b/channel_8h.html#a7ca2fda13b129a55c251b56729de285b">ast_channel_name</a>(active), <a class="code" href="../../d5/d7b/channel_8h.html#a7ca2fda13b129a55c251b56729de285b">ast_channel_name</a>(other));</div><div class="line"><a name="l03147"></a><span class="lineno"> 3147</span>&#160;         <a class="code" href="../../d0/d60/res__fax_8c.html#aa9ea5a83822d7365075730ddb8490d23">t38_parameters_ast_to_fax</a>(&amp;details-&gt;<a class="code" href="../../d8/dc2/structast__fax__session__details.html#a12cc2bfdcc88e94984d001cca6fefdc5">their_t38_parameters</a>, control_params);</div><div class="line"><a name="l03148"></a><span class="lineno"> 3148</span>&#160;         gateway-&gt;<a class="code" href="../../dd/dd2/structfax__gateway.html#a37f4333f3e7eaf12966069b77dac704e">t38_state</a> = <a class="code" href="../../d5/d7b/channel_8h.html#a4cd990f4c1cd0c2af6e4c63f6d15b4e1ab6834ded836bd85b489322f04984d274">T38_STATE_UNKNOWN</a>;</div><div class="line"><a name="l03149"></a><span class="lineno"> 3149</span>&#160;         gateway-&gt;<a class="code" href="../../dd/dd2/structfax__gateway.html#a23b38dad7025290be3461b4b3208b4e6">timeout_start</a> = <a class="code" href="../../de/df7/time_8h.html#ad3899efb6f0e348556ef69f5b16aa7f7">ast_tvnow</a>();</div><div class="line"><a name="l03150"></a><span class="lineno"> 3150</span>&#160;         details-&gt;<a class="code" href="../../d8/dc2/structast__fax__session__details.html#aa3cf325797b2746fbd79f34b2fd45370">is_t38_negotiated</a> = 0;</div><div class="line"><a name="l03151"></a><span class="lineno"> 3151</span>&#160;         details-&gt;<a class="code" href="../../d8/dc2/structast__fax__session__details.html#a3ef48556ce45595f874faa2368bc3cfa">gateway_timeout</a> = <a class="code" href="../../d0/d60/res__fax_8c.html#ac63658a749ab21cd75126580a69a789a">FAX_GATEWAY_TIMEOUT</a>;</div><div class="line"><a name="l03152"></a><span class="lineno"> 3152</span>&#160;         <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(details, -1);</div><div class="line"><a name="l03153"></a><span class="lineno"> 3153</span>&#160;         <span class="keywordflow">return</span> f;</div><div class="line"><a name="l03154"></a><span class="lineno"> 3154</span>&#160;      } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (state_other == <a class="code" href="../../d5/d7b/channel_8h.html#a4cd990f4c1cd0c2af6e4c63f6d15b4e1a8bd9e539fb6a17b095fb24a75e0b4d21">T38_STATE_UNAVAILABLE</a> || state_other == <a class="code" href="../../d5/d7b/channel_8h.html#a4cd990f4c1cd0c2af6e4c63f6d15b4e1ad3745918c0830d3816e5ce5561814e7e">T38_STATE_REJECTED</a>) {</div><div class="line"><a name="l03155"></a><span class="lineno"> 3155</span>&#160;         <span class="comment">/* the other channel does not support T.38, we need to</span></div><div class="line"><a name="l03156"></a><span class="lineno"> 3156</span>&#160;<span class="comment">          * step in here */</span></div><div class="line"><a name="l03157"></a><span class="lineno"> 3157</span>&#160;         <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(1, <span class="stringliteral">&quot;%s is attempting to negotiate T.38 but %s does not support it\n&quot;</span>, <a class="code" href="../../d5/d7b/channel_8h.html#a7ca2fda13b129a55c251b56729de285b">ast_channel_name</a>(active), <a class="code" href="../../d5/d7b/channel_8h.html#a7ca2fda13b129a55c251b56729de285b">ast_channel_name</a>(other));</div><div class="line"><a name="l03158"></a><span class="lineno"> 3158</span>&#160;         <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(1, <span class="stringliteral">&quot;starting T.38 gateway for T.38 channel %s and G.711 channel %s\n&quot;</span>, <a class="code" href="../../d5/d7b/channel_8h.html#a7ca2fda13b129a55c251b56729de285b">ast_channel_name</a>(active), <a class="code" href="../../d5/d7b/channel_8h.html#a7ca2fda13b129a55c251b56729de285b">ast_channel_name</a>(other));</div><div class="line"><a name="l03159"></a><span class="lineno"> 3159</span>&#160;</div><div class="line"><a name="l03160"></a><span class="lineno"> 3160</span>&#160;         <a class="code" href="../../d0/d60/res__fax_8c.html#aa9ea5a83822d7365075730ddb8490d23">t38_parameters_ast_to_fax</a>(&amp;details-&gt;<a class="code" href="../../d8/dc2/structast__fax__session__details.html#a12cc2bfdcc88e94984d001cca6fefdc5">their_t38_parameters</a>, control_params);</div><div class="line"><a name="l03161"></a><span class="lineno"> 3161</span>&#160;         <a class="code" href="../../d0/d60/res__fax_8c.html#a624525cc48cff52d5ae4e5e50895e81e">t38_parameters_fax_to_ast</a>(control_params, &amp;details-&gt;<a class="code" href="../../d8/dc2/structast__fax__session__details.html#a80632865b575d06f319ef95c42645b2c">our_t38_parameters</a>);</div><div class="line"><a name="l03162"></a><span class="lineno"> 3162</span>&#160;</div><div class="line"><a name="l03163"></a><span class="lineno"> 3163</span>&#160;         <span class="keywordflow">if</span> (<a class="code" href="../../d0/d60/res__fax_8c.html#a0a1efd136d28f11d18bfa7cf927ff5ea">fax_gateway_start</a>(gateway, details, chan)) {</div><div class="line"><a name="l03164"></a><span class="lineno"> 3164</span>&#160;            <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;error starting T.38 gateway for T.38 channel %s and G.711 channel %s\n&quot;</span>, <a class="code" href="../../d5/d7b/channel_8h.html#a7ca2fda13b129a55c251b56729de285b">ast_channel_name</a>(active), <a class="code" href="../../d5/d7b/channel_8h.html#a7ca2fda13b129a55c251b56729de285b">ast_channel_name</a>(other));</div><div class="line"><a name="l03165"></a><span class="lineno"> 3165</span>&#160;            gateway-&gt;<a class="code" href="../../dd/dd2/structfax__gateway.html#a37f4333f3e7eaf12966069b77dac704e">t38_state</a> = <a class="code" href="../../d5/d7b/channel_8h.html#a4cd990f4c1cd0c2af6e4c63f6d15b4e1ad3745918c0830d3816e5ce5561814e7e">T38_STATE_REJECTED</a>;</div><div class="line"><a name="l03166"></a><span class="lineno"> 3166</span>&#160;            details-&gt;<a class="code" href="../../d8/dc2/structast__fax__session__details.html#aa3cf325797b2746fbd79f34b2fd45370">is_t38_negotiated</a> = 0;</div><div class="line"><a name="l03167"></a><span class="lineno"> 3167</span>&#160;            control_params-&gt;<a class="code" href="../../d5/def/structast__control__t38__parameters.html#adb36822366e10ce64ca8337c512732a6">request_response</a> = <a class="code" href="../../d6/d66/include_2asterisk_2frame_8h.html#a168d496bdac09ece3ce49cf473bbdb4baa02b30f25621f20396d06f5ac8aa7a2e">AST_T38_REFUSED</a>;</div><div class="line"><a name="l03168"></a><span class="lineno"> 3168</span>&#160;</div><div class="line"><a name="l03169"></a><span class="lineno"> 3169</span>&#160;            <a class="code" href="../../db/d3c/framehook_8h.html#a6e116259cae8c1e5cca074d05f0a3475">ast_framehook_detach</a>(chan, details-&gt;<a class="code" href="../../d8/dc2/structast__fax__session__details.html#a2a669261b0b8c26d26573c678149d312">gateway_id</a>);</div><div class="line"><a name="l03170"></a><span class="lineno"> 3170</span>&#160;            details-&gt;<a class="code" href="../../d8/dc2/structast__fax__session__details.html#a2a669261b0b8c26d26573c678149d312">gateway_id</a> = -1;</div><div class="line"><a name="l03171"></a><span class="lineno"> 3171</span>&#160;         } <span class="keywordflow">else</span> {</div><div class="line"><a name="l03172"></a><span class="lineno"> 3172</span>&#160;            gateway-&gt;<a class="code" href="../../dd/dd2/structfax__gateway.html#a37f4333f3e7eaf12966069b77dac704e">t38_state</a> = <a class="code" href="../../d5/d7b/channel_8h.html#a4cd990f4c1cd0c2af6e4c63f6d15b4e1af142c79721a025bd65edad812f0725e0">T38_STATE_NEGOTIATED</a>;</div><div class="line"><a name="l03173"></a><span class="lineno"> 3173</span>&#160;            details-&gt;<a class="code" href="../../d8/dc2/structast__fax__session__details.html#aa3cf325797b2746fbd79f34b2fd45370">is_t38_negotiated</a> = chan == active;</div><div class="line"><a name="l03174"></a><span class="lineno"> 3174</span>&#160;            control_params-&gt;<a class="code" href="../../d5/def/structast__control__t38__parameters.html#adb36822366e10ce64ca8337c512732a6">request_response</a> = <a class="code" href="../../d6/d66/include_2asterisk_2frame_8h.html#a168d496bdac09ece3ce49cf473bbdb4bad501e0d5fe272eaba466507a686a2df5">AST_T38_NEGOTIATED</a>;</div><div class="line"><a name="l03175"></a><span class="lineno"> 3175</span>&#160;            <a class="code" href="../../d0/d60/res__fax_8c.html#a38d73af44b480b7cad7a654f75926777">report_fax_status</a>(chan, details, <span class="stringliteral">&quot;T.38 Negotiated&quot;</span>);</div><div class="line"><a name="l03176"></a><span class="lineno"> 3176</span>&#160;         }</div><div class="line"><a name="l03177"></a><span class="lineno"> 3177</span>&#160;</div><div class="line"><a name="l03178"></a><span class="lineno"> 3178</span>&#160;         <a class="code" href="../../d0/d60/res__fax_8c.html#a23b5336ddff8d963dbeb84251845721d">fax_gateway_indicate_t38</a>(chan, active, control_params);</div><div class="line"><a name="l03179"></a><span class="lineno"> 3179</span>&#160;</div><div class="line"><a name="l03180"></a><span class="lineno"> 3180</span>&#160;         <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(details, -1);</div><div class="line"><a name="l03181"></a><span class="lineno"> 3181</span>&#160;         <span class="keywordflow">return</span> &amp;<a class="code" href="../../d6/d66/include_2asterisk_2frame_8h.html#af203379aca2fd704fe8d86a9445596b6">ast_null_frame</a>;</div><div class="line"><a name="l03182"></a><span class="lineno"> 3182</span>&#160;      } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (gateway-&gt;<a class="code" href="../../dd/dd2/structfax__gateway.html#a37f4333f3e7eaf12966069b77dac704e">t38_state</a> == <a class="code" href="../../d5/d7b/channel_8h.html#a4cd990f4c1cd0c2af6e4c63f6d15b4e1afa1eab36050476591f803c3e234c2ed1">T38_STATE_NEGOTIATING</a>) {</div><div class="line"><a name="l03183"></a><span class="lineno"> 3183</span>&#160;         <span class="comment">/* we got a request to negotiate T.38 after we already</span></div><div class="line"><a name="l03184"></a><span class="lineno"> 3184</span>&#160;<span class="comment">          * sent one to the other party based on v21 preamble</span></div><div class="line"><a name="l03185"></a><span class="lineno"> 3185</span>&#160;<span class="comment">          * detection. We&#39;ll just pretend we passed this request</span></div><div class="line"><a name="l03186"></a><span class="lineno"> 3186</span>&#160;<span class="comment">          * through in the first place. */</span></div><div class="line"><a name="l03187"></a><span class="lineno"> 3187</span>&#160;</div><div class="line"><a name="l03188"></a><span class="lineno"> 3188</span>&#160;         <a class="code" href="../../d0/d60/res__fax_8c.html#aa9ea5a83822d7365075730ddb8490d23">t38_parameters_ast_to_fax</a>(&amp;details-&gt;<a class="code" href="../../d8/dc2/structast__fax__session__details.html#a12cc2bfdcc88e94984d001cca6fefdc5">their_t38_parameters</a>, control_params);</div><div class="line"><a name="l03189"></a><span class="lineno"> 3189</span>&#160;         gateway-&gt;<a class="code" href="../../dd/dd2/structfax__gateway.html#a37f4333f3e7eaf12966069b77dac704e">t38_state</a> = <a class="code" href="../../d5/d7b/channel_8h.html#a4cd990f4c1cd0c2af6e4c63f6d15b4e1ab6834ded836bd85b489322f04984d274">T38_STATE_UNKNOWN</a>;</div><div class="line"><a name="l03190"></a><span class="lineno"> 3190</span>&#160;         gateway-&gt;<a class="code" href="../../dd/dd2/structfax__gateway.html#a23b38dad7025290be3461b4b3208b4e6">timeout_start</a> = <a class="code" href="../../de/df7/time_8h.html#ad3899efb6f0e348556ef69f5b16aa7f7">ast_tvnow</a>();</div><div class="line"><a name="l03191"></a><span class="lineno"> 3191</span>&#160;         details-&gt;<a class="code" href="../../d8/dc2/structast__fax__session__details.html#aa3cf325797b2746fbd79f34b2fd45370">is_t38_negotiated</a> = 0;</div><div class="line"><a name="l03192"></a><span class="lineno"> 3192</span>&#160;         details-&gt;<a class="code" href="../../d8/dc2/structast__fax__session__details.html#a3ef48556ce45595f874faa2368bc3cfa">gateway_timeout</a> = <a class="code" href="../../d0/d60/res__fax_8c.html#ac63658a749ab21cd75126580a69a789a">FAX_GATEWAY_TIMEOUT</a>;</div><div class="line"><a name="l03193"></a><span class="lineno"> 3193</span>&#160;</div><div class="line"><a name="l03194"></a><span class="lineno"> 3194</span>&#160;         <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(1, <span class="stringliteral">&quot;%s is attempting to negotiate T.38 after we already sent a negotiation request based on v21 preamble detection\n&quot;</span>, <a class="code" href="../../d5/d7b/channel_8h.html#a7ca2fda13b129a55c251b56729de285b">ast_channel_name</a>(active));</div><div class="line"><a name="l03195"></a><span class="lineno"> 3195</span>&#160;         <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(details, -1);</div><div class="line"><a name="l03196"></a><span class="lineno"> 3196</span>&#160;         <span class="keywordflow">return</span> &amp;<a class="code" href="../../d6/d66/include_2asterisk_2frame_8h.html#af203379aca2fd704fe8d86a9445596b6">ast_null_frame</a>;</div><div class="line"><a name="l03197"></a><span class="lineno"> 3197</span>&#160;      } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (gateway-&gt;<a class="code" href="../../dd/dd2/structfax__gateway.html#a37f4333f3e7eaf12966069b77dac704e">t38_state</a> == <a class="code" href="../../d5/d7b/channel_8h.html#a4cd990f4c1cd0c2af6e4c63f6d15b4e1af142c79721a025bd65edad812f0725e0">T38_STATE_NEGOTIATED</a>) {</div><div class="line"><a name="l03198"></a><span class="lineno"> 3198</span>&#160;         <span class="comment">/* we got a request to negotiate T.38 after we already</span></div><div class="line"><a name="l03199"></a><span class="lineno"> 3199</span>&#160;<span class="comment">          * sent one to the other party based on v21 preamble</span></div><div class="line"><a name="l03200"></a><span class="lineno"> 3200</span>&#160;<span class="comment">          * detection and received a response. We need to</span></div><div class="line"><a name="l03201"></a><span class="lineno"> 3201</span>&#160;<span class="comment">          * respond to this and shut down the gateway. */</span></div><div class="line"><a name="l03202"></a><span class="lineno"> 3202</span>&#160;</div><div class="line"><a name="l03203"></a><span class="lineno"> 3203</span>&#160;         <a class="code" href="../../d0/d60/res__fax_8c.html#a624525cc48cff52d5ae4e5e50895e81e">t38_parameters_fax_to_ast</a>(control_params, &amp;details-&gt;<a class="code" href="../../d8/dc2/structast__fax__session__details.html#a12cc2bfdcc88e94984d001cca6fefdc5">their_t38_parameters</a>);</div><div class="line"><a name="l03204"></a><span class="lineno"> 3204</span>&#160;         <a class="code" href="../../db/d3c/framehook_8h.html#a6e116259cae8c1e5cca074d05f0a3475">ast_framehook_detach</a>(chan, details-&gt;<a class="code" href="../../d8/dc2/structast__fax__session__details.html#a2a669261b0b8c26d26573c678149d312">gateway_id</a>);</div><div class="line"><a name="l03205"></a><span class="lineno"> 3205</span>&#160;         details-&gt;<a class="code" href="../../d8/dc2/structast__fax__session__details.html#a2a669261b0b8c26d26573c678149d312">gateway_id</a> = -1;</div><div class="line"><a name="l03206"></a><span class="lineno"> 3206</span>&#160;</div><div class="line"><a name="l03207"></a><span class="lineno"> 3207</span>&#160;         control_params-&gt;<a class="code" href="../../d5/def/structast__control__t38__parameters.html#adb36822366e10ce64ca8337c512732a6">request_response</a> = <a class="code" href="../../d6/d66/include_2asterisk_2frame_8h.html#a168d496bdac09ece3ce49cf473bbdb4bad501e0d5fe272eaba466507a686a2df5">AST_T38_NEGOTIATED</a>;</div><div class="line"><a name="l03208"></a><span class="lineno"> 3208</span>&#160;</div><div class="line"><a name="l03209"></a><span class="lineno"> 3209</span>&#160;         <a class="code" href="../../d0/d60/res__fax_8c.html#a23b5336ddff8d963dbeb84251845721d">fax_gateway_indicate_t38</a>(chan, active, control_params);</div><div class="line"><a name="l03210"></a><span class="lineno"> 3210</span>&#160;</div><div class="line"><a name="l03211"></a><span class="lineno"> 3211</span>&#160;         <a class="code" href="../../d1/d0f/stringfields_8h.html#a653461abd6e0d16e4e3326ab90e0501d">ast_string_field_set</a>(details, <a class="code" href="../../de/d1b/cel__pgsql_8c.html#ad6c487210772a9b4b0ca04b04b847d4c">result</a>, <span class="stringliteral">&quot;SUCCESS&quot;</span>);</div><div class="line"><a name="l03212"></a><span class="lineno"> 3212</span>&#160;         <a class="code" href="../../d1/d0f/stringfields_8h.html#a653461abd6e0d16e4e3326ab90e0501d">ast_string_field_set</a>(details, <a class="code" href="../../d8/dc2/structast__fax__session__details.html#a8e155783a5296f8607948dfbe5783933">resultstr</a>, <span class="stringliteral">&quot;no gateway necessary&quot;</span>);</div><div class="line"><a name="l03213"></a><span class="lineno"> 3213</span>&#160;         <a class="code" href="../../d1/d0f/stringfields_8h.html#a653461abd6e0d16e4e3326ab90e0501d">ast_string_field_set</a>(details, <a class="code" href="../../d6/d47/utils_2frame_8c.html#a4a9391ee88e57361b613c4c2fd2bf4aa">error</a>, <span class="stringliteral">&quot;NATIVE_T38&quot;</span>);</div><div class="line"><a name="l03214"></a><span class="lineno"> 3214</span>&#160;         details-&gt;<a class="code" href="../../d8/dc2/structast__fax__session__details.html#aa3cf325797b2746fbd79f34b2fd45370">is_t38_negotiated</a> = 1;</div><div class="line"><a name="l03215"></a><span class="lineno"> 3215</span>&#160;         <a class="code" href="../../d0/d60/res__fax_8c.html#ad7732b5ae304d39afa2dacb20187cf04">set_channel_variables</a>(chan, details);</div><div class="line"><a name="l03216"></a><span class="lineno"> 3216</span>&#160;</div><div class="line"><a name="l03217"></a><span class="lineno"> 3217</span>&#160;         <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(1, <span class="stringliteral">&quot;%s is attempting to negotiate T.38 after we already negotiated T.38 with %s, disabling the gateway\n&quot;</span>, <a class="code" href="../../d5/d7b/channel_8h.html#a7ca2fda13b129a55c251b56729de285b">ast_channel_name</a>(active), <a class="code" href="../../d5/d7b/channel_8h.html#a7ca2fda13b129a55c251b56729de285b">ast_channel_name</a>(other));</div><div class="line"><a name="l03218"></a><span class="lineno"> 3218</span>&#160;         <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(details, -1);</div><div class="line"><a name="l03219"></a><span class="lineno"> 3219</span>&#160;         <span class="keywordflow">return</span> &amp;<a class="code" href="../../d6/d66/include_2asterisk_2frame_8h.html#af203379aca2fd704fe8d86a9445596b6">ast_null_frame</a>;</div><div class="line"><a name="l03220"></a><span class="lineno"> 3220</span>&#160;      } <span class="keywordflow">else</span> {</div><div class="line"><a name="l03221"></a><span class="lineno"> 3221</span>&#160;         <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;%s is attempting to negotiate T.38 while %s is in an unsupported state\n&quot;</span>, <a class="code" href="../../d5/d7b/channel_8h.html#a7ca2fda13b129a55c251b56729de285b">ast_channel_name</a>(active), <a class="code" href="../../d5/d7b/channel_8h.html#a7ca2fda13b129a55c251b56729de285b">ast_channel_name</a>(other));</div><div class="line"><a name="l03222"></a><span class="lineno"> 3222</span>&#160;         <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(details, -1);</div><div class="line"><a name="l03223"></a><span class="lineno"> 3223</span>&#160;         <span class="keywordflow">return</span> f;</div><div class="line"><a name="l03224"></a><span class="lineno"> 3224</span>&#160;      }</div><div class="line"><a name="l03225"></a><span class="lineno"> 3225</span>&#160;   } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (gateway-&gt;<a class="code" href="../../dd/dd2/structfax__gateway.html#a37f4333f3e7eaf12966069b77dac704e">t38_state</a> == <a class="code" href="../../d5/d7b/channel_8h.html#a4cd990f4c1cd0c2af6e4c63f6d15b4e1afa1eab36050476591f803c3e234c2ed1">T38_STATE_NEGOTIATING</a></div><div class="line"><a name="l03226"></a><span class="lineno"> 3226</span>&#160;      &amp;&amp; control_params-&gt;<a class="code" href="../../d5/def/structast__control__t38__parameters.html#adb36822366e10ce64ca8337c512732a6">request_response</a> == <a class="code" href="../../d6/d66/include_2asterisk_2frame_8h.html#a168d496bdac09ece3ce49cf473bbdb4baa02b30f25621f20396d06f5ac8aa7a2e">AST_T38_REFUSED</a>) {</div><div class="line"><a name="l03227"></a><span class="lineno"> 3227</span>&#160;</div><div class="line"><a name="l03228"></a><span class="lineno"> 3228</span>&#160;      <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(1, <span class="stringliteral">&quot;unable to negotiate T.38 on %s for fax gateway\n&quot;</span>, <a class="code" href="../../d5/d7b/channel_8h.html#a7ca2fda13b129a55c251b56729de285b">ast_channel_name</a>(active));</div><div class="line"><a name="l03229"></a><span class="lineno"> 3229</span>&#160;      details-&gt;<a class="code" href="../../d8/dc2/structast__fax__session__details.html#aa3cf325797b2746fbd79f34b2fd45370">is_t38_negotiated</a> = 0;</div><div class="line"><a name="l03230"></a><span class="lineno"> 3230</span>&#160;</div><div class="line"><a name="l03231"></a><span class="lineno"> 3231</span>&#160;      <span class="comment">/* our request to negotiate T.38 was refused, if the other</span></div><div class="line"><a name="l03232"></a><span class="lineno"> 3232</span>&#160;<span class="comment">       * channel supports T.38, they might still reinvite and save</span></div><div class="line"><a name="l03233"></a><span class="lineno"> 3233</span>&#160;<span class="comment">       * the day.  Otherwise disable the gateway. */</span></div><div class="line"><a name="l03234"></a><span class="lineno"> 3234</span>&#160;      <a class="code" href="../../d5/d7b/channel_8h.html#af476c537b29be3f29240489032f9db39">ast_channel_unlock</a>(chan);</div><div class="line"><a name="l03235"></a><span class="lineno"> 3235</span>&#160;      state_other = <a class="code" href="../../d5/d7b/channel_8h.html#a1b22ea5302ef183fa68bc45bfb0659c9">ast_channel_get_t38_state</a>(other);</div><div class="line"><a name="l03236"></a><span class="lineno"> 3236</span>&#160;      <a class="code" href="../../d5/d7b/channel_8h.html#a493bdebe876caafb8ee535853310364a">ast_channel_lock</a>(chan);</div><div class="line"><a name="l03237"></a><span class="lineno"> 3237</span>&#160;      <span class="keywordflow">if</span> (state_other == <a class="code" href="../../d5/d7b/channel_8h.html#a4cd990f4c1cd0c2af6e4c63f6d15b4e1ab6834ded836bd85b489322f04984d274">T38_STATE_UNKNOWN</a>) {</div><div class="line"><a name="l03238"></a><span class="lineno"> 3238</span>&#160;         gateway-&gt;<a class="code" href="../../dd/dd2/structfax__gateway.html#a37f4333f3e7eaf12966069b77dac704e">t38_state</a> = <a class="code" href="../../d5/d7b/channel_8h.html#a4cd990f4c1cd0c2af6e4c63f6d15b4e1a8bd9e539fb6a17b095fb24a75e0b4d21">T38_STATE_UNAVAILABLE</a>;</div><div class="line"><a name="l03239"></a><span class="lineno"> 3239</span>&#160;      } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (state_other != <a class="code" href="../../d5/d7b/channel_8h.html#a4cd990f4c1cd0c2af6e4c63f6d15b4e1afa1eab36050476591f803c3e234c2ed1">T38_STATE_NEGOTIATING</a>) {</div><div class="line"><a name="l03240"></a><span class="lineno"> 3240</span>&#160;         <a class="code" href="../../db/d3c/framehook_8h.html#a6e116259cae8c1e5cca074d05f0a3475">ast_framehook_detach</a>(chan, details-&gt;<a class="code" href="../../d8/dc2/structast__fax__session__details.html#a2a669261b0b8c26d26573c678149d312">gateway_id</a>);</div><div class="line"><a name="l03241"></a><span class="lineno"> 3241</span>&#160;         details-&gt;<a class="code" href="../../d8/dc2/structast__fax__session__details.html#a2a669261b0b8c26d26573c678149d312">gateway_id</a> = -1;</div><div class="line"><a name="l03242"></a><span class="lineno"> 3242</span>&#160;</div><div class="line"><a name="l03243"></a><span class="lineno"> 3243</span>&#160;         <a class="code" href="../../d1/d0f/stringfields_8h.html#a653461abd6e0d16e4e3326ab90e0501d">ast_string_field_set</a>(details, <a class="code" href="../../de/d1b/cel__pgsql_8c.html#ad6c487210772a9b4b0ca04b04b847d4c">result</a>, <span class="stringliteral">&quot;FAILED&quot;</span>);</div><div class="line"><a name="l03244"></a><span class="lineno"> 3244</span>&#160;         <a class="code" href="../../d1/d0f/stringfields_8h.html#a653461abd6e0d16e4e3326ab90e0501d">ast_string_field_set</a>(details, <a class="code" href="../../d8/dc2/structast__fax__session__details.html#a8e155783a5296f8607948dfbe5783933">resultstr</a>, <span class="stringliteral">&quot;unable to negotiate T.38&quot;</span>);</div><div class="line"><a name="l03245"></a><span class="lineno"> 3245</span>&#160;         <a class="code" href="../../d1/d0f/stringfields_8h.html#a653461abd6e0d16e4e3326ab90e0501d">ast_string_field_set</a>(details, <a class="code" href="../../d6/d47/utils_2frame_8c.html#a4a9391ee88e57361b613c4c2fd2bf4aa">error</a>, <span class="stringliteral">&quot;T38_NEG_ERROR&quot;</span>);</div><div class="line"><a name="l03246"></a><span class="lineno"> 3246</span>&#160;         <a class="code" href="../../d0/d60/res__fax_8c.html#ad7732b5ae304d39afa2dacb20187cf04">set_channel_variables</a>(chan, details);</div><div class="line"><a name="l03247"></a><span class="lineno"> 3247</span>&#160;      }</div><div class="line"><a name="l03248"></a><span class="lineno"> 3248</span>&#160;</div><div class="line"><a name="l03249"></a><span class="lineno"> 3249</span>&#160;      <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(details, -1);</div><div class="line"><a name="l03250"></a><span class="lineno"> 3250</span>&#160;      <span class="keywordflow">return</span> &amp;<a class="code" href="../../d6/d66/include_2asterisk_2frame_8h.html#af203379aca2fd704fe8d86a9445596b6">ast_null_frame</a>;</div><div class="line"><a name="l03251"></a><span class="lineno"> 3251</span>&#160;   } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (gateway-&gt;<a class="code" href="../../dd/dd2/structfax__gateway.html#a37f4333f3e7eaf12966069b77dac704e">t38_state</a> == <a class="code" href="../../d5/d7b/channel_8h.html#a4cd990f4c1cd0c2af6e4c63f6d15b4e1afa1eab36050476591f803c3e234c2ed1">T38_STATE_NEGOTIATING</a></div><div class="line"><a name="l03252"></a><span class="lineno"> 3252</span>&#160;      &amp;&amp; control_params-&gt;<a class="code" href="../../d5/def/structast__control__t38__parameters.html#adb36822366e10ce64ca8337c512732a6">request_response</a> == <a class="code" href="../../d6/d66/include_2asterisk_2frame_8h.html#a168d496bdac09ece3ce49cf473bbdb4bad501e0d5fe272eaba466507a686a2df5">AST_T38_NEGOTIATED</a>) {</div><div class="line"><a name="l03253"></a><span class="lineno"> 3253</span>&#160;</div><div class="line"><a name="l03254"></a><span class="lineno"> 3254</span>&#160;      <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(1, <span class="stringliteral">&quot;starting T.38 gateway for T.38 channel %s and G.711 channel %s\n&quot;</span>, <a class="code" href="../../d5/d7b/channel_8h.html#a7ca2fda13b129a55c251b56729de285b">ast_channel_name</a>(active), <a class="code" href="../../d5/d7b/channel_8h.html#a7ca2fda13b129a55c251b56729de285b">ast_channel_name</a>(other));</div><div class="line"><a name="l03255"></a><span class="lineno"> 3255</span>&#160;</div><div class="line"><a name="l03256"></a><span class="lineno"> 3256</span>&#160;      <a class="code" href="../../d0/d60/res__fax_8c.html#aa9ea5a83822d7365075730ddb8490d23">t38_parameters_ast_to_fax</a>(&amp;details-&gt;<a class="code" href="../../d8/dc2/structast__fax__session__details.html#a12cc2bfdcc88e94984d001cca6fefdc5">their_t38_parameters</a>, control_params);</div><div class="line"><a name="l03257"></a><span class="lineno"> 3257</span>&#160;</div><div class="line"><a name="l03258"></a><span class="lineno"> 3258</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="../../d0/d60/res__fax_8c.html#a0a1efd136d28f11d18bfa7cf927ff5ea">fax_gateway_start</a>(gateway, details, chan)) {</div><div class="line"><a name="l03259"></a><span class="lineno"> 3259</span>&#160;         <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;error starting T.38 gateway for T.38 channel %s and G.711 channel %s\n&quot;</span>, <a class="code" href="../../d5/d7b/channel_8h.html#a7ca2fda13b129a55c251b56729de285b">ast_channel_name</a>(active), <a class="code" href="../../d5/d7b/channel_8h.html#a7ca2fda13b129a55c251b56729de285b">ast_channel_name</a>(other));</div><div class="line"><a name="l03260"></a><span class="lineno"> 3260</span>&#160;         gateway-&gt;<a class="code" href="../../dd/dd2/structfax__gateway.html#a37f4333f3e7eaf12966069b77dac704e">t38_state</a> = <a class="code" href="../../d5/d7b/channel_8h.html#a4cd990f4c1cd0c2af6e4c63f6d15b4e1afa1eab36050476591f803c3e234c2ed1">T38_STATE_NEGOTIATING</a>;</div><div class="line"><a name="l03261"></a><span class="lineno"> 3261</span>&#160;         details-&gt;<a class="code" href="../../d8/dc2/structast__fax__session__details.html#aa3cf325797b2746fbd79f34b2fd45370">is_t38_negotiated</a> = 0;</div><div class="line"><a name="l03262"></a><span class="lineno"> 3262</span>&#160;         control_params-&gt;<a class="code" href="../../d5/def/structast__control__t38__parameters.html#adb36822366e10ce64ca8337c512732a6">request_response</a> = <a class="code" href="../../d6/d66/include_2asterisk_2frame_8h.html#a168d496bdac09ece3ce49cf473bbdb4bab75e46d3212a2a886143d874c78a1e3c">AST_T38_REQUEST_TERMINATE</a>;</div><div class="line"><a name="l03263"></a><span class="lineno"> 3263</span>&#160;</div><div class="line"><a name="l03264"></a><span class="lineno"> 3264</span>&#160;         <a class="code" href="../../d0/d60/res__fax_8c.html#a23b5336ddff8d963dbeb84251845721d">fax_gateway_indicate_t38</a>(chan, active, control_params);</div><div class="line"><a name="l03265"></a><span class="lineno"> 3265</span>&#160;      } <span class="keywordflow">else</span> {</div><div class="line"><a name="l03266"></a><span class="lineno"> 3266</span>&#160;         gateway-&gt;<a class="code" href="../../dd/dd2/structfax__gateway.html#a37f4333f3e7eaf12966069b77dac704e">t38_state</a> = <a class="code" href="../../d5/d7b/channel_8h.html#a4cd990f4c1cd0c2af6e4c63f6d15b4e1af142c79721a025bd65edad812f0725e0">T38_STATE_NEGOTIATED</a>;</div><div class="line"><a name="l03267"></a><span class="lineno"> 3267</span>&#160;         details-&gt;<a class="code" href="../../d8/dc2/structast__fax__session__details.html#aa3cf325797b2746fbd79f34b2fd45370">is_t38_negotiated</a> = chan == active;</div><div class="line"><a name="l03268"></a><span class="lineno"> 3268</span>&#160;         <a class="code" href="../../d0/d60/res__fax_8c.html#a38d73af44b480b7cad7a654f75926777">report_fax_status</a>(chan, details, <span class="stringliteral">&quot;T.38 Negotiated&quot;</span>);</div><div class="line"><a name="l03269"></a><span class="lineno"> 3269</span>&#160;      }</div><div class="line"><a name="l03270"></a><span class="lineno"> 3270</span>&#160;</div><div class="line"><a name="l03271"></a><span class="lineno"> 3271</span>&#160;      <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(details, -1);</div><div class="line"><a name="l03272"></a><span class="lineno"> 3272</span>&#160;      <span class="keywordflow">return</span> &amp;<a class="code" href="../../d6/d66/include_2asterisk_2frame_8h.html#af203379aca2fd704fe8d86a9445596b6">ast_null_frame</a>;</div><div class="line"><a name="l03273"></a><span class="lineno"> 3273</span>&#160;   } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (control_params-&gt;<a class="code" href="../../d5/def/structast__control__t38__parameters.html#adb36822366e10ce64ca8337c512732a6">request_response</a> == <a class="code" href="../../d6/d66/include_2asterisk_2frame_8h.html#a168d496bdac09ece3ce49cf473bbdb4baa02b30f25621f20396d06f5ac8aa7a2e">AST_T38_REFUSED</a>) {</div><div class="line"><a name="l03274"></a><span class="lineno"> 3274</span>&#160;      <span class="comment">/* the other channel refused the request to negotiate T.38,</span></div><div class="line"><a name="l03275"></a><span class="lineno"> 3275</span>&#160;<span class="comment">       * we&#39;ll step in here and pretend the request was accepted */</span></div><div class="line"><a name="l03276"></a><span class="lineno"> 3276</span>&#160;</div><div class="line"><a name="l03277"></a><span class="lineno"> 3277</span>&#160;      <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(1, <span class="stringliteral">&quot;%s attempted to negotiate T.38 but %s refused the request\n&quot;</span>, <a class="code" href="../../d5/d7b/channel_8h.html#a7ca2fda13b129a55c251b56729de285b">ast_channel_name</a>(other), <a class="code" href="../../d5/d7b/channel_8h.html#a7ca2fda13b129a55c251b56729de285b">ast_channel_name</a>(active));</div><div class="line"><a name="l03278"></a><span class="lineno"> 3278</span>&#160;      <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(1, <span class="stringliteral">&quot;starting T.38 gateway for T.38 channel %s and G.711 channel %s\n&quot;</span>, <a class="code" href="../../d5/d7b/channel_8h.html#a7ca2fda13b129a55c251b56729de285b">ast_channel_name</a>(other), <a class="code" href="../../d5/d7b/channel_8h.html#a7ca2fda13b129a55c251b56729de285b">ast_channel_name</a>(active));</div><div class="line"><a name="l03279"></a><span class="lineno"> 3279</span>&#160;</div><div class="line"><a name="l03280"></a><span class="lineno"> 3280</span>&#160;      <a class="code" href="../../d0/d60/res__fax_8c.html#a624525cc48cff52d5ae4e5e50895e81e">t38_parameters_fax_to_ast</a>(control_params, &amp;details-&gt;<a class="code" href="../../d8/dc2/structast__fax__session__details.html#a80632865b575d06f319ef95c42645b2c">our_t38_parameters</a>);</div><div class="line"><a name="l03281"></a><span class="lineno"> 3281</span>&#160;</div><div class="line"><a name="l03282"></a><span class="lineno"> 3282</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="../../d0/d60/res__fax_8c.html#a0a1efd136d28f11d18bfa7cf927ff5ea">fax_gateway_start</a>(gateway, details, chan)) {</div><div class="line"><a name="l03283"></a><span class="lineno"> 3283</span>&#160;         <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;error starting T.38 gateway for T.38 channel %s and G.711 channel %s\n&quot;</span>, <a class="code" href="../../d5/d7b/channel_8h.html#a7ca2fda13b129a55c251b56729de285b">ast_channel_name</a>(other), <a class="code" href="../../d5/d7b/channel_8h.html#a7ca2fda13b129a55c251b56729de285b">ast_channel_name</a>(active));</div><div class="line"><a name="l03284"></a><span class="lineno"> 3284</span>&#160;         gateway-&gt;<a class="code" href="../../dd/dd2/structfax__gateway.html#a37f4333f3e7eaf12966069b77dac704e">t38_state</a> = <a class="code" href="../../d5/d7b/channel_8h.html#a4cd990f4c1cd0c2af6e4c63f6d15b4e1ad3745918c0830d3816e5ce5561814e7e">T38_STATE_REJECTED</a>;</div><div class="line"><a name="l03285"></a><span class="lineno"> 3285</span>&#160;         details-&gt;<a class="code" href="../../d8/dc2/structast__fax__session__details.html#aa3cf325797b2746fbd79f34b2fd45370">is_t38_negotiated</a> = 0;</div><div class="line"><a name="l03286"></a><span class="lineno"> 3286</span>&#160;         control_params-&gt;<a class="code" href="../../d5/def/structast__control__t38__parameters.html#adb36822366e10ce64ca8337c512732a6">request_response</a> = <a class="code" href="../../d6/d66/include_2asterisk_2frame_8h.html#a168d496bdac09ece3ce49cf473bbdb4baa02b30f25621f20396d06f5ac8aa7a2e">AST_T38_REFUSED</a>;</div><div class="line"><a name="l03287"></a><span class="lineno"> 3287</span>&#160;</div><div class="line"><a name="l03288"></a><span class="lineno"> 3288</span>&#160;         <a class="code" href="../../db/d3c/framehook_8h.html#a6e116259cae8c1e5cca074d05f0a3475">ast_framehook_detach</a>(chan, details-&gt;<a class="code" href="../../d8/dc2/structast__fax__session__details.html#a2a669261b0b8c26d26573c678149d312">gateway_id</a>);</div><div class="line"><a name="l03289"></a><span class="lineno"> 3289</span>&#160;         details-&gt;<a class="code" href="../../d8/dc2/structast__fax__session__details.html#a2a669261b0b8c26d26573c678149d312">gateway_id</a> = -1;</div><div class="line"><a name="l03290"></a><span class="lineno"> 3290</span>&#160;      } <span class="keywordflow">else</span> {</div><div class="line"><a name="l03291"></a><span class="lineno"> 3291</span>&#160;         gateway-&gt;<a class="code" href="../../dd/dd2/structfax__gateway.html#a37f4333f3e7eaf12966069b77dac704e">t38_state</a> = <a class="code" href="../../d5/d7b/channel_8h.html#a4cd990f4c1cd0c2af6e4c63f6d15b4e1af142c79721a025bd65edad812f0725e0">T38_STATE_NEGOTIATED</a>;</div><div class="line"><a name="l03292"></a><span class="lineno"> 3292</span>&#160;         details-&gt;<a class="code" href="../../d8/dc2/structast__fax__session__details.html#aa3cf325797b2746fbd79f34b2fd45370">is_t38_negotiated</a> = chan == other;</div><div class="line"><a name="l03293"></a><span class="lineno"> 3293</span>&#160;         control_params-&gt;<a class="code" href="../../d5/def/structast__control__t38__parameters.html#adb36822366e10ce64ca8337c512732a6">request_response</a> = <a class="code" href="../../d6/d66/include_2asterisk_2frame_8h.html#a168d496bdac09ece3ce49cf473bbdb4bad501e0d5fe272eaba466507a686a2df5">AST_T38_NEGOTIATED</a>;</div><div class="line"><a name="l03294"></a><span class="lineno"> 3294</span>&#160;      }</div><div class="line"><a name="l03295"></a><span class="lineno"> 3295</span>&#160;</div><div class="line"><a name="l03296"></a><span class="lineno"> 3296</span>&#160;      <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(details, -1);</div><div class="line"><a name="l03297"></a><span class="lineno"> 3297</span>&#160;      <span class="keywordflow">return</span> f;</div><div class="line"><a name="l03298"></a><span class="lineno"> 3298</span>&#160;   } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (control_params-&gt;<a class="code" href="../../d5/def/structast__control__t38__parameters.html#adb36822366e10ce64ca8337c512732a6">request_response</a> == <a class="code" href="../../d6/d66/include_2asterisk_2frame_8h.html#a168d496bdac09ece3ce49cf473bbdb4bab75e46d3212a2a886143d874c78a1e3c">AST_T38_REQUEST_TERMINATE</a>) {</div><div class="line"><a name="l03299"></a><span class="lineno"> 3299</span>&#160;      <span class="comment">/* the channel wishes to end our short relationship, we shall</span></div><div class="line"><a name="l03300"></a><span class="lineno"> 3300</span>&#160;<span class="comment">       * oblige */</span></div><div class="line"><a name="l03301"></a><span class="lineno"> 3301</span>&#160;</div><div class="line"><a name="l03302"></a><span class="lineno"> 3302</span>&#160;      <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(1, <span class="stringliteral">&quot;T.38 channel %s is requesting a shutdown of T.38, disabling the gateway\n&quot;</span>, <a class="code" href="../../d5/d7b/channel_8h.html#a7ca2fda13b129a55c251b56729de285b">ast_channel_name</a>(active));</div><div class="line"><a name="l03303"></a><span class="lineno"> 3303</span>&#160;</div><div class="line"><a name="l03304"></a><span class="lineno"> 3304</span>&#160;      <a class="code" href="../../db/d3c/framehook_8h.html#a6e116259cae8c1e5cca074d05f0a3475">ast_framehook_detach</a>(chan, details-&gt;<a class="code" href="../../d8/dc2/structast__fax__session__details.html#a2a669261b0b8c26d26573c678149d312">gateway_id</a>);</div><div class="line"><a name="l03305"></a><span class="lineno"> 3305</span>&#160;      details-&gt;<a class="code" href="../../d8/dc2/structast__fax__session__details.html#a2a669261b0b8c26d26573c678149d312">gateway_id</a> = -1;</div><div class="line"><a name="l03306"></a><span class="lineno"> 3306</span>&#160;</div><div class="line"><a name="l03307"></a><span class="lineno"> 3307</span>&#160;      gateway-&gt;<a class="code" href="../../dd/dd2/structfax__gateway.html#a37f4333f3e7eaf12966069b77dac704e">t38_state</a> = <a class="code" href="../../d5/d7b/channel_8h.html#a4cd990f4c1cd0c2af6e4c63f6d15b4e1ad3745918c0830d3816e5ce5561814e7e">T38_STATE_REJECTED</a>;</div><div class="line"><a name="l03308"></a><span class="lineno"> 3308</span>&#160;      details-&gt;<a class="code" href="../../d8/dc2/structast__fax__session__details.html#aa3cf325797b2746fbd79f34b2fd45370">is_t38_negotiated</a> = 0;</div><div class="line"><a name="l03309"></a><span class="lineno"> 3309</span>&#160;      control_params-&gt;<a class="code" href="../../d5/def/structast__control__t38__parameters.html#adb36822366e10ce64ca8337c512732a6">request_response</a> = <a class="code" href="../../d6/d66/include_2asterisk_2frame_8h.html#a168d496bdac09ece3ce49cf473bbdb4ba9df578b4287c86673d7f40f9abcdc86f">AST_T38_TERMINATED</a>;</div><div class="line"><a name="l03310"></a><span class="lineno"> 3310</span>&#160;</div><div class="line"><a name="l03311"></a><span class="lineno"> 3311</span>&#160;      <a class="code" href="../../d0/d60/res__fax_8c.html#a23b5336ddff8d963dbeb84251845721d">fax_gateway_indicate_t38</a>(chan, active, control_params);</div><div class="line"><a name="l03312"></a><span class="lineno"> 3312</span>&#160;</div><div class="line"><a name="l03313"></a><span class="lineno"> 3313</span>&#160;      <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(details, -1);</div><div class="line"><a name="l03314"></a><span class="lineno"> 3314</span>&#160;      <span class="keywordflow">return</span> &amp;<a class="code" href="../../d6/d66/include_2asterisk_2frame_8h.html#af203379aca2fd704fe8d86a9445596b6">ast_null_frame</a>;</div><div class="line"><a name="l03315"></a><span class="lineno"> 3315</span>&#160;   } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (control_params-&gt;<a class="code" href="../../d5/def/structast__control__t38__parameters.html#adb36822366e10ce64ca8337c512732a6">request_response</a> == <a class="code" href="../../d6/d66/include_2asterisk_2frame_8h.html#a168d496bdac09ece3ce49cf473bbdb4bad501e0d5fe272eaba466507a686a2df5">AST_T38_NEGOTIATED</a>) {</div><div class="line"><a name="l03316"></a><span class="lineno"> 3316</span>&#160;      <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(1, <span class="stringliteral">&quot;T.38 successfully negotiated between %s and %s, no gateway necessary\n&quot;</span>, <a class="code" href="../../d5/d7b/channel_8h.html#a7ca2fda13b129a55c251b56729de285b">ast_channel_name</a>(active), <a class="code" href="../../d5/d7b/channel_8h.html#a7ca2fda13b129a55c251b56729de285b">ast_channel_name</a>(other));</div><div class="line"><a name="l03317"></a><span class="lineno"> 3317</span>&#160;</div><div class="line"><a name="l03318"></a><span class="lineno"> 3318</span>&#160;      <a class="code" href="../../db/d3c/framehook_8h.html#a6e116259cae8c1e5cca074d05f0a3475">ast_framehook_detach</a>(chan, details-&gt;<a class="code" href="../../d8/dc2/structast__fax__session__details.html#a2a669261b0b8c26d26573c678149d312">gateway_id</a>);</div><div class="line"><a name="l03319"></a><span class="lineno"> 3319</span>&#160;      details-&gt;<a class="code" href="../../d8/dc2/structast__fax__session__details.html#a2a669261b0b8c26d26573c678149d312">gateway_id</a> = -1;</div><div class="line"><a name="l03320"></a><span class="lineno"> 3320</span>&#160;</div><div class="line"><a name="l03321"></a><span class="lineno"> 3321</span>&#160;      <a class="code" href="../../d1/d0f/stringfields_8h.html#a653461abd6e0d16e4e3326ab90e0501d">ast_string_field_set</a>(details, <a class="code" href="../../de/d1b/cel__pgsql_8c.html#ad6c487210772a9b4b0ca04b04b847d4c">result</a>, <span class="stringliteral">&quot;SUCCESS&quot;</span>);</div><div class="line"><a name="l03322"></a><span class="lineno"> 3322</span>&#160;      <a class="code" href="../../d1/d0f/stringfields_8h.html#a653461abd6e0d16e4e3326ab90e0501d">ast_string_field_set</a>(details, <a class="code" href="../../d8/dc2/structast__fax__session__details.html#a8e155783a5296f8607948dfbe5783933">resultstr</a>, <span class="stringliteral">&quot;no gateway necessary&quot;</span>);</div><div class="line"><a name="l03323"></a><span class="lineno"> 3323</span>&#160;      <a class="code" href="../../d1/d0f/stringfields_8h.html#a653461abd6e0d16e4e3326ab90e0501d">ast_string_field_set</a>(details, <a class="code" href="../../d6/d47/utils_2frame_8c.html#a4a9391ee88e57361b613c4c2fd2bf4aa">error</a>, <span class="stringliteral">&quot;NATIVE_T38&quot;</span>);</div><div class="line"><a name="l03324"></a><span class="lineno"> 3324</span>&#160;      details-&gt;<a class="code" href="../../d8/dc2/structast__fax__session__details.html#aa3cf325797b2746fbd79f34b2fd45370">is_t38_negotiated</a> = 1;</div><div class="line"><a name="l03325"></a><span class="lineno"> 3325</span>&#160;      <a class="code" href="../../d0/d60/res__fax_8c.html#ad7732b5ae304d39afa2dacb20187cf04">set_channel_variables</a>(chan, details);</div><div class="line"><a name="l03326"></a><span class="lineno"> 3326</span>&#160;</div><div class="line"><a name="l03327"></a><span class="lineno"> 3327</span>&#160;      <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(details, -1);</div><div class="line"><a name="l03328"></a><span class="lineno"> 3328</span>&#160;      <span class="keywordflow">return</span> f;</div><div class="line"><a name="l03329"></a><span class="lineno"> 3329</span>&#160;   } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (control_params-&gt;<a class="code" href="../../d5/def/structast__control__t38__parameters.html#adb36822366e10ce64ca8337c512732a6">request_response</a> == <a class="code" href="../../d6/d66/include_2asterisk_2frame_8h.html#a168d496bdac09ece3ce49cf473bbdb4ba9df578b4287c86673d7f40f9abcdc86f">AST_T38_TERMINATED</a>) {</div><div class="line"><a name="l03330"></a><span class="lineno"> 3330</span>&#160;      <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(1, <span class="stringliteral">&quot;T.38 disabled on channel %s\n&quot;</span>, <a class="code" href="../../d5/d7b/channel_8h.html#a7ca2fda13b129a55c251b56729de285b">ast_channel_name</a>(active));</div><div class="line"><a name="l03331"></a><span class="lineno"> 3331</span>&#160;</div><div class="line"><a name="l03332"></a><span class="lineno"> 3332</span>&#160;      <a class="code" href="../../db/d3c/framehook_8h.html#a6e116259cae8c1e5cca074d05f0a3475">ast_framehook_detach</a>(chan, details-&gt;<a class="code" href="../../d8/dc2/structast__fax__session__details.html#a2a669261b0b8c26d26573c678149d312">gateway_id</a>);</div><div class="line"><a name="l03333"></a><span class="lineno"> 3333</span>&#160;      details-&gt;<a class="code" href="../../d8/dc2/structast__fax__session__details.html#a2a669261b0b8c26d26573c678149d312">gateway_id</a> = -1;</div><div class="line"><a name="l03334"></a><span class="lineno"> 3334</span>&#160;</div><div class="line"><a name="l03335"></a><span class="lineno"> 3335</span>&#160;      <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(details, -1);</div><div class="line"><a name="l03336"></a><span class="lineno"> 3336</span>&#160;      <span class="keywordflow">return</span> &amp;<a class="code" href="../../d6/d66/include_2asterisk_2frame_8h.html#af203379aca2fd704fe8d86a9445596b6">ast_null_frame</a>;</div><div class="line"><a name="l03337"></a><span class="lineno"> 3337</span>&#160;   }</div><div class="line"><a name="l03338"></a><span class="lineno"> 3338</span>&#160;</div><div class="line"><a name="l03339"></a><span class="lineno"> 3339</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(details, -1);</div><div class="line"><a name="l03340"></a><span class="lineno"> 3340</span>&#160;   <span class="keywordflow">return</span> f;</div><div class="line"><a name="l03341"></a><span class="lineno"> 3341</span>&#160;}</div><div class="line"><a name="l03342"></a><span class="lineno"> 3342</span>&#160;<span class="comment"></span></div><div class="line"><a name="l03343"></a><span class="lineno"> 3343</span>&#160;<span class="comment">/*! \brief Destroy the gateway data structure when the framehook is detached</span></div><div class="line"><a name="l03344"></a><span class="lineno"> 3344</span>&#160;<span class="comment"> * \param data framehook data (gateway data)*/</span></div><div class="line"><a name="l03345"></a><span class="lineno"><a class="line" href="../../d0/d60/res__fax_8c.html#a792719145deb79c5c8ad82b739ab564e"> 3345</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d0/d60/res__fax_8c.html#a792719145deb79c5c8ad82b739ab564e">fax_gateway_framehook_destroy</a>(<span class="keywordtype">void</span> *data)</div><div class="line"><a name="l03346"></a><span class="lineno"> 3346</span>&#160;{</div><div class="line"><a name="l03347"></a><span class="lineno"> 3347</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../dd/dd2/structfax__gateway.html">fax_gateway</a> *gateway = data;</div><div class="line"><a name="l03348"></a><span class="lineno"> 3348</span>&#160;</div><div class="line"><a name="l03349"></a><span class="lineno"> 3349</span>&#160;   <span class="keywordflow">if</span> (gateway-&gt;<a class="code" href="../../dd/dd2/structfax__gateway.html#acf7d6ff8498e4c50ee13ac0711210c72">s</a>) {</div><div class="line"><a name="l03350"></a><span class="lineno"> 3350</span>&#160;      <span class="keywordflow">switch</span> (gateway-&gt;<a class="code" href="../../dd/dd2/structfax__gateway.html#acf7d6ff8498e4c50ee13ac0711210c72">s</a>-&gt;<a class="code" href="../../d1/d16/structast__fax__session.html#ad8f346e1752edcc0b1a6b431b1749f0e">state</a>) {</div><div class="line"><a name="l03351"></a><span class="lineno"> 3351</span>&#160;      <span class="keywordflow">case</span> <a class="code" href="../../db/d6a/res__fax_8h.html#ab34810136037068a0847bcca2518112ca11037f2ac950e3e5281b419aef13e3dc">AST_FAX_STATE_INITIALIZED</a>:</div><div class="line"><a name="l03352"></a><span class="lineno"> 3352</span>&#160;      <span class="keywordflow">case</span> <a class="code" href="../../db/d6a/res__fax_8h.html#ab34810136037068a0847bcca2518112cad0225f93f7c72e6071a0e2c459ec213c">AST_FAX_STATE_OPEN</a>:</div><div class="line"><a name="l03353"></a><span class="lineno"> 3353</span>&#160;      <span class="keywordflow">case</span> <a class="code" href="../../db/d6a/res__fax_8h.html#ab34810136037068a0847bcca2518112ca59afc86be1c4be9a01c3cd178c4337b2">AST_FAX_STATE_ACTIVE</a>:</div><div class="line"><a name="l03354"></a><span class="lineno"> 3354</span>&#160;      <span class="keywordflow">case</span> <a class="code" href="../../db/d6a/res__fax_8h.html#ab34810136037068a0847bcca2518112ca89690cf17e4dd810bc40e657ac1d6213">AST_FAX_STATE_COMPLETE</a>:</div><div class="line"><a name="l03355"></a><span class="lineno"> 3355</span>&#160;         <span class="keywordflow">if</span> (gateway-&gt;<a class="code" href="../../dd/dd2/structfax__gateway.html#acf7d6ff8498e4c50ee13ac0711210c72">s</a>-&gt;<a class="code" href="../../d1/d16/structast__fax__session.html#a4ac6ff3775e67c710cd55bc7dfd592fe">tech</a>-&gt;<a class="code" href="../../d9/d0e/structast__fax__tech.html#a794f785a8ae4c97642fd20ff8ef83c34">cancel_session</a>) {</div><div class="line"><a name="l03356"></a><span class="lineno"> 3356</span>&#160;            gateway-&gt;<a class="code" href="../../dd/dd2/structfax__gateway.html#acf7d6ff8498e4c50ee13ac0711210c72">s</a>-&gt;<a class="code" href="../../d1/d16/structast__fax__session.html#a4ac6ff3775e67c710cd55bc7dfd592fe">tech</a>-&gt;<a class="code" href="../../d9/d0e/structast__fax__tech.html#a794f785a8ae4c97642fd20ff8ef83c34">cancel_session</a>(gateway-&gt;<a class="code" href="../../dd/dd2/structfax__gateway.html#acf7d6ff8498e4c50ee13ac0711210c72">s</a>);</div><div class="line"><a name="l03357"></a><span class="lineno"> 3357</span>&#160;         }</div><div class="line"><a name="l03358"></a><span class="lineno"> 3358</span>&#160;         <span class="comment">/* fall through */</span></div><div class="line"><a name="l03359"></a><span class="lineno"> 3359</span>&#160;      <span class="keywordflow">default</span>:</div><div class="line"><a name="l03360"></a><span class="lineno"> 3360</span>&#160;         <span class="keywordflow">break</span>;</div><div class="line"><a name="l03361"></a><span class="lineno"> 3361</span>&#160;      }</div><div class="line"><a name="l03362"></a><span class="lineno"> 3362</span>&#160;   }</div><div class="line"><a name="l03363"></a><span class="lineno"> 3363</span>&#160;</div><div class="line"><a name="l03364"></a><span class="lineno"> 3364</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(gateway, -1);</div><div class="line"><a name="l03365"></a><span class="lineno"> 3365</span>&#160;}</div><div class="line"><a name="l03366"></a><span class="lineno"> 3366</span>&#160;<span class="comment"></span></div><div class="line"><a name="l03367"></a><span class="lineno"> 3367</span>&#160;<span class="comment">/*!</span></div><div class="line"><a name="l03368"></a><span class="lineno"> 3368</span>&#160;<span class="comment"> * \brief T.30&lt;-&gt;T.38 gateway framehook.</span></div><div class="line"><a name="l03369"></a><span class="lineno"> 3369</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l03370"></a><span class="lineno"> 3370</span>&#160;<span class="comment"> * Intercept packets on bridged channels and determine if a T.38 gateway is</span></div><div class="line"><a name="l03371"></a><span class="lineno"> 3371</span>&#160;<span class="comment"> * required. If a gateway is required, start a gateway and handle T.38</span></div><div class="line"><a name="l03372"></a><span class="lineno"> 3372</span>&#160;<span class="comment"> * negotiation if necessary.</span></div><div class="line"><a name="l03373"></a><span class="lineno"> 3373</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l03374"></a><span class="lineno"> 3374</span>&#160;<span class="comment"> * \param chan channel running the gateway</span></div><div class="line"><a name="l03375"></a><span class="lineno"> 3375</span>&#160;<span class="comment"> * \param f frame to handle may be NULL</span></div><div class="line"><a name="l03376"></a><span class="lineno"> 3376</span>&#160;<span class="comment"> * \param event framehook event</span></div><div class="line"><a name="l03377"></a><span class="lineno"> 3377</span>&#160;<span class="comment"> * \param data framehook data (struct fax_gateway *)</span></div><div class="line"><a name="l03378"></a><span class="lineno"> 3378</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l03379"></a><span class="lineno"> 3379</span>&#160;<span class="comment"> * \pre chan is locked on entry</span></div><div class="line"><a name="l03380"></a><span class="lineno"> 3380</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l03381"></a><span class="lineno"> 3381</span>&#160;<span class="comment"> * \return processed frame or NULL when f is NULL or a null frame</span></div><div class="line"><a name="l03382"></a><span class="lineno"> 3382</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l03383"></a><span class="lineno"><a class="line" href="../../d0/d60/res__fax_8c.html#a55af247b700c6bcc938efffd92e55802"> 3383</a></span>&#160;<span class="keyword">static</span> <span class="keyword">struct </span><a class="code" href="../../d0/d99/structast__frame.html">ast_frame</a> *<a class="code" href="../../d0/d60/res__fax_8c.html#a55af247b700c6bcc938efffd92e55802">fax_gateway_framehook</a>(<span class="keyword">struct</span> <a class="code" href="../../df/d3c/structast__channel.html">ast_channel</a> *chan, <span class="keyword">struct</span> <a class="code" href="../../d0/d99/structast__frame.html">ast_frame</a> *f, <span class="keyword">enum</span> <a class="code" href="../../db/d3c/framehook_8h.html#a54250544f50efde9156d2341e8da0614">ast_framehook_event</a> <a class="code" href="../../df/d7d/structevent.html">event</a>, <span class="keywordtype">void</span> *data)</div><div class="line"><a name="l03384"></a><span class="lineno"> 3384</span>&#160;{</div><div class="line"><a name="l03385"></a><span class="lineno"> 3385</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../dd/dd2/structfax__gateway.html">fax_gateway</a> *gateway = data;</div><div class="line"><a name="l03386"></a><span class="lineno"> 3386</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../df/d3c/structast__channel.html">ast_channel</a> *active;</div><div class="line"><a name="l03387"></a><span class="lineno"> 3387</span>&#160;   <a class="code" href="../../d5/d60/utils_8h.html#a1604b4d72144dd3d9f7da668e90337e9">RAII_VAR</a>(<span class="keyword">struct</span> <a class="code" href="../../d8/dc2/structast__fax__session__details.html">ast_fax_session_details</a> *, details, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../d5/da5/astobj2_8h.html#a6321ee982370c55ab3c24c72c562cbdd">ao2_cleanup</a>);</div><div class="line"><a name="l03388"></a><span class="lineno"> 3388</span>&#160;   <a class="code" href="../../d5/d60/utils_8h.html#a1604b4d72144dd3d9f7da668e90337e9">RAII_VAR</a>(<span class="keyword">struct</span> <a class="code" href="../../df/d3c/structast__channel.html">ast_channel</a> *, peer, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../d5/da5/astobj2_8h.html#a6321ee982370c55ab3c24c72c562cbdd">ao2_cleanup</a>);</div><div class="line"><a name="l03389"></a><span class="lineno"> 3389</span>&#160;   <a class="code" href="../../d5/d60/utils_8h.html#a1604b4d72144dd3d9f7da668e90337e9">RAII_VAR</a>(<span class="keyword">struct</span> <a class="code" href="../../df/d3c/structast__channel.html">ast_channel</a> *, chan_ref, chan, <a class="code" href="../../d5/da5/astobj2_8h.html#a6321ee982370c55ab3c24c72c562cbdd">ao2_cleanup</a>);</div><div class="line"><a name="l03390"></a><span class="lineno"> 3390</span>&#160;</div><div class="line"><a name="l03391"></a><span class="lineno"> 3391</span>&#160;   <span class="comment">/* Ref bump channel for when we have to unlock it */</span></div><div class="line"><a name="l03392"></a><span class="lineno"> 3392</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(chan_ref, 1);</div><div class="line"><a name="l03393"></a><span class="lineno"> 3393</span>&#160;</div><div class="line"><a name="l03394"></a><span class="lineno"> 3394</span>&#160;   <span class="keywordflow">if</span> (gateway-&gt;<a class="code" href="../../dd/dd2/structfax__gateway.html#acf7d6ff8498e4c50ee13ac0711210c72">s</a>) {</div><div class="line"><a name="l03395"></a><span class="lineno"> 3395</span>&#160;      details = gateway-&gt;<a class="code" href="../../dd/dd2/structfax__gateway.html#acf7d6ff8498e4c50ee13ac0711210c72">s</a>-&gt;<a class="code" href="../../d1/d16/structast__fax__session.html#ae7b633178d301df70e8612b4ce1aeb77">details</a>;</div><div class="line"><a name="l03396"></a><span class="lineno"> 3396</span>&#160;      <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(details, 1);</div><div class="line"><a name="l03397"></a><span class="lineno"> 3397</span>&#160;   } <span class="keywordflow">else</span> {</div><div class="line"><a name="l03398"></a><span class="lineno"> 3398</span>&#160;      <span class="keywordflow">if</span> (!(details = <a class="code" href="../../d0/d60/res__fax_8c.html#aa42f3331d32fc2fd92010023c6100322">find_details</a>(chan))) {</div><div class="line"><a name="l03399"></a><span class="lineno"> 3399</span>&#160;         <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;no FAX session details found on chan %s for T.38 gateway session, odd\n&quot;</span>, <a class="code" href="../../d5/d7b/channel_8h.html#a7ca2fda13b129a55c251b56729de285b">ast_channel_name</a>(chan));</div><div class="line"><a name="l03400"></a><span class="lineno"> 3400</span>&#160;         <a class="code" href="../../db/d3c/framehook_8h.html#a6e116259cae8c1e5cca074d05f0a3475">ast_framehook_detach</a>(chan, gateway-&gt;<a class="code" href="../../dd/dd2/structfax__gateway.html#ae25f61b5aa8877dfb396fd378c6b7722">framehook</a>);</div><div class="line"><a name="l03401"></a><span class="lineno"> 3401</span>&#160;         <span class="keywordflow">return</span> f;</div><div class="line"><a name="l03402"></a><span class="lineno"> 3402</span>&#160;      }</div><div class="line"><a name="l03403"></a><span class="lineno"> 3403</span>&#160;   }</div><div class="line"><a name="l03404"></a><span class="lineno"> 3404</span>&#160;</div><div class="line"><a name="l03405"></a><span class="lineno"> 3405</span>&#160;   <span class="comment">/* restore audio formats when we are detached */</span></div><div class="line"><a name="l03406"></a><span class="lineno"> 3406</span>&#160;   <span class="keywordflow">if</span> (event == <a class="code" href="../../db/d3c/framehook_8h.html#a54250544f50efde9156d2341e8da0614a8e213d52d922fb4ab2842022c2252a62">AST_FRAMEHOOK_EVENT_DETACHED</a>) {</div><div class="line"><a name="l03407"></a><span class="lineno"> 3407</span>&#160;      <a class="code" href="../../d0/d60/res__fax_8c.html#ad7732b5ae304d39afa2dacb20187cf04">set_channel_variables</a>(chan, details);</div><div class="line"><a name="l03408"></a><span class="lineno"> 3408</span>&#160;</div><div class="line"><a name="l03409"></a><span class="lineno"> 3409</span>&#160;      <span class="keywordflow">if</span> (gateway-&gt;<a class="code" href="../../dd/dd2/structfax__gateway.html#a0d2ac6150d9d6ec10389a84148a4425f">bridged</a>) {</div><div class="line"><a name="l03410"></a><span class="lineno"> 3410</span>&#160;         <a class="code" href="../../d5/d7b/channel_8h.html#a9107a83365cbf327cc0d12cb0dbd28d8">ast_set_read_format</a>(chan, gateway-&gt;<a class="code" href="../../dd/dd2/structfax__gateway.html#a59e020b75f0a03b00bfad6332fa53b9e">chan_read_format</a>);</div><div class="line"><a name="l03411"></a><span class="lineno"> 3411</span>&#160;         <a class="code" href="../../d5/d7b/channel_8h.html#abbdfb98077180544657b2d16c5d25f74">ast_set_write_format</a>(chan, gateway-&gt;<a class="code" href="../../dd/dd2/structfax__gateway.html#a6157ce6a6b99804070b09723d9dcf05d">chan_write_format</a>);</div><div class="line"><a name="l03412"></a><span class="lineno"> 3412</span>&#160;</div><div class="line"><a name="l03413"></a><span class="lineno"> 3413</span>&#160;         <a class="code" href="../../d5/d7b/channel_8h.html#af476c537b29be3f29240489032f9db39">ast_channel_unlock</a>(chan);</div><div class="line"><a name="l03414"></a><span class="lineno"> 3414</span>&#160;         peer = <a class="code" href="../../d5/d7b/channel_8h.html#af9e27ecd92ff5aa897c9e058dfbd6510">ast_channel_bridge_peer</a>(chan);</div><div class="line"><a name="l03415"></a><span class="lineno"> 3415</span>&#160;         <span class="keywordflow">if</span> (peer) {</div><div class="line"><a name="l03416"></a><span class="lineno"> 3416</span>&#160;            <a class="code" href="../../d5/d7b/channel_8h.html#a9107a83365cbf327cc0d12cb0dbd28d8">ast_set_read_format</a>(peer, gateway-&gt;<a class="code" href="../../dd/dd2/structfax__gateway.html#ac11fd22af311685dee2ccb296221cc86">peer_read_format</a>);</div><div class="line"><a name="l03417"></a><span class="lineno"> 3417</span>&#160;            <a class="code" href="../../d5/d7b/channel_8h.html#abbdfb98077180544657b2d16c5d25f74">ast_set_write_format</a>(peer, gateway-&gt;<a class="code" href="../../dd/dd2/structfax__gateway.html#a997059bcc0230f25cde254408e405d02">peer_write_format</a>);</div><div class="line"><a name="l03418"></a><span class="lineno"> 3418</span>&#160;            <a class="code" href="../../d5/d7b/channel_8h.html#a4aff0f5358bdc107a92320b4c4631834">ast_channel_make_compatible</a>(chan, peer);</div><div class="line"><a name="l03419"></a><span class="lineno"> 3419</span>&#160;         }</div><div class="line"><a name="l03420"></a><span class="lineno"> 3420</span>&#160;         <a class="code" href="../../d5/d7b/channel_8h.html#a493bdebe876caafb8ee535853310364a">ast_channel_lock</a>(chan);</div><div class="line"><a name="l03421"></a><span class="lineno"> 3421</span>&#160;      }</div><div class="line"><a name="l03422"></a><span class="lineno"> 3422</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l03423"></a><span class="lineno"> 3423</span>&#160;   }</div><div class="line"><a name="l03424"></a><span class="lineno"> 3424</span>&#160;</div><div class="line"><a name="l03425"></a><span class="lineno"> 3425</span>&#160;   <span class="keywordflow">if</span> (!f || (event == <a class="code" href="../../db/d3c/framehook_8h.html#a54250544f50efde9156d2341e8da0614a890a69eb197e4612993b98f04ab73ead">AST_FRAMEHOOK_EVENT_ATTACHED</a>)) {</div><div class="line"><a name="l03426"></a><span class="lineno"> 3426</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l03427"></a><span class="lineno"> 3427</span>&#160;   };</div><div class="line"><a name="l03428"></a><span class="lineno"> 3428</span>&#160;</div><div class="line"><a name="l03429"></a><span class="lineno"> 3429</span>&#160;   <span class="comment">/* this frame was generated by the fax gateway, pass it on */</span></div><div class="line"><a name="l03430"></a><span class="lineno"> 3430</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d5/d60/utils_8h.html#a00d4c9254c9827d6fa44f17a326744a5">ast_test_flag</a>(f, <a class="code" href="../../db/d6a/res__fax_8h.html#a748e0695940b2d6145b9646387daa4db">AST_FAX_FRFLAG_GATEWAY</a>)) {</div><div class="line"><a name="l03431"></a><span class="lineno"> 3431</span>&#160;      <span class="keywordflow">return</span> f;</div><div class="line"><a name="l03432"></a><span class="lineno"> 3432</span>&#160;   }</div><div class="line"><a name="l03433"></a><span class="lineno"> 3433</span>&#160;</div><div class="line"><a name="l03434"></a><span class="lineno"> 3434</span>&#160;   <span class="comment">/* If we aren&#39;t bridged or we don&#39;t have a peer, don&#39;t do anything */</span></div><div class="line"><a name="l03435"></a><span class="lineno"> 3435</span>&#160;   <a class="code" href="../../d5/d7b/channel_8h.html#af476c537b29be3f29240489032f9db39">ast_channel_unlock</a>(chan);</div><div class="line"><a name="l03436"></a><span class="lineno"> 3436</span>&#160;   peer = <a class="code" href="../../d5/d7b/channel_8h.html#af9e27ecd92ff5aa897c9e058dfbd6510">ast_channel_bridge_peer</a>(chan);</div><div class="line"><a name="l03437"></a><span class="lineno"> 3437</span>&#160;   <a class="code" href="../../d5/d7b/channel_8h.html#a493bdebe876caafb8ee535853310364a">ast_channel_lock</a>(chan);</div><div class="line"><a name="l03438"></a><span class="lineno"> 3438</span>&#160;   <span class="keywordflow">if</span> (!peer) {</div><div class="line"><a name="l03439"></a><span class="lineno"> 3439</span>&#160;      <span class="keywordflow">return</span> f;</div><div class="line"><a name="l03440"></a><span class="lineno"> 3440</span>&#160;   }</div><div class="line"><a name="l03441"></a><span class="lineno"> 3441</span>&#160;</div><div class="line"><a name="l03442"></a><span class="lineno"> 3442</span>&#160;   <span class="keywordflow">if</span> (!gateway-&gt;<a class="code" href="../../dd/dd2/structfax__gateway.html#a0d2ac6150d9d6ec10389a84148a4425f">bridged</a>) {</div><div class="line"><a name="l03443"></a><span class="lineno"> 3443</span>&#160;      <span class="keyword">enum</span> <a class="code" href="../../d5/d7b/channel_8h.html#a4cd990f4c1cd0c2af6e4c63f6d15b4e1">ast_t38_state</a> state_chan;</div><div class="line"><a name="l03444"></a><span class="lineno"> 3444</span>&#160;      <span class="keyword">enum</span> <a class="code" href="../../d5/d7b/channel_8h.html#a4cd990f4c1cd0c2af6e4c63f6d15b4e1">ast_t38_state</a> state_peer;</div><div class="line"><a name="l03445"></a><span class="lineno"> 3445</span>&#160;      <span class="keywordtype">int</span> chan_is_hungup;</div><div class="line"><a name="l03446"></a><span class="lineno"> 3446</span>&#160;      <span class="keywordtype">int</span> peer_is_hungup;</div><div class="line"><a name="l03447"></a><span class="lineno"> 3447</span>&#160;</div><div class="line"><a name="l03448"></a><span class="lineno"> 3448</span>&#160;      chan_is_hungup = <a class="code" href="../../d5/d7b/channel_8h.html#a9c63fff1d736568d1ee332dd7ea502bd">ast_check_hangup</a>(chan);</div><div class="line"><a name="l03449"></a><span class="lineno"> 3449</span>&#160;      peer_is_hungup = <a class="code" href="../../d5/d7b/channel_8h.html#a9c63fff1d736568d1ee332dd7ea502bd">ast_check_hangup</a>(peer);</div><div class="line"><a name="l03450"></a><span class="lineno"> 3450</span>&#160;      <span class="comment">/* Don&#39;t start a gateway if either channel is hung up */</span></div><div class="line"><a name="l03451"></a><span class="lineno"> 3451</span>&#160;      <span class="keywordflow">if</span> (chan_is_hungup || peer_is_hungup) {</div><div class="line"><a name="l03452"></a><span class="lineno"> 3452</span>&#160;         <span class="keywordflow">return</span> f;</div><div class="line"><a name="l03453"></a><span class="lineno"> 3453</span>&#160;      }</div><div class="line"><a name="l03454"></a><span class="lineno"> 3454</span>&#160;</div><div class="line"><a name="l03455"></a><span class="lineno"> 3455</span>&#160;      <a class="code" href="../../d5/d7b/channel_8h.html#af476c537b29be3f29240489032f9db39">ast_channel_unlock</a>(chan);</div><div class="line"><a name="l03456"></a><span class="lineno"> 3456</span>&#160;      state_chan = <a class="code" href="../../d5/d7b/channel_8h.html#a1b22ea5302ef183fa68bc45bfb0659c9">ast_channel_get_t38_state</a>(chan);</div><div class="line"><a name="l03457"></a><span class="lineno"> 3457</span>&#160;      state_peer = <a class="code" href="../../d5/d7b/channel_8h.html#a1b22ea5302ef183fa68bc45bfb0659c9">ast_channel_get_t38_state</a>(peer);</div><div class="line"><a name="l03458"></a><span class="lineno"> 3458</span>&#160;      <a class="code" href="../../d5/d7b/channel_8h.html#a493bdebe876caafb8ee535853310364a">ast_channel_lock</a>(chan);</div><div class="line"><a name="l03459"></a><span class="lineno"> 3459</span>&#160;</div><div class="line"><a name="l03460"></a><span class="lineno"> 3460</span>&#160;      <span class="comment">/* don&#39;t start a gateway if neither channel can handle T.38 */</span></div><div class="line"><a name="l03461"></a><span class="lineno"> 3461</span>&#160;      <span class="keywordflow">if</span> (state_chan == <a class="code" href="../../d5/d7b/channel_8h.html#a4cd990f4c1cd0c2af6e4c63f6d15b4e1a8bd9e539fb6a17b095fb24a75e0b4d21">T38_STATE_UNAVAILABLE</a> &amp;&amp; state_peer == <a class="code" href="../../d5/d7b/channel_8h.html#a4cd990f4c1cd0c2af6e4c63f6d15b4e1a8bd9e539fb6a17b095fb24a75e0b4d21">T38_STATE_UNAVAILABLE</a>) {</div><div class="line"><a name="l03462"></a><span class="lineno"> 3462</span>&#160;         <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(1, <span class="stringliteral">&quot;not starting gateway for %s and %s; neither channel supports T.38\n&quot;</span>, <a class="code" href="../../d5/d7b/channel_8h.html#a7ca2fda13b129a55c251b56729de285b">ast_channel_name</a>(chan), <a class="code" href="../../d5/d7b/channel_8h.html#a7ca2fda13b129a55c251b56729de285b">ast_channel_name</a>(peer));</div><div class="line"><a name="l03463"></a><span class="lineno"> 3463</span>&#160;         <a class="code" href="../../db/d3c/framehook_8h.html#a6e116259cae8c1e5cca074d05f0a3475">ast_framehook_detach</a>(chan, gateway-&gt;<a class="code" href="../../dd/dd2/structfax__gateway.html#ae25f61b5aa8877dfb396fd378c6b7722">framehook</a>);</div><div class="line"><a name="l03464"></a><span class="lineno"> 3464</span>&#160;         details-&gt;<a class="code" href="../../d8/dc2/structast__fax__session__details.html#a2a669261b0b8c26d26573c678149d312">gateway_id</a> = -1;</div><div class="line"><a name="l03465"></a><span class="lineno"> 3465</span>&#160;</div><div class="line"><a name="l03466"></a><span class="lineno"> 3466</span>&#160;         <a class="code" href="../../d1/d0f/stringfields_8h.html#a653461abd6e0d16e4e3326ab90e0501d">ast_string_field_set</a>(details, <a class="code" href="../../de/d1b/cel__pgsql_8c.html#ad6c487210772a9b4b0ca04b04b847d4c">result</a>, <span class="stringliteral">&quot;FAILED&quot;</span>);</div><div class="line"><a name="l03467"></a><span class="lineno"> 3467</span>&#160;         <a class="code" href="../../d1/d0f/stringfields_8h.html#a653461abd6e0d16e4e3326ab90e0501d">ast_string_field_set</a>(details, resultstr, <span class="stringliteral">&quot;neither channel supports T.38&quot;</span>);</div><div class="line"><a name="l03468"></a><span class="lineno"> 3468</span>&#160;         <a class="code" href="../../d1/d0f/stringfields_8h.html#a653461abd6e0d16e4e3326ab90e0501d">ast_string_field_set</a>(details, <a class="code" href="../../d6/d47/utils_2frame_8c.html#a4a9391ee88e57361b613c4c2fd2bf4aa">error</a>, <span class="stringliteral">&quot;T38_NEG_ERROR&quot;</span>);</div><div class="line"><a name="l03469"></a><span class="lineno"> 3469</span>&#160;         details-&gt;<a class="code" href="../../d8/dc2/structast__fax__session__details.html#aa3cf325797b2746fbd79f34b2fd45370">is_t38_negotiated</a> = 0;</div><div class="line"><a name="l03470"></a><span class="lineno"> 3470</span>&#160;         <a class="code" href="../../d0/d60/res__fax_8c.html#ad7732b5ae304d39afa2dacb20187cf04">set_channel_variables</a>(chan, details);</div><div class="line"><a name="l03471"></a><span class="lineno"> 3471</span>&#160;         <span class="keywordflow">return</span> f;</div><div class="line"><a name="l03472"></a><span class="lineno"> 3472</span>&#160;      }</div><div class="line"><a name="l03473"></a><span class="lineno"> 3473</span>&#160;</div><div class="line"><a name="l03474"></a><span class="lineno"> 3474</span>&#160;      <span class="keywordflow">if</span> (details-&gt;<a class="code" href="../../d8/dc2/structast__fax__session__details.html#a3ef48556ce45595f874faa2368bc3cfa">gateway_timeout</a>) {</div><div class="line"><a name="l03475"></a><span class="lineno"> 3475</span>&#160;         gateway-&gt;<a class="code" href="../../dd/dd2/structfax__gateway.html#a23b38dad7025290be3461b4b3208b4e6">timeout_start</a> = <a class="code" href="../../de/df7/time_8h.html#ad3899efb6f0e348556ef69f5b16aa7f7">ast_tvnow</a>();</div><div class="line"><a name="l03476"></a><span class="lineno"> 3476</span>&#160;      }</div><div class="line"><a name="l03477"></a><span class="lineno"> 3477</span>&#160;</div><div class="line"><a name="l03478"></a><span class="lineno"> 3478</span>&#160;      <a class="code" href="../../d5/d7b/channel_8h.html#af476c537b29be3f29240489032f9db39">ast_channel_unlock</a>(chan);</div><div class="line"><a name="l03479"></a><span class="lineno"> 3479</span>&#160;      <a class="code" href="../../d5/d7b/channel_8h.html#a695e5b4fcf983db6451b583fbd647424">ast_channel_lock_both</a>(chan, peer);</div><div class="line"><a name="l03480"></a><span class="lineno"> 3480</span>&#160;</div><div class="line"><a name="l03481"></a><span class="lineno"> 3481</span>&#160;      <span class="comment">/* we are bridged, change r/w formats to SLIN for v21 preamble</span></div><div class="line"><a name="l03482"></a><span class="lineno"> 3482</span>&#160;<span class="comment">       * detection and T.30 */</span></div><div class="line"><a name="l03483"></a><span class="lineno"> 3483</span>&#160;      <a class="code" href="../../d5/da5/astobj2_8h.html#aa81c8462bd0574f4f9e09e71f2772f44">ao2_replace</a>(gateway-&gt;<a class="code" href="../../dd/dd2/structfax__gateway.html#a59e020b75f0a03b00bfad6332fa53b9e">chan_read_format</a>, <a class="code" href="../../d5/d7b/channel_8h.html#aaced431562223538a94e0e69cf94151a">ast_channel_readformat</a>(chan));</div><div class="line"><a name="l03484"></a><span class="lineno"> 3484</span>&#160;      <a class="code" href="../../d5/da5/astobj2_8h.html#aa81c8462bd0574f4f9e09e71f2772f44">ao2_replace</a>(gateway-&gt;<a class="code" href="../../dd/dd2/structfax__gateway.html#a6157ce6a6b99804070b09723d9dcf05d">chan_write_format</a>, <a class="code" href="../../d5/d7b/channel_8h.html#a1dc625bd14a7875b04bfe0c388858929">ast_channel_writeformat</a>(chan));</div><div class="line"><a name="l03485"></a><span class="lineno"> 3485</span>&#160;</div><div class="line"><a name="l03486"></a><span class="lineno"> 3486</span>&#160;      <a class="code" href="../../d5/da5/astobj2_8h.html#aa81c8462bd0574f4f9e09e71f2772f44">ao2_replace</a>(gateway-&gt;<a class="code" href="../../dd/dd2/structfax__gateway.html#ac11fd22af311685dee2ccb296221cc86">peer_read_format</a>, <a class="code" href="../../d5/d7b/channel_8h.html#aaced431562223538a94e0e69cf94151a">ast_channel_readformat</a>(peer));</div><div class="line"><a name="l03487"></a><span class="lineno"> 3487</span>&#160;      <a class="code" href="../../d5/da5/astobj2_8h.html#aa81c8462bd0574f4f9e09e71f2772f44">ao2_replace</a>(gateway-&gt;<a class="code" href="../../dd/dd2/structfax__gateway.html#a997059bcc0230f25cde254408e405d02">peer_write_format</a>, <a class="code" href="../../d5/d7b/channel_8h.html#a1dc625bd14a7875b04bfe0c388858929">ast_channel_writeformat</a>(peer));</div><div class="line"><a name="l03488"></a><span class="lineno"> 3488</span>&#160;</div><div class="line"><a name="l03489"></a><span class="lineno"> 3489</span>&#160;      <a class="code" href="../../d5/d7b/channel_8h.html#a9107a83365cbf327cc0d12cb0dbd28d8">ast_set_read_format</a>(chan, <a class="code" href="../../db/d1c/format__cache_8h.html#a771d7c34570e8e492c25a0c2eb41889d">ast_format_slin</a>);</div><div class="line"><a name="l03490"></a><span class="lineno"> 3490</span>&#160;      <a class="code" href="../../d5/d7b/channel_8h.html#abbdfb98077180544657b2d16c5d25f74">ast_set_write_format</a>(chan, <a class="code" href="../../db/d1c/format__cache_8h.html#a771d7c34570e8e492c25a0c2eb41889d">ast_format_slin</a>);</div><div class="line"><a name="l03491"></a><span class="lineno"> 3491</span>&#160;</div><div class="line"><a name="l03492"></a><span class="lineno"> 3492</span>&#160;      <a class="code" href="../../d5/d7b/channel_8h.html#a9107a83365cbf327cc0d12cb0dbd28d8">ast_set_read_format</a>(peer, <a class="code" href="../../db/d1c/format__cache_8h.html#a771d7c34570e8e492c25a0c2eb41889d">ast_format_slin</a>);</div><div class="line"><a name="l03493"></a><span class="lineno"> 3493</span>&#160;      <a class="code" href="../../d5/d7b/channel_8h.html#abbdfb98077180544657b2d16c5d25f74">ast_set_write_format</a>(peer, <a class="code" href="../../db/d1c/format__cache_8h.html#a771d7c34570e8e492c25a0c2eb41889d">ast_format_slin</a>);</div><div class="line"><a name="l03494"></a><span class="lineno"> 3494</span>&#160;</div><div class="line"><a name="l03495"></a><span class="lineno"> 3495</span>&#160;      <a class="code" href="../../d5/d7b/channel_8h.html#af476c537b29be3f29240489032f9db39">ast_channel_unlock</a>(peer);</div><div class="line"><a name="l03496"></a><span class="lineno"> 3496</span>&#160;</div><div class="line"><a name="l03497"></a><span class="lineno"> 3497</span>&#160;      gateway-&gt;<a class="code" href="../../dd/dd2/structfax__gateway.html#a0d2ac6150d9d6ec10389a84148a4425f">bridged</a> = 1;</div><div class="line"><a name="l03498"></a><span class="lineno"> 3498</span>&#160;      <span class="keywordflow">if</span> (!(gateway-&gt;<a class="code" href="../../dd/dd2/structfax__gateway.html#a08eb33d553223ed90af3397a850b3af1">peer_v21_session</a> = fax_v21_session_new(peer))) {</div><div class="line"><a name="l03499"></a><span class="lineno"> 3499</span>&#160;         <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Can&#39;t create V21 session on chan %s for T.38 gateway session\n&quot;</span>, <a class="code" href="../../d5/d7b/channel_8h.html#a7ca2fda13b129a55c251b56729de285b">ast_channel_name</a>(peer));</div><div class="line"><a name="l03500"></a><span class="lineno"> 3500</span>&#160;         <a class="code" href="../../db/d3c/framehook_8h.html#a6e116259cae8c1e5cca074d05f0a3475">ast_framehook_detach</a>(chan, gateway-&gt;<a class="code" href="../../dd/dd2/structfax__gateway.html#ae25f61b5aa8877dfb396fd378c6b7722">framehook</a>);</div><div class="line"><a name="l03501"></a><span class="lineno"> 3501</span>&#160;         <span class="keywordflow">return</span> f;</div><div class="line"><a name="l03502"></a><span class="lineno"> 3502</span>&#160;      }</div><div class="line"><a name="l03503"></a><span class="lineno"> 3503</span>&#160;   }</div><div class="line"><a name="l03504"></a><span class="lineno"> 3504</span>&#160;</div><div class="line"><a name="l03505"></a><span class="lineno"> 3505</span>&#160;   <span class="keywordflow">if</span> (gateway-&gt;<a class="code" href="../../dd/dd2/structfax__gateway.html#a0d2ac6150d9d6ec10389a84148a4425f">bridged</a> &amp;&amp; !<a class="code" href="../../de/df7/time_8h.html#a4e7b3508884147c7991a68361ac781a2">ast_tvzero</a>(gateway-&gt;<a class="code" href="../../dd/dd2/structfax__gateway.html#a23b38dad7025290be3461b4b3208b4e6">timeout_start</a>)) {</div><div class="line"><a name="l03506"></a><span class="lineno"> 3506</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="../../de/df7/time_8h.html#aca4ecdab7d8d3519062aad9a90fcb29d">ast_tvdiff_ms</a>(<a class="code" href="../../de/df7/time_8h.html#ad3899efb6f0e348556ef69f5b16aa7f7">ast_tvnow</a>(), gateway-&gt;<a class="code" href="../../dd/dd2/structfax__gateway.html#a23b38dad7025290be3461b4b3208b4e6">timeout_start</a>) &gt; details-&gt;<a class="code" href="../../d8/dc2/structast__fax__session__details.html#a3ef48556ce45595f874faa2368bc3cfa">gateway_timeout</a>) {</div><div class="line"><a name="l03507"></a><span class="lineno"> 3507</span>&#160;         <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(1, <span class="stringliteral">&quot;no fax activity between %s and %s after %d ms, disabling gateway\n&quot;</span>, <a class="code" href="../../d5/d7b/channel_8h.html#a7ca2fda13b129a55c251b56729de285b">ast_channel_name</a>(chan), <a class="code" href="../../d5/d7b/channel_8h.html#a7ca2fda13b129a55c251b56729de285b">ast_channel_name</a>(peer), details-&gt;<a class="code" href="../../d8/dc2/structast__fax__session__details.html#a3ef48556ce45595f874faa2368bc3cfa">gateway_timeout</a>);</div><div class="line"><a name="l03508"></a><span class="lineno"> 3508</span>&#160;         <a class="code" href="../../db/d3c/framehook_8h.html#a6e116259cae8c1e5cca074d05f0a3475">ast_framehook_detach</a>(chan, gateway-&gt;<a class="code" href="../../dd/dd2/structfax__gateway.html#ae25f61b5aa8877dfb396fd378c6b7722">framehook</a>);</div><div class="line"><a name="l03509"></a><span class="lineno"> 3509</span>&#160;         details-&gt;<a class="code" href="../../d8/dc2/structast__fax__session__details.html#a2a669261b0b8c26d26573c678149d312">gateway_id</a> = -1;</div><div class="line"><a name="l03510"></a><span class="lineno"> 3510</span>&#160;</div><div class="line"><a name="l03511"></a><span class="lineno"> 3511</span>&#160;         <a class="code" href="../../d1/d0f/stringfields_8h.html#a653461abd6e0d16e4e3326ab90e0501d">ast_string_field_set</a>(details, <a class="code" href="../../de/d1b/cel__pgsql_8c.html#ad6c487210772a9b4b0ca04b04b847d4c">result</a>, <span class="stringliteral">&quot;FAILED&quot;</span>);</div><div class="line"><a name="l03512"></a><span class="lineno"> 3512</span>&#160;         <a class="code" href="../../d1/d0f/stringfields_8h.html#a8b9f4347fc72720cc5cead952b54abe9">ast_string_field_build</a>(details, resultstr, <span class="stringliteral">&quot;no fax activity after %d ms&quot;</span>, details-&gt;<a class="code" href="../../d8/dc2/structast__fax__session__details.html#a3ef48556ce45595f874faa2368bc3cfa">gateway_timeout</a>);</div><div class="line"><a name="l03513"></a><span class="lineno"> 3513</span>&#160;         <a class="code" href="../../d1/d0f/stringfields_8h.html#a653461abd6e0d16e4e3326ab90e0501d">ast_string_field_set</a>(details, <a class="code" href="../../d6/d47/utils_2frame_8c.html#a4a9391ee88e57361b613c4c2fd2bf4aa">error</a>, <span class="stringliteral">&quot;TIMEOUT&quot;</span>);</div><div class="line"><a name="l03514"></a><span class="lineno"> 3514</span>&#160;         details-&gt;<a class="code" href="../../d8/dc2/structast__fax__session__details.html#aa3cf325797b2746fbd79f34b2fd45370">is_t38_negotiated</a> = 0;</div><div class="line"><a name="l03515"></a><span class="lineno"> 3515</span>&#160;         <a class="code" href="../../d0/d60/res__fax_8c.html#ad7732b5ae304d39afa2dacb20187cf04">set_channel_variables</a>(chan, details);</div><div class="line"><a name="l03516"></a><span class="lineno"> 3516</span>&#160;         <span class="keywordflow">return</span> f;</div><div class="line"><a name="l03517"></a><span class="lineno"> 3517</span>&#160;      }</div><div class="line"><a name="l03518"></a><span class="lineno"> 3518</span>&#160;   }</div><div class="line"><a name="l03519"></a><span class="lineno"> 3519</span>&#160;</div><div class="line"><a name="l03520"></a><span class="lineno"> 3520</span>&#160;   <span class="comment">/* only handle VOICE, MODEM, and CONTROL frames*/</span></div><div class="line"><a name="l03521"></a><span class="lineno"> 3521</span>&#160;   <span class="keywordflow">switch</span> (f-&gt;<a class="code" href="../../d0/d99/structast__frame.html#a6937b93c56cb473b547eda454dca7b4c">frametype</a>) {</div><div class="line"><a name="l03522"></a><span class="lineno"> 3522</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="../../d6/d66/include_2asterisk_2frame_8h.html#ae2e1a9c4e048da387b761f619312d6e0aa457fe7005f11bb7b21453f9bb4caa8f">AST_FRAME_VOICE</a>:</div><div class="line"><a name="l03523"></a><span class="lineno"> 3523</span>&#160;      <span class="keywordflow">if</span> ((<a class="code" href="../../d0/d0a/format_8h.html#a738c58eca291b71de4422e95bff27400">ast_format_cmp</a>(f-&gt;<a class="code" href="../../d0/d99/structast__frame.html#a27237c48fdcd22556401f20c693811db">subclass</a>.<a class="code" href="../../d1/d9f/structast__frame__subclass.html#ab425a484a0916077c5a30d9d7b229b44">format</a>, <a class="code" href="../../db/d1c/format__cache_8h.html#a771d7c34570e8e492c25a0c2eb41889d">ast_format_slin</a>) != <a class="code" href="../../d0/d0a/format_8h.html#a79bdf0b3c0616d9950d00cfeb62295c3ab1e8c1a0f8b4a1ecb6a2109992636859">AST_FORMAT_CMP_EQUAL</a>) &amp;&amp;</div><div class="line"><a name="l03524"></a><span class="lineno"> 3524</span>&#160;         (<a class="code" href="../../d0/d0a/format_8h.html#a738c58eca291b71de4422e95bff27400">ast_format_cmp</a>(f-&gt;<a class="code" href="../../d0/d99/structast__frame.html#a27237c48fdcd22556401f20c693811db">subclass</a>.<a class="code" href="../../d1/d9f/structast__frame__subclass.html#ab425a484a0916077c5a30d9d7b229b44">format</a>, <a class="code" href="../../db/d1c/format__cache_8h.html#a95c058fe6adef68780f026d6aec2481c">ast_format_alaw</a>) != <a class="code" href="../../d0/d0a/format_8h.html#a79bdf0b3c0616d9950d00cfeb62295c3ab1e8c1a0f8b4a1ecb6a2109992636859">AST_FORMAT_CMP_EQUAL</a>) &amp;&amp;</div><div class="line"><a name="l03525"></a><span class="lineno"> 3525</span>&#160;         (<a class="code" href="../../d0/d0a/format_8h.html#a738c58eca291b71de4422e95bff27400">ast_format_cmp</a>(f-&gt;<a class="code" href="../../d0/d99/structast__frame.html#a27237c48fdcd22556401f20c693811db">subclass</a>.<a class="code" href="../../d1/d9f/structast__frame__subclass.html#ab425a484a0916077c5a30d9d7b229b44">format</a>, <a class="code" href="../../db/d1c/format__cache_8h.html#a568c3f5838b53c38f11996dbe5ff5785">ast_format_ulaw</a>) != <a class="code" href="../../d0/d0a/format_8h.html#a79bdf0b3c0616d9950d00cfeb62295c3ab1e8c1a0f8b4a1ecb6a2109992636859">AST_FORMAT_CMP_EQUAL</a>)) {</div><div class="line"><a name="l03526"></a><span class="lineno"> 3526</span>&#160;         <span class="keywordflow">return</span> f;</div><div class="line"><a name="l03527"></a><span class="lineno"> 3527</span>&#160;      }</div><div class="line"><a name="l03528"></a><span class="lineno"> 3528</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l03529"></a><span class="lineno"> 3529</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="../../d6/d66/include_2asterisk_2frame_8h.html#ae2e1a9c4e048da387b761f619312d6e0ad99b86353343f422bda01163898b2eea">AST_FRAME_MODEM</a>:</div><div class="line"><a name="l03530"></a><span class="lineno"> 3530</span>&#160;      <span class="keywordflow">if</span> (f-&gt;<a class="code" href="../../d0/d99/structast__frame.html#a27237c48fdcd22556401f20c693811db">subclass</a>.<a class="code" href="../../d1/d9f/structast__frame__subclass.html#adece183191b0e700e039e59101e06105">integer</a> == <a class="code" href="../../d6/d66/include_2asterisk_2frame_8h.html#a3a510e4e2673c6870ed5fe0f1eb53732">AST_MODEM_T38</a>) {</div><div class="line"><a name="l03531"></a><span class="lineno"> 3531</span>&#160;         <span class="keywordflow">break</span>;</div><div class="line"><a name="l03532"></a><span class="lineno"> 3532</span>&#160;      }</div><div class="line"><a name="l03533"></a><span class="lineno"> 3533</span>&#160;      <span class="keywordflow">return</span> f;</div><div class="line"><a name="l03534"></a><span class="lineno"> 3534</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="../../d6/d66/include_2asterisk_2frame_8h.html#ae2e1a9c4e048da387b761f619312d6e0ae1dae388b0d70825876e137ae95bb0c1">AST_FRAME_CONTROL</a>:</div><div class="line"><a name="l03535"></a><span class="lineno"> 3535</span>&#160;      <span class="keywordflow">if</span> (f-&gt;<a class="code" href="../../d0/d99/structast__frame.html#a27237c48fdcd22556401f20c693811db">subclass</a>.<a class="code" href="../../d1/d9f/structast__frame__subclass.html#adece183191b0e700e039e59101e06105">integer</a> == <a class="code" href="../../d6/d66/include_2asterisk_2frame_8h.html#aedda41918e992000fe921f8f7363b390a7334c9d27a6d70fe7c85b60b864788fc">AST_CONTROL_T38_PARAMETERS</a>) {</div><div class="line"><a name="l03536"></a><span class="lineno"> 3536</span>&#160;         <span class="keywordflow">break</span>;</div><div class="line"><a name="l03537"></a><span class="lineno"> 3537</span>&#160;      }</div><div class="line"><a name="l03538"></a><span class="lineno"> 3538</span>&#160;      <span class="keywordflow">return</span> f;</div><div class="line"><a name="l03539"></a><span class="lineno"> 3539</span>&#160;   <span class="keywordflow">default</span>:</div><div class="line"><a name="l03540"></a><span class="lineno"> 3540</span>&#160;      <span class="keywordflow">return</span> f;</div><div class="line"><a name="l03541"></a><span class="lineno"> 3541</span>&#160;   }</div><div class="line"><a name="l03542"></a><span class="lineno"> 3542</span>&#160;</div><div class="line"><a name="l03543"></a><span class="lineno"> 3543</span>&#160;   <span class="comment">/* detect the active channel */</span></div><div class="line"><a name="l03544"></a><span class="lineno"> 3544</span>&#160;   <span class="keywordflow">switch</span> (event) {</div><div class="line"><a name="l03545"></a><span class="lineno"> 3545</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="../../db/d3c/framehook_8h.html#a54250544f50efde9156d2341e8da0614a8e96ab8d6971c2abf694c55ed52653d9">AST_FRAMEHOOK_EVENT_WRITE</a>:</div><div class="line"><a name="l03546"></a><span class="lineno"> 3546</span>&#160;      active = peer;</div><div class="line"><a name="l03547"></a><span class="lineno"> 3547</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l03548"></a><span class="lineno"> 3548</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="../../db/d3c/framehook_8h.html#a54250544f50efde9156d2341e8da0614ab652eafa2595533d8c065a6ac426aa8a">AST_FRAMEHOOK_EVENT_READ</a>:</div><div class="line"><a name="l03549"></a><span class="lineno"> 3549</span>&#160;      active = chan;</div><div class="line"><a name="l03550"></a><span class="lineno"> 3550</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l03551"></a><span class="lineno"> 3551</span>&#160;   <span class="keywordflow">default</span>:</div><div class="line"><a name="l03552"></a><span class="lineno"> 3552</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;unhandled framehook event %u\n&quot;</span>, event);</div><div class="line"><a name="l03553"></a><span class="lineno"> 3553</span>&#160;      <span class="keywordflow">return</span> f;</div><div class="line"><a name="l03554"></a><span class="lineno"> 3554</span>&#160;   }</div><div class="line"><a name="l03555"></a><span class="lineno"> 3555</span>&#160;</div><div class="line"><a name="l03556"></a><span class="lineno"> 3556</span>&#160;   <span class="comment">/* handle control frames */</span></div><div class="line"><a name="l03557"></a><span class="lineno"> 3557</span>&#160;   <span class="keywordflow">if</span> (f-&gt;<a class="code" href="../../d0/d99/structast__frame.html#a6937b93c56cb473b547eda454dca7b4c">frametype</a> == <a class="code" href="../../d6/d66/include_2asterisk_2frame_8h.html#ae2e1a9c4e048da387b761f619312d6e0ae1dae388b0d70825876e137ae95bb0c1">AST_FRAME_CONTROL</a> &amp;&amp; f-&gt;<a class="code" href="../../d0/d99/structast__frame.html#a27237c48fdcd22556401f20c693811db">subclass</a>.<a class="code" href="../../d1/d9f/structast__frame__subclass.html#adece183191b0e700e039e59101e06105">integer</a> == <a class="code" href="../../d6/d66/include_2asterisk_2frame_8h.html#aedda41918e992000fe921f8f7363b390a7334c9d27a6d70fe7c85b60b864788fc">AST_CONTROL_T38_PARAMETERS</a>) {</div><div class="line"><a name="l03558"></a><span class="lineno"> 3558</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../d0/d60/res__fax_8c.html#a522499b2966b304ec995720f3815e8f6">fax_gateway_detect_t38</a>(gateway, chan, peer, active, f);</div><div class="line"><a name="l03559"></a><span class="lineno"> 3559</span>&#160;   }</div><div class="line"><a name="l03560"></a><span class="lineno"> 3560</span>&#160;</div><div class="line"><a name="l03561"></a><span class="lineno"> 3561</span>&#160;   <span class="keywordflow">if</span> (!gateway-&gt;<a class="code" href="../../dd/dd2/structfax__gateway.html#af2cb1e09b1af5d5bebdec7471555c940">detected_v21</a> &amp;&amp; gateway-&gt;<a class="code" href="../../dd/dd2/structfax__gateway.html#a37f4333f3e7eaf12966069b77dac704e">t38_state</a> == <a class="code" href="../../d5/d7b/channel_8h.html#a4cd990f4c1cd0c2af6e4c63f6d15b4e1a8bd9e539fb6a17b095fb24a75e0b4d21">T38_STATE_UNAVAILABLE</a> &amp;&amp; f-&gt;<a class="code" href="../../d0/d99/structast__frame.html#a6937b93c56cb473b547eda454dca7b4c">frametype</a> == <a class="code" href="../../d6/d66/include_2asterisk_2frame_8h.html#ae2e1a9c4e048da387b761f619312d6e0aa457fe7005f11bb7b21453f9bb4caa8f">AST_FRAME_VOICE</a>) {</div><div class="line"><a name="l03562"></a><span class="lineno"> 3562</span>&#160;      <span class="comment">/* not in gateway mode and have not detected v21 yet, listen</span></div><div class="line"><a name="l03563"></a><span class="lineno"> 3563</span>&#160;<span class="comment">       * for v21 */</span></div><div class="line"><a name="l03564"></a><span class="lineno"> 3564</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../d0/d60/res__fax_8c.html#aa1d6811868ccbb842dde66cf8060a5fb">fax_gateway_detect_v21</a>(gateway, chan, peer, active, f);</div><div class="line"><a name="l03565"></a><span class="lineno"> 3565</span>&#160;   }</div><div class="line"><a name="l03566"></a><span class="lineno"> 3566</span>&#160;</div><div class="line"><a name="l03567"></a><span class="lineno"> 3567</span>&#160;   <span class="comment">/* in gateway mode, gateway some packets */</span></div><div class="line"><a name="l03568"></a><span class="lineno"> 3568</span>&#160;   <span class="keywordflow">if</span> (gateway-&gt;<a class="code" href="../../dd/dd2/structfax__gateway.html#a37f4333f3e7eaf12966069b77dac704e">t38_state</a> == <a class="code" href="../../d5/d7b/channel_8h.html#a4cd990f4c1cd0c2af6e4c63f6d15b4e1af142c79721a025bd65edad812f0725e0">T38_STATE_NEGOTIATED</a>) {</div><div class="line"><a name="l03569"></a><span class="lineno"> 3569</span>&#160;      <span class="keyword">struct </span><a class="code" href="../../d1/d47/structast__trans__pvt.html">ast_trans_pvt</a> *readtrans;</div><div class="line"><a name="l03570"></a><span class="lineno"> 3570</span>&#160;</div><div class="line"><a name="l03571"></a><span class="lineno"> 3571</span>&#160;      <span class="keywordflow">if</span> (!gateway-&gt;<a class="code" href="../../dd/dd2/structfax__gateway.html#acf7d6ff8498e4c50ee13ac0711210c72">s</a> || !gateway-&gt;<a class="code" href="../../dd/dd2/structfax__gateway.html#acf7d6ff8498e4c50ee13ac0711210c72">s</a>-&gt;<a class="code" href="../../d1/d16/structast__fax__session.html#a19aa04db5508cf9496602e694dc69e2f">tech_pvt</a>) {</div><div class="line"><a name="l03572"></a><span class="lineno"> 3572</span>&#160;         <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;no FAX session on chan %s for T.38 gateway session, odd&quot;</span>, <a class="code" href="../../d5/d7b/channel_8h.html#a7ca2fda13b129a55c251b56729de285b">ast_channel_name</a>(chan));</div><div class="line"><a name="l03573"></a><span class="lineno"> 3573</span>&#160;         <span class="keywordflow">return</span> <a class="code" href="../../d1/d47/structast__trans__pvt.html#a735f764b1095611ace084e7c6c06857d">f</a>;</div><div class="line"><a name="l03574"></a><span class="lineno"> 3574</span>&#160;      }</div><div class="line"><a name="l03575"></a><span class="lineno"> 3575</span>&#160;</div><div class="line"><a name="l03576"></a><span class="lineno"> 3576</span>&#160;      <span class="comment">/* framehooks are called in __ast_read() before frame format</span></div><div class="line"><a name="l03577"></a><span class="lineno"> 3577</span>&#160;<span class="comment">       * translation is done, so we need to translate here */</span></div><div class="line"><a name="l03578"></a><span class="lineno"> 3578</span>&#160;      <span class="keywordflow">if</span> ((f-&gt;<a class="code" href="../../d0/d99/structast__frame.html#a6937b93c56cb473b547eda454dca7b4c">frametype</a> == <a class="code" href="../../d6/d66/include_2asterisk_2frame_8h.html#ae2e1a9c4e048da387b761f619312d6e0aa457fe7005f11bb7b21453f9bb4caa8f">AST_FRAME_VOICE</a>) &amp;&amp; (<a class="code" href="../../d0/d0a/format_8h.html#a738c58eca291b71de4422e95bff27400">ast_format_cmp</a>(f-&gt;<a class="code" href="../../d0/d99/structast__frame.html#a27237c48fdcd22556401f20c693811db">subclass</a>.<a class="code" href="../../d1/d9f/structast__frame__subclass.html#ab425a484a0916077c5a30d9d7b229b44">format</a>, <a class="code" href="../../db/d1c/format__cache_8h.html#a771d7c34570e8e492c25a0c2eb41889d">ast_format_slin</a>) != <a class="code" href="../../d0/d0a/format_8h.html#a79bdf0b3c0616d9950d00cfeb62295c3ab1e8c1a0f8b4a1ecb6a2109992636859">AST_FORMAT_CMP_EQUAL</a>)</div><div class="line"><a name="l03579"></a><span class="lineno"> 3579</span>&#160;         &amp;&amp; (readtrans = <a class="code" href="../../d5/d7b/channel_8h.html#a6b4548259e61f691c654aed0025e5502">ast_channel_readtrans</a>(active))) {</div><div class="line"><a name="l03580"></a><span class="lineno"> 3580</span>&#160;         <span class="keywordflow">if</span> ((f = <a class="code" href="../../db/d39/translate_8h.html#ab09d3ccb95d1f828d2871530226f9456">ast_translate</a>(readtrans, f, event == <a class="code" href="../../db/d3c/framehook_8h.html#a54250544f50efde9156d2341e8da0614a8e96ab8d6971c2abf694c55ed52653d9">AST_FRAMEHOOK_EVENT_WRITE</a> ? 0 : 1)) == <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {</div><div class="line"><a name="l03581"></a><span class="lineno"> 3581</span>&#160;            f = &amp;<a class="code" href="../../d6/d66/include_2asterisk_2frame_8h.html#af203379aca2fd704fe8d86a9445596b6">ast_null_frame</a>;</div><div class="line"><a name="l03582"></a><span class="lineno"> 3582</span>&#160;            <span class="keywordflow">return</span> <a class="code" href="../../d1/d47/structast__trans__pvt.html#a735f764b1095611ace084e7c6c06857d">f</a>;</div><div class="line"><a name="l03583"></a><span class="lineno"> 3583</span>&#160;         }</div><div class="line"><a name="l03584"></a><span class="lineno"> 3584</span>&#160;         <span class="comment">/* XXX we ignore the return value here, perhaps we should</span></div><div class="line"><a name="l03585"></a><span class="lineno"> 3585</span>&#160;<span class="comment">          * disable the gateway if a write fails. I am not sure how a</span></div><div class="line"><a name="l03586"></a><span class="lineno"> 3586</span>&#160;<span class="comment">          * write would fail, or even if a failure would be fatal so for</span></div><div class="line"><a name="l03587"></a><span class="lineno"> 3587</span>&#160;<span class="comment">          * now we&#39;ll just ignore the return value. */</span></div><div class="line"><a name="l03588"></a><span class="lineno"> 3588</span>&#160;         gateway-&gt;<a class="code" href="../../dd/dd2/structfax__gateway.html#acf7d6ff8498e4c50ee13ac0711210c72">s</a>-&gt;<a class="code" href="../../d1/d16/structast__fax__session.html#a4ac6ff3775e67c710cd55bc7dfd592fe">tech</a>-&gt;<a class="code" href="../../d9/d0e/structast__fax__tech.html#a7014a7b1d150a523cf1273e6fee5bdd6">write</a>(gateway-&gt;<a class="code" href="../../dd/dd2/structfax__gateway.html#acf7d6ff8498e4c50ee13ac0711210c72">s</a>, f);</div><div class="line"><a name="l03589"></a><span class="lineno"> 3589</span>&#160;         <a class="code" href="../../d6/d66/include_2asterisk_2frame_8h.html#a6440d070425a2efe8e0aa71e8d9e47b7">ast_frfree</a>(f);</div><div class="line"><a name="l03590"></a><span class="lineno"> 3590</span>&#160;      } <span class="keywordflow">else</span> {</div><div class="line"><a name="l03591"></a><span class="lineno"> 3591</span>&#160;         gateway-&gt;<a class="code" href="../../dd/dd2/structfax__gateway.html#acf7d6ff8498e4c50ee13ac0711210c72">s</a>-&gt;<a class="code" href="../../d1/d16/structast__fax__session.html#a4ac6ff3775e67c710cd55bc7dfd592fe">tech</a>-&gt;<a class="code" href="../../d9/d0e/structast__fax__tech.html#a7014a7b1d150a523cf1273e6fee5bdd6">write</a>(gateway-&gt;<a class="code" href="../../dd/dd2/structfax__gateway.html#acf7d6ff8498e4c50ee13ac0711210c72">s</a>, f);</div><div class="line"><a name="l03592"></a><span class="lineno"> 3592</span>&#160;      }</div><div class="line"><a name="l03593"></a><span class="lineno"> 3593</span>&#160;</div><div class="line"><a name="l03594"></a><span class="lineno"> 3594</span>&#160;      f = &amp;<a class="code" href="../../d6/d66/include_2asterisk_2frame_8h.html#af203379aca2fd704fe8d86a9445596b6">ast_null_frame</a>;</div><div class="line"><a name="l03595"></a><span class="lineno"> 3595</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../d1/d47/structast__trans__pvt.html#a735f764b1095611ace084e7c6c06857d">f</a>;</div><div class="line"><a name="l03596"></a><span class="lineno"> 3596</span>&#160;   }</div><div class="line"><a name="l03597"></a><span class="lineno"> 3597</span>&#160;</div><div class="line"><a name="l03598"></a><span class="lineno"> 3598</span>&#160;   <span class="comment">/* force silence on the line if T.38 negotiation might be taking place */</span></div><div class="line"><a name="l03599"></a><span class="lineno"> 3599</span>&#160;   <span class="keywordflow">if</span> (gateway-&gt;<a class="code" href="../../dd/dd2/structfax__gateway.html#a37f4333f3e7eaf12966069b77dac704e">t38_state</a> != <a class="code" href="../../d5/d7b/channel_8h.html#a4cd990f4c1cd0c2af6e4c63f6d15b4e1a8bd9e539fb6a17b095fb24a75e0b4d21">T38_STATE_UNAVAILABLE</a> &amp;&amp; gateway-&gt;<a class="code" href="../../dd/dd2/structfax__gateway.html#a37f4333f3e7eaf12966069b77dac704e">t38_state</a> != <a class="code" href="../../d5/d7b/channel_8h.html#a4cd990f4c1cd0c2af6e4c63f6d15b4e1ad3745918c0830d3816e5ce5561814e7e">T38_STATE_REJECTED</a>) {</div><div class="line"><a name="l03600"></a><span class="lineno"> 3600</span>&#160;      <span class="keywordflow">if</span> (f-&gt;<a class="code" href="../../d0/d99/structast__frame.html#a6937b93c56cb473b547eda454dca7b4c">frametype</a> == <a class="code" href="../../d6/d66/include_2asterisk_2frame_8h.html#ae2e1a9c4e048da387b761f619312d6e0aa457fe7005f11bb7b21453f9bb4caa8f">AST_FRAME_VOICE</a> &amp;&amp;</div><div class="line"><a name="l03601"></a><span class="lineno"> 3601</span>&#160;         (<a class="code" href="../../d0/d0a/format_8h.html#a738c58eca291b71de4422e95bff27400">ast_format_cmp</a>(f-&gt;<a class="code" href="../../d0/d99/structast__frame.html#a27237c48fdcd22556401f20c693811db">subclass</a>.<a class="code" href="../../d1/d9f/structast__frame__subclass.html#ab425a484a0916077c5a30d9d7b229b44">format</a>, <a class="code" href="../../db/d1c/format__cache_8h.html#a771d7c34570e8e492c25a0c2eb41889d">ast_format_slin</a>) == <a class="code" href="../../d0/d0a/format_8h.html#a79bdf0b3c0616d9950d00cfeb62295c3ab1e8c1a0f8b4a1ecb6a2109992636859">AST_FORMAT_CMP_EQUAL</a>)) {</div><div class="line"><a name="l03602"></a><span class="lineno"> 3602</span>&#160;         <span class="keywordtype">short</span> silence_buf[f-&gt;<a class="code" href="../../d0/d99/structast__frame.html#a37672e6b906143604cefd3e959777b31">samples</a>];</div><div class="line"><a name="l03603"></a><span class="lineno"> 3603</span>&#160;         <span class="keyword">struct </span><a class="code" href="../../d0/d99/structast__frame.html">ast_frame</a> silence_frame = {</div><div class="line"><a name="l03604"></a><span class="lineno"> 3604</span>&#160;            .<a class="code" href="../../d0/d99/structast__frame.html#a6937b93c56cb473b547eda454dca7b4c">frametype</a> = <a class="code" href="../../d6/d66/include_2asterisk_2frame_8h.html#ae2e1a9c4e048da387b761f619312d6e0aa457fe7005f11bb7b21453f9bb4caa8f">AST_FRAME_VOICE</a>,</div><div class="line"><a name="l03605"></a><span class="lineno"> 3605</span>&#160;            .subclass.format = <a class="code" href="../../db/d1c/format__cache_8h.html#a771d7c34570e8e492c25a0c2eb41889d">ast_format_slin</a>,</div><div class="line"><a name="l03606"></a><span class="lineno"> 3606</span>&#160;            .data.ptr = silence_buf,</div><div class="line"><a name="l03607"></a><span class="lineno"> 3607</span>&#160;            .samples = f-&gt;<a class="code" href="../../d0/d99/structast__frame.html#a37672e6b906143604cefd3e959777b31">samples</a>,</div><div class="line"><a name="l03608"></a><span class="lineno"> 3608</span>&#160;            .datalen = <span class="keyword">sizeof</span>(silence_buf),</div><div class="line"><a name="l03609"></a><span class="lineno"> 3609</span>&#160;         };</div><div class="line"><a name="l03610"></a><span class="lineno"> 3610</span>&#160;         memset(silence_buf, 0, <span class="keyword">sizeof</span>(silence_buf));</div><div class="line"><a name="l03611"></a><span class="lineno"> 3611</span>&#160;         <span class="keywordflow">return</span> <a class="code" href="../../d6/d66/include_2asterisk_2frame_8h.html#a314496ce1d74ed7fdb9c5319c5e2e953">ast_frisolate</a>(&amp;silence_frame);</div><div class="line"><a name="l03612"></a><span class="lineno"> 3612</span>&#160;      } <span class="keywordflow">else</span> {</div><div class="line"><a name="l03613"></a><span class="lineno"> 3613</span>&#160;         <span class="keywordflow">return</span> &amp;<a class="code" href="../../d6/d66/include_2asterisk_2frame_8h.html#af203379aca2fd704fe8d86a9445596b6">ast_null_frame</a>;</div><div class="line"><a name="l03614"></a><span class="lineno"> 3614</span>&#160;      }</div><div class="line"><a name="l03615"></a><span class="lineno"> 3615</span>&#160;   }</div><div class="line"><a name="l03616"></a><span class="lineno"> 3616</span>&#160;</div><div class="line"><a name="l03617"></a><span class="lineno"> 3617</span>&#160;   <span class="keywordflow">return</span> f;</div><div class="line"><a name="l03618"></a><span class="lineno"> 3618</span>&#160;}</div><div class="line"><a name="l03619"></a><span class="lineno"> 3619</span>&#160;<span class="comment"></span></div><div class="line"><a name="l03620"></a><span class="lineno"> 3620</span>&#160;<span class="comment">/*! \brief Attach a gateway framehook object to a channel.</span></div><div class="line"><a name="l03621"></a><span class="lineno"> 3621</span>&#160;<span class="comment"> * \param chan the channel to attach to</span></div><div class="line"><a name="l03622"></a><span class="lineno"> 3622</span>&#160;<span class="comment"> * \param details fax session details</span></div><div class="line"><a name="l03623"></a><span class="lineno"> 3623</span>&#160;<span class="comment"> * \return the framehook id of the attached framehook or -1 on error</span></div><div class="line"><a name="l03624"></a><span class="lineno"> 3624</span>&#160;<span class="comment"> * \retval -1 error</span></div><div class="line"><a name="l03625"></a><span class="lineno"> 3625</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l03626"></a><span class="lineno"><a class="line" href="../../d0/d60/res__fax_8c.html#a87718f9b64d50c694da714f631626807"> 3626</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d0/d60/res__fax_8c.html#a87718f9b64d50c694da714f631626807">fax_gateway_attach</a>(<span class="keyword">struct</span> <a class="code" href="../../df/d3c/structast__channel.html">ast_channel</a> *chan, <span class="keyword">struct</span> <a class="code" href="../../d8/dc2/structast__fax__session__details.html">ast_fax_session_details</a> *details)</div><div class="line"><a name="l03627"></a><span class="lineno"> 3627</span>&#160;{</div><div class="line"><a name="l03628"></a><span class="lineno"> 3628</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../dd/dd2/structfax__gateway.html">fax_gateway</a> *gateway;</div><div class="line"><a name="l03629"></a><span class="lineno"> 3629</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d3/d7b/structast__framehook__interface.html">ast_framehook_interface</a> fr_hook = {</div><div class="line"><a name="l03630"></a><span class="lineno"> 3630</span>&#160;      .<a class="code" href="../../d3/d7b/structast__framehook__interface.html#ab6d7b6f8c2ceaba7acda80aaf05f4899">version</a> = <a class="code" href="../../db/d3c/framehook_8h.html#ae3b6fa28df6c8608d05936efaf929f32">AST_FRAMEHOOK_INTERFACE_VERSION</a>,</div><div class="line"><a name="l03631"></a><span class="lineno"> 3631</span>&#160;      .event_cb = <a class="code" href="../../d0/d60/res__fax_8c.html#a55af247b700c6bcc938efffd92e55802">fax_gateway_framehook</a>,</div><div class="line"><a name="l03632"></a><span class="lineno"> 3632</span>&#160;      .destroy_cb = <a class="code" href="../../d0/d60/res__fax_8c.html#a792719145deb79c5c8ad82b739ab564e">fax_gateway_framehook_destroy</a>,</div><div class="line"><a name="l03633"></a><span class="lineno"> 3633</span>&#160;      .disable_inheritance = 1, <span class="comment">/* Masquerade inheritance is handled through the datastore fixup */</span></div><div class="line"><a name="l03634"></a><span class="lineno"> 3634</span>&#160;   };</div><div class="line"><a name="l03635"></a><span class="lineno"> 3635</span>&#160;</div><div class="line"><a name="l03636"></a><span class="lineno"> 3636</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d0/d60/res__fax_8c.html#afb6be9ca0b6c0d09211b5c4e55fa2291">global_fax_debug</a>) {</div><div class="line"><a name="l03637"></a><span class="lineno"> 3637</span>&#160;      details-&gt;<a class="code" href="../../d8/dc2/structast__fax__session__details.html#a3ab211dbe8780b7292257f6b3dba1952">option</a>.<a class="code" href="../../d8/dc2/structast__fax__session__details.html#a84360ac08d9be11f221466122d8cdc65">debug</a> = <a class="code" href="../../db/d6a/res__fax_8h.html#a1838c71fcf68c3cfe0ce37e35e77406dabd9b4a57405ba5c0c884ac98746a8bd7">AST_FAX_OPTFLAG_TRUE</a>;</div><div class="line"><a name="l03638"></a><span class="lineno"> 3638</span>&#160;   }</div><div class="line"><a name="l03639"></a><span class="lineno"> 3639</span>&#160;</div><div class="line"><a name="l03640"></a><span class="lineno"> 3640</span>&#160;   <a class="code" href="../../d1/d0f/stringfields_8h.html#a653461abd6e0d16e4e3326ab90e0501d">ast_string_field_set</a>(details, <a class="code" href="../../de/d1b/cel__pgsql_8c.html#ad6c487210772a9b4b0ca04b04b847d4c">result</a>, <span class="stringliteral">&quot;SUCCESS&quot;</span>);</div><div class="line"><a name="l03641"></a><span class="lineno"> 3641</span>&#160;   <a class="code" href="../../d1/d0f/stringfields_8h.html#a653461abd6e0d16e4e3326ab90e0501d">ast_string_field_set</a>(details, resultstr, <span class="stringliteral">&quot;gateway operation started successfully&quot;</span>);</div><div class="line"><a name="l03642"></a><span class="lineno"> 3642</span>&#160;   <a class="code" href="../../d1/d0f/stringfields_8h.html#a653461abd6e0d16e4e3326ab90e0501d">ast_string_field_set</a>(details, <a class="code" href="../../d6/d47/utils_2frame_8c.html#a4a9391ee88e57361b613c4c2fd2bf4aa">error</a>, <span class="stringliteral">&quot;NO_ERROR&quot;</span>);</div><div class="line"><a name="l03643"></a><span class="lineno"> 3643</span>&#160;   <a class="code" href="../../d0/d60/res__fax_8c.html#ad7732b5ae304d39afa2dacb20187cf04">set_channel_variables</a>(chan, details);</div><div class="line"><a name="l03644"></a><span class="lineno"> 3644</span>&#160;</div><div class="line"><a name="l03645"></a><span class="lineno"> 3645</span>&#160;   <span class="comment">/* set up the frame hook*/</span></div><div class="line"><a name="l03646"></a><span class="lineno"> 3646</span>&#160;   gateway = <a class="code" href="../../d0/d60/res__fax_8c.html#a47e8837147c2482dcde5be39f354e03c">fax_gateway_new</a>(chan, details);</div><div class="line"><a name="l03647"></a><span class="lineno"> 3647</span>&#160;   <span class="keywordflow">if</span> (!gateway) {</div><div class="line"><a name="l03648"></a><span class="lineno"> 3648</span>&#160;      <a class="code" href="../../d1/d0f/stringfields_8h.html#a653461abd6e0d16e4e3326ab90e0501d">ast_string_field_set</a>(details, <a class="code" href="../../de/d1b/cel__pgsql_8c.html#ad6c487210772a9b4b0ca04b04b847d4c">result</a>, <span class="stringliteral">&quot;FAILED&quot;</span>);</div><div class="line"><a name="l03649"></a><span class="lineno"> 3649</span>&#160;      <a class="code" href="../../d1/d0f/stringfields_8h.html#a653461abd6e0d16e4e3326ab90e0501d">ast_string_field_set</a>(details, resultstr, <span class="stringliteral">&quot;error initializing gateway session&quot;</span>);</div><div class="line"><a name="l03650"></a><span class="lineno"> 3650</span>&#160;      <a class="code" href="../../d1/d0f/stringfields_8h.html#a653461abd6e0d16e4e3326ab90e0501d">ast_string_field_set</a>(details, <a class="code" href="../../d6/d47/utils_2frame_8c.html#a4a9391ee88e57361b613c4c2fd2bf4aa">error</a>, <span class="stringliteral">&quot;INIT_ERROR&quot;</span>);</div><div class="line"><a name="l03651"></a><span class="lineno"> 3651</span>&#160;      details-&gt;<a class="code" href="../../d8/dc2/structast__fax__session__details.html#aa3cf325797b2746fbd79f34b2fd45370">is_t38_negotiated</a> = 0;</div><div class="line"><a name="l03652"></a><span class="lineno"> 3652</span>&#160;      <a class="code" href="../../d0/d60/res__fax_8c.html#ad7732b5ae304d39afa2dacb20187cf04">set_channel_variables</a>(chan, details);</div><div class="line"><a name="l03653"></a><span class="lineno"> 3653</span>&#160;      <a class="code" href="../../d0/d60/res__fax_8c.html#a38d73af44b480b7cad7a654f75926777">report_fax_status</a>(chan, details, <span class="stringliteral">&quot;No Available Resource&quot;</span>);</div><div class="line"><a name="l03654"></a><span class="lineno"> 3654</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l03655"></a><span class="lineno"> 3655</span>&#160;   }</div><div class="line"><a name="l03656"></a><span class="lineno"> 3656</span>&#160;</div><div class="line"><a name="l03657"></a><span class="lineno"> 3657</span>&#160;   fr_hook.<a class="code" href="../../d3/d7b/structast__framehook__interface.html#a735984d41155bc1032e09bece8f8d66d">data</a> = gateway;</div><div class="line"><a name="l03658"></a><span class="lineno"> 3658</span>&#160;   <a class="code" href="../../d5/d7b/channel_8h.html#a493bdebe876caafb8ee535853310364a">ast_channel_lock</a>(chan);</div><div class="line"><a name="l03659"></a><span class="lineno"> 3659</span>&#160;   gateway-&gt;<a class="code" href="../../dd/dd2/structfax__gateway.html#ae25f61b5aa8877dfb396fd378c6b7722">framehook</a> = <a class="code" href="../../db/d3c/framehook_8h.html#a3ca711dc98d26e881936c855f0ae3d77">ast_framehook_attach</a>(chan, &amp;fr_hook);</div><div class="line"><a name="l03660"></a><span class="lineno"> 3660</span>&#160;   <a class="code" href="../../d5/d7b/channel_8h.html#af476c537b29be3f29240489032f9db39">ast_channel_unlock</a>(chan);</div><div class="line"><a name="l03661"></a><span class="lineno"> 3661</span>&#160;</div><div class="line"><a name="l03662"></a><span class="lineno"> 3662</span>&#160;   <span class="keywordflow">if</span> (gateway-&gt;<a class="code" href="../../dd/dd2/structfax__gateway.html#ae25f61b5aa8877dfb396fd378c6b7722">framehook</a> &lt; 0) {</div><div class="line"><a name="l03663"></a><span class="lineno"> 3663</span>&#160;      <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(gateway, -1);</div><div class="line"><a name="l03664"></a><span class="lineno"> 3664</span>&#160;      <a class="code" href="../../d1/d0f/stringfields_8h.html#a653461abd6e0d16e4e3326ab90e0501d">ast_string_field_set</a>(details, <a class="code" href="../../de/d1b/cel__pgsql_8c.html#ad6c487210772a9b4b0ca04b04b847d4c">result</a>, <span class="stringliteral">&quot;FAILED&quot;</span>);</div><div class="line"><a name="l03665"></a><span class="lineno"> 3665</span>&#160;      <a class="code" href="../../d1/d0f/stringfields_8h.html#a653461abd6e0d16e4e3326ab90e0501d">ast_string_field_set</a>(details, resultstr, <span class="stringliteral">&quot;error attaching gateway to channel&quot;</span>);</div><div class="line"><a name="l03666"></a><span class="lineno"> 3666</span>&#160;      <a class="code" href="../../d1/d0f/stringfields_8h.html#a653461abd6e0d16e4e3326ab90e0501d">ast_string_field_set</a>(details, <a class="code" href="../../d6/d47/utils_2frame_8c.html#a4a9391ee88e57361b613c4c2fd2bf4aa">error</a>, <span class="stringliteral">&quot;INIT_ERROR&quot;</span>);</div><div class="line"><a name="l03667"></a><span class="lineno"> 3667</span>&#160;      details-&gt;<a class="code" href="../../d8/dc2/structast__fax__session__details.html#aa3cf325797b2746fbd79f34b2fd45370">is_t38_negotiated</a> = 0;</div><div class="line"><a name="l03668"></a><span class="lineno"> 3668</span>&#160;      <a class="code" href="../../d0/d60/res__fax_8c.html#ad7732b5ae304d39afa2dacb20187cf04">set_channel_variables</a>(chan, details);</div><div class="line"><a name="l03669"></a><span class="lineno"> 3669</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l03670"></a><span class="lineno"> 3670</span>&#160;   }</div><div class="line"><a name="l03671"></a><span class="lineno"> 3671</span>&#160;</div><div class="line"><a name="l03672"></a><span class="lineno"> 3672</span>&#160;   <span class="keywordflow">return</span> gateway-&gt;<a class="code" href="../../dd/dd2/structfax__gateway.html#ae25f61b5aa8877dfb396fd378c6b7722">framehook</a>;</div><div class="line"><a name="l03673"></a><span class="lineno"> 3673</span>&#160;}</div><div class="line"><a name="l03674"></a><span class="lineno"> 3674</span>&#160;<span class="comment"></span></div><div class="line"><a name="l03675"></a><span class="lineno"> 3675</span>&#160;<span class="comment">/*! \brief destroy a FAX detect structure */</span></div><div class="line"><a name="l03676"></a><span class="lineno"><a class="line" href="../../d0/d60/res__fax_8c.html#ad43f70b44389967e168e43ee8df32201"> 3676</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d0/d60/res__fax_8c.html#ad43f70b44389967e168e43ee8df32201">destroy_faxdetect</a>(<span class="keywordtype">void</span> *data)</div><div class="line"><a name="l03677"></a><span class="lineno"> 3677</span>&#160;{</div><div class="line"><a name="l03678"></a><span class="lineno"> 3678</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../da/df6/structfax__detect.html">fax_detect</a> *faxdetect = data;</div><div class="line"><a name="l03679"></a><span class="lineno"> 3679</span>&#160;</div><div class="line"><a name="l03680"></a><span class="lineno"> 3680</span>&#160;   <span class="keywordflow">if</span> (faxdetect-&gt;<a class="code" href="../../da/df6/structfax__detect.html#ab9deccb020b39c3f7ac94b1af99cac5d">dsp</a>) {</div><div class="line"><a name="l03681"></a><span class="lineno"> 3681</span>&#160;      <a class="code" href="../../d3/d08/dsp_8h.html#a0a57a1e374549eb2705068688f4046db">ast_dsp_free</a>(faxdetect-&gt;<a class="code" href="../../da/df6/structfax__detect.html#ab9deccb020b39c3f7ac94b1af99cac5d">dsp</a>);</div><div class="line"><a name="l03682"></a><span class="lineno"> 3682</span>&#160;      faxdetect-&gt;<a class="code" href="../../da/df6/structfax__detect.html#ab9deccb020b39c3f7ac94b1af99cac5d">dsp</a> = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l03683"></a><span class="lineno"> 3683</span>&#160;   }</div><div class="line"><a name="l03684"></a><span class="lineno"> 3684</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#a6321ee982370c55ab3c24c72c562cbdd">ao2_cleanup</a>(faxdetect-&gt;<a class="code" href="../../da/df6/structfax__detect.html#ae7b633178d301df70e8612b4ce1aeb77">details</a>);</div><div class="line"><a name="l03685"></a><span class="lineno"> 3685</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#a6321ee982370c55ab3c24c72c562cbdd">ao2_cleanup</a>(faxdetect-&gt;<a class="code" href="../../da/df6/structfax__detect.html#ae5329584b2cf034725f675183f6bd391">orig_format</a>);</div><div class="line"><a name="l03686"></a><span class="lineno"> 3686</span>&#160;}</div><div class="line"><a name="l03687"></a><span class="lineno"> 3687</span>&#160;<span class="comment"></span></div><div class="line"><a name="l03688"></a><span class="lineno"> 3688</span>&#160;<span class="comment">/*! \brief Create a new fax detect object.</span></div><div class="line"><a name="l03689"></a><span class="lineno"> 3689</span>&#160;<span class="comment"> * \param chan the channel attaching to</span></div><div class="line"><a name="l03690"></a><span class="lineno"> 3690</span>&#160;<span class="comment"> * \param timeout in ms to remove framehook in this time if not zero</span></div><div class="line"><a name="l03691"></a><span class="lineno"> 3691</span>&#160;<span class="comment"> * \param flags required options</span></div><div class="line"><a name="l03692"></a><span class="lineno"> 3692</span>&#160;<span class="comment"> * \return NULL or a fax gateway object</span></div><div class="line"><a name="l03693"></a><span class="lineno"> 3693</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l03694"></a><span class="lineno"><a class="line" href="../../d0/d60/res__fax_8c.html#a1599952156d1b1f2be32eb21bcdbf1d9"> 3694</a></span>&#160;<span class="keyword">static</span> <span class="keyword">struct </span><a class="code" href="../../da/df6/structfax__detect.html">fax_detect</a> *<a class="code" href="../../d0/d60/res__fax_8c.html#a1599952156d1b1f2be32eb21bcdbf1d9">fax_detect_new</a>(<span class="keyword">struct</span> <a class="code" href="../../df/d3c/structast__channel.html">ast_channel</a> *chan, <span class="keywordtype">int</span> timeout, <span class="keywordtype">int</span> flags)</div><div class="line"><a name="l03695"></a><span class="lineno"> 3695</span>&#160;{</div><div class="line"><a name="l03696"></a><span class="lineno"> 3696</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../da/df6/structfax__detect.html">fax_detect</a> *faxdetect = <a class="code" href="../../d5/da5/astobj2_8h.html#ae0422b60d8e25b6962b2d61ae4ddf724">ao2_alloc</a>(<span class="keyword">sizeof</span>(*faxdetect), <a class="code" href="../../d0/d60/res__fax_8c.html#ad43f70b44389967e168e43ee8df32201">destroy_faxdetect</a>);</div><div class="line"><a name="l03697"></a><span class="lineno"> 3697</span>&#160;   <span class="keywordflow">if</span> (!faxdetect) {</div><div class="line"><a name="l03698"></a><span class="lineno"> 3698</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l03699"></a><span class="lineno"> 3699</span>&#160;   }</div><div class="line"><a name="l03700"></a><span class="lineno"> 3700</span>&#160;</div><div class="line"><a name="l03701"></a><span class="lineno"> 3701</span>&#160;   faxdetect-&gt;<a class="code" href="../../da/df6/structfax__detect.html#ac8bf36fe0577cba66bccda3a6f7e80a4">flags</a> = <a class="code" href="../../da/df6/structfax__detect.html#ac8bf36fe0577cba66bccda3a6f7e80a4">flags</a>;</div><div class="line"><a name="l03702"></a><span class="lineno"> 3702</span>&#160;</div><div class="line"><a name="l03703"></a><span class="lineno"> 3703</span>&#160;   <span class="keywordflow">if</span> (timeout) {</div><div class="line"><a name="l03704"></a><span class="lineno"> 3704</span>&#160;      faxdetect-&gt;<a class="code" href="../../da/df6/structfax__detect.html#a23b38dad7025290be3461b4b3208b4e6">timeout_start</a> = <a class="code" href="../../de/df7/time_8h.html#ad3899efb6f0e348556ef69f5b16aa7f7">ast_tvnow</a>();</div><div class="line"><a name="l03705"></a><span class="lineno"> 3705</span>&#160;   } <span class="keywordflow">else</span> {</div><div class="line"><a name="l03706"></a><span class="lineno"> 3706</span>&#160;      faxdetect-&gt;<a class="code" href="../../da/df6/structfax__detect.html#a23b38dad7025290be3461b4b3208b4e6">timeout_start</a>.tv_sec = 0;</div><div class="line"><a name="l03707"></a><span class="lineno"> 3707</span>&#160;      faxdetect-&gt;<a class="code" href="../../da/df6/structfax__detect.html#a23b38dad7025290be3461b4b3208b4e6">timeout_start</a>.tv_usec = 0;</div><div class="line"><a name="l03708"></a><span class="lineno"> 3708</span>&#160;   }</div><div class="line"><a name="l03709"></a><span class="lineno"> 3709</span>&#160;</div><div class="line"><a name="l03710"></a><span class="lineno"> 3710</span>&#160;   <span class="keywordflow">if</span> (faxdetect-&gt;<a class="code" href="../../da/df6/structfax__detect.html#ac8bf36fe0577cba66bccda3a6f7e80a4">flags</a> &amp; <a class="code" href="../../d0/d60/res__fax_8c.html#af4165a00608b669d97f5acbe873dc1f7">FAX_DETECT_MODE_CNG</a>) {</div><div class="line"><a name="l03711"></a><span class="lineno"> 3711</span>&#160;      faxdetect-&gt;<a class="code" href="../../da/df6/structfax__detect.html#ab9deccb020b39c3f7ac94b1af99cac5d">dsp</a> = <a class="code" href="../../d3/d08/dsp_8h.html#a0a60e93006c8e1ca8fda922ae0e0da2c">ast_dsp_new</a>();</div><div class="line"><a name="l03712"></a><span class="lineno"> 3712</span>&#160;      <span class="keywordflow">if</span> (!faxdetect-&gt;<a class="code" href="../../da/df6/structfax__detect.html#ab9deccb020b39c3f7ac94b1af99cac5d">dsp</a>) {</div><div class="line"><a name="l03713"></a><span class="lineno"> 3713</span>&#160;         <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(faxdetect, -1);</div><div class="line"><a name="l03714"></a><span class="lineno"> 3714</span>&#160;         <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l03715"></a><span class="lineno"> 3715</span>&#160;      }</div><div class="line"><a name="l03716"></a><span class="lineno"> 3716</span>&#160;      <a class="code" href="../../d3/d08/dsp_8h.html#aedc7fa20fba91e3c018f6989e95c714b">ast_dsp_set_features</a>(faxdetect-&gt;<a class="code" href="../../da/df6/structfax__detect.html#ab9deccb020b39c3f7ac94b1af99cac5d">dsp</a>, <a class="code" href="../../d3/d08/dsp_8h.html#a92045e8a8ad56b9b31d24db325fa95ab">DSP_FEATURE_FAX_DETECT</a>);</div><div class="line"><a name="l03717"></a><span class="lineno"> 3717</span>&#160;      <a class="code" href="../../d3/d08/dsp_8h.html#ad3cfa673380a4763168ce800db8b2f0b">ast_dsp_set_faxmode</a>(faxdetect-&gt;<a class="code" href="../../da/df6/structfax__detect.html#ab9deccb020b39c3f7ac94b1af99cac5d">dsp</a>, <a class="code" href="../../d3/d08/dsp_8h.html#aa97125e8415ed15db98bb7e79b17ab73">DSP_FAXMODE_DETECT_CNG</a> | <a class="code" href="../../d3/d08/dsp_8h.html#a9baae529c58a54aaa53a0ccef8caa05e">DSP_FAXMODE_DETECT_SQUELCH</a>);</div><div class="line"><a name="l03718"></a><span class="lineno"> 3718</span>&#160;   } <span class="keywordflow">else</span> {</div><div class="line"><a name="l03719"></a><span class="lineno"> 3719</span>&#160;      faxdetect-&gt;<a class="code" href="../../da/df6/structfax__detect.html#ab9deccb020b39c3f7ac94b1af99cac5d">dsp</a> = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l03720"></a><span class="lineno"> 3720</span>&#160;   }</div><div class="line"><a name="l03721"></a><span class="lineno"> 3721</span>&#160;</div><div class="line"><a name="l03722"></a><span class="lineno"> 3722</span>&#160;   <span class="keywordflow">return</span> faxdetect;</div><div class="line"><a name="l03723"></a><span class="lineno"> 3723</span>&#160;}</div><div class="line"><a name="l03724"></a><span class="lineno"> 3724</span>&#160;<span class="comment"></span></div><div class="line"><a name="l03725"></a><span class="lineno"> 3725</span>&#160;<span class="comment">/*! \brief Deref the faxdetect data structure when the faxdetect framehook is detached</span></div><div class="line"><a name="l03726"></a><span class="lineno"> 3726</span>&#160;<span class="comment"> * \param data framehook data (faxdetect data)*/</span></div><div class="line"><a name="l03727"></a><span class="lineno"><a class="line" href="../../d0/d60/res__fax_8c.html#a53f13b154b4691e9b1b5e9c2323f399c"> 3727</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d0/d60/res__fax_8c.html#a53f13b154b4691e9b1b5e9c2323f399c">fax_detect_framehook_destroy</a>(<span class="keywordtype">void</span> *data)</div><div class="line"><a name="l03728"></a><span class="lineno"> 3728</span>&#160;{</div><div class="line"><a name="l03729"></a><span class="lineno"> 3729</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../da/df6/structfax__detect.html">fax_detect</a> *faxdetect = data;</div><div class="line"><a name="l03730"></a><span class="lineno"> 3730</span>&#160;</div><div class="line"><a name="l03731"></a><span class="lineno"> 3731</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(faxdetect, -1);</div><div class="line"><a name="l03732"></a><span class="lineno"> 3732</span>&#160;}</div><div class="line"><a name="l03733"></a><span class="lineno"> 3733</span>&#160;<span class="comment"></span></div><div class="line"><a name="l03734"></a><span class="lineno"> 3734</span>&#160;<span class="comment">/*! \brief Fax Detect Framehook</span></div><div class="line"><a name="l03735"></a><span class="lineno"> 3735</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l03736"></a><span class="lineno"> 3736</span>&#160;<span class="comment"> * Listen for fax tones in audio path and enable jumping to a extension when detected.</span></div><div class="line"><a name="l03737"></a><span class="lineno"> 3737</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l03738"></a><span class="lineno"> 3738</span>&#160;<span class="comment"> * \param chan channel</span></div><div class="line"><a name="l03739"></a><span class="lineno"> 3739</span>&#160;<span class="comment"> * \param f frame to handle may be NULL</span></div><div class="line"><a name="l03740"></a><span class="lineno"> 3740</span>&#160;<span class="comment"> * \param event framehook event</span></div><div class="line"><a name="l03741"></a><span class="lineno"> 3741</span>&#160;<span class="comment"> * \param data framehook data (struct fax_detect *)</span></div><div class="line"><a name="l03742"></a><span class="lineno"> 3742</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l03743"></a><span class="lineno"> 3743</span>&#160;<span class="comment"> * \return processed frame or NULL when f is NULL or a null frame</span></div><div class="line"><a name="l03744"></a><span class="lineno"> 3744</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l03745"></a><span class="lineno"><a class="line" href="../../d0/d60/res__fax_8c.html#ac527bcc9f23787a9eca1e170210f361e"> 3745</a></span>&#160;<span class="keyword">static</span> <span class="keyword">struct </span><a class="code" href="../../d0/d99/structast__frame.html">ast_frame</a> *<a class="code" href="../../d0/d60/res__fax_8c.html#ac527bcc9f23787a9eca1e170210f361e">fax_detect_framehook</a>(<span class="keyword">struct</span> <a class="code" href="../../df/d3c/structast__channel.html">ast_channel</a> *chan, <span class="keyword">struct</span> <a class="code" href="../../d0/d99/structast__frame.html">ast_frame</a> *f, <span class="keyword">enum</span> <a class="code" href="../../db/d3c/framehook_8h.html#a54250544f50efde9156d2341e8da0614">ast_framehook_event</a> <a class="code" href="../../df/d7d/structevent.html">event</a>, <span class="keywordtype">void</span> *data)</div><div class="line"><a name="l03746"></a><span class="lineno"> 3746</span>&#160;{</div><div class="line"><a name="l03747"></a><span class="lineno"> 3747</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../da/df6/structfax__detect.html">fax_detect</a> *faxdetect = data;</div><div class="line"><a name="l03748"></a><span class="lineno"> 3748</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d8/dc2/structast__fax__session__details.html">ast_fax_session_details</a> *details;</div><div class="line"><a name="l03749"></a><span class="lineno"> 3749</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d5/def/structast__control__t38__parameters.html">ast_control_t38_parameters</a> *control_params;</div><div class="line"><a name="l03750"></a><span class="lineno"> 3750</span>&#160;   <a class="code" href="../../d5/d60/utils_8h.html#a1604b4d72144dd3d9f7da668e90337e9">RAII_VAR</a>(<span class="keyword">struct</span> <a class="code" href="../../df/d3c/structast__channel.html">ast_channel</a> *, peer, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../d5/da5/astobj2_8h.html#a6321ee982370c55ab3c24c72c562cbdd">ao2_cleanup</a>);</div><div class="line"><a name="l03751"></a><span class="lineno"> 3751</span>&#160;   <a class="code" href="../../d5/d60/utils_8h.html#a1604b4d72144dd3d9f7da668e90337e9">RAII_VAR</a>(<span class="keyword">struct</span> <a class="code" href="../../df/d3c/structast__channel.html">ast_channel</a> *, chan_ref, chan, <a class="code" href="../../d5/da5/astobj2_8h.html#a6321ee982370c55ab3c24c72c562cbdd">ao2_cleanup</a>);</div><div class="line"><a name="l03752"></a><span class="lineno"> 3752</span>&#160;   <span class="keywordtype">int</span> <a class="code" href="../../de/d1b/cel__pgsql_8c.html#ad6c487210772a9b4b0ca04b04b847d4c">result</a> = 0;</div><div class="line"><a name="l03753"></a><span class="lineno"> 3753</span>&#160;</div><div class="line"><a name="l03754"></a><span class="lineno"> 3754</span>&#160;   <span class="comment">/* Ref bump the channel for when we have to unlock it */</span></div><div class="line"><a name="l03755"></a><span class="lineno"> 3755</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(chan, 1);</div><div class="line"><a name="l03756"></a><span class="lineno"> 3756</span>&#160;</div><div class="line"><a name="l03757"></a><span class="lineno"> 3757</span>&#160;   details = faxdetect-&gt;<a class="code" href="../../da/df6/structfax__detect.html#ae7b633178d301df70e8612b4ce1aeb77">details</a>;</div><div class="line"><a name="l03758"></a><span class="lineno"> 3758</span>&#160;</div><div class="line"><a name="l03759"></a><span class="lineno"> 3759</span>&#160;   <span class="keywordflow">switch</span> (event) {</div><div class="line"><a name="l03760"></a><span class="lineno"> 3760</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="../../db/d3c/framehook_8h.html#a54250544f50efde9156d2341e8da0614a890a69eb197e4612993b98f04ab73ead">AST_FRAMEHOOK_EVENT_ATTACHED</a>:</div><div class="line"><a name="l03761"></a><span class="lineno"> 3761</span>&#160;      <span class="comment">/* Setup format for DSP on ATTACH*/</span></div><div class="line"><a name="l03762"></a><span class="lineno"> 3762</span>&#160;      <a class="code" href="../../d5/da5/astobj2_8h.html#aa81c8462bd0574f4f9e09e71f2772f44">ao2_replace</a>(faxdetect-&gt;<a class="code" href="../../da/df6/structfax__detect.html#ae5329584b2cf034725f675183f6bd391">orig_format</a>, <a class="code" href="../../d5/d7b/channel_8h.html#aaced431562223538a94e0e69cf94151a">ast_channel_readformat</a>(chan));</div><div class="line"><a name="l03763"></a><span class="lineno"> 3763</span>&#160;</div><div class="line"><a name="l03764"></a><span class="lineno"> 3764</span>&#160;      <span class="keywordflow">if</span> ((<a class="code" href="../../d0/d0a/format_8h.html#a738c58eca291b71de4422e95bff27400">ast_format_cmp</a>(<a class="code" href="../../d5/d7b/channel_8h.html#aaced431562223538a94e0e69cf94151a">ast_channel_readformat</a>(chan), <a class="code" href="../../db/d1c/format__cache_8h.html#a771d7c34570e8e492c25a0c2eb41889d">ast_format_slin</a>) != <a class="code" href="../../d0/d0a/format_8h.html#a79bdf0b3c0616d9950d00cfeb62295c3ab1e8c1a0f8b4a1ecb6a2109992636859">AST_FORMAT_CMP_EQUAL</a>) &amp;&amp;</div><div class="line"><a name="l03765"></a><span class="lineno"> 3765</span>&#160;         (<a class="code" href="../../d0/d0a/format_8h.html#a738c58eca291b71de4422e95bff27400">ast_format_cmp</a>(<a class="code" href="../../d5/d7b/channel_8h.html#aaced431562223538a94e0e69cf94151a">ast_channel_readformat</a>(chan), <a class="code" href="../../db/d1c/format__cache_8h.html#a95c058fe6adef68780f026d6aec2481c">ast_format_alaw</a>) != <a class="code" href="../../d0/d0a/format_8h.html#a79bdf0b3c0616d9950d00cfeb62295c3ab1e8c1a0f8b4a1ecb6a2109992636859">AST_FORMAT_CMP_EQUAL</a>) &amp;&amp;</div><div class="line"><a name="l03766"></a><span class="lineno"> 3766</span>&#160;         (<a class="code" href="../../d0/d0a/format_8h.html#a738c58eca291b71de4422e95bff27400">ast_format_cmp</a>(<a class="code" href="../../d5/d7b/channel_8h.html#aaced431562223538a94e0e69cf94151a">ast_channel_readformat</a>(chan), <a class="code" href="../../db/d1c/format__cache_8h.html#a568c3f5838b53c38f11996dbe5ff5785">ast_format_ulaw</a>) != <a class="code" href="../../d0/d0a/format_8h.html#a79bdf0b3c0616d9950d00cfeb62295c3ab1e8c1a0f8b4a1ecb6a2109992636859">AST_FORMAT_CMP_EQUAL</a>)) {</div><div class="line"><a name="l03767"></a><span class="lineno"> 3767</span>&#160;         <span class="keywordflow">if</span> (<a class="code" href="../../d5/d7b/channel_8h.html#a9107a83365cbf327cc0d12cb0dbd28d8">ast_set_read_format</a>(chan, <a class="code" href="../../db/d1c/format__cache_8h.html#a771d7c34570e8e492c25a0c2eb41889d">ast_format_slin</a>)) {</div><div class="line"><a name="l03768"></a><span class="lineno"> 3768</span>&#160;            <a class="code" href="../../db/d3c/framehook_8h.html#a6e116259cae8c1e5cca074d05f0a3475">ast_framehook_detach</a>(chan, details-&gt;<a class="code" href="../../d8/dc2/structast__fax__session__details.html#aaa69733356239747f442b9543b38cfba">faxdetect_id</a>);</div><div class="line"><a name="l03769"></a><span class="lineno"> 3769</span>&#160;            details-&gt;<a class="code" href="../../d8/dc2/structast__fax__session__details.html#aaa69733356239747f442b9543b38cfba">faxdetect_id</a> = -1;</div><div class="line"><a name="l03770"></a><span class="lineno"> 3770</span>&#160;            <span class="keywordflow">return</span> f;</div><div class="line"><a name="l03771"></a><span class="lineno"> 3771</span>&#160;         }</div><div class="line"><a name="l03772"></a><span class="lineno"> 3772</span>&#160;      }</div><div class="line"><a name="l03773"></a><span class="lineno"> 3773</span>&#160;</div><div class="line"><a name="l03774"></a><span class="lineno"> 3774</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l03775"></a><span class="lineno"> 3775</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="../../db/d3c/framehook_8h.html#a54250544f50efde9156d2341e8da0614a8e213d52d922fb4ab2842022c2252a62">AST_FRAMEHOOK_EVENT_DETACHED</a>:</div><div class="line"><a name="l03776"></a><span class="lineno"> 3776</span>&#160;      <span class="comment">/* restore audio formats when we are detached */</span></div><div class="line"><a name="l03777"></a><span class="lineno"> 3777</span>&#160;      <a class="code" href="../../d5/d7b/channel_8h.html#a9107a83365cbf327cc0d12cb0dbd28d8">ast_set_read_format</a>(chan, faxdetect-&gt;<a class="code" href="../../da/df6/structfax__detect.html#ae5329584b2cf034725f675183f6bd391">orig_format</a>);</div><div class="line"><a name="l03778"></a><span class="lineno"> 3778</span>&#160;      <a class="code" href="../../d5/d7b/channel_8h.html#af476c537b29be3f29240489032f9db39">ast_channel_unlock</a>(chan);</div><div class="line"><a name="l03779"></a><span class="lineno"> 3779</span>&#160;      peer = <a class="code" href="../../d5/d7b/channel_8h.html#af9e27ecd92ff5aa897c9e058dfbd6510">ast_channel_bridge_peer</a>(chan);</div><div class="line"><a name="l03780"></a><span class="lineno"> 3780</span>&#160;      <span class="keywordflow">if</span> (peer) {</div><div class="line"><a name="l03781"></a><span class="lineno"> 3781</span>&#160;         <a class="code" href="../../d5/d7b/channel_8h.html#a4aff0f5358bdc107a92320b4c4631834">ast_channel_make_compatible</a>(chan, peer);</div><div class="line"><a name="l03782"></a><span class="lineno"> 3782</span>&#160;      }</div><div class="line"><a name="l03783"></a><span class="lineno"> 3783</span>&#160;      <a class="code" href="../../d5/d7b/channel_8h.html#a493bdebe876caafb8ee535853310364a">ast_channel_lock</a>(chan);</div><div class="line"><a name="l03784"></a><span class="lineno"> 3784</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l03785"></a><span class="lineno"> 3785</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="../../db/d3c/framehook_8h.html#a54250544f50efde9156d2341e8da0614ab652eafa2595533d8c065a6ac426aa8a">AST_FRAMEHOOK_EVENT_READ</a>:</div><div class="line"><a name="l03786"></a><span class="lineno"> 3786</span>&#160;      <span class="keywordflow">if</span> (f) {</div><div class="line"><a name="l03787"></a><span class="lineno"> 3787</span>&#160;         <span class="keywordflow">break</span>;</div><div class="line"><a name="l03788"></a><span class="lineno"> 3788</span>&#160;      }</div><div class="line"><a name="l03789"></a><span class="lineno"> 3789</span>&#160;   <span class="keywordflow">default</span>:</div><div class="line"><a name="l03790"></a><span class="lineno"> 3790</span>&#160;      <span class="keywordflow">return</span> f;</div><div class="line"><a name="l03791"></a><span class="lineno"> 3791</span>&#160;   };</div><div class="line"><a name="l03792"></a><span class="lineno"> 3792</span>&#160;</div><div class="line"><a name="l03793"></a><span class="lineno"> 3793</span>&#160;   <span class="keywordflow">if</span> (details-&gt;<a class="code" href="../../d8/dc2/structast__fax__session__details.html#aaa69733356239747f442b9543b38cfba">faxdetect_id</a> &lt; 0) {</div><div class="line"><a name="l03794"></a><span class="lineno"> 3794</span>&#160;      <span class="keywordflow">return</span> f;</div><div class="line"><a name="l03795"></a><span class="lineno"> 3795</span>&#160;   }</div><div class="line"><a name="l03796"></a><span class="lineno"> 3796</span>&#160;</div><div class="line"><a name="l03797"></a><span class="lineno"> 3797</span>&#160;   <span class="keywordflow">if</span> (!<a class="code" href="../../de/df7/time_8h.html#a4e7b3508884147c7991a68361ac781a2">ast_tvzero</a>(faxdetect-&gt;<a class="code" href="../../da/df6/structfax__detect.html#a23b38dad7025290be3461b4b3208b4e6">timeout_start</a>)</div><div class="line"><a name="l03798"></a><span class="lineno"> 3798</span>&#160;      &amp;&amp; <a class="code" href="../../de/df7/time_8h.html#aca4ecdab7d8d3519062aad9a90fcb29d">ast_tvdiff_ms</a>(<a class="code" href="../../de/df7/time_8h.html#ad3899efb6f0e348556ef69f5b16aa7f7">ast_tvnow</a>(), faxdetect-&gt;<a class="code" href="../../da/df6/structfax__detect.html#a23b38dad7025290be3461b4b3208b4e6">timeout_start</a>) &gt; details-&gt;<a class="code" href="../../d8/dc2/structast__fax__session__details.html#ab3f309860ee36512bc8bba783df26b1c">faxdetect_timeout</a>) {</div><div class="line"><a name="l03799"></a><span class="lineno"> 3799</span>&#160;      <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(1, <span class="stringliteral">&quot;FAXOPT(faxdetect) timeout on %s\n&quot;</span>, <a class="code" href="../../d5/d7b/channel_8h.html#a7ca2fda13b129a55c251b56729de285b">ast_channel_name</a>(chan));</div><div class="line"><a name="l03800"></a><span class="lineno"> 3800</span>&#160;      <a class="code" href="../../db/d3c/framehook_8h.html#a6e116259cae8c1e5cca074d05f0a3475">ast_framehook_detach</a>(chan, details-&gt;<a class="code" href="../../d8/dc2/structast__fax__session__details.html#aaa69733356239747f442b9543b38cfba">faxdetect_id</a>);</div><div class="line"><a name="l03801"></a><span class="lineno"> 3801</span>&#160;      details-&gt;<a class="code" href="../../d8/dc2/structast__fax__session__details.html#aaa69733356239747f442b9543b38cfba">faxdetect_id</a> = -1;</div><div class="line"><a name="l03802"></a><span class="lineno"> 3802</span>&#160;      <span class="keywordflow">return</span> f;</div><div class="line"><a name="l03803"></a><span class="lineno"> 3803</span>&#160;   }</div><div class="line"><a name="l03804"></a><span class="lineno"> 3804</span>&#160;</div><div class="line"><a name="l03805"></a><span class="lineno"> 3805</span>&#160;   <span class="comment">/* only handle VOICE and CONTROL frames*/</span></div><div class="line"><a name="l03806"></a><span class="lineno"> 3806</span>&#160;   <span class="keywordflow">switch</span> (f-&gt;<a class="code" href="../../d0/d99/structast__frame.html#a6937b93c56cb473b547eda454dca7b4c">frametype</a>) {</div><div class="line"><a name="l03807"></a><span class="lineno"> 3807</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="../../d6/d66/include_2asterisk_2frame_8h.html#ae2e1a9c4e048da387b761f619312d6e0aa457fe7005f11bb7b21453f9bb4caa8f">AST_FRAME_VOICE</a>:</div><div class="line"><a name="l03808"></a><span class="lineno"> 3808</span>&#160;      <span class="comment">/* we have no DSP this means we not detecting CNG */</span></div><div class="line"><a name="l03809"></a><span class="lineno"> 3809</span>&#160;      <span class="keywordflow">if</span> (!faxdetect-&gt;<a class="code" href="../../da/df6/structfax__detect.html#ab9deccb020b39c3f7ac94b1af99cac5d">dsp</a>) {</div><div class="line"><a name="l03810"></a><span class="lineno"> 3810</span>&#160;         <span class="keywordflow">return</span> f;</div><div class="line"><a name="l03811"></a><span class="lineno"> 3811</span>&#160;      }</div><div class="line"><a name="l03812"></a><span class="lineno"> 3812</span>&#160;      <span class="comment">/* We can only process some formats*/</span></div><div class="line"><a name="l03813"></a><span class="lineno"> 3813</span>&#160;      <span class="keywordflow">if</span> ((<a class="code" href="../../d0/d0a/format_8h.html#a738c58eca291b71de4422e95bff27400">ast_format_cmp</a>(f-&gt;<a class="code" href="../../d0/d99/structast__frame.html#a27237c48fdcd22556401f20c693811db">subclass</a>.<a class="code" href="../../d1/d9f/structast__frame__subclass.html#ab425a484a0916077c5a30d9d7b229b44">format</a>, <a class="code" href="../../db/d1c/format__cache_8h.html#a771d7c34570e8e492c25a0c2eb41889d">ast_format_slin</a>) != <a class="code" href="../../d0/d0a/format_8h.html#a79bdf0b3c0616d9950d00cfeb62295c3ab1e8c1a0f8b4a1ecb6a2109992636859">AST_FORMAT_CMP_EQUAL</a>) &amp;&amp;</div><div class="line"><a name="l03814"></a><span class="lineno"> 3814</span>&#160;         (<a class="code" href="../../d0/d0a/format_8h.html#a738c58eca291b71de4422e95bff27400">ast_format_cmp</a>(f-&gt;<a class="code" href="../../d0/d99/structast__frame.html#a27237c48fdcd22556401f20c693811db">subclass</a>.<a class="code" href="../../d1/d9f/structast__frame__subclass.html#ab425a484a0916077c5a30d9d7b229b44">format</a>, <a class="code" href="../../db/d1c/format__cache_8h.html#a95c058fe6adef68780f026d6aec2481c">ast_format_alaw</a>) != <a class="code" href="../../d0/d0a/format_8h.html#a79bdf0b3c0616d9950d00cfeb62295c3ab1e8c1a0f8b4a1ecb6a2109992636859">AST_FORMAT_CMP_EQUAL</a>) &amp;&amp;</div><div class="line"><a name="l03815"></a><span class="lineno"> 3815</span>&#160;         (<a class="code" href="../../d0/d0a/format_8h.html#a738c58eca291b71de4422e95bff27400">ast_format_cmp</a>(f-&gt;<a class="code" href="../../d0/d99/structast__frame.html#a27237c48fdcd22556401f20c693811db">subclass</a>.<a class="code" href="../../d1/d9f/structast__frame__subclass.html#ab425a484a0916077c5a30d9d7b229b44">format</a>, <a class="code" href="../../db/d1c/format__cache_8h.html#a568c3f5838b53c38f11996dbe5ff5785">ast_format_ulaw</a>) != <a class="code" href="../../d0/d0a/format_8h.html#a79bdf0b3c0616d9950d00cfeb62295c3ab1e8c1a0f8b4a1ecb6a2109992636859">AST_FORMAT_CMP_EQUAL</a>)) {</div><div class="line"><a name="l03816"></a><span class="lineno"> 3816</span>&#160;         <span class="keywordflow">return</span> f;</div><div class="line"><a name="l03817"></a><span class="lineno"> 3817</span>&#160;      }</div><div class="line"><a name="l03818"></a><span class="lineno"> 3818</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l03819"></a><span class="lineno"> 3819</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="../../d6/d66/include_2asterisk_2frame_8h.html#ae2e1a9c4e048da387b761f619312d6e0ae1dae388b0d70825876e137ae95bb0c1">AST_FRAME_CONTROL</a>:</div><div class="line"><a name="l03820"></a><span class="lineno"> 3820</span>&#160;      <span class="keywordflow">if</span> ((f-&gt;<a class="code" href="../../d0/d99/structast__frame.html#a27237c48fdcd22556401f20c693811db">subclass</a>.<a class="code" href="../../d1/d9f/structast__frame__subclass.html#adece183191b0e700e039e59101e06105">integer</a> == <a class="code" href="../../d6/d66/include_2asterisk_2frame_8h.html#aedda41918e992000fe921f8f7363b390a7334c9d27a6d70fe7c85b60b864788fc">AST_CONTROL_T38_PARAMETERS</a>) &amp;&amp;</div><div class="line"><a name="l03821"></a><span class="lineno"> 3821</span>&#160;          (faxdetect-&gt;<a class="code" href="../../da/df6/structfax__detect.html#ac8bf36fe0577cba66bccda3a6f7e80a4">flags</a> &amp; <a class="code" href="../../d0/d60/res__fax_8c.html#a9612f65fe4e81e83a12136c6b9e89553">FAX_DETECT_MODE_T38</a>)) {</div><div class="line"><a name="l03822"></a><span class="lineno"> 3822</span>&#160;         <span class="keywordflow">break</span>;</div><div class="line"><a name="l03823"></a><span class="lineno"> 3823</span>&#160;      }</div><div class="line"><a name="l03824"></a><span class="lineno"> 3824</span>&#160;      <span class="keywordflow">return</span> f;</div><div class="line"><a name="l03825"></a><span class="lineno"> 3825</span>&#160;   <span class="keywordflow">default</span>:</div><div class="line"><a name="l03826"></a><span class="lineno"> 3826</span>&#160;      <span class="keywordflow">return</span> f;</div><div class="line"><a name="l03827"></a><span class="lineno"> 3827</span>&#160;   }</div><div class="line"><a name="l03828"></a><span class="lineno"> 3828</span>&#160;</div><div class="line"><a name="l03829"></a><span class="lineno"> 3829</span>&#160;   <span class="keywordflow">if</span> (f-&gt;<a class="code" href="../../d0/d99/structast__frame.html#a6937b93c56cb473b547eda454dca7b4c">frametype</a> == <a class="code" href="../../d6/d66/include_2asterisk_2frame_8h.html#ae2e1a9c4e048da387b761f619312d6e0aa457fe7005f11bb7b21453f9bb4caa8f">AST_FRAME_VOICE</a>) {</div><div class="line"><a name="l03830"></a><span class="lineno"> 3830</span>&#160;      f = <a class="code" href="../../d3/d08/dsp_8h.html#ab6387ee12a3544d3d2068db61d9576ad">ast_dsp_process</a>(chan, faxdetect-&gt;<a class="code" href="../../da/df6/structfax__detect.html#ab9deccb020b39c3f7ac94b1af99cac5d">dsp</a>, f);</div><div class="line"><a name="l03831"></a><span class="lineno"> 3831</span>&#160;      <span class="keywordflow">if</span> (f-&gt;<a class="code" href="../../d0/d99/structast__frame.html#a6937b93c56cb473b547eda454dca7b4c">frametype</a> == <a class="code" href="../../d6/d66/include_2asterisk_2frame_8h.html#a248afd6c02044259a386f6b7aee922a2">AST_FRAME_DTMF</a>) {</div><div class="line"><a name="l03832"></a><span class="lineno"> 3832</span>&#160;         result = f-&gt;<a class="code" href="../../d0/d99/structast__frame.html#a27237c48fdcd22556401f20c693811db">subclass</a>.<a class="code" href="../../d1/d9f/structast__frame__subclass.html#adece183191b0e700e039e59101e06105">integer</a>;</div><div class="line"><a name="l03833"></a><span class="lineno"> 3833</span>&#160;      }</div><div class="line"><a name="l03834"></a><span class="lineno"> 3834</span>&#160;   } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((f-&gt;<a class="code" href="../../d0/d99/structast__frame.html#a6937b93c56cb473b547eda454dca7b4c">frametype</a> == <a class="code" href="../../d6/d66/include_2asterisk_2frame_8h.html#ae2e1a9c4e048da387b761f619312d6e0ae1dae388b0d70825876e137ae95bb0c1">AST_FRAME_CONTROL</a>) &amp;&amp; (f-&gt;<a class="code" href="../../d0/d99/structast__frame.html#ad67e07841d1233e596e6f822a3c81f6b">datalen</a> == <span class="keyword">sizeof</span>(<span class="keyword">struct</span> <a class="code" href="../../d5/def/structast__control__t38__parameters.html">ast_control_t38_parameters</a>))) {</div><div class="line"><a name="l03835"></a><span class="lineno"> 3835</span>&#160;      control_params = f-&gt;<a class="code" href="../../d0/d99/structast__frame.html#a4027905f872af30d910929b07e261ca5">data</a>.<a class="code" href="../../d0/d99/structast__frame.html#add9af9569af79ec26dd741fb226b38ba">ptr</a>;</div><div class="line"><a name="l03836"></a><span class="lineno"> 3836</span>&#160;      <span class="keywordflow">switch</span> (control_params-&gt;<a class="code" href="../../d5/def/structast__control__t38__parameters.html#adb36822366e10ce64ca8337c512732a6">request_response</a>) {</div><div class="line"><a name="l03837"></a><span class="lineno"> 3837</span>&#160;      <span class="keywordflow">case</span> <a class="code" href="../../d6/d66/include_2asterisk_2frame_8h.html#a168d496bdac09ece3ce49cf473bbdb4bad501e0d5fe272eaba466507a686a2df5">AST_T38_NEGOTIATED</a>:</div><div class="line"><a name="l03838"></a><span class="lineno"> 3838</span>&#160;      <span class="keywordflow">case</span> <a class="code" href="../../d6/d66/include_2asterisk_2frame_8h.html#a168d496bdac09ece3ce49cf473bbdb4bafdb1ca68d683c64301c4cf07463a9975">AST_T38_REQUEST_NEGOTIATE</a>:</div><div class="line"><a name="l03839"></a><span class="lineno"> 3839</span>&#160;         result = <span class="charliteral">&#39;t&#39;</span>;</div><div class="line"><a name="l03840"></a><span class="lineno"> 3840</span>&#160;         <span class="keywordflow">break</span>;</div><div class="line"><a name="l03841"></a><span class="lineno"> 3841</span>&#160;      <span class="keywordflow">default</span>:</div><div class="line"><a name="l03842"></a><span class="lineno"> 3842</span>&#160;         <span class="keywordflow">break</span>;</div><div class="line"><a name="l03843"></a><span class="lineno"> 3843</span>&#160;      }</div><div class="line"><a name="l03844"></a><span class="lineno"> 3844</span>&#160;   }</div><div class="line"><a name="l03845"></a><span class="lineno"> 3845</span>&#160;</div><div class="line"><a name="l03846"></a><span class="lineno"> 3846</span>&#160;   <span class="keywordflow">if</span> (result) {</div><div class="line"><a name="l03847"></a><span class="lineno"> 3847</span>&#160;      <span class="keyword">const</span> <span class="keywordtype">char</span> *target_context;</div><div class="line"><a name="l03848"></a><span class="lineno"> 3848</span>&#160;</div><div class="line"><a name="l03849"></a><span class="lineno"> 3849</span>&#160;      <span class="keywordflow">switch</span> (result) {</div><div class="line"><a name="l03850"></a><span class="lineno"> 3850</span>&#160;      <span class="keywordflow">case</span> <span class="charliteral">&#39;f&#39;</span>:</div><div class="line"><a name="l03851"></a><span class="lineno"> 3851</span>&#160;      <span class="keywordflow">case</span> <span class="charliteral">&#39;t&#39;</span>:</div><div class="line"><a name="l03852"></a><span class="lineno"> 3852</span>&#160;         target_context = <a class="code" href="../../d6/d90/strings_8h.html#a2faaa16929951bfd2802b7829a100ba2">S_OR</a>(<a class="code" href="../../d5/d7b/channel_8h.html#adf593d68a333075c1fcae8a73b68c069">ast_channel_macrocontext</a>(chan), <a class="code" href="../../d5/d7b/channel_8h.html#a582dee4d5ea9b2ff6f309f0c5239f6bd">ast_channel_context</a>(chan));</div><div class="line"><a name="l03853"></a><span class="lineno"> 3853</span>&#160;</div><div class="line"><a name="l03854"></a><span class="lineno"> 3854</span>&#160;         <a class="code" href="../../d5/d7b/channel_8h.html#af476c537b29be3f29240489032f9db39">ast_channel_unlock</a>(chan);</div><div class="line"><a name="l03855"></a><span class="lineno"> 3855</span>&#160;         <a class="code" href="../../d6/d66/include_2asterisk_2frame_8h.html#a6440d070425a2efe8e0aa71e8d9e47b7">ast_frfree</a>(f);</div><div class="line"><a name="l03856"></a><span class="lineno"> 3856</span>&#160;         f = &amp;<a class="code" href="../../d6/d66/include_2asterisk_2frame_8h.html#af203379aca2fd704fe8d86a9445596b6">ast_null_frame</a>;</div><div class="line"><a name="l03857"></a><span class="lineno"> 3857</span>&#160;         <span class="keywordflow">if</span> (<a class="code" href="../../db/de0/pbx_8h.html#a64a5b8fdc919806135ad427aca9e71b7">ast_exists_extension</a>(chan, target_context, <span class="stringliteral">&quot;fax&quot;</span>, 1,</div><div class="line"><a name="l03858"></a><span class="lineno"> 3858</span>&#160;             <a class="code" href="../../d6/d90/strings_8h.html#a38a896048b2ca84076864505f0aa8f01">S_COR</a>(<a class="code" href="../../d5/d7b/channel_8h.html#ac2dc872b606534943c98304aed841b34">ast_channel_caller</a>(chan)-&gt;<span class="keywordtype">id</span>.<a class="code" href="../../d6/d49/structnumber.html">number</a>.valid, <a class="code" href="../../d5/d7b/channel_8h.html#ac2dc872b606534943c98304aed841b34">ast_channel_caller</a>(chan)-&gt;<span class="keywordtype">id</span>.<a class="code" href="../../d6/d49/structnumber.html">number</a>.str, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>))) {</div><div class="line"><a name="l03859"></a><span class="lineno"> 3859</span>&#160;            <a class="code" href="../../d1/d8c/logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a>(2, <span class="stringliteral">&quot;Redirecting &#39;%s&#39; to fax extension due to %s detection\n&quot;</span>,</div><div class="line"><a name="l03860"></a><span class="lineno"> 3860</span>&#160;               <a class="code" href="../../d5/d7b/channel_8h.html#a7ca2fda13b129a55c251b56729de285b">ast_channel_name</a>(chan), (result == <span class="charliteral">&#39;f&#39;</span>) ? <span class="stringliteral">&quot;CNG&quot;</span> : <span class="stringliteral">&quot;T38&quot;</span>);</div><div class="line"><a name="l03861"></a><span class="lineno"> 3861</span>&#160;            <a class="code" href="../../db/de0/pbx_8h.html#a6e5b90edb84d216267148dddcffe9b9a">pbx_builtin_setvar_helper</a>(chan, <span class="stringliteral">&quot;FAXEXTEN&quot;</span>, <a class="code" href="../../d5/d7b/channel_8h.html#aa8b52fbc8168e939bc5553502367d46a">ast_channel_exten</a>(chan));</div><div class="line"><a name="l03862"></a><span class="lineno"> 3862</span>&#160;            <span class="keywordflow">if</span> (<a class="code" href="../../db/de0/pbx_8h.html#ae0ba2eb966a9e3376de61d30513f7302">ast_async_goto</a>(chan, target_context, <span class="stringliteral">&quot;fax&quot;</span>, 1)) {</div><div class="line"><a name="l03863"></a><span class="lineno"> 3863</span>&#160;               <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#ad89ee324d180cdcd7defcc709ff9ca42">LOG_NOTICE</a>, <span class="stringliteral">&quot;Failed to async goto &#39;%s&#39; into fax of &#39;%s&#39;\n&quot;</span>, <a class="code" href="../../d5/d7b/channel_8h.html#a7ca2fda13b129a55c251b56729de285b">ast_channel_name</a>(chan), target_context);</div><div class="line"><a name="l03864"></a><span class="lineno"> 3864</span>&#160;            }</div><div class="line"><a name="l03865"></a><span class="lineno"> 3865</span>&#160;         } <span class="keywordflow">else</span> {</div><div class="line"><a name="l03866"></a><span class="lineno"> 3866</span>&#160;            <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#ad89ee324d180cdcd7defcc709ff9ca42">LOG_NOTICE</a>, <span class="stringliteral">&quot;FAX %s detected but no fax extension in context (%s)\n&quot;</span>,</div><div class="line"><a name="l03867"></a><span class="lineno"> 3867</span>&#160;               (result == <span class="charliteral">&#39;f&#39;</span>) ? <span class="stringliteral">&quot;CNG&quot;</span> : <span class="stringliteral">&quot;T38&quot;</span>, target_context);</div><div class="line"><a name="l03868"></a><span class="lineno"> 3868</span>&#160;         }</div><div class="line"><a name="l03869"></a><span class="lineno"> 3869</span>&#160;         <a class="code" href="../../d5/d7b/channel_8h.html#a493bdebe876caafb8ee535853310364a">ast_channel_lock</a>(chan);</div><div class="line"><a name="l03870"></a><span class="lineno"> 3870</span>&#160;</div><div class="line"><a name="l03871"></a><span class="lineno"> 3871</span>&#160;         <a class="code" href="../../db/d3c/framehook_8h.html#a6e116259cae8c1e5cca074d05f0a3475">ast_framehook_detach</a>(chan, details-&gt;<a class="code" href="../../d8/dc2/structast__fax__session__details.html#aaa69733356239747f442b9543b38cfba">faxdetect_id</a>);</div><div class="line"><a name="l03872"></a><span class="lineno"> 3872</span>&#160;         details-&gt;<a class="code" href="../../d8/dc2/structast__fax__session__details.html#aaa69733356239747f442b9543b38cfba">faxdetect_id</a> = -1;</div><div class="line"><a name="l03873"></a><span class="lineno"> 3873</span>&#160;         <span class="keywordflow">break</span>;</div><div class="line"><a name="l03874"></a><span class="lineno"> 3874</span>&#160;      <span class="keywordflow">default</span>:</div><div class="line"><a name="l03875"></a><span class="lineno"> 3875</span>&#160;         <span class="keywordflow">break</span>;</div><div class="line"><a name="l03876"></a><span class="lineno"> 3876</span>&#160;      }</div><div class="line"><a name="l03877"></a><span class="lineno"> 3877</span>&#160;   }</div><div class="line"><a name="l03878"></a><span class="lineno"> 3878</span>&#160;</div><div class="line"><a name="l03879"></a><span class="lineno"> 3879</span>&#160;   <span class="keywordflow">return</span> f;</div><div class="line"><a name="l03880"></a><span class="lineno"> 3880</span>&#160;}</div><div class="line"><a name="l03881"></a><span class="lineno"> 3881</span>&#160;<span class="comment"></span></div><div class="line"><a name="l03882"></a><span class="lineno"> 3882</span>&#160;<span class="comment">/*! \brief Attach a faxdetect framehook object to a channel.</span></div><div class="line"><a name="l03883"></a><span class="lineno"> 3883</span>&#160;<span class="comment"> * \param chan the channel to attach to</span></div><div class="line"><a name="l03884"></a><span class="lineno"> 3884</span>&#160;<span class="comment"> * \param timeout in ms to remove framehook in this time if not zero</span></div><div class="line"><a name="l03885"></a><span class="lineno"> 3885</span>&#160;<span class="comment"> * \return the faxdetect structure or NULL on error</span></div><div class="line"><a name="l03886"></a><span class="lineno"> 3886</span>&#160;<span class="comment"> * \param flags required options</span></div><div class="line"><a name="l03887"></a><span class="lineno"> 3887</span>&#160;<span class="comment"> * \retval -1 error</span></div><div class="line"><a name="l03888"></a><span class="lineno"> 3888</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l03889"></a><span class="lineno"><a class="line" href="../../d0/d60/res__fax_8c.html#a72074e43459dce843bd53cf52f186861"> 3889</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d0/d60/res__fax_8c.html#a72074e43459dce843bd53cf52f186861">fax_detect_attach</a>(<span class="keyword">struct</span> <a class="code" href="../../df/d3c/structast__channel.html">ast_channel</a> *chan, <span class="keywordtype">int</span> timeout, <span class="keywordtype">int</span> flags)</div><div class="line"><a name="l03890"></a><span class="lineno"> 3890</span>&#160;{</div><div class="line"><a name="l03891"></a><span class="lineno"> 3891</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../da/df6/structfax__detect.html">fax_detect</a> *faxdetect;</div><div class="line"><a name="l03892"></a><span class="lineno"> 3892</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d8/dc2/structast__fax__session__details.html">ast_fax_session_details</a> *details;</div><div class="line"><a name="l03893"></a><span class="lineno"> 3893</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d3/d7b/structast__framehook__interface.html">ast_framehook_interface</a> fr_hook = {</div><div class="line"><a name="l03894"></a><span class="lineno"> 3894</span>&#160;      .<a class="code" href="../../d3/d7b/structast__framehook__interface.html#ab6d7b6f8c2ceaba7acda80aaf05f4899">version</a> = <a class="code" href="../../db/d3c/framehook_8h.html#ae3b6fa28df6c8608d05936efaf929f32">AST_FRAMEHOOK_INTERFACE_VERSION</a>,</div><div class="line"><a name="l03895"></a><span class="lineno"> 3895</span>&#160;      .event_cb = <a class="code" href="../../d0/d60/res__fax_8c.html#ac527bcc9f23787a9eca1e170210f361e">fax_detect_framehook</a>,</div><div class="line"><a name="l03896"></a><span class="lineno"> 3896</span>&#160;      .destroy_cb = <a class="code" href="../../d0/d60/res__fax_8c.html#a53f13b154b4691e9b1b5e9c2323f399c">fax_detect_framehook_destroy</a>,</div><div class="line"><a name="l03897"></a><span class="lineno"> 3897</span>&#160;   };</div><div class="line"><a name="l03898"></a><span class="lineno"> 3898</span>&#160;</div><div class="line"><a name="l03899"></a><span class="lineno"> 3899</span>&#160;   <span class="keywordflow">if</span> (!(details = <a class="code" href="../../d0/d60/res__fax_8c.html#ac4310e981e9db76dfc3e85c51f4c6e1e">find_or_create_details</a>(chan))) {</div><div class="line"><a name="l03900"></a><span class="lineno"> 3900</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;System cannot provide memory for session requirements.\n&quot;</span>);</div><div class="line"><a name="l03901"></a><span class="lineno"> 3901</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l03902"></a><span class="lineno"> 3902</span>&#160;   }</div><div class="line"><a name="l03903"></a><span class="lineno"> 3903</span>&#160;</div><div class="line"><a name="l03904"></a><span class="lineno"> 3904</span>&#160;   <span class="comment">/* set up the frame hook*/</span></div><div class="line"><a name="l03905"></a><span class="lineno"> 3905</span>&#160;   faxdetect = <a class="code" href="../../d0/d60/res__fax_8c.html#a1599952156d1b1f2be32eb21bcdbf1d9">fax_detect_new</a>(chan, timeout, flags);</div><div class="line"><a name="l03906"></a><span class="lineno"> 3906</span>&#160;   <span class="keywordflow">if</span> (!faxdetect) {</div><div class="line"><a name="l03907"></a><span class="lineno"> 3907</span>&#160;      <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(details, -1);</div><div class="line"><a name="l03908"></a><span class="lineno"> 3908</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l03909"></a><span class="lineno"> 3909</span>&#160;   }</div><div class="line"><a name="l03910"></a><span class="lineno"> 3910</span>&#160;</div><div class="line"><a name="l03911"></a><span class="lineno"> 3911</span>&#160;   fr_hook.<a class="code" href="../../d3/d7b/structast__framehook__interface.html#a735984d41155bc1032e09bece8f8d66d">data</a> = faxdetect;</div><div class="line"><a name="l03912"></a><span class="lineno"> 3912</span>&#160;   faxdetect-&gt;<a class="code" href="../../da/df6/structfax__detect.html#ae7b633178d301df70e8612b4ce1aeb77">details</a> = details;</div><div class="line"><a name="l03913"></a><span class="lineno"> 3913</span>&#160;   <a class="code" href="../../d5/d7b/channel_8h.html#a493bdebe876caafb8ee535853310364a">ast_channel_lock</a>(chan);</div><div class="line"><a name="l03914"></a><span class="lineno"> 3914</span>&#160;   details-&gt;<a class="code" href="../../d8/dc2/structast__fax__session__details.html#aaa69733356239747f442b9543b38cfba">faxdetect_id</a> = <a class="code" href="../../db/d3c/framehook_8h.html#a3ca711dc98d26e881936c855f0ae3d77">ast_framehook_attach</a>(chan, &amp;fr_hook);</div><div class="line"><a name="l03915"></a><span class="lineno"> 3915</span>&#160;   details-&gt;<a class="code" href="../../d8/dc2/structast__fax__session__details.html#ab3f309860ee36512bc8bba783df26b1c">faxdetect_timeout</a> = <a class="code" href="../../d0/d29/cdr__mysql_8c.html#a493b57f443cc38b3d3df9c1e584d9d82">timeout</a>;</div><div class="line"><a name="l03916"></a><span class="lineno"> 3916</span>&#160;   details-&gt;<a class="code" href="../../d8/dc2/structast__fax__session__details.html#a6147f275a3ab3a425ab9da2b9d754241">faxdetect_flags</a> = flags;</div><div class="line"><a name="l03917"></a><span class="lineno"> 3917</span>&#160;   <a class="code" href="../../d5/d7b/channel_8h.html#af476c537b29be3f29240489032f9db39">ast_channel_unlock</a>(chan);</div><div class="line"><a name="l03918"></a><span class="lineno"> 3918</span>&#160;</div><div class="line"><a name="l03919"></a><span class="lineno"> 3919</span>&#160;   <span class="keywordflow">if</span> (details-&gt;<a class="code" href="../../d8/dc2/structast__fax__session__details.html#aaa69733356239747f442b9543b38cfba">faxdetect_id</a> &lt; 0) {</div><div class="line"><a name="l03920"></a><span class="lineno"> 3920</span>&#160;      <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(faxdetect, -1);</div><div class="line"><a name="l03921"></a><span class="lineno"> 3921</span>&#160;   }</div><div class="line"><a name="l03922"></a><span class="lineno"> 3922</span>&#160;</div><div class="line"><a name="l03923"></a><span class="lineno"> 3923</span>&#160;   <span class="keywordflow">return</span> details-&gt;<a class="code" href="../../d8/dc2/structast__fax__session__details.html#aaa69733356239747f442b9543b38cfba">faxdetect_id</a>;</div><div class="line"><a name="l03924"></a><span class="lineno"> 3924</span>&#160;}</div><div class="line"><a name="l03925"></a><span class="lineno"> 3925</span>&#160;<span class="comment"></span></div><div class="line"><a name="l03926"></a><span class="lineno"> 3926</span>&#160;<span class="comment">/*! \brief hash callback for ao2 */</span></div><div class="line"><a name="l03927"></a><span class="lineno"><a class="line" href="../../d0/d60/res__fax_8c.html#a107e52e1d9d616990103fa9f54536f74"> 3927</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d0/d60/res__fax_8c.html#a107e52e1d9d616990103fa9f54536f74">session_hash_cb</a>(<span class="keyword">const</span> <span class="keywordtype">void</span> *obj, <span class="keyword">const</span> <span class="keywordtype">int</span> flags)</div><div class="line"><a name="l03928"></a><span class="lineno"> 3928</span>&#160;{</div><div class="line"><a name="l03929"></a><span class="lineno"> 3929</span>&#160;   <span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="../../d1/d16/structast__fax__session.html">ast_fax_session</a> *s = obj;</div><div class="line"><a name="l03930"></a><span class="lineno"> 3930</span>&#160;</div><div class="line"><a name="l03931"></a><span class="lineno"> 3931</span>&#160;   <span class="keywordflow">return</span> s-&gt;<a class="code" href="../../d1/d16/structast__fax__session.html#ab7ce6f462afaf105224b0ca772a33c43">id</a>;</div><div class="line"><a name="l03932"></a><span class="lineno"> 3932</span>&#160;}</div><div class="line"><a name="l03933"></a><span class="lineno"> 3933</span>&#160;<span class="comment"></span></div><div class="line"><a name="l03934"></a><span class="lineno"> 3934</span>&#160;<span class="comment">/*! \brief compare callback for ao2 */</span></div><div class="line"><a name="l03935"></a><span class="lineno"><a class="line" href="../../d0/d60/res__fax_8c.html#a0696c5e15e0596da88b514beffeb6248"> 3935</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d0/d60/res__fax_8c.html#a0696c5e15e0596da88b514beffeb6248">session_cmp_cb</a>(<span class="keywordtype">void</span> *obj, <span class="keywordtype">void</span> *arg, <span class="keywordtype">int</span> flags)</div><div class="line"><a name="l03936"></a><span class="lineno"> 3936</span>&#160;{</div><div class="line"><a name="l03937"></a><span class="lineno"> 3937</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d1/d16/structast__fax__session.html">ast_fax_session</a> *lhs = obj, *rhs = arg;</div><div class="line"><a name="l03938"></a><span class="lineno"> 3938</span>&#160;</div><div class="line"><a name="l03939"></a><span class="lineno"> 3939</span>&#160;   <span class="keywordflow">return</span> (lhs-&gt;<a class="code" href="../../d1/d16/structast__fax__session.html#ab7ce6f462afaf105224b0ca772a33c43">id</a> == rhs-&gt;id) ? <a class="code" href="../../d5/da5/astobj2_8h.html#a1f8b41308be4c47de8ff89a3b9c7e7d1a1959468a3c5d6aecd2fa1272d8e30fbf">CMP_MATCH</a> | <a class="code" href="../../d5/da5/astobj2_8h.html#a1f8b41308be4c47de8ff89a3b9c7e7d1a75382dc9117cc118719edf6c3d2b71df">CMP_STOP</a> : 0;</div><div class="line"><a name="l03940"></a><span class="lineno"> 3940</span>&#160;}</div><div class="line"><a name="l03941"></a><span class="lineno"> 3941</span>&#160;<span class="comment"></span></div><div class="line"><a name="l03942"></a><span class="lineno"> 3942</span>&#160;<span class="comment">/*! \brief fax session tab completion */</span></div><div class="line"><a name="l03943"></a><span class="lineno"><a class="line" href="../../d0/d60/res__fax_8c.html#a6804dd46bef333503315e1e71db009cf"> 3943</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">char</span> *<a class="code" href="../../d0/d60/res__fax_8c.html#a6804dd46bef333503315e1e71db009cf">fax_session_tab_complete</a>(<span class="keyword">struct</span> <a class="code" href="../../d3/dad/structast__cli__args.html">ast_cli_args</a> *<a class="code" href="../../d7/d6f/test__linkedlists_8c.html#a13dd15487fee89a002d17ef3aff62d02">a</a>)</div><div class="line"><a name="l03944"></a><span class="lineno"> 3944</span>&#160;{</div><div class="line"><a name="l03945"></a><span class="lineno"> 3945</span>&#160;   <span class="keywordtype">int</span> tklen;</div><div class="line"><a name="l03946"></a><span class="lineno"> 3946</span>&#160;   <span class="keywordtype">int</span> wordnum = 0;</div><div class="line"><a name="l03947"></a><span class="lineno"> 3947</span>&#160;   <span class="keywordtype">char</span> *<a class="code" href="../../d0/d29/cdr__mysql_8c.html#a0980a105ccb863d8008eb6201a51da52">name</a> = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l03948"></a><span class="lineno"> 3948</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d9/d97/structao2__iterator.html">ao2_iterator</a> i;</div><div class="line"><a name="l03949"></a><span class="lineno"> 3949</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d1/d16/structast__fax__session.html">ast_fax_session</a> *s;</div><div class="line"><a name="l03950"></a><span class="lineno"> 3950</span>&#160;   <span class="keywordtype">char</span> tbuf[5];</div><div class="line"><a name="l03951"></a><span class="lineno"> 3951</span>&#160;</div><div class="line"><a name="l03952"></a><span class="lineno"> 3952</span>&#160;   <span class="keywordflow">if</span> (a-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#a4b911d12699acbbb5a8b62355b35bae8">pos</a> != 3) {</div><div class="line"><a name="l03953"></a><span class="lineno"> 3953</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l03954"></a><span class="lineno"> 3954</span>&#160;   }</div><div class="line"><a name="l03955"></a><span class="lineno"> 3955</span>&#160;</div><div class="line"><a name="l03956"></a><span class="lineno"> 3956</span>&#160;   tklen = strlen(a-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#adc1f34651f7bbfa3ba5af27db5f53817">word</a>);</div><div class="line"><a name="l03957"></a><span class="lineno"> 3957</span>&#160;   i = <a class="code" href="../../d5/da5/astobj2_8h.html#a91d5d37d00874ae7a92d1a15c0a3b3a6">ao2_iterator_init</a>(<a class="code" href="../../d0/d60/res__fax_8c.html#a058b6772fcfe1ce5a1a0957e2f11d367">faxregistry</a>.container, 0);</div><div class="line"><a name="l03958"></a><span class="lineno"> 3958</span>&#160;   <span class="keywordflow">while</span> ((s = <a class="code" href="../../d5/da5/astobj2_8h.html#a17990ea630db7dbd1252ef0132133a2b">ao2_iterator_next</a>(&amp;i))) {</div><div class="line"><a name="l03959"></a><span class="lineno"> 3959</span>&#160;      snprintf(tbuf, <span class="keyword">sizeof</span>(tbuf), <span class="stringliteral">&quot;%u&quot;</span>, s-&gt;<a class="code" href="../../d1/d16/structast__fax__session.html#ab7ce6f462afaf105224b0ca772a33c43">id</a>);</div><div class="line"><a name="l03960"></a><span class="lineno"> 3960</span>&#160;      <span class="keywordflow">if</span> (!strncasecmp(a-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#adc1f34651f7bbfa3ba5af27db5f53817">word</a>, tbuf, tklen) &amp;&amp; ++wordnum &gt; a-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#acfc02ec89670db29251fda6a66602ce2">n</a>) {</div><div class="line"><a name="l03961"></a><span class="lineno"> 3961</span>&#160;         name = <a class="code" href="../../d8/d8a/astmm_8h.html#ab263849d03fb892847be4986db759737">ast_strdup</a>(tbuf);</div><div class="line"><a name="l03962"></a><span class="lineno"> 3962</span>&#160;         <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(s, -1);</div><div class="line"><a name="l03963"></a><span class="lineno"> 3963</span>&#160;         <span class="keywordflow">break</span>;</div><div class="line"><a name="l03964"></a><span class="lineno"> 3964</span>&#160;      }</div><div class="line"><a name="l03965"></a><span class="lineno"> 3965</span>&#160;      <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(s, -1);</div><div class="line"><a name="l03966"></a><span class="lineno"> 3966</span>&#160;   }</div><div class="line"><a name="l03967"></a><span class="lineno"> 3967</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#ad36841ab6daa3997f7ca7047ad2d033a">ao2_iterator_destroy</a>(&amp;i);</div><div class="line"><a name="l03968"></a><span class="lineno"> 3968</span>&#160;   <span class="keywordflow">return</span> <a class="code" href="../../d0/d29/cdr__mysql_8c.html#a0980a105ccb863d8008eb6201a51da52">name</a>;</div><div class="line"><a name="l03969"></a><span class="lineno"> 3969</span>&#160;}</div><div class="line"><a name="l03970"></a><span class="lineno"> 3970</span>&#160;</div><div class="line"><a name="l03971"></a><span class="lineno"><a class="line" href="../../d0/d60/res__fax_8c.html#a1d2f98b9f7e7f3a8217c9afa7f1915a2"> 3971</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">char</span> *<a class="code" href="../../d0/d60/res__fax_8c.html#a1d2f98b9f7e7f3a8217c9afa7f1915a2">cli_fax_show_version</a>(<span class="keyword">struct</span> <a class="code" href="../../d8/d07/structast__cli__entry.html">ast_cli_entry</a> *e, <span class="keywordtype">int</span> cmd, <span class="keyword">struct</span> <a class="code" href="../../d3/dad/structast__cli__args.html">ast_cli_args</a> *<a class="code" href="../../d7/d6f/test__linkedlists_8c.html#a13dd15487fee89a002d17ef3aff62d02">a</a>)</div><div class="line"><a name="l03972"></a><span class="lineno"> 3972</span>&#160;{</div><div class="line"><a name="l03973"></a><span class="lineno"> 3973</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d9/d07/structfax__module.html">fax_module</a> *fax;</div><div class="line"><a name="l03974"></a><span class="lineno"> 3974</span>&#160;</div><div class="line"><a name="l03975"></a><span class="lineno"> 3975</span>&#160;   <span class="keywordflow">switch</span>(cmd) {</div><div class="line"><a name="l03976"></a><span class="lineno"> 3976</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="../../dc/db0/cli_8h.html#ab33e5350a923c3a8cedbeb496cd88ec9a71745eb63dd093f560a1add3e430d2a9">CLI_INIT</a>:</div><div class="line"><a name="l03977"></a><span class="lineno"> 3977</span>&#160;      e-&gt;<a class="code" href="../../d8/d07/structast__cli__entry.html#ade9cba72805fe52685a1deea307a8e82">command</a> = <span class="stringliteral">&quot;fax show version&quot;</span>;</div><div class="line"><a name="l03978"></a><span class="lineno"> 3978</span>&#160;      e-&gt;<a class="code" href="../../d8/d07/structast__cli__entry.html#aef1bd6ad890a110b466cb0e8088507a2">usage</a> =</div><div class="line"><a name="l03979"></a><span class="lineno"> 3979</span>&#160;         <span class="stringliteral">&quot;Usage: fax show version\n&quot;</span></div><div class="line"><a name="l03980"></a><span class="lineno"> 3980</span>&#160;         <span class="stringliteral">&quot;       Show versions of FAX For Asterisk components.\n&quot;</span>;</div><div class="line"><a name="l03981"></a><span class="lineno"> 3981</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l03982"></a><span class="lineno"> 3982</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="../../dc/db0/cli_8h.html#ab33e5350a923c3a8cedbeb496cd88ec9a76bf33139279b03ec1691f2be2d1be40">CLI_GENERATE</a>:</div><div class="line"><a name="l03983"></a><span class="lineno"> 3983</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l03984"></a><span class="lineno"> 3984</span>&#160;   }</div><div class="line"><a name="l03985"></a><span class="lineno"> 3985</span>&#160;</div><div class="line"><a name="l03986"></a><span class="lineno"> 3986</span>&#160;   <span class="keywordflow">if</span> (a-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#a98e1d8441ca58834f11f7367be4b3345">argc</a> != 3) {</div><div class="line"><a name="l03987"></a><span class="lineno"> 3987</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/db0/cli_8h.html#a0873456096960dab21fff0ce68c95acb">CLI_SHOWUSAGE</a>;</div><div class="line"><a name="l03988"></a><span class="lineno"> 3988</span>&#160;   }</div><div class="line"><a name="l03989"></a><span class="lineno"> 3989</span>&#160;</div><div class="line"><a name="l03990"></a><span class="lineno"> 3990</span>&#160;   <a class="code" href="../../dc/db0/cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#acf64f219885421479997667d2ed3f08a">fd</a>, <span class="stringliteral">&quot;FAX For Asterisk Components:\n&quot;</span>);</div><div class="line"><a name="l03991"></a><span class="lineno"> 3991</span>&#160;   <a class="code" href="../../dc/db0/cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#acf64f219885421479997667d2ed3f08a">fd</a>, <span class="stringliteral">&quot;\tApplications: %s\n&quot;</span>, <a class="code" href="../../d5/db9/ast__version_8h.html#a7765c608aea948584928643ab3963b2a">ast_get_version</a>());</div><div class="line"><a name="l03992"></a><span class="lineno"> 3992</span>&#160;   <a class="code" href="../../df/d90/linkedlists_8h.html#a0a0fe104cc2cc36a43784f886f3ae7dc">AST_RWLIST_RDLOCK</a>(&amp;<a class="code" href="../../df/d07/structfaxmodules.html">faxmodules</a>);</div><div class="line"><a name="l03993"></a><span class="lineno"> 3993</span>&#160;   <a class="code" href="../../df/d90/linkedlists_8h.html#a944b82566722f2247aa35f1328402c98">AST_RWLIST_TRAVERSE</a>(&amp;<a class="code" href="../../df/d07/structfaxmodules.html">faxmodules</a>, fax, list) {</div><div class="line"><a name="l03994"></a><span class="lineno"> 3994</span>&#160;      <a class="code" href="../../dc/db0/cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#acf64f219885421479997667d2ed3f08a">fd</a>, <span class="stringliteral">&quot;\t%s: %s\n&quot;</span>, fax-&gt;<a class="code" href="../../d9/d07/structfax__module.html#a4ac6ff3775e67c710cd55bc7dfd592fe">tech</a>-&gt;<a class="code" href="../../d9/d0e/structast__fax__tech.html#ac57ec035c076b222b9420a68ddab3bf1">description</a>, fax-&gt;<a class="code" href="../../d9/d07/structfax__module.html#a4ac6ff3775e67c710cd55bc7dfd592fe">tech</a>-&gt;<a class="code" href="../../d9/d0e/structast__fax__tech.html#ab3293b469db5b9353aa3bc1d278ba080">version</a>);</div><div class="line"><a name="l03995"></a><span class="lineno"> 3995</span>&#160;   }</div><div class="line"><a name="l03996"></a><span class="lineno"> 3996</span>&#160;   <a class="code" href="../../df/d90/linkedlists_8h.html#a2e9a2518b5029b96671aff6701bd5138">AST_RWLIST_UNLOCK</a>(&amp;<a class="code" href="../../df/d07/structfaxmodules.html">faxmodules</a>);</div><div class="line"><a name="l03997"></a><span class="lineno"> 3997</span>&#160;   <a class="code" href="../../dc/db0/cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#acf64f219885421479997667d2ed3f08a">fd</a>, <span class="stringliteral">&quot;\n&quot;</span>);</div><div class="line"><a name="l03998"></a><span class="lineno"> 3998</span>&#160;</div><div class="line"><a name="l03999"></a><span class="lineno"> 3999</span>&#160;   <span class="keywordflow">return</span> <a class="code" href="../../dc/db0/cli_8h.html#a50989f00b32eeb2516a3803cb2ffb766">CLI_SUCCESS</a>;</div><div class="line"><a name="l04000"></a><span class="lineno"> 4000</span>&#160;}</div><div class="line"><a name="l04001"></a><span class="lineno"> 4001</span>&#160;<span class="comment"></span></div><div class="line"><a name="l04002"></a><span class="lineno"> 4002</span>&#160;<span class="comment">/*! \brief enable FAX debugging */</span></div><div class="line"><a name="l04003"></a><span class="lineno"><a class="line" href="../../d0/d60/res__fax_8c.html#a38ce372560eb0b88386f1249c0e1e576"> 4003</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">char</span> *<a class="code" href="../../d0/d60/res__fax_8c.html#a38ce372560eb0b88386f1249c0e1e576">cli_fax_set_debug</a>(<span class="keyword">struct</span> <a class="code" href="../../d8/d07/structast__cli__entry.html">ast_cli_entry</a> *e, <span class="keywordtype">int</span> cmd, <span class="keyword">struct</span> <a class="code" href="../../d3/dad/structast__cli__args.html">ast_cli_args</a> *<a class="code" href="../../d7/d6f/test__linkedlists_8c.html#a13dd15487fee89a002d17ef3aff62d02">a</a>)</div><div class="line"><a name="l04004"></a><span class="lineno"> 4004</span>&#160;{</div><div class="line"><a name="l04005"></a><span class="lineno"> 4005</span>&#160;   <span class="keywordtype">int</span> <a class="code" href="../../dc/dc2/f2c_8h.html#abf5d144da384425ae6cb542ce6eec8d3">flag</a>;</div><div class="line"><a name="l04006"></a><span class="lineno"> 4006</span>&#160;   <span class="keyword">const</span> <span class="keywordtype">char</span> *what;</div><div class="line"><a name="l04007"></a><span class="lineno"> 4007</span>&#160;</div><div class="line"><a name="l04008"></a><span class="lineno"> 4008</span>&#160;   <span class="keywordflow">switch</span> (cmd) {</div><div class="line"><a name="l04009"></a><span class="lineno"> 4009</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="../../dc/db0/cli_8h.html#ab33e5350a923c3a8cedbeb496cd88ec9a71745eb63dd093f560a1add3e430d2a9">CLI_INIT</a>:</div><div class="line"><a name="l04010"></a><span class="lineno"> 4010</span>&#160;      e-&gt;<a class="code" href="../../d8/d07/structast__cli__entry.html#ade9cba72805fe52685a1deea307a8e82">command</a> = <span class="stringliteral">&quot;fax set debug {on|off}&quot;</span>;</div><div class="line"><a name="l04011"></a><span class="lineno"> 4011</span>&#160;      e-&gt;<a class="code" href="../../d8/d07/structast__cli__entry.html#aef1bd6ad890a110b466cb0e8088507a2">usage</a> =</div><div class="line"><a name="l04012"></a><span class="lineno"> 4012</span>&#160;         <span class="stringliteral">&quot;Usage: fax set debug { on | off }\n&quot;</span></div><div class="line"><a name="l04013"></a><span class="lineno"> 4013</span>&#160;         <span class="stringliteral">&quot;       Enable/Disable FAX debugging on new FAX sessions.  The basic FAX debugging will result in\n&quot;</span></div><div class="line"><a name="l04014"></a><span class="lineno"> 4014</span>&#160;         <span class="stringliteral">&quot;       additional events sent to manager sessions with &#39;call&#39; class permissions.  When\n&quot;</span></div><div class="line"><a name="l04015"></a><span class="lineno"> 4015</span>&#160;         <span class="stringliteral">&quot;       verbosity is greater than &#39;5&#39; events will be displayed to the console and audio versus\n&quot;</span></div><div class="line"><a name="l04016"></a><span class="lineno"> 4016</span>&#160;         <span class="stringliteral">&quot;       energy analysis will be performed and displayed to the console.\n&quot;</span>;</div><div class="line"><a name="l04017"></a><span class="lineno"> 4017</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l04018"></a><span class="lineno"> 4018</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="../../dc/db0/cli_8h.html#ab33e5350a923c3a8cedbeb496cd88ec9a76bf33139279b03ec1691f2be2d1be40">CLI_GENERATE</a>:</div><div class="line"><a name="l04019"></a><span class="lineno"> 4019</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l04020"></a><span class="lineno"> 4020</span>&#160;   }</div><div class="line"><a name="l04021"></a><span class="lineno"> 4021</span>&#160;</div><div class="line"><a name="l04022"></a><span class="lineno"> 4022</span>&#160;   what = a-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#ad0a19c4d63698f9e9cfd5653e8851452">argv</a>[e-&gt;<a class="code" href="../../d8/d07/structast__cli__entry.html#a1bd7a8575ca2650132d636d65dcda2f6">args</a>-1];      <span class="comment">/* guaranteed to exist */</span></div><div class="line"><a name="l04023"></a><span class="lineno"> 4023</span>&#160;   <span class="keywordflow">if</span> (!strcasecmp(what, <span class="stringliteral">&quot;on&quot;</span>)) {</div><div class="line"><a name="l04024"></a><span class="lineno"> 4024</span>&#160;      flag = 1;</div><div class="line"><a name="l04025"></a><span class="lineno"> 4025</span>&#160;   } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(what, <span class="stringliteral">&quot;off&quot;</span>)) {</div><div class="line"><a name="l04026"></a><span class="lineno"> 4026</span>&#160;      flag = 0;</div><div class="line"><a name="l04027"></a><span class="lineno"> 4027</span>&#160;   } <span class="keywordflow">else</span> {</div><div class="line"><a name="l04028"></a><span class="lineno"> 4028</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/db0/cli_8h.html#a0873456096960dab21fff0ce68c95acb">CLI_SHOWUSAGE</a>;</div><div class="line"><a name="l04029"></a><span class="lineno"> 4029</span>&#160;   }</div><div class="line"><a name="l04030"></a><span class="lineno"> 4030</span>&#160;</div><div class="line"><a name="l04031"></a><span class="lineno"> 4031</span>&#160;   <a class="code" href="../../d0/d60/res__fax_8c.html#afb6be9ca0b6c0d09211b5c4e55fa2291">global_fax_debug</a> = <a class="code" href="../../dc/dc2/f2c_8h.html#abf5d144da384425ae6cb542ce6eec8d3">flag</a>;</div><div class="line"><a name="l04032"></a><span class="lineno"> 4032</span>&#160;   <a class="code" href="../../dc/db0/cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#acf64f219885421479997667d2ed3f08a">fd</a>, <span class="stringliteral">&quot;\n\nFAX Debug %s\n\n&quot;</span>, (flag) ? <span class="stringliteral">&quot;Enabled&quot;</span> : <span class="stringliteral">&quot;Disabled&quot;</span>);</div><div class="line"><a name="l04033"></a><span class="lineno"> 4033</span>&#160;</div><div class="line"><a name="l04034"></a><span class="lineno"> 4034</span>&#160;   <span class="keywordflow">return</span> <a class="code" href="../../dc/db0/cli_8h.html#a50989f00b32eeb2516a3803cb2ffb766">CLI_SUCCESS</a>;</div><div class="line"><a name="l04035"></a><span class="lineno"> 4035</span>&#160;}</div><div class="line"><a name="l04036"></a><span class="lineno"> 4036</span>&#160;<span class="comment"></span></div><div class="line"><a name="l04037"></a><span class="lineno"> 4037</span>&#160;<span class="comment">/*! \brief display registered FAX capabilities */</span></div><div class="line"><a name="l04038"></a><span class="lineno"><a class="line" href="../../d0/d60/res__fax_8c.html#aa3abd8d044003f1086e5b07a357f82fb"> 4038</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">char</span> *<a class="code" href="../../d0/d60/res__fax_8c.html#aa3abd8d044003f1086e5b07a357f82fb">cli_fax_show_capabilities</a>(<span class="keyword">struct</span> <a class="code" href="../../d8/d07/structast__cli__entry.html">ast_cli_entry</a> *e, <span class="keywordtype">int</span> cmd, <span class="keyword">struct</span> <a class="code" href="../../d3/dad/structast__cli__args.html">ast_cli_args</a> *<a class="code" href="../../d7/d6f/test__linkedlists_8c.html#a13dd15487fee89a002d17ef3aff62d02">a</a>)</div><div class="line"><a name="l04039"></a><span class="lineno"> 4039</span>&#160;{</div><div class="line"><a name="l04040"></a><span class="lineno"> 4040</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d9/d07/structfax__module.html">fax_module</a> *fax;</div><div class="line"><a name="l04041"></a><span class="lineno"> 4041</span>&#160;   <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> num_modules = 0;</div><div class="line"><a name="l04042"></a><span class="lineno"> 4042</span>&#160;</div><div class="line"><a name="l04043"></a><span class="lineno"> 4043</span>&#160;   <span class="keywordflow">switch</span> (cmd) {</div><div class="line"><a name="l04044"></a><span class="lineno"> 4044</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="../../dc/db0/cli_8h.html#ab33e5350a923c3a8cedbeb496cd88ec9a71745eb63dd093f560a1add3e430d2a9">CLI_INIT</a>:</div><div class="line"><a name="l04045"></a><span class="lineno"> 4045</span>&#160;      e-&gt;<a class="code" href="../../d8/d07/structast__cli__entry.html#ade9cba72805fe52685a1deea307a8e82">command</a> = <span class="stringliteral">&quot;fax show capabilities&quot;</span>;</div><div class="line"><a name="l04046"></a><span class="lineno"> 4046</span>&#160;      e-&gt;<a class="code" href="../../d8/d07/structast__cli__entry.html#aef1bd6ad890a110b466cb0e8088507a2">usage</a> =</div><div class="line"><a name="l04047"></a><span class="lineno"> 4047</span>&#160;         <span class="stringliteral">&quot;Usage: fax show capabilities\n&quot;</span></div><div class="line"><a name="l04048"></a><span class="lineno"> 4048</span>&#160;         <span class="stringliteral">&quot;       Shows the capabilities of the registered FAX technology modules\n&quot;</span>;</div><div class="line"><a name="l04049"></a><span class="lineno"> 4049</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l04050"></a><span class="lineno"> 4050</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="../../dc/db0/cli_8h.html#ab33e5350a923c3a8cedbeb496cd88ec9a76bf33139279b03ec1691f2be2d1be40">CLI_GENERATE</a>:</div><div class="line"><a name="l04051"></a><span class="lineno"> 4051</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l04052"></a><span class="lineno"> 4052</span>&#160;   }</div><div class="line"><a name="l04053"></a><span class="lineno"> 4053</span>&#160;</div><div class="line"><a name="l04054"></a><span class="lineno"> 4054</span>&#160;   <a class="code" href="../../dc/db0/cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#acf64f219885421479997667d2ed3f08a">fd</a>, <span class="stringliteral">&quot;\n\nRegistered FAX Technology Modules:\n\n&quot;</span>);</div><div class="line"><a name="l04055"></a><span class="lineno"> 4055</span>&#160;   <a class="code" href="../../df/d90/linkedlists_8h.html#a0a0fe104cc2cc36a43784f886f3ae7dc">AST_RWLIST_RDLOCK</a>(&amp;<a class="code" href="../../df/d07/structfaxmodules.html">faxmodules</a>);</div><div class="line"><a name="l04056"></a><span class="lineno"> 4056</span>&#160;   <a class="code" href="../../df/d90/linkedlists_8h.html#a944b82566722f2247aa35f1328402c98">AST_RWLIST_TRAVERSE</a>(&amp;<a class="code" href="../../df/d07/structfaxmodules.html">faxmodules</a>, fax, list) {</div><div class="line"><a name="l04057"></a><span class="lineno"> 4057</span>&#160;      <a class="code" href="../../dc/db0/cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#acf64f219885421479997667d2ed3f08a">fd</a>, <span class="stringliteral">&quot;%-15s : %s\n%-15s : %s\n%-15s : &quot;</span>, <span class="stringliteral">&quot;Type&quot;</span>, fax-&gt;<a class="code" href="../../d9/d07/structfax__module.html#a4ac6ff3775e67c710cd55bc7dfd592fe">tech</a>-&gt;<a class="code" href="../../d9/d0e/structast__fax__tech.html#a8ff938fb2f815be425fd2859a21e6d61">type</a>, <span class="stringliteral">&quot;Description&quot;</span>, fax-&gt;<a class="code" href="../../d9/d07/structfax__module.html#a4ac6ff3775e67c710cd55bc7dfd592fe">tech</a>-&gt;<a class="code" href="../../d9/d0e/structast__fax__tech.html#ac57ec035c076b222b9420a68ddab3bf1">description</a>, <span class="stringliteral">&quot;Capabilities&quot;</span>);</div><div class="line"><a name="l04058"></a><span class="lineno"> 4058</span>&#160;      fax-&gt;<a class="code" href="../../d9/d07/structfax__module.html#a4ac6ff3775e67c710cd55bc7dfd592fe">tech</a>-&gt;<a class="code" href="../../d9/d0e/structast__fax__tech.html#a654cf082cf4abd8495abb41ab70a77df">cli_show_capabilities</a>(a-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#acf64f219885421479997667d2ed3f08a">fd</a>);</div><div class="line"><a name="l04059"></a><span class="lineno"> 4059</span>&#160;      num_modules++;</div><div class="line"><a name="l04060"></a><span class="lineno"> 4060</span>&#160;   }</div><div class="line"><a name="l04061"></a><span class="lineno"> 4061</span>&#160;   <a class="code" href="../../df/d90/linkedlists_8h.html#a2e9a2518b5029b96671aff6701bd5138">AST_RWLIST_UNLOCK</a>(&amp;<a class="code" href="../../df/d07/structfaxmodules.html">faxmodules</a>);</div><div class="line"><a name="l04062"></a><span class="lineno"> 4062</span>&#160;   <a class="code" href="../../dc/db0/cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#acf64f219885421479997667d2ed3f08a">fd</a>, <span class="stringliteral">&quot;%u registered modules\n\n&quot;</span>, num_modules);</div><div class="line"><a name="l04063"></a><span class="lineno"> 4063</span>&#160;</div><div class="line"><a name="l04064"></a><span class="lineno"> 4064</span>&#160;   <span class="keywordflow">return</span> <a class="code" href="../../dc/db0/cli_8h.html#a50989f00b32eeb2516a3803cb2ffb766">CLI_SUCCESS</a>;</div><div class="line"><a name="l04065"></a><span class="lineno"> 4065</span>&#160;}</div><div class="line"><a name="l04066"></a><span class="lineno"> 4066</span>&#160;<span class="comment"></span></div><div class="line"><a name="l04067"></a><span class="lineno"> 4067</span>&#160;<span class="comment">/*! \brief display global defaults and settings */</span></div><div class="line"><a name="l04068"></a><span class="lineno"><a class="line" href="../../d0/d60/res__fax_8c.html#a3c172ffb404f992210517ac86cfc7a1a"> 4068</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">char</span> *<a class="code" href="../../d0/d60/res__fax_8c.html#a3c172ffb404f992210517ac86cfc7a1a">cli_fax_show_settings</a>(<span class="keyword">struct</span> <a class="code" href="../../d8/d07/structast__cli__entry.html">ast_cli_entry</a> *e, <span class="keywordtype">int</span> cmd, <span class="keyword">struct</span> <a class="code" href="../../d3/dad/structast__cli__args.html">ast_cli_args</a> *<a class="code" href="../../d7/d6f/test__linkedlists_8c.html#a13dd15487fee89a002d17ef3aff62d02">a</a>)</div><div class="line"><a name="l04069"></a><span class="lineno"> 4069</span>&#160;{</div><div class="line"><a name="l04070"></a><span class="lineno"> 4070</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d9/d07/structfax__module.html">fax_module</a> *fax;</div><div class="line"><a name="l04071"></a><span class="lineno"> 4071</span>&#160;   <span class="keywordtype">char</span> modems[128] = <span class="stringliteral">&quot;&quot;</span>;</div><div class="line"><a name="l04072"></a><span class="lineno"> 4072</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d0/d28/structfax__options.html">fax_options</a> options;</div><div class="line"><a name="l04073"></a><span class="lineno"> 4073</span>&#160;</div><div class="line"><a name="l04074"></a><span class="lineno"> 4074</span>&#160;   <span class="keywordflow">switch</span> (cmd) {</div><div class="line"><a name="l04075"></a><span class="lineno"> 4075</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="../../dc/db0/cli_8h.html#ab33e5350a923c3a8cedbeb496cd88ec9a71745eb63dd093f560a1add3e430d2a9">CLI_INIT</a>:</div><div class="line"><a name="l04076"></a><span class="lineno"> 4076</span>&#160;      e-&gt;<a class="code" href="../../d8/d07/structast__cli__entry.html#ade9cba72805fe52685a1deea307a8e82">command</a> = <span class="stringliteral">&quot;fax show settings&quot;</span>;</div><div class="line"><a name="l04077"></a><span class="lineno"> 4077</span>&#160;      e-&gt;<a class="code" href="../../d8/d07/structast__cli__entry.html#aef1bd6ad890a110b466cb0e8088507a2">usage</a> =</div><div class="line"><a name="l04078"></a><span class="lineno"> 4078</span>&#160;         <span class="stringliteral">&quot;Usage: fax show settings\n&quot;</span></div><div class="line"><a name="l04079"></a><span class="lineno"> 4079</span>&#160;         <span class="stringliteral">&quot;       Show the global settings and defaults of both the FAX core and technology modules\n&quot;</span>;</div><div class="line"><a name="l04080"></a><span class="lineno"> 4080</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l04081"></a><span class="lineno"> 4081</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="../../dc/db0/cli_8h.html#ab33e5350a923c3a8cedbeb496cd88ec9a76bf33139279b03ec1691f2be2d1be40">CLI_GENERATE</a>:</div><div class="line"><a name="l04082"></a><span class="lineno"> 4082</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l04083"></a><span class="lineno"> 4083</span>&#160;   }</div><div class="line"><a name="l04084"></a><span class="lineno"> 4084</span>&#160;</div><div class="line"><a name="l04085"></a><span class="lineno"> 4085</span>&#160;   <a class="code" href="../../d0/d60/res__fax_8c.html#aa4691aa21eb58ad524c6418d9f252b7d">get_general_options</a>(&amp;options);</div><div class="line"><a name="l04086"></a><span class="lineno"> 4086</span>&#160;</div><div class="line"><a name="l04087"></a><span class="lineno"> 4087</span>&#160;   <a class="code" href="../../dc/db0/cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#acf64f219885421479997667d2ed3f08a">fd</a>, <span class="stringliteral">&quot;FAX For Asterisk Settings:\n&quot;</span>);</div><div class="line"><a name="l04088"></a><span class="lineno"> 4088</span>&#160;   <a class="code" href="../../dc/db0/cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#acf64f219885421479997667d2ed3f08a">fd</a>, <span class="stringliteral">&quot;\tECM: %s\n&quot;</span>, options.<a class="code" href="../../d0/d28/structfax__options.html#af766692698b742acddbc42494d323a9f">ecm</a> ? <span class="stringliteral">&quot;Enabled&quot;</span> : <span class="stringliteral">&quot;Disabled&quot;</span>);</div><div class="line"><a name="l04089"></a><span class="lineno"> 4089</span>&#160;   <a class="code" href="../../dc/db0/cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#acf64f219885421479997667d2ed3f08a">fd</a>, <span class="stringliteral">&quot;\tStatus Events: %s\n&quot;</span>,  options.<a class="code" href="../../d0/d28/structfax__options.html#a7f633c7bc4fe667e873649afa4d44640">statusevents</a> ? <span class="stringliteral">&quot;On&quot;</span> : <span class="stringliteral">&quot;Off&quot;</span>);</div><div class="line"><a name="l04090"></a><span class="lineno"> 4090</span>&#160;   <a class="code" href="../../dc/db0/cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#acf64f219885421479997667d2ed3f08a">fd</a>, <span class="stringliteral">&quot;\tMinimum Bit Rate: %u\n&quot;</span>, options.<a class="code" href="../../d0/d28/structfax__options.html#a8bff16fb9ab2254b86636f6fac166a66">minrate</a>);</div><div class="line"><a name="l04091"></a><span class="lineno"> 4091</span>&#160;   <a class="code" href="../../dc/db0/cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#acf64f219885421479997667d2ed3f08a">fd</a>, <span class="stringliteral">&quot;\tMaximum Bit Rate: %u\n&quot;</span>, options.<a class="code" href="../../d0/d28/structfax__options.html#a975b0a45868387d13867daeac314978a">maxrate</a>);</div><div class="line"><a name="l04092"></a><span class="lineno"> 4092</span>&#160;   <a class="code" href="../../d0/d60/res__fax_8c.html#a9310358a6223a275dce64548ab625062">ast_fax_modem_to_str</a>(options.<a class="code" href="../../d0/d28/structfax__options.html#a38b557eee45ee4c0d92d514c04823f84">modems</a>, modems, <span class="keyword">sizeof</span>(modems));</div><div class="line"><a name="l04093"></a><span class="lineno"> 4093</span>&#160;   <a class="code" href="../../dc/db0/cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#acf64f219885421479997667d2ed3f08a">fd</a>, <span class="stringliteral">&quot;\tModem Modulations Allowed: %s\n&quot;</span>, modems);</div><div class="line"><a name="l04094"></a><span class="lineno"> 4094</span>&#160;   <a class="code" href="../../dc/db0/cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#acf64f219885421479997667d2ed3f08a">fd</a>, <span class="stringliteral">&quot;\tT.38 Negotiation Timeout: %u\n&quot;</span>, options.<a class="code" href="../../d0/d28/structfax__options.html#a50d4d0d4e0ae5aae877a0e6d2faa9517">t38timeout</a>);</div><div class="line"><a name="l04095"></a><span class="lineno"> 4095</span>&#160;   <a class="code" href="../../dc/db0/cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#acf64f219885421479997667d2ed3f08a">fd</a>, <span class="stringliteral">&quot;\n\nFAX Technology Modules:\n\n&quot;</span>);</div><div class="line"><a name="l04096"></a><span class="lineno"> 4096</span>&#160;   <a class="code" href="../../df/d90/linkedlists_8h.html#a0a0fe104cc2cc36a43784f886f3ae7dc">AST_RWLIST_RDLOCK</a>(&amp;<a class="code" href="../../df/d07/structfaxmodules.html">faxmodules</a>);</div><div class="line"><a name="l04097"></a><span class="lineno"> 4097</span>&#160;   <a class="code" href="../../df/d90/linkedlists_8h.html#a944b82566722f2247aa35f1328402c98">AST_RWLIST_TRAVERSE</a>(&amp;<a class="code" href="../../df/d07/structfaxmodules.html">faxmodules</a>, fax, list) {</div><div class="line"><a name="l04098"></a><span class="lineno"> 4098</span>&#160;      <a class="code" href="../../dc/db0/cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#acf64f219885421479997667d2ed3f08a">fd</a>, <span class="stringliteral">&quot;%s (%s) Settings:\n&quot;</span>, fax-&gt;<a class="code" href="../../d9/d07/structfax__module.html#a4ac6ff3775e67c710cd55bc7dfd592fe">tech</a>-&gt;<a class="code" href="../../d9/d0e/structast__fax__tech.html#a8ff938fb2f815be425fd2859a21e6d61">type</a>, fax-&gt;<a class="code" href="../../d9/d07/structfax__module.html#a4ac6ff3775e67c710cd55bc7dfd592fe">tech</a>-&gt;<a class="code" href="../../d9/d0e/structast__fax__tech.html#ac57ec035c076b222b9420a68ddab3bf1">description</a>);</div><div class="line"><a name="l04099"></a><span class="lineno"> 4099</span>&#160;      fax-&gt;<a class="code" href="../../d9/d07/structfax__module.html#a4ac6ff3775e67c710cd55bc7dfd592fe">tech</a>-&gt;<a class="code" href="../../d9/d0e/structast__fax__tech.html#a223cb9747d79114e3d087507f06cfdbd">cli_show_settings</a>(a-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#acf64f219885421479997667d2ed3f08a">fd</a>);</div><div class="line"><a name="l04100"></a><span class="lineno"> 4100</span>&#160;   }</div><div class="line"><a name="l04101"></a><span class="lineno"> 4101</span>&#160;   <a class="code" href="../../df/d90/linkedlists_8h.html#a2e9a2518b5029b96671aff6701bd5138">AST_RWLIST_UNLOCK</a>(&amp;<a class="code" href="../../df/d07/structfaxmodules.html">faxmodules</a>);</div><div class="line"><a name="l04102"></a><span class="lineno"> 4102</span>&#160;</div><div class="line"><a name="l04103"></a><span class="lineno"> 4103</span>&#160;   <span class="keywordflow">return</span> <a class="code" href="../../dc/db0/cli_8h.html#a50989f00b32eeb2516a3803cb2ffb766">CLI_SUCCESS</a>;</div><div class="line"><a name="l04104"></a><span class="lineno"> 4104</span>&#160;}</div><div class="line"><a name="l04105"></a><span class="lineno"> 4105</span>&#160;<span class="comment"></span></div><div class="line"><a name="l04106"></a><span class="lineno"> 4106</span>&#160;<span class="comment">/*! \brief display details of a specified fax session */</span></div><div class="line"><a name="l04107"></a><span class="lineno"><a class="line" href="../../d0/d60/res__fax_8c.html#aac8f65ba9ce0d6ea865b98cc415003cf"> 4107</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">char</span> *<a class="code" href="../../d0/d60/res__fax_8c.html#aac8f65ba9ce0d6ea865b98cc415003cf">cli_fax_show_session</a>(<span class="keyword">struct</span> <a class="code" href="../../d8/d07/structast__cli__entry.html">ast_cli_entry</a> *e, <span class="keywordtype">int</span> cmd, <span class="keyword">struct</span> <a class="code" href="../../d3/dad/structast__cli__args.html">ast_cli_args</a> *<a class="code" href="../../d7/d6f/test__linkedlists_8c.html#a13dd15487fee89a002d17ef3aff62d02">a</a>)</div><div class="line"><a name="l04108"></a><span class="lineno"> 4108</span>&#160;{</div><div class="line"><a name="l04109"></a><span class="lineno"> 4109</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d1/d16/structast__fax__session.html">ast_fax_session</a> *s, <a class="code" href="../../de/d1e/bt__open_8c.html#a1cdd2bb1a9a71d3e1120100229315d67">tmp</a>;</div><div class="line"><a name="l04110"></a><span class="lineno"> 4110</span>&#160;</div><div class="line"><a name="l04111"></a><span class="lineno"> 4111</span>&#160;   <span class="keywordflow">switch</span> (cmd) {</div><div class="line"><a name="l04112"></a><span class="lineno"> 4112</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="../../dc/db0/cli_8h.html#ab33e5350a923c3a8cedbeb496cd88ec9a71745eb63dd093f560a1add3e430d2a9">CLI_INIT</a>:</div><div class="line"><a name="l04113"></a><span class="lineno"> 4113</span>&#160;      e-&gt;<a class="code" href="../../d8/d07/structast__cli__entry.html#ade9cba72805fe52685a1deea307a8e82">command</a> = <span class="stringliteral">&quot;fax show session&quot;</span>;</div><div class="line"><a name="l04114"></a><span class="lineno"> 4114</span>&#160;      e-&gt;<a class="code" href="../../d8/d07/structast__cli__entry.html#aef1bd6ad890a110b466cb0e8088507a2">usage</a> =</div><div class="line"><a name="l04115"></a><span class="lineno"> 4115</span>&#160;         <span class="stringliteral">&quot;Usage: fax show session &lt;session number&gt;\n&quot;</span></div><div class="line"><a name="l04116"></a><span class="lineno"> 4116</span>&#160;         <span class="stringliteral">&quot;       Shows status of the named FAX session\n&quot;</span>;</div><div class="line"><a name="l04117"></a><span class="lineno"> 4117</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l04118"></a><span class="lineno"> 4118</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="../../dc/db0/cli_8h.html#ab33e5350a923c3a8cedbeb496cd88ec9a76bf33139279b03ec1691f2be2d1be40">CLI_GENERATE</a>:</div><div class="line"><a name="l04119"></a><span class="lineno"> 4119</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../d0/d60/res__fax_8c.html#a6804dd46bef333503315e1e71db009cf">fax_session_tab_complete</a>(a);</div><div class="line"><a name="l04120"></a><span class="lineno"> 4120</span>&#160;   }</div><div class="line"><a name="l04121"></a><span class="lineno"> 4121</span>&#160;</div><div class="line"><a name="l04122"></a><span class="lineno"> 4122</span>&#160;   <span class="keywordflow">if</span> (a-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#a98e1d8441ca58834f11f7367be4b3345">argc</a> != 4) {</div><div class="line"><a name="l04123"></a><span class="lineno"> 4123</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/db0/cli_8h.html#a0873456096960dab21fff0ce68c95acb">CLI_SHOWUSAGE</a>;</div><div class="line"><a name="l04124"></a><span class="lineno"> 4124</span>&#160;   }</div><div class="line"><a name="l04125"></a><span class="lineno"> 4125</span>&#160;</div><div class="line"><a name="l04126"></a><span class="lineno"> 4126</span>&#160;   <span class="keywordflow">if</span> (sscanf(a-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#ad0a19c4d63698f9e9cfd5653e8851452">argv</a>[3], <span class="stringliteral">&quot;%u&quot;</span>, &amp;tmp.<a class="code" href="../../d1/d16/structast__fax__session.html#ab7ce6f462afaf105224b0ca772a33c43">id</a>) != 1) {</div><div class="line"><a name="l04127"></a><span class="lineno"> 4127</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;invalid session id: &#39;%s&#39;\n&quot;</span>, a-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#ad0a19c4d63698f9e9cfd5653e8851452">argv</a>[3]);</div><div class="line"><a name="l04128"></a><span class="lineno"> 4128</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/db0/cli_8h.html#a7cc1753a05a0821f6c70dd2bccfbab5c">RESULT_SUCCESS</a>;</div><div class="line"><a name="l04129"></a><span class="lineno"> 4129</span>&#160;   }</div><div class="line"><a name="l04130"></a><span class="lineno"> 4130</span>&#160;</div><div class="line"><a name="l04131"></a><span class="lineno"> 4131</span>&#160;   <a class="code" href="../../dc/db0/cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#acf64f219885421479997667d2ed3f08a">fd</a>, <span class="stringliteral">&quot;\nFAX Session Details:\n--------------------\n\n&quot;</span>);</div><div class="line"><a name="l04132"></a><span class="lineno"> 4132</span>&#160;   s = <a class="code" href="../../d5/da5/astobj2_8h.html#a911e0703891a9a7aaf73978152092586">ao2_find</a>(<a class="code" href="../../d0/d60/res__fax_8c.html#a058b6772fcfe1ce5a1a0957e2f11d367">faxregistry</a>.container, &amp;tmp, <a class="code" href="../../d5/da5/astobj2_8h.html#a2448088751e4d494d1981c7f4b84e8d0">OBJ_POINTER</a>);</div><div class="line"><a name="l04133"></a><span class="lineno"> 4133</span>&#160;   <span class="keywordflow">if</span> (s) {</div><div class="line"><a name="l04134"></a><span class="lineno"> 4134</span>&#160;      <a class="code" href="../../dc/db0/cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#acf64f219885421479997667d2ed3f08a">fd</a>, <span class="stringliteral">&quot;%-22s : %s\n&quot;</span>, <span class="stringliteral">&quot;channel&quot;</span>, s-&gt;<a class="code" href="../../d1/d16/structast__fax__session.html#a9f716886b5b2a50ad6d2b9119502b152">channame</a>);</div><div class="line"><a name="l04135"></a><span class="lineno"> 4135</span>&#160;      s-&gt;<a class="code" href="../../d1/d16/structast__fax__session.html#a4ac6ff3775e67c710cd55bc7dfd592fe">tech</a>-&gt;<a class="code" href="../../d9/d0e/structast__fax__tech.html#ae6156817adecb8ef99cd175a229e07fe">cli_show_session</a>(s, a-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#acf64f219885421479997667d2ed3f08a">fd</a>);</div><div class="line"><a name="l04136"></a><span class="lineno"> 4136</span>&#160;      <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(s, -1);</div><div class="line"><a name="l04137"></a><span class="lineno"> 4137</span>&#160;   }</div><div class="line"><a name="l04138"></a><span class="lineno"> 4138</span>&#160;   <a class="code" href="../../dc/db0/cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#acf64f219885421479997667d2ed3f08a">fd</a>, <span class="stringliteral">&quot;\n\n&quot;</span>);</div><div class="line"><a name="l04139"></a><span class="lineno"> 4139</span>&#160;</div><div class="line"><a name="l04140"></a><span class="lineno"> 4140</span>&#160;   <span class="keywordflow">return</span> <a class="code" href="../../dc/db0/cli_8h.html#a50989f00b32eeb2516a3803cb2ffb766">CLI_SUCCESS</a>;</div><div class="line"><a name="l04141"></a><span class="lineno"> 4141</span>&#160;}</div><div class="line"><a name="l04142"></a><span class="lineno"> 4142</span>&#160;</div><div class="line"><a name="l04143"></a><span class="lineno"><a class="line" href="../../d0/d60/res__fax_8c.html#aaacf4ac8f8a199b23f61f1fd37982940"> 4143</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d0/d60/res__fax_8c.html#aaacf4ac8f8a199b23f61f1fd37982940">manager_fax_session</a>(<span class="keyword">struct</span> <a class="code" href="../../d2/d8a/structmansession.html">mansession</a> *s, <span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="../../d8/d9e/structmessage.html">message</a> *m)</div><div class="line"><a name="l04144"></a><span class="lineno"> 4144</span>&#160;{</div><div class="line"><a name="l04145"></a><span class="lineno"> 4145</span>&#160;   <span class="keyword">const</span> <span class="keywordtype">char</span> *action_id = <a class="code" href="../../df/d72/group__Group__AMI.html#gac6a9f3498f9afffecfd78c485af41556">astman_get_header</a>(m, <span class="stringliteral">&quot;ActionID&quot;</span>);</div><div class="line"><a name="l04146"></a><span class="lineno"> 4146</span>&#160;   <span class="keyword">const</span> <span class="keywordtype">char</span> *session_number = <a class="code" href="../../df/d72/group__Group__AMI.html#gac6a9f3498f9afffecfd78c485af41556">astman_get_header</a>(m, <span class="stringliteral">&quot;SessionNumber&quot;</span>);</div><div class="line"><a name="l04147"></a><span class="lineno"> 4147</span>&#160;   <span class="keywordtype">char</span> id_text[256] = <span class="stringliteral">&quot;&quot;</span>;</div><div class="line"><a name="l04148"></a><span class="lineno"> 4148</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d1/d16/structast__fax__session.html">ast_fax_session</a> *<a class="code" href="../../d2/d4d/astman_8c.html#ac4a6ae0400e4457f0b35beddec80c93d">session</a>;</div><div class="line"><a name="l04149"></a><span class="lineno"> 4149</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d1/d16/structast__fax__session.html">ast_fax_session</a> find_session;</div><div class="line"><a name="l04150"></a><span class="lineno"> 4150</span>&#160;</div><div class="line"><a name="l04151"></a><span class="lineno"> 4151</span>&#160;   <span class="keywordflow">if</span> (sscanf(session_number, <span class="stringliteral">&quot;%30u&quot;</span>, &amp;find_session.<a class="code" href="../../d1/d16/structast__fax__session.html#ab7ce6f462afaf105224b0ca772a33c43">id</a>) != 1) {</div><div class="line"><a name="l04152"></a><span class="lineno"> 4152</span>&#160;      <a class="code" href="../../df/d72/group__Group__AMI.html#ga31a02a7d3cc36aa66ebebdedfc574d1c">astman_send_error</a>(s, m, <span class="stringliteral">&quot;Invalid session ID&quot;</span>);</div><div class="line"><a name="l04153"></a><span class="lineno"> 4153</span>&#160;      <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l04154"></a><span class="lineno"> 4154</span>&#160;   }</div><div class="line"><a name="l04155"></a><span class="lineno"> 4155</span>&#160;</div><div class="line"><a name="l04156"></a><span class="lineno"> 4156</span>&#160;   session = <a class="code" href="../../d5/da5/astobj2_8h.html#a911e0703891a9a7aaf73978152092586">ao2_find</a>(<a class="code" href="../../d0/d60/res__fax_8c.html#a058b6772fcfe1ce5a1a0957e2f11d367">faxregistry</a>.container, &amp;find_session, <a class="code" href="../../d5/da5/astobj2_8h.html#a2448088751e4d494d1981c7f4b84e8d0">OBJ_POINTER</a>);</div><div class="line"><a name="l04157"></a><span class="lineno"> 4157</span>&#160;   <span class="keywordflow">if</span> (!session) {</div><div class="line"><a name="l04158"></a><span class="lineno"> 4158</span>&#160;      <a class="code" href="../../df/d72/group__Group__AMI.html#ga31a02a7d3cc36aa66ebebdedfc574d1c">astman_send_error</a>(s, m, <span class="stringliteral">&quot;Session not found&quot;</span>);</div><div class="line"><a name="l04159"></a><span class="lineno"> 4159</span>&#160;      <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l04160"></a><span class="lineno"> 4160</span>&#160;   }</div><div class="line"><a name="l04161"></a><span class="lineno"> 4161</span>&#160;</div><div class="line"><a name="l04162"></a><span class="lineno"> 4162</span>&#160;   <span class="keywordflow">if</span> (!session-&gt;<a class="code" href="../../d1/d16/structast__fax__session.html#a4ac6ff3775e67c710cd55bc7dfd592fe">tech</a>-&gt;<a class="code" href="../../d9/d0e/structast__fax__tech.html#a122c331ef9858205b17ca45fb08c211b">manager_fax_session</a>) {</div><div class="line"><a name="l04163"></a><span class="lineno"> 4163</span>&#160;      <a class="code" href="../../df/d72/group__Group__AMI.html#ga31a02a7d3cc36aa66ebebdedfc574d1c">astman_send_error</a>(s, m, <span class="stringliteral">&quot;Fax technology doesn&#39;t provide a handler for FAXSession&quot;</span>);</div><div class="line"><a name="l04164"></a><span class="lineno"> 4164</span>&#160;      <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(session, -1);</div><div class="line"><a name="l04165"></a><span class="lineno"> 4165</span>&#160;      <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l04166"></a><span class="lineno"> 4166</span>&#160;   }</div><div class="line"><a name="l04167"></a><span class="lineno"> 4167</span>&#160;</div><div class="line"><a name="l04168"></a><span class="lineno"> 4168</span>&#160;   <span class="keywordflow">if</span> (!<a class="code" href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a>(action_id)) {</div><div class="line"><a name="l04169"></a><span class="lineno"> 4169</span>&#160;      snprintf(id_text, <span class="keyword">sizeof</span>(id_text), <span class="stringliteral">&quot;ActionID: %s\r\n&quot;</span>, action_id);</div><div class="line"><a name="l04170"></a><span class="lineno"> 4170</span>&#160;   }</div><div class="line"><a name="l04171"></a><span class="lineno"> 4171</span>&#160;</div><div class="line"><a name="l04172"></a><span class="lineno"> 4172</span>&#160;   <a class="code" href="../../df/d72/group__Group__AMI.html#ga77315fa8e29950f0c88120501acda0a3">astman_send_ack</a>(s, m, <span class="stringliteral">&quot;FAXSession event will follow&quot;</span>);</div><div class="line"><a name="l04173"></a><span class="lineno"> 4173</span>&#160;</div><div class="line"><a name="l04174"></a><span class="lineno"> 4174</span>&#160;   session-&gt;<a class="code" href="../../d1/d16/structast__fax__session.html#a4ac6ff3775e67c710cd55bc7dfd592fe">tech</a>-&gt;<a class="code" href="../../d9/d0e/structast__fax__tech.html#a122c331ef9858205b17ca45fb08c211b">manager_fax_session</a>(s, id_text, session);</div><div class="line"><a name="l04175"></a><span class="lineno"> 4175</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(session, -1);</div><div class="line"><a name="l04176"></a><span class="lineno"> 4176</span>&#160;</div><div class="line"><a name="l04177"></a><span class="lineno"> 4177</span>&#160;   <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l04178"></a><span class="lineno"> 4178</span>&#160;}</div><div class="line"><a name="l04179"></a><span class="lineno"> 4179</span>&#160;<span class="comment"></span></div><div class="line"><a name="l04180"></a><span class="lineno"> 4180</span>&#160;<span class="comment">/*! \brief display fax stats */</span></div><div class="line"><a name="l04181"></a><span class="lineno"><a class="line" href="../../d0/d60/res__fax_8c.html#a00b75aa8e0cf805cdf2ad917351e0a1e"> 4181</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">char</span> *<a class="code" href="../../d0/d60/res__fax_8c.html#a00b75aa8e0cf805cdf2ad917351e0a1e">cli_fax_show_stats</a>(<span class="keyword">struct</span> <a class="code" href="../../d8/d07/structast__cli__entry.html">ast_cli_entry</a> *e, <span class="keywordtype">int</span> cmd, <span class="keyword">struct</span> <a class="code" href="../../d3/dad/structast__cli__args.html">ast_cli_args</a> *<a class="code" href="../../d7/d6f/test__linkedlists_8c.html#a13dd15487fee89a002d17ef3aff62d02">a</a>)</div><div class="line"><a name="l04182"></a><span class="lineno"> 4182</span>&#160;{</div><div class="line"><a name="l04183"></a><span class="lineno"> 4183</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d9/d07/structfax__module.html">fax_module</a> *fax;</div><div class="line"><a name="l04184"></a><span class="lineno"> 4184</span>&#160;</div><div class="line"><a name="l04185"></a><span class="lineno"> 4185</span>&#160;   <span class="keywordflow">switch</span> (cmd) {</div><div class="line"><a name="l04186"></a><span class="lineno"> 4186</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="../../dc/db0/cli_8h.html#ab33e5350a923c3a8cedbeb496cd88ec9a71745eb63dd093f560a1add3e430d2a9">CLI_INIT</a>:</div><div class="line"><a name="l04187"></a><span class="lineno"> 4187</span>&#160;      e-&gt;<a class="code" href="../../d8/d07/structast__cli__entry.html#ade9cba72805fe52685a1deea307a8e82">command</a> = <span class="stringliteral">&quot;fax show stats&quot;</span>;</div><div class="line"><a name="l04188"></a><span class="lineno"> 4188</span>&#160;      e-&gt;<a class="code" href="../../d8/d07/structast__cli__entry.html#aef1bd6ad890a110b466cb0e8088507a2">usage</a> =</div><div class="line"><a name="l04189"></a><span class="lineno"> 4189</span>&#160;         <span class="stringliteral">&quot;Usage: fax show stats\n&quot;</span></div><div class="line"><a name="l04190"></a><span class="lineno"> 4190</span>&#160;         <span class="stringliteral">&quot;       Shows a statistical summary of FAX transmissions\n&quot;</span>;</div><div class="line"><a name="l04191"></a><span class="lineno"> 4191</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l04192"></a><span class="lineno"> 4192</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="../../dc/db0/cli_8h.html#ab33e5350a923c3a8cedbeb496cd88ec9a76bf33139279b03ec1691f2be2d1be40">CLI_GENERATE</a>:</div><div class="line"><a name="l04193"></a><span class="lineno"> 4193</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l04194"></a><span class="lineno"> 4194</span>&#160;   }</div><div class="line"><a name="l04195"></a><span class="lineno"> 4195</span>&#160;</div><div class="line"><a name="l04196"></a><span class="lineno"> 4196</span>&#160;   <a class="code" href="../../dc/db0/cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#acf64f219885421479997667d2ed3f08a">fd</a>, <span class="stringliteral">&quot;\nFAX Statistics:\n---------------\n\n&quot;</span>);</div><div class="line"><a name="l04197"></a><span class="lineno"> 4197</span>&#160;   <a class="code" href="../../dc/db0/cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#acf64f219885421479997667d2ed3f08a">fd</a>, <span class="stringliteral">&quot;%-20.20s : %d\n&quot;</span>, <span class="stringliteral">&quot;Current Sessions&quot;</span>, <a class="code" href="../../d0/d60/res__fax_8c.html#a058b6772fcfe1ce5a1a0957e2f11d367">faxregistry</a>.active_sessions);</div><div class="line"><a name="l04198"></a><span class="lineno"> 4198</span>&#160;   <a class="code" href="../../dc/db0/cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#acf64f219885421479997667d2ed3f08a">fd</a>, <span class="stringliteral">&quot;%-20.20s : %d\n&quot;</span>, <span class="stringliteral">&quot;Reserved Sessions&quot;</span>, <a class="code" href="../../d0/d60/res__fax_8c.html#a058b6772fcfe1ce5a1a0957e2f11d367">faxregistry</a>.reserved_sessions);</div><div class="line"><a name="l04199"></a><span class="lineno"> 4199</span>&#160;   <a class="code" href="../../dc/db0/cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#acf64f219885421479997667d2ed3f08a">fd</a>, <span class="stringliteral">&quot;%-20.20s : %d\n&quot;</span>, <span class="stringliteral">&quot;Transmit Attempts&quot;</span>, <a class="code" href="../../d0/d60/res__fax_8c.html#a058b6772fcfe1ce5a1a0957e2f11d367">faxregistry</a>.fax_tx_attempts);</div><div class="line"><a name="l04200"></a><span class="lineno"> 4200</span>&#160;   <a class="code" href="../../dc/db0/cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#acf64f219885421479997667d2ed3f08a">fd</a>, <span class="stringliteral">&quot;%-20.20s : %d\n&quot;</span>, <span class="stringliteral">&quot;Receive Attempts&quot;</span>, <a class="code" href="../../d0/d60/res__fax_8c.html#a058b6772fcfe1ce5a1a0957e2f11d367">faxregistry</a>.fax_rx_attempts);</div><div class="line"><a name="l04201"></a><span class="lineno"> 4201</span>&#160;   <a class="code" href="../../dc/db0/cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#acf64f219885421479997667d2ed3f08a">fd</a>, <span class="stringliteral">&quot;%-20.20s : %d\n&quot;</span>, <span class="stringliteral">&quot;Completed FAXes&quot;</span>, <a class="code" href="../../d0/d60/res__fax_8c.html#a058b6772fcfe1ce5a1a0957e2f11d367">faxregistry</a>.fax_complete);</div><div class="line"><a name="l04202"></a><span class="lineno"> 4202</span>&#160;   <a class="code" href="../../dc/db0/cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#acf64f219885421479997667d2ed3f08a">fd</a>, <span class="stringliteral">&quot;%-20.20s : %d\n&quot;</span>, <span class="stringliteral">&quot;Failed FAXes&quot;</span>, <a class="code" href="../../d0/d60/res__fax_8c.html#a058b6772fcfe1ce5a1a0957e2f11d367">faxregistry</a>.fax_failures);</div><div class="line"><a name="l04203"></a><span class="lineno"> 4203</span>&#160;   <a class="code" href="../../df/d90/linkedlists_8h.html#a0a0fe104cc2cc36a43784f886f3ae7dc">AST_RWLIST_RDLOCK</a>(&amp;<a class="code" href="../../df/d07/structfaxmodules.html">faxmodules</a>);</div><div class="line"><a name="l04204"></a><span class="lineno"> 4204</span>&#160;   <a class="code" href="../../df/d90/linkedlists_8h.html#a944b82566722f2247aa35f1328402c98">AST_RWLIST_TRAVERSE</a>(&amp;<a class="code" href="../../df/d07/structfaxmodules.html">faxmodules</a>, fax, list) {</div><div class="line"><a name="l04205"></a><span class="lineno"> 4205</span>&#160;      fax-&gt;<a class="code" href="../../d9/d07/structfax__module.html#a4ac6ff3775e67c710cd55bc7dfd592fe">tech</a>-&gt;<a class="code" href="../../d9/d0e/structast__fax__tech.html#aa6e050925b9e4522acd7e77374b54128">cli_show_stats</a>(a-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#acf64f219885421479997667d2ed3f08a">fd</a>);</div><div class="line"><a name="l04206"></a><span class="lineno"> 4206</span>&#160;   }</div><div class="line"><a name="l04207"></a><span class="lineno"> 4207</span>&#160;   <a class="code" href="../../df/d90/linkedlists_8h.html#a2e9a2518b5029b96671aff6701bd5138">AST_RWLIST_UNLOCK</a>(&amp;<a class="code" href="../../df/d07/structfaxmodules.html">faxmodules</a>);</div><div class="line"><a name="l04208"></a><span class="lineno"> 4208</span>&#160;   <a class="code" href="../../dc/db0/cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#acf64f219885421479997667d2ed3f08a">fd</a>, <span class="stringliteral">&quot;\n\n&quot;</span>);</div><div class="line"><a name="l04209"></a><span class="lineno"> 4209</span>&#160;</div><div class="line"><a name="l04210"></a><span class="lineno"> 4210</span>&#160;   <span class="keywordflow">return</span> <a class="code" href="../../dc/db0/cli_8h.html#a50989f00b32eeb2516a3803cb2ffb766">CLI_SUCCESS</a>;</div><div class="line"><a name="l04211"></a><span class="lineno"> 4211</span>&#160;}</div><div class="line"><a name="l04212"></a><span class="lineno"> 4212</span>&#160;</div><div class="line"><a name="l04213"></a><span class="lineno"><a class="line" href="../../d0/d60/res__fax_8c.html#abe5fc760b71dee05a818bb0df9639e36"> 4213</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d0/d60/res__fax_8c.html#abe5fc760b71dee05a818bb0df9639e36">manager_fax_stats</a>(<span class="keyword">struct</span> <a class="code" href="../../d2/d8a/structmansession.html">mansession</a> *s, <span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="../../d8/d9e/structmessage.html">message</a> *m)</div><div class="line"><a name="l04214"></a><span class="lineno"> 4214</span>&#160;{</div><div class="line"><a name="l04215"></a><span class="lineno"> 4215</span>&#160;   <span class="keyword">const</span> <span class="keywordtype">char</span> *action_id = <a class="code" href="../../df/d72/group__Group__AMI.html#gac6a9f3498f9afffecfd78c485af41556">astman_get_header</a>(m, <span class="stringliteral">&quot;ActionID&quot;</span>);</div><div class="line"><a name="l04216"></a><span class="lineno"> 4216</span>&#160;</div><div class="line"><a name="l04217"></a><span class="lineno"> 4217</span>&#160;   <span class="keywordtype">char</span> id_text[256] = <span class="stringliteral">&quot;&quot;</span>;</div><div class="line"><a name="l04218"></a><span class="lineno"> 4218</span>&#160;</div><div class="line"><a name="l04219"></a><span class="lineno"> 4219</span>&#160;   <a class="code" href="../../df/d72/group__Group__AMI.html#ga77315fa8e29950f0c88120501acda0a3">astman_send_ack</a>(s, m, <span class="stringliteral">&quot;FAXStats event will follow&quot;</span>);</div><div class="line"><a name="l04220"></a><span class="lineno"> 4220</span>&#160;</div><div class="line"><a name="l04221"></a><span class="lineno"> 4221</span>&#160;   <span class="keywordflow">if</span> (!<a class="code" href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a>(action_id)) {</div><div class="line"><a name="l04222"></a><span class="lineno"> 4222</span>&#160;      snprintf(id_text, <span class="keyword">sizeof</span>(id_text), <span class="stringliteral">&quot;ActionID: %s\r\n&quot;</span>, action_id);</div><div class="line"><a name="l04223"></a><span class="lineno"> 4223</span>&#160;   }</div><div class="line"><a name="l04224"></a><span class="lineno"> 4224</span>&#160;</div><div class="line"><a name="l04225"></a><span class="lineno"> 4225</span>&#160;   <a class="code" href="../../df/d72/group__Group__AMI.html#gac2d42f7be13c532b6a70d50f1b8983d2">astman_append</a>(s, <span class="stringliteral">&quot;Event: FAXStats\r\n&quot;</span></div><div class="line"><a name="l04226"></a><span class="lineno"> 4226</span>&#160;      <span class="stringliteral">&quot;%s&quot;</span></div><div class="line"><a name="l04227"></a><span class="lineno"> 4227</span>&#160;      <span class="stringliteral">&quot;CurrentSessions: %d\r\n&quot;</span></div><div class="line"><a name="l04228"></a><span class="lineno"> 4228</span>&#160;      <span class="stringliteral">&quot;ReservedSessions: %d\r\n&quot;</span></div><div class="line"><a name="l04229"></a><span class="lineno"> 4229</span>&#160;      <span class="stringliteral">&quot;TransmitAttempts: %d\r\n&quot;</span></div><div class="line"><a name="l04230"></a><span class="lineno"> 4230</span>&#160;      <span class="stringliteral">&quot;ReceiveAttempts: %d\r\n&quot;</span></div><div class="line"><a name="l04231"></a><span class="lineno"> 4231</span>&#160;      <span class="stringliteral">&quot;CompletedFAXes: %d\r\n&quot;</span></div><div class="line"><a name="l04232"></a><span class="lineno"> 4232</span>&#160;      <span class="stringliteral">&quot;FailedFAXes: %d\r\n&quot;</span></div><div class="line"><a name="l04233"></a><span class="lineno"> 4233</span>&#160;      <span class="stringliteral">&quot;\r\n&quot;</span>,</div><div class="line"><a name="l04234"></a><span class="lineno"> 4234</span>&#160;      id_text,</div><div class="line"><a name="l04235"></a><span class="lineno"> 4235</span>&#160;      <a class="code" href="../../d0/d60/res__fax_8c.html#a058b6772fcfe1ce5a1a0957e2f11d367">faxregistry</a>.active_sessions, <a class="code" href="../../d0/d60/res__fax_8c.html#a058b6772fcfe1ce5a1a0957e2f11d367">faxregistry</a>.reserved_sessions,</div><div class="line"><a name="l04236"></a><span class="lineno"> 4236</span>&#160;      <a class="code" href="../../d0/d60/res__fax_8c.html#a058b6772fcfe1ce5a1a0957e2f11d367">faxregistry</a>.fax_tx_attempts, <a class="code" href="../../d0/d60/res__fax_8c.html#a058b6772fcfe1ce5a1a0957e2f11d367">faxregistry</a>.fax_rx_attempts,</div><div class="line"><a name="l04237"></a><span class="lineno"> 4237</span>&#160;      <a class="code" href="../../d0/d60/res__fax_8c.html#a058b6772fcfe1ce5a1a0957e2f11d367">faxregistry</a>.fax_complete, <a class="code" href="../../d0/d60/res__fax_8c.html#a058b6772fcfe1ce5a1a0957e2f11d367">faxregistry</a>.fax_failures);</div><div class="line"><a name="l04238"></a><span class="lineno"> 4238</span>&#160;</div><div class="line"><a name="l04239"></a><span class="lineno"> 4239</span>&#160;   <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l04240"></a><span class="lineno"> 4240</span>&#160;}</div><div class="line"><a name="l04241"></a><span class="lineno"> 4241</span>&#160;</div><div class="line"><a name="l04242"></a><span class="lineno"><a class="line" href="../../d0/d60/res__fax_8c.html#a20a88f0d3ef36ac1137ed08fd8e9f217"> 4242</a></span>&#160;<span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="../../d0/d60/res__fax_8c.html#a20a88f0d3ef36ac1137ed08fd8e9f217">fax_session_type</a>(<span class="keyword">struct</span> <a class="code" href="../../d1/d16/structast__fax__session.html">ast_fax_session</a> *s)</div><div class="line"><a name="l04243"></a><span class="lineno"> 4243</span>&#160;{</div><div class="line"><a name="l04244"></a><span class="lineno"> 4244</span>&#160;   <span class="keywordflow">if</span> (s-&gt;<a class="code" href="../../d1/d16/structast__fax__session.html#ae7b633178d301df70e8612b4ce1aeb77">details</a>-&gt;<a class="code" href="../../d8/dc2/structast__fax__session__details.html#ad75375cdd336e91cbcee4a829fcdabfe">caps</a> &amp; <a class="code" href="../../db/d6a/res__fax_8h.html#a54eb45ad548b874cf12d0a599631e3f6a76fa4111df51955a949e95fadbccd48b">AST_FAX_TECH_AUDIO</a>) {</div><div class="line"><a name="l04245"></a><span class="lineno"> 4245</span>&#160;      <span class="keywordflow">return</span> <span class="stringliteral">&quot;G.711&quot;</span>;</div><div class="line"><a name="l04246"></a><span class="lineno"> 4246</span>&#160;   }</div><div class="line"><a name="l04247"></a><span class="lineno"> 4247</span>&#160;   <span class="keywordflow">if</span> (s-&gt;<a class="code" href="../../d1/d16/structast__fax__session.html#ae7b633178d301df70e8612b4ce1aeb77">details</a>-&gt;<a class="code" href="../../d8/dc2/structast__fax__session__details.html#ad75375cdd336e91cbcee4a829fcdabfe">caps</a> &amp; <a class="code" href="../../db/d6a/res__fax_8h.html#a54eb45ad548b874cf12d0a599631e3f6a6868445e2802e5b71068ae883366f635">AST_FAX_TECH_T38</a>) {</div><div class="line"><a name="l04248"></a><span class="lineno"> 4248</span>&#160;      <span class="keywordflow">return</span> <span class="stringliteral">&quot;T.38&quot;</span>;</div><div class="line"><a name="l04249"></a><span class="lineno"> 4249</span>&#160;   }</div><div class="line"><a name="l04250"></a><span class="lineno"> 4250</span>&#160;</div><div class="line"><a name="l04251"></a><span class="lineno"> 4251</span>&#160;   <span class="keywordflow">return</span> <span class="stringliteral">&quot;none&quot;</span>;</div><div class="line"><a name="l04252"></a><span class="lineno"> 4252</span>&#160;}</div><div class="line"><a name="l04253"></a><span class="lineno"> 4253</span>&#160;</div><div class="line"><a name="l04254"></a><span class="lineno"><a class="line" href="../../d0/d60/res__fax_8c.html#a1b9314c7e94b0f3b703c975b0854519f"> 4254</a></span>&#160;<span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="../../d0/d60/res__fax_8c.html#a1b9314c7e94b0f3b703c975b0854519f">ast_fax_session_operation_str</a>(<span class="keyword">struct</span> <a class="code" href="../../d1/d16/structast__fax__session.html">ast_fax_session</a> *s)</div><div class="line"><a name="l04255"></a><span class="lineno"> 4255</span>&#160;{</div><div class="line"><a name="l04256"></a><span class="lineno"> 4256</span>&#160;   <span class="keywordflow">if</span> (s-&gt;<a class="code" href="../../d1/d16/structast__fax__session.html#ae7b633178d301df70e8612b4ce1aeb77">details</a>-&gt;<a class="code" href="../../d8/dc2/structast__fax__session__details.html#ad75375cdd336e91cbcee4a829fcdabfe">caps</a> &amp; <a class="code" href="../../db/d6a/res__fax_8h.html#a54eb45ad548b874cf12d0a599631e3f6add135550dca7400fb80e250a63a54887">AST_FAX_TECH_GATEWAY</a>) {</div><div class="line"><a name="l04257"></a><span class="lineno"> 4257</span>&#160;      <span class="keywordflow">return</span> <span class="stringliteral">&quot;gateway&quot;</span>;</div><div class="line"><a name="l04258"></a><span class="lineno"> 4258</span>&#160;   }</div><div class="line"><a name="l04259"></a><span class="lineno"> 4259</span>&#160;   <span class="keywordflow">if</span> (s-&gt;<a class="code" href="../../d1/d16/structast__fax__session.html#ae7b633178d301df70e8612b4ce1aeb77">details</a>-&gt;<a class="code" href="../../d8/dc2/structast__fax__session__details.html#ad75375cdd336e91cbcee4a829fcdabfe">caps</a> &amp; <a class="code" href="../../db/d6a/res__fax_8h.html#a54eb45ad548b874cf12d0a599631e3f6adbf07d8224b1a548ccae3b994653003b">AST_FAX_TECH_SEND</a>) {</div><div class="line"><a name="l04260"></a><span class="lineno"> 4260</span>&#160;      <span class="keywordflow">return</span> <span class="stringliteral">&quot;send&quot;</span>;</div><div class="line"><a name="l04261"></a><span class="lineno"> 4261</span>&#160;   }</div><div class="line"><a name="l04262"></a><span class="lineno"> 4262</span>&#160;   <span class="keywordflow">if</span> (s-&gt;<a class="code" href="../../d1/d16/structast__fax__session.html#ae7b633178d301df70e8612b4ce1aeb77">details</a>-&gt;<a class="code" href="../../d8/dc2/structast__fax__session__details.html#ad75375cdd336e91cbcee4a829fcdabfe">caps</a> &amp; <a class="code" href="../../db/d6a/res__fax_8h.html#a54eb45ad548b874cf12d0a599631e3f6a77bcc28b15614142ddbf4a180d263602">AST_FAX_TECH_RECEIVE</a>) {</div><div class="line"><a name="l04263"></a><span class="lineno"> 4263</span>&#160;      <span class="keywordflow">return</span> <span class="stringliteral">&quot;receive&quot;</span>;</div><div class="line"><a name="l04264"></a><span class="lineno"> 4264</span>&#160;   }</div><div class="line"><a name="l04265"></a><span class="lineno"> 4265</span>&#160;   <span class="keywordflow">if</span> (s-&gt;<a class="code" href="../../d1/d16/structast__fax__session.html#ae7b633178d301df70e8612b4ce1aeb77">details</a>-&gt;<a class="code" href="../../d8/dc2/structast__fax__session__details.html#ad75375cdd336e91cbcee4a829fcdabfe">caps</a> &amp; <a class="code" href="../../db/d6a/res__fax_8h.html#a54eb45ad548b874cf12d0a599631e3f6a9138c48a79016bfccdd7cee6197cb21c">AST_FAX_TECH_V21_DETECT</a>) {</div><div class="line"><a name="l04266"></a><span class="lineno"> 4266</span>&#160;      <span class="keywordflow">return</span> <span class="stringliteral">&quot;V.21&quot;</span>;</div><div class="line"><a name="l04267"></a><span class="lineno"> 4267</span>&#160;   }</div><div class="line"><a name="l04268"></a><span class="lineno"> 4268</span>&#160;</div><div class="line"><a name="l04269"></a><span class="lineno"> 4269</span>&#160;   <span class="keywordflow">return</span> <span class="stringliteral">&quot;none&quot;</span>;</div><div class="line"><a name="l04270"></a><span class="lineno"> 4270</span>&#160;}</div><div class="line"><a name="l04271"></a><span class="lineno"> 4271</span>&#160;<span class="comment"></span></div><div class="line"><a name="l04272"></a><span class="lineno"> 4272</span>&#160;<span class="comment">/*! \brief display fax sessions */</span></div><div class="line"><a name="l04273"></a><span class="lineno"><a class="line" href="../../d0/d60/res__fax_8c.html#abaa1897073e2e290097650bfbbe25d46"> 4273</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">char</span> *<a class="code" href="../../d0/d60/res__fax_8c.html#abaa1897073e2e290097650bfbbe25d46">cli_fax_show_sessions</a>(<span class="keyword">struct</span> <a class="code" href="../../d8/d07/structast__cli__entry.html">ast_cli_entry</a> *e, <span class="keywordtype">int</span> cmd, <span class="keyword">struct</span> <a class="code" href="../../d3/dad/structast__cli__args.html">ast_cli_args</a> *<a class="code" href="../../d7/d6f/test__linkedlists_8c.html#a13dd15487fee89a002d17ef3aff62d02">a</a>)</div><div class="line"><a name="l04274"></a><span class="lineno"> 4274</span>&#160;{</div><div class="line"><a name="l04275"></a><span class="lineno"> 4275</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d1/d16/structast__fax__session.html">ast_fax_session</a> *s;</div><div class="line"><a name="l04276"></a><span class="lineno"> 4276</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d9/d97/structao2__iterator.html">ao2_iterator</a> i;</div><div class="line"><a name="l04277"></a><span class="lineno"> 4277</span>&#160;   <span class="keywordtype">int</span> <a class="code" href="../../dd/d43/http_8c.html#a7aa5af3eb4d501b0c44c590507f751e8">session_count</a>;</div><div class="line"><a name="l04278"></a><span class="lineno"> 4278</span>&#160;   <span class="keywordtype">char</span> *filenames;</div><div class="line"><a name="l04279"></a><span class="lineno"> 4279</span>&#160;</div><div class="line"><a name="l04280"></a><span class="lineno"> 4280</span>&#160;   <span class="keywordflow">switch</span> (cmd) {</div><div class="line"><a name="l04281"></a><span class="lineno"> 4281</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="../../dc/db0/cli_8h.html#ab33e5350a923c3a8cedbeb496cd88ec9a71745eb63dd093f560a1add3e430d2a9">CLI_INIT</a>:</div><div class="line"><a name="l04282"></a><span class="lineno"> 4282</span>&#160;      e-&gt;<a class="code" href="../../d8/d07/structast__cli__entry.html#ade9cba72805fe52685a1deea307a8e82">command</a> = <span class="stringliteral">&quot;fax show sessions&quot;</span>;</div><div class="line"><a name="l04283"></a><span class="lineno"> 4283</span>&#160;      e-&gt;<a class="code" href="../../d8/d07/structast__cli__entry.html#aef1bd6ad890a110b466cb0e8088507a2">usage</a> =</div><div class="line"><a name="l04284"></a><span class="lineno"> 4284</span>&#160;         <span class="stringliteral">&quot;Usage: fax show sessions\n&quot;</span></div><div class="line"><a name="l04285"></a><span class="lineno"> 4285</span>&#160;         <span class="stringliteral">&quot;       Shows the current FAX sessions\n&quot;</span>;</div><div class="line"><a name="l04286"></a><span class="lineno"> 4286</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l04287"></a><span class="lineno"> 4287</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="../../dc/db0/cli_8h.html#ab33e5350a923c3a8cedbeb496cd88ec9a76bf33139279b03ec1691f2be2d1be40">CLI_GENERATE</a>:</div><div class="line"><a name="l04288"></a><span class="lineno"> 4288</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l04289"></a><span class="lineno"> 4289</span>&#160;   }</div><div class="line"><a name="l04290"></a><span class="lineno"> 4290</span>&#160;</div><div class="line"><a name="l04291"></a><span class="lineno"> 4291</span>&#160;   <a class="code" href="../../dc/db0/cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#acf64f219885421479997667d2ed3f08a">fd</a>, <span class="stringliteral">&quot;\nCurrent FAX Sessions:\n\n&quot;</span>);</div><div class="line"><a name="l04292"></a><span class="lineno"> 4292</span>&#160;   <a class="code" href="../../dc/db0/cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#acf64f219885421479997667d2ed3f08a">fd</a>, <span class="stringliteral">&quot;%-30.30s %-10.10s %-10.10s %-5.5s %-10.10s %-15.15s %-30.30s\n&quot;</span>,</div><div class="line"><a name="l04293"></a><span class="lineno"> 4293</span>&#160;      <span class="stringliteral">&quot;Channel&quot;</span>, <span class="stringliteral">&quot;Tech&quot;</span>, <span class="stringliteral">&quot;FAXID&quot;</span>, <span class="stringliteral">&quot;Type&quot;</span>, <span class="stringliteral">&quot;Operation&quot;</span>, <span class="stringliteral">&quot;State&quot;</span>, <span class="stringliteral">&quot;File(s)&quot;</span>);</div><div class="line"><a name="l04294"></a><span class="lineno"> 4294</span>&#160;   i = <a class="code" href="../../d5/da5/astobj2_8h.html#a91d5d37d00874ae7a92d1a15c0a3b3a6">ao2_iterator_init</a>(<a class="code" href="../../d0/d60/res__fax_8c.html#a058b6772fcfe1ce5a1a0957e2f11d367">faxregistry</a>.container, 0);</div><div class="line"><a name="l04295"></a><span class="lineno"> 4295</span>&#160;   <span class="keywordflow">while</span> ((s = <a class="code" href="../../d5/da5/astobj2_8h.html#a17990ea630db7dbd1252ef0132133a2b">ao2_iterator_next</a>(&amp;i))) {</div><div class="line"><a name="l04296"></a><span class="lineno"> 4296</span>&#160;      <a class="code" href="../../d5/da5/astobj2_8h.html#aa9fdb5d0a6157a56060d9f7279fe6c49">ao2_lock</a>(s);</div><div class="line"><a name="l04297"></a><span class="lineno"> 4297</span>&#160;</div><div class="line"><a name="l04298"></a><span class="lineno"> 4298</span>&#160;      filenames = <a class="code" href="../../d0/d60/res__fax_8c.html#aea322d9ee9a565a0f53e6fa1f1f34e66">generate_filenames_string</a>(s-&gt;<a class="code" href="../../d1/d16/structast__fax__session.html#ae7b633178d301df70e8612b4ce1aeb77">details</a>, <span class="stringliteral">&quot;&quot;</span>, <span class="stringliteral">&quot;, &quot;</span>);</div><div class="line"><a name="l04299"></a><span class="lineno"> 4299</span>&#160;</div><div class="line"><a name="l04300"></a><span class="lineno"> 4300</span>&#160;      <a class="code" href="../../dc/db0/cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#acf64f219885421479997667d2ed3f08a">fd</a>, <span class="stringliteral">&quot;%-30.30s %-10.10s %-10u %-5.5s %-10.10s %-15.15s %-30s\n&quot;</span>,</div><div class="line"><a name="l04301"></a><span class="lineno"> 4301</span>&#160;         s-&gt;<a class="code" href="../../d1/d16/structast__fax__session.html#a9f716886b5b2a50ad6d2b9119502b152">channame</a>, s-&gt;<a class="code" href="../../d1/d16/structast__fax__session.html#a4ac6ff3775e67c710cd55bc7dfd592fe">tech</a>-&gt;<a class="code" href="../../d9/d0e/structast__fax__tech.html#a8ff938fb2f815be425fd2859a21e6d61">type</a>, s-&gt;<a class="code" href="../../d1/d16/structast__fax__session.html#ab7ce6f462afaf105224b0ca772a33c43">id</a>,</div><div class="line"><a name="l04302"></a><span class="lineno"> 4302</span>&#160;         <a class="code" href="../../d0/d60/res__fax_8c.html#a20a88f0d3ef36ac1137ed08fd8e9f217">fax_session_type</a>(s),</div><div class="line"><a name="l04303"></a><span class="lineno"> 4303</span>&#160;         <a class="code" href="../../d0/d60/res__fax_8c.html#a1b9314c7e94b0f3b703c975b0854519f">ast_fax_session_operation_str</a>(s),</div><div class="line"><a name="l04304"></a><span class="lineno"> 4304</span>&#160;         <a class="code" href="../../d0/d60/res__fax_8c.html#a70598462f8d1c09bb43e7a7091498e53">ast_fax_state_to_str</a>(s-&gt;<a class="code" href="../../d1/d16/structast__fax__session.html#ad8f346e1752edcc0b1a6b431b1749f0e">state</a>), <a class="code" href="../../d6/d90/strings_8h.html#a2faaa16929951bfd2802b7829a100ba2">S_OR</a>(filenames, <span class="stringliteral">&quot;&quot;</span>));</div><div class="line"><a name="l04305"></a><span class="lineno"> 4305</span>&#160;</div><div class="line"><a name="l04306"></a><span class="lineno"> 4306</span>&#160;      <a class="code" href="../../d8/d8a/astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(filenames);</div><div class="line"><a name="l04307"></a><span class="lineno"> 4307</span>&#160;      <a class="code" href="../../d5/da5/astobj2_8h.html#a9998bd156b936636a8780385e9a910b2">ao2_unlock</a>(s);</div><div class="line"><a name="l04308"></a><span class="lineno"> 4308</span>&#160;      <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(s, -1);</div><div class="line"><a name="l04309"></a><span class="lineno"> 4309</span>&#160;   }</div><div class="line"><a name="l04310"></a><span class="lineno"> 4310</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#ad36841ab6daa3997f7ca7047ad2d033a">ao2_iterator_destroy</a>(&amp;i);</div><div class="line"><a name="l04311"></a><span class="lineno"> 4311</span>&#160;   session_count = <a class="code" href="../../d5/da5/astobj2_8h.html#a512cc40ce96c63b3d5c78040baa4c9cd">ao2_container_count</a>(<a class="code" href="../../d0/d60/res__fax_8c.html#a058b6772fcfe1ce5a1a0957e2f11d367">faxregistry</a>.container);</div><div class="line"><a name="l04312"></a><span class="lineno"> 4312</span>&#160;   <a class="code" href="../../dc/db0/cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a>(a-&gt;<a class="code" href="../../d3/dad/structast__cli__args.html#acf64f219885421479997667d2ed3f08a">fd</a>, <span class="stringliteral">&quot;\n%d FAX sessions\n\n&quot;</span>, session_count);</div><div class="line"><a name="l04313"></a><span class="lineno"> 4313</span>&#160;</div><div class="line"><a name="l04314"></a><span class="lineno"> 4314</span>&#160;   <span class="keywordflow">return</span> <a class="code" href="../../dc/db0/cli_8h.html#a50989f00b32eeb2516a3803cb2ffb766">CLI_SUCCESS</a>;</div><div class="line"><a name="l04315"></a><span class="lineno"> 4315</span>&#160;}</div><div class="line"><a name="l04316"></a><span class="lineno"> 4316</span>&#160;</div><div class="line"><a name="l04317"></a><span class="lineno"><a class="line" href="../../d0/d60/res__fax_8c.html#a099616a85b16965265642eae545d12ac"> 4317</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d0/d60/res__fax_8c.html#a099616a85b16965265642eae545d12ac">manager_fax_sessions_entry</a>(<span class="keyword">struct</span> <a class="code" href="../../d2/d8a/structmansession.html">mansession</a> *s,</div><div class="line"><a name="l04318"></a><span class="lineno"> 4318</span>&#160;   <span class="keyword">struct</span> <a class="code" href="../../d1/d16/structast__fax__session.html">ast_fax_session</a> *<a class="code" href="../../d2/d4d/astman_8c.html#ac4a6ae0400e4457f0b35beddec80c93d">session</a>, <span class="keyword">const</span> <span class="keywordtype">char</span> *id_text)</div><div class="line"><a name="l04319"></a><span class="lineno"> 4319</span>&#160;{</div><div class="line"><a name="l04320"></a><span class="lineno"> 4320</span>&#160;   <span class="keywordtype">char</span> *filenames;</div><div class="line"><a name="l04321"></a><span class="lineno"> 4321</span>&#160;</div><div class="line"><a name="l04322"></a><span class="lineno"> 4322</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#aa9fdb5d0a6157a56060d9f7279fe6c49">ao2_lock</a>(session);</div><div class="line"><a name="l04323"></a><span class="lineno"> 4323</span>&#160;   filenames = <a class="code" href="../../d0/d60/res__fax_8c.html#aea322d9ee9a565a0f53e6fa1f1f34e66">generate_filenames_string</a>(session-&gt;<a class="code" href="../../d1/d16/structast__fax__session.html#ae7b633178d301df70e8612b4ce1aeb77">details</a>, <span class="stringliteral">&quot;&quot;</span>, <span class="stringliteral">&quot;,&quot;</span>);</div><div class="line"><a name="l04324"></a><span class="lineno"> 4324</span>&#160;</div><div class="line"><a name="l04325"></a><span class="lineno"> 4325</span>&#160;   <span class="keywordflow">if</span> (!filenames) {</div><div class="line"><a name="l04326"></a><span class="lineno"> 4326</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Error generating Files string&quot;</span>);</div><div class="line"><a name="l04327"></a><span class="lineno"> 4327</span>&#160;      <a class="code" href="../../d5/da5/astobj2_8h.html#a9998bd156b936636a8780385e9a910b2">ao2_unlock</a>(session);</div><div class="line"><a name="l04328"></a><span class="lineno"> 4328</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l04329"></a><span class="lineno"> 4329</span>&#160;   }</div><div class="line"><a name="l04330"></a><span class="lineno"> 4330</span>&#160;</div><div class="line"><a name="l04331"></a><span class="lineno"> 4331</span>&#160;   <a class="code" href="../../df/d72/group__Group__AMI.html#gac2d42f7be13c532b6a70d50f1b8983d2">astman_append</a>(s, <span class="stringliteral">&quot;Event: FAXSessionsEntry\r\n&quot;</span></div><div class="line"><a name="l04332"></a><span class="lineno"> 4332</span>&#160;      <span class="stringliteral">&quot;%s&quot;</span> <span class="comment">/* ActionID if present */</span></div><div class="line"><a name="l04333"></a><span class="lineno"> 4333</span>&#160;      <span class="stringliteral">&quot;Channel: %s\r\n&quot;</span> <span class="comment">/* Channel name */</span></div><div class="line"><a name="l04334"></a><span class="lineno"> 4334</span>&#160;      <span class="stringliteral">&quot;Technology: %s\r\n&quot;</span> <span class="comment">/* Fax session technology */</span></div><div class="line"><a name="l04335"></a><span class="lineno"> 4335</span>&#160;      <span class="stringliteral">&quot;SessionNumber: %u\r\n&quot;</span> <span class="comment">/* Session ID */</span></div><div class="line"><a name="l04336"></a><span class="lineno"> 4336</span>&#160;      <span class="stringliteral">&quot;SessionType: %s\r\n&quot;</span> <span class="comment">/* G711 or T38 */</span></div><div class="line"><a name="l04337"></a><span class="lineno"> 4337</span>&#160;      <span class="stringliteral">&quot;Operation: %s\r\n&quot;</span></div><div class="line"><a name="l04338"></a><span class="lineno"> 4338</span>&#160;      <span class="stringliteral">&quot;State: %s\r\n&quot;</span></div><div class="line"><a name="l04339"></a><span class="lineno"> 4339</span>&#160;      <span class="stringliteral">&quot;Files: %s\r\n&quot;</span></div><div class="line"><a name="l04340"></a><span class="lineno"> 4340</span>&#160;      <span class="stringliteral">&quot;\r\n&quot;</span>,</div><div class="line"><a name="l04341"></a><span class="lineno"> 4341</span>&#160;      id_text, session-&gt;<a class="code" href="../../d1/d16/structast__fax__session.html#a9f716886b5b2a50ad6d2b9119502b152">channame</a>, session-&gt;<a class="code" href="../../d1/d16/structast__fax__session.html#a4ac6ff3775e67c710cd55bc7dfd592fe">tech</a>-&gt;<a class="code" href="../../d9/d0e/structast__fax__tech.html#a8ff938fb2f815be425fd2859a21e6d61">type</a>, session-&gt;<a class="code" href="../../d1/d16/structast__fax__session.html#ab7ce6f462afaf105224b0ca772a33c43">id</a>,</div><div class="line"><a name="l04342"></a><span class="lineno"> 4342</span>&#160;      <a class="code" href="../../d0/d60/res__fax_8c.html#a20a88f0d3ef36ac1137ed08fd8e9f217">fax_session_type</a>(session), <a class="code" href="../../d0/d60/res__fax_8c.html#a1b9314c7e94b0f3b703c975b0854519f">ast_fax_session_operation_str</a>(session),</div><div class="line"><a name="l04343"></a><span class="lineno"> 4343</span>&#160;      <a class="code" href="../../d0/d60/res__fax_8c.html#a70598462f8d1c09bb43e7a7091498e53">ast_fax_state_to_str</a>(session-&gt;<a class="code" href="../../d1/d16/structast__fax__session.html#ad8f346e1752edcc0b1a6b431b1749f0e">state</a>), <a class="code" href="../../d6/d90/strings_8h.html#a2faaa16929951bfd2802b7829a100ba2">S_OR</a>(filenames, <span class="stringliteral">&quot;&quot;</span>));</div><div class="line"><a name="l04344"></a><span class="lineno"> 4344</span>&#160;   <a class="code" href="../../d8/d8a/astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(filenames);</div><div class="line"><a name="l04345"></a><span class="lineno"> 4345</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#a9998bd156b936636a8780385e9a910b2">ao2_unlock</a>(session);</div><div class="line"><a name="l04346"></a><span class="lineno"> 4346</span>&#160;   <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l04347"></a><span class="lineno"> 4347</span>&#160;}</div><div class="line"><a name="l04348"></a><span class="lineno"> 4348</span>&#160;</div><div class="line"><a name="l04349"></a><span class="lineno"><a class="line" href="../../d0/d60/res__fax_8c.html#af31af245716f15330db91e03ef9cfe15"> 4349</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d0/d60/res__fax_8c.html#af31af245716f15330db91e03ef9cfe15">manager_fax_sessions</a>(<span class="keyword">struct</span> <a class="code" href="../../d2/d8a/structmansession.html">mansession</a> *s, <span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="../../d8/d9e/structmessage.html">message</a> *m)</div><div class="line"><a name="l04350"></a><span class="lineno"> 4350</span>&#160;{</div><div class="line"><a name="l04351"></a><span class="lineno"> 4351</span>&#160;   <span class="keyword">const</span> <span class="keywordtype">char</span> *action_id = <a class="code" href="../../df/d72/group__Group__AMI.html#gac6a9f3498f9afffecfd78c485af41556">astman_get_header</a>(m, <span class="stringliteral">&quot;ActionID&quot;</span>);</div><div class="line"><a name="l04352"></a><span class="lineno"> 4352</span>&#160;   <span class="keywordtype">char</span> id_text[256];</div><div class="line"><a name="l04353"></a><span class="lineno"> 4353</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d1/d16/structast__fax__session.html">ast_fax_session</a> *<a class="code" href="../../d2/d4d/astman_8c.html#ac4a6ae0400e4457f0b35beddec80c93d">session</a>;</div><div class="line"><a name="l04354"></a><span class="lineno"> 4354</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d9/d97/structao2__iterator.html">ao2_iterator</a> iter;</div><div class="line"><a name="l04355"></a><span class="lineno"> 4355</span>&#160;   <span class="keywordtype">int</span> <a class="code" href="../../dd/d43/http_8c.html#a7aa5af3eb4d501b0c44c590507f751e8">session_count</a> = 0;</div><div class="line"><a name="l04356"></a><span class="lineno"> 4356</span>&#160;</div><div class="line"><a name="l04357"></a><span class="lineno"> 4357</span>&#160;   id_text[0] = <span class="charliteral">&#39;\0&#39;</span>;</div><div class="line"><a name="l04358"></a><span class="lineno"> 4358</span>&#160;   <span class="keywordflow">if</span> (!<a class="code" href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a>(action_id)) {</div><div class="line"><a name="l04359"></a><span class="lineno"> 4359</span>&#160;      snprintf(id_text, <span class="keyword">sizeof</span>(id_text), <span class="stringliteral">&quot;ActionID: %s\r\n&quot;</span>, action_id);</div><div class="line"><a name="l04360"></a><span class="lineno"> 4360</span>&#160;   }</div><div class="line"><a name="l04361"></a><span class="lineno"> 4361</span>&#160;</div><div class="line"><a name="l04362"></a><span class="lineno"> 4362</span>&#160;   <a class="code" href="../../df/d72/group__Group__AMI.html#ga0ee6ee1f4d200f711e2983bffe770a72">astman_send_listack</a>(s, m, <span class="stringliteral">&quot;FAXSessionsEntry event list will follow&quot;</span>, <span class="stringliteral">&quot;Start&quot;</span>);</div><div class="line"><a name="l04363"></a><span class="lineno"> 4363</span>&#160;</div><div class="line"><a name="l04364"></a><span class="lineno"> 4364</span>&#160;   iter = <a class="code" href="../../d5/da5/astobj2_8h.html#a91d5d37d00874ae7a92d1a15c0a3b3a6">ao2_iterator_init</a>(<a class="code" href="../../d0/d60/res__fax_8c.html#a058b6772fcfe1ce5a1a0957e2f11d367">faxregistry</a>.container, 0);</div><div class="line"><a name="l04365"></a><span class="lineno"> 4365</span>&#160;   <span class="keywordflow">while</span> ((session = <a class="code" href="../../d5/da5/astobj2_8h.html#a17990ea630db7dbd1252ef0132133a2b">ao2_iterator_next</a>(&amp;iter))) {</div><div class="line"><a name="l04366"></a><span class="lineno"> 4366</span>&#160;      <span class="keywordflow">if</span> (!<a class="code" href="../../d0/d60/res__fax_8c.html#a099616a85b16965265642eae545d12ac">manager_fax_sessions_entry</a>(s, session, id_text)) {</div><div class="line"><a name="l04367"></a><span class="lineno"> 4367</span>&#160;         session_count++;</div><div class="line"><a name="l04368"></a><span class="lineno"> 4368</span>&#160;      }</div><div class="line"><a name="l04369"></a><span class="lineno"> 4369</span>&#160;      <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(session, -1);</div><div class="line"><a name="l04370"></a><span class="lineno"> 4370</span>&#160;   }</div><div class="line"><a name="l04371"></a><span class="lineno"> 4371</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#ad36841ab6daa3997f7ca7047ad2d033a">ao2_iterator_destroy</a>(&amp;iter);</div><div class="line"><a name="l04372"></a><span class="lineno"> 4372</span>&#160;</div><div class="line"><a name="l04373"></a><span class="lineno"> 4373</span>&#160;   <a class="code" href="../../df/d72/group__Group__AMI.html#ga58c3e3da5d31739cafaee1df6ddf9342">astman_send_list_complete_start</a>(s, m, <span class="stringliteral">&quot;FAXSessionsComplete&quot;</span>, session_count);</div><div class="line"><a name="l04374"></a><span class="lineno"> 4374</span>&#160;   <a class="code" href="../../df/d72/group__Group__AMI.html#gac2d42f7be13c532b6a70d50f1b8983d2">astman_append</a>(s, <span class="stringliteral">&quot;Total: %d\r\n&quot;</span>, session_count);</div><div class="line"><a name="l04375"></a><span class="lineno"> 4375</span>&#160;   <a class="code" href="../../df/d72/group__Group__AMI.html#gabf7c909efbfc26d0d9c66786c83b8f69">astman_send_list_complete_end</a>(s);</div><div class="line"><a name="l04376"></a><span class="lineno"> 4376</span>&#160;</div><div class="line"><a name="l04377"></a><span class="lineno"> 4377</span>&#160;   <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l04378"></a><span class="lineno"> 4378</span>&#160;}</div><div class="line"><a name="l04379"></a><span class="lineno"> 4379</span>&#160;</div><div class="line"><a name="l04380"></a><span class="lineno"><a class="line" href="../../d0/d60/res__fax_8c.html#ae6ba3a7d00a9db8c29509bda24c233f1"> 4380</a></span>&#160;<span class="keyword">static</span> <span class="keyword">struct </span><a class="code" href="../../d8/d07/structast__cli__entry.html">ast_cli_entry</a> <a class="code" href="../../d0/d60/res__fax_8c.html#ae6ba3a7d00a9db8c29509bda24c233f1">fax_cli</a>[] = {</div><div class="line"><a name="l04381"></a><span class="lineno"> 4381</span>&#160;   <a class="code" href="../../dc/db0/cli_8h.html#a5c4130cf8f1e93acfdd84416cebf1aef">AST_CLI_DEFINE</a>(<a class="code" href="../../d0/d60/res__fax_8c.html#a1d2f98b9f7e7f3a8217c9afa7f1915a2">cli_fax_show_version</a>, <span class="stringliteral">&quot;Show versions of FAX For Asterisk components&quot;</span>),</div><div class="line"><a name="l04382"></a><span class="lineno"> 4382</span>&#160;   <a class="code" href="../../dc/db0/cli_8h.html#a5c4130cf8f1e93acfdd84416cebf1aef">AST_CLI_DEFINE</a>(<a class="code" href="../../d0/d60/res__fax_8c.html#a38ce372560eb0b88386f1249c0e1e576">cli_fax_set_debug</a>, <span class="stringliteral">&quot;Enable/Disable FAX debugging on new FAX sessions&quot;</span>),</div><div class="line"><a name="l04383"></a><span class="lineno"> 4383</span>&#160;   <a class="code" href="../../dc/db0/cli_8h.html#a5c4130cf8f1e93acfdd84416cebf1aef">AST_CLI_DEFINE</a>(<a class="code" href="../../d0/d60/res__fax_8c.html#aa3abd8d044003f1086e5b07a357f82fb">cli_fax_show_capabilities</a>, <span class="stringliteral">&quot;Show the capabilities of the registered FAX technology modules&quot;</span>),</div><div class="line"><a name="l04384"></a><span class="lineno"> 4384</span>&#160;   <a class="code" href="../../dc/db0/cli_8h.html#a5c4130cf8f1e93acfdd84416cebf1aef">AST_CLI_DEFINE</a>(<a class="code" href="../../d0/d60/res__fax_8c.html#a3c172ffb404f992210517ac86cfc7a1a">cli_fax_show_settings</a>, <span class="stringliteral">&quot;Show the global settings and defaults of both the FAX core and technology modules&quot;</span>),</div><div class="line"><a name="l04385"></a><span class="lineno"> 4385</span>&#160;   <a class="code" href="../../dc/db0/cli_8h.html#a5c4130cf8f1e93acfdd84416cebf1aef">AST_CLI_DEFINE</a>(<a class="code" href="../../d0/d60/res__fax_8c.html#aac8f65ba9ce0d6ea865b98cc415003cf">cli_fax_show_session</a>, <span class="stringliteral">&quot;Show the status of the named FAX sessions&quot;</span>),</div><div class="line"><a name="l04386"></a><span class="lineno"> 4386</span>&#160;   <a class="code" href="../../dc/db0/cli_8h.html#a5c4130cf8f1e93acfdd84416cebf1aef">AST_CLI_DEFINE</a>(<a class="code" href="../../d0/d60/res__fax_8c.html#abaa1897073e2e290097650bfbbe25d46">cli_fax_show_sessions</a>, <span class="stringliteral">&quot;Show the current FAX sessions&quot;</span>),</div><div class="line"><a name="l04387"></a><span class="lineno"> 4387</span>&#160;   <a class="code" href="../../dc/db0/cli_8h.html#a5c4130cf8f1e93acfdd84416cebf1aef">AST_CLI_DEFINE</a>(<a class="code" href="../../d0/d60/res__fax_8c.html#a00b75aa8e0cf805cdf2ad917351e0a1e">cli_fax_show_stats</a>, <span class="stringliteral">&quot;Summarize FAX session history&quot;</span>),</div><div class="line"><a name="l04388"></a><span class="lineno"> 4388</span>&#160;};</div><div class="line"><a name="l04389"></a><span class="lineno"> 4389</span>&#160;</div><div class="line"><a name="l04390"></a><span class="lineno"><a class="line" href="../../d0/d60/res__fax_8c.html#a235464080ba7708ab425f6074d9a2bda"> 4390</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d0/d60/res__fax_8c.html#a235464080ba7708ab425f6074d9a2bda">set_general_options</a>(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="../../d0/d28/structfax__options.html">fax_options</a> *<a class="code" href="../../d4/d45/test__http__media__cache_8c.html#a80c8e3ae5087d90d422675d034eeebc7">options</a>)</div><div class="line"><a name="l04391"></a><span class="lineno"> 4391</span>&#160;{</div><div class="line"><a name="l04392"></a><span class="lineno"> 4392</span>&#160;   <a class="code" href="../../dd/d42/lock_8h.html#a045bd81ceab2de81e42af338ad7cf121">ast_rwlock_wrlock</a>(&amp;<a class="code" href="../../d0/d60/res__fax_8c.html#a75acaa938bee74395e4decb810ab7789">options_lock</a>);</div><div class="line"><a name="l04393"></a><span class="lineno"> 4393</span>&#160;   <a class="code" href="../../d0/d60/res__fax_8c.html#affdd90b9debbbb9add90b87c27b38de0">general_options</a> = *<a class="code" href="../../d4/d45/test__http__media__cache_8c.html#a80c8e3ae5087d90d422675d034eeebc7">options</a>;</div><div class="line"><a name="l04394"></a><span class="lineno"> 4394</span>&#160;   <a class="code" href="../../dd/d42/lock_8h.html#ac2920a1db37313ec46bd91dc83bf9c8a">ast_rwlock_unlock</a>(&amp;<a class="code" href="../../d0/d60/res__fax_8c.html#a75acaa938bee74395e4decb810ab7789">options_lock</a>);</div><div class="line"><a name="l04395"></a><span class="lineno"> 4395</span>&#160;}</div><div class="line"><a name="l04396"></a><span class="lineno"> 4396</span>&#160;</div><div class="line"><a name="l04397"></a><span class="lineno"><a class="line" href="../../d0/d60/res__fax_8c.html#aa4691aa21eb58ad524c6418d9f252b7d"> 4397</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d0/d60/res__fax_8c.html#aa4691aa21eb58ad524c6418d9f252b7d">get_general_options</a>(<span class="keyword">struct</span> <a class="code" href="../../d0/d28/structfax__options.html">fax_options</a> *<a class="code" href="../../d4/d45/test__http__media__cache_8c.html#a80c8e3ae5087d90d422675d034eeebc7">options</a>)</div><div class="line"><a name="l04398"></a><span class="lineno"> 4398</span>&#160;{</div><div class="line"><a name="l04399"></a><span class="lineno"> 4399</span>&#160;   <a class="code" href="../../dd/d42/lock_8h.html#a7330ac9d36b05bad68b188c2dcfa42d7">ast_rwlock_rdlock</a>(&amp;<a class="code" href="../../d0/d60/res__fax_8c.html#a75acaa938bee74395e4decb810ab7789">options_lock</a>);</div><div class="line"><a name="l04400"></a><span class="lineno"> 4400</span>&#160;   *options = <a class="code" href="../../d0/d60/res__fax_8c.html#affdd90b9debbbb9add90b87c27b38de0">general_options</a>;</div><div class="line"><a name="l04401"></a><span class="lineno"> 4401</span>&#160;   <a class="code" href="../../dd/d42/lock_8h.html#ac2920a1db37313ec46bd91dc83bf9c8a">ast_rwlock_unlock</a>(&amp;<a class="code" href="../../d0/d60/res__fax_8c.html#a75acaa938bee74395e4decb810ab7789">options_lock</a>);</div><div class="line"><a name="l04402"></a><span class="lineno"> 4402</span>&#160;}</div><div class="line"><a name="l04403"></a><span class="lineno"> 4403</span>&#160;</div><div class="line"><a name="l04404"></a><span class="lineno"><a class="line" href="../../d0/d60/res__fax_8c.html#a6768093d6a4ce21f6b3b18bad24c5ee2"> 4404</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d0/d60/res__fax_8c.html#a6768093d6a4ce21f6b3b18bad24c5ee2">set_t38timeout</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="../../d4/d2f/syslog_8c.html#ac4f474c82e82cbb89ca7c36dd52be0ed">value</a>, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> *t38timeout)</div><div class="line"><a name="l04405"></a><span class="lineno"> 4405</span>&#160;{</div><div class="line"><a name="l04406"></a><span class="lineno"> 4406</span>&#160;   <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="../../d0/d29/cdr__mysql_8c.html#a493b57f443cc38b3d3df9c1e584d9d82">timeout</a>;</div><div class="line"><a name="l04407"></a><span class="lineno"> 4407</span>&#160;</div><div class="line"><a name="l04408"></a><span class="lineno"> 4408</span>&#160;   <span class="keywordflow">if</span> (sscanf(value, <span class="stringliteral">&quot;%u&quot;</span>, &amp;timeout) != 1) {</div><div class="line"><a name="l04409"></a><span class="lineno"> 4409</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Unable to get timeout from &#39;%s&#39;\n&quot;</span>, value);</div><div class="line"><a name="l04410"></a><span class="lineno"> 4410</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l04411"></a><span class="lineno"> 4411</span>&#160;   } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (timeout) {</div><div class="line"><a name="l04412"></a><span class="lineno"> 4412</span>&#160;      *t38timeout = <a class="code" href="../../d0/d29/cdr__mysql_8c.html#a493b57f443cc38b3d3df9c1e584d9d82">timeout</a>;</div><div class="line"><a name="l04413"></a><span class="lineno"> 4413</span>&#160;   } <span class="keywordflow">else</span> {</div><div class="line"><a name="l04414"></a><span class="lineno"> 4414</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;T.38 negotiation timeout must be non-zero\n&quot;</span>);</div><div class="line"><a name="l04415"></a><span class="lineno"> 4415</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l04416"></a><span class="lineno"> 4416</span>&#160;   }</div><div class="line"><a name="l04417"></a><span class="lineno"> 4417</span>&#160;</div><div class="line"><a name="l04418"></a><span class="lineno"> 4418</span>&#160;   <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l04419"></a><span class="lineno"> 4419</span>&#160;}</div><div class="line"><a name="l04420"></a><span class="lineno"> 4420</span>&#160;<span class="comment"></span></div><div class="line"><a name="l04421"></a><span class="lineno"> 4421</span>&#160;<span class="comment">/*! \brief configure res_fax */</span></div><div class="line"><a name="l04422"></a><span class="lineno"><a class="line" href="../../d0/d60/res__fax_8c.html#a87b3eecb05c2a57012c6589329751a40"> 4422</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d0/d60/res__fax_8c.html#a87b3eecb05c2a57012c6589329751a40">set_config</a>(<span class="keywordtype">int</span> <a class="code" href="../../d0/d29/cdr__mysql_8c.html#ad1982509765f4870f1f63412a53ea668">reload</a>)</div><div class="line"><a name="l04423"></a><span class="lineno"> 4423</span>&#160;{</div><div class="line"><a name="l04424"></a><span class="lineno"> 4424</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../dd/d18/structast__config.html">ast_config</a> *cfg;</div><div class="line"><a name="l04425"></a><span class="lineno"> 4425</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../dd/d02/structast__variable.html">ast_variable</a> *v;</div><div class="line"><a name="l04426"></a><span class="lineno"> 4426</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../dc/dac/structast__flags.html">ast_flags</a> config_flags = { reload ? <a class="code" href="../../d3/de6/include_2asterisk_2config_8h.html#a103e76ed4bd42f776f7f260080b98b3fafa887389dc380bbdcffb65fec379f037">CONFIG_FLAG_FILEUNCHANGED</a> : 0 };</div><div class="line"><a name="l04427"></a><span class="lineno"> 4427</span>&#160;   <span class="keywordtype">char</span> modems[128] = <span class="stringliteral">&quot;&quot;</span>;</div><div class="line"><a name="l04428"></a><span class="lineno"> 4428</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d0/d28/structfax__options.html">fax_options</a> options;</div><div class="line"><a name="l04429"></a><span class="lineno"> 4429</span>&#160;   <span class="keywordtype">int</span> res = 0;</div><div class="line"><a name="l04430"></a><span class="lineno"> 4430</span>&#160;</div><div class="line"><a name="l04431"></a><span class="lineno"> 4431</span>&#160;   options = <a class="code" href="../../d0/d60/res__fax_8c.html#a4ca79c149a1ff5fdc17dbce18e8371f8">default_options</a>;</div><div class="line"><a name="l04432"></a><span class="lineno"> 4432</span>&#160;</div><div class="line"><a name="l04433"></a><span class="lineno"> 4433</span>&#160;   <span class="comment">/* When we&#39;re not reloading, we have to be certain to set the general options</span></div><div class="line"><a name="l04434"></a><span class="lineno"> 4434</span>&#160;<span class="comment">    * to the defaults in case config loading goes wrong at some point. On a reload,</span></div><div class="line"><a name="l04435"></a><span class="lineno"> 4435</span>&#160;<span class="comment">    * the general options need to stay the same as what they were prior to the</span></div><div class="line"><a name="l04436"></a><span class="lineno"> 4436</span>&#160;<span class="comment">    * reload rather than being reset to the defaults.</span></div><div class="line"><a name="l04437"></a><span class="lineno"> 4437</span>&#160;<span class="comment">    */</span></div><div class="line"><a name="l04438"></a><span class="lineno"> 4438</span>&#160;   <span class="keywordflow">if</span> (!reload) {</div><div class="line"><a name="l04439"></a><span class="lineno"> 4439</span>&#160;      <a class="code" href="../../d0/d60/res__fax_8c.html#a235464080ba7708ab425f6074d9a2bda">set_general_options</a>(&amp;options);</div><div class="line"><a name="l04440"></a><span class="lineno"> 4440</span>&#160;   }</div><div class="line"><a name="l04441"></a><span class="lineno"> 4441</span>&#160;</div><div class="line"><a name="l04442"></a><span class="lineno"> 4442</span>&#160;   <span class="comment">/* read configuration */</span></div><div class="line"><a name="l04443"></a><span class="lineno"> 4443</span>&#160;   <span class="keywordflow">if</span> (!(cfg = <a class="code" href="../../d3/de6/include_2asterisk_2config_8h.html#aab3eac8fa82a86a93c074deb7b77dbc9">ast_config_load2</a>(<a class="code" href="../../d0/d60/res__fax_8c.html#a65e5109273690c9fa64f70d4860c6647">config</a>, <span class="stringliteral">&quot;res_fax&quot;</span>, config_flags))) {</div><div class="line"><a name="l04444"></a><span class="lineno"> 4444</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#ad89ee324d180cdcd7defcc709ff9ca42">LOG_NOTICE</a>, <span class="stringliteral">&quot;Configuration file &#39;%s&#39; not found, %s options.\n&quot;</span>,</div><div class="line"><a name="l04445"></a><span class="lineno"> 4445</span>&#160;            <a class="code" href="../../d0/d60/res__fax_8c.html#a65e5109273690c9fa64f70d4860c6647">config</a>, reload ? <span class="stringliteral">&quot;not changing&quot;</span> : <span class="stringliteral">&quot;using default&quot;</span>);</div><div class="line"><a name="l04446"></a><span class="lineno"> 4446</span>&#160;      <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l04447"></a><span class="lineno"> 4447</span>&#160;   }</div><div class="line"><a name="l04448"></a><span class="lineno"> 4448</span>&#160;</div><div class="line"><a name="l04449"></a><span class="lineno"> 4449</span>&#160;   <span class="keywordflow">if</span> (cfg == <a class="code" href="../../d3/de6/include_2asterisk_2config_8h.html#a8d1a63cdf2c7aff22a77b6e75d93b377">CONFIG_STATUS_FILEINVALID</a>) {</div><div class="line"><a name="l04450"></a><span class="lineno"> 4450</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#ad89ee324d180cdcd7defcc709ff9ca42">LOG_NOTICE</a>, <span class="stringliteral">&quot;Configuration file &#39;%s&#39; is invalid, %s options.\n&quot;</span>,</div><div class="line"><a name="l04451"></a><span class="lineno"> 4451</span>&#160;            <a class="code" href="../../d0/d60/res__fax_8c.html#a65e5109273690c9fa64f70d4860c6647">config</a>, reload ? <span class="stringliteral">&quot;not changing&quot;</span> : <span class="stringliteral">&quot;using default&quot;</span>);</div><div class="line"><a name="l04452"></a><span class="lineno"> 4452</span>&#160;      <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l04453"></a><span class="lineno"> 4453</span>&#160;   }</div><div class="line"><a name="l04454"></a><span class="lineno"> 4454</span>&#160;</div><div class="line"><a name="l04455"></a><span class="lineno"> 4455</span>&#160;   <span class="keywordflow">if</span> (cfg == <a class="code" href="../../d3/de6/include_2asterisk_2config_8h.html#a846844eb2c4eb44554445936b3770711">CONFIG_STATUS_FILEUNCHANGED</a>) {</div><div class="line"><a name="l04456"></a><span class="lineno"> 4456</span>&#160;      <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l04457"></a><span class="lineno"> 4457</span>&#160;   }</div><div class="line"><a name="l04458"></a><span class="lineno"> 4458</span>&#160;</div><div class="line"><a name="l04459"></a><span class="lineno"> 4459</span>&#160;   <span class="keywordflow">if</span> (reload) {</div><div class="line"><a name="l04460"></a><span class="lineno"> 4460</span>&#160;      options = <a class="code" href="../../d0/d60/res__fax_8c.html#a4ca79c149a1ff5fdc17dbce18e8371f8">default_options</a>;</div><div class="line"><a name="l04461"></a><span class="lineno"> 4461</span>&#160;   }</div><div class="line"><a name="l04462"></a><span class="lineno"> 4462</span>&#160;</div><div class="line"><a name="l04463"></a><span class="lineno"> 4463</span>&#160;   <span class="comment">/* create configuration */</span></div><div class="line"><a name="l04464"></a><span class="lineno"> 4464</span>&#160;   <span class="keywordflow">for</span> (v = <a class="code" href="../../d3/de6/include_2asterisk_2config_8h.html#aef636ed2f3d33f4c7a1ba67eb7c4d052">ast_variable_browse</a>(cfg, <span class="stringliteral">&quot;general&quot;</span>); v; v = v-&gt;<a class="code" href="../../dd/d02/structast__variable.html#afaaf66cc5029a563bd0bb9df076ea14b">next</a>) {</div><div class="line"><a name="l04465"></a><span class="lineno"> 4465</span>&#160;      <span class="keywordtype">int</span> rate;</div><div class="line"><a name="l04466"></a><span class="lineno"> 4466</span>&#160;</div><div class="line"><a name="l04467"></a><span class="lineno"> 4467</span>&#160;      <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="../../dd/d02/structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;minrate&quot;</span>)) {</div><div class="line"><a name="l04468"></a><span class="lineno"> 4468</span>&#160;         <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(3, <span class="stringliteral">&quot;reading minrate &#39;%s&#39; from configuration file\n&quot;</span>, v-&gt;<a class="code" href="../../dd/d02/structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>);</div><div class="line"><a name="l04469"></a><span class="lineno"> 4469</span>&#160;         <span class="keywordflow">if</span> ((rate = <a class="code" href="../../d0/d60/res__fax_8c.html#aca0e59fc667e8d921853204d2b511d98">fax_rate_str_to_int</a>(v-&gt;<a class="code" href="../../dd/d02/structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>)) == 0) {</div><div class="line"><a name="l04470"></a><span class="lineno"> 4470</span>&#160;            res = -1;</div><div class="line"><a name="l04471"></a><span class="lineno"> 4471</span>&#160;            <span class="keywordflow">goto</span> <a class="code" href="../../dd/d7c/eagi__proxy_8c.html#a8fd806ad19b8f5513a4cf18cbf77532c">end</a>;</div><div class="line"><a name="l04472"></a><span class="lineno"> 4472</span>&#160;         }</div><div class="line"><a name="l04473"></a><span class="lineno"> 4473</span>&#160;         options.<a class="code" href="../../d0/d28/structfax__options.html#a8bff16fb9ab2254b86636f6fac166a66">minrate</a> = rate;</div><div class="line"><a name="l04474"></a><span class="lineno"> 4474</span>&#160;      } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="../../dd/d02/structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;maxrate&quot;</span>)) {</div><div class="line"><a name="l04475"></a><span class="lineno"> 4475</span>&#160;         <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(3, <span class="stringliteral">&quot;reading maxrate &#39;%s&#39; from configuration file\n&quot;</span>, v-&gt;<a class="code" href="../../dd/d02/structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>);</div><div class="line"><a name="l04476"></a><span class="lineno"> 4476</span>&#160;         <span class="keywordflow">if</span> ((rate = <a class="code" href="../../d0/d60/res__fax_8c.html#aca0e59fc667e8d921853204d2b511d98">fax_rate_str_to_int</a>(v-&gt;<a class="code" href="../../dd/d02/structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>)) == 0) {</div><div class="line"><a name="l04477"></a><span class="lineno"> 4477</span>&#160;            res = -1;</div><div class="line"><a name="l04478"></a><span class="lineno"> 4478</span>&#160;            <span class="keywordflow">goto</span> <a class="code" href="../../dd/d7c/eagi__proxy_8c.html#a8fd806ad19b8f5513a4cf18cbf77532c">end</a>;</div><div class="line"><a name="l04479"></a><span class="lineno"> 4479</span>&#160;         }</div><div class="line"><a name="l04480"></a><span class="lineno"> 4480</span>&#160;         options.<a class="code" href="../../d0/d28/structfax__options.html#a975b0a45868387d13867daeac314978a">maxrate</a> = rate;</div><div class="line"><a name="l04481"></a><span class="lineno"> 4481</span>&#160;      } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="../../dd/d02/structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;statusevents&quot;</span>)) {</div><div class="line"><a name="l04482"></a><span class="lineno"> 4482</span>&#160;         <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(3, <span class="stringliteral">&quot;reading statusevents &#39;%s&#39; from configuration file\n&quot;</span>, v-&gt;<a class="code" href="../../dd/d02/structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>);</div><div class="line"><a name="l04483"></a><span class="lineno"> 4483</span>&#160;         options.<a class="code" href="../../d0/d28/structfax__options.html#a7f633c7bc4fe667e873649afa4d44640">statusevents</a> = <a class="code" href="../../d6/d90/strings_8h.html#a387a69b3871ca31061566a73f45d20f4">ast_true</a>(v-&gt;<a class="code" href="../../dd/d02/structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>);</div><div class="line"><a name="l04484"></a><span class="lineno"> 4484</span>&#160;      } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="../../dd/d02/structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;ecm&quot;</span>)) {</div><div class="line"><a name="l04485"></a><span class="lineno"> 4485</span>&#160;         <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(3, <span class="stringliteral">&quot;reading ecm &#39;%s&#39; from configuration file\n&quot;</span>, v-&gt;<a class="code" href="../../dd/d02/structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>);</div><div class="line"><a name="l04486"></a><span class="lineno"> 4486</span>&#160;         options.<a class="code" href="../../d0/d28/structfax__options.html#af766692698b742acddbc42494d323a9f">ecm</a> = <a class="code" href="../../d6/d90/strings_8h.html#a387a69b3871ca31061566a73f45d20f4">ast_true</a>(v-&gt;<a class="code" href="../../dd/d02/structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>);</div><div class="line"><a name="l04487"></a><span class="lineno"> 4487</span>&#160;      } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((!strcasecmp(v-&gt;<a class="code" href="../../dd/d02/structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;modem&quot;</span>)) || (!strcasecmp(v-&gt;<a class="code" href="../../dd/d02/structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;modems&quot;</span>))) {</div><div class="line"><a name="l04488"></a><span class="lineno"> 4488</span>&#160;         options.<a class="code" href="../../d0/d28/structfax__options.html#a38b557eee45ee4c0d92d514c04823f84">modems</a> = 0;</div><div class="line"><a name="l04489"></a><span class="lineno"> 4489</span>&#160;         <a class="code" href="../../d0/d60/res__fax_8c.html#a1e8694b9fd8a3141f361235450a323ab">update_modem_bits</a>(&amp;options.<a class="code" href="../../d0/d28/structfax__options.html#a38b557eee45ee4c0d92d514c04823f84">modems</a>, v-&gt;<a class="code" href="../../dd/d02/structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>);</div><div class="line"><a name="l04490"></a><span class="lineno"> 4490</span>&#160;      } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(v-&gt;<a class="code" href="../../dd/d02/structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, <span class="stringliteral">&quot;t38timeout&quot;</span>)) {</div><div class="line"><a name="l04491"></a><span class="lineno"> 4491</span>&#160;         <span class="keywordflow">if</span> (<a class="code" href="../../d0/d60/res__fax_8c.html#a6768093d6a4ce21f6b3b18bad24c5ee2">set_t38timeout</a>(v-&gt;<a class="code" href="../../dd/d02/structast__variable.html#a8556878012feffc9e0beb86cd78f424d">value</a>, &amp;options.<a class="code" href="../../d0/d28/structfax__options.html#a50d4d0d4e0ae5aae877a0e6d2faa9517">t38timeout</a>)) {</div><div class="line"><a name="l04492"></a><span class="lineno"> 4492</span>&#160;            res = -1;</div><div class="line"><a name="l04493"></a><span class="lineno"> 4493</span>&#160;            <span class="keywordflow">goto</span> <a class="code" href="../../dd/d7c/eagi__proxy_8c.html#a8fd806ad19b8f5513a4cf18cbf77532c">end</a>;</div><div class="line"><a name="l04494"></a><span class="lineno"> 4494</span>&#160;         }</div><div class="line"><a name="l04495"></a><span class="lineno"> 4495</span>&#160;      }</div><div class="line"><a name="l04496"></a><span class="lineno"> 4496</span>&#160;   }</div><div class="line"><a name="l04497"></a><span class="lineno"> 4497</span>&#160;</div><div class="line"><a name="l04498"></a><span class="lineno"> 4498</span>&#160;   <span class="keywordflow">if</span> (options.<a class="code" href="../../d0/d28/structfax__options.html#a975b0a45868387d13867daeac314978a">maxrate</a> &lt; options.<a class="code" href="../../d0/d28/structfax__options.html#a8bff16fb9ab2254b86636f6fac166a66">minrate</a>) {</div><div class="line"><a name="l04499"></a><span class="lineno"> 4499</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;maxrate %u is less than minrate %u\n&quot;</span>, options.<a class="code" href="../../d0/d28/structfax__options.html#a975b0a45868387d13867daeac314978a">maxrate</a>, options.<a class="code" href="../../d0/d28/structfax__options.html#a8bff16fb9ab2254b86636f6fac166a66">minrate</a>);</div><div class="line"><a name="l04500"></a><span class="lineno"> 4500</span>&#160;      res = -1;</div><div class="line"><a name="l04501"></a><span class="lineno"> 4501</span>&#160;      <span class="keywordflow">goto</span> <a class="code" href="../../dd/d7c/eagi__proxy_8c.html#a8fd806ad19b8f5513a4cf18cbf77532c">end</a>;</div><div class="line"><a name="l04502"></a><span class="lineno"> 4502</span>&#160;   }</div><div class="line"><a name="l04503"></a><span class="lineno"> 4503</span>&#160;</div><div class="line"><a name="l04504"></a><span class="lineno"> 4504</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d0/d60/res__fax_8c.html#a693b0f3ff5d9020fe797cdc46e9489d4">check_modem_rate</a>(options.<a class="code" href="../../d0/d28/structfax__options.html#a38b557eee45ee4c0d92d514c04823f84">modems</a>, options.<a class="code" href="../../d0/d28/structfax__options.html#a8bff16fb9ab2254b86636f6fac166a66">minrate</a>)) {</div><div class="line"><a name="l04505"></a><span class="lineno"> 4505</span>&#160;      <a class="code" href="../../d0/d60/res__fax_8c.html#a9310358a6223a275dce64548ab625062">ast_fax_modem_to_str</a>(options.<a class="code" href="../../d0/d28/structfax__options.html#a38b557eee45ee4c0d92d514c04823f84">modems</a>, modems, <span class="keyword">sizeof</span>(modems));</div><div class="line"><a name="l04506"></a><span class="lineno"> 4506</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;&#39;modems&#39; setting &#39;%s&#39; is incompatible with &#39;minrate&#39; setting %u\n&quot;</span>, modems, options.<a class="code" href="../../d0/d28/structfax__options.html#a8bff16fb9ab2254b86636f6fac166a66">minrate</a>);</div><div class="line"><a name="l04507"></a><span class="lineno"> 4507</span>&#160;      res = -1;</div><div class="line"><a name="l04508"></a><span class="lineno"> 4508</span>&#160;      <span class="keywordflow">goto</span> <a class="code" href="../../dd/d7c/eagi__proxy_8c.html#a8fd806ad19b8f5513a4cf18cbf77532c">end</a>;</div><div class="line"><a name="l04509"></a><span class="lineno"> 4509</span>&#160;   }</div><div class="line"><a name="l04510"></a><span class="lineno"> 4510</span>&#160;</div><div class="line"><a name="l04511"></a><span class="lineno"> 4511</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d0/d60/res__fax_8c.html#a693b0f3ff5d9020fe797cdc46e9489d4">check_modem_rate</a>(options.<a class="code" href="../../d0/d28/structfax__options.html#a38b557eee45ee4c0d92d514c04823f84">modems</a>, options.<a class="code" href="../../d0/d28/structfax__options.html#a975b0a45868387d13867daeac314978a">maxrate</a>)) {</div><div class="line"><a name="l04512"></a><span class="lineno"> 4512</span>&#160;      <a class="code" href="../../d0/d60/res__fax_8c.html#a9310358a6223a275dce64548ab625062">ast_fax_modem_to_str</a>(options.<a class="code" href="../../d0/d28/structfax__options.html#a38b557eee45ee4c0d92d514c04823f84">modems</a>, modems, <span class="keyword">sizeof</span>(modems));</div><div class="line"><a name="l04513"></a><span class="lineno"> 4513</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;&#39;modems&#39; setting &#39;%s&#39; is incompatible with &#39;maxrate&#39; setting %u\n&quot;</span>, modems, options.<a class="code" href="../../d0/d28/structfax__options.html#a975b0a45868387d13867daeac314978a">maxrate</a>);</div><div class="line"><a name="l04514"></a><span class="lineno"> 4514</span>&#160;      res = -1;</div><div class="line"><a name="l04515"></a><span class="lineno"> 4515</span>&#160;      <span class="keywordflow">goto</span> <a class="code" href="../../dd/d7c/eagi__proxy_8c.html#a8fd806ad19b8f5513a4cf18cbf77532c">end</a>;</div><div class="line"><a name="l04516"></a><span class="lineno"> 4516</span>&#160;   }</div><div class="line"><a name="l04517"></a><span class="lineno"> 4517</span>&#160;</div><div class="line"><a name="l04518"></a><span class="lineno"> 4518</span>&#160;   <a class="code" href="../../d0/d60/res__fax_8c.html#a235464080ba7708ab425f6074d9a2bda">set_general_options</a>(&amp;options);</div><div class="line"><a name="l04519"></a><span class="lineno"> 4519</span>&#160;</div><div class="line"><a name="l04520"></a><span class="lineno"> 4520</span>&#160;<a class="code" href="../../dd/d7c/eagi__proxy_8c.html#a8fd806ad19b8f5513a4cf18cbf77532c">end</a>:</div><div class="line"><a name="l04521"></a><span class="lineno"> 4521</span>&#160;   <a class="code" href="../../d3/de6/include_2asterisk_2config_8h.html#a6b4d4d929013de7812fbba4e58353078">ast_config_destroy</a>(cfg);</div><div class="line"><a name="l04522"></a><span class="lineno"> 4522</span>&#160;   <span class="keywordflow">return</span> res;</div><div class="line"><a name="l04523"></a><span class="lineno"> 4523</span>&#160;}</div><div class="line"><a name="l04524"></a><span class="lineno"> 4524</span>&#160;<span class="comment"></span></div><div class="line"><a name="l04525"></a><span class="lineno"> 4525</span>&#160;<span class="comment">/*! \brief FAXOPT read function returns the contents of a FAX option */</span></div><div class="line"><a name="l04526"></a><span class="lineno"><a class="line" href="../../d0/d60/res__fax_8c.html#a383005b651eaf3e5203501a8ef9e7766"> 4526</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d0/d60/res__fax_8c.html#a383005b651eaf3e5203501a8ef9e7766">acf_faxopt_read</a>(<span class="keyword">struct</span> <a class="code" href="../../df/d3c/structast__channel.html">ast_channel</a> *chan, <span class="keyword">const</span> <span class="keywordtype">char</span> *cmd, <span class="keywordtype">char</span> *data, <span class="keywordtype">char</span> *<a class="code" href="../../dd/d7c/eagi__proxy_8c.html#ac95651d79c608a3148973b5b1fc9e525">buf</a>, <span class="keywordtype">size_t</span> <a class="code" href="../../d9/d1e/func__strings_8c.html#af24e73aaf92f3000fda15d285e66df24">len</a>)</div><div class="line"><a name="l04527"></a><span class="lineno"> 4527</span>&#160;{</div><div class="line"><a name="l04528"></a><span class="lineno"> 4528</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d8/dc2/structast__fax__session__details.html">ast_fax_session_details</a> *details = <a class="code" href="../../d0/d60/res__fax_8c.html#aa42f3331d32fc2fd92010023c6100322">find_details</a>(chan);</div><div class="line"><a name="l04529"></a><span class="lineno"> 4529</span>&#160;   <span class="keywordtype">int</span> res = 0;</div><div class="line"><a name="l04530"></a><span class="lineno"> 4530</span>&#160;   <span class="keywordtype">char</span> *filenames;</div><div class="line"><a name="l04531"></a><span class="lineno"> 4531</span>&#160;</div><div class="line"><a name="l04532"></a><span class="lineno"> 4532</span>&#160;   <span class="keywordflow">if</span> (!details) {</div><div class="line"><a name="l04533"></a><span class="lineno"> 4533</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;channel &#39;%s&#39; can&#39;t read FAXOPT(%s) because it has never been written.\n&quot;</span>, <a class="code" href="../../d5/d7b/channel_8h.html#a7ca2fda13b129a55c251b56729de285b">ast_channel_name</a>(chan), data);</div><div class="line"><a name="l04534"></a><span class="lineno"> 4534</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l04535"></a><span class="lineno"> 4535</span>&#160;   }</div><div class="line"><a name="l04536"></a><span class="lineno"> 4536</span>&#160;   <span class="keywordflow">if</span> (!strcasecmp(data, <span class="stringliteral">&quot;ecm&quot;</span>)) {</div><div class="line"><a name="l04537"></a><span class="lineno"> 4537</span>&#160;      <a class="code" href="../../d6/d90/strings_8h.html#ac4040268f7b6ed77dfc49c7767626369">ast_copy_string</a>(buf, details-&gt;<a class="code" href="../../d8/dc2/structast__fax__session__details.html#a3ab211dbe8780b7292257f6b3dba1952">option</a>.<a class="code" href="../../d8/dc2/structast__fax__session__details.html#af766692698b742acddbc42494d323a9f">ecm</a> ? <span class="stringliteral">&quot;yes&quot;</span> : <span class="stringliteral">&quot;no&quot;</span>, len);</div><div class="line"><a name="l04538"></a><span class="lineno"> 4538</span>&#160;   } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(data, <span class="stringliteral">&quot;t38gateway&quot;</span>) || !strcasecmp(data, <span class="stringliteral">&quot;gateway&quot;</span>) ||</div><div class="line"><a name="l04539"></a><span class="lineno"> 4539</span>&#160;         !strcasecmp(data, <span class="stringliteral">&quot;t38_gateway&quot;</span>) || !strcasecmp(data, <span class="stringliteral">&quot;faxgateway&quot;</span>)) {</div><div class="line"><a name="l04540"></a><span class="lineno"> 4540</span>&#160;      <a class="code" href="../../d6/d90/strings_8h.html#ac4040268f7b6ed77dfc49c7767626369">ast_copy_string</a>(buf, details-&gt;<a class="code" href="../../d8/dc2/structast__fax__session__details.html#a2a669261b0b8c26d26573c678149d312">gateway_id</a> != -1 ? <span class="stringliteral">&quot;yes&quot;</span> : <span class="stringliteral">&quot;no&quot;</span>, len);</div><div class="line"><a name="l04541"></a><span class="lineno"> 4541</span>&#160;   } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(data, <span class="stringliteral">&quot;faxdetect&quot;</span>)) {</div><div class="line"><a name="l04542"></a><span class="lineno"> 4542</span>&#160;      <a class="code" href="../../d6/d90/strings_8h.html#ac4040268f7b6ed77dfc49c7767626369">ast_copy_string</a>(buf, details-&gt;<a class="code" href="../../d8/dc2/structast__fax__session__details.html#aaa69733356239747f442b9543b38cfba">faxdetect_id</a> != -1 ? <span class="stringliteral">&quot;yes&quot;</span> : <span class="stringliteral">&quot;no&quot;</span>, len);</div><div class="line"><a name="l04543"></a><span class="lineno"> 4543</span>&#160;   } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(data, <span class="stringliteral">&quot;error&quot;</span>)) {</div><div class="line"><a name="l04544"></a><span class="lineno"> 4544</span>&#160;      <a class="code" href="../../d6/d90/strings_8h.html#ac4040268f7b6ed77dfc49c7767626369">ast_copy_string</a>(buf, details-&gt;<a class="code" href="../../d8/dc2/structast__fax__session__details.html#a9b0934c83ded1da0aa05bd8eb4677f93">error</a>, len);</div><div class="line"><a name="l04545"></a><span class="lineno"> 4545</span>&#160;   } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(data, <span class="stringliteral">&quot;filename&quot;</span>)) {</div><div class="line"><a name="l04546"></a><span class="lineno"> 4546</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="../../df/d90/linkedlists_8h.html#a4a1884cde93e53bef32ca85c194a1d05">AST_LIST_EMPTY</a>(&amp;details-&gt;<a class="code" href="../../d8/dc2/structast__fax__session__details.html#a14c20eed7d6d03b484ebc2cc7a447ea2">documents</a>)) {</div><div class="line"><a name="l04547"></a><span class="lineno"> 4547</span>&#160;         <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;channel &#39;%s&#39; can&#39;t read FAXOPT(%s) because it has never been written.\n&quot;</span>, <a class="code" href="../../d5/d7b/channel_8h.html#a7ca2fda13b129a55c251b56729de285b">ast_channel_name</a>(chan), data);</div><div class="line"><a name="l04548"></a><span class="lineno"> 4548</span>&#160;         res = -1;</div><div class="line"><a name="l04549"></a><span class="lineno"> 4549</span>&#160;      } <span class="keywordflow">else</span> {</div><div class="line"><a name="l04550"></a><span class="lineno"> 4550</span>&#160;         <a class="code" href="../../d6/d90/strings_8h.html#ac4040268f7b6ed77dfc49c7767626369">ast_copy_string</a>(buf, <a class="code" href="../../df/d90/linkedlists_8h.html#adf1959c5c03a3a706da97ad2f49617e5">AST_LIST_FIRST</a>(&amp;details-&gt;<a class="code" href="../../d8/dc2/structast__fax__session__details.html#a14c20eed7d6d03b484ebc2cc7a447ea2">documents</a>)-&gt;filename, len);</div><div class="line"><a name="l04551"></a><span class="lineno"> 4551</span>&#160;      }</div><div class="line"><a name="l04552"></a><span class="lineno"> 4552</span>&#160;   } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(data, <span class="stringliteral">&quot;filenames&quot;</span>)) {</div><div class="line"><a name="l04553"></a><span class="lineno"> 4553</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="../../df/d90/linkedlists_8h.html#a4a1884cde93e53bef32ca85c194a1d05">AST_LIST_EMPTY</a>(&amp;details-&gt;<a class="code" href="../../d8/dc2/structast__fax__session__details.html#a14c20eed7d6d03b484ebc2cc7a447ea2">documents</a>)) {</div><div class="line"><a name="l04554"></a><span class="lineno"> 4554</span>&#160;         <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;channel &#39;%s&#39; can&#39;t read FAXOPT(%s) because it has never been written.\n&quot;</span>, <a class="code" href="../../d5/d7b/channel_8h.html#a7ca2fda13b129a55c251b56729de285b">ast_channel_name</a>(chan), data);</div><div class="line"><a name="l04555"></a><span class="lineno"> 4555</span>&#160;         res = -1;</div><div class="line"><a name="l04556"></a><span class="lineno"> 4556</span>&#160;      } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((filenames = <a class="code" href="../../d0/d60/res__fax_8c.html#aea322d9ee9a565a0f53e6fa1f1f34e66">generate_filenames_string</a>(details, <span class="stringliteral">&quot;&quot;</span>, <span class="stringliteral">&quot;,&quot;</span>))) {</div><div class="line"><a name="l04557"></a><span class="lineno"> 4557</span>&#160;         <a class="code" href="../../d6/d90/strings_8h.html#ac4040268f7b6ed77dfc49c7767626369">ast_copy_string</a>(buf, filenames, len);</div><div class="line"><a name="l04558"></a><span class="lineno"> 4558</span>&#160;         <a class="code" href="../../d8/d8a/astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(filenames);</div><div class="line"><a name="l04559"></a><span class="lineno"> 4559</span>&#160;      } <span class="keywordflow">else</span> {</div><div class="line"><a name="l04560"></a><span class="lineno"> 4560</span>&#160;         <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;channel &#39;%s&#39; can&#39;t read FAXOPT(%s), there was an error generating the filenames list.\n&quot;</span>, <a class="code" href="../../d5/d7b/channel_8h.html#a7ca2fda13b129a55c251b56729de285b">ast_channel_name</a>(chan), data);</div><div class="line"><a name="l04561"></a><span class="lineno"> 4561</span>&#160;         res = -1;</div><div class="line"><a name="l04562"></a><span class="lineno"> 4562</span>&#160;      }</div><div class="line"><a name="l04563"></a><span class="lineno"> 4563</span>&#160;   } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(data, <span class="stringliteral">&quot;headerinfo&quot;</span>)) {</div><div class="line"><a name="l04564"></a><span class="lineno"> 4564</span>&#160;      <a class="code" href="../../d6/d90/strings_8h.html#ac4040268f7b6ed77dfc49c7767626369">ast_copy_string</a>(buf, details-&gt;<a class="code" href="../../d8/dc2/structast__fax__session__details.html#a6e3b307f2cde58ca9c7ed2c150e4c53c">headerinfo</a>, len);</div><div class="line"><a name="l04565"></a><span class="lineno"> 4565</span>&#160;   } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(data, <span class="stringliteral">&quot;localstationid&quot;</span>)) {</div><div class="line"><a name="l04566"></a><span class="lineno"> 4566</span>&#160;      <a class="code" href="../../d6/d90/strings_8h.html#ac4040268f7b6ed77dfc49c7767626369">ast_copy_string</a>(buf, details-&gt;<a class="code" href="../../d8/dc2/structast__fax__session__details.html#a045d24c59f1a8a85e8fbc745fff88140">localstationid</a>, len);</div><div class="line"><a name="l04567"></a><span class="lineno"> 4567</span>&#160;   } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(data, <span class="stringliteral">&quot;maxrate&quot;</span>)) {</div><div class="line"><a name="l04568"></a><span class="lineno"> 4568</span>&#160;      snprintf(buf, len, <span class="stringliteral">&quot;%u&quot;</span>, details-&gt;<a class="code" href="../../d8/dc2/structast__fax__session__details.html#a975b0a45868387d13867daeac314978a">maxrate</a>);</div><div class="line"><a name="l04569"></a><span class="lineno"> 4569</span>&#160;   } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(data, <span class="stringliteral">&quot;minrate&quot;</span>)) {</div><div class="line"><a name="l04570"></a><span class="lineno"> 4570</span>&#160;      snprintf(buf, len, <span class="stringliteral">&quot;%u&quot;</span>, details-&gt;<a class="code" href="../../d8/dc2/structast__fax__session__details.html#a8bff16fb9ab2254b86636f6fac166a66">minrate</a>);</div><div class="line"><a name="l04571"></a><span class="lineno"> 4571</span>&#160;   } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(data, <span class="stringliteral">&quot;pages&quot;</span>)) {</div><div class="line"><a name="l04572"></a><span class="lineno"> 4572</span>&#160;      snprintf(buf, len, <span class="stringliteral">&quot;%u&quot;</span>, details-&gt;<a class="code" href="../../d8/dc2/structast__fax__session__details.html#ac579558087dfa900a4c5384cb6e09dd8">pages_transferred</a>);</div><div class="line"><a name="l04573"></a><span class="lineno"> 4573</span>&#160;   } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(data, <span class="stringliteral">&quot;rate&quot;</span>)) {</div><div class="line"><a name="l04574"></a><span class="lineno"> 4574</span>&#160;      <a class="code" href="../../d6/d90/strings_8h.html#ac4040268f7b6ed77dfc49c7767626369">ast_copy_string</a>(buf, details-&gt;<a class="code" href="../../d8/dc2/structast__fax__session__details.html#acabbc07223706b9f471213b8e5dc1d58">transfer_rate</a>, len);</div><div class="line"><a name="l04575"></a><span class="lineno"> 4575</span>&#160;   } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(data, <span class="stringliteral">&quot;remotestationid&quot;</span>)) {</div><div class="line"><a name="l04576"></a><span class="lineno"> 4576</span>&#160;      <a class="code" href="../../d6/d90/strings_8h.html#ac4040268f7b6ed77dfc49c7767626369">ast_copy_string</a>(buf, details-&gt;<a class="code" href="../../d8/dc2/structast__fax__session__details.html#acab313697f3cc547dbfede01ee743aa6">remotestationid</a>, len);</div><div class="line"><a name="l04577"></a><span class="lineno"> 4577</span>&#160;   } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(data, <span class="stringliteral">&quot;resolution&quot;</span>)) {</div><div class="line"><a name="l04578"></a><span class="lineno"> 4578</span>&#160;      <a class="code" href="../../d6/d90/strings_8h.html#ac4040268f7b6ed77dfc49c7767626369">ast_copy_string</a>(buf, details-&gt;<a class="code" href="../../d8/dc2/structast__fax__session__details.html#ac832ac88c8237d922dfeba836a8d77ce">resolution</a>, len);</div><div class="line"><a name="l04579"></a><span class="lineno"> 4579</span>&#160;   } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(data, <span class="stringliteral">&quot;sessionid&quot;</span>)) {</div><div class="line"><a name="l04580"></a><span class="lineno"> 4580</span>&#160;      snprintf(buf, len, <span class="stringliteral">&quot;%u&quot;</span>, details-&gt;<a class="code" href="../../d8/dc2/structast__fax__session__details.html#ab7ce6f462afaf105224b0ca772a33c43">id</a>);</div><div class="line"><a name="l04581"></a><span class="lineno"> 4581</span>&#160;   } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(data, <span class="stringliteral">&quot;status&quot;</span>)) {</div><div class="line"><a name="l04582"></a><span class="lineno"> 4582</span>&#160;      <a class="code" href="../../d6/d90/strings_8h.html#ac4040268f7b6ed77dfc49c7767626369">ast_copy_string</a>(buf, details-&gt;<a class="code" href="../../d8/dc2/structast__fax__session__details.html#a17c89d9cdcac0df0f2039f065b7cf0ed">result</a>, len);</div><div class="line"><a name="l04583"></a><span class="lineno"> 4583</span>&#160;   } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(data, <span class="stringliteral">&quot;statusstr&quot;</span>)) {</div><div class="line"><a name="l04584"></a><span class="lineno"> 4584</span>&#160;      <a class="code" href="../../d6/d90/strings_8h.html#ac4040268f7b6ed77dfc49c7767626369">ast_copy_string</a>(buf, details-&gt;<a class="code" href="../../d8/dc2/structast__fax__session__details.html#a8e155783a5296f8607948dfbe5783933">resultstr</a>, len);</div><div class="line"><a name="l04585"></a><span class="lineno"> 4585</span>&#160;   } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((!strcasecmp(data, <span class="stringliteral">&quot;modem&quot;</span>)) || (!strcasecmp(data, <span class="stringliteral">&quot;modems&quot;</span>))) {</div><div class="line"><a name="l04586"></a><span class="lineno"> 4586</span>&#160;      <a class="code" href="../../d0/d60/res__fax_8c.html#a9310358a6223a275dce64548ab625062">ast_fax_modem_to_str</a>(details-&gt;<a class="code" href="../../d8/dc2/structast__fax__session__details.html#a38b557eee45ee4c0d92d514c04823f84">modems</a>, buf, len);</div><div class="line"><a name="l04587"></a><span class="lineno"> 4587</span>&#160;   } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(data, <span class="stringliteral">&quot;t38timeout&quot;</span>)) {</div><div class="line"><a name="l04588"></a><span class="lineno"> 4588</span>&#160;      snprintf(buf, len, <span class="stringliteral">&quot;%u&quot;</span>, details-&gt;<a class="code" href="../../d8/dc2/structast__fax__session__details.html#a50d4d0d4e0ae5aae877a0e6d2faa9517">t38timeout</a>);</div><div class="line"><a name="l04589"></a><span class="lineno"> 4589</span>&#160;   } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(data, <span class="stringliteral">&quot;negotiate_both&quot;</span>)) {</div><div class="line"><a name="l04590"></a><span class="lineno"> 4590</span>&#160;      <a class="code" href="../../d6/d90/strings_8h.html#ac4040268f7b6ed77dfc49c7767626369">ast_copy_string</a>(buf, details-&gt;<a class="code" href="../../d8/dc2/structast__fax__session__details.html#a40311ef8f9bd5a1a7d7bf32f3b019148">negotiate_both</a> != -1 ? <span class="stringliteral">&quot;yes&quot;</span> : <span class="stringliteral">&quot;no&quot;</span>, len);</div><div class="line"><a name="l04591"></a><span class="lineno"> 4591</span>&#160;   } <span class="keywordflow">else</span> {</div><div class="line"><a name="l04592"></a><span class="lineno"> 4592</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;channel &#39;%s&#39; can&#39;t read FAXOPT(%s) because it is unhandled!\n&quot;</span>, <a class="code" href="../../d5/d7b/channel_8h.html#a7ca2fda13b129a55c251b56729de285b">ast_channel_name</a>(chan), data);</div><div class="line"><a name="l04593"></a><span class="lineno"> 4593</span>&#160;      res = -1;</div><div class="line"><a name="l04594"></a><span class="lineno"> 4594</span>&#160;   }</div><div class="line"><a name="l04595"></a><span class="lineno"> 4595</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(details, -1);</div><div class="line"><a name="l04596"></a><span class="lineno"> 4596</span>&#160;</div><div class="line"><a name="l04597"></a><span class="lineno"> 4597</span>&#160;   <span class="keywordflow">return</span> res;</div><div class="line"><a name="l04598"></a><span class="lineno"> 4598</span>&#160;}</div><div class="line"><a name="l04599"></a><span class="lineno"> 4599</span>&#160;<span class="comment"></span></div><div class="line"><a name="l04600"></a><span class="lineno"> 4600</span>&#160;<span class="comment">/*! \brief FAXOPT write function modifies the contents of a FAX option */</span></div><div class="line"><a name="l04601"></a><span class="lineno"><a class="line" href="../../d0/d60/res__fax_8c.html#a0b0465081fc0fba59df0daa857ed49bf"> 4601</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d0/d60/res__fax_8c.html#a0b0465081fc0fba59df0daa857ed49bf">acf_faxopt_write</a>(<span class="keyword">struct</span> <a class="code" href="../../df/d3c/structast__channel.html">ast_channel</a> *chan, <span class="keyword">const</span> <span class="keywordtype">char</span> *cmd, <span class="keywordtype">char</span> *data, <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="../../d4/d2f/syslog_8c.html#ac4f474c82e82cbb89ca7c36dd52be0ed">value</a>)</div><div class="line"><a name="l04602"></a><span class="lineno"> 4602</span>&#160;{</div><div class="line"><a name="l04603"></a><span class="lineno"> 4603</span>&#160;   <span class="keywordtype">int</span> res = 0;</div><div class="line"><a name="l04604"></a><span class="lineno"> 4604</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d8/dc2/structast__fax__session__details.html">ast_fax_session_details</a> *details;</div><div class="line"><a name="l04605"></a><span class="lineno"> 4605</span>&#160;</div><div class="line"><a name="l04606"></a><span class="lineno"> 4606</span>&#160;   <span class="keywordflow">if</span> (!(details = <a class="code" href="../../d0/d60/res__fax_8c.html#ac4310e981e9db76dfc3e85c51f4c6e1e">find_or_create_details</a>(chan))) {</div><div class="line"><a name="l04607"></a><span class="lineno"> 4607</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;channel &#39;%s&#39; can&#39;t set FAXOPT(%s) to &#39;%s&#39; because it failed to create a datastore.\n&quot;</span>, <a class="code" href="../../d5/d7b/channel_8h.html#a7ca2fda13b129a55c251b56729de285b">ast_channel_name</a>(chan), data, value);</div><div class="line"><a name="l04608"></a><span class="lineno"> 4608</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l04609"></a><span class="lineno"> 4609</span>&#160;   }</div><div class="line"><a name="l04610"></a><span class="lineno"> 4610</span>&#160;   <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(3, <span class="stringliteral">&quot;channel &#39;%s&#39; setting FAXOPT(%s) to &#39;%s&#39;\n&quot;</span>, <a class="code" href="../../d5/d7b/channel_8h.html#a7ca2fda13b129a55c251b56729de285b">ast_channel_name</a>(chan), data, value);</div><div class="line"><a name="l04611"></a><span class="lineno"> 4611</span>&#160;</div><div class="line"><a name="l04612"></a><span class="lineno"> 4612</span>&#160;   <span class="keywordflow">if</span> (!strcasecmp(data, <span class="stringliteral">&quot;ecm&quot;</span>)) {</div><div class="line"><a name="l04613"></a><span class="lineno"> 4613</span>&#160;      <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="../../d5/d85/structval.html">val</a> = <a class="code" href="../../d6/d90/strings_8h.html#af5693da955fa3bc73bc49c47b601fc7a">ast_skip_blanks</a>(value);</div><div class="line"><a name="l04614"></a><span class="lineno"> 4614</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="../../d6/d90/strings_8h.html#a387a69b3871ca31061566a73f45d20f4">ast_true</a>(val)) {</div><div class="line"><a name="l04615"></a><span class="lineno"> 4615</span>&#160;         details-&gt;<a class="code" href="../../d8/dc2/structast__fax__session__details.html#a3ab211dbe8780b7292257f6b3dba1952">option</a>.<a class="code" href="../../d8/dc2/structast__fax__session__details.html#af766692698b742acddbc42494d323a9f">ecm</a> = <a class="code" href="../../db/d6a/res__fax_8h.html#a1838c71fcf68c3cfe0ce37e35e77406dabd9b4a57405ba5c0c884ac98746a8bd7">AST_FAX_OPTFLAG_TRUE</a>;</div><div class="line"><a name="l04616"></a><span class="lineno"> 4616</span>&#160;      } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="../../d6/d90/strings_8h.html#a6c3dc0bad204e9dd9890325c1c861e38">ast_false</a>(val)) {</div><div class="line"><a name="l04617"></a><span class="lineno"> 4617</span>&#160;         details-&gt;<a class="code" href="../../d8/dc2/structast__fax__session__details.html#a3ab211dbe8780b7292257f6b3dba1952">option</a>.<a class="code" href="../../d8/dc2/structast__fax__session__details.html#af766692698b742acddbc42494d323a9f">ecm</a> = <a class="code" href="../../db/d6a/res__fax_8h.html#a1838c71fcf68c3cfe0ce37e35e77406daa2151729c413238bea86a4b62e7865bd">AST_FAX_OPTFLAG_FALSE</a>;</div><div class="line"><a name="l04618"></a><span class="lineno"> 4618</span>&#160;      } <span class="keywordflow">else</span> {</div><div class="line"><a name="l04619"></a><span class="lineno"> 4619</span>&#160;         <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Unsupported value &#39;%s&#39; passed to FAXOPT(ecm).\n&quot;</span>, value);</div><div class="line"><a name="l04620"></a><span class="lineno"> 4620</span>&#160;      }</div><div class="line"><a name="l04621"></a><span class="lineno"> 4621</span>&#160;   } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(data, <span class="stringliteral">&quot;t38gateway&quot;</span>) || !strcasecmp(data, <span class="stringliteral">&quot;gateway&quot;</span>) ||</div><div class="line"><a name="l04622"></a><span class="lineno"> 4622</span>&#160;         !strcasecmp(data, <span class="stringliteral">&quot;t38_gateway&quot;</span>) || !strcasecmp(data, <span class="stringliteral">&quot;faxgateway&quot;</span>)) {</div><div class="line"><a name="l04623"></a><span class="lineno"> 4623</span>&#160;      <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="../../d5/d85/structval.html">val</a> = <a class="code" href="../../d6/d90/strings_8h.html#af5693da955fa3bc73bc49c47b601fc7a">ast_skip_blanks</a>(value);</div><div class="line"><a name="l04624"></a><span class="lineno"> 4624</span>&#160;      <span class="keywordtype">char</span> *timeout = strchr(val, <span class="charliteral">&#39;,&#39;</span>);</div><div class="line"><a name="l04625"></a><span class="lineno"> 4625</span>&#160;</div><div class="line"><a name="l04626"></a><span class="lineno"> 4626</span>&#160;      <span class="keywordflow">if</span> (timeout) {</div><div class="line"><a name="l04627"></a><span class="lineno"> 4627</span>&#160;         *timeout++ = <span class="charliteral">&#39;\0&#39;</span>;</div><div class="line"><a name="l04628"></a><span class="lineno"> 4628</span>&#160;      }</div><div class="line"><a name="l04629"></a><span class="lineno"> 4629</span>&#160;</div><div class="line"><a name="l04630"></a><span class="lineno"> 4630</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="../../d6/d90/strings_8h.html#a387a69b3871ca31061566a73f45d20f4">ast_true</a>(val)) {</div><div class="line"><a name="l04631"></a><span class="lineno"> 4631</span>&#160;         <span class="keywordflow">if</span> (details-&gt;<a class="code" href="../../d8/dc2/structast__fax__session__details.html#a2a669261b0b8c26d26573c678149d312">gateway_id</a> &lt; 0) {</div><div class="line"><a name="l04632"></a><span class="lineno"> 4632</span>&#160;            details-&gt;<a class="code" href="../../d8/dc2/structast__fax__session__details.html#a3ef48556ce45595f874faa2368bc3cfa">gateway_timeout</a> = 0;</div><div class="line"><a name="l04633"></a><span class="lineno"> 4633</span>&#160;            <span class="keywordflow">if</span> (timeout) {</div><div class="line"><a name="l04634"></a><span class="lineno"> 4634</span>&#160;               <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> gwtimeout;</div><div class="line"><a name="l04635"></a><span class="lineno"> 4635</span>&#160;</div><div class="line"><a name="l04636"></a><span class="lineno"> 4636</span>&#160;               <span class="keywordflow">if</span> (sscanf(timeout, <span class="stringliteral">&quot;%30u&quot;</span>, &amp;gwtimeout) == 1) {</div><div class="line"><a name="l04637"></a><span class="lineno"> 4637</span>&#160;                  details-&gt;<a class="code" href="../../d8/dc2/structast__fax__session__details.html#a3ef48556ce45595f874faa2368bc3cfa">gateway_timeout</a> = gwtimeout * 1000;</div><div class="line"><a name="l04638"></a><span class="lineno"> 4638</span>&#160;               } <span class="keywordflow">else</span> {</div><div class="line"><a name="l04639"></a><span class="lineno"> 4639</span>&#160;                  <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Unsupported timeout &#39;%s&#39; passed to FAXOPT(%s).\n&quot;</span>, timeout, data);</div><div class="line"><a name="l04640"></a><span class="lineno"> 4640</span>&#160;               }</div><div class="line"><a name="l04641"></a><span class="lineno"> 4641</span>&#160;            }</div><div class="line"><a name="l04642"></a><span class="lineno"> 4642</span>&#160;</div><div class="line"><a name="l04643"></a><span class="lineno"> 4643</span>&#160;            details-&gt;<a class="code" href="../../d8/dc2/structast__fax__session__details.html#a2a669261b0b8c26d26573c678149d312">gateway_id</a> = <a class="code" href="../../d0/d60/res__fax_8c.html#a87718f9b64d50c694da714f631626807">fax_gateway_attach</a>(chan, details);</div><div class="line"><a name="l04644"></a><span class="lineno"> 4644</span>&#160;            <span class="keywordflow">if</span> (details-&gt;<a class="code" href="../../d8/dc2/structast__fax__session__details.html#a2a669261b0b8c26d26573c678149d312">gateway_id</a> &lt; 0) {</div><div class="line"><a name="l04645"></a><span class="lineno"> 4645</span>&#160;               <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Error attaching T.38 gateway to channel %s.\n&quot;</span>, <a class="code" href="../../d5/d7b/channel_8h.html#a7ca2fda13b129a55c251b56729de285b">ast_channel_name</a>(chan));</div><div class="line"><a name="l04646"></a><span class="lineno"> 4646</span>&#160;               res = -1;</div><div class="line"><a name="l04647"></a><span class="lineno"> 4647</span>&#160;            } <span class="keywordflow">else</span> {</div><div class="line"><a name="l04648"></a><span class="lineno"> 4648</span>&#160;               <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(1, <span class="stringliteral">&quot;Attached T.38 gateway to channel %s.\n&quot;</span>, <a class="code" href="../../d5/d7b/channel_8h.html#a7ca2fda13b129a55c251b56729de285b">ast_channel_name</a>(chan));</div><div class="line"><a name="l04649"></a><span class="lineno"> 4649</span>&#160;            }</div><div class="line"><a name="l04650"></a><span class="lineno"> 4650</span>&#160;         } <span class="keywordflow">else</span> {</div><div class="line"><a name="l04651"></a><span class="lineno"> 4651</span>&#160;            <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Attempt to attach a T.38 gateway on channel (%s) with gateway already running.\n&quot;</span>, <a class="code" href="../../d5/d7b/channel_8h.html#a7ca2fda13b129a55c251b56729de285b">ast_channel_name</a>(chan));</div><div class="line"><a name="l04652"></a><span class="lineno"> 4652</span>&#160;         }</div><div class="line"><a name="l04653"></a><span class="lineno"> 4653</span>&#160;      } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="../../d6/d90/strings_8h.html#a6c3dc0bad204e9dd9890325c1c861e38">ast_false</a>(val)) {</div><div class="line"><a name="l04654"></a><span class="lineno"> 4654</span>&#160;         <a class="code" href="../../d5/d7b/channel_8h.html#a493bdebe876caafb8ee535853310364a">ast_channel_lock</a>(chan);</div><div class="line"><a name="l04655"></a><span class="lineno"> 4655</span>&#160;         <a class="code" href="../../db/d3c/framehook_8h.html#a6e116259cae8c1e5cca074d05f0a3475">ast_framehook_detach</a>(chan, details-&gt;<a class="code" href="../../d8/dc2/structast__fax__session__details.html#a2a669261b0b8c26d26573c678149d312">gateway_id</a>);</div><div class="line"><a name="l04656"></a><span class="lineno"> 4656</span>&#160;         <a class="code" href="../../d5/d7b/channel_8h.html#af476c537b29be3f29240489032f9db39">ast_channel_unlock</a>(chan);</div><div class="line"><a name="l04657"></a><span class="lineno"> 4657</span>&#160;         details-&gt;<a class="code" href="../../d8/dc2/structast__fax__session__details.html#a2a669261b0b8c26d26573c678149d312">gateway_id</a> = -1;</div><div class="line"><a name="l04658"></a><span class="lineno"> 4658</span>&#160;      } <span class="keywordflow">else</span> {</div><div class="line"><a name="l04659"></a><span class="lineno"> 4659</span>&#160;         <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Unsupported value &#39;%s&#39; passed to FAXOPT(%s).\n&quot;</span>, value, data);</div><div class="line"><a name="l04660"></a><span class="lineno"> 4660</span>&#160;      }</div><div class="line"><a name="l04661"></a><span class="lineno"> 4661</span>&#160;   } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(data, <span class="stringliteral">&quot;faxdetect&quot;</span>)) {</div><div class="line"><a name="l04662"></a><span class="lineno"> 4662</span>&#160;      <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="../../d5/d85/structval.html">val</a> = <a class="code" href="../../d6/d90/strings_8h.html#af5693da955fa3bc73bc49c47b601fc7a">ast_skip_blanks</a>(value);</div><div class="line"><a name="l04663"></a><span class="lineno"> 4663</span>&#160;      <span class="keywordtype">char</span> *timeout = strchr(val, <span class="charliteral">&#39;,&#39;</span>);</div><div class="line"><a name="l04664"></a><span class="lineno"> 4664</span>&#160;      <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="../../dc/d5c/app__alarmreceiver_8c.html#a1b48abc3f5ca7a0f92edf228128e47a1">fdtimeout</a> = 0;</div><div class="line"><a name="l04665"></a><span class="lineno"> 4665</span>&#160;      <span class="keywordtype">int</span> flags;</div><div class="line"><a name="l04666"></a><span class="lineno"> 4666</span>&#160;      <span class="keywordtype">int</span> faxdetect;</div><div class="line"><a name="l04667"></a><span class="lineno"> 4667</span>&#160;</div><div class="line"><a name="l04668"></a><span class="lineno"> 4668</span>&#160;      <span class="keywordflow">if</span> (timeout) {</div><div class="line"><a name="l04669"></a><span class="lineno"> 4669</span>&#160;         *timeout++ = <span class="charliteral">&#39;\0&#39;</span>;</div><div class="line"><a name="l04670"></a><span class="lineno"> 4670</span>&#160;      }</div><div class="line"><a name="l04671"></a><span class="lineno"> 4671</span>&#160;</div><div class="line"><a name="l04672"></a><span class="lineno"> 4672</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="../../d6/d90/strings_8h.html#a387a69b3871ca31061566a73f45d20f4">ast_true</a>(val) || !strcasecmp(val, <span class="stringliteral">&quot;t38&quot;</span>) || !strcasecmp(val, <span class="stringliteral">&quot;cng&quot;</span>)) {</div><div class="line"><a name="l04673"></a><span class="lineno"> 4673</span>&#160;         <span class="keywordflow">if</span> (details-&gt;<a class="code" href="../../d8/dc2/structast__fax__session__details.html#aaa69733356239747f442b9543b38cfba">faxdetect_id</a> &lt; 0) {</div><div class="line"><a name="l04674"></a><span class="lineno"> 4674</span>&#160;            <span class="keywordflow">if</span> (timeout) {</div><div class="line"><a name="l04675"></a><span class="lineno"> 4675</span>&#160;               <span class="keywordflow">if</span> (sscanf(timeout, <span class="stringliteral">&quot;%30u&quot;</span>, &amp;fdtimeout) == 1) {</div><div class="line"><a name="l04676"></a><span class="lineno"> 4676</span>&#160;                  fdtimeout *= 1000;</div><div class="line"><a name="l04677"></a><span class="lineno"> 4677</span>&#160;               } <span class="keywordflow">else</span> {</div><div class="line"><a name="l04678"></a><span class="lineno"> 4678</span>&#160;                  <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Unsupported timeout &#39;%s&#39; passed to FAXOPT(%s).\n&quot;</span>,</div><div class="line"><a name="l04679"></a><span class="lineno"> 4679</span>&#160;                     timeout, data);</div><div class="line"><a name="l04680"></a><span class="lineno"> 4680</span>&#160;               }</div><div class="line"><a name="l04681"></a><span class="lineno"> 4681</span>&#160;            }</div><div class="line"><a name="l04682"></a><span class="lineno"> 4682</span>&#160;</div><div class="line"><a name="l04683"></a><span class="lineno"> 4683</span>&#160;            <span class="keywordflow">if</span> (!strcasecmp(val, <span class="stringliteral">&quot;t38&quot;</span>)) {</div><div class="line"><a name="l04684"></a><span class="lineno"> 4684</span>&#160;               flags = <a class="code" href="../../d0/d60/res__fax_8c.html#a9612f65fe4e81e83a12136c6b9e89553">FAX_DETECT_MODE_T38</a>;</div><div class="line"><a name="l04685"></a><span class="lineno"> 4685</span>&#160;            } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(val, <span class="stringliteral">&quot;cng&quot;</span>)) {</div><div class="line"><a name="l04686"></a><span class="lineno"> 4686</span>&#160;               flags = <a class="code" href="../../d0/d60/res__fax_8c.html#af4165a00608b669d97f5acbe873dc1f7">FAX_DETECT_MODE_CNG</a>;</div><div class="line"><a name="l04687"></a><span class="lineno"> 4687</span>&#160;            } <span class="keywordflow">else</span> {</div><div class="line"><a name="l04688"></a><span class="lineno"> 4688</span>&#160;               flags = <a class="code" href="../../d0/d60/res__fax_8c.html#a23c423fff7dbf2e50800db8be4ae26ed">FAX_DETECT_MODE_BOTH</a>;</div><div class="line"><a name="l04689"></a><span class="lineno"> 4689</span>&#160;            }</div><div class="line"><a name="l04690"></a><span class="lineno"> 4690</span>&#160;</div><div class="line"><a name="l04691"></a><span class="lineno"> 4691</span>&#160;            faxdetect = <a class="code" href="../../d0/d60/res__fax_8c.html#a72074e43459dce843bd53cf52f186861">fax_detect_attach</a>(chan, fdtimeout, flags);</div><div class="line"><a name="l04692"></a><span class="lineno"> 4692</span>&#160;            <span class="keywordflow">if</span> (faxdetect &lt; 0) {</div><div class="line"><a name="l04693"></a><span class="lineno"> 4693</span>&#160;               <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Error attaching FAX detect to channel %s.\n&quot;</span>, <a class="code" href="../../d5/d7b/channel_8h.html#a7ca2fda13b129a55c251b56729de285b">ast_channel_name</a>(chan));</div><div class="line"><a name="l04694"></a><span class="lineno"> 4694</span>&#160;               res = -1;</div><div class="line"><a name="l04695"></a><span class="lineno"> 4695</span>&#160;            } <span class="keywordflow">else</span> {</div><div class="line"><a name="l04696"></a><span class="lineno"> 4696</span>&#160;               <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(1, <span class="stringliteral">&quot;Attached FAX detect to channel %s.\n&quot;</span>, <a class="code" href="../../d5/d7b/channel_8h.html#a7ca2fda13b129a55c251b56729de285b">ast_channel_name</a>(chan));</div><div class="line"><a name="l04697"></a><span class="lineno"> 4697</span>&#160;            }</div><div class="line"><a name="l04698"></a><span class="lineno"> 4698</span>&#160;         } <span class="keywordflow">else</span> {</div><div class="line"><a name="l04699"></a><span class="lineno"> 4699</span>&#160;            <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Attempt to attach a FAX detect on channel (%s) with FAX detect already running.\n&quot;</span>, <a class="code" href="../../d5/d7b/channel_8h.html#a7ca2fda13b129a55c251b56729de285b">ast_channel_name</a>(chan));</div><div class="line"><a name="l04700"></a><span class="lineno"> 4700</span>&#160;         }</div><div class="line"><a name="l04701"></a><span class="lineno"> 4701</span>&#160;      } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="../../d6/d90/strings_8h.html#a6c3dc0bad204e9dd9890325c1c861e38">ast_false</a>(val)) {</div><div class="line"><a name="l04702"></a><span class="lineno"> 4702</span>&#160;         <a class="code" href="../../d5/d7b/channel_8h.html#a493bdebe876caafb8ee535853310364a">ast_channel_lock</a>(chan);</div><div class="line"><a name="l04703"></a><span class="lineno"> 4703</span>&#160;         <a class="code" href="../../db/d3c/framehook_8h.html#a6e116259cae8c1e5cca074d05f0a3475">ast_framehook_detach</a>(chan, details-&gt;<a class="code" href="../../d8/dc2/structast__fax__session__details.html#aaa69733356239747f442b9543b38cfba">faxdetect_id</a>);</div><div class="line"><a name="l04704"></a><span class="lineno"> 4704</span>&#160;         <a class="code" href="../../d5/d7b/channel_8h.html#af476c537b29be3f29240489032f9db39">ast_channel_unlock</a>(chan);</div><div class="line"><a name="l04705"></a><span class="lineno"> 4705</span>&#160;         details-&gt;<a class="code" href="../../d8/dc2/structast__fax__session__details.html#aaa69733356239747f442b9543b38cfba">faxdetect_id</a> = -1;</div><div class="line"><a name="l04706"></a><span class="lineno"> 4706</span>&#160;      } <span class="keywordflow">else</span> {</div><div class="line"><a name="l04707"></a><span class="lineno"> 4707</span>&#160;         <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Unsupported value &#39;%s&#39; passed to FAXOPT(%s).\n&quot;</span>, value, data);</div><div class="line"><a name="l04708"></a><span class="lineno"> 4708</span>&#160;      }</div><div class="line"><a name="l04709"></a><span class="lineno"> 4709</span>&#160;   } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(data, <span class="stringliteral">&quot;headerinfo&quot;</span>)) {</div><div class="line"><a name="l04710"></a><span class="lineno"> 4710</span>&#160;      <a class="code" href="../../d1/d0f/stringfields_8h.html#a653461abd6e0d16e4e3326ab90e0501d">ast_string_field_set</a>(details, <a class="code" href="../../d8/dc2/structast__fax__session__details.html#a6e3b307f2cde58ca9c7ed2c150e4c53c">headerinfo</a>, value);</div><div class="line"><a name="l04711"></a><span class="lineno"> 4711</span>&#160;   } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(data, <span class="stringliteral">&quot;localstationid&quot;</span>)) {</div><div class="line"><a name="l04712"></a><span class="lineno"> 4712</span>&#160;      <a class="code" href="../../d1/d0f/stringfields_8h.html#a653461abd6e0d16e4e3326ab90e0501d">ast_string_field_set</a>(details, <a class="code" href="../../d8/dc2/structast__fax__session__details.html#a045d24c59f1a8a85e8fbc745fff88140">localstationid</a>, value);</div><div class="line"><a name="l04713"></a><span class="lineno"> 4713</span>&#160;   } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(data, <span class="stringliteral">&quot;maxrate&quot;</span>)) {</div><div class="line"><a name="l04714"></a><span class="lineno"> 4714</span>&#160;      details-&gt;<a class="code" href="../../d8/dc2/structast__fax__session__details.html#a975b0a45868387d13867daeac314978a">maxrate</a> = <a class="code" href="../../d0/d60/res__fax_8c.html#aca0e59fc667e8d921853204d2b511d98">fax_rate_str_to_int</a>(value);</div><div class="line"><a name="l04715"></a><span class="lineno"> 4715</span>&#160;      <span class="keywordflow">if</span> (!details-&gt;<a class="code" href="../../d8/dc2/structast__fax__session__details.html#a975b0a45868387d13867daeac314978a">maxrate</a>) {</div><div class="line"><a name="l04716"></a><span class="lineno"> 4716</span>&#160;         details-&gt;<a class="code" href="../../d8/dc2/structast__fax__session__details.html#a975b0a45868387d13867daeac314978a">maxrate</a> = <a class="code" href="../../d0/d60/res__fax_8c.html#aa0da952373da5653cfc4b62964aa6286">ast_fax_maxrate</a>();</div><div class="line"><a name="l04717"></a><span class="lineno"> 4717</span>&#160;      }</div><div class="line"><a name="l04718"></a><span class="lineno"> 4718</span>&#160;   } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(data, <span class="stringliteral">&quot;minrate&quot;</span>)) {</div><div class="line"><a name="l04719"></a><span class="lineno"> 4719</span>&#160;      details-&gt;<a class="code" href="../../d8/dc2/structast__fax__session__details.html#a8bff16fb9ab2254b86636f6fac166a66">minrate</a> = <a class="code" href="../../d0/d60/res__fax_8c.html#aca0e59fc667e8d921853204d2b511d98">fax_rate_str_to_int</a>(value);</div><div class="line"><a name="l04720"></a><span class="lineno"> 4720</span>&#160;      <span class="keywordflow">if</span> (!details-&gt;<a class="code" href="../../d8/dc2/structast__fax__session__details.html#a8bff16fb9ab2254b86636f6fac166a66">minrate</a>) {</div><div class="line"><a name="l04721"></a><span class="lineno"> 4721</span>&#160;         details-&gt;<a class="code" href="../../d8/dc2/structast__fax__session__details.html#a8bff16fb9ab2254b86636f6fac166a66">minrate</a> = <a class="code" href="../../d0/d60/res__fax_8c.html#a137ec11e07e82ed4c27374909f9ac965">ast_fax_minrate</a>();</div><div class="line"><a name="l04722"></a><span class="lineno"> 4722</span>&#160;      }</div><div class="line"><a name="l04723"></a><span class="lineno"> 4723</span>&#160;   } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(data, <span class="stringliteral">&quot;t38timeout&quot;</span>)) {</div><div class="line"><a name="l04724"></a><span class="lineno"> 4724</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="../../d0/d60/res__fax_8c.html#a6768093d6a4ce21f6b3b18bad24c5ee2">set_t38timeout</a>(value, &amp;details-&gt;<a class="code" href="../../d8/dc2/structast__fax__session__details.html#a50d4d0d4e0ae5aae877a0e6d2faa9517">t38timeout</a>)) {</div><div class="line"><a name="l04725"></a><span class="lineno"> 4725</span>&#160;         res = -1;</div><div class="line"><a name="l04726"></a><span class="lineno"> 4726</span>&#160;      }</div><div class="line"><a name="l04727"></a><span class="lineno"> 4727</span>&#160;   } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((!strcasecmp(data, <span class="stringliteral">&quot;modem&quot;</span>)) || (!strcasecmp(data, <span class="stringliteral">&quot;modems&quot;</span>))) {</div><div class="line"><a name="l04728"></a><span class="lineno"> 4728</span>&#160;      <a class="code" href="../../d0/d60/res__fax_8c.html#a1e8694b9fd8a3141f361235450a323ab">update_modem_bits</a>(&amp;details-&gt;<a class="code" href="../../d8/dc2/structast__fax__session__details.html#a38b557eee45ee4c0d92d514c04823f84">modems</a>, value);</div><div class="line"><a name="l04729"></a><span class="lineno"> 4729</span>&#160;   } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcasecmp(data, <span class="stringliteral">&quot;negotiate_both&quot;</span>)) {</div><div class="line"><a name="l04730"></a><span class="lineno"> 4730</span>&#160;      details-&gt;<a class="code" href="../../d8/dc2/structast__fax__session__details.html#a40311ef8f9bd5a1a7d7bf32f3b019148">negotiate_both</a> = <a class="code" href="../../d6/d90/strings_8h.html#a387a69b3871ca31061566a73f45d20f4">ast_true</a>(<a class="code" href="../../d6/d90/strings_8h.html#af5693da955fa3bc73bc49c47b601fc7a">ast_skip_blanks</a>(value));</div><div class="line"><a name="l04731"></a><span class="lineno"> 4731</span>&#160;   } <span class="keywordflow">else</span> {</div><div class="line"><a name="l04732"></a><span class="lineno"> 4732</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;channel &#39;%s&#39; set FAXOPT(%s) to &#39;%s&#39; is unhandled!\n&quot;</span>, <a class="code" href="../../d5/d7b/channel_8h.html#a7ca2fda13b129a55c251b56729de285b">ast_channel_name</a>(chan), data, value);</div><div class="line"><a name="l04733"></a><span class="lineno"> 4733</span>&#160;      res = -1;</div><div class="line"><a name="l04734"></a><span class="lineno"> 4734</span>&#160;   }</div><div class="line"><a name="l04735"></a><span class="lineno"> 4735</span>&#160;</div><div class="line"><a name="l04736"></a><span class="lineno"> 4736</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(details, -1);</div><div class="line"><a name="l04737"></a><span class="lineno"> 4737</span>&#160;</div><div class="line"><a name="l04738"></a><span class="lineno"> 4738</span>&#160;   <span class="keywordflow">return</span> res;</div><div class="line"><a name="l04739"></a><span class="lineno"> 4739</span>&#160;}</div><div class="line"><a name="l04740"></a><span class="lineno"> 4740</span>&#160;<span class="comment"></span></div><div class="line"><a name="l04741"></a><span class="lineno"> 4741</span>&#160;<span class="comment">/*! \brief FAXOPT dialplan function */</span></div><div class="line"><a name="l04742"></a><span class="lineno"><a class="line" href="../../d0/d60/res__fax_8c.html#a529256c8c5467cc6a5012d9c270b2295"> 4742</a></span>&#160;<span class="keyword">struct </span><a class="code" href="../../db/dc0/structast__custom__function.html">ast_custom_function</a> <a class="code" href="../../d0/d60/res__fax_8c.html#a529256c8c5467cc6a5012d9c270b2295">acf_faxopt</a> = {</div><div class="line"><a name="l04743"></a><span class="lineno"> 4743</span>&#160;   .<a class="code" href="../../db/dc0/structast__custom__function.html#afcd1706c9144e6d6eee6127661ae3be2">name</a> = <span class="stringliteral">&quot;FAXOPT&quot;</span>,</div><div class="line"><a name="l04744"></a><span class="lineno"> 4744</span>&#160;   .read = <a class="code" href="../../d0/d60/res__fax_8c.html#a383005b651eaf3e5203501a8ef9e7766">acf_faxopt_read</a>,</div><div class="line"><a name="l04745"></a><span class="lineno"> 4745</span>&#160;   .write = <a class="code" href="../../d0/d60/res__fax_8c.html#a0b0465081fc0fba59df0daa857ed49bf">acf_faxopt_write</a>,</div><div class="line"><a name="l04746"></a><span class="lineno"> 4746</span>&#160;};</div><div class="line"><a name="l04747"></a><span class="lineno"> 4747</span>&#160;<span class="comment"></span></div><div class="line"><a name="l04748"></a><span class="lineno"> 4748</span>&#160;<span class="comment">/*! \brief unload res_fax */</span></div><div class="line"><a name="l04749"></a><span class="lineno"><a class="line" href="../../d0/d60/res__fax_8c.html#ad09fa931f468002152a3cc2d5ce25eae"> 4749</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d0/d60/res__fax_8c.html#ad09fa931f468002152a3cc2d5ce25eae">unload_module</a>(<span class="keywordtype">void</span>)</div><div class="line"><a name="l04750"></a><span class="lineno"> 4750</span>&#160;{</div><div class="line"><a name="l04751"></a><span class="lineno"> 4751</span>&#160;   <a class="code" href="../../dc/db0/cli_8h.html#a56b6b59ee2eaa994597a5b0f4e9f9d09">ast_cli_unregister_multiple</a>(fax_cli, <a class="code" href="../../de/dfe/isdn__lib_8c.html#ab9129b977a587b50ea801daac75e178f">ARRAY_LEN</a>(fax_cli));</div><div class="line"><a name="l04752"></a><span class="lineno"> 4752</span>&#160;</div><div class="line"><a name="l04753"></a><span class="lineno"> 4753</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../db/de0/pbx_8h.html#a965977ea9a3144bc203e0ce7a64680a1">ast_custom_function_unregister</a>(&amp;acf_faxopt) &lt; 0) {</div><div class="line"><a name="l04754"></a><span class="lineno"> 4754</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;failed to unregister function &#39;%s&#39;\n&quot;</span>, acf_faxopt.<a class="code" href="../../db/dc0/structast__custom__function.html#afcd1706c9144e6d6eee6127661ae3be2">name</a>);</div><div class="line"><a name="l04755"></a><span class="lineno"> 4755</span>&#160;   }</div><div class="line"><a name="l04756"></a><span class="lineno"> 4756</span>&#160;</div><div class="line"><a name="l04757"></a><span class="lineno"> 4757</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d5/d16/module_8h.html#ad2ca15621101154f29748cf1dac3c3cf">ast_unregister_application</a>(<a class="code" href="../../d0/d60/res__fax_8c.html#a9029b2196b8587ea85bad4ac4b6174d7">app_sendfax</a>) &lt; 0) {</div><div class="line"><a name="l04758"></a><span class="lineno"> 4758</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;failed to unregister &#39;%s&#39;\n&quot;</span>, <a class="code" href="../../d0/d60/res__fax_8c.html#a9029b2196b8587ea85bad4ac4b6174d7">app_sendfax</a>);</div><div class="line"><a name="l04759"></a><span class="lineno"> 4759</span>&#160;   }</div><div class="line"><a name="l04760"></a><span class="lineno"> 4760</span>&#160;</div><div class="line"><a name="l04761"></a><span class="lineno"> 4761</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d5/d16/module_8h.html#ad2ca15621101154f29748cf1dac3c3cf">ast_unregister_application</a>(<a class="code" href="../../d0/d60/res__fax_8c.html#a39b1d432fa7056aa4737e302b608f8ee">app_receivefax</a>) &lt; 0) {</div><div class="line"><a name="l04762"></a><span class="lineno"> 4762</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;failed to unregister &#39;%s&#39;\n&quot;</span>, <a class="code" href="../../d0/d60/res__fax_8c.html#a39b1d432fa7056aa4737e302b608f8ee">app_receivefax</a>);</div><div class="line"><a name="l04763"></a><span class="lineno"> 4763</span>&#160;   }</div><div class="line"><a name="l04764"></a><span class="lineno"> 4764</span>&#160;</div><div class="line"><a name="l04765"></a><span class="lineno"> 4765</span>&#160;   <a class="code" href="../../df/d72/group__Group__AMI.html#gafadf012f66a9fd7ecf985ec5b9dee101">ast_manager_unregister</a>(<span class="stringliteral">&quot;FAXSessions&quot;</span>);</div><div class="line"><a name="l04766"></a><span class="lineno"> 4766</span>&#160;   <a class="code" href="../../df/d72/group__Group__AMI.html#gafadf012f66a9fd7ecf985ec5b9dee101">ast_manager_unregister</a>(<span class="stringliteral">&quot;FAXSession&quot;</span>);</div><div class="line"><a name="l04767"></a><span class="lineno"> 4767</span>&#160;   <a class="code" href="../../df/d72/group__Group__AMI.html#gafadf012f66a9fd7ecf985ec5b9dee101">ast_manager_unregister</a>(<span class="stringliteral">&quot;FAXStats&quot;</span>);</div><div class="line"><a name="l04768"></a><span class="lineno"> 4768</span>&#160;</div><div class="line"><a name="l04769"></a><span class="lineno"> 4769</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d0/d60/res__fax_8c.html#a3e8bec5eeb0e707450d6dab929fe3436">fax_logger_level</a> != -1) {</div><div class="line"><a name="l04770"></a><span class="lineno"> 4770</span>&#160;      <a class="code" href="../../d1/d8c/logger_8h.html#ae3d21782b3b66b21cda6d9e153545909">ast_logger_unregister_level</a>(<span class="stringliteral">&quot;FAX&quot;</span>);</div><div class="line"><a name="l04771"></a><span class="lineno"> 4771</span>&#160;   }</div><div class="line"><a name="l04772"></a><span class="lineno"> 4772</span>&#160;</div><div class="line"><a name="l04773"></a><span class="lineno"> 4773</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(<a class="code" href="../../d0/d60/res__fax_8c.html#a058b6772fcfe1ce5a1a0957e2f11d367">faxregistry</a>.container, -1);</div><div class="line"><a name="l04774"></a><span class="lineno"> 4774</span>&#160;</div><div class="line"><a name="l04775"></a><span class="lineno"> 4775</span>&#160;   <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l04776"></a><span class="lineno"> 4776</span>&#160;}</div><div class="line"><a name="l04777"></a><span class="lineno"> 4777</span>&#160;<span class="comment"></span></div><div class="line"><a name="l04778"></a><span class="lineno"> 4778</span>&#160;<span class="comment">/*!</span></div><div class="line"><a name="l04779"></a><span class="lineno"> 4779</span>&#160;<span class="comment"> * \brief Load the module</span></div><div class="line"><a name="l04780"></a><span class="lineno"> 4780</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l04781"></a><span class="lineno"> 4781</span>&#160;<span class="comment"> * Module loading including tests for configuration or dependencies.</span></div><div class="line"><a name="l04782"></a><span class="lineno"> 4782</span>&#160;<span class="comment"> * This function can return AST_MODULE_LOAD_FAILURE, AST_MODULE_LOAD_DECLINE,</span></div><div class="line"><a name="l04783"></a><span class="lineno"> 4783</span>&#160;<span class="comment"> * or AST_MODULE_LOAD_SUCCESS. If a dependency or environment variable fails</span></div><div class="line"><a name="l04784"></a><span class="lineno"> 4784</span>&#160;<span class="comment"> * tests return AST_MODULE_LOAD_FAILURE. If the module can not load the</span></div><div class="line"><a name="l04785"></a><span class="lineno"> 4785</span>&#160;<span class="comment"> * configuration file or other non-critical problem return</span></div><div class="line"><a name="l04786"></a><span class="lineno"> 4786</span>&#160;<span class="comment"> * AST_MODULE_LOAD_DECLINE. On success return AST_MODULE_LOAD_SUCCESS.</span></div><div class="line"><a name="l04787"></a><span class="lineno"> 4787</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l04788"></a><span class="lineno"><a class="line" href="../../d0/d60/res__fax_8c.html#ac3382bf6da54c56b37069bd76bbdf4f9"> 4788</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d0/d60/res__fax_8c.html#ac3382bf6da54c56b37069bd76bbdf4f9">load_module</a>(<span class="keywordtype">void</span>)</div><div class="line"><a name="l04789"></a><span class="lineno"> 4789</span>&#160;{</div><div class="line"><a name="l04790"></a><span class="lineno"> 4790</span>&#160;   <span class="keywordtype">int</span> res;</div><div class="line"><a name="l04791"></a><span class="lineno"> 4791</span>&#160;</div><div class="line"><a name="l04792"></a><span class="lineno"> 4792</span>&#160;   <span class="comment">/* initialize the registry */</span></div><div class="line"><a name="l04793"></a><span class="lineno"> 4793</span>&#160;   <a class="code" href="../../d0/d60/res__fax_8c.html#a058b6772fcfe1ce5a1a0957e2f11d367">faxregistry</a>.active_sessions = 0;</div><div class="line"><a name="l04794"></a><span class="lineno"> 4794</span>&#160;   <a class="code" href="../../d0/d60/res__fax_8c.html#a058b6772fcfe1ce5a1a0957e2f11d367">faxregistry</a>.reserved_sessions = 0;</div><div class="line"><a name="l04795"></a><span class="lineno"> 4795</span>&#160;   <a class="code" href="../../d0/d60/res__fax_8c.html#a058b6772fcfe1ce5a1a0957e2f11d367">faxregistry</a>.container = <a class="code" href="../../d5/da5/astobj2_8h.html#aefc16f8aa9087cbc5c55c70cf1dd41b2">ao2_container_alloc_hash</a>(<a class="code" href="../../d5/da5/astobj2_8h.html#a2cf7e3433f08351aafe3b0cd31edf7f8a8ccf751bd6749d062999469f0694e7ad">AO2_ALLOC_OPT_LOCK_MUTEX</a>, 0,</div><div class="line"><a name="l04796"></a><span class="lineno"> 4796</span>&#160;      <a class="code" href="../../d0/d60/res__fax_8c.html#a714cd8f82d821052b5bbd4b6234b5950">FAX_MAXBUCKETS</a>, <a class="code" href="../../d0/d60/res__fax_8c.html#a107e52e1d9d616990103fa9f54536f74">session_hash_cb</a>, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../d0/d60/res__fax_8c.html#a0696c5e15e0596da88b514beffeb6248">session_cmp_cb</a>);</div><div class="line"><a name="l04797"></a><span class="lineno"> 4797</span>&#160;   <span class="keywordflow">if</span> (!<a class="code" href="../../d0/d60/res__fax_8c.html#a058b6772fcfe1ce5a1a0957e2f11d367">faxregistry</a>.container) {</div><div class="line"><a name="l04798"></a><span class="lineno"> 4798</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../d5/d16/module_8h.html#adc09474f0ff557e9925b722ee5b952dfac742921e9f9512d28f62c74ea2affe57">AST_MODULE_LOAD_DECLINE</a>;</div><div class="line"><a name="l04799"></a><span class="lineno"> 4799</span>&#160;   }</div><div class="line"><a name="l04800"></a><span class="lineno"> 4800</span>&#160;</div><div class="line"><a name="l04801"></a><span class="lineno"> 4801</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d0/d60/res__fax_8c.html#a87b3eecb05c2a57012c6589329751a40">set_config</a>(0) &lt; 0) {</div><div class="line"><a name="l04802"></a><span class="lineno"> 4802</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;failed to load configuration file &#39;%s&#39;\n&quot;</span>, <a class="code" href="../../d0/d60/res__fax_8c.html#a65e5109273690c9fa64f70d4860c6647">config</a>);</div><div class="line"><a name="l04803"></a><span class="lineno"> 4803</span>&#160;      <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(<a class="code" href="../../d0/d60/res__fax_8c.html#a058b6772fcfe1ce5a1a0957e2f11d367">faxregistry</a>.container, -1);</div><div class="line"><a name="l04804"></a><span class="lineno"> 4804</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../d5/d16/module_8h.html#adc09474f0ff557e9925b722ee5b952dfac742921e9f9512d28f62c74ea2affe57">AST_MODULE_LOAD_DECLINE</a>;</div><div class="line"><a name="l04805"></a><span class="lineno"> 4805</span>&#160;   }</div><div class="line"><a name="l04806"></a><span class="lineno"> 4806</span>&#160;</div><div class="line"><a name="l04807"></a><span class="lineno"> 4807</span>&#160;   <span class="comment">/* register CLI operations and applications */</span></div><div class="line"><a name="l04808"></a><span class="lineno"> 4808</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d5/d16/module_8h.html#afba4eb7a910b10969041ae4cd488729d">ast_register_application_xml</a>(<a class="code" href="../../d0/d60/res__fax_8c.html#a9029b2196b8587ea85bad4ac4b6174d7">app_sendfax</a>, <a class="code" href="../../d0/d60/res__fax_8c.html#a69d3cd379ff7db5b4f5689f515f9a2ce">sendfax_exec</a>) &lt; 0) {</div><div class="line"><a name="l04809"></a><span class="lineno"> 4809</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;failed to register &#39;%s&#39;.\n&quot;</span>, <a class="code" href="../../d0/d60/res__fax_8c.html#a9029b2196b8587ea85bad4ac4b6174d7">app_sendfax</a>);</div><div class="line"><a name="l04810"></a><span class="lineno"> 4810</span>&#160;      <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(<a class="code" href="../../d0/d60/res__fax_8c.html#a058b6772fcfe1ce5a1a0957e2f11d367">faxregistry</a>.container, -1);</div><div class="line"><a name="l04811"></a><span class="lineno"> 4811</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../d5/d16/module_8h.html#adc09474f0ff557e9925b722ee5b952dfac742921e9f9512d28f62c74ea2affe57">AST_MODULE_LOAD_DECLINE</a>;</div><div class="line"><a name="l04812"></a><span class="lineno"> 4812</span>&#160;   }</div><div class="line"><a name="l04813"></a><span class="lineno"> 4813</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d5/d16/module_8h.html#afba4eb7a910b10969041ae4cd488729d">ast_register_application_xml</a>(<a class="code" href="../../d0/d60/res__fax_8c.html#a39b1d432fa7056aa4737e302b608f8ee">app_receivefax</a>, <a class="code" href="../../d0/d60/res__fax_8c.html#a73c65030688bef51d1d09e342f261a0f">receivefax_exec</a>) &lt; 0) {</div><div class="line"><a name="l04814"></a><span class="lineno"> 4814</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;failed to register &#39;%s&#39;.\n&quot;</span>, <a class="code" href="../../d0/d60/res__fax_8c.html#a39b1d432fa7056aa4737e302b608f8ee">app_receivefax</a>);</div><div class="line"><a name="l04815"></a><span class="lineno"> 4815</span>&#160;      <a class="code" href="../../d5/d16/module_8h.html#ad2ca15621101154f29748cf1dac3c3cf">ast_unregister_application</a>(<a class="code" href="../../d0/d60/res__fax_8c.html#a9029b2196b8587ea85bad4ac4b6174d7">app_sendfax</a>);</div><div class="line"><a name="l04816"></a><span class="lineno"> 4816</span>&#160;      <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(<a class="code" href="../../d0/d60/res__fax_8c.html#a058b6772fcfe1ce5a1a0957e2f11d367">faxregistry</a>.container, -1);</div><div class="line"><a name="l04817"></a><span class="lineno"> 4817</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../d5/d16/module_8h.html#adc09474f0ff557e9925b722ee5b952dfac742921e9f9512d28f62c74ea2affe57">AST_MODULE_LOAD_DECLINE</a>;</div><div class="line"><a name="l04818"></a><span class="lineno"> 4818</span>&#160;   }</div><div class="line"><a name="l04819"></a><span class="lineno"> 4819</span>&#160;</div><div class="line"><a name="l04820"></a><span class="lineno"> 4820</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../db/d45/manager_8h.html#a5b63b8a8faede2d852e071e1f7b31c11">ast_manager_register_xml</a>(<span class="stringliteral">&quot;FAXSessions&quot;</span>, <a class="code" href="../../db/d45/manager_8h.html#ab5db3cc603d7e798d61cb4cd94fbb4e2">EVENT_FLAG_CALL</a>, <a class="code" href="../../d0/d60/res__fax_8c.html#af31af245716f15330db91e03ef9cfe15">manager_fax_sessions</a>)) {</div><div class="line"><a name="l04821"></a><span class="lineno"> 4821</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;failed to register &#39;FAXSessions&#39; AMI command.\n&quot;</span>);</div><div class="line"><a name="l04822"></a><span class="lineno"> 4822</span>&#160;      <a class="code" href="../../d5/d16/module_8h.html#ad2ca15621101154f29748cf1dac3c3cf">ast_unregister_application</a>(<a class="code" href="../../d0/d60/res__fax_8c.html#a39b1d432fa7056aa4737e302b608f8ee">app_receivefax</a>);</div><div class="line"><a name="l04823"></a><span class="lineno"> 4823</span>&#160;      <a class="code" href="../../d5/d16/module_8h.html#ad2ca15621101154f29748cf1dac3c3cf">ast_unregister_application</a>(<a class="code" href="../../d0/d60/res__fax_8c.html#a9029b2196b8587ea85bad4ac4b6174d7">app_sendfax</a>);</div><div class="line"><a name="l04824"></a><span class="lineno"> 4824</span>&#160;      <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(<a class="code" href="../../d0/d60/res__fax_8c.html#a058b6772fcfe1ce5a1a0957e2f11d367">faxregistry</a>.container, -1);</div><div class="line"><a name="l04825"></a><span class="lineno"> 4825</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../d5/d16/module_8h.html#adc09474f0ff557e9925b722ee5b952dfac742921e9f9512d28f62c74ea2affe57">AST_MODULE_LOAD_DECLINE</a>;</div><div class="line"><a name="l04826"></a><span class="lineno"> 4826</span>&#160;   }</div><div class="line"><a name="l04827"></a><span class="lineno"> 4827</span>&#160;</div><div class="line"><a name="l04828"></a><span class="lineno"> 4828</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../db/d45/manager_8h.html#a5b63b8a8faede2d852e071e1f7b31c11">ast_manager_register_xml</a>(<span class="stringliteral">&quot;FAXSession&quot;</span>, <a class="code" href="../../db/d45/manager_8h.html#ab5db3cc603d7e798d61cb4cd94fbb4e2">EVENT_FLAG_CALL</a>, <a class="code" href="../../d0/d60/res__fax_8c.html#aaacf4ac8f8a199b23f61f1fd37982940">manager_fax_session</a>)) {</div><div class="line"><a name="l04829"></a><span class="lineno"> 4829</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;failed to register &#39;FAXSession&#39; AMI command.\n&quot;</span>);</div><div class="line"><a name="l04830"></a><span class="lineno"> 4830</span>&#160;      <a class="code" href="../../df/d72/group__Group__AMI.html#gafadf012f66a9fd7ecf985ec5b9dee101">ast_manager_unregister</a>(<span class="stringliteral">&quot;FAXSession&quot;</span>);</div><div class="line"><a name="l04831"></a><span class="lineno"> 4831</span>&#160;      <a class="code" href="../../d5/d16/module_8h.html#ad2ca15621101154f29748cf1dac3c3cf">ast_unregister_application</a>(<a class="code" href="../../d0/d60/res__fax_8c.html#a39b1d432fa7056aa4737e302b608f8ee">app_receivefax</a>);</div><div class="line"><a name="l04832"></a><span class="lineno"> 4832</span>&#160;      <a class="code" href="../../d5/d16/module_8h.html#ad2ca15621101154f29748cf1dac3c3cf">ast_unregister_application</a>(<a class="code" href="../../d0/d60/res__fax_8c.html#a9029b2196b8587ea85bad4ac4b6174d7">app_sendfax</a>);</div><div class="line"><a name="l04833"></a><span class="lineno"> 4833</span>&#160;      <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(<a class="code" href="../../d0/d60/res__fax_8c.html#a058b6772fcfe1ce5a1a0957e2f11d367">faxregistry</a>.container, -1);</div><div class="line"><a name="l04834"></a><span class="lineno"> 4834</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../d5/d16/module_8h.html#adc09474f0ff557e9925b722ee5b952dfac742921e9f9512d28f62c74ea2affe57">AST_MODULE_LOAD_DECLINE</a>;</div><div class="line"><a name="l04835"></a><span class="lineno"> 4835</span>&#160;   }</div><div class="line"><a name="l04836"></a><span class="lineno"> 4836</span>&#160;</div><div class="line"><a name="l04837"></a><span class="lineno"> 4837</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../db/d45/manager_8h.html#a5b63b8a8faede2d852e071e1f7b31c11">ast_manager_register_xml</a>(<span class="stringliteral">&quot;FAXStats&quot;</span>, <a class="code" href="../../db/d45/manager_8h.html#a0b1b4140c2836696a6950e92ab48a580">EVENT_FLAG_REPORTING</a>, <a class="code" href="../../d0/d60/res__fax_8c.html#abe5fc760b71dee05a818bb0df9639e36">manager_fax_stats</a>)) {</div><div class="line"><a name="l04838"></a><span class="lineno"> 4838</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;failed to register &#39;FAXStats&#39; AMI command.\n&quot;</span>);</div><div class="line"><a name="l04839"></a><span class="lineno"> 4839</span>&#160;      <a class="code" href="../../df/d72/group__Group__AMI.html#gafadf012f66a9fd7ecf985ec5b9dee101">ast_manager_unregister</a>(<span class="stringliteral">&quot;FAXSession&quot;</span>);</div><div class="line"><a name="l04840"></a><span class="lineno"> 4840</span>&#160;      <a class="code" href="../../df/d72/group__Group__AMI.html#gafadf012f66a9fd7ecf985ec5b9dee101">ast_manager_unregister</a>(<span class="stringliteral">&quot;FAXSessions&quot;</span>);</div><div class="line"><a name="l04841"></a><span class="lineno"> 4841</span>&#160;      <a class="code" href="../../d5/d16/module_8h.html#ad2ca15621101154f29748cf1dac3c3cf">ast_unregister_application</a>(<a class="code" href="../../d0/d60/res__fax_8c.html#a39b1d432fa7056aa4737e302b608f8ee">app_receivefax</a>);</div><div class="line"><a name="l04842"></a><span class="lineno"> 4842</span>&#160;      <a class="code" href="../../d5/d16/module_8h.html#ad2ca15621101154f29748cf1dac3c3cf">ast_unregister_application</a>(<a class="code" href="../../d0/d60/res__fax_8c.html#a9029b2196b8587ea85bad4ac4b6174d7">app_sendfax</a>);</div><div class="line"><a name="l04843"></a><span class="lineno"> 4843</span>&#160;      <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(<a class="code" href="../../d0/d60/res__fax_8c.html#a058b6772fcfe1ce5a1a0957e2f11d367">faxregistry</a>.container, -1);</div><div class="line"><a name="l04844"></a><span class="lineno"> 4844</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../d5/d16/module_8h.html#adc09474f0ff557e9925b722ee5b952dfac742921e9f9512d28f62c74ea2affe57">AST_MODULE_LOAD_DECLINE</a>;</div><div class="line"><a name="l04845"></a><span class="lineno"> 4845</span>&#160;   }</div><div class="line"><a name="l04846"></a><span class="lineno"> 4846</span>&#160;</div><div class="line"><a name="l04847"></a><span class="lineno"> 4847</span>&#160;   <a class="code" href="../../dc/db0/cli_8h.html#aea8910ed9e301e7f741f87942c244eac">ast_cli_register_multiple</a>(fax_cli, <a class="code" href="../../de/dfe/isdn__lib_8c.html#ab9129b977a587b50ea801daac75e178f">ARRAY_LEN</a>(fax_cli));</div><div class="line"><a name="l04848"></a><span class="lineno"> 4848</span>&#160;   res = <a class="code" href="../../db/de0/pbx_8h.html#a8af0e93442a9e468425f63cc52b0ac7b">ast_custom_function_register</a>(&amp;acf_faxopt);</div><div class="line"><a name="l04849"></a><span class="lineno"> 4849</span>&#160;   <a class="code" href="../../d0/d60/res__fax_8c.html#a3e8bec5eeb0e707450d6dab929fe3436">fax_logger_level</a> = <a class="code" href="../../d1/d8c/logger_8h.html#aa689efaaa503de6322c2b13b3faab63d">ast_logger_register_level</a>(<span class="stringliteral">&quot;FAX&quot;</span>);</div><div class="line"><a name="l04850"></a><span class="lineno"> 4850</span>&#160;</div><div class="line"><a name="l04851"></a><span class="lineno"> 4851</span>&#160;   <span class="keywordflow">return</span> res;</div><div class="line"><a name="l04852"></a><span class="lineno"> 4852</span>&#160;}</div><div class="line"><a name="l04853"></a><span class="lineno"> 4853</span>&#160;</div><div class="line"><a name="l04854"></a><span class="lineno"><a class="line" href="../../d0/d60/res__fax_8c.html#a7c6ac25ea7536c0bc9ed18cbcf917527"> 4854</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d0/d60/res__fax_8c.html#a7c6ac25ea7536c0bc9ed18cbcf917527">reload_module</a>(<span class="keywordtype">void</span>)</div><div class="line"><a name="l04855"></a><span class="lineno"> 4855</span>&#160;{</div><div class="line"><a name="l04856"></a><span class="lineno"> 4856</span>&#160;   <a class="code" href="../../d0/d60/res__fax_8c.html#a87b3eecb05c2a57012c6589329751a40">set_config</a>(1);</div><div class="line"><a name="l04857"></a><span class="lineno"> 4857</span>&#160;   <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l04858"></a><span class="lineno"> 4858</span>&#160;}</div><div class="line"><a name="l04859"></a><span class="lineno"> 4859</span>&#160;</div><div class="line"><a name="l04860"></a><span class="lineno"> 4860</span>&#160;</div><div class="line"><a name="l04861"></a><span class="lineno"> 4861</span>&#160;<a class="code" href="../../d9/de9/res__phoneprov_8c.html#addaa208b0ed785225e24490fb9f28a80">AST_MODULE_INFO</a>(<a class="code" href="../../d5/d16/module_8h.html#aba2c8d4be709a254658b21a834f8294a">ASTERISK_GPL_KEY</a>, <a class="code" href="../../d5/d16/module_8h.html#a155a0df9c59e04e305d4a2fa3e35f843a835b27a90d895a488e4e14cc3d2dee8c">AST_MODFLAG_GLOBAL_SYMBOLS</a> | <a class="code" href="../../d5/d16/module_8h.html#a155a0df9c59e04e305d4a2fa3e35f843a12c3f60dd7655dfa8d4430cbf04b1223">AST_MODFLAG_LOAD_ORDER</a>, <span class="stringliteral">&quot;Generic FAX Applications&quot;</span>,</div><div class="line"><a name="l04862"></a><span class="lineno"> 4862</span>&#160;   .support_level = <a class="code" href="../../d5/d16/module_8h.html#ab35bc4efd9f79706300965c9d36a0ce5a634484c0074e7b6b630756fab09e2c15">AST_MODULE_SUPPORT_CORE</a>,</div><div class="line"><a name="l04863"></a><span class="lineno"> 4863</span>&#160;   .load = <a class="code" href="../../d0/d60/res__fax_8c.html#ac3382bf6da54c56b37069bd76bbdf4f9">load_module</a>,</div><div class="line"><a name="l04864"></a><span class="lineno"> 4864</span>&#160;   .unload = <a class="code" href="../../d0/d60/res__fax_8c.html#ad09fa931f468002152a3cc2d5ce25eae">unload_module</a>,</div><div class="line"><a name="l04865"></a><span class="lineno"> 4865</span>&#160;   .<a class="code" href="../../d0/d29/cdr__mysql_8c.html#ad1982509765f4870f1f63412a53ea668">reload</a> = <a class="code" href="../../d0/d60/res__fax_8c.html#a7c6ac25ea7536c0bc9ed18cbcf917527">reload_module</a>,</div><div class="line"><a name="l04866"></a><span class="lineno"> 4866</span>&#160;   .load_pri = <a class="code" href="../../d5/d16/module_8h.html#aa4f734041ffd9d75b07cefb0291e1e58a08d902290b0d6cbffd8e607d5e399a06">AST_MODPRI_APP_DEPEND</a>,</div><div class="line"><a name="l04867"></a><span class="lineno"><a class="line" href="../../d0/d60/res__fax_8c.html#a4fb0aca9bbcdb9709fa52a70aded6cae"> 4867</a></span>&#160;);</div><div class="ttc" id="structast__custom__function_html_afcd1706c9144e6d6eee6127661ae3be2"><div class="ttname"><a href="../../db/dc0/structast__custom__function.html#afcd1706c9144e6d6eee6127661ae3be2">ast_custom_function::name</a></div><div class="ttdeci">const char * name</div><div class="ttdef"><b>Definition:</b> <a href="../../db/de0/pbx_8h_source.html#l00119">pbx.h:119</a></div></div>
<div class="ttc" id="res__fax_8c_html_a73bbffb792649ab5cb9278a0476a7ddd"><div class="ttname"><a href="../../d0/d60/res__fax_8c.html#a73bbffb792649ab5cb9278a0476a7ddd">RES_FAX_MINRATE</a></div><div class="ttdeci">#define RES_FAX_MINRATE</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d60/res__fax_8c_source.html#l00522">res_fax.c:522</a></div></div>
<div class="ttc" id="res__fax_8c_html_a73c65030688bef51d1d09e342f261a0f"><div class="ttname"><a href="../../d0/d60/res__fax_8c.html#a73c65030688bef51d1d09e342f261a0f">receivefax_exec</a></div><div class="ttdeci">static int receivefax_exec(struct ast_channel *chan, const char *data)</div><div class="ttdoc">initiate a receive FAX session </div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d60/res__fax_8c_source.html#l02082">res_fax.c:2082</a></div></div>
<div class="ttc" id="channel_8h_html_a4cd990f4c1cd0c2af6e4c63f6d15b4e1ab6834ded836bd85b489322f04984d274"><div class="ttname"><a href="../../d5/d7b/channel_8h.html#a4cd990f4c1cd0c2af6e4c63f6d15b4e1ab6834ded836bd85b489322f04984d274">T38_STATE_UNKNOWN</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d7b/channel_8h_source.html#l00881">channel.h:881</a></div></div>
<div class="ttc" id="channel_8h_html_ac2dc872b606534943c98304aed841b34"><div class="ttname"><a href="../../d5/d7b/channel_8h.html#ac2dc872b606534943c98304aed841b34">ast_channel_caller</a></div><div class="ttdeci">struct ast_party_caller * ast_channel_caller(struct ast_channel *chan)</div><div class="ttdef"><b>Definition:</b> <a href="../../db/de2/channel__internal__api_8c_source.html#l00888">channel_internal_api.c:888</a></div></div>
<div class="ttc" id="structast__datastore__info_html_a763fd8db6bba8fbbbc113ca0d61c47c2"><div class="ttname"><a href="../../d9/dfb/structast__datastore__info.html#a763fd8db6bba8fbbbc113ca0d61c47c2">ast_datastore_info::type</a></div><div class="ttdeci">const char * type</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/db6/datastore_8h_source.html#l00032">datastore.h:32</a></div></div>
<div class="ttc" id="structast__framehook__interface_html_ab6d7b6f8c2ceaba7acda80aaf05f4899"><div class="ttname"><a href="../../d3/d7b/structast__framehook__interface.html#ab6d7b6f8c2ceaba7acda80aaf05f4899">ast_framehook_interface::version</a></div><div class="ttdeci">uint16_t version</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d3c/framehook_8h_source.html#l00231">framehook.h:231</a></div></div>
<div class="ttc" id="structast__variable_html_afaaf66cc5029a563bd0bb9df076ea14b"><div class="ttname"><a href="../../dd/d02/structast__variable.html#afaaf66cc5029a563bd0bb9df076ea14b">ast_variable::next</a></div><div class="ttdeci">struct ast_variable * next</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/de6/include_2asterisk_2config_8h_source.html#l00090">include/asterisk/config.h:90</a></div></div>
<div class="ttc" id="channel_8h_html_a1b22ea5302ef183fa68bc45bfb0659c9"><div class="ttname"><a href="../../d5/d7b/channel_8h.html#a1b22ea5302ef183fa68bc45bfb0659c9">ast_channel_get_t38_state</a></div><div class="ttdeci">static enum ast_t38_state ast_channel_get_t38_state(struct ast_channel *chan)</div><div class="ttdoc">Retrieves the current T38 state of a channel. </div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d7b/channel_8h_source.html#l02873">channel.h:2873</a></div></div>
<div class="ttc" id="structast__fax__session__details_html_a17c89d9cdcac0df0f2039f065b7cf0ed"><div class="ttname"><a href="../../d8/dc2/structast__fax__session__details.html#a17c89d9cdcac0df0f2039f065b7cf0ed">ast_fax_session_details::result</a></div><div class="ttdeci">const ast_string_field result</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d6a/res__fax_8h_source.html#l00142">res_fax.h:142</a></div></div>
<div class="ttc" id="structast__fax__tech_html_a5c75cdace0414b0bafc3c946980d7417"><div class="ttname"><a href="../../d9/d0e/structast__fax__tech.html#a5c75cdace0414b0bafc3c946980d7417">ast_fax_tech::switch_to_t38</a></div><div class="ttdeci">int(*const switch_to_t38)(struct ast_fax_session *)</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d6a/res__fax_8h_source.html#l00265">res_fax.h:265</a></div></div>
<div class="ttc" id="res__fax_8c_html_ac80e2d8faf47cb500e4b85bb8d2c97ee"><div class="ttname"><a href="../../d0/d60/res__fax_8c.html#ac80e2d8faf47cb500e4b85bb8d2c97ee">fax_complete</a></div><div class="ttdeci">int fax_complete</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d60/res__fax_8c_source.html#l00508">res_fax.c:508</a></div></div>
<div class="ttc" id="structast__framehook__interface_html"><div class="ttname"><a href="../../d3/d7b/structast__framehook__interface.html">ast_framehook_interface</a></div><div class="ttdef"><b>Definition:</b> <a href="../../db/d3c/framehook_8h_source.html#l00229">framehook.h:229</a></div></div>
<div class="ttc" id="res__fax_8c_html_aaf76f6af8369f4ef489b676433f3e255"><div class="ttname"><a href="../../d0/d60/res__fax_8c.html#aaf76f6af8369f4ef489b676433f3e255">GENERIC_FAX_EXEC_ERROR</a></div><div class="ttdeci">#define GENERIC_FAX_EXEC_ERROR(fax, chan, errorstr, reason)</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d60/res__fax_8c_source.html#l01485">res_fax.c:1485</a></div></div>
<div class="ttc" id="indications_8h_html"><div class="ttname"><a href="../../d2/d0f/indications_8h.html">indications.h</a></div><div class="ttdoc">Tone Indication Support. </div></div>
<div class="ttc" id="lock_8h_html_a7330ac9d36b05bad68b188c2dcfa42d7"><div class="ttname"><a href="../../dd/d42/lock_8h.html#a7330ac9d36b05bad68b188c2dcfa42d7">ast_rwlock_rdlock</a></div><div class="ttdeci">#define ast_rwlock_rdlock(a)</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d42/lock_8h_source.html#l00233">lock.h:233</a></div></div>
<div class="ttc" id="channel_8h_html_a493bdebe876caafb8ee535853310364a"><div class="ttname"><a href="../../d5/d7b/channel_8h.html#a493bdebe876caafb8ee535853310364a">ast_channel_lock</a></div><div class="ttdeci">#define ast_channel_lock(chan)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d7b/channel_8h_source.html#l02945">channel.h:2945</a></div></div>
<div class="ttc" id="format_8h_html_a79bdf0b3c0616d9950d00cfeb62295c3ab1e8c1a0f8b4a1ecb6a2109992636859"><div class="ttname"><a href="../../d0/d0a/format_8h.html#a79bdf0b3c0616d9950d00cfeb62295c3ab1e8c1a0f8b4a1ecb6a2109992636859">AST_FORMAT_CMP_EQUAL</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d0a/format_8h_source.html#l00036">format.h:36</a></div></div>
<div class="ttc" id="dsp_8h_html_ab6387ee12a3544d3d2068db61d9576ad"><div class="ttname"><a href="../../d3/d08/dsp_8h.html#ab6387ee12a3544d3d2068db61d9576ad">ast_dsp_process</a></div><div class="ttdeci">struct ast_frame * ast_dsp_process(struct ast_channel *chan, struct ast_dsp *dsp, struct ast_frame *inf)</div><div class="ttdoc">Return AST_FRAME_NULL frames when there is silence, AST_FRAME_BUSY on busies, and call progress...</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d3b/dsp_8c_source.html#l01494">dsp.c:1494</a></div></div>
<div class="ttc" id="structast__channel_html"><div class="ttname"><a href="../../df/d3c/structast__channel.html">ast_channel</a></div><div class="ttdoc">Main Channel structure associated with a channel. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/de2/channel__internal__api_8c_source.html#l00073">channel_internal_api.c:73</a></div></div>
<div class="ttc" id="res__fax_8c_html_a2fccc15f81746e2ae5f88df9e88f3a7a"><div class="ttname"><a href="../../d0/d60/res__fax_8c.html#a2fccc15f81746e2ae5f88df9e88f3a7a">fax_exec_options</a></div><div class="ttdeci">static const struct ast_app_option fax_exec_options[128]</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d60/res__fax_8c_source.html#l00575">res_fax.c:575</a></div></div>
<div class="ttc" id="res__fax_8c_html_a24d642cdb140e5795c10802786bf991f"><div class="ttname"><a href="../../d0/d60/res__fax_8c.html#a24d642cdb140e5795c10802786bf991f">receivefax_t38_init</a></div><div class="ttdeci">static int receivefax_t38_init(struct ast_channel *chan, struct ast_fax_session_details *details)</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d60/res__fax_8c_source.html#l01856">res_fax.c:1856</a></div></div>
<div class="ttc" id="res__fax_8c_html_a099616a85b16965265642eae545d12ac"><div class="ttname"><a href="../../d0/d60/res__fax_8c.html#a099616a85b16965265642eae545d12ac">manager_fax_sessions_entry</a></div><div class="ttdeci">static int manager_fax_sessions_entry(struct mansession *s, struct ast_fax_session *session, const char *id_text)</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d60/res__fax_8c_source.html#l04317">res_fax.c:4317</a></div></div>
<div class="ttc" id="cli_8h_html_a5c4130cf8f1e93acfdd84416cebf1aef"><div class="ttname"><a href="../../dc/db0/cli_8h.html#a5c4130cf8f1e93acfdd84416cebf1aef">AST_CLI_DEFINE</a></div><div class="ttdeci">#define AST_CLI_DEFINE(fn, txt,...)</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/db0/cli_8h_source.html#l00197">cli.h:197</a></div></div>
<div class="ttc" id="res__fax_8c_html_a8b3821747db8167c6ff68a5fdf3b073e"><div class="ttname"><a href="../../d0/d60/res__fax_8c.html#a8b3821747db8167c6ff68a5fdf3b073e">our_t38_parameters</a></div><div class="ttdeci">static struct ast_control_t38_parameters our_t38_parameters</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d60/res__fax_8c_source.html#l00733">res_fax.c:733</a></div></div>
<div class="ttc" id="json_8h_html_a0ca956b7df20127f7e38993c3c06cb2c"><div class="ttname"><a href="../../d4/d05/json_8h.html#a0ca956b7df20127f7e38993c3c06cb2c">ast_json_ref</a></div><div class="ttdeci">struct ast_json * ast_json_ref(struct ast_json *value)</div><div class="ttdoc">Increase refcount on value. </div><div class="ttdef"><b>Definition:</b> <a href="../../df/d98/json_8c_source.html#l00067">json.c:67</a></div></div>
<div class="ttc" id="structdebug__info__history_html"><div class="ttname"><a href="../../d2/d1c/structdebug__info__history.html">debug_info_history</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d60/res__fax_8c_source.html#l00431">res_fax.c:431</a></div></div>
<div class="ttc" id="res__fax_8h_html_a54eb45ad548b874cf12d0a599631e3f6add135550dca7400fb80e250a63a54887"><div class="ttname"><a href="../../db/d6a/res__fax_8h.html#a54eb45ad548b874cf12d0a599631e3f6add135550dca7400fb80e250a63a54887">AST_FAX_TECH_GATEWAY</a></div><div class="ttdef"><b>Definition:</b> <a href="../../db/d6a/res__fax_8h_source.html#l00047">res_fax.h:47</a></div></div>
<div class="ttc" id="structmessage_html"><div class="ttname"><a href="../../d8/d9e/structmessage.html">message</a></div><div class="ttdef"><b>Definition:</b> <a href="../../db/d45/manager_8h_source.html#l00144">manager.h:144</a></div></div>
<div class="ttc" id="res__fax_8h_html_a748e0695940b2d6145b9646387daa4db"><div class="ttname"><a href="../../db/d6a/res__fax_8h.html#a748e0695940b2d6145b9646387daa4db">AST_FAX_FRFLAG_GATEWAY</a></div><div class="ttdeci">#define AST_FAX_FRFLAG_GATEWAY</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d6a/res__fax_8h_source.html#l00232">res_fax.h:232</a></div></div>
<div class="ttc" id="structast__fax__document_html"><div class="ttname"><a href="../../d2/db8/structast__fax__document.html">ast_fax_document</a></div><div class="ttdef"><b>Definition:</b> <a href="../../db/d6a/res__fax_8h_source.html#l00102">res_fax.h:102</a></div></div>
<div class="ttc" id="res__fax_8c_html_a578823f8ca07fcdd9b31030679259c47"><div class="ttname"><a href="../../d0/d60/res__fax_8c.html#a578823f8ca07fcdd9b31030679259c47">fax_tx_attempts</a></div><div class="ttdeci">int fax_tx_attempts</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d60/res__fax_8c_source.html#l00504">res_fax.c:504</a></div></div>
<div class="ttc" id="structast__frame__subclass_html"><div class="ttname"><a href="../../d1/d9f/structast__frame__subclass.html">ast_frame_subclass</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d66/include_2asterisk_2frame_8h_source.html#l00150">include/asterisk/frame.h:150</a></div></div>
<div class="ttc" id="lock_8h_html"><div class="ttname"><a href="../../dd/d42/lock_8h.html">lock.h</a></div><div class="ttdoc">Asterisk locking-related definitions: </div></div>
<div class="ttc" id="group__Group__AMI_html_gac2d42f7be13c532b6a70d50f1b8983d2"><div class="ttname"><a href="../../df/d72/group__Group__AMI.html#gac2d42f7be13c532b6a70d50f1b8983d2">astman_append</a></div><div class="ttdeci">void astman_append(struct mansession *s, const char *fmt,...)</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d10/manager_8c_source.html#l03080">manager.c:3080</a></div></div>
<div class="ttc" id="stasis__channels_8h_html"><div class="ttname"><a href="../../d9/d4a/stasis__channels_8h.html">stasis_channels.h</a></div></div>
<div class="ttc" id="asterisk_8h_html"><div class="ttname"><a href="../../db/db2/asterisk_8h.html">asterisk.h</a></div><div class="ttdoc">Asterisk main include file. File version handling, generic pbx functions. </div></div>
<div class="ttc" id="structast__fax__session_html_a4ac6ff3775e67c710cd55bc7dfd592fe"><div class="ttname"><a href="../../d1/d16/structast__fax__session.html#a4ac6ff3775e67c710cd55bc7dfd592fe">ast_fax_session::tech</a></div><div class="ttdeci">const struct ast_fax_tech * tech</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d6a/res__fax_8h_source.html#l00214">res_fax.h:214</a></div></div>
<div class="ttc" id="linkedlists_8h_html_adf1959c5c03a3a706da97ad2f49617e5"><div class="ttname"><a href="../../df/d90/linkedlists_8h.html#adf1959c5c03a3a706da97ad2f49617e5">AST_LIST_FIRST</a></div><div class="ttdeci">#define AST_LIST_FIRST(head)</div><div class="ttdoc">Returns the first entry contained in a list. </div><div class="ttdef"><b>Definition:</b> <a href="../../df/d90/linkedlists_8h_source.html#l00420">linkedlists.h:420</a></div></div>
<div class="ttc" id="structast__fax__session__details_html_a50d4d0d4e0ae5aae877a0e6d2faa9517"><div class="ttname"><a href="../../d8/dc2/structast__fax__session__details.html#a50d4d0d4e0ae5aae877a0e6d2faa9517">ast_fax_session_details::t38timeout</a></div><div class="ttdeci">unsigned int t38timeout</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d6a/res__fax_8h_source.html#l00179">res_fax.h:179</a></div></div>
<div class="ttc" id="res__fax_8c_html_ab801f87cf8e5b82381bec2e68c73ffbf"><div class="ttname"><a href="../../d0/d60/res__fax_8c.html#ab801f87cf8e5b82381bec2e68c73ffbf">active_sessions</a></div><div class="ttdeci">int active_sessions</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d60/res__fax_8c_source.html#l00498">res_fax.c:498</a></div></div>
<div class="ttc" id="res__fax_8c_html_ad43f70b44389967e168e43ee8df32201"><div class="ttname"><a href="../../d0/d60/res__fax_8c.html#ad43f70b44389967e168e43ee8df32201">destroy_faxdetect</a></div><div class="ttdeci">static void destroy_faxdetect(void *data)</div><div class="ttdoc">destroy a FAX detect structure </div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d60/res__fax_8c_source.html#l03676">res_fax.c:3676</a></div></div>
<div class="ttc" id="astobj2_8h_html_a512cc40ce96c63b3d5c78040baa4c9cd"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#a512cc40ce96c63b3d5c78040baa4c9cd">ao2_container_count</a></div><div class="ttdeci">int ao2_container_count(struct ao2_container *c)</div><div class="ttdoc">Returns the number of elements in a container. </div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d22/astobj2__container_8c_source.html#l00034">astobj2_container.c:34</a></div></div>
<div class="ttc" id="lock_8h_html_a7443635fb39ae2aa946e2373dada3ac7"><div class="ttname"><a href="../../dd/d42/lock_8h.html#a7443635fb39ae2aa946e2373dada3ac7">AST_RWLOCK_DEFINE_STATIC</a></div><div class="ttdeci">#define AST_RWLOCK_DEFINE_STATIC(rwlock)</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d42/lock_8h_source.html#l00541">lock.h:541</a></div></div>
<div class="ttc" id="res__fax_8c_html_a40f6174b24063f05bea58bf6288b14e0"><div class="ttname"><a href="../../d0/d60/res__fax_8c.html#a40f6174b24063f05bea58bf6288b14e0">destroy_session_details</a></div><div class="ttdeci">static void destroy_session_details(void *details)</div><div class="ttdoc">destroy a FAX session details structure </div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d60/res__fax_8c_source.html#l00684">res_fax.c:684</a></div></div>
<div class="ttc" id="structfaxmodules_html"><div class="ttname"><a href="../../df/d07/structfaxmodules.html">faxmodules</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d60/res__fax_8c_source.html#l00520">res_fax.c:520</a></div></div>
<div class="ttc" id="isdn__lib_8c_html_ab9129b977a587b50ea801daac75e178f"><div class="ttname"><a href="../../de/dfe/isdn__lib_8c.html#ab9129b977a587b50ea801daac75e178f">ARRAY_LEN</a></div><div class="ttdeci">#define ARRAY_LEN(a)</div><div class="ttdef"><b>Definition:</b> <a href="../../de/dfe/isdn__lib_8c_source.html#l00042">isdn_lib.c:42</a></div></div>
<div class="ttc" id="structfax__options_html_af766692698b742acddbc42494d323a9f"><div class="ttname"><a href="../../d0/d28/structfax__options.html#af766692698b742acddbc42494d323a9f">fax_options::ecm</a></div><div class="ttdeci">uint32_t ecm</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d60/res__fax_8c_source.html#l00531">res_fax.c:531</a></div></div>
<div class="ttc" id="structast__fax__tech_html_a591895ebcfb08392338b8836c5afa281"><div class="ttname"><a href="../../d9/d0e/structast__fax__tech.html#a591895ebcfb08392338b8836c5afa281">ast_fax_tech::generate_silence</a></div><div class="ttdeci">int(*const generate_silence)(struct ast_fax_session *)</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d6a/res__fax_8h_source.html#l00263">res_fax.h:263</a></div></div>
<div class="ttc" id="res__fax_8h_html_a1838c71fcf68c3cfe0ce37e35e77406dabd9b4a57405ba5c0c884ac98746a8bd7"><div class="ttname"><a href="../../db/d6a/res__fax_8h.html#a1838c71fcf68c3cfe0ce37e35e77406dabd9b4a57405ba5c0c884ac98746a8bd7">AST_FAX_OPTFLAG_TRUE</a></div><div class="ttdef"><b>Definition:</b> <a href="../../db/d6a/res__fax_8h_source.html#l00087">res_fax.h:87</a></div></div>
<div class="ttc" id="res__fax_8c_html_a0551bf04899fb222ec7b425200049a6f"><div class="ttname"><a href="../../d0/d60/res__fax_8c.html#a0551bf04899fb222ec7b425200049a6f">RES_FAX_MAXRATE</a></div><div class="ttdeci">#define RES_FAX_MAXRATE</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d60/res__fax_8c_source.html#l00523">res_fax.c:523</a></div></div>
<div class="ttc" id="json_8h_html_a99715667e822b2ad409b34ca041e535d"><div class="ttname"><a href="../../d4/d05/json_8h.html#a99715667e822b2ad409b34ca041e535d">ast_json_pack</a></div><div class="ttdeci">struct ast_json * ast_json_pack(char const *format,...)</div><div class="ttdoc">Helper for creating complex JSON values. </div><div class="ttdef"><b>Definition:</b> <a href="../../df/d98/json_8c_source.html#l00591">json.c:591</a></div></div>
<div class="ttc" id="smoother_8h_html_aab5808a118c74febd13f39746bcce96c"><div class="ttname"><a href="../../d6/d7f/smoother_8h.html#aab5808a118c74febd13f39746bcce96c">ast_smoother_feed</a></div><div class="ttdeci">#define ast_smoother_feed(s, f)</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d7f/smoother_8h_source.html#l00076">smoother.h:76</a></div></div>
<div class="ttc" id="smoother_8h_html_a6f1c795e5db00c9eb553e540dce7a503"><div class="ttname"><a href="../../d6/d7f/smoother_8h.html#a6f1c795e5db00c9eb553e540dce7a503">ast_smoother_new</a></div><div class="ttdeci">struct ast_smoother * ast_smoother_new(int bytes)</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/dd7/smoother_8c_source.html#l00108">smoother.c:108</a></div></div>
<div class="ttc" id="structdebug__info__history_html_a956be2e6e0911206ed31a587010be4da"><div class="ttname"><a href="../../d2/d1c/structdebug__info__history.html#a956be2e6e0911206ed31a587010be4da">debug_info_history::consec_frames</a></div><div class="ttdeci">unsigned int consec_frames</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d60/res__fax_8c_source.html#l00432">res_fax.c:432</a></div></div>
<div class="ttc" id="linkedlists_8h_html_a39918fd433ac42184b152c86016ef139"><div class="ttname"><a href="../../df/d90/linkedlists_8h.html#a39918fd433ac42184b152c86016ef139">AST_RWLIST_HEAD_STATIC</a></div><div class="ttdeci">#define AST_RWLIST_HEAD_STATIC(name, type)</div><div class="ttdoc">Defines a structure to be used to hold a read/write list of specified type, statically initialized...</div><div class="ttdef"><b>Definition:</b> <a href="../../df/d90/linkedlists_8h_source.html#l00332">linkedlists.h:332</a></div></div>
<div class="ttc" id="structast__control__t38__parameters_html_a5408ac5df4c170828874e1b10b4c35a0"><div class="ttname"><a href="../../d5/def/structast__control__t38__parameters.html#a5408ac5df4c170828874e1b10b4c35a0">ast_control_t38_parameters::version</a></div><div class="ttdeci">unsigned int version</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d66/include_2asterisk_2frame_8h_source.html#l00399">include/asterisk/frame.h:399</a></div></div>
<div class="ttc" id="module_8h_html_ab35bc4efd9f79706300965c9d36a0ce5a634484c0074e7b6b630756fab09e2c15"><div class="ttname"><a href="../../d5/d16/module_8h.html#ab35bc4efd9f79706300965c9d36a0ce5a634484c0074e7b6b630756fab09e2c15">AST_MODULE_SUPPORT_CORE</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d16/module_8h_source.html#l00121">module.h:121</a></div></div>
<div class="ttc" id="strings_8h_html"><div class="ttname"><a href="../../d6/d90/strings_8h.html">strings.h</a></div><div class="ttdoc">String manipulation functions. </div></div>
<div class="ttc" id="structfax__gateway_html_a0d2ac6150d9d6ec10389a84148a4425f"><div class="ttname"><a href="../../dd/dd2/structfax__gateway.html#a0d2ac6150d9d6ec10389a84148a4425f">fax_gateway::bridged</a></div><div class="ttdeci">int bridged</div><div class="ttdoc">bridged </div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d60/res__fax_8c_source.html#l00456">res_fax.c:456</a></div></div>
<div class="ttc" id="structast__fax__session_html_a7322779fdf9224c1354c795981079ee3"><div class="ttname"><a href="../../d1/d16/structast__fax__session.html#a7322779fdf9224c1354c795981079ee3">ast_fax_session::frames_sent</a></div><div class="ttdeci">unsigned long frames_sent</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d6a/res__fax_8h_source.html#l00212">res_fax.h:212</a></div></div>
<div class="ttc" id="res__fax_8c_html_a3b513e2bd3454f5e5077c0ca8f748142"><div class="ttname"><a href="../../d0/d60/res__fax_8c.html#a3b513e2bd3454f5e5077c0ca8f748142">fax_rx_attempts</a></div><div class="ttdeci">int fax_rx_attempts</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d60/res__fax_8c_source.html#l00506">res_fax.c:506</a></div></div>
<div class="ttc" id="structast__fax__session__details_html_a6e3b307f2cde58ca9c7ed2c150e4c53c"><div class="ttname"><a href="../../d8/dc2/structast__fax__session__details.html#a6e3b307f2cde58ca9c7ed2c150e4c53c">ast_fax_session_details::headerinfo</a></div><div class="ttdeci">const ast_string_field headerinfo</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d6a/res__fax_8h_source.html#l00142">res_fax.h:142</a></div></div>
<div class="ttc" id="structval_html"><div class="ttname"><a href="../../d5/d85/structval.html">val</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d3/dd1/ast__expr2_8c_source.html#l00325">ast_expr2.c:325</a></div></div>
<div class="ttc" id="res__fax_8c_html_a0a1efd136d28f11d18bfa7cf927ff5ea"><div class="ttname"><a href="../../d0/d60/res__fax_8c.html#a0a1efd136d28f11d18bfa7cf927ff5ea">fax_gateway_start</a></div><div class="ttdeci">static int fax_gateway_start(struct fax_gateway *gateway, struct ast_fax_session_details *details, struct ast_channel *chan)</div><div class="ttdoc">Create a fax session and start T.30&lt;-&gt;T.38 gateway mode. </div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d60/res__fax_8c_source.html#l02917">res_fax.c:2917</a></div></div>
<div class="ttc" id="structast__fax__session_html_a642958d63ff66872cbdcc0dc9795b4a3"><div class="ttname"><a href="../../d1/d16/structast__fax__session.html#a642958d63ff66872cbdcc0dc9795b4a3">ast_fax_session::frames_received</a></div><div class="ttdeci">unsigned long frames_received</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d6a/res__fax_8h_source.html#l00210">res_fax.h:210</a></div></div>
<div class="ttc" id="res__fax_8c_html_aca0e59fc667e8d921853204d2b511d98"><div class="ttname"><a href="../../d0/d60/res__fax_8c.html#aca0e59fc667e8d921853204d2b511d98">fax_rate_str_to_int</a></div><div class="ttdeci">static unsigned int fax_rate_str_to_int(const char *ratestr)</div><div class="ttdoc">convert a rate string to a rate </div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d60/res__fax_8c_source.html#l01046">res_fax.c:1046</a></div></div>
<div class="ttc" id="ast__version_8h_html"><div class="ttname"><a href="../../d5/db9/ast__version_8h.html">ast_version.h</a></div><div class="ttdoc">Asterisk version information. </div></div>
<div class="ttc" id="res__fax_8h_html_a54eb45ad548b874cf12d0a599631e3f6adbf07d8224b1a548ccae3b994653003b"><div class="ttname"><a href="../../db/d6a/res__fax_8h.html#a54eb45ad548b874cf12d0a599631e3f6adbf07d8224b1a548ccae3b994653003b">AST_FAX_TECH_SEND</a></div><div class="ttdef"><b>Definition:</b> <a href="../../db/d6a/res__fax_8h_source.html#l00037">res_fax.h:37</a></div></div>
<div class="ttc" id="cli_8h_html_a56b6b59ee2eaa994597a5b0f4e9f9d09"><div class="ttname"><a href="../../dc/db0/cli_8h.html#a56b6b59ee2eaa994597a5b0f4e9f9d09">ast_cli_unregister_multiple</a></div><div class="ttdeci">int ast_cli_unregister_multiple(struct ast_cli_entry *e, int len)</div><div class="ttdoc">Unregister multiple commands. </div><div class="ttdef"><b>Definition:</b> <a href="../../da/d4d/clicompat_8c_source.html#l00030">clicompat.c:30</a></div></div>
<div class="ttc" id="framehook_8h_html_a54250544f50efde9156d2341e8da0614a890a69eb197e4612993b98f04ab73ead"><div class="ttname"><a href="../../db/d3c/framehook_8h.html#a54250544f50efde9156d2341e8da0614a890a69eb197e4612993b98f04ab73ead">AST_FRAMEHOOK_EVENT_ATTACHED</a></div><div class="ttdef"><b>Definition:</b> <a href="../../db/d3c/framehook_8h_source.html#l00154">framehook.h:154</a></div></div>
<div class="ttc" id="res__fax_8h_html_a54eb45ad548b874cf12d0a599631e3f6a9138c48a79016bfccdd7cee6197cb21c"><div class="ttname"><a href="../../db/d6a/res__fax_8h.html#a54eb45ad548b874cf12d0a599631e3f6a9138c48a79016bfccdd7cee6197cb21c">AST_FAX_TECH_V21_DETECT</a></div><div class="ttdef"><b>Definition:</b> <a href="../../db/d6a/res__fax_8h_source.html#l00049">res_fax.h:49</a></div></div>
<div class="ttc" id="structast__fax__session_html_ab7ce6f462afaf105224b0ca772a33c43"><div class="ttname"><a href="../../d1/d16/structast__fax__session.html#ab7ce6f462afaf105224b0ca772a33c43">ast_fax_session::id</a></div><div class="ttdeci">unsigned int id</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d6a/res__fax_8h_source.html#l00204">res_fax.h:204</a></div></div>
<div class="ttc" id="utils_8h_html_a00d4c9254c9827d6fa44f17a326744a5"><div class="ttname"><a href="../../d5/d60/utils_8h.html#a00d4c9254c9827d6fa44f17a326744a5">ast_test_flag</a></div><div class="ttdeci">#define ast_test_flag(p, flag)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d60/utils_8h_source.html#l00063">utils.h:63</a></div></div>
<div class="ttc" id="include_2asterisk_2config_8h_html_aef636ed2f3d33f4c7a1ba67eb7c4d052"><div class="ttname"><a href="../../d3/de6/include_2asterisk_2config_8h.html#aef636ed2f3d33f4c7a1ba67eb7c4d052">ast_variable_browse</a></div><div class="ttdeci">struct ast_variable * ast_variable_browse(const struct ast_config *config, const char *category_name)</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/dc5/extconf_8c_source.html#l01216">extconf.c:1216</a></div></div>
<div class="ttc" id="structast__fax__session__details_html_a84360ac08d9be11f221466122d8cdc65"><div class="ttname"><a href="../../d8/dc2/structast__fax__session__details.html#a84360ac08d9be11f221466122d8cdc65">ast_fax_session_details::debug</a></div><div class="ttdeci">uint32_t debug</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d6a/res__fax_8h_source.html#l00151">res_fax.h:151</a></div></div>
<div class="ttc" id="structast__control__t38__parameters_html"><div class="ttname"><a href="../../d5/def/structast__control__t38__parameters.html">ast_control_t38_parameters</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d66/include_2asterisk_2frame_8h_source.html#l00397">include/asterisk/frame.h:397</a></div></div>
<div class="ttc" id="translate_8h_html"><div class="ttname"><a href="../../db/d39/translate_8h.html">translate.h</a></div><div class="ttdoc">Support for translation of data formats. translate.c. </div></div>
<div class="ttc" id="include_2asterisk_2app_8h_html_ab451a4653176c211d131b899e1f91bde"><div class="ttname"><a href="../../d3/d93/include_2asterisk_2app_8h.html#ab451a4653176c211d131b899e1f91bde">BEGIN_OPTIONS</a></div><div class="ttdeci">#define BEGIN_OPTIONS</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d93/include_2asterisk_2app_8h_source.html#l01343">include/asterisk/app.h:1343</a></div></div>
<div class="ttc" id="json_8h_html_a33bcd9181e613a659eefe411ec42c87c"><div class="ttname"><a href="../../d4/d05/json_8h.html#a33bcd9181e613a659eefe411ec42c87c">ast_json_unref</a></div><div class="ttdeci">void ast_json_unref(struct ast_json *value)</div><div class="ttdoc">Decrease refcount on value. If refcount reaches zero, value is freed. </div><div class="ttdef"><b>Definition:</b> <a href="../../df/d98/json_8c_source.html#l00073">json.c:73</a></div></div>
<div class="ttc" id="res__fax_8c_html_a9029b2196b8587ea85bad4ac4b6174d7"><div class="ttname"><a href="../../d0/d60/res__fax_8c.html#a9029b2196b8587ea85bad4ac4b6174d7">app_sendfax</a></div><div class="ttdeci">static const char app_sendfax[]</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d60/res__fax_8c_source.html#l00429">res_fax.c:429</a></div></div>
<div class="ttc" id="res__fax_8c_html_a779e8d2cf3518f35900b9089a2c344ec"><div class="ttname"><a href="../../d0/d60/res__fax_8c.html#a779e8d2cf3518f35900b9089a2c344ec">generic_fax_exec</a></div><div class="ttdeci">static int generic_fax_exec(struct ast_channel *chan, struct ast_fax_session_details *details, struct ast_fax_session *reserved, struct ast_fax_tech_token *token)</div><div class="ttdoc">this is the generic FAX session handling function </div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d60/res__fax_8c_source.html#l01590">res_fax.c:1590</a></div></div>
<div class="ttc" id="dsp_8h_html_a0a57a1e374549eb2705068688f4046db"><div class="ttname"><a href="../../d3/d08/dsp_8h.html#a0a57a1e374549eb2705068688f4046db">ast_dsp_free</a></div><div class="ttdeci">void ast_dsp_free(struct ast_dsp *dsp)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d3b/dsp_8c_source.html#l01770">dsp.c:1770</a></div></div>
<div class="ttc" id="structast__frame_html_add9af9569af79ec26dd741fb226b38ba"><div class="ttname"><a href="../../d0/d99/structast__frame.html#add9af9569af79ec26dd741fb226b38ba">ast_frame::ptr</a></div><div class="ttdeci">void * ptr</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d66/include_2asterisk_2frame_8h_source.html#l00183">include/asterisk/frame.h:183</a></div></div>
<div class="ttc" id="structast__fax__tech_html_aa6e050925b9e4522acd7e77374b54128"><div class="ttname"><a href="../../d9/d0e/structast__fax__tech.html#aa6e050925b9e4522acd7e77374b54128">ast_fax_tech::cli_show_stats</a></div><div class="ttdeci">char *(*const cli_show_stats)(int)</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d6a/res__fax_8h_source.html#l00274">res_fax.h:274</a></div></div>
<div class="ttc" id="eagi__proxy_8c_html_ac95651d79c608a3148973b5b1fc9e525"><div class="ttname"><a href="../../dd/d7c/eagi__proxy_8c.html#ac95651d79c608a3148973b5b1fc9e525">buf</a></div><div class="ttdeci">char buf[BUFSIZE]</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d7c/eagi__proxy_8c_source.html#l00066">eagi_proxy.c:66</a></div></div>
<div class="ttc" id="app__alarmreceiver_8c_html_a1b48abc3f5ca7a0f92edf228128e47a1"><div class="ttname"><a href="../../dc/d5c/app__alarmreceiver_8c.html#a1b48abc3f5ca7a0f92edf228128e47a1">fdtimeout</a></div><div class="ttdeci">static int fdtimeout</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d5c/app__alarmreceiver_8c_source.html#l00182">app_alarmreceiver.c:182</a></div></div>
<div class="ttc" id="ast__version_8h_html_a7765c608aea948584928643ab3963b2a"><div class="ttname"><a href="../../d5/db9/ast__version_8h.html#a7765c608aea948584928643ab3963b2a">ast_get_version</a></div><div class="ttdeci">const char * ast_get_version(void)</div><div class="ttdoc">Retrieve the Asterisk version string. </div><div class="ttdef"><b>Definition:</b> <a href="../../d2/d0b/version_8c_source.html#l00016">version.c:16</a></div></div>
<div class="ttc" id="structfax__gateway_html"><div class="ttname"><a href="../../dd/dd2/structfax__gateway.html">fax_gateway</a></div><div class="ttdoc">used for gateway framehook </div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d60/res__fax_8c_source.html#l00444">res_fax.c:444</a></div></div>
<div class="ttc" id="namespacemake__ari__stubs_html_a40a5d58ffa6e88aa578d6683ac413105"><div class="ttname"><a href="../../d2/dc8/namespacemake__ari__stubs.html#a40a5d58ffa6e88aa578d6683ac413105">make_ari_stubs.file</a></div><div class="ttdeci">file</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d28/make__ari__stubs_8py_source.html#l00025">make_ari_stubs.py:25</a></div></div>
<div class="ttc" id="dsp_8h_html"><div class="ttname"><a href="../../d3/d08/dsp_8h.html">dsp.h</a></div><div class="ttdoc">Convenient Signal Processing routines. </div></div>
<div class="ttc" id="linkedlists_8h_html_a2d0cf4182bade9f773fb16ff12abe595"><div class="ttname"><a href="../../df/d90/linkedlists_8h.html#a2d0cf4182bade9f773fb16ff12abe595">AST_RWLIST_WRLOCK</a></div><div class="ttdeci">#define AST_RWLIST_WRLOCK(head)</div><div class="ttdoc">Write locks a list. </div><div class="ttdef"><b>Definition:</b> <a href="../../df/d90/linkedlists_8h_source.html#l00051">linkedlists.h:51</a></div></div>
<div class="ttc" id="astobj2_8h_html_a2448088751e4d494d1981c7f4b84e8d0"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#a2448088751e4d494d1981c7f4b84e8d0">OBJ_POINTER</a></div><div class="ttdeci">#define OBJ_POINTER</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l01154">astobj2.h:1154</a></div></div>
<div class="ttc" id="res__fax_8h_html"><div class="ttname"><a href="../../db/d6a/res__fax_8h.html">res_fax.h</a></div></div>
<div class="ttc" id="include_2asterisk_2app_8h_html_ac08f7eb1eb9476b30987c73e1052ada8"><div class="ttname"><a href="../../d3/d93/include_2asterisk_2app_8h.html#ac08f7eb1eb9476b30987c73e1052ada8">AST_STANDARD_APP_ARGS</a></div><div class="ttdeci">#define AST_STANDARD_APP_ARGS(args, parse)</div><div class="ttdoc">Performs the &amp;#39;standard&amp;#39; argument separation process for an application. </div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d93/include_2asterisk_2app_8h_source.html#l01285">include/asterisk/app.h:1285</a></div></div>
<div class="ttc" id="structast__trans__pvt_html_a735f764b1095611ace084e7c6c06857d"><div class="ttname"><a href="../../d1/d47/structast__trans__pvt.html#a735f764b1095611ace084e7c6c06857d">ast_trans_pvt::f</a></div><div class="ttdeci">struct ast_frame f</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d39/translate_8h_source.html#l00215">translate.h:215</a></div></div>
<div class="ttc" id="group__Group__AMI_html_ga58c3e3da5d31739cafaee1df6ddf9342"><div class="ttname"><a href="../../df/d72/group__Group__AMI.html#ga58c3e3da5d31739cafaee1df6ddf9342">astman_send_list_complete_start</a></div><div class="ttdeci">void astman_send_list_complete_start(struct mansession *s, const struct message *m, const char *event_name, int count)</div><div class="ttdoc">Start the list complete event. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d10/manager_8c_source.html#l03237">manager.c:3237</a></div></div>
<div class="ttc" id="structfax__options_html_a38b557eee45ee4c0d92d514c04823f84"><div class="ttname"><a href="../../d0/d28/structfax__options.html#a38b557eee45ee4c0d92d514c04823f84">fax_options::modems</a></div><div class="ttdeci">enum ast_fax_modems modems</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d60/res__fax_8c_source.html#l00529">res_fax.c:529</a></div></div>
<div class="ttc" id="format__cache_8h_html_a568c3f5838b53c38f11996dbe5ff5785"><div class="ttname"><a href="../../db/d1c/format__cache_8h.html#a568c3f5838b53c38f11996dbe5ff5785">ast_format_ulaw</a></div><div class="ttdeci">struct ast_format * ast_format_ulaw</div><div class="ttdoc">Built-in cached ulaw format. </div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d29/format__cache_8c_source.html#l00086">format_cache.c:86</a></div></div>
<div class="ttc" id="stasis_8h_html"><div class="ttname"><a href="../../dd/d79/stasis_8h.html">stasis.h</a></div><div class="ttdoc">Stasis Message Bus API. See Stasis Message Bus API for detailed documentation. </div></div>
<div class="ttc" id="res__fax_8c_html_a46275621a3d3846d089a092249fb8c37a580250f89769e79e089f734549526a37"><div class="ttname"><a href="../../d0/d60/res__fax_8c.html#a46275621a3d3846d089a092249fb8c37a580250f89769e79e089f734549526a37">OPT_REQUEST_T38</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d60/res__fax_8c_source.html#l00563">res_fax.c:563</a></div></div>
<div class="ttc" id="structast__cli__entry_html"><div class="ttname"><a href="../../d8/d07/structast__cli__entry.html">ast_cli_entry</a></div><div class="ttdoc">descriptor for a cli entry. </div><div class="ttdef"><b>Definition:</b> <a href="../../dc/db0/cli_8h_source.html#l00171">cli.h:171</a></div></div>
<div class="ttc" id="res__fax_8c_html_a46275621a3d3846d089a092249fb8c37a87052b571961ef8c1192a196d329ea1d"><div class="ttname"><a href="../../d0/d60/res__fax_8c.html#a46275621a3d3846d089a092249fb8c37a87052b571961ef8c1192a196d329ea1d">OPT_FORCE_AUDIO</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d60/res__fax_8c_source.html#l00564">res_fax.c:564</a></div></div>
<div class="ttc" id="structast__cli__args_html_a98e1d8441ca58834f11f7367be4b3345"><div class="ttname"><a href="../../d3/dad/structast__cli__args.html#a98e1d8441ca58834f11f7367be4b3345">ast_cli_args::argc</a></div><div class="ttdeci">const int argc</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/db0/cli_8h_source.html#l00160">cli.h:160</a></div></div>
<div class="ttc" id="logger_8h_html_adf4476a6a4ea6c74231c826e899d7189"><div class="ttname"><a href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a></div><div class="ttdeci">#define LOG_WARNING</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d8c/logger_8h_source.html#l00274">logger.h:274</a></div></div>
<div class="ttc" id="res__fax_8c_html_aaacf4ac8f8a199b23f61f1fd37982940"><div class="ttname"><a href="../../d0/d60/res__fax_8c.html#aaacf4ac8f8a199b23f61f1fd37982940">manager_fax_session</a></div><div class="ttdeci">static int manager_fax_session(struct mansession *s, const struct message *m)</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d60/res__fax_8c_source.html#l04143">res_fax.c:4143</a></div></div>
<div class="ttc" id="res__fax_8c_html_a75acaa938bee74395e4decb810ab7789"><div class="ttname"><a href="../../d0/d60/res__fax_8c.html#a75acaa938bee74395e4decb810ab7789">options_lock</a></div><div class="ttdeci">static ast_rwlock_t options_lock</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d60/res__fax_8c_source.html#l00548">res_fax.c:548</a></div></div>
<div class="ttc" id="framehook_8h_html_a54250544f50efde9156d2341e8da0614"><div class="ttname"><a href="../../db/d3c/framehook_8h.html#a54250544f50efde9156d2341e8da0614">ast_framehook_event</a></div><div class="ttdeci">ast_framehook_event</div><div class="ttdoc">These are the types of events that the framehook&amp;#39;s event callback can receive. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/d3c/framehook_8h_source.html#l00151">framehook.h:151</a></div></div>
<div class="ttc" id="structast__fax__session__details_html_a9f26ae9d27415acd75d11e5cf606dd92"><div class="ttname"><a href="../../d8/dc2/structast__fax__session__details.html#a9f26ae9d27415acd75d11e5cf606dd92">ast_fax_session_details::request_t38</a></div><div class="ttdeci">uint32_t request_t38</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d6a/res__fax_8h_source.html#l00165">res_fax.h:165</a></div></div>
<div class="ttc" id="test__linkedlists_8c_html_a156f09c32102fa036620ad75c3ee4fbf"><div class="ttname"><a href="../../d7/d6f/test__linkedlists_8c.html#a156f09c32102fa036620ad75c3ee4fbf">d</a></div><div class="ttdeci">static struct test_val d</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d6f/test__linkedlists_8c_source.html#l00049">test_linkedlists.c:49</a></div></div>
<div class="ttc" id="include_2asterisk_2config_8h_html_a8d1a63cdf2c7aff22a77b6e75d93b377"><div class="ttname"><a href="../../d3/de6/include_2asterisk_2config_8h.html#a8d1a63cdf2c7aff22a77b6e75d93b377">CONFIG_STATUS_FILEINVALID</a></div><div class="ttdeci">#define CONFIG_STATUS_FILEINVALID</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/de6/include_2asterisk_2config_8h_source.html#l00060">include/asterisk/config.h:60</a></div></div>
<div class="ttc" id="res__fax_8c_html_a40d89bb1e84698fe43b2813c44587cef"><div class="ttname"><a href="../../d0/d60/res__fax_8c.html#a40d89bb1e84698fe43b2813c44587cef">ast_fax_caps_to_str</a></div><div class="ttdeci">static char * ast_fax_caps_to_str(enum ast_fax_capabilities caps, char *buf, size_t bufsize)</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d60/res__fax_8c_source.html#l00846">res_fax.c:846</a></div></div>
<div class="ttc" id="dsp_8h_html_a0a60e93006c8e1ca8fda922ae0e0da2c"><div class="ttname"><a href="../../d3/d08/dsp_8h.html#a0a60e93006c8e1ca8fda922ae0e0da2c">ast_dsp_new</a></div><div class="ttdeci">struct ast_dsp * ast_dsp_new(void)</div><div class="ttdoc">Allocates a new dsp, assumes 8khz for internal sample rate. </div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d3b/dsp_8c_source.html#l01745">dsp.c:1745</a></div></div>
<div class="ttc" id="structast__fax__tech_html_a8ff938fb2f815be425fd2859a21e6d61"><div class="ttname"><a href="../../d9/d0e/structast__fax__tech.html#a8ff938fb2f815be425fd2859a21e6d61">ast_fax_tech::type</a></div><div class="ttdeci">const char *const type</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d6a/res__fax_8h_source.html#l00237">res_fax.h:237</a></div></div>
<div class="ttc" id="res__fax_8h_html_ab34810136037068a0847bcca2518112ca59afc86be1c4be9a01c3cd178c4337b2"><div class="ttname"><a href="../../db/d6a/res__fax_8h.html#ab34810136037068a0847bcca2518112ca59afc86be1c4be9a01c3cd178c4337b2">AST_FAX_STATE_ACTIVE</a></div><div class="ttdef"><b>Definition:</b> <a href="../../db/d6a/res__fax_8h_source.html#l00073">res_fax.h:73</a></div></div>
<div class="ttc" id="cdr__mysql_8c_html_a493b57f443cc38b3d3df9c1e584d9d82"><div class="ttname"><a href="../../d0/d29/cdr__mysql_8c.html#a493b57f443cc38b3d3df9c1e584d9d82">timeout</a></div><div class="ttdeci">static int timeout</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d29/cdr__mysql_8c_source.html#l00086">cdr_mysql.c:86</a></div></div>
<div class="ttc" id="bt__open_8c_html_a1cdd2bb1a9a71d3e1120100229315d67"><div class="ttname"><a href="../../de/d1e/bt__open_8c.html#a1cdd2bb1a9a71d3e1120100229315d67">tmp</a></div><div class="ttdeci">static int tmp()</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d1e/bt__open_8c_source.html#l00389">bt_open.c:389</a></div></div>
<div class="ttc" id="linkedlists_8h_html_a2e9a2518b5029b96671aff6701bd5138"><div class="ttname"><a href="../../df/d90/linkedlists_8h.html#a2e9a2518b5029b96671aff6701bd5138">AST_RWLIST_UNLOCK</a></div><div class="ttdeci">#define AST_RWLIST_UNLOCK(head)</div><div class="ttdoc">Attempts to unlock a read/write based list. </div><div class="ttdef"><b>Definition:</b> <a href="../../df/d90/linkedlists_8h_source.html#l00150">linkedlists.h:150</a></div></div>
<div class="ttc" id="structt38__state_html"><div class="ttname"><a href="../../de/d6f/structt38__state.html">t38_state</a></div><div class="ttdoc">T.38 state information. </div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d80/res__pjsip__t38_8c_source.html#l00059">res_pjsip_t38.c:59</a></div></div>
<div class="ttc" id="res__fax_8c_html_aa2dc9cc8d6f1e82d281acbcc292b28b5"><div class="ttname"><a href="../../d0/d60/res__fax_8c.html#aa2dc9cc8d6f1e82d281acbcc292b28b5">destroy_session</a></div><div class="ttdeci">static void destroy_session(void *session)</div><div class="ttdoc">destroy a FAX session structure </div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d60/res__fax_8c_source.html#l01096">res_fax.c:1096</a></div></div>
<div class="ttc" id="res__fax_8c_html_a0212d23b36bd4b0777c0002ef6758bd9"><div class="ttname"><a href="../../d0/d60/res__fax_8c.html#a0212d23b36bd4b0777c0002ef6758bd9">ast_fax_tech_unregister</a></div><div class="ttdeci">void ast_fax_tech_unregister(struct ast_fax_tech *tech)</div><div class="ttdoc">unregister a FAX technology module </div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d60/res__fax_8c_source.html#l00992">res_fax.c:992</a></div></div>
<div class="ttc" id="res__fax_8c_html_a8dfe16760634f2d87db5508787023ef5"><div class="ttname"><a href="../../d0/d60/res__fax_8c.html#a8dfe16760634f2d87db5508787023ef5">generate_filenames_json</a></div><div class="ttdeci">static struct ast_json * generate_filenames_json(struct ast_fax_session_details *details)</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d60/res__fax_8c_source.html#l01330">res_fax.c:1330</a></div></div>
<div class="ttc" id="include_2asterisk_2config_8h_html_aab3eac8fa82a86a93c074deb7b77dbc9"><div class="ttname"><a href="../../d3/de6/include_2asterisk_2config_8h.html#aab3eac8fa82a86a93c074deb7b77dbc9">ast_config_load2</a></div><div class="ttdeci">struct ast_config * ast_config_load2(const char *filename, const char *who_asked, struct ast_flags flags)</div><div class="ttdoc">Load a config file. </div><div class="ttdef"><b>Definition:</b> <a href="../../d2/d9d/main_2config_8c_source.html#l03154">main/config.c:3154</a></div></div>
<div class="ttc" id="structast__variable_html"><div class="ttname"><a href="../../dd/d02/structast__variable.html">ast_variable</a></div><div class="ttdoc">Structure for variables, used for configurations and for channel variables. </div><div class="ttdef"><b>Definition:</b> <a href="../../d3/de6/include_2asterisk_2config_8h_source.html#l00083">include/asterisk/config.h:83</a></div></div>
<div class="ttc" id="structast__fax__session__details_html_acabbc07223706b9f471213b8e5dc1d58"><div class="ttname"><a href="../../d8/dc2/structast__fax__session__details.html#acabbc07223706b9f471213b8e5dc1d58">ast_fax_session_details::transfer_rate</a></div><div class="ttdeci">const ast_string_field transfer_rate</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d6a/res__fax_8h_source.html#l00142">res_fax.h:142</a></div></div>
<div class="ttc" id="structfax__gateway_html_ae25f61b5aa8877dfb396fd378c6b7722"><div class="ttname"><a href="../../dd/dd2/structfax__gateway.html#ae25f61b5aa8877dfb396fd378c6b7722">fax_gateway::framehook</a></div><div class="ttdeci">int framehook</div><div class="ttdoc">framehook used in gateway mode </div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d60/res__fax_8c_source.html#l00454">res_fax.c:454</a></div></div>
<div class="ttc" id="framehook_8h_html_a54250544f50efde9156d2341e8da0614a8e213d52d922fb4ab2842022c2252a62"><div class="ttname"><a href="../../db/d3c/framehook_8h.html#a54250544f50efde9156d2341e8da0614a8e213d52d922fb4ab2842022c2252a62">AST_FRAMEHOOK_EVENT_DETACHED</a></div><div class="ttdef"><b>Definition:</b> <a href="../../db/d3c/framehook_8h_source.html#l00155">framehook.h:155</a></div></div>
<div class="ttc" id="res__fax_8c_html_aa9ea5a83822d7365075730ddb8490d23"><div class="ttname"><a href="../../d0/d60/res__fax_8c.html#aa9ea5a83822d7365075730ddb8490d23">t38_parameters_ast_to_fax</a></div><div class="ttdeci">static void t38_parameters_ast_to_fax(struct ast_fax_t38_parameters *dst, const struct ast_control_t38_parameters *src)</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d60/res__fax_8c_source.html#l00740">res_fax.c:740</a></div></div>
<div class="ttc" id="framehook_8h_html_a6e116259cae8c1e5cca074d05f0a3475"><div class="ttname"><a href="../../db/d3c/framehook_8h.html#a6e116259cae8c1e5cca074d05f0a3475">ast_framehook_detach</a></div><div class="ttdeci">int ast_framehook_detach(struct ast_channel *chan, int framehook_id)</div><div class="ttdoc">Detach an framehook from a channel. </div><div class="ttdef"><b>Definition:</b> <a href="../../da/dac/framehook_8c_source.html#l00177">framehook.c:177</a></div></div>
<div class="ttc" id="res__fax_8c_html_a624525cc48cff52d5ae4e5e50895e81e"><div class="ttname"><a href="../../d0/d60/res__fax_8c.html#a624525cc48cff52d5ae4e5e50895e81e">t38_parameters_fax_to_ast</a></div><div class="ttdeci">static void t38_parameters_fax_to_ast(struct ast_control_t38_parameters *dst, const struct ast_fax_t38_parameters *src)</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d60/res__fax_8c_source.html#l00751">res_fax.c:751</a></div></div>
<div class="ttc" id="include_2asterisk_2frame_8h_html_a168d496bdac09ece3ce49cf473bbdb4bafdb1ca68d683c64301c4cf07463a9975"><div class="ttname"><a href="../../d6/d66/include_2asterisk_2frame_8h.html#a168d496bdac09ece3ce49cf473bbdb4bafdb1ca68d683c64301c4cf07463a9975">AST_T38_REQUEST_NEGOTIATE</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d66/include_2asterisk_2frame_8h_source.html#l00371">include/asterisk/frame.h:371</a></div></div>
<div class="ttc" id="time_8h_html_a4e7b3508884147c7991a68361ac781a2"><div class="ttname"><a href="../../de/df7/time_8h.html#a4e7b3508884147c7991a68361ac781a2">ast_tvzero</a></div><div class="ttdeci">int ast_tvzero(const struct timeval t)</div><div class="ttdoc">Returns true if the argument is 0,0. </div><div class="ttdef"><b>Definition:</b> <a href="../../de/df7/time_8h_source.html#l00108">time.h:108</a></div></div>
<div class="ttc" id="include_2asterisk_2frame_8h_html_ae2e1a9c4e048da387b761f619312d6e0aa457fe7005f11bb7b21453f9bb4caa8f"><div class="ttname"><a href="../../d6/d66/include_2asterisk_2frame_8h.html#ae2e1a9c4e048da387b761f619312d6e0aa457fe7005f11bb7b21453f9bb4caa8f">AST_FRAME_VOICE</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d66/include_2asterisk_2frame_8h_source.html#l00101">include/asterisk/frame.h:101</a></div></div>
<div class="ttc" id="structast__fax__tech_html_abc5dcf4e27ad698c7907dbcc15b8d1cc"><div class="ttname"><a href="../../d9/d0e/structast__fax__tech.html#abc5dcf4e27ad698c7907dbcc15b8d1cc">ast_fax_tech::release_token</a></div><div class="ttdeci">void(*const release_token)(struct ast_fax_tech_token *)</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d6a/res__fax_8h_source.html#l00249">res_fax.h:249</a></div></div>
<div class="ttc" id="channel_8h_html_a7ef6737309dc9e8b6c4a7cb4800638b1"><div class="ttname"><a href="../../d5/d7b/channel_8h.html#a7ef6737309dc9e8b6c4a7cb4800638b1">ast_read</a></div><div class="ttdeci">struct ast_frame * ast_read(struct ast_channel *chan)</div><div class="ttdoc">Reads a frame. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d28/channel_8c_source.html#l04302">channel.c:4302</a></div></div>
<div class="ttc" id="res__fax_8c_html_aa1d6811868ccbb842dde66cf8060a5fb"><div class="ttname"><a href="../../d0/d60/res__fax_8c.html#aa1d6811868ccbb842dde66cf8060a5fb">fax_gateway_detect_v21</a></div><div class="ttdeci">static struct ast_frame * fax_gateway_detect_v21(struct fax_gateway *gateway, struct ast_channel *chan, struct ast_channel *peer, struct ast_channel *active, struct ast_frame *f)</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d60/res__fax_8c_source.html#l03012">res_fax.c:3012</a></div></div>
<div class="ttc" id="res__fax_8c_html_a1599952156d1b1f2be32eb21bcdbf1d9"><div class="ttname"><a href="../../d0/d60/res__fax_8c.html#a1599952156d1b1f2be32eb21bcdbf1d9">fax_detect_new</a></div><div class="ttdeci">static struct fax_detect * fax_detect_new(struct ast_channel *chan, int timeout, int flags)</div><div class="ttdoc">Create a new fax detect object. </div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d60/res__fax_8c_source.html#l03694">res_fax.c:3694</a></div></div>
<div class="ttc" id="structast__fax__session_html_a34ee6625e0f7d45c4e35cd409cb42e21"><div class="ttname"><a href="../../d1/d16/structast__fax__session.html#a34ee6625e0f7d45c4e35cd409cb42e21">ast_fax_session::smoother</a></div><div class="ttdeci">struct ast_smoother * smoother</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d6a/res__fax_8h_source.html#l00228">res_fax.h:228</a></div></div>
<div class="ttc" id="structast__control__t38__parameters_html_adb36822366e10ce64ca8337c512732a6"><div class="ttname"><a href="../../d5/def/structast__control__t38__parameters.html#adb36822366e10ce64ca8337c512732a6">ast_control_t38_parameters::request_response</a></div><div class="ttdeci">enum ast_control_t38 request_response</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d66/include_2asterisk_2frame_8h_source.html#l00398">include/asterisk/frame.h:398</a></div></div>
<div class="ttc" id="manager_8h_html_ab5db3cc603d7e798d61cb4cd94fbb4e2"><div class="ttname"><a href="../../db/d45/manager_8h.html#ab5db3cc603d7e798d61cb4cd94fbb4e2">EVENT_FLAG_CALL</a></div><div class="ttdeci">#define EVENT_FLAG_CALL</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d45/manager_8h_source.html#l00072">manager.h:72</a></div></div>
<div class="ttc" id="structast__fax__session__details_html_a7f633c7bc4fe667e873649afa4d44640"><div class="ttname"><a href="../../d8/dc2/structast__fax__session__details.html#a7f633c7bc4fe667e873649afa4d44640">ast_fax_session_details::statusevents</a></div><div class="ttdeci">uint32_t statusevents</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d6a/res__fax_8h_source.html#l00155">res_fax.h:155</a></div></div>
<div class="ttc" id="cli_8h_html_ab33e5350a923c3a8cedbeb496cd88ec9a71745eb63dd093f560a1add3e430d2a9"><div class="ttname"><a href="../../dc/db0/cli_8h.html#ab33e5350a923c3a8cedbeb496cd88ec9a71745eb63dd093f560a1add3e430d2a9">CLI_INIT</a></div><div class="ttdef"><b>Definition:</b> <a href="../../dc/db0/cli_8h_source.html#l00152">cli.h:152</a></div></div>
<div class="ttc" id="include_2asterisk_2frame_8h_html_a168d496bdac09ece3ce49cf473bbdb4ba6763b3f21dd07811168f6959ee2d2082"><div class="ttname"><a href="../../d6/d66/include_2asterisk_2frame_8h.html#a168d496bdac09ece3ce49cf473bbdb4ba6763b3f21dd07811168f6959ee2d2082">AST_T38_REQUEST_PARMS</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d66/include_2asterisk_2frame_8h_source.html#l00376">include/asterisk/frame.h:376</a></div></div>
<div class="ttc" id="ast__expr2f_8c_html_a33e91cd0cef6786e9e3a27ac67707207"><div class="ttname"><a href="../../dc/df2/ast__expr2f_8c.html#a33e91cd0cef6786e9e3a27ac67707207">if</a></div><div class="ttdeci">if(!yyg-&gt;yy_init)</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/df2/ast__expr2f_8c_source.html#l00868">ast_expr2f.c:868</a></div></div>
<div class="ttc" id="res__fax_8c_html_a107e52e1d9d616990103fa9f54536f74"><div class="ttname"><a href="../../d0/d60/res__fax_8c.html#a107e52e1d9d616990103fa9f54536f74">session_hash_cb</a></div><div class="ttdeci">static int session_hash_cb(const void *obj, const int flags)</div><div class="ttdoc">hash callback for ao2 </div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d60/res__fax_8c_source.html#l03927">res_fax.c:3927</a></div></div>
<div class="ttc" id="structast__datastore__info_html"><div class="ttname"><a href="../../d9/dfb/structast__datastore__info.html">ast_datastore_info</a></div><div class="ttdoc">Structure for a data store type. </div><div class="ttdef"><b>Definition:</b> <a href="../../d9/db6/datastore_8h_source.html#l00031">datastore.h:31</a></div></div>
<div class="ttc" id="channelstate_8h_html_a03585bc87e5bbd0f4d11bc789734c660"><div class="ttname"><a href="../../d9/d95/channelstate_8h.html#a03585bc87e5bbd0f4d11bc789734c660">ast_channel_state</a></div><div class="ttdeci">ast_channel_state</div><div class="ttdoc">ast_channel states </div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d95/channelstate_8h_source.html#l00035">channelstate.h:35</a></div></div>
<div class="ttc" id="structfax__module_html_a4ac6ff3775e67c710cd55bc7dfd592fe"><div class="ttname"><a href="../../d9/d07/structfax__module.html#a4ac6ff3775e67c710cd55bc7dfd592fe">fax_module::tech</a></div><div class="ttdeci">const struct ast_fax_tech * tech</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d60/res__fax_8c_source.html#l00517">res_fax.c:517</a></div></div>
<div class="ttc" id="structfax__detect_html"><div class="ttname"><a href="../../da/df6/structfax__detect.html">fax_detect</a></div><div class="ttdoc">used for fax detect framehook </div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d60/res__fax_8c_source.html#l00469">res_fax.c:469</a></div></div>
<div class="ttc" id="channel_8h_html_aa8c3522af1bc639cbd5b38f5fdf171fa"><div class="ttname"><a href="../../d5/d7b/channel_8h.html#aa8c3522af1bc639cbd5b38f5fdf171fa">ast_indicate_data</a></div><div class="ttdeci">int ast_indicate_data(struct ast_channel *chan, int condition, const void *data, size_t datalen)</div><div class="ttdoc">Indicates condition of channel, with payload. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d28/channel_8c_source.html#l04698">channel.c:4698</a></div></div>
<div class="ttc" id="res__fax_8c_html_afd17b7bdd81198a94df9503cc9f10291"><div class="ttname"><a href="../../d0/d60/res__fax_8c.html#afd17b7bdd81198a94df9503cc9f10291">report_send_fax_status</a></div><div class="ttdeci">static int report_send_fax_status(struct ast_channel *chan, struct ast_fax_session_details *details)</div><div class="ttdoc">Report on the status of a completed fax send attempt. </div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d60/res__fax_8c_source.html#l02527">res_fax.c:2527</a></div></div>
<div class="ttc" id="structevent_html"><div class="ttname"><a href="../../df/d7d/structevent.html">event</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d2/d4d/astman_8c_source.html#l00222">astman.c:222</a></div></div>
<div class="ttc" id="logger_8h_html_aa27e6ab6364e8aea74c77f858ccd231e"><div class="ttname"><a href="../../d1/d8c/logger_8h.html#aa27e6ab6364e8aea74c77f858ccd231e">ast_log_dynamic_level</a></div><div class="ttdeci">#define ast_log_dynamic_level(level,...)</div><div class="ttdoc">Send a log message to a dynamically registered log level. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d8c/logger_8h_source.html#l00439">logger.h:439</a></div></div>
<div class="ttc" id="dsp_8h_html_a9baae529c58a54aaa53a0ccef8caa05e"><div class="ttname"><a href="../../d3/d08/dsp_8h.html#a9baae529c58a54aaa53a0ccef8caa05e">DSP_FAXMODE_DETECT_SQUELCH</a></div><div class="ttdeci">#define DSP_FAXMODE_DETECT_SQUELCH</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d08/dsp_8h_source.html#l00049">dsp.h:49</a></div></div>
<div class="ttc" id="structast__format_html"><div class="ttname"><a href="../../d0/d98/structast__format.html">ast_format</a></div><div class="ttdoc">Definition of a media format. </div><div class="ttdef"><b>Definition:</b> <a href="../../de/da6/format_8c_source.html#l00043">format.c:43</a></div></div>
<div class="ttc" id="channel_8h_html_a4cd990f4c1cd0c2af6e4c63f6d15b4e1"><div class="ttname"><a href="../../d5/d7b/channel_8h.html#a4cd990f4c1cd0c2af6e4c63f6d15b4e1">ast_t38_state</a></div><div class="ttdeci">ast_t38_state</div><div class="ttdoc">Possible T38 states on channels. </div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d7b/channel_8h_source.html#l00879">channel.h:879</a></div></div>
<div class="ttc" id="structast__fax__tech_html_a794f785a8ae4c97642fd20ff8ef83c34"><div class="ttname"><a href="../../d9/d0e/structast__fax__tech.html#a794f785a8ae4c97642fd20ff8ef83c34">ast_fax_tech::cancel_session</a></div><div class="ttdeci">int(*const cancel_session)(struct ast_fax_session *)</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d6a/res__fax_8h_source.html#l00261">res_fax.h:261</a></div></div>
<div class="ttc" id="include_2asterisk_2frame_8h_html_a168d496bdac09ece3ce49cf473bbdb4bab75e46d3212a2a886143d874c78a1e3c"><div class="ttname"><a href="../../d6/d66/include_2asterisk_2frame_8h.html#a168d496bdac09ece3ce49cf473bbdb4bab75e46d3212a2a886143d874c78a1e3c">AST_T38_REQUEST_TERMINATE</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d66/include_2asterisk_2frame_8h_source.html#l00372">include/asterisk/frame.h:372</a></div></div>
<div class="ttc" id="structstasis__message_html"><div class="ttname"><a href="../../d7/d55/structstasis__message.html">stasis_message</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d2/db9/stasis__message_8c_source.html#l00121">stasis_message.c:121</a></div></div>
<div class="ttc" id="cli_8h_html_aea8910ed9e301e7f741f87942c244eac"><div class="ttname"><a href="../../dc/db0/cli_8h.html#aea8910ed9e301e7f741f87942c244eac">ast_cli_register_multiple</a></div><div class="ttdeci">#define ast_cli_register_multiple(e, len)</div><div class="ttdoc">Register multiple commands. </div><div class="ttdef"><b>Definition:</b> <a href="../../dc/db0/cli_8h_source.html#l00265">cli.h:265</a></div></div>
<div class="ttc" id="astobj2_8h_html_ad36841ab6daa3997f7ca7047ad2d033a"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#ad36841ab6daa3997f7ca7047ad2d033a">ao2_iterator_destroy</a></div><div class="ttdeci">void ao2_iterator_destroy(struct ao2_iterator *iter)</div><div class="ttdoc">Destroy a container iterator. </div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d22/astobj2__container_8c_source.html#l00534">astobj2_container.c:534</a></div></div>
<div class="ttc" id="structast__fax__t38__parameters_html_a124b43d7f331e00aad39c964ea523329"><div class="ttname"><a href="../../d3/df6/structast__fax__t38__parameters.html#a124b43d7f331e00aad39c964ea523329">ast_fax_t38_parameters::rate</a></div><div class="ttdeci">enum ast_control_t38_rate rate</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d6a/res__fax_8h_source.html#l00095">res_fax.h:95</a></div></div>
<div class="ttc" id="time_8h_html_ad3899efb6f0e348556ef69f5b16aa7f7"><div class="ttname"><a href="../../de/df7/time_8h.html#ad3899efb6f0e348556ef69f5b16aa7f7">ast_tvnow</a></div><div class="ttdeci">struct timeval ast_tvnow(void)</div><div class="ttdoc">Returns current timeval. Meant to replace calls to gettimeofday(). </div><div class="ttdef"><b>Definition:</b> <a href="../../de/df7/time_8h_source.html#l00150">time.h:150</a></div></div>
<div class="ttc" id="linkedlists_8h_html_a4a1884cde93e53bef32ca85c194a1d05"><div class="ttname"><a href="../../df/d90/linkedlists_8h.html#a4a1884cde93e53bef32ca85c194a1d05">AST_LIST_EMPTY</a></div><div class="ttdeci">#define AST_LIST_EMPTY(head)</div><div class="ttdoc">Checks whether the specified list contains any entries. </div><div class="ttdef"><b>Definition:</b> <a href="../../df/d90/linkedlists_8h_source.html#l00449">linkedlists.h:449</a></div></div>
<div class="ttc" id="group__Group__AMI_html_ga77315fa8e29950f0c88120501acda0a3"><div class="ttname"><a href="../../df/d72/group__Group__AMI.html#ga77315fa8e29950f0c88120501acda0a3">astman_send_ack</a></div><div class="ttdeci">void astman_send_ack(struct mansession *s, const struct message *m, char *msg)</div><div class="ttdoc">Send ack in manager transaction. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d10/manager_8c_source.html#l03191">manager.c:3191</a></div></div>
<div class="ttc" id="channelstate_8h_html_a03585bc87e5bbd0f4d11bc789734c660aa8ab4bcda7378ccc17c39dfd880cba3d"><div class="ttname"><a href="../../d9/d95/channelstate_8h.html#a03585bc87e5bbd0f4d11bc789734c660aa8ab4bcda7378ccc17c39dfd880cba3d">AST_STATE_UP</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d95/channelstate_8h_source.html#l00042">channelstate.h:42</a></div></div>
<div class="ttc" id="translate_8h_html_ab09d3ccb95d1f828d2871530226f9456"><div class="ttname"><a href="../../db/d39/translate_8h.html#ab09d3ccb95d1f828d2871530226f9456">ast_translate</a></div><div class="ttdeci">struct ast_frame * ast_translate(struct ast_trans_pvt *tr, struct ast_frame *f, int consume)</div><div class="ttdoc">translates one or more frames Apply an input frame into the translator and receive zero or one output...</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d43/translate_8c_source.html#l00565">translate.c:565</a></div></div>
<div class="ttc" id="res__fax_8c_html_a0696c5e15e0596da88b514beffeb6248"><div class="ttname"><a href="../../d0/d60/res__fax_8c.html#a0696c5e15e0596da88b514beffeb6248">session_cmp_cb</a></div><div class="ttdeci">static int session_cmp_cb(void *obj, void *arg, int flags)</div><div class="ttdoc">compare callback for ao2 </div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d60/res__fax_8c_source.html#l03935">res_fax.c:3935</a></div></div>
<div class="ttc" id="astobj2_8h_html_a9998bd156b936636a8780385e9a910b2"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#a9998bd156b936636a8780385e9a910b2">ao2_unlock</a></div><div class="ttdeci">#define ao2_unlock(a)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l00730">astobj2.h:730</a></div></div>
<div class="ttc" id="test__linkedlists_8c_html_acd9db00336027462cfb25b97b5356883"><div class="ttname"><a href="../../d7/d6f/test__linkedlists_8c.html#acd9db00336027462cfb25b97b5356883">c</a></div><div class="ttdeci">static struct test_val c</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d6f/test__linkedlists_8c_source.html#l00048">test_linkedlists.c:48</a></div></div>
<div class="ttc" id="structfax__gateway_html_a8bb543c7fdbaf19b5a07e0154727228d"><div class="ttname"><a href="../../dd/dd2/structfax__gateway.html#a8bb543c7fdbaf19b5a07e0154727228d">fax_gateway::chan_v21_session</a></div><div class="ttdeci">struct ast_fax_session * chan_v21_session</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d60/res__fax_8c_source.html#l00448">res_fax.c:448</a></div></div>
<div class="ttc" id="time_8h_html_aca4ecdab7d8d3519062aad9a90fcb29d"><div class="ttname"><a href="../../de/df7/time_8h.html#aca4ecdab7d8d3519062aad9a90fcb29d">ast_tvdiff_ms</a></div><div class="ttdeci">int64_t ast_tvdiff_ms(struct timeval end, struct timeval start)</div><div class="ttdoc">Computes the difference (in milliseconds) between two struct timeval instances. </div><div class="ttdef"><b>Definition:</b> <a href="../../de/df7/time_8h_source.html#l00098">time.h:98</a></div></div>
<div class="ttc" id="res__fax_8c_html_a23b5336ddff8d963dbeb84251845721d"><div class="ttname"><a href="../../d0/d60/res__fax_8c.html#a23b5336ddff8d963dbeb84251845721d">fax_gateway_indicate_t38</a></div><div class="ttdeci">static void fax_gateway_indicate_t38(struct ast_channel *chan, struct ast_channel *active, struct ast_control_t38_parameters *control_params)</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d60/res__fax_8c_source.html#l03085">res_fax.c:3085</a></div></div>
<div class="ttc" id="sip_8h_html_ada584ef2e7f77c8dfe0315d05fa49e1c"><div class="ttname"><a href="../../d1/d94/sip_8h.html#ada584ef2e7f77c8dfe0315d05fa49e1c">t38state</a></div><div class="ttdeci">t38state</div><div class="ttdoc">T38 States for a call. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d94/sip_8h_source.html#l00665">sip.h:665</a></div></div>
<div class="ttc" id="res__fax_8h_html_a54eb45ad548b874cf12d0a599631e3f6a76fa4111df51955a949e95fadbccd48b"><div class="ttname"><a href="../../db/d6a/res__fax_8h.html#a54eb45ad548b874cf12d0a599631e3f6a76fa4111df51955a949e95fadbccd48b">AST_FAX_TECH_AUDIO</a></div><div class="ttdef"><b>Definition:</b> <a href="../../db/d6a/res__fax_8h_source.html#l00041">res_fax.h:41</a></div></div>
<div class="ttc" id="astmm_8h_html_ab263849d03fb892847be4986db759737"><div class="ttname"><a href="../../d8/d8a/astmm_8h.html#ab263849d03fb892847be4986db759737">ast_strdup</a></div><div class="ttdeci">#define ast_strdup(str)</div><div class="ttdoc">A wrapper for strdup() </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d8a/astmm_8h_source.html#l00243">astmm.h:243</a></div></div>
<div class="ttc" id="astobj2_8h_html_a1f8b41308be4c47de8ff89a3b9c7e7d1a75382dc9117cc118719edf6c3d2b71df"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#a1f8b41308be4c47de8ff89a3b9c7e7d1a75382dc9117cc118719edf6c3d2b71df">CMP_STOP</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l01032">astobj2.h:1032</a></div></div>
<div class="ttc" id="structast__datastore_html"><div class="ttname"><a href="../../d4/d5d/structast__datastore.html">ast_datastore</a></div><div class="ttdoc">Structure for a data store object. </div><div class="ttdef"><b>Definition:</b> <a href="../../d9/db6/datastore_8h_source.html#l00068">datastore.h:68</a></div></div>
<div class="ttc" id="channel_8h_html_aad1e09cd7c79237d05cffb45d6cdfd7c"><div class="ttname"><a href="../../d5/d7b/channel_8h.html#aad1e09cd7c79237d05cffb45d6cdfd7c">ast_channel_datastore_find</a></div><div class="ttdeci">struct ast_datastore * ast_channel_datastore_find(struct ast_channel *chan, const struct ast_datastore_info *info, const char *uid)</div><div class="ttdoc">Find a datastore on a channel. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d28/channel_8c_source.html#l02404">channel.c:2404</a></div></div>
<div class="ttc" id="file_8h_html"><div class="ttname"><a href="../../d2/d4d/file_8h.html">file.h</a></div><div class="ttdoc">Generic File Format Support. Should be included by clients of the file handling routines. File service providers should instead include mod_format.h. </div></div>
<div class="ttc" id="structast__fax__tech_html_ac57ec035c076b222b9420a68ddab3bf1"><div class="ttname"><a href="../../d9/d0e/structast__fax__tech.html#ac57ec035c076b222b9420a68ddab3bf1">ast_fax_tech::description</a></div><div class="ttdeci">const char *const description</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d6a/res__fax_8h_source.html#l00239">res_fax.h:239</a></div></div>
<div class="ttc" id="structast__fax__session__details_html_ab3f309860ee36512bc8bba783df26b1c"><div class="ttname"><a href="../../d8/dc2/structast__fax__session__details.html#ab3f309860ee36512bc8bba783df26b1c">ast_fax_session_details::faxdetect_timeout</a></div><div class="ttdeci">int faxdetect_timeout</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d6a/res__fax_8h_source.html#l00187">res_fax.h:187</a></div></div>
<div class="ttc" id="structfax__options_html_a975b0a45868387d13867daeac314978a"><div class="ttname"><a href="../../d0/d28/structfax__options.html#a975b0a45868387d13867daeac314978a">fax_options::maxrate</a></div><div class="ttdeci">unsigned int maxrate</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d60/res__fax_8c_source.html#l00533">res_fax.c:533</a></div></div>
<div class="ttc" id="test__func__file_8c_html_a7df83d295429a2562396f1ec127a46c0"><div class="ttname"><a href="../../d5/dde/test__func__file_8c.html#a7df83d295429a2562396f1ec127a46c0">args</a></div><div class="ttdeci">const char * args</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/dde/test__func__file_8c_source.html#l00046">test_func_file.c:46</a></div></div>
<div class="ttc" id="indications_8h_html_a9d5be069b7060d326a213f5d60b8dc77"><div class="ttname"><a href="../../d2/d0f/indications_8h.html#a9d5be069b7060d326a213f5d60b8dc77">ast_playtones_stop</a></div><div class="ttdeci">void ast_playtones_stop(struct ast_channel *chan)</div><div class="ttdoc">Stop playing tones on a channel. </div><div class="ttdef"><b>Definition:</b> <a href="../../df/d6e/indications_8c_source.html#l00393">indications.c:393</a></div></div>
<div class="ttc" id="res__fax_8c_html_a51e58bc93624e847e900cdc13b7bfa5a"><div class="ttname"><a href="../../d0/d60/res__fax_8c.html#a51e58bc93624e847e900cdc13b7bfa5a">fax_datastore</a></div><div class="ttdeci">static const struct ast_datastore_info fax_datastore</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d60/res__fax_8c_source.html#l00619">res_fax.c:619</a></div></div>
<div class="ttc" id="res__fax_8c_html_a37d092c7d520ee77021a0d9ce53af421"><div class="ttname"><a href="../../d0/d60/res__fax_8c.html#a37d092c7d520ee77021a0d9ce53af421">fax_gateway_request_t38</a></div><div class="ttdeci">static struct ast_frame * fax_gateway_request_t38(struct fax_gateway *gateway, struct ast_channel *chan)</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d60/res__fax_8c_source.html#l02972">res_fax.c:2972</a></div></div>
<div class="ttc" id="resample_8c_html_a070d2ce7b6bb7e5c05602aa8c308d0c4"><div class="ttname"><a href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a></div><div class="ttdeci">#define NULL</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d7f/resample_8c_source.html#l00096">resample.c:96</a></div></div>
<div class="ttc" id="res__fax_8c_html_a51a502192456037fec6aa542707fcfe4"><div class="ttname"><a href="../../d0/d60/res__fax_8c.html#a51a502192456037fec6aa542707fcfe4">session_details_new</a></div><div class="ttdeci">static struct ast_fax_session_details * session_details_new(void)</div><div class="ttdoc">create a FAX session details structure </div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d60/res__fax_8c_source.html#l00696">res_fax.c:696</a></div></div>
<div class="ttc" id="structfax__options_html_a8bff16fb9ab2254b86636f6fac166a66"><div class="ttname"><a href="../../d0/d28/structfax__options.html#a8bff16fb9ab2254b86636f6fac166a66">fax_options::minrate</a></div><div class="ttdeci">unsigned int minrate</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d60/res__fax_8c_source.html#l00532">res_fax.c:532</a></div></div>
<div class="ttc" id="io_8h_html"><div class="ttname"><a href="../../dc/dac/io_8h.html">io.h</a></div><div class="ttdoc">I/O Management (derived from Cheops-NG) </div></div>
<div class="ttc" id="eagi__proxy_8c_html_a8fd806ad19b8f5513a4cf18cbf77532c"><div class="ttname"><a href="../../dd/d7c/eagi__proxy_8c.html#a8fd806ad19b8f5513a4cf18cbf77532c">end</a></div><div class="ttdeci">char * end</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d7c/eagi__proxy_8c_source.html#l00073">eagi_proxy.c:73</a></div></div>
<div class="ttc" id="structast__fax__session_html_a84d1435c5b8d387806714ea7079304b7"><div class="ttname"><a href="../../d1/d16/structast__fax__session.html#a84d1435c5b8d387806714ea7079304b7">ast_fax_session::chan</a></div><div class="ttdeci">struct ast_channel * chan</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d6a/res__fax_8h_source.html#l00224">res_fax.h:224</a></div></div>
<div class="ttc" id="syslog_8c_html_ac4f474c82e82cbb89ca7c36dd52be0ed"><div class="ttname"><a href="../../d4/d2f/syslog_8c.html#ac4f474c82e82cbb89ca7c36dd52be0ed">value</a></div><div class="ttdeci">int value</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d2f/syslog_8c_source.html#l00037">syslog.c:37</a></div></div>
<div class="ttc" id="cli_8h_html_a791bf9f5637185bee5e8f0907c762130"><div class="ttname"><a href="../../dc/db0/cli_8h.html#a791bf9f5637185bee5e8f0907c762130">ast_cli</a></div><div class="ttdeci">void ast_cli(int fd, const char *fmt,...)</div><div class="ttdef"><b>Definition:</b> <a href="../../da/d4d/clicompat_8c_source.html#l00006">clicompat.c:6</a></div></div>
<div class="ttc" id="res__fax_8c_html_abb5f973c1052179a51f936be5c43a852"><div class="ttname"><a href="../../d0/d60/res__fax_8c.html#abb5f973c1052179a51f936be5c43a852">ast_fax_log</a></div><div class="ttdeci">void ast_fax_log(int level, const char *file, const int line, const char *function, const char *msg)</div><div class="ttdoc">Log message at FAX or recommended level. </div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d60/res__fax_8c_source.html#l01036">res_fax.c:1036</a></div></div>
<div class="ttc" id="include_2asterisk_2frame_8h_html_a248afd6c02044259a386f6b7aee922a2"><div class="ttname"><a href="../../d6/d66/include_2asterisk_2frame_8h.html#a248afd6c02044259a386f6b7aee922a2">AST_FRAME_DTMF</a></div><div class="ttdeci">#define AST_FRAME_DTMF</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d66/include_2asterisk_2frame_8h_source.html#l00139">include/asterisk/frame.h:139</a></div></div>
<div class="ttc" id="structfax__gateway_html_acf7d6ff8498e4c50ee13ac0711210c72"><div class="ttname"><a href="../../dd/dd2/structfax__gateway.html#acf7d6ff8498e4c50ee13ac0711210c72">fax_gateway::s</a></div><div class="ttdeci">struct ast_fax_session * s</div><div class="ttdoc">FAX Session. </div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d60/res__fax_8c_source.html#l00446">res_fax.c:446</a></div></div>
<div class="ttc" id="lock_8h_html_ac2920a1db37313ec46bd91dc83bf9c8a"><div class="ttname"><a href="../../dd/d42/lock_8h.html#ac2920a1db37313ec46bd91dc83bf9c8a">ast_rwlock_unlock</a></div><div class="ttdeci">#define ast_rwlock_unlock(a)</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d42/lock_8h_source.html#l00232">lock.h:232</a></div></div>
<div class="ttc" id="res__fax_8c_html_a87718f9b64d50c694da714f631626807"><div class="ttname"><a href="../../d0/d60/res__fax_8c.html#a87718f9b64d50c694da714f631626807">fax_gateway_attach</a></div><div class="ttdeci">static int fax_gateway_attach(struct ast_channel *chan, struct ast_fax_session_details *details)</div><div class="ttdoc">Attach a gateway framehook object to a channel. </div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d60/res__fax_8c_source.html#l03626">res_fax.c:3626</a></div></div>
<div class="ttc" id="res__fax_8c_html_a55af247b700c6bcc938efffd92e55802"><div class="ttname"><a href="../../d0/d60/res__fax_8c.html#a55af247b700c6bcc938efffd92e55802">fax_gateway_framehook</a></div><div class="ttdeci">static struct ast_frame * fax_gateway_framehook(struct ast_channel *chan, struct ast_frame *f, enum ast_framehook_event event, void *data)</div><div class="ttdoc">T.30&lt;-&gt;T.38 gateway framehook. </div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d60/res__fax_8c_source.html#l03383">res_fax.c:3383</a></div></div>
<div class="ttc" id="module_8h_html_ad2ca15621101154f29748cf1dac3c3cf"><div class="ttname"><a href="../../d5/d16/module_8h.html#ad2ca15621101154f29748cf1dac3c3cf">ast_unregister_application</a></div><div class="ttdeci">int ast_unregister_application(const char *app)</div><div class="ttdoc">Unregister an application. </div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d16/pbx__app_8c_source.html#l00392">pbx_app.c:392</a></div></div>
<div class="ttc" id="structfax__gateway_html_ac11fd22af311685dee2ccb296221cc86"><div class="ttname"><a href="../../dd/dd2/structfax__gateway.html#ac11fd22af311685dee2ccb296221cc86">fax_gateway::peer_read_format</a></div><div class="ttdeci">struct ast_format * peer_read_format</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d60/res__fax_8c_source.html#l00464">res_fax.c:464</a></div></div>
<div class="ttc" id="res__fax_8c_html_a563b007e45c3114b00faab5a9577fda1"><div class="ttname"><a href="../../d0/d60/res__fax_8c.html#a563b007e45c3114b00faab5a9577fda1">fax_v21_session_new</a></div><div class="ttdeci">static struct ast_fax_session * fax_v21_session_new(struct ast_channel *chan)</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d60/res__fax_8c_source.html#l02861">res_fax.c:2861</a></div></div>
<div class="ttc" id="channel_8h_html_a5e62602ca9e229304f60ab5c2b32e13b"><div class="ttname"><a href="../../d5/d7b/channel_8h.html#a5e62602ca9e229304f60ab5c2b32e13b">ast_waitfor_nandfds</a></div><div class="ttdeci">struct ast_channel * ast_waitfor_nandfds(struct ast_channel **chan, int n, int *fds, int nfds, int *exception, int *outfd, int *ms)</div><div class="ttdoc">Waits for activity on a group of channels. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d28/channel_8c_source.html#l02997">channel.c:2997</a></div></div>
<div class="ttc" id="res__fax_8c_html_a46275621a3d3846d089a092249fb8c37a8e81c5ccb5474dde66440f846fdfdd90"><div class="ttname"><a href="../../d0/d60/res__fax_8c.html#a46275621a3d3846d089a092249fb8c37a8e81c5ccb5474dde66440f846fdfdd90">OPT_CALLERMODE</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d60/res__fax_8c_source.html#l00559">res_fax.c:559</a></div></div>
<div class="ttc" id="smoother_8h_html"><div class="ttname"><a href="../../d6/d7f/smoother_8h.html">smoother.h</a></div><div class="ttdoc">Asterisk internal frame definitions. </div></div>
<div class="ttc" id="logger_8h_html_ad770f83c71e237e1f64163358ce4e13d"><div class="ttname"><a href="../../d1/d8c/logger_8h.html#ad770f83c71e237e1f64163358ce4e13d">ast_verb</a></div><div class="ttdeci">#define ast_verb(level,...)</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d8c/logger_8h_source.html#l00463">logger.h:463</a></div></div>
<div class="ttc" id="channel_8h_html_a6b4548259e61f691c654aed0025e5502"><div class="ttname"><a href="../../d5/d7b/channel_8h.html#a6b4548259e61f691c654aed0025e5502">ast_channel_readtrans</a></div><div class="ttdeci">struct ast_trans_pvt * ast_channel_readtrans(const struct ast_channel *chan)</div><div class="ttdef"><b>Definition:</b> <a href="../../db/de2/channel__internal__api_8c_source.html#l00753">channel_internal_api.c:753</a></div></div>
<div class="ttc" id="lock_8h_html_a8a3bd496edfec04a95683ace66676200"><div class="ttname"><a href="../../dd/d42/lock_8h.html#a8a3bd496edfec04a95683ace66676200">ast_atomic_fetchadd_int</a></div><div class="ttdeci">int ast_atomic_fetchadd_int(volatile int *p, int v)</div><div class="ttdoc">Atomically add v to *p and return the previous value of *p. </div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d42/lock_8h_source.html#l00755">lock.h:755</a></div></div>
<div class="ttc" id="pbx_8h_html_a965977ea9a3144bc203e0ce7a64680a1"><div class="ttname"><a href="../../db/de0/pbx_8h.html#a965977ea9a3144bc203e0ce7a64680a1">ast_custom_function_unregister</a></div><div class="ttdeci">int ast_custom_function_unregister(struct ast_custom_function *acf)</div><div class="ttdoc">Unregister a custom function. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/d70/pbx__functions_8c_source.html#l00273">pbx_functions.c:273</a></div></div>
<div class="ttc" id="datastore_8h_html_aee27286888b30c6448a9bce928040a14"><div class="ttname"><a href="../../d9/db6/datastore_8h.html#aee27286888b30c6448a9bce928040a14">ast_datastore_free</a></div><div class="ttdeci">int ast_datastore_free(struct ast_datastore *datastore)</div><div class="ttdoc">Free a data store object. </div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d7a/datastore_8c_source.html#l00068">datastore.c:68</a></div></div>
<div class="ttc" id="pbx_8h_html_a98c5425b90ec7c5e136a40f529170b1b"><div class="ttname"><a href="../../db/de0/pbx_8h.html#a98c5425b90ec7c5e136a40f529170b1b">pbx_builtin_getvar_helper</a></div><div class="ttdeci">const char * pbx_builtin_getvar_helper(struct ast_channel *chan, const char *name)</div><div class="ttdoc">Return a pointer to the value of the corresponding channel variable. </div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d8c/pbx__variables_8c_source.html#l01000">pbx_variables.c:1000</a></div></div>
<div class="ttc" id="structast__frame_html_a27237c48fdcd22556401f20c693811db"><div class="ttname"><a href="../../d0/d99/structast__frame.html#a27237c48fdcd22556401f20c693811db">ast_frame::subclass</a></div><div class="ttdeci">struct ast_frame_subclass subclass</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d66/include_2asterisk_2frame_8h_source.html#l00169">include/asterisk/frame.h:169</a></div></div>
<div class="ttc" id="utils_8h_html"><div class="ttname"><a href="../../d5/d60/utils_8h.html">utils.h</a></div><div class="ttdoc">Utility functions. </div></div>
<div class="ttc" id="structast__cli__entry_html_a1bd7a8575ca2650132d636d65dcda2f6"><div class="ttname"><a href="../../d8/d07/structast__cli__entry.html#a1bd7a8575ca2650132d636d65dcda2f6">ast_cli_entry::args</a></div><div class="ttdeci">int args</div><div class="ttdoc">This gets set in ast_cli_register() </div><div class="ttdef"><b>Definition:</b> <a href="../../dc/db0/cli_8h_source.html#l00185">cli.h:185</a></div></div>
<div class="ttc" id="group__Group__AMI_html_gac6a9f3498f9afffecfd78c485af41556"><div class="ttname"><a href="../../df/d72/group__Group__AMI.html#gac6a9f3498f9afffecfd78c485af41556">astman_get_header</a></div><div class="ttdeci">const char * astman_get_header(const struct message *m, char *var)</div><div class="ttdoc">Get header from mananger transaction. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d10/manager_8c_source.html#l02820">manager.c:2820</a></div></div>
<div class="ttc" id="res__fax_8c_html_ac3382bf6da54c56b37069bd76bbdf4f9"><div class="ttname"><a href="../../d0/d60/res__fax_8c.html#ac3382bf6da54c56b37069bd76bbdf4f9">load_module</a></div><div class="ttdeci">static int load_module(void)</div><div class="ttdoc">Load the module. </div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d60/res__fax_8c_source.html#l04788">res_fax.c:4788</a></div></div>
<div class="ttc" id="module_8h_html_a15896c26e51e8162df5eb9a0124c841f"><div class="ttname"><a href="../../d5/d16/module_8h.html#a15896c26e51e8162df5eb9a0124c841f">ast_module_unref</a></div><div class="ttdeci">#define ast_module_unref(mod)</div><div class="ttdoc">Release a reference to the module. </div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d16/module_8h_source.html#l00469">module.h:469</a></div></div>
<div class="ttc" id="strings_8h_html_a372554b7a2d69a8bd3adac5157672036"><div class="ttname"><a href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a></div><div class="ttdeci">#define ast_strlen_zero(foo)</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d90/strings_8h_source.html#l00052">strings.h:52</a></div></div>
<div class="ttc" id="res__fax_8c_html_ac527bcc9f23787a9eca1e170210f361e"><div class="ttname"><a href="../../d0/d60/res__fax_8c.html#ac527bcc9f23787a9eca1e170210f361e">fax_detect_framehook</a></div><div class="ttdeci">static struct ast_frame * fax_detect_framehook(struct ast_channel *chan, struct ast_frame *f, enum ast_framehook_event event, void *data)</div><div class="ttdoc">Fax Detect Framehook. </div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d60/res__fax_8c_source.html#l03745">res_fax.c:3745</a></div></div>
<div class="ttc" id="channel_8h_html_aaced431562223538a94e0e69cf94151a"><div class="ttname"><a href="../../d5/d7b/channel_8h.html#aaced431562223538a94e0e69cf94151a">ast_channel_readformat</a></div><div class="ttdeci">struct ast_format * ast_channel_readformat(struct ast_channel *chan)</div><div class="ttdef"><b>Definition:</b> <a href="../../db/de2/channel__internal__api_8c_source.html#l00856">channel_internal_api.c:856</a></div></div>
<div class="ttc" id="structast__fax__session__details_html_ab7ce6f462afaf105224b0ca772a33c43"><div class="ttname"><a href="../../d8/dc2/structast__fax__session__details.html#ab7ce6f462afaf105224b0ca772a33c43">ast_fax_session_details::id</a></div><div class="ttdeci">unsigned int id</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d6a/res__fax_8h_source.html#l00117">res_fax.h:117</a></div></div>
<div class="ttc" id="include_2asterisk_2frame_8h_html_aedda41918e992000fe921f8f7363b390a7334c9d27a6d70fe7c85b60b864788fc"><div class="ttname"><a href="../../d6/d66/include_2asterisk_2frame_8h.html#aedda41918e992000fe921f8f7363b390a7334c9d27a6d70fe7c85b60b864788fc">AST_CONTROL_T38_PARAMETERS</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d66/include_2asterisk_2frame_8h_source.html#l00301">include/asterisk/frame.h:301</a></div></div>
<div class="ttc" id="include_2asterisk_2app_8h_html_a520a3c6b7d57903d9a616051da1a019d"><div class="ttname"><a href="../../d3/d93/include_2asterisk_2app_8h.html#a520a3c6b7d57903d9a616051da1a019d">AST_APP_OPTIONS</a></div><div class="ttdeci">#define AST_APP_OPTIONS(holder, options...)</div><div class="ttdoc">Declares an array of options for an application. </div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d93/include_2asterisk_2app_8h_source.html#l01393">include/asterisk/app.h:1393</a></div></div>
<div class="ttc" id="structnumber_html"><div class="ttname"><a href="../../d6/d49/structnumber.html">number</a></div><div class="ttdoc">Number structure. </div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d55/app__followme_8c_source.html#l00154">app_followme.c:154</a></div></div>
<div class="ttc" id="astobj2_8h_html_ac438c3fcd3150481fad38689fd813a15"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#ac438c3fcd3150481fad38689fd813a15">ao2_bump</a></div><div class="ttdeci">#define ao2_bump(obj)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l00491">astobj2.h:491</a></div></div>
<div class="ttc" id="structast__fax__session__details_html_a71957d41c126c8b61cb93b69894d21fe"><div class="ttname"><a href="../../d8/dc2/structast__fax__session__details.html#a71957d41c126c8b61cb93b69894d21fe">ast_fax_session_details::send_ced</a></div><div class="ttdeci">uint32_t send_ced</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d6a/res__fax_8h_source.html#l00161">res_fax.h:161</a></div></div>
<div class="ttc" id="res__fax_8c_html_abaa1897073e2e290097650bfbbe25d46"><div class="ttname"><a href="../../d0/d60/res__fax_8c.html#abaa1897073e2e290097650bfbbe25d46">cli_fax_show_sessions</a></div><div class="ttdeci">static char * cli_fax_show_sessions(struct ast_cli_entry *e, int cmd, struct ast_cli_args *a)</div><div class="ttdoc">display fax sessions </div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d60/res__fax_8c_source.html#l04273">res_fax.c:4273</a></div></div>
<div class="ttc" id="res__fax_8c_html_a6268c89f90792764152ddfa24154a78e"><div class="ttname"><a href="../../d0/d60/res__fax_8c.html#a6268c89f90792764152ddfa24154a78e">fixup_callback</a></div><div class="ttdeci">static void fixup_callback(void *data, struct ast_channel *old_chan, struct ast_channel *new_chan)</div><div class="ttdoc">Copies fax detection and gateway framehooks during masquerades. </div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d60/res__fax_8c_source.html#l00636">res_fax.c:636</a></div></div>
<div class="ttc" id="framehook_8h_html_a3ca711dc98d26e881936c855f0ae3d77"><div class="ttname"><a href="../../db/d3c/framehook_8h.html#a3ca711dc98d26e881936c855f0ae3d77">ast_framehook_attach</a></div><div class="ttdeci">int ast_framehook_attach(struct ast_channel *chan, struct ast_framehook_interface *i)</div><div class="ttdoc">Attach an framehook onto a channel for frame interception. </div><div class="ttdef"><b>Definition:</b> <a href="../../da/dac/framehook_8c_source.html#l00132">framehook.c:132</a></div></div>
<div class="ttc" id="channel_8h_html_a4cd990f4c1cd0c2af6e4c63f6d15b4e1ad3745918c0830d3816e5ce5561814e7e"><div class="ttname"><a href="../../d5/d7b/channel_8h.html#a4cd990f4c1cd0c2af6e4c63f6d15b4e1ad3745918c0830d3816e5ce5561814e7e">T38_STATE_REJECTED</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d7b/channel_8h_source.html#l00883">channel.h:883</a></div></div>
<div class="ttc" id="res__fax_8h_html_ab9287e81dc5d3047da0bcb1f6c89bd57a7f0a2c297f96556e6d4af522930d1ccc"><div class="ttname"><a href="../../db/d6a/res__fax_8h.html#ab9287e81dc5d3047da0bcb1f6c89bd57a7f0a2c297f96556e6d4af522930d1ccc">AST_FAX_MODEM_V29</a></div><div class="ttdef"><b>Definition:</b> <a href="../../db/d6a/res__fax_8h_source.html#l00059">res_fax.h:59</a></div></div>
<div class="ttc" id="logger_8h_html_ae3d21782b3b66b21cda6d9e153545909"><div class="ttname"><a href="../../d1/d8c/logger_8h.html#ae3d21782b3b66b21cda6d9e153545909">ast_logger_unregister_level</a></div><div class="ttdeci">void ast_logger_unregister_level(const char *name)</div><div class="ttdoc">Unregister a previously registered logger level. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d22/logger_8c_source.html#l02536">logger.c:2536</a></div></div>
<div class="ttc" id="structast__fax__session__details_html_ad3795f2a4b1e30b36f642bdcc0ec4586"><div class="ttname"><a href="../../d8/dc2/structast__fax__session__details.html#ad3795f2a4b1e30b36f642bdcc0ec4586">ast_fax_session_details::send_cng</a></div><div class="ttdeci">uint32_t send_cng</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d6a/res__fax_8h_source.html#l00163">res_fax.h:163</a></div></div>
<div class="ttc" id="structast__fax__session__details_html_a3ab211dbe8780b7292257f6b3dba1952"><div class="ttname"><a href="../../d8/dc2/structast__fax__session__details.html#a3ab211dbe8780b7292257f6b3dba1952">ast_fax_session_details::option</a></div><div class="ttdeci">union ast_fax_session_details::@290 option</div></div>
<div class="ttc" id="include_2asterisk_2config_8h_html"><div class="ttname"><a href="../../d3/de6/include_2asterisk_2config_8h.html">config.h</a></div><div class="ttdoc">Configuration File Parser. </div></div>
<div class="ttc" id="res__fax_8h_html_ab34810136037068a0847bcca2518112ca11037f2ac950e3e5281b419aef13e3dc"><div class="ttname"><a href="../../db/d6a/res__fax_8h.html#ab34810136037068a0847bcca2518112ca11037f2ac950e3e5281b419aef13e3dc">AST_FAX_STATE_INITIALIZED</a></div><div class="ttdef"><b>Definition:</b> <a href="../../db/d6a/res__fax_8h_source.html#l00069">res_fax.h:69</a></div></div>
<div class="ttc" id="linkedlists_8h_html_a0a0fe104cc2cc36a43784f886f3ae7dc"><div class="ttname"><a href="../../df/d90/linkedlists_8h.html#a0a0fe104cc2cc36a43784f886f3ae7dc">AST_RWLIST_RDLOCK</a></div><div class="ttdeci">#define AST_RWLIST_RDLOCK(head)</div><div class="ttdoc">Read locks a list. </div><div class="ttdef"><b>Definition:</b> <a href="../../df/d90/linkedlists_8h_source.html#l00077">linkedlists.h:77</a></div></div>
<div class="ttc" id="smoother_8h_html_a6d3b71e0a81af743bae6c33c02b64f1f"><div class="ttname"><a href="../../d6/d7f/smoother_8h.html#a6d3b71e0a81af743bae6c33c02b64f1f">ast_smoother_free</a></div><div class="ttdeci">void ast_smoother_free(struct ast_smoother *s)</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/dd7/smoother_8c_source.html#l00220">smoother.c:220</a></div></div>
<div class="ttc" id="res__fax_8h_html_ab34810136037068a0847bcca2518112ca522d0463615626bcc42a3dd5716651dd"><div class="ttname"><a href="../../db/d6a/res__fax_8h.html#ab34810136037068a0847bcca2518112ca522d0463615626bcc42a3dd5716651dd">AST_FAX_STATE_INACTIVE</a></div><div class="ttdef"><b>Definition:</b> <a href="../../db/d6a/res__fax_8h_source.html#l00079">res_fax.h:79</a></div></div>
<div class="ttc" id="structast__fax__session_html_a881c40036288d692235f426586f2352b"><div class="ttname"><a href="../../d1/d16/structast__fax__session.html#a881c40036288d692235f426586f2352b">ast_fax_session::debug_info</a></div><div class="ttdeci">struct ast_fax_debug_info * debug_info</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d6a/res__fax_8h_source.html#l00226">res_fax.h:226</a></div></div>
<div class="ttc" id="res__fax_8c_html_a1e8694b9fd8a3141f361235450a323ab"><div class="ttname"><a href="../../d0/d60/res__fax_8c.html#a1e8694b9fd8a3141f361235450a323ab">update_modem_bits</a></div><div class="ttdeci">static int update_modem_bits(enum ast_fax_modems *bits, const char *value)</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d60/res__fax_8c_source.html#l00812">res_fax.c:812</a></div></div>
<div class="ttc" id="structast__frame__subclass_html_adece183191b0e700e039e59101e06105"><div class="ttname"><a href="../../d1/d9f/structast__frame__subclass.html#adece183191b0e700e039e59101e06105">ast_frame_subclass::integer</a></div><div class="ttdeci">int integer</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d66/include_2asterisk_2frame_8h_source.html#l00152">include/asterisk/frame.h:152</a></div></div>
<div class="ttc" id="logger_8h_html_a3f248112c8d6ce7e3959aa723dade648"><div class="ttname"><a href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a></div><div class="ttdeci">#define ast_debug(level,...)</div><div class="ttdoc">Log a DEBUG message. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d8c/logger_8h_source.html#l00452">logger.h:452</a></div></div>
<div class="ttc" id="astobj2_8c_html_a96a00b3a518d7f32b6d51dc28f09bf9b"><div class="ttname"><a href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a></div><div class="ttdeci">#define ast_log</div><div class="ttdef"><b>Definition:</b> <a href="../../da/df7/astobj2_8c_source.html#l00042">astobj2.c:42</a></div></div>
<div class="ttc" id="structast__fax__debug__info_html"><div class="ttname"><a href="../../d3/d84/structast__fax__debug__info.html">ast_fax_debug_info</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d60/res__fax_8c_source.html#l00437">res_fax.c:437</a></div></div>
<div class="ttc" id="res__fax_8h_html_a54eb45ad548b874cf12d0a599631e3f6a77bcc28b15614142ddbf4a180d263602"><div class="ttname"><a href="../../db/d6a/res__fax_8h.html#a54eb45ad548b874cf12d0a599631e3f6a77bcc28b15614142ddbf4a180d263602">AST_FAX_TECH_RECEIVE</a></div><div class="ttdef"><b>Definition:</b> <a href="../../db/d6a/res__fax_8h_source.html#l00039">res_fax.h:39</a></div></div>
<div class="ttc" id="res__fax_8c_html_a0b0465081fc0fba59df0daa857ed49bf"><div class="ttname"><a href="../../d0/d60/res__fax_8c.html#a0b0465081fc0fba59df0daa857ed49bf">acf_faxopt_write</a></div><div class="ttdeci">static int acf_faxopt_write(struct ast_channel *chan, const char *cmd, char *data, const char *value)</div><div class="ttdoc">FAXOPT write function modifies the contents of a FAX option. </div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d60/res__fax_8c_source.html#l04601">res_fax.c:4601</a></div></div>
<div class="ttc" id="res__fax_8c_html_ac6fce80bf868971a37f69e9db4111924"><div class="ttname"><a href="../../d0/d60/res__fax_8c.html#ac6fce80bf868971a37f69e9db4111924">GENERIC_FAX_EXEC_SET_VARS</a></div><div class="ttdeci">#define GENERIC_FAX_EXEC_SET_VARS(fax, chan, errorstr, reason)</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d60/res__fax_8c_source.html#l01469">res_fax.c:1469</a></div></div>
<div class="ttc" id="structast__control__t38__parameters_html_ad2b3d53474db70e3ff2058da953b7b82"><div class="ttname"><a href="../../d5/def/structast__control__t38__parameters.html#ad2b3d53474db70e3ff2058da953b7b82">ast_control_t38_parameters::transcoding_mmr</a></div><div class="ttdeci">unsigned int transcoding_mmr</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d66/include_2asterisk_2frame_8h_source.html#l00404">include/asterisk/frame.h:404</a></div></div>
<div class="ttc" id="structast__variable_html_a8556878012feffc9e0beb86cd78f424d"><div class="ttname"><a href="../../dd/d02/structast__variable.html#a8556878012feffc9e0beb86cd78f424d">ast_variable::value</a></div><div class="ttdeci">const char * value</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/de6/include_2asterisk_2config_8h_source.html#l00087">include/asterisk/config.h:87</a></div></div>
<div class="ttc" id="structast__fax__session__details_html_a80632865b575d06f319ef95c42645b2c"><div class="ttname"><a href="../../d8/dc2/structast__fax__session__details.html#a80632865b575d06f319ef95c42645b2c">ast_fax_session_details::our_t38_parameters</a></div><div class="ttdeci">struct ast_fax_t38_parameters our_t38_parameters</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d6a/res__fax_8h_source.html#l00175">res_fax.h:175</a></div></div>
<div class="ttc" id="channel_8h_html_a4aff0f5358bdc107a92320b4c4631834"><div class="ttname"><a href="../../d5/d7b/channel_8h.html#a4aff0f5358bdc107a92320b4c4631834">ast_channel_make_compatible</a></div><div class="ttdeci">int ast_channel_make_compatible(struct ast_channel *chan, struct ast_channel *peer)</div><div class="ttdoc">Make the frame formats of two channels compatible. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d28/channel_8c_source.html#l06817">channel.c:6817</a></div></div>
<div class="ttc" id="include_2asterisk_2frame_8h_html_a9db3df106b7deebbee4c5106a880ec33abbb1b9b329ded73597a5c2eefe13a34c"><div class="ttname"><a href="../../d6/d66/include_2asterisk_2frame_8h.html#a9db3df106b7deebbee4c5106a880ec33abbb1b9b329ded73597a5c2eefe13a34c">AST_T38_RATE_MANAGEMENT_TRANSFERRED_TCF</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d66/include_2asterisk_2frame_8h_source.html#l00393">include/asterisk/frame.h:393</a></div></div>
<div class="ttc" id="logger_8h_html_a2fdd5bff193a29ec6c7278da2851ea56"><div class="ttname"><a href="../../d1/d8c/logger_8h.html#a2fdd5bff193a29ec6c7278da2851ea56">AST_LOG_ERROR</a></div><div class="ttdeci">#define AST_LOG_ERROR</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d8c/logger_8h_source.html#l00290">logger.h:290</a></div></div>
<div class="ttc" id="format_8h_html_a738c58eca291b71de4422e95bff27400"><div class="ttname"><a href="../../d0/d0a/format_8h.html#a738c58eca291b71de4422e95bff27400">ast_format_cmp</a></div><div class="ttdeci">enum ast_format_cmp_res ast_format_cmp(const struct ast_format *format1, const struct ast_format *format2)</div><div class="ttdoc">Compare two formats. </div><div class="ttdef"><b>Definition:</b> <a href="../../de/da6/format_8c_source.html#l00201">format.c:201</a></div></div>
<div class="ttc" id="format_8h_html_a79bdf0b3c0616d9950d00cfeb62295c3ad88eb6e1d9b89b5e60412393b887391c"><div class="ttname"><a href="../../d0/d0a/format_8h.html#a79bdf0b3c0616d9950d00cfeb62295c3ad88eb6e1d9b89b5e60412393b887391c">AST_FORMAT_CMP_NOT_EQUAL</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d0a/format_8h_source.html#l00038">format.h:38</a></div></div>
<div class="ttc" id="strings_8h_html_a603020160399d4876ec09fd299ebcaf9"><div class="ttname"><a href="../../d6/d90/strings_8h.html#a603020160399d4876ec09fd299ebcaf9">ast_build_string</a></div><div class="ttdeci">int ast_build_string(char **buffer, size_t *space, const char *fmt,...)</div><div class="ttdoc">Build a string in a buffer, designed to be called repeatedly. </div><div class="ttdef"><b>Definition:</b> <a href="../../de/d1f/main_2utils_8c_source.html#l01919">main/utils.c:1919</a></div></div>
<div class="ttc" id="res__fax_8h_html_ab9287e81dc5d3047da0bcb1f6c89bd57a2faab4efa2a8027ed56a92cc758a7bb0"><div class="ttname"><a href="../../db/d6a/res__fax_8h.html#ab9287e81dc5d3047da0bcb1f6c89bd57a2faab4efa2a8027ed56a92cc758a7bb0">AST_FAX_MODEM_V17</a></div><div class="ttdef"><b>Definition:</b> <a href="../../db/d6a/res__fax_8h_source.html#l00055">res_fax.h:55</a></div></div>
<div class="ttc" id="res__fax_8c_html_a1d2f98b9f7e7f3a8217c9afa7f1915a2"><div class="ttname"><a href="../../d0/d60/res__fax_8c.html#a1d2f98b9f7e7f3a8217c9afa7f1915a2">cli_fax_show_version</a></div><div class="ttdeci">static char * cli_fax_show_version(struct ast_cli_entry *e, int cmd, struct ast_cli_args *a)</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d60/res__fax_8c_source.html#l03971">res_fax.c:3971</a></div></div>
<div class="ttc" id="lock_8h_html_aa11d2e2d6aaa7048d48491842c1de738"><div class="ttname"><a href="../../dd/d42/lock_8h.html#aa11d2e2d6aaa7048d48491842c1de738">SCOPED_CHANNELLOCK</a></div><div class="ttdeci">#define SCOPED_CHANNELLOCK(varname, chan)</div><div class="ttdoc">scoped lock specialization for channels. </div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d42/lock_8h_source.html#l00617">lock.h:617</a></div></div>
<div class="ttc" id="channel_8h_html"><div class="ttname"><a href="../../d5/d7b/channel_8h.html">channel.h</a></div><div class="ttdoc">General Asterisk PBX channel definitions. </div></div>
<div class="ttc" id="res__fax_8c_html_aac8f65ba9ce0d6ea865b98cc415003cf"><div class="ttname"><a href="../../d0/d60/res__fax_8c.html#aac8f65ba9ce0d6ea865b98cc415003cf">cli_fax_show_session</a></div><div class="ttdeci">static char * cli_fax_show_session(struct ast_cli_entry *e, int cmd, struct ast_cli_args *a)</div><div class="ttdoc">display details of a specified fax session </div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d60/res__fax_8c_source.html#l04107">res_fax.c:4107</a></div></div>
<div class="ttc" id="module_8h_html_a155a0df9c59e04e305d4a2fa3e35f843a12c3f60dd7655dfa8d4430cbf04b1223"><div class="ttname"><a href="../../d5/d16/module_8h.html#a155a0df9c59e04e305d4a2fa3e35f843a12c3f60dd7655dfa8d4430cbf04b1223">AST_MODFLAG_LOAD_ORDER</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d16/module_8h_source.html#l00317">module.h:317</a></div></div>
<div class="ttc" id="structast__fax__tech_html_ad75375cdd336e91cbcee4a829fcdabfe"><div class="ttname"><a href="../../d9/d0e/structast__fax__tech.html#ad75375cdd336e91cbcee4a829fcdabfe">ast_fax_tech::caps</a></div><div class="ttdeci">enum ast_fax_capabilities caps</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d6a/res__fax_8h_source.html#l00243">res_fax.h:243</a></div></div>
<div class="ttc" id="structast__fax__tech_html_ac543607ff0378532fea1bc788b9dce08"><div class="ttname"><a href="../../d9/d0e/structast__fax__tech.html#ac543607ff0378532fea1bc788b9dce08">ast_fax_tech::reserve_session</a></div><div class="ttdeci">struct ast_fax_tech_token *(*const reserve_session)(struct ast_fax_session *)</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d6a/res__fax_8h_source.html#l00247">res_fax.h:247</a></div></div>
<div class="ttc" id="structast__frame_html_af51e37c9331049b1e3d250a7c8bc3c26"><div class="ttname"><a href="../../d0/d99/structast__frame.html#af51e37c9331049b1e3d250a7c8bc3c26">ast_frame::src</a></div><div class="ttdeci">const char * src</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d66/include_2asterisk_2frame_8h_source.html#l00181">include/asterisk/frame.h:181</a></div></div>
<div class="ttc" id="group__Group__AMI_html_gabf7c909efbfc26d0d9c66786c83b8f69"><div class="ttname"><a href="../../df/d72/group__Group__AMI.html#gabf7c909efbfc26d0d9c66786c83b8f69">astman_send_list_complete_end</a></div><div class="ttdeci">void astman_send_list_complete_end(struct mansession *s)</div><div class="ttdoc">End the list complete event. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d10/manager_8c_source.html#l03245">manager.c:3245</a></div></div>
<div class="ttc" id="channel_8h_html_a9107a83365cbf327cc0d12cb0dbd28d8"><div class="ttname"><a href="../../d5/d7b/channel_8h.html#a9107a83365cbf327cc0d12cb0dbd28d8">ast_set_read_format</a></div><div class="ttdeci">int ast_set_read_format(struct ast_channel *chan, struct ast_format *format)</div><div class="ttdoc">Sets read format on channel chan. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d28/channel_8c_source.html#l05849">channel.c:5849</a></div></div>
<div class="ttc" id="utils_8h_html_a1604b4d72144dd3d9f7da668e90337e9"><div class="ttname"><a href="../../d5/d60/utils_8h.html#a1604b4d72144dd3d9f7da668e90337e9">RAII_VAR</a></div><div class="ttdeci">#define RAII_VAR(vartype, varname, initval, dtor)</div><div class="ttdoc">Declare a variable that will call a destructor function when it goes out of scope. </div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d60/utils_8h_source.html#l00911">utils.h:911</a></div></div>
<div class="ttc" id="framehook_8h_html_a54250544f50efde9156d2341e8da0614a8e96ab8d6971c2abf694c55ed52653d9"><div class="ttname"><a href="../../db/d3c/framehook_8h.html#a54250544f50efde9156d2341e8da0614a8e96ab8d6971c2abf694c55ed52653d9">AST_FRAMEHOOK_EVENT_WRITE</a></div><div class="ttdef"><b>Definition:</b> <a href="../../db/d3c/framehook_8h_source.html#l00153">framehook.h:153</a></div></div>
<div class="ttc" id="json_8h_html_adc52f8d76b7fdd0c8d12987981fd5bf5"><div class="ttname"><a href="../../d4/d05/json_8h.html#adc52f8d76b7fdd0c8d12987981fd5bf5">ast_json_string_create</a></div><div class="ttdeci">struct ast_json * ast_json_string_create(const char *value)</div><div class="ttdoc">Construct a JSON string from value. </div><div class="ttdef"><b>Definition:</b> <a href="../../df/d98/json_8c_source.html#l00268">json.c:268</a></div></div>
<div class="ttc" id="structast__fax__t38__parameters_html"><div class="ttname"><a href="../../d3/df6/structast__fax__t38__parameters.html">ast_fax_t38_parameters</a></div><div class="ttdef"><b>Definition:</b> <a href="../../db/d6a/res__fax_8h_source.html#l00092">res_fax.h:92</a></div></div>
<div class="ttc" id="res__fax_8c_html_ae3ee13924d0059d65a340212b5117a48"><div class="ttname"><a href="../../d0/d60/res__fax_8c.html#ae3ee13924d0059d65a340212b5117a48">disable_t38</a></div><div class="ttdeci">static int disable_t38(struct ast_channel *chan)</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d60/res__fax_8c_source.html#l01527">res_fax.c:1527</a></div></div>
<div class="ttc" id="structast__cli__args_html_acf64f219885421479997667d2ed3f08a"><div class="ttname"><a href="../../d3/dad/structast__cli__args.html#acf64f219885421479997667d2ed3f08a">ast_cli_args::fd</a></div><div class="ttdeci">const int fd</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/db0/cli_8h_source.html#l00159">cli.h:159</a></div></div>
<div class="ttc" id="stringfields_8h_html_a871274fa4fd2687c7a44849a84df3665"><div class="ttname"><a href="../../d1/d0f/stringfields_8h.html#a871274fa4fd2687c7a44849a84df3665">ast_string_field_init</a></div><div class="ttdeci">#define ast_string_field_init(x, size)</div><div class="ttdoc">Initialize a field pool and fields. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d0f/stringfields_8h_source.html#l00353">stringfields.h:353</a></div></div>
<div class="ttc" id="structast__dsp_html"><div class="ttname"><a href="../../d6/de5/structast__dsp.html">ast_dsp</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d3b/dsp_8c_source.html#l00405">dsp.c:405</a></div></div>
<div class="ttc" id="astman_8c_html_ac4a6ae0400e4457f0b35beddec80c93d"><div class="ttname"><a href="../../d2/d4d/astman_8c.html#ac4a6ae0400e4457f0b35beddec80c93d">session</a></div><div class="ttdeci">static struct ast_mansession session</div></div>
<div class="ttc" id="include_2asterisk_2frame_8h_html_a168d496bdac09ece3ce49cf473bbdb4baa02b30f25621f20396d06f5ac8aa7a2e"><div class="ttname"><a href="../../d6/d66/include_2asterisk_2frame_8h.html#a168d496bdac09ece3ce49cf473bbdb4baa02b30f25621f20396d06f5ac8aa7a2e">AST_T38_REFUSED</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d66/include_2asterisk_2frame_8h_source.html#l00375">include/asterisk/frame.h:375</a></div></div>
<div class="ttc" id="structast__cli__args_html_acfc02ec89670db29251fda6a66602ce2"><div class="ttname"><a href="../../d3/dad/structast__cli__args.html#acfc02ec89670db29251fda6a66602ce2">ast_cli_args::n</a></div><div class="ttdeci">const int n</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/db0/cli_8h_source.html#l00165">cli.h:165</a></div></div>
<div class="ttc" id="structast__custom__function_html"><div class="ttname"><a href="../../db/dc0/structast__custom__function.html">ast_custom_function</a></div><div class="ttdoc">Data structure associated with a custom dialplan function. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/de0/pbx_8h_source.html#l00118">pbx.h:118</a></div></div>
<div class="ttc" id="res__fax_8c_html_a693b0f3ff5d9020fe797cdc46e9489d4"><div class="ttname"><a href="../../d0/d60/res__fax_8c.html#a693b0f3ff5d9020fe797cdc46e9489d4">check_modem_rate</a></div><div class="ttdeci">static int check_modem_rate(enum ast_fax_modems modems, unsigned int rate)</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d60/res__fax_8c_source.html#l00938">res_fax.c:938</a></div></div>
<div class="ttc" id="astobj2_8h_html"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html">astobj2.h</a></div></div>
<div class="ttc" id="app__meetme_8c_html_adf04f66344e3fb0a6f6a69bf39d19902"><div class="ttname"><a href="../../df/d44/app__meetme_8c.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a></div><div class="ttdeci">ast_mutex_t lock</div><div class="ttdef"><b>Definition:</b> <a href="../../df/d44/app__meetme_8c_source.html#l01091">app_meetme.c:1091</a></div></div>
<div class="ttc" id="linkedlists_8h_html_a944b82566722f2247aa35f1328402c98"><div class="ttname"><a href="../../df/d90/linkedlists_8h.html#a944b82566722f2247aa35f1328402c98">AST_RWLIST_TRAVERSE</a></div><div class="ttdeci">#define AST_RWLIST_TRAVERSE</div><div class="ttdef"><b>Definition:</b> <a href="../../df/d90/linkedlists_8h_source.html#l00493">linkedlists.h:493</a></div></div>
<div class="ttc" id="structast__frame_html_ad67e07841d1233e596e6f822a3c81f6b"><div class="ttname"><a href="../../d0/d99/structast__frame.html#ad67e07841d1233e596e6f822a3c81f6b">ast_frame::datalen</a></div><div class="ttdeci">int datalen</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d66/include_2asterisk_2frame_8h_source.html#l00171">include/asterisk/frame.h:171</a></div></div>
<div class="ttc" id="channel_8h_html_a4cd990f4c1cd0c2af6e4c63f6d15b4e1a8bd9e539fb6a17b095fb24a75e0b4d21"><div class="ttname"><a href="../../d5/d7b/channel_8h.html#a4cd990f4c1cd0c2af6e4c63f6d15b4e1a8bd9e539fb6a17b095fb24a75e0b4d21">T38_STATE_UNAVAILABLE</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d7b/channel_8h_source.html#l00880">channel.h:880</a></div></div>
<div class="ttc" id="res__fax_8c_html_a39b1d432fa7056aa4737e302b608f8ee"><div class="ttname"><a href="../../d0/d60/res__fax_8c.html#a39b1d432fa7056aa4737e302b608f8ee">app_receivefax</a></div><div class="ttdeci">static const char app_receivefax[]</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d60/res__fax_8c_source.html#l00428">res_fax.c:428</a></div></div>
<div class="ttc" id="res__fax_8c_html_a387384e096d0670b954f14891a26be61"><div class="ttname"><a href="../../d0/d60/res__fax_8c.html#a387384e096d0670b954f14891a26be61">destroy_gateway</a></div><div class="ttdeci">static void destroy_gateway(void *data)</div><div class="ttdoc">destroy a FAX gateway session structure </div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d60/res__fax_8c_source.html#l02839">res_fax.c:2839</a></div></div>
<div class="ttc" id="structfax__gateway_html_a997059bcc0230f25cde254408e405d02"><div class="ttname"><a href="../../dd/dd2/structfax__gateway.html#a997059bcc0230f25cde254408e405d02">fax_gateway::peer_write_format</a></div><div class="ttdeci">struct ast_format * peer_write_format</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d60/res__fax_8c_source.html#l00465">res_fax.c:465</a></div></div>
<div class="ttc" id="astobj2_8h_html_aaca5e8eac39a22f9da1c36fc6c922270"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a></div><div class="ttdeci">#define ao2_ref(o, delta)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l00464">astobj2.h:464</a></div></div>
<div class="ttc" id="astobj2_8h_html_a1f8b41308be4c47de8ff89a3b9c7e7d1a1959468a3c5d6aecd2fa1272d8e30fbf"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#a1f8b41308be4c47de8ff89a3b9c7e7d1a1959468a3c5d6aecd2fa1272d8e30fbf">CMP_MATCH</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l01031">astobj2.h:1031</a></div></div>
<div class="ttc" id="strings_8h_html_a38a896048b2ca84076864505f0aa8f01"><div class="ttname"><a href="../../d6/d90/strings_8h.html#a38a896048b2ca84076864505f0aa8f01">S_COR</a></div><div class="ttdeci">#define S_COR(a, b, c)</div><div class="ttdoc">returns the equivalent of logic or for strings, with an additional boolean check: second one if not e...</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d90/strings_8h_source.html#l00085">strings.h:85</a></div></div>
<div class="ttc" id="structast__fax__session_html_ae7b633178d301df70e8612b4ce1aeb77"><div class="ttname"><a href="../../d1/d16/structast__fax__session.html#ae7b633178d301df70e8612b4ce1aeb77">ast_fax_session::details</a></div><div class="ttdeci">struct ast_fax_session_details * details</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d6a/res__fax_8h_source.html#l00208">res_fax.h:208</a></div></div>
<div class="ttc" id="structast__control__t38__parameters_html_a124b43d7f331e00aad39c964ea523329"><div class="ttname"><a href="../../d5/def/structast__control__t38__parameters.html#a124b43d7f331e00aad39c964ea523329">ast_control_t38_parameters::rate</a></div><div class="ttdeci">enum ast_control_t38_rate rate</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d66/include_2asterisk_2frame_8h_source.html#l00401">include/asterisk/frame.h:401</a></div></div>
<div class="ttc" id="include_2asterisk_2config_8h_html_a6b4d4d929013de7812fbba4e58353078"><div class="ttname"><a href="../../d3/de6/include_2asterisk_2config_8h.html#a6b4d4d929013de7812fbba4e58353078">ast_config_destroy</a></div><div class="ttdeci">void ast_config_destroy(struct ast_config *config)</div><div class="ttdoc">Destroys a config. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/dc5/extconf_8c_source.html#l01290">extconf.c:1290</a></div></div>
<div class="ttc" id="structmansession_html"><div class="ttname"><a href="../../d2/d8a/structmansession.html">mansession</a></div><div class="ttdoc">In case you didn&amp;#39;t read that giant block of text above the mansession_session struct, the struct mansession is named this solely to keep the API the same in Asterisk. This structure really represents data that is different from Manager action to Manager action. The mansession_session pointer contained within points to session-specific data. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d10/manager_8c_source.html#l01625">manager.c:1625</a></div></div>
<div class="ttc" id="dsp_8h_html_a92045e8a8ad56b9b31d24db325fa95ab"><div class="ttname"><a href="../../d3/d08/dsp_8h.html#a92045e8a8ad56b9b31d24db325fa95ab">DSP_FEATURE_FAX_DETECT</a></div><div class="ttdeci">#define DSP_FEATURE_FAX_DETECT</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d08/dsp_8h_source.html#l00029">dsp.h:29</a></div></div>
<div class="ttc" id="structast__fax__document_html_afae8c108f5d360038fa8b099eb4ab2f3"><div class="ttname"><a href="../../d2/db8/structast__fax__document.html#afae8c108f5d360038fa8b099eb4ab2f3">ast_fax_document::filename</a></div><div class="ttdeci">char filename[0]</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d6a/res__fax_8h_source.html#l00104">res_fax.h:104</a></div></div>
<div class="ttc" id="astobj2_8h_html_aa9fdb5d0a6157a56060d9f7279fe6c49"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#aa9fdb5d0a6157a56060d9f7279fe6c49">ao2_lock</a></div><div class="ttdeci">#define ao2_lock(a)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l00718">astobj2.h:718</a></div></div>
<div class="ttc" id="linkedlists_8h_html_a02212548652c9eb0f3db38dc4e4bd285"><div class="ttname"><a href="../../df/d90/linkedlists_8h.html#a02212548652c9eb0f3db38dc4e4bd285">AST_RWLIST_REMOVE_CURRENT</a></div><div class="ttdeci">#define AST_RWLIST_REMOVE_CURRENT</div><div class="ttdef"><b>Definition:</b> <a href="../../df/d90/linkedlists_8h_source.html#l00569">linkedlists.h:569</a></div></div>
<div class="ttc" id="astmm_8h_html_ab5f0750cc80ba337fdcbddea2d3a1ee6"><div class="ttname"><a href="../../d8/d8a/astmm_8h.html#ab5f0750cc80ba337fdcbddea2d3a1ee6">ast_strdupa</a></div><div class="ttdeci">#define ast_strdupa(s)</div><div class="ttdoc">duplicate a string in memory from the stack </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d8a/astmm_8h_source.html#l00300">astmm.h:300</a></div></div>
<div class="ttc" id="structfax__gateway_html_af2cb1e09b1af5d5bebdec7471555c940"><div class="ttname"><a href="../../dd/dd2/structfax__gateway.html#af2cb1e09b1af5d5bebdec7471555c940">fax_gateway::detected_v21</a></div><div class="ttdeci">int detected_v21</div><div class="ttdoc">1 if a v21 preamble has been detected </div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d60/res__fax_8c_source.html#l00458">res_fax.c:458</a></div></div>
<div class="ttc" id="res__fax_8c_html_a137ec11e07e82ed4c27374909f9ac965"><div class="ttname"><a href="../../d0/d60/res__fax_8c.html#a137ec11e07e82ed4c27374909f9ac965">ast_fax_minrate</a></div><div class="ttdeci">unsigned int ast_fax_minrate(void)</div><div class="ttdoc">get the minimum supported fax rate </div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d60/res__fax_8c_source.html#l00804">res_fax.c:804</a></div></div>
<div class="ttc" id="structfax__detect_html_ae7b633178d301df70e8612b4ce1aeb77"><div class="ttname"><a href="../../da/df6/structfax__detect.html#ae7b633178d301df70e8612b4ce1aeb77">fax_detect::details</a></div><div class="ttdeci">struct ast_fax_session_details * details</div><div class="ttdoc">fax session details </div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d60/res__fax_8c_source.html#l00477">res_fax.c:477</a></div></div>
<div class="ttc" id="dsp_8h_html_ad3cfa673380a4763168ce800db8b2f0b"><div class="ttname"><a href="../../d3/d08/dsp_8h.html#ad3cfa673380a4763168ce800db8b2f0b">ast_dsp_set_faxmode</a></div><div class="ttdeci">int ast_dsp_set_faxmode(struct ast_dsp *dsp, int faxmode)</div><div class="ttdoc">Set fax mode. </div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d3b/dsp_8c_source.html#l01870">dsp.c:1870</a></div></div>
<div class="ttc" id="res__fax_8c_html_a7ca6ede68de97a21f49d381ef9014ae1"><div class="ttname"><a href="../../d0/d60/res__fax_8c.html#a7ca6ede68de97a21f49d381ef9014ae1">fax_session_new</a></div><div class="ttdeci">static struct ast_fax_session * fax_session_new(struct ast_fax_session_details *details, struct ast_channel *chan, struct ast_fax_session *reserved, struct ast_fax_tech_token *token)</div><div class="ttdoc">create a FAX session </div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d60/res__fax_8c_source.html#l01215">res_fax.c:1215</a></div></div>
<div class="ttc" id="res__fax_8c_html_a3d942985befce033fb70506848199758"><div class="ttname"><a href="../../d0/d60/res__fax_8c.html#a3d942985befce033fb70506848199758">destroy_v21_sessions</a></div><div class="ttdeci">static void destroy_v21_sessions(struct fax_gateway *gateway)</div><div class="ttdoc">destroy the v21 detection parts of a fax gateway session </div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d60/res__fax_8c_source.html#l02821">res_fax.c:2821</a></div></div>
<div class="ttc" id="structast__framehook__interface_html_a735984d41155bc1032e09bece8f8d66d"><div class="ttname"><a href="../../d3/d7b/structast__framehook__interface.html#a735984d41155bc1032e09bece8f8d66d">ast_framehook_interface::data</a></div><div class="ttdeci">void * data</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d3c/framehook_8h_source.html#l00255">framehook.h:255</a></div></div>
<div class="ttc" id="structast__variable_html_a8f8f80d37794cde9472343e4487ba3eb"><div class="ttname"><a href="../../dd/d02/structast__variable.html#a8f8f80d37794cde9472343e4487ba3eb">ast_variable::name</a></div><div class="ttdeci">const char * name</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/de6/include_2asterisk_2config_8h_source.html#l00085">include/asterisk/config.h:85</a></div></div>
<div class="ttc" id="structast__fax__session_html_a9f716886b5b2a50ad6d2b9119502b152"><div class="ttname"><a href="../../d1/d16/structast__fax__session.html#a9f716886b5b2a50ad6d2b9119502b152">ast_fax_session::channame</a></div><div class="ttdeci">char * channame</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d6a/res__fax_8h_source.html#l00220">res_fax.h:220</a></div></div>
<div class="ttc" id="structast__fax__session__details_html"><div class="ttname"><a href="../../d8/dc2/structast__fax__session__details.html">ast_fax_session_details</a></div><div class="ttdoc">The data communicated between the high level applications and the generic fax function. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/d6a/res__fax_8h_source.html#l00110">res_fax.h:110</a></div></div>
<div class="ttc" id="astmm_8h_html_ae63d4f486bcf6eac7c1593f867717d91"><div class="ttname"><a href="../../d8/d8a/astmm_8h.html#ae63d4f486bcf6eac7c1593f867717d91">ast_malloc</a></div><div class="ttdeci">#define ast_malloc(len)</div><div class="ttdoc">A wrapper for malloc() </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d8a/astmm_8h_source.html#l00193">astmm.h:193</a></div></div>
<div class="ttc" id="res__fax_8c_html_a7ea220e4d14b05876af4430e9832ce47"><div class="ttname"><a href="../../d0/d60/res__fax_8c.html#a7ea220e4d14b05876af4430e9832ce47">container</a></div><div class="ttdeci">struct ao2_container * container</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d60/res__fax_8c_source.html#l00502">res_fax.c:502</a></div></div>
<div class="ttc" id="channel_8h_html_a4cd990f4c1cd0c2af6e4c63f6d15b4e1afa1eab36050476591f803c3e234c2ed1"><div class="ttname"><a href="../../d5/d7b/channel_8h.html#a4cd990f4c1cd0c2af6e4c63f6d15b4e1afa1eab36050476591f803c3e234c2ed1">T38_STATE_NEGOTIATING</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d7b/channel_8h_source.html#l00882">channel.h:882</a></div></div>
<div class="ttc" id="channel_8h_html_abbdfb98077180544657b2d16c5d25f74"><div class="ttname"><a href="../../d5/d7b/channel_8h.html#abbdfb98077180544657b2d16c5d25f74">ast_set_write_format</a></div><div class="ttdeci">int ast_set_write_format(struct ast_channel *chan, struct ast_format *format)</div><div class="ttdoc">Sets write format on channel chan. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d28/channel_8c_source.html#l05890">channel.c:5890</a></div></div>
<div class="ttc" id="res__fax_8c_html_a69d3cd379ff7db5b4f5689f515f9a2ce"><div class="ttname"><a href="../../d0/d60/res__fax_8c.html#a69d3cd379ff7db5b4f5689f515f9a2ce">sendfax_exec</a></div><div class="ttdeci">static int sendfax_exec(struct ast_channel *chan, const char *data)</div><div class="ttdoc">initiate a send FAX session </div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d60/res__fax_8c_source.html#l02590">res_fax.c:2590</a></div></div>
<div class="ttc" id="linkedlists_8h_html_aadfe2a69fbba4f27c201266a2ca5f989"><div class="ttname"><a href="../../df/d90/linkedlists_8h.html#aadfe2a69fbba4f27c201266a2ca5f989">AST_LIST_REMOVE_HEAD</a></div><div class="ttdeci">#define AST_LIST_REMOVE_HEAD(head, field)</div><div class="ttdoc">Removes and returns the head entry from a list. </div><div class="ttdef"><b>Definition:</b> <a href="../../df/d90/linkedlists_8h_source.html#l00832">linkedlists.h:832</a></div></div>
<div class="ttc" id="structast__fax__tech_html_a8637433cfbb88aeb10ce2ed5dcba0eb1"><div class="ttname"><a href="../../d9/d0e/structast__fax__tech.html#a8637433cfbb88aeb10ce2ed5dcba0eb1">ast_fax_tech::module</a></div><div class="ttdeci">struct ast_module * module</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d6a/res__fax_8h_source.html#l00245">res_fax.h:245</a></div></div>
<div class="ttc" id="astobj2_8h_html_a2cf7e3433f08351aafe3b0cd31edf7f8a8ccf751bd6749d062999469f0694e7ad"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#a2cf7e3433f08351aafe3b0cd31edf7f8a8ccf751bd6749d062999469f0694e7ad">AO2_ALLOC_OPT_LOCK_MUTEX</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l00365">astobj2.h:365</a></div></div>
<div class="ttc" id="pbx_8h_html_a64a5b8fdc919806135ad427aca9e71b7"><div class="ttname"><a href="../../db/de0/pbx_8h.html#a64a5b8fdc919806135ad427aca9e71b7">ast_exists_extension</a></div><div class="ttdeci">int ast_exists_extension(struct ast_channel *c, const char *context, const char *exten, int priority, const char *callerid)</div><div class="ttdoc">Determine whether an extension exists. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l04179">pbx.c:4179</a></div></div>
<div class="ttc" id="res__fax_8h_html_a54eb45ad548b874cf12d0a599631e3f6a6868445e2802e5b71068ae883366f635"><div class="ttname"><a href="../../db/d6a/res__fax_8h.html#a54eb45ad548b874cf12d0a599631e3f6a6868445e2802e5b71068ae883366f635">AST_FAX_TECH_T38</a></div><div class="ttdef"><b>Definition:</b> <a href="../../db/d6a/res__fax_8h_source.html#l00043">res_fax.h:43</a></div></div>
<div class="ttc" id="structfax__options_html_a7f633c7bc4fe667e873649afa4d44640"><div class="ttname"><a href="../../d0/d28/structfax__options.html#a7f633c7bc4fe667e873649afa4d44640">fax_options::statusevents</a></div><div class="ttdeci">uint32_t statusevents</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d60/res__fax_8c_source.html#l00530">res_fax.c:530</a></div></div>
<div class="ttc" id="structfax__gateway_html_a59e020b75f0a03b00bfad6332fa53b9e"><div class="ttname"><a href="../../dd/dd2/structfax__gateway.html#a59e020b75f0a03b00bfad6332fa53b9e">fax_gateway::chan_read_format</a></div><div class="ttdeci">struct ast_format * chan_read_format</div><div class="ttdoc">original audio formats </div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d60/res__fax_8c_source.html#l00462">res_fax.c:462</a></div></div>
<div class="ttc" id="res__fax_8h_html_a54eb45ad548b874cf12d0a599631e3f6a9f71e042b26b9d7b671a3771bef6db64"><div class="ttname"><a href="../../db/d6a/res__fax_8h.html#a54eb45ad548b874cf12d0a599631e3f6a9f71e042b26b9d7b671a3771bef6db64">AST_FAX_TECH_MULTI_DOC</a></div><div class="ttdef"><b>Definition:</b> <a href="../../db/d6a/res__fax_8h_source.html#l00045">res_fax.h:45</a></div></div>
<div class="ttc" id="include_2asterisk_2app_8h_html_af40039f1c49c16d0f6fa33fe9c43a0cb"><div class="ttname"><a href="../../d3/d93/include_2asterisk_2app_8h.html#af40039f1c49c16d0f6fa33fe9c43a0cb">ast_app_parse_options</a></div><div class="ttdeci">int ast_app_parse_options(const struct ast_app_option *options, struct ast_flags *flags, char **args, char *optstr)</div><div class="ttdoc">Parses a string containing application options and sets flags/arguments. </div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d83/main_2app_8c_source.html#l02906">main/app.c:2906</a></div></div>
<div class="ttc" id="structast__fax__session__details_html_acab313697f3cc547dbfede01ee743aa6"><div class="ttname"><a href="../../d8/dc2/structast__fax__session__details.html#acab313697f3cc547dbfede01ee743aa6">ast_fax_session_details::remotestationid</a></div><div class="ttdeci">const ast_string_field remotestationid</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d6a/res__fax_8h_source.html#l00142">res_fax.h:142</a></div></div>
<div class="ttc" id="logger_8h_html_aa689efaaa503de6322c2b13b3faab63d"><div class="ttname"><a href="../../d1/d8c/logger_8h.html#aa689efaaa503de6322c2b13b3faab63d">ast_logger_register_level</a></div><div class="ttdeci">int ast_logger_register_level(const char *name)</div><div class="ttdoc">Register a new logger level. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d22/logger_8c_source.html#l02503">logger.c:2503</a></div></div>
<div class="ttc" id="channel_8h_html_aa8b52fbc8168e939bc5553502367d46a"><div class="ttname"><a href="../../d5/d7b/channel_8h.html#aa8b52fbc8168e939bc5553502367d46a">ast_channel_exten</a></div><div class="ttdeci">const char * ast_channel_exten(const struct ast_channel *chan)</div><div class="ttdef"><b>Definition:</b> <a href="../../db/de2/channel__internal__api_8c_source.html#l00353">channel_internal_api.c:353</a></div></div>
<div class="ttc" id="pbx_8h_html"><div class="ttname"><a href="../../db/de0/pbx_8h.html">pbx.h</a></div><div class="ttdoc">Core PBX routines and definitions. </div></div>
<div class="ttc" id="json_8h_html_a48d874eed79fb2bbeb0557440e33ae67"><div class="ttname"><a href="../../d4/d05/json_8h.html#a48d874eed79fb2bbeb0557440e33ae67">ast_json_array_create</a></div><div class="ttdeci">struct ast_json * ast_json_array_create(void)</div><div class="ttdoc">Create a empty JSON array. </div><div class="ttdef"><b>Definition:</b> <a href="../../df/d98/json_8c_source.html#l00352">json.c:352</a></div></div>
<div class="ttc" id="channel_8h_html_a9c63fff1d736568d1ee332dd7ea502bd"><div class="ttname"><a href="../../d5/d7b/channel_8h.html#a9c63fff1d736568d1ee332dd7ea502bd">ast_check_hangup</a></div><div class="ttdeci">int ast_check_hangup(struct ast_channel *chan)</div><div class="ttdoc">Check to see if a channel is needing hang up. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d28/channel_8c_source.html#l00445">channel.c:445</a></div></div>
<div class="ttc" id="linkedlists_8h_html_a21be6da4b2146b04b4868c2be5cae750"><div class="ttname"><a href="../../df/d90/linkedlists_8h.html#a21be6da4b2146b04b4868c2be5cae750">AST_RWLIST_TRAVERSE_SAFE_BEGIN</a></div><div class="ttdeci">#define AST_RWLIST_TRAVERSE_SAFE_BEGIN</div><div class="ttdef"><b>Definition:</b> <a href="../../df/d90/linkedlists_8h_source.html#l00544">linkedlists.h:544</a></div></div>
<div class="ttc" id="include_2asterisk_2frame_8h_html_ae2e1a9c4e048da387b761f619312d6e0ae1dae388b0d70825876e137ae95bb0c1"><div class="ttname"><a href="../../d6/d66/include_2asterisk_2frame_8h.html#ae2e1a9c4e048da387b761f619312d6e0ae1dae388b0d70825876e137ae95bb0c1">AST_FRAME_CONTROL</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d66/include_2asterisk_2frame_8h_source.html#l00105">include/asterisk/frame.h:105</a></div></div>
<div class="ttc" id="json_8h_html_a3d675e52f866630a6a03302df2712b8d"><div class="ttname"><a href="../../d4/d05/json_8h.html#a3d675e52f866630a6a03302df2712b8d">ast_json_array_append</a></div><div class="ttdeci">int ast_json_array_append(struct ast_json *array, struct ast_json *value)</div><div class="ttdoc">Append to an array. </div><div class="ttdef"><b>Definition:</b> <a href="../../df/d98/json_8c_source.html#l00368">json.c:368</a></div></div>
<div class="ttc" id="include_2asterisk_2config_8h_html_a846844eb2c4eb44554445936b3770711"><div class="ttname"><a href="../../d3/de6/include_2asterisk_2config_8h.html#a846844eb2c4eb44554445936b3770711">CONFIG_STATUS_FILEUNCHANGED</a></div><div class="ttdeci">#define CONFIG_STATUS_FILEUNCHANGED</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/de6/include_2asterisk_2config_8h_source.html#l00059">include/asterisk/config.h:59</a></div></div>
<div class="ttc" id="structast__control__t38__parameters_html_a7924cc45cde640e779a902c4aadaf180"><div class="ttname"><a href="../../d5/def/structast__control__t38__parameters.html#a7924cc45cde640e779a902c4aadaf180">ast_control_t38_parameters::max_ifp</a></div><div class="ttdeci">unsigned int max_ifp</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d66/include_2asterisk_2frame_8h_source.html#l00400">include/asterisk/frame.h:400</a></div></div>
<div class="ttc" id="dsp_8h_html_a06a0b883127ba1f853e9e0fa5f29d81b"><div class="ttname"><a href="../../d3/d08/dsp_8h.html#a06a0b883127ba1f853e9e0fa5f29d81b">ast_dsp_set_threshold</a></div><div class="ttdeci">void ast_dsp_set_threshold(struct ast_dsp *dsp, int threshold)</div><div class="ttdoc">Set the minimum average magnitude threshold to determine talking by the DSP. </div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d3b/dsp_8c_source.html#l01775">dsp.c:1775</a></div></div>
<div class="ttc" id="channel_8h_html_a3b6254f6d3832ef928f0a727113b1c63"><div class="ttname"><a href="../../d5/d7b/channel_8h.html#a3b6254f6d3832ef928f0a727113b1c63">ast_channel_uniqueid</a></div><div class="ttdeci">const char * ast_channel_uniqueid(const struct ast_channel *chan)</div><div class="ttdef"><b>Definition:</b> <a href="../../db/de2/channel__internal__api_8c_source.html#l00305">channel_internal_api.c:305</a></div></div>
<div class="ttc" id="structast__cli__args_html_ad0a19c4d63698f9e9cfd5653e8851452"><div class="ttname"><a href="../../d3/dad/structast__cli__args.html#ad0a19c4d63698f9e9cfd5653e8851452">ast_cli_args::argv</a></div><div class="ttdeci">const char *const  * argv</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/db0/cli_8h_source.html#l00161">cli.h:161</a></div></div>
<div class="ttc" id="channel_8h_html_afdeaf9abb1aecc715313a4f62c1cf9c9"><div class="ttname"><a href="../../d5/d7b/channel_8h.html#afdeaf9abb1aecc715313a4f62c1cf9c9">ast_channel_topic</a></div><div class="ttdeci">struct stasis_topic * ast_channel_topic(struct ast_channel *chan)</div><div class="ttdoc">A topic which publishes the events for a particular channel. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/de2/channel__internal__api_8c_source.html#l01502">channel_internal_api.c:1502</a></div></div>
<div class="ttc" id="dsp_8h_html_a673744da45e35463b6500a17c360bebe"><div class="ttname"><a href="../../d3/d08/dsp_8h.html#a673744da45e35463b6500a17c360bebe">ast_dsp_reset</a></div><div class="ttdeci">void ast_dsp_reset(struct ast_dsp *dsp)</div><div class="ttdoc">Reset total silence count. </div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d3b/dsp_8c_source.html#l01830">dsp.c:1830</a></div></div>
<div class="ttc" id="group__Group__AMI_html_gafadf012f66a9fd7ecf985ec5b9dee101"><div class="ttname"><a href="../../df/d72/group__Group__AMI.html#gafadf012f66a9fd7ecf985ec5b9dee101">ast_manager_unregister</a></div><div class="ttdeci">int ast_manager_unregister(const char *action)</div><div class="ttdoc">Unregister a registered manager command. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d10/manager_8c_source.html#l07258">manager.c:7258</a></div></div>
<div class="ttc" id="structast__fax__t38__parameters_html_ad2b3d53474db70e3ff2058da953b7b82"><div class="ttname"><a href="../../d3/df6/structast__fax__t38__parameters.html#ad2b3d53474db70e3ff2058da953b7b82">ast_fax_t38_parameters::transcoding_mmr</a></div><div class="ttdeci">unsigned int transcoding_mmr</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d6a/res__fax_8h_source.html#l00098">res_fax.h:98</a></div></div>
<div class="ttc" id="structast__fax__t38__parameters_html_a07676322ec48c4872f9a208a6248d034"><div class="ttname"><a href="../../d3/df6/structast__fax__t38__parameters.html#a07676322ec48c4872f9a208a6248d034">ast_fax_t38_parameters::transcoding_jbig</a></div><div class="ttdeci">unsigned int transcoding_jbig</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d6a/res__fax_8h_source.html#l00099">res_fax.h:99</a></div></div>
<div class="ttc" id="include_2asterisk_2frame_8h_html_ae2e1a9c4e048da387b761f619312d6e0ad99b86353343f422bda01163898b2eea"><div class="ttname"><a href="../../d6/d66/include_2asterisk_2frame_8h.html#ae2e1a9c4e048da387b761f619312d6e0ad99b86353343f422bda01163898b2eea">AST_FRAME_MODEM</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d66/include_2asterisk_2frame_8h_source.html#l00123">include/asterisk/frame.h:123</a></div></div>
<div class="ttc" id="structfax__options_html"><div class="ttname"><a href="../../d0/d28/structfax__options.html">fax_options</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d60/res__fax_8c_source.html#l00528">res_fax.c:528</a></div></div>
<div class="ttc" id="res__fax_8c_html_a792719145deb79c5c8ad82b739ab564e"><div class="ttname"><a href="../../d0/d60/res__fax_8c.html#a792719145deb79c5c8ad82b739ab564e">fax_gateway_framehook_destroy</a></div><div class="ttdeci">static void fax_gateway_framehook_destroy(void *data)</div><div class="ttdoc">Destroy the gateway data structure when the framehook is detached. </div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d60/res__fax_8c_source.html#l03345">res_fax.c:3345</a></div></div>
<div class="ttc" id="framehook_8h_html_a54250544f50efde9156d2341e8da0614ab652eafa2595533d8c065a6ac426aa8a"><div class="ttname"><a href="../../db/d3c/framehook_8h.html#a54250544f50efde9156d2341e8da0614ab652eafa2595533d8c065a6ac426aa8a">AST_FRAMEHOOK_EVENT_READ</a></div><div class="ttdef"><b>Definition:</b> <a href="../../db/d3c/framehook_8h_source.html#l00152">framehook.h:152</a></div></div>
<div class="ttc" id="res__fax_8c_html_abadd563fd124df50869cc1bdebf712be"><div class="ttname"><a href="../../d0/d60/res__fax_8c.html#abadd563fd124df50869cc1bdebf712be">set_fax_t38_caps</a></div><div class="ttdeci">static int set_fax_t38_caps(struct ast_channel *chan, struct ast_fax_session_details *details)</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d60/res__fax_8c_source.html#l01491">res_fax.c:1491</a></div></div>
<div class="ttc" id="res__fax_8h_html_ab9287e81dc5d3047da0bcb1f6c89bd57"><div class="ttname"><a href="../../db/d6a/res__fax_8h.html#ab9287e81dc5d3047da0bcb1f6c89bd57">ast_fax_modems</a></div><div class="ttdeci">ast_fax_modems</div><div class="ttdoc">fax modem capabilities </div><div class="ttdef"><b>Definition:</b> <a href="../../db/d6a/res__fax_8h_source.html#l00053">res_fax.h:53</a></div></div>
<div class="ttc" id="res__fax_8c_html_ac4310e981e9db76dfc3e85c51f4c6e1e"><div class="ttname"><a href="../../d0/d60/res__fax_8c.html#ac4310e981e9db76dfc3e85c51f4c6e1e">find_or_create_details</a></div><div class="ttdeci">static struct ast_fax_session_details * find_or_create_details(struct ast_channel *chan)</div><div class="ttdoc">returns a reference counted details structure from the channel&amp;#39;s fax datastore. If the datastore does...</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d60/res__fax_8c_source.html#l00764">res_fax.c:764</a></div></div>
<div class="ttc" id="logger_8h_html_aced66975c154ea0e2a8ec3bc818b4e08"><div class="ttname"><a href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a></div><div class="ttdeci">#define LOG_ERROR</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d8c/logger_8h_source.html#l00285">logger.h:285</a></div></div>
<div class="ttc" id="linkedlists_8h_html_a4d258b4525e63c435d7de579d3f46960"><div class="ttname"><a href="../../df/d90/linkedlists_8h.html#a4d258b4525e63c435d7de579d3f46960">AST_LIST_INSERT_TAIL</a></div><div class="ttdeci">#define AST_LIST_INSERT_TAIL(head, elm, field)</div><div class="ttdoc">Appends a list entry to the tail of a list. </div><div class="ttdef"><b>Definition:</b> <a href="../../df/d90/linkedlists_8h_source.html#l00730">linkedlists.h:730</a></div></div>
<div class="ttc" id="astobj2_8h_html_aefc16f8aa9087cbc5c55c70cf1dd41b2"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#aefc16f8aa9087cbc5c55c70cf1dd41b2">ao2_container_alloc_hash</a></div><div class="ttdeci">#define ao2_container_alloc_hash(ao2_options, container_options, n_buckets, hash_fn, sort_fn, cmp_fn)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l01310">astobj2.h:1310</a></div></div>
<div class="ttc" id="res__fax_8h_html_ab9287e81dc5d3047da0bcb1f6c89bd57ae3b2fd3e12f8b526273b642e0c0a342a"><div class="ttname"><a href="../../db/d6a/res__fax_8h.html#ab9287e81dc5d3047da0bcb1f6c89bd57ae3b2fd3e12f8b526273b642e0c0a342a">AST_FAX_MODEM_V27TER</a></div><div class="ttdef"><b>Definition:</b> <a href="../../db/d6a/res__fax_8h_source.html#l00057">res_fax.h:57</a></div></div>
<div class="ttc" id="res__fax_8c_html_af4165a00608b669d97f5acbe873dc1f7"><div class="ttname"><a href="../../d0/d60/res__fax_8c.html#af4165a00608b669d97f5acbe873dc1f7">FAX_DETECT_MODE_CNG</a></div><div class="ttdeci">#define FAX_DETECT_MODE_CNG</div><div class="ttdoc">FAX Detect flags. </div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d60/res__fax_8c_source.html#l00483">res_fax.c:483</a></div></div>
<div class="ttc" id="structast__fax__tech_html_ad048a85b941a47dc602ff04b6a3a5f01"><div class="ttname"><a href="../../d9/d0e/structast__fax__tech.html#ad048a85b941a47dc602ff04b6a3a5f01">ast_fax_tech::destroy_session</a></div><div class="ttdeci">void(*const destroy_session)(struct ast_fax_session *)</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d6a/res__fax_8h_source.html#l00253">res_fax.h:253</a></div></div>
<div class="ttc" id="strings_8h_html_a387a69b3871ca31061566a73f45d20f4"><div class="ttname"><a href="../../d6/d90/strings_8h.html#a387a69b3871ca31061566a73f45d20f4">ast_true</a></div><div class="ttdeci">int attribute_pure ast_true(const char *val)</div><div class="ttdoc">Make sure something is true. Determine if a string containing a boolean value is &quot;true&quot;. This function checks to see whether a string passed to it is an indication of an &quot;true&quot; value. It checks to see if the string is &quot;yes&quot;, &quot;true&quot;, &quot;y&quot;, &quot;t&quot;, &quot;on&quot; or &quot;1&quot;. </div><div class="ttdef"><b>Definition:</b> <a href="../../de/d1f/main_2utils_8c_source.html#l01951">main/utils.c:1951</a></div></div>
<div class="ttc" id="res__fax_8c_html_a522499b2966b304ec995720f3815e8f6"><div class="ttname"><a href="../../d0/d60/res__fax_8c.html#a522499b2966b304ec995720f3815e8f6">fax_gateway_detect_t38</a></div><div class="ttdeci">static struct ast_frame * fax_gateway_detect_t38(struct fax_gateway *gateway, struct ast_channel *chan, struct ast_channel *peer, struct ast_channel *active, struct ast_frame *f)</div><div class="ttdoc">T38 Gateway Negotiate t38 parameters. </div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d60/res__fax_8c_source.html#l03109">res_fax.c:3109</a></div></div>
<div class="ttc" id="structast__fax__session__details_html_ac579558087dfa900a4c5384cb6e09dd8"><div class="ttname"><a href="../../d8/dc2/structast__fax__session__details.html#ac579558087dfa900a4c5384cb6e09dd8">ast_fax_session_details::pages_transferred</a></div><div class="ttdeci">unsigned int pages_transferred</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d6a/res__fax_8h_source.html#l00144">res_fax.h:144</a></div></div>
<div class="ttc" id="structfax__options_html_a50d4d0d4e0ae5aae877a0e6d2faa9517"><div class="ttname"><a href="../../d0/d28/structfax__options.html#a50d4d0d4e0ae5aae877a0e6d2faa9517">fax_options::t38timeout</a></div><div class="ttdeci">unsigned int t38timeout</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d60/res__fax_8c_source.html#l00534">res_fax.c:534</a></div></div>
<div class="ttc" id="structast__trans__pvt_html"><div class="ttname"><a href="../../d1/d47/structast__trans__pvt.html">ast_trans_pvt</a></div><div class="ttdoc">Default structure for translators, with the basic fields and buffers, all allocated as part of the sa...</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d39/translate_8h_source.html#l00213">translate.h:213</a></div></div>
<div class="ttc" id="res__fax_8c_html_a049f9f29f5e7c99af20888026f84c5c1"><div class="ttname"><a href="../../d0/d60/res__fax_8c.html#a049f9f29f5e7c99af20888026f84c5c1">fax_session_release</a></div><div class="ttdeci">static void fax_session_release(struct ast_fax_session *s, struct ast_fax_tech_token *token)</div><div class="ttdoc">Release a session token. </div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d60/res__fax_8c_source.html#l01083">res_fax.c:1083</a></div></div>
<div class="ttc" id="astobj2_8h_html_a64f51be4bee35c38dbe59b0a788b5ce8"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#a64f51be4bee35c38dbe59b0a788b5ce8">ao2_unlink</a></div><div class="ttdeci">#define ao2_unlink(container, obj)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l01598">astobj2.h:1598</a></div></div>
<div class="ttc" id="cli_8h_html_a0873456096960dab21fff0ce68c95acb"><div class="ttname"><a href="../../dc/db0/cli_8h.html#a0873456096960dab21fff0ce68c95acb">CLI_SHOWUSAGE</a></div><div class="ttdeci">#define CLI_SHOWUSAGE</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/db0/cli_8h_source.html#l00045">cli.h:45</a></div></div>
<div class="ttc" id="structast__fax__session__details_html_aed36280452b10bbcf7cb35873db02762"><div class="ttname"><a href="../../d8/dc2/structast__fax__session__details.html#aed36280452b10bbcf7cb35873db02762">ast_fax_session_details::v21_detected</a></div><div class="ttdeci">uint32_t v21_detected</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d6a/res__fax_8h_source.html#l00167">res_fax.h:167</a></div></div>
<div class="ttc" id="time_8h_html_a904a6933b710e14c7fa2029a0f0cc91a"><div class="ttname"><a href="../../de/df7/time_8h.html#a904a6933b710e14c7fa2029a0f0cc91a">ast_remaining_ms</a></div><div class="ttdeci">int ast_remaining_ms(struct timeval start, int max_ms)</div><div class="ttdoc">Calculate remaining milliseconds given a starting timestamp and upper bound. </div><div class="ttdef"><b>Definition:</b> <a href="../../de/d1f/main_2utils_8c_source.html#l02033">main/utils.c:2033</a></div></div>
<div class="ttc" id="structast__control__t38__parameters_html_addb721c952a7144f0a6a9ac5f621d2bc"><div class="ttname"><a href="../../d5/def/structast__control__t38__parameters.html#addb721c952a7144f0a6a9ac5f621d2bc">ast_control_t38_parameters::fill_bit_removal</a></div><div class="ttdeci">unsigned int fill_bit_removal</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d66/include_2asterisk_2frame_8h_source.html#l00403">include/asterisk/frame.h:403</a></div></div>
<div class="ttc" id="structast__fax__t38__parameters_html_a7924cc45cde640e779a902c4aadaf180"><div class="ttname"><a href="../../d3/df6/structast__fax__t38__parameters.html#a7924cc45cde640e779a902c4aadaf180">ast_fax_t38_parameters::max_ifp</a></div><div class="ttdeci">unsigned int max_ifp</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d6a/res__fax_8h_source.html#l00094">res_fax.h:94</a></div></div>
<div class="ttc" id="structfax__gateway_html_a6157ce6a6b99804070b09723d9dcf05d"><div class="ttname"><a href="../../dd/dd2/structfax__gateway.html#a6157ce6a6b99804070b09723d9dcf05d">fax_gateway::chan_write_format</a></div><div class="ttdeci">struct ast_format * chan_write_format</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d60/res__fax_8c_source.html#l00463">res_fax.c:463</a></div></div>
<div class="ttc" id="structast__fax__session__details_html_a3ef48556ce45595f874faa2368bc3cfa"><div class="ttname"><a href="../../d8/dc2/structast__fax__session__details.html#a3ef48556ce45595f874faa2368bc3cfa">ast_fax_session_details::gateway_timeout</a></div><div class="ttdeci">int gateway_timeout</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d6a/res__fax_8h_source.html#l00183">res_fax.h:183</a></div></div>
<div class="ttc" id="framehook_8h_html_ae3b6fa28df6c8608d05936efaf929f32"><div class="ttname"><a href="../../db/d3c/framehook_8h.html#ae3b6fa28df6c8608d05936efaf929f32">AST_FRAMEHOOK_INTERFACE_VERSION</a></div><div class="ttdeci">#define AST_FRAMEHOOK_INTERFACE_VERSION</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d3c/framehook_8h_source.html#l00227">framehook.h:227</a></div></div>
<div class="ttc" id="structfax__detect_html_a23b38dad7025290be3461b4b3208b4e6"><div class="ttname"><a href="../../da/df6/structfax__detect.html#a23b38dad7025290be3461b4b3208b4e6">fax_detect::timeout_start</a></div><div class="ttdeci">struct timeval timeout_start</div><div class="ttdoc">the start of our timeout counter </div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d60/res__fax_8c_source.html#l00471">res_fax.c:471</a></div></div>
<div class="ttc" id="res__fax_8c_html_ad7732b5ae304d39afa2dacb20187cf04"><div class="ttname"><a href="../../d0/d60/res__fax_8c.html#ad7732b5ae304d39afa2dacb20187cf04">set_channel_variables</a></div><div class="ttdeci">static void set_channel_variables(struct ast_channel *chan, struct ast_fax_session_details *details)</div><div class="ttdoc">Set fax related channel variables. </div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d60/res__fax_8c_source.html#l01447">res_fax.c:1447</a></div></div>
<div class="ttc" id="structast__fax__session__details_html_a14c20eed7d6d03b484ebc2cc7a447ea2"><div class="ttname"><a href="../../d8/dc2/structast__fax__session__details.html#a14c20eed7d6d03b484ebc2cc7a447ea2">ast_fax_session_details::documents</a></div><div class="ttdeci">struct ast_fax_documents documents</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d6a/res__fax_8h_source.html#l00119">res_fax.h:119</a></div></div>
<div class="ttc" id="func__strings_8c_html_af24e73aaf92f3000fda15d285e66df24"><div class="ttname"><a href="../../d9/d1e/func__strings_8c.html#af24e73aaf92f3000fda15d285e66df24">len</a></div><div class="ttdeci">static int len(struct ast_channel *chan, const char *cmd, char *data, char *buf, size_t buflen)</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d1e/func__strings_8c_source.html#l01344">func_strings.c:1344</a></div></div>
<div class="ttc" id="res__fax_8c_html_a46275621a3d3846d089a092249fb8c37ac50e4902aa670a5a0ad1927d8fef741a"><div class="ttname"><a href="../../d0/d60/res__fax_8c.html#a46275621a3d3846d089a092249fb8c37ac50e4902aa670a5a0ad1927d8fef741a">OPT_STATUS</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d60/res__fax_8c_source.html#l00561">res_fax.c:561</a></div></div>
<div class="ttc" id="main_2stdtime_2private_8h_html_ad65a8842cc674e3ddf69355898c0ecbf"><div class="ttname"><a href="../../d1/d6e/main_2stdtime_2private_8h.html#ad65a8842cc674e3ddf69355898c0ecbf">errno</a></div><div class="ttdeci">int errno</div></div>
<div class="ttc" id="res__fax_8h_html_ab9287e81dc5d3047da0bcb1f6c89bd57af68d38a189351562faca6609a162b5a6"><div class="ttname"><a href="../../db/d6a/res__fax_8h.html#ab9287e81dc5d3047da0bcb1f6c89bd57af68d38a189351562faca6609a162b5a6">AST_FAX_MODEM_V34</a></div><div class="ttdef"><b>Definition:</b> <a href="../../db/d6a/res__fax_8h_source.html#l00061">res_fax.h:61</a></div></div>
<div class="ttc" id="structast__fax__tech_html"><div class="ttname"><a href="../../d9/d0e/structast__fax__tech.html">ast_fax_tech</a></div><div class="ttdoc">used to register a FAX technology module with res_fax </div><div class="ttdef"><b>Definition:</b> <a href="../../db/d6a/res__fax_8h_source.html#l00235">res_fax.h:235</a></div></div>
<div class="ttc" id="strings_8h_html_af5693da955fa3bc73bc49c47b601fc7a"><div class="ttname"><a href="../../d6/d90/strings_8h.html#af5693da955fa3bc73bc49c47b601fc7a">ast_skip_blanks</a></div><div class="ttdeci">char * ast_skip_blanks(const char *str)</div><div class="ttdoc">Gets a pointer to the first non-whitespace character in a string. </div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d90/strings_8h_source.html#l00157">strings.h:157</a></div></div>
<div class="ttc" id="app__meetme_8c_html_a18b6f1cf748d864dd085819a7d4e6680"><div class="ttname"><a href="../../df/d44/app__meetme_8c.html#a18b6f1cf748d864dd085819a7d4e6680">first</a></div><div class="ttdeci">struct sla_ringing_trunk * first</div><div class="ttdef"><b>Definition:</b> <a href="../../df/d44/app__meetme_8c_source.html#l01092">app_meetme.c:1092</a></div></div>
<div class="ttc" id="astobj2_8h_html_a17990ea630db7dbd1252ef0132133a2b"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#a17990ea630db7dbd1252ef0132133a2b">ao2_iterator_next</a></div><div class="ttdeci">#define ao2_iterator_next(iter)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l01933">astobj2.h:1933</a></div></div>
<div class="ttc" id="astobj2_8h_html_ae0422b60d8e25b6962b2d61ae4ddf724"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#ae0422b60d8e25b6962b2d61ae4ddf724">ao2_alloc</a></div><div class="ttdeci">#define ao2_alloc(data_size, destructor_fn)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l00411">astobj2.h:411</a></div></div>
<div class="ttc" id="logger_8h_html_ad89ee324d180cdcd7defcc709ff9ca42"><div class="ttname"><a href="../../d1/d8c/logger_8h.html#ad89ee324d180cdcd7defcc709ff9ca42">LOG_NOTICE</a></div><div class="ttdeci">#define LOG_NOTICE</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d8c/logger_8h_source.html#l00263">logger.h:263</a></div></div>
<div class="ttc" id="res__fax_8c_html_a714cd8f82d821052b5bbd4b6234b5950"><div class="ttname"><a href="../../d0/d60/res__fax_8c.html#a714cd8f82d821052b5bbd4b6234b5950">FAX_MAXBUCKETS</a></div><div class="ttdeci">#define FAX_MAXBUCKETS</div><div class="ttdoc">maximum buckets for res_fax ao2 containers </div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d60/res__fax_8c_source.html#l00490">res_fax.c:490</a></div></div>
<div class="ttc" id="structast__fax__session__details_html_a8bff16fb9ab2254b86636f6fac166a66"><div class="ttname"><a href="../../d8/dc2/structast__fax__session__details.html#a8bff16fb9ab2254b86636f6fac166a66">ast_fax_session_details::minrate</a></div><div class="ttdeci">unsigned int minrate</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d6a/res__fax_8h_source.html#l00171">res_fax.h:171</a></div></div>
<div class="ttc" id="structast__config_html"><div class="ttname"><a href="../../dd/d18/structast__config.html">ast_config</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d2/d9d/main_2config_8c_source.html#l00249">main/config.c:249</a></div></div>
<div class="ttc" id="linkedlists_8h_html_a3008b2f4f236b72d8bcfb80e346324ef"><div class="ttname"><a href="../../df/d90/linkedlists_8h.html#a3008b2f4f236b72d8bcfb80e346324ef">AST_LIST_TRAVERSE</a></div><div class="ttdeci">#define AST_LIST_TRAVERSE(head, var, field)</div><div class="ttdoc">Loops over (traverses) the entries in a list. </div><div class="ttdef"><b>Definition:</b> <a href="../../df/d90/linkedlists_8h_source.html#l00490">linkedlists.h:490</a></div></div>
<div class="ttc" id="res__fax_8c_html_ac63658a749ab21cd75126580a69a789a"><div class="ttname"><a href="../../d0/d60/res__fax_8c.html#ac63658a749ab21cd75126580a69a789a">FAX_GATEWAY_TIMEOUT</a></div><div class="ttdeci">#define FAX_GATEWAY_TIMEOUT</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d60/res__fax_8c_source.html#l00493">res_fax.c:493</a></div></div>
<div class="ttc" id="f2c_8h_html_abf5d144da384425ae6cb542ce6eec8d3"><div class="ttname"><a href="../../dc/dc2/f2c_8h.html#abf5d144da384425ae6cb542ce6eec8d3">flag</a></div><div class="ttdeci">long int flag</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/dc2/f2c_8h_source.html#l00083">f2c.h:83</a></div></div>
<div class="ttc" id="structast__fax__session__details_html_a2a669261b0b8c26d26573c678149d312"><div class="ttname"><a href="../../d8/dc2/structast__fax__session__details.html#a2a669261b0b8c26d26573c678149d312">ast_fax_session_details::gateway_id</a></div><div class="ttdeci">int gateway_id</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d6a/res__fax_8h_source.html#l00181">res_fax.h:181</a></div></div>
<div class="ttc" id="res__fax_8c_html_afa20e50d2a685b5bb4d13ca0bb62d4c8"><div class="ttname"><a href="../../d0/d60/res__fax_8c.html#afa20e50d2a685b5bb4d13ca0bb62d4c8">reserved_sessions</a></div><div class="ttdeci">int reserved_sessions</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d60/res__fax_8c_source.html#l00500">res_fax.c:500</a></div></div>
<div class="ttc" id="channel_8h_html_af476c537b29be3f29240489032f9db39"><div class="ttname"><a href="../../d5/d7b/channel_8h.html#af476c537b29be3f29240489032f9db39">ast_channel_unlock</a></div><div class="ttdeci">#define ast_channel_unlock(chan)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d7b/channel_8h_source.html#l02946">channel.h:2946</a></div></div>
<div class="ttc" id="chan__mgcp_8c_html_a2e006acff60d9b3d65d7d60f975d6747"><div class="ttname"><a href="../../d0/dd6/chan__mgcp_8c.html#a2e006acff60d9b3d65d7d60f975d6747">parse</a></div><div class="ttdeci">static void parse(struct mgcp_request *req)</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/dd6/chan__mgcp_8c_source.html#l01872">chan_mgcp.c:1872</a></div></div>
<div class="ttc" id="dsp_8h_html_aedc7fa20fba91e3c018f6989e95c714b"><div class="ttname"><a href="../../d3/d08/dsp_8h.html#aedc7fa20fba91e3c018f6989e95c714b">ast_dsp_set_features</a></div><div class="ttdeci">void ast_dsp_set_features(struct ast_dsp *dsp, int features)</div><div class="ttdoc">Select feature set. </div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d3b/dsp_8c_source.html#l01755">dsp.c:1755</a></div></div>
<div class="ttc" id="stasis_8h_html_ac43d0a33d111e9f34b441b285c166cfc"><div class="ttname"><a href="../../dd/d79/stasis_8h.html#ac43d0a33d111e9f34b441b285c166cfc">stasis_publish</a></div><div class="ttdeci">void stasis_publish(struct stasis_topic *topic, struct stasis_message *message)</div><div class="ttdoc">Publish a message to a topic&amp;#39;s subscribers. </div><div class="ttdef"><b>Definition:</b> <a href="../../d0/df4/stasis_8c_source.html#l01511">stasis.c:1511</a></div></div>
<div class="ttc" id="cdr__mysql_8c_html_a0980a105ccb863d8008eb6201a51da52"><div class="ttname"><a href="../../d0/d29/cdr__mysql_8c.html#a0980a105ccb863d8008eb6201a51da52">name</a></div><div class="ttdeci">static const char name[]</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d29/cdr__mysql_8c_source.html#l00074">cdr_mysql.c:74</a></div></div>
<div class="ttc" id="astmm_8h_html_a402072d6789f6ed9e3a81da27504127e"><div class="ttname"><a href="../../d8/d8a/astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a></div><div class="ttdeci">#define ast_free(a)</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d8a/astmm_8h_source.html#l00182">astmm.h:182</a></div></div>
<div class="ttc" id="structast__cli__entry_html_ade9cba72805fe52685a1deea307a8e82"><div class="ttname"><a href="../../d8/d07/structast__cli__entry.html#ade9cba72805fe52685a1deea307a8e82">ast_cli_entry::command</a></div><div class="ttdeci">char * command</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/db0/cli_8h_source.html#l00186">cli.h:186</a></div></div>
<div class="ttc" id="structast__fax__session__details_html_a2bdd8d6f48911b41e094440799e00bd2"><div class="ttname"><a href="../../d8/dc2/structast__fax__session__details.html#a2bdd8d6f48911b41e094440799e00bd2">ast_fax_session_details::allow_audio</a></div><div class="ttdeci">uint32_t allow_audio</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d6a/res__fax_8h_source.html#l00157">res_fax.h:157</a></div></div>
<div class="ttc" id="res__fax_8c_html_abe5fc760b71dee05a818bb0df9639e36"><div class="ttname"><a href="../../d0/d60/res__fax_8c.html#abe5fc760b71dee05a818bb0df9639e36">manager_fax_stats</a></div><div class="ttdeci">static int manager_fax_stats(struct mansession *s, const struct message *m)</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d60/res__fax_8c_source.html#l04213">res_fax.c:4213</a></div></div>
<div class="ttc" id="astmm_8h_html_ae0cd4c5524b01287ab19cbe233d9cebb"><div class="ttname"><a href="../../d8/d8a/astmm_8h.html#ae0cd4c5524b01287ab19cbe233d9cebb">ast_calloc</a></div><div class="ttdeci">#define ast_calloc(num, len)</div><div class="ttdoc">A wrapper for calloc() </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d8a/astmm_8h_source.html#l00204">astmm.h:204</a></div></div>
<div class="ttc" id="structast__fax__tech_html_ab3293b469db5b9353aa3bc1d278ba080"><div class="ttname"><a href="../../d9/d0e/structast__fax__tech.html#ab3293b469db5b9353aa3bc1d278ba080">ast_fax_tech::version</a></div><div class="ttdeci">const char *const version</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d6a/res__fax_8h_source.html#l00241">res_fax.h:241</a></div></div>
<div class="ttc" id="cdr__mysql_8c_html_ad1982509765f4870f1f63412a53ea668"><div class="ttname"><a href="../../d0/d29/cdr__mysql_8c.html#ad1982509765f4870f1f63412a53ea668">reload</a></div><div class="ttdeci">static int reload(void)</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d29/cdr__mysql_8c_source.html#l00741">cdr_mysql.c:741</a></div></div>
<div class="ttc" id="structast__fax__session__details_html_af766692698b742acddbc42494d323a9f"><div class="ttname"><a href="../../d8/dc2/structast__fax__session__details.html#af766692698b742acddbc42494d323a9f">ast_fax_session_details::ecm</a></div><div class="ttdeci">uint32_t ecm</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d6a/res__fax_8h_source.html#l00153">res_fax.h:153</a></div></div>
<div class="ttc" id="res__fax_8c_html_ab42fd8bc63ac1571556fa571dcc1c91c"><div class="ttname"><a href="../../d0/d60/res__fax_8c.html#ab42fd8bc63ac1571556fa571dcc1c91c">RES_FAX_STATUSEVENTS</a></div><div class="ttdeci">#define RES_FAX_STATUSEVENTS</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d60/res__fax_8c_source.html#l00524">res_fax.c:524</a></div></div>
<div class="ttc" id="res__fax_8c_html_a6768093d6a4ce21f6b3b18bad24c5ee2"><div class="ttname"><a href="../../d0/d60/res__fax_8c.html#a6768093d6a4ce21f6b3b18bad24c5ee2">set_t38timeout</a></div><div class="ttdeci">static int set_t38timeout(const char *value, unsigned int *t38timeout)</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d60/res__fax_8c_source.html#l04404">res_fax.c:4404</a></div></div>
<div class="ttc" id="res__fax_8c_html_a383005b651eaf3e5203501a8ef9e7766"><div class="ttname"><a href="../../d0/d60/res__fax_8c.html#a383005b651eaf3e5203501a8ef9e7766">acf_faxopt_read</a></div><div class="ttdeci">static int acf_faxopt_read(struct ast_channel *chan, const char *cmd, char *data, char *buf, size_t len)</div><div class="ttdoc">FAXOPT read function returns the contents of a FAX option. </div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d60/res__fax_8c_source.html#l04526">res_fax.c:4526</a></div></div>
<div class="ttc" id="res__fax_8c_html_a7c6ac25ea7536c0bc9ed18cbcf917527"><div class="ttname"><a href="../../d0/d60/res__fax_8c.html#a7c6ac25ea7536c0bc9ed18cbcf917527">reload_module</a></div><div class="ttdeci">static int reload_module(void)</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d60/res__fax_8c_source.html#l04854">res_fax.c:4854</a></div></div>
<div class="ttc" id="res__fax_8c_html_a38ce372560eb0b88386f1249c0e1e576"><div class="ttname"><a href="../../d0/d60/res__fax_8c.html#a38ce372560eb0b88386f1249c0e1e576">cli_fax_set_debug</a></div><div class="ttdeci">static char * cli_fax_set_debug(struct ast_cli_entry *e, int cmd, struct ast_cli_args *a)</div><div class="ttdoc">enable FAX debugging </div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d60/res__fax_8c_source.html#l04003">res_fax.c:4003</a></div></div>
<div class="ttc" id="structast__fax__tech_html_af6a106ce28aa76aef5f65fa63d1cb129"><div class="ttname"><a href="../../d9/d0e/structast__fax__tech.html#af6a106ce28aa76aef5f65fa63d1cb129">ast_fax_tech::new_session</a></div><div class="ttdeci">void *(*const new_session)(struct ast_fax_session *, struct ast_fax_tech_token *)</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d6a/res__fax_8h_source.html#l00251">res_fax.h:251</a></div></div>
<div class="ttc" id="res__fax_8h_html_a54eb45ad548b874cf12d0a599631e3f6"><div class="ttname"><a href="../../db/d6a/res__fax_8h.html#a54eb45ad548b874cf12d0a599631e3f6">ast_fax_capabilities</a></div><div class="ttdeci">ast_fax_capabilities</div><div class="ttdoc">capabilities for res_fax to locate a fax technology module </div><div class="ttdef"><b>Definition:</b> <a href="../../db/d6a/res__fax_8h_source.html#l00035">res_fax.h:35</a></div></div>
<div class="ttc" id="res__fax_8h_html_ab34810136037068a0847bcca2518112c"><div class="ttname"><a href="../../db/d6a/res__fax_8h.html#ab34810136037068a0847bcca2518112c">ast_fax_state</a></div><div class="ttdeci">ast_fax_state</div><div class="ttdoc">current state of a fax session </div><div class="ttdef"><b>Definition:</b> <a href="../../db/d6a/res__fax_8h_source.html#l00065">res_fax.h:65</a></div></div>
<div class="ttc" id="structast__fax__session__details_html_a38b557eee45ee4c0d92d514c04823f84"><div class="ttname"><a href="../../d8/dc2/structast__fax__session__details.html#a38b557eee45ee4c0d92d514c04823f84">ast_fax_session_details::modems</a></div><div class="ttdeci">enum ast_fax_modems modems</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d6a/res__fax_8h_source.html#l00115">res_fax.h:115</a></div></div>
<div class="ttc" id="channel_8h_html_a79c413d51b7135404d5cacf811649a61"><div class="ttname"><a href="../../d5/d7b/channel_8h.html#a79c413d51b7135404d5cacf811649a61">ast_write</a></div><div class="ttdeci">int ast_write(struct ast_channel *chan, struct ast_frame *frame)</div><div class="ttdoc">Write a frame to a channel This function writes the given frame to the indicated channel. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d28/channel_8c_source.html#l05189">channel.c:5189</a></div></div>
<div class="ttc" id="include_2asterisk_2frame_8h_html_a8d9ee156e6e29222a8fc1383f2832b07a2956ffa9b3fdde7ffc800fbd6e6a5482"><div class="ttname"><a href="../../d6/d66/include_2asterisk_2frame_8h.html#a8d9ee156e6e29222a8fc1383f2832b07a2956ffa9b3fdde7ffc800fbd6e6a5482">AST_T38_RATE_14400</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d66/include_2asterisk_2frame_8h_source.html#l00389">include/asterisk/frame.h:389</a></div></div>
<div class="ttc" id="structast__cli__args_html_adc1f34651f7bbfa3ba5af27db5f53817"><div class="ttname"><a href="../../d3/dad/structast__cli__args.html#adc1f34651f7bbfa3ba5af27db5f53817">ast_cli_args::word</a></div><div class="ttdeci">const char * word</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/db0/cli_8h_source.html#l00163">cli.h:163</a></div></div>
<div class="ttc" id="structast__fax__tech_html_a122c331ef9858205b17ca45fb08c211b"><div class="ttname"><a href="../../d9/d0e/structast__fax__tech.html#a122c331ef9858205b17ca45fb08c211b">ast_fax_tech::manager_fax_session</a></div><div class="ttdeci">void(*const manager_fax_session)(struct mansession *, const char *, struct ast_fax_session *)</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d6a/res__fax_8h_source.html#l00271">res_fax.h:271</a></div></div>
<div class="ttc" id="structast__fax__session_html_ad8f346e1752edcc0b1a6b431b1749f0e"><div class="ttname"><a href="../../d1/d16/structast__fax__session.html#ad8f346e1752edcc0b1a6b431b1749f0e">ast_fax_session::state</a></div><div class="ttdeci">enum ast_fax_state state</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d6a/res__fax_8h_source.html#l00218">res_fax.h:218</a></div></div>
<div class="ttc" id="structfax__detect_html_ae5329584b2cf034725f675183f6bd391"><div class="ttname"><a href="../../da/df6/structfax__detect.html#ae5329584b2cf034725f675183f6bd391">fax_detect::orig_format</a></div><div class="ttdeci">struct ast_format * orig_format</div><div class="ttdoc">original audio formats </div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d60/res__fax_8c_source.html#l00475">res_fax.c:475</a></div></div>
<div class="ttc" id="module_8h_html_adc09474f0ff557e9925b722ee5b952dfac742921e9f9512d28f62c74ea2affe57"><div class="ttname"><a href="../../d5/d16/module_8h.html#adc09474f0ff557e9925b722ee5b952dfac742921e9f9512d28f62c74ea2affe57">AST_MODULE_LOAD_DECLINE</a></div><div class="ttdoc">Module has failed to load, may be in an inconsistent state. </div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d16/module_8h_source.html#l00078">module.h:78</a></div></div>
<div class="ttc" id="structast__fax__session_html_a6f8059414f0228f0256115e024eeed4b"><div class="ttname"><a href="../../d1/d16/structast__fax__session.html#a6f8059414f0228f0256115e024eeed4b">ast_fax_session::fd</a></div><div class="ttdeci">int fd</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d6a/res__fax_8h_source.html#l00206">res_fax.h:206</a></div></div>
<div class="ttc" id="structdebug__info__history_html_a0e129d2262db03fd0da1b365ea05fdc5"><div class="ttname"><a href="../../d2/d1c/structdebug__info__history.html#a0e129d2262db03fd0da1b365ea05fdc5">debug_info_history::consec_ms</a></div><div class="ttdeci">unsigned int consec_ms</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d60/res__fax_8c_source.html#l00433">res_fax.c:433</a></div></div>
<div class="ttc" id="include_2asterisk_2frame_8h_html_a314496ce1d74ed7fdb9c5319c5e2e953"><div class="ttname"><a href="../../d6/d66/include_2asterisk_2frame_8h.html#a314496ce1d74ed7fdb9c5319c5e2e953">ast_frisolate</a></div><div class="ttdeci">#define ast_frisolate(fr)</div><div class="ttdoc">Makes a frame independent of any static storage. </div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d66/include_2asterisk_2frame_8h_source.html#l00577">include/asterisk/frame.h:577</a></div></div>
<div class="ttc" id="astobj2_8h_html_a911e0703891a9a7aaf73978152092586"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#a911e0703891a9a7aaf73978152092586">ao2_find</a></div><div class="ttdeci">#define ao2_find(container, arg, flags)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l01756">astobj2.h:1756</a></div></div>
<div class="ttc" id="res__fax_8h_html_ab34810136037068a0847bcca2518112cae3dc111580a7a9ef050b638a3da10790"><div class="ttname"><a href="../../db/d6a/res__fax_8h.html#ab34810136037068a0847bcca2518112cae3dc111580a7a9ef050b638a3da10790">AST_FAX_STATE_RESERVED</a></div><div class="ttdef"><b>Definition:</b> <a href="../../db/d6a/res__fax_8h_source.html#l00077">res_fax.h:77</a></div></div>
<div class="ttc" id="res__fax_8c_html_a3e8bec5eeb0e707450d6dab929fe3436"><div class="ttname"><a href="../../d0/d60/res__fax_8c.html#a3e8bec5eeb0e707450d6dab929fe3436">fax_logger_level</a></div><div class="ttdeci">static int fax_logger_level</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d60/res__fax_8c_source.html#l00487">res_fax.c:487</a></div></div>
<div class="ttc" id="structstate_html"><div class="ttname"><a href="../../d4/d88/structstate.html">state</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d9/df8/localtime_8c_source.html#l00158">localtime.c:158</a></div></div>
<div class="ttc" id="channel_8h_html_a4cd990f4c1cd0c2af6e4c63f6d15b4e1af142c79721a025bd65edad812f0725e0"><div class="ttname"><a href="../../d5/d7b/channel_8h.html#a4cd990f4c1cd0c2af6e4c63f6d15b4e1af142c79721a025bd65edad812f0725e0">T38_STATE_NEGOTIATED</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d7b/channel_8h_source.html#l00884">channel.h:884</a></div></div>
<div class="ttc" id="structast__fax__session__details_html_aaa69733356239747f442b9543b38cfba"><div class="ttname"><a href="../../d8/dc2/structast__fax__session__details.html#aaa69733356239747f442b9543b38cfba">ast_fax_session_details::faxdetect_id</a></div><div class="ttdeci">int faxdetect_id</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d6a/res__fax_8h_source.html#l00185">res_fax.h:185</a></div></div>
<div class="ttc" id="res__fax_8c_html_ad09fa931f468002152a3cc2d5ce25eae"><div class="ttname"><a href="../../d0/d60/res__fax_8c.html#ad09fa931f468002152a3cc2d5ce25eae">unload_module</a></div><div class="ttdeci">static int unload_module(void)</div><div class="ttdoc">unload res_fax </div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d60/res__fax_8c_source.html#l04749">res_fax.c:4749</a></div></div>
<div class="ttc" id="structfax__gateway_html_a37f4333f3e7eaf12966069b77dac704e"><div class="ttname"><a href="../../dd/dd2/structfax__gateway.html#a37f4333f3e7eaf12966069b77dac704e">fax_gateway::t38_state</a></div><div class="ttdeci">enum ast_t38_state t38_state</div><div class="ttdoc">a flag to track the state of our negotiation </div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d60/res__fax_8c_source.html#l00460">res_fax.c:460</a></div></div>
<div class="ttc" id="res__fax_8h_html_ab34810136037068a0847bcca2518112cad0225f93f7c72e6071a0e2c459ec213c"><div class="ttname"><a href="../../db/d6a/res__fax_8h.html#ab34810136037068a0847bcca2518112cad0225f93f7c72e6071a0e2c459ec213c">AST_FAX_STATE_OPEN</a></div><div class="ttdef"><b>Definition:</b> <a href="../../db/d6a/res__fax_8h_source.html#l00071">res_fax.h:71</a></div></div>
<div class="ttc" id="res__fax_8c_html_aa0da952373da5653cfc4b62964aa6286"><div class="ttname"><a href="../../d0/d60/res__fax_8c.html#aa0da952373da5653cfc4b62964aa6286">ast_fax_maxrate</a></div><div class="ttdeci">unsigned int ast_fax_maxrate(void)</div><div class="ttdoc">get the maxiumum supported fax rate </div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d60/res__fax_8c_source.html#l00796">res_fax.c:796</a></div></div>
<div class="ttc" id="res__fax_8c_html_afb6be9ca0b6c0d09211b5c4e55fa2291"><div class="ttname"><a href="../../d0/d60/res__fax_8c.html#afb6be9ca0b6c0d09211b5c4e55fa2291">global_fax_debug</a></div><div class="ttdeci">static int global_fax_debug</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d60/res__fax_8c_source.html#l00555">res_fax.c:555</a></div></div>
<div class="ttc" id="structfax__detect_html_ac8bf36fe0577cba66bccda3a6f7e80a4"><div class="ttname"><a href="../../da/df6/structfax__detect.html#ac8bf36fe0577cba66bccda3a6f7e80a4">fax_detect::flags</a></div><div class="ttdeci">int flags</div><div class="ttdoc">mode </div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d60/res__fax_8c_source.html#l00479">res_fax.c:479</a></div></div>
<div class="ttc" id="http_8c_html_a7aa5af3eb4d501b0c44c590507f751e8"><div class="ttname"><a href="../../dd/d43/http_8c.html#a7aa5af3eb4d501b0c44c590507f751e8">session_count</a></div><div class="ttdeci">static int session_count</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d43/http_8c_source.html#l00109">http.c:109</a></div></div>
<div class="ttc" id="stringfields_8h_html_a8b9f4347fc72720cc5cead952b54abe9"><div class="ttname"><a href="../../d1/d0f/stringfields_8h.html#a8b9f4347fc72720cc5cead952b54abe9">ast_string_field_build</a></div><div class="ttdeci">#define ast_string_field_build(x, field, fmt, args...)</div><div class="ttdoc">Set a field to a complex (built) value. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d0f/stringfields_8h_source.html#l00550">stringfields.h:550</a></div></div>
<div class="ttc" id="structast__flags_html"><div class="ttname"><a href="../../dc/dac/structast__flags.html">ast_flags</a></div><div class="ttdoc">Structure used to handle boolean flags. </div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d60/utils_8h_source.html#l00199">utils.h:199</a></div></div>
<div class="ttc" id="res__fax_8c_html_a20a88f0d3ef36ac1137ed08fd8e9f217"><div class="ttname"><a href="../../d0/d60/res__fax_8c.html#a20a88f0d3ef36ac1137ed08fd8e9f217">fax_session_type</a></div><div class="ttdeci">static const char * fax_session_type(struct ast_fax_session *s)</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d60/res__fax_8c_source.html#l04242">res_fax.c:4242</a></div></div>
<div class="ttc" id="res__fax_8c_html_a65e5109273690c9fa64f70d4860c6647"><div class="ttname"><a href="../../d0/d60/res__fax_8c.html#a65e5109273690c9fa64f70d4860c6647">config</a></div><div class="ttdeci">static const char * config</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d60/res__fax_8c_source.html#l00553">res_fax.c:553</a></div></div>
<div class="ttc" id="logger_8h_html"><div class="ttname"><a href="../../d1/d8c/logger_8h.html">logger.h</a></div><div class="ttdoc">Support for logging to various files, console and syslog Configuration in file logger.conf. </div></div>
<div class="ttc" id="res__fax_8c_html_abdefdbe1ecf335759235651298ad70b2"><div class="ttname"><a href="../../d0/d60/res__fax_8c.html#abdefdbe1ecf335759235651298ad70b2">destroy_callback</a></div><div class="ttdeci">static void destroy_callback(void *data)</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d60/res__fax_8c_source.html#l00610">res_fax.c:610</a></div></div>
<div class="ttc" id="linkedlists_8h_html_ac63e9e237da22b6faf3be4edfc4f5a11"><div class="ttname"><a href="../../df/d90/linkedlists_8h.html#ac63e9e237da22b6faf3be4edfc4f5a11">AST_RWLIST_ENTRY</a></div><div class="ttdeci">#define AST_RWLIST_ENTRY</div><div class="ttdef"><b>Definition:</b> <a href="../../df/d90/linkedlists_8h_source.html#l00414">linkedlists.h:414</a></div></div>
<div class="ttc" id="res__phoneprov_8c_html_addaa208b0ed785225e24490fb9f28a80"><div class="ttname"><a href="../../d9/de9/res__phoneprov_8c.html#addaa208b0ed785225e24490fb9f28a80">AST_MODULE_INFO</a></div><div class="ttdeci">AST_MODULE_INFO(ASTERISK_GPL_KEY, AST_MODFLAG_GLOBAL_SYMBOLS|AST_MODFLAG_LOAD_ORDER, &quot;HTTP Phone Provisioning&quot;,.support_level=AST_MODULE_SUPPORT_EXTENDED,.load=load_module,.unload=unload_module,.reload=reload,.load_pri=AST_MODPRI_CHANNEL_DEPEND,.requires=&quot;http&quot;,)</div></div>
<div class="ttc" id="structast__fax__debug__info_html_ab9deccb020b39c3f7ac94b1af99cac5d"><div class="ttname"><a href="../../d3/d84/structast__fax__debug__info.html#ab9deccb020b39c3f7ac94b1af99cac5d">ast_fax_debug_info::dsp</a></div><div class="ttdeci">struct ast_dsp * dsp</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d60/res__fax_8c_source.html#l00440">res_fax.c:440</a></div></div>
<div class="ttc" id="group__StasisTopicsAndMessages_html_gafe8b123e0c124e44c3bff016591d3f9c"><div class="ttname"><a href="../../df/deb/group__StasisTopicsAndMessages.html#gafe8b123e0c124e44c3bff016591d3f9c">ast_channel_blob_create_from_cache</a></div><div class="ttdeci">struct stasis_message * ast_channel_blob_create_from_cache(const char *uniqueid, struct stasis_message_type *type, struct ast_json *blob)</div><div class="ttdoc">Create a ast_channel_blob message, pulling channel state from the cache. </div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d2b/stasis__channels_8c_source.html#l00771">stasis_channels.c:771</a></div></div>
<div class="ttc" id="structast__cli__entry_html_aef1bd6ad890a110b466cb0e8088507a2"><div class="ttname"><a href="../../d8/d07/structast__cli__entry.html#aef1bd6ad890a110b466cb0e8088507a2">ast_cli_entry::usage</a></div><div class="ttdeci">const char * usage</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/db0/cli_8h_source.html#l00177">cli.h:177</a></div></div>
<div class="ttc" id="structast__control__t38__parameters_html_a07676322ec48c4872f9a208a6248d034"><div class="ttname"><a href="../../d5/def/structast__control__t38__parameters.html#a07676322ec48c4872f9a208a6248d034">ast_control_t38_parameters::transcoding_jbig</a></div><div class="ttdeci">unsigned int transcoding_jbig</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d66/include_2asterisk_2frame_8h_source.html#l00405">include/asterisk/frame.h:405</a></div></div>
<div class="ttc" id="pbx_8h_html_a6e5b90edb84d216267148dddcffe9b9a"><div class="ttname"><a href="../../db/de0/pbx_8h.html#a6e5b90edb84d216267148dddcffe9b9a">pbx_builtin_setvar_helper</a></div><div class="ttdeci">int pbx_builtin_setvar_helper(struct ast_channel *chan, const char *name, const char *value)</div><div class="ttdoc">Add a variable to the channel variable stack, removing the most recently set value for the same name...</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d8c/pbx__variables_8c_source.html#l01071">pbx_variables.c:1071</a></div></div>
<div class="ttc" id="res__fax_8c_html_a53f13b154b4691e9b1b5e9c2323f399c"><div class="ttname"><a href="../../d0/d60/res__fax_8c.html#a53f13b154b4691e9b1b5e9c2323f399c">fax_detect_framehook_destroy</a></div><div class="ttdeci">static void fax_detect_framehook_destroy(void *data)</div><div class="ttdoc">Deref the faxdetect data structure when the faxdetect framehook is detached. </div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d60/res__fax_8c_source.html#l03727">res_fax.c:3727</a></div></div>
<div class="ttc" id="lock_8h_html_a045bd81ceab2de81e42af338ad7cf121"><div class="ttname"><a href="../../dd/d42/lock_8h.html#a045bd81ceab2de81e42af338ad7cf121">ast_rwlock_wrlock</a></div><div class="ttdeci">#define ast_rwlock_wrlock(a)</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d42/lock_8h_source.html#l00234">lock.h:234</a></div></div>
<div class="ttc" id="module_8h_html_ad2dd3dce05926913c40b883cc7cff0a8"><div class="ttname"><a href="../../d5/d16/module_8h.html#ad2dd3dce05926913c40b883cc7cff0a8">ast_module_running_ref</a></div><div class="ttdeci">#define ast_module_running_ref(mod)</div><div class="ttdoc">Hold a reference to the module if it is running. </div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d16/module_8h_source.html#l00455">module.h:455</a></div></div>
<div class="ttc" id="res__fax_8c_html_a46275621a3d3846d089a092249fb8c37a98a16270534ab6ed19ac7935f6ab5730"><div class="ttname"><a href="../../d0/d60/res__fax_8c.html#a46275621a3d3846d089a092249fb8c37a98a16270534ab6ed19ac7935f6ab5730">OPT_ALLOWAUDIO</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d60/res__fax_8c_source.html#l00562">res_fax.c:562</a></div></div>
<div class="ttc" id="include_2asterisk_2frame_8h_html_af203379aca2fd704fe8d86a9445596b6"><div class="ttname"><a href="../../d6/d66/include_2asterisk_2frame_8h.html#af203379aca2fd704fe8d86a9445596b6">ast_null_frame</a></div><div class="ttdeci">struct ast_frame ast_null_frame</div><div class="ttdef"><b>Definition:</b> <a href="../../df/d55/main_2frame_8c_source.html#l00079">main/frame.c:79</a></div></div>
<div class="ttc" id="structast__fax__t38__parameters_html_a5408ac5df4c170828874e1b10b4c35a0"><div class="ttname"><a href="../../d3/df6/structast__fax__t38__parameters.html#a5408ac5df4c170828874e1b10b4c35a0">ast_fax_t38_parameters::version</a></div><div class="ttdeci">unsigned int version</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d6a/res__fax_8h_source.html#l00093">res_fax.h:93</a></div></div>
<div class="ttc" id="channel_8h_html_a695e5b4fcf983db6451b583fbd647424"><div class="ttname"><a href="../../d5/d7b/channel_8h.html#a695e5b4fcf983db6451b583fbd647424">ast_channel_lock_both</a></div><div class="ttdeci">#define ast_channel_lock_both(chan1, chan2)</div><div class="ttdoc">Lock two channels. </div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d7b/channel_8h_source.html#l02952">channel.h:2952</a></div></div>
<div class="ttc" id="manager_8h_html_a0b1b4140c2836696a6950e92ab48a580"><div class="ttname"><a href="../../db/d45/manager_8h.html#a0b1b4140c2836696a6950e92ab48a580">EVENT_FLAG_REPORTING</a></div><div class="ttdeci">#define EVENT_FLAG_REPORTING</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d45/manager_8h_source.html#l00080">manager.h:80</a></div></div>
<div class="ttc" id="res__fax_8c_html_aa71e4f978e47d124ee1f87b340fdfb78"><div class="ttname"><a href="../../d0/d60/res__fax_8c.html#aa71e4f978e47d124ee1f87b340fdfb78">fax_session_reserve</a></div><div class="ttdeci">static struct ast_fax_session * fax_session_reserve(struct ast_fax_session_details *details, struct ast_fax_tech_token **token)</div><div class="ttdoc">Reserve a fax session. </div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d60/res__fax_8c_source.html#l01146">res_fax.c:1146</a></div></div>
<div class="ttc" id="cli_8h_html_a50989f00b32eeb2516a3803cb2ffb766"><div class="ttname"><a href="../../dc/db0/cli_8h.html#a50989f00b32eeb2516a3803cb2ffb766">CLI_SUCCESS</a></div><div class="ttdeci">#define CLI_SUCCESS</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/db0/cli_8h_source.html#l00044">cli.h:44</a></div></div>
<div class="ttc" id="structfax__module_html"><div class="ttname"><a href="../../d9/d07/structfax__module.html">fax_module</a></div><div class="ttdoc">registered FAX technology modules are put into this list </div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d60/res__fax_8c_source.html#l00516">res_fax.c:516</a></div></div>
<div class="ttc" id="dsp_8h_html_a3f3b67988bffb3addfbc8a4688fa466d"><div class="ttname"><a href="../../d3/d08/dsp_8h.html#a3f3b67988bffb3addfbc8a4688fa466d">ast_dsp_silence</a></div><div class="ttdeci">int ast_dsp_silence(struct ast_dsp *dsp, struct ast_frame *f, int *totalsilence)</div><div class="ttdoc">Process the audio frame for silence. </div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d3b/dsp_8c_source.html#l01483">dsp.c:1483</a></div></div>
<div class="ttc" id="cli_8h_html_ab33e5350a923c3a8cedbeb496cd88ec9a76bf33139279b03ec1691f2be2d1be40"><div class="ttname"><a href="../../dc/db0/cli_8h.html#ab33e5350a923c3a8cedbeb496cd88ec9a76bf33139279b03ec1691f2be2d1be40">CLI_GENERATE</a></div><div class="ttdef"><b>Definition:</b> <a href="../../dc/db0/cli_8h_source.html#l00153">cli.h:153</a></div></div>
<div class="ttc" id="structast__datastore_html_a735984d41155bc1032e09bece8f8d66d"><div class="ttname"><a href="../../d4/d5d/structast__datastore.html#a735984d41155bc1032e09bece8f8d66d">ast_datastore::data</a></div><div class="ttdeci">void * data</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/db6/datastore_8h_source.html#l00070">datastore.h:70</a></div></div>
<div class="ttc" id="linkedlists_8h_html_aadda916488b2d151af4426e2f06ad332"><div class="ttname"><a href="../../df/d90/linkedlists_8h.html#aadda916488b2d151af4426e2f06ad332">AST_RWLIST_INSERT_TAIL</a></div><div class="ttdeci">#define AST_RWLIST_INSERT_TAIL</div><div class="ttdef"><b>Definition:</b> <a href="../../df/d90/linkedlists_8h_source.html#l00740">linkedlists.h:740</a></div></div>
<div class="ttc" id="include_2asterisk_2frame_8h_html_a168d496bdac09ece3ce49cf473bbdb4bad501e0d5fe272eaba466507a686a2df5"><div class="ttname"><a href="../../d6/d66/include_2asterisk_2frame_8h.html#a168d496bdac09ece3ce49cf473bbdb4bad501e0d5fe272eaba466507a686a2df5">AST_T38_NEGOTIATED</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d66/include_2asterisk_2frame_8h_source.html#l00373">include/asterisk/frame.h:373</a></div></div>
<div class="ttc" id="linkedlists_8h_html_a0d1f922e093ac18824a7863fe3f5fa27"><div class="ttname"><a href="../../df/d90/linkedlists_8h.html#a0d1f922e093ac18824a7863fe3f5fa27">AST_LIST_HEAD_INIT_NOLOCK</a></div><div class="ttdeci">#define AST_LIST_HEAD_INIT_NOLOCK(head)</div><div class="ttdoc">Initializes a list head structure. </div><div class="ttdef"><b>Definition:</b> <a href="../../df/d90/linkedlists_8h_source.html#l00680">linkedlists.h:680</a></div></div>
<div class="ttc" id="structast__fax__tech_html_ae6156817adecb8ef99cd175a229e07fe"><div class="ttname"><a href="../../d9/d0e/structast__fax__tech.html#ae6156817adecb8ef99cd175a229e07fe">ast_fax_tech::cli_show_session</a></div><div class="ttdeci">char *(*const cli_show_session)(struct ast_fax_session *, int)</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d6a/res__fax_8h_source.html#l00269">res_fax.h:269</a></div></div>
<div class="ttc" id="include_2asterisk_2compat_8h_html_a40eca58273c74a20a17f137d18ba826c"><div class="ttname"><a href="../../de/da3/include_2asterisk_2compat_8h.html#a40eca58273c74a20a17f137d18ba826c">strsep</a></div><div class="ttdeci">char * strsep(char **str, const char *delims)</div></div>
<div class="ttc" id="res__fax_8c_html_a058b6772fcfe1ce5a1a0957e2f11d367"><div class="ttname"><a href="../../d0/d60/res__fax_8c.html#a058b6772fcfe1ce5a1a0957e2f11d367">faxregistry</a></div><div class="ttdeci">static struct @460 faxregistry</div><div class="ttdoc">The faxregistry is used to manage information and statistics for all FAX sessions. </div></div>
<div class="ttc" id="utils_2frame_8c_html_a48bc11919b2752df9d14ce89557cfb25"><div class="ttname"><a href="../../d6/d47/utils_2frame_8c.html#a48bc11919b2752df9d14ce89557cfb25">out</a></div><div class="ttdeci">FILE * out</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d47/utils_2frame_8c_source.html#l00033">utils/frame.c:33</a></div></div>
<div class="ttc" id="res__fax_8c_html_a87b3eecb05c2a57012c6589329751a40"><div class="ttname"><a href="../../d0/d60/res__fax_8c.html#a87b3eecb05c2a57012c6589329751a40">set_config</a></div><div class="ttdeci">static int set_config(int reload)</div><div class="ttdoc">configure res_fax </div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d60/res__fax_8c_source.html#l04422">res_fax.c:4422</a></div></div>
<div class="ttc" id="astobj2_8h_html_aa81c8462bd0574f4f9e09e71f2772f44"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#aa81c8462bd0574f4f9e09e71f2772f44">ao2_replace</a></div><div class="ttdeci">#define ao2_replace(dst, src)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l00517">astobj2.h:517</a></div></div>
<div class="ttc" id="channel_8c_html_a5cb129ce1d580dbb22ec9573dcb62f7f"><div class="ttname"><a href="../../d4/d28/channel_8c.html#a5cb129ce1d580dbb22ec9573dcb62f7f">chancount</a></div><div class="ttdeci">static int chancount</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d28/channel_8c_source.html#l00093">channel.c:93</a></div></div>
<div class="ttc" id="channel_8h_html_a60e0bcaed001e8d5ed1ba0eb2644b3cc"><div class="ttname"><a href="../../d5/d7b/channel_8h.html#a60e0bcaed001e8d5ed1ba0eb2644b3cc">ast_waitfor</a></div><div class="ttdeci">int ast_waitfor(struct ast_channel *chan, int ms)</div><div class="ttdoc">Wait for input on a channel. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d28/channel_8c_source.html#l03171">channel.c:3171</a></div></div>
<div class="ttc" id="res__fax_8c_html_a1b9314c7e94b0f3b703c975b0854519f"><div class="ttname"><a href="../../d0/d60/res__fax_8c.html#a1b9314c7e94b0f3b703c975b0854519f">ast_fax_session_operation_str</a></div><div class="ttdeci">const char * ast_fax_session_operation_str(struct ast_fax_session *s)</div><div class="ttdoc">get string representation of a FAX session&amp;#39;s operation </div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d60/res__fax_8c_source.html#l04254">res_fax.c:4254</a></div></div>
<div class="ttc" id="structao2__iterator_html"><div class="ttname"><a href="../../d9/d97/structao2__iterator.html">ao2_iterator</a></div><div class="ttdoc">When we need to walk through a container, we use an ao2_iterator to keep track of the current positio...</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l01841">astobj2.h:1841</a></div></div>
<div class="ttc" id="astobj2_8h_html_a6321ee982370c55ab3c24c72c562cbdd"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#a6321ee982370c55ab3c24c72c562cbdd">ao2_cleanup</a></div><div class="ttdeci">#define ao2_cleanup(obj)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l01958">astobj2.h:1958</a></div></div>
<div class="ttc" id="cli_8h_html"><div class="ttname"><a href="../../dc/db0/cli_8h.html">cli.h</a></div><div class="ttdoc">Standard Command Line Interface. </div></div>
<div class="ttc" id="smoother_8h_html_af8d6dcd265eaf403b1b1139770c885d8"><div class="ttname"><a href="../../d6/d7f/smoother_8h.html#af8d6dcd265eaf403b1b1139770c885d8">ast_smoother_read</a></div><div class="ttdeci">struct ast_frame * ast_smoother_read(struct ast_smoother *s)</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/dd7/smoother_8c_source.html#l00169">smoother.c:169</a></div></div>
<div class="ttc" id="res__fax_8c_html_af822150a9af5748af190c5f66979aae0"><div class="ttname"><a href="../../d0/d60/res__fax_8c.html#af822150a9af5748af190c5f66979aae0">report_receive_fax_status</a></div><div class="ttdeci">static int report_receive_fax_status(struct ast_channel *chan, const char *filename)</div><div class="ttdoc">Report on the final state of a receive fax operation. </div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d60/res__fax_8c_source.html#l02018">res_fax.c:2018</a></div></div>
<div class="ttc" id="structast__fax__document_html_a7d18bbe79e0371242e10316471016b3d"><div class="ttname"><a href="../../d2/db8/structast__fax__document.html#a7d18bbe79e0371242e10316471016b3d">ast_fax_document::next</a></div><div class="ttdeci">struct ast_fax_document * next</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d6a/res__fax_8h_source.html#l00103">res_fax.h:103</a></div></div>
<div class="ttc" id="strings_8h_html_ac4040268f7b6ed77dfc49c7767626369"><div class="ttname"><a href="../../d6/d90/strings_8h.html#ac4040268f7b6ed77dfc49c7767626369">ast_copy_string</a></div><div class="ttdeci">void ast_copy_string(char *dst, const char *src, size_t size)</div><div class="ttdoc">Size-limited null-terminating string copy. </div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d90/strings_8h_source.html#l00401">strings.h:401</a></div></div>
<div class="ttc" id="res__fax_8c_html_af31af245716f15330db91e03ef9cfe15"><div class="ttname"><a href="../../d0/d60/res__fax_8c.html#af31af245716f15330db91e03ef9cfe15">manager_fax_sessions</a></div><div class="ttdeci">static int manager_fax_sessions(struct mansession *s, const struct message *m)</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d60/res__fax_8c_source.html#l04349">res_fax.c:4349</a></div></div>
<div class="ttc" id="res__fax_8c_html_aa42f3331d32fc2fd92010023c6100322"><div class="ttname"><a href="../../d0/d60/res__fax_8c.html#aa42f3331d32fc2fd92010023c6100322">find_details</a></div><div class="ttdeci">static struct ast_fax_session_details * find_details(struct ast_channel *chan)</div><div class="ttdoc">returns a reference counted pointer to a fax datastore, if it exists </div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d60/res__fax_8c_source.html#l00662">res_fax.c:662</a></div></div>
<div class="ttc" id="strings_8h_html_a2faaa16929951bfd2802b7829a100ba2"><div class="ttname"><a href="../../d6/d90/strings_8h.html#a2faaa16929951bfd2802b7829a100ba2">S_OR</a></div><div class="ttdeci">#define S_OR(a, b)</div><div class="ttdoc">returns the equivalent of logic or for strings: first one if not empty, otherwise second one...</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d90/strings_8h_source.html#l00079">strings.h:79</a></div></div>
<div class="ttc" id="format__cache_8h_html_a95c058fe6adef68780f026d6aec2481c"><div class="ttname"><a href="../../db/d1c/format__cache_8h.html#a95c058fe6adef68780f026d6aec2481c">ast_format_alaw</a></div><div class="ttdeci">struct ast_format * ast_format_alaw</div><div class="ttdoc">Built-in cached alaw format. </div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d29/format__cache_8c_source.html#l00091">format_cache.c:91</a></div></div>
<div class="ttc" id="structast__fax__tech_html_aa44dffb52a00b5f1f5ccb493d81fb659"><div class="ttname"><a href="../../d9/d0e/structast__fax__tech.html#aa44dffb52a00b5f1f5ccb493d81fb659">ast_fax_tech::read</a></div><div class="ttdeci">struct ast_frame *(*const read)(struct ast_fax_session *)</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d6a/res__fax_8h_source.html#l00255">res_fax.h:255</a></div></div>
<div class="ttc" id="channel_8h_html_af9e27ecd92ff5aa897c9e058dfbd6510"><div class="ttname"><a href="../../d5/d7b/channel_8h.html#af9e27ecd92ff5aa897c9e058dfbd6510">ast_channel_bridge_peer</a></div><div class="ttdeci">struct ast_channel * ast_channel_bridge_peer(struct ast_channel *chan)</div><div class="ttdoc">Get the channel&amp;#39;s bridge peer only if the bridge is two-party. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d28/channel_8c_source.html#l10765">channel.c:10765</a></div></div>
<div class="ttc" id="structfax__gateway_html_aed7ead71b14c348cd4a72ffbced30989"><div class="ttname"><a href="../../dd/dd2/structfax__gateway.html#aed7ead71b14c348cd4a72ffbced30989">fax_gateway::token</a></div><div class="ttdeci">struct ast_fax_tech_token * token</div><div class="ttdoc">reserved fax session token </div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d60/res__fax_8c_source.html#l00450">res_fax.c:450</a></div></div>
<div class="ttc" id="channel_8h_html_a7ca2fda13b129a55c251b56729de285b"><div class="ttname"><a href="../../d5/d7b/channel_8h.html#a7ca2fda13b129a55c251b56729de285b">ast_channel_name</a></div><div class="ttdeci">const char * ast_channel_name(const struct ast_channel *chan)</div></div>
<div class="ttc" id="strings_8h_html_a6c3dc0bad204e9dd9890325c1c861e38"><div class="ttname"><a href="../../d6/d90/strings_8h.html#a6c3dc0bad204e9dd9890325c1c861e38">ast_false</a></div><div class="ttdeci">int attribute_pure ast_false(const char *val)</div><div class="ttdoc">Make sure something is false. Determine if a string containing a boolean value is &quot;false&quot;...</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d1f/main_2utils_8c_source.html#l01968">main/utils.c:1968</a></div></div>
<div class="ttc" id="res__fax_8c_html_a235464080ba7708ab425f6074d9a2bda"><div class="ttname"><a href="../../d0/d60/res__fax_8c.html#a235464080ba7708ab425f6074d9a2bda">set_general_options</a></div><div class="ttdeci">static void set_general_options(const struct fax_options *options)</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d60/res__fax_8c_source.html#l04390">res_fax.c:4390</a></div></div>
<div class="ttc" id="structast__cli__args_html_a4b911d12699acbbb5a8b62355b35bae8"><div class="ttname"><a href="../../d3/dad/structast__cli__args.html#a4b911d12699acbbb5a8b62355b35bae8">ast_cli_args::pos</a></div><div class="ttdeci">const int pos</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/db0/cli_8h_source.html#l00164">cli.h:164</a></div></div>
<div class="ttc" id="res__fax_8h_html_ab34810136037068a0847bcca2518112ca89690cf17e4dd810bc40e657ac1d6213"><div class="ttname"><a href="../../db/d6a/res__fax_8h.html#ab34810136037068a0847bcca2518112ca89690cf17e4dd810bc40e657ac1d6213">AST_FAX_STATE_COMPLETE</a></div><div class="ttdef"><b>Definition:</b> <a href="../../db/d6a/res__fax_8h_source.html#l00075">res_fax.h:75</a></div></div>
<div class="ttc" id="res__fax_8c_html_affdd90b9debbbb9add90b87c27b38de0"><div class="ttname"><a href="../../d0/d60/res__fax_8c.html#affdd90b9debbbb9add90b87c27b38de0">general_options</a></div><div class="ttdeci">static struct fax_options general_options</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d60/res__fax_8c_source.html#l00537">res_fax.c:537</a></div></div>
<div class="ttc" id="res__fax_8c_html_a72074e43459dce843bd53cf52f186861"><div class="ttname"><a href="../../d0/d60/res__fax_8c.html#a72074e43459dce843bd53cf52f186861">fax_detect_attach</a></div><div class="ttdeci">static int fax_detect_attach(struct ast_channel *chan, int timeout, int flags)</div><div class="ttdoc">Attach a faxdetect framehook object to a channel. </div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d60/res__fax_8c_source.html#l03889">res_fax.c:3889</a></div></div>
<div class="ttc" id="res__fax_8c_html_a38d73af44b480b7cad7a654f75926777"><div class="ttname"><a href="../../d0/d60/res__fax_8c.html#a38d73af44b480b7cad7a654f75926777">report_fax_status</a></div><div class="ttdeci">static int report_fax_status(struct ast_channel *chan, struct ast_fax_session_details *details, const char *status)</div><div class="ttdoc">send a FAX status manager event </div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d60/res__fax_8c_source.html#l01407">res_fax.c:1407</a></div></div>
<div class="ttc" id="include_2asterisk_2app_8h_html_a2a1890787b3e55318c417c0a3e1432c7"><div class="ttname"><a href="../../d3/d93/include_2asterisk_2app_8h.html#a2a1890787b3e55318c417c0a3e1432c7">END_OPTIONS</a></div><div class="ttdeci">#define END_OPTIONS</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d93/include_2asterisk_2app_8h_source.html#l01344">include/asterisk/app.h:1344</a></div></div>
<div class="ttc" id="res__fax_8c_html_af76343c79cdf15a8e524457455fc2d20"><div class="ttname"><a href="../../d0/d60/res__fax_8c.html#af76343c79cdf15a8e524457455fc2d20">fax_failures</a></div><div class="ttdeci">int fax_failures</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d60/res__fax_8c_source.html#l00510">res_fax.c:510</a></div></div>
<div class="ttc" id="pbx_8h_html_ae0ba2eb966a9e3376de61d30513f7302"><div class="ttname"><a href="../../db/de0/pbx_8h.html#ae0ba2eb966a9e3376de61d30513f7302">ast_async_goto</a></div><div class="ttdeci">int ast_async_goto(struct ast_channel *chan, const char *context, const char *exten, int priority)</div><div class="ttdoc">Set the channel to next execute the specified dialplan location. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l07011">pbx.c:7011</a></div></div>
<div class="ttc" id="include_2asterisk_2frame_8h_html_a6440d070425a2efe8e0aa71e8d9e47b7"><div class="ttname"><a href="../../d6/d66/include_2asterisk_2frame_8h.html#a6440d070425a2efe8e0aa71e8d9e47b7">ast_frfree</a></div><div class="ttdeci">#define ast_frfree(fr)</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d66/include_2asterisk_2frame_8h_source.html#l00556">include/asterisk/frame.h:556</a></div></div>
<div class="ttc" id="channel_8h_html_aec583a3e25358ee552a4f3df53914cd0"><div class="ttname"><a href="../../d5/d7b/channel_8h.html#aec583a3e25358ee552a4f3df53914cd0">ast_answer</a></div><div class="ttdeci">int ast_answer(struct ast_channel *chan)</div><div class="ttdoc">Answer a channel. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d28/channel_8c_source.html#l02814">channel.c:2814</a></div></div>
<div class="ttc" id="include_2asterisk_2frame_8h_html_a168d496bdac09ece3ce49cf473bbdb4ba9df578b4287c86673d7f40f9abcdc86f"><div class="ttname"><a href="../../d6/d66/include_2asterisk_2frame_8h.html#a168d496bdac09ece3ce49cf473bbdb4ba9df578b4287c86673d7f40f9abcdc86f">AST_T38_TERMINATED</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d66/include_2asterisk_2frame_8h_source.html#l00374">include/asterisk/frame.h:374</a></div></div>
<div class="ttc" id="res__fax_8c_html_a47e8837147c2482dcde5be39f354e03c"><div class="ttname"><a href="../../d0/d60/res__fax_8c.html#a47e8837147c2482dcde5be39f354e03c">fax_gateway_new</a></div><div class="ttdeci">static struct fax_gateway * fax_gateway_new(struct ast_channel *chan, struct ast_fax_session_details *details)</div><div class="ttdoc">Create a new fax gateway object. </div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d60/res__fax_8c_source.html#l02880">res_fax.c:2880</a></div></div>
<div class="ttc" id="cel__pgsql_8c_html_ad6c487210772a9b4b0ca04b04b847d4c"><div class="ttname"><a href="../../de/d1b/cel__pgsql_8c.html#ad6c487210772a9b4b0ca04b04b847d4c">result</a></div><div class="ttdeci">static PGresult * result</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d1b/cel__pgsql_8c_source.html#l00088">cel_pgsql.c:88</a></div></div>
<div class="ttc" id="structast__control__t38__parameters_html_ad39f48f545d7c8962dfa0ae83a61c21f"><div class="ttname"><a href="../../d5/def/structast__control__t38__parameters.html#ad39f48f545d7c8962dfa0ae83a61c21f">ast_control_t38_parameters::rate_management</a></div><div class="ttdeci">enum ast_control_t38_rate_management rate_management</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d66/include_2asterisk_2frame_8h_source.html#l00402">include/asterisk/frame.h:402</a></div></div>
<div class="ttc" id="channel_8h_html_a7e5e15c22564fd66351d332ad10658b5"><div class="ttname"><a href="../../d5/d7b/channel_8h.html#a7e5e15c22564fd66351d332ad10658b5">ast_queue_control_data</a></div><div class="ttdeci">int ast_queue_control_data(struct ast_channel *chan, enum ast_control_frame_type control, const void *data, size_t datalen)</div><div class="ttdoc">Queue a control frame with payload. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d28/channel_8c_source.html#l01238">channel.c:1238</a></div></div>
<div class="ttc" id="structast__fax__session_html"><div class="ttname"><a href="../../d1/d16/structast__fax__session.html">ast_fax_session</a></div><div class="ttdoc">The data required to handle a fax session. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/d6a/res__fax_8h_source.html#l00202">res_fax.h:202</a></div></div>
<div class="ttc" id="res__fax_8c_html_a6804dd46bef333503315e1e71db009cf"><div class="ttname"><a href="../../d0/d60/res__fax_8c.html#a6804dd46bef333503315e1e71db009cf">fax_session_tab_complete</a></div><div class="ttdeci">static char * fax_session_tab_complete(struct ast_cli_args *a)</div><div class="ttdoc">fax session tab completion </div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d60/res__fax_8c_source.html#l03943">res_fax.c:3943</a></div></div>
<div class="ttc" id="include_2asterisk_2frame_8h_html_a3a510e4e2673c6870ed5fe0f1eb53732"><div class="ttname"><a href="../../d6/d66/include_2asterisk_2frame_8h.html#a3a510e4e2673c6870ed5fe0f1eb53732">AST_MODEM_T38</a></div><div class="ttdeci">#define AST_MODEM_T38</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d66/include_2asterisk_2frame_8h_source.html#l00241">include/asterisk/frame.h:241</a></div></div>
<div class="ttc" id="structast__fax__debug__info_html_a223334851a9df6368db714953c25990e"><div class="ttname"><a href="../../d3/d84/structast__fax__debug__info.html#a223334851a9df6368db714953c25990e">ast_fax_debug_info::base_tv</a></div><div class="ttdeci">struct timeval base_tv</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d60/res__fax_8c_source.html#l00438">res_fax.c:438</a></div></div>
<div class="ttc" id="res__fax_8c_html_aae683f9221ef32fd1fdc2f52e94857e0"><div class="ttname"><a href="../../d0/d60/res__fax_8c.html#aae683f9221ef32fd1fdc2f52e94857e0">debug_check_frame_for_silence</a></div><div class="ttdeci">static void debug_check_frame_for_silence(struct ast_fax_session *s, unsigned int c2s, struct ast_frame *frame)</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d60/res__fax_8c_source.html#l00577">res_fax.c:577</a></div></div>
<div class="ttc" id="structfax__detect_html_ab9deccb020b39c3f7ac94b1af99cac5d"><div class="ttname"><a href="../../da/df6/structfax__detect.html#ab9deccb020b39c3f7ac94b1af99cac5d">fax_detect::dsp</a></div><div class="ttdeci">struct ast_dsp * dsp</div><div class="ttdoc">DSP Processor. </div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d60/res__fax_8c_source.html#l00473">res_fax.c:473</a></div></div>
<div class="ttc" id="structast__frame_html"><div class="ttname"><a href="../../d0/d99/structast__frame.html">ast_frame</a></div><div class="ttdoc">Data structure associated with a single frame of data. </div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d66/include_2asterisk_2frame_8h_source.html#l00165">include/asterisk/frame.h:165</a></div></div>
<div class="ttc" id="structast__fax__t38__parameters_html_ad39f48f545d7c8962dfa0ae83a61c21f"><div class="ttname"><a href="../../d3/df6/structast__fax__t38__parameters.html#ad39f48f545d7c8962dfa0ae83a61c21f">ast_fax_t38_parameters::rate_management</a></div><div class="ttdeci">enum ast_control_t38_rate_management rate_management</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d6a/res__fax_8h_source.html#l00096">res_fax.h:96</a></div></div>
<div class="ttc" id="res__fax_8c_html_a3c172ffb404f992210517ac86cfc7a1a"><div class="ttname"><a href="../../d0/d60/res__fax_8c.html#a3c172ffb404f992210517ac86cfc7a1a">cli_fax_show_settings</a></div><div class="ttdeci">static char * cli_fax_show_settings(struct ast_cli_entry *e, int cmd, struct ast_cli_args *a)</div><div class="ttdoc">display global defaults and settings </div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d60/res__fax_8c_source.html#l04068">res_fax.c:4068</a></div></div>
<div class="ttc" id="structast__fax__session__details_html_ad75375cdd336e91cbcee4a829fcdabfe"><div class="ttname"><a href="../../d8/dc2/structast__fax__session__details.html#ad75375cdd336e91cbcee4a829fcdabfe">ast_fax_session_details::caps</a></div><div class="ttdeci">enum ast_fax_capabilities caps</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d6a/res__fax_8h_source.html#l00113">res_fax.h:113</a></div></div>
<div class="ttc" id="structast__fax__session_html_a2e10a6e79b985bcf3fe9aef1c176f0a1"><div class="ttname"><a href="../../d1/d16/structast__fax__session.html#a2e10a6e79b985bcf3fe9aef1c176f0a1">ast_fax_session::chan_uniqueid</a></div><div class="ttdeci">char * chan_uniqueid</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d6a/res__fax_8h_source.html#l00222">res_fax.h:222</a></div></div>
<div class="ttc" id="res__fax_8c_html_aa1e6a64120757501a2e6a1a076e070ff"><div class="ttname"><a href="../../d0/d60/res__fax_8c.html#aa1e6a64120757501a2e6a1a076e070ff">ast_fax_tech_register</a></div><div class="ttdeci">int ast_fax_tech_register(struct ast_fax_tech *tech)</div><div class="ttdoc">register a FAX technology module </div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d60/res__fax_8c_source.html#l00974">res_fax.c:974</a></div></div>
<div class="ttc" id="structast__json_html"><div class="ttname"><a href="../../d1/da1/structast__json.html">ast_json</a></div><div class="ttdoc">Abstract JSON element (object, array, string, int, ...). </div></div>
<div class="ttc" id="indications_8h_html_a544e8a1dd4a986b00754103dda6a7d3b"><div class="ttname"><a href="../../d2/d0f/indications_8h.html#a544e8a1dd4a986b00754103dda6a7d3b">ast_playtones_start</a></div><div class="ttdeci">int ast_playtones_start(struct ast_channel *chan, int vol, const char *tonelist, int interruptible)</div><div class="ttdoc">Start playing a list of tones on a channel. </div><div class="ttdef"><b>Definition:</b> <a href="../../df/d6e/indications_8c_source.html#l00302">indications.c:302</a></div></div>
<div class="ttc" id="structast__fax__session_html_a19aa04db5508cf9496602e694dc69e2f"><div class="ttname"><a href="../../d1/d16/structast__fax__session.html#a19aa04db5508cf9496602e694dc69e2f">ast_fax_session::tech_pvt</a></div><div class="ttdeci">void * tech_pvt</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d6a/res__fax_8h_source.html#l00216">res_fax.h:216</a></div></div>
<div class="ttc" id="structast__cli__args_html"><div class="ttname"><a href="../../d3/dad/structast__cli__args.html">ast_cli_args</a></div><div class="ttdef"><b>Definition:</b> <a href="../../dc/db0/cli_8h_source.html#l00158">cli.h:158</a></div></div>
<div class="ttc" id="options_8h_html"><div class="ttname"><a href="../../d7/d5b/options_8h.html">options.h</a></div><div class="ttdoc">Options provided by main asterisk program. </div></div>
<div class="ttc" id="structast__fax__tech_html_a7014a7b1d150a523cf1273e6fee5bdd6"><div class="ttname"><a href="../../d9/d0e/structast__fax__tech.html#a7014a7b1d150a523cf1273e6fee5bdd6">ast_fax_tech::write</a></div><div class="ttdeci">int(*const write)(struct ast_fax_session *, const struct ast_frame *)</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d6a/res__fax_8h_source.html#l00257">res_fax.h:257</a></div></div>
<div class="ttc" id="dsp_8h_html_aa97125e8415ed15db98bb7e79b17ab73"><div class="ttname"><a href="../../d3/d08/dsp_8h.html#aa97125e8415ed15db98bb7e79b17ab73">DSP_FAXMODE_DETECT_CNG</a></div><div class="ttdeci">#define DSP_FAXMODE_DETECT_CNG</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d08/dsp_8h_source.html#l00047">dsp.h:47</a></div></div>
<div class="ttc" id="res__fax_8c_html_affb9d2b3b67e36e7e7ad9b4055de7630"><div class="ttname"><a href="../../d0/d60/res__fax_8c.html#affb9d2b3b67e36e7e7ad9b4055de7630">RES_FAX_TIMEOUT</a></div><div class="ttdeci">#define RES_FAX_TIMEOUT</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d60/res__fax_8c_source.html#l00492">res_fax.c:492</a></div></div>
<div class="ttc" id="structentry_html"><div class="ttname"><a href="../../d3/d96/structentry.html">entry</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d85/search_8h_source.html#l00040">search.h:40</a></div></div>
<div class="ttc" id="channel_8h_html_a582dee4d5ea9b2ff6f309f0c5239f6bd"><div class="ttname"><a href="../../d5/d7b/channel_8h.html#a582dee4d5ea9b2ff6f309f0c5239f6bd">ast_channel_context</a></div><div class="ttdeci">const char * ast_channel_context(const struct ast_channel *chan)</div><div class="ttdef"><b>Definition:</b> <a href="../../db/de2/channel__internal__api_8c_source.html#l00344">channel_internal_api.c:344</a></div></div>
<div class="ttc" id="utils_2frame_8c_html_a4a9391ee88e57361b613c4c2fd2bf4aa"><div class="ttname"><a href="../../d6/d47/utils_2frame_8c.html#a4a9391ee88e57361b613c4c2fd2bf4aa">error</a></div><div class="ttdeci">int error(const char *format,...)</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d47/utils_2frame_8c_source.html#l00999">utils/frame.c:999</a></div></div>
<div class="ttc" id="time_8h_html_aa13b651c18bc6004cab21ac041d44dd8"><div class="ttname"><a href="../../de/df7/time_8h.html#aa13b651c18bc6004cab21ac041d44dd8">ast_tvsub</a></div><div class="ttdeci">struct timeval ast_tvsub(struct timeval a, struct timeval b)</div><div class="ttdoc">Returns the difference of two timevals a - b. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/dc5/extconf_8c_source.html#l02298">extconf.c:2298</a></div></div>
<div class="ttc" id="res__fax_8c_html_a9310358a6223a275dce64548ab625062"><div class="ttname"><a href="../../d0/d60/res__fax_8c.html#a9310358a6223a275dce64548ab625062">ast_fax_modem_to_str</a></div><div class="ttdeci">static int ast_fax_modem_to_str(enum ast_fax_modems bits, char *tbuf, size_t bufsize)</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d60/res__fax_8c_source.html#l00905">res_fax.c:905</a></div></div>
<div class="ttc" id="structast__fax__session__details_html_a8e155783a5296f8607948dfbe5783933"><div class="ttname"><a href="../../d8/dc2/structast__fax__session__details.html#a8e155783a5296f8607948dfbe5783933">ast_fax_session_details::resultstr</a></div><div class="ttdeci">const ast_string_field resultstr</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d6a/res__fax_8h_source.html#l00142">res_fax.h:142</a></div></div>
<div class="ttc" id="datastore_8h_html_a666afb07fd77d50782cc10f83e029159"><div class="ttname"><a href="../../d9/db6/datastore_8h.html#a666afb07fd77d50782cc10f83e029159">ast_datastore_alloc</a></div><div class="ttdeci">#define ast_datastore_alloc(info, uid)</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/db6/datastore_8h_source.html#l00089">datastore.h:89</a></div></div>
<div class="ttc" id="structast__frame_html_a4027905f872af30d910929b07e261ca5"><div class="ttname"><a href="../../d0/d99/structast__frame.html#a4027905f872af30d910929b07e261ca5">ast_frame::data</a></div><div class="ttdeci">union ast_frame::@263 data</div></div>
<div class="ttc" id="res__fax_8c_html_a46275621a3d3846d089a092249fb8c37a2ffdf9172bc4ad9ae1ee477d90078ef0"><div class="ttname"><a href="../../d0/d60/res__fax_8c.html#a46275621a3d3846d089a092249fb8c37a2ffdf9172bc4ad9ae1ee477d90078ef0">OPT_CALLEDMODE</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d60/res__fax_8c_source.html#l00558">res_fax.c:558</a></div></div>
<div class="ttc" id="structast__frame_html_a6937b93c56cb473b547eda454dca7b4c"><div class="ttname"><a href="../../d0/d99/structast__frame.html#a6937b93c56cb473b547eda454dca7b4c">ast_frame::frametype</a></div><div class="ttdeci">enum ast_frame_type frametype</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d66/include_2asterisk_2frame_8h_source.html#l00167">include/asterisk/frame.h:167</a></div></div>
<div class="ttc" id="structast__fax__session__details_html_a045d24c59f1a8a85e8fbc745fff88140"><div class="ttname"><a href="../../d8/dc2/structast__fax__session__details.html#a045d24c59f1a8a85e8fbc745fff88140">ast_fax_session_details::localstationid</a></div><div class="ttdeci">const ast_string_field localstationid</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d6a/res__fax_8h_source.html#l00142">res_fax.h:142</a></div></div>
<div class="ttc" id="structast__fax__session__details_html_a975b0a45868387d13867daeac314978a"><div class="ttname"><a href="../../d8/dc2/structast__fax__session__details.html#a975b0a45868387d13867daeac314978a">ast_fax_session_details::maxrate</a></div><div class="ttdeci">unsigned int maxrate</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d6a/res__fax_8h_source.html#l00173">res_fax.h:173</a></div></div>
<div class="ttc" id="structdebug__info__history_html_a99f01a0b4f6b3afa5bf25e98c550bcc1"><div class="ttname"><a href="../../d2/d1c/structdebug__info__history.html#a99f01a0b4f6b3afa5bf25e98c550bcc1">debug_info_history::silence</a></div><div class="ttdeci">unsigned char silence</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d60/res__fax_8c_source.html#l00434">res_fax.c:434</a></div></div>
<div class="ttc" id="structao2__container_html"><div class="ttname"><a href="../../d2/da9/structao2__container.html">ao2_container</a></div><div class="ttdoc">Generic container type. </div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d20/astobj2__container__private_8h_source.html#l00282">astobj2_container_private.h:282</a></div></div>
<div class="ttc" id="res__fax_8c_html_a00b75aa8e0cf805cdf2ad917351e0a1e"><div class="ttname"><a href="../../d0/d60/res__fax_8c.html#a00b75aa8e0cf805cdf2ad917351e0a1e">cli_fax_show_stats</a></div><div class="ttdeci">static char * cli_fax_show_stats(struct ast_cli_entry *e, int cmd, struct ast_cli_args *a)</div><div class="ttdoc">display fax stats </div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d60/res__fax_8c_source.html#l04181">res_fax.c:4181</a></div></div>
<div class="ttc" id="res__fax_8c_html_a70598462f8d1c09bb43e7a7091498e53"><div class="ttname"><a href="../../d0/d60/res__fax_8c.html#a70598462f8d1c09bb43e7a7091498e53">ast_fax_state_to_str</a></div><div class="ttdeci">const char * ast_fax_state_to_str(enum ast_fax_state state)</div><div class="ttdoc">convert a ast_fax_state to a string </div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d60/res__fax_8c_source.html#l01013">res_fax.c:1013</a></div></div>
<div class="ttc" id="test__http__media__cache_8c_html_a80c8e3ae5087d90d422675d034eeebc7"><div class="ttname"><a href="../../d4/d45/test__http__media__cache_8c.html#a80c8e3ae5087d90d422675d034eeebc7">options</a></div><div class="ttdeci">static struct test_options options</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d45/test__http__media__cache_8c_source.html#l00062">test_http_media_cache.c:62</a></div></div>
<div class="ttc" id="include_2asterisk_2app_8h_html_aca036489931bf5571e2472331c8ac80b"><div class="ttname"><a href="../../d3/d93/include_2asterisk_2app_8h.html#aca036489931bf5571e2472331c8ac80b">AST_APP_OPTION</a></div><div class="ttdeci">#define AST_APP_OPTION(option, flagno)</div><div class="ttdoc">Declares an application option that does not accept an argument. </div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d93/include_2asterisk_2app_8h_source.html#l01402">include/asterisk/app.h:1402</a></div></div>
<div class="ttc" id="structast__fax__session__details_html_a9b0934c83ded1da0aa05bd8eb4677f93"><div class="ttname"><a href="../../d8/dc2/structast__fax__session__details.html#a9b0934c83ded1da0aa05bd8eb4677f93">ast_fax_session_details::error</a></div><div class="ttdeci">const ast_string_field error</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d6a/res__fax_8h_source.html#l00142">res_fax.h:142</a></div></div>
<div class="ttc" id="structast__frame__subclass_html_ab425a484a0916077c5a30d9d7b229b44"><div class="ttname"><a href="../../d1/d9f/structast__frame__subclass.html#ab425a484a0916077c5a30d9d7b229b44">ast_frame_subclass::format</a></div><div class="ttdeci">struct ast_format * format</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d66/include_2asterisk_2frame_8h_source.html#l00155">include/asterisk/frame.h:155</a></div></div>
<div class="ttc" id="structast__fax__session__details_html_a6147f275a3ab3a425ab9da2b9d754241"><div class="ttname"><a href="../../d8/dc2/structast__fax__session__details.html#a6147f275a3ab3a425ab9da2b9d754241">ast_fax_session_details::faxdetect_flags</a></div><div class="ttdeci">int faxdetect_flags</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d6a/res__fax_8h_source.html#l00189">res_fax.h:189</a></div></div>
<div class="ttc" id="module_8h_html_a155a0df9c59e04e305d4a2fa3e35f843a835b27a90d895a488e4e14cc3d2dee8c"><div class="ttname"><a href="../../d5/d16/module_8h.html#a155a0df9c59e04e305d4a2fa3e35f843a835b27a90d895a488e4e14cc3d2dee8c">AST_MODFLAG_GLOBAL_SYMBOLS</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d16/module_8h_source.html#l00316">module.h:316</a></div></div>
<div class="ttc" id="res__fax_8c_html_ae3fd81a0a9b66a52b821e2a795395000"><div class="ttname"><a href="../../d0/d60/res__fax_8c.html#ae3fd81a0a9b66a52b821e2a795395000">nextsessionname</a></div><div class="ttdeci">int nextsessionname</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d60/res__fax_8c_source.html#l00512">res_fax.c:512</a></div></div>
<div class="ttc" id="module_8h_html_aa4f734041ffd9d75b07cefb0291e1e58a08d902290b0d6cbffd8e607d5e399a06"><div class="ttname"><a href="../../d5/d16/module_8h.html#aa4f734041ffd9d75b07cefb0291e1e58a08d902290b0d6cbffd8e607d5e399a06">AST_MODPRI_APP_DEPEND</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d16/module_8h_source.html#l00328">module.h:328</a></div></div>
<div class="ttc" id="channel_8h_html_adf593d68a333075c1fcae8a73b68c069"><div class="ttname"><a href="../../d5/d7b/channel_8h.html#adf593d68a333075c1fcae8a73b68c069">ast_channel_macrocontext</a></div><div class="ttdeci">const char * ast_channel_macrocontext(const struct ast_channel *chan)</div><div class="ttdef"><b>Definition:</b> <a href="../../db/de2/channel__internal__api_8c_source.html#l00362">channel_internal_api.c:362</a></div></div>
<div class="ttc" id="res__fax_8h_html_a1838c71fcf68c3cfe0ce37e35e77406daa2151729c413238bea86a4b62e7865bd"><div class="ttname"><a href="../../db/d6a/res__fax_8h.html#a1838c71fcf68c3cfe0ce37e35e77406daa2151729c413238bea86a4b62e7865bd">AST_FAX_OPTFLAG_FALSE</a></div><div class="ttdef"><b>Definition:</b> <a href="../../db/d6a/res__fax_8h_source.html#l00085">res_fax.h:85</a></div></div>
<div class="ttc" id="res__fax_8c_html_a46275621a3d3846d089a092249fb8c37ae18c66c85f5c325308846289886981d7"><div class="ttname"><a href="../../d0/d60/res__fax_8c.html#a46275621a3d3846d089a092249fb8c37ae18c66c85f5c325308846289886981d7">OPT_DEBUG</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d60/res__fax_8c_source.html#l00560">res_fax.c:560</a></div></div>
<div class="ttc" id="manager_8h_html_a5b63b8a8faede2d852e071e1f7b31c11"><div class="ttname"><a href="../../db/d45/manager_8h.html#a5b63b8a8faede2d852e071e1f7b31c11">ast_manager_register_xml</a></div><div class="ttdeci">#define ast_manager_register_xml(action, authority, func)</div><div class="ttdoc">Register a manager callback using XML documentation to describe the manager. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/d45/manager_8h_source.html#l00186">manager.h:186</a></div></div>
<div class="ttc" id="structfax__gateway_html_a23b38dad7025290be3461b4b3208b4e6"><div class="ttname"><a href="../../dd/dd2/structfax__gateway.html#a23b38dad7025290be3461b4b3208b4e6">fax_gateway::timeout_start</a></div><div class="ttdeci">struct timeval timeout_start</div><div class="ttdoc">the start of our timeout counter </div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d60/res__fax_8c_source.html#l00452">res_fax.c:452</a></div></div>
<div class="ttc" id="module_8h_html_aba2c8d4be709a254658b21a834f8294a"><div class="ttname"><a href="../../d5/d16/module_8h.html#aba2c8d4be709a254658b21a834f8294a">ASTERISK_GPL_KEY</a></div><div class="ttdeci">#define ASTERISK_GPL_KEY</div><div class="ttdoc">The text the key() function should return. </div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d16/module_8h_source.html#l00046">module.h:46</a></div></div>
<div class="ttc" id="structast__fax__tech_html_a654cf082cf4abd8495abb41ab70a77df"><div class="ttname"><a href="../../d9/d0e/structast__fax__tech.html#a654cf082cf4abd8495abb41ab70a77df">ast_fax_tech::cli_show_capabilities</a></div><div class="ttdeci">char *(*const cli_show_capabilities)(int)</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d6a/res__fax_8h_source.html#l00267">res_fax.h:267</a></div></div>
<div class="ttc" id="cli_8h_html_a7cc1753a05a0821f6c70dd2bccfbab5c"><div class="ttname"><a href="../../dc/db0/cli_8h.html#a7cc1753a05a0821f6c70dd2bccfbab5c">RESULT_SUCCESS</a></div><div class="ttdeci">#define RESULT_SUCCESS</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/db0/cli_8h_source.html#l00040">cli.h:40</a></div></div>
<div class="ttc" id="res__fax_8c_html_ae6ba3a7d00a9db8c29509bda24c233f1"><div class="ttname"><a href="../../d0/d60/res__fax_8c.html#ae6ba3a7d00a9db8c29509bda24c233f1">fax_cli</a></div><div class="ttdeci">static struct ast_cli_entry fax_cli[]</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d60/res__fax_8c_source.html#l04380">res_fax.c:4380</a></div></div>
<div class="ttc" id="format__cache_8h_html_a771d7c34570e8e492c25a0c2eb41889d"><div class="ttname"><a href="../../db/d1c/format__cache_8h.html#a771d7c34570e8e492c25a0c2eb41889d">ast_format_slin</a></div><div class="ttdeci">struct ast_format * ast_format_slin</div><div class="ttdoc">Built-in cached signed linear 8kHz format. </div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d29/format__cache_8c_source.html#l00041">format_cache.c:41</a></div></div>
<div class="ttc" id="res__fax_8c_html_a4ca79c149a1ff5fdc17dbce18e8371f8"><div class="ttname"><a href="../../d0/d60/res__fax_8c.html#a4ca79c149a1ff5fdc17dbce18e8371f8">default_options</a></div><div class="ttdeci">static const struct fax_options default_options</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d60/res__fax_8c_source.html#l00539">res_fax.c:539</a></div></div>
<div class="ttc" id="structast__fax__tech_html_a020b7b790b06e12b73b1ca66d1eda3e7"><div class="ttname"><a href="../../d9/d0e/structast__fax__tech.html#a020b7b790b06e12b73b1ca66d1eda3e7">ast_fax_tech::start_session</a></div><div class="ttdeci">int(*const start_session)(struct ast_fax_session *)</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d6a/res__fax_8h_source.html#l00259">res_fax.h:259</a></div></div>
<div class="ttc" id="structast__fax__tech_html_a223cb9747d79114e3d087507f06cfdbd"><div class="ttname"><a href="../../d9/d0e/structast__fax__tech.html#a223cb9747d79114e3d087507f06cfdbd">ast_fax_tech::cli_show_settings</a></div><div class="ttdeci">char *(*const cli_show_settings)(int)</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d6a/res__fax_8h_source.html#l00276">res_fax.h:276</a></div></div>
<div class="ttc" id="res__fax_8c_html_a9612f65fe4e81e83a12136c6b9e89553"><div class="ttname"><a href="../../d0/d60/res__fax_8c.html#a9612f65fe4e81e83a12136c6b9e89553">FAX_DETECT_MODE_T38</a></div><div class="ttdeci">#define FAX_DETECT_MODE_T38</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d60/res__fax_8c_source.html#l00484">res_fax.c:484</a></div></div>
<div class="ttc" id="group__Group__AMI_html_ga31a02a7d3cc36aa66ebebdedfc574d1c"><div class="ttname"><a href="../../df/d72/group__Group__AMI.html#ga31a02a7d3cc36aa66ebebdedfc574d1c">astman_send_error</a></div><div class="ttdeci">void astman_send_error(struct mansession *s, const struct message *m, char *error)</div><div class="ttdoc">Send error in manager transaction. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d10/manager_8c_source.html#l03159">manager.c:3159</a></div></div>
<div class="ttc" id="module_8h_html"><div class="ttname"><a href="../../d5/d16/module_8h.html">module.h</a></div><div class="ttdoc">Asterisk module definitions. </div></div>
<div class="ttc" id="channel_8h_html_a1dc625bd14a7875b04bfe0c388858929"><div class="ttname"><a href="../../d5/d7b/channel_8h.html#a1dc625bd14a7875b04bfe0c388858929">ast_channel_writeformat</a></div><div class="ttdeci">struct ast_format * ast_channel_writeformat(struct ast_channel *chan)</div><div class="ttdef"><b>Definition:</b> <a href="../../db/de2/channel__internal__api_8c_source.html#l00860">channel_internal_api.c:860</a></div></div>
<div class="ttc" id="structast__fax__debug__info_html_a16b8f82ab064d3b55a11bc9059805bf5"><div class="ttname"><a href="../../d3/d84/structast__fax__debug__info.html#a16b8f82ab064d3b55a11bc9059805bf5">ast_fax_debug_info::s2c</a></div><div class="ttdeci">struct debug_info_history c2s s2c</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d60/res__fax_8c_source.html#l00439">res_fax.c:439</a></div></div>
<div class="ttc" id="structast__fax__t38__parameters_html_addb721c952a7144f0a6a9ac5f621d2bc"><div class="ttname"><a href="../../d3/df6/structast__fax__t38__parameters.html#addb721c952a7144f0a6a9ac5f621d2bc">ast_fax_t38_parameters::fill_bit_removal</a></div><div class="ttdeci">unsigned int fill_bit_removal</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d6a/res__fax_8h_source.html#l00097">res_fax.h:97</a></div></div>
<div class="ttc" id="res__fax_8c_html_aa3abd8d044003f1086e5b07a357f82fb"><div class="ttname"><a href="../../d0/d60/res__fax_8c.html#aa3abd8d044003f1086e5b07a357f82fb">cli_fax_show_capabilities</a></div><div class="ttdeci">static char * cli_fax_show_capabilities(struct ast_cli_entry *e, int cmd, struct ast_cli_args *a)</div><div class="ttdoc">display registered FAX capabilities </div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d60/res__fax_8c_source.html#l04038">res_fax.c:4038</a></div></div>
<div class="ttc" id="structast__fax__session__details_html_a12cc2bfdcc88e94984d001cca6fefdc5"><div class="ttname"><a href="../../d8/dc2/structast__fax__session__details.html#a12cc2bfdcc88e94984d001cca6fefdc5">ast_fax_session_details::their_t38_parameters</a></div><div class="ttdeci">struct ast_fax_t38_parameters their_t38_parameters</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d6a/res__fax_8h_source.html#l00177">res_fax.h:177</a></div></div>
<div class="ttc" id="res__fax_8c_html_a543460599793e883a0b4d4a99c639722"><div class="ttname"><a href="../../d0/d60/res__fax_8c.html#a543460599793e883a0b4d4a99c639722">RES_FAX_MODEM</a></div><div class="ttdeci">#define RES_FAX_MODEM</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d60/res__fax_8c_source.html#l00525">res_fax.c:525</a></div></div>
<div class="ttc" id="group__StasisTopicsAndMessages_html_ga6d11307e605e80f977bde354a11d7902"><div class="ttname"><a href="../../df/deb/group__StasisTopicsAndMessages.html#ga6d11307e605e80f977bde354a11d7902">ast_channel_fax_type</a></div><div class="ttdeci">struct stasis_message_type * ast_channel_fax_type(void)</div><div class="ttdoc">Message type for a fax operation. </div></div>
<div class="ttc" id="res__fax_8c_html_ac4e0560b06c338fc643710d3dc6bc6f7"><div class="ttname"><a href="../../d0/d60/res__fax_8c.html#ac4e0560b06c338fc643710d3dc6bc6f7">sendfax_t38_init</a></div><div class="ttdeci">static int sendfax_t38_init(struct ast_channel *chan, struct ast_fax_session_details *details)</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d60/res__fax_8c_source.html#l02283">res_fax.c:2283</a></div></div>
<div class="ttc" id="channel_8h_html_a1ed3e98d33d5587948a0e2ef67a81f52"><div class="ttname"><a href="../../d5/d7b/channel_8h.html#a1ed3e98d33d5587948a0e2ef67a81f52">ast_channel_datastore_add</a></div><div class="ttdeci">int ast_channel_datastore_add(struct ast_channel *chan, struct ast_datastore *datastore)</div><div class="ttdoc">Add a datastore to a channel. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d28/channel_8c_source.html#l02390">channel.c:2390</a></div></div>
<div class="ttc" id="include_2asterisk_2app_8h_html_a80cd3f6f786b59b742bcecfc0b3be7c2"><div class="ttname"><a href="../../d3/d93/include_2asterisk_2app_8h.html#a80cd3f6f786b59b742bcecfc0b3be7c2">AST_DECLARE_APP_ARGS</a></div><div class="ttdeci">#define AST_DECLARE_APP_ARGS(name, arglist)</div><div class="ttdoc">Declare a structure to hold an application&amp;#39;s arguments. </div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d93/include_2asterisk_2app_8h_source.html#l01249">include/asterisk/app.h:1249</a></div></div>
<div class="ttc" id="stringfields_8h_html_abf60f862ae6a141d2f86a0f5e82792de"><div class="ttname"><a href="../../d1/d0f/stringfields_8h.html#abf60f862ae6a141d2f86a0f5e82792de">ast_string_field_free_memory</a></div><div class="ttdeci">#define ast_string_field_free_memory(x)</div><div class="ttdoc">free all memory - to be called before destroying the object </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d0f/stringfields_8h_source.html#l00368">stringfields.h:368</a></div></div>
<div class="ttc" id="include_2asterisk_2app_8h_html"><div class="ttname"><a href="../../d3/d93/include_2asterisk_2app_8h.html">app.h</a></div><div class="ttdoc">Application convenience functions, designed to give consistent look and feel to Asterisk apps...</div></div>
<div class="ttc" id="json_8h_html_ac319d5898e86709f7e25b1b2d73b7b12"><div class="ttname"><a href="../../d4/d05/json_8h.html#ac319d5898e86709f7e25b1b2d73b7b12">AST_JSON_UTF8_VALIDATE</a></div><div class="ttdeci">#define AST_JSON_UTF8_VALIDATE(str)</div><div class="ttdoc">Check str for UTF-8 and replace with an empty string if fails the check. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d05/json_8h_source.html#l00224">json.h:224</a></div></div>
<div class="ttc" id="res__fax_8h_html_ab34810136037068a0847bcca2518112cad2e2632aa1b6333fcd0e89c554d0df54"><div class="ttname"><a href="../../db/d6a/res__fax_8h.html#ab34810136037068a0847bcca2518112cad2e2632aa1b6333fcd0e89c554d0df54">AST_FAX_STATE_UNINITIALIZED</a></div><div class="ttdef"><b>Definition:</b> <a href="../../db/d6a/res__fax_8h_source.html#l00067">res_fax.h:67</a></div></div>
<div class="ttc" id="res__fax_8c_html_ab7db9bae692cd3e60f2413df1e0e978a"><div class="ttname"><a href="../../d0/d60/res__fax_8c.html#ab7db9bae692cd3e60f2413df1e0e978a">RES_FAX_T38TIMEOUT</a></div><div class="ttdeci">#define RES_FAX_T38TIMEOUT</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d60/res__fax_8c_source.html#l00526">res_fax.c:526</a></div></div>
<div class="ttc" id="astobj2_8h_html_a91d5d37d00874ae7a92d1a15c0a3b3a6"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#a91d5d37d00874ae7a92d1a15c0a3b3a6">ao2_iterator_init</a></div><div class="ttdeci">struct ao2_iterator ao2_iterator_init(struct ao2_container *c, int flags) attribute_warn_unused_result</div><div class="ttdoc">Create an iterator for a container. </div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d22/astobj2__container_8c_source.html#l00485">astobj2_container.c:485</a></div></div>
<div class="ttc" id="structast__fax__session__details_html_ac832ac88c8237d922dfeba836a8d77ce"><div class="ttname"><a href="../../d8/dc2/structast__fax__session__details.html#ac832ac88c8237d922dfeba836a8d77ce">ast_fax_session_details::resolution</a></div><div class="ttdeci">const ast_string_field resolution</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d6a/res__fax_8h_source.html#l00142">res_fax.h:142</a></div></div>
<div class="ttc" id="channel_8h_html_a1ff1c62b6d50823da93a920575c9c0c9"><div class="ttname"><a href="../../d5/d7b/channel_8h.html#a1ff1c62b6d50823da93a920575c9c0c9">ast_channel_datastore_remove</a></div><div class="ttdeci">int ast_channel_datastore_remove(struct ast_channel *chan, struct ast_datastore *datastore)</div><div class="ttdoc">Remove a datastore from a channel. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d28/channel_8c_source.html#l02399">channel.c:2399</a></div></div>
<div class="ttc" id="pbx_8h_html_a8af0e93442a9e468425f63cc52b0ac7b"><div class="ttname"><a href="../../db/de0/pbx_8h.html#a8af0e93442a9e468425f63cc52b0ac7b">ast_custom_function_register</a></div><div class="ttdeci">#define ast_custom_function_register(acf)</div><div class="ttdoc">Register a custom function. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/de0/pbx_8h_source.html#l01508">pbx.h:1508</a></div></div>
<div class="ttc" id="linkedlists_8h_html_a6bf0e81cb6ef01532ddebaba68f6de28"><div class="ttname"><a href="../../df/d90/linkedlists_8h.html#a6bf0e81cb6ef01532ddebaba68f6de28">AST_RWLIST_TRAVERSE_SAFE_END</a></div><div class="ttdeci">#define AST_RWLIST_TRAVERSE_SAFE_END</div><div class="ttdef"><b>Definition:</b> <a href="../../df/d90/linkedlists_8h_source.html#l00616">linkedlists.h:616</a></div></div>
<div class="ttc" id="structfax__gateway_html_a08eb33d553223ed90af3397a850b3af1"><div class="ttname"><a href="../../dd/dd2/structfax__gateway.html#a08eb33d553223ed90af3397a850b3af1">fax_gateway::peer_v21_session</a></div><div class="ttdeci">struct ast_fax_session * peer_v21_session</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d60/res__fax_8c_source.html#l00447">res_fax.c:447</a></div></div>
<div class="ttc" id="module_8h_html_afba4eb7a910b10969041ae4cd488729d"><div class="ttname"><a href="../../d5/d16/module_8h.html#afba4eb7a910b10969041ae4cd488729d">ast_register_application_xml</a></div><div class="ttdeci">#define ast_register_application_xml(app, execute)</div><div class="ttdoc">Register an application using XML documentation. </div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d16/module_8h_source.html#l00626">module.h:626</a></div></div>
<div class="ttc" id="res__fax_8c_html_a529256c8c5467cc6a5012d9c270b2295"><div class="ttname"><a href="../../d0/d60/res__fax_8c.html#a529256c8c5467cc6a5012d9c270b2295">acf_faxopt</a></div><div class="ttdeci">struct ast_custom_function acf_faxopt</div><div class="ttdoc">FAXOPT dialplan function. </div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d60/res__fax_8c_source.html#l04742">res_fax.c:4742</a></div></div>
<div class="ttc" id="structast__fax__session__details_html_aa3cf325797b2746fbd79f34b2fd45370"><div class="ttname"><a href="../../d8/dc2/structast__fax__session__details.html#aa3cf325797b2746fbd79f34b2fd45370">ast_fax_session_details::is_t38_negotiated</a></div><div class="ttdeci">int is_t38_negotiated</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d6a/res__fax_8h_source.html#l00191">res_fax.h:191</a></div></div>
<div class="ttc" id="structast__fax__session__details_html_a40311ef8f9bd5a1a7d7bf32f3b019148"><div class="ttname"><a href="../../d8/dc2/structast__fax__session__details.html#a40311ef8f9bd5a1a7d7bf32f3b019148">ast_fax_session_details::negotiate_both</a></div><div class="ttdeci">int negotiate_both</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d6a/res__fax_8h_source.html#l00194">res_fax.h:194</a></div></div>
<div class="ttc" id="res__fax_8c_html_a23c423fff7dbf2e50800db8be4ae26ed"><div class="ttname"><a href="../../d0/d60/res__fax_8c.html#a23c423fff7dbf2e50800db8be4ae26ed">FAX_DETECT_MODE_BOTH</a></div><div class="ttdeci">#define FAX_DETECT_MODE_BOTH</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d60/res__fax_8c_source.html#l00485">res_fax.c:485</a></div></div>
<div class="ttc" id="app__jack_8c_html_ac191e5810fa65e63095409471eb5648f"><div class="ttname"><a href="../../de/dcd/app__jack_8c.html#ac191e5810fa65e63095409471eb5648f">status</a></div><div class="ttdeci">jack_status_t status</div><div class="ttdef"><b>Definition:</b> <a href="../../de/dcd/app__jack_8c_source.html#l00146">app_jack.c:146</a></div></div>
<div class="ttc" id="structast__frame_html_a37672e6b906143604cefd3e959777b31"><div class="ttname"><a href="../../d0/d99/structast__frame.html#a37672e6b906143604cefd3e959777b31">ast_frame::samples</a></div><div class="ttdeci">int samples</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d66/include_2asterisk_2frame_8h_source.html#l00173">include/asterisk/frame.h:173</a></div></div>
<div class="ttc" id="format__cache_8h_html"><div class="ttname"><a href="../../db/d1c/format__cache_8h.html">format_cache.h</a></div><div class="ttdoc">Media Format Cache API. </div></div>
<div class="ttc" id="res__fax_8c_html_aea322d9ee9a565a0f53e6fa1f1f34e66"><div class="ttname"><a href="../../d0/d60/res__fax_8c.html#aea322d9ee9a565a0f53e6fa1f1f34e66">generate_filenames_string</a></div><div class="ttdeci">static char * generate_filenames_string(struct ast_fax_session_details *details, char *prefix, char *separator)</div><div class="ttdoc">Generate a string of filenames using the given prefix and separator. </div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d60/res__fax_8c_source.html#l01370">res_fax.c:1370</a></div></div>
<div class="ttc" id="http_8c_html_a6f25bc812d09fedb86bf394c01061c56"><div class="ttname"><a href="../../dd/d43/http_8c.html#a6f25bc812d09fedb86bf394c01061c56">prefix</a></div><div class="ttdeci">static char prefix[MAX_PREFIX]</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d43/http_8c_source.html#l00141">http.c:141</a></div></div>
<div class="ttc" id="include_2asterisk_2app_8h_html_a037e9a5b28477b17e7c9acbe7ecb21d5"><div class="ttname"><a href="../../d3/d93/include_2asterisk_2app_8h.html#a037e9a5b28477b17e7c9acbe7ecb21d5">AST_APP_ARG</a></div><div class="ttdeci">#define AST_APP_ARG(name)</div><div class="ttdoc">Define an application argument. </div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d93/include_2asterisk_2app_8h_source.html#l01232">include/asterisk/app.h:1232</a></div></div>
<div class="ttc" id="stringfields_8h_html_a653461abd6e0d16e4e3326ab90e0501d"><div class="ttname"><a href="../../d1/d0f/stringfields_8h.html#a653461abd6e0d16e4e3326ab90e0501d">ast_string_field_set</a></div><div class="ttdeci">#define ast_string_field_set(x, field, data)</div><div class="ttdoc">Set a field to a simple string value. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d0f/stringfields_8h_source.html#l00514">stringfields.h:514</a></div></div>
<div class="ttc" id="include_2asterisk_2config_8h_html_a103e76ed4bd42f776f7f260080b98b3fafa887389dc380bbdcffb65fec379f037"><div class="ttname"><a href="../../d3/de6/include_2asterisk_2config_8h.html#a103e76ed4bd42f776f7f260080b98b3fafa887389dc380bbdcffb65fec379f037">CONFIG_FLAG_FILEUNCHANGED</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d3/de6/include_2asterisk_2config_8h_source.html#l00043">include/asterisk/config.h:43</a></div></div>
<div class="ttc" id="group__Group__AMI_html_ga0ee6ee1f4d200f711e2983bffe770a72"><div class="ttname"><a href="../../df/d72/group__Group__AMI.html#ga0ee6ee1f4d200f711e2983bffe770a72">astman_send_listack</a></div><div class="ttdeci">void astman_send_listack(struct mansession *s, const struct message *m, char *msg, char *listflag)</div><div class="ttdoc">Send ack in manager transaction to begin a list. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d10/manager_8c_source.html#l03201">manager.c:3201</a></div></div>
<div class="ttc" id="test__linkedlists_8c_html_a13dd15487fee89a002d17ef3aff62d02"><div class="ttname"><a href="../../d7/d6f/test__linkedlists_8c.html#a13dd15487fee89a002d17ef3aff62d02">a</a></div><div class="ttdeci">static struct test_val a</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d6f/test__linkedlists_8c_source.html#l00046">test_linkedlists.c:46</a></div></div>
<div class="ttc" id="res__fax_8c_html_aa4691aa21eb58ad524c6418d9f252b7d"><div class="ttname"><a href="../../d0/d60/res__fax_8c.html#aa4691aa21eb58ad524c6418d9f252b7d">get_general_options</a></div><div class="ttdeci">static void get_general_options(struct fax_options *options)</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d60/res__fax_8c_source.html#l04397">res_fax.c:4397</a></div></div>
<div class="ttc" id="astobj2_8h_html_a1ad9f122bcae95a470639402faa3d2ee"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#a1ad9f122bcae95a470639402faa3d2ee">ao2_link</a></div><div class="ttdeci">#define ao2_link(container, obj)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l01549">astobj2.h:1549</a></div></div>
</div><!-- fragment --></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Sun Aug 8 2021 19:44:01 for Asterisk - The Open Source Telephony Project by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="../../doxygen.png" alt="doxygen"/>
</a> 1.8.13
</small></address>
</body>
</html>
