<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Asterisk - The Open Source Telephony Project: refstats Namespace Reference</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Asterisk - The Open Source Telephony Project
   &#160;<span id="projectnumber">18.5.0</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "../../search",false,'Search');
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('../../',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">refstats Namespace Reference</div>  </div>
</div><!--header-->
<div class="contents">
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a107e683a7dc23a01f565e9d6ed9f8a8f"><td class="memItemLeft" align="right" valign="top">def&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d0/d6f/namespacerefstats.html#a107e683a7dc23a01f565e9d6ed9f8a8f">create_stats</a> ()</td></tr>
<tr class="separator:a107e683a7dc23a01f565e9d6ed9f8a8f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a79d1c02a7521dfb7070de07b72b841f4"><td class="memItemLeft" align="right" valign="top">def&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d0/d6f/namespacerefstats.html#a79d1c02a7521dfb7070de07b72b841f4">main</a> (argv=None)</td></tr>
<tr class="separator:a79d1c02a7521dfb7070de07b72b841f4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4d961c19dfa9165e07048c955f363ea9"><td class="memItemLeft" align="right" valign="top">def&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d0/d6f/namespacerefstats.html#a4d961c19dfa9165e07048c955f363ea9">process_file</a> (<a class="el" href="../../d4/d45/test__http__media__cache_8c.html#a80c8e3ae5087d90d422675d034eeebc7">options</a>)</td></tr>
<tr class="separator:a4d961c19dfa9165e07048c955f363ea9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6017b4304878d68a992cf7206844a10f"><td class="memItemLeft" align="right" valign="top">def&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d0/d6f/namespacerefstats.html#a6017b4304878d68a992cf7206844a10f">update_stats</a> (current, peak, <a class="el" href="../../dd/d27/res__adsi_8c.html#ac7af894858cf396a219d632f40afdc8d">total</a>, key, <a class="el" href="../../d4/d8b/func__frame__drop_8c.html#a99f26e6ee9fcd62f75203b5402df8098">direction</a>, delta)</td></tr>
<tr class="separator:a6017b4304878d68a992cf7206844a10f"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><pre class="fragment">Process a ref debug log for memory usage

 This will provide information about total and peak
 allocations.

 See http://www.asterisk.org for more information about
 the Asterisk project. Please do not directly contact
 any of the maintainers of this project for assistance;
 the project provides a web site, mailing lists and IRC
 channels for your use.

 This program is free software, distributed under the terms of
 the GNU General Public License Version 2. See the LICENSE file
 at the top of the source tree.

 Copyright (C) 2018, CFWare, LLC
 Corey Farrell &lt;git@cfware.com&gt;
</pre> </div><h2 class="groupheader">Function Documentation</h2>
<a id="a107e683a7dc23a01f565e9d6ed9f8a8f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a107e683a7dc23a01f565e9d6ed9f8a8f">&#9670;&nbsp;</a></span>create_stats()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">def refstats.create_stats </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<pre class="fragment">Create statistics object</pre> 
<p class="definition">Definition at line <a class="el" href="../../d4/db9/refstats_8py_source.html#l00028">28</a> of file <a class="el" href="../../d4/db9/refstats_8py_source.html">refstats.py</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../d4/db9/refstats_8py_source.html#l00050">process_file()</a>.</p>
<div class="fragment"><div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;<span class="keyword">def </span><a class="code" href="../../d0/d6f/namespacerefstats.html#a107e683a7dc23a01f565e9d6ed9f8a8f">create_stats</a>():</div><div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;    <span class="stringliteral">&quot;&quot;&quot;Create statistics object&quot;&quot;&quot;</span></div><div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;    <span class="keywordflow">return</span> {</div><div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;        <span class="stringliteral">&#39;count&#39;</span>: 0,</div><div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;        <span class="stringliteral">&#39;overhead&#39;</span>: 0,</div><div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;        <span class="stringliteral">&#39;user_data&#39;</span>: 0,</div><div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;        <span class="stringliteral">&#39;totalmem&#39;</span>: 0</div><div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;    }</div><div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;</div><div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;</div><div class="ttc" id="namespacerefstats_html_a107e683a7dc23a01f565e9d6ed9f8a8f"><div class="ttname"><a href="../../d0/d6f/namespacerefstats.html#a107e683a7dc23a01f565e9d6ed9f8a8f">refstats.create_stats</a></div><div class="ttdeci">def create_stats()</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/db9/refstats_8py_source.html#l00028">refstats.py:28</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a79d1c02a7521dfb7070de07b72b841f4"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a79d1c02a7521dfb7070de07b72b841f4">&#9670;&nbsp;</a></span>main()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">def refstats.main </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>argv</em> = <code>None</code></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<pre class="fragment">Main entry point for the script</pre> 
<p class="definition">Definition at line <a class="el" href="../../d4/db9/refstats_8py_source.html#l00150">150</a> of file <a class="el" href="../../d4/db9/refstats_8py_source.html">refstats.py</a>.</p>

<p class="reference">References <a class="el" href="../../d4/db9/refstats_8py_source.html#l00050">process_file()</a>.</p>
<div class="fragment"><div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;<span class="keyword">def </span><a class="code" href="../../d0/d6f/namespacerefstats.html#a79d1c02a7521dfb7070de07b72b841f4">main</a>(argv=None):</div><div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;    <span class="stringliteral">&quot;&quot;&quot;Main entry point for the script&quot;&quot;&quot;</span></div><div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;</div><div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;    ret_code = 0</div><div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;</div><div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;    <span class="keywordflow">if</span> argv <span class="keywordflow">is</span> <span class="keywordtype">None</span>:</div><div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;        argv = sys.argv</div><div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;</div><div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;    parser = OptionParser()</div><div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;</div><div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;    parser.add_option(<span class="stringliteral">&quot;-f&quot;</span>, <span class="stringliteral">&quot;--file&quot;</span>, action=<span class="stringliteral">&quot;store&quot;</span>, type=<span class="stringliteral">&quot;string&quot;</span>,</div><div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;                      dest=<span class="stringliteral">&quot;filepath&quot;</span>, default=<span class="stringliteral">&quot;/var/log/asterisk/refs&quot;</span>,</div><div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;                      help=<span class="stringliteral">&quot;The full path to the refs file to process&quot;</span>)</div><div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;</div><div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;    (options, args) = parser.parse_args(argv)</div><div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;</div><div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;    <span class="keywordflow">if</span> <span class="keywordflow">not</span> os.path.isfile(options.filepath):</div><div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;        print(<span class="stringliteral">&quot;File not found: %s&quot;</span> % options.filepath, file=sys.stderr)</div><div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;        <span class="keywordflow">return</span> -1</div><div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;</div><div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;    <span class="keywordflow">try</span>:</div><div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;        <a class="code" href="../../d0/d6f/namespacerefstats.html#a4d961c19dfa9165e07048c955f363ea9">process_file</a>(options)</div><div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;    <span class="keywordflow">except</span> (KeyboardInterrupt, SystemExit, IOError):</div><div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;        print(<span class="stringliteral">&quot;File processing cancelled&quot;</span>, file=sys.stderr)</div><div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;        <span class="keywordflow">return</span> -1</div><div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;</div><div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;    <span class="keywordflow">return</span> ret_code</div><div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;</div><div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;</div><div class="ttc" id="namespacerefstats_html_a79d1c02a7521dfb7070de07b72b841f4"><div class="ttname"><a href="../../d0/d6f/namespacerefstats.html#a79d1c02a7521dfb7070de07b72b841f4">refstats.main</a></div><div class="ttdeci">def main(argv=None)</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/db9/refstats_8py_source.html#l00150">refstats.py:150</a></div></div>
<div class="ttc" id="namespacerefstats_html_a4d961c19dfa9165e07048c955f363ea9"><div class="ttname"><a href="../../d0/d6f/namespacerefstats.html#a4d961c19dfa9165e07048c955f363ea9">refstats.process_file</a></div><div class="ttdeci">def process_file(options)</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/db9/refstats_8py_source.html#l00050">refstats.py:50</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a4d961c19dfa9165e07048c955f363ea9"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4d961c19dfa9165e07048c955f363ea9">&#9670;&nbsp;</a></span>process_file()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">def refstats.process_file </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>options</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<pre class="fragment">The routine that kicks off processing a ref file</pre> 
<p class="definition">Definition at line <a class="el" href="../../d4/db9/refstats_8py_source.html#l00050">50</a> of file <a class="el" href="../../d4/db9/refstats_8py_source.html">refstats.py</a>.</p>

<p class="reference">References <a class="el" href="../../d4/db9/refstats_8py_source.html#l00028">create_stats()</a>, <a class="el" href="../../d9/d1e/func__strings_8c_source.html#l01344">len()</a>, and <a class="el" href="../../d4/db9/refstats_8py_source.html#l00038">update_stats()</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../d4/db9/refstats_8py_source.html#l00150">main()</a>.</p>
<div class="fragment"><div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;<span class="keyword">def </span><a class="code" href="../../d0/d6f/namespacerefstats.html#a4d961c19dfa9165e07048c955f363ea9">process_file</a>(options):</div><div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;    <span class="stringliteral">&quot;&quot;&quot;The routine that kicks off processing a ref file&quot;&quot;&quot;</span></div><div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;</div><div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;    current = <a class="code" href="../../d0/d6f/namespacerefstats.html#a107e683a7dc23a01f565e9d6ed9f8a8f">create_stats</a>()</div><div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;    total = <a class="code" href="../../d0/d6f/namespacerefstats.html#a107e683a7dc23a01f565e9d6ed9f8a8f">create_stats</a>()</div><div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;    peak = <a class="code" href="../../d0/d6f/namespacerefstats.html#a107e683a7dc23a01f565e9d6ed9f8a8f">create_stats</a>()</div><div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;    object_types = {}</div><div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;    objects = {}</div><div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;    filename = options.filepath</div><div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;</div><div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;    with open(filename, <span class="stringliteral">&#39;r&#39;) as ref_file:</span></div><div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;<span class="stringliteral">        </span><span class="keywordflow">for</span> line <span class="keywordflow">in</span> ref_file:</div><div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;            <span class="keywordflow">if</span> <span class="stringliteral">&#39;constructor&#39;</span> <span class="keywordflow">not</span> <span class="keywordflow">in</span> line <span class="keywordflow">and</span> <span class="stringliteral">&#39;destructor&#39;</span> <span class="keywordflow">not</span> <span class="keywordflow">in</span> line:</div><div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;                <span class="keywordflow">continue</span></div><div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;            <span class="comment"># The line format is:</span></div><div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;            <span class="comment"># addr,delta,thread_id,file,line,function,state,tag</span></div><div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;            <span class="comment"># Only addr, file, line, function, state are used by reflocks.py</span></div><div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;            tokens = line.strip().split(<span class="stringliteral">&#39;,&#39;</span>, 7)</div><div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;            addr = tokens[0]</div><div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;            state = tokens[6]</div><div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;            <span class="keywordflow">if</span> <span class="stringliteral">&#39;constructor&#39;</span> <span class="keywordflow">in</span> state:</div><div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;                split_state = state.split(<span class="stringliteral">&quot;**&quot;</span>)</div><div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;                <span class="keywordflow">if</span> <a class="code" href="../../d9/d1e/func__strings_8c.html#af24e73aaf92f3000fda15d285e66df24">len</a>(split_state) &lt; 4:</div><div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;                    print(<span class="stringliteral">&quot;File does not contain object size information&quot;</span>, file=sys.stderr)</div><div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;                    sys.exit(1)</div><div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;</div><div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;                obj_type = <span class="stringliteral">&#39;%s:%s:%s&#39;</span> % (tokens[3], tokens[4], tokens[5])</div><div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;                <span class="keywordflow">if</span> obj_type <span class="keywordflow">not</span> <span class="keywordflow">in</span> object_types:</div><div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;                    object_types[obj_type] = {</div><div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;                        <span class="stringliteral">&#39;used&#39;</span>: 0,</div><div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;                        <span class="stringliteral">&#39;unused&#39;</span>: 0,</div><div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;                        <span class="stringliteral">&#39;none&#39;</span>: 0</div><div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;                    }</div><div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;                overhead = int(split_state[2])</div><div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;                user_data = int(split_state[3])</div><div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;                obj = objects[addr] = {</div><div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;                    <span class="stringliteral">&#39;overhead&#39;</span>: overhead,</div><div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;                    <span class="stringliteral">&#39;user_data&#39;</span>: user_data,</div><div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;                    <span class="stringliteral">&#39;obj_type&#39;</span>: obj_type</div><div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;                }</div><div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;</div><div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;                direction = 1</div><div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;            <span class="keywordflow">else</span>:</div><div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;                <span class="keywordflow">if</span> addr <span class="keywordflow">not</span> <span class="keywordflow">in</span> objects:</div><div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;                    <span class="comment"># This error would be reported by refcounter.py.</span></div><div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;                    <span class="keywordflow">continue</span></div><div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;                obj = objects[addr]</div><div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;                del objects[addr]</div><div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;                direction = -1</div><div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;                obj_type = obj[<span class="stringliteral">&#39;obj_type&#39;</span>]</div><div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;                <span class="keywordflow">if</span> <span class="stringliteral">&#39;**lock-state:unused**&#39;</span> <span class="keywordflow">in</span> state:</div><div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;                    object_types[obj_type][<span class="stringliteral">&#39;unused&#39;</span>] += 1</div><div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;                <span class="keywordflow">elif</span> <span class="stringliteral">&#39;**lock-state:used**&#39;</span> <span class="keywordflow">in</span> state:</div><div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;                    object_types[obj_type][<span class="stringliteral">&#39;used&#39;</span>] += 1</div><div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;</div><div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;            <span class="comment"># Increment current and peak usage</span></div><div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;            <a class="code" href="../../d5/d47/res__fax__spandsp_8c.html#adf5e0a963a0c910f4affa63d1ba1353e">update_stats</a>(current, peak, total, <span class="stringliteral">&#39;count&#39;</span>, direction, 1)</div><div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;            <a class="code" href="../../d5/d47/res__fax__spandsp_8c.html#adf5e0a963a0c910f4affa63d1ba1353e">update_stats</a>(current, peak, total, <span class="stringliteral">&#39;overhead&#39;</span>, direction, obj[<span class="stringliteral">&#39;overhead&#39;</span>])</div><div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;            <a class="code" href="../../d5/d47/res__fax__spandsp_8c.html#adf5e0a963a0c910f4affa63d1ba1353e">update_stats</a>(current, peak, total, <span class="stringliteral">&#39;user_data&#39;</span>, direction, obj[<span class="stringliteral">&#39;user_data&#39;</span>])</div><div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;            <a class="code" href="../../d5/d47/res__fax__spandsp_8c.html#adf5e0a963a0c910f4affa63d1ba1353e">update_stats</a>(current, peak, total, <span class="stringliteral">&#39;totalmem&#39;</span>, direction, obj[<span class="stringliteral">&#39;overhead&#39;</span>] + obj[<span class="stringliteral">&#39;user_data&#39;</span>])</div><div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;</div><div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;    print(<span class="stringliteral">&quot;Total usage statistics:&quot;</span>)</div><div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;    print(<span class="stringliteral">&quot;%20s: %d&quot;</span> % (<span class="stringliteral">&quot;Count&quot;</span>, total[<span class="stringliteral">&#39;count&#39;</span>]))</div><div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;    print(<span class="stringliteral">&quot;%20s: %d&quot;</span> % (<span class="stringliteral">&quot;Total Memory (k)&quot;</span>, total[<span class="stringliteral">&#39;totalmem&#39;</span>] / 1024))</div><div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;    print(<span class="stringliteral">&quot;%20s: %d (%.2f%%)&quot;</span> % (<span class="stringliteral">&quot;Overhead (k)&quot;</span>, total[<span class="stringliteral">&#39;overhead&#39;</span>] / 1024, total[<span class="stringliteral">&#39;overhead&#39;</span>] * 100.0 / total[<span class="stringliteral">&#39;totalmem&#39;</span>]))</div><div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;    print(<span class="stringliteral">&quot;%20s: %d&quot;</span> % (<span class="stringliteral">&quot;User Data (k)&quot;</span>, total[<span class="stringliteral">&#39;user_data&#39;</span>] / 1024))</div><div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;    print(<span class="stringliteral">&quot;&quot;</span>)</div><div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;    print(<span class="stringliteral">&quot;Peak usage statistics:&quot;</span>)</div><div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;    print(<span class="stringliteral">&quot;%20s: %d&quot;</span> % (<span class="stringliteral">&quot;Count&quot;</span>, peak[<span class="stringliteral">&#39;count&#39;</span>]))</div><div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;    print(<span class="stringliteral">&quot;%20s: %d&quot;</span> % (<span class="stringliteral">&quot;Total Memory (k)&quot;</span>, peak[<span class="stringliteral">&#39;totalmem&#39;</span>] / 1024))</div><div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;    print(<span class="stringliteral">&quot;%20s: %d (%.2f%%)&quot;</span> % (<span class="stringliteral">&quot;Overhead (k)&quot;</span>, peak[<span class="stringliteral">&#39;overhead&#39;</span>] / 1024, peak[<span class="stringliteral">&#39;overhead&#39;</span>] * 100.0 / peak[<span class="stringliteral">&#39;totalmem&#39;</span>]))</div><div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;    print(<span class="stringliteral">&quot;%20s: %d&quot;</span> % (<span class="stringliteral">&quot;User Data (k)&quot;</span>, peak[<span class="stringliteral">&#39;user_data&#39;</span>] / 1024))</div><div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;    print(<span class="stringliteral">&quot;&quot;</span>)</div><div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;</div><div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;    lockbyobj = {<span class="stringliteral">&#39;used&#39;</span>: 0, <span class="stringliteral">&#39;total&#39;</span>: 0}</div><div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;    lockbytype = {<span class="stringliteral">&#39;used&#39;</span>: 0, <span class="stringliteral">&#39;total&#39;</span>: 0}</div><div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;    <span class="keywordflow">for</span> (allocator, info) <span class="keywordflow">in</span> object_types.items():</div><div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;        lockbyobj[<span class="stringliteral">&#39;used&#39;</span>] += info[<span class="stringliteral">&#39;used&#39;</span>]</div><div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;        lockbyobj[<span class="stringliteral">&#39;total&#39;</span>] += info[<span class="stringliteral">&#39;used&#39;</span>] + info[<span class="stringliteral">&#39;unused&#39;</span>]</div><div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;</div><div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;        <span class="keywordflow">if</span> info[<span class="stringliteral">&#39;used&#39;</span>] != 0:</div><div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;            lockbytype[<span class="stringliteral">&#39;used&#39;</span>] += 1</div><div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;        <span class="keywordflow">elif</span> info[<span class="stringliteral">&#39;unused&#39;</span>] == 0:</div><div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;            <span class="comment"># This object type doesn&#39;t have locking.</span></div><div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;            <span class="keywordflow">continue</span></div><div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;        lockbytype[<span class="stringliteral">&#39;total&#39;</span>] += 1</div><div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;</div><div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;    print(<span class="stringliteral">&quot;Lock usage statistics:&quot;</span>)</div><div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;    print(<span class="stringliteral">&quot;%20s: %d of %d used (%.2f%%)&quot;</span> % (</div><div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;        <span class="stringliteral">&quot;By object&quot;</span>,</div><div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;        lockbyobj[<span class="stringliteral">&#39;used&#39;</span>],</div><div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;        lockbyobj[<span class="stringliteral">&#39;total&#39;</span>],</div><div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;        lockbyobj[<span class="stringliteral">&#39;used&#39;</span>] * 100.0 / lockbyobj[<span class="stringliteral">&#39;total&#39;</span>]))</div><div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;    print(<span class="stringliteral">&quot;%20s: %d of %d used (%.2f%%)&quot;</span> % (</div><div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;        <span class="stringliteral">&quot;By type&quot;</span>,</div><div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;        lockbytype[<span class="stringliteral">&#39;used&#39;</span>],</div><div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;        lockbytype[<span class="stringliteral">&#39;total&#39;</span>],</div><div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;        lockbytype[<span class="stringliteral">&#39;used&#39;</span>] * 100.0 / lockbytype[<span class="stringliteral">&#39;total&#39;</span>]))</div><div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;</div><div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;</div><div class="ttc" id="namespacerefstats_html_a107e683a7dc23a01f565e9d6ed9f8a8f"><div class="ttname"><a href="../../d0/d6f/namespacerefstats.html#a107e683a7dc23a01f565e9d6ed9f8a8f">refstats.create_stats</a></div><div class="ttdeci">def create_stats()</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/db9/refstats_8py_source.html#l00028">refstats.py:28</a></div></div>
<div class="ttc" id="func__strings_8c_html_af24e73aaf92f3000fda15d285e66df24"><div class="ttname"><a href="../../d9/d1e/func__strings_8c.html#af24e73aaf92f3000fda15d285e66df24">len</a></div><div class="ttdeci">static int len(struct ast_channel *chan, const char *cmd, char *data, char *buf, size_t buflen)</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d1e/func__strings_8c_source.html#l01344">func_strings.c:1344</a></div></div>
<div class="ttc" id="res__fax__spandsp_8c_html_adf5e0a963a0c910f4affa63d1ba1353e"><div class="ttname"><a href="../../d5/d47/res__fax__spandsp_8c.html#adf5e0a963a0c910f4affa63d1ba1353e">update_stats</a></div><div class="ttdeci">static int update_stats(struct spandsp_pvt *p, int completion_code)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d47/res__fax__spandsp_8c_source.html#l00257">res_fax_spandsp.c:257</a></div></div>
<div class="ttc" id="namespacerefstats_html_a4d961c19dfa9165e07048c955f363ea9"><div class="ttname"><a href="../../d0/d6f/namespacerefstats.html#a4d961c19dfa9165e07048c955f363ea9">refstats.process_file</a></div><div class="ttdeci">def process_file(options)</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/db9/refstats_8py_source.html#l00050">refstats.py:50</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a6017b4304878d68a992cf7206844a10f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6017b4304878d68a992cf7206844a10f">&#9670;&nbsp;</a></span>update_stats()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">def refstats.update_stats </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>current</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>peak</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>total</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>key</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>direction</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>delta</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<pre class="fragment">Update statistics objects</pre> 
<p class="definition">Definition at line <a class="el" href="../../d4/db9/refstats_8py_source.html#l00038">38</a> of file <a class="el" href="../../d4/db9/refstats_8py_source.html">refstats.py</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../d4/db9/refstats_8py_source.html#l00050">process_file()</a>.</p>
<div class="fragment"><div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;<span class="keyword">def </span><a class="code" href="../../d5/d47/res__fax__spandsp_8c.html#adf5e0a963a0c910f4affa63d1ba1353e">update_stats</a>(current, peak, total, key, direction, delta):</div><div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;    <span class="stringliteral">&quot;&quot;&quot;Update statistics objects&quot;&quot;&quot;</span></div><div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;</div><div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;    <span class="keywordflow">if</span> direction == 1:</div><div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;        total[key] += delta</div><div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;</div><div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;    delta *= direction</div><div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;    current[key] += delta</div><div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;    <span class="keywordflow">if</span> current[key] &gt; peak[key]:</div><div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;        peak[key] = current[key]</div><div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;</div><div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;</div><div class="ttc" id="res__fax__spandsp_8c_html_adf5e0a963a0c910f4affa63d1ba1353e"><div class="ttname"><a href="../../d5/d47/res__fax__spandsp_8c.html#adf5e0a963a0c910f4affa63d1ba1353e">update_stats</a></div><div class="ttdeci">static int update_stats(struct spandsp_pvt *p, int completion_code)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d47/res__fax__spandsp_8c_source.html#l00257">res_fax_spandsp.c:257</a></div></div>
</div><!-- fragment -->
</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Sun Aug 8 2021 19:47:31 for Asterisk - The Open Source Telephony Project by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="../../doxygen.png" alt="doxygen"/>
</a> 1.8.13
</small></address>
</body>
</html>
