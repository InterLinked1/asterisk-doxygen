<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Asterisk - The Open Source Telephony Project: res_pjsip_refer.c File Reference</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Asterisk - The Open Source Telephony Project
   &#160;<span id="projectnumber">18.5.0</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "../../search",false,'Search');
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('../../',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="../../dir_7b47cca4d318623bb4270ab1fb592ef5.html">res</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#nested-classes">Data Structures</a> &#124;
<a href="#define-members">Macros</a> &#124;
<a href="#func-members">Functions</a> &#124;
<a href="#var-members">Variables</a>  </div>
  <div class="headertitle">
<div class="title">res_pjsip_refer.c File Reference</div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><code>#include &quot;<a class="el" href="../../db/db2/asterisk_8h_source.html">asterisk.h</a>&quot;</code><br />
<code>#include &lt;pjsip.h&gt;</code><br />
<code>#include &lt;pjsip_ua.h&gt;</code><br />
<code>#include &quot;<a class="el" href="../../d8/d8c/res__pjsip_8h_source.html">asterisk/res_pjsip.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="../../d9/de7/res__pjsip__session_8h_source.html">asterisk/res_pjsip_session.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="../../d5/d16/module_8h_source.html">asterisk/module.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="../../db/de0/pbx_8h_source.html">asterisk/pbx.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="../../d0/d1e/taskprocessor_8h_source.html">asterisk/taskprocessor.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="../../d4/d56/bridge_8h_source.html">asterisk/bridge.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="../../db/d3c/framehook_8h_source.html">asterisk/framehook.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="../../dc/d4e/stasis__bridges_8h_source.html">asterisk/stasis_bridges.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="../../d9/d4a/stasis__channels_8h_source.html">asterisk/stasis_channels.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="../../d4/da3/causes_8h_source.html">asterisk/causes.h</a>&quot;</code><br />
</div><div class="textblock"><div class="dynheader">
Include dependency graph for res_pjsip_refer.c:</div>
<div class="dyncontent">
<div class="center"><img src="../../d5/d2d/res__pjsip__refer_8c__incl.png" border="0" usemap="#res__pjsip__refer_8c" alt=""/></div>
<map name="res__pjsip__refer_8c" id="res__pjsip__refer_8c">
<area shape="rect" id="node2" href="../../db/db2/asterisk_8h.html" title="Asterisk main include file. File version handling, generic pbx functions. " alt="" coords="291,80,375,107"/>
<area shape="rect" id="node8" href="../../d8/d8c/res__pjsip_8h.html" title="asterisk/res_pjsip.h" alt="" coords="1256,244,1400,271"/>
<area shape="rect" id="node24" href="../../db/d3c/framehook_8h.html" title="FrameHook Architecture. " alt="" coords="2404,468,2561,495"/>
<area shape="rect" id="node32" href="../../d9/d4a/stasis__channels_8h.html" title="asterisk/stasis_channels.h" alt="" coords="2141,319,2331,345"/>
<area shape="rect" id="node35" href="../../d9/de7/res__pjsip__session_8h.html" title="asterisk/res_pjsip\l_session.h" alt="" coords="1983,155,2115,196"/>
<area shape="rect" id="node37" href="../../d5/d16/module_8h.html" title="Asterisk module definitions. " alt="" coords="3116,80,3252,107"/>
<area shape="rect" id="node38" href="../../db/de0/pbx_8h.html" title="Core PBX routines and definitions. " alt="" coords="2457,319,2567,345"/>
<area shape="rect" id="node43" href="../../d0/d1e/taskprocessor_8h.html" title="An API for managing task processing threads that can be shared across modules. " alt="" coords="2863,80,3041,107"/>
<area shape="rect" id="node44" href="../../d4/d56/bridge_8h.html" title="Bridging API. " alt="" coords="3015,162,3143,189"/>
<area shape="rect" id="node49" href="../../dc/d4e/stasis__bridges_8h.html" title="asterisk/stasis_bridges.h" alt="" coords="2660,80,2839,107"/>
<area shape="rect" id="node50" href="../../d4/da3/causes_8h.html" title="Internal Asterisk hangup causes. " alt="" coords="3276,80,3409,107"/>
<area shape="rect" id="node3" href="../../d8/d20/autoconfig_8h.html" title="asterisk/autoconfig.h" alt="" coords="5,162,160,189"/>
<area shape="rect" id="node4" href="../../de/da3/include_2asterisk_2compat_8h.html" title="General Definitions for Asterisk top level program Included by asterisk.h to handle platform&#45;specific..." alt="" coords="185,162,322,189"/>
<area shape="rect" id="node5" href="../../d8/d8a/astmm_8h.html" title="Asterisk memory management routines. " alt="" coords="346,162,481,189"/>
<area shape="rect" id="node13" href="../../d1/d0f/stringfields_8h.html" title="asterisk/stringfields.h" alt="" coords="1621,543,1779,569"/>
<area shape="rect" id="node14" href="../../d6/d68/vector_8h.html" title="Vector container support. " alt="" coords="1485,617,1611,644"/>
<area shape="rect" id="node16" href="../../db/df1/netsock2_8h.html" title="Network socket handling. " alt="" coords="1365,393,1512,420"/>
<area shape="rect" id="node17" href="../../df/d90/linkedlists_8h.html" title="A set of macros to manage forward&#45;linked lists. " alt="" coords="2450,617,2601,644"/>
<area shape="rect" id="node18" href="../../d5/d7b/channel_8h.html" title="General Asterisk PBX channel definitions. " alt="" coords="2259,393,2397,420"/>
<area shape="rect" id="node25" href="../../d4/d61/endpoints_8h.html" title="Endpoint abstractions. " alt="" coords="717,468,867,495"/>
<area shape="rect" id="node26" href="../../d8/d25/sorcery_8h.html" title="Sorcery Data Access Layer API. " alt="" coords="2592,319,2725,345"/>
<area shape="rect" id="node28" href="../../db/dc4/dnsmgr_8h.html" title="Background DNS update manager. " alt="" coords="1371,319,1507,345"/>
<area shape="rect" id="node29" href="../../d5/da1/udptl_8h.html" title="UDPTL support for T.38. " alt="" coords="1763,319,1883,345"/>
<area shape="rect" id="node31" href="../../d5/dde/rtp__engine_8h.html" title="Pluggable RTP Architecture. " alt="" coords="1582,319,1738,345"/>
<area shape="rect" id="node33" href="../../d7/d44/stasis__endpoints_8h.html" title="Endpoint abstractions. " alt="" coords="601,393,796,420"/>
<area shape="rect" id="node34" href="../../d8/d95/stream_8h.html" title="Media Stream API. " alt="" coords="639,543,774,569"/>
<area shape="rect" id="node15" href="../../dd/d42/lock_8h.html" title="Asterisk locking&#45;related definitions: " alt="" coords="2534,692,2647,719"/>
<area shape="rect" id="node19" href="../../d6/d66/include_2asterisk_2frame_8h.html" title="Asterisk internal frame definitions. " alt="" coords="2050,543,2177,569"/>
<area shape="rect" id="node22" href="../../d9/de7/chanvars_8h.html" title="Channel Variables. " alt="" coords="2585,468,2732,495"/>
<area shape="rect" id="node23" href="../../d5/d60/utils_8h.html" title="Utility functions. " alt="" coords="2756,468,2871,495"/>
<area shape="rect" id="node20" href="../../d0/d0a/format_8h.html" title="Media Format API. " alt="" coords="1947,617,2077,644"/>
<area shape="rect" id="node21" href="../../d1/d16/codec_8h.html" title="Codec API. " alt="" coords="643,692,770,719"/>
<area shape="rect" id="node27" href="../../dd/d1d/uuid_8h.html" title="Universally unique identifier support. " alt="" coords="2969,393,3084,420"/>
<area shape="rect" id="node30" href="../../d7/d00/sched_8h.html" title="Scheduler Routines (derived from cheops) " alt="" coords="1691,393,1818,420"/>
<area shape="rect" id="node36" href="../../de/d5f/sdp__srtp_8h.html" title="SRTP and SDP Security descriptions. " alt="" coords="2033,244,2175,271"/>
<area shape="rect" id="node39" href="../../da/da2/devicestate_8h.html" title="Device state management. " alt="" coords="2732,393,2895,420"/>
<area shape="rect" id="node40" href="../../d6/dd7/presencestate_8h.html" title="Presence state management. " alt="" coords="2422,393,2602,420"/>
<area shape="rect" id="node41" href="../../d6/da0/hashtab_8h.html" title="Generic (perhaps overly so) hashtable implementation Hash Table support in Asterisk. " alt="" coords="2795,617,2935,644"/>
<area shape="rect" id="node42" href="../../d1/d99/xmldoc_8h.html" title="Asterisk XML Documentation API. " alt="" coords="1738,468,1873,495"/>
<area shape="rect" id="node45" href="../../dc/d7a/bridge__features_8h.html" title="Channel Bridging API. " alt="" coords="2902,319,3090,345"/>
<area shape="rect" id="node46" href="../../de/d41/bridge__channel_8h.html" title="asterisk/bridge_channel.h" alt="" coords="2813,244,2998,271"/>
<area shape="rect" id="node47" href="../../dd/dff/bridge__roles_8h.html" title="Channel Bridging Roles API. " alt="" coords="2754,543,2921,569"/>
<area shape="rect" id="node48" href="../../d3/d08/dsp_8h.html" title="Convenient Signal Processing routines. " alt="" coords="3125,244,3235,271"/>
</map>
</div>
</div>
<p><a href="../../d1/d75/res__pjsip__refer_8c_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="nested-classes"></a>
Data Structures</h2></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d8/d70/structinvite__replaces.html">invite_replaces</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">Structure used to retrieve channel from another session.  <a href="../../d8/d70/structinvite__replaces.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dc/d15/structrefer__attended.html">refer_attended</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">Structure for attended transfer task.  <a href="../../dc/d15/structrefer__attended.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../da/de6/structrefer__blind.html">refer_blind</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">Structure for blind transfer callback details.  <a href="../../da/de6/structrefer__blind.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d0/d4b/structrefer__progress.html">refer_progress</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">REFER Progress structure.  <a href="../../d0/d4b/structrefer__progress.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d3/dff/structrefer__progress__notification.html">refer_progress_notification</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">REFER Progress notification structure.  <a href="../../d3/dff/structrefer__progress__notification.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="define-members"></a>
Macros</h2></td></tr>
<tr class="memitem:a5244b5757f33d46f4458a16d8cc14088"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/d75/res__pjsip__refer_8c.html#a5244b5757f33d46f4458a16d8cc14088">DETERMINE_TRANSFER_CONTEXT</a>(<a class="el" href="../../da/dde/chan__phone_8c.html#a579ca8125bbf48d9ce8691d522f99933">context</a>,  <a class="el" href="../../d2/d4d/astman_8c.html#ac4a6ae0400e4457f0b35beddec80c93d">session</a>)</td></tr>
<tr class="separator:a5244b5757f33d46f4458a16d8cc14088"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a88b7c88fed6b80fd18f34f97757dfc04"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/d75/res__pjsip__refer_8c.html#a88b7c88fed6b80fd18f34f97757dfc04">__reg_module</a> (void)</td></tr>
<tr class="separator:a88b7c88fed6b80fd18f34f97757dfc04"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:afeab1257bd17282b95875499393a147a"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/d75/res__pjsip__refer_8c.html#afeab1257bd17282b95875499393a147a">__unreg_module</a> (void)</td></tr>
<tr class="separator:afeab1257bd17282b95875499393a147a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a09a39bfa4ee64baa72466c1ab2cd9de0"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/d75/res__pjsip__refer_8c.html#a09a39bfa4ee64baa72466c1ab2cd9de0">add_header_from_channel_var</a> (struct <a class="el" href="../../df/d3c/structast__channel.html">ast_channel</a> *chan, const char *var_name, const char *header_name, pjsip_tx_data *tdata)</td></tr>
<tr class="memdesc:a09a39bfa4ee64baa72466c1ab2cd9de0"><td class="mdescLeft">&#160;</td><td class="mdescRight">Use the value of a channel variable as the value of a SIP header.  <a href="#a09a39bfa4ee64baa72466c1ab2cd9de0">More...</a><br /></td></tr>
<tr class="separator:a09a39bfa4ee64baa72466c1ab2cd9de0"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4fb0aca9bbcdb9709fa52a70aded6cae"><td class="memItemLeft" align="right" valign="top">struct <a class="el" href="../../d9/df5/structast__module.html">ast_module</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/d75/res__pjsip__refer_8c.html#a4fb0aca9bbcdb9709fa52a70aded6cae">AST_MODULE_SELF_SYM</a> (void)</td></tr>
<tr class="separator:a4fb0aca9bbcdb9709fa52a70aded6cae"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa3cde726a80afa88dba59d8b777ee32d"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/d75/res__pjsip__refer_8c.html#aa3cde726a80afa88dba59d8b777ee32d">defer_termination_cancel_task</a> (void *data)</td></tr>
<tr class="separator:aa3cde726a80afa88dba59d8b777ee32d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a449dd07f80afc1ecd81fffb290abca7b"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/d75/res__pjsip__refer_8c.html#a449dd07f80afc1ecd81fffb290abca7b">dlg_releaser_task</a> (void *data)</td></tr>
<tr class="separator:a449dd07f80afc1ecd81fffb290abca7b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab59723c0c02a171587bf04893d5deb33"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/d75/res__pjsip__refer_8c.html#ab59723c0c02a171587bf04893d5deb33">invite_replaces</a> (void *data)</td></tr>
<tr class="memdesc:ab59723c0c02a171587bf04893d5deb33"><td class="mdescLeft">&#160;</td><td class="mdescRight">Task for invite replaces.  <a href="#ab59723c0c02a171587bf04893d5deb33">More...</a><br /></td></tr>
<tr class="separator:ab59723c0c02a171587bf04893d5deb33"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac3382bf6da54c56b37069bd76bbdf4f9"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/d75/res__pjsip__refer_8c.html#ac3382bf6da54c56b37069bd76bbdf4f9">load_module</a> (void)</td></tr>
<tr class="separator:ac3382bf6da54c56b37069bd76bbdf4f9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6d7634cbb9a37cc1e5acc87277b455f5"><td class="memItemLeft" align="right" valign="top">static struct <a class="el" href="../../dc/d15/structrefer__attended.html">refer_attended</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/d75/res__pjsip__refer_8c.html#a6d7634cbb9a37cc1e5acc87277b455f5">refer_attended_alloc</a> (struct <a class="el" href="../../d2/dec/structast__sip__session.html">ast_sip_session</a> *transferer, struct <a class="el" href="../../d2/dec/structast__sip__session.html">ast_sip_session</a> *transferer_second, struct <a class="el" href="../../d0/d4b/structrefer__progress.html">refer_progress</a> *<a class="el" href="../../d1/df7/structprogress.html">progress</a>)</td></tr>
<tr class="memdesc:a6d7634cbb9a37cc1e5acc87277b455f5"><td class="mdescLeft">&#160;</td><td class="mdescRight">Allocator for attended transfer task.  <a href="#a6d7634cbb9a37cc1e5acc87277b455f5">More...</a><br /></td></tr>
<tr class="separator:a6d7634cbb9a37cc1e5acc87277b455f5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7658e07b1e5539b7ad89022096e3be03"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/d75/res__pjsip__refer_8c.html#a7658e07b1e5539b7ad89022096e3be03">refer_attended_destroy</a> (void *obj)</td></tr>
<tr class="memdesc:a7658e07b1e5539b7ad89022096e3be03"><td class="mdescLeft">&#160;</td><td class="mdescRight">Destructor for attended transfer task.  <a href="#a7658e07b1e5539b7ad89022096e3be03">More...</a><br /></td></tr>
<tr class="separator:a7658e07b1e5539b7ad89022096e3be03"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a81d8534849ca3b33df588163b6665f94"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/d75/res__pjsip__refer_8c.html#a81d8534849ca3b33df588163b6665f94">refer_attended_task</a> (void *data)</td></tr>
<tr class="memdesc:a81d8534849ca3b33df588163b6665f94"><td class="mdescLeft">&#160;</td><td class="mdescRight">Task for attended transfer executed by attended-&gt;transferer_second serializer.  <a href="#a81d8534849ca3b33df588163b6665f94">More...</a><br /></td></tr>
<tr class="separator:a81d8534849ca3b33df588163b6665f94"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a699d01236694a29bde454097cfd05e10"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/d75/res__pjsip__refer_8c.html#a699d01236694a29bde454097cfd05e10">refer_blind_callback</a> (struct <a class="el" href="../../df/d3c/structast__channel.html">ast_channel</a> *chan, struct <a class="el" href="../../da/d84/structtransfer__channel__data.html">transfer_channel_data</a> *user_data_wrapper, enum <a class="el" href="../../d4/d56/bridge_8h.html#a865f7ef0f91885406ab746b23eb598cd">ast_transfer_type</a> transfer_type)</td></tr>
<tr class="memdesc:a699d01236694a29bde454097cfd05e10"><td class="mdescLeft">&#160;</td><td class="mdescRight">Blind transfer callback function.  <a href="#a699d01236694a29bde454097cfd05e10">More...</a><br /></td></tr>
<tr class="separator:a699d01236694a29bde454097cfd05e10"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4c8c85f5bb081806be83bc5da897b019"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/d75/res__pjsip__refer_8c.html#a4c8c85f5bb081806be83bc5da897b019">refer_incoming_attended_request</a> (struct <a class="el" href="../../d2/dec/structast__sip__session.html">ast_sip_session</a> *<a class="el" href="../../d2/d4d/astman_8c.html#ac4a6ae0400e4457f0b35beddec80c93d">session</a>, pjsip_rx_data *rdata, pjsip_sip_uri *target_uri, pjsip_param *replaces_param, struct <a class="el" href="../../d0/d4b/structrefer__progress.html">refer_progress</a> *<a class="el" href="../../d1/df7/structprogress.html">progress</a>)</td></tr>
<tr class="separator:a4c8c85f5bb081806be83bc5da897b019"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a528166ff65a4e80a894beb5aed0c2d33"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/d75/res__pjsip__refer_8c.html#a528166ff65a4e80a894beb5aed0c2d33">refer_incoming_blind_request</a> (struct <a class="el" href="../../d2/dec/structast__sip__session.html">ast_sip_session</a> *<a class="el" href="../../d2/d4d/astman_8c.html#ac4a6ae0400e4457f0b35beddec80c93d">session</a>, pjsip_rx_data *rdata, pjsip_sip_uri *target, struct <a class="el" href="../../d0/d4b/structrefer__progress.html">refer_progress</a> *<a class="el" href="../../d1/df7/structprogress.html">progress</a>)</td></tr>
<tr class="separator:a528166ff65a4e80a894beb5aed0c2d33"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5e57806e0d60b29bf6adbd28b97de46c"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/d75/res__pjsip__refer_8c.html#a5e57806e0d60b29bf6adbd28b97de46c">refer_incoming_invite_request</a> (struct <a class="el" href="../../d2/dec/structast__sip__session.html">ast_sip_session</a> *<a class="el" href="../../d2/d4d/astman_8c.html#ac4a6ae0400e4457f0b35beddec80c93d">session</a>, struct pjsip_rx_data *rdata)</td></tr>
<tr class="separator:a5e57806e0d60b29bf6adbd28b97de46c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6a2741fe46b1034fe54e11e1d90f853a"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/d75/res__pjsip__refer_8c.html#a6a2741fe46b1034fe54e11e1d90f853a">refer_incoming_refer_request</a> (struct <a class="el" href="../../d2/dec/structast__sip__session.html">ast_sip_session</a> *<a class="el" href="../../d2/d4d/astman_8c.html#ac4a6ae0400e4457f0b35beddec80c93d">session</a>, struct pjsip_rx_data *rdata)</td></tr>
<tr class="separator:a6a2741fe46b1034fe54e11e1d90f853a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a63d31b0d0f4fea629c8fe34b0854eb3c"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/d75/res__pjsip__refer_8c.html#a63d31b0d0f4fea629c8fe34b0854eb3c">refer_incoming_request</a> (struct <a class="el" href="../../d2/dec/structast__sip__session.html">ast_sip_session</a> *<a class="el" href="../../d2/d4d/astman_8c.html#ac4a6ae0400e4457f0b35beddec80c93d">session</a>, pjsip_rx_data *rdata)</td></tr>
<tr class="separator:a63d31b0d0f4fea629c8fe34b0854eb3c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2147bff39e836eadcc58c4ad6531f39f"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/d75/res__pjsip__refer_8c.html#a2147bff39e836eadcc58c4ad6531f39f">refer_outgoing_request</a> (struct <a class="el" href="../../d2/dec/structast__sip__session.html">ast_sip_session</a> *<a class="el" href="../../d2/d4d/astman_8c.html#ac4a6ae0400e4457f0b35beddec80c93d">session</a>, struct pjsip_tx_data *tdata)</td></tr>
<tr class="separator:a2147bff39e836eadcc58c4ad6531f39f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae1ecfce9061d388895519ded34e31a36"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/d75/res__pjsip__refer_8c.html#ae1ecfce9061d388895519ded34e31a36">refer_progress_alloc</a> (struct <a class="el" href="../../d2/dec/structast__sip__session.html">ast_sip_session</a> *<a class="el" href="../../d2/d4d/astman_8c.html#ac4a6ae0400e4457f0b35beddec80c93d">session</a>, pjsip_rx_data *rdata, struct <a class="el" href="../../d0/d4b/structrefer__progress.html">refer_progress</a> **<a class="el" href="../../d1/df7/structprogress.html">progress</a>)</td></tr>
<tr class="memdesc:ae1ecfce9061d388895519ded34e31a36"><td class="mdescLeft">&#160;</td><td class="mdescRight">Internal helper function which sets up a refer progress structure if needed.  <a href="#ae1ecfce9061d388895519ded34e31a36">More...</a><br /></td></tr>
<tr class="separator:ae1ecfce9061d388895519ded34e31a36"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af1b4316df480302870d7bc3e9391227d"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/d75/res__pjsip__refer_8c.html#af1b4316df480302870d7bc3e9391227d">refer_progress_bridge</a> (void *data, struct <a class="el" href="../../d9/de4/structstasis__subscription.html">stasis_subscription</a> *<a class="el" href="../../d1/da4/res__corosync_8c.html#a8e51289dd0fc7415cee40e7a57b49fdf">sub</a>, struct <a class="el" href="../../d7/d55/structstasis__message.html">stasis_message</a> *<a class="el" href="../../d8/d9e/structmessage.html">message</a>)</td></tr>
<tr class="separator:af1b4316df480302870d7bc3e9391227d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a905b61e1a8539d48d654e13850396b06"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/d75/res__pjsip__refer_8c.html#a905b61e1a8539d48d654e13850396b06">refer_progress_destroy</a> (void *obj)</td></tr>
<tr class="memdesc:a905b61e1a8539d48d654e13850396b06"><td class="mdescLeft">&#160;</td><td class="mdescRight">Destructor for REFER progress sutrcture.  <a href="#a905b61e1a8539d48d654e13850396b06">More...</a><br /></td></tr>
<tr class="separator:a905b61e1a8539d48d654e13850396b06"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a257bc682830b3e4df38b8d5d413d588c"><td class="memItemLeft" align="right" valign="top">static struct <a class="el" href="../../d0/d99/structast__frame.html">ast_frame</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/d75/res__pjsip__refer_8c.html#a257bc682830b3e4df38b8d5d413d588c">refer_progress_framehook</a> (struct <a class="el" href="../../df/d3c/structast__channel.html">ast_channel</a> *chan, struct <a class="el" href="../../d0/d99/structast__frame.html">ast_frame</a> *f, enum <a class="el" href="../../db/d3c/framehook_8h.html#a54250544f50efde9156d2341e8da0614">ast_framehook_event</a> <a class="el" href="../../df/d7d/structevent.html">event</a>, void *data)</td></tr>
<tr class="memdesc:a257bc682830b3e4df38b8d5d413d588c"><td class="mdescLeft">&#160;</td><td class="mdescRight">Progress monitoring frame hook - examines frames to determine state of transfer.  <a href="#a257bc682830b3e4df38b8d5d413d588c">More...</a><br /></td></tr>
<tr class="separator:a257bc682830b3e4df38b8d5d413d588c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ace0ce27cec92bc5b7997cc2d6890bf10"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/d75/res__pjsip__refer_8c.html#ace0ce27cec92bc5b7997cc2d6890bf10">refer_progress_framehook_destroy</a> (void *data)</td></tr>
<tr class="memdesc:ace0ce27cec92bc5b7997cc2d6890bf10"><td class="mdescLeft">&#160;</td><td class="mdescRight">Destroy callback for monitoring framehook.  <a href="#ace0ce27cec92bc5b7997cc2d6890bf10">More...</a><br /></td></tr>
<tr class="separator:ace0ce27cec92bc5b7997cc2d6890bf10"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a89f2c1d96492b68d1399f20fc6eeb833"><td class="memItemLeft" align="right" valign="top">static struct <a class="el" href="../../d3/dff/structrefer__progress__notification.html">refer_progress_notification</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/d75/res__pjsip__refer_8c.html#a89f2c1d96492b68d1399f20fc6eeb833">refer_progress_notification_alloc</a> (struct <a class="el" href="../../d0/d4b/structrefer__progress.html">refer_progress</a> *<a class="el" href="../../d1/df7/structprogress.html">progress</a>, int response, pjsip_evsub_state <a class="el" href="../../d4/d88/structstate.html">state</a>)</td></tr>
<tr class="memdesc:a89f2c1d96492b68d1399f20fc6eeb833"><td class="mdescLeft">&#160;</td><td class="mdescRight">Allocator for REFER Progress notification structure.  <a href="#a89f2c1d96492b68d1399f20fc6eeb833">More...</a><br /></td></tr>
<tr class="separator:a89f2c1d96492b68d1399f20fc6eeb833"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2f443ca2bb3b274b636f4cb2d2e50446"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/d75/res__pjsip__refer_8c.html#a2f443ca2bb3b274b636f4cb2d2e50446">refer_progress_notification_destroy</a> (void *obj)</td></tr>
<tr class="memdesc:a2f443ca2bb3b274b636f4cb2d2e50446"><td class="mdescLeft">&#160;</td><td class="mdescRight">Destructor for REFER Progress notification structure.  <a href="#a2f443ca2bb3b274b636f4cb2d2e50446">More...</a><br /></td></tr>
<tr class="separator:a2f443ca2bb3b274b636f4cb2d2e50446"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5d2be3003a3c77234b90343bc0a43935"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/d75/res__pjsip__refer_8c.html#a5d2be3003a3c77234b90343bc0a43935">refer_progress_notify</a> (void *data)</td></tr>
<tr class="memdesc:a5d2be3003a3c77234b90343bc0a43935"><td class="mdescLeft">&#160;</td><td class="mdescRight">Serialized callback for subscription notification.  <a href="#a5d2be3003a3c77234b90343bc0a43935">More...</a><br /></td></tr>
<tr class="separator:a5d2be3003a3c77234b90343bc0a43935"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a08d6e1b32dd2e7926e98a1edba6d58a6"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/d75/res__pjsip__refer_8c.html#a08d6e1b32dd2e7926e98a1edba6d58a6">refer_progress_on_evsub_state</a> (pjsip_evsub *<a class="el" href="../../d1/da4/res__corosync_8c.html#a8e51289dd0fc7415cee40e7a57b49fdf">sub</a>, pjsip_event *<a class="el" href="../../df/d7d/structevent.html">event</a>)</td></tr>
<tr class="memdesc:a08d6e1b32dd2e7926e98a1edba6d58a6"><td class="mdescLeft">&#160;</td><td class="mdescRight">Callback for REFER subscription state changes.  <a href="#a08d6e1b32dd2e7926e98a1edba6d58a6">More...</a><br /></td></tr>
<tr class="separator:a08d6e1b32dd2e7926e98a1edba6d58a6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac2d698569813f09d32e13c7068adbbda"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/d75/res__pjsip__refer_8c.html#ac2d698569813f09d32e13c7068adbbda">session_end_if_deferred_task</a> (void *data)</td></tr>
<tr class="separator:ac2d698569813f09d32e13c7068adbbda"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad09fa931f468002152a3cc2d5ce25eae"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/d75/res__pjsip__refer_8c.html#ad09fa931f468002152a3cc2d5ce25eae">unload_module</a> (void)</td></tr>
<tr class="separator:ad09fa931f468002152a3cc2d5ce25eae"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1d1a233825b31a62bc5074299f4b273c"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/d75/res__pjsip__refer_8c.html#a1d1a233825b31a62bc5074299f4b273c">xfer_response_code2sip</a> (enum <a class="el" href="../../d4/d56/bridge_8h.html#aadbf879fadde4b1bb7832b1390cc8c17">ast_transfer_result</a> xfer_code)</td></tr>
<tr class="separator:a1d1a233825b31a62bc5074299f4b273c"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="var-members"></a>
Variables</h2></td></tr>
<tr class="memitem:ab22f32016155f7f403e7178767163d7d"><td class="memItemLeft" align="right" valign="top">static struct <a class="el" href="../../dd/d5f/structast__module__info.html">ast_module_info</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/d75/res__pjsip__refer_8c.html#ab22f32016155f7f403e7178767163d7d">__mod_info</a> = { .<a class="el" href="../../d1/da4/res__corosync_8c.html#a8f8f80d37794cde9472343e4487ba3eb">name</a> = <a class="el" href="../../da/ddd/named__acl_8c.html#aec23fc5034c3bb08140fc021f4955877">AST_MODULE</a>, .flags = <a class="el" href="../../d5/d16/module_8h.html#a155a0df9c59e04e305d4a2fa3e35f843a12c3f60dd7655dfa8d4430cbf04b1223">AST_MODFLAG_LOAD_ORDER</a> , .description = &quot;PJSIP Blind and Attended Transfer Support&quot; , .key = &quot;This paragraph is copyright (<a class="el" href="../../d7/d6f/test__linkedlists_8c.html#acd9db00336027462cfb25b97b5356883">c</a>) 2006 by Digium, Inc. \In <a class="el" href="../../d5/d14/voicin_8c.html#aed7ca058008dc3e5ee131e575abed285">order</a> for your module to load, it must return this \key via <a class="el" href="../../d7/d6f/test__linkedlists_8c.html#a13dd15487fee89a002d17ef3aff62d02">a</a> function called \&quot;key\&quot;. Any code which \includes this paragraph must <a class="el" href="../../dd/d7c/eagi__proxy_8c.html#a39730e90126aad69cfc9ca4d6fcdb3a6">be</a> licensed under the GNU \General Public License <a class="el" href="../../da/d7c/utils_2frame_8h.html#a56abfaab87c46691c1ef3ad0df23e864">version</a> 2 or later (at your \option). In addition to Digium's general reservations \of rights, Digium expressly reserves the right to \allow other parties to license this paragraph under \different terms. Any use of Digium, Inc. trademarks or \logos (including \&quot;Asterisk\&quot; or \&quot;Digium\&quot;) without \express written <a class="el" href="../../d4/d4c/structpermission.html">permission</a> of Digium, Inc. is prohibited.\n&quot; , .buildopt_sum = &quot;30ef0c93b36035ec78c9cfd712d36d9b&quot; , .support_level = AST_MODULE_SUPPORT_CORE, .load = load_module, .unload = unload_module, .load_pri = AST_MODPRI_APP_DEPEND, .requires = &quot;res_pjsip,res_pjsip_session,res_pjsip_pubsub&quot;, }</td></tr>
<tr class="separator:ab22f32016155f7f403e7178767163d7d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad60e83b9aa660040fed4d5377966cc21"><td class="memItemLeft" align="right" valign="top">static const struct <a class="el" href="../../dd/d5f/structast__module__info.html">ast_module_info</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/d75/res__pjsip__refer_8c.html#ad60e83b9aa660040fed4d5377966cc21">ast_module_info</a> = &amp;<a class="el" href="../../d6/d7a/test__xml__escape_8c.html#ab22f32016155f7f403e7178767163d7d">__mod_info</a></td></tr>
<tr class="separator:ad60e83b9aa660040fed4d5377966cc21"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aeccd64eee013b06e9076d695d8d47ba3"><td class="memItemLeft" align="right" valign="top">static pjsip_evsub_user&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/d75/res__pjsip__refer_8c.html#aeccd64eee013b06e9076d695d8d47ba3">refer_progress_evsub_cb</a></td></tr>
<tr class="memdesc:aeccd64eee013b06e9076d695d8d47ba3"><td class="mdescLeft">&#160;</td><td class="mdescRight">Callback structure for subscription.  <a href="#aeccd64eee013b06e9076d695d8d47ba3">More...</a><br /></td></tr>
<tr class="separator:aeccd64eee013b06e9076d695d8d47ba3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a43579c197f6efc45d0093d0ab8cba536"><td class="memItemLeft" align="right" valign="top">static pjsip_module&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/d75/res__pjsip__refer_8c.html#a43579c197f6efc45d0093d0ab8cba536">refer_progress_module</a></td></tr>
<tr class="memdesc:a43579c197f6efc45d0093d0ab8cba536"><td class="mdescLeft">&#160;</td><td class="mdescRight">REFER Progress module, used to attach REFER progress structure to subscriptions.  <a href="#a43579c197f6efc45d0093d0ab8cba536">More...</a><br /></td></tr>
<tr class="separator:a43579c197f6efc45d0093d0ab8cba536"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a366b18e6269e3453a3bae9a35df9334a"><td class="memItemLeft" align="right" valign="top">static struct <a class="el" href="../../df/db8/structast__sip__session__supplement.html">ast_sip_session_supplement</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/d75/res__pjsip__refer_8c.html#a366b18e6269e3453a3bae9a35df9334a">refer_supplement</a></td></tr>
<tr class="separator:a366b18e6269e3453a3bae9a35df9334a"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<h2 class="groupheader">Macro Definition Documentation</h2>
<a id="a5244b5757f33d46f4458a16d8cc14088"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a5244b5757f33d46f4458a16d8cc14088">&#9670;&nbsp;</a></span>DETERMINE_TRANSFER_CONTEXT</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define DETERMINE_TRANSFER_CONTEXT</td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><a class="el" href="../../da/dde/chan__phone_8c.html#a579ca8125bbf48d9ce8691d522f99933">context</a>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><a class="el" href="../../d2/d4d/astman_8c.html#ac4a6ae0400e4457f0b35beddec80c93d">session</a>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="../../d1/d75/res__pjsip__refer_8c_source.html#l00777">777</a> of file <a class="el" href="../../d1/d75/res__pjsip__refer_8c_source.html">res_pjsip_refer.c</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../d1/d75/res__pjsip__refer_8c_source.html#l00789">refer_incoming_attended_request()</a>, and <a class="el" href="../../d1/d75/res__pjsip__refer_8c_source.html#l00886">refer_incoming_blind_request()</a>.</p>

</div>
</div>
<h2 class="groupheader">Function Documentation</h2>
<a id="a88b7c88fed6b80fd18f34f97757dfc04"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a88b7c88fed6b80fd18f34f97757dfc04">&#9670;&nbsp;</a></span>__reg_module()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void __reg_module </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="../../d1/d75/res__pjsip__refer_8c_source.html#l01295">1295</a> of file <a class="el" href="../../d1/d75/res__pjsip__refer_8c_source.html">res_pjsip_refer.c</a>.</p>

</div>
</div>
<a id="afeab1257bd17282b95875499393a147a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#afeab1257bd17282b95875499393a147a">&#9670;&nbsp;</a></span>__unreg_module()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void __unreg_module </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="../../d1/d75/res__pjsip__refer_8c_source.html#l01295">1295</a> of file <a class="el" href="../../d1/d75/res__pjsip__refer_8c_source.html">res_pjsip_refer.c</a>.</p>

</div>
</div>
<a id="a09a39bfa4ee64baa72466c1ab2cd9de0"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a09a39bfa4ee64baa72466c1ab2cd9de0">&#9670;&nbsp;</a></span>add_header_from_channel_var()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void add_header_from_channel_var </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="../../df/d3c/structast__channel.html">ast_channel</a> *&#160;</td>
          <td class="paramname"><em>chan</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>var_name</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>header_name</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">pjsip_tx_data *&#160;</td>
          <td class="paramname"><em>tdata</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Use the value of a channel variable as the value of a SIP header. </p>
<p>This looks up a variable name on a channel, then takes that value and adds it to an outgoing SIP request. If the header already exists on the message, then no action is taken.</p>
<dl class="section pre"><dt>Precondition</dt><dd>chan is locked.</dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">chan</td><td>The channel on which to find the variable. </td></tr>
    <tr><td class="paramname">var_name</td><td>The name of the channel variable to use. </td></tr>
    <tr><td class="paramname">header_name</td><td>The name of the SIP header to add to the outgoing message. </td></tr>
    <tr><td class="paramname">tdata</td><td>The outgoing SIP message on which to add the header </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="../../d1/d75/res__pjsip__refer_8c_source.html#l01223">1223</a> of file <a class="el" href="../../d1/d75/res__pjsip__refer_8c_source.html">res_pjsip_refer.c</a>.</p>

<p class="reference">References <a class="el" href="../../de/d96/res__pjsip_8c_source.html#l05063">ast_sip_add_header()</a>, <a class="el" href="../../d6/d90/strings_8h_source.html#l00052">ast_strlen_zero</a>, <a class="el" href="../../dc/d7f/resample_8c_source.html#l00096">NULL</a>, and <a class="el" href="../../d3/d8c/pbx__variables_8c_source.html#l01000">pbx_builtin_getvar_helper()</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../d1/d75/res__pjsip__refer_8c_source.html#l01242">refer_outgoing_request()</a>.</p>
<div class="fragment"><div class="line"><a name="l01224"></a><span class="lineno"> 1224</span>&#160;{</div><div class="line"><a name="l01225"></a><span class="lineno"> 1225</span>&#160;   <span class="keyword">const</span> <span class="keywordtype">char</span> *var_value;</div><div class="line"><a name="l01226"></a><span class="lineno"> 1226</span>&#160;   pj_str_t pj_header_name;</div><div class="line"><a name="l01227"></a><span class="lineno"> 1227</span>&#160;   pjsip_hdr *<a class="code" href="../../d5/d65/structheader.html">header</a>;</div><div class="line"><a name="l01228"></a><span class="lineno"> 1228</span>&#160;</div><div class="line"><a name="l01229"></a><span class="lineno"> 1229</span>&#160;   var_value = <a class="code" href="../../db/de0/pbx_8h.html#a98c5425b90ec7c5e136a40f529170b1b">pbx_builtin_getvar_helper</a>(chan, var_name);</div><div class="line"><a name="l01230"></a><span class="lineno"> 1230</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a>(var_value)) {</div><div class="line"><a name="l01231"></a><span class="lineno"> 1231</span>&#160;      <span class="keywordflow">return</span>;</div><div class="line"><a name="l01232"></a><span class="lineno"> 1232</span>&#160;   }</div><div class="line"><a name="l01233"></a><span class="lineno"> 1233</span>&#160;</div><div class="line"><a name="l01234"></a><span class="lineno"> 1234</span>&#160;   pj_cstr(&amp;pj_header_name, header_name);</div><div class="line"><a name="l01235"></a><span class="lineno"> 1235</span>&#160;   header = pjsip_msg_find_hdr_by_name(tdata-&gt;msg, &amp;pj_header_name, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div><div class="line"><a name="l01236"></a><span class="lineno"> 1236</span>&#160;   <span class="keywordflow">if</span> (header) {</div><div class="line"><a name="l01237"></a><span class="lineno"> 1237</span>&#160;      <span class="keywordflow">return</span>;</div><div class="line"><a name="l01238"></a><span class="lineno"> 1238</span>&#160;   }</div><div class="line"><a name="l01239"></a><span class="lineno"> 1239</span>&#160;   <a class="code" href="../../d8/d8c/res__pjsip_8h.html#acef4d0aef5bdc92f0b6b188e48f2e90f">ast_sip_add_header</a>(tdata, header_name, var_value);</div><div class="line"><a name="l01240"></a><span class="lineno"> 1240</span>&#160;}</div><div class="ttc" id="resample_8c_html_a070d2ce7b6bb7e5c05602aa8c308d0c4"><div class="ttname"><a href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a></div><div class="ttdeci">#define NULL</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d7f/resample_8c_source.html#l00096">resample.c:96</a></div></div>
<div class="ttc" id="res__pjsip_8h_html_acef4d0aef5bdc92f0b6b188e48f2e90f"><div class="ttname"><a href="../../d8/d8c/res__pjsip_8h.html#acef4d0aef5bdc92f0b6b188e48f2e90f">ast_sip_add_header</a></div><div class="ttdeci">int ast_sip_add_header(pjsip_tx_data *tdata, const char *name, const char *value)</div><div class="ttdoc">Add a header to an outbound SIP message. </div><div class="ttdef"><b>Definition:</b> <a href="../../de/d96/res__pjsip_8c_source.html#l05063">res_pjsip.c:5063</a></div></div>
<div class="ttc" id="pbx_8h_html_a98c5425b90ec7c5e136a40f529170b1b"><div class="ttname"><a href="../../db/de0/pbx_8h.html#a98c5425b90ec7c5e136a40f529170b1b">pbx_builtin_getvar_helper</a></div><div class="ttdeci">const char * pbx_builtin_getvar_helper(struct ast_channel *chan, const char *name)</div><div class="ttdoc">Return a pointer to the value of the corresponding channel variable. </div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d8c/pbx__variables_8c_source.html#l01000">pbx_variables.c:1000</a></div></div>
<div class="ttc" id="strings_8h_html_a372554b7a2d69a8bd3adac5157672036"><div class="ttname"><a href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a></div><div class="ttdeci">#define ast_strlen_zero(foo)</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d90/strings_8h_source.html#l00052">strings.h:52</a></div></div>
<div class="ttc" id="structheader_html"><div class="ttname"><a href="../../d5/d65/structheader.html">header</a></div><div class="ttdef"><b>Definition:</b> <a href="../../db/d73/pjsip__global__headers_8c_source.html#l00047">pjsip_global_headers.c:47</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a4fb0aca9bbcdb9709fa52a70aded6cae"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4fb0aca9bbcdb9709fa52a70aded6cae">&#9670;&nbsp;</a></span>AST_MODULE_SELF_SYM()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="../../d9/df5/structast__module.html">ast_module</a>* AST_MODULE_SELF_SYM </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="../../d1/d75/res__pjsip__refer_8c_source.html#l01295">1295</a> of file <a class="el" href="../../d1/d75/res__pjsip__refer_8c_source.html">res_pjsip_refer.c</a>.</p>

</div>
</div>
<a id="aa3cde726a80afa88dba59d8b777ee32d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa3cde726a80afa88dba59d8b777ee32d">&#9670;&nbsp;</a></span>defer_termination_cancel_task()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int defer_termination_cancel_task </td>
          <td>(</td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>data</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="../../d1/d75/res__pjsip__refer_8c_source.html#l00511">511</a> of file <a class="el" href="../../d1/d75/res__pjsip__refer_8c_source.html">res_pjsip_refer.c</a>.</p>

<p class="reference">References <a class="el" href="../../d5/da5/astobj2_8h_source.html#l00464">ao2_ref</a>, <a class="el" href="../../d4/d92/res__pjsip__session_8c_source.html#l03596">ast_sip_session_defer_termination_cancel()</a>, <a class="el" href="../../d4/d92/res__pjsip__session_8c_source.html#l03614">ast_sip_session_end_if_deferred()</a>, and <a class="el" href="../../d2/d4d/astman_8c.html#ac4a6ae0400e4457f0b35beddec80c93d">session</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../d1/d75/res__pjsip__refer_8c_source.html#l00553">refer_attended_task()</a>.</p>
<div class="fragment"><div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;{</div><div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d2/dec/structast__sip__session.html">ast_sip_session</a> *<a class="code" href="../../d2/d4d/astman_8c.html#ac4a6ae0400e4457f0b35beddec80c93d">session</a> = data;</div><div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;</div><div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;   <a class="code" href="../../d9/de7/res__pjsip__session_8h.html#aa55296422ab86c7de1d7f52e9c227d82">ast_sip_session_end_if_deferred</a>(session);</div><div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;   <a class="code" href="../../d9/de7/res__pjsip__session_8h.html#a587c035e9aae3bf37049f886dc29dcb6">ast_sip_session_defer_termination_cancel</a>(session);</div><div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(session, -1);</div><div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;   <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;}</div><div class="ttc" id="structast__sip__session_html"><div class="ttname"><a href="../../d2/dec/structast__sip__session.html">ast_sip_session</a></div><div class="ttdoc">A structure describing a SIP session. </div><div class="ttdef"><b>Definition:</b> <a href="../../d9/de7/res__pjsip__session_8h_source.html#l00179">res_pjsip_session.h:179</a></div></div>
<div class="ttc" id="astman_8c_html_ac4a6ae0400e4457f0b35beddec80c93d"><div class="ttname"><a href="../../d2/d4d/astman_8c.html#ac4a6ae0400e4457f0b35beddec80c93d">session</a></div><div class="ttdeci">static struct ast_mansession session</div></div>
<div class="ttc" id="res__pjsip__session_8h_html_a587c035e9aae3bf37049f886dc29dcb6"><div class="ttname"><a href="../../d9/de7/res__pjsip__session_8h.html#a587c035e9aae3bf37049f886dc29dcb6">ast_sip_session_defer_termination_cancel</a></div><div class="ttdeci">void ast_sip_session_defer_termination_cancel(struct ast_sip_session *session)</div><div class="ttdoc">Cancel a pending deferred termination. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d92/res__pjsip__session_8c_source.html#l03596">res_pjsip_session.c:3596</a></div></div>
<div class="ttc" id="astobj2_8h_html_aaca5e8eac39a22f9da1c36fc6c922270"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a></div><div class="ttdeci">#define ao2_ref(o, delta)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l00464">astobj2.h:464</a></div></div>
<div class="ttc" id="res__pjsip__session_8h_html_aa55296422ab86c7de1d7f52e9c227d82"><div class="ttname"><a href="../../d9/de7/res__pjsip__session_8h.html#aa55296422ab86c7de1d7f52e9c227d82">ast_sip_session_end_if_deferred</a></div><div class="ttdeci">void ast_sip_session_end_if_deferred(struct ast_sip_session *session)</div><div class="ttdoc">End the session if it had been previously deferred. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d92/res__pjsip__session_8c_source.html#l03614">res_pjsip_session.c:3614</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a449dd07f80afc1ecd81fffb290abca7b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a449dd07f80afc1ecd81fffb290abca7b">&#9670;&nbsp;</a></span>dlg_releaser_task()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int dlg_releaser_task </td>
          <td>(</td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>data</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="../../d1/d75/res__pjsip__refer_8c_source.html#l00343">343</a> of file <a class="el" href="../../d1/d75/res__pjsip__refer_8c_source.html">res_pjsip_refer.c</a>.</p>

<p class="reference">References <a class="el" href="../../d1/d75/res__pjsip__refer_8c_source.html#l00080">refer_progress_module</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../d1/d75/res__pjsip__refer_8c_source.html#l00349">refer_progress_destroy()</a>.</p>
<div class="fragment"><div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;                                         {</div><div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;   pjsip_dlg_dec_session((pjsip_dialog *)data, &amp;<a class="code" href="../../d1/d75/res__pjsip__refer_8c.html#a43579c197f6efc45d0093d0ab8cba536">refer_progress_module</a>);</div><div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;   <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;}</div><div class="ttc" id="res__pjsip__refer_8c_html_a43579c197f6efc45d0093d0ab8cba536"><div class="ttname"><a href="../../d1/d75/res__pjsip__refer_8c.html#a43579c197f6efc45d0093d0ab8cba536">refer_progress_module</a></div><div class="ttdeci">static pjsip_module refer_progress_module</div><div class="ttdoc">REFER Progress module, used to attach REFER progress structure to subscriptions. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d75/res__pjsip__refer_8c_source.html#l00080">res_pjsip_refer.c:80</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="ab59723c0c02a171587bf04893d5deb33"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab59723c0c02a171587bf04893d5deb33">&#9670;&nbsp;</a></span>invite_replaces()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int <a class="el" href="../../d8/d70/structinvite__replaces.html">invite_replaces</a> </td>
          <td>(</td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>data</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Task for invite replaces. </p>

<p class="definition">Definition at line <a class="el" href="../../d1/d75/res__pjsip__refer_8c_source.html#l00954">954</a> of file <a class="el" href="../../d1/d75/res__pjsip__refer_8c_source.html">res_pjsip_refer.c</a>.</p>

<p class="reference">References <a class="el" href="../../d0/d95/bridge_8c_source.html#l04460">ast_bridge_transfer_acquire_bridge()</a>, <a class="el" href="../../d5/d7b/channel_8h_source.html#l02970">ast_channel_ref</a>, <a class="el" href="../../d1/d75/res__pjsip__refer_8c_source.html#l00950">invite_replaces::bridge</a>, <a class="el" href="../../d9/de7/res__pjsip__session_8h_source.html#l00189">ast_sip_session::channel</a>, <a class="el" href="../../d1/d75/res__pjsip__refer_8c_source.html#l00948">invite_replaces::channel</a>, and <a class="el" href="../../d1/d75/res__pjsip__refer_8c_source.html#l00946">invite_replaces::session</a>.</p>
<div class="fragment"><div class="line"><a name="l00955"></a><span class="lineno">  955</span>&#160;{</div><div class="line"><a name="l00956"></a><span class="lineno">  956</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d8/d70/structinvite__replaces.html">invite_replaces</a> *invite = data;</div><div class="line"><a name="l00957"></a><span class="lineno">  957</span>&#160;</div><div class="line"><a name="l00958"></a><span class="lineno">  958</span>&#160;   <span class="keywordflow">if</span> (!invite-&gt;<a class="code" href="../../d8/d70/structinvite__replaces.html#a47bd1bb949183a58a194970acaccffbd">session</a>-&gt;<a class="code" href="../../d2/dec/structast__sip__session.html#a48371aaa1ad1144e564ebcd179a2db2e">channel</a>) {</div><div class="line"><a name="l00959"></a><span class="lineno">  959</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l00960"></a><span class="lineno">  960</span>&#160;   }</div><div class="line"><a name="l00961"></a><span class="lineno">  961</span>&#160;</div><div class="line"><a name="l00962"></a><span class="lineno">  962</span>&#160;   <a class="code" href="../../d5/d7b/channel_8h.html#a6801c703e767d6f760c54c8b86a30024">ast_channel_ref</a>(invite-&gt;<a class="code" href="../../d8/d70/structinvite__replaces.html#a47bd1bb949183a58a194970acaccffbd">session</a>-&gt;<a class="code" href="../../d2/dec/structast__sip__session.html#a48371aaa1ad1144e564ebcd179a2db2e">channel</a>);</div><div class="line"><a name="l00963"></a><span class="lineno">  963</span>&#160;   invite-&gt;<a class="code" href="../../d8/d70/structinvite__replaces.html#a48371aaa1ad1144e564ebcd179a2db2e">channel</a> = invite-&gt;<a class="code" href="../../d8/d70/structinvite__replaces.html#a47bd1bb949183a58a194970acaccffbd">session</a>-&gt;<a class="code" href="../../d2/dec/structast__sip__session.html#a48371aaa1ad1144e564ebcd179a2db2e">channel</a>;</div><div class="line"><a name="l00964"></a><span class="lineno">  964</span>&#160;</div><div class="line"><a name="l00965"></a><span class="lineno">  965</span>&#160;   invite-&gt;<a class="code" href="../../d8/d70/structinvite__replaces.html#a4fe7571e3c1759f3689d4453c132bdb7">bridge</a> = <a class="code" href="../../d4/d56/bridge_8h.html#acf7de35a81822873b105c08e1c22826f">ast_bridge_transfer_acquire_bridge</a>(invite-&gt;<a class="code" href="../../d8/d70/structinvite__replaces.html#a48371aaa1ad1144e564ebcd179a2db2e">channel</a>);</div><div class="line"><a name="l00966"></a><span class="lineno">  966</span>&#160;   <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00967"></a><span class="lineno">  967</span>&#160;}</div><div class="ttc" id="structinvite__replaces_html"><div class="ttname"><a href="../../d8/d70/structinvite__replaces.html">invite_replaces</a></div><div class="ttdoc">Structure used to retrieve channel from another session. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d75/res__pjsip__refer_8c_source.html#l00944">res_pjsip_refer.c:944</a></div></div>
<div class="ttc" id="structinvite__replaces_html_a4fe7571e3c1759f3689d4453c132bdb7"><div class="ttname"><a href="../../d8/d70/structinvite__replaces.html#a4fe7571e3c1759f3689d4453c132bdb7">invite_replaces::bridge</a></div><div class="ttdeci">struct ast_bridge * bridge</div><div class="ttdoc">Bridge the channel is in. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d75/res__pjsip__refer_8c_source.html#l00950">res_pjsip_refer.c:950</a></div></div>
<div class="ttc" id="bridge_8h_html_acf7de35a81822873b105c08e1c22826f"><div class="ttname"><a href="../../d4/d56/bridge_8h.html#acf7de35a81822873b105c08e1c22826f">ast_bridge_transfer_acquire_bridge</a></div><div class="ttdeci">struct ast_bridge * ast_bridge_transfer_acquire_bridge(struct ast_channel *chan)</div><div class="ttdoc">Acquire the channel&amp;#39;s bridge for transfer purposes. </div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d95/bridge_8c_source.html#l04460">bridge.c:4460</a></div></div>
<div class="ttc" id="structast__sip__session_html_a48371aaa1ad1144e564ebcd179a2db2e"><div class="ttname"><a href="../../d2/dec/structast__sip__session.html#a48371aaa1ad1144e564ebcd179a2db2e">ast_sip_session::channel</a></div><div class="ttdeci">struct ast_channel * channel</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/de7/res__pjsip__session_8h_source.html#l00189">res_pjsip_session.h:189</a></div></div>
<div class="ttc" id="structinvite__replaces_html_a47bd1bb949183a58a194970acaccffbd"><div class="ttname"><a href="../../d8/d70/structinvite__replaces.html#a47bd1bb949183a58a194970acaccffbd">invite_replaces::session</a></div><div class="ttdeci">struct ast_sip_session * session</div><div class="ttdoc">Session we want the channel from. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d75/res__pjsip__refer_8c_source.html#l00946">res_pjsip_refer.c:946</a></div></div>
<div class="ttc" id="channel_8h_html_a6801c703e767d6f760c54c8b86a30024"><div class="ttname"><a href="../../d5/d7b/channel_8h.html#a6801c703e767d6f760c54c8b86a30024">ast_channel_ref</a></div><div class="ttdeci">#define ast_channel_ref(c)</div><div class="ttdoc">Increase channel reference count. </div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d7b/channel_8h_source.html#l02970">channel.h:2970</a></div></div>
<div class="ttc" id="structinvite__replaces_html_a48371aaa1ad1144e564ebcd179a2db2e"><div class="ttname"><a href="../../d8/d70/structinvite__replaces.html#a48371aaa1ad1144e564ebcd179a2db2e">invite_replaces::channel</a></div><div class="ttdeci">struct ast_channel * channel</div><div class="ttdoc">Channel from the session (with reference) </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d75/res__pjsip__refer_8c_source.html#l00948">res_pjsip_refer.c:948</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="ac3382bf6da54c56b37069bd76bbdf4f9"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac3382bf6da54c56b37069bd76bbdf4f9">&#9670;&nbsp;</a></span>load_module()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int load_module </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="../../d1/d75/res__pjsip__refer_8c_source.html#l01262">1262</a> of file <a class="el" href="../../d1/d75/res__pjsip__refer_8c_source.html">res_pjsip_refer.c</a>.</p>

<p class="reference">References <a class="el" href="../../d5/d16/module_8h_source.html#l00070">AST_MODULE_LOAD_SUCCESS</a>, <a class="el" href="../../d5/d16/module_8h_source.html#l00464">ast_module_shutdown_ref</a>, <a class="el" href="../../dd/dfd/config__global_8c_source.html#l00507">ast_sip_get_norefersub()</a>, <a class="el" href="../../de/d96/res__pjsip_8c_source.html#l03718">ast_sip_get_pjsip_endpoint()</a>, <a class="el" href="../../de/d96/res__pjsip_8c_source.html#l03315">ast_sip_register_service()</a>, <a class="el" href="../../d9/de7/res__pjsip__session_8h_source.html#l00616">ast_sip_session_register_supplement</a>, <a class="el" href="../../dc/d7f/resample_8c_source.html#l00096">NULL</a>, <a class="el" href="../../d1/d75/res__pjsip__refer_8c_source.html#l00080">refer_progress_module</a>, and <a class="el" href="../../d5/d16/module_8h_source.html#l00342">ast_module_info::self</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../d1/d75/res__pjsip__refer_8c_source.html#l01281">unload_module()</a>.</p>
<div class="fragment"><div class="line"><a name="l01263"></a><span class="lineno"> 1263</span>&#160;{</div><div class="line"><a name="l01264"></a><span class="lineno"> 1264</span>&#160;   <span class="keyword">const</span> pj_str_t str_norefersub = { <span class="stringliteral">&quot;norefersub&quot;</span>, 10 };</div><div class="line"><a name="l01265"></a><span class="lineno"> 1265</span>&#160;</div><div class="line"><a name="l01266"></a><span class="lineno"> 1266</span>&#160;   pjsip_replaces_init_module(<a class="code" href="../../d8/d8c/res__pjsip_8h.html#a785afb501e315c8a97ad476fb6a8be1d">ast_sip_get_pjsip_endpoint</a>());</div><div class="line"><a name="l01267"></a><span class="lineno"> 1267</span>&#160;   pjsip_xfer_init_module(<a class="code" href="../../d8/d8c/res__pjsip_8h.html#a785afb501e315c8a97ad476fb6a8be1d">ast_sip_get_pjsip_endpoint</a>());</div><div class="line"><a name="l01268"></a><span class="lineno"> 1268</span>&#160;</div><div class="line"><a name="l01269"></a><span class="lineno"> 1269</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d8/d8c/res__pjsip_8h.html#a0ba92141c24bf4204831637d8e4a205a">ast_sip_get_norefersub</a>()) {</div><div class="line"><a name="l01270"></a><span class="lineno"> 1270</span>&#160;      pjsip_endpt_add_capability(<a class="code" href="../../d8/d8c/res__pjsip_8h.html#a785afb501e315c8a97ad476fb6a8be1d">ast_sip_get_pjsip_endpoint</a>(), <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, PJSIP_H_SUPPORTED, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, 1, &amp;str_norefersub);</div><div class="line"><a name="l01271"></a><span class="lineno"> 1271</span>&#160;   }</div><div class="line"><a name="l01272"></a><span class="lineno"> 1272</span>&#160;</div><div class="line"><a name="l01273"></a><span class="lineno"> 1273</span>&#160;   <a class="code" href="../../d8/d8c/res__pjsip_8h.html#a2d923ef44f62dffc05178f762b88f084">ast_sip_register_service</a>(&amp;<a class="code" href="../../d1/d75/res__pjsip__refer_8c.html#a43579c197f6efc45d0093d0ab8cba536">refer_progress_module</a>);</div><div class="line"><a name="l01274"></a><span class="lineno"> 1274</span>&#160;   <a class="code" href="../../d9/de7/res__pjsip__session_8h.html#aa21df5d2fdfb2d6e2734a3056ec3db7c">ast_sip_session_register_supplement</a>(&amp;<a class="code" href="../../d1/d75/res__pjsip__refer_8c.html#a366b18e6269e3453a3bae9a35df9334a">refer_supplement</a>);</div><div class="line"><a name="l01275"></a><span class="lineno"> 1275</span>&#160;</div><div class="line"><a name="l01276"></a><span class="lineno"> 1276</span>&#160;   <a class="code" href="../../d5/d16/module_8h.html#a9967b09817639f2e15c3f074a60b6379">ast_module_shutdown_ref</a>(<a class="code" href="../../dd/d5f/structast__module__info.html">ast_module_info</a>-&gt;<a class="code" href="../../dd/d5f/structast__module__info.html#a1aff0615d43e1dfa5c72c1c7d1c6d709">self</a>);</div><div class="line"><a name="l01277"></a><span class="lineno"> 1277</span>&#160;</div><div class="line"><a name="l01278"></a><span class="lineno"> 1278</span>&#160;   <span class="keywordflow">return</span> <a class="code" href="../../d5/d16/module_8h.html#adc09474f0ff557e9925b722ee5b952dfa89bb877ade9ce418ad6663f3d936f314">AST_MODULE_LOAD_SUCCESS</a>;</div><div class="line"><a name="l01279"></a><span class="lineno"> 1279</span>&#160;}</div><div class="ttc" id="module_8h_html_adc09474f0ff557e9925b722ee5b952dfa89bb877ade9ce418ad6663f3d936f314"><div class="ttname"><a href="../../d5/d16/module_8h.html#adc09474f0ff557e9925b722ee5b952dfa89bb877ade9ce418ad6663f3d936f314">AST_MODULE_LOAD_SUCCESS</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d16/module_8h_source.html#l00070">module.h:70</a></div></div>
<div class="ttc" id="res__pjsip__refer_8c_html_a366b18e6269e3453a3bae9a35df9334a"><div class="ttname"><a href="../../d1/d75/res__pjsip__refer_8c.html#a366b18e6269e3453a3bae9a35df9334a">refer_supplement</a></div><div class="ttdeci">static struct ast_sip_session_supplement refer_supplement</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d75/res__pjsip__refer_8c_source.html#l01256">res_pjsip_refer.c:1256</a></div></div>
<div class="ttc" id="structast__module__info_html"><div class="ttname"><a href="../../dd/d5f/structast__module__info.html">ast_module_info</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d16/module_8h_source.html#l00336">module.h:336</a></div></div>
<div class="ttc" id="res__pjsip_8h_html_a0ba92141c24bf4204831637d8e4a205a"><div class="ttname"><a href="../../d8/d8c/res__pjsip_8h.html#a0ba92141c24bf4204831637d8e4a205a">ast_sip_get_norefersub</a></div><div class="ttdeci">unsigned int ast_sip_get_norefersub(void)</div><div class="ttdoc">Retrieve the global setting &amp;#39;norefersub&amp;#39;. </div><div class="ttdef"><b>Definition:</b> <a href="../../dd/dfd/config__global_8c_source.html#l00507">config_global.c:507</a></div></div>
<div class="ttc" id="resample_8c_html_a070d2ce7b6bb7e5c05602aa8c308d0c4"><div class="ttname"><a href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a></div><div class="ttdeci">#define NULL</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d7f/resample_8c_source.html#l00096">resample.c:96</a></div></div>
<div class="ttc" id="res__pjsip__refer_8c_html_a43579c197f6efc45d0093d0ab8cba536"><div class="ttname"><a href="../../d1/d75/res__pjsip__refer_8c.html#a43579c197f6efc45d0093d0ab8cba536">refer_progress_module</a></div><div class="ttdeci">static pjsip_module refer_progress_module</div><div class="ttdoc">REFER Progress module, used to attach REFER progress structure to subscriptions. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d75/res__pjsip__refer_8c_source.html#l00080">res_pjsip_refer.c:80</a></div></div>
<div class="ttc" id="structast__module__info_html_a1aff0615d43e1dfa5c72c1c7d1c6d709"><div class="ttname"><a href="../../dd/d5f/structast__module__info.html#a1aff0615d43e1dfa5c72c1c7d1c6d709">ast_module_info::self</a></div><div class="ttdeci">struct ast_module * self</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d16/module_8h_source.html#l00342">module.h:342</a></div></div>
<div class="ttc" id="res__pjsip_8h_html_a2d923ef44f62dffc05178f762b88f084"><div class="ttname"><a href="../../d8/d8c/res__pjsip_8h.html#a2d923ef44f62dffc05178f762b88f084">ast_sip_register_service</a></div><div class="ttdeci">int ast_sip_register_service(pjsip_module *module)</div><div class="ttdoc">Register a SIP service in Asterisk. </div><div class="ttdef"><b>Definition:</b> <a href="../../de/d96/res__pjsip_8c_source.html#l03315">res_pjsip.c:3315</a></div></div>
<div class="ttc" id="module_8h_html_a9967b09817639f2e15c3f074a60b6379"><div class="ttname"><a href="../../d5/d16/module_8h.html#a9967b09817639f2e15c3f074a60b6379">ast_module_shutdown_ref</a></div><div class="ttdeci">#define ast_module_shutdown_ref(mod)</div><div class="ttdoc">Prevent unload of the module before shutdown. </div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d16/module_8h_source.html#l00464">module.h:464</a></div></div>
<div class="ttc" id="res__pjsip_8h_html_a785afb501e315c8a97ad476fb6a8be1d"><div class="ttname"><a href="../../d8/d8c/res__pjsip_8h.html#a785afb501e315c8a97ad476fb6a8be1d">ast_sip_get_pjsip_endpoint</a></div><div class="ttdeci">pjsip_endpoint * ast_sip_get_pjsip_endpoint(void)</div><div class="ttdoc">Get a pointer to the PJSIP endpoint. </div><div class="ttdef"><b>Definition:</b> <a href="../../de/d96/res__pjsip_8c_source.html#l03718">res_pjsip.c:3718</a></div></div>
<div class="ttc" id="res__pjsip__session_8h_html_aa21df5d2fdfb2d6e2734a3056ec3db7c"><div class="ttname"><a href="../../d9/de7/res__pjsip__session_8h.html#aa21df5d2fdfb2d6e2734a3056ec3db7c">ast_sip_session_register_supplement</a></div><div class="ttdeci">#define ast_sip_session_register_supplement(supplement)</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/de7/res__pjsip__session_8h_source.html#l00616">res_pjsip_session.h:616</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a6d7634cbb9a37cc1e5acc87277b455f5"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6d7634cbb9a37cc1e5acc87277b455f5">&#9670;&nbsp;</a></span>refer_attended_alloc()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static struct <a class="el" href="../../dc/d15/structrefer__attended.html">refer_attended</a>* refer_attended_alloc </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="../../d2/dec/structast__sip__session.html">ast_sip_session</a> *&#160;</td>
          <td class="paramname"><em>transferer</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="../../d2/dec/structast__sip__session.html">ast_sip_session</a> *&#160;</td>
          <td class="paramname"><em>transferer_second</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="../../d0/d4b/structrefer__progress.html">refer_progress</a> *&#160;</td>
          <td class="paramname"><em>progress</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Allocator for attended transfer task. </p>

<p class="definition">Definition at line <a class="el" href="../../d1/d75/res__pjsip__refer_8c_source.html#l00475">475</a> of file <a class="el" href="../../d1/d75/res__pjsip__refer_8c_source.html">res_pjsip_refer.c</a>.</p>

<p class="reference">References <a class="el" href="../../d5/da5/astobj2_8h_source.html#l00369">AO2_ALLOC_OPT_LOCK_NOLOCK</a>, <a class="el" href="../../d5/da5/astobj2_8h_source.html#l00406">ao2_alloc_options</a>, <a class="el" href="../../d5/da5/astobj2_8h_source.html#l00464">ao2_ref</a>, <a class="el" href="../../d5/d7b/channel_8h_source.html#l02970">ast_channel_ref</a>, <a class="el" href="../../d9/de7/res__pjsip__session_8h_source.html#l00189">ast_sip_session::channel</a>, <a class="el" href="../../dc/d7f/resample_8c_source.html#l00096">NULL</a>, <a class="el" href="../../d1/d75/res__pjsip__refer_8c_source.html#l00460">refer_attended::progress</a>, <a class="el" href="../../d1/d75/res__pjsip__refer_8c_source.html#l00464">refer_attended_destroy()</a>, <a class="el" href="../../d1/d75/res__pjsip__refer_8c_source.html#l00454">refer_attended::transferer</a>, <a class="el" href="../../d1/d75/res__pjsip__refer_8c_source.html#l00456">refer_attended::transferer_chan</a>, and <a class="el" href="../../d1/d75/res__pjsip__refer_8c_source.html#l00458">refer_attended::transferer_second</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../d1/d75/res__pjsip__refer_8c_source.html#l00789">refer_incoming_attended_request()</a>.</p>
<div class="fragment"><div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;{</div><div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../dc/d15/structrefer__attended.html">refer_attended</a> *attended;</div><div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;</div><div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;   attended = <a class="code" href="../../d5/da5/astobj2_8h.html#ab3c44e28d661616129b7819069effe61">ao2_alloc_options</a>(<span class="keyword">sizeof</span>(*attended), <a class="code" href="../../d1/d75/res__pjsip__refer_8c.html#a7658e07b1e5539b7ad89022096e3be03">refer_attended_destroy</a>,</div><div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;      <a class="code" href="../../d5/da5/astobj2_8h.html#a2cf7e3433f08351aafe3b0cd31edf7f8a23b60f2636bcfbc4dfeea6cc21bf847b">AO2_ALLOC_OPT_LOCK_NOLOCK</a>);</div><div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;   <span class="keywordflow">if</span> (!attended) {</div><div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;   }</div><div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;</div><div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(transferer, +1);</div><div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;   attended-&gt;<a class="code" href="../../dc/d15/structrefer__attended.html#a346c86ca97ec97def2f38fddbc173174">transferer</a> = <a class="code" href="../../dc/d15/structrefer__attended.html#a346c86ca97ec97def2f38fddbc173174">transferer</a>;</div><div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;   <a class="code" href="../../d5/d7b/channel_8h.html#a6801c703e767d6f760c54c8b86a30024">ast_channel_ref</a>(transferer-&gt;<a class="code" href="../../d2/dec/structast__sip__session.html#a48371aaa1ad1144e564ebcd179a2db2e">channel</a>);</div><div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;   attended-&gt;<a class="code" href="../../dc/d15/structrefer__attended.html#acb6fd2c0f6b39a00d54d4e2a311381e6">transferer_chan</a> = transferer-&gt;<a class="code" href="../../d2/dec/structast__sip__session.html#a48371aaa1ad1144e564ebcd179a2db2e">channel</a>;</div><div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(transferer_second, +1);</div><div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;   attended-&gt;<a class="code" href="../../dc/d15/structrefer__attended.html#a499bbeaf70a8cca72458ce32016c99d4">transferer_second</a> = <a class="code" href="../../dc/d15/structrefer__attended.html#a499bbeaf70a8cca72458ce32016c99d4">transferer_second</a>;</div><div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;</div><div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;   <span class="keywordflow">if</span> (progress) {</div><div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;      <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(progress, +1);</div><div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;      attended-&gt;<a class="code" href="../../dc/d15/structrefer__attended.html#a78ae786167e10c748e902a68acf1138d">progress</a> = <a class="code" href="../../dc/d15/structrefer__attended.html#a78ae786167e10c748e902a68acf1138d">progress</a>;</div><div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;   }</div><div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;</div><div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;   <span class="keywordflow">return</span> attended;</div><div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;}</div><div class="ttc" id="structrefer__attended_html_a78ae786167e10c748e902a68acf1138d"><div class="ttname"><a href="../../dc/d15/structrefer__attended.html#a78ae786167e10c748e902a68acf1138d">refer_attended::progress</a></div><div class="ttdeci">struct refer_progress * progress</div><div class="ttdoc">Optional refer progress structure. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d75/res__pjsip__refer_8c_source.html#l00460">res_pjsip_refer.c:460</a></div></div>
<div class="ttc" id="astobj2_8h_html_a2cf7e3433f08351aafe3b0cd31edf7f8a23b60f2636bcfbc4dfeea6cc21bf847b"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#a2cf7e3433f08351aafe3b0cd31edf7f8a23b60f2636bcfbc4dfeea6cc21bf847b">AO2_ALLOC_OPT_LOCK_NOLOCK</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l00369">astobj2.h:369</a></div></div>
<div class="ttc" id="structrefer__attended_html_a346c86ca97ec97def2f38fddbc173174"><div class="ttname"><a href="../../dc/d15/structrefer__attended.html#a346c86ca97ec97def2f38fddbc173174">refer_attended::transferer</a></div><div class="ttdeci">struct ast_sip_session * transferer</div><div class="ttdoc">Transferer session. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d75/res__pjsip__refer_8c_source.html#l00454">res_pjsip_refer.c:454</a></div></div>
<div class="ttc" id="structrefer__attended_html_a499bbeaf70a8cca72458ce32016c99d4"><div class="ttname"><a href="../../dc/d15/structrefer__attended.html#a499bbeaf70a8cca72458ce32016c99d4">refer_attended::transferer_second</a></div><div class="ttdeci">struct ast_sip_session * transferer_second</div><div class="ttdoc">Second transferer session. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d75/res__pjsip__refer_8c_source.html#l00458">res_pjsip_refer.c:458</a></div></div>
<div class="ttc" id="structrefer__attended_html"><div class="ttname"><a href="../../dc/d15/structrefer__attended.html">refer_attended</a></div><div class="ttdoc">Structure for attended transfer task. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d75/res__pjsip__refer_8c_source.html#l00452">res_pjsip_refer.c:452</a></div></div>
<div class="ttc" id="astobj2_8h_html_ab3c44e28d661616129b7819069effe61"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#ab3c44e28d661616129b7819069effe61">ao2_alloc_options</a></div><div class="ttdeci">#define ao2_alloc_options(data_size, destructor_fn, options)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l00406">astobj2.h:406</a></div></div>
<div class="ttc" id="res__pjsip__refer_8c_html_a7658e07b1e5539b7ad89022096e3be03"><div class="ttname"><a href="../../d1/d75/res__pjsip__refer_8c.html#a7658e07b1e5539b7ad89022096e3be03">refer_attended_destroy</a></div><div class="ttdeci">static void refer_attended_destroy(void *obj)</div><div class="ttdoc">Destructor for attended transfer task. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d75/res__pjsip__refer_8c_source.html#l00464">res_pjsip_refer.c:464</a></div></div>
<div class="ttc" id="resample_8c_html_a070d2ce7b6bb7e5c05602aa8c308d0c4"><div class="ttname"><a href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a></div><div class="ttdeci">#define NULL</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d7f/resample_8c_source.html#l00096">resample.c:96</a></div></div>
<div class="ttc" id="astobj2_8h_html_aaca5e8eac39a22f9da1c36fc6c922270"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a></div><div class="ttdeci">#define ao2_ref(o, delta)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l00464">astobj2.h:464</a></div></div>
<div class="ttc" id="structast__sip__session_html_a48371aaa1ad1144e564ebcd179a2db2e"><div class="ttname"><a href="../../d2/dec/structast__sip__session.html#a48371aaa1ad1144e564ebcd179a2db2e">ast_sip_session::channel</a></div><div class="ttdeci">struct ast_channel * channel</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/de7/res__pjsip__session_8h_source.html#l00189">res_pjsip_session.h:189</a></div></div>
<div class="ttc" id="channel_8h_html_a6801c703e767d6f760c54c8b86a30024"><div class="ttname"><a href="../../d5/d7b/channel_8h.html#a6801c703e767d6f760c54c8b86a30024">ast_channel_ref</a></div><div class="ttdeci">#define ast_channel_ref(c)</div><div class="ttdoc">Increase channel reference count. </div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d7b/channel_8h_source.html#l02970">channel.h:2970</a></div></div>
<div class="ttc" id="structrefer__attended_html_acb6fd2c0f6b39a00d54d4e2a311381e6"><div class="ttname"><a href="../../dc/d15/structrefer__attended.html#acb6fd2c0f6b39a00d54d4e2a311381e6">refer_attended::transferer_chan</a></div><div class="ttdeci">struct ast_channel * transferer_chan</div><div class="ttdoc">Transferer channel. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d75/res__pjsip__refer_8c_source.html#l00456">res_pjsip_refer.c:456</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a7658e07b1e5539b7ad89022096e3be03"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a7658e07b1e5539b7ad89022096e3be03">&#9670;&nbsp;</a></span>refer_attended_destroy()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void refer_attended_destroy </td>
          <td>(</td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>obj</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Destructor for attended transfer task. </p>

<p class="definition">Definition at line <a class="el" href="../../d1/d75/res__pjsip__refer_8c_source.html#l00464">464</a> of file <a class="el" href="../../d1/d75/res__pjsip__refer_8c_source.html">res_pjsip_refer.c</a>.</p>

<p class="reference">References <a class="el" href="../../d5/da5/astobj2_8h_source.html#l01958">ao2_cleanup</a>, <a class="el" href="../../d5/d7b/channel_8h_source.html#l02992">ast_channel_cleanup</a>, <a class="el" href="../../d1/d75/res__pjsip__refer_8c_source.html#l00460">refer_attended::progress</a>, <a class="el" href="../../d1/d75/res__pjsip__refer_8c_source.html#l00454">refer_attended::transferer</a>, <a class="el" href="../../d1/d75/res__pjsip__refer_8c_source.html#l00456">refer_attended::transferer_chan</a>, and <a class="el" href="../../d1/d75/res__pjsip__refer_8c_source.html#l00458">refer_attended::transferer_second</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../d1/d75/res__pjsip__refer_8c_source.html#l00475">refer_attended_alloc()</a>.</p>
<div class="fragment"><div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;{</div><div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../dc/d15/structrefer__attended.html">refer_attended</a> *attended = obj;</div><div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;</div><div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#a6321ee982370c55ab3c24c72c562cbdd">ao2_cleanup</a>(attended-&gt;<a class="code" href="../../dc/d15/structrefer__attended.html#a346c86ca97ec97def2f38fddbc173174">transferer</a>);</div><div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;   <a class="code" href="../../d5/d7b/channel_8h.html#ae93ebb3372a2d9495ae3c5417dd95cd5">ast_channel_cleanup</a>(attended-&gt;<a class="code" href="../../dc/d15/structrefer__attended.html#acb6fd2c0f6b39a00d54d4e2a311381e6">transferer_chan</a>);</div><div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#a6321ee982370c55ab3c24c72c562cbdd">ao2_cleanup</a>(attended-&gt;<a class="code" href="../../dc/d15/structrefer__attended.html#a499bbeaf70a8cca72458ce32016c99d4">transferer_second</a>);</div><div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#a6321ee982370c55ab3c24c72c562cbdd">ao2_cleanup</a>(attended-&gt;<a class="code" href="../../dc/d15/structrefer__attended.html#a78ae786167e10c748e902a68acf1138d">progress</a>);</div><div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;}</div><div class="ttc" id="structrefer__attended_html_a78ae786167e10c748e902a68acf1138d"><div class="ttname"><a href="../../dc/d15/structrefer__attended.html#a78ae786167e10c748e902a68acf1138d">refer_attended::progress</a></div><div class="ttdeci">struct refer_progress * progress</div><div class="ttdoc">Optional refer progress structure. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d75/res__pjsip__refer_8c_source.html#l00460">res_pjsip_refer.c:460</a></div></div>
<div class="ttc" id="structrefer__attended_html_a346c86ca97ec97def2f38fddbc173174"><div class="ttname"><a href="../../dc/d15/structrefer__attended.html#a346c86ca97ec97def2f38fddbc173174">refer_attended::transferer</a></div><div class="ttdeci">struct ast_sip_session * transferer</div><div class="ttdoc">Transferer session. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d75/res__pjsip__refer_8c_source.html#l00454">res_pjsip_refer.c:454</a></div></div>
<div class="ttc" id="structrefer__attended_html_a499bbeaf70a8cca72458ce32016c99d4"><div class="ttname"><a href="../../dc/d15/structrefer__attended.html#a499bbeaf70a8cca72458ce32016c99d4">refer_attended::transferer_second</a></div><div class="ttdeci">struct ast_sip_session * transferer_second</div><div class="ttdoc">Second transferer session. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d75/res__pjsip__refer_8c_source.html#l00458">res_pjsip_refer.c:458</a></div></div>
<div class="ttc" id="structrefer__attended_html"><div class="ttname"><a href="../../dc/d15/structrefer__attended.html">refer_attended</a></div><div class="ttdoc">Structure for attended transfer task. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d75/res__pjsip__refer_8c_source.html#l00452">res_pjsip_refer.c:452</a></div></div>
<div class="ttc" id="channel_8h_html_ae93ebb3372a2d9495ae3c5417dd95cd5"><div class="ttname"><a href="../../d5/d7b/channel_8h.html#ae93ebb3372a2d9495ae3c5417dd95cd5">ast_channel_cleanup</a></div><div class="ttdeci">#define ast_channel_cleanup(c)</div><div class="ttdoc">Cleanup a channel reference. </div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d7b/channel_8h_source.html#l02992">channel.h:2992</a></div></div>
<div class="ttc" id="astobj2_8h_html_a6321ee982370c55ab3c24c72c562cbdd"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#a6321ee982370c55ab3c24c72c562cbdd">ao2_cleanup</a></div><div class="ttdeci">#define ao2_cleanup(obj)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l01958">astobj2.h:1958</a></div></div>
<div class="ttc" id="structrefer__attended_html_acb6fd2c0f6b39a00d54d4e2a311381e6"><div class="ttname"><a href="../../dc/d15/structrefer__attended.html#acb6fd2c0f6b39a00d54d4e2a311381e6">refer_attended::transferer_chan</a></div><div class="ttdeci">struct ast_channel * transferer_chan</div><div class="ttdoc">Transferer channel. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d75/res__pjsip__refer_8c_source.html#l00456">res_pjsip_refer.c:456</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a81d8534849ca3b33df588163b6665f94"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a81d8534849ca3b33df588163b6665f94">&#9670;&nbsp;</a></span>refer_attended_task()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int refer_attended_task </td>
          <td>(</td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>data</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Task for attended transfer executed by attended-&gt;transferer_second serializer. </p>

<p class="definition">Definition at line <a class="el" href="../../d1/d75/res__pjsip__refer_8c_source.html#l00553">553</a> of file <a class="el" href="../../d1/d75/res__pjsip__refer_8c_source.html">res_pjsip_refer.c</a>.</p>

<p class="reference">References <a class="el" href="../../d5/da5/astobj2_8h_source.html#l01958">ao2_cleanup</a>, <a class="el" href="../../d5/da5/astobj2_8h_source.html#l00464">ao2_ref</a>, <a class="el" href="../../d0/d95/bridge_8c_source.html#l04729">ast_bridge_transfer_attended()</a>, <a class="el" href="../../d5/d7b/channel_8h.html#a7ca2fda13b129a55c251b56729de285b">ast_channel_name()</a>, <a class="el" href="../../d1/d8c/logger_8h_source.html#l00452">ast_debug</a>, <a class="el" href="../../de/d96/res__pjsip_8c_source.html#l05138">ast_sip_push_task()</a>, <a class="el" href="../../d4/d92/res__pjsip__session_8c_source.html#l03614">ast_sip_session_end_if_deferred()</a>, <a class="el" href="../../d9/de7/res__pjsip__session_8h_source.html#l00189">ast_sip_session::channel</a>, <a class="el" href="../../d1/d75/res__pjsip__refer_8c_source.html#l00511">defer_termination_cancel_task()</a>, <a class="el" href="../../dc/d7f/resample_8c_source.html#l00096">NULL</a>, <a class="el" href="../../d1/d75/res__pjsip__refer_8c_source.html#l00460">refer_attended::progress</a>, <a class="el" href="../../d1/d75/res__pjsip__refer_8c_source.html#l00094">refer_progress_notification_alloc()</a>, <a class="el" href="../../d1/d75/res__pjsip__refer_8c_source.html#l00140">refer_progress_notify()</a>, <a class="el" href="../../d1/d75/res__pjsip__refer_8c_source.html#l00056">refer_progress::serializer</a>, <a class="el" href="../../d9/de7/res__pjsip__session_8h_source.html#l00195">ast_sip_session::serializer</a>, <a class="el" href="../../d1/d75/res__pjsip__refer_8c_source.html#l00502">session_end_if_deferred_task()</a>, <a class="el" href="../../d1/d75/res__pjsip__refer_8c_source.html#l00454">refer_attended::transferer</a>, <a class="el" href="../../d1/d75/res__pjsip__refer_8c_source.html#l00456">refer_attended::transferer_chan</a>, <a class="el" href="../../d1/d75/res__pjsip__refer_8c_source.html#l00458">refer_attended::transferer_second</a>, and <a class="el" href="../../d1/d75/res__pjsip__refer_8c_source.html#l00530">xfer_response_code2sip()</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../d1/d75/res__pjsip__refer_8c_source.html#l00789">refer_incoming_attended_request()</a>.</p>
<div class="fragment"><div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;{</div><div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../dc/d15/structrefer__attended.html">refer_attended</a> *attended = data;</div><div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;   <span class="keywordtype">int</span> response;</div><div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;   int (*task_cb)(<span class="keywordtype">void</span> *data);</div><div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;</div><div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;   <span class="keywordflow">if</span> (attended-&gt;<a class="code" href="../../dc/d15/structrefer__attended.html#a499bbeaf70a8cca72458ce32016c99d4">transferer_second</a>-&gt;<a class="code" href="../../d2/dec/structast__sip__session.html#a48371aaa1ad1144e564ebcd179a2db2e">channel</a>) {</div><div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;      <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(3, <span class="stringliteral">&quot;Performing a REFER attended transfer - Transferer #1: %s Transferer #2: %s\n&quot;</span>,</div><div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;         <a class="code" href="../../d5/d7b/channel_8h.html#a7ca2fda13b129a55c251b56729de285b">ast_channel_name</a>(attended-&gt;<a class="code" href="../../dc/d15/structrefer__attended.html#acb6fd2c0f6b39a00d54d4e2a311381e6">transferer_chan</a>),</div><div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;         <a class="code" href="../../d5/d7b/channel_8h.html#a7ca2fda13b129a55c251b56729de285b">ast_channel_name</a>(attended-&gt;<a class="code" href="../../dc/d15/structrefer__attended.html#a499bbeaf70a8cca72458ce32016c99d4">transferer_second</a>-&gt;<a class="code" href="../../d2/dec/structast__sip__session.html#a48371aaa1ad1144e564ebcd179a2db2e">channel</a>));</div><div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;</div><div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;      response = <a class="code" href="../../d1/d75/res__pjsip__refer_8c.html#a1d1a233825b31a62bc5074299f4b273c">xfer_response_code2sip</a>(<a class="code" href="../../d4/d56/bridge_8h.html#aec45146e91e4d8bc2a7d2cf083c4dac0">ast_bridge_transfer_attended</a>(</div><div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;         attended-&gt;<a class="code" href="../../dc/d15/structrefer__attended.html#acb6fd2c0f6b39a00d54d4e2a311381e6">transferer_chan</a>,</div><div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;         attended-&gt;<a class="code" href="../../dc/d15/structrefer__attended.html#a499bbeaf70a8cca72458ce32016c99d4">transferer_second</a>-&gt;<a class="code" href="../../d2/dec/structast__sip__session.html#a48371aaa1ad1144e564ebcd179a2db2e">channel</a>));</div><div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;</div><div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;      <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(3, <span class="stringliteral">&quot;Final response for REFER attended transfer - Transferer #1: %s Transferer #2: %s is &#39;%d&#39;\n&quot;</span>,</div><div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;         <a class="code" href="../../d5/d7b/channel_8h.html#a7ca2fda13b129a55c251b56729de285b">ast_channel_name</a>(attended-&gt;<a class="code" href="../../dc/d15/structrefer__attended.html#acb6fd2c0f6b39a00d54d4e2a311381e6">transferer_chan</a>),</div><div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;         <a class="code" href="../../d5/d7b/channel_8h.html#a7ca2fda13b129a55c251b56729de285b">ast_channel_name</a>(attended-&gt;<a class="code" href="../../dc/d15/structrefer__attended.html#a499bbeaf70a8cca72458ce32016c99d4">transferer_second</a>-&gt;<a class="code" href="../../d2/dec/structast__sip__session.html#a48371aaa1ad1144e564ebcd179a2db2e">channel</a>),</div><div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;         response);</div><div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;   } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;      <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(3, <span class="stringliteral">&quot;Received REFER request on channel &#39;%s&#39; but other channel has gone.\n&quot;</span>,</div><div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;         <a class="code" href="../../d5/d7b/channel_8h.html#a7ca2fda13b129a55c251b56729de285b">ast_channel_name</a>(attended-&gt;<a class="code" href="../../dc/d15/structrefer__attended.html#acb6fd2c0f6b39a00d54d4e2a311381e6">transferer_chan</a>));</div><div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;      response = 603;</div><div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;   }</div><div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;</div><div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;   <span class="keywordflow">if</span> (attended-&gt;<a class="code" href="../../dc/d15/structrefer__attended.html#a78ae786167e10c748e902a68acf1138d">progress</a>) {</div><div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;      <span class="keyword">struct </span><a class="code" href="../../d3/dff/structrefer__progress__notification.html">refer_progress_notification</a> *notification;</div><div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;</div><div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;      notification = <a class="code" href="../../d1/d75/res__pjsip__refer_8c.html#a89f2c1d96492b68d1399f20fc6eeb833">refer_progress_notification_alloc</a>(attended-&gt;<a class="code" href="../../dc/d15/structrefer__attended.html#a78ae786167e10c748e902a68acf1138d">progress</a>, response,</div><div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;         PJSIP_EVSUB_STATE_TERMINATED);</div><div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;      <span class="keywordflow">if</span> (notification) {</div><div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;         <span class="keywordflow">if</span> (<a class="code" href="../../d7/dfa/group__pjsip__threading.html#ga4f0a0629fa2ca084812772356d8e3565">ast_sip_push_task</a>(attended-&gt;<a class="code" href="../../dc/d15/structrefer__attended.html#a78ae786167e10c748e902a68acf1138d">progress</a>-&gt;<a class="code" href="../../d0/d4b/structrefer__progress.html#ac23e23ba60f358de78a893d537c0afa4">serializer</a>, <a class="code" href="../../d1/d75/res__pjsip__refer_8c.html#a5d2be3003a3c77234b90343bc0a43935">refer_progress_notify</a>, notification)) {</div><div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;            <a class="code" href="../../d5/da5/astobj2_8h.html#a6321ee982370c55ab3c24c72c562cbdd">ao2_cleanup</a>(notification);</div><div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;         }</div><div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;      }</div><div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;   }</div><div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;</div><div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;   <span class="keywordflow">if</span> (response == 200) {</div><div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;      task_cb = <a class="code" href="../../d1/d75/res__pjsip__refer_8c.html#ac2d698569813f09d32e13c7068adbbda">session_end_if_deferred_task</a>;</div><div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;   } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;      task_cb = <a class="code" href="../../d1/d75/res__pjsip__refer_8c.html#aa3cde726a80afa88dba59d8b777ee32d">defer_termination_cancel_task</a>;</div><div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;   }</div><div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;   <span class="keywordflow">if</span> (!<a class="code" href="../../d7/dfa/group__pjsip__threading.html#ga4f0a0629fa2ca084812772356d8e3565">ast_sip_push_task</a>(attended-&gt;<a class="code" href="../../dc/d15/structrefer__attended.html#a346c86ca97ec97def2f38fddbc173174">transferer</a>-&gt;<a class="code" href="../../d2/dec/structast__sip__session.html#ac23e23ba60f358de78a893d537c0afa4">serializer</a>,</div><div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;      task_cb, attended-&gt;<a class="code" href="../../dc/d15/structrefer__attended.html#a346c86ca97ec97def2f38fddbc173174">transferer</a>)) {</div><div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;      <span class="comment">/* Gave the ref to the pushed task. */</span></div><div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;      attended-&gt;<a class="code" href="../../dc/d15/structrefer__attended.html#a346c86ca97ec97def2f38fddbc173174">transferer</a> = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;   } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;      <span class="comment">/* Do this anyway even though it is the wrong serializer. */</span></div><div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;      <a class="code" href="../../d9/de7/res__pjsip__session_8h.html#aa55296422ab86c7de1d7f52e9c227d82">ast_sip_session_end_if_deferred</a>(attended-&gt;<a class="code" href="../../dc/d15/structrefer__attended.html#a346c86ca97ec97def2f38fddbc173174">transferer</a>);</div><div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;   }</div><div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;</div><div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(attended, -1);</div><div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;   <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;}</div><div class="ttc" id="bridge_8h_html_aec45146e91e4d8bc2a7d2cf083c4dac0"><div class="ttname"><a href="../../d4/d56/bridge_8h.html#aec45146e91e4d8bc2a7d2cf083c4dac0">ast_bridge_transfer_attended</a></div><div class="ttdeci">enum ast_transfer_result ast_bridge_transfer_attended(struct ast_channel *to_transferee, struct ast_channel *to_transfer_target)</div><div class="ttdoc">Attended transfer. </div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d95/bridge_8c_source.html#l04729">bridge.c:4729</a></div></div>
<div class="ttc" id="structrefer__attended_html_a78ae786167e10c748e902a68acf1138d"><div class="ttname"><a href="../../dc/d15/structrefer__attended.html#a78ae786167e10c748e902a68acf1138d">refer_attended::progress</a></div><div class="ttdeci">struct refer_progress * progress</div><div class="ttdoc">Optional refer progress structure. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d75/res__pjsip__refer_8c_source.html#l00460">res_pjsip_refer.c:460</a></div></div>
<div class="ttc" id="structrefer__attended_html_a346c86ca97ec97def2f38fddbc173174"><div class="ttname"><a href="../../dc/d15/structrefer__attended.html#a346c86ca97ec97def2f38fddbc173174">refer_attended::transferer</a></div><div class="ttdeci">struct ast_sip_session * transferer</div><div class="ttdoc">Transferer session. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d75/res__pjsip__refer_8c_source.html#l00454">res_pjsip_refer.c:454</a></div></div>
<div class="ttc" id="structrefer__attended_html_a499bbeaf70a8cca72458ce32016c99d4"><div class="ttname"><a href="../../dc/d15/structrefer__attended.html#a499bbeaf70a8cca72458ce32016c99d4">refer_attended::transferer_second</a></div><div class="ttdeci">struct ast_sip_session * transferer_second</div><div class="ttdoc">Second transferer session. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d75/res__pjsip__refer_8c_source.html#l00458">res_pjsip_refer.c:458</a></div></div>
<div class="ttc" id="structrefer__progress_html_ac23e23ba60f358de78a893d537c0afa4"><div class="ttname"><a href="../../d0/d4b/structrefer__progress.html#ac23e23ba60f358de78a893d537c0afa4">refer_progress::serializer</a></div><div class="ttdeci">struct ast_taskprocessor * serializer</div><div class="ttdoc">Serializer for notifications. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d75/res__pjsip__refer_8c_source.html#l00056">res_pjsip_refer.c:56</a></div></div>
<div class="ttc" id="structrefer__attended_html"><div class="ttname"><a href="../../dc/d15/structrefer__attended.html">refer_attended</a></div><div class="ttdoc">Structure for attended transfer task. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d75/res__pjsip__refer_8c_source.html#l00452">res_pjsip_refer.c:452</a></div></div>
<div class="ttc" id="structrefer__progress__notification_html"><div class="ttname"><a href="../../d3/dff/structrefer__progress__notification.html">refer_progress_notification</a></div><div class="ttdoc">REFER Progress notification structure. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d75/res__pjsip__refer_8c_source.html#l00070">res_pjsip_refer.c:70</a></div></div>
<div class="ttc" id="res__pjsip__refer_8c_html_aa3cde726a80afa88dba59d8b777ee32d"><div class="ttname"><a href="../../d1/d75/res__pjsip__refer_8c.html#aa3cde726a80afa88dba59d8b777ee32d">defer_termination_cancel_task</a></div><div class="ttdeci">static int defer_termination_cancel_task(void *data)</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d75/res__pjsip__refer_8c_source.html#l00511">res_pjsip_refer.c:511</a></div></div>
<div class="ttc" id="resample_8c_html_a070d2ce7b6bb7e5c05602aa8c308d0c4"><div class="ttname"><a href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a></div><div class="ttdeci">#define NULL</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d7f/resample_8c_source.html#l00096">resample.c:96</a></div></div>
<div class="ttc" id="res__pjsip__refer_8c_html_a1d1a233825b31a62bc5074299f4b273c"><div class="ttname"><a href="../../d1/d75/res__pjsip__refer_8c.html#a1d1a233825b31a62bc5074299f4b273c">xfer_response_code2sip</a></div><div class="ttdeci">static int xfer_response_code2sip(enum ast_transfer_result xfer_code)</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d75/res__pjsip__refer_8c_source.html#l00530">res_pjsip_refer.c:530</a></div></div>
<div class="ttc" id="res__pjsip__refer_8c_html_ac2d698569813f09d32e13c7068adbbda"><div class="ttname"><a href="../../d1/d75/res__pjsip__refer_8c.html#ac2d698569813f09d32e13c7068adbbda">session_end_if_deferred_task</a></div><div class="ttdeci">static int session_end_if_deferred_task(void *data)</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d75/res__pjsip__refer_8c_source.html#l00502">res_pjsip_refer.c:502</a></div></div>
<div class="ttc" id="logger_8h_html_a3f248112c8d6ce7e3959aa723dade648"><div class="ttname"><a href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a></div><div class="ttdeci">#define ast_debug(level,...)</div><div class="ttdoc">Log a DEBUG message. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d8c/logger_8h_source.html#l00452">logger.h:452</a></div></div>
<div class="ttc" id="astobj2_8h_html_aaca5e8eac39a22f9da1c36fc6c922270"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a></div><div class="ttdeci">#define ao2_ref(o, delta)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l00464">astobj2.h:464</a></div></div>
<div class="ttc" id="structast__sip__session_html_a48371aaa1ad1144e564ebcd179a2db2e"><div class="ttname"><a href="../../d2/dec/structast__sip__session.html#a48371aaa1ad1144e564ebcd179a2db2e">ast_sip_session::channel</a></div><div class="ttdeci">struct ast_channel * channel</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/de7/res__pjsip__session_8h_source.html#l00189">res_pjsip_session.h:189</a></div></div>
<div class="ttc" id="structast__sip__session_html_ac23e23ba60f358de78a893d537c0afa4"><div class="ttname"><a href="../../d2/dec/structast__sip__session.html#ac23e23ba60f358de78a893d537c0afa4">ast_sip_session::serializer</a></div><div class="ttdeci">struct ast_taskprocessor * serializer</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/de7/res__pjsip__session_8h_source.html#l00195">res_pjsip_session.h:195</a></div></div>
<div class="ttc" id="group__pjsip__threading_html_ga4f0a0629fa2ca084812772356d8e3565"><div class="ttname"><a href="../../d7/dfa/group__pjsip__threading.html#ga4f0a0629fa2ca084812772356d8e3565">ast_sip_push_task</a></div><div class="ttdeci">int ast_sip_push_task(struct ast_taskprocessor *serializer, int(*sip_task)(void *), void *task_data)</div><div class="ttdoc">Pushes a task to SIP servants. </div><div class="ttdef"><b>Definition:</b> <a href="../../de/d96/res__pjsip_8c_source.html#l05138">res_pjsip.c:5138</a></div></div>
<div class="ttc" id="res__pjsip__refer_8c_html_a89f2c1d96492b68d1399f20fc6eeb833"><div class="ttname"><a href="../../d1/d75/res__pjsip__refer_8c.html#a89f2c1d96492b68d1399f20fc6eeb833">refer_progress_notification_alloc</a></div><div class="ttdeci">static struct refer_progress_notification * refer_progress_notification_alloc(struct refer_progress *progress, int response, pjsip_evsub_state state)</div><div class="ttdoc">Allocator for REFER Progress notification structure. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d75/res__pjsip__refer_8c_source.html#l00094">res_pjsip_refer.c:94</a></div></div>
<div class="ttc" id="res__pjsip__refer_8c_html_a5d2be3003a3c77234b90343bc0a43935"><div class="ttname"><a href="../../d1/d75/res__pjsip__refer_8c.html#a5d2be3003a3c77234b90343bc0a43935">refer_progress_notify</a></div><div class="ttdeci">static int refer_progress_notify(void *data)</div><div class="ttdoc">Serialized callback for subscription notification. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d75/res__pjsip__refer_8c_source.html#l00140">res_pjsip_refer.c:140</a></div></div>
<div class="ttc" id="astobj2_8h_html_a6321ee982370c55ab3c24c72c562cbdd"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#a6321ee982370c55ab3c24c72c562cbdd">ao2_cleanup</a></div><div class="ttdeci">#define ao2_cleanup(obj)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l01958">astobj2.h:1958</a></div></div>
<div class="ttc" id="res__pjsip__session_8h_html_aa55296422ab86c7de1d7f52e9c227d82"><div class="ttname"><a href="../../d9/de7/res__pjsip__session_8h.html#aa55296422ab86c7de1d7f52e9c227d82">ast_sip_session_end_if_deferred</a></div><div class="ttdeci">void ast_sip_session_end_if_deferred(struct ast_sip_session *session)</div><div class="ttdoc">End the session if it had been previously deferred. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d92/res__pjsip__session_8c_source.html#l03614">res_pjsip_session.c:3614</a></div></div>
<div class="ttc" id="channel_8h_html_a7ca2fda13b129a55c251b56729de285b"><div class="ttname"><a href="../../d5/d7b/channel_8h.html#a7ca2fda13b129a55c251b56729de285b">ast_channel_name</a></div><div class="ttdeci">const char * ast_channel_name(const struct ast_channel *chan)</div></div>
<div class="ttc" id="structrefer__attended_html_acb6fd2c0f6b39a00d54d4e2a311381e6"><div class="ttname"><a href="../../dc/d15/structrefer__attended.html#acb6fd2c0f6b39a00d54d4e2a311381e6">refer_attended::transferer_chan</a></div><div class="ttdeci">struct ast_channel * transferer_chan</div><div class="ttdoc">Transferer channel. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d75/res__pjsip__refer_8c_source.html#l00456">res_pjsip_refer.c:456</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a699d01236694a29bde454097cfd05e10"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a699d01236694a29bde454097cfd05e10">&#9670;&nbsp;</a></span>refer_blind_callback()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void refer_blind_callback </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="../../df/d3c/structast__channel.html">ast_channel</a> *&#160;</td>
          <td class="paramname"><em>chan</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="../../da/d84/structtransfer__channel__data.html">transfer_channel_data</a> *&#160;</td>
          <td class="paramname"><em>user_data_wrapper</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">enum <a class="el" href="../../d4/d56/bridge_8h.html#a865f7ef0f91885406ab746b23eb598cd">ast_transfer_type</a>&#160;</td>
          <td class="paramname"><em>transfer_type</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Blind transfer callback function. </p>

<p class="definition">Definition at line <a class="el" href="../../d1/d75/res__pjsip__refer_8c_source.html#l00625">625</a> of file <a class="el" href="../../d1/d75/res__pjsip__refer_8c_source.html">res_pjsip_refer.c</a>.</p>

<p class="reference">References <a class="el" href="../../d5/da5/astobj2_8h_source.html#l01958">ao2_cleanup</a>, <a class="el" href="../../d5/da5/astobj2_8h_source.html#l00464">ao2_ref</a>, <a class="el" href="../../d8/d8a/astmm_8h_source.html#l00290">ast_alloca</a>, <a class="el" href="../../da/d0f/stasis__bridges_8c_source.html#l00179">ast_bridge_topic_all()</a>, <a class="el" href="../../dc/d4e/stasis__bridges_8h.html#a8bd3a6c07bd2064a82a7c27091ba0fce">ast_channel_entered_bridge_type()</a>, <a class="el" href="../../d5/d7b/channel_8h_source.html#l02945">ast_channel_lock</a>, <a class="el" href="../../d5/d7b/channel_8h.html#a7ca2fda13b129a55c251b56729de285b">ast_channel_name()</a>, <a class="el" href="../../db/de2/channel__internal__api_8c_source.html#l00305">ast_channel_uniqueid()</a>, <a class="el" href="../../d5/d7b/channel_8h_source.html#l02946">ast_channel_unlock</a>, <a class="el" href="../../de/d96/res__pjsip_8c_source.html#l05240">ast_copy_pj_str()</a>, <a class="el" href="../../da/dac/framehook_8c_source.html#l00132">ast_framehook_attach()</a>, <a class="el" href="../../da/dac/framehook_8c_source.html#l00177">ast_framehook_detach()</a>, <a class="el" href="../../db/d3c/framehook_8h_source.html#l00227">AST_FRAMEHOOK_INTERFACE_VERSION</a>, <a class="el" href="../../da/df7/astobj2_8c_source.html#l00042">ast_log</a>, <a class="el" href="../../de/d96/res__pjsip_8c_source.html#l05138">ast_sip_push_task()</a>, <a class="el" href="../../d8/d8a/astmm_8h_source.html#l00243">ast_strdup</a>, <a class="el" href="../../d1/d75/res__pjsip__refer_8c_source.html#l00621">refer_blind::attended</a>, <a class="el" href="../../d1/d75/res__pjsip__refer_8c_source.html#l00058">refer_progress::bridge_sub</a>, <a class="el" href="../../d1/d75/res__pjsip__refer_8c_source.html#l00611">refer_blind::context</a>, <a class="el" href="../../d4/d56/bridge_8h_source.html#l01137">transfer_channel_data::data</a>, <a class="el" href="../../d1/d75/res__pjsip__refer_8c_source.html#l00052">refer_progress::framehook</a>, <a class="el" href="../../d9/d1e/func__strings_8c_source.html#l01344">len()</a>, <a class="el" href="../../d1/d8c/logger_8h_source.html#l00274">LOG_WARNING</a>, <a class="el" href="../../dc/d7f/resample_8c_source.html#l00096">NULL</a>, <a class="el" href="../../d3/d8c/pbx__variables_8c_source.html#l01071">pbx_builtin_setvar_helper()</a>, <a class="el" href="../../d1/d75/res__pjsip__refer_8c_source.html#l00613">refer_blind::progress</a>, <a class="el" href="../../d1/d75/res__pjsip__refer_8c_source.html#l00615">refer_blind::rdata</a>, <a class="el" href="../../d1/d75/res__pjsip__refer_8c_source.html#l00066">refer_progress::refer_blind_progress</a>, <a class="el" href="../../d1/d75/res__pjsip__refer_8c_source.html#l00181">refer_progress_bridge()</a>, <a class="el" href="../../d1/d75/res__pjsip__refer_8c_source.html#l00236">refer_progress_framehook()</a>, <a class="el" href="../../d1/d75/res__pjsip__refer_8c_source.html#l00297">refer_progress_framehook_destroy()</a>, <a class="el" href="../../d1/d75/res__pjsip__refer_8c_source.html#l00094">refer_progress_notification_alloc()</a>, <a class="el" href="../../d1/d75/res__pjsip__refer_8c_source.html#l00140">refer_progress_notify()</a>, <a class="el" href="../../d1/d75/res__pjsip__refer_8c_source.html#l00619">refer_blind::refer_to</a>, <a class="el" href="../../d1/d75/res__pjsip__refer_8c_source.html#l00617">refer_blind::replaces</a>, <a class="el" href="../../d6/d90/strings_8h_source.html#l00079">S_OR</a>, <a class="el" href="../../d1/d75/res__pjsip__refer_8c_source.html#l00056">refer_progress::serializer</a>, <a class="el" href="../../dd/d79/stasis_8h_source.html#l00682">stasis_subscribe_pool</a>, <a class="el" href="../../d0/df4/stasis_8c_source.html#l01025">stasis_subscription_accept_message_type()</a>, <a class="el" href="../../df/deb/group__StasisTopicsAndMessages.html#gafae630f05995b59b49dc523a5b9ce757">stasis_subscription_change_type()</a>, <a class="el" href="../../dd/d79/stasis_8h_source.html#l00300">STASIS_SUBSCRIPTION_FILTER_SELECTIVE</a>, <a class="el" href="../../d0/df4/stasis_8c_source.html#l01079">stasis_subscription_set_filter()</a>, <a class="el" href="../../d1/d75/res__pjsip__refer_8c_source.html#l00060">refer_progress::transfer_data</a>, <a class="el" href="../../d1/d75/res__pjsip__refer_8c_source.html#l00062">refer_progress::transferee</a>, and <a class="el" href="../../db/d3c/framehook_8h_source.html#l00231">ast_framehook_interface::version</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../d1/d75/res__pjsip__refer_8c_source.html#l00789">refer_incoming_attended_request()</a>, and <a class="el" href="../../d1/d75/res__pjsip__refer_8c_source.html#l00886">refer_incoming_blind_request()</a>.</p>
<div class="fragment"><div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160;{</div><div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../da/de6/structrefer__blind.html">refer_blind</a> *refer = user_data_wrapper-&gt;<a class="code" href="../../da/d84/structtransfer__channel__data.html#a735984d41155bc1032e09bece8f8d66d">data</a>;</div><div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160;   pjsip_generic_string_hdr *referred_by;</div><div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;</div><div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160;   <span class="keyword">static</span> <span class="keyword">const</span> pj_str_t str_referred_by = { <span class="stringliteral">&quot;Referred-By&quot;</span>, 11 };</div><div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160;   <span class="keyword">static</span> <span class="keyword">const</span> pj_str_t str_referred_by_s = { <span class="stringliteral">&quot;b&quot;</span>, 1 };</div><div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160;</div><div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160;   <a class="code" href="../../db/de0/pbx_8h.html#a6e5b90edb84d216267148dddcffe9b9a">pbx_builtin_setvar_helper</a>(chan, <span class="stringliteral">&quot;SIPTRANSFER&quot;</span>, <span class="stringliteral">&quot;yes&quot;</span>);</div><div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160;</div><div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160;   <span class="keywordflow">if</span> (refer-&gt;<a class="code" href="../../da/de6/structrefer__blind.html#a78ae786167e10c748e902a68acf1138d">progress</a> &amp;&amp; !refer-&gt;<a class="code" href="../../da/de6/structrefer__blind.html#a91dcef106d87bfcd59a03e0e33642ff6">attended</a> &amp;&amp; !refer-&gt;<a class="code" href="../../da/de6/structrefer__blind.html#a78ae786167e10c748e902a68acf1138d">progress</a>-&gt;<a class="code" href="../../d0/d4b/structrefer__progress.html#a63e413c0e98d7635f20ef19c9432c1aa">refer_blind_progress</a>) {</div><div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160;      <span class="comment">/* If blind transfer and endpoint doesn&#39;t want to receive all the progress details */</span></div><div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160;      <span class="keyword">struct </span><a class="code" href="../../d3/dff/structrefer__progress__notification.html">refer_progress_notification</a> *notification = <a class="code" href="../../d1/d75/res__pjsip__refer_8c.html#a89f2c1d96492b68d1399f20fc6eeb833">refer_progress_notification_alloc</a>(refer-&gt;<a class="code" href="../../da/de6/structrefer__blind.html#a78ae786167e10c748e902a68acf1138d">progress</a>, 200,</div><div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160;         PJSIP_EVSUB_STATE_TERMINATED);</div><div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160;</div><div class="line"><a name="l00641"></a><span class="lineno">  641</span>&#160;      <span class="keywordflow">if</span> (notification) {</div><div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160;         <span class="keywordflow">if</span> (<a class="code" href="../../d7/dfa/group__pjsip__threading.html#ga4f0a0629fa2ca084812772356d8e3565">ast_sip_push_task</a>(refer-&gt;<a class="code" href="../../da/de6/structrefer__blind.html#a78ae786167e10c748e902a68acf1138d">progress</a>-&gt;<a class="code" href="../../d0/d4b/structrefer__progress.html#ac23e23ba60f358de78a893d537c0afa4">serializer</a>, <a class="code" href="../../d1/d75/res__pjsip__refer_8c.html#a5d2be3003a3c77234b90343bc0a43935">refer_progress_notify</a>, notification)) {</div><div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160;            <a class="code" href="../../d5/da5/astobj2_8h.html#a6321ee982370c55ab3c24c72c562cbdd">ao2_cleanup</a>(notification);</div><div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160;         }</div><div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160;      }</div><div class="line"><a name="l00646"></a><span class="lineno">  646</span>&#160;   } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (refer-&gt;<a class="code" href="../../da/de6/structrefer__blind.html#a78ae786167e10c748e902a68acf1138d">progress</a>) {</div><div class="line"><a name="l00647"></a><span class="lineno">  647</span>&#160;      <span class="comment">/* If attended transfer and progress monitoring is being done attach a frame hook so we can monitor it */</span></div><div class="line"><a name="l00648"></a><span class="lineno">  648</span>&#160;      <span class="keyword">struct </span><a class="code" href="../../d3/d7b/structast__framehook__interface.html">ast_framehook_interface</a> hook = {</div><div class="line"><a name="l00649"></a><span class="lineno">  649</span>&#160;         .<a class="code" href="../../d3/d7b/structast__framehook__interface.html#ab6d7b6f8c2ceaba7acda80aaf05f4899">version</a> = <a class="code" href="../../db/d3c/framehook_8h.html#ae3b6fa28df6c8608d05936efaf929f32">AST_FRAMEHOOK_INTERFACE_VERSION</a>,</div><div class="line"><a name="l00650"></a><span class="lineno">  650</span>&#160;         .event_cb = <a class="code" href="../../d1/d75/res__pjsip__refer_8c.html#a257bc682830b3e4df38b8d5d413d588c">refer_progress_framehook</a>,</div><div class="line"><a name="l00651"></a><span class="lineno">  651</span>&#160;         .destroy_cb = <a class="code" href="../../d1/d75/res__pjsip__refer_8c.html#ace0ce27cec92bc5b7997cc2d6890bf10">refer_progress_framehook_destroy</a>,</div><div class="line"><a name="l00652"></a><span class="lineno">  652</span>&#160;         .data = refer-&gt;<a class="code" href="../../da/de6/structrefer__blind.html#a78ae786167e10c748e902a68acf1138d">progress</a>,</div><div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160;         .disable_inheritance = 1,</div><div class="line"><a name="l00654"></a><span class="lineno">  654</span>&#160;      };</div><div class="line"><a name="l00655"></a><span class="lineno">  655</span>&#160;</div><div class="line"><a name="l00656"></a><span class="lineno">  656</span>&#160;      refer-&gt;<a class="code" href="../../da/de6/structrefer__blind.html#a78ae786167e10c748e902a68acf1138d">progress</a>-&gt;<a class="code" href="../../d0/d4b/structrefer__progress.html#ad59ea5bda14dba853447d8de13813038">transferee</a> = <a class="code" href="../../d8/d8a/astmm_8h.html#ab263849d03fb892847be4986db759737">ast_strdup</a>(<a class="code" href="../../d5/d7b/channel_8h.html#a3b6254f6d3832ef928f0a727113b1c63">ast_channel_uniqueid</a>(chan));</div><div class="line"><a name="l00657"></a><span class="lineno">  657</span>&#160;      <span class="keywordflow">if</span> (!refer-&gt;<a class="code" href="../../da/de6/structrefer__blind.html#a78ae786167e10c748e902a68acf1138d">progress</a>-&gt;<a class="code" href="../../d0/d4b/structrefer__progress.html#ad59ea5bda14dba853447d8de13813038">transferee</a>) {</div><div class="line"><a name="l00658"></a><span class="lineno">  658</span>&#160;         <span class="keyword">struct </span><a class="code" href="../../d3/dff/structrefer__progress__notification.html">refer_progress_notification</a> *notification = <a class="code" href="../../d1/d75/res__pjsip__refer_8c.html#a89f2c1d96492b68d1399f20fc6eeb833">refer_progress_notification_alloc</a>(refer-&gt;<a class="code" href="../../da/de6/structrefer__blind.html#a78ae786167e10c748e902a68acf1138d">progress</a>, 200,</div><div class="line"><a name="l00659"></a><span class="lineno">  659</span>&#160;            PJSIP_EVSUB_STATE_TERMINATED);</div><div class="line"><a name="l00660"></a><span class="lineno">  660</span>&#160;</div><div class="line"><a name="l00661"></a><span class="lineno">  661</span>&#160;         <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Could not copy channel name &#39;%s&#39; during transfer - assuming success\n&quot;</span>,</div><div class="line"><a name="l00662"></a><span class="lineno">  662</span>&#160;            <a class="code" href="../../d5/d7b/channel_8h.html#a7ca2fda13b129a55c251b56729de285b">ast_channel_name</a>(chan));</div><div class="line"><a name="l00663"></a><span class="lineno">  663</span>&#160;</div><div class="line"><a name="l00664"></a><span class="lineno">  664</span>&#160;         <span class="keywordflow">if</span> (notification) {</div><div class="line"><a name="l00665"></a><span class="lineno">  665</span>&#160;            <span class="keywordflow">if</span> (<a class="code" href="../../d7/dfa/group__pjsip__threading.html#ga4f0a0629fa2ca084812772356d8e3565">ast_sip_push_task</a>(refer-&gt;<a class="code" href="../../da/de6/structrefer__blind.html#a78ae786167e10c748e902a68acf1138d">progress</a>-&gt;<a class="code" href="../../d0/d4b/structrefer__progress.html#ac23e23ba60f358de78a893d537c0afa4">serializer</a>, <a class="code" href="../../d1/d75/res__pjsip__refer_8c.html#a5d2be3003a3c77234b90343bc0a43935">refer_progress_notify</a>, notification)) {</div><div class="line"><a name="l00666"></a><span class="lineno">  666</span>&#160;               <a class="code" href="../../d5/da5/astobj2_8h.html#a6321ee982370c55ab3c24c72c562cbdd">ao2_cleanup</a>(notification);</div><div class="line"><a name="l00667"></a><span class="lineno">  667</span>&#160;            }</div><div class="line"><a name="l00668"></a><span class="lineno">  668</span>&#160;         }</div><div class="line"><a name="l00669"></a><span class="lineno">  669</span>&#160;      }</div><div class="line"><a name="l00670"></a><span class="lineno">  670</span>&#160;</div><div class="line"><a name="l00671"></a><span class="lineno">  671</span>&#160;      <span class="comment">/* Progress needs a reference to the transfer_channel_data so that it can track the completed status of the transfer */</span></div><div class="line"><a name="l00672"></a><span class="lineno">  672</span>&#160;      <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(user_data_wrapper, +1);</div><div class="line"><a name="l00673"></a><span class="lineno">  673</span>&#160;      refer-&gt;<a class="code" href="../../da/de6/structrefer__blind.html#a78ae786167e10c748e902a68acf1138d">progress</a>-&gt;<a class="code" href="../../d0/d4b/structrefer__progress.html#a22abfff94132237b9bfefd9926961698">transfer_data</a> = user_data_wrapper;</div><div class="line"><a name="l00674"></a><span class="lineno">  674</span>&#160;</div><div class="line"><a name="l00675"></a><span class="lineno">  675</span>&#160;      <span class="comment">/* We need to bump the reference count up on the progress structure since it is in the frame hook now */</span></div><div class="line"><a name="l00676"></a><span class="lineno">  676</span>&#160;      <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(refer-&gt;<a class="code" href="../../da/de6/structrefer__blind.html#a78ae786167e10c748e902a68acf1138d">progress</a>, +1);</div><div class="line"><a name="l00677"></a><span class="lineno">  677</span>&#160;</div><div class="line"><a name="l00678"></a><span class="lineno">  678</span>&#160;      <span class="comment">/* If we can&#39;t attach a frame hook for whatever reason send a notification of success immediately */</span></div><div class="line"><a name="l00679"></a><span class="lineno">  679</span>&#160;      <a class="code" href="../../d5/d7b/channel_8h.html#a493bdebe876caafb8ee535853310364a">ast_channel_lock</a>(chan);</div><div class="line"><a name="l00680"></a><span class="lineno">  680</span>&#160;      refer-&gt;<a class="code" href="../../da/de6/structrefer__blind.html#a78ae786167e10c748e902a68acf1138d">progress</a>-&gt;<a class="code" href="../../d0/d4b/structrefer__progress.html#ae25f61b5aa8877dfb396fd378c6b7722">framehook</a> = <a class="code" href="../../db/d3c/framehook_8h.html#a3ca711dc98d26e881936c855f0ae3d77">ast_framehook_attach</a>(chan, &amp;hook);</div><div class="line"><a name="l00681"></a><span class="lineno">  681</span>&#160;      <a class="code" href="../../d5/d7b/channel_8h.html#af476c537b29be3f29240489032f9db39">ast_channel_unlock</a>(chan);</div><div class="line"><a name="l00682"></a><span class="lineno">  682</span>&#160;      <span class="keywordflow">if</span> (refer-&gt;<a class="code" href="../../da/de6/structrefer__blind.html#a78ae786167e10c748e902a68acf1138d">progress</a>-&gt;<a class="code" href="../../d0/d4b/structrefer__progress.html#ae25f61b5aa8877dfb396fd378c6b7722">framehook</a> &lt; 0) {</div><div class="line"><a name="l00683"></a><span class="lineno">  683</span>&#160;         <span class="keyword">struct </span><a class="code" href="../../d3/dff/structrefer__progress__notification.html">refer_progress_notification</a> *notification = <a class="code" href="../../d1/d75/res__pjsip__refer_8c.html#a89f2c1d96492b68d1399f20fc6eeb833">refer_progress_notification_alloc</a>(refer-&gt;<a class="code" href="../../da/de6/structrefer__blind.html#a78ae786167e10c748e902a68acf1138d">progress</a>, 200,</div><div class="line"><a name="l00684"></a><span class="lineno">  684</span>&#160;            PJSIP_EVSUB_STATE_TERMINATED);</div><div class="line"><a name="l00685"></a><span class="lineno">  685</span>&#160;</div><div class="line"><a name="l00686"></a><span class="lineno">  686</span>&#160;         <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Could not attach REFER transfer progress monitoring hook to channel &#39;%s&#39; - assuming success\n&quot;</span>,</div><div class="line"><a name="l00687"></a><span class="lineno">  687</span>&#160;            <a class="code" href="../../d5/d7b/channel_8h.html#a7ca2fda13b129a55c251b56729de285b">ast_channel_name</a>(chan));</div><div class="line"><a name="l00688"></a><span class="lineno">  688</span>&#160;</div><div class="line"><a name="l00689"></a><span class="lineno">  689</span>&#160;         <span class="keywordflow">if</span> (notification) {</div><div class="line"><a name="l00690"></a><span class="lineno">  690</span>&#160;            <span class="keywordflow">if</span> (<a class="code" href="../../d7/dfa/group__pjsip__threading.html#ga4f0a0629fa2ca084812772356d8e3565">ast_sip_push_task</a>(refer-&gt;<a class="code" href="../../da/de6/structrefer__blind.html#a78ae786167e10c748e902a68acf1138d">progress</a>-&gt;<a class="code" href="../../d0/d4b/structrefer__progress.html#ac23e23ba60f358de78a893d537c0afa4">serializer</a>, <a class="code" href="../../d1/d75/res__pjsip__refer_8c.html#a5d2be3003a3c77234b90343bc0a43935">refer_progress_notify</a>, notification)) {</div><div class="line"><a name="l00691"></a><span class="lineno">  691</span>&#160;               <a class="code" href="../../d5/da5/astobj2_8h.html#a6321ee982370c55ab3c24c72c562cbdd">ao2_cleanup</a>(notification);</div><div class="line"><a name="l00692"></a><span class="lineno">  692</span>&#160;            }</div><div class="line"><a name="l00693"></a><span class="lineno">  693</span>&#160;         }</div><div class="line"><a name="l00694"></a><span class="lineno">  694</span>&#160;</div><div class="line"><a name="l00695"></a><span class="lineno">  695</span>&#160;         <a class="code" href="../../d5/da5/astobj2_8h.html#a6321ee982370c55ab3c24c72c562cbdd">ao2_cleanup</a>(refer-&gt;<a class="code" href="../../da/de6/structrefer__blind.html#a78ae786167e10c748e902a68acf1138d">progress</a>);</div><div class="line"><a name="l00696"></a><span class="lineno">  696</span>&#160;      }</div><div class="line"><a name="l00697"></a><span class="lineno">  697</span>&#160;</div><div class="line"><a name="l00698"></a><span class="lineno">  698</span>&#160;      <span class="comment">/* We need to bump the reference count for the stasis subscription */</span></div><div class="line"><a name="l00699"></a><span class="lineno">  699</span>&#160;      <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(refer-&gt;<a class="code" href="../../da/de6/structrefer__blind.html#a78ae786167e10c748e902a68acf1138d">progress</a>, +1);</div><div class="line"><a name="l00700"></a><span class="lineno">  700</span>&#160;      <span class="comment">/* We also will need to detect if the transferee enters a bridge. This is currently the only reliable way to</span></div><div class="line"><a name="l00701"></a><span class="lineno">  701</span>&#160;<span class="comment">       * detect if the transfer target has answered the call</span></div><div class="line"><a name="l00702"></a><span class="lineno">  702</span>&#160;<span class="comment">       */</span></div><div class="line"><a name="l00703"></a><span class="lineno">  703</span>&#160;      refer-&gt;<a class="code" href="../../da/de6/structrefer__blind.html#a78ae786167e10c748e902a68acf1138d">progress</a>-&gt;<a class="code" href="../../d0/d4b/structrefer__progress.html#aab0602828a0c8ce025953da194f6681f">bridge_sub</a> = <a class="code" href="../../dd/d79/stasis_8h.html#a597f7a30fe616c9f083a93ed168955ed">stasis_subscribe_pool</a>(<a class="code" href="../../dc/d4e/stasis__bridges_8h.html#abf64fa441014314244648caa6c8ab80b">ast_bridge_topic_all</a>(), <a class="code" href="../../d1/d75/res__pjsip__refer_8c.html#af1b4316df480302870d7bc3e9391227d">refer_progress_bridge</a>, refer-&gt;<a class="code" href="../../da/de6/structrefer__blind.html#a78ae786167e10c748e902a68acf1138d">progress</a>);</div><div class="line"><a name="l00704"></a><span class="lineno">  704</span>&#160;      <span class="keywordflow">if</span> (!refer-&gt;<a class="code" href="../../da/de6/structrefer__blind.html#a78ae786167e10c748e902a68acf1138d">progress</a>-&gt;<a class="code" href="../../d0/d4b/structrefer__progress.html#aab0602828a0c8ce025953da194f6681f">bridge_sub</a>) {</div><div class="line"><a name="l00705"></a><span class="lineno">  705</span>&#160;         <span class="keyword">struct </span><a class="code" href="../../d3/dff/structrefer__progress__notification.html">refer_progress_notification</a> *notification = <a class="code" href="../../d1/d75/res__pjsip__refer_8c.html#a89f2c1d96492b68d1399f20fc6eeb833">refer_progress_notification_alloc</a>(refer-&gt;<a class="code" href="../../da/de6/structrefer__blind.html#a78ae786167e10c748e902a68acf1138d">progress</a>, 200,</div><div class="line"><a name="l00706"></a><span class="lineno">  706</span>&#160;            PJSIP_EVSUB_STATE_TERMINATED);</div><div class="line"><a name="l00707"></a><span class="lineno">  707</span>&#160;</div><div class="line"><a name="l00708"></a><span class="lineno">  708</span>&#160;         <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Could not create bridge stasis subscription for monitoring progress on transfer of channel &#39;%s&#39; - assuming success\n&quot;</span>,</div><div class="line"><a name="l00709"></a><span class="lineno">  709</span>&#160;               <a class="code" href="../../d5/d7b/channel_8h.html#a7ca2fda13b129a55c251b56729de285b">ast_channel_name</a>(chan));</div><div class="line"><a name="l00710"></a><span class="lineno">  710</span>&#160;</div><div class="line"><a name="l00711"></a><span class="lineno">  711</span>&#160;         <span class="keywordflow">if</span> (notification) {</div><div class="line"><a name="l00712"></a><span class="lineno">  712</span>&#160;            <span class="keywordflow">if</span> (<a class="code" href="../../d7/dfa/group__pjsip__threading.html#ga4f0a0629fa2ca084812772356d8e3565">ast_sip_push_task</a>(refer-&gt;<a class="code" href="../../da/de6/structrefer__blind.html#a78ae786167e10c748e902a68acf1138d">progress</a>-&gt;<a class="code" href="../../d0/d4b/structrefer__progress.html#ac23e23ba60f358de78a893d537c0afa4">serializer</a>, <a class="code" href="../../d1/d75/res__pjsip__refer_8c.html#a5d2be3003a3c77234b90343bc0a43935">refer_progress_notify</a>, notification)) {</div><div class="line"><a name="l00713"></a><span class="lineno">  713</span>&#160;               <a class="code" href="../../d5/da5/astobj2_8h.html#a6321ee982370c55ab3c24c72c562cbdd">ao2_cleanup</a>(notification);</div><div class="line"><a name="l00714"></a><span class="lineno">  714</span>&#160;            }</div><div class="line"><a name="l00715"></a><span class="lineno">  715</span>&#160;         }</div><div class="line"><a name="l00716"></a><span class="lineno">  716</span>&#160;</div><div class="line"><a name="l00717"></a><span class="lineno">  717</span>&#160;         <a class="code" href="../../d5/d7b/channel_8h.html#a493bdebe876caafb8ee535853310364a">ast_channel_lock</a>(chan);</div><div class="line"><a name="l00718"></a><span class="lineno">  718</span>&#160;         <a class="code" href="../../db/d3c/framehook_8h.html#a6e116259cae8c1e5cca074d05f0a3475">ast_framehook_detach</a>(chan, refer-&gt;<a class="code" href="../../da/de6/structrefer__blind.html#a78ae786167e10c748e902a68acf1138d">progress</a>-&gt;<a class="code" href="../../d0/d4b/structrefer__progress.html#ae25f61b5aa8877dfb396fd378c6b7722">framehook</a>);</div><div class="line"><a name="l00719"></a><span class="lineno">  719</span>&#160;         <a class="code" href="../../d5/d7b/channel_8h.html#af476c537b29be3f29240489032f9db39">ast_channel_unlock</a>(chan);</div><div class="line"><a name="l00720"></a><span class="lineno">  720</span>&#160;</div><div class="line"><a name="l00721"></a><span class="lineno">  721</span>&#160;         <a class="code" href="../../d5/da5/astobj2_8h.html#a6321ee982370c55ab3c24c72c562cbdd">ao2_cleanup</a>(refer-&gt;<a class="code" href="../../da/de6/structrefer__blind.html#a78ae786167e10c748e902a68acf1138d">progress</a>);</div><div class="line"><a name="l00722"></a><span class="lineno">  722</span>&#160;      } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00723"></a><span class="lineno">  723</span>&#160;         <a class="code" href="../../dd/d79/stasis_8h.html#a4f248ee5f4791f05d0af8768aaab282b">stasis_subscription_accept_message_type</a>(refer-&gt;<a class="code" href="../../da/de6/structrefer__blind.html#a78ae786167e10c748e902a68acf1138d">progress</a>-&gt;<a class="code" href="../../d0/d4b/structrefer__progress.html#aab0602828a0c8ce025953da194f6681f">bridge_sub</a>, <a class="code" href="../../dc/d4e/stasis__bridges_8h.html#a8bd3a6c07bd2064a82a7c27091ba0fce">ast_channel_entered_bridge_type</a>());</div><div class="line"><a name="l00724"></a><span class="lineno">  724</span>&#160;         <a class="code" href="../../dd/d79/stasis_8h.html#a4f248ee5f4791f05d0af8768aaab282b">stasis_subscription_accept_message_type</a>(refer-&gt;<a class="code" href="../../da/de6/structrefer__blind.html#a78ae786167e10c748e902a68acf1138d">progress</a>-&gt;<a class="code" href="../../d0/d4b/structrefer__progress.html#aab0602828a0c8ce025953da194f6681f">bridge_sub</a>, <a class="code" href="../../df/deb/group__StasisTopicsAndMessages.html#gafae630f05995b59b49dc523a5b9ce757">stasis_subscription_change_type</a>());</div><div class="line"><a name="l00725"></a><span class="lineno">  725</span>&#160;         <a class="code" href="../../dd/d79/stasis_8h.html#a52b5393bef89d7781c0d039d6489de23">stasis_subscription_set_filter</a>(refer-&gt;<a class="code" href="../../da/de6/structrefer__blind.html#a78ae786167e10c748e902a68acf1138d">progress</a>-&gt;<a class="code" href="../../d0/d4b/structrefer__progress.html#aab0602828a0c8ce025953da194f6681f">bridge_sub</a>, <a class="code" href="../../dd/d79/stasis_8h.html#a3804fa8ec76d77090d5cda80fc4ac891a0e40588366edb9a53e453d47ef26d567">STASIS_SUBSCRIPTION_FILTER_SELECTIVE</a>);</div><div class="line"><a name="l00726"></a><span class="lineno">  726</span>&#160;      }</div><div class="line"><a name="l00727"></a><span class="lineno">  727</span>&#160;   }</div><div class="line"><a name="l00728"></a><span class="lineno">  728</span>&#160;</div><div class="line"><a name="l00729"></a><span class="lineno">  729</span>&#160;   <a class="code" href="../../db/de0/pbx_8h.html#a6e5b90edb84d216267148dddcffe9b9a">pbx_builtin_setvar_helper</a>(chan, <span class="stringliteral">&quot;SIPREFERRINGCONTEXT&quot;</span>, <a class="code" href="../../d6/d90/strings_8h.html#a2faaa16929951bfd2802b7829a100ba2">S_OR</a>(refer-&gt;<a class="code" href="../../da/de6/structrefer__blind.html#a94f090d1fb5c71712726fcdf025b9ace">context</a>, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>));</div><div class="line"><a name="l00730"></a><span class="lineno">  730</span>&#160;</div><div class="line"><a name="l00731"></a><span class="lineno">  731</span>&#160;   referred_by = pjsip_msg_find_hdr_by_names(refer-&gt;<a class="code" href="../../da/de6/structrefer__blind.html#a41249c16bd9cc17b36f3719debaf7a67">rdata</a>-&gt;msg_info.msg,</div><div class="line"><a name="l00732"></a><span class="lineno">  732</span>&#160;      &amp;str_referred_by, &amp;str_referred_by_s, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div><div class="line"><a name="l00733"></a><span class="lineno">  733</span>&#160;   <span class="keywordflow">if</span> (referred_by) {</div><div class="line"><a name="l00734"></a><span class="lineno">  734</span>&#160;      <span class="keywordtype">size_t</span> uri_size = pj_strlen(&amp;referred_by-&gt;hvalue) + 1;</div><div class="line"><a name="l00735"></a><span class="lineno">  735</span>&#160;      <span class="keywordtype">char</span> *uri = <a class="code" href="../../d8/d8a/astmm_8h.html#a249282ecc7ba5a1a49fa75e9a33d1717">ast_alloca</a>(uri_size);</div><div class="line"><a name="l00736"></a><span class="lineno">  736</span>&#160;</div><div class="line"><a name="l00737"></a><span class="lineno">  737</span>&#160;      <a class="code" href="../../d8/d8c/res__pjsip_8h.html#a7da3e1f7ee3fcb77f29d41a76a7528fe">ast_copy_pj_str</a>(uri, &amp;referred_by-&gt;hvalue, uri_size);</div><div class="line"><a name="l00738"></a><span class="lineno">  738</span>&#160;      <a class="code" href="../../db/de0/pbx_8h.html#a6e5b90edb84d216267148dddcffe9b9a">pbx_builtin_setvar_helper</a>(chan, <span class="stringliteral">&quot;__SIPREFERREDBYHDR&quot;</span>, <a class="code" href="../../d6/d90/strings_8h.html#a2faaa16929951bfd2802b7829a100ba2">S_OR</a>(uri, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>));</div><div class="line"><a name="l00739"></a><span class="lineno">  739</span>&#160;   } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00740"></a><span class="lineno">  740</span>&#160;      <a class="code" href="../../db/de0/pbx_8h.html#a6e5b90edb84d216267148dddcffe9b9a">pbx_builtin_setvar_helper</a>(chan, <span class="stringliteral">&quot;SIPREFERREDBYHDR&quot;</span>, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div><div class="line"><a name="l00741"></a><span class="lineno">  741</span>&#160;   }</div><div class="line"><a name="l00742"></a><span class="lineno">  742</span>&#160;</div><div class="line"><a name="l00743"></a><span class="lineno">  743</span>&#160;   <span class="keywordflow">if</span> (refer-&gt;<a class="code" href="../../da/de6/structrefer__blind.html#a1aa05c1a9100a9bc5f44546a5c2059fa">replaces</a>) {</div><div class="line"><a name="l00744"></a><span class="lineno">  744</span>&#160;      <span class="keywordtype">char</span> replaces[512];</div><div class="line"><a name="l00745"></a><span class="lineno">  745</span>&#160;      <span class="keywordtype">char</span> *replaces_val = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l00746"></a><span class="lineno">  746</span>&#160;      <span class="keywordtype">int</span> <a class="code" href="../../d9/d1e/func__strings_8c.html#af24e73aaf92f3000fda15d285e66df24">len</a>;</div><div class="line"><a name="l00747"></a><span class="lineno">  747</span>&#160;</div><div class="line"><a name="l00748"></a><span class="lineno">  748</span>&#160;      len = pjsip_hdr_print_on(refer-&gt;<a class="code" href="../../da/de6/structrefer__blind.html#a1aa05c1a9100a9bc5f44546a5c2059fa">replaces</a>, replaces, <span class="keyword">sizeof</span>(replaces) - 1);</div><div class="line"><a name="l00749"></a><span class="lineno">  749</span>&#160;      <span class="keywordflow">if</span> (len != -1) {</div><div class="line"><a name="l00750"></a><span class="lineno">  750</span>&#160;         <span class="comment">/* pjsip_hdr_print_on does not NULL terminate the buffer */</span></div><div class="line"><a name="l00751"></a><span class="lineno">  751</span>&#160;         replaces[<a class="code" href="../../d9/d1e/func__strings_8c.html#af24e73aaf92f3000fda15d285e66df24">len</a>] = <span class="charliteral">&#39;\0&#39;</span>;</div><div class="line"><a name="l00752"></a><span class="lineno">  752</span>&#160;         replaces_val = replaces + <span class="keyword">sizeof</span>(<span class="stringliteral">&quot;Replaces:&quot;</span>);</div><div class="line"><a name="l00753"></a><span class="lineno">  753</span>&#160;      }</div><div class="line"><a name="l00754"></a><span class="lineno">  754</span>&#160;      <a class="code" href="../../db/de0/pbx_8h.html#a6e5b90edb84d216267148dddcffe9b9a">pbx_builtin_setvar_helper</a>(chan, <span class="stringliteral">&quot;__SIPREPLACESHDR&quot;</span>, replaces_val);</div><div class="line"><a name="l00755"></a><span class="lineno">  755</span>&#160;   } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00756"></a><span class="lineno">  756</span>&#160;      <a class="code" href="../../db/de0/pbx_8h.html#a6e5b90edb84d216267148dddcffe9b9a">pbx_builtin_setvar_helper</a>(chan, <span class="stringliteral">&quot;SIPREPLACESHDR&quot;</span>, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div><div class="line"><a name="l00757"></a><span class="lineno">  757</span>&#160;   }</div><div class="line"><a name="l00758"></a><span class="lineno">  758</span>&#160;</div><div class="line"><a name="l00759"></a><span class="lineno">  759</span>&#160;   <span class="keywordflow">if</span> (refer-&gt;<a class="code" href="../../da/de6/structrefer__blind.html#ae53dbeeccf085547b974cfc2cc13bb04">refer_to</a>) {</div><div class="line"><a name="l00760"></a><span class="lineno">  760</span>&#160;      <span class="keywordtype">char</span> refer_to[PJSIP_MAX_URL_SIZE];</div><div class="line"><a name="l00761"></a><span class="lineno">  761</span>&#160;</div><div class="line"><a name="l00762"></a><span class="lineno">  762</span>&#160;      pjsip_uri_print(PJSIP_URI_IN_REQ_URI, refer-&gt;<a class="code" href="../../da/de6/structrefer__blind.html#ae53dbeeccf085547b974cfc2cc13bb04">refer_to</a>, refer_to, <span class="keyword">sizeof</span>(refer_to));</div><div class="line"><a name="l00763"></a><span class="lineno">  763</span>&#160;      <a class="code" href="../../db/de0/pbx_8h.html#a6e5b90edb84d216267148dddcffe9b9a">pbx_builtin_setvar_helper</a>(chan, <span class="stringliteral">&quot;SIPREFERTOHDR&quot;</span>, <a class="code" href="../../d6/d90/strings_8h.html#a2faaa16929951bfd2802b7829a100ba2">S_OR</a>(refer_to, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>));</div><div class="line"><a name="l00764"></a><span class="lineno">  764</span>&#160;   } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00765"></a><span class="lineno">  765</span>&#160;      <a class="code" href="../../db/de0/pbx_8h.html#a6e5b90edb84d216267148dddcffe9b9a">pbx_builtin_setvar_helper</a>(chan, <span class="stringliteral">&quot;SIPREFERTOHDR&quot;</span>, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div><div class="line"><a name="l00766"></a><span class="lineno">  766</span>&#160;   }</div><div class="line"><a name="l00767"></a><span class="lineno">  767</span>&#160;}</div><div class="ttc" id="structast__framehook__interface_html_ab6d7b6f8c2ceaba7acda80aaf05f4899"><div class="ttname"><a href="../../d3/d7b/structast__framehook__interface.html#ab6d7b6f8c2ceaba7acda80aaf05f4899">ast_framehook_interface::version</a></div><div class="ttdeci">uint16_t version</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d3c/framehook_8h_source.html#l00231">framehook.h:231</a></div></div>
<div class="ttc" id="structast__framehook__interface_html"><div class="ttname"><a href="../../d3/d7b/structast__framehook__interface.html">ast_framehook_interface</a></div><div class="ttdef"><b>Definition:</b> <a href="../../db/d3c/framehook_8h_source.html#l00229">framehook.h:229</a></div></div>
<div class="ttc" id="structtransfer__channel__data_html_a735984d41155bc1032e09bece8f8d66d"><div class="ttname"><a href="../../da/d84/structtransfer__channel__data.html#a735984d41155bc1032e09bece8f8d66d">transfer_channel_data::data</a></div><div class="ttdeci">void * data</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d56/bridge_8h_source.html#l01137">bridge.h:1137</a></div></div>
<div class="ttc" id="channel_8h_html_a493bdebe876caafb8ee535853310364a"><div class="ttname"><a href="../../d5/d7b/channel_8h.html#a493bdebe876caafb8ee535853310364a">ast_channel_lock</a></div><div class="ttdeci">#define ast_channel_lock(chan)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d7b/channel_8h_source.html#l02945">channel.h:2945</a></div></div>
<div class="ttc" id="stasis__bridges_8h_html_a8bd3a6c07bd2064a82a7c27091ba0fce"><div class="ttname"><a href="../../dc/d4e/stasis__bridges_8h.html#a8bd3a6c07bd2064a82a7c27091ba0fce">ast_channel_entered_bridge_type</a></div><div class="ttdeci">struct stasis_message_type * ast_channel_entered_bridge_type(void)</div><div class="ttdoc">Message type for channel enter bridge blob messages. </div></div>
<div class="ttc" id="structrefer__progress_html_ac23e23ba60f358de78a893d537c0afa4"><div class="ttname"><a href="../../d0/d4b/structrefer__progress.html#ac23e23ba60f358de78a893d537c0afa4">refer_progress::serializer</a></div><div class="ttdeci">struct ast_taskprocessor * serializer</div><div class="ttdoc">Serializer for notifications. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d75/res__pjsip__refer_8c_source.html#l00056">res_pjsip_refer.c:56</a></div></div>
<div class="ttc" id="structrefer__progress_html_aab0602828a0c8ce025953da194f6681f"><div class="ttname"><a href="../../d0/d4b/structrefer__progress.html#aab0602828a0c8ce025953da194f6681f">refer_progress::bridge_sub</a></div><div class="ttdeci">struct stasis_subscription * bridge_sub</div><div class="ttdoc">Stasis subscription for bridge events. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d75/res__pjsip__refer_8c_source.html#l00058">res_pjsip_refer.c:58</a></div></div>
<div class="ttc" id="logger_8h_html_adf4476a6a4ea6c74231c826e899d7189"><div class="ttname"><a href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a></div><div class="ttdeci">#define LOG_WARNING</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d8c/logger_8h_source.html#l00274">logger.h:274</a></div></div>
<div class="ttc" id="res__pjsip__refer_8c_html_a257bc682830b3e4df38b8d5d413d588c"><div class="ttname"><a href="../../d1/d75/res__pjsip__refer_8c.html#a257bc682830b3e4df38b8d5d413d588c">refer_progress_framehook</a></div><div class="ttdeci">static struct ast_frame * refer_progress_framehook(struct ast_channel *chan, struct ast_frame *f, enum ast_framehook_event event, void *data)</div><div class="ttdoc">Progress monitoring frame hook - examines frames to determine state of transfer. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d75/res__pjsip__refer_8c_source.html#l00236">res_pjsip_refer.c:236</a></div></div>
<div class="ttc" id="structrefer__progress_html_a22abfff94132237b9bfefd9926961698"><div class="ttname"><a href="../../d0/d4b/structrefer__progress.html#a22abfff94132237b9bfefd9926961698">refer_progress::transfer_data</a></div><div class="ttdeci">struct transfer_channel_data * transfer_data</div><div class="ttdoc">Reference to transfer_channel_data related to the refer. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d75/res__pjsip__refer_8c_source.html#l00060">res_pjsip_refer.c:60</a></div></div>
<div class="ttc" id="structrefer__blind_html"><div class="ttname"><a href="../../da/de6/structrefer__blind.html">refer_blind</a></div><div class="ttdoc">Structure for blind transfer callback details. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d75/res__pjsip__refer_8c_source.html#l00609">res_pjsip_refer.c:609</a></div></div>
<div class="ttc" id="framehook_8h_html_a6e116259cae8c1e5cca074d05f0a3475"><div class="ttname"><a href="../../db/d3c/framehook_8h.html#a6e116259cae8c1e5cca074d05f0a3475">ast_framehook_detach</a></div><div class="ttdeci">int ast_framehook_detach(struct ast_channel *chan, int framehook_id)</div><div class="ttdoc">Detach an framehook from a channel. </div><div class="ttdef"><b>Definition:</b> <a href="../../da/dac/framehook_8c_source.html#l00177">framehook.c:177</a></div></div>
<div class="ttc" id="res__pjsip__refer_8c_html_af1b4316df480302870d7bc3e9391227d"><div class="ttname"><a href="../../d1/d75/res__pjsip__refer_8c.html#af1b4316df480302870d7bc3e9391227d">refer_progress_bridge</a></div><div class="ttdeci">static void refer_progress_bridge(void *data, struct stasis_subscription *sub, struct stasis_message *message)</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d75/res__pjsip__refer_8c_source.html#l00181">res_pjsip_refer.c:181</a></div></div>
<div class="ttc" id="structrefer__progress_html_ae25f61b5aa8877dfb396fd378c6b7722"><div class="ttname"><a href="../../d0/d4b/structrefer__progress.html#ae25f61b5aa8877dfb396fd378c6b7722">refer_progress::framehook</a></div><div class="ttdeci">int framehook</div><div class="ttdoc">Frame hook for monitoring REFER progress. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d75/res__pjsip__refer_8c_source.html#l00052">res_pjsip_refer.c:52</a></div></div>
<div class="ttc" id="stasis_8h_html_a52b5393bef89d7781c0d039d6489de23"><div class="ttname"><a href="../../dd/d79/stasis_8h.html#a52b5393bef89d7781c0d039d6489de23">stasis_subscription_set_filter</a></div><div class="ttdeci">int stasis_subscription_set_filter(struct stasis_subscription *subscription, enum stasis_subscription_message_filter filter)</div><div class="ttdoc">Set the message type filtering level on a subscription. </div><div class="ttdef"><b>Definition:</b> <a href="../../d0/df4/stasis_8c_source.html#l01079">stasis.c:1079</a></div></div>
<div class="ttc" id="structrefer__progress__notification_html"><div class="ttname"><a href="../../d3/dff/structrefer__progress__notification.html">refer_progress_notification</a></div><div class="ttdoc">REFER Progress notification structure. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d75/res__pjsip__refer_8c_source.html#l00070">res_pjsip_refer.c:70</a></div></div>
<div class="ttc" id="structrefer__progress_html_a63e413c0e98d7635f20ef19c9432c1aa"><div class="ttname"><a href="../../d0/d4b/structrefer__progress.html#a63e413c0e98d7635f20ef19c9432c1aa">refer_progress::refer_blind_progress</a></div><div class="ttdeci">unsigned int refer_blind_progress</div><div class="ttdoc">Whether to notifies all the progress details on blind transfer. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d75/res__pjsip__refer_8c_source.html#l00066">res_pjsip_refer.c:66</a></div></div>
<div class="ttc" id="astmm_8h_html_ab263849d03fb892847be4986db759737"><div class="ttname"><a href="../../d8/d8a/astmm_8h.html#ab263849d03fb892847be4986db759737">ast_strdup</a></div><div class="ttdeci">#define ast_strdup(str)</div><div class="ttdoc">A wrapper for strdup() </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d8a/astmm_8h_source.html#l00243">astmm.h:243</a></div></div>
<div class="ttc" id="res__pjsip_8h_html_a7da3e1f7ee3fcb77f29d41a76a7528fe"><div class="ttname"><a href="../../d8/d8c/res__pjsip_8h.html#a7da3e1f7ee3fcb77f29d41a76a7528fe">ast_copy_pj_str</a></div><div class="ttdeci">void ast_copy_pj_str(char *dest, const pj_str_t *src, size_t size)</div><div class="ttdoc">Copy a pj_str_t into a standard character buffer. </div><div class="ttdef"><b>Definition:</b> <a href="../../de/d96/res__pjsip_8c_source.html#l05240">res_pjsip.c:5240</a></div></div>
<div class="ttc" id="resample_8c_html_a070d2ce7b6bb7e5c05602aa8c308d0c4"><div class="ttname"><a href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a></div><div class="ttdeci">#define NULL</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d7f/resample_8c_source.html#l00096">resample.c:96</a></div></div>
<div class="ttc" id="structrefer__blind_html_a78ae786167e10c748e902a68acf1138d"><div class="ttname"><a href="../../da/de6/structrefer__blind.html#a78ae786167e10c748e902a68acf1138d">refer_blind::progress</a></div><div class="ttdeci">struct refer_progress * progress</div><div class="ttdoc">Optional progress structure. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d75/res__pjsip__refer_8c_source.html#l00613">res_pjsip_refer.c:613</a></div></div>
<div class="ttc" id="structrefer__blind_html_a91dcef106d87bfcd59a03e0e33642ff6"><div class="ttname"><a href="../../da/de6/structrefer__blind.html#a91dcef106d87bfcd59a03e0e33642ff6">refer_blind::attended</a></div><div class="ttdeci">unsigned int attended</div><div class="ttdoc">Attended transfer flag. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d75/res__pjsip__refer_8c_source.html#l00621">res_pjsip_refer.c:621</a></div></div>
<div class="ttc" id="structrefer__progress_html_ad59ea5bda14dba853447d8de13813038"><div class="ttname"><a href="../../d0/d4b/structrefer__progress.html#ad59ea5bda14dba853447d8de13813038">refer_progress::transferee</a></div><div class="ttdeci">char * transferee</div><div class="ttdoc">Uniqueid of transferee channel. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d75/res__pjsip__refer_8c_source.html#l00062">res_pjsip_refer.c:62</a></div></div>
<div class="ttc" id="framehook_8h_html_a3ca711dc98d26e881936c855f0ae3d77"><div class="ttname"><a href="../../db/d3c/framehook_8h.html#a3ca711dc98d26e881936c855f0ae3d77">ast_framehook_attach</a></div><div class="ttdeci">int ast_framehook_attach(struct ast_channel *chan, struct ast_framehook_interface *i)</div><div class="ttdoc">Attach an framehook onto a channel for frame interception. </div><div class="ttdef"><b>Definition:</b> <a href="../../da/dac/framehook_8c_source.html#l00132">framehook.c:132</a></div></div>
<div class="ttc" id="astobj2_8c_html_a96a00b3a518d7f32b6d51dc28f09bf9b"><div class="ttname"><a href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a></div><div class="ttdeci">#define ast_log</div><div class="ttdef"><b>Definition:</b> <a href="../../da/df7/astobj2_8c_source.html#l00042">astobj2.c:42</a></div></div>
<div class="ttc" id="structrefer__blind_html_a94f090d1fb5c71712726fcdf025b9ace"><div class="ttname"><a href="../../da/de6/structrefer__blind.html#a94f090d1fb5c71712726fcdf025b9ace">refer_blind::context</a></div><div class="ttdeci">const char * context</div><div class="ttdoc">Context being used for transfer. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d75/res__pjsip__refer_8c_source.html#l00611">res_pjsip_refer.c:611</a></div></div>
<div class="ttc" id="structrefer__blind_html_ae53dbeeccf085547b974cfc2cc13bb04"><div class="ttname"><a href="../../da/de6/structrefer__blind.html#ae53dbeeccf085547b974cfc2cc13bb04">refer_blind::refer_to</a></div><div class="ttdeci">pjsip_sip_uri * refer_to</div><div class="ttdoc">Optional Refer-To header. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d75/res__pjsip__refer_8c_source.html#l00619">res_pjsip_refer.c:619</a></div></div>
<div class="ttc" id="astobj2_8h_html_aaca5e8eac39a22f9da1c36fc6c922270"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a></div><div class="ttdeci">#define ao2_ref(o, delta)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l00464">astobj2.h:464</a></div></div>
<div class="ttc" id="astmm_8h_html_a249282ecc7ba5a1a49fa75e9a33d1717"><div class="ttname"><a href="../../d8/d8a/astmm_8h.html#a249282ecc7ba5a1a49fa75e9a33d1717">ast_alloca</a></div><div class="ttdeci">#define ast_alloca(size)</div><div class="ttdoc">call __builtin_alloca to ensure we get gcc builtin semantics </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d8a/astmm_8h_source.html#l00290">astmm.h:290</a></div></div>
<div class="ttc" id="channel_8h_html_a3b6254f6d3832ef928f0a727113b1c63"><div class="ttname"><a href="../../d5/d7b/channel_8h.html#a3b6254f6d3832ef928f0a727113b1c63">ast_channel_uniqueid</a></div><div class="ttdeci">const char * ast_channel_uniqueid(const struct ast_channel *chan)</div><div class="ttdef"><b>Definition:</b> <a href="../../db/de2/channel__internal__api_8c_source.html#l00305">channel_internal_api.c:305</a></div></div>
<div class="ttc" id="group__pjsip__threading_html_ga4f0a0629fa2ca084812772356d8e3565"><div class="ttname"><a href="../../d7/dfa/group__pjsip__threading.html#ga4f0a0629fa2ca084812772356d8e3565">ast_sip_push_task</a></div><div class="ttdeci">int ast_sip_push_task(struct ast_taskprocessor *serializer, int(*sip_task)(void *), void *task_data)</div><div class="ttdoc">Pushes a task to SIP servants. </div><div class="ttdef"><b>Definition:</b> <a href="../../de/d96/res__pjsip_8c_source.html#l05138">res_pjsip.c:5138</a></div></div>
<div class="ttc" id="framehook_8h_html_ae3b6fa28df6c8608d05936efaf929f32"><div class="ttname"><a href="../../db/d3c/framehook_8h.html#ae3b6fa28df6c8608d05936efaf929f32">AST_FRAMEHOOK_INTERFACE_VERSION</a></div><div class="ttdeci">#define AST_FRAMEHOOK_INTERFACE_VERSION</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d3c/framehook_8h_source.html#l00227">framehook.h:227</a></div></div>
<div class="ttc" id="func__strings_8c_html_af24e73aaf92f3000fda15d285e66df24"><div class="ttname"><a href="../../d9/d1e/func__strings_8c.html#af24e73aaf92f3000fda15d285e66df24">len</a></div><div class="ttdeci">static int len(struct ast_channel *chan, const char *cmd, char *data, char *buf, size_t buflen)</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d1e/func__strings_8c_source.html#l01344">func_strings.c:1344</a></div></div>
<div class="ttc" id="structrefer__blind_html_a1aa05c1a9100a9bc5f44546a5c2059fa"><div class="ttname"><a href="../../da/de6/structrefer__blind.html#a1aa05c1a9100a9bc5f44546a5c2059fa">refer_blind::replaces</a></div><div class="ttdeci">pjsip_replaces_hdr * replaces</div><div class="ttdoc">Optional Replaces header. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d75/res__pjsip__refer_8c_source.html#l00617">res_pjsip_refer.c:617</a></div></div>
<div class="ttc" id="stasis_8h_html_a597f7a30fe616c9f083a93ed168955ed"><div class="ttname"><a href="../../dd/d79/stasis_8h.html#a597f7a30fe616c9f083a93ed168955ed">stasis_subscribe_pool</a></div><div class="ttdeci">#define stasis_subscribe_pool(topic, callback, data)</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d79/stasis_8h_source.html#l00682">stasis.h:682</a></div></div>
<div class="ttc" id="channel_8h_html_af476c537b29be3f29240489032f9db39"><div class="ttname"><a href="../../d5/d7b/channel_8h.html#af476c537b29be3f29240489032f9db39">ast_channel_unlock</a></div><div class="ttdeci">#define ast_channel_unlock(chan)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d7b/channel_8h_source.html#l02946">channel.h:2946</a></div></div>
<div class="ttc" id="res__pjsip__refer_8c_html_a89f2c1d96492b68d1399f20fc6eeb833"><div class="ttname"><a href="../../d1/d75/res__pjsip__refer_8c.html#a89f2c1d96492b68d1399f20fc6eeb833">refer_progress_notification_alloc</a></div><div class="ttdeci">static struct refer_progress_notification * refer_progress_notification_alloc(struct refer_progress *progress, int response, pjsip_evsub_state state)</div><div class="ttdoc">Allocator for REFER Progress notification structure. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d75/res__pjsip__refer_8c_source.html#l00094">res_pjsip_refer.c:94</a></div></div>
<div class="ttc" id="stasis__bridges_8h_html_abf64fa441014314244648caa6c8ab80b"><div class="ttname"><a href="../../dc/d4e/stasis__bridges_8h.html#abf64fa441014314244648caa6c8ab80b">ast_bridge_topic_all</a></div><div class="ttdeci">struct stasis_topic * ast_bridge_topic_all(void)</div><div class="ttdoc">A topic which publishes the events for all bridges. </div><div class="ttdef"><b>Definition:</b> <a href="../../da/d0f/stasis__bridges_8c_source.html#l00179">stasis_bridges.c:179</a></div></div>
<div class="ttc" id="pbx_8h_html_a6e5b90edb84d216267148dddcffe9b9a"><div class="ttname"><a href="../../db/de0/pbx_8h.html#a6e5b90edb84d216267148dddcffe9b9a">pbx_builtin_setvar_helper</a></div><div class="ttdeci">int pbx_builtin_setvar_helper(struct ast_channel *chan, const char *name, const char *value)</div><div class="ttdoc">Add a variable to the channel variable stack, removing the most recently set value for the same name...</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d8c/pbx__variables_8c_source.html#l01071">pbx_variables.c:1071</a></div></div>
<div class="ttc" id="res__pjsip__refer_8c_html_ace0ce27cec92bc5b7997cc2d6890bf10"><div class="ttname"><a href="../../d1/d75/res__pjsip__refer_8c.html#ace0ce27cec92bc5b7997cc2d6890bf10">refer_progress_framehook_destroy</a></div><div class="ttdeci">static void refer_progress_framehook_destroy(void *data)</div><div class="ttdoc">Destroy callback for monitoring framehook. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d75/res__pjsip__refer_8c_source.html#l00297">res_pjsip_refer.c:297</a></div></div>
<div class="ttc" id="structrefer__blind_html_a41249c16bd9cc17b36f3719debaf7a67"><div class="ttname"><a href="../../da/de6/structrefer__blind.html#a41249c16bd9cc17b36f3719debaf7a67">refer_blind::rdata</a></div><div class="ttdeci">pjsip_rx_data * rdata</div><div class="ttdoc">REFER message. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d75/res__pjsip__refer_8c_source.html#l00615">res_pjsip_refer.c:615</a></div></div>
<div class="ttc" id="res__pjsip__refer_8c_html_a5d2be3003a3c77234b90343bc0a43935"><div class="ttname"><a href="../../d1/d75/res__pjsip__refer_8c.html#a5d2be3003a3c77234b90343bc0a43935">refer_progress_notify</a></div><div class="ttdeci">static int refer_progress_notify(void *data)</div><div class="ttdoc">Serialized callback for subscription notification. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d75/res__pjsip__refer_8c_source.html#l00140">res_pjsip_refer.c:140</a></div></div>
<div class="ttc" id="astobj2_8h_html_a6321ee982370c55ab3c24c72c562cbdd"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#a6321ee982370c55ab3c24c72c562cbdd">ao2_cleanup</a></div><div class="ttdeci">#define ao2_cleanup(obj)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l01958">astobj2.h:1958</a></div></div>
<div class="ttc" id="strings_8h_html_a2faaa16929951bfd2802b7829a100ba2"><div class="ttname"><a href="../../d6/d90/strings_8h.html#a2faaa16929951bfd2802b7829a100ba2">S_OR</a></div><div class="ttdeci">#define S_OR(a, b)</div><div class="ttdoc">returns the equivalent of logic or for strings: first one if not empty, otherwise second one...</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d90/strings_8h_source.html#l00079">strings.h:79</a></div></div>
<div class="ttc" id="channel_8h_html_a7ca2fda13b129a55c251b56729de285b"><div class="ttname"><a href="../../d5/d7b/channel_8h.html#a7ca2fda13b129a55c251b56729de285b">ast_channel_name</a></div><div class="ttdeci">const char * ast_channel_name(const struct ast_channel *chan)</div></div>
<div class="ttc" id="stasis_8h_html_a4f248ee5f4791f05d0af8768aaab282b"><div class="ttname"><a href="../../dd/d79/stasis_8h.html#a4f248ee5f4791f05d0af8768aaab282b">stasis_subscription_accept_message_type</a></div><div class="ttdeci">int stasis_subscription_accept_message_type(struct stasis_subscription *subscription, const struct stasis_message_type *type)</div><div class="ttdoc">Indicate to a subscription that we are interested in a message type. </div><div class="ttdef"><b>Definition:</b> <a href="../../d0/df4/stasis_8c_source.html#l01025">stasis.c:1025</a></div></div>
<div class="ttc" id="stasis_8h_html_a3804fa8ec76d77090d5cda80fc4ac891a0e40588366edb9a53e453d47ef26d567"><div class="ttname"><a href="../../dd/d79/stasis_8h.html#a3804fa8ec76d77090d5cda80fc4ac891a0e40588366edb9a53e453d47ef26d567">STASIS_SUBSCRIPTION_FILTER_SELECTIVE</a></div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d79/stasis_8h_source.html#l00300">stasis.h:300</a></div></div>
<div class="ttc" id="group__StasisTopicsAndMessages_html_gafae630f05995b59b49dc523a5b9ce757"><div class="ttname"><a href="../../df/deb/group__StasisTopicsAndMessages.html#gafae630f05995b59b49dc523a5b9ce757">stasis_subscription_change_type</a></div><div class="ttdeci">struct stasis_message_type * stasis_subscription_change_type(void)</div><div class="ttdoc">Gets the message type for subscription change notices. </div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a4c8c85f5bb081806be83bc5da897b019"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4c8c85f5bb081806be83bc5da897b019">&#9670;&nbsp;</a></span>refer_incoming_attended_request()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int refer_incoming_attended_request </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="../../d2/dec/structast__sip__session.html">ast_sip_session</a> *&#160;</td>
          <td class="paramname"><em>session</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">pjsip_rx_data *&#160;</td>
          <td class="paramname"><em>rdata</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">pjsip_sip_uri *&#160;</td>
          <td class="paramname"><em>target_uri</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">pjsip_param *&#160;</td>
          <td class="paramname"><em>replaces_param</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="../../d0/d4b/structrefer__progress.html">refer_progress</a> *&#160;</td>
          <td class="paramname"><em>progress</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="../../d1/d75/res__pjsip__refer_8c_source.html#l00789">789</a> of file <a class="el" href="../../d1/d75/res__pjsip__refer_8c_source.html">res_pjsip_refer.c</a>.</p>

<p class="reference">References <a class="el" href="../../d5/da5/astobj2_8h_source.html#l01958">ao2_cleanup</a>, <a class="el" href="../../d0/d95/bridge_8c_source.html#l04477">ast_bridge_transfer_blind()</a>, <a class="el" href="../../d5/d7b/channel_8h.html#a7ca2fda13b129a55c251b56729de285b">ast_channel_name()</a>, <a class="el" href="../../d1/d8c/logger_8h_source.html#l00452">ast_debug</a>, <a class="el" href="../../db/d94/pbx_8c_source.html#l04179">ast_exists_extension()</a>, <a class="el" href="../../da/df7/astobj2_8c_source.html#l00042">ast_log</a>, <a class="el" href="../../d4/d92/res__pjsip__session_8c_source.html#l03630">ast_sip_dialog_get_session()</a>, <a class="el" href="../../de/d96/res__pjsip_8c_source.html#l05138">ast_sip_push_task()</a>, <a class="el" href="../../d4/d92/res__pjsip__session_8c_source.html#l03554">ast_sip_session_defer_termination()</a>, <a class="el" href="../../d4/d92/res__pjsip__session_8c_source.html#l03596">ast_sip_session_defer_termination_cancel()</a>, <a class="el" href="../../d4/d92/res__pjsip__session_8c_source.html#l03614">ast_sip_session_end_if_deferred()</a>, <a class="el" href="../../d7/d69/sorcery_8c_source.html#l02312">ast_sorcery_object_get_id()</a>, <a class="el" href="../../d1/d75/res__pjsip__refer_8c_source.html#l00621">refer_blind::attended</a>, <a class="el" href="../../d9/de7/res__pjsip__session_8h_source.html#l00189">ast_sip_session::channel</a>, <a class="el" href="../../da/d45/chan__alsa_8c_source.html#l00116">context</a>, <a class="el" href="../../d1/d75/res__pjsip__refer_8c_source.html#l00611">refer_blind::context</a>, <a class="el" href="../../d1/d75/res__pjsip__refer_8c_source.html#l00777">DETERMINE_TRANSFER_CONTEXT</a>, <a class="el" href="../../d1/d75/res__pjsip__refer_8c_source.html#l00048">refer_progress::dlg</a>, <a class="el" href="../../d9/de7/res__pjsip__session_8h_source.html#l00183">ast_sip_session::endpoint</a>, <a class="el" href="../../d1/d8c/logger_8h_source.html#l00285">LOG_ERROR</a>, <a class="el" href="../../dc/d7f/resample_8c_source.html#l00096">NULL</a>, <a class="el" href="../../d1/d75/res__pjsip__refer_8c_source.html#l00613">refer_blind::progress</a>, <a class="el" href="../../d5/d60/utils_8h_source.html#l00911">RAII_VAR</a>, <a class="el" href="../../d1/d75/res__pjsip__refer_8c_source.html#l00050">refer_progress::rdata</a>, <a class="el" href="../../d1/d75/res__pjsip__refer_8c_source.html#l00615">refer_blind::rdata</a>, <a class="el" href="../../d1/d75/res__pjsip__refer_8c_source.html#l00475">refer_attended_alloc()</a>, <a class="el" href="../../d1/d75/res__pjsip__refer_8c_source.html#l00553">refer_attended_task()</a>, <a class="el" href="../../d1/d75/res__pjsip__refer_8c_source.html#l00625">refer_blind_callback()</a>, <a class="el" href="../../d1/d75/res__pjsip__refer_8c_source.html#l00619">refer_blind::refer_to</a>, <a class="el" href="../../d1/d75/res__pjsip__refer_8c_source.html#l00617">refer_blind::replaces</a>, and <a class="el" href="../../d1/d75/res__pjsip__refer_8c_source.html#l00530">xfer_response_code2sip()</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../d1/d75/res__pjsip__refer_8c_source.html#l01088">refer_incoming_refer_request()</a>.</p>
<div class="fragment"><div class="line"><a name="l00791"></a><span class="lineno">  791</span>&#160;{</div><div class="line"><a name="l00792"></a><span class="lineno">  792</span>&#160;   <span class="keyword">const</span> pj_str_t str_replaces = { <span class="stringliteral">&quot;Replaces&quot;</span>, 8 };</div><div class="line"><a name="l00793"></a><span class="lineno">  793</span>&#160;   pj_str_t replaces_content;</div><div class="line"><a name="l00794"></a><span class="lineno">  794</span>&#160;   pjsip_replaces_hdr *replaces;</div><div class="line"><a name="l00795"></a><span class="lineno">  795</span>&#160;   <span class="keywordtype">int</span> parsed_len;</div><div class="line"><a name="l00796"></a><span class="lineno">  796</span>&#160;   pjsip_dialog *dlg;</div><div class="line"><a name="l00797"></a><span class="lineno">  797</span>&#160;</div><div class="line"><a name="l00798"></a><span class="lineno">  798</span>&#160;   pj_strdup_with_null(rdata-&gt;tp_info.pool, &amp;replaces_content, &amp;replaces_param-&gt;value);</div><div class="line"><a name="l00799"></a><span class="lineno">  799</span>&#160;</div><div class="line"><a name="l00800"></a><span class="lineno">  800</span>&#160;   <span class="comment">/* Parsing the parameter as a Replaces header easily grabs the needed information */</span></div><div class="line"><a name="l00801"></a><span class="lineno">  801</span>&#160;   <span class="keywordflow">if</span> (!(replaces = pjsip_parse_hdr(rdata-&gt;tp_info.pool, &amp;str_replaces, replaces_content.ptr,</div><div class="line"><a name="l00802"></a><span class="lineno">  802</span>&#160;      pj_strlen(&amp;replaces_content), &amp;parsed_len))) {</div><div class="line"><a name="l00803"></a><span class="lineno">  803</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Received REFER request on channel &#39;%s&#39; from endpoint &#39;%s&#39; with invalid Replaces header, rejecting\n&quot;</span>,</div><div class="line"><a name="l00804"></a><span class="lineno">  804</span>&#160;         <a class="code" href="../../d5/d7b/channel_8h.html#a7ca2fda13b129a55c251b56729de285b">ast_channel_name</a>(session-&gt;<a class="code" href="../../d2/dec/structast__sip__session.html#a48371aaa1ad1144e564ebcd179a2db2e">channel</a>), <a class="code" href="../../d8/d25/sorcery_8h.html#a97706283a06cbb44e4f0f9620dd5cf07">ast_sorcery_object_get_id</a>(session-&gt;<a class="code" href="../../d2/dec/structast__sip__session.html#a3960205b2a4e7e012dc9f0eae1855f01">endpoint</a>));</div><div class="line"><a name="l00805"></a><span class="lineno">  805</span>&#160;      <span class="keywordflow">return</span> 400;</div><div class="line"><a name="l00806"></a><span class="lineno">  806</span>&#160;   }</div><div class="line"><a name="l00807"></a><span class="lineno">  807</span>&#160;</div><div class="line"><a name="l00808"></a><span class="lineno">  808</span>&#160;   <span class="comment">/* See if the dialog is local, or remote */</span></div><div class="line"><a name="l00809"></a><span class="lineno">  809</span>&#160;   <span class="keywordflow">if</span> ((dlg = pjsip_ua_find_dialog(&amp;replaces-&gt;call_id, &amp;replaces-&gt;to_tag, &amp;replaces-&gt;from_tag, PJ_TRUE))) {</div><div class="line"><a name="l00810"></a><span class="lineno">  810</span>&#160;      <a class="code" href="../../d5/d60/utils_8h.html#a1604b4d72144dd3d9f7da668e90337e9">RAII_VAR</a>(<span class="keyword">struct</span> <a class="code" href="../../d2/dec/structast__sip__session.html">ast_sip_session</a> *, other_session, <a class="code" href="../../d9/de7/res__pjsip__session_8h.html#a908cdf7ba25c4d6f3d2efdf01f0125ca">ast_sip_dialog_get_session</a>(dlg), <a class="code" href="../../d5/da5/astobj2_8h.html#a6321ee982370c55ab3c24c72c562cbdd">ao2_cleanup</a>);</div><div class="line"><a name="l00811"></a><span class="lineno">  811</span>&#160;      <span class="keyword">struct </span><a class="code" href="../../dc/d15/structrefer__attended.html">refer_attended</a> *attended;</div><div class="line"><a name="l00812"></a><span class="lineno">  812</span>&#160;</div><div class="line"><a name="l00813"></a><span class="lineno">  813</span>&#160;      pjsip_dlg_dec_lock(dlg);</div><div class="line"><a name="l00814"></a><span class="lineno">  814</span>&#160;</div><div class="line"><a name="l00815"></a><span class="lineno">  815</span>&#160;      <span class="keywordflow">if</span> (!other_session) {</div><div class="line"><a name="l00816"></a><span class="lineno">  816</span>&#160;         <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(3, <span class="stringliteral">&quot;Received REFER request on channel &#39;%s&#39; from endpoint &#39;%s&#39; for local dialog but no session exists on it\n&quot;</span>,</div><div class="line"><a name="l00817"></a><span class="lineno">  817</span>&#160;            <a class="code" href="../../d5/d7b/channel_8h.html#a7ca2fda13b129a55c251b56729de285b">ast_channel_name</a>(session-&gt;<a class="code" href="../../d2/dec/structast__sip__session.html#a48371aaa1ad1144e564ebcd179a2db2e">channel</a>), <a class="code" href="../../d8/d25/sorcery_8h.html#a97706283a06cbb44e4f0f9620dd5cf07">ast_sorcery_object_get_id</a>(session-&gt;<a class="code" href="../../d2/dec/structast__sip__session.html#a3960205b2a4e7e012dc9f0eae1855f01">endpoint</a>));</div><div class="line"><a name="l00818"></a><span class="lineno">  818</span>&#160;         <span class="keywordflow">return</span> 603;</div><div class="line"><a name="l00819"></a><span class="lineno">  819</span>&#160;      }</div><div class="line"><a name="l00820"></a><span class="lineno">  820</span>&#160;</div><div class="line"><a name="l00821"></a><span class="lineno">  821</span>&#160;      <span class="comment">/* We defer actually doing the attended transfer to the other session so no deadlock can occur */</span></div><div class="line"><a name="l00822"></a><span class="lineno">  822</span>&#160;      <span class="keywordflow">if</span> (!(attended = <a class="code" href="../../d1/d75/res__pjsip__refer_8c.html#a6d7634cbb9a37cc1e5acc87277b455f5">refer_attended_alloc</a>(session, other_session, progress))) {</div><div class="line"><a name="l00823"></a><span class="lineno">  823</span>&#160;         <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Received REFER request on channel &#39;%s&#39; from endpoint &#39;%s&#39; for local dialog but could not allocate structure to complete, rejecting\n&quot;</span>,</div><div class="line"><a name="l00824"></a><span class="lineno">  824</span>&#160;            <a class="code" href="../../d5/d7b/channel_8h.html#a7ca2fda13b129a55c251b56729de285b">ast_channel_name</a>(session-&gt;<a class="code" href="../../d2/dec/structast__sip__session.html#a48371aaa1ad1144e564ebcd179a2db2e">channel</a>), <a class="code" href="../../d8/d25/sorcery_8h.html#a97706283a06cbb44e4f0f9620dd5cf07">ast_sorcery_object_get_id</a>(session-&gt;<a class="code" href="../../d2/dec/structast__sip__session.html#a3960205b2a4e7e012dc9f0eae1855f01">endpoint</a>));</div><div class="line"><a name="l00825"></a><span class="lineno">  825</span>&#160;         <span class="keywordflow">return</span> 500;</div><div class="line"><a name="l00826"></a><span class="lineno">  826</span>&#160;      }</div><div class="line"><a name="l00827"></a><span class="lineno">  827</span>&#160;</div><div class="line"><a name="l00828"></a><span class="lineno">  828</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="../../d9/de7/res__pjsip__session_8h.html#ab099805fb795c60964dff130d6d15165">ast_sip_session_defer_termination</a>(session)) {</div><div class="line"><a name="l00829"></a><span class="lineno">  829</span>&#160;         <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Received REFER request on channel &#39;%s&#39; from endpoint &#39;%s&#39; for local dialog but could not defer termination, rejecting\n&quot;</span>,</div><div class="line"><a name="l00830"></a><span class="lineno">  830</span>&#160;            <a class="code" href="../../d5/d7b/channel_8h.html#a7ca2fda13b129a55c251b56729de285b">ast_channel_name</a>(session-&gt;<a class="code" href="../../d2/dec/structast__sip__session.html#a48371aaa1ad1144e564ebcd179a2db2e">channel</a>), <a class="code" href="../../d8/d25/sorcery_8h.html#a97706283a06cbb44e4f0f9620dd5cf07">ast_sorcery_object_get_id</a>(session-&gt;<a class="code" href="../../d2/dec/structast__sip__session.html#a3960205b2a4e7e012dc9f0eae1855f01">endpoint</a>));</div><div class="line"><a name="l00831"></a><span class="lineno">  831</span>&#160;         <a class="code" href="../../d5/da5/astobj2_8h.html#a6321ee982370c55ab3c24c72c562cbdd">ao2_cleanup</a>(attended);</div><div class="line"><a name="l00832"></a><span class="lineno">  832</span>&#160;         <span class="keywordflow">return</span> 500;</div><div class="line"><a name="l00833"></a><span class="lineno">  833</span>&#160;      }</div><div class="line"><a name="l00834"></a><span class="lineno">  834</span>&#160;</div><div class="line"><a name="l00835"></a><span class="lineno">  835</span>&#160;      <span class="comment">/* Push it to the other session, which will have both channels with minimal locking */</span></div><div class="line"><a name="l00836"></a><span class="lineno">  836</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="../../d7/dfa/group__pjsip__threading.html#ga4f0a0629fa2ca084812772356d8e3565">ast_sip_push_task</a>(other_session-&gt;serializer, <a class="code" href="../../d1/d75/res__pjsip__refer_8c.html#a81d8534849ca3b33df588163b6665f94">refer_attended_task</a>, attended)) {</div><div class="line"><a name="l00837"></a><span class="lineno">  837</span>&#160;         <a class="code" href="../../d9/de7/res__pjsip__session_8h.html#aa55296422ab86c7de1d7f52e9c227d82">ast_sip_session_end_if_deferred</a>(session);</div><div class="line"><a name="l00838"></a><span class="lineno">  838</span>&#160;         <a class="code" href="../../d9/de7/res__pjsip__session_8h.html#a587c035e9aae3bf37049f886dc29dcb6">ast_sip_session_defer_termination_cancel</a>(session);</div><div class="line"><a name="l00839"></a><span class="lineno">  839</span>&#160;         <a class="code" href="../../d5/da5/astobj2_8h.html#a6321ee982370c55ab3c24c72c562cbdd">ao2_cleanup</a>(attended);</div><div class="line"><a name="l00840"></a><span class="lineno">  840</span>&#160;         <span class="keywordflow">return</span> 500;</div><div class="line"><a name="l00841"></a><span class="lineno">  841</span>&#160;      }</div><div class="line"><a name="l00842"></a><span class="lineno">  842</span>&#160;</div><div class="line"><a name="l00843"></a><span class="lineno">  843</span>&#160;      <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(3, <span class="stringliteral">&quot;Attended transfer from &#39;%s&#39; pushed to second channel serializer\n&quot;</span>,</div><div class="line"><a name="l00844"></a><span class="lineno">  844</span>&#160;         <a class="code" href="../../d5/d7b/channel_8h.html#a7ca2fda13b129a55c251b56729de285b">ast_channel_name</a>(session-&gt;<a class="code" href="../../d2/dec/structast__sip__session.html#a48371aaa1ad1144e564ebcd179a2db2e">channel</a>));</div><div class="line"><a name="l00845"></a><span class="lineno">  845</span>&#160;</div><div class="line"><a name="l00846"></a><span class="lineno">  846</span>&#160;      <span class="keywordflow">return</span> 200;</div><div class="line"><a name="l00847"></a><span class="lineno">  847</span>&#160;   } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00848"></a><span class="lineno">  848</span>&#160;      <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="../../da/d45/chan__alsa_8c.html#ac25ea00ee3f082df06e0cf468cbde240">context</a>;</div><div class="line"><a name="l00849"></a><span class="lineno">  849</span>&#160;      <span class="keyword">struct </span><a class="code" href="../../da/de6/structrefer__blind.html">refer_blind</a> refer = { 0, };</div><div class="line"><a name="l00850"></a><span class="lineno">  850</span>&#160;      <span class="keywordtype">int</span> response;</div><div class="line"><a name="l00851"></a><span class="lineno">  851</span>&#160;</div><div class="line"><a name="l00852"></a><span class="lineno">  852</span>&#160;      <a class="code" href="../../d1/d75/res__pjsip__refer_8c.html#a5244b5757f33d46f4458a16d8cc14088">DETERMINE_TRANSFER_CONTEXT</a>(context, session);</div><div class="line"><a name="l00853"></a><span class="lineno">  853</span>&#160;</div><div class="line"><a name="l00854"></a><span class="lineno">  854</span>&#160;      <span class="keywordflow">if</span> (!<a class="code" href="../../db/de0/pbx_8h.html#a64a5b8fdc919806135ad427aca9e71b7">ast_exists_extension</a>(<a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, context, <span class="stringliteral">&quot;external_replaces&quot;</span>, 1, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)) {</div><div class="line"><a name="l00855"></a><span class="lineno">  855</span>&#160;         <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Received REFER for remote session on channel &#39;%s&#39; from endpoint &#39;%s&#39; but &#39;external_replaces&#39; extension not found in context %s\n&quot;</span>,</div><div class="line"><a name="l00856"></a><span class="lineno">  856</span>&#160;            <a class="code" href="../../d5/d7b/channel_8h.html#a7ca2fda13b129a55c251b56729de285b">ast_channel_name</a>(session-&gt;<a class="code" href="../../d2/dec/structast__sip__session.html#a48371aaa1ad1144e564ebcd179a2db2e">channel</a>), <a class="code" href="../../d8/d25/sorcery_8h.html#a97706283a06cbb44e4f0f9620dd5cf07">ast_sorcery_object_get_id</a>(session-&gt;<a class="code" href="../../d2/dec/structast__sip__session.html#a3960205b2a4e7e012dc9f0eae1855f01">endpoint</a>), context);</div><div class="line"><a name="l00857"></a><span class="lineno">  857</span>&#160;         <span class="keywordflow">return</span> 404;</div><div class="line"><a name="l00858"></a><span class="lineno">  858</span>&#160;      }</div><div class="line"><a name="l00859"></a><span class="lineno">  859</span>&#160;</div><div class="line"><a name="l00860"></a><span class="lineno">  860</span>&#160;      refer.<a class="code" href="../../da/de6/structrefer__blind.html#a94f090d1fb5c71712726fcdf025b9ace">context</a> = <a class="code" href="../../da/d45/chan__alsa_8c.html#ac25ea00ee3f082df06e0cf468cbde240">context</a>;</div><div class="line"><a name="l00861"></a><span class="lineno">  861</span>&#160;      refer.<a class="code" href="../../da/de6/structrefer__blind.html#a78ae786167e10c748e902a68acf1138d">progress</a> = <a class="code" href="../../da/de6/structrefer__blind.html#a78ae786167e10c748e902a68acf1138d">progress</a>;</div><div class="line"><a name="l00862"></a><span class="lineno">  862</span>&#160;      refer.<a class="code" href="../../da/de6/structrefer__blind.html#a41249c16bd9cc17b36f3719debaf7a67">rdata</a> = <a class="code" href="../../da/de6/structrefer__blind.html#a41249c16bd9cc17b36f3719debaf7a67">rdata</a>;</div><div class="line"><a name="l00863"></a><span class="lineno">  863</span>&#160;      refer.<a class="code" href="../../da/de6/structrefer__blind.html#a1aa05c1a9100a9bc5f44546a5c2059fa">replaces</a> = <a class="code" href="../../da/de6/structrefer__blind.html#a1aa05c1a9100a9bc5f44546a5c2059fa">replaces</a>;</div><div class="line"><a name="l00864"></a><span class="lineno">  864</span>&#160;      refer.<a class="code" href="../../da/de6/structrefer__blind.html#ae53dbeeccf085547b974cfc2cc13bb04">refer_to</a> = target_uri;</div><div class="line"><a name="l00865"></a><span class="lineno">  865</span>&#160;      refer.<a class="code" href="../../da/de6/structrefer__blind.html#a91dcef106d87bfcd59a03e0e33642ff6">attended</a> = 1;</div><div class="line"><a name="l00866"></a><span class="lineno">  866</span>&#160;</div><div class="line"><a name="l00867"></a><span class="lineno">  867</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="../../d9/de7/res__pjsip__session_8h.html#ab099805fb795c60964dff130d6d15165">ast_sip_session_defer_termination</a>(session)) {</div><div class="line"><a name="l00868"></a><span class="lineno">  868</span>&#160;         <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Received REFER for remote session on channel &#39;%s&#39; from endpoint &#39;%s&#39; but could not defer termination, rejecting\n&quot;</span>,</div><div class="line"><a name="l00869"></a><span class="lineno">  869</span>&#160;            <a class="code" href="../../d5/d7b/channel_8h.html#a7ca2fda13b129a55c251b56729de285b">ast_channel_name</a>(session-&gt;<a class="code" href="../../d2/dec/structast__sip__session.html#a48371aaa1ad1144e564ebcd179a2db2e">channel</a>),</div><div class="line"><a name="l00870"></a><span class="lineno">  870</span>&#160;            <a class="code" href="../../d8/d25/sorcery_8h.html#a97706283a06cbb44e4f0f9620dd5cf07">ast_sorcery_object_get_id</a>(session-&gt;<a class="code" href="../../d2/dec/structast__sip__session.html#a3960205b2a4e7e012dc9f0eae1855f01">endpoint</a>));</div><div class="line"><a name="l00871"></a><span class="lineno">  871</span>&#160;         <span class="keywordflow">return</span> 500;</div><div class="line"><a name="l00872"></a><span class="lineno">  872</span>&#160;      }</div><div class="line"><a name="l00873"></a><span class="lineno">  873</span>&#160;</div><div class="line"><a name="l00874"></a><span class="lineno">  874</span>&#160;      response = <a class="code" href="../../d1/d75/res__pjsip__refer_8c.html#a1d1a233825b31a62bc5074299f4b273c">xfer_response_code2sip</a>(<a class="code" href="../../d4/d56/bridge_8h.html#a982e0e652b9f03abf1ec584c137791a3">ast_bridge_transfer_blind</a>(1, session-&gt;<a class="code" href="../../d2/dec/structast__sip__session.html#a48371aaa1ad1144e564ebcd179a2db2e">channel</a>,</div><div class="line"><a name="l00875"></a><span class="lineno">  875</span>&#160;         <span class="stringliteral">&quot;external_replaces&quot;</span>, context, <a class="code" href="../../d1/d75/res__pjsip__refer_8c.html#a699d01236694a29bde454097cfd05e10">refer_blind_callback</a>, &amp;refer));</div><div class="line"><a name="l00876"></a><span class="lineno">  876</span>&#160;</div><div class="line"><a name="l00877"></a><span class="lineno">  877</span>&#160;      <a class="code" href="../../d9/de7/res__pjsip__session_8h.html#aa55296422ab86c7de1d7f52e9c227d82">ast_sip_session_end_if_deferred</a>(session);</div><div class="line"><a name="l00878"></a><span class="lineno">  878</span>&#160;      <span class="keywordflow">if</span> (response != 200) {</div><div class="line"><a name="l00879"></a><span class="lineno">  879</span>&#160;         <a class="code" href="../../d9/de7/res__pjsip__session_8h.html#a587c035e9aae3bf37049f886dc29dcb6">ast_sip_session_defer_termination_cancel</a>(session);</div><div class="line"><a name="l00880"></a><span class="lineno">  880</span>&#160;      }</div><div class="line"><a name="l00881"></a><span class="lineno">  881</span>&#160;</div><div class="line"><a name="l00882"></a><span class="lineno">  882</span>&#160;      <span class="keywordflow">return</span> response;</div><div class="line"><a name="l00883"></a><span class="lineno">  883</span>&#160;   }</div><div class="line"><a name="l00884"></a><span class="lineno">  884</span>&#160;}</div><div class="ttc" id="structast__sip__session_html_a3960205b2a4e7e012dc9f0eae1855f01"><div class="ttname"><a href="../../d2/dec/structast__sip__session.html#a3960205b2a4e7e012dc9f0eae1855f01">ast_sip_session::endpoint</a></div><div class="ttdeci">struct ast_sip_endpoint * endpoint</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/de7/res__pjsip__session_8h_source.html#l00183">res_pjsip_session.h:183</a></div></div>
<div class="ttc" id="structrefer__blind_html"><div class="ttname"><a href="../../da/de6/structrefer__blind.html">refer_blind</a></div><div class="ttdoc">Structure for blind transfer callback details. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d75/res__pjsip__refer_8c_source.html#l00609">res_pjsip_refer.c:609</a></div></div>
<div class="ttc" id="structrefer__attended_html"><div class="ttname"><a href="../../dc/d15/structrefer__attended.html">refer_attended</a></div><div class="ttdoc">Structure for attended transfer task. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d75/res__pjsip__refer_8c_source.html#l00452">res_pjsip_refer.c:452</a></div></div>
<div class="ttc" id="resample_8c_html_a070d2ce7b6bb7e5c05602aa8c308d0c4"><div class="ttname"><a href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a></div><div class="ttdeci">#define NULL</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d7f/resample_8c_source.html#l00096">resample.c:96</a></div></div>
<div class="ttc" id="res__pjsip__refer_8c_html_a81d8534849ca3b33df588163b6665f94"><div class="ttname"><a href="../../d1/d75/res__pjsip__refer_8c.html#a81d8534849ca3b33df588163b6665f94">refer_attended_task</a></div><div class="ttdeci">static int refer_attended_task(void *data)</div><div class="ttdoc">Task for attended transfer executed by attended-&gt;transferer_second serializer. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d75/res__pjsip__refer_8c_source.html#l00553">res_pjsip_refer.c:553</a></div></div>
<div class="ttc" id="res__pjsip__refer_8c_html_a699d01236694a29bde454097cfd05e10"><div class="ttname"><a href="../../d1/d75/res__pjsip__refer_8c.html#a699d01236694a29bde454097cfd05e10">refer_blind_callback</a></div><div class="ttdeci">static void refer_blind_callback(struct ast_channel *chan, struct transfer_channel_data *user_data_wrapper, enum ast_transfer_type transfer_type)</div><div class="ttdoc">Blind transfer callback function. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d75/res__pjsip__refer_8c_source.html#l00625">res_pjsip_refer.c:625</a></div></div>
<div class="ttc" id="structast__sip__session_html"><div class="ttname"><a href="../../d2/dec/structast__sip__session.html">ast_sip_session</a></div><div class="ttdoc">A structure describing a SIP session. </div><div class="ttdef"><b>Definition:</b> <a href="../../d9/de7/res__pjsip__session_8h_source.html#l00179">res_pjsip_session.h:179</a></div></div>
<div class="ttc" id="structrefer__blind_html_a78ae786167e10c748e902a68acf1138d"><div class="ttname"><a href="../../da/de6/structrefer__blind.html#a78ae786167e10c748e902a68acf1138d">refer_blind::progress</a></div><div class="ttdeci">struct refer_progress * progress</div><div class="ttdoc">Optional progress structure. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d75/res__pjsip__refer_8c_source.html#l00613">res_pjsip_refer.c:613</a></div></div>
<div class="ttc" id="structrefer__blind_html_a91dcef106d87bfcd59a03e0e33642ff6"><div class="ttname"><a href="../../da/de6/structrefer__blind.html#a91dcef106d87bfcd59a03e0e33642ff6">refer_blind::attended</a></div><div class="ttdeci">unsigned int attended</div><div class="ttdoc">Attended transfer flag. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d75/res__pjsip__refer_8c_source.html#l00621">res_pjsip_refer.c:621</a></div></div>
<div class="ttc" id="res__pjsip__refer_8c_html_a1d1a233825b31a62bc5074299f4b273c"><div class="ttname"><a href="../../d1/d75/res__pjsip__refer_8c.html#a1d1a233825b31a62bc5074299f4b273c">xfer_response_code2sip</a></div><div class="ttdeci">static int xfer_response_code2sip(enum ast_transfer_result xfer_code)</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d75/res__pjsip__refer_8c_source.html#l00530">res_pjsip_refer.c:530</a></div></div>
<div class="ttc" id="logger_8h_html_a3f248112c8d6ce7e3959aa723dade648"><div class="ttname"><a href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a></div><div class="ttdeci">#define ast_debug(level,...)</div><div class="ttdoc">Log a DEBUG message. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d8c/logger_8h_source.html#l00452">logger.h:452</a></div></div>
<div class="ttc" id="astobj2_8c_html_a96a00b3a518d7f32b6d51dc28f09bf9b"><div class="ttname"><a href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a></div><div class="ttdeci">#define ast_log</div><div class="ttdef"><b>Definition:</b> <a href="../../da/df7/astobj2_8c_source.html#l00042">astobj2.c:42</a></div></div>
<div class="ttc" id="structrefer__blind_html_a94f090d1fb5c71712726fcdf025b9ace"><div class="ttname"><a href="../../da/de6/structrefer__blind.html#a94f090d1fb5c71712726fcdf025b9ace">refer_blind::context</a></div><div class="ttdeci">const char * context</div><div class="ttdoc">Context being used for transfer. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d75/res__pjsip__refer_8c_source.html#l00611">res_pjsip_refer.c:611</a></div></div>
<div class="ttc" id="structrefer__blind_html_ae53dbeeccf085547b974cfc2cc13bb04"><div class="ttname"><a href="../../da/de6/structrefer__blind.html#ae53dbeeccf085547b974cfc2cc13bb04">refer_blind::refer_to</a></div><div class="ttdeci">pjsip_sip_uri * refer_to</div><div class="ttdoc">Optional Refer-To header. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d75/res__pjsip__refer_8c_source.html#l00619">res_pjsip_refer.c:619</a></div></div>
<div class="ttc" id="bridge_8h_html_a982e0e652b9f03abf1ec584c137791a3"><div class="ttname"><a href="../../d4/d56/bridge_8h.html#a982e0e652b9f03abf1ec584c137791a3">ast_bridge_transfer_blind</a></div><div class="ttdeci">enum ast_transfer_result ast_bridge_transfer_blind(int is_external, struct ast_channel *transferer, const char *exten, const char *context, transfer_channel_cb new_channel_cb, void *user_data)</div><div class="ttdoc">Blind transfer target to the extension and context provided. </div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d95/bridge_8c_source.html#l04477">bridge.c:4477</a></div></div>
<div class="ttc" id="utils_8h_html_a1604b4d72144dd3d9f7da668e90337e9"><div class="ttname"><a href="../../d5/d60/utils_8h.html#a1604b4d72144dd3d9f7da668e90337e9">RAII_VAR</a></div><div class="ttdeci">#define RAII_VAR(vartype, varname, initval, dtor)</div><div class="ttdoc">Declare a variable that will call a destructor function when it goes out of scope. </div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d60/utils_8h_source.html#l00911">utils.h:911</a></div></div>
<div class="ttc" id="res__pjsip__refer_8c_html_a6d7634cbb9a37cc1e5acc87277b455f5"><div class="ttname"><a href="../../d1/d75/res__pjsip__refer_8c.html#a6d7634cbb9a37cc1e5acc87277b455f5">refer_attended_alloc</a></div><div class="ttdeci">static struct refer_attended * refer_attended_alloc(struct ast_sip_session *transferer, struct ast_sip_session *transferer_second, struct refer_progress *progress)</div><div class="ttdoc">Allocator for attended transfer task. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d75/res__pjsip__refer_8c_source.html#l00475">res_pjsip_refer.c:475</a></div></div>
<div class="ttc" id="res__pjsip__session_8h_html_a587c035e9aae3bf37049f886dc29dcb6"><div class="ttname"><a href="../../d9/de7/res__pjsip__session_8h.html#a587c035e9aae3bf37049f886dc29dcb6">ast_sip_session_defer_termination_cancel</a></div><div class="ttdeci">void ast_sip_session_defer_termination_cancel(struct ast_sip_session *session)</div><div class="ttdoc">Cancel a pending deferred termination. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d92/res__pjsip__session_8c_source.html#l03596">res_pjsip_session.c:3596</a></div></div>
<div class="ttc" id="sorcery_8h_html_a97706283a06cbb44e4f0f9620dd5cf07"><div class="ttname"><a href="../../d8/d25/sorcery_8h.html#a97706283a06cbb44e4f0f9620dd5cf07">ast_sorcery_object_get_id</a></div><div class="ttdeci">const char * ast_sorcery_object_get_id(const void *object)</div><div class="ttdoc">Get the unique identifier of a sorcery object. </div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d69/sorcery_8c_source.html#l02312">sorcery.c:2312</a></div></div>
<div class="ttc" id="structast__sip__session_html_a48371aaa1ad1144e564ebcd179a2db2e"><div class="ttname"><a href="../../d2/dec/structast__sip__session.html#a48371aaa1ad1144e564ebcd179a2db2e">ast_sip_session::channel</a></div><div class="ttdeci">struct ast_channel * channel</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/de7/res__pjsip__session_8h_source.html#l00189">res_pjsip_session.h:189</a></div></div>
<div class="ttc" id="pbx_8h_html_a64a5b8fdc919806135ad427aca9e71b7"><div class="ttname"><a href="../../db/de0/pbx_8h.html#a64a5b8fdc919806135ad427aca9e71b7">ast_exists_extension</a></div><div class="ttdeci">int ast_exists_extension(struct ast_channel *c, const char *context, const char *exten, int priority, const char *callerid)</div><div class="ttdoc">Determine whether an extension exists. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l04179">pbx.c:4179</a></div></div>
<div class="ttc" id="res__pjsip__refer_8c_html_a5244b5757f33d46f4458a16d8cc14088"><div class="ttname"><a href="../../d1/d75/res__pjsip__refer_8c.html#a5244b5757f33d46f4458a16d8cc14088">DETERMINE_TRANSFER_CONTEXT</a></div><div class="ttdeci">#define DETERMINE_TRANSFER_CONTEXT(context, session)</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d75/res__pjsip__refer_8c_source.html#l00777">res_pjsip_refer.c:777</a></div></div>
<div class="ttc" id="logger_8h_html_aced66975c154ea0e2a8ec3bc818b4e08"><div class="ttname"><a href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a></div><div class="ttdeci">#define LOG_ERROR</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d8c/logger_8h_source.html#l00285">logger.h:285</a></div></div>
<div class="ttc" id="group__pjsip__threading_html_ga4f0a0629fa2ca084812772356d8e3565"><div class="ttname"><a href="../../d7/dfa/group__pjsip__threading.html#ga4f0a0629fa2ca084812772356d8e3565">ast_sip_push_task</a></div><div class="ttdeci">int ast_sip_push_task(struct ast_taskprocessor *serializer, int(*sip_task)(void *), void *task_data)</div><div class="ttdoc">Pushes a task to SIP servants. </div><div class="ttdef"><b>Definition:</b> <a href="../../de/d96/res__pjsip_8c_source.html#l05138">res_pjsip.c:5138</a></div></div>
<div class="ttc" id="structrefer__blind_html_a1aa05c1a9100a9bc5f44546a5c2059fa"><div class="ttname"><a href="../../da/de6/structrefer__blind.html#a1aa05c1a9100a9bc5f44546a5c2059fa">refer_blind::replaces</a></div><div class="ttdeci">pjsip_replaces_hdr * replaces</div><div class="ttdoc">Optional Replaces header. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d75/res__pjsip__refer_8c_source.html#l00617">res_pjsip_refer.c:617</a></div></div>
<div class="ttc" id="res__pjsip__session_8h_html_ab099805fb795c60964dff130d6d15165"><div class="ttname"><a href="../../d9/de7/res__pjsip__session_8h.html#ab099805fb795c60964dff130d6d15165">ast_sip_session_defer_termination</a></div><div class="ttdeci">int ast_sip_session_defer_termination(struct ast_sip_session *session)</div><div class="ttdoc">Defer local termination of a session until remote side terminates, or an amount of time passes...</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d92/res__pjsip__session_8c_source.html#l03554">res_pjsip_session.c:3554</a></div></div>
<div class="ttc" id="structrefer__blind_html_a41249c16bd9cc17b36f3719debaf7a67"><div class="ttname"><a href="../../da/de6/structrefer__blind.html#a41249c16bd9cc17b36f3719debaf7a67">refer_blind::rdata</a></div><div class="ttdeci">pjsip_rx_data * rdata</div><div class="ttdoc">REFER message. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d75/res__pjsip__refer_8c_source.html#l00615">res_pjsip_refer.c:615</a></div></div>
<div class="ttc" id="astobj2_8h_html_a6321ee982370c55ab3c24c72c562cbdd"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#a6321ee982370c55ab3c24c72c562cbdd">ao2_cleanup</a></div><div class="ttdeci">#define ao2_cleanup(obj)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l01958">astobj2.h:1958</a></div></div>
<div class="ttc" id="res__pjsip__session_8h_html_aa55296422ab86c7de1d7f52e9c227d82"><div class="ttname"><a href="../../d9/de7/res__pjsip__session_8h.html#aa55296422ab86c7de1d7f52e9c227d82">ast_sip_session_end_if_deferred</a></div><div class="ttdeci">void ast_sip_session_end_if_deferred(struct ast_sip_session *session)</div><div class="ttdoc">End the session if it had been previously deferred. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d92/res__pjsip__session_8c_source.html#l03614">res_pjsip_session.c:3614</a></div></div>
<div class="ttc" id="channel_8h_html_a7ca2fda13b129a55c251b56729de285b"><div class="ttname"><a href="../../d5/d7b/channel_8h.html#a7ca2fda13b129a55c251b56729de285b">ast_channel_name</a></div><div class="ttdeci">const char * ast_channel_name(const struct ast_channel *chan)</div></div>
<div class="ttc" id="chan__alsa_8c_html_ac25ea00ee3f082df06e0cf468cbde240"><div class="ttname"><a href="../../da/d45/chan__alsa_8c.html#ac25ea00ee3f082df06e0cf468cbde240">context</a></div><div class="ttdeci">static char context[AST_MAX_CONTEXT]</div><div class="ttdef"><b>Definition:</b> <a href="../../da/d45/chan__alsa_8c_source.html#l00116">chan_alsa.c:116</a></div></div>
<div class="ttc" id="res__pjsip__session_8h_html_a908cdf7ba25c4d6f3d2efdf01f0125ca"><div class="ttname"><a href="../../d9/de7/res__pjsip__session_8h.html#a908cdf7ba25c4d6f3d2efdf01f0125ca">ast_sip_dialog_get_session</a></div><div class="ttdeci">struct ast_sip_session * ast_sip_dialog_get_session(pjsip_dialog *dlg)</div><div class="ttdoc">Retrieves a session from a dialog. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d92/res__pjsip__session_8c_source.html#l03630">res_pjsip_session.c:3630</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a528166ff65a4e80a894beb5aed0c2d33"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a528166ff65a4e80a894beb5aed0c2d33">&#9670;&nbsp;</a></span>refer_incoming_blind_request()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int refer_incoming_blind_request </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="../../d2/dec/structast__sip__session.html">ast_sip_session</a> *&#160;</td>
          <td class="paramname"><em>session</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">pjsip_rx_data *&#160;</td>
          <td class="paramname"><em>rdata</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">pjsip_sip_uri *&#160;</td>
          <td class="paramname"><em>target</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="../../d0/d4b/structrefer__progress.html">refer_progress</a> *&#160;</td>
          <td class="paramname"><em>progress</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="../../d1/d75/res__pjsip__refer_8c_source.html#l00886">886</a> of file <a class="el" href="../../d1/d75/res__pjsip__refer_8c_source.html">res_pjsip_refer.c</a>.</p>

<p class="reference">References <a class="el" href="../../d0/d95/bridge_8c_source.html#l04477">ast_bridge_transfer_blind()</a>, <a class="el" href="../../d5/d7b/channel_8h.html#a7ca2fda13b129a55c251b56729de285b">ast_channel_name()</a>, <a class="el" href="../../de/d96/res__pjsip_8c_source.html#l05240">ast_copy_pj_str()</a>, <a class="el" href="../../d6/d90/strings_8h_source.html#l00401">ast_copy_string()</a>, <a class="el" href="../../d1/d8c/logger_8h_source.html#l00452">ast_debug</a>, <a class="el" href="../../db/d94/pbx_8c_source.html#l04179">ast_exists_extension()</a>, <a class="el" href="../../da/df7/astobj2_8c_source.html#l00042">ast_log</a>, <a class="el" href="../../d5/d7b/channel_8h_source.html#l00135">AST_MAX_EXTENSION</a>, <a class="el" href="../../d4/d92/res__pjsip__session_8c_source.html#l03554">ast_sip_session_defer_termination()</a>, <a class="el" href="../../d4/d92/res__pjsip__session_8c_source.html#l03596">ast_sip_session_defer_termination_cancel()</a>, <a class="el" href="../../d4/d92/res__pjsip__session_8c_source.html#l03614">ast_sip_session_end_if_deferred()</a>, <a class="el" href="../../d8/d8c/res__pjsip_8h_source.html#l03036">AST_SIP_USER_OPTIONS_TRUNCATE_CHECK</a>, <a class="el" href="../../d7/d69/sorcery_8c_source.html#l02312">ast_sorcery_object_get_id()</a>, <a class="el" href="../../d6/d90/strings_8h_source.html#l00052">ast_strlen_zero</a>, <a class="el" href="../../d1/d75/res__pjsip__refer_8c_source.html#l00621">refer_blind::attended</a>, <a class="el" href="../../d9/de7/res__pjsip__session_8h_source.html#l00189">ast_sip_session::channel</a>, <a class="el" href="../../da/d45/chan__alsa_8c_source.html#l00116">context</a>, <a class="el" href="../../d1/d75/res__pjsip__refer_8c_source.html#l00611">refer_blind::context</a>, <a class="el" href="../../d1/d75/res__pjsip__refer_8c_source.html#l00777">DETERMINE_TRANSFER_CONTEXT</a>, <a class="el" href="../../d9/de7/res__pjsip__session_8h_source.html#l00183">ast_sip_session::endpoint</a>, <a class="el" href="../../da/d45/chan__alsa_8c_source.html#l00118">exten</a>, <a class="el" href="../../d1/d8c/logger_8h_source.html#l00285">LOG_ERROR</a>, <a class="el" href="../../dc/d7f/resample_8c_source.html#l00096">NULL</a>, <a class="el" href="../../d1/d75/res__pjsip__refer_8c_source.html#l00613">refer_blind::progress</a>, <a class="el" href="../../d1/d75/res__pjsip__refer_8c_source.html#l00050">refer_progress::rdata</a>, <a class="el" href="../../d1/d75/res__pjsip__refer_8c_source.html#l00615">refer_blind::rdata</a>, <a class="el" href="../../d1/d75/res__pjsip__refer_8c_source.html#l00625">refer_blind_callback()</a>, <a class="el" href="../../d1/d75/res__pjsip__refer_8c_source.html#l00619">refer_blind::refer_to</a>, and <a class="el" href="../../d1/d75/res__pjsip__refer_8c_source.html#l00530">xfer_response_code2sip()</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../d1/d75/res__pjsip__refer_8c_source.html#l01088">refer_incoming_refer_request()</a>.</p>
<div class="fragment"><div class="line"><a name="l00888"></a><span class="lineno">  888</span>&#160;{</div><div class="line"><a name="l00889"></a><span class="lineno">  889</span>&#160;   <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="../../da/d45/chan__alsa_8c.html#ac25ea00ee3f082df06e0cf468cbde240">context</a>;</div><div class="line"><a name="l00890"></a><span class="lineno">  890</span>&#160;   <span class="keywordtype">char</span> <a class="code" href="../../da/d45/chan__alsa_8c.html#a78d4847658b695383d849efd12399b38">exten</a>[<a class="code" href="../../d5/d7b/channel_8h.html#af4e59494f74ad9e0c50170d9e276ad31">AST_MAX_EXTENSION</a>];</div><div class="line"><a name="l00891"></a><span class="lineno">  891</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../da/de6/structrefer__blind.html">refer_blind</a> refer = { 0, };</div><div class="line"><a name="l00892"></a><span class="lineno">  892</span>&#160;   <span class="keywordtype">int</span> response;</div><div class="line"><a name="l00893"></a><span class="lineno">  893</span>&#160;</div><div class="line"><a name="l00894"></a><span class="lineno">  894</span>&#160;   <span class="comment">/* If no explicit transfer context has been provided use their configured context */</span></div><div class="line"><a name="l00895"></a><span class="lineno">  895</span>&#160;   <a class="code" href="../../d1/d75/res__pjsip__refer_8c.html#a5244b5757f33d46f4458a16d8cc14088">DETERMINE_TRANSFER_CONTEXT</a>(context, session);</div><div class="line"><a name="l00896"></a><span class="lineno">  896</span>&#160;</div><div class="line"><a name="l00897"></a><span class="lineno">  897</span>&#160;   <span class="comment">/* Using the user portion of the target URI see if it exists as a valid extension in their context */</span></div><div class="line"><a name="l00898"></a><span class="lineno">  898</span>&#160;   <a class="code" href="../../d8/d8c/res__pjsip_8h.html#a7da3e1f7ee3fcb77f29d41a76a7528fe">ast_copy_pj_str</a>(exten, &amp;target-&gt;user, <span class="keyword">sizeof</span>(exten));</div><div class="line"><a name="l00899"></a><span class="lineno">  899</span>&#160;</div><div class="line"><a name="l00900"></a><span class="lineno">  900</span>&#160;   <span class="comment">/*</span></div><div class="line"><a name="l00901"></a><span class="lineno">  901</span>&#160;<span class="comment">    * We may want to match in the dialplan without any user</span></div><div class="line"><a name="l00902"></a><span class="lineno">  902</span>&#160;<span class="comment">    * options getting in the way.</span></div><div class="line"><a name="l00903"></a><span class="lineno">  903</span>&#160;<span class="comment">    */</span></div><div class="line"><a name="l00904"></a><span class="lineno">  904</span>&#160;   <a class="code" href="../../d8/d8c/res__pjsip_8h.html#a6bb5769d100d0348446c7f032eca58c1">AST_SIP_USER_OPTIONS_TRUNCATE_CHECK</a>(exten);</div><div class="line"><a name="l00905"></a><span class="lineno">  905</span>&#160;</div><div class="line"><a name="l00906"></a><span class="lineno">  906</span>&#160;   <span class="comment">/* Uri without exten */</span></div><div class="line"><a name="l00907"></a><span class="lineno">  907</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a>(exten)) {</div><div class="line"><a name="l00908"></a><span class="lineno">  908</span>&#160;      <a class="code" href="../../d6/d90/strings_8h.html#ac4040268f7b6ed77dfc49c7767626369">ast_copy_string</a>(exten, <span class="stringliteral">&quot;s&quot;</span>, <span class="keyword">sizeof</span>(exten));</div><div class="line"><a name="l00909"></a><span class="lineno">  909</span>&#160;      <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(3, <span class="stringliteral">&quot;Channel &#39;%s&#39; from endpoint &#39;%s&#39; attempted blind transfer to a target without extension. Target was set to &#39;s@%s&#39;\n&quot;</span>,</div><div class="line"><a name="l00910"></a><span class="lineno">  910</span>&#160;         <a class="code" href="../../d5/d7b/channel_8h.html#a7ca2fda13b129a55c251b56729de285b">ast_channel_name</a>(session-&gt;<a class="code" href="../../d2/dec/structast__sip__session.html#a48371aaa1ad1144e564ebcd179a2db2e">channel</a>), <a class="code" href="../../d8/d25/sorcery_8h.html#a97706283a06cbb44e4f0f9620dd5cf07">ast_sorcery_object_get_id</a>(session-&gt;<a class="code" href="../../d2/dec/structast__sip__session.html#a3960205b2a4e7e012dc9f0eae1855f01">endpoint</a>), context);</div><div class="line"><a name="l00911"></a><span class="lineno">  911</span>&#160;   }</div><div class="line"><a name="l00912"></a><span class="lineno">  912</span>&#160;</div><div class="line"><a name="l00913"></a><span class="lineno">  913</span>&#160;   <span class="keywordflow">if</span> (!<a class="code" href="../../db/de0/pbx_8h.html#a64a5b8fdc919806135ad427aca9e71b7">ast_exists_extension</a>(<a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, context, exten, 1, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)) {</div><div class="line"><a name="l00914"></a><span class="lineno">  914</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Channel &#39;%s&#39; from endpoint &#39;%s&#39; attempted blind transfer to &#39;%s@%s&#39; but target does not exist\n&quot;</span>,</div><div class="line"><a name="l00915"></a><span class="lineno">  915</span>&#160;         <a class="code" href="../../d5/d7b/channel_8h.html#a7ca2fda13b129a55c251b56729de285b">ast_channel_name</a>(session-&gt;<a class="code" href="../../d2/dec/structast__sip__session.html#a48371aaa1ad1144e564ebcd179a2db2e">channel</a>), <a class="code" href="../../d8/d25/sorcery_8h.html#a97706283a06cbb44e4f0f9620dd5cf07">ast_sorcery_object_get_id</a>(session-&gt;<a class="code" href="../../d2/dec/structast__sip__session.html#a3960205b2a4e7e012dc9f0eae1855f01">endpoint</a>), exten, context);</div><div class="line"><a name="l00916"></a><span class="lineno">  916</span>&#160;      <span class="keywordflow">return</span> 404;</div><div class="line"><a name="l00917"></a><span class="lineno">  917</span>&#160;   }</div><div class="line"><a name="l00918"></a><span class="lineno">  918</span>&#160;</div><div class="line"><a name="l00919"></a><span class="lineno">  919</span>&#160;   refer.<a class="code" href="../../da/de6/structrefer__blind.html#a94f090d1fb5c71712726fcdf025b9ace">context</a> = <a class="code" href="../../da/d45/chan__alsa_8c.html#ac25ea00ee3f082df06e0cf468cbde240">context</a>;</div><div class="line"><a name="l00920"></a><span class="lineno">  920</span>&#160;   refer.<a class="code" href="../../da/de6/structrefer__blind.html#a78ae786167e10c748e902a68acf1138d">progress</a> = <a class="code" href="../../da/de6/structrefer__blind.html#a78ae786167e10c748e902a68acf1138d">progress</a>;</div><div class="line"><a name="l00921"></a><span class="lineno">  921</span>&#160;   refer.<a class="code" href="../../da/de6/structrefer__blind.html#a41249c16bd9cc17b36f3719debaf7a67">rdata</a> = <a class="code" href="../../da/de6/structrefer__blind.html#a41249c16bd9cc17b36f3719debaf7a67">rdata</a>;</div><div class="line"><a name="l00922"></a><span class="lineno">  922</span>&#160;   refer.<a class="code" href="../../da/de6/structrefer__blind.html#ae53dbeeccf085547b974cfc2cc13bb04">refer_to</a> = target;</div><div class="line"><a name="l00923"></a><span class="lineno">  923</span>&#160;   refer.<a class="code" href="../../da/de6/structrefer__blind.html#a91dcef106d87bfcd59a03e0e33642ff6">attended</a> = 0;</div><div class="line"><a name="l00924"></a><span class="lineno">  924</span>&#160;</div><div class="line"><a name="l00925"></a><span class="lineno">  925</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d9/de7/res__pjsip__session_8h.html#ab099805fb795c60964dff130d6d15165">ast_sip_session_defer_termination</a>(session)) {</div><div class="line"><a name="l00926"></a><span class="lineno">  926</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Channel &#39;%s&#39; from endpoint &#39;%s&#39; attempted blind transfer but could not defer termination, rejecting\n&quot;</span>,</div><div class="line"><a name="l00927"></a><span class="lineno">  927</span>&#160;         <a class="code" href="../../d5/d7b/channel_8h.html#a7ca2fda13b129a55c251b56729de285b">ast_channel_name</a>(session-&gt;<a class="code" href="../../d2/dec/structast__sip__session.html#a48371aaa1ad1144e564ebcd179a2db2e">channel</a>),</div><div class="line"><a name="l00928"></a><span class="lineno">  928</span>&#160;         <a class="code" href="../../d8/d25/sorcery_8h.html#a97706283a06cbb44e4f0f9620dd5cf07">ast_sorcery_object_get_id</a>(session-&gt;<a class="code" href="../../d2/dec/structast__sip__session.html#a3960205b2a4e7e012dc9f0eae1855f01">endpoint</a>));</div><div class="line"><a name="l00929"></a><span class="lineno">  929</span>&#160;      <span class="keywordflow">return</span> 500;</div><div class="line"><a name="l00930"></a><span class="lineno">  930</span>&#160;   }</div><div class="line"><a name="l00931"></a><span class="lineno">  931</span>&#160;</div><div class="line"><a name="l00932"></a><span class="lineno">  932</span>&#160;   response = <a class="code" href="../../d1/d75/res__pjsip__refer_8c.html#a1d1a233825b31a62bc5074299f4b273c">xfer_response_code2sip</a>(<a class="code" href="../../d4/d56/bridge_8h.html#a982e0e652b9f03abf1ec584c137791a3">ast_bridge_transfer_blind</a>(1, session-&gt;<a class="code" href="../../d2/dec/structast__sip__session.html#a48371aaa1ad1144e564ebcd179a2db2e">channel</a>,</div><div class="line"><a name="l00933"></a><span class="lineno">  933</span>&#160;      exten, context, <a class="code" href="../../d1/d75/res__pjsip__refer_8c.html#a699d01236694a29bde454097cfd05e10">refer_blind_callback</a>, &amp;refer));</div><div class="line"><a name="l00934"></a><span class="lineno">  934</span>&#160;</div><div class="line"><a name="l00935"></a><span class="lineno">  935</span>&#160;   <a class="code" href="../../d9/de7/res__pjsip__session_8h.html#aa55296422ab86c7de1d7f52e9c227d82">ast_sip_session_end_if_deferred</a>(session);</div><div class="line"><a name="l00936"></a><span class="lineno">  936</span>&#160;   <span class="keywordflow">if</span> (response != 200) {</div><div class="line"><a name="l00937"></a><span class="lineno">  937</span>&#160;      <a class="code" href="../../d9/de7/res__pjsip__session_8h.html#a587c035e9aae3bf37049f886dc29dcb6">ast_sip_session_defer_termination_cancel</a>(session);</div><div class="line"><a name="l00938"></a><span class="lineno">  938</span>&#160;   }</div><div class="line"><a name="l00939"></a><span class="lineno">  939</span>&#160;</div><div class="line"><a name="l00940"></a><span class="lineno">  940</span>&#160;   <span class="keywordflow">return</span> response;</div><div class="line"><a name="l00941"></a><span class="lineno">  941</span>&#160;}</div><div class="ttc" id="chan__alsa_8c_html_a78d4847658b695383d849efd12399b38"><div class="ttname"><a href="../../da/d45/chan__alsa_8c.html#a78d4847658b695383d849efd12399b38">exten</a></div><div class="ttdeci">static char exten[AST_MAX_EXTENSION]</div><div class="ttdef"><b>Definition:</b> <a href="../../da/d45/chan__alsa_8c_source.html#l00118">chan_alsa.c:118</a></div></div>
<div class="ttc" id="structast__sip__session_html_a3960205b2a4e7e012dc9f0eae1855f01"><div class="ttname"><a href="../../d2/dec/structast__sip__session.html#a3960205b2a4e7e012dc9f0eae1855f01">ast_sip_session::endpoint</a></div><div class="ttdeci">struct ast_sip_endpoint * endpoint</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/de7/res__pjsip__session_8h_source.html#l00183">res_pjsip_session.h:183</a></div></div>
<div class="ttc" id="res__pjsip_8h_html_a6bb5769d100d0348446c7f032eca58c1"><div class="ttname"><a href="../../d8/d8c/res__pjsip_8h.html#a6bb5769d100d0348446c7f032eca58c1">AST_SIP_USER_OPTIONS_TRUNCATE_CHECK</a></div><div class="ttdeci">#define AST_SIP_USER_OPTIONS_TRUNCATE_CHECK(str)</div><div class="ttdoc">Truncate the URI user field options string if enabled. </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d8c/res__pjsip_8h_source.html#l03036">res_pjsip.h:3036</a></div></div>
<div class="ttc" id="structrefer__blind_html"><div class="ttname"><a href="../../da/de6/structrefer__blind.html">refer_blind</a></div><div class="ttdoc">Structure for blind transfer callback details. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d75/res__pjsip__refer_8c_source.html#l00609">res_pjsip_refer.c:609</a></div></div>
<div class="ttc" id="res__pjsip_8h_html_a7da3e1f7ee3fcb77f29d41a76a7528fe"><div class="ttname"><a href="../../d8/d8c/res__pjsip_8h.html#a7da3e1f7ee3fcb77f29d41a76a7528fe">ast_copy_pj_str</a></div><div class="ttdeci">void ast_copy_pj_str(char *dest, const pj_str_t *src, size_t size)</div><div class="ttdoc">Copy a pj_str_t into a standard character buffer. </div><div class="ttdef"><b>Definition:</b> <a href="../../de/d96/res__pjsip_8c_source.html#l05240">res_pjsip.c:5240</a></div></div>
<div class="ttc" id="resample_8c_html_a070d2ce7b6bb7e5c05602aa8c308d0c4"><div class="ttname"><a href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a></div><div class="ttdeci">#define NULL</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d7f/resample_8c_source.html#l00096">resample.c:96</a></div></div>
<div class="ttc" id="res__pjsip__refer_8c_html_a699d01236694a29bde454097cfd05e10"><div class="ttname"><a href="../../d1/d75/res__pjsip__refer_8c.html#a699d01236694a29bde454097cfd05e10">refer_blind_callback</a></div><div class="ttdeci">static void refer_blind_callback(struct ast_channel *chan, struct transfer_channel_data *user_data_wrapper, enum ast_transfer_type transfer_type)</div><div class="ttdoc">Blind transfer callback function. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d75/res__pjsip__refer_8c_source.html#l00625">res_pjsip_refer.c:625</a></div></div>
<div class="ttc" id="structrefer__blind_html_a78ae786167e10c748e902a68acf1138d"><div class="ttname"><a href="../../da/de6/structrefer__blind.html#a78ae786167e10c748e902a68acf1138d">refer_blind::progress</a></div><div class="ttdeci">struct refer_progress * progress</div><div class="ttdoc">Optional progress structure. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d75/res__pjsip__refer_8c_source.html#l00613">res_pjsip_refer.c:613</a></div></div>
<div class="ttc" id="structrefer__blind_html_a91dcef106d87bfcd59a03e0e33642ff6"><div class="ttname"><a href="../../da/de6/structrefer__blind.html#a91dcef106d87bfcd59a03e0e33642ff6">refer_blind::attended</a></div><div class="ttdeci">unsigned int attended</div><div class="ttdoc">Attended transfer flag. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d75/res__pjsip__refer_8c_source.html#l00621">res_pjsip_refer.c:621</a></div></div>
<div class="ttc" id="strings_8h_html_a372554b7a2d69a8bd3adac5157672036"><div class="ttname"><a href="../../d6/d90/strings_8h.html#a372554b7a2d69a8bd3adac5157672036">ast_strlen_zero</a></div><div class="ttdeci">#define ast_strlen_zero(foo)</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d90/strings_8h_source.html#l00052">strings.h:52</a></div></div>
<div class="ttc" id="res__pjsip__refer_8c_html_a1d1a233825b31a62bc5074299f4b273c"><div class="ttname"><a href="../../d1/d75/res__pjsip__refer_8c.html#a1d1a233825b31a62bc5074299f4b273c">xfer_response_code2sip</a></div><div class="ttdeci">static int xfer_response_code2sip(enum ast_transfer_result xfer_code)</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d75/res__pjsip__refer_8c_source.html#l00530">res_pjsip_refer.c:530</a></div></div>
<div class="ttc" id="logger_8h_html_a3f248112c8d6ce7e3959aa723dade648"><div class="ttname"><a href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a></div><div class="ttdeci">#define ast_debug(level,...)</div><div class="ttdoc">Log a DEBUG message. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d8c/logger_8h_source.html#l00452">logger.h:452</a></div></div>
<div class="ttc" id="astobj2_8c_html_a96a00b3a518d7f32b6d51dc28f09bf9b"><div class="ttname"><a href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a></div><div class="ttdeci">#define ast_log</div><div class="ttdef"><b>Definition:</b> <a href="../../da/df7/astobj2_8c_source.html#l00042">astobj2.c:42</a></div></div>
<div class="ttc" id="structrefer__blind_html_a94f090d1fb5c71712726fcdf025b9ace"><div class="ttname"><a href="../../da/de6/structrefer__blind.html#a94f090d1fb5c71712726fcdf025b9ace">refer_blind::context</a></div><div class="ttdeci">const char * context</div><div class="ttdoc">Context being used for transfer. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d75/res__pjsip__refer_8c_source.html#l00611">res_pjsip_refer.c:611</a></div></div>
<div class="ttc" id="structrefer__blind_html_ae53dbeeccf085547b974cfc2cc13bb04"><div class="ttname"><a href="../../da/de6/structrefer__blind.html#ae53dbeeccf085547b974cfc2cc13bb04">refer_blind::refer_to</a></div><div class="ttdeci">pjsip_sip_uri * refer_to</div><div class="ttdoc">Optional Refer-To header. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d75/res__pjsip__refer_8c_source.html#l00619">res_pjsip_refer.c:619</a></div></div>
<div class="ttc" id="bridge_8h_html_a982e0e652b9f03abf1ec584c137791a3"><div class="ttname"><a href="../../d4/d56/bridge_8h.html#a982e0e652b9f03abf1ec584c137791a3">ast_bridge_transfer_blind</a></div><div class="ttdeci">enum ast_transfer_result ast_bridge_transfer_blind(int is_external, struct ast_channel *transferer, const char *exten, const char *context, transfer_channel_cb new_channel_cb, void *user_data)</div><div class="ttdoc">Blind transfer target to the extension and context provided. </div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d95/bridge_8c_source.html#l04477">bridge.c:4477</a></div></div>
<div class="ttc" id="channel_8h_html_af4e59494f74ad9e0c50170d9e276ad31"><div class="ttname"><a href="../../d5/d7b/channel_8h.html#af4e59494f74ad9e0c50170d9e276ad31">AST_MAX_EXTENSION</a></div><div class="ttdeci">#define AST_MAX_EXTENSION</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d7b/channel_8h_source.html#l00135">channel.h:135</a></div></div>
<div class="ttc" id="res__pjsip__session_8h_html_a587c035e9aae3bf37049f886dc29dcb6"><div class="ttname"><a href="../../d9/de7/res__pjsip__session_8h.html#a587c035e9aae3bf37049f886dc29dcb6">ast_sip_session_defer_termination_cancel</a></div><div class="ttdeci">void ast_sip_session_defer_termination_cancel(struct ast_sip_session *session)</div><div class="ttdoc">Cancel a pending deferred termination. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d92/res__pjsip__session_8c_source.html#l03596">res_pjsip_session.c:3596</a></div></div>
<div class="ttc" id="sorcery_8h_html_a97706283a06cbb44e4f0f9620dd5cf07"><div class="ttname"><a href="../../d8/d25/sorcery_8h.html#a97706283a06cbb44e4f0f9620dd5cf07">ast_sorcery_object_get_id</a></div><div class="ttdeci">const char * ast_sorcery_object_get_id(const void *object)</div><div class="ttdoc">Get the unique identifier of a sorcery object. </div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d69/sorcery_8c_source.html#l02312">sorcery.c:2312</a></div></div>
<div class="ttc" id="structast__sip__session_html_a48371aaa1ad1144e564ebcd179a2db2e"><div class="ttname"><a href="../../d2/dec/structast__sip__session.html#a48371aaa1ad1144e564ebcd179a2db2e">ast_sip_session::channel</a></div><div class="ttdeci">struct ast_channel * channel</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/de7/res__pjsip__session_8h_source.html#l00189">res_pjsip_session.h:189</a></div></div>
<div class="ttc" id="pbx_8h_html_a64a5b8fdc919806135ad427aca9e71b7"><div class="ttname"><a href="../../db/de0/pbx_8h.html#a64a5b8fdc919806135ad427aca9e71b7">ast_exists_extension</a></div><div class="ttdeci">int ast_exists_extension(struct ast_channel *c, const char *context, const char *exten, int priority, const char *callerid)</div><div class="ttdoc">Determine whether an extension exists. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/d94/pbx_8c_source.html#l04179">pbx.c:4179</a></div></div>
<div class="ttc" id="res__pjsip__refer_8c_html_a5244b5757f33d46f4458a16d8cc14088"><div class="ttname"><a href="../../d1/d75/res__pjsip__refer_8c.html#a5244b5757f33d46f4458a16d8cc14088">DETERMINE_TRANSFER_CONTEXT</a></div><div class="ttdeci">#define DETERMINE_TRANSFER_CONTEXT(context, session)</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d75/res__pjsip__refer_8c_source.html#l00777">res_pjsip_refer.c:777</a></div></div>
<div class="ttc" id="logger_8h_html_aced66975c154ea0e2a8ec3bc818b4e08"><div class="ttname"><a href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a></div><div class="ttdeci">#define LOG_ERROR</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d8c/logger_8h_source.html#l00285">logger.h:285</a></div></div>
<div class="ttc" id="res__pjsip__session_8h_html_ab099805fb795c60964dff130d6d15165"><div class="ttname"><a href="../../d9/de7/res__pjsip__session_8h.html#ab099805fb795c60964dff130d6d15165">ast_sip_session_defer_termination</a></div><div class="ttdeci">int ast_sip_session_defer_termination(struct ast_sip_session *session)</div><div class="ttdoc">Defer local termination of a session until remote side terminates, or an amount of time passes...</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d92/res__pjsip__session_8c_source.html#l03554">res_pjsip_session.c:3554</a></div></div>
<div class="ttc" id="structrefer__blind_html_a41249c16bd9cc17b36f3719debaf7a67"><div class="ttname"><a href="../../da/de6/structrefer__blind.html#a41249c16bd9cc17b36f3719debaf7a67">refer_blind::rdata</a></div><div class="ttdeci">pjsip_rx_data * rdata</div><div class="ttdoc">REFER message. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d75/res__pjsip__refer_8c_source.html#l00615">res_pjsip_refer.c:615</a></div></div>
<div class="ttc" id="res__pjsip__session_8h_html_aa55296422ab86c7de1d7f52e9c227d82"><div class="ttname"><a href="../../d9/de7/res__pjsip__session_8h.html#aa55296422ab86c7de1d7f52e9c227d82">ast_sip_session_end_if_deferred</a></div><div class="ttdeci">void ast_sip_session_end_if_deferred(struct ast_sip_session *session)</div><div class="ttdoc">End the session if it had been previously deferred. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d92/res__pjsip__session_8c_source.html#l03614">res_pjsip_session.c:3614</a></div></div>
<div class="ttc" id="strings_8h_html_ac4040268f7b6ed77dfc49c7767626369"><div class="ttname"><a href="../../d6/d90/strings_8h.html#ac4040268f7b6ed77dfc49c7767626369">ast_copy_string</a></div><div class="ttdeci">void ast_copy_string(char *dst, const char *src, size_t size)</div><div class="ttdoc">Size-limited null-terminating string copy. </div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d90/strings_8h_source.html#l00401">strings.h:401</a></div></div>
<div class="ttc" id="channel_8h_html_a7ca2fda13b129a55c251b56729de285b"><div class="ttname"><a href="../../d5/d7b/channel_8h.html#a7ca2fda13b129a55c251b56729de285b">ast_channel_name</a></div><div class="ttdeci">const char * ast_channel_name(const struct ast_channel *chan)</div></div>
<div class="ttc" id="chan__alsa_8c_html_ac25ea00ee3f082df06e0cf468cbde240"><div class="ttname"><a href="../../da/d45/chan__alsa_8c.html#ac25ea00ee3f082df06e0cf468cbde240">context</a></div><div class="ttdeci">static char context[AST_MAX_CONTEXT]</div><div class="ttdef"><b>Definition:</b> <a href="../../da/d45/chan__alsa_8c_source.html#l00116">chan_alsa.c:116</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a5e57806e0d60b29bf6adbd28b97de46c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a5e57806e0d60b29bf6adbd28b97de46c">&#9670;&nbsp;</a></span>refer_incoming_invite_request()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int refer_incoming_invite_request </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="../../d2/dec/structast__sip__session.html">ast_sip_session</a> *&#160;</td>
          <td class="paramname"><em>session</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct pjsip_rx_data *&#160;</td>
          <td class="paramname"><em>rdata</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="../../d1/d75/res__pjsip__refer_8c_source.html#l00969">969</a> of file <a class="el" href="../../d1/d75/res__pjsip__refer_8c_source.html">res_pjsip_refer.c</a>.</p>

<p class="reference">References <a class="el" href="../../d5/da5/astobj2_8h_source.html#l01958">ao2_cleanup</a>, <a class="el" href="../../d5/d60/utils_8h_source.html#l00695">ast_assert</a>, <a class="el" href="../../d0/d95/bridge_8c_source.html#l01924">ast_bridge_impart()</a>, <a class="el" href="../../d4/d56/bridge_8h_source.html#l00604">AST_BRIDGE_IMPART_CHAN_INDEPENDENT</a>, <a class="el" href="../../d4/da3/causes_8h_source.html#l00149">AST_CAUSE_FAILURE</a>, <a class="el" href="../../db/de2/channel__internal__api_8c_source.html#l00431">ast_channel_hangupcause_set()</a>, <a class="el" href="../../d5/d7b/channel_8h_source.html#l02945">ast_channel_lock</a>, <a class="el" href="../../d4/d28/channel_8c_source.html#l10867">ast_channel_move()</a>, <a class="el" href="../../d5/d7b/channel_8h.html#a7ca2fda13b129a55c251b56729de285b">ast_channel_name()</a>, <a class="el" href="../../d5/d7b/channel_8h_source.html#l02946">ast_channel_unlock</a>, <a class="el" href="../../d5/d7b/channel_8h_source.html#l02981">ast_channel_unref</a>, <a class="el" href="../../d1/d8c/logger_8h_source.html#l00452">ast_debug</a>, <a class="el" href="../../d4/d28/channel_8c_source.html#l02548">ast_hangup()</a>, <a class="el" href="../../d4/d28/channel_8c_source.html#l01150">ast_queue_hangup()</a>, <a class="el" href="../../d4/d28/channel_8c_source.html#l02699">ast_raw_answer()</a>, <a class="el" href="../../d4/d28/channel_8c_source.html#l07486">ast_setstate()</a>, <a class="el" href="../../d4/d92/res__pjsip__session_8c_source.html#l03630">ast_sip_dialog_get_session()</a>, <a class="el" href="../../de/d96/res__pjsip_8c_source.html#l05218">ast_sip_push_task_wait_serializer()</a>, <a class="el" href="../../d4/d92/res__pjsip__session_8c_source.html#l02576">ast_sip_session_send_response()</a>, <a class="el" href="../../d7/d69/sorcery_8c_source.html#l02312">ast_sorcery_object_get_id()</a>, <a class="el" href="../../d9/d95/channelstate_8h_source.html#l00040">AST_STATE_RING</a>, <a class="el" href="../../d1/d75/res__pjsip__refer_8c_source.html#l00950">invite_replaces::bridge</a>, <a class="el" href="../../d9/de7/res__pjsip__session_8h_source.html#l00189">ast_sip_session::channel</a>, <a class="el" href="../../d1/d75/res__pjsip__refer_8c_source.html#l00948">invite_replaces::channel</a>, <a class="el" href="../../d9/de7/res__pjsip__session_8h_source.html#l00215">ast_sip_session::defer_terminate</a>, <a class="el" href="../../d9/de7/res__pjsip__session_8h_source.html#l00183">ast_sip_session::endpoint</a>, <a class="el" href="../../d9/de7/res__pjsip__session_8h_source.html#l00187">ast_sip_session::inv_session</a>, <a class="el" href="../../dc/d7f/resample_8c_source.html#l00096">NULL</a>, <a class="el" href="../../d5/d60/utils_8h_source.html#l00911">RAII_VAR</a>, and <a class="el" href="../../d1/d75/res__pjsip__refer_8c_source.html#l00946">invite_replaces::session</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../d1/d75/res__pjsip__refer_8c_source.html#l01198">refer_incoming_request()</a>.</p>
<div class="fragment"><div class="line"><a name="l00970"></a><span class="lineno">  970</span>&#160;{</div><div class="line"><a name="l00971"></a><span class="lineno">  971</span>&#160;   pjsip_dialog *other_dlg = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l00972"></a><span class="lineno">  972</span>&#160;   pjsip_tx_data *packet;</div><div class="line"><a name="l00973"></a><span class="lineno">  973</span>&#160;   <span class="keywordtype">int</span> response = 0;</div><div class="line"><a name="l00974"></a><span class="lineno">  974</span>&#160;   <a class="code" href="../../d5/d60/utils_8h.html#a1604b4d72144dd3d9f7da668e90337e9">RAII_VAR</a>(<span class="keyword">struct</span> <a class="code" href="../../d2/dec/structast__sip__session.html">ast_sip_session</a> *, other_session, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../d5/da5/astobj2_8h.html#a6321ee982370c55ab3c24c72c562cbdd">ao2_cleanup</a>);</div><div class="line"><a name="l00975"></a><span class="lineno">  975</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d8/d70/structinvite__replaces.html">invite_replaces</a> invite;</div><div class="line"><a name="l00976"></a><span class="lineno">  976</span>&#160;</div><div class="line"><a name="l00977"></a><span class="lineno">  977</span>&#160;   <span class="comment">/* If a Replaces header is present make sure it is valid */</span></div><div class="line"><a name="l00978"></a><span class="lineno">  978</span>&#160;   <span class="keywordflow">if</span> (pjsip_replaces_verify_request(rdata, &amp;other_dlg, PJ_TRUE, &amp;packet) != PJ_SUCCESS) {</div><div class="line"><a name="l00979"></a><span class="lineno">  979</span>&#160;      response = packet-&gt;msg-&gt;line.status.code;</div><div class="line"><a name="l00980"></a><span class="lineno">  980</span>&#160;      <a class="code" href="../../d5/d60/utils_8h.html#a24374da24af1931d8a7ccde5b352bb2c">ast_assert</a>(response != 0);</div><div class="line"><a name="l00981"></a><span class="lineno">  981</span>&#160;      pjsip_tx_data_dec_ref(packet);</div><div class="line"><a name="l00982"></a><span class="lineno">  982</span>&#160;      <span class="keywordflow">goto</span> inv_replace_failed;</div><div class="line"><a name="l00983"></a><span class="lineno">  983</span>&#160;   }</div><div class="line"><a name="l00984"></a><span class="lineno">  984</span>&#160;</div><div class="line"><a name="l00985"></a><span class="lineno">  985</span>&#160;   <span class="comment">/* If no other dialog exists then this INVITE request does not have a Replaces header */</span></div><div class="line"><a name="l00986"></a><span class="lineno">  986</span>&#160;   <span class="keywordflow">if</span> (!other_dlg) {</div><div class="line"><a name="l00987"></a><span class="lineno">  987</span>&#160;      <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00988"></a><span class="lineno">  988</span>&#160;   }</div><div class="line"><a name="l00989"></a><span class="lineno">  989</span>&#160;</div><div class="line"><a name="l00990"></a><span class="lineno">  990</span>&#160;   other_session = <a class="code" href="../../d9/de7/res__pjsip__session_8h.html#a908cdf7ba25c4d6f3d2efdf01f0125ca">ast_sip_dialog_get_session</a>(other_dlg);</div><div class="line"><a name="l00991"></a><span class="lineno">  991</span>&#160;   pjsip_dlg_dec_lock(other_dlg);</div><div class="line"><a name="l00992"></a><span class="lineno">  992</span>&#160;</div><div class="line"><a name="l00993"></a><span class="lineno">  993</span>&#160;   <span class="comment">/* Don&#39;t accept an in-dialog INVITE with Replaces as it does not make much sense */</span></div><div class="line"><a name="l00994"></a><span class="lineno">  994</span>&#160;   <span class="keywordflow">if</span> (session-&gt;<a class="code" href="../../d2/dec/structast__sip__session.html#ab9fd713b198a122cb52c7f10bd66d1c6">inv_session</a>-&gt;dlg-&gt;state == PJSIP_DIALOG_STATE_ESTABLISHED) {</div><div class="line"><a name="l00995"></a><span class="lineno">  995</span>&#160;      response = 488;</div><div class="line"><a name="l00996"></a><span class="lineno">  996</span>&#160;      <span class="keywordflow">goto</span> inv_replace_failed;</div><div class="line"><a name="l00997"></a><span class="lineno">  997</span>&#160;   }</div><div class="line"><a name="l00998"></a><span class="lineno">  998</span>&#160;</div><div class="line"><a name="l00999"></a><span class="lineno">  999</span>&#160;   <span class="keywordflow">if</span> (!other_session) {</div><div class="line"><a name="l01000"></a><span class="lineno"> 1000</span>&#160;      <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(3, <span class="stringliteral">&quot;INVITE with Replaces received on channel &#39;%s&#39; from endpoint &#39;%s&#39;, but requested session does not exist\n&quot;</span>,</div><div class="line"><a name="l01001"></a><span class="lineno"> 1001</span>&#160;         <a class="code" href="../../d5/d7b/channel_8h.html#a7ca2fda13b129a55c251b56729de285b">ast_channel_name</a>(session-&gt;<a class="code" href="../../d2/dec/structast__sip__session.html#a48371aaa1ad1144e564ebcd179a2db2e">channel</a>), <a class="code" href="../../d8/d25/sorcery_8h.html#a97706283a06cbb44e4f0f9620dd5cf07">ast_sorcery_object_get_id</a>(session-&gt;<a class="code" href="../../d2/dec/structast__sip__session.html#a3960205b2a4e7e012dc9f0eae1855f01">endpoint</a>));</div><div class="line"><a name="l01002"></a><span class="lineno"> 1002</span>&#160;      response = 481;</div><div class="line"><a name="l01003"></a><span class="lineno"> 1003</span>&#160;      <span class="keywordflow">goto</span> inv_replace_failed;</div><div class="line"><a name="l01004"></a><span class="lineno"> 1004</span>&#160;   }</div><div class="line"><a name="l01005"></a><span class="lineno"> 1005</span>&#160;</div><div class="line"><a name="l01006"></a><span class="lineno"> 1006</span>&#160;   invite.session = other_session;</div><div class="line"><a name="l01007"></a><span class="lineno"> 1007</span>&#160;</div><div class="line"><a name="l01008"></a><span class="lineno"> 1008</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d7/dfa/group__pjsip__threading.html#gac231880459dcf8feacf1bb272b60472a">ast_sip_push_task_wait_serializer</a>(other_session-&gt;serializer, <a class="code" href="../../d8/d70/structinvite__replaces.html">invite_replaces</a>,</div><div class="line"><a name="l01009"></a><span class="lineno"> 1009</span>&#160;      &amp;invite)) {</div><div class="line"><a name="l01010"></a><span class="lineno"> 1010</span>&#160;      response = 481;</div><div class="line"><a name="l01011"></a><span class="lineno"> 1011</span>&#160;      <span class="keywordflow">goto</span> inv_replace_failed;</div><div class="line"><a name="l01012"></a><span class="lineno"> 1012</span>&#160;   }</div><div class="line"><a name="l01013"></a><span class="lineno"> 1013</span>&#160;</div><div class="line"><a name="l01014"></a><span class="lineno"> 1014</span>&#160;   <a class="code" href="../../d5/d7b/channel_8h.html#a493bdebe876caafb8ee535853310364a">ast_channel_lock</a>(session-&gt;<a class="code" href="../../d2/dec/structast__sip__session.html#a48371aaa1ad1144e564ebcd179a2db2e">channel</a>);</div><div class="line"><a name="l01015"></a><span class="lineno"> 1015</span>&#160;   <a class="code" href="../../d9/d95/channelstate_8h.html#ad9d8f7d9e228b5af98a7b40db9f06448">ast_setstate</a>(session-&gt;<a class="code" href="../../d2/dec/structast__sip__session.html#a48371aaa1ad1144e564ebcd179a2db2e">channel</a>, <a class="code" href="../../d9/d95/channelstate_8h.html#a03585bc87e5bbd0f4d11bc789734c660a10482c2bc6340e09ed02b00bc0e3f433">AST_STATE_RING</a>);</div><div class="line"><a name="l01016"></a><span class="lineno"> 1016</span>&#160;   <a class="code" href="../../d5/d7b/channel_8h.html#af476c537b29be3f29240489032f9db39">ast_channel_unlock</a>(session-&gt;<a class="code" href="../../d2/dec/structast__sip__session.html#a48371aaa1ad1144e564ebcd179a2db2e">channel</a>);</div><div class="line"><a name="l01017"></a><span class="lineno"> 1017</span>&#160;   <a class="code" href="../../d5/d7b/channel_8h.html#af558043411edede3b5fda44a08da589f">ast_raw_answer</a>(session-&gt;<a class="code" href="../../d2/dec/structast__sip__session.html#a48371aaa1ad1144e564ebcd179a2db2e">channel</a>);</div><div class="line"><a name="l01018"></a><span class="lineno"> 1018</span>&#160;</div><div class="line"><a name="l01019"></a><span class="lineno"> 1019</span>&#160;   <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(3, <span class="stringliteral">&quot;INVITE with Replaces being attempted.  &#39;%s&#39; --&gt; &#39;%s&#39;\n&quot;</span>,</div><div class="line"><a name="l01020"></a><span class="lineno"> 1020</span>&#160;      <a class="code" href="../../d5/d7b/channel_8h.html#a7ca2fda13b129a55c251b56729de285b">ast_channel_name</a>(session-&gt;<a class="code" href="../../d2/dec/structast__sip__session.html#a48371aaa1ad1144e564ebcd179a2db2e">channel</a>), <a class="code" href="../../d5/d7b/channel_8h.html#a7ca2fda13b129a55c251b56729de285b">ast_channel_name</a>(invite.channel));</div><div class="line"><a name="l01021"></a><span class="lineno"> 1021</span>&#160;</div><div class="line"><a name="l01022"></a><span class="lineno"> 1022</span>&#160;   <span class="keywordflow">if</span> (!invite.bridge) {</div><div class="line"><a name="l01023"></a><span class="lineno"> 1023</span>&#160;      <span class="keyword">struct </span><a class="code" href="../../df/d3c/structast__channel.html">ast_channel</a> *chan = session-&gt;<a class="code" href="../../d2/dec/structast__sip__session.html#a48371aaa1ad1144e564ebcd179a2db2e">channel</a>;</div><div class="line"><a name="l01024"></a><span class="lineno"> 1024</span>&#160;</div><div class="line"><a name="l01025"></a><span class="lineno"> 1025</span>&#160;      <span class="comment">/*</span></div><div class="line"><a name="l01026"></a><span class="lineno"> 1026</span>&#160;<span class="comment">       * This will use a synchronous task but we aren&#39;t operating in</span></div><div class="line"><a name="l01027"></a><span class="lineno"> 1027</span>&#160;<span class="comment">       * the serializer at this point in time, so it won&#39;t deadlock.</span></div><div class="line"><a name="l01028"></a><span class="lineno"> 1028</span>&#160;<span class="comment">       */</span></div><div class="line"><a name="l01029"></a><span class="lineno"> 1029</span>&#160;      <span class="keywordflow">if</span> (!<a class="code" href="../../d5/d7b/channel_8h.html#a8043e35bcff5fb2d410dd161ac6e4360">ast_channel_move</a>(invite.channel, chan)) {</div><div class="line"><a name="l01030"></a><span class="lineno"> 1030</span>&#160;         <span class="comment">/*</span></div><div class="line"><a name="l01031"></a><span class="lineno"> 1031</span>&#160;<span class="comment">          * We can&#39;t directly use session-&gt;channel because ast_channel_move()</span></div><div class="line"><a name="l01032"></a><span class="lineno"> 1032</span>&#160;<span class="comment">          * does a masquerade which changes session-&gt;channel to a different</span></div><div class="line"><a name="l01033"></a><span class="lineno"> 1033</span>&#160;<span class="comment">          * channel.  To ensure we work on the right channel we store a</span></div><div class="line"><a name="l01034"></a><span class="lineno"> 1034</span>&#160;<span class="comment">          * pointer locally before we begin so it remains valid.</span></div><div class="line"><a name="l01035"></a><span class="lineno"> 1035</span>&#160;<span class="comment">          */</span></div><div class="line"><a name="l01036"></a><span class="lineno"> 1036</span>&#160;         <a class="code" href="../../d5/d7b/channel_8h.html#a29557c4823f5e9c02519a01daf6a289c">ast_hangup</a>(chan);</div><div class="line"><a name="l01037"></a><span class="lineno"> 1037</span>&#160;      } <span class="keywordflow">else</span> {</div><div class="line"><a name="l01038"></a><span class="lineno"> 1038</span>&#160;         response = <a class="code" href="../../d4/da3/causes_8h.html#a45c0c189b93333bad969b8f371d8442d">AST_CAUSE_FAILURE</a>;</div><div class="line"><a name="l01039"></a><span class="lineno"> 1039</span>&#160;      }</div><div class="line"><a name="l01040"></a><span class="lineno"> 1040</span>&#160;   } <span class="keywordflow">else</span> {</div><div class="line"><a name="l01041"></a><span class="lineno"> 1041</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="../../d4/d56/bridge_8h.html#a582e1dd73a483ac881cff01fa07f39ae">ast_bridge_impart</a>(invite.bridge, session-&gt;<a class="code" href="../../d2/dec/structast__sip__session.html#a48371aaa1ad1144e564ebcd179a2db2e">channel</a>, invite.channel, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>,</div><div class="line"><a name="l01042"></a><span class="lineno"> 1042</span>&#160;         <a class="code" href="../../d4/d56/bridge_8h.html#ac086b7d74fb40c2ede8514274585b101aecfd8e6279a21b20ee4db0ab69c847e8">AST_BRIDGE_IMPART_CHAN_INDEPENDENT</a>)) {</div><div class="line"><a name="l01043"></a><span class="lineno"> 1043</span>&#160;         response = <a class="code" href="../../d4/da3/causes_8h.html#a45c0c189b93333bad969b8f371d8442d">AST_CAUSE_FAILURE</a>;</div><div class="line"><a name="l01044"></a><span class="lineno"> 1044</span>&#160;      }</div><div class="line"><a name="l01045"></a><span class="lineno"> 1045</span>&#160;   }</div><div class="line"><a name="l01046"></a><span class="lineno"> 1046</span>&#160;</div><div class="line"><a name="l01047"></a><span class="lineno"> 1047</span>&#160;   <a class="code" href="../../d5/d7b/channel_8h.html#ab733a7825810b895a89b629e0ea89380">ast_channel_unref</a>(invite.channel);</div><div class="line"><a name="l01048"></a><span class="lineno"> 1048</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#a6321ee982370c55ab3c24c72c562cbdd">ao2_cleanup</a>(invite.bridge);</div><div class="line"><a name="l01049"></a><span class="lineno"> 1049</span>&#160;</div><div class="line"><a name="l01050"></a><span class="lineno"> 1050</span>&#160;   <span class="keywordflow">if</span> (!response) {</div><div class="line"><a name="l01051"></a><span class="lineno"> 1051</span>&#160;      <span class="comment">/*</span></div><div class="line"><a name="l01052"></a><span class="lineno"> 1052</span>&#160;<span class="comment">       * On success we cannot use session-&gt;channel in the debug message.</span></div><div class="line"><a name="l01053"></a><span class="lineno"> 1053</span>&#160;<span class="comment">       * This thread either no longer has a ref to session-&gt;channel or</span></div><div class="line"><a name="l01054"></a><span class="lineno"> 1054</span>&#160;<span class="comment">       * session-&gt;channel is no longer the original channel.</span></div><div class="line"><a name="l01055"></a><span class="lineno"> 1055</span>&#160;<span class="comment">       */</span></div><div class="line"><a name="l01056"></a><span class="lineno"> 1056</span>&#160;      <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(3, <span class="stringliteral">&quot;INVITE with Replaces successfully completed.\n&quot;</span>);</div><div class="line"><a name="l01057"></a><span class="lineno"> 1057</span>&#160;   } <span class="keywordflow">else</span> {</div><div class="line"><a name="l01058"></a><span class="lineno"> 1058</span>&#160;      <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(3, <span class="stringliteral">&quot;INVITE with Replaces failed on channel &#39;%s&#39;, hanging up with cause &#39;%d&#39;\n&quot;</span>,</div><div class="line"><a name="l01059"></a><span class="lineno"> 1059</span>&#160;         <a class="code" href="../../d5/d7b/channel_8h.html#a7ca2fda13b129a55c251b56729de285b">ast_channel_name</a>(session-&gt;<a class="code" href="../../d2/dec/structast__sip__session.html#a48371aaa1ad1144e564ebcd179a2db2e">channel</a>), response);</div><div class="line"><a name="l01060"></a><span class="lineno"> 1060</span>&#160;      <a class="code" href="../../d5/d7b/channel_8h.html#a493bdebe876caafb8ee535853310364a">ast_channel_lock</a>(session-&gt;<a class="code" href="../../d2/dec/structast__sip__session.html#a48371aaa1ad1144e564ebcd179a2db2e">channel</a>);</div><div class="line"><a name="l01061"></a><span class="lineno"> 1061</span>&#160;      <a class="code" href="../../d5/d7b/channel_8h.html#ae6b4b7ba458e88fdbb2df9f39d935337">ast_channel_hangupcause_set</a>(session-&gt;<a class="code" href="../../d2/dec/structast__sip__session.html#a48371aaa1ad1144e564ebcd179a2db2e">channel</a>, response);</div><div class="line"><a name="l01062"></a><span class="lineno"> 1062</span>&#160;      <a class="code" href="../../d5/d7b/channel_8h.html#af476c537b29be3f29240489032f9db39">ast_channel_unlock</a>(session-&gt;<a class="code" href="../../d2/dec/structast__sip__session.html#a48371aaa1ad1144e564ebcd179a2db2e">channel</a>);</div><div class="line"><a name="l01063"></a><span class="lineno"> 1063</span>&#160;      <a class="code" href="../../d5/d7b/channel_8h.html#a29557c4823f5e9c02519a01daf6a289c">ast_hangup</a>(session-&gt;<a class="code" href="../../d2/dec/structast__sip__session.html#a48371aaa1ad1144e564ebcd179a2db2e">channel</a>);</div><div class="line"><a name="l01064"></a><span class="lineno"> 1064</span>&#160;   }</div><div class="line"><a name="l01065"></a><span class="lineno"> 1065</span>&#160;</div><div class="line"><a name="l01066"></a><span class="lineno"> 1066</span>&#160;   <span class="keywordflow">return</span> 1;</div><div class="line"><a name="l01067"></a><span class="lineno"> 1067</span>&#160;</div><div class="line"><a name="l01068"></a><span class="lineno"> 1068</span>&#160;inv_replace_failed:</div><div class="line"><a name="l01069"></a><span class="lineno"> 1069</span>&#160;   <span class="keywordflow">if</span> (session-&gt;<a class="code" href="../../d2/dec/structast__sip__session.html#ab9fd713b198a122cb52c7f10bd66d1c6">inv_session</a>-&gt;dlg-&gt;state != PJSIP_DIALOG_STATE_ESTABLISHED) {</div><div class="line"><a name="l01070"></a><span class="lineno"> 1070</span>&#160;      <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(3, <span class="stringliteral">&quot;INVITE with Replaces failed on channel &#39;%s&#39;, sending response of &#39;%d&#39;\n&quot;</span>,</div><div class="line"><a name="l01071"></a><span class="lineno"> 1071</span>&#160;         <a class="code" href="../../d5/d7b/channel_8h.html#a7ca2fda13b129a55c251b56729de285b">ast_channel_name</a>(session-&gt;<a class="code" href="../../d2/dec/structast__sip__session.html#a48371aaa1ad1144e564ebcd179a2db2e">channel</a>), response);</div><div class="line"><a name="l01072"></a><span class="lineno"> 1072</span>&#160;      session-&gt;<a class="code" href="../../d2/dec/structast__sip__session.html#a52a2a3cbcab65965d83205363c8f09d1">defer_terminate</a> = 1;</div><div class="line"><a name="l01073"></a><span class="lineno"> 1073</span>&#160;      <a class="code" href="../../d5/d7b/channel_8h.html#a29557c4823f5e9c02519a01daf6a289c">ast_hangup</a>(session-&gt;<a class="code" href="../../d2/dec/structast__sip__session.html#a48371aaa1ad1144e564ebcd179a2db2e">channel</a>);</div><div class="line"><a name="l01074"></a><span class="lineno"> 1074</span>&#160;</div><div class="line"><a name="l01075"></a><span class="lineno"> 1075</span>&#160;      <span class="keywordflow">if</span> (pjsip_inv_end_session(session-&gt;<a class="code" href="../../d2/dec/structast__sip__session.html#ab9fd713b198a122cb52c7f10bd66d1c6">inv_session</a>, response, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, &amp;packet) == PJ_SUCCESS</div><div class="line"><a name="l01076"></a><span class="lineno"> 1076</span>&#160;         &amp;&amp; packet) {</div><div class="line"><a name="l01077"></a><span class="lineno"> 1077</span>&#160;         <a class="code" href="../../d9/de7/res__pjsip__session_8h.html#aed4c9a6bf6967790981c02027f5f02e8">ast_sip_session_send_response</a>(session, packet);</div><div class="line"><a name="l01078"></a><span class="lineno"> 1078</span>&#160;      }</div><div class="line"><a name="l01079"></a><span class="lineno"> 1079</span>&#160;   } <span class="keywordflow">else</span> {</div><div class="line"><a name="l01080"></a><span class="lineno"> 1080</span>&#160;      <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(3, <span class="stringliteral">&quot;INVITE with Replaces in-dialog on channel &#39;%s&#39;, hanging up\n&quot;</span>,</div><div class="line"><a name="l01081"></a><span class="lineno"> 1081</span>&#160;         <a class="code" href="../../d5/d7b/channel_8h.html#a7ca2fda13b129a55c251b56729de285b">ast_channel_name</a>(session-&gt;<a class="code" href="../../d2/dec/structast__sip__session.html#a48371aaa1ad1144e564ebcd179a2db2e">channel</a>));</div><div class="line"><a name="l01082"></a><span class="lineno"> 1082</span>&#160;      <a class="code" href="../../d5/d7b/channel_8h.html#a30bcf0418189567bc84ff32034f79f28">ast_queue_hangup</a>(session-&gt;<a class="code" href="../../d2/dec/structast__sip__session.html#a48371aaa1ad1144e564ebcd179a2db2e">channel</a>);</div><div class="line"><a name="l01083"></a><span class="lineno"> 1083</span>&#160;   }</div><div class="line"><a name="l01084"></a><span class="lineno"> 1084</span>&#160;</div><div class="line"><a name="l01085"></a><span class="lineno"> 1085</span>&#160;   <span class="keywordflow">return</span> 1;</div><div class="line"><a name="l01086"></a><span class="lineno"> 1086</span>&#160;}</div><div class="ttc" id="channel_8h_html_a30bcf0418189567bc84ff32034f79f28"><div class="ttname"><a href="../../d5/d7b/channel_8h.html#a30bcf0418189567bc84ff32034f79f28">ast_queue_hangup</a></div><div class="ttdeci">int ast_queue_hangup(struct ast_channel *chan)</div><div class="ttdoc">Queue a hangup frame. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d28/channel_8c_source.html#l01150">channel.c:1150</a></div></div>
<div class="ttc" id="channel_8h_html_a493bdebe876caafb8ee535853310364a"><div class="ttname"><a href="../../d5/d7b/channel_8h.html#a493bdebe876caafb8ee535853310364a">ast_channel_lock</a></div><div class="ttdeci">#define ast_channel_lock(chan)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d7b/channel_8h_source.html#l02945">channel.h:2945</a></div></div>
<div class="ttc" id="structast__channel_html"><div class="ttname"><a href="../../df/d3c/structast__channel.html">ast_channel</a></div><div class="ttdoc">Main Channel structure associated with a channel. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/de2/channel__internal__api_8c_source.html#l00073">channel_internal_api.c:73</a></div></div>
<div class="ttc" id="structast__sip__session_html_a3960205b2a4e7e012dc9f0eae1855f01"><div class="ttname"><a href="../../d2/dec/structast__sip__session.html#a3960205b2a4e7e012dc9f0eae1855f01">ast_sip_session::endpoint</a></div><div class="ttdeci">struct ast_sip_endpoint * endpoint</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/de7/res__pjsip__session_8h_source.html#l00183">res_pjsip_session.h:183</a></div></div>
<div class="ttc" id="channel_8h_html_ab733a7825810b895a89b629e0ea89380"><div class="ttname"><a href="../../d5/d7b/channel_8h.html#ab733a7825810b895a89b629e0ea89380">ast_channel_unref</a></div><div class="ttdeci">#define ast_channel_unref(c)</div><div class="ttdoc">Decrease channel reference count. </div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d7b/channel_8h_source.html#l02981">channel.h:2981</a></div></div>
<div class="ttc" id="channelstate_8h_html_a03585bc87e5bbd0f4d11bc789734c660a10482c2bc6340e09ed02b00bc0e3f433"><div class="ttname"><a href="../../d9/d95/channelstate_8h.html#a03585bc87e5bbd0f4d11bc789734c660a10482c2bc6340e09ed02b00bc0e3f433">AST_STATE_RING</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d95/channelstate_8h_source.html#l00040">channelstate.h:40</a></div></div>
<div class="ttc" id="channel_8h_html_ae6b4b7ba458e88fdbb2df9f39d935337"><div class="ttname"><a href="../../d5/d7b/channel_8h.html#ae6b4b7ba458e88fdbb2df9f39d935337">ast_channel_hangupcause_set</a></div><div class="ttdeci">void ast_channel_hangupcause_set(struct ast_channel *chan, int value)</div><div class="ttdef"><b>Definition:</b> <a href="../../db/de2/channel__internal__api_8c_source.html#l00431">channel_internal_api.c:431</a></div></div>
<div class="ttc" id="structast__sip__session_html_a52a2a3cbcab65965d83205363c8f09d1"><div class="ttname"><a href="../../d2/dec/structast__sip__session.html#a52a2a3cbcab65965d83205363c8f09d1">ast_sip_session::defer_terminate</a></div><div class="ttdeci">unsigned int defer_terminate</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/de7/res__pjsip__session_8h_source.html#l00215">res_pjsip_session.h:215</a></div></div>
<div class="ttc" id="structinvite__replaces_html"><div class="ttname"><a href="../../d8/d70/structinvite__replaces.html">invite_replaces</a></div><div class="ttdoc">Structure used to retrieve channel from another session. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d75/res__pjsip__refer_8c_source.html#l00944">res_pjsip_refer.c:944</a></div></div>
<div class="ttc" id="utils_8h_html_a24374da24af1931d8a7ccde5b352bb2c"><div class="ttname"><a href="../../d5/d60/utils_8h.html#a24374da24af1931d8a7ccde5b352bb2c">ast_assert</a></div><div class="ttdeci">#define ast_assert(a)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d60/utils_8h_source.html#l00695">utils.h:695</a></div></div>
<div class="ttc" id="resample_8c_html_a070d2ce7b6bb7e5c05602aa8c308d0c4"><div class="ttname"><a href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a></div><div class="ttdeci">#define NULL</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d7f/resample_8c_source.html#l00096">resample.c:96</a></div></div>
<div class="ttc" id="channel_8h_html_a8043e35bcff5fb2d410dd161ac6e4360"><div class="ttname"><a href="../../d5/d7b/channel_8h.html#a8043e35bcff5fb2d410dd161ac6e4360">ast_channel_move</a></div><div class="ttdeci">int ast_channel_move(struct ast_channel *dest, struct ast_channel *source)</div><div class="ttdoc">Move a channel from its current location to a new location. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d28/channel_8c_source.html#l10867">channel.c:10867</a></div></div>
<div class="ttc" id="structast__sip__session_html_ab9fd713b198a122cb52c7f10bd66d1c6"><div class="ttname"><a href="../../d2/dec/structast__sip__session.html#ab9fd713b198a122cb52c7f10bd66d1c6">ast_sip_session::inv_session</a></div><div class="ttdeci">struct pjsip_inv_session * inv_session</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/de7/res__pjsip__session_8h_source.html#l00187">res_pjsip_session.h:187</a></div></div>
<div class="ttc" id="structast__sip__session_html"><div class="ttname"><a href="../../d2/dec/structast__sip__session.html">ast_sip_session</a></div><div class="ttdoc">A structure describing a SIP session. </div><div class="ttdef"><b>Definition:</b> <a href="../../d9/de7/res__pjsip__session_8h_source.html#l00179">res_pjsip_session.h:179</a></div></div>
<div class="ttc" id="channel_8h_html_af558043411edede3b5fda44a08da589f"><div class="ttname"><a href="../../d5/d7b/channel_8h.html#af558043411edede3b5fda44a08da589f">ast_raw_answer</a></div><div class="ttdeci">int ast_raw_answer(struct ast_channel *chan)</div><div class="ttdoc">Answer a channel. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d28/channel_8c_source.html#l02699">channel.c:2699</a></div></div>
<div class="ttc" id="logger_8h_html_a3f248112c8d6ce7e3959aa723dade648"><div class="ttname"><a href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a></div><div class="ttdeci">#define ast_debug(level,...)</div><div class="ttdoc">Log a DEBUG message. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d8c/logger_8h_source.html#l00452">logger.h:452</a></div></div>
<div class="ttc" id="bridge_8h_html_a582e1dd73a483ac881cff01fa07f39ae"><div class="ttname"><a href="../../d4/d56/bridge_8h.html#a582e1dd73a483ac881cff01fa07f39ae">ast_bridge_impart</a></div><div class="ttdeci">int ast_bridge_impart(struct ast_bridge *bridge, struct ast_channel *chan, struct ast_channel *swap, struct ast_bridge_features *features, enum ast_bridge_impart_flags flags) attribute_warn_unused_result</div><div class="ttdoc">Impart a channel to a bridge (non-blocking) </div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d95/bridge_8c_source.html#l01924">bridge.c:1924</a></div></div>
<div class="ttc" id="utils_8h_html_a1604b4d72144dd3d9f7da668e90337e9"><div class="ttname"><a href="../../d5/d60/utils_8h.html#a1604b4d72144dd3d9f7da668e90337e9">RAII_VAR</a></div><div class="ttdeci">#define RAII_VAR(vartype, varname, initval, dtor)</div><div class="ttdoc">Declare a variable that will call a destructor function when it goes out of scope. </div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d60/utils_8h_source.html#l00911">utils.h:911</a></div></div>
<div class="ttc" id="group__pjsip__threading_html_gac231880459dcf8feacf1bb272b60472a"><div class="ttname"><a href="../../d7/dfa/group__pjsip__threading.html#gac231880459dcf8feacf1bb272b60472a">ast_sip_push_task_wait_serializer</a></div><div class="ttdeci">int ast_sip_push_task_wait_serializer(struct ast_taskprocessor *serializer, int(*sip_task)(void *), void *task_data)</div><div class="ttdoc">Push a task to the serializer and wait for it to complete. </div><div class="ttdef"><b>Definition:</b> <a href="../../de/d96/res__pjsip_8c_source.html#l05218">res_pjsip.c:5218</a></div></div>
<div class="ttc" id="sorcery_8h_html_a97706283a06cbb44e4f0f9620dd5cf07"><div class="ttname"><a href="../../d8/d25/sorcery_8h.html#a97706283a06cbb44e4f0f9620dd5cf07">ast_sorcery_object_get_id</a></div><div class="ttdeci">const char * ast_sorcery_object_get_id(const void *object)</div><div class="ttdoc">Get the unique identifier of a sorcery object. </div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d69/sorcery_8c_source.html#l02312">sorcery.c:2312</a></div></div>
<div class="ttc" id="structast__sip__session_html_a48371aaa1ad1144e564ebcd179a2db2e"><div class="ttname"><a href="../../d2/dec/structast__sip__session.html#a48371aaa1ad1144e564ebcd179a2db2e">ast_sip_session::channel</a></div><div class="ttdeci">struct ast_channel * channel</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/de7/res__pjsip__session_8h_source.html#l00189">res_pjsip_session.h:189</a></div></div>
<div class="ttc" id="res__pjsip__session_8h_html_aed4c9a6bf6967790981c02027f5f02e8"><div class="ttname"><a href="../../d9/de7/res__pjsip__session_8h.html#aed4c9a6bf6967790981c02027f5f02e8">ast_sip_session_send_response</a></div><div class="ttdeci">void ast_sip_session_send_response(struct ast_sip_session *session, pjsip_tx_data *tdata)</div><div class="ttdoc">Send a SIP response. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d92/res__pjsip__session_8c_source.html#l02576">res_pjsip_session.c:2576</a></div></div>
<div class="ttc" id="causes_8h_html_a45c0c189b93333bad969b8f371d8442d"><div class="ttname"><a href="../../d4/da3/causes_8h.html#a45c0c189b93333bad969b8f371d8442d">AST_CAUSE_FAILURE</a></div><div class="ttdeci">#define AST_CAUSE_FAILURE</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/da3/causes_8h_source.html#l00149">causes.h:149</a></div></div>
<div class="ttc" id="bridge_8h_html_ac086b7d74fb40c2ede8514274585b101aecfd8e6279a21b20ee4db0ab69c847e8"><div class="ttname"><a href="../../d4/d56/bridge_8h.html#ac086b7d74fb40c2ede8514274585b101aecfd8e6279a21b20ee4db0ab69c847e8">AST_BRIDGE_IMPART_CHAN_INDEPENDENT</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d56/bridge_8h_source.html#l00604">bridge.h:604</a></div></div>
<div class="ttc" id="channel_8h_html_af476c537b29be3f29240489032f9db39"><div class="ttname"><a href="../../d5/d7b/channel_8h.html#af476c537b29be3f29240489032f9db39">ast_channel_unlock</a></div><div class="ttdeci">#define ast_channel_unlock(chan)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d7b/channel_8h_source.html#l02946">channel.h:2946</a></div></div>
<div class="ttc" id="channel_8h_html_a29557c4823f5e9c02519a01daf6a289c"><div class="ttname"><a href="../../d5/d7b/channel_8h.html#a29557c4823f5e9c02519a01daf6a289c">ast_hangup</a></div><div class="ttdeci">void ast_hangup(struct ast_channel *chan)</div><div class="ttdoc">Hang up a channel. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d28/channel_8c_source.html#l02548">channel.c:2548</a></div></div>
<div class="ttc" id="astobj2_8h_html_a6321ee982370c55ab3c24c72c562cbdd"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#a6321ee982370c55ab3c24c72c562cbdd">ao2_cleanup</a></div><div class="ttdeci">#define ao2_cleanup(obj)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l01958">astobj2.h:1958</a></div></div>
<div class="ttc" id="channel_8h_html_a7ca2fda13b129a55c251b56729de285b"><div class="ttname"><a href="../../d5/d7b/channel_8h.html#a7ca2fda13b129a55c251b56729de285b">ast_channel_name</a></div><div class="ttdeci">const char * ast_channel_name(const struct ast_channel *chan)</div></div>
<div class="ttc" id="channelstate_8h_html_ad9d8f7d9e228b5af98a7b40db9f06448"><div class="ttname"><a href="../../d9/d95/channelstate_8h.html#ad9d8f7d9e228b5af98a7b40db9f06448">ast_setstate</a></div><div class="ttdeci">int ast_setstate(struct ast_channel *chan, enum ast_channel_state)</div><div class="ttdoc">Change the state of a channel. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d28/channel_8c_source.html#l07486">channel.c:7486</a></div></div>
<div class="ttc" id="res__pjsip__session_8h_html_a908cdf7ba25c4d6f3d2efdf01f0125ca"><div class="ttname"><a href="../../d9/de7/res__pjsip__session_8h.html#a908cdf7ba25c4d6f3d2efdf01f0125ca">ast_sip_dialog_get_session</a></div><div class="ttdeci">struct ast_sip_session * ast_sip_dialog_get_session(pjsip_dialog *dlg)</div><div class="ttdoc">Retrieves a session from a dialog. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d92/res__pjsip__session_8c_source.html#l03630">res_pjsip_session.c:3630</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a6a2741fe46b1034fe54e11e1d90f853a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6a2741fe46b1034fe54e11e1d90f853a">&#9670;&nbsp;</a></span>refer_incoming_refer_request()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int refer_incoming_refer_request </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="../../d2/dec/structast__sip__session.html">ast_sip_session</a> *&#160;</td>
          <td class="paramname"><em>session</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct pjsip_rx_data *&#160;</td>
          <td class="paramname"><em>rdata</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="../../d1/d75/res__pjsip__refer_8c_source.html#l01088">1088</a> of file <a class="el" href="../../d1/d75/res__pjsip__refer_8c_source.html">res_pjsip_refer.c</a>.</p>

<p class="reference">References <a class="el" href="../../d8/d8c/res__pjsip_8h_source.html#l00871">ast_sip_endpoint::allowtransfer</a>, <a class="el" href="../../d5/da5/astobj2_8h_source.html#l01958">ao2_cleanup</a>, <a class="el" href="../../d8/d8a/astmm_8h_source.html#l00290">ast_alloca</a>, <a class="el" href="../../d5/d7b/channel_8h.html#a7ca2fda13b129a55c251b56729de285b">ast_channel_name()</a>, <a class="el" href="../../de/d96/res__pjsip_8c_source.html#l05240">ast_copy_pj_str()</a>, <a class="el" href="../../d1/d8c/logger_8h_source.html#l00452">ast_debug</a>, <a class="el" href="../../da/df7/astobj2_8c_source.html#l00042">ast_log</a>, <a class="el" href="../../de/d96/res__pjsip_8c_source.html#l05138">ast_sip_push_task()</a>, <a class="el" href="../../d7/d69/sorcery_8c_source.html#l02312">ast_sorcery_object_get_id()</a>, <a class="el" href="../../d9/de7/res__pjsip__session_8h_source.html#l00189">ast_sip_session::channel</a>, <a class="el" href="../../d9/de7/res__pjsip__session_8h_source.html#l00183">ast_sip_session::endpoint</a>, <a class="el" href="../../d9/de7/res__pjsip__session_8h_source.html#l00187">ast_sip_session::inv_session</a>, <a class="el" href="../../d1/d8c/logger_8h_source.html#l00274">LOG_WARNING</a>, <a class="el" href="../../dc/d7f/resample_8c_source.html#l00096">NULL</a>, <a class="el" href="../../d5/d60/utils_8h_source.html#l00911">RAII_VAR</a>, <a class="el" href="../../d1/d75/res__pjsip__refer_8c_source.html#l00789">refer_incoming_attended_request()</a>, <a class="el" href="../../d1/d75/res__pjsip__refer_8c_source.html#l00886">refer_incoming_blind_request()</a>, <a class="el" href="../../d1/d75/res__pjsip__refer_8c_source.html#l00382">refer_progress_alloc()</a>, <a class="el" href="../../d1/d75/res__pjsip__refer_8c_source.html#l00094">refer_progress_notification_alloc()</a>, and <a class="el" href="../../d1/d75/res__pjsip__refer_8c_source.html#l00140">refer_progress_notify()</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../d1/d75/res__pjsip__refer_8c_source.html#l01198">refer_incoming_request()</a>.</p>
<div class="fragment"><div class="line"><a name="l01089"></a><span class="lineno"> 1089</span>&#160;{</div><div class="line"><a name="l01090"></a><span class="lineno"> 1090</span>&#160;   pjsip_generic_string_hdr *refer_to;</div><div class="line"><a name="l01091"></a><span class="lineno"> 1091</span>&#160;   <span class="keywordtype">char</span> *uri;</div><div class="line"><a name="l01092"></a><span class="lineno"> 1092</span>&#160;   <span class="keywordtype">size_t</span> uri_size;</div><div class="line"><a name="l01093"></a><span class="lineno"> 1093</span>&#160;   pjsip_uri *target;</div><div class="line"><a name="l01094"></a><span class="lineno"> 1094</span>&#160;   pjsip_sip_uri *target_uri;</div><div class="line"><a name="l01095"></a><span class="lineno"> 1095</span>&#160;   <a class="code" href="../../d5/d60/utils_8h.html#a1604b4d72144dd3d9f7da668e90337e9">RAII_VAR</a>(<span class="keyword">struct</span> <a class="code" href="../../d0/d4b/structrefer__progress.html">refer_progress</a> *, <a class="code" href="../../d1/df7/structprogress.html">progress</a>, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../d5/da5/astobj2_8h.html#a6321ee982370c55ab3c24c72c562cbdd">ao2_cleanup</a>);</div><div class="line"><a name="l01096"></a><span class="lineno"> 1096</span>&#160;   pjsip_param *replaces;</div><div class="line"><a name="l01097"></a><span class="lineno"> 1097</span>&#160;   <span class="keywordtype">int</span> response;</div><div class="line"><a name="l01098"></a><span class="lineno"> 1098</span>&#160;</div><div class="line"><a name="l01099"></a><span class="lineno"> 1099</span>&#160;   <span class="keyword">static</span> <span class="keyword">const</span> pj_str_t str_refer_to = { <span class="stringliteral">&quot;Refer-To&quot;</span>, 8 };</div><div class="line"><a name="l01100"></a><span class="lineno"> 1100</span>&#160;   <span class="keyword">static</span> <span class="keyword">const</span> pj_str_t str_refer_to_s = { <span class="stringliteral">&quot;r&quot;</span>, 1 };</div><div class="line"><a name="l01101"></a><span class="lineno"> 1101</span>&#160;   <span class="keyword">static</span> <span class="keyword">const</span> pj_str_t str_replaces = { <span class="stringliteral">&quot;Replaces&quot;</span>, 8 };</div><div class="line"><a name="l01102"></a><span class="lineno"> 1102</span>&#160;</div><div class="line"><a name="l01103"></a><span class="lineno"> 1103</span>&#160;   <span class="keywordflow">if</span> (!session-&gt;<a class="code" href="../../d2/dec/structast__sip__session.html#a48371aaa1ad1144e564ebcd179a2db2e">channel</a>) {</div><div class="line"><a name="l01104"></a><span class="lineno"> 1104</span>&#160;      <span class="comment">/* No channel to refer.  Likely because the call was just hung up. */</span></div><div class="line"><a name="l01105"></a><span class="lineno"> 1105</span>&#160;      pjsip_dlg_respond(session-&gt;<a class="code" href="../../d2/dec/structast__sip__session.html#ab9fd713b198a122cb52c7f10bd66d1c6">inv_session</a>-&gt;dlg, rdata, 404, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div><div class="line"><a name="l01106"></a><span class="lineno"> 1106</span>&#160;      <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(3, <span class="stringliteral">&quot;Received a REFER on a session with no channel from endpoint &#39;%s&#39;.\n&quot;</span>,</div><div class="line"><a name="l01107"></a><span class="lineno"> 1107</span>&#160;         <a class="code" href="../../d8/d25/sorcery_8h.html#a97706283a06cbb44e4f0f9620dd5cf07">ast_sorcery_object_get_id</a>(session-&gt;<a class="code" href="../../d2/dec/structast__sip__session.html#a3960205b2a4e7e012dc9f0eae1855f01">endpoint</a>));</div><div class="line"><a name="l01108"></a><span class="lineno"> 1108</span>&#160;      <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l01109"></a><span class="lineno"> 1109</span>&#160;   }</div><div class="line"><a name="l01110"></a><span class="lineno"> 1110</span>&#160;</div><div class="line"><a name="l01111"></a><span class="lineno"> 1111</span>&#160;   <span class="keywordflow">if</span> (!session-&gt;<a class="code" href="../../d2/dec/structast__sip__session.html#a3960205b2a4e7e012dc9f0eae1855f01">endpoint</a>-&gt;<a class="code" href="../../d3/d46/structast__sip__endpoint.html#aea775f08306dc623d9d1381d2d5890df">allowtransfer</a>) {</div><div class="line"><a name="l01112"></a><span class="lineno"> 1112</span>&#160;      pjsip_dlg_respond(session-&gt;<a class="code" href="../../d2/dec/structast__sip__session.html#ab9fd713b198a122cb52c7f10bd66d1c6">inv_session</a>-&gt;dlg, rdata, 603, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div><div class="line"><a name="l01113"></a><span class="lineno"> 1113</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Endpoint %s transfer attempt blocked due to configuration\n&quot;</span>,</div><div class="line"><a name="l01114"></a><span class="lineno"> 1114</span>&#160;            <a class="code" href="../../d8/d25/sorcery_8h.html#a97706283a06cbb44e4f0f9620dd5cf07">ast_sorcery_object_get_id</a>(session-&gt;<a class="code" href="../../d2/dec/structast__sip__session.html#a3960205b2a4e7e012dc9f0eae1855f01">endpoint</a>));</div><div class="line"><a name="l01115"></a><span class="lineno"> 1115</span>&#160;      <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l01116"></a><span class="lineno"> 1116</span>&#160;   }</div><div class="line"><a name="l01117"></a><span class="lineno"> 1117</span>&#160;</div><div class="line"><a name="l01118"></a><span class="lineno"> 1118</span>&#160;   <span class="comment">/* A Refer-To header is required */</span></div><div class="line"><a name="l01119"></a><span class="lineno"> 1119</span>&#160;   refer_to = pjsip_msg_find_hdr_by_names(rdata-&gt;msg_info.msg, &amp;str_refer_to, &amp;str_refer_to_s, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div><div class="line"><a name="l01120"></a><span class="lineno"> 1120</span>&#160;   <span class="keywordflow">if</span> (!refer_to) {</div><div class="line"><a name="l01121"></a><span class="lineno"> 1121</span>&#160;      pjsip_dlg_respond(session-&gt;<a class="code" href="../../d2/dec/structast__sip__session.html#ab9fd713b198a122cb52c7f10bd66d1c6">inv_session</a>-&gt;dlg, rdata, 400, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div><div class="line"><a name="l01122"></a><span class="lineno"> 1122</span>&#160;      <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(3, <span class="stringliteral">&quot;Received a REFER without Refer-To on channel &#39;%s&#39; from endpoint &#39;%s&#39;\n&quot;</span>,</div><div class="line"><a name="l01123"></a><span class="lineno"> 1123</span>&#160;         <a class="code" href="../../d5/d7b/channel_8h.html#a7ca2fda13b129a55c251b56729de285b">ast_channel_name</a>(session-&gt;<a class="code" href="../../d2/dec/structast__sip__session.html#a48371aaa1ad1144e564ebcd179a2db2e">channel</a>), <a class="code" href="../../d8/d25/sorcery_8h.html#a97706283a06cbb44e4f0f9620dd5cf07">ast_sorcery_object_get_id</a>(session-&gt;<a class="code" href="../../d2/dec/structast__sip__session.html#a3960205b2a4e7e012dc9f0eae1855f01">endpoint</a>));</div><div class="line"><a name="l01124"></a><span class="lineno"> 1124</span>&#160;      <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l01125"></a><span class="lineno"> 1125</span>&#160;   }</div><div class="line"><a name="l01126"></a><span class="lineno"> 1126</span>&#160;</div><div class="line"><a name="l01127"></a><span class="lineno"> 1127</span>&#160;   <span class="comment">/* The ast_copy_pj_str to uri is needed because it puts the NULL terminator to the uri</span></div><div class="line"><a name="l01128"></a><span class="lineno"> 1128</span>&#160;<span class="comment">    * as pjsip_parse_uri require a NULL terminated uri</span></div><div class="line"><a name="l01129"></a><span class="lineno"> 1129</span>&#160;<span class="comment">    */</span></div><div class="line"><a name="l01130"></a><span class="lineno"> 1130</span>&#160;</div><div class="line"><a name="l01131"></a><span class="lineno"> 1131</span>&#160;   uri_size = pj_strlen(&amp;refer_to-&gt;hvalue) + 1;</div><div class="line"><a name="l01132"></a><span class="lineno"> 1132</span>&#160;   uri = <a class="code" href="../../d8/d8a/astmm_8h.html#a249282ecc7ba5a1a49fa75e9a33d1717">ast_alloca</a>(uri_size);</div><div class="line"><a name="l01133"></a><span class="lineno"> 1133</span>&#160;   <a class="code" href="../../d8/d8c/res__pjsip_8h.html#a7da3e1f7ee3fcb77f29d41a76a7528fe">ast_copy_pj_str</a>(uri, &amp;refer_to-&gt;hvalue, uri_size);</div><div class="line"><a name="l01134"></a><span class="lineno"> 1134</span>&#160;</div><div class="line"><a name="l01135"></a><span class="lineno"> 1135</span>&#160;   target = pjsip_parse_uri(rdata-&gt;tp_info.pool, uri, uri_size - 1, 0);</div><div class="line"><a name="l01136"></a><span class="lineno"> 1136</span>&#160;</div><div class="line"><a name="l01137"></a><span class="lineno"> 1137</span>&#160;   <span class="keywordflow">if</span> (!target</div><div class="line"><a name="l01138"></a><span class="lineno"> 1138</span>&#160;      || (!PJSIP_URI_SCHEME_IS_SIP(target)</div><div class="line"><a name="l01139"></a><span class="lineno"> 1139</span>&#160;         &amp;&amp; !PJSIP_URI_SCHEME_IS_SIPS(target))) {</div><div class="line"><a name="l01140"></a><span class="lineno"> 1140</span>&#160;</div><div class="line"><a name="l01141"></a><span class="lineno"> 1141</span>&#160;      pjsip_dlg_respond(session-&gt;<a class="code" href="../../d2/dec/structast__sip__session.html#ab9fd713b198a122cb52c7f10bd66d1c6">inv_session</a>-&gt;dlg, rdata, 400, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div><div class="line"><a name="l01142"></a><span class="lineno"> 1142</span>&#160;      <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(3, <span class="stringliteral">&quot;Received a REFER without a parseable Refer-To (&#39;%s&#39;) on channel &#39;%s&#39; from endpoint &#39;%s&#39;\n&quot;</span>,</div><div class="line"><a name="l01143"></a><span class="lineno"> 1143</span>&#160;         uri, <a class="code" href="../../d5/d7b/channel_8h.html#a7ca2fda13b129a55c251b56729de285b">ast_channel_name</a>(session-&gt;<a class="code" href="../../d2/dec/structast__sip__session.html#a48371aaa1ad1144e564ebcd179a2db2e">channel</a>), <a class="code" href="../../d8/d25/sorcery_8h.html#a97706283a06cbb44e4f0f9620dd5cf07">ast_sorcery_object_get_id</a>(session-&gt;<a class="code" href="../../d2/dec/structast__sip__session.html#a3960205b2a4e7e012dc9f0eae1855f01">endpoint</a>));</div><div class="line"><a name="l01144"></a><span class="lineno"> 1144</span>&#160;      <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l01145"></a><span class="lineno"> 1145</span>&#160;   }</div><div class="line"><a name="l01146"></a><span class="lineno"> 1146</span>&#160;   target_uri = pjsip_uri_get_uri(target);</div><div class="line"><a name="l01147"></a><span class="lineno"> 1147</span>&#160;</div><div class="line"><a name="l01148"></a><span class="lineno"> 1148</span>&#160;   <span class="comment">/* Set up REFER progress subscription if requested/possible */</span></div><div class="line"><a name="l01149"></a><span class="lineno"> 1149</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d1/d75/res__pjsip__refer_8c.html#ae1ecfce9061d388895519ded34e31a36">refer_progress_alloc</a>(session, rdata, &amp;<a class="code" href="../../d1/df7/structprogress.html">progress</a>)) {</div><div class="line"><a name="l01150"></a><span class="lineno"> 1150</span>&#160;      pjsip_dlg_respond(session-&gt;<a class="code" href="../../d2/dec/structast__sip__session.html#ab9fd713b198a122cb52c7f10bd66d1c6">inv_session</a>-&gt;dlg, rdata, 500, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div><div class="line"><a name="l01151"></a><span class="lineno"> 1151</span>&#160;      <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(3, <span class="stringliteral">&quot;Could not set up subscription for REFER on channel &#39;%s&#39; from endpoint &#39;%s&#39;\n&quot;</span>,</div><div class="line"><a name="l01152"></a><span class="lineno"> 1152</span>&#160;         <a class="code" href="../../d5/d7b/channel_8h.html#a7ca2fda13b129a55c251b56729de285b">ast_channel_name</a>(session-&gt;<a class="code" href="../../d2/dec/structast__sip__session.html#a48371aaa1ad1144e564ebcd179a2db2e">channel</a>), <a class="code" href="../../d8/d25/sorcery_8h.html#a97706283a06cbb44e4f0f9620dd5cf07">ast_sorcery_object_get_id</a>(session-&gt;<a class="code" href="../../d2/dec/structast__sip__session.html#a3960205b2a4e7e012dc9f0eae1855f01">endpoint</a>));</div><div class="line"><a name="l01153"></a><span class="lineno"> 1153</span>&#160;      <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l01154"></a><span class="lineno"> 1154</span>&#160;   }</div><div class="line"><a name="l01155"></a><span class="lineno"> 1155</span>&#160;</div><div class="line"><a name="l01156"></a><span class="lineno"> 1156</span>&#160;   <span class="comment">/* Determine if this is an attended or blind transfer */</span></div><div class="line"><a name="l01157"></a><span class="lineno"> 1157</span>&#160;   <span class="keywordflow">if</span> ((replaces = pjsip_param_find(&amp;target_uri-&gt;header_param, &amp;str_replaces)) ||</div><div class="line"><a name="l01158"></a><span class="lineno"> 1158</span>&#160;      (replaces = pjsip_param_find(&amp;target_uri-&gt;other_param, &amp;str_replaces))) {</div><div class="line"><a name="l01159"></a><span class="lineno"> 1159</span>&#160;      response = <a class="code" href="../../d1/d75/res__pjsip__refer_8c.html#a4c8c85f5bb081806be83bc5da897b019">refer_incoming_attended_request</a>(session, rdata, target_uri, replaces, <a class="code" href="../../d1/df7/structprogress.html">progress</a>);</div><div class="line"><a name="l01160"></a><span class="lineno"> 1160</span>&#160;   } <span class="keywordflow">else</span> {</div><div class="line"><a name="l01161"></a><span class="lineno"> 1161</span>&#160;      response = <a class="code" href="../../d1/d75/res__pjsip__refer_8c.html#a528166ff65a4e80a894beb5aed0c2d33">refer_incoming_blind_request</a>(session, rdata, target_uri, <a class="code" href="../../d1/df7/structprogress.html">progress</a>);</div><div class="line"><a name="l01162"></a><span class="lineno"> 1162</span>&#160;   }</div><div class="line"><a name="l01163"></a><span class="lineno"> 1163</span>&#160;</div><div class="line"><a name="l01164"></a><span class="lineno"> 1164</span>&#160;   <span class="keywordflow">if</span> (!<a class="code" href="../../d1/df7/structprogress.html">progress</a>) {</div><div class="line"><a name="l01165"></a><span class="lineno"> 1165</span>&#160;      <span class="comment">/* The transferer has requested no subscription, so send a final response immediately */</span></div><div class="line"><a name="l01166"></a><span class="lineno"> 1166</span>&#160;      pjsip_tx_data *tdata;</div><div class="line"><a name="l01167"></a><span class="lineno"> 1167</span>&#160;      <span class="keyword">const</span> pj_str_t str_refer_sub = { <span class="stringliteral">&quot;Refer-Sub&quot;</span>, 9 };</div><div class="line"><a name="l01168"></a><span class="lineno"> 1168</span>&#160;      <span class="keyword">const</span> pj_str_t str_false = { <span class="stringliteral">&quot;false&quot;</span>, 5 };</div><div class="line"><a name="l01169"></a><span class="lineno"> 1169</span>&#160;      pjsip_hdr *hdr;</div><div class="line"><a name="l01170"></a><span class="lineno"> 1170</span>&#160;</div><div class="line"><a name="l01171"></a><span class="lineno"> 1171</span>&#160;      <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(3, <span class="stringliteral">&quot;Progress monitoring not requested for REFER on channel &#39;%s&#39; from endpoint &#39;%s&#39;, sending immediate response of &#39;%d&#39;\n&quot;</span>,</div><div class="line"><a name="l01172"></a><span class="lineno"> 1172</span>&#160;         <a class="code" href="../../d5/d7b/channel_8h.html#a7ca2fda13b129a55c251b56729de285b">ast_channel_name</a>(session-&gt;<a class="code" href="../../d2/dec/structast__sip__session.html#a48371aaa1ad1144e564ebcd179a2db2e">channel</a>), <a class="code" href="../../d8/d25/sorcery_8h.html#a97706283a06cbb44e4f0f9620dd5cf07">ast_sorcery_object_get_id</a>(session-&gt;<a class="code" href="../../d2/dec/structast__sip__session.html#a3960205b2a4e7e012dc9f0eae1855f01">endpoint</a>), response);</div><div class="line"><a name="l01173"></a><span class="lineno"> 1173</span>&#160;</div><div class="line"><a name="l01174"></a><span class="lineno"> 1174</span>&#160;      <span class="keywordflow">if</span> (pjsip_dlg_create_response(session-&gt;<a class="code" href="../../d2/dec/structast__sip__session.html#ab9fd713b198a122cb52c7f10bd66d1c6">inv_session</a>-&gt;dlg, rdata, response, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, &amp;tdata) != PJ_SUCCESS) {</div><div class="line"><a name="l01175"></a><span class="lineno"> 1175</span>&#160;         pjsip_dlg_respond(session-&gt;<a class="code" href="../../d2/dec/structast__sip__session.html#ab9fd713b198a122cb52c7f10bd66d1c6">inv_session</a>-&gt;dlg, rdata, response, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div><div class="line"><a name="l01176"></a><span class="lineno"> 1176</span>&#160;         <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l01177"></a><span class="lineno"> 1177</span>&#160;      }</div><div class="line"><a name="l01178"></a><span class="lineno"> 1178</span>&#160;</div><div class="line"><a name="l01179"></a><span class="lineno"> 1179</span>&#160;      hdr = (pjsip_hdr*)pjsip_generic_string_hdr_create(tdata-&gt;pool, &amp;str_refer_sub, &amp;str_false);</div><div class="line"><a name="l01180"></a><span class="lineno"> 1180</span>&#160;      pjsip_msg_add_hdr(tdata-&gt;msg, hdr);</div><div class="line"><a name="l01181"></a><span class="lineno"> 1181</span>&#160;</div><div class="line"><a name="l01182"></a><span class="lineno"> 1182</span>&#160;      pjsip_dlg_send_response(session-&gt;<a class="code" href="../../d2/dec/structast__sip__session.html#ab9fd713b198a122cb52c7f10bd66d1c6">inv_session</a>-&gt;dlg, pjsip_rdata_get_tsx(rdata), tdata);</div><div class="line"><a name="l01183"></a><span class="lineno"> 1183</span>&#160;   } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (response != 200) {</div><div class="line"><a name="l01184"></a><span class="lineno"> 1184</span>&#160;      <span class="comment">/* Since this failed we can send a final NOTIFY now and terminate the subscription */</span></div><div class="line"><a name="l01185"></a><span class="lineno"> 1185</span>&#160;      <span class="keyword">struct </span><a class="code" href="../../d3/dff/structrefer__progress__notification.html">refer_progress_notification</a> *notification = <a class="code" href="../../d1/d75/res__pjsip__refer_8c.html#a89f2c1d96492b68d1399f20fc6eeb833">refer_progress_notification_alloc</a>(<a class="code" href="../../d1/df7/structprogress.html">progress</a>, response, PJSIP_EVSUB_STATE_TERMINATED);</div><div class="line"><a name="l01186"></a><span class="lineno"> 1186</span>&#160;</div><div class="line"><a name="l01187"></a><span class="lineno"> 1187</span>&#160;      <span class="keywordflow">if</span> (notification) {</div><div class="line"><a name="l01188"></a><span class="lineno"> 1188</span>&#160;         <span class="comment">/* The refer_progress_notify function will call ao2_cleanup on this for us */</span></div><div class="line"><a name="l01189"></a><span class="lineno"> 1189</span>&#160;         <span class="keywordflow">if</span> (<a class="code" href="../../d7/dfa/group__pjsip__threading.html#ga4f0a0629fa2ca084812772356d8e3565">ast_sip_push_task</a>(<a class="code" href="../../d1/df7/structprogress.html">progress</a>-&gt;serializer, <a class="code" href="../../d1/d75/res__pjsip__refer_8c.html#a5d2be3003a3c77234b90343bc0a43935">refer_progress_notify</a>, notification)) {</div><div class="line"><a name="l01190"></a><span class="lineno"> 1190</span>&#160;            <a class="code" href="../../d5/da5/astobj2_8h.html#a6321ee982370c55ab3c24c72c562cbdd">ao2_cleanup</a>(notification);</div><div class="line"><a name="l01191"></a><span class="lineno"> 1191</span>&#160;         }</div><div class="line"><a name="l01192"></a><span class="lineno"> 1192</span>&#160;      }</div><div class="line"><a name="l01193"></a><span class="lineno"> 1193</span>&#160;   }</div><div class="line"><a name="l01194"></a><span class="lineno"> 1194</span>&#160;</div><div class="line"><a name="l01195"></a><span class="lineno"> 1195</span>&#160;   <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l01196"></a><span class="lineno"> 1196</span>&#160;}</div><div class="ttc" id="structast__sip__session_html_a3960205b2a4e7e012dc9f0eae1855f01"><div class="ttname"><a href="../../d2/dec/structast__sip__session.html#a3960205b2a4e7e012dc9f0eae1855f01">ast_sip_session::endpoint</a></div><div class="ttdeci">struct ast_sip_endpoint * endpoint</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/de7/res__pjsip__session_8h_source.html#l00183">res_pjsip_session.h:183</a></div></div>
<div class="ttc" id="logger_8h_html_adf4476a6a4ea6c74231c826e899d7189"><div class="ttname"><a href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a></div><div class="ttdeci">#define LOG_WARNING</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d8c/logger_8h_source.html#l00274">logger.h:274</a></div></div>
<div class="ttc" id="res__pjsip__refer_8c_html_a4c8c85f5bb081806be83bc5da897b019"><div class="ttname"><a href="../../d1/d75/res__pjsip__refer_8c.html#a4c8c85f5bb081806be83bc5da897b019">refer_incoming_attended_request</a></div><div class="ttdeci">static int refer_incoming_attended_request(struct ast_sip_session *session, pjsip_rx_data *rdata, pjsip_sip_uri *target_uri, pjsip_param *replaces_param, struct refer_progress *progress)</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d75/res__pjsip__refer_8c_source.html#l00789">res_pjsip_refer.c:789</a></div></div>
<div class="ttc" id="structrefer__progress__notification_html"><div class="ttname"><a href="../../d3/dff/structrefer__progress__notification.html">refer_progress_notification</a></div><div class="ttdoc">REFER Progress notification structure. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d75/res__pjsip__refer_8c_source.html#l00070">res_pjsip_refer.c:70</a></div></div>
<div class="ttc" id="res__pjsip_8h_html_a7da3e1f7ee3fcb77f29d41a76a7528fe"><div class="ttname"><a href="../../d8/d8c/res__pjsip_8h.html#a7da3e1f7ee3fcb77f29d41a76a7528fe">ast_copy_pj_str</a></div><div class="ttdeci">void ast_copy_pj_str(char *dest, const pj_str_t *src, size_t size)</div><div class="ttdoc">Copy a pj_str_t into a standard character buffer. </div><div class="ttdef"><b>Definition:</b> <a href="../../de/d96/res__pjsip_8c_source.html#l05240">res_pjsip.c:5240</a></div></div>
<div class="ttc" id="resample_8c_html_a070d2ce7b6bb7e5c05602aa8c308d0c4"><div class="ttname"><a href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a></div><div class="ttdeci">#define NULL</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d7f/resample_8c_source.html#l00096">resample.c:96</a></div></div>
<div class="ttc" id="structprogress_html"><div class="ttname"><a href="../../d1/df7/structprogress.html">progress</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d3b/dsp_8c_source.html#l00117">dsp.c:117</a></div></div>
<div class="ttc" id="structast__sip__session_html_ab9fd713b198a122cb52c7f10bd66d1c6"><div class="ttname"><a href="../../d2/dec/structast__sip__session.html#ab9fd713b198a122cb52c7f10bd66d1c6">ast_sip_session::inv_session</a></div><div class="ttdeci">struct pjsip_inv_session * inv_session</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/de7/res__pjsip__session_8h_source.html#l00187">res_pjsip_session.h:187</a></div></div>
<div class="ttc" id="logger_8h_html_a3f248112c8d6ce7e3959aa723dade648"><div class="ttname"><a href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a></div><div class="ttdeci">#define ast_debug(level,...)</div><div class="ttdoc">Log a DEBUG message. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d8c/logger_8h_source.html#l00452">logger.h:452</a></div></div>
<div class="ttc" id="astobj2_8c_html_a96a00b3a518d7f32b6d51dc28f09bf9b"><div class="ttname"><a href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a></div><div class="ttdeci">#define ast_log</div><div class="ttdef"><b>Definition:</b> <a href="../../da/df7/astobj2_8c_source.html#l00042">astobj2.c:42</a></div></div>
<div class="ttc" id="utils_8h_html_a1604b4d72144dd3d9f7da668e90337e9"><div class="ttname"><a href="../../d5/d60/utils_8h.html#a1604b4d72144dd3d9f7da668e90337e9">RAII_VAR</a></div><div class="ttdeci">#define RAII_VAR(vartype, varname, initval, dtor)</div><div class="ttdoc">Declare a variable that will call a destructor function when it goes out of scope. </div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d60/utils_8h_source.html#l00911">utils.h:911</a></div></div>
<div class="ttc" id="sorcery_8h_html_a97706283a06cbb44e4f0f9620dd5cf07"><div class="ttname"><a href="../../d8/d25/sorcery_8h.html#a97706283a06cbb44e4f0f9620dd5cf07">ast_sorcery_object_get_id</a></div><div class="ttdeci">const char * ast_sorcery_object_get_id(const void *object)</div><div class="ttdoc">Get the unique identifier of a sorcery object. </div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d69/sorcery_8c_source.html#l02312">sorcery.c:2312</a></div></div>
<div class="ttc" id="structast__sip__session_html_a48371aaa1ad1144e564ebcd179a2db2e"><div class="ttname"><a href="../../d2/dec/structast__sip__session.html#a48371aaa1ad1144e564ebcd179a2db2e">ast_sip_session::channel</a></div><div class="ttdeci">struct ast_channel * channel</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/de7/res__pjsip__session_8h_source.html#l00189">res_pjsip_session.h:189</a></div></div>
<div class="ttc" id="astmm_8h_html_a249282ecc7ba5a1a49fa75e9a33d1717"><div class="ttname"><a href="../../d8/d8a/astmm_8h.html#a249282ecc7ba5a1a49fa75e9a33d1717">ast_alloca</a></div><div class="ttdeci">#define ast_alloca(size)</div><div class="ttdoc">call __builtin_alloca to ensure we get gcc builtin semantics </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d8a/astmm_8h_source.html#l00290">astmm.h:290</a></div></div>
<div class="ttc" id="group__pjsip__threading_html_ga4f0a0629fa2ca084812772356d8e3565"><div class="ttname"><a href="../../d7/dfa/group__pjsip__threading.html#ga4f0a0629fa2ca084812772356d8e3565">ast_sip_push_task</a></div><div class="ttdeci">int ast_sip_push_task(struct ast_taskprocessor *serializer, int(*sip_task)(void *), void *task_data)</div><div class="ttdoc">Pushes a task to SIP servants. </div><div class="ttdef"><b>Definition:</b> <a href="../../de/d96/res__pjsip_8c_source.html#l05138">res_pjsip.c:5138</a></div></div>
<div class="ttc" id="res__pjsip__refer_8c_html_a89f2c1d96492b68d1399f20fc6eeb833"><div class="ttname"><a href="../../d1/d75/res__pjsip__refer_8c.html#a89f2c1d96492b68d1399f20fc6eeb833">refer_progress_notification_alloc</a></div><div class="ttdeci">static struct refer_progress_notification * refer_progress_notification_alloc(struct refer_progress *progress, int response, pjsip_evsub_state state)</div><div class="ttdoc">Allocator for REFER Progress notification structure. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d75/res__pjsip__refer_8c_source.html#l00094">res_pjsip_refer.c:94</a></div></div>
<div class="ttc" id="structast__sip__endpoint_html_aea775f08306dc623d9d1381d2d5890df"><div class="ttname"><a href="../../d3/d46/structast__sip__endpoint.html#aea775f08306dc623d9d1381d2d5890df">ast_sip_endpoint::allowtransfer</a></div><div class="ttdeci">unsigned int allowtransfer</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d8c/res__pjsip_8h_source.html#l00871">res_pjsip.h:871</a></div></div>
<div class="ttc" id="res__pjsip__refer_8c_html_a5d2be3003a3c77234b90343bc0a43935"><div class="ttname"><a href="../../d1/d75/res__pjsip__refer_8c.html#a5d2be3003a3c77234b90343bc0a43935">refer_progress_notify</a></div><div class="ttdeci">static int refer_progress_notify(void *data)</div><div class="ttdoc">Serialized callback for subscription notification. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d75/res__pjsip__refer_8c_source.html#l00140">res_pjsip_refer.c:140</a></div></div>
<div class="ttc" id="astobj2_8h_html_a6321ee982370c55ab3c24c72c562cbdd"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#a6321ee982370c55ab3c24c72c562cbdd">ao2_cleanup</a></div><div class="ttdeci">#define ao2_cleanup(obj)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l01958">astobj2.h:1958</a></div></div>
<div class="ttc" id="channel_8h_html_a7ca2fda13b129a55c251b56729de285b"><div class="ttname"><a href="../../d5/d7b/channel_8h.html#a7ca2fda13b129a55c251b56729de285b">ast_channel_name</a></div><div class="ttdeci">const char * ast_channel_name(const struct ast_channel *chan)</div></div>
<div class="ttc" id="res__pjsip__refer_8c_html_a528166ff65a4e80a894beb5aed0c2d33"><div class="ttname"><a href="../../d1/d75/res__pjsip__refer_8c.html#a528166ff65a4e80a894beb5aed0c2d33">refer_incoming_blind_request</a></div><div class="ttdeci">static int refer_incoming_blind_request(struct ast_sip_session *session, pjsip_rx_data *rdata, pjsip_sip_uri *target, struct refer_progress *progress)</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d75/res__pjsip__refer_8c_source.html#l00886">res_pjsip_refer.c:886</a></div></div>
<div class="ttc" id="structrefer__progress_html"><div class="ttname"><a href="../../d0/d4b/structrefer__progress.html">refer_progress</a></div><div class="ttdoc">REFER Progress structure. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d75/res__pjsip__refer_8c_source.html#l00044">res_pjsip_refer.c:44</a></div></div>
<div class="ttc" id="res__pjsip__refer_8c_html_ae1ecfce9061d388895519ded34e31a36"><div class="ttname"><a href="../../d1/d75/res__pjsip__refer_8c.html#ae1ecfce9061d388895519ded34e31a36">refer_progress_alloc</a></div><div class="ttdeci">static int refer_progress_alloc(struct ast_sip_session *session, pjsip_rx_data *rdata, struct refer_progress **progress)</div><div class="ttdoc">Internal helper function which sets up a refer progress structure if needed. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d75/res__pjsip__refer_8c_source.html#l00382">res_pjsip_refer.c:382</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a63d31b0d0f4fea629c8fe34b0854eb3c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a63d31b0d0f4fea629c8fe34b0854eb3c">&#9670;&nbsp;</a></span>refer_incoming_request()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int refer_incoming_request </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="../../d2/dec/structast__sip__session.html">ast_sip_session</a> *&#160;</td>
          <td class="paramname"><em>session</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">pjsip_rx_data *&#160;</td>
          <td class="paramname"><em>rdata</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="../../d1/d75/res__pjsip__refer_8c_source.html#l01198">1198</a> of file <a class="el" href="../../d1/d75/res__pjsip__refer_8c_source.html">res_pjsip_refer.c</a>.</p>

<p class="reference">References <a class="el" href="../../d1/d75/res__pjsip__refer_8c_source.html#l00969">refer_incoming_invite_request()</a>, and <a class="el" href="../../d1/d75/res__pjsip__refer_8c_source.html#l01088">refer_incoming_refer_request()</a>.</p>
<div class="fragment"><div class="line"><a name="l01199"></a><span class="lineno"> 1199</span>&#160;{</div><div class="line"><a name="l01200"></a><span class="lineno"> 1200</span>&#160;   <span class="keywordflow">if</span> (!pjsip_method_cmp(&amp;rdata-&gt;msg_info.msg-&gt;line.req.method, pjsip_get_refer_method())) {</div><div class="line"><a name="l01201"></a><span class="lineno"> 1201</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../d1/d75/res__pjsip__refer_8c.html#a6a2741fe46b1034fe54e11e1d90f853a">refer_incoming_refer_request</a>(session, rdata);</div><div class="line"><a name="l01202"></a><span class="lineno"> 1202</span>&#160;   } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!pjsip_method_cmp(&amp;rdata-&gt;msg_info.msg-&gt;line.req.method, &amp;pjsip_invite_method)) {</div><div class="line"><a name="l01203"></a><span class="lineno"> 1203</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../d1/d75/res__pjsip__refer_8c.html#a5e57806e0d60b29bf6adbd28b97de46c">refer_incoming_invite_request</a>(session, rdata);</div><div class="line"><a name="l01204"></a><span class="lineno"> 1204</span>&#160;   } <span class="keywordflow">else</span> {</div><div class="line"><a name="l01205"></a><span class="lineno"> 1205</span>&#160;      <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l01206"></a><span class="lineno"> 1206</span>&#160;   }</div><div class="line"><a name="l01207"></a><span class="lineno"> 1207</span>&#160;}</div><div class="ttc" id="res__pjsip__refer_8c_html_a6a2741fe46b1034fe54e11e1d90f853a"><div class="ttname"><a href="../../d1/d75/res__pjsip__refer_8c.html#a6a2741fe46b1034fe54e11e1d90f853a">refer_incoming_refer_request</a></div><div class="ttdeci">static int refer_incoming_refer_request(struct ast_sip_session *session, struct pjsip_rx_data *rdata)</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d75/res__pjsip__refer_8c_source.html#l01088">res_pjsip_refer.c:1088</a></div></div>
<div class="ttc" id="res__pjsip__refer_8c_html_a5e57806e0d60b29bf6adbd28b97de46c"><div class="ttname"><a href="../../d1/d75/res__pjsip__refer_8c.html#a5e57806e0d60b29bf6adbd28b97de46c">refer_incoming_invite_request</a></div><div class="ttdeci">static int refer_incoming_invite_request(struct ast_sip_session *session, struct pjsip_rx_data *rdata)</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d75/res__pjsip__refer_8c_source.html#l00969">res_pjsip_refer.c:969</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a2147bff39e836eadcc58c4ad6531f39f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2147bff39e836eadcc58c4ad6531f39f">&#9670;&nbsp;</a></span>refer_outgoing_request()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void refer_outgoing_request </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="../../d2/dec/structast__sip__session.html">ast_sip_session</a> *&#160;</td>
          <td class="paramname"><em>session</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct pjsip_tx_data *&#160;</td>
          <td class="paramname"><em>tdata</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="../../d1/d75/res__pjsip__refer_8c_source.html#l01242">1242</a> of file <a class="el" href="../../d1/d75/res__pjsip__refer_8c_source.html">res_pjsip_refer.c</a>.</p>

<p class="reference">References <a class="el" href="../../d1/d75/res__pjsip__refer_8c_source.html#l01223">add_header_from_channel_var()</a>, <a class="el" href="../../d5/d7b/channel_8h_source.html#l02945">ast_channel_lock</a>, <a class="el" href="../../d5/d7b/channel_8h_source.html#l02946">ast_channel_unlock</a>, <a class="el" href="../../d9/de7/res__pjsip__session_8h_source.html#l00189">ast_sip_session::channel</a>, and <a class="el" href="../../d9/de7/res__pjsip__session_8h_source.html#l00187">ast_sip_session::inv_session</a>.</p>
<div class="fragment"><div class="line"><a name="l01243"></a><span class="lineno"> 1243</span>&#160;{</div><div class="line"><a name="l01244"></a><span class="lineno"> 1244</span>&#160;   <span class="keywordflow">if</span> (pjsip_method_cmp(&amp;tdata-&gt;msg-&gt;line.req.method, &amp;pjsip_invite_method)</div><div class="line"><a name="l01245"></a><span class="lineno"> 1245</span>&#160;      || !session-&gt;<a class="code" href="../../d2/dec/structast__sip__session.html#a48371aaa1ad1144e564ebcd179a2db2e">channel</a></div><div class="line"><a name="l01246"></a><span class="lineno"> 1246</span>&#160;      || session-&gt;<a class="code" href="../../d2/dec/structast__sip__session.html#ab9fd713b198a122cb52c7f10bd66d1c6">inv_session</a>-&gt;state != PJSIP_INV_STATE_NULL) {</div><div class="line"><a name="l01247"></a><span class="lineno"> 1247</span>&#160;      <span class="keywordflow">return</span>;</div><div class="line"><a name="l01248"></a><span class="lineno"> 1248</span>&#160;   }</div><div class="line"><a name="l01249"></a><span class="lineno"> 1249</span>&#160;</div><div class="line"><a name="l01250"></a><span class="lineno"> 1250</span>&#160;   <a class="code" href="../../d5/d7b/channel_8h.html#a493bdebe876caafb8ee535853310364a">ast_channel_lock</a>(session-&gt;<a class="code" href="../../d2/dec/structast__sip__session.html#a48371aaa1ad1144e564ebcd179a2db2e">channel</a>);</div><div class="line"><a name="l01251"></a><span class="lineno"> 1251</span>&#160;   <a class="code" href="../../d1/d75/res__pjsip__refer_8c.html#a09a39bfa4ee64baa72466c1ab2cd9de0">add_header_from_channel_var</a>(session-&gt;<a class="code" href="../../d2/dec/structast__sip__session.html#a48371aaa1ad1144e564ebcd179a2db2e">channel</a>, <span class="stringliteral">&quot;SIPREPLACESHDR&quot;</span>, <span class="stringliteral">&quot;Replaces&quot;</span>, tdata);</div><div class="line"><a name="l01252"></a><span class="lineno"> 1252</span>&#160;   <a class="code" href="../../d1/d75/res__pjsip__refer_8c.html#a09a39bfa4ee64baa72466c1ab2cd9de0">add_header_from_channel_var</a>(session-&gt;<a class="code" href="../../d2/dec/structast__sip__session.html#a48371aaa1ad1144e564ebcd179a2db2e">channel</a>, <span class="stringliteral">&quot;SIPREFERREDBYHDR&quot;</span>, <span class="stringliteral">&quot;Referred-By&quot;</span>, tdata);</div><div class="line"><a name="l01253"></a><span class="lineno"> 1253</span>&#160;   <a class="code" href="../../d5/d7b/channel_8h.html#af476c537b29be3f29240489032f9db39">ast_channel_unlock</a>(session-&gt;<a class="code" href="../../d2/dec/structast__sip__session.html#a48371aaa1ad1144e564ebcd179a2db2e">channel</a>);</div><div class="line"><a name="l01254"></a><span class="lineno"> 1254</span>&#160;}</div><div class="ttc" id="channel_8h_html_a493bdebe876caafb8ee535853310364a"><div class="ttname"><a href="../../d5/d7b/channel_8h.html#a493bdebe876caafb8ee535853310364a">ast_channel_lock</a></div><div class="ttdeci">#define ast_channel_lock(chan)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d7b/channel_8h_source.html#l02945">channel.h:2945</a></div></div>
<div class="ttc" id="structast__sip__session_html_ab9fd713b198a122cb52c7f10bd66d1c6"><div class="ttname"><a href="../../d2/dec/structast__sip__session.html#ab9fd713b198a122cb52c7f10bd66d1c6">ast_sip_session::inv_session</a></div><div class="ttdeci">struct pjsip_inv_session * inv_session</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/de7/res__pjsip__session_8h_source.html#l00187">res_pjsip_session.h:187</a></div></div>
<div class="ttc" id="structast__sip__session_html_a48371aaa1ad1144e564ebcd179a2db2e"><div class="ttname"><a href="../../d2/dec/structast__sip__session.html#a48371aaa1ad1144e564ebcd179a2db2e">ast_sip_session::channel</a></div><div class="ttdeci">struct ast_channel * channel</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/de7/res__pjsip__session_8h_source.html#l00189">res_pjsip_session.h:189</a></div></div>
<div class="ttc" id="res__pjsip__refer_8c_html_a09a39bfa4ee64baa72466c1ab2cd9de0"><div class="ttname"><a href="../../d1/d75/res__pjsip__refer_8c.html#a09a39bfa4ee64baa72466c1ab2cd9de0">add_header_from_channel_var</a></div><div class="ttdeci">static void add_header_from_channel_var(struct ast_channel *chan, const char *var_name, const char *header_name, pjsip_tx_data *tdata)</div><div class="ttdoc">Use the value of a channel variable as the value of a SIP header. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d75/res__pjsip__refer_8c_source.html#l01223">res_pjsip_refer.c:1223</a></div></div>
<div class="ttc" id="channel_8h_html_af476c537b29be3f29240489032f9db39"><div class="ttname"><a href="../../d5/d7b/channel_8h.html#af476c537b29be3f29240489032f9db39">ast_channel_unlock</a></div><div class="ttdeci">#define ast_channel_unlock(chan)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d7b/channel_8h_source.html#l02946">channel.h:2946</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="ae1ecfce9061d388895519ded34e31a36"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae1ecfce9061d388895519ded34e31a36">&#9670;&nbsp;</a></span>refer_progress_alloc()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int refer_progress_alloc </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="../../d2/dec/structast__sip__session.html">ast_sip_session</a> *&#160;</td>
          <td class="paramname"><em>session</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">pjsip_rx_data *&#160;</td>
          <td class="paramname"><em>rdata</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="../../d0/d4b/structrefer__progress.html">refer_progress</a> **&#160;</td>
          <td class="paramname"><em>progress</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Internal helper function which sets up a refer progress structure if needed. </p>

<p class="definition">Definition at line <a class="el" href="../../d1/d75/res__pjsip__refer_8c_source.html#l00382">382</a> of file <a class="el" href="../../d1/d75/res__pjsip__refer_8c_source.html">res_pjsip_refer.c</a>.</p>

<p class="reference">References <a class="el" href="../../d5/da5/astobj2_8h_source.html#l00411">ao2_alloc</a>, <a class="el" href="../../d5/da5/astobj2_8h_source.html#l01958">ao2_cleanup</a>, <a class="el" href="../../d5/da5/astobj2_8h_source.html#l00464">ao2_ref</a>, <a class="el" href="../../d5/d7b/channel_8h.html#a7ca2fda13b129a55c251b56729de285b">ast_channel_name()</a>, <a class="el" href="../../d1/d8c/logger_8h_source.html#l00452">ast_debug</a>, <a class="el" href="../../de/d96/res__pjsip_8c_source.html#l05133">ast_sip_create_serializer()</a>, <a class="el" href="../../d7/d69/sorcery_8c_source.html#l02312">ast_sorcery_object_get_id()</a>, <a class="el" href="../../d4/deb/taskprocessor_8c_source.html#l01295">ast_taskprocessor_build_name()</a>, <a class="el" href="../../d0/d1e/taskprocessor_8h_source.html#l00060">AST_TASKPROCESSOR_MAX_NAME</a>, <a class="el" href="../../d9/de7/res__pjsip__session_8h_source.html#l00189">ast_sip_session::channel</a>, <a class="el" href="../../d9/de7/res__pjsip__session_8h_source.html#l00183">ast_sip_session::endpoint</a>, <a class="el" href="../../d6/d47/utils_2frame_8c_source.html#l00999">error()</a>, <a class="el" href="../../d9/de7/res__pjsip__session_8h_source.html#l00187">ast_sip_session::inv_session</a>, <a class="el" href="../../dc/d7f/resample_8c_source.html#l00096">NULL</a>, <a class="el" href="../../d8/d8c/res__pjsip_8h_source.html#l00895">ast_sip_endpoint::refer_blind_progress</a>, <a class="el" href="../../d1/d75/res__pjsip__refer_8c_source.html#l00349">refer_progress_destroy()</a>, <a class="el" href="../../d1/d75/res__pjsip__refer_8c_source.html#l00339">refer_progress_evsub_cb</a>, and <a class="el" href="../../d1/d75/res__pjsip__refer_8c_source.html#l00080">refer_progress_module</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../d1/d75/res__pjsip__refer_8c_source.html#l01088">refer_incoming_refer_request()</a>.</p>
<div class="fragment"><div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;{</div><div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;   <span class="keyword">const</span> pj_str_t str_refer_sub = { <span class="stringliteral">&quot;Refer-Sub&quot;</span>, 9 };</div><div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;   pjsip_generic_string_hdr *refer_sub = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;   <span class="keyword">const</span> pj_str_t str_true = { <span class="stringliteral">&quot;true&quot;</span>, 4 };</div><div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;   pjsip_hdr <a class="code" href="../../d6/dba/structhdr__list.html">hdr_list</a>;</div><div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;   <span class="keywordtype">char</span> tps_name[<a class="code" href="../../d0/d1e/taskprocessor_8h.html#adf4c5a237767eb6db5b1db41ccdfc689">AST_TASKPROCESSOR_MAX_NAME</a> + 1];</div><div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;</div><div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;   *progress = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;</div><div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;   <span class="comment">/* Grab the optional Refer-Sub header, it can be used to suppress the implicit subscription */</span></div><div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;   refer_sub = pjsip_msg_find_hdr_by_name(rdata-&gt;msg_info.msg, &amp;str_refer_sub, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div><div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;   <span class="keywordflow">if</span> ((refer_sub &amp;&amp; pj_strnicmp(&amp;refer_sub-&gt;hvalue, &amp;str_true, 4))) {</div><div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;      <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;   }</div><div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;</div><div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;   <span class="keywordflow">if</span> (!(*progress = <a class="code" href="../../d5/da5/astobj2_8h.html#ae0422b60d8e25b6962b2d61ae4ddf724">ao2_alloc</a>(<span class="keyword">sizeof</span>(<span class="keyword">struct</span> <a class="code" href="../../d0/d4b/structrefer__progress.html">refer_progress</a>), <a class="code" href="../../d1/d75/res__pjsip__refer_8c.html#a905b61e1a8539d48d654e13850396b06">refer_progress_destroy</a>))) {</div><div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;   }</div><div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;</div><div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;   <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(3, <span class="stringliteral">&quot;Created progress monitor &#39;%p&#39; for transfer occurring from channel &#39;%s&#39; and endpoint &#39;%s&#39;\n&quot;</span>,</div><div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;      progress, <a class="code" href="../../d5/d7b/channel_8h.html#a7ca2fda13b129a55c251b56729de285b">ast_channel_name</a>(session-&gt;<a class="code" href="../../d2/dec/structast__sip__session.html#a48371aaa1ad1144e564ebcd179a2db2e">channel</a>), <a class="code" href="../../d8/d25/sorcery_8h.html#a97706283a06cbb44e4f0f9620dd5cf07">ast_sorcery_object_get_id</a>(session-&gt;<a class="code" href="../../d2/dec/structast__sip__session.html#a3960205b2a4e7e012dc9f0eae1855f01">endpoint</a>));</div><div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;</div><div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;   (*progress)-&gt;refer_blind_progress = session-&gt;<a class="code" href="../../d2/dec/structast__sip__session.html#a3960205b2a4e7e012dc9f0eae1855f01">endpoint</a>-&gt;<a class="code" href="../../d3/d46/structast__sip__endpoint.html#a63e413c0e98d7635f20ef19c9432c1aa">refer_blind_progress</a>;</div><div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;</div><div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;   (*progress)-&gt;framehook = -1;</div><div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;</div><div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;   <span class="comment">/* Create name with seq number appended. */</span></div><div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;   <a class="code" href="../../d0/d1e/taskprocessor_8h.html#ab47623e207bf2cdd0edfa613d91894e5">ast_taskprocessor_build_name</a>(tps_name, <span class="keyword">sizeof</span>(tps_name), <span class="stringliteral">&quot;pjsip/refer/%s&quot;</span>,</div><div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;      <a class="code" href="../../d8/d25/sorcery_8h.html#a97706283a06cbb44e4f0f9620dd5cf07">ast_sorcery_object_get_id</a>(session-&gt;<a class="code" href="../../d2/dec/structast__sip__session.html#a3960205b2a4e7e012dc9f0eae1855f01">endpoint</a>));</div><div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;</div><div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;   <span class="keywordflow">if</span> (!((*progress)-&gt;serializer = <a class="code" href="../../d7/dfa/group__pjsip__threading.html#gad57aa0b914fbd6adbf8ee2fe176e1fb1">ast_sip_create_serializer</a>(tps_name))) {</div><div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;      <span class="keywordflow">goto</span> <a class="code" href="../../d6/d47/utils_2frame_8c.html#a4a9391ee88e57361b613c4c2fd2bf4aa">error</a>;</div><div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;   }</div><div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;</div><div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;   <span class="comment">/* Create the implicit subscription for monitoring of this transfer */</span></div><div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;   <span class="keywordflow">if</span> (pjsip_xfer_create_uas(session-&gt;<a class="code" href="../../d2/dec/structast__sip__session.html#ab9fd713b198a122cb52c7f10bd66d1c6">inv_session</a>-&gt;dlg, &amp;<a class="code" href="../../d1/d75/res__pjsip__refer_8c.html#aeccd64eee013b06e9076d695d8d47ba3">refer_progress_evsub_cb</a>, rdata, &amp;(*progress)-&gt;sub) != PJ_SUCCESS) {</div><div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;      <span class="keywordflow">goto</span> <a class="code" href="../../d6/d47/utils_2frame_8c.html#a4a9391ee88e57361b613c4c2fd2bf4aa">error</a>;</div><div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;   }</div><div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;</div><div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;   <span class="comment">/* To prevent a potential deadlock we need the dialog so we can lock/unlock */</span></div><div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;   (*progress)-&gt;dlg = session-&gt;<a class="code" href="../../d2/dec/structast__sip__session.html#ab9fd713b198a122cb52c7f10bd66d1c6">inv_session</a>-&gt;dlg;</div><div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;   <span class="comment">/* We also need to make sure it stays around until we&#39;re done with it */</span></div><div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;   pjsip_dlg_inc_session((*progress)-&gt;dlg, &amp;<a class="code" href="../../d1/d75/res__pjsip__refer_8c.html#a43579c197f6efc45d0093d0ab8cba536">refer_progress_module</a>);</div><div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;</div><div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;</div><div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;   <span class="comment">/* Associate the REFER progress structure with the subscription */</span></div><div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(*progress, +1);</div><div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;   pjsip_evsub_set_mod_data((*progress)-&gt;sub, <a class="code" href="../../d1/d75/res__pjsip__refer_8c.html#a43579c197f6efc45d0093d0ab8cba536">refer_progress_module</a>.id, *progress);</div><div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;</div><div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;   pj_list_init(&amp;hdr_list);</div><div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;   <span class="keywordflow">if</span> (refer_sub) {</div><div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;      pjsip_hdr *hdr = (pjsip_hdr*)pjsip_generic_string_hdr_create(session-&gt;<a class="code" href="../../d2/dec/structast__sip__session.html#ab9fd713b198a122cb52c7f10bd66d1c6">inv_session</a>-&gt;dlg-&gt;pool, &amp;str_refer_sub, &amp;str_true);</div><div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;</div><div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;      pj_list_push_back(&amp;hdr_list, hdr);</div><div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;   }</div><div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;</div><div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;   <span class="comment">/* Accept the REFER request */</span></div><div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;   <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(3, <span class="stringliteral">&quot;Accepting REFER request for progress monitor &#39;%p&#39;\n&quot;</span>, *progress);</div><div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;   pjsip_xfer_accept((*progress)-&gt;sub, rdata, 202, &amp;hdr_list);</div><div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;</div><div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;   <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;</div><div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;<a class="code" href="../../d6/d47/utils_2frame_8c.html#a4a9391ee88e57361b613c4c2fd2bf4aa">error</a>:</div><div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#a6321ee982370c55ab3c24c72c562cbdd">ao2_cleanup</a>(*progress);</div><div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;   *progress = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;   <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;}</div><div class="ttc" id="structast__sip__session_html_a3960205b2a4e7e012dc9f0eae1855f01"><div class="ttname"><a href="../../d2/dec/structast__sip__session.html#a3960205b2a4e7e012dc9f0eae1855f01">ast_sip_session::endpoint</a></div><div class="ttdeci">struct ast_sip_endpoint * endpoint</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/de7/res__pjsip__session_8h_source.html#l00183">res_pjsip_session.h:183</a></div></div>
<div class="ttc" id="taskprocessor_8h_html_ab47623e207bf2cdd0edfa613d91894e5"><div class="ttname"><a href="../../d0/d1e/taskprocessor_8h.html#ab47623e207bf2cdd0edfa613d91894e5">ast_taskprocessor_build_name</a></div><div class="ttdeci">void ast_taskprocessor_build_name(char *buf, unsigned int size, const char *format,...)</div><div class="ttdoc">Build a taskprocessor name with a sequence number on the end. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/deb/taskprocessor_8c_source.html#l01295">taskprocessor.c:1295</a></div></div>
<div class="ttc" id="structhdr__list_html"><div class="ttname"><a href="../../d6/dba/structhdr__list.html">hdr_list</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d6/dd6/res__pjsip__header__funcs_8c_source.html#l00149">res_pjsip_header_funcs.c:149</a></div></div>
<div class="ttc" id="resample_8c_html_a070d2ce7b6bb7e5c05602aa8c308d0c4"><div class="ttname"><a href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a></div><div class="ttdeci">#define NULL</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d7f/resample_8c_source.html#l00096">resample.c:96</a></div></div>
<div class="ttc" id="taskprocessor_8h_html_adf4c5a237767eb6db5b1db41ccdfc689"><div class="ttname"><a href="../../d0/d1e/taskprocessor_8h.html#adf4c5a237767eb6db5b1db41ccdfc689">AST_TASKPROCESSOR_MAX_NAME</a></div><div class="ttdeci">#define AST_TASKPROCESSOR_MAX_NAME</div><div class="ttdoc">Suggested maximum taskprocessor name length (less null terminator). </div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d1e/taskprocessor_8h_source.html#l00060">taskprocessor.h:60</a></div></div>
<div class="ttc" id="structast__sip__session_html_ab9fd713b198a122cb52c7f10bd66d1c6"><div class="ttname"><a href="../../d2/dec/structast__sip__session.html#ab9fd713b198a122cb52c7f10bd66d1c6">ast_sip_session::inv_session</a></div><div class="ttdeci">struct pjsip_inv_session * inv_session</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/de7/res__pjsip__session_8h_source.html#l00187">res_pjsip_session.h:187</a></div></div>
<div class="ttc" id="res__pjsip__refer_8c_html_a43579c197f6efc45d0093d0ab8cba536"><div class="ttname"><a href="../../d1/d75/res__pjsip__refer_8c.html#a43579c197f6efc45d0093d0ab8cba536">refer_progress_module</a></div><div class="ttdeci">static pjsip_module refer_progress_module</div><div class="ttdoc">REFER Progress module, used to attach REFER progress structure to subscriptions. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d75/res__pjsip__refer_8c_source.html#l00080">res_pjsip_refer.c:80</a></div></div>
<div class="ttc" id="logger_8h_html_a3f248112c8d6ce7e3959aa723dade648"><div class="ttname"><a href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a></div><div class="ttdeci">#define ast_debug(level,...)</div><div class="ttdoc">Log a DEBUG message. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d8c/logger_8h_source.html#l00452">logger.h:452</a></div></div>
<div class="ttc" id="astobj2_8h_html_aaca5e8eac39a22f9da1c36fc6c922270"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a></div><div class="ttdeci">#define ao2_ref(o, delta)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l00464">astobj2.h:464</a></div></div>
<div class="ttc" id="sorcery_8h_html_a97706283a06cbb44e4f0f9620dd5cf07"><div class="ttname"><a href="../../d8/d25/sorcery_8h.html#a97706283a06cbb44e4f0f9620dd5cf07">ast_sorcery_object_get_id</a></div><div class="ttdeci">const char * ast_sorcery_object_get_id(const void *object)</div><div class="ttdoc">Get the unique identifier of a sorcery object. </div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d69/sorcery_8c_source.html#l02312">sorcery.c:2312</a></div></div>
<div class="ttc" id="structast__sip__session_html_a48371aaa1ad1144e564ebcd179a2db2e"><div class="ttname"><a href="../../d2/dec/structast__sip__session.html#a48371aaa1ad1144e564ebcd179a2db2e">ast_sip_session::channel</a></div><div class="ttdeci">struct ast_channel * channel</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/de7/res__pjsip__session_8h_source.html#l00189">res_pjsip_session.h:189</a></div></div>
<div class="ttc" id="res__pjsip__refer_8c_html_a905b61e1a8539d48d654e13850396b06"><div class="ttname"><a href="../../d1/d75/res__pjsip__refer_8c.html#a905b61e1a8539d48d654e13850396b06">refer_progress_destroy</a></div><div class="ttdeci">static void refer_progress_destroy(void *obj)</div><div class="ttdoc">Destructor for REFER progress sutrcture. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d75/res__pjsip__refer_8c_source.html#l00349">res_pjsip_refer.c:349</a></div></div>
<div class="ttc" id="group__pjsip__threading_html_gad57aa0b914fbd6adbf8ee2fe176e1fb1"><div class="ttname"><a href="../../d7/dfa/group__pjsip__threading.html#gad57aa0b914fbd6adbf8ee2fe176e1fb1">ast_sip_create_serializer</a></div><div class="ttdeci">struct ast_taskprocessor * ast_sip_create_serializer(const char *name)</div><div class="ttdoc">Create a new serializer for SIP tasks. </div><div class="ttdef"><b>Definition:</b> <a href="../../de/d96/res__pjsip_8c_source.html#l05133">res_pjsip.c:5133</a></div></div>
<div class="ttc" id="astobj2_8h_html_ae0422b60d8e25b6962b2d61ae4ddf724"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#ae0422b60d8e25b6962b2d61ae4ddf724">ao2_alloc</a></div><div class="ttdeci">#define ao2_alloc(data_size, destructor_fn)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l00411">astobj2.h:411</a></div></div>
<div class="ttc" id="structast__sip__endpoint_html_a63e413c0e98d7635f20ef19c9432c1aa"><div class="ttname"><a href="../../d3/d46/structast__sip__endpoint.html#a63e413c0e98d7635f20ef19c9432c1aa">ast_sip_endpoint::refer_blind_progress</a></div><div class="ttdeci">unsigned int refer_blind_progress</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d8c/res__pjsip_8h_source.html#l00895">res_pjsip.h:895</a></div></div>
<div class="ttc" id="res__pjsip__refer_8c_html_aeccd64eee013b06e9076d695d8d47ba3"><div class="ttname"><a href="../../d1/d75/res__pjsip__refer_8c.html#aeccd64eee013b06e9076d695d8d47ba3">refer_progress_evsub_cb</a></div><div class="ttdeci">static pjsip_evsub_user refer_progress_evsub_cb</div><div class="ttdoc">Callback structure for subscription. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d75/res__pjsip__refer_8c_source.html#l00339">res_pjsip_refer.c:339</a></div></div>
<div class="ttc" id="astobj2_8h_html_a6321ee982370c55ab3c24c72c562cbdd"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#a6321ee982370c55ab3c24c72c562cbdd">ao2_cleanup</a></div><div class="ttdeci">#define ao2_cleanup(obj)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l01958">astobj2.h:1958</a></div></div>
<div class="ttc" id="channel_8h_html_a7ca2fda13b129a55c251b56729de285b"><div class="ttname"><a href="../../d5/d7b/channel_8h.html#a7ca2fda13b129a55c251b56729de285b">ast_channel_name</a></div><div class="ttdeci">const char * ast_channel_name(const struct ast_channel *chan)</div></div>
<div class="ttc" id="utils_2frame_8c_html_a4a9391ee88e57361b613c4c2fd2bf4aa"><div class="ttname"><a href="../../d6/d47/utils_2frame_8c.html#a4a9391ee88e57361b613c4c2fd2bf4aa">error</a></div><div class="ttdeci">int error(const char *format,...)</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d47/utils_2frame_8c_source.html#l00999">utils/frame.c:999</a></div></div>
<div class="ttc" id="structrefer__progress_html"><div class="ttname"><a href="../../d0/d4b/structrefer__progress.html">refer_progress</a></div><div class="ttdoc">REFER Progress structure. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d75/res__pjsip__refer_8c_source.html#l00044">res_pjsip_refer.c:44</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="af1b4316df480302870d7bc3e9391227d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af1b4316df480302870d7bc3e9391227d">&#9670;&nbsp;</a></span>refer_progress_bridge()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void refer_progress_bridge </td>
          <td>(</td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>data</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="../../d9/de4/structstasis__subscription.html">stasis_subscription</a> *&#160;</td>
          <td class="paramname"><em>sub</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="../../d7/d55/structstasis__message.html">stasis_message</a> *&#160;</td>
          <td class="paramname"><em>message</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="../../d1/d75/res__pjsip__refer_8c_source.html#l00181">181</a> of file <a class="el" href="../../d1/d75/res__pjsip__refer_8c_source.html">res_pjsip_refer.c</a>.</p>

<p class="reference">References <a class="el" href="../../d5/da5/astobj2_8h_source.html#l01958">ao2_cleanup</a>, <a class="el" href="../../d5/da5/astobj2_8h_source.html#l00464">ao2_ref</a>, <a class="el" href="../../dc/d4e/stasis__bridges_8h.html#a8bd3a6c07bd2064a82a7c27091ba0fce">ast_channel_entered_bridge_type()</a>, <a class="el" href="../../d4/d28/channel_8c_source.html#l01454">ast_channel_get_by_name()</a>, <a class="el" href="../../d5/d7b/channel_8h_source.html#l02945">ast_channel_lock</a>, <a class="el" href="../../d5/d7b/channel_8h.html#a7ca2fda13b129a55c251b56729de285b">ast_channel_name()</a>, <a class="el" href="../../d5/d7b/channel_8h_source.html#l02946">ast_channel_unlock</a>, <a class="el" href="../../d5/d7b/channel_8h_source.html#l02981">ast_channel_unref</a>, <a class="el" href="../../d1/d8c/logger_8h_source.html#l00452">ast_debug</a>, <a class="el" href="../../da/dac/framehook_8c_source.html#l00177">ast_framehook_detach()</a>, <a class="el" href="../../de/d96/res__pjsip_8c_source.html#l05138">ast_sip_push_task()</a>, <a class="el" href="../../d9/d4a/stasis__channels_8h_source.html#l00146">ast_channel_snapshot::base</a>, <a class="el" href="../../d1/d75/res__pjsip__refer_8c_source.html#l00058">refer_progress::bridge_sub</a>, <a class="el" href="../../dc/d4e/stasis__bridges_8h_source.html#l00127">ast_bridge_blob::channel</a>, <a class="el" href="../../d4/d56/bridge_8h_source.html#l01141">transfer_channel_data::completed</a>, <a class="el" href="../../d1/d75/res__pjsip__refer_8c_source.html#l00052">refer_progress::framehook</a>, <a class="el" href="../../d1/d75/res__pjsip__refer_8c_source.html#l00094">refer_progress_notification_alloc()</a>, <a class="el" href="../../d1/d75/res__pjsip__refer_8c_source.html#l00140">refer_progress_notify()</a>, <a class="el" href="../../d1/d75/res__pjsip__refer_8c_source.html#l00056">refer_progress::serializer</a>, <a class="el" href="../../d2/db9/stasis__message_8c_source.html#l00195">stasis_message_data()</a>, <a class="el" href="../../d2/db9/stasis__message_8c_source.html#l00187">stasis_message_type()</a>, <a class="el" href="../../d0/df4/stasis_8c_source.html#l01176">stasis_subscription_final_message()</a>, <a class="el" href="../../d0/df4/stasis_8c_source.html#l00973">stasis_unsubscribe()</a>, <a class="el" href="../../d1/d75/res__pjsip__refer_8c_source.html#l00060">refer_progress::transfer_data</a>, <a class="el" href="../../d1/d75/res__pjsip__refer_8c_source.html#l00062">refer_progress::transferee</a>, and <a class="el" href="../../d9/d4a/stasis__channels_8h_source.html#l00112">ast_channel_snapshot_base::uniqueid</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../d1/d75/res__pjsip__refer_8c_source.html#l00625">refer_blind_callback()</a>.</p>
<div class="fragment"><div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;{</div><div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d0/d4b/structrefer__progress.html">refer_progress</a> *<a class="code" href="../../d1/df7/structprogress.html">progress</a> = data;</div><div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d7/d01/structast__bridge__blob.html">ast_bridge_blob</a> *enter_blob;</div><div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d3/dff/structrefer__progress__notification.html">refer_progress_notification</a> *notification;</div><div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../df/d3c/structast__channel.html">ast_channel</a> *chan;</div><div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;</div><div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../dd/d79/stasis_8h.html#a839350445aaa51cedf31f6daec933ee0">stasis_subscription_final_message</a>(sub, message)) {</div><div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;      <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(progress, -1);</div><div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;      <span class="keywordflow">return</span>;</div><div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;   }</div><div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;</div><div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../dc/d4e/stasis__bridges_8h.html#a8bd3a6c07bd2064a82a7c27091ba0fce">ast_channel_entered_bridge_type</a>() != <a class="code" href="../../dd/d79/stasis_8h.html#a9356e8a29344ca4eac93088198ccff89">stasis_message_type</a>(message)) {</div><div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;      <span class="comment">/* Don&#39;t care */</span></div><div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;      <span class="keywordflow">return</span>;</div><div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;   }</div><div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;</div><div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;   enter_blob = <a class="code" href="../../dd/d79/stasis_8h.html#af6081f17431b81bc1a010b680517491d">stasis_message_data</a>(message);</div><div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;   <span class="keywordflow">if</span> (strcmp(enter_blob-&gt;<a class="code" href="../../d7/d01/structast__bridge__blob.html#a8ee8cdf03a2b9d3424011cb6875751fa">channel</a>-&gt;<a class="code" href="../../dd/dbe/structast__channel__snapshot.html#ab6103ad1bbc12922f93c0526204573cf">base</a>-&gt;<a class="code" href="../../d6/d29/structast__channel__snapshot__base.html#a753c7b39e3284d771f13f513b003d033">uniqueid</a>, progress-&gt;<a class="code" href="../../d0/d4b/structrefer__progress.html#ad59ea5bda14dba853447d8de13813038">transferee</a>)) {</div><div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;      <span class="comment">/* Don&#39;t care */</span></div><div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;      <span class="keywordflow">return</span>;</div><div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;   }</div><div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;</div><div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;   <span class="keywordflow">if</span> (!progress-&gt;<a class="code" href="../../d0/d4b/structrefer__progress.html#a22abfff94132237b9bfefd9926961698">transfer_data</a>-&gt;<a class="code" href="../../da/d84/structtransfer__channel__data.html#a4eff08519948266efdd345aabe6ecbbb">completed</a>) {</div><div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;      <span class="comment">/* We can&#39;t act on this message because the transfer_channel_data doesn&#39;t show that</span></div><div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;<span class="comment">       * the transfer is ready to progress */</span></div><div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;      <span class="keywordflow">return</span>;</div><div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;   }</div><div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;</div><div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;   <span class="comment">/* OMG the transferee is joining a bridge. His call got answered! */</span></div><div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;   notification = <a class="code" href="../../d1/d75/res__pjsip__refer_8c.html#a89f2c1d96492b68d1399f20fc6eeb833">refer_progress_notification_alloc</a>(progress, 200, PJSIP_EVSUB_STATE_TERMINATED);</div><div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;   <span class="keywordflow">if</span> (notification) {</div><div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="../../d7/dfa/group__pjsip__threading.html#ga4f0a0629fa2ca084812772356d8e3565">ast_sip_push_task</a>(progress-&gt;<a class="code" href="../../d0/d4b/structrefer__progress.html#ac23e23ba60f358de78a893d537c0afa4">serializer</a>, <a class="code" href="../../d1/d75/res__pjsip__refer_8c.html#a5d2be3003a3c77234b90343bc0a43935">refer_progress_notify</a>, notification)) {</div><div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;         <a class="code" href="../../d5/da5/astobj2_8h.html#a6321ee982370c55ab3c24c72c562cbdd">ao2_cleanup</a>(notification);</div><div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;      }</div><div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;      progress-&gt;<a class="code" href="../../d0/d4b/structrefer__progress.html#aab0602828a0c8ce025953da194f6681f">bridge_sub</a> = <a class="code" href="../../dd/d79/stasis_8h.html#a3498301077e2005383f0d261c471388b">stasis_unsubscribe</a>(progress-&gt;<a class="code" href="../../d0/d4b/structrefer__progress.html#aab0602828a0c8ce025953da194f6681f">bridge_sub</a>);</div><div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;   }</div><div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;</div><div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;   chan = <a class="code" href="../../d5/d7b/channel_8h.html#ac7e42045272530c8678418993e75fd56">ast_channel_get_by_name</a>(progress-&gt;<a class="code" href="../../d0/d4b/structrefer__progress.html#ad59ea5bda14dba853447d8de13813038">transferee</a>);</div><div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;   <span class="keywordflow">if</span> (!chan) {</div><div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;      <span class="comment">/* The channel is already gone */</span></div><div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;      <span class="keywordflow">return</span>;</div><div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;   }</div><div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;</div><div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;   <a class="code" href="../../d5/d7b/channel_8h.html#a493bdebe876caafb8ee535853310364a">ast_channel_lock</a>(chan);</div><div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;   <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(3, <span class="stringliteral">&quot;Detaching REFER progress monitoring hook from &#39;%s&#39; as it has joined a bridge\n&quot;</span>,</div><div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;      <a class="code" href="../../d5/d7b/channel_8h.html#a7ca2fda13b129a55c251b56729de285b">ast_channel_name</a>(chan));</div><div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;   <a class="code" href="../../db/d3c/framehook_8h.html#a6e116259cae8c1e5cca074d05f0a3475">ast_framehook_detach</a>(chan, progress-&gt;<a class="code" href="../../d0/d4b/structrefer__progress.html#ae25f61b5aa8877dfb396fd378c6b7722">framehook</a>);</div><div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;   <a class="code" href="../../d5/d7b/channel_8h.html#af476c537b29be3f29240489032f9db39">ast_channel_unlock</a>(chan);</div><div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;</div><div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;   <a class="code" href="../../d5/d7b/channel_8h.html#ab733a7825810b895a89b629e0ea89380">ast_channel_unref</a>(chan);</div><div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;}</div><div class="ttc" id="channel_8h_html_a493bdebe876caafb8ee535853310364a"><div class="ttname"><a href="../../d5/d7b/channel_8h.html#a493bdebe876caafb8ee535853310364a">ast_channel_lock</a></div><div class="ttdeci">#define ast_channel_lock(chan)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d7b/channel_8h_source.html#l02945">channel.h:2945</a></div></div>
<div class="ttc" id="structast__channel_html"><div class="ttname"><a href="../../df/d3c/structast__channel.html">ast_channel</a></div><div class="ttdoc">Main Channel structure associated with a channel. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/de2/channel__internal__api_8c_source.html#l00073">channel_internal_api.c:73</a></div></div>
<div class="ttc" id="structast__channel__snapshot_html_ab6103ad1bbc12922f93c0526204573cf"><div class="ttname"><a href="../../dd/dbe/structast__channel__snapshot.html#ab6103ad1bbc12922f93c0526204573cf">ast_channel_snapshot::base</a></div><div class="ttdeci">struct ast_channel_snapshot_base * base</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d4a/stasis__channels_8h_source.html#l00146">stasis_channels.h:146</a></div></div>
<div class="ttc" id="stasis__bridges_8h_html_a8bd3a6c07bd2064a82a7c27091ba0fce"><div class="ttname"><a href="../../dc/d4e/stasis__bridges_8h.html#a8bd3a6c07bd2064a82a7c27091ba0fce">ast_channel_entered_bridge_type</a></div><div class="ttdeci">struct stasis_message_type * ast_channel_entered_bridge_type(void)</div><div class="ttdoc">Message type for channel enter bridge blob messages. </div></div>
<div class="ttc" id="structast__bridge__blob_html_a8ee8cdf03a2b9d3424011cb6875751fa"><div class="ttname"><a href="../../d7/d01/structast__bridge__blob.html#a8ee8cdf03a2b9d3424011cb6875751fa">ast_bridge_blob::channel</a></div><div class="ttdeci">struct ast_channel_snapshot * channel</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d4e/stasis__bridges_8h_source.html#l00127">stasis_bridges.h:127</a></div></div>
<div class="ttc" id="channel_8h_html_ab733a7825810b895a89b629e0ea89380"><div class="ttname"><a href="../../d5/d7b/channel_8h.html#ab733a7825810b895a89b629e0ea89380">ast_channel_unref</a></div><div class="ttdeci">#define ast_channel_unref(c)</div><div class="ttdoc">Decrease channel reference count. </div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d7b/channel_8h_source.html#l02981">channel.h:2981</a></div></div>
<div class="ttc" id="structrefer__progress_html_ac23e23ba60f358de78a893d537c0afa4"><div class="ttname"><a href="../../d0/d4b/structrefer__progress.html#ac23e23ba60f358de78a893d537c0afa4">refer_progress::serializer</a></div><div class="ttdeci">struct ast_taskprocessor * serializer</div><div class="ttdoc">Serializer for notifications. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d75/res__pjsip__refer_8c_source.html#l00056">res_pjsip_refer.c:56</a></div></div>
<div class="ttc" id="structrefer__progress_html_aab0602828a0c8ce025953da194f6681f"><div class="ttname"><a href="../../d0/d4b/structrefer__progress.html#aab0602828a0c8ce025953da194f6681f">refer_progress::bridge_sub</a></div><div class="ttdeci">struct stasis_subscription * bridge_sub</div><div class="ttdoc">Stasis subscription for bridge events. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d75/res__pjsip__refer_8c_source.html#l00058">res_pjsip_refer.c:58</a></div></div>
<div class="ttc" id="structrefer__progress_html_a22abfff94132237b9bfefd9926961698"><div class="ttname"><a href="../../d0/d4b/structrefer__progress.html#a22abfff94132237b9bfefd9926961698">refer_progress::transfer_data</a></div><div class="ttdeci">struct transfer_channel_data * transfer_data</div><div class="ttdoc">Reference to transfer_channel_data related to the refer. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d75/res__pjsip__refer_8c_source.html#l00060">res_pjsip_refer.c:60</a></div></div>
<div class="ttc" id="framehook_8h_html_a6e116259cae8c1e5cca074d05f0a3475"><div class="ttname"><a href="../../db/d3c/framehook_8h.html#a6e116259cae8c1e5cca074d05f0a3475">ast_framehook_detach</a></div><div class="ttdeci">int ast_framehook_detach(struct ast_channel *chan, int framehook_id)</div><div class="ttdoc">Detach an framehook from a channel. </div><div class="ttdef"><b>Definition:</b> <a href="../../da/dac/framehook_8c_source.html#l00177">framehook.c:177</a></div></div>
<div class="ttc" id="stasis_8h_html_a9356e8a29344ca4eac93088198ccff89"><div class="ttname"><a href="../../dd/d79/stasis_8h.html#a9356e8a29344ca4eac93088198ccff89">stasis_message_type</a></div><div class="ttdeci">struct stasis_message_type * stasis_message_type(const struct stasis_message *msg)</div><div class="ttdoc">Get the message type for a stasis_message. </div><div class="ttdef"><b>Definition:</b> <a href="../../d2/db9/stasis__message_8c_source.html#l00187">stasis_message.c:187</a></div></div>
<div class="ttc" id="structrefer__progress_html_ae25f61b5aa8877dfb396fd378c6b7722"><div class="ttname"><a href="../../d0/d4b/structrefer__progress.html#ae25f61b5aa8877dfb396fd378c6b7722">refer_progress::framehook</a></div><div class="ttdeci">int framehook</div><div class="ttdoc">Frame hook for monitoring REFER progress. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d75/res__pjsip__refer_8c_source.html#l00052">res_pjsip_refer.c:52</a></div></div>
<div class="ttc" id="structrefer__progress__notification_html"><div class="ttname"><a href="../../d3/dff/structrefer__progress__notification.html">refer_progress_notification</a></div><div class="ttdoc">REFER Progress notification structure. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d75/res__pjsip__refer_8c_source.html#l00070">res_pjsip_refer.c:70</a></div></div>
<div class="ttc" id="structast__channel__snapshot__base_html_a753c7b39e3284d771f13f513b003d033"><div class="ttname"><a href="../../d6/d29/structast__channel__snapshot__base.html#a753c7b39e3284d771f13f513b003d033">ast_channel_snapshot_base::uniqueid</a></div><div class="ttdeci">const ast_string_field uniqueid</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d4a/stasis__channels_8h_source.html#l00112">stasis_channels.h:112</a></div></div>
<div class="ttc" id="structprogress_html"><div class="ttname"><a href="../../d1/df7/structprogress.html">progress</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d3b/dsp_8c_source.html#l00117">dsp.c:117</a></div></div>
<div class="ttc" id="structrefer__progress_html_ad59ea5bda14dba853447d8de13813038"><div class="ttname"><a href="../../d0/d4b/structrefer__progress.html#ad59ea5bda14dba853447d8de13813038">refer_progress::transferee</a></div><div class="ttdeci">char * transferee</div><div class="ttdoc">Uniqueid of transferee channel. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d75/res__pjsip__refer_8c_source.html#l00062">res_pjsip_refer.c:62</a></div></div>
<div class="ttc" id="logger_8h_html_a3f248112c8d6ce7e3959aa723dade648"><div class="ttname"><a href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a></div><div class="ttdeci">#define ast_debug(level,...)</div><div class="ttdoc">Log a DEBUG message. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d8c/logger_8h_source.html#l00452">logger.h:452</a></div></div>
<div class="ttc" id="astobj2_8h_html_aaca5e8eac39a22f9da1c36fc6c922270"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a></div><div class="ttdeci">#define ao2_ref(o, delta)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l00464">astobj2.h:464</a></div></div>
<div class="ttc" id="structast__bridge__blob_html"><div class="ttname"><a href="../../d7/d01/structast__bridge__blob.html">ast_bridge_blob</a></div><div class="ttdoc">Blob of data associated with a bridge. </div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d4e/stasis__bridges_8h_source.html#l00123">stasis_bridges.h:123</a></div></div>
<div class="ttc" id="group__pjsip__threading_html_ga4f0a0629fa2ca084812772356d8e3565"><div class="ttname"><a href="../../d7/dfa/group__pjsip__threading.html#ga4f0a0629fa2ca084812772356d8e3565">ast_sip_push_task</a></div><div class="ttdeci">int ast_sip_push_task(struct ast_taskprocessor *serializer, int(*sip_task)(void *), void *task_data)</div><div class="ttdoc">Pushes a task to SIP servants. </div><div class="ttdef"><b>Definition:</b> <a href="../../de/d96/res__pjsip_8c_source.html#l05138">res_pjsip.c:5138</a></div></div>
<div class="ttc" id="stasis_8h_html_af6081f17431b81bc1a010b680517491d"><div class="ttname"><a href="../../dd/d79/stasis_8h.html#af6081f17431b81bc1a010b680517491d">stasis_message_data</a></div><div class="ttdeci">void * stasis_message_data(const struct stasis_message *msg)</div><div class="ttdoc">Get the data contained in a message. </div><div class="ttdef"><b>Definition:</b> <a href="../../d2/db9/stasis__message_8c_source.html#l00195">stasis_message.c:195</a></div></div>
<div class="ttc" id="stasis_8h_html_a3498301077e2005383f0d261c471388b"><div class="ttname"><a href="../../dd/d79/stasis_8h.html#a3498301077e2005383f0d261c471388b">stasis_unsubscribe</a></div><div class="ttdeci">struct stasis_subscription * stasis_unsubscribe(struct stasis_subscription *subscription)</div><div class="ttdoc">Cancel a subscription. </div><div class="ttdef"><b>Definition:</b> <a href="../../d0/df4/stasis_8c_source.html#l00973">stasis.c:973</a></div></div>
<div class="ttc" id="stasis_8h_html_a839350445aaa51cedf31f6daec933ee0"><div class="ttname"><a href="../../dd/d79/stasis_8h.html#a839350445aaa51cedf31f6daec933ee0">stasis_subscription_final_message</a></div><div class="ttdeci">int stasis_subscription_final_message(struct stasis_subscription *sub, struct stasis_message *msg)</div><div class="ttdoc">Determine whether a message is the final message to be received on a subscription. </div><div class="ttdef"><b>Definition:</b> <a href="../../d0/df4/stasis_8c_source.html#l01176">stasis.c:1176</a></div></div>
<div class="ttc" id="channel_8h_html_af476c537b29be3f29240489032f9db39"><div class="ttname"><a href="../../d5/d7b/channel_8h.html#af476c537b29be3f29240489032f9db39">ast_channel_unlock</a></div><div class="ttdeci">#define ast_channel_unlock(chan)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d7b/channel_8h_source.html#l02946">channel.h:2946</a></div></div>
<div class="ttc" id="res__pjsip__refer_8c_html_a89f2c1d96492b68d1399f20fc6eeb833"><div class="ttname"><a href="../../d1/d75/res__pjsip__refer_8c.html#a89f2c1d96492b68d1399f20fc6eeb833">refer_progress_notification_alloc</a></div><div class="ttdeci">static struct refer_progress_notification * refer_progress_notification_alloc(struct refer_progress *progress, int response, pjsip_evsub_state state)</div><div class="ttdoc">Allocator for REFER Progress notification structure. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d75/res__pjsip__refer_8c_source.html#l00094">res_pjsip_refer.c:94</a></div></div>
<div class="ttc" id="structtransfer__channel__data_html_a4eff08519948266efdd345aabe6ecbbb"><div class="ttname"><a href="../../da/d84/structtransfer__channel__data.html#a4eff08519948266efdd345aabe6ecbbb">transfer_channel_data::completed</a></div><div class="ttdeci">int completed</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d56/bridge_8h_source.html#l01141">bridge.h:1141</a></div></div>
<div class="ttc" id="res__pjsip__refer_8c_html_a5d2be3003a3c77234b90343bc0a43935"><div class="ttname"><a href="../../d1/d75/res__pjsip__refer_8c.html#a5d2be3003a3c77234b90343bc0a43935">refer_progress_notify</a></div><div class="ttdeci">static int refer_progress_notify(void *data)</div><div class="ttdoc">Serialized callback for subscription notification. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d75/res__pjsip__refer_8c_source.html#l00140">res_pjsip_refer.c:140</a></div></div>
<div class="ttc" id="astobj2_8h_html_a6321ee982370c55ab3c24c72c562cbdd"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#a6321ee982370c55ab3c24c72c562cbdd">ao2_cleanup</a></div><div class="ttdeci">#define ao2_cleanup(obj)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l01958">astobj2.h:1958</a></div></div>
<div class="ttc" id="channel_8h_html_a7ca2fda13b129a55c251b56729de285b"><div class="ttname"><a href="../../d5/d7b/channel_8h.html#a7ca2fda13b129a55c251b56729de285b">ast_channel_name</a></div><div class="ttdeci">const char * ast_channel_name(const struct ast_channel *chan)</div></div>
<div class="ttc" id="channel_8h_html_ac7e42045272530c8678418993e75fd56"><div class="ttname"><a href="../../d5/d7b/channel_8h.html#ac7e42045272530c8678418993e75fd56">ast_channel_get_by_name</a></div><div class="ttdeci">struct ast_channel * ast_channel_get_by_name(const char *name)</div><div class="ttdoc">Find a channel by name. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d28/channel_8c_source.html#l01454">channel.c:1454</a></div></div>
<div class="ttc" id="structrefer__progress_html"><div class="ttname"><a href="../../d0/d4b/structrefer__progress.html">refer_progress</a></div><div class="ttdoc">REFER Progress structure. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d75/res__pjsip__refer_8c_source.html#l00044">res_pjsip_refer.c:44</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a905b61e1a8539d48d654e13850396b06"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a905b61e1a8539d48d654e13850396b06">&#9670;&nbsp;</a></span>refer_progress_destroy()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void refer_progress_destroy </td>
          <td>(</td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>obj</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Destructor for REFER progress sutrcture. </p>

<p class="definition">Definition at line <a class="el" href="../../d1/d75/res__pjsip__refer_8c_source.html#l00349">349</a> of file <a class="el" href="../../d1/d75/res__pjsip__refer_8c_source.html">res_pjsip_refer.c</a>.</p>

<p class="reference">References <a class="el" href="../../d5/da5/astobj2_8h_source.html#l01958">ao2_cleanup</a>, <a class="el" href="../../d8/d8a/astmm_8h_source.html#l00182">ast_free</a>, <a class="el" href="../../de/d96/res__pjsip_8c_source.html#l05138">ast_sip_push_task()</a>, <a class="el" href="../../de/d96/res__pjsip_8c_source.html#l05321">ast_sip_thread_is_servant()</a>, <a class="el" href="../../d4/deb/taskprocessor_8c_source.html#l01109">ast_taskprocessor_unreference()</a>, <a class="el" href="../../d1/d75/res__pjsip__refer_8c_source.html#l00058">refer_progress::bridge_sub</a>, <a class="el" href="../../d1/d75/res__pjsip__refer_8c_source.html#l00048">refer_progress::dlg</a>, <a class="el" href="../../d1/d75/res__pjsip__refer_8c_source.html#l00343">dlg_releaser_task()</a>, <a class="el" href="../../dc/d7f/resample_8c_source.html#l00096">NULL</a>, <a class="el" href="../../d1/d75/res__pjsip__refer_8c_source.html#l00080">refer_progress_module</a>, <a class="el" href="../../d1/d75/res__pjsip__refer_8c_source.html#l00056">refer_progress::serializer</a>, <a class="el" href="../../d0/df4/stasis_8c_source.html#l00973">stasis_unsubscribe()</a>, <a class="el" href="../../d1/d75/res__pjsip__refer_8c_source.html#l00060">refer_progress::transfer_data</a>, and <a class="el" href="../../d1/d75/res__pjsip__refer_8c_source.html#l00062">refer_progress::transferee</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../d1/d75/res__pjsip__refer_8c_source.html#l00382">refer_progress_alloc()</a>.</p>
<div class="fragment"><div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;{</div><div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d0/d4b/structrefer__progress.html">refer_progress</a> *<a class="code" href="../../d1/df7/structprogress.html">progress</a> = obj;</div><div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;</div><div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;   <span class="keywordflow">if</span> (progress-&gt;<a class="code" href="../../d0/d4b/structrefer__progress.html#aab0602828a0c8ce025953da194f6681f">bridge_sub</a>) {</div><div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;      progress-&gt;<a class="code" href="../../d0/d4b/structrefer__progress.html#aab0602828a0c8ce025953da194f6681f">bridge_sub</a> = <a class="code" href="../../dd/d79/stasis_8h.html#a3498301077e2005383f0d261c471388b">stasis_unsubscribe</a>(progress-&gt;<a class="code" href="../../d0/d4b/structrefer__progress.html#aab0602828a0c8ce025953da194f6681f">bridge_sub</a>);</div><div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;   }</div><div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;</div><div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;   <span class="keywordflow">if</span> (progress-&gt;<a class="code" href="../../d0/d4b/structrefer__progress.html#a9d867cb404dff4c9d88a624e78a0e4d0">dlg</a>) {</div><div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;      <span class="comment">/*</span></div><div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;<span class="comment">       * Although the dlg session count was incremented in a pjsip servant</span></div><div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;<span class="comment">       * thread, there&#39;s no guarantee that the last thread to unref this progress</span></div><div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;<span class="comment">       * object was one.  Before we decrement, we need to make sure that this</span></div><div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;<span class="comment">       * is either a servant thread or that we push the decrement to a</span></div><div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;<span class="comment">       * serializer that is one.</span></div><div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;<span class="comment">       *</span></div><div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;<span class="comment">       * Because pjsip_dlg_dec_session requires the dialog lock, we don&#39;t want</span></div><div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;<span class="comment">       * to wait on the task to complete if we had to push it to a serializer.</span></div><div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;<span class="comment">       */</span></div><div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="../../d7/dfa/group__pjsip__threading.html#ga77c1258c88c9e98d907a2299934d8de1">ast_sip_thread_is_servant</a>()) {</div><div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;         pjsip_dlg_dec_session(progress-&gt;<a class="code" href="../../d0/d4b/structrefer__progress.html#a9d867cb404dff4c9d88a624e78a0e4d0">dlg</a>, &amp;<a class="code" href="../../d1/d75/res__pjsip__refer_8c.html#a43579c197f6efc45d0093d0ab8cba536">refer_progress_module</a>);</div><div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;      } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;         <a class="code" href="../../d7/dfa/group__pjsip__threading.html#ga4f0a0629fa2ca084812772356d8e3565">ast_sip_push_task</a>(<a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../d1/d75/res__pjsip__refer_8c.html#a449dd07f80afc1ecd81fffb290abca7b">dlg_releaser_task</a>, progress-&gt;<a class="code" href="../../d0/d4b/structrefer__progress.html#a9d867cb404dff4c9d88a624e78a0e4d0">dlg</a>);</div><div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;      }</div><div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;   }</div><div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;</div><div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#a6321ee982370c55ab3c24c72c562cbdd">ao2_cleanup</a>(progress-&gt;<a class="code" href="../../d0/d4b/structrefer__progress.html#a22abfff94132237b9bfefd9926961698">transfer_data</a>);</div><div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;</div><div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;   <a class="code" href="../../d8/d8a/astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(progress-&gt;<a class="code" href="../../d0/d4b/structrefer__progress.html#ad59ea5bda14dba853447d8de13813038">transferee</a>);</div><div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;   <a class="code" href="../../d0/d1e/taskprocessor_8h.html#a32492eb2480cb8c46ad669622cff8556">ast_taskprocessor_unreference</a>(progress-&gt;<a class="code" href="../../d0/d4b/structrefer__progress.html#ac23e23ba60f358de78a893d537c0afa4">serializer</a>);</div><div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;}</div><div class="ttc" id="structrefer__progress_html_ac23e23ba60f358de78a893d537c0afa4"><div class="ttname"><a href="../../d0/d4b/structrefer__progress.html#ac23e23ba60f358de78a893d537c0afa4">refer_progress::serializer</a></div><div class="ttdeci">struct ast_taskprocessor * serializer</div><div class="ttdoc">Serializer for notifications. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d75/res__pjsip__refer_8c_source.html#l00056">res_pjsip_refer.c:56</a></div></div>
<div class="ttc" id="structrefer__progress_html_aab0602828a0c8ce025953da194f6681f"><div class="ttname"><a href="../../d0/d4b/structrefer__progress.html#aab0602828a0c8ce025953da194f6681f">refer_progress::bridge_sub</a></div><div class="ttdeci">struct stasis_subscription * bridge_sub</div><div class="ttdoc">Stasis subscription for bridge events. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d75/res__pjsip__refer_8c_source.html#l00058">res_pjsip_refer.c:58</a></div></div>
<div class="ttc" id="structrefer__progress_html_a22abfff94132237b9bfefd9926961698"><div class="ttname"><a href="../../d0/d4b/structrefer__progress.html#a22abfff94132237b9bfefd9926961698">refer_progress::transfer_data</a></div><div class="ttdeci">struct transfer_channel_data * transfer_data</div><div class="ttdoc">Reference to transfer_channel_data related to the refer. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d75/res__pjsip__refer_8c_source.html#l00060">res_pjsip_refer.c:60</a></div></div>
<div class="ttc" id="res__pjsip__refer_8c_html_a449dd07f80afc1ecd81fffb290abca7b"><div class="ttname"><a href="../../d1/d75/res__pjsip__refer_8c.html#a449dd07f80afc1ecd81fffb290abca7b">dlg_releaser_task</a></div><div class="ttdeci">static int dlg_releaser_task(void *data)</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d75/res__pjsip__refer_8c_source.html#l00343">res_pjsip_refer.c:343</a></div></div>
<div class="ttc" id="resample_8c_html_a070d2ce7b6bb7e5c05602aa8c308d0c4"><div class="ttname"><a href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a></div><div class="ttdeci">#define NULL</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d7f/resample_8c_source.html#l00096">resample.c:96</a></div></div>
<div class="ttc" id="structprogress_html"><div class="ttname"><a href="../../d1/df7/structprogress.html">progress</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d3b/dsp_8c_source.html#l00117">dsp.c:117</a></div></div>
<div class="ttc" id="structrefer__progress_html_ad59ea5bda14dba853447d8de13813038"><div class="ttname"><a href="../../d0/d4b/structrefer__progress.html#ad59ea5bda14dba853447d8de13813038">refer_progress::transferee</a></div><div class="ttdeci">char * transferee</div><div class="ttdoc">Uniqueid of transferee channel. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d75/res__pjsip__refer_8c_source.html#l00062">res_pjsip_refer.c:62</a></div></div>
<div class="ttc" id="res__pjsip__refer_8c_html_a43579c197f6efc45d0093d0ab8cba536"><div class="ttname"><a href="../../d1/d75/res__pjsip__refer_8c.html#a43579c197f6efc45d0093d0ab8cba536">refer_progress_module</a></div><div class="ttdeci">static pjsip_module refer_progress_module</div><div class="ttdoc">REFER Progress module, used to attach REFER progress structure to subscriptions. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d75/res__pjsip__refer_8c_source.html#l00080">res_pjsip_refer.c:80</a></div></div>
<div class="ttc" id="group__pjsip__threading_html_ga77c1258c88c9e98d907a2299934d8de1"><div class="ttname"><a href="../../d7/dfa/group__pjsip__threading.html#ga77c1258c88c9e98d907a2299934d8de1">ast_sip_thread_is_servant</a></div><div class="ttdeci">int ast_sip_thread_is_servant(void)</div><div class="ttdoc">Determine if the current thread is a SIP servant thread. </div><div class="ttdef"><b>Definition:</b> <a href="../../de/d96/res__pjsip_8c_source.html#l05321">res_pjsip.c:5321</a></div></div>
<div class="ttc" id="group__pjsip__threading_html_ga4f0a0629fa2ca084812772356d8e3565"><div class="ttname"><a href="../../d7/dfa/group__pjsip__threading.html#ga4f0a0629fa2ca084812772356d8e3565">ast_sip_push_task</a></div><div class="ttdeci">int ast_sip_push_task(struct ast_taskprocessor *serializer, int(*sip_task)(void *), void *task_data)</div><div class="ttdoc">Pushes a task to SIP servants. </div><div class="ttdef"><b>Definition:</b> <a href="../../de/d96/res__pjsip_8c_source.html#l05138">res_pjsip.c:5138</a></div></div>
<div class="ttc" id="stasis_8h_html_a3498301077e2005383f0d261c471388b"><div class="ttname"><a href="../../dd/d79/stasis_8h.html#a3498301077e2005383f0d261c471388b">stasis_unsubscribe</a></div><div class="ttdeci">struct stasis_subscription * stasis_unsubscribe(struct stasis_subscription *subscription)</div><div class="ttdoc">Cancel a subscription. </div><div class="ttdef"><b>Definition:</b> <a href="../../d0/df4/stasis_8c_source.html#l00973">stasis.c:973</a></div></div>
<div class="ttc" id="astmm_8h_html_a402072d6789f6ed9e3a81da27504127e"><div class="ttname"><a href="../../d8/d8a/astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a></div><div class="ttdeci">#define ast_free(a)</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d8a/astmm_8h_source.html#l00182">astmm.h:182</a></div></div>
<div class="ttc" id="astobj2_8h_html_a6321ee982370c55ab3c24c72c562cbdd"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#a6321ee982370c55ab3c24c72c562cbdd">ao2_cleanup</a></div><div class="ttdeci">#define ao2_cleanup(obj)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l01958">astobj2.h:1958</a></div></div>
<div class="ttc" id="taskprocessor_8h_html_a32492eb2480cb8c46ad669622cff8556"><div class="ttname"><a href="../../d0/d1e/taskprocessor_8h.html#a32492eb2480cb8c46ad669622cff8556">ast_taskprocessor_unreference</a></div><div class="ttdeci">void * ast_taskprocessor_unreference(struct ast_taskprocessor *tps)</div><div class="ttdoc">Unreference the specified taskprocessor and its reference count will decrement. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/deb/taskprocessor_8c_source.html#l01109">taskprocessor.c:1109</a></div></div>
<div class="ttc" id="structrefer__progress_html_a9d867cb404dff4c9d88a624e78a0e4d0"><div class="ttname"><a href="../../d0/d4b/structrefer__progress.html#a9d867cb404dff4c9d88a624e78a0e4d0">refer_progress::dlg</a></div><div class="ttdeci">pjsip_dialog * dlg</div><div class="ttdoc">Dialog for subscription. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d75/res__pjsip__refer_8c_source.html#l00048">res_pjsip_refer.c:48</a></div></div>
<div class="ttc" id="structrefer__progress_html"><div class="ttname"><a href="../../d0/d4b/structrefer__progress.html">refer_progress</a></div><div class="ttdoc">REFER Progress structure. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d75/res__pjsip__refer_8c_source.html#l00044">res_pjsip_refer.c:44</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a257bc682830b3e4df38b8d5d413d588c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a257bc682830b3e4df38b8d5d413d588c">&#9670;&nbsp;</a></span>refer_progress_framehook()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static struct <a class="el" href="../../d0/d99/structast__frame.html">ast_frame</a>* refer_progress_framehook </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="../../df/d3c/structast__channel.html">ast_channel</a> *&#160;</td>
          <td class="paramname"><em>chan</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="../../d0/d99/structast__frame.html">ast_frame</a> *&#160;</td>
          <td class="paramname"><em>f</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">enum <a class="el" href="../../db/d3c/framehook_8h.html#a54250544f50efde9156d2341e8da0614">ast_framehook_event</a>&#160;</td>
          <td class="paramname"><em>event</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>data</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Progress monitoring frame hook - examines frames to determine state of transfer. </p>

<p class="definition">Definition at line <a class="el" href="../../d1/d75/res__pjsip__refer_8c_source.html#l00236">236</a> of file <a class="el" href="../../d1/d75/res__pjsip__refer_8c_source.html">res_pjsip_refer.c</a>.</p>

<p class="reference">References <a class="el" href="../../d5/da5/astobj2_8h_source.html#l01958">ao2_cleanup</a>, <a class="el" href="../../d5/d7b/channel_8h.html#a7ca2fda13b129a55c251b56729de285b">ast_channel_name()</a>, <a class="el" href="../../d6/d66/include_2asterisk_2frame_8h_source.html#l00281">AST_CONTROL_ANSWER</a>, <a class="el" href="../../d6/d66/include_2asterisk_2frame_8h_source.html#l00282">AST_CONTROL_BUSY</a>, <a class="el" href="../../d6/d66/include_2asterisk_2frame_8h_source.html#l00285">AST_CONTROL_CONGESTION</a>, <a class="el" href="../../d6/d66/include_2asterisk_2frame_8h_source.html#l00292">AST_CONTROL_PROCEEDING</a>, <a class="el" href="../../d6/d66/include_2asterisk_2frame_8h_source.html#l00291">AST_CONTROL_PROGRESS</a>, <a class="el" href="../../d6/d66/include_2asterisk_2frame_8h_source.html#l00279">AST_CONTROL_RING</a>, <a class="el" href="../../d6/d66/include_2asterisk_2frame_8h_source.html#l00280">AST_CONTROL_RINGING</a>, <a class="el" href="../../d1/d8c/logger_8h_source.html#l00452">ast_debug</a>, <a class="el" href="../../d6/d66/include_2asterisk_2frame_8h_source.html#l00105">AST_FRAME_CONTROL</a>, <a class="el" href="../../d6/d66/include_2asterisk_2frame_8h_source.html#l00101">AST_FRAME_VOICE</a>, <a class="el" href="../../da/dac/framehook_8c_source.html#l00177">ast_framehook_detach()</a>, <a class="el" href="../../db/d3c/framehook_8h_source.html#l00153">AST_FRAMEHOOK_EVENT_WRITE</a>, <a class="el" href="../../de/d96/res__pjsip_8c_source.html#l05138">ast_sip_push_task()</a>, <a class="el" href="../../d4/d56/bridge_8h_source.html#l01141">transfer_channel_data::completed</a>, <a class="el" href="../../d1/d75/res__pjsip__refer_8c_source.html#l00052">refer_progress::framehook</a>, <a class="el" href="../../d6/d66/include_2asterisk_2frame_8h_source.html#l00167">ast_frame::frametype</a>, <a class="el" href="../../d6/d66/include_2asterisk_2frame_8h_source.html#l00152">ast_frame_subclass::integer</a>, <a class="el" href="../../dc/d7f/resample_8c_source.html#l00096">NULL</a>, <a class="el" href="../../d1/d75/res__pjsip__refer_8c_source.html#l00094">refer_progress_notification_alloc()</a>, <a class="el" href="../../d1/d75/res__pjsip__refer_8c_source.html#l00140">refer_progress_notify()</a>, <a class="el" href="../../d1/d75/res__pjsip__refer_8c_source.html#l00056">refer_progress::serializer</a>, <a class="el" href="../../d1/d75/res__pjsip__refer_8c_source.html#l00076">refer_progress_notification::state</a>, <a class="el" href="../../d1/d75/res__pjsip__refer_8c_source.html#l00054">refer_progress::subclass</a>, <a class="el" href="../../d6/d66/include_2asterisk_2frame_8h_source.html#l00169">ast_frame::subclass</a>, and <a class="el" href="../../d1/d75/res__pjsip__refer_8c_source.html#l00060">refer_progress::transfer_data</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../d1/d75/res__pjsip__refer_8c_source.html#l00625">refer_blind_callback()</a>.</p>
<div class="fragment"><div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;{</div><div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d0/d4b/structrefer__progress.html">refer_progress</a> *<a class="code" href="../../d1/df7/structprogress.html">progress</a> = data;</div><div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d3/dff/structrefer__progress__notification.html">refer_progress_notification</a> *notification = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;</div><div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;   <span class="comment">/* We only care about frames *to* the channel */</span></div><div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;   <span class="keywordflow">if</span> (!f || (<a class="code" href="../../df/d7d/structevent.html">event</a> != <a class="code" href="../../db/d3c/framehook_8h.html#a54250544f50efde9156d2341e8da0614a8e96ab8d6971c2abf694c55ed52653d9">AST_FRAMEHOOK_EVENT_WRITE</a>)) {</div><div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;      <span class="keywordflow">return</span> f;</div><div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;   }</div><div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;</div><div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;   <span class="comment">/* If the completed flag hasn&#39;t been raised, skip this pass. */</span></div><div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;   <span class="keywordflow">if</span> (!progress-&gt;<a class="code" href="../../d0/d4b/structrefer__progress.html#a22abfff94132237b9bfefd9926961698">transfer_data</a>-&gt;<a class="code" href="../../da/d84/structtransfer__channel__data.html#a4eff08519948266efdd345aabe6ecbbb">completed</a>) {</div><div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;      <span class="keywordflow">return</span> f;</div><div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;   }</div><div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;</div><div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;   <span class="comment">/* Determine the state of the REFER based on the control frames (or voice frames) passing */</span></div><div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;   <span class="keywordflow">if</span> (f-&gt;<a class="code" href="../../d0/d99/structast__frame.html#a6937b93c56cb473b547eda454dca7b4c">frametype</a> == <a class="code" href="../../d6/d66/include_2asterisk_2frame_8h.html#ae2e1a9c4e048da387b761f619312d6e0aa457fe7005f11bb7b21453f9bb4caa8f">AST_FRAME_VOICE</a> &amp;&amp; !progress-&gt;<a class="code" href="../../d0/d4b/structrefer__progress.html#a8690cd2e4b0ef8477711b72a120ae086">subclass</a>) {</div><div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;      <span class="comment">/* Media is passing without progress, this means the call has been answered */</span></div><div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;      progress-&gt;<a class="code" href="../../d0/d4b/structrefer__progress.html#a8690cd2e4b0ef8477711b72a120ae086">subclass</a> = <a class="code" href="../../d6/d66/include_2asterisk_2frame_8h.html#aedda41918e992000fe921f8f7363b390a9e3135920bd5bdbfd8c57fdaaa6b1dbe">AST_CONTROL_ANSWER</a>;</div><div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;      notification = <a class="code" href="../../d1/d75/res__pjsip__refer_8c.html#a89f2c1d96492b68d1399f20fc6eeb833">refer_progress_notification_alloc</a>(progress, 200, PJSIP_EVSUB_STATE_TERMINATED);</div><div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;   } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (f-&gt;<a class="code" href="../../d0/d99/structast__frame.html#a6937b93c56cb473b547eda454dca7b4c">frametype</a> == <a class="code" href="../../d6/d66/include_2asterisk_2frame_8h.html#ae2e1a9c4e048da387b761f619312d6e0ae1dae388b0d70825876e137ae95bb0c1">AST_FRAME_CONTROL</a>) {</div><div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;      <span class="comment">/* Based on the control frame being written we can send a NOTIFY advising of the progress */</span></div><div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;      <span class="keywordflow">if</span> ((f-&gt;<a class="code" href="../../d0/d99/structast__frame.html#a27237c48fdcd22556401f20c693811db">subclass</a>.<a class="code" href="../../d1/d9f/structast__frame__subclass.html#adece183191b0e700e039e59101e06105">integer</a> == <a class="code" href="../../d6/d66/include_2asterisk_2frame_8h.html#aedda41918e992000fe921f8f7363b390a00675bfb8c64b2be86297fe4cba51fa2">AST_CONTROL_RING</a>) || (f-&gt;<a class="code" href="../../d0/d99/structast__frame.html#a27237c48fdcd22556401f20c693811db">subclass</a>.<a class="code" href="../../d1/d9f/structast__frame__subclass.html#adece183191b0e700e039e59101e06105">integer</a> == <a class="code" href="../../d6/d66/include_2asterisk_2frame_8h.html#aedda41918e992000fe921f8f7363b390aa5814e690c23b590bcd4eb43535907a1">AST_CONTROL_RINGING</a>)) {</div><div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;         <span class="comment">/* Don&#39;t set progress-&gt;subclass; an ANSWER can still follow */</span></div><div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;         notification = <a class="code" href="../../d1/d75/res__pjsip__refer_8c.html#a89f2c1d96492b68d1399f20fc6eeb833">refer_progress_notification_alloc</a>(progress, 180, PJSIP_EVSUB_STATE_ACTIVE);</div><div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;      } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (f-&gt;<a class="code" href="../../d0/d99/structast__frame.html#a27237c48fdcd22556401f20c693811db">subclass</a>.<a class="code" href="../../d1/d9f/structast__frame__subclass.html#adece183191b0e700e039e59101e06105">integer</a> == <a class="code" href="../../d6/d66/include_2asterisk_2frame_8h.html#aedda41918e992000fe921f8f7363b390a387635982df3d2edb669a1eece92c875">AST_CONTROL_BUSY</a>) {</div><div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;         progress-&gt;<a class="code" href="../../d0/d4b/structrefer__progress.html#a8690cd2e4b0ef8477711b72a120ae086">subclass</a> = f-&gt;<a class="code" href="../../d0/d99/structast__frame.html#a27237c48fdcd22556401f20c693811db">subclass</a>.<a class="code" href="../../d1/d9f/structast__frame__subclass.html#adece183191b0e700e039e59101e06105">integer</a>;</div><div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;         notification = <a class="code" href="../../d1/d75/res__pjsip__refer_8c.html#a89f2c1d96492b68d1399f20fc6eeb833">refer_progress_notification_alloc</a>(progress, 486, PJSIP_EVSUB_STATE_TERMINATED);</div><div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;      } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (f-&gt;<a class="code" href="../../d0/d99/structast__frame.html#a27237c48fdcd22556401f20c693811db">subclass</a>.<a class="code" href="../../d1/d9f/structast__frame__subclass.html#adece183191b0e700e039e59101e06105">integer</a> == <a class="code" href="../../d6/d66/include_2asterisk_2frame_8h.html#aedda41918e992000fe921f8f7363b390a850bb06a1702741c93a3fd67cc9637ab">AST_CONTROL_CONGESTION</a>) {</div><div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;         progress-&gt;<a class="code" href="../../d0/d4b/structrefer__progress.html#a8690cd2e4b0ef8477711b72a120ae086">subclass</a> = f-&gt;<a class="code" href="../../d0/d99/structast__frame.html#a27237c48fdcd22556401f20c693811db">subclass</a>.<a class="code" href="../../d1/d9f/structast__frame__subclass.html#adece183191b0e700e039e59101e06105">integer</a>;</div><div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;         notification = <a class="code" href="../../d1/d75/res__pjsip__refer_8c.html#a89f2c1d96492b68d1399f20fc6eeb833">refer_progress_notification_alloc</a>(progress, 503, PJSIP_EVSUB_STATE_TERMINATED);</div><div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;      } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (f-&gt;<a class="code" href="../../d0/d99/structast__frame.html#a27237c48fdcd22556401f20c693811db">subclass</a>.<a class="code" href="../../d1/d9f/structast__frame__subclass.html#adece183191b0e700e039e59101e06105">integer</a> == <a class="code" href="../../d6/d66/include_2asterisk_2frame_8h.html#aedda41918e992000fe921f8f7363b390a1a461c5e737ed6ed7c8cb0f78557a6fd">AST_CONTROL_PROGRESS</a>) {</div><div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;         <span class="comment">/* Don&#39;t set progress-&gt;subclass; an ANSWER can still follow */</span></div><div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;         notification = <a class="code" href="../../d1/d75/res__pjsip__refer_8c.html#a89f2c1d96492b68d1399f20fc6eeb833">refer_progress_notification_alloc</a>(progress, 183, PJSIP_EVSUB_STATE_ACTIVE);</div><div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;      } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (f-&gt;<a class="code" href="../../d0/d99/structast__frame.html#a27237c48fdcd22556401f20c693811db">subclass</a>.<a class="code" href="../../d1/d9f/structast__frame__subclass.html#adece183191b0e700e039e59101e06105">integer</a> == <a class="code" href="../../d6/d66/include_2asterisk_2frame_8h.html#aedda41918e992000fe921f8f7363b390a50b7fe33bba67b74dd7b746539e81000">AST_CONTROL_PROCEEDING</a>) {</div><div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;         <span class="comment">/* Don&#39;t set progress-&gt;subclass; an ANSWER can still follow */</span></div><div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;         notification = <a class="code" href="../../d1/d75/res__pjsip__refer_8c.html#a89f2c1d96492b68d1399f20fc6eeb833">refer_progress_notification_alloc</a>(progress, 100, PJSIP_EVSUB_STATE_ACTIVE);</div><div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;      } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (f-&gt;<a class="code" href="../../d0/d99/structast__frame.html#a27237c48fdcd22556401f20c693811db">subclass</a>.<a class="code" href="../../d1/d9f/structast__frame__subclass.html#adece183191b0e700e039e59101e06105">integer</a> == <a class="code" href="../../d6/d66/include_2asterisk_2frame_8h.html#aedda41918e992000fe921f8f7363b390a9e3135920bd5bdbfd8c57fdaaa6b1dbe">AST_CONTROL_ANSWER</a>) {</div><div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;         progress-&gt;<a class="code" href="../../d0/d4b/structrefer__progress.html#a8690cd2e4b0ef8477711b72a120ae086">subclass</a> = f-&gt;<a class="code" href="../../d0/d99/structast__frame.html#a27237c48fdcd22556401f20c693811db">subclass</a>.<a class="code" href="../../d1/d9f/structast__frame__subclass.html#adece183191b0e700e039e59101e06105">integer</a>;</div><div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;         notification = <a class="code" href="../../d1/d75/res__pjsip__refer_8c.html#a89f2c1d96492b68d1399f20fc6eeb833">refer_progress_notification_alloc</a>(progress, 200, PJSIP_EVSUB_STATE_TERMINATED);</div><div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;      }</div><div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;   }</div><div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;</div><div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;   <span class="comment">/* If a notification is due to be sent push it to the thread pool */</span></div><div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;   <span class="keywordflow">if</span> (notification) {</div><div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;      <span class="comment">/* If the subscription is being terminated we don&#39;t need the frame hook any longer */</span></div><div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;      <span class="keywordflow">if</span> (notification-&gt;<a class="code" href="../../d3/dff/structrefer__progress__notification.html#a06eab984618d6a85fadc73dfb41f5c69">state</a> == PJSIP_EVSUB_STATE_TERMINATED) {</div><div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;         <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(3, <span class="stringliteral">&quot;Detaching REFER progress monitoring hook from &#39;%s&#39; as subscription is being terminated\n&quot;</span>,</div><div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;            <a class="code" href="../../d5/d7b/channel_8h.html#a7ca2fda13b129a55c251b56729de285b">ast_channel_name</a>(chan));</div><div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;         <a class="code" href="../../db/d3c/framehook_8h.html#a6e116259cae8c1e5cca074d05f0a3475">ast_framehook_detach</a>(chan, progress-&gt;<a class="code" href="../../d0/d4b/structrefer__progress.html#ae25f61b5aa8877dfb396fd378c6b7722">framehook</a>);</div><div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;      }</div><div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;</div><div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="../../d7/dfa/group__pjsip__threading.html#ga4f0a0629fa2ca084812772356d8e3565">ast_sip_push_task</a>(progress-&gt;<a class="code" href="../../d0/d4b/structrefer__progress.html#ac23e23ba60f358de78a893d537c0afa4">serializer</a>, <a class="code" href="../../d1/d75/res__pjsip__refer_8c.html#a5d2be3003a3c77234b90343bc0a43935">refer_progress_notify</a>, notification)) {</div><div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;         <a class="code" href="../../d5/da5/astobj2_8h.html#a6321ee982370c55ab3c24c72c562cbdd">ao2_cleanup</a>(notification);</div><div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;      }</div><div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;   }</div><div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;</div><div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;   <span class="keywordflow">return</span> f;</div><div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;}</div><div class="ttc" id="structrefer__progress_html_a8690cd2e4b0ef8477711b72a120ae086"><div class="ttname"><a href="../../d0/d4b/structrefer__progress.html#a8690cd2e4b0ef8477711b72a120ae086">refer_progress::subclass</a></div><div class="ttdeci">int subclass</div><div class="ttdoc">Last received subclass in frame hook. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d75/res__pjsip__refer_8c_source.html#l00054">res_pjsip_refer.c:54</a></div></div>
<div class="ttc" id="structrefer__progress_html_ac23e23ba60f358de78a893d537c0afa4"><div class="ttname"><a href="../../d0/d4b/structrefer__progress.html#ac23e23ba60f358de78a893d537c0afa4">refer_progress::serializer</a></div><div class="ttdeci">struct ast_taskprocessor * serializer</div><div class="ttdoc">Serializer for notifications. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d75/res__pjsip__refer_8c_source.html#l00056">res_pjsip_refer.c:56</a></div></div>
<div class="ttc" id="structrefer__progress_html_a22abfff94132237b9bfefd9926961698"><div class="ttname"><a href="../../d0/d4b/structrefer__progress.html#a22abfff94132237b9bfefd9926961698">refer_progress::transfer_data</a></div><div class="ttdeci">struct transfer_channel_data * transfer_data</div><div class="ttdoc">Reference to transfer_channel_data related to the refer. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d75/res__pjsip__refer_8c_source.html#l00060">res_pjsip_refer.c:60</a></div></div>
<div class="ttc" id="include_2asterisk_2frame_8h_html_aedda41918e992000fe921f8f7363b390a9e3135920bd5bdbfd8c57fdaaa6b1dbe"><div class="ttname"><a href="../../d6/d66/include_2asterisk_2frame_8h.html#aedda41918e992000fe921f8f7363b390a9e3135920bd5bdbfd8c57fdaaa6b1dbe">AST_CONTROL_ANSWER</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d66/include_2asterisk_2frame_8h_source.html#l00281">include/asterisk/frame.h:281</a></div></div>
<div class="ttc" id="include_2asterisk_2frame_8h_html_aedda41918e992000fe921f8f7363b390a00675bfb8c64b2be86297fe4cba51fa2"><div class="ttname"><a href="../../d6/d66/include_2asterisk_2frame_8h.html#aedda41918e992000fe921f8f7363b390a00675bfb8c64b2be86297fe4cba51fa2">AST_CONTROL_RING</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d66/include_2asterisk_2frame_8h_source.html#l00279">include/asterisk/frame.h:279</a></div></div>
<div class="ttc" id="framehook_8h_html_a6e116259cae8c1e5cca074d05f0a3475"><div class="ttname"><a href="../../db/d3c/framehook_8h.html#a6e116259cae8c1e5cca074d05f0a3475">ast_framehook_detach</a></div><div class="ttdeci">int ast_framehook_detach(struct ast_channel *chan, int framehook_id)</div><div class="ttdoc">Detach an framehook from a channel. </div><div class="ttdef"><b>Definition:</b> <a href="../../da/dac/framehook_8c_source.html#l00177">framehook.c:177</a></div></div>
<div class="ttc" id="include_2asterisk_2frame_8h_html_ae2e1a9c4e048da387b761f619312d6e0aa457fe7005f11bb7b21453f9bb4caa8f"><div class="ttname"><a href="../../d6/d66/include_2asterisk_2frame_8h.html#ae2e1a9c4e048da387b761f619312d6e0aa457fe7005f11bb7b21453f9bb4caa8f">AST_FRAME_VOICE</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d66/include_2asterisk_2frame_8h_source.html#l00101">include/asterisk/frame.h:101</a></div></div>
<div class="ttc" id="structrefer__progress_html_ae25f61b5aa8877dfb396fd378c6b7722"><div class="ttname"><a href="../../d0/d4b/structrefer__progress.html#ae25f61b5aa8877dfb396fd378c6b7722">refer_progress::framehook</a></div><div class="ttdeci">int framehook</div><div class="ttdoc">Frame hook for monitoring REFER progress. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d75/res__pjsip__refer_8c_source.html#l00052">res_pjsip_refer.c:52</a></div></div>
<div class="ttc" id="structrefer__progress__notification_html"><div class="ttname"><a href="../../d3/dff/structrefer__progress__notification.html">refer_progress_notification</a></div><div class="ttdoc">REFER Progress notification structure. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d75/res__pjsip__refer_8c_source.html#l00070">res_pjsip_refer.c:70</a></div></div>
<div class="ttc" id="structevent_html"><div class="ttname"><a href="../../df/d7d/structevent.html">event</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d2/d4d/astman_8c_source.html#l00222">astman.c:222</a></div></div>
<div class="ttc" id="include_2asterisk_2frame_8h_html_aedda41918e992000fe921f8f7363b390a387635982df3d2edb669a1eece92c875"><div class="ttname"><a href="../../d6/d66/include_2asterisk_2frame_8h.html#aedda41918e992000fe921f8f7363b390a387635982df3d2edb669a1eece92c875">AST_CONTROL_BUSY</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d66/include_2asterisk_2frame_8h_source.html#l00282">include/asterisk/frame.h:282</a></div></div>
<div class="ttc" id="resample_8c_html_a070d2ce7b6bb7e5c05602aa8c308d0c4"><div class="ttname"><a href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a></div><div class="ttdeci">#define NULL</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d7f/resample_8c_source.html#l00096">resample.c:96</a></div></div>
<div class="ttc" id="structprogress_html"><div class="ttname"><a href="../../d1/df7/structprogress.html">progress</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d3b/dsp_8c_source.html#l00117">dsp.c:117</a></div></div>
<div class="ttc" id="structast__frame_html_a27237c48fdcd22556401f20c693811db"><div class="ttname"><a href="../../d0/d99/structast__frame.html#a27237c48fdcd22556401f20c693811db">ast_frame::subclass</a></div><div class="ttdeci">struct ast_frame_subclass subclass</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d66/include_2asterisk_2frame_8h_source.html#l00169">include/asterisk/frame.h:169</a></div></div>
<div class="ttc" id="include_2asterisk_2frame_8h_html_aedda41918e992000fe921f8f7363b390a50b7fe33bba67b74dd7b746539e81000"><div class="ttname"><a href="../../d6/d66/include_2asterisk_2frame_8h.html#aedda41918e992000fe921f8f7363b390a50b7fe33bba67b74dd7b746539e81000">AST_CONTROL_PROCEEDING</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d66/include_2asterisk_2frame_8h_source.html#l00292">include/asterisk/frame.h:292</a></div></div>
<div class="ttc" id="structast__frame__subclass_html_adece183191b0e700e039e59101e06105"><div class="ttname"><a href="../../d1/d9f/structast__frame__subclass.html#adece183191b0e700e039e59101e06105">ast_frame_subclass::integer</a></div><div class="ttdeci">int integer</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d66/include_2asterisk_2frame_8h_source.html#l00152">include/asterisk/frame.h:152</a></div></div>
<div class="ttc" id="logger_8h_html_a3f248112c8d6ce7e3959aa723dade648"><div class="ttname"><a href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a></div><div class="ttdeci">#define ast_debug(level,...)</div><div class="ttdoc">Log a DEBUG message. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d8c/logger_8h_source.html#l00452">logger.h:452</a></div></div>
<div class="ttc" id="framehook_8h_html_a54250544f50efde9156d2341e8da0614a8e96ab8d6971c2abf694c55ed52653d9"><div class="ttname"><a href="../../db/d3c/framehook_8h.html#a54250544f50efde9156d2341e8da0614a8e96ab8d6971c2abf694c55ed52653d9">AST_FRAMEHOOK_EVENT_WRITE</a></div><div class="ttdef"><b>Definition:</b> <a href="../../db/d3c/framehook_8h_source.html#l00153">framehook.h:153</a></div></div>
<div class="ttc" id="include_2asterisk_2frame_8h_html_ae2e1a9c4e048da387b761f619312d6e0ae1dae388b0d70825876e137ae95bb0c1"><div class="ttname"><a href="../../d6/d66/include_2asterisk_2frame_8h.html#ae2e1a9c4e048da387b761f619312d6e0ae1dae388b0d70825876e137ae95bb0c1">AST_FRAME_CONTROL</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d66/include_2asterisk_2frame_8h_source.html#l00105">include/asterisk/frame.h:105</a></div></div>
<div class="ttc" id="group__pjsip__threading_html_ga4f0a0629fa2ca084812772356d8e3565"><div class="ttname"><a href="../../d7/dfa/group__pjsip__threading.html#ga4f0a0629fa2ca084812772356d8e3565">ast_sip_push_task</a></div><div class="ttdeci">int ast_sip_push_task(struct ast_taskprocessor *serializer, int(*sip_task)(void *), void *task_data)</div><div class="ttdoc">Pushes a task to SIP servants. </div><div class="ttdef"><b>Definition:</b> <a href="../../de/d96/res__pjsip_8c_source.html#l05138">res_pjsip.c:5138</a></div></div>
<div class="ttc" id="res__pjsip__refer_8c_html_a89f2c1d96492b68d1399f20fc6eeb833"><div class="ttname"><a href="../../d1/d75/res__pjsip__refer_8c.html#a89f2c1d96492b68d1399f20fc6eeb833">refer_progress_notification_alloc</a></div><div class="ttdeci">static struct refer_progress_notification * refer_progress_notification_alloc(struct refer_progress *progress, int response, pjsip_evsub_state state)</div><div class="ttdoc">Allocator for REFER Progress notification structure. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d75/res__pjsip__refer_8c_source.html#l00094">res_pjsip_refer.c:94</a></div></div>
<div class="ttc" id="include_2asterisk_2frame_8h_html_aedda41918e992000fe921f8f7363b390a1a461c5e737ed6ed7c8cb0f78557a6fd"><div class="ttname"><a href="../../d6/d66/include_2asterisk_2frame_8h.html#aedda41918e992000fe921f8f7363b390a1a461c5e737ed6ed7c8cb0f78557a6fd">AST_CONTROL_PROGRESS</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d66/include_2asterisk_2frame_8h_source.html#l00291">include/asterisk/frame.h:291</a></div></div>
<div class="ttc" id="structtransfer__channel__data_html_a4eff08519948266efdd345aabe6ecbbb"><div class="ttname"><a href="../../da/d84/structtransfer__channel__data.html#a4eff08519948266efdd345aabe6ecbbb">transfer_channel_data::completed</a></div><div class="ttdeci">int completed</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d56/bridge_8h_source.html#l01141">bridge.h:1141</a></div></div>
<div class="ttc" id="res__pjsip__refer_8c_html_a5d2be3003a3c77234b90343bc0a43935"><div class="ttname"><a href="../../d1/d75/res__pjsip__refer_8c.html#a5d2be3003a3c77234b90343bc0a43935">refer_progress_notify</a></div><div class="ttdeci">static int refer_progress_notify(void *data)</div><div class="ttdoc">Serialized callback for subscription notification. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d75/res__pjsip__refer_8c_source.html#l00140">res_pjsip_refer.c:140</a></div></div>
<div class="ttc" id="astobj2_8h_html_a6321ee982370c55ab3c24c72c562cbdd"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#a6321ee982370c55ab3c24c72c562cbdd">ao2_cleanup</a></div><div class="ttdeci">#define ao2_cleanup(obj)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l01958">astobj2.h:1958</a></div></div>
<div class="ttc" id="channel_8h_html_a7ca2fda13b129a55c251b56729de285b"><div class="ttname"><a href="../../d5/d7b/channel_8h.html#a7ca2fda13b129a55c251b56729de285b">ast_channel_name</a></div><div class="ttdeci">const char * ast_channel_name(const struct ast_channel *chan)</div></div>
<div class="ttc" id="include_2asterisk_2frame_8h_html_aedda41918e992000fe921f8f7363b390aa5814e690c23b590bcd4eb43535907a1"><div class="ttname"><a href="../../d6/d66/include_2asterisk_2frame_8h.html#aedda41918e992000fe921f8f7363b390aa5814e690c23b590bcd4eb43535907a1">AST_CONTROL_RINGING</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d66/include_2asterisk_2frame_8h_source.html#l00280">include/asterisk/frame.h:280</a></div></div>
<div class="ttc" id="structast__frame_html_a6937b93c56cb473b547eda454dca7b4c"><div class="ttname"><a href="../../d0/d99/structast__frame.html#a6937b93c56cb473b547eda454dca7b4c">ast_frame::frametype</a></div><div class="ttdeci">enum ast_frame_type frametype</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d66/include_2asterisk_2frame_8h_source.html#l00167">include/asterisk/frame.h:167</a></div></div>
<div class="ttc" id="structrefer__progress__notification_html_a06eab984618d6a85fadc73dfb41f5c69"><div class="ttname"><a href="../../d3/dff/structrefer__progress__notification.html#a06eab984618d6a85fadc73dfb41f5c69">refer_progress_notification::state</a></div><div class="ttdeci">pjsip_evsub_state state</div><div class="ttdoc">Subscription state. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d75/res__pjsip__refer_8c_source.html#l00076">res_pjsip_refer.c:76</a></div></div>
<div class="ttc" id="structrefer__progress_html"><div class="ttname"><a href="../../d0/d4b/structrefer__progress.html">refer_progress</a></div><div class="ttdoc">REFER Progress structure. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d75/res__pjsip__refer_8c_source.html#l00044">res_pjsip_refer.c:44</a></div></div>
<div class="ttc" id="include_2asterisk_2frame_8h_html_aedda41918e992000fe921f8f7363b390a850bb06a1702741c93a3fd67cc9637ab"><div class="ttname"><a href="../../d6/d66/include_2asterisk_2frame_8h.html#aedda41918e992000fe921f8f7363b390a850bb06a1702741c93a3fd67cc9637ab">AST_CONTROL_CONGESTION</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d66/include_2asterisk_2frame_8h_source.html#l00285">include/asterisk/frame.h:285</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="ace0ce27cec92bc5b7997cc2d6890bf10"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ace0ce27cec92bc5b7997cc2d6890bf10">&#9670;&nbsp;</a></span>refer_progress_framehook_destroy()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void refer_progress_framehook_destroy </td>
          <td>(</td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>data</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Destroy callback for monitoring framehook. </p>

<p class="definition">Definition at line <a class="el" href="../../d1/d75/res__pjsip__refer_8c_source.html#l00297">297</a> of file <a class="el" href="../../d1/d75/res__pjsip__refer_8c_source.html">res_pjsip_refer.c</a>.</p>

<p class="reference">References <a class="el" href="../../d5/da5/astobj2_8h_source.html#l01958">ao2_cleanup</a>, <a class="el" href="../../de/d96/res__pjsip_8c_source.html#l05138">ast_sip_push_task()</a>, <a class="el" href="../../d1/d75/res__pjsip__refer_8c_source.html#l00058">refer_progress::bridge_sub</a>, <a class="el" href="../../d1/d75/res__pjsip__refer_8c_source.html#l00094">refer_progress_notification_alloc()</a>, <a class="el" href="../../d1/d75/res__pjsip__refer_8c_source.html#l00140">refer_progress_notify()</a>, <a class="el" href="../../d1/d75/res__pjsip__refer_8c_source.html#l00056">refer_progress::serializer</a>, and <a class="el" href="../../d0/df4/stasis_8c_source.html#l00973">stasis_unsubscribe()</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../d1/d75/res__pjsip__refer_8c_source.html#l00625">refer_blind_callback()</a>.</p>
<div class="fragment"><div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;{</div><div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d0/d4b/structrefer__progress.html">refer_progress</a> *<a class="code" href="../../d1/df7/structprogress.html">progress</a> = data;</div><div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d3/dff/structrefer__progress__notification.html">refer_progress_notification</a> *notification = <a class="code" href="../../d1/d75/res__pjsip__refer_8c.html#a89f2c1d96492b68d1399f20fc6eeb833">refer_progress_notification_alloc</a>(progress, 503, PJSIP_EVSUB_STATE_TERMINATED);</div><div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;</div><div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;   <span class="keywordflow">if</span> (notification &amp;&amp; <a class="code" href="../../d7/dfa/group__pjsip__threading.html#ga4f0a0629fa2ca084812772356d8e3565">ast_sip_push_task</a>(progress-&gt;<a class="code" href="../../d0/d4b/structrefer__progress.html#ac23e23ba60f358de78a893d537c0afa4">serializer</a>, <a class="code" href="../../d1/d75/res__pjsip__refer_8c.html#a5d2be3003a3c77234b90343bc0a43935">refer_progress_notify</a>, notification)) {</div><div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;      <a class="code" href="../../d5/da5/astobj2_8h.html#a6321ee982370c55ab3c24c72c562cbdd">ao2_cleanup</a>(notification);</div><div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;   }</div><div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;</div><div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;   <span class="keywordflow">if</span> (progress-&gt;<a class="code" href="../../d0/d4b/structrefer__progress.html#aab0602828a0c8ce025953da194f6681f">bridge_sub</a>) {</div><div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;      progress-&gt;<a class="code" href="../../d0/d4b/structrefer__progress.html#aab0602828a0c8ce025953da194f6681f">bridge_sub</a> = <a class="code" href="../../dd/d79/stasis_8h.html#a3498301077e2005383f0d261c471388b">stasis_unsubscribe</a>(progress-&gt;<a class="code" href="../../d0/d4b/structrefer__progress.html#aab0602828a0c8ce025953da194f6681f">bridge_sub</a>);</div><div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;   }</div><div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;</div><div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#a6321ee982370c55ab3c24c72c562cbdd">ao2_cleanup</a>(progress);</div><div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;}</div><div class="ttc" id="structrefer__progress_html_ac23e23ba60f358de78a893d537c0afa4"><div class="ttname"><a href="../../d0/d4b/structrefer__progress.html#ac23e23ba60f358de78a893d537c0afa4">refer_progress::serializer</a></div><div class="ttdeci">struct ast_taskprocessor * serializer</div><div class="ttdoc">Serializer for notifications. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d75/res__pjsip__refer_8c_source.html#l00056">res_pjsip_refer.c:56</a></div></div>
<div class="ttc" id="structrefer__progress_html_aab0602828a0c8ce025953da194f6681f"><div class="ttname"><a href="../../d0/d4b/structrefer__progress.html#aab0602828a0c8ce025953da194f6681f">refer_progress::bridge_sub</a></div><div class="ttdeci">struct stasis_subscription * bridge_sub</div><div class="ttdoc">Stasis subscription for bridge events. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d75/res__pjsip__refer_8c_source.html#l00058">res_pjsip_refer.c:58</a></div></div>
<div class="ttc" id="structrefer__progress__notification_html"><div class="ttname"><a href="../../d3/dff/structrefer__progress__notification.html">refer_progress_notification</a></div><div class="ttdoc">REFER Progress notification structure. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d75/res__pjsip__refer_8c_source.html#l00070">res_pjsip_refer.c:70</a></div></div>
<div class="ttc" id="structprogress_html"><div class="ttname"><a href="../../d1/df7/structprogress.html">progress</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d3b/dsp_8c_source.html#l00117">dsp.c:117</a></div></div>
<div class="ttc" id="group__pjsip__threading_html_ga4f0a0629fa2ca084812772356d8e3565"><div class="ttname"><a href="../../d7/dfa/group__pjsip__threading.html#ga4f0a0629fa2ca084812772356d8e3565">ast_sip_push_task</a></div><div class="ttdeci">int ast_sip_push_task(struct ast_taskprocessor *serializer, int(*sip_task)(void *), void *task_data)</div><div class="ttdoc">Pushes a task to SIP servants. </div><div class="ttdef"><b>Definition:</b> <a href="../../de/d96/res__pjsip_8c_source.html#l05138">res_pjsip.c:5138</a></div></div>
<div class="ttc" id="stasis_8h_html_a3498301077e2005383f0d261c471388b"><div class="ttname"><a href="../../dd/d79/stasis_8h.html#a3498301077e2005383f0d261c471388b">stasis_unsubscribe</a></div><div class="ttdeci">struct stasis_subscription * stasis_unsubscribe(struct stasis_subscription *subscription)</div><div class="ttdoc">Cancel a subscription. </div><div class="ttdef"><b>Definition:</b> <a href="../../d0/df4/stasis_8c_source.html#l00973">stasis.c:973</a></div></div>
<div class="ttc" id="res__pjsip__refer_8c_html_a89f2c1d96492b68d1399f20fc6eeb833"><div class="ttname"><a href="../../d1/d75/res__pjsip__refer_8c.html#a89f2c1d96492b68d1399f20fc6eeb833">refer_progress_notification_alloc</a></div><div class="ttdeci">static struct refer_progress_notification * refer_progress_notification_alloc(struct refer_progress *progress, int response, pjsip_evsub_state state)</div><div class="ttdoc">Allocator for REFER Progress notification structure. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d75/res__pjsip__refer_8c_source.html#l00094">res_pjsip_refer.c:94</a></div></div>
<div class="ttc" id="res__pjsip__refer_8c_html_a5d2be3003a3c77234b90343bc0a43935"><div class="ttname"><a href="../../d1/d75/res__pjsip__refer_8c.html#a5d2be3003a3c77234b90343bc0a43935">refer_progress_notify</a></div><div class="ttdeci">static int refer_progress_notify(void *data)</div><div class="ttdoc">Serialized callback for subscription notification. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d75/res__pjsip__refer_8c_source.html#l00140">res_pjsip_refer.c:140</a></div></div>
<div class="ttc" id="astobj2_8h_html_a6321ee982370c55ab3c24c72c562cbdd"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#a6321ee982370c55ab3c24c72c562cbdd">ao2_cleanup</a></div><div class="ttdeci">#define ao2_cleanup(obj)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l01958">astobj2.h:1958</a></div></div>
<div class="ttc" id="structrefer__progress_html"><div class="ttname"><a href="../../d0/d4b/structrefer__progress.html">refer_progress</a></div><div class="ttdoc">REFER Progress structure. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d75/res__pjsip__refer_8c_source.html#l00044">res_pjsip_refer.c:44</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a89f2c1d96492b68d1399f20fc6eeb833"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a89f2c1d96492b68d1399f20fc6eeb833">&#9670;&nbsp;</a></span>refer_progress_notification_alloc()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static struct <a class="el" href="../../d3/dff/structrefer__progress__notification.html">refer_progress_notification</a>* refer_progress_notification_alloc </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="../../d0/d4b/structrefer__progress.html">refer_progress</a> *&#160;</td>
          <td class="paramname"><em>progress</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>response</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">pjsip_evsub_state&#160;</td>
          <td class="paramname"><em>state</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Allocator for REFER Progress notification structure. </p>

<p class="definition">Definition at line <a class="el" href="../../d1/d75/res__pjsip__refer_8c_source.html#l00094">94</a> of file <a class="el" href="../../d1/d75/res__pjsip__refer_8c_source.html">res_pjsip_refer.c</a>.</p>

<p class="reference">References <a class="el" href="../../d5/da5/astobj2_8h_source.html#l00411">ao2_alloc</a>, <a class="el" href="../../d5/da5/astobj2_8h_source.html#l00464">ao2_ref</a>, <a class="el" href="../../dc/d7f/resample_8c_source.html#l00096">NULL</a>, <a class="el" href="../../d1/d75/res__pjsip__refer_8c_source.html#l00072">refer_progress_notification::progress</a>, <a class="el" href="../../d1/d75/res__pjsip__refer_8c_source.html#l00086">refer_progress_notification_destroy()</a>, <a class="el" href="../../d1/d75/res__pjsip__refer_8c_source.html#l00074">refer_progress_notification::response</a>, <a class="el" href="../../d1/d75/res__pjsip__refer_8c_source.html#l00076">refer_progress_notification::state</a>, and <a class="el" href="../../d5/dfe/chan__sip_8c_source.html#l00959">state</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../d1/d75/res__pjsip__refer_8c_source.html#l00553">refer_attended_task()</a>, <a class="el" href="../../d1/d75/res__pjsip__refer_8c_source.html#l00625">refer_blind_callback()</a>, <a class="el" href="../../d1/d75/res__pjsip__refer_8c_source.html#l01088">refer_incoming_refer_request()</a>, <a class="el" href="../../d1/d75/res__pjsip__refer_8c_source.html#l00181">refer_progress_bridge()</a>, <a class="el" href="../../d1/d75/res__pjsip__refer_8c_source.html#l00236">refer_progress_framehook()</a>, and <a class="el" href="../../d1/d75/res__pjsip__refer_8c_source.html#l00297">refer_progress_framehook_destroy()</a>.</p>
<div class="fragment"><div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;{</div><div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d3/dff/structrefer__progress__notification.html">refer_progress_notification</a> *notification = <a class="code" href="../../d5/da5/astobj2_8h.html#ae0422b60d8e25b6962b2d61ae4ddf724">ao2_alloc</a>(<span class="keyword">sizeof</span>(*notification), <a class="code" href="../../d1/d75/res__pjsip__refer_8c.html#a2f443ca2bb3b274b636f4cb2d2e50446">refer_progress_notification_destroy</a>);</div><div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;</div><div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;   <span class="keywordflow">if</span> (!notification) {</div><div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;   }</div><div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;</div><div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(progress, +1);</div><div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;   notification-&gt;<a class="code" href="../../d3/dff/structrefer__progress__notification.html#a78ae786167e10c748e902a68acf1138d">progress</a> = <a class="code" href="../../d3/dff/structrefer__progress__notification.html#a78ae786167e10c748e902a68acf1138d">progress</a>;</div><div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;   notification-&gt;<a class="code" href="../../d3/dff/structrefer__progress__notification.html#a2a6a9da56f84d57323e6e3f63af5dcc9">response</a> = <a class="code" href="../../d3/dff/structrefer__progress__notification.html#a2a6a9da56f84d57323e6e3f63af5dcc9">response</a>;</div><div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;   notification-&gt;<a class="code" href="../../d3/dff/structrefer__progress__notification.html#a06eab984618d6a85fadc73dfb41f5c69">state</a> = <a class="code" href="../../d5/dfe/chan__sip_8c.html#a14a9662e09deed264497073732fb014a">state</a>;</div><div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;</div><div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;   <span class="keywordflow">return</span> notification;</div><div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;}</div><div class="ttc" id="chan__sip_8c_html_a14a9662e09deed264497073732fb014a"><div class="ttname"><a href="../../d5/dfe/chan__sip_8c.html#a14a9662e09deed264497073732fb014a">state</a></div><div class="ttdeci">enum sip_cc_notify_state state</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/dfe/chan__sip_8c_source.html#l00959">chan_sip.c:959</a></div></div>
<div class="ttc" id="structrefer__progress__notification_html_a78ae786167e10c748e902a68acf1138d"><div class="ttname"><a href="../../d3/dff/structrefer__progress__notification.html#a78ae786167e10c748e902a68acf1138d">refer_progress_notification::progress</a></div><div class="ttdeci">struct refer_progress * progress</div><div class="ttdoc">Refer progress structure to send notification on. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d75/res__pjsip__refer_8c_source.html#l00072">res_pjsip_refer.c:72</a></div></div>
<div class="ttc" id="res__pjsip__refer_8c_html_a2f443ca2bb3b274b636f4cb2d2e50446"><div class="ttname"><a href="../../d1/d75/res__pjsip__refer_8c.html#a2f443ca2bb3b274b636f4cb2d2e50446">refer_progress_notification_destroy</a></div><div class="ttdeci">static void refer_progress_notification_destroy(void *obj)</div><div class="ttdoc">Destructor for REFER Progress notification structure. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d75/res__pjsip__refer_8c_source.html#l00086">res_pjsip_refer.c:86</a></div></div>
<div class="ttc" id="structrefer__progress__notification_html"><div class="ttname"><a href="../../d3/dff/structrefer__progress__notification.html">refer_progress_notification</a></div><div class="ttdoc">REFER Progress notification structure. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d75/res__pjsip__refer_8c_source.html#l00070">res_pjsip_refer.c:70</a></div></div>
<div class="ttc" id="resample_8c_html_a070d2ce7b6bb7e5c05602aa8c308d0c4"><div class="ttname"><a href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a></div><div class="ttdeci">#define NULL</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d7f/resample_8c_source.html#l00096">resample.c:96</a></div></div>
<div class="ttc" id="astobj2_8h_html_aaca5e8eac39a22f9da1c36fc6c922270"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a></div><div class="ttdeci">#define ao2_ref(o, delta)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l00464">astobj2.h:464</a></div></div>
<div class="ttc" id="astobj2_8h_html_ae0422b60d8e25b6962b2d61ae4ddf724"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#ae0422b60d8e25b6962b2d61ae4ddf724">ao2_alloc</a></div><div class="ttdeci">#define ao2_alloc(data_size, destructor_fn)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l00411">astobj2.h:411</a></div></div>
<div class="ttc" id="structrefer__progress__notification_html_a2a6a9da56f84d57323e6e3f63af5dcc9"><div class="ttname"><a href="../../d3/dff/structrefer__progress__notification.html#a2a6a9da56f84d57323e6e3f63af5dcc9">refer_progress_notification::response</a></div><div class="ttdeci">int response</div><div class="ttdoc">SIP response code to send. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d75/res__pjsip__refer_8c_source.html#l00074">res_pjsip_refer.c:74</a></div></div>
<div class="ttc" id="structrefer__progress__notification_html_a06eab984618d6a85fadc73dfb41f5c69"><div class="ttname"><a href="../../d3/dff/structrefer__progress__notification.html#a06eab984618d6a85fadc73dfb41f5c69">refer_progress_notification::state</a></div><div class="ttdeci">pjsip_evsub_state state</div><div class="ttdoc">Subscription state. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d75/res__pjsip__refer_8c_source.html#l00076">res_pjsip_refer.c:76</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a2f443ca2bb3b274b636f4cb2d2e50446"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2f443ca2bb3b274b636f4cb2d2e50446">&#9670;&nbsp;</a></span>refer_progress_notification_destroy()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void refer_progress_notification_destroy </td>
          <td>(</td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>obj</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Destructor for REFER Progress notification structure. </p>

<p class="definition">Definition at line <a class="el" href="../../d1/d75/res__pjsip__refer_8c_source.html#l00086">86</a> of file <a class="el" href="../../d1/d75/res__pjsip__refer_8c_source.html">res_pjsip_refer.c</a>.</p>

<p class="reference">References <a class="el" href="../../d5/da5/astobj2_8h_source.html#l01958">ao2_cleanup</a>, and <a class="el" href="../../d1/d75/res__pjsip__refer_8c_source.html#l00072">refer_progress_notification::progress</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../d1/d75/res__pjsip__refer_8c_source.html#l00094">refer_progress_notification_alloc()</a>.</p>
<div class="fragment"><div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;{</div><div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d3/dff/structrefer__progress__notification.html">refer_progress_notification</a> *notification = obj;</div><div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;</div><div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#a6321ee982370c55ab3c24c72c562cbdd">ao2_cleanup</a>(notification-&gt;<a class="code" href="../../d3/dff/structrefer__progress__notification.html#a78ae786167e10c748e902a68acf1138d">progress</a>);</div><div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;}</div><div class="ttc" id="structrefer__progress__notification_html_a78ae786167e10c748e902a68acf1138d"><div class="ttname"><a href="../../d3/dff/structrefer__progress__notification.html#a78ae786167e10c748e902a68acf1138d">refer_progress_notification::progress</a></div><div class="ttdeci">struct refer_progress * progress</div><div class="ttdoc">Refer progress structure to send notification on. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d75/res__pjsip__refer_8c_source.html#l00072">res_pjsip_refer.c:72</a></div></div>
<div class="ttc" id="structrefer__progress__notification_html"><div class="ttname"><a href="../../d3/dff/structrefer__progress__notification.html">refer_progress_notification</a></div><div class="ttdoc">REFER Progress notification structure. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d75/res__pjsip__refer_8c_source.html#l00070">res_pjsip_refer.c:70</a></div></div>
<div class="ttc" id="astobj2_8h_html_a6321ee982370c55ab3c24c72c562cbdd"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#a6321ee982370c55ab3c24c72c562cbdd">ao2_cleanup</a></div><div class="ttdeci">#define ao2_cleanup(obj)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l01958">astobj2.h:1958</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a5d2be3003a3c77234b90343bc0a43935"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a5d2be3003a3c77234b90343bc0a43935">&#9670;&nbsp;</a></span>refer_progress_notify()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int refer_progress_notify </td>
          <td>(</td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>data</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Serialized callback for subscription notification. </p>
<p>Locking and serialization:</p>
<p>Although <a class="el" href="../../d1/d75/res__pjsip__refer_8c.html#a5d2be3003a3c77234b90343bc0a43935" title="Serialized callback for subscription notification. ">refer_progress_notify()</a> always runs in the progress serializer, the pjproject evsub module itself can cause the subscription to be destroyed which then triggers <a class="el" href="../../d1/d75/res__pjsip__refer_8c.html#a08d6e1b32dd2e7926e98a1edba6d58a6" title="Callback for REFER subscription state changes. ">refer_progress_on_evsub_state()</a> to clean it up. In this case, it's possible that <a class="el" href="../../d1/d75/res__pjsip__refer_8c.html#a5d2be3003a3c77234b90343bc0a43935" title="Serialized callback for subscription notification. ">refer_progress_notify()</a> could get the subscription pulled out from under it while it's trying to use it.</p>
<p>At one point we tried to have <a class="el" href="../../d1/d75/res__pjsip__refer_8c.html#a08d6e1b32dd2e7926e98a1edba6d58a6" title="Callback for REFER subscription state changes. ">refer_progress_on_evsub_state()</a> push the cleanup to the serializer and wait for its return before returning to pjproject but since pjproject calls its state callbacks with the dialog locked, this required us to unlock the dialog while waiting for the serialized cleanup, then lock it again before returning to pjproject. There were also still some cases where other callers of <a class="el" href="../../d1/d75/res__pjsip__refer_8c.html#a5d2be3003a3c77234b90343bc0a43935" title="Serialized callback for subscription notification. ">refer_progress_notify()</a> weren't using the serializer and crashes were resulting.</p>
<p>Although all callers of <a class="el" href="../../d1/d75/res__pjsip__refer_8c.html#a5d2be3003a3c77234b90343bc0a43935" title="Serialized callback for subscription notification. ">refer_progress_notify()</a> now use the progress serializer, we decided to simplify the locking so we didn't have to unlock and relock the dialog in <a class="el" href="../../d1/d75/res__pjsip__refer_8c.html#a08d6e1b32dd2e7926e98a1edba6d58a6" title="Callback for REFER subscription state changes. ">refer_progress_on_evsub_state()</a>.</p>
<p>Now, <a class="el" href="../../d1/d75/res__pjsip__refer_8c.html#a5d2be3003a3c77234b90343bc0a43935" title="Serialized callback for subscription notification. ">refer_progress_notify()</a> holds the dialog lock for all its work rather than just when calling pjsip_evsub_set_mod_data() to clear the module data. Since pjproject also holds the dialog lock while calling <a class="el" href="../../d1/d75/res__pjsip__refer_8c.html#a08d6e1b32dd2e7926e98a1edba6d58a6" title="Callback for REFER subscription state changes. ">refer_progress_on_evsub_state()</a>, there should be no more chances for the subscription to be cleaned up while still being used to send NOTIFYs. </p>

<p class="definition">Definition at line <a class="el" href="../../d1/d75/res__pjsip__refer_8c_source.html#l00140">140</a> of file <a class="el" href="../../d1/d75/res__pjsip__refer_8c_source.html">res_pjsip_refer.c</a>.</p>

<p class="reference">References <a class="el" href="../../d5/da5/astobj2_8h_source.html#l01958">ao2_cleanup</a>, <a class="el" href="../../d1/d8c/logger_8h_source.html#l00452">ast_debug</a>, <a class="el" href="../../dc/d7f/resample_8c_source.html#l00096">NULL</a>, <a class="el" href="../../d5/d60/utils_8h_source.html#l00911">RAII_VAR</a>, and <a class="el" href="../../d1/d75/res__pjsip__refer_8c_source.html#l00046">refer_progress::sub</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../d1/d75/res__pjsip__refer_8c_source.html#l00553">refer_attended_task()</a>, <a class="el" href="../../d1/d75/res__pjsip__refer_8c_source.html#l00625">refer_blind_callback()</a>, <a class="el" href="../../d1/d75/res__pjsip__refer_8c_source.html#l01088">refer_incoming_refer_request()</a>, <a class="el" href="../../d1/d75/res__pjsip__refer_8c_source.html#l00181">refer_progress_bridge()</a>, <a class="el" href="../../d1/d75/res__pjsip__refer_8c_source.html#l00236">refer_progress_framehook()</a>, and <a class="el" href="../../d1/d75/res__pjsip__refer_8c_source.html#l00297">refer_progress_framehook_destroy()</a>.</p>
<div class="fragment"><div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;{</div><div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;   <a class="code" href="../../d5/d60/utils_8h.html#a1604b4d72144dd3d9f7da668e90337e9">RAII_VAR</a>(<span class="keyword">struct</span> <a class="code" href="../../d3/dff/structrefer__progress__notification.html">refer_progress_notification</a> *, notification, data, <a class="code" href="../../d5/da5/astobj2_8h.html#a6321ee982370c55ab3c24c72c562cbdd">ao2_cleanup</a>);</div><div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;   pjsip_evsub *<a class="code" href="../../d1/da4/res__corosync_8c.html#a8e51289dd0fc7415cee40e7a57b49fdf">sub</a>;</div><div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;   pjsip_tx_data *tdata;</div><div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;</div><div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;   pjsip_dlg_inc_lock(notification-&gt;progress-&gt;dlg);</div><div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;</div><div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;   <span class="comment">/* If the subscription has already been terminated we can&#39;t send a notification */</span></div><div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;   <span class="keywordflow">if</span> (!(sub = notification-&gt;progress-&gt;sub)) {</div><div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;      <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(3, <span class="stringliteral">&quot;Not sending NOTIFY of response &#39;%d&#39; and state &#39;%u&#39; on progress monitor &#39;%p&#39; as subscription has been terminated\n&quot;</span>,</div><div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;         notification-&gt;response, notification-&gt;state, notification-&gt;progress);</div><div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;      pjsip_dlg_dec_lock(notification-&gt;progress-&gt;dlg);</div><div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;      <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;   }</div><div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;</div><div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;   <span class="comment">/* Send a deferred initial 100 Trying SIP frag NOTIFY if we haven&#39;t already. */</span></div><div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;   <span class="keywordflow">if</span> (!notification-&gt;progress-&gt;sent_100) {</div><div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;      notification-&gt;progress-&gt;sent_100 = 1;</div><div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;      <span class="keywordflow">if</span> (notification-&gt;response != 100) {</div><div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;         <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(3, <span class="stringliteral">&quot;Sending initial 100 Trying NOTIFY for progress monitor &#39;%p&#39;\n&quot;</span>,</div><div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;            notification-&gt;progress);</div><div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;         <span class="keywordflow">if</span> (pjsip_xfer_notify(sub, PJSIP_EVSUB_STATE_ACTIVE, 100, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, &amp;tdata) == PJ_SUCCESS) {</div><div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;            pjsip_xfer_send_request(sub, tdata);</div><div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;         }</div><div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;      }</div><div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;   }</div><div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;</div><div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;   <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(3, <span class="stringliteral">&quot;Sending NOTIFY with response &#39;%d&#39; and state &#39;%u&#39; on subscription &#39;%p&#39; and progress monitor &#39;%p&#39;\n&quot;</span>,</div><div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;      notification-&gt;response, notification-&gt;state, sub, notification-&gt;progress);</div><div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;</div><div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;   <span class="comment">/* Actually send the notification */</span></div><div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;   <span class="keywordflow">if</span> (pjsip_xfer_notify(sub, notification-&gt;state, notification-&gt;response, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, &amp;tdata) == PJ_SUCCESS) {</div><div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;      pjsip_xfer_send_request(sub, tdata);</div><div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;   }</div><div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;</div><div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;   pjsip_dlg_dec_lock(notification-&gt;progress-&gt;dlg);</div><div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;</div><div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;   <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;}</div><div class="ttc" id="structrefer__progress__notification_html"><div class="ttname"><a href="../../d3/dff/structrefer__progress__notification.html">refer_progress_notification</a></div><div class="ttdoc">REFER Progress notification structure. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d75/res__pjsip__refer_8c_source.html#l00070">res_pjsip_refer.c:70</a></div></div>
<div class="ttc" id="resample_8c_html_a070d2ce7b6bb7e5c05602aa8c308d0c4"><div class="ttname"><a href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a></div><div class="ttdeci">#define NULL</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d7f/resample_8c_source.html#l00096">resample.c:96</a></div></div>
<div class="ttc" id="logger_8h_html_a3f248112c8d6ce7e3959aa723dade648"><div class="ttname"><a href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a></div><div class="ttdeci">#define ast_debug(level,...)</div><div class="ttdoc">Log a DEBUG message. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d8c/logger_8h_source.html#l00452">logger.h:452</a></div></div>
<div class="ttc" id="utils_8h_html_a1604b4d72144dd3d9f7da668e90337e9"><div class="ttname"><a href="../../d5/d60/utils_8h.html#a1604b4d72144dd3d9f7da668e90337e9">RAII_VAR</a></div><div class="ttdeci">#define RAII_VAR(vartype, varname, initval, dtor)</div><div class="ttdoc">Declare a variable that will call a destructor function when it goes out of scope. </div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d60/utils_8h_source.html#l00911">utils.h:911</a></div></div>
<div class="ttc" id="astobj2_8h_html_a6321ee982370c55ab3c24c72c562cbdd"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#a6321ee982370c55ab3c24c72c562cbdd">ao2_cleanup</a></div><div class="ttdeci">#define ao2_cleanup(obj)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l01958">astobj2.h:1958</a></div></div>
<div class="ttc" id="res__corosync_8c_html_a8e51289dd0fc7415cee40e7a57b49fdf"><div class="ttname"><a href="../../d1/da4/res__corosync_8c.html#a8e51289dd0fc7415cee40e7a57b49fdf">sub</a></div><div class="ttdeci">struct stasis_forward * sub</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/da4/res__corosync_8c_source.html#l00240">res_corosync.c:240</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a08d6e1b32dd2e7926e98a1edba6d58a6"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a08d6e1b32dd2e7926e98a1edba6d58a6">&#9670;&nbsp;</a></span>refer_progress_on_evsub_state()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void refer_progress_on_evsub_state </td>
          <td>(</td>
          <td class="paramtype">pjsip_evsub *&#160;</td>
          <td class="paramname"><em>sub</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">pjsip_event *&#160;</td>
          <td class="paramname"><em>event</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Callback for REFER subscription state changes. </p>
<dl class="section see"><dt>See also</dt><dd><a class="el" href="../../d1/d75/res__pjsip__refer_8c.html#a5d2be3003a3c77234b90343bc0a43935" title="Serialized callback for subscription notification. ">refer_progress_notify</a></dd></dl>
<p>The documentation attached to refer_progress_notify has more information about the locking issues with cleaning up the subscription.</p>
<dl class="section note"><dt>Note</dt><dd>pjproject holds the dialog lock while calling this function. </dd></dl>

<p class="definition">Definition at line <a class="el" href="../../d1/d75/res__pjsip__refer_8c_source.html#l00323">323</a> of file <a class="el" href="../../d1/d75/res__pjsip__refer_8c_source.html">res_pjsip_refer.c</a>.</p>

<p class="reference">References <a class="el" href="../../d5/da5/astobj2_8h_source.html#l01958">ao2_cleanup</a>, <a class="el" href="../../dc/d7f/resample_8c_source.html#l00096">NULL</a>, <a class="el" href="../../d1/d75/res__pjsip__refer_8c_source.html#l00080">refer_progress_module</a>, and <a class="el" href="../../d1/d75/res__pjsip__refer_8c_source.html#l00046">refer_progress::sub</a>.</p>
<div class="fragment"><div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;{</div><div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d0/d4b/structrefer__progress.html">refer_progress</a> *<a class="code" href="../../d1/df7/structprogress.html">progress</a> = pjsip_evsub_get_mod_data(<a class="code" href="../../d1/da4/res__corosync_8c.html#a8e51289dd0fc7415cee40e7a57b49fdf">sub</a>, <a class="code" href="../../d1/d75/res__pjsip__refer_8c.html#a43579c197f6efc45d0093d0ab8cba536">refer_progress_module</a>.id);</div><div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;</div><div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;   <span class="comment">/*</span></div><div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;<span class="comment">    * If being destroyed, remove the progress object from the subscription</span></div><div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;<span class="comment">    * and release the reference it had.</span></div><div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;<span class="comment">    */</span></div><div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;   <span class="keywordflow">if</span> (progress &amp;&amp; (pjsip_evsub_get_state(<a class="code" href="../../d1/da4/res__corosync_8c.html#a8e51289dd0fc7415cee40e7a57b49fdf">sub</a>) == PJSIP_EVSUB_STATE_TERMINATED)) {</div><div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;      pjsip_evsub_set_mod_data(progress-&gt;<a class="code" href="../../d0/d4b/structrefer__progress.html#a68b82ac5fc0f4f04476771d38712a3f0">sub</a>, <a class="code" href="../../d1/d75/res__pjsip__refer_8c.html#a43579c197f6efc45d0093d0ab8cba536">refer_progress_module</a>.id, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div><div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;      progress-&gt;<a class="code" href="../../d0/d4b/structrefer__progress.html#a68b82ac5fc0f4f04476771d38712a3f0">sub</a> = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;      <a class="code" href="../../d5/da5/astobj2_8h.html#a6321ee982370c55ab3c24c72c562cbdd">ao2_cleanup</a>(progress);</div><div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;   }</div><div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;}</div><div class="ttc" id="structrefer__progress_html_a68b82ac5fc0f4f04476771d38712a3f0"><div class="ttname"><a href="../../d0/d4b/structrefer__progress.html#a68b82ac5fc0f4f04476771d38712a3f0">refer_progress::sub</a></div><div class="ttdeci">pjsip_evsub * sub</div><div class="ttdoc">Subscription to provide updates on. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d75/res__pjsip__refer_8c_source.html#l00046">res_pjsip_refer.c:46</a></div></div>
<div class="ttc" id="resample_8c_html_a070d2ce7b6bb7e5c05602aa8c308d0c4"><div class="ttname"><a href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a></div><div class="ttdeci">#define NULL</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d7f/resample_8c_source.html#l00096">resample.c:96</a></div></div>
<div class="ttc" id="structprogress_html"><div class="ttname"><a href="../../d1/df7/structprogress.html">progress</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d3b/dsp_8c_source.html#l00117">dsp.c:117</a></div></div>
<div class="ttc" id="res__pjsip__refer_8c_html_a43579c197f6efc45d0093d0ab8cba536"><div class="ttname"><a href="../../d1/d75/res__pjsip__refer_8c.html#a43579c197f6efc45d0093d0ab8cba536">refer_progress_module</a></div><div class="ttdeci">static pjsip_module refer_progress_module</div><div class="ttdoc">REFER Progress module, used to attach REFER progress structure to subscriptions. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d75/res__pjsip__refer_8c_source.html#l00080">res_pjsip_refer.c:80</a></div></div>
<div class="ttc" id="astobj2_8h_html_a6321ee982370c55ab3c24c72c562cbdd"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#a6321ee982370c55ab3c24c72c562cbdd">ao2_cleanup</a></div><div class="ttdeci">#define ao2_cleanup(obj)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l01958">astobj2.h:1958</a></div></div>
<div class="ttc" id="res__corosync_8c_html_a8e51289dd0fc7415cee40e7a57b49fdf"><div class="ttname"><a href="../../d1/da4/res__corosync_8c.html#a8e51289dd0fc7415cee40e7a57b49fdf">sub</a></div><div class="ttdeci">struct stasis_forward * sub</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/da4/res__corosync_8c_source.html#l00240">res_corosync.c:240</a></div></div>
<div class="ttc" id="structrefer__progress_html"><div class="ttname"><a href="../../d0/d4b/structrefer__progress.html">refer_progress</a></div><div class="ttdoc">REFER Progress structure. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d75/res__pjsip__refer_8c_source.html#l00044">res_pjsip_refer.c:44</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="ac2d698569813f09d32e13c7068adbbda"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac2d698569813f09d32e13c7068adbbda">&#9670;&nbsp;</a></span>session_end_if_deferred_task()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int session_end_if_deferred_task </td>
          <td>(</td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>data</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="../../d1/d75/res__pjsip__refer_8c_source.html#l00502">502</a> of file <a class="el" href="../../d1/d75/res__pjsip__refer_8c_source.html">res_pjsip_refer.c</a>.</p>

<p class="reference">References <a class="el" href="../../d5/da5/astobj2_8h_source.html#l00464">ao2_ref</a>, <a class="el" href="../../d4/d92/res__pjsip__session_8c_source.html#l03614">ast_sip_session_end_if_deferred()</a>, and <a class="el" href="../../d2/d4d/astman_8c.html#ac4a6ae0400e4457f0b35beddec80c93d">session</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../d1/d75/res__pjsip__refer_8c_source.html#l00553">refer_attended_task()</a>.</p>
<div class="fragment"><div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;{</div><div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d2/dec/structast__sip__session.html">ast_sip_session</a> *<a class="code" href="../../d2/d4d/astman_8c.html#ac4a6ae0400e4457f0b35beddec80c93d">session</a> = data;</div><div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;</div><div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;   <a class="code" href="../../d9/de7/res__pjsip__session_8h.html#aa55296422ab86c7de1d7f52e9c227d82">ast_sip_session_end_if_deferred</a>(session);</div><div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(session, -1);</div><div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;   <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;}</div><div class="ttc" id="structast__sip__session_html"><div class="ttname"><a href="../../d2/dec/structast__sip__session.html">ast_sip_session</a></div><div class="ttdoc">A structure describing a SIP session. </div><div class="ttdef"><b>Definition:</b> <a href="../../d9/de7/res__pjsip__session_8h_source.html#l00179">res_pjsip_session.h:179</a></div></div>
<div class="ttc" id="astman_8c_html_ac4a6ae0400e4457f0b35beddec80c93d"><div class="ttname"><a href="../../d2/d4d/astman_8c.html#ac4a6ae0400e4457f0b35beddec80c93d">session</a></div><div class="ttdeci">static struct ast_mansession session</div></div>
<div class="ttc" id="astobj2_8h_html_aaca5e8eac39a22f9da1c36fc6c922270"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a></div><div class="ttdeci">#define ao2_ref(o, delta)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l00464">astobj2.h:464</a></div></div>
<div class="ttc" id="res__pjsip__session_8h_html_aa55296422ab86c7de1d7f52e9c227d82"><div class="ttname"><a href="../../d9/de7/res__pjsip__session_8h.html#aa55296422ab86c7de1d7f52e9c227d82">ast_sip_session_end_if_deferred</a></div><div class="ttdeci">void ast_sip_session_end_if_deferred(struct ast_sip_session *session)</div><div class="ttdoc">End the session if it had been previously deferred. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d92/res__pjsip__session_8c_source.html#l03614">res_pjsip_session.c:3614</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="ad09fa931f468002152a3cc2d5ce25eae"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad09fa931f468002152a3cc2d5ce25eae">&#9670;&nbsp;</a></span>unload_module()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int unload_module </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="../../d1/d75/res__pjsip__refer_8c_source.html#l01281">1281</a> of file <a class="el" href="../../d1/d75/res__pjsip__refer_8c_source.html">res_pjsip_refer.c</a>.</p>

<p class="reference">References <a class="el" href="../../d5/d16/module_8h_source.html#l00317">AST_MODFLAG_LOAD_ORDER</a>, <a class="el" href="../../d5/d16/module_8h_source.html#l00328">AST_MODPRI_APP_DEPEND</a>, <a class="el" href="../../d9/de9/res__phoneprov_8c.html#addaa208b0ed785225e24490fb9f28a80">AST_MODULE_INFO()</a>, <a class="el" href="../../d5/d16/module_8h_source.html#l00121">AST_MODULE_SUPPORT_CORE</a>, <a class="el" href="../../d2/dc0/pjsip__session_8c_source.html#l00063">ast_sip_session_unregister_supplement()</a>, <a class="el" href="../../de/d96/res__pjsip_8c_source.html#l03331">ast_sip_unregister_service()</a>, <a class="el" href="../../d5/d16/module_8h_source.html#l00046">ASTERISK_GPL_KEY</a>, <a class="el" href="../../d1/d75/res__pjsip__refer_8c_source.html#l01262">load_module()</a>, and <a class="el" href="../../d1/d75/res__pjsip__refer_8c_source.html#l00080">refer_progress_module</a>.</p>
<div class="fragment"><div class="line"><a name="l01282"></a><span class="lineno"> 1282</span>&#160;{</div><div class="line"><a name="l01283"></a><span class="lineno"> 1283</span>&#160;   <a class="code" href="../../d9/de7/res__pjsip__session_8h.html#aae89632996ffdcf888ab251c14dc6cdb">ast_sip_session_unregister_supplement</a>(&amp;<a class="code" href="../../d1/d75/res__pjsip__refer_8c.html#a366b18e6269e3453a3bae9a35df9334a">refer_supplement</a>);</div><div class="line"><a name="l01284"></a><span class="lineno"> 1284</span>&#160;   <a class="code" href="../../d8/d8c/res__pjsip_8h.html#a15aa09d9084763cdd20b7467a4cd381a">ast_sip_unregister_service</a>(&amp;<a class="code" href="../../d1/d75/res__pjsip__refer_8c.html#a43579c197f6efc45d0093d0ab8cba536">refer_progress_module</a>);</div><div class="line"><a name="l01285"></a><span class="lineno"> 1285</span>&#160;</div><div class="line"><a name="l01286"></a><span class="lineno"> 1286</span>&#160;   <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l01287"></a><span class="lineno"> 1287</span>&#160;}</div><div class="ttc" id="res__pjsip__refer_8c_html_a366b18e6269e3453a3bae9a35df9334a"><div class="ttname"><a href="../../d1/d75/res__pjsip__refer_8c.html#a366b18e6269e3453a3bae9a35df9334a">refer_supplement</a></div><div class="ttdeci">static struct ast_sip_session_supplement refer_supplement</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d75/res__pjsip__refer_8c_source.html#l01256">res_pjsip_refer.c:1256</a></div></div>
<div class="ttc" id="res__pjsip__session_8h_html_aae89632996ffdcf888ab251c14dc6cdb"><div class="ttname"><a href="../../d9/de7/res__pjsip__session_8h.html#aae89632996ffdcf888ab251c14dc6cdb">ast_sip_session_unregister_supplement</a></div><div class="ttdeci">void ast_sip_session_unregister_supplement(struct ast_sip_session_supplement *supplement)</div><div class="ttdoc">Unregister a an supplement to SIP session processing. </div><div class="ttdef"><b>Definition:</b> <a href="../../d2/dc0/pjsip__session_8c_source.html#l00063">pjsip_session.c:63</a></div></div>
<div class="ttc" id="res__pjsip__refer_8c_html_a43579c197f6efc45d0093d0ab8cba536"><div class="ttname"><a href="../../d1/d75/res__pjsip__refer_8c.html#a43579c197f6efc45d0093d0ab8cba536">refer_progress_module</a></div><div class="ttdeci">static pjsip_module refer_progress_module</div><div class="ttdoc">REFER Progress module, used to attach REFER progress structure to subscriptions. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d75/res__pjsip__refer_8c_source.html#l00080">res_pjsip_refer.c:80</a></div></div>
<div class="ttc" id="res__pjsip_8h_html_a15aa09d9084763cdd20b7467a4cd381a"><div class="ttname"><a href="../../d8/d8c/res__pjsip_8h.html#a15aa09d9084763cdd20b7467a4cd381a">ast_sip_unregister_service</a></div><div class="ttdeci">void ast_sip_unregister_service(pjsip_module *module)</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d96/res__pjsip_8c_source.html#l03331">res_pjsip.c:3331</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a1d1a233825b31a62bc5074299f4b273c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1d1a233825b31a62bc5074299f4b273c">&#9670;&nbsp;</a></span>xfer_response_code2sip()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int xfer_response_code2sip </td>
          <td>(</td>
          <td class="paramtype">enum <a class="el" href="../../d4/d56/bridge_8h.html#aadbf879fadde4b1bb7832b1390cc8c17">ast_transfer_result</a>&#160;</td>
          <td class="paramname"><em>xfer_code</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="../../d1/d75/res__pjsip__refer_8c_source.html#l00530">530</a> of file <a class="el" href="../../d1/d75/res__pjsip__refer_8c_source.html">res_pjsip_refer.c</a>.</p>

<p class="reference">References <a class="el" href="../../d4/d56/bridge_8h_source.html#l01123">AST_BRIDGE_TRANSFER_FAIL</a>, <a class="el" href="../../d4/d56/bridge_8h_source.html#l01121">AST_BRIDGE_TRANSFER_INVALID</a>, <a class="el" href="../../d4/d56/bridge_8h_source.html#l01119">AST_BRIDGE_TRANSFER_NOT_PERMITTED</a>, and <a class="el" href="../../d4/d56/bridge_8h_source.html#l01117">AST_BRIDGE_TRANSFER_SUCCESS</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../d1/d75/res__pjsip__refer_8c_source.html#l00553">refer_attended_task()</a>, <a class="el" href="../../d1/d75/res__pjsip__refer_8c_source.html#l00789">refer_incoming_attended_request()</a>, and <a class="el" href="../../d1/d75/res__pjsip__refer_8c_source.html#l00886">refer_incoming_blind_request()</a>.</p>
<div class="fragment"><div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;{</div><div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;   <span class="keywordtype">int</span> response;</div><div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;</div><div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;   response = 503;</div><div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;   <span class="keywordflow">switch</span> (xfer_code) {</div><div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="../../d4/d56/bridge_8h.html#aadbf879fadde4b1bb7832b1390cc8c17a93e2a5d4517067d0b9a0e39b0cdc5df8">AST_BRIDGE_TRANSFER_INVALID</a>:</div><div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;      response = 400;</div><div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="../../d4/d56/bridge_8h.html#aadbf879fadde4b1bb7832b1390cc8c17a10037a900428dbddb31e85e4481bb4da">AST_BRIDGE_TRANSFER_NOT_PERMITTED</a>:</div><div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;      response = 403;</div><div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="../../d4/d56/bridge_8h.html#aadbf879fadde4b1bb7832b1390cc8c17aeebe667b42c8e7993a9f5f4c45e6da25">AST_BRIDGE_TRANSFER_FAIL</a>:</div><div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;      response = 500;</div><div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="../../d4/d56/bridge_8h.html#aadbf879fadde4b1bb7832b1390cc8c17a6b0053a1a47d100ef5f155f068c08934">AST_BRIDGE_TRANSFER_SUCCESS</a>:</div><div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;      response = 200;</div><div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;   }</div><div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;   <span class="keywordflow">return</span> response;</div><div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;}</div><div class="ttc" id="bridge_8h_html_aadbf879fadde4b1bb7832b1390cc8c17a93e2a5d4517067d0b9a0e39b0cdc5df8"><div class="ttname"><a href="../../d4/d56/bridge_8h.html#aadbf879fadde4b1bb7832b1390cc8c17a93e2a5d4517067d0b9a0e39b0cdc5df8">AST_BRIDGE_TRANSFER_INVALID</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d56/bridge_8h_source.html#l01121">bridge.h:1121</a></div></div>
<div class="ttc" id="bridge_8h_html_aadbf879fadde4b1bb7832b1390cc8c17a6b0053a1a47d100ef5f155f068c08934"><div class="ttname"><a href="../../d4/d56/bridge_8h.html#aadbf879fadde4b1bb7832b1390cc8c17a6b0053a1a47d100ef5f155f068c08934">AST_BRIDGE_TRANSFER_SUCCESS</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d56/bridge_8h_source.html#l01117">bridge.h:1117</a></div></div>
<div class="ttc" id="bridge_8h_html_aadbf879fadde4b1bb7832b1390cc8c17aeebe667b42c8e7993a9f5f4c45e6da25"><div class="ttname"><a href="../../d4/d56/bridge_8h.html#aadbf879fadde4b1bb7832b1390cc8c17aeebe667b42c8e7993a9f5f4c45e6da25">AST_BRIDGE_TRANSFER_FAIL</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d56/bridge_8h_source.html#l01123">bridge.h:1123</a></div></div>
<div class="ttc" id="bridge_8h_html_aadbf879fadde4b1bb7832b1390cc8c17a10037a900428dbddb31e85e4481bb4da"><div class="ttname"><a href="../../d4/d56/bridge_8h.html#aadbf879fadde4b1bb7832b1390cc8c17a10037a900428dbddb31e85e4481bb4da">AST_BRIDGE_TRANSFER_NOT_PERMITTED</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d56/bridge_8h_source.html#l01119">bridge.h:1119</a></div></div>
</div><!-- fragment -->
</div>
</div>
<h2 class="groupheader">Variable Documentation</h2>
<a id="ab22f32016155f7f403e7178767163d7d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab22f32016155f7f403e7178767163d7d">&#9670;&nbsp;</a></span>__mod_info</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="../../dd/d5f/structast__module__info.html">ast_module_info</a> __mod_info = { .<a class="el" href="../../d1/da4/res__corosync_8c.html#a8f8f80d37794cde9472343e4487ba3eb">name</a> = <a class="el" href="../../da/ddd/named__acl_8c.html#aec23fc5034c3bb08140fc021f4955877">AST_MODULE</a>, .flags = <a class="el" href="../../d5/d16/module_8h.html#a155a0df9c59e04e305d4a2fa3e35f843a12c3f60dd7655dfa8d4430cbf04b1223">AST_MODFLAG_LOAD_ORDER</a> , .description = &quot;PJSIP Blind and Attended Transfer Support&quot; , .key = &quot;This paragraph is copyright (<a class="el" href="../../d7/d6f/test__linkedlists_8c.html#acd9db00336027462cfb25b97b5356883">c</a>) 2006 by Digium, Inc. \In <a class="el" href="../../d5/d14/voicin_8c.html#aed7ca058008dc3e5ee131e575abed285">order</a> for your module to load, it must return this \key via <a class="el" href="../../d7/d6f/test__linkedlists_8c.html#a13dd15487fee89a002d17ef3aff62d02">a</a> function called \&quot;key\&quot;. Any code which \includes this paragraph must <a class="el" href="../../dd/d7c/eagi__proxy_8c.html#a39730e90126aad69cfc9ca4d6fcdb3a6">be</a> licensed under the GNU \General Public License <a class="el" href="../../da/d7c/utils_2frame_8h.html#a56abfaab87c46691c1ef3ad0df23e864">version</a> 2 or later (at your \option). In addition to Digium's general reservations \of rights, Digium expressly reserves the right to \allow other parties to license this paragraph under \different terms. Any use of Digium, Inc. trademarks or \logos (including \&quot;Asterisk\&quot; or \&quot;Digium\&quot;) without \express written <a class="el" href="../../d4/d4c/structpermission.html">permission</a> of Digium, Inc. is prohibited.\n&quot; , .buildopt_sum = &quot;30ef0c93b36035ec78c9cfd712d36d9b&quot; , .support_level = AST_MODULE_SUPPORT_CORE, .load = load_module, .unload = unload_module, .load_pri = AST_MODPRI_APP_DEPEND, .requires = &quot;res_pjsip,res_pjsip_session,res_pjsip_pubsub&quot;, }</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="../../d1/d75/res__pjsip__refer_8c_source.html#l01295">1295</a> of file <a class="el" href="../../d1/d75/res__pjsip__refer_8c_source.html">res_pjsip_refer.c</a>.</p>

</div>
</div>
<a id="ad60e83b9aa660040fed4d5377966cc21"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad60e83b9aa660040fed4d5377966cc21">&#9670;&nbsp;</a></span>ast_module_info</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">const struct <a class="el" href="../../dd/d5f/structast__module__info.html">ast_module_info</a>* <a class="el" href="../../dd/d5f/structast__module__info.html">ast_module_info</a> = &amp;<a class="el" href="../../d6/d7a/test__xml__escape_8c.html#ab22f32016155f7f403e7178767163d7d">__mod_info</a></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="../../d1/d75/res__pjsip__refer_8c_source.html#l01295">1295</a> of file <a class="el" href="../../d1/d75/res__pjsip__refer_8c_source.html">res_pjsip_refer.c</a>.</p>

</div>
</div>
<a id="aeccd64eee013b06e9076d695d8d47ba3"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aeccd64eee013b06e9076d695d8d47ba3">&#9670;&nbsp;</a></span>refer_progress_evsub_cb</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">pjsip_evsub_user refer_progress_evsub_cb</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<b>Initial value:</b><div class="fragment"><div class="line">= {</div><div class="line">   .on_evsub_state = <a class="code" href="../../d1/d75/res__pjsip__refer_8c.html#a08d6e1b32dd2e7926e98a1edba6d58a6">refer_progress_on_evsub_state</a>,</div><div class="line">}</div><div class="ttc" id="res__pjsip__refer_8c_html_a08d6e1b32dd2e7926e98a1edba6d58a6"><div class="ttname"><a href="../../d1/d75/res__pjsip__refer_8c.html#a08d6e1b32dd2e7926e98a1edba6d58a6">refer_progress_on_evsub_state</a></div><div class="ttdeci">static void refer_progress_on_evsub_state(pjsip_evsub *sub, pjsip_event *event)</div><div class="ttdoc">Callback for REFER subscription state changes. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d75/res__pjsip__refer_8c_source.html#l00323">res_pjsip_refer.c:323</a></div></div>
</div><!-- fragment -->
<p>Callback structure for subscription. </p>

<p class="definition">Definition at line <a class="el" href="../../d1/d75/res__pjsip__refer_8c_source.html#l00339">339</a> of file <a class="el" href="../../d1/d75/res__pjsip__refer_8c_source.html">res_pjsip_refer.c</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../d1/d75/res__pjsip__refer_8c_source.html#l00382">refer_progress_alloc()</a>.</p>

</div>
</div>
<a id="a43579c197f6efc45d0093d0ab8cba536"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a43579c197f6efc45d0093d0ab8cba536">&#9670;&nbsp;</a></span>refer_progress_module</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">pjsip_module refer_progress_module</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<b>Initial value:</b><div class="fragment"><div class="line">= {</div><div class="line">   .name = { <span class="stringliteral">&quot;REFER Progress&quot;</span>, 14 },</div><div class="line">   .id = -1,</div><div class="line">}</div></div><!-- fragment -->
<p>REFER Progress module, used to attach REFER progress structure to subscriptions. </p>

<p class="definition">Definition at line <a class="el" href="../../d1/d75/res__pjsip__refer_8c_source.html#l00080">80</a> of file <a class="el" href="../../d1/d75/res__pjsip__refer_8c_source.html">res_pjsip_refer.c</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../d1/d75/res__pjsip__refer_8c_source.html#l00343">dlg_releaser_task()</a>, <a class="el" href="../../d1/d75/res__pjsip__refer_8c_source.html#l01262">load_module()</a>, <a class="el" href="../../d1/d75/res__pjsip__refer_8c_source.html#l00382">refer_progress_alloc()</a>, <a class="el" href="../../d1/d75/res__pjsip__refer_8c_source.html#l00349">refer_progress_destroy()</a>, <a class="el" href="../../d1/d75/res__pjsip__refer_8c_source.html#l00323">refer_progress_on_evsub_state()</a>, and <a class="el" href="../../d1/d75/res__pjsip__refer_8c_source.html#l01281">unload_module()</a>.</p>

</div>
</div>
<a id="a366b18e6269e3453a3bae9a35df9334a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a366b18e6269e3453a3bae9a35df9334a">&#9670;&nbsp;</a></span>refer_supplement</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="../../df/db8/structast__sip__session__supplement.html">ast_sip_session_supplement</a> refer_supplement</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<b>Initial value:</b><div class="fragment"><div class="line">= {</div><div class="line">   .priority = <a class="code" href="../../d8/d8c/res__pjsip_8h.html#a6e3c5164d38b50bc0f4f22040dedb2cea9dbb0c95071568837209872e28864f43">AST_SIP_SUPPLEMENT_PRIORITY_CHANNEL</a> + 1,</div><div class="line">   .incoming_request = <a class="code" href="../../d1/d75/res__pjsip__refer_8c.html#a63d31b0d0f4fea629c8fe34b0854eb3c">refer_incoming_request</a>,</div><div class="line">   .outgoing_request = <a class="code" href="../../d1/d75/res__pjsip__refer_8c.html#a2147bff39e836eadcc58c4ad6531f39f">refer_outgoing_request</a>,</div><div class="line">}</div><div class="ttc" id="res__pjsip_8h_html_a6e3c5164d38b50bc0f4f22040dedb2cea9dbb0c95071568837209872e28864f43"><div class="ttname"><a href="../../d8/d8c/res__pjsip_8h.html#a6e3c5164d38b50bc0f4f22040dedb2cea9dbb0c95071568837209872e28864f43">AST_SIP_SUPPLEMENT_PRIORITY_CHANNEL</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d8c/res__pjsip_8h_source.html#l02876">res_pjsip.h:2876</a></div></div>
<div class="ttc" id="res__pjsip__refer_8c_html_a63d31b0d0f4fea629c8fe34b0854eb3c"><div class="ttname"><a href="../../d1/d75/res__pjsip__refer_8c.html#a63d31b0d0f4fea629c8fe34b0854eb3c">refer_incoming_request</a></div><div class="ttdeci">static int refer_incoming_request(struct ast_sip_session *session, pjsip_rx_data *rdata)</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d75/res__pjsip__refer_8c_source.html#l01198">res_pjsip_refer.c:1198</a></div></div>
<div class="ttc" id="res__pjsip__refer_8c_html_a2147bff39e836eadcc58c4ad6531f39f"><div class="ttname"><a href="../../d1/d75/res__pjsip__refer_8c.html#a2147bff39e836eadcc58c4ad6531f39f">refer_outgoing_request</a></div><div class="ttdeci">static void refer_outgoing_request(struct ast_sip_session *session, struct pjsip_tx_data *tdata)</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d75/res__pjsip__refer_8c_source.html#l01242">res_pjsip_refer.c:1242</a></div></div>
</div><!-- fragment -->
<p class="definition">Definition at line <a class="el" href="../../d1/d75/res__pjsip__refer_8c_source.html#l01256">1256</a> of file <a class="el" href="../../d1/d75/res__pjsip__refer_8c_source.html">res_pjsip_refer.c</a>.</p>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Sun Aug 8 2021 19:46:34 for Asterisk - The Open Source Telephony Project by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="../../doxygen.png" alt="doxygen"/>
</a> 1.8.13
</small></address>
</body>
</html>
