<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Asterisk - The Open Source Telephony Project: threadpool.c File Reference</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Asterisk - The Open Source Telephony Project
   &#160;<span id="projectnumber">18.5.0</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "../../search",false,'Search');
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('../../',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="../../dir_5c982d53a68cdbcd421152b4020263a9.html">main</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#nested-classes">Data Structures</a> &#124;
<a href="#define-members">Macros</a> &#124;
<a href="#enum-members">Enumerations</a> &#124;
<a href="#func-members">Functions</a> &#124;
<a href="#var-members">Variables</a>  </div>
  <div class="headertitle">
<div class="title">threadpool.c File Reference</div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><code>#include &quot;<a class="el" href="../../db/db2/asterisk_8h_source.html">asterisk.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="../../d3/d40/threadpool_8h_source.html">asterisk/threadpool.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="../../d0/d1e/taskprocessor_8h_source.html">asterisk/taskprocessor.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="../../d5/da5/astobj2_8h_source.html">asterisk/astobj2.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="../../d5/d60/utils_8h_source.html">asterisk/utils.h</a>&quot;</code><br />
</div><div class="textblock"><div class="dynheader">
Include dependency graph for threadpool.c:</div>
<div class="dyncontent">
<div class="center"><img src="../../d4/d0d/threadpool_8c__incl.png" border="0" usemap="#threadpool_8c" alt=""/></div>
<map name="threadpool_8c" id="threadpool_8c">
<area shape="rect" id="node2" href="../../db/db2/asterisk_8h.html" title="Asterisk main include file. File version handling, generic pbx functions. " alt="" coords="98,229,182,256"/>
<area shape="rect" id="node22" href="../../d3/d40/threadpool_8h.html" title="asterisk/threadpool.h" alt="" coords="1789,80,1947,107"/>
<area shape="rect" id="node23" href="../../d0/d1e/taskprocessor_8h.html" title="An API for managing task processing threads that can be shared across modules. " alt="" coords="1971,80,2149,107"/>
<area shape="rect" id="node24" href="../../d5/da5/astobj2_8h.html" title="asterisk/astobj2.h" alt="" coords="1535,229,1670,256"/>
<area shape="rect" id="node34" href="../../d5/d60/utils_8h.html" title="Utility functions. " alt="" coords="1651,80,1765,107"/>
<area shape="rect" id="node3" href="../../d8/d20/autoconfig_8h.html" title="asterisk/autoconfig.h" alt="" coords="5,528,160,555"/>
<area shape="rect" id="node5" href="../../de/da3/include_2asterisk_2compat_8h.html" title="General Definitions for Asterisk top level program Included by asterisk.h to handle platform&#45;specific..." alt="" coords="869,304,1006,331"/>
<area shape="rect" id="node21" href="../../d8/d8a/astmm_8h.html" title="Asterisk memory management routines. " alt="" coords="59,304,194,331"/>
<area shape="rect" id="node4" href="../../dc/dba/buildopts_8h.html" title="asterisk/buildopts.h" alt="" coords="9,603,156,629"/>
<area shape="rect" id="node6" href="../../d4/dd1/compiler_8h.html" title="Compiler&#45;specific macros and other items. " alt="" coords="1331,453,1474,480"/>
<area shape="rect" id="node25" href="../../dd/d42/lock_8h.html" title="Asterisk locking&#45;related definitions: " alt="" coords="1803,379,1917,405"/>
<area shape="rect" id="node28" href="../../d5/d9d/inline__api_8h.html" title="Inlinable API function macro. " alt="" coords="1817,528,1964,555"/>
<area shape="rect" id="node33" href="../../df/d90/linkedlists_8h.html" title="A set of macros to manage forward&#45;linked lists. " alt="" coords="1745,304,1895,331"/>
<area shape="rect" id="node27" href="../../de/df7/time_8h.html" title="Time&#45;related functions and macros. " alt="" coords="1505,453,1567,480"/>
<area shape="rect" id="node31" href="../../d3/dda/backtrace_8h.html" title="Asterisk backtrace generation. " alt="" coords="1643,453,1794,480"/>
<area shape="rect" id="node32" href="../../d1/d8c/logger_8h.html" title="Support for logging to various files, console and syslog Configuration in file logger.conf. " alt="" coords="2590,453,2717,480"/>
<area shape="rect" id="node35" href="../../d9/d94/network_8h.html" title="Wrapper for network related headers, masking differences between various operating systems..." alt="" coords="2328,155,2467,181"/>
<area shape="rect" id="node45" href="../../d5/deb/localtime_8h.html" title="Custom localtime functions for multiple timezones. " alt="" coords="2673,155,2820,181"/>
<area shape="rect" id="node47" href="../../d1/d0f/stringfields_8h.html" title="asterisk/stringfields.h" alt="" coords="3051,229,3208,256"/>
<area shape="rect" id="node49" href="../../d6/d90/strings_8h.html" title="String manipulation functions. " alt="" coords="1643,155,1773,181"/>
<area shape="rect" id="node48" href="../../d6/d68/vector_8h.html" title="Vector container support. " alt="" coords="2655,304,2782,331"/>
</map>
</div>
</div>
<p><a href="../../d1/dc7/threadpool_8c_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="nested-classes"></a>
Data Structures</h2></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dc/d82/structast__serializer__shutdown__group.html">ast_serializer_shutdown_group</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d5/d10/structast__threadpool.html">ast_threadpool</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">An opaque threadpool structure.  <a href="../../d5/d10/structast__threadpool.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/d12/structast__threadpool__listener.html">ast_threadpool_listener</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">listener for a threadpool  <a href="../../dd/d12/structast__threadpool__listener.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dc/dc3/structpool__options__pair.html">pool_options_pair</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d9/d47/structserializer.html">serializer</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dc/d28/structset__size__data.html">set_size_data</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">Helper struct used for queued operations that change the size of the threadpool.  <a href="../../dc/d28/structset__size__data.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d8/d82/structtask__pushed__data.html">task_pushed_data</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">helper used for queued task when tasks are pushed  <a href="../../d8/d82/structtask__pushed__data.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/d34/structthread__worker__pair.html">thread_worker_pair</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">Struct used for queued operations involving worker state changes.  <a href="../../d1/d34/structthread__worker__pair.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/d5b/structworker__thread.html">worker_thread</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="define-members"></a>
Macros</h2></td></tr>
<tr class="memitem:acfc62009ad38b3c3b15f1ac934bf25d0"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/dc7/threadpool_8c.html#acfc62009ad38b3c3b15f1ac934bf25d0">THREAD_BUCKETS</a>&#160;&#160;&#160;89</td></tr>
<tr class="separator:acfc62009ad38b3c3b15f1ac934bf25d0"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="enum-members"></a>
Enumerations</h2></td></tr>
<tr class="memitem:a74d6a8e9b05f036ec5b86d00abaffea6"><td class="memItemLeft" align="right" valign="top">enum &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/dc7/threadpool_8c.html#a74d6a8e9b05f036ec5b86d00abaffea6">worker_state</a> { <a class="el" href="../../d1/dc7/threadpool_8c.html#a74d6a8e9b05f036ec5b86d00abaffea6a4f34c5c191d6e0d028ca831b6c0b1571">ALIVE</a>, 
<a class="el" href="../../d1/dc7/threadpool_8c.html#a74d6a8e9b05f036ec5b86d00abaffea6a5dfb36109b24f39d54d5c3f48f53def8">ZOMBIE</a>, 
<a class="el" href="../../d1/dc7/threadpool_8c.html#a74d6a8e9b05f036ec5b86d00abaffea6a11fd9ca455f92c69c084484d5cd803c2">DEAD</a>
 }<tr class="memdesc:a74d6a8e9b05f036ec5b86d00abaffea6"><td class="mdescLeft">&#160;</td><td class="mdescRight">states for worker threads  <a href="../../d1/dc7/threadpool_8c.html#a74d6a8e9b05f036ec5b86d00abaffea6">More...</a><br /></td></tr>
</td></tr>
<tr class="separator:a74d6a8e9b05f036ec5b86d00abaffea6"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a180728fe1bdbe0895097666c4bad2999"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/dc7/threadpool_8c.html#a180728fe1bdbe0895097666c4bad2999">activate_thread</a> (void *obj, void *arg, int flags)</td></tr>
<tr class="memdesc:a180728fe1bdbe0895097666c4bad2999"><td class="mdescLeft">&#160;</td><td class="mdescRight">Activate idle threads.  <a href="#a180728fe1bdbe0895097666c4bad2999">More...</a><br /></td></tr>
<tr class="separator:a180728fe1bdbe0895097666c4bad2999"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a26d6e398621cb8b8d2e1066b0393944a"><td class="memItemLeft" align="right" valign="top">struct <a class="el" href="../../dc/d82/structast__serializer__shutdown__group.html">ast_serializer_shutdown_group</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/dc7/threadpool_8c.html#a26d6e398621cb8b8d2e1066b0393944a">ast_serializer_shutdown_group_alloc</a> (void)</td></tr>
<tr class="memdesc:a26d6e398621cb8b8d2e1066b0393944a"><td class="mdescLeft">&#160;</td><td class="mdescRight">Create a serializer group shutdown control object.  <a href="#a26d6e398621cb8b8d2e1066b0393944a">More...</a><br /></td></tr>
<tr class="separator:a26d6e398621cb8b8d2e1066b0393944a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab8cbf6d9f2f9964fc6225a73cc287441"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/dc7/threadpool_8c.html#ab8cbf6d9f2f9964fc6225a73cc287441">ast_serializer_shutdown_group_join</a> (struct <a class="el" href="../../dc/d82/structast__serializer__shutdown__group.html">ast_serializer_shutdown_group</a> *<a class="el" href="../../d9/d96/res__pjsip__outbound__registration_8c.html#a2c3d0057b62bfa5b08fe977478749c24">shutdown_group</a>, int <a class="el" href="../../d0/d29/cdr__mysql_8c.html#a493b57f443cc38b3d3df9c1e584d9d82">timeout</a>)</td></tr>
<tr class="memdesc:ab8cbf6d9f2f9964fc6225a73cc287441"><td class="mdescLeft">&#160;</td><td class="mdescRight">Wait for the serializers in the group to shutdown with timeout.  <a href="#ab8cbf6d9f2f9964fc6225a73cc287441">More...</a><br /></td></tr>
<tr class="separator:ab8cbf6d9f2f9964fc6225a73cc287441"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:abf6fc4af30779217d37047cbb1fddd1a"><td class="memItemLeft" align="right" valign="top">struct <a class="el" href="../../d5/d10/structast__threadpool.html">ast_threadpool</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/dc7/threadpool_8c.html#abf6fc4af30779217d37047cbb1fddd1a">ast_threadpool_create</a> (const char *<a class="el" href="../../d1/da4/res__corosync_8c.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, struct <a class="el" href="../../dd/d12/structast__threadpool__listener.html">ast_threadpool_listener</a> *<a class="el" href="../../d5/d03/asterisk_8c.html#adc01bca6281492dfec5ae217cf32fc34">listener</a>, const struct <a class="el" href="../../de/de6/structast__threadpool__options.html">ast_threadpool_options</a> *<a class="el" href="../../d4/d45/test__http__media__cache_8c.html#a80c8e3ae5087d90d422675d034eeebc7">options</a>)</td></tr>
<tr class="memdesc:abf6fc4af30779217d37047cbb1fddd1a"><td class="mdescLeft">&#160;</td><td class="mdescRight">Create a new threadpool.  <a href="#abf6fc4af30779217d37047cbb1fddd1a">More...</a><br /></td></tr>
<tr class="separator:abf6fc4af30779217d37047cbb1fddd1a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3e1d943184d2d6260b6718e5629bbc24"><td class="memItemLeft" align="right" valign="top">struct <a class="el" href="../../dd/d12/structast__threadpool__listener.html">ast_threadpool_listener</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/dc7/threadpool_8c.html#a3e1d943184d2d6260b6718e5629bbc24">ast_threadpool_listener_alloc</a> (const struct <a class="el" href="../../df/d64/structast__threadpool__listener__callbacks.html">ast_threadpool_listener_callbacks</a> *callbacks, void *user_data)</td></tr>
<tr class="memdesc:a3e1d943184d2d6260b6718e5629bbc24"><td class="mdescLeft">&#160;</td><td class="mdescRight">Allocate a threadpool listener.  <a href="#a3e1d943184d2d6260b6718e5629bbc24">More...</a><br /></td></tr>
<tr class="separator:a3e1d943184d2d6260b6718e5629bbc24"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa9bee831e887eb53e72a7e161d5c19de"><td class="memItemLeft" align="right" valign="top">void *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/dc7/threadpool_8c.html#aa9bee831e887eb53e72a7e161d5c19de">ast_threadpool_listener_get_user_data</a> (const struct <a class="el" href="../../dd/d12/structast__threadpool__listener.html">ast_threadpool_listener</a> *<a class="el" href="../../d5/d03/asterisk_8c.html#adc01bca6281492dfec5ae217cf32fc34">listener</a>)</td></tr>
<tr class="memdesc:aa9bee831e887eb53e72a7e161d5c19de"><td class="mdescLeft">&#160;</td><td class="mdescRight">Get the threadpool listener's user data.  <a href="#aa9bee831e887eb53e72a7e161d5c19de">More...</a><br /></td></tr>
<tr class="separator:aa9bee831e887eb53e72a7e161d5c19de"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa3aac2ce5678c3c1f0750e7990ae68a9"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/dc7/threadpool_8c.html#aa3aac2ce5678c3c1f0750e7990ae68a9">ast_threadpool_push</a> (struct <a class="el" href="../../d5/d10/structast__threadpool.html">ast_threadpool</a> *<a class="el" href="../../d9/d21/res__rtp__asterisk_8c.html#a2e57658a5d3ef6c4ef2774c9d5868e7c">pool</a>, int(*<a class="el" href="../../df/df7/test__taskprocessor_8c.html#a07d08fd44ac4a9f8e1319ce270f5d56a">task</a>)(void *data), void *data)</td></tr>
<tr class="memdesc:aa3aac2ce5678c3c1f0750e7990ae68a9"><td class="mdescLeft">&#160;</td><td class="mdescRight">Push a task to the threadpool.  <a href="#aa3aac2ce5678c3c1f0750e7990ae68a9">More...</a><br /></td></tr>
<tr class="separator:aa3aac2ce5678c3c1f0750e7990ae68a9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6e65e5b2e17e83c008f74b1d93cee2b5"><td class="memItemLeft" align="right" valign="top">long&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/dc7/threadpool_8c.html#a6e65e5b2e17e83c008f74b1d93cee2b5">ast_threadpool_queue_size</a> (struct <a class="el" href="../../d5/d10/structast__threadpool.html">ast_threadpool</a> *<a class="el" href="../../d9/d21/res__rtp__asterisk_8c.html#a2e57658a5d3ef6c4ef2774c9d5868e7c">pool</a>)</td></tr>
<tr class="memdesc:a6e65e5b2e17e83c008f74b1d93cee2b5"><td class="mdescLeft">&#160;</td><td class="mdescRight">Return the size of the threadpool's task queue.  <a href="#a6e65e5b2e17e83c008f74b1d93cee2b5">More...</a><br /></td></tr>
<tr class="separator:a6e65e5b2e17e83c008f74b1d93cee2b5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6e86f51d34ae17fd6f38b8379883bf87"><td class="memItemLeft" align="right" valign="top">struct <a class="el" href="../../db/d17/structast__taskprocessor.html">ast_taskprocessor</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/dc7/threadpool_8c.html#a6e86f51d34ae17fd6f38b8379883bf87">ast_threadpool_serializer</a> (const char *<a class="el" href="../../d1/da4/res__corosync_8c.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, struct <a class="el" href="../../d5/d10/structast__threadpool.html">ast_threadpool</a> *<a class="el" href="../../d9/d21/res__rtp__asterisk_8c.html#a2e57658a5d3ef6c4ef2774c9d5868e7c">pool</a>)</td></tr>
<tr class="memdesc:a6e86f51d34ae17fd6f38b8379883bf87"><td class="mdescLeft">&#160;</td><td class="mdescRight">Serialized execution of tasks within a <a class="el" href="../../d5/d10/structast__threadpool.html">ast_threadpool</a>.  <a href="#a6e86f51d34ae17fd6f38b8379883bf87">More...</a><br /></td></tr>
<tr class="separator:a6e86f51d34ae17fd6f38b8379883bf87"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad8505fda5adce26c0e2e45de0a0dcb51"><td class="memItemLeft" align="right" valign="top">struct <a class="el" href="../../db/d17/structast__taskprocessor.html">ast_taskprocessor</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/dc7/threadpool_8c.html#ad8505fda5adce26c0e2e45de0a0dcb51">ast_threadpool_serializer_get_current</a> (void)</td></tr>
<tr class="memdesc:ad8505fda5adce26c0e2e45de0a0dcb51"><td class="mdescLeft">&#160;</td><td class="mdescRight">Get the threadpool serializer currently associated with this thread.  <a href="#ad8505fda5adce26c0e2e45de0a0dcb51">More...</a><br /></td></tr>
<tr class="separator:ad8505fda5adce26c0e2e45de0a0dcb51"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a49b8fabf465ce8e4f325ceecda8ccd16"><td class="memItemLeft" align="right" valign="top">struct <a class="el" href="../../db/d17/structast__taskprocessor.html">ast_taskprocessor</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/dc7/threadpool_8c.html#a49b8fabf465ce8e4f325ceecda8ccd16">ast_threadpool_serializer_group</a> (const char *<a class="el" href="../../d1/da4/res__corosync_8c.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, struct <a class="el" href="../../d5/d10/structast__threadpool.html">ast_threadpool</a> *<a class="el" href="../../d9/d21/res__rtp__asterisk_8c.html#a2e57658a5d3ef6c4ef2774c9d5868e7c">pool</a>, struct <a class="el" href="../../dc/d82/structast__serializer__shutdown__group.html">ast_serializer_shutdown_group</a> *<a class="el" href="../../d9/d96/res__pjsip__outbound__registration_8c.html#a2c3d0057b62bfa5b08fe977478749c24">shutdown_group</a>)</td></tr>
<tr class="memdesc:a49b8fabf465ce8e4f325ceecda8ccd16"><td class="mdescLeft">&#160;</td><td class="mdescRight">Serialized execution of tasks within a <a class="el" href="../../d5/d10/structast__threadpool.html">ast_threadpool</a>.  <a href="#a49b8fabf465ce8e4f325ceecda8ccd16">More...</a><br /></td></tr>
<tr class="separator:a49b8fabf465ce8e4f325ceecda8ccd16"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a13fdc818d975e34cef105d44829a054b"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/dc7/threadpool_8c.html#a13fdc818d975e34cef105d44829a054b">ast_threadpool_set_size</a> (struct <a class="el" href="../../d5/d10/structast__threadpool.html">ast_threadpool</a> *<a class="el" href="../../d9/d21/res__rtp__asterisk_8c.html#a2e57658a5d3ef6c4ef2774c9d5868e7c">pool</a>, unsigned int size)</td></tr>
<tr class="memdesc:a13fdc818d975e34cef105d44829a054b"><td class="mdescLeft">&#160;</td><td class="mdescRight">Set the number of threads for the thread pool.  <a href="#a13fdc818d975e34cef105d44829a054b">More...</a><br /></td></tr>
<tr class="separator:a13fdc818d975e34cef105d44829a054b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a45bebfa26a1737c170f723ac86299bba"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/dc7/threadpool_8c.html#a45bebfa26a1737c170f723ac86299bba">ast_threadpool_shutdown</a> (struct <a class="el" href="../../d5/d10/structast__threadpool.html">ast_threadpool</a> *<a class="el" href="../../d9/d21/res__rtp__asterisk_8c.html#a2e57658a5d3ef6c4ef2774c9d5868e7c">pool</a>)</td></tr>
<tr class="memdesc:a45bebfa26a1737c170f723ac86299bba"><td class="mdescLeft">&#160;</td><td class="mdescRight">Shut down a threadpool and destroy it.  <a href="#a45bebfa26a1737c170f723ac86299bba">More...</a><br /></td></tr>
<tr class="separator:a45bebfa26a1737c170f723ac86299bba"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a790f3603be48a5ee567924e6f06d6c88"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/dc7/threadpool_8c.html#a790f3603be48a5ee567924e6f06d6c88">AST_THREADSTORAGE_RAW</a> (current_serializer)</td></tr>
<tr class="separator:a790f3603be48a5ee567924e6f06d6c88"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad18a34a1aef573f84ff3f29004edefba"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/dc7/threadpool_8c.html#ad18a34a1aef573f84ff3f29004edefba">execute_tasks</a> (void *data)</td></tr>
<tr class="separator:ad18a34a1aef573f84ff3f29004edefba"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4b7d634038cf195b340980395ec1b9a4"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/dc7/threadpool_8c.html#a4b7d634038cf195b340980395ec1b9a4">grow</a> (struct <a class="el" href="../../d5/d10/structast__threadpool.html">ast_threadpool</a> *<a class="el" href="../../d9/d21/res__rtp__asterisk_8c.html#a2e57658a5d3ef6c4ef2774c9d5868e7c">pool</a>, int delta)</td></tr>
<tr class="memdesc:a4b7d634038cf195b340980395ec1b9a4"><td class="mdescLeft">&#160;</td><td class="mdescRight">Add threads to the threadpool.  <a href="#a4b7d634038cf195b340980395ec1b9a4">More...</a><br /></td></tr>
<tr class="separator:a4b7d634038cf195b340980395ec1b9a4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aeb318ea12f5c123fac34bc885227d0f5"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/dc7/threadpool_8c.html#aeb318ea12f5c123fac34bc885227d0f5">kill_threads</a> (void *obj, void *arg, int flags)</td></tr>
<tr class="memdesc:aeb318ea12f5c123fac34bc885227d0f5"><td class="mdescLeft">&#160;</td><td class="mdescRight">ao2 callback to kill a set number of threads.  <a href="#aeb318ea12f5c123fac34bc885227d0f5">More...</a><br /></td></tr>
<tr class="separator:aeb318ea12f5c123fac34bc885227d0f5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8265602231dc299fa6acc75612ab7602"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/dc7/threadpool_8c.html#a8265602231dc299fa6acc75612ab7602">queued_active_thread_idle</a> (void *data)</td></tr>
<tr class="memdesc:a8265602231dc299fa6acc75612ab7602"><td class="mdescLeft">&#160;</td><td class="mdescRight">Move a worker thread from the active container to the idle container.  <a href="#a8265602231dc299fa6acc75612ab7602">More...</a><br /></td></tr>
<tr class="separator:a8265602231dc299fa6acc75612ab7602"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a21b4589c07fb24d89ea06b419d5bdd1b"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/dc7/threadpool_8c.html#a21b4589c07fb24d89ea06b419d5bdd1b">queued_emptied</a> (void *data)</td></tr>
<tr class="memdesc:a21b4589c07fb24d89ea06b419d5bdd1b"><td class="mdescLeft">&#160;</td><td class="mdescRight">Queued task that handles the case where the threadpool's taskprocessor is emptied.  <a href="#a21b4589c07fb24d89ea06b419d5bdd1b">More...</a><br /></td></tr>
<tr class="separator:a21b4589c07fb24d89ea06b419d5bdd1b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa630f726bcc0a7f0a4d36478e829dde1"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/dc7/threadpool_8c.html#aa630f726bcc0a7f0a4d36478e829dde1">queued_idle_thread_dead</a> (void *data)</td></tr>
<tr class="separator:aa630f726bcc0a7f0a4d36478e829dde1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6dcc947c4d1eb51eaf8feb2efab14635"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/dc7/threadpool_8c.html#a6dcc947c4d1eb51eaf8feb2efab14635">queued_set_size</a> (void *data)</td></tr>
<tr class="memdesc:a6dcc947c4d1eb51eaf8feb2efab14635"><td class="mdescLeft">&#160;</td><td class="mdescRight">Change the size of the threadpool.  <a href="#a6dcc947c4d1eb51eaf8feb2efab14635">More...</a><br /></td></tr>
<tr class="separator:a6dcc947c4d1eb51eaf8feb2efab14635"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a179beb37a4570d77547617e37ec3d368"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/dc7/threadpool_8c.html#a179beb37a4570d77547617e37ec3d368">queued_task_pushed</a> (void *data)</td></tr>
<tr class="memdesc:a179beb37a4570d77547617e37ec3d368"><td class="mdescLeft">&#160;</td><td class="mdescRight">Queued task called when tasks are pushed into the threadpool.  <a href="#a179beb37a4570d77547617e37ec3d368">More...</a><br /></td></tr>
<tr class="separator:a179beb37a4570d77547617e37ec3d368"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9943d81da4d867f7c77f8935bdfb2d62"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/dc7/threadpool_8c.html#a9943d81da4d867f7c77f8935bdfb2d62">queued_zombie_thread_dead</a> (void *data)</td></tr>
<tr class="memdesc:a9943d81da4d867f7c77f8935bdfb2d62"><td class="mdescLeft">&#160;</td><td class="mdescRight">Kill a zombie thread.  <a href="#a9943d81da4d867f7c77f8935bdfb2d62">More...</a><br /></td></tr>
<tr class="separator:a9943d81da4d867f7c77f8935bdfb2d62"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a82e66b52e831016bdfc643992d2d25f4"><td class="memItemLeft" align="right" valign="top">static struct <a class="el" href="../../d9/d47/structserializer.html">serializer</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/dc7/threadpool_8c.html#a82e66b52e831016bdfc643992d2d25f4">serializer_create</a> (struct <a class="el" href="../../d5/d10/structast__threadpool.html">ast_threadpool</a> *<a class="el" href="../../d9/d21/res__rtp__asterisk_8c.html#a2e57658a5d3ef6c4ef2774c9d5868e7c">pool</a>, struct <a class="el" href="../../dc/d82/structast__serializer__shutdown__group.html">ast_serializer_shutdown_group</a> *<a class="el" href="../../d9/d96/res__pjsip__outbound__registration_8c.html#a2c3d0057b62bfa5b08fe977478749c24">shutdown_group</a>)</td></tr>
<tr class="separator:a82e66b52e831016bdfc643992d2d25f4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4026d93f6429cb37a172dae32e774ec3"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/dc7/threadpool_8c.html#a4026d93f6429cb37a172dae32e774ec3">serializer_dtor</a> (void *obj)</td></tr>
<tr class="separator:a4026d93f6429cb37a172dae32e774ec3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa577e16b6d03e11f0f7b9c5fea0af059"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/dc7/threadpool_8c.html#aa577e16b6d03e11f0f7b9c5fea0af059">serializer_shutdown</a> (struct <a class="el" href="../../d7/d52/structast__taskprocessor__listener.html">ast_taskprocessor_listener</a> *<a class="el" href="../../d5/d03/asterisk_8c.html#adc01bca6281492dfec5ae217cf32fc34">listener</a>)</td></tr>
<tr class="separator:aa577e16b6d03e11f0f7b9c5fea0af059"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a140bca9937359fcff891bb8c7d5271a5"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/dc7/threadpool_8c.html#a140bca9937359fcff891bb8c7d5271a5">serializer_shutdown_group_dec</a> (struct <a class="el" href="../../dc/d82/structast__serializer__shutdown__group.html">ast_serializer_shutdown_group</a> *<a class="el" href="../../d9/d96/res__pjsip__outbound__registration_8c.html#a2c3d0057b62bfa5b08fe977478749c24">shutdown_group</a>)</td></tr>
<tr class="separator:a140bca9937359fcff891bb8c7d5271a5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a32f9d04cf2e48a22a1bf4c0c035ed8c1"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/dc7/threadpool_8c.html#a32f9d04cf2e48a22a1bf4c0c035ed8c1">serializer_shutdown_group_dtor</a> (void *vdoomed)</td></tr>
<tr class="separator:a32f9d04cf2e48a22a1bf4c0c035ed8c1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a94999064773c19db7466b855530eb1b4"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/dc7/threadpool_8c.html#a94999064773c19db7466b855530eb1b4">serializer_shutdown_group_inc</a> (struct <a class="el" href="../../dc/d82/structast__serializer__shutdown__group.html">ast_serializer_shutdown_group</a> *<a class="el" href="../../d9/d96/res__pjsip__outbound__registration_8c.html#a2c3d0057b62bfa5b08fe977478749c24">shutdown_group</a>)</td></tr>
<tr class="separator:a94999064773c19db7466b855530eb1b4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:adbed1c57bcac947d16e5248c1004e51e"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/dc7/threadpool_8c.html#adbed1c57bcac947d16e5248c1004e51e">serializer_start</a> (struct <a class="el" href="../../d7/d52/structast__taskprocessor__listener.html">ast_taskprocessor_listener</a> *<a class="el" href="../../d5/d03/asterisk_8c.html#adc01bca6281492dfec5ae217cf32fc34">listener</a>)</td></tr>
<tr class="separator:adbed1c57bcac947d16e5248c1004e51e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a645501c6996b276d116fa71ad474e00c"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/dc7/threadpool_8c.html#a645501c6996b276d116fa71ad474e00c">serializer_task_pushed</a> (struct <a class="el" href="../../d7/d52/structast__taskprocessor__listener.html">ast_taskprocessor_listener</a> *<a class="el" href="../../d5/d03/asterisk_8c.html#adc01bca6281492dfec5ae217cf32fc34">listener</a>, int was_empty)</td></tr>
<tr class="separator:a645501c6996b276d116fa71ad474e00c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3db89f7bce86946752e8247d4a0d3e55"><td class="memItemLeft" align="right" valign="top">static struct <a class="el" href="../../dc/d28/structset__size__data.html">set_size_data</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/dc7/threadpool_8c.html#a3db89f7bce86946752e8247d4a0d3e55">set_size_data_alloc</a> (struct <a class="el" href="../../d5/d10/structast__threadpool.html">ast_threadpool</a> *<a class="el" href="../../d9/d21/res__rtp__asterisk_8c.html#a2e57658a5d3ef6c4ef2774c9d5868e7c">pool</a>, unsigned int size)</td></tr>
<tr class="memdesc:a3db89f7bce86946752e8247d4a0d3e55"><td class="mdescLeft">&#160;</td><td class="mdescRight">Allocate and initialize a <a class="el" href="../../dc/d28/structset__size__data.html" title="Helper struct used for queued operations that change the size of the threadpool. ">set_size_data</a>.  <a href="#a3db89f7bce86946752e8247d4a0d3e55">More...</a><br /></td></tr>
<tr class="separator:a3db89f7bce86946752e8247d4a0d3e55"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7bbaf491f374ac79e84f3585989ae349"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/dc7/threadpool_8c.html#a7bbaf491f374ac79e84f3585989ae349">shrink</a> (struct <a class="el" href="../../d5/d10/structast__threadpool.html">ast_threadpool</a> *<a class="el" href="../../d9/d21/res__rtp__asterisk_8c.html#a2e57658a5d3ef6c4ef2774c9d5868e7c">pool</a>, int delta)</td></tr>
<tr class="memdesc:a7bbaf491f374ac79e84f3585989ae349"><td class="mdescLeft">&#160;</td><td class="mdescRight">Remove threads from the threadpool.  <a href="#a7bbaf491f374ac79e84f3585989ae349">More...</a><br /></td></tr>
<tr class="separator:a7bbaf491f374ac79e84f3585989ae349"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae6195901c5f444f8ac661eced96e6168"><td class="memItemLeft" align="right" valign="top">static struct <a class="el" href="../../d8/d82/structtask__pushed__data.html">task_pushed_data</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/dc7/threadpool_8c.html#ae6195901c5f444f8ac661eced96e6168">task_pushed_data_alloc</a> (struct <a class="el" href="../../d5/d10/structast__threadpool.html">ast_threadpool</a> *<a class="el" href="../../d9/d21/res__rtp__asterisk_8c.html#a2e57658a5d3ef6c4ef2774c9d5868e7c">pool</a>, int was_empty)</td></tr>
<tr class="memdesc:ae6195901c5f444f8ac661eced96e6168"><td class="mdescLeft">&#160;</td><td class="mdescRight">Allocate and initialize a <a class="el" href="../../d8/d82/structtask__pushed__data.html" title="helper used for queued task when tasks are pushed ">task_pushed_data</a>.  <a href="#ae6195901c5f444f8ac661eced96e6168">More...</a><br /></td></tr>
<tr class="separator:ae6195901c5f444f8ac661eced96e6168"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2d77e9ba6f3133c92f78b076d2561732"><td class="memItemLeft" align="right" valign="top">static struct <a class="el" href="../../d1/d34/structthread__worker__pair.html">thread_worker_pair</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/dc7/threadpool_8c.html#a2d77e9ba6f3133c92f78b076d2561732">thread_worker_pair_alloc</a> (struct <a class="el" href="../../d5/d10/structast__threadpool.html">ast_threadpool</a> *<a class="el" href="../../d9/d21/res__rtp__asterisk_8c.html#a2e57658a5d3ef6c4ef2774c9d5868e7c">pool</a>, struct <a class="el" href="../../dd/d5b/structworker__thread.html">worker_thread</a> *worker)</td></tr>
<tr class="memdesc:a2d77e9ba6f3133c92f78b076d2561732"><td class="mdescLeft">&#160;</td><td class="mdescRight">Allocate and initialize a <a class="el" href="../../d1/d34/structthread__worker__pair.html" title="Struct used for queued operations involving worker state changes. ">thread_worker_pair</a>.  <a href="#a2d77e9ba6f3133c92f78b076d2561732">More...</a><br /></td></tr>
<tr class="separator:a2d77e9ba6f3133c92f78b076d2561732"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0041e0562576aadeec0ce50221ba2396"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/dc7/threadpool_8c.html#a0041e0562576aadeec0ce50221ba2396">thread_worker_pair_free</a> (struct <a class="el" href="../../d1/d34/structthread__worker__pair.html">thread_worker_pair</a> *<a class="el" href="../../df/de8/structpair.html">pair</a>)</td></tr>
<tr class="memdesc:a0041e0562576aadeec0ce50221ba2396"><td class="mdescLeft">&#160;</td><td class="mdescRight">Destructor for <a class="el" href="../../d1/d34/structthread__worker__pair.html" title="Struct used for queued operations involving worker state changes. ">thread_worker_pair</a>.  <a href="#a0041e0562576aadeec0ce50221ba2396">More...</a><br /></td></tr>
<tr class="separator:a0041e0562576aadeec0ce50221ba2396"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1db4545f69518e92887438ebf9dfb898"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/dc7/threadpool_8c.html#a1db4545f69518e92887438ebf9dfb898">threadpool_active_thread_idle</a> (struct <a class="el" href="../../d5/d10/structast__threadpool.html">ast_threadpool</a> *<a class="el" href="../../d9/d21/res__rtp__asterisk_8c.html#a2e57658a5d3ef6c4ef2774c9d5868e7c">pool</a>, struct <a class="el" href="../../dd/d5b/structworker__thread.html">worker_thread</a> *worker)</td></tr>
<tr class="memdesc:a1db4545f69518e92887438ebf9dfb898"><td class="mdescLeft">&#160;</td><td class="mdescRight">Queue a task to move a thread from the active list to the idle list.  <a href="#a1db4545f69518e92887438ebf9dfb898">More...</a><br /></td></tr>
<tr class="separator:a1db4545f69518e92887438ebf9dfb898"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aff29105af0024d75406fe2d09017fa3d"><td class="memItemLeft" align="right" valign="top">static struct <a class="el" href="../../d5/d10/structast__threadpool.html">ast_threadpool</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/dc7/threadpool_8c.html#aff29105af0024d75406fe2d09017fa3d">threadpool_alloc</a> (const char *<a class="el" href="../../d1/da4/res__corosync_8c.html#a8f8f80d37794cde9472343e4487ba3eb">name</a>, const struct <a class="el" href="../../de/de6/structast__threadpool__options.html">ast_threadpool_options</a> *<a class="el" href="../../d4/d45/test__http__media__cache_8c.html#a80c8e3ae5087d90d422675d034eeebc7">options</a>)</td></tr>
<tr class="separator:aff29105af0024d75406fe2d09017fa3d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a43dc131042e760b997414f566761236c"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/dc7/threadpool_8c.html#a43dc131042e760b997414f566761236c">threadpool_destructor</a> (void *obj)</td></tr>
<tr class="memdesc:a43dc131042e760b997414f566761236c"><td class="mdescLeft">&#160;</td><td class="mdescRight">Destroy a threadpool's components.  <a href="#a43dc131042e760b997414f566761236c">More...</a><br /></td></tr>
<tr class="separator:a43dc131042e760b997414f566761236c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6eab2cb427a73f76279f15c10182f1ed"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/dc7/threadpool_8c.html#a6eab2cb427a73f76279f15c10182f1ed">threadpool_execute</a> (struct <a class="el" href="../../d5/d10/structast__threadpool.html">ast_threadpool</a> *<a class="el" href="../../d9/d21/res__rtp__asterisk_8c.html#a2e57658a5d3ef6c4ef2774c9d5868e7c">pool</a>)</td></tr>
<tr class="memdesc:a6eab2cb427a73f76279f15c10182f1ed"><td class="mdescLeft">&#160;</td><td class="mdescRight">Execute a task in the threadpool.  <a href="#a6eab2cb427a73f76279f15c10182f1ed">More...</a><br /></td></tr>
<tr class="separator:a6eab2cb427a73f76279f15c10182f1ed"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab74dbf0b6c8d543d3b115afd691cddd6"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/dc7/threadpool_8c.html#ab74dbf0b6c8d543d3b115afd691cddd6">threadpool_idle_thread_dead</a> (struct <a class="el" href="../../d5/d10/structast__threadpool.html">ast_threadpool</a> *<a class="el" href="../../d9/d21/res__rtp__asterisk_8c.html#a2e57658a5d3ef6c4ef2774c9d5868e7c">pool</a>, struct <a class="el" href="../../dd/d5b/structworker__thread.html">worker_thread</a> *worker)</td></tr>
<tr class="separator:ab74dbf0b6c8d543d3b115afd691cddd6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a77f79e913191ee36b6d34e86ac6cb1aa"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/dc7/threadpool_8c.html#a77f79e913191ee36b6d34e86ac6cb1aa">threadpool_send_state_changed</a> (struct <a class="el" href="../../d5/d10/structast__threadpool.html">ast_threadpool</a> *<a class="el" href="../../d9/d21/res__rtp__asterisk_8c.html#a2e57658a5d3ef6c4ef2774c9d5868e7c">pool</a>)</td></tr>
<tr class="memdesc:a77f79e913191ee36b6d34e86ac6cb1aa"><td class="mdescLeft">&#160;</td><td class="mdescRight">Notify the threadpool listener that the state has changed.  <a href="#a77f79e913191ee36b6d34e86ac6cb1aa">More...</a><br /></td></tr>
<tr class="separator:a77f79e913191ee36b6d34e86ac6cb1aa"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a621d8ba52c236882416b1a0962e114fd"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/dc7/threadpool_8c.html#a621d8ba52c236882416b1a0962e114fd">threadpool_tps_emptied</a> (struct <a class="el" href="../../d7/d52/structast__taskprocessor__listener.html">ast_taskprocessor_listener</a> *<a class="el" href="../../d5/d03/asterisk_8c.html#adc01bca6281492dfec5ae217cf32fc34">listener</a>)</td></tr>
<tr class="memdesc:a621d8ba52c236882416b1a0962e114fd"><td class="mdescLeft">&#160;</td><td class="mdescRight">Taskprocessor listener emptied callback.  <a href="#a621d8ba52c236882416b1a0962e114fd">More...</a><br /></td></tr>
<tr class="separator:a621d8ba52c236882416b1a0962e114fd"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a491cd0ee23f9dc029a50bff296a3dc3e"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/dc7/threadpool_8c.html#a491cd0ee23f9dc029a50bff296a3dc3e">threadpool_tps_shutdown</a> (struct <a class="el" href="../../d7/d52/structast__taskprocessor__listener.html">ast_taskprocessor_listener</a> *<a class="el" href="../../d5/d03/asterisk_8c.html#adc01bca6281492dfec5ae217cf32fc34">listener</a>)</td></tr>
<tr class="memdesc:a491cd0ee23f9dc029a50bff296a3dc3e"><td class="mdescLeft">&#160;</td><td class="mdescRight">Taskprocessor listener shutdown callback.  <a href="#a491cd0ee23f9dc029a50bff296a3dc3e">More...</a><br /></td></tr>
<tr class="separator:a491cd0ee23f9dc029a50bff296a3dc3e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa9ae4b147b979a06c8020849efe87512"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/dc7/threadpool_8c.html#aa9ae4b147b979a06c8020849efe87512">threadpool_tps_start</a> (struct <a class="el" href="../../d7/d52/structast__taskprocessor__listener.html">ast_taskprocessor_listener</a> *<a class="el" href="../../d5/d03/asterisk_8c.html#adc01bca6281492dfec5ae217cf32fc34">listener</a>)</td></tr>
<tr class="separator:aa9ae4b147b979a06c8020849efe87512"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aea5a7903822f85d64689498a69df4700"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/dc7/threadpool_8c.html#aea5a7903822f85d64689498a69df4700">threadpool_tps_task_pushed</a> (struct <a class="el" href="../../d7/d52/structast__taskprocessor__listener.html">ast_taskprocessor_listener</a> *<a class="el" href="../../d5/d03/asterisk_8c.html#adc01bca6281492dfec5ae217cf32fc34">listener</a>, int was_empty)</td></tr>
<tr class="memdesc:aea5a7903822f85d64689498a69df4700"><td class="mdescLeft">&#160;</td><td class="mdescRight">Taskprocessor listener callback called when a task is added.  <a href="#aea5a7903822f85d64689498a69df4700">More...</a><br /></td></tr>
<tr class="separator:aea5a7903822f85d64689498a69df4700"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9bdb1831968932c47c5321e9079f705d"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/dc7/threadpool_8c.html#a9bdb1831968932c47c5321e9079f705d">threadpool_zombie_thread_dead</a> (struct <a class="el" href="../../d5/d10/structast__threadpool.html">ast_threadpool</a> *<a class="el" href="../../d9/d21/res__rtp__asterisk_8c.html#a2e57658a5d3ef6c4ef2774c9d5868e7c">pool</a>, struct <a class="el" href="../../dd/d5b/structworker__thread.html">worker_thread</a> *worker)</td></tr>
<tr class="memdesc:a9bdb1831968932c47c5321e9079f705d"><td class="mdescLeft">&#160;</td><td class="mdescRight">Queue a task to kill a zombie thread.  <a href="#a9bdb1831968932c47c5321e9079f705d">More...</a><br /></td></tr>
<tr class="separator:a9bdb1831968932c47c5321e9079f705d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0aca7fd49b04646cdd284d4daad538c4"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/dc7/threadpool_8c.html#a0aca7fd49b04646cdd284d4daad538c4">worker_active</a> (struct <a class="el" href="../../dd/d5b/structworker__thread.html">worker_thread</a> *worker)</td></tr>
<tr class="memdesc:a0aca7fd49b04646cdd284d4daad538c4"><td class="mdescLeft">&#160;</td><td class="mdescRight">Active loop for worker threads.  <a href="#a0aca7fd49b04646cdd284d4daad538c4">More...</a><br /></td></tr>
<tr class="separator:a0aca7fd49b04646cdd284d4daad538c4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a569b7d8ff03ca80e7b6a852769d15c61"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/dc7/threadpool_8c.html#a569b7d8ff03ca80e7b6a852769d15c61">worker_idle</a> (struct <a class="el" href="../../dd/d5b/structworker__thread.html">worker_thread</a> *worker)</td></tr>
<tr class="memdesc:a569b7d8ff03ca80e7b6a852769d15c61"><td class="mdescLeft">&#160;</td><td class="mdescRight">Idle function for worker threads.  <a href="#a569b7d8ff03ca80e7b6a852769d15c61">More...</a><br /></td></tr>
<tr class="separator:a569b7d8ff03ca80e7b6a852769d15c61"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5513b88136117cc6c4c7d146c226bf86"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/dc7/threadpool_8c.html#a5513b88136117cc6c4c7d146c226bf86">worker_set_state</a> (struct <a class="el" href="../../dd/d5b/structworker__thread.html">worker_thread</a> *worker, enum <a class="el" href="../../d1/dc7/threadpool_8c.html#a74d6a8e9b05f036ec5b86d00abaffea6">worker_state</a> <a class="el" href="../../d4/d88/structstate.html">state</a>)</td></tr>
<tr class="memdesc:a5513b88136117cc6c4c7d146c226bf86"><td class="mdescLeft">&#160;</td><td class="mdescRight">Change a worker's state.  <a href="#a5513b88136117cc6c4c7d146c226bf86">More...</a><br /></td></tr>
<tr class="separator:a5513b88136117cc6c4c7d146c226bf86"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a52721e95ac239fe4f3cb7d27e677d921"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/dc7/threadpool_8c.html#a52721e95ac239fe4f3cb7d27e677d921">worker_shutdown</a> (struct <a class="el" href="../../dd/d5b/structworker__thread.html">worker_thread</a> *worker)</td></tr>
<tr class="memdesc:a52721e95ac239fe4f3cb7d27e677d921"><td class="mdescLeft">&#160;</td><td class="mdescRight">shut a worker thread down  <a href="#a52721e95ac239fe4f3cb7d27e677d921">More...</a><br /></td></tr>
<tr class="separator:a52721e95ac239fe4f3cb7d27e677d921"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aea51831e6b71573a0864d603b6f6195f"><td class="memItemLeft" align="right" valign="top">static void *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/dc7/threadpool_8c.html#aea51831e6b71573a0864d603b6f6195f">worker_start</a> (void *arg)</td></tr>
<tr class="memdesc:aea51831e6b71573a0864d603b6f6195f"><td class="mdescLeft">&#160;</td><td class="mdescRight">start point for worker threads  <a href="#aea51831e6b71573a0864d603b6f6195f">More...</a><br /></td></tr>
<tr class="separator:aea51831e6b71573a0864d603b6f6195f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a03c0a8a356376d546a672d2a1acfe13d"><td class="memItemLeft" align="right" valign="top">static struct <a class="el" href="../../dd/d5b/structworker__thread.html">worker_thread</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/dc7/threadpool_8c.html#a03c0a8a356376d546a672d2a1acfe13d">worker_thread_alloc</a> (struct <a class="el" href="../../d5/d10/structast__threadpool.html">ast_threadpool</a> *<a class="el" href="../../d9/d21/res__rtp__asterisk_8c.html#a2e57658a5d3ef6c4ef2774c9d5868e7c">pool</a>)</td></tr>
<tr class="memdesc:a03c0a8a356376d546a672d2a1acfe13d"><td class="mdescLeft">&#160;</td><td class="mdescRight">Allocate and initialize a new worker thread.  <a href="#a03c0a8a356376d546a672d2a1acfe13d">More...</a><br /></td></tr>
<tr class="separator:a03c0a8a356376d546a672d2a1acfe13d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac0d540965c29848c4867d3db2440ec4d"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/dc7/threadpool_8c.html#ac0d540965c29848c4867d3db2440ec4d">worker_thread_cmp</a> (void *obj, void *arg, int flags)</td></tr>
<tr class="separator:ac0d540965c29848c4867d3db2440ec4d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:acc4078c1106c6cfd3f2ee11694b60fc3"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/dc7/threadpool_8c.html#acc4078c1106c6cfd3f2ee11694b60fc3">worker_thread_destroy</a> (void *obj)</td></tr>
<tr class="memdesc:acc4078c1106c6cfd3f2ee11694b60fc3"><td class="mdescLeft">&#160;</td><td class="mdescRight">Worker thread destructor.  <a href="#acc4078c1106c6cfd3f2ee11694b60fc3">More...</a><br /></td></tr>
<tr class="separator:acc4078c1106c6cfd3f2ee11694b60fc3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a21d4025815ba402857dd4c09dead0384"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/dc7/threadpool_8c.html#a21d4025815ba402857dd4c09dead0384">worker_thread_hash</a> (const void *obj, int flags)</td></tr>
<tr class="separator:a21d4025815ba402857dd4c09dead0384"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a25fb76590bc741453b0269ae1bde21b8"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/dc7/threadpool_8c.html#a25fb76590bc741453b0269ae1bde21b8">worker_thread_start</a> (struct <a class="el" href="../../dd/d5b/structworker__thread.html">worker_thread</a> *worker)</td></tr>
<tr class="separator:a25fb76590bc741453b0269ae1bde21b8"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:affb887ea65f72e5efedfa4f2a9918a5d"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/dc7/threadpool_8c.html#affb887ea65f72e5efedfa4f2a9918a5d">zombify_threads</a> (void *obj, void *arg, void *data, int flags)</td></tr>
<tr class="memdesc:affb887ea65f72e5efedfa4f2a9918a5d"><td class="mdescLeft">&#160;</td><td class="mdescRight">ao2 callback to zombify a set number of threads.  <a href="#affb887ea65f72e5efedfa4f2a9918a5d">More...</a><br /></td></tr>
<tr class="separator:affb887ea65f72e5efedfa4f2a9918a5d"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="var-members"></a>
Variables</h2></td></tr>
<tr class="memitem:a1ffa8804dc56390ba80054d2bac56e11"><td class="memItemLeft" align="right" valign="top">static struct <a class="el" href="../../d0/d01/structast__taskprocessor__listener__callbacks.html">ast_taskprocessor_listener_callbacks</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/dc7/threadpool_8c.html#a1ffa8804dc56390ba80054d2bac56e11">serializer_tps_listener_callbacks</a></td></tr>
<tr class="separator:a1ffa8804dc56390ba80054d2bac56e11"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a54b2045c1d47ecd3404aba214a0e0ab4"><td class="memItemLeft" align="right" valign="top">static struct <a class="el" href="../../d0/d01/structast__taskprocessor__listener__callbacks.html">ast_taskprocessor_listener_callbacks</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/dc7/threadpool_8c.html#a54b2045c1d47ecd3404aba214a0e0ab4">threadpool_tps_listener_callbacks</a></td></tr>
<tr class="memdesc:a54b2045c1d47ecd3404aba214a0e0ab4"><td class="mdescLeft">&#160;</td><td class="mdescRight">Table of taskprocessor listener callbacks for threadpool's main taskprocessor.  <a href="#a54b2045c1d47ecd3404aba214a0e0ab4">More...</a><br /></td></tr>
<tr class="separator:a54b2045c1d47ecd3404aba214a0e0ab4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7ae6eaefcacec74737f4dbb8ec01eaf7"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/dc7/threadpool_8c.html#a7ae6eaefcacec74737f4dbb8ec01eaf7">worker_id_counter</a></td></tr>
<tr class="separator:a7ae6eaefcacec74737f4dbb8ec01eaf7"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<h2 class="groupheader">Macro Definition Documentation</h2>
<a id="acfc62009ad38b3c3b15f1ac934bf25d0"></a>
<h2 class="memtitle"><span class="permalink"><a href="#acfc62009ad38b3c3b15f1ac934bf25d0">&#9670;&nbsp;</a></span>THREAD_BUCKETS</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define THREAD_BUCKETS&#160;&#160;&#160;89</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="../../d1/dc7/threadpool_8c_source.html#l00028">28</a> of file <a class="el" href="../../d1/dc7/threadpool_8c_source.html">threadpool.c</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../d1/dc7/threadpool_8c_source.html#l00404">threadpool_alloc()</a>.</p>

</div>
</div>
<h2 class="groupheader">Enumeration Type Documentation</h2>
<a id="a74d6a8e9b05f036ec5b86d00abaffea6"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a74d6a8e9b05f036ec5b86d00abaffea6">&#9670;&nbsp;</a></span>worker_state</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">enum <a class="el" href="../../d1/dc7/threadpool_8c.html#a74d6a8e9b05f036ec5b86d00abaffea6">worker_state</a></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>states for worker threads </p>
<table class="fieldtable">
<tr><th colspan="2">Enumerator</th></tr><tr><td class="fieldname"><a id="a74d6a8e9b05f036ec5b86d00abaffea6a4f34c5c191d6e0d028ca831b6c0b1571"></a>ALIVE&#160;</td><td class="fielddoc"><p>The worker is either active or idle </p>
</td></tr>
<tr><td class="fieldname"><a id="a74d6a8e9b05f036ec5b86d00abaffea6a5dfb36109b24f39d54d5c3f48f53def8"></a>ZOMBIE&#160;</td><td class="fielddoc"><p>The worker has been asked to shut down but may still be in the process of executing tasks. This transition happens when the threadpool needs to shrink and needs to kill active threads in order to do so. </p>
</td></tr>
<tr><td class="fieldname"><a id="a74d6a8e9b05f036ec5b86d00abaffea6a11fd9ca455f92c69c084484d5cd803c2"></a>DEAD&#160;</td><td class="fielddoc"><p>The worker has been asked to shut down. Typically only idle threads go to this state directly, but active threads may go straight to this state when the threadpool is shut down. </p>
</td></tr>
</table>

<p class="definition">Definition at line <a class="el" href="../../d1/dc7/threadpool_8c_source.html#l00120">120</a> of file <a class="el" href="../../d1/dc7/threadpool_8c_source.html">threadpool.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;                  {<span class="comment"></span></div><div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;<span class="comment">   /*! The worker is either active or idle */</span></div><div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;   <a class="code" href="../../d1/dc7/threadpool_8c.html#a74d6a8e9b05f036ec5b86d00abaffea6a4f34c5c191d6e0d028ca831b6c0b1571">ALIVE</a>,<span class="comment"></span></div><div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;<span class="comment">   /*!</span></div><div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;<span class="comment">    * The worker has been asked to shut down but</span></div><div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;<span class="comment">    * may still be in the process of executing tasks.</span></div><div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;<span class="comment">    * This transition happens when the threadpool needs</span></div><div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;<span class="comment">    * to shrink and needs to kill active threads in order</span></div><div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;<span class="comment">    * to do so.</span></div><div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;<span class="comment">    */</span></div><div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;   <a class="code" href="../../d1/dc7/threadpool_8c.html#a74d6a8e9b05f036ec5b86d00abaffea6a5dfb36109b24f39d54d5c3f48f53def8">ZOMBIE</a>,<span class="comment"></span></div><div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;<span class="comment">   /*!</span></div><div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;<span class="comment">    * The worker has been asked to shut down. Typically</span></div><div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;<span class="comment">    * only idle threads go to this state directly, but</span></div><div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;<span class="comment">    * active threads may go straight to this state when</span></div><div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;<span class="comment">    * the threadpool is shut down.</span></div><div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;<span class="comment">    */</span></div><div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;   <a class="code" href="../../d1/dc7/threadpool_8c.html#a74d6a8e9b05f036ec5b86d00abaffea6a11fd9ca455f92c69c084484d5cd803c2">DEAD</a>,</div><div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;};</div><div class="ttc" id="threadpool_8c_html_a74d6a8e9b05f036ec5b86d00abaffea6a5dfb36109b24f39d54d5c3f48f53def8"><div class="ttname"><a href="../../d1/dc7/threadpool_8c.html#a74d6a8e9b05f036ec5b86d00abaffea6a5dfb36109b24f39d54d5c3f48f53def8">ZOMBIE</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d1/dc7/threadpool_8c_source.html#l00130">threadpool.c:130</a></div></div>
<div class="ttc" id="threadpool_8c_html_a74d6a8e9b05f036ec5b86d00abaffea6a11fd9ca455f92c69c084484d5cd803c2"><div class="ttname"><a href="../../d1/dc7/threadpool_8c.html#a74d6a8e9b05f036ec5b86d00abaffea6a11fd9ca455f92c69c084484d5cd803c2">DEAD</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d1/dc7/threadpool_8c_source.html#l00137">threadpool.c:137</a></div></div>
<div class="ttc" id="threadpool_8c_html_a74d6a8e9b05f036ec5b86d00abaffea6a4f34c5c191d6e0d028ca831b6c0b1571"><div class="ttname"><a href="../../d1/dc7/threadpool_8c.html#a74d6a8e9b05f036ec5b86d00abaffea6a4f34c5c191d6e0d028ca831b6c0b1571">ALIVE</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d1/dc7/threadpool_8c_source.html#l00122">threadpool.c:122</a></div></div>
</div><!-- fragment -->
</div>
</div>
<h2 class="groupheader">Function Documentation</h2>
<a id="a180728fe1bdbe0895097666c4bad2999"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a180728fe1bdbe0895097666c4bad2999">&#9670;&nbsp;</a></span>activate_thread()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int activate_thread </td>
          <td>(</td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>obj</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>arg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>flags</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Activate idle threads. </p>
<p>This function always returns CMP_MATCH because all workers that this function acts on need to be seen as matches so they are unlinked from the list of idle threads.</p>
<p>Called as an ao2_callback in the threadpool's control taskprocessor thread. </p><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">obj</td><td>The worker to activate </td></tr>
    <tr><td class="paramname">arg</td><td>The pool where the worker belongs </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">CMP_MATCH</td><td></td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="../../d1/dc7/threadpool_8c_source.html#l00491">491</a> of file <a class="el" href="../../d1/dc7/threadpool_8c_source.html">threadpool.c</a>.</p>

<p class="reference">References <a class="el" href="../../d1/dc7/threadpool_8c_source.html#l00043">ast_threadpool::active_threads</a>, <a class="el" href="../../d1/dc7/threadpool_8c_source.html#l00122">ALIVE</a>, <a class="el" href="../../d5/da5/astobj2_8h_source.html#l01549">ao2_link</a>, <a class="el" href="../../d5/da5/astobj2_8h_source.html#l01598">ao2_unlink</a>, <a class="el" href="../../d1/d8c/logger_8h_source.html#l00452">ast_debug</a>, <a class="el" href="../../da/df7/astobj2_8c_source.html#l00042">ast_log</a>, <a class="el" href="../../d5/da5/astobj2_8h_source.html#l01031">CMP_MATCH</a>, <a class="el" href="../../d1/dc7/threadpool_8c_source.html#l00145">worker_thread::id</a>, <a class="el" href="../../d1/d8c/logger_8h_source.html#l00274">LOG_WARNING</a>, <a class="el" href="../../d9/d21/res__rtp__asterisk_8c_source.html#l00236">pool</a>, and <a class="el" href="../../d1/dc7/threadpool_8c_source.html#l01186">worker_set_state()</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../d1/dc7/threadpool_8c_source.html#l00838">queued_set_size()</a>, and <a class="el" href="../../d1/dc7/threadpool_8c_source.html#l00564">queued_task_pushed()</a>.</p>
<div class="fragment"><div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;{</div><div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../dd/d5b/structworker__thread.html">worker_thread</a> *worker = obj;</div><div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d5/d10/structast__threadpool.html">ast_threadpool</a> *<a class="code" href="../../d9/d21/res__rtp__asterisk_8c.html#a2e57658a5d3ef6c4ef2774c9d5868e7c">pool</a> = arg;</div><div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;</div><div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;   <span class="keywordflow">if</span> (!<a class="code" href="../../d5/da5/astobj2_8h.html#a1ad9f122bcae95a470639402faa3d2ee">ao2_link</a>(pool-&gt;<a class="code" href="../../d5/d10/structast__threadpool.html#af151fe496c19e89e750605192e7726c8">active_threads</a>, worker)) {</div><div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;      <span class="comment">/* If we can&#39;t link the idle thread into the active container, then</span></div><div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;<span class="comment">       * we&#39;ll just leave the thread idle and not wake it up.</span></div><div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;<span class="comment">       */</span></div><div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Failed to activate thread %d. Remaining idle\n&quot;</span>,</div><div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;            worker-&gt;<a class="code" href="../../dd/d5b/structworker__thread.html#a7441ef0865bcb3db9b8064dd7375c1ea">id</a>);</div><div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;      <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;   }</div><div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;</div><div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d1/dc7/threadpool_8c.html#a5513b88136117cc6c4c7d146c226bf86">worker_set_state</a>(worker, <a class="code" href="../../d1/dc7/threadpool_8c.html#a74d6a8e9b05f036ec5b86d00abaffea6a4f34c5c191d6e0d028ca831b6c0b1571">ALIVE</a>)) {</div><div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;      <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(1, <span class="stringliteral">&quot;Failed to activate thread %d. It is dead\n&quot;</span>,</div><div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;            worker-&gt;<a class="code" href="../../dd/d5b/structworker__thread.html#a7441ef0865bcb3db9b8064dd7375c1ea">id</a>);</div><div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;      <span class="comment">/* The worker thread will no longer exist in the active threads or</span></div><div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;<span class="comment">       * idle threads container after this.</span></div><div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;<span class="comment">       */</span></div><div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;      <a class="code" href="../../d5/da5/astobj2_8h.html#a64f51be4bee35c38dbe59b0a788b5ce8">ao2_unlink</a>(pool-&gt;<a class="code" href="../../d5/d10/structast__threadpool.html#af151fe496c19e89e750605192e7726c8">active_threads</a>, worker);</div><div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;   }</div><div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;</div><div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;   <span class="keywordflow">return</span> <a class="code" href="../../d5/da5/astobj2_8h.html#a1f8b41308be4c47de8ff89a3b9c7e7d1a1959468a3c5d6aecd2fa1272d8e30fbf">CMP_MATCH</a>;</div><div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;}</div><div class="ttc" id="logger_8h_html_adf4476a6a4ea6c74231c826e899d7189"><div class="ttname"><a href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a></div><div class="ttdeci">#define LOG_WARNING</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d8c/logger_8h_source.html#l00274">logger.h:274</a></div></div>
<div class="ttc" id="structworker__thread_html"><div class="ttname"><a href="../../dd/d5b/structworker__thread.html">worker_thread</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d1/dc7/threadpool_8c_source.html#l00143">threadpool.c:143</a></div></div>
<div class="ttc" id="res__rtp__asterisk_8c_html_a2e57658a5d3ef6c4ef2774c9d5868e7c"><div class="ttname"><a href="../../d9/d21/res__rtp__asterisk_8c.html#a2e57658a5d3ef6c4ef2774c9d5868e7c">pool</a></div><div class="ttdeci">static pj_pool_t * pool</div><div class="ttdoc">Global memory pool for configuration and timers. </div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d21/res__rtp__asterisk_8c_source.html#l00236">res_rtp_asterisk.c:236</a></div></div>
<div class="ttc" id="structworker__thread_html_a7441ef0865bcb3db9b8064dd7375c1ea"><div class="ttname"><a href="../../dd/d5b/structworker__thread.html#a7441ef0865bcb3db9b8064dd7375c1ea">worker_thread::id</a></div><div class="ttdeci">int id</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/dc7/threadpool_8c_source.html#l00145">threadpool.c:145</a></div></div>
<div class="ttc" id="logger_8h_html_a3f248112c8d6ce7e3959aa723dade648"><div class="ttname"><a href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a></div><div class="ttdeci">#define ast_debug(level,...)</div><div class="ttdoc">Log a DEBUG message. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d8c/logger_8h_source.html#l00452">logger.h:452</a></div></div>
<div class="ttc" id="astobj2_8c_html_a96a00b3a518d7f32b6d51dc28f09bf9b"><div class="ttname"><a href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a></div><div class="ttdeci">#define ast_log</div><div class="ttdef"><b>Definition:</b> <a href="../../da/df7/astobj2_8c_source.html#l00042">astobj2.c:42</a></div></div>
<div class="ttc" id="astobj2_8h_html_a1f8b41308be4c47de8ff89a3b9c7e7d1a1959468a3c5d6aecd2fa1272d8e30fbf"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#a1f8b41308be4c47de8ff89a3b9c7e7d1a1959468a3c5d6aecd2fa1272d8e30fbf">CMP_MATCH</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l01031">astobj2.h:1031</a></div></div>
<div class="ttc" id="astobj2_8h_html_a64f51be4bee35c38dbe59b0a788b5ce8"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#a64f51be4bee35c38dbe59b0a788b5ce8">ao2_unlink</a></div><div class="ttdeci">#define ao2_unlink(container, obj)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l01598">astobj2.h:1598</a></div></div>
<div class="ttc" id="threadpool_8c_html_a5513b88136117cc6c4c7d146c226bf86"><div class="ttname"><a href="../../d1/dc7/threadpool_8c.html#a5513b88136117cc6c4c7d146c226bf86">worker_set_state</a></div><div class="ttdeci">static int worker_set_state(struct worker_thread *worker, enum worker_state state)</div><div class="ttdoc">Change a worker&amp;#39;s state. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/dc7/threadpool_8c_source.html#l01186">threadpool.c:1186</a></div></div>
<div class="ttc" id="structast__threadpool_html_af151fe496c19e89e750605192e7726c8"><div class="ttname"><a href="../../d5/d10/structast__threadpool.html#af151fe496c19e89e750605192e7726c8">ast_threadpool::active_threads</a></div><div class="ttdeci">struct ao2_container * active_threads</div><div class="ttdoc">The container of active threads. Active threads are those that are currently running tasks...</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/dc7/threadpool_8c_source.html#l00043">threadpool.c:43</a></div></div>
<div class="ttc" id="structast__threadpool_html"><div class="ttname"><a href="../../d5/d10/structast__threadpool.html">ast_threadpool</a></div><div class="ttdoc">An opaque threadpool structure. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/dc7/threadpool_8c_source.html#l00036">threadpool.c:36</a></div></div>
<div class="ttc" id="threadpool_8c_html_a74d6a8e9b05f036ec5b86d00abaffea6a4f34c5c191d6e0d028ca831b6c0b1571"><div class="ttname"><a href="../../d1/dc7/threadpool_8c.html#a74d6a8e9b05f036ec5b86d00abaffea6a4f34c5c191d6e0d028ca831b6c0b1571">ALIVE</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d1/dc7/threadpool_8c_source.html#l00122">threadpool.c:122</a></div></div>
<div class="ttc" id="astobj2_8h_html_a1ad9f122bcae95a470639402faa3d2ee"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#a1ad9f122bcae95a470639402faa3d2ee">ao2_link</a></div><div class="ttdeci">#define ao2_link(container, obj)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l01549">astobj2.h:1549</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a26d6e398621cb8b8d2e1066b0393944a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a26d6e398621cb8b8d2e1066b0393944a">&#9670;&nbsp;</a></span>ast_serializer_shutdown_group_alloc()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="../../dc/d82/structast__serializer__shutdown__group.html">ast_serializer_shutdown_group</a>* ast_serializer_shutdown_group_alloc </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Create a serializer group shutdown control object. </p>
<dl class="section since"><dt>Since</dt><dd>13.5.0</dd></dl>
<dl class="section return"><dt>Returns</dt><dd>ao2 object to control shutdown of a serializer group. </dd></dl>

<p class="definition">Definition at line <a class="el" href="../../d1/dc7/threadpool_8c_source.html#l01229">1229</a> of file <a class="el" href="../../d1/dc7/threadpool_8c_source.html">threadpool.c</a>.</p>

<p class="reference">References <a class="el" href="../../d5/da5/astobj2_8h_source.html#l00411">ao2_alloc</a>, <a class="el" href="../../dd/d42/lock_8h_source.html#l00199">ast_cond_init</a>, <a class="el" href="../../d1/dc7/threadpool_8c_source.html#l01217">ast_serializer_shutdown_group::cond</a>, <a class="el" href="../../dc/d7f/resample_8c_source.html#l00096">NULL</a>, <a class="el" href="../../d1/dc7/threadpool_8c_source.html#l01222">serializer_shutdown_group_dtor()</a>, and <a class="el" href="../../df/dda/pjsip__options_8c_source.html#l00129">shutdown_group</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../d6/dd3/serializer_8c_source.html#l00076">ast_serializer_pool_create()</a>, <a class="el" href="../../df/d3a/res__pjsip__outbound__publish_8c_source.html#l01647">load_module()</a>, and <a class="el" href="../../df/dda/pjsip__options_8c_source.html#l02885">sip_options_init_task()</a>.</p>
<div class="fragment"><div class="line"><a name="l01230"></a><span class="lineno"> 1230</span>&#160;{</div><div class="line"><a name="l01231"></a><span class="lineno"> 1231</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../dc/d82/structast__serializer__shutdown__group.html">ast_serializer_shutdown_group</a> *<a class="code" href="../../df/dda/pjsip__options_8c.html#a2c3d0057b62bfa5b08fe977478749c24">shutdown_group</a>;</div><div class="line"><a name="l01232"></a><span class="lineno"> 1232</span>&#160;</div><div class="line"><a name="l01233"></a><span class="lineno"> 1233</span>&#160;   shutdown_group = <a class="code" href="../../d5/da5/astobj2_8h.html#ae0422b60d8e25b6962b2d61ae4ddf724">ao2_alloc</a>(<span class="keyword">sizeof</span>(*shutdown_group), <a class="code" href="../../d1/dc7/threadpool_8c.html#a32f9d04cf2e48a22a1bf4c0c035ed8c1">serializer_shutdown_group_dtor</a>);</div><div class="line"><a name="l01234"></a><span class="lineno"> 1234</span>&#160;   <span class="keywordflow">if</span> (!shutdown_group) {</div><div class="line"><a name="l01235"></a><span class="lineno"> 1235</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l01236"></a><span class="lineno"> 1236</span>&#160;   }</div><div class="line"><a name="l01237"></a><span class="lineno"> 1237</span>&#160;   <a class="code" href="../../dd/d42/lock_8h.html#a69e9591803d36f5683eb9b084442be9b">ast_cond_init</a>(&amp;shutdown_group-&gt;<a class="code" href="../../dc/d82/structast__serializer__shutdown__group.html#a1c7181c39f99ee801943a0d0aa9872b9">cond</a>, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div><div class="line"><a name="l01238"></a><span class="lineno"> 1238</span>&#160;   <span class="keywordflow">return</span> <a class="code" href="../../df/dda/pjsip__options_8c.html#a2c3d0057b62bfa5b08fe977478749c24">shutdown_group</a>;</div><div class="line"><a name="l01239"></a><span class="lineno"> 1239</span>&#160;}</div><div class="ttc" id="structast__serializer__shutdown__group_html_a1c7181c39f99ee801943a0d0aa9872b9"><div class="ttname"><a href="../../dc/d82/structast__serializer__shutdown__group.html#a1c7181c39f99ee801943a0d0aa9872b9">ast_serializer_shutdown_group::cond</a></div><div class="ttdeci">ast_cond_t cond</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/dc7/threadpool_8c_source.html#l01217">threadpool.c:1217</a></div></div>
<div class="ttc" id="lock_8h_html_a69e9591803d36f5683eb9b084442be9b"><div class="ttname"><a href="../../dd/d42/lock_8h.html#a69e9591803d36f5683eb9b084442be9b">ast_cond_init</a></div><div class="ttdeci">#define ast_cond_init(cond, attr)</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d42/lock_8h_source.html#l00199">lock.h:199</a></div></div>
<div class="ttc" id="resample_8c_html_a070d2ce7b6bb7e5c05602aa8c308d0c4"><div class="ttname"><a href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a></div><div class="ttdeci">#define NULL</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d7f/resample_8c_source.html#l00096">resample.c:96</a></div></div>
<div class="ttc" id="astobj2_8h_html_ae0422b60d8e25b6962b2d61ae4ddf724"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#ae0422b60d8e25b6962b2d61ae4ddf724">ao2_alloc</a></div><div class="ttdeci">#define ao2_alloc(data_size, destructor_fn)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l00411">astobj2.h:411</a></div></div>
<div class="ttc" id="threadpool_8c_html_a32f9d04cf2e48a22a1bf4c0c035ed8c1"><div class="ttname"><a href="../../d1/dc7/threadpool_8c.html#a32f9d04cf2e48a22a1bf4c0c035ed8c1">serializer_shutdown_group_dtor</a></div><div class="ttdeci">static void serializer_shutdown_group_dtor(void *vdoomed)</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/dc7/threadpool_8c_source.html#l01222">threadpool.c:1222</a></div></div>
<div class="ttc" id="pjsip__options_8c_html_a2c3d0057b62bfa5b08fe977478749c24"><div class="ttname"><a href="../../df/dda/pjsip__options_8c.html#a2c3d0057b62bfa5b08fe977478749c24">shutdown_group</a></div><div class="ttdeci">static struct ast_serializer_shutdown_group * shutdown_group</div><div class="ttdoc">Shutdown group for options serializers. </div><div class="ttdef"><b>Definition:</b> <a href="../../df/dda/pjsip__options_8c_source.html#l00129">pjsip_options.c:129</a></div></div>
<div class="ttc" id="structast__serializer__shutdown__group_html"><div class="ttname"><a href="../../dc/d82/structast__serializer__shutdown__group.html">ast_serializer_shutdown_group</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d1/dc7/threadpool_8c_source.html#l01215">threadpool.c:1215</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="ab8cbf6d9f2f9964fc6225a73cc287441"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab8cbf6d9f2f9964fc6225a73cc287441">&#9670;&nbsp;</a></span>ast_serializer_shutdown_group_join()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ast_serializer_shutdown_group_join </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="../../dc/d82/structast__serializer__shutdown__group.html">ast_serializer_shutdown_group</a> *&#160;</td>
          <td class="paramname"><em>shutdown_group</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>timeout</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Wait for the serializers in the group to shutdown with timeout. </p>
<dl class="section since"><dt>Since</dt><dd>13.5.0</dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">shutdown_group</td><td>Group shutdown controller. (Returns 0 immediately if NULL) </td></tr>
    <tr><td class="paramname">timeout</td><td>Number of seconds to wait for the serializers in the group to shutdown. Zero if the timeout is disabled.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>Number of seriaizers that did not get shutdown within the timeout. </dd></dl>

<p class="definition">Definition at line <a class="el" href="../../d1/dc7/threadpool_8c_source.html#l01241">1241</a> of file <a class="el" href="../../d1/dc7/threadpool_8c_source.html">threadpool.c</a>.</p>

<p class="reference">References <a class="el" href="../../d5/da5/astobj2_8h_source.html#l00718">ao2_lock</a>, <a class="el" href="../../da/df7/astobj2_8c_source.html#l00476">ao2_object_get_lockaddr()</a>, <a class="el" href="../../d5/da5/astobj2_8h_source.html#l00730">ao2_unlock</a>, <a class="el" href="../../d5/d60/utils_8h_source.html#l00695">ast_assert</a>, <a class="el" href="../../dd/d42/lock_8h_source.html#l00204">ast_cond_timedwait</a>, <a class="el" href="../../dd/d42/lock_8h_source.html#l00203">ast_cond_wait</a>, <a class="el" href="../../de/df7/time_8h_source.html#l00150">ast_tvnow()</a>, <a class="el" href="../../d1/dc7/threadpool_8c_source.html#l01217">ast_serializer_shutdown_group::cond</a>, <a class="el" href="../../d1/dc7/threadpool_8c_source.html#l01219">ast_serializer_shutdown_group::count</a>, <a class="el" href="../../df/d44/app__meetme_8c_source.html#l01091">lock</a>, <a class="el" href="../../dc/d7f/resample_8c_source.html#l00096">NULL</a>, and <a class="el" href="../../d0/d29/cdr__mysql_8c_source.html#l00086">timeout</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../df/dda/pjsip__options_8c_source.html#l02835">ast_res_pjsip_cleanup_options_handling()</a>, <a class="el" href="../../d6/dd3/serializer_8c_source.html#l00039">ast_serializer_pool_destroy()</a>, and <a class="el" href="../../df/d3a/res__pjsip__outbound__publish_8c_source.html#l01622">unload_module()</a>.</p>
<div class="fragment"><div class="line"><a name="l01242"></a><span class="lineno"> 1242</span>&#160;{</div><div class="line"><a name="l01243"></a><span class="lineno"> 1243</span>&#160;   <span class="keywordtype">int</span> remaining;</div><div class="line"><a name="l01244"></a><span class="lineno"> 1244</span>&#160;   <a class="code" href="../../d8/dc5/structast__mutex__info.html">ast_mutex_t</a> *<a class="code" href="../../df/d44/app__meetme_8c.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>;</div><div class="line"><a name="l01245"></a><span class="lineno"> 1245</span>&#160;</div><div class="line"><a name="l01246"></a><span class="lineno"> 1246</span>&#160;   <span class="keywordflow">if</span> (!shutdown_group) {</div><div class="line"><a name="l01247"></a><span class="lineno"> 1247</span>&#160;      <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l01248"></a><span class="lineno"> 1248</span>&#160;   }</div><div class="line"><a name="l01249"></a><span class="lineno"> 1249</span>&#160;</div><div class="line"><a name="l01250"></a><span class="lineno"> 1250</span>&#160;   lock = <a class="code" href="../../d5/da5/astobj2_8h.html#a503b6c7ced96f9b56ec59c115cbeb29a">ao2_object_get_lockaddr</a>(shutdown_group);</div><div class="line"><a name="l01251"></a><span class="lineno"> 1251</span>&#160;   <a class="code" href="../../d5/d60/utils_8h.html#a24374da24af1931d8a7ccde5b352bb2c">ast_assert</a>(lock != <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div><div class="line"><a name="l01252"></a><span class="lineno"> 1252</span>&#160;</div><div class="line"><a name="l01253"></a><span class="lineno"> 1253</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#aa9fdb5d0a6157a56060d9f7279fe6c49">ao2_lock</a>(shutdown_group);</div><div class="line"><a name="l01254"></a><span class="lineno"> 1254</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d0/d29/cdr__mysql_8c.html#a493b57f443cc38b3d3df9c1e584d9d82">timeout</a>) {</div><div class="line"><a name="l01255"></a><span class="lineno"> 1255</span>&#160;      <span class="keyword">struct </span>timeval start;</div><div class="line"><a name="l01256"></a><span class="lineno"> 1256</span>&#160;      <span class="keyword">struct </span>timespec <a class="code" href="../../dd/d7c/eagi__proxy_8c.html#a8fd806ad19b8f5513a4cf18cbf77532c">end</a>;</div><div class="line"><a name="l01257"></a><span class="lineno"> 1257</span>&#160;</div><div class="line"><a name="l01258"></a><span class="lineno"> 1258</span>&#160;      start = <a class="code" href="../../de/df7/time_8h.html#ad3899efb6f0e348556ef69f5b16aa7f7">ast_tvnow</a>();</div><div class="line"><a name="l01259"></a><span class="lineno"> 1259</span>&#160;      <a class="code" href="../../dd/d7c/eagi__proxy_8c.html#a8fd806ad19b8f5513a4cf18cbf77532c">end</a>.tv_sec = start.tv_sec + <a class="code" href="../../d0/d29/cdr__mysql_8c.html#a493b57f443cc38b3d3df9c1e584d9d82">timeout</a>;</div><div class="line"><a name="l01260"></a><span class="lineno"> 1260</span>&#160;      <a class="code" href="../../dd/d7c/eagi__proxy_8c.html#a8fd806ad19b8f5513a4cf18cbf77532c">end</a>.tv_nsec = start.tv_usec * 1000;</div><div class="line"><a name="l01261"></a><span class="lineno"> 1261</span>&#160;      <span class="keywordflow">while</span> (shutdown_group-&gt;<a class="code" href="../../dc/d82/structast__serializer__shutdown__group.html#ad43c3812e6d13e0518d9f8b8f463ffcf">count</a>) {</div><div class="line"><a name="l01262"></a><span class="lineno"> 1262</span>&#160;         <span class="keywordflow">if</span> (<a class="code" href="../../dd/d42/lock_8h.html#a6add1f30b2d53ca9384b15529a6f126e">ast_cond_timedwait</a>(&amp;shutdown_group-&gt;<a class="code" href="../../dc/d82/structast__serializer__shutdown__group.html#a1c7181c39f99ee801943a0d0aa9872b9">cond</a>, lock, &amp;<a class="code" href="../../dd/d7c/eagi__proxy_8c.html#a8fd806ad19b8f5513a4cf18cbf77532c">end</a>)) {</div><div class="line"><a name="l01263"></a><span class="lineno"> 1263</span>&#160;            <span class="comment">/* Error or timed out waiting for the count to reach zero. */</span></div><div class="line"><a name="l01264"></a><span class="lineno"> 1264</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l01265"></a><span class="lineno"> 1265</span>&#160;         }</div><div class="line"><a name="l01266"></a><span class="lineno"> 1266</span>&#160;      }</div><div class="line"><a name="l01267"></a><span class="lineno"> 1267</span>&#160;   } <span class="keywordflow">else</span> {</div><div class="line"><a name="l01268"></a><span class="lineno"> 1268</span>&#160;      <span class="keywordflow">while</span> (shutdown_group-&gt;<a class="code" href="../../dc/d82/structast__serializer__shutdown__group.html#ad43c3812e6d13e0518d9f8b8f463ffcf">count</a>) {</div><div class="line"><a name="l01269"></a><span class="lineno"> 1269</span>&#160;         <span class="keywordflow">if</span> (<a class="code" href="../../dd/d42/lock_8h.html#a36233c5520173c095bf732a788356aee">ast_cond_wait</a>(&amp;shutdown_group-&gt;<a class="code" href="../../dc/d82/structast__serializer__shutdown__group.html#a1c7181c39f99ee801943a0d0aa9872b9">cond</a>, lock)) {</div><div class="line"><a name="l01270"></a><span class="lineno"> 1270</span>&#160;            <span class="comment">/* Error */</span></div><div class="line"><a name="l01271"></a><span class="lineno"> 1271</span>&#160;            <span class="keywordflow">break</span>;</div><div class="line"><a name="l01272"></a><span class="lineno"> 1272</span>&#160;         }</div><div class="line"><a name="l01273"></a><span class="lineno"> 1273</span>&#160;      }</div><div class="line"><a name="l01274"></a><span class="lineno"> 1274</span>&#160;   }</div><div class="line"><a name="l01275"></a><span class="lineno"> 1275</span>&#160;   remaining = shutdown_group-&gt;<a class="code" href="../../dc/d82/structast__serializer__shutdown__group.html#ad43c3812e6d13e0518d9f8b8f463ffcf">count</a>;</div><div class="line"><a name="l01276"></a><span class="lineno"> 1276</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#a9998bd156b936636a8780385e9a910b2">ao2_unlock</a>(shutdown_group);</div><div class="line"><a name="l01277"></a><span class="lineno"> 1277</span>&#160;   <span class="keywordflow">return</span> remaining;</div><div class="line"><a name="l01278"></a><span class="lineno"> 1278</span>&#160;}</div><div class="ttc" id="structast__serializer__shutdown__group_html_ad43c3812e6d13e0518d9f8b8f463ffcf"><div class="ttname"><a href="../../dc/d82/structast__serializer__shutdown__group.html#ad43c3812e6d13e0518d9f8b8f463ffcf">ast_serializer_shutdown_group::count</a></div><div class="ttdeci">int count</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/dc7/threadpool_8c_source.html#l01219">threadpool.c:1219</a></div></div>
<div class="ttc" id="structast__serializer__shutdown__group_html_a1c7181c39f99ee801943a0d0aa9872b9"><div class="ttname"><a href="../../dc/d82/structast__serializer__shutdown__group.html#a1c7181c39f99ee801943a0d0aa9872b9">ast_serializer_shutdown_group::cond</a></div><div class="ttdeci">ast_cond_t cond</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/dc7/threadpool_8c_source.html#l01217">threadpool.c:1217</a></div></div>
<div class="ttc" id="cdr__mysql_8c_html_a493b57f443cc38b3d3df9c1e584d9d82"><div class="ttname"><a href="../../d0/d29/cdr__mysql_8c.html#a493b57f443cc38b3d3df9c1e584d9d82">timeout</a></div><div class="ttdeci">static int timeout</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d29/cdr__mysql_8c_source.html#l00086">cdr_mysql.c:86</a></div></div>
<div class="ttc" id="lock_8h_html_a36233c5520173c095bf732a788356aee"><div class="ttname"><a href="../../dd/d42/lock_8h.html#a36233c5520173c095bf732a788356aee">ast_cond_wait</a></div><div class="ttdeci">#define ast_cond_wait(cond, mutex)</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d42/lock_8h_source.html#l00203">lock.h:203</a></div></div>
<div class="ttc" id="time_8h_html_ad3899efb6f0e348556ef69f5b16aa7f7"><div class="ttname"><a href="../../de/df7/time_8h.html#ad3899efb6f0e348556ef69f5b16aa7f7">ast_tvnow</a></div><div class="ttdeci">struct timeval ast_tvnow(void)</div><div class="ttdoc">Returns current timeval. Meant to replace calls to gettimeofday(). </div><div class="ttdef"><b>Definition:</b> <a href="../../de/df7/time_8h_source.html#l00150">time.h:150</a></div></div>
<div class="ttc" id="utils_8h_html_a24374da24af1931d8a7ccde5b352bb2c"><div class="ttname"><a href="../../d5/d60/utils_8h.html#a24374da24af1931d8a7ccde5b352bb2c">ast_assert</a></div><div class="ttdeci">#define ast_assert(a)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d60/utils_8h_source.html#l00695">utils.h:695</a></div></div>
<div class="ttc" id="astobj2_8h_html_a9998bd156b936636a8780385e9a910b2"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#a9998bd156b936636a8780385e9a910b2">ao2_unlock</a></div><div class="ttdeci">#define ao2_unlock(a)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l00730">astobj2.h:730</a></div></div>
<div class="ttc" id="resample_8c_html_a070d2ce7b6bb7e5c05602aa8c308d0c4"><div class="ttname"><a href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a></div><div class="ttdeci">#define NULL</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d7f/resample_8c_source.html#l00096">resample.c:96</a></div></div>
<div class="ttc" id="eagi__proxy_8c_html_a8fd806ad19b8f5513a4cf18cbf77532c"><div class="ttname"><a href="../../dd/d7c/eagi__proxy_8c.html#a8fd806ad19b8f5513a4cf18cbf77532c">end</a></div><div class="ttdeci">char * end</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d7c/eagi__proxy_8c_source.html#l00073">eagi_proxy.c:73</a></div></div>
<div class="ttc" id="astobj2_8h_html_a503b6c7ced96f9b56ec59c115cbeb29a"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#a503b6c7ced96f9b56ec59c115cbeb29a">ao2_object_get_lockaddr</a></div><div class="ttdeci">void * ao2_object_get_lockaddr(void *obj)</div><div class="ttdoc">Return the mutex lock address of an object. </div><div class="ttdef"><b>Definition:</b> <a href="../../da/df7/astobj2_8c_source.html#l00476">astobj2.c:476</a></div></div>
<div class="ttc" id="app__meetme_8c_html_adf04f66344e3fb0a6f6a69bf39d19902"><div class="ttname"><a href="../../df/d44/app__meetme_8c.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a></div><div class="ttdeci">ast_mutex_t lock</div><div class="ttdef"><b>Definition:</b> <a href="../../df/d44/app__meetme_8c_source.html#l01091">app_meetme.c:1091</a></div></div>
<div class="ttc" id="astobj2_8h_html_aa9fdb5d0a6157a56060d9f7279fe6c49"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#aa9fdb5d0a6157a56060d9f7279fe6c49">ao2_lock</a></div><div class="ttdeci">#define ao2_lock(a)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l00718">astobj2.h:718</a></div></div>
<div class="ttc" id="lock_8h_html_a6add1f30b2d53ca9384b15529a6f126e"><div class="ttname"><a href="../../dd/d42/lock_8h.html#a6add1f30b2d53ca9384b15529a6f126e">ast_cond_timedwait</a></div><div class="ttdeci">#define ast_cond_timedwait(cond, mutex, time)</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d42/lock_8h_source.html#l00204">lock.h:204</a></div></div>
<div class="ttc" id="structast__mutex__info_html"><div class="ttname"><a href="../../d8/dc5/structast__mutex__info.html">ast_mutex_info</a></div><div class="ttdoc">Structure for mutex and tracking information. </div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d42/lock_8h_source.html#l00135">lock.h:135</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="abf6fc4af30779217d37047cbb1fddd1a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#abf6fc4af30779217d37047cbb1fddd1a">&#9670;&nbsp;</a></span>ast_threadpool_create()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="../../d5/d10/structast__threadpool.html">ast_threadpool</a>* ast_threadpool_create </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>name</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="../../dd/d12/structast__threadpool__listener.html">ast_threadpool_listener</a> *&#160;</td>
          <td class="paramname"><em>listener</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const struct <a class="el" href="../../de/de6/structast__threadpool__options.html">ast_threadpool_options</a> *&#160;</td>
          <td class="paramname"><em>options</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Create a new threadpool. </p>
<p>This function creates a threadpool. Tasks may be pushed onto this thread pool and will be automatically acted upon by threads within the pool.</p>
<p>Only a single threadpool with a given name may exist. This function will fail if a threadpool with the given name already exists.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">name</td><td>The unique name for the threadpool </td></tr>
    <tr><td class="paramname">listener</td><td>The listener the threadpool will notify of changes. Can be NULL. </td></tr>
    <tr><td class="paramname">options</td><td>The behavioral options for this threadpool </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">NULL</td><td>Failed to create the threadpool </td></tr>
    <tr><td class="paramname">non-NULL</td><td>The newly-created threadpool </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="../../d1/dc7/threadpool_8c_source.html#l00915">915</a> of file <a class="el" href="../../d1/dc7/threadpool_8c_source.html">threadpool.c</a>.</p>

<p class="reference">References <a class="el" href="../../d5/da5/astobj2_8h_source.html#l01958">ao2_cleanup</a>, <a class="el" href="../../d5/da5/astobj2_8h_source.html#l00464">ao2_ref</a>, <a class="el" href="../../d8/d8a/astmm_8h_source.html#l00290">ast_alloca</a>, <a class="el" href="../../da/df7/astobj2_8c_source.html#l00042">ast_log</a>, <a class="el" href="../../d4/deb/taskprocessor_8c_source.html#l01083">ast_taskprocessor_create_with_listener()</a>, <a class="el" href="../../d4/deb/taskprocessor_8c_source.html#l00930">ast_taskprocessor_listener_alloc()</a>, <a class="el" href="../../d3/d40/threadpool_8h_source.html#l00071">AST_THREADPOOL_OPTIONS_VERSION</a>, <a class="el" href="../../d1/dc7/threadpool_8c_source.html#l00874">ast_threadpool_set_size()</a>, <a class="el" href="../../d1/dc7/threadpool_8c_source.html#l00038">ast_threadpool::listener</a>, <a class="el" href="../../d1/d8c/logger_8h_source.html#l00274">LOG_WARNING</a>, <a class="el" href="../../dc/d7f/resample_8c_source.html#l00096">NULL</a>, <a class="el" href="../../d9/d21/res__rtp__asterisk_8c_source.html#l00236">pool</a>, <a class="el" href="../../d5/d60/utils_8h_source.html#l00911">RAII_VAR</a>, <a class="el" href="../../d1/dc7/threadpool_8c_source.html#l00404">threadpool_alloc()</a>, <a class="el" href="../../d1/dc7/threadpool_8c_source.html#l00067">ast_threadpool::tps</a>, and <a class="el" href="../../d3/d40/threadpool_8h_source.html#l00073">ast_threadpool_options::version</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../d7/d69/sorcery_8c_source.html#l00387">ast_sorcery_init()</a>, <a class="el" href="../../df/df7/test__taskprocessor_8c_source.html#l00901">AST_TEST_DEFINE()</a>, <a class="el" href="../../de/d96/res__pjsip_8c_source.html#l05810">load_module()</a>, and <a class="el" href="../../d0/df4/stasis_8c_source.html#l03061">stasis_init()</a>.</p>
<div class="fragment"><div class="line"><a name="l00918"></a><span class="lineno">  918</span>&#160;{</div><div class="line"><a name="l00919"></a><span class="lineno">  919</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../db/d17/structast__taskprocessor.html">ast_taskprocessor</a> *tps;</div><div class="line"><a name="l00920"></a><span class="lineno">  920</span>&#160;   <a class="code" href="../../d5/d60/utils_8h.html#a1604b4d72144dd3d9f7da668e90337e9">RAII_VAR</a>(<span class="keyword">struct</span> <a class="code" href="../../d7/d52/structast__taskprocessor__listener.html">ast_taskprocessor_listener</a> *, tps_listener, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../d5/da5/astobj2_8h.html#a6321ee982370c55ab3c24c72c562cbdd">ao2_cleanup</a>);</div><div class="line"><a name="l00921"></a><span class="lineno">  921</span>&#160;   <a class="code" href="../../d5/d60/utils_8h.html#a1604b4d72144dd3d9f7da668e90337e9">RAII_VAR</a>(<span class="keyword">struct</span> <a class="code" href="../../d5/d10/structast__threadpool.html">ast_threadpool</a> *, <a class="code" href="../../d9/d21/res__rtp__asterisk_8c.html#a2e57658a5d3ef6c4ef2774c9d5868e7c">pool</a>, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../d5/da5/astobj2_8h.html#a6321ee982370c55ab3c24c72c562cbdd">ao2_cleanup</a>);</div><div class="line"><a name="l00922"></a><span class="lineno">  922</span>&#160;   <span class="keywordtype">char</span> *fullname;</div><div class="line"><a name="l00923"></a><span class="lineno">  923</span>&#160;</div><div class="line"><a name="l00924"></a><span class="lineno">  924</span>&#160;   <a class="code" href="../../d9/d21/res__rtp__asterisk_8c.html#a2e57658a5d3ef6c4ef2774c9d5868e7c">pool</a> = <a class="code" href="../../d1/dc7/threadpool_8c.html#aff29105af0024d75406fe2d09017fa3d">threadpool_alloc</a>(<a class="code" href="../../d0/d29/cdr__mysql_8c.html#a0980a105ccb863d8008eb6201a51da52">name</a>, options);</div><div class="line"><a name="l00925"></a><span class="lineno">  925</span>&#160;   <span class="keywordflow">if</span> (!<a class="code" href="../../d9/d21/res__rtp__asterisk_8c.html#a2e57658a5d3ef6c4ef2774c9d5868e7c">pool</a>) {</div><div class="line"><a name="l00926"></a><span class="lineno">  926</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l00927"></a><span class="lineno">  927</span>&#160;   }</div><div class="line"><a name="l00928"></a><span class="lineno">  928</span>&#160;</div><div class="line"><a name="l00929"></a><span class="lineno">  929</span>&#160;   tps_listener = <a class="code" href="../../d0/d1e/taskprocessor_8h.html#ad7d5e40a1f7eac54dcad096b90d013bd">ast_taskprocessor_listener_alloc</a>(&amp;<a class="code" href="../../d1/dc7/threadpool_8c.html#a54b2045c1d47ecd3404aba214a0e0ab4">threadpool_tps_listener_callbacks</a>, <a class="code" href="../../d9/d21/res__rtp__asterisk_8c.html#a2e57658a5d3ef6c4ef2774c9d5868e7c">pool</a>);</div><div class="line"><a name="l00930"></a><span class="lineno">  930</span>&#160;   <span class="keywordflow">if</span> (!tps_listener) {</div><div class="line"><a name="l00931"></a><span class="lineno">  931</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l00932"></a><span class="lineno">  932</span>&#160;   }</div><div class="line"><a name="l00933"></a><span class="lineno">  933</span>&#160;</div><div class="line"><a name="l00934"></a><span class="lineno">  934</span>&#160;   <span class="keywordflow">if</span> (options-&gt;<a class="code" href="../../de/de6/structast__threadpool__options.html#aad880fc4455c253781e8968f2239d56f">version</a> != <a class="code" href="../../d3/d40/threadpool_8h.html#ae95119c74a92ef5c17f55421b278a25c">AST_THREADPOOL_OPTIONS_VERSION</a>) {</div><div class="line"><a name="l00935"></a><span class="lineno">  935</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Incompatible version of threadpool options in use.\n&quot;</span>);</div><div class="line"><a name="l00936"></a><span class="lineno">  936</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l00937"></a><span class="lineno">  937</span>&#160;   }</div><div class="line"><a name="l00938"></a><span class="lineno">  938</span>&#160;</div><div class="line"><a name="l00939"></a><span class="lineno">  939</span>&#160;   fullname = <a class="code" href="../../d8/d8a/astmm_8h.html#a249282ecc7ba5a1a49fa75e9a33d1717">ast_alloca</a>(strlen(<a class="code" href="../../d0/d29/cdr__mysql_8c.html#a0980a105ccb863d8008eb6201a51da52">name</a>) + strlen(<span class="stringliteral">&quot;/pool&quot;</span>) + 1);</div><div class="line"><a name="l00940"></a><span class="lineno">  940</span>&#160;   sprintf(fullname, <span class="stringliteral">&quot;%s/pool&quot;</span>, <a class="code" href="../../d0/d29/cdr__mysql_8c.html#a0980a105ccb863d8008eb6201a51da52">name</a>); <span class="comment">/* Safe */</span></div><div class="line"><a name="l00941"></a><span class="lineno">  941</span>&#160;   tps = <a class="code" href="../../d0/d1e/taskprocessor_8h.html#ab79575eb73e817bd3afe77c87308e8be">ast_taskprocessor_create_with_listener</a>(fullname, tps_listener);</div><div class="line"><a name="l00942"></a><span class="lineno">  942</span>&#160;   <span class="keywordflow">if</span> (!tps) {</div><div class="line"><a name="l00943"></a><span class="lineno">  943</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l00944"></a><span class="lineno">  944</span>&#160;   }</div><div class="line"><a name="l00945"></a><span class="lineno">  945</span>&#160;</div><div class="line"><a name="l00946"></a><span class="lineno">  946</span>&#160;   <a class="code" href="../../d9/d21/res__rtp__asterisk_8c.html#a2e57658a5d3ef6c4ef2774c9d5868e7c">pool</a>-&gt;tps = tps;</div><div class="line"><a name="l00947"></a><span class="lineno">  947</span>&#160;   <span class="keywordflow">if</span> (listener) {</div><div class="line"><a name="l00948"></a><span class="lineno">  948</span>&#160;      <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(listener, +1);</div><div class="line"><a name="l00949"></a><span class="lineno">  949</span>&#160;      <a class="code" href="../../d9/d21/res__rtp__asterisk_8c.html#a2e57658a5d3ef6c4ef2774c9d5868e7c">pool</a>-&gt;listener = <a class="code" href="../../d5/d03/asterisk_8c.html#adc01bca6281492dfec5ae217cf32fc34">listener</a>;</div><div class="line"><a name="l00950"></a><span class="lineno">  950</span>&#160;   }</div><div class="line"><a name="l00951"></a><span class="lineno">  951</span>&#160;   <a class="code" href="../../d1/dc7/threadpool_8c.html#a13fdc818d975e34cef105d44829a054b">ast_threadpool_set_size</a>(<a class="code" href="../../d9/d21/res__rtp__asterisk_8c.html#a2e57658a5d3ef6c4ef2774c9d5868e7c">pool</a>, <a class="code" href="../../d9/d21/res__rtp__asterisk_8c.html#a2e57658a5d3ef6c4ef2774c9d5868e7c">pool</a>-&gt;options.initial_size);</div><div class="line"><a name="l00952"></a><span class="lineno">  952</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(<a class="code" href="../../d9/d21/res__rtp__asterisk_8c.html#a2e57658a5d3ef6c4ef2774c9d5868e7c">pool</a>, +1);</div><div class="line"><a name="l00953"></a><span class="lineno">  953</span>&#160;   <span class="keywordflow">return</span> <a class="code" href="../../d9/d21/res__rtp__asterisk_8c.html#a2e57658a5d3ef6c4ef2774c9d5868e7c">pool</a>;</div><div class="line"><a name="l00954"></a><span class="lineno">  954</span>&#160;}</div><div class="ttc" id="structast__taskprocessor__listener_html"><div class="ttname"><a href="../../d7/d52/structast__taskprocessor__listener.html">ast_taskprocessor_listener</a></div><div class="ttdoc">A listener for taskprocessors. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/deb/taskprocessor_8c_source.html#l00110">taskprocessor.c:110</a></div></div>
<div class="ttc" id="threadpool_8c_html_a13fdc818d975e34cef105d44829a054b"><div class="ttname"><a href="../../d1/dc7/threadpool_8c.html#a13fdc818d975e34cef105d44829a054b">ast_threadpool_set_size</a></div><div class="ttdeci">void ast_threadpool_set_size(struct ast_threadpool *pool, unsigned int size)</div><div class="ttdoc">Set the number of threads for the thread pool. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/dc7/threadpool_8c_source.html#l00874">threadpool.c:874</a></div></div>
<div class="ttc" id="threadpool_8h_html_ae95119c74a92ef5c17f55421b278a25c"><div class="ttname"><a href="../../d3/d40/threadpool_8h.html#ae95119c74a92ef5c17f55421b278a25c">AST_THREADPOOL_OPTIONS_VERSION</a></div><div class="ttdeci">#define AST_THREADPOOL_OPTIONS_VERSION</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d40/threadpool_8h_source.html#l00071">threadpool.h:71</a></div></div>
<div class="ttc" id="logger_8h_html_adf4476a6a4ea6c74231c826e899d7189"><div class="ttname"><a href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a></div><div class="ttdeci">#define LOG_WARNING</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d8c/logger_8h_source.html#l00274">logger.h:274</a></div></div>
<div class="ttc" id="res__rtp__asterisk_8c_html_a2e57658a5d3ef6c4ef2774c9d5868e7c"><div class="ttname"><a href="../../d9/d21/res__rtp__asterisk_8c.html#a2e57658a5d3ef6c4ef2774c9d5868e7c">pool</a></div><div class="ttdeci">static pj_pool_t * pool</div><div class="ttdoc">Global memory pool for configuration and timers. </div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d21/res__rtp__asterisk_8c_source.html#l00236">res_rtp_asterisk.c:236</a></div></div>
<div class="ttc" id="threadpool_8c_html_aff29105af0024d75406fe2d09017fa3d"><div class="ttname"><a href="../../d1/dc7/threadpool_8c.html#aff29105af0024d75406fe2d09017fa3d">threadpool_alloc</a></div><div class="ttdeci">static struct ast_threadpool * threadpool_alloc(const char *name, const struct ast_threadpool_options *options)</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/dc7/threadpool_8c_source.html#l00404">threadpool.c:404</a></div></div>
<div class="ttc" id="resample_8c_html_a070d2ce7b6bb7e5c05602aa8c308d0c4"><div class="ttname"><a href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a></div><div class="ttdeci">#define NULL</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d7f/resample_8c_source.html#l00096">resample.c:96</a></div></div>
<div class="ttc" id="astobj2_8c_html_a96a00b3a518d7f32b6d51dc28f09bf9b"><div class="ttname"><a href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a></div><div class="ttdeci">#define ast_log</div><div class="ttdef"><b>Definition:</b> <a href="../../da/df7/astobj2_8c_source.html#l00042">astobj2.c:42</a></div></div>
<div class="ttc" id="asterisk_8c_html_adc01bca6281492dfec5ae217cf32fc34"><div class="ttname"><a href="../../d5/d03/asterisk_8c.html#adc01bca6281492dfec5ae217cf32fc34">listener</a></div><div class="ttdeci">static void * listener(void *unused)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d03/asterisk_8c_source.html#l01476">asterisk.c:1476</a></div></div>
<div class="ttc" id="threadpool_8c_html_a54b2045c1d47ecd3404aba214a0e0ab4"><div class="ttname"><a href="../../d1/dc7/threadpool_8c.html#a54b2045c1d47ecd3404aba214a0e0ab4">threadpool_tps_listener_callbacks</a></div><div class="ttdeci">static struct ast_taskprocessor_listener_callbacks threadpool_tps_listener_callbacks</div><div class="ttdoc">Table of taskprocessor listener callbacks for threadpool&amp;#39;s main taskprocessor. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/dc7/threadpool_8c_source.html#l00695">threadpool.c:695</a></div></div>
<div class="ttc" id="utils_8h_html_a1604b4d72144dd3d9f7da668e90337e9"><div class="ttname"><a href="../../d5/d60/utils_8h.html#a1604b4d72144dd3d9f7da668e90337e9">RAII_VAR</a></div><div class="ttdeci">#define RAII_VAR(vartype, varname, initval, dtor)</div><div class="ttdoc">Declare a variable that will call a destructor function when it goes out of scope. </div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d60/utils_8h_source.html#l00911">utils.h:911</a></div></div>
<div class="ttc" id="astobj2_8h_html_aaca5e8eac39a22f9da1c36fc6c922270"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a></div><div class="ttdeci">#define ao2_ref(o, delta)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l00464">astobj2.h:464</a></div></div>
<div class="ttc" id="astmm_8h_html_a249282ecc7ba5a1a49fa75e9a33d1717"><div class="ttname"><a href="../../d8/d8a/astmm_8h.html#a249282ecc7ba5a1a49fa75e9a33d1717">ast_alloca</a></div><div class="ttdeci">#define ast_alloca(size)</div><div class="ttdoc">call __builtin_alloca to ensure we get gcc builtin semantics </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d8a/astmm_8h_source.html#l00290">astmm.h:290</a></div></div>
<div class="ttc" id="cdr__mysql_8c_html_a0980a105ccb863d8008eb6201a51da52"><div class="ttname"><a href="../../d0/d29/cdr__mysql_8c.html#a0980a105ccb863d8008eb6201a51da52">name</a></div><div class="ttdeci">static const char name[]</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d29/cdr__mysql_8c_source.html#l00074">cdr_mysql.c:74</a></div></div>
<div class="ttc" id="structast__threadpool__options_html_aad880fc4455c253781e8968f2239d56f"><div class="ttname"><a href="../../de/de6/structast__threadpool__options.html#aad880fc4455c253781e8968f2239d56f">ast_threadpool_options::version</a></div><div class="ttdeci">int version</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d40/threadpool_8h_source.html#l00073">threadpool.h:73</a></div></div>
<div class="ttc" id="taskprocessor_8h_html_ad7d5e40a1f7eac54dcad096b90d013bd"><div class="ttname"><a href="../../d0/d1e/taskprocessor_8h.html#ad7d5e40a1f7eac54dcad096b90d013bd">ast_taskprocessor_listener_alloc</a></div><div class="ttdeci">struct ast_taskprocessor_listener * ast_taskprocessor_listener_alloc(const struct ast_taskprocessor_listener_callbacks *callbacks, void *user_data)</div><div class="ttdoc">Allocate a taskprocessor listener. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/deb/taskprocessor_8c_source.html#l00930">taskprocessor.c:930</a></div></div>
<div class="ttc" id="structast__taskprocessor_html"><div class="ttname"><a href="../../db/d17/structast__taskprocessor.html">ast_taskprocessor</a></div><div class="ttdoc">A ast_taskprocessor structure is a singleton by name. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/deb/taskprocessor_8c_source.html#l00069">taskprocessor.c:69</a></div></div>
<div class="ttc" id="astobj2_8h_html_a6321ee982370c55ab3c24c72c562cbdd"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#a6321ee982370c55ab3c24c72c562cbdd">ao2_cleanup</a></div><div class="ttdeci">#define ao2_cleanup(obj)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l01958">astobj2.h:1958</a></div></div>
<div class="ttc" id="structast__threadpool_html"><div class="ttname"><a href="../../d5/d10/structast__threadpool.html">ast_threadpool</a></div><div class="ttdoc">An opaque threadpool structure. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/dc7/threadpool_8c_source.html#l00036">threadpool.c:36</a></div></div>
<div class="ttc" id="taskprocessor_8h_html_ab79575eb73e817bd3afe77c87308e8be"><div class="ttname"><a href="../../d0/d1e/taskprocessor_8h.html#ab79575eb73e817bd3afe77c87308e8be">ast_taskprocessor_create_with_listener</a></div><div class="ttdeci">struct ast_taskprocessor * ast_taskprocessor_create_with_listener(const char *name, struct ast_taskprocessor_listener *listener)</div><div class="ttdoc">Create a taskprocessor with a custom listener. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/deb/taskprocessor_8c_source.html#l01083">taskprocessor.c:1083</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a3e1d943184d2d6260b6718e5629bbc24"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3e1d943184d2d6260b6718e5629bbc24">&#9670;&nbsp;</a></span>ast_threadpool_listener_alloc()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="../../dd/d12/structast__threadpool__listener.html">ast_threadpool_listener</a>* ast_threadpool_listener_alloc </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="../../df/d64/structast__threadpool__listener__callbacks.html">ast_threadpool_listener_callbacks</a> *&#160;</td>
          <td class="paramname"><em>callbacks</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>user_data</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Allocate a threadpool listener. </p>
<p>This function will call back into the alloc callback for the listener.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">callbacks</td><td>Listener callbacks to assign to the listener </td></tr>
    <tr><td class="paramname">user_data</td><td>User data to be stored in the threadpool listener </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">NULL</td><td>Failed to allocate the listener </td></tr>
    <tr><td class="paramname">non-NULL</td><td>The newly-created threadpool listener </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="../../d1/dc7/threadpool_8c_source.html#l00893">893</a> of file <a class="el" href="../../d1/dc7/threadpool_8c_source.html">threadpool.c</a>.</p>

<p class="reference">References <a class="el" href="../../d5/da5/astobj2_8h_source.html#l00411">ao2_alloc</a>, <a class="el" href="../../d1/dc7/threadpool_8c_source.html#l00112">ast_threadpool_listener::callbacks</a>, <a class="el" href="../../d1/dc7/threadpool_8c_source.html#l00038">ast_threadpool::listener</a>, <a class="el" href="../../dc/d7f/resample_8c_source.html#l00096">NULL</a>, and <a class="el" href="../../d1/dc7/threadpool_8c_source.html#l00114">ast_threadpool_listener::user_data</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../de/dec/test__threadpool_8c_source.html#l00288">AST_TEST_DEFINE()</a>.</p>
<div class="fragment"><div class="line"><a name="l00895"></a><span class="lineno">  895</span>&#160;{</div><div class="line"><a name="l00896"></a><span class="lineno">  896</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../dd/d12/structast__threadpool__listener.html">ast_threadpool_listener</a> *<a class="code" href="../../d5/d03/asterisk_8c.html#adc01bca6281492dfec5ae217cf32fc34">listener</a> = <a class="code" href="../../d5/da5/astobj2_8h.html#ae0422b60d8e25b6962b2d61ae4ddf724">ao2_alloc</a>(<span class="keyword">sizeof</span>(*listener), <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div><div class="line"><a name="l00897"></a><span class="lineno">  897</span>&#160;   <span class="keywordflow">if</span> (!listener) {</div><div class="line"><a name="l00898"></a><span class="lineno">  898</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l00899"></a><span class="lineno">  899</span>&#160;   }</div><div class="line"><a name="l00900"></a><span class="lineno">  900</span>&#160;   listener-&gt;<a class="code" href="../../dd/d12/structast__threadpool__listener.html#ae47947f47eb99da4337ce95cddd1d614">callbacks</a> = <a class="code" href="../../dd/d12/structast__threadpool__listener.html#ae47947f47eb99da4337ce95cddd1d614">callbacks</a>;</div><div class="line"><a name="l00901"></a><span class="lineno">  901</span>&#160;   listener-&gt;<a class="code" href="../../dd/d12/structast__threadpool__listener.html#a0f53d287ac7c064d1a49d4bd93ca1cb9">user_data</a> = <a class="code" href="../../dd/d12/structast__threadpool__listener.html#a0f53d287ac7c064d1a49d4bd93ca1cb9">user_data</a>;</div><div class="line"><a name="l00902"></a><span class="lineno">  902</span>&#160;   <span class="keywordflow">return</span> <a class="code" href="../../d5/d03/asterisk_8c.html#adc01bca6281492dfec5ae217cf32fc34">listener</a>;</div><div class="line"><a name="l00903"></a><span class="lineno">  903</span>&#160;}</div><div class="ttc" id="resample_8c_html_a070d2ce7b6bb7e5c05602aa8c308d0c4"><div class="ttname"><a href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a></div><div class="ttdeci">#define NULL</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d7f/resample_8c_source.html#l00096">resample.c:96</a></div></div>
<div class="ttc" id="structast__threadpool__listener_html_ae47947f47eb99da4337ce95cddd1d614"><div class="ttname"><a href="../../dd/d12/structast__threadpool__listener.html#ae47947f47eb99da4337ce95cddd1d614">ast_threadpool_listener::callbacks</a></div><div class="ttdeci">const struct ast_threadpool_listener_callbacks * callbacks</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/dc7/threadpool_8c_source.html#l00112">threadpool.c:112</a></div></div>
<div class="ttc" id="asterisk_8c_html_adc01bca6281492dfec5ae217cf32fc34"><div class="ttname"><a href="../../d5/d03/asterisk_8c.html#adc01bca6281492dfec5ae217cf32fc34">listener</a></div><div class="ttdeci">static void * listener(void *unused)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d03/asterisk_8c_source.html#l01476">asterisk.c:1476</a></div></div>
<div class="ttc" id="astobj2_8h_html_ae0422b60d8e25b6962b2d61ae4ddf724"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#ae0422b60d8e25b6962b2d61ae4ddf724">ao2_alloc</a></div><div class="ttdeci">#define ao2_alloc(data_size, destructor_fn)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l00411">astobj2.h:411</a></div></div>
<div class="ttc" id="structast__threadpool__listener_html_a0f53d287ac7c064d1a49d4bd93ca1cb9"><div class="ttname"><a href="../../dd/d12/structast__threadpool__listener.html#a0f53d287ac7c064d1a49d4bd93ca1cb9">ast_threadpool_listener::user_data</a></div><div class="ttdeci">void * user_data</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/dc7/threadpool_8c_source.html#l00114">threadpool.c:114</a></div></div>
<div class="ttc" id="structast__threadpool__listener_html"><div class="ttname"><a href="../../dd/d12/structast__threadpool__listener.html">ast_threadpool_listener</a></div><div class="ttdoc">listener for a threadpool </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/dc7/threadpool_8c_source.html#l00110">threadpool.c:110</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="aa9bee831e887eb53e72a7e161d5c19de"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa9bee831e887eb53e72a7e161d5c19de">&#9670;&nbsp;</a></span>ast_threadpool_listener_get_user_data()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void* ast_threadpool_listener_get_user_data </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="../../dd/d12/structast__threadpool__listener.html">ast_threadpool_listener</a> *&#160;</td>
          <td class="paramname"><em>listener</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Get the threadpool listener's user data. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">listener</td><td>The threadpool listener </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>The user data </dd></dl>

<p class="definition">Definition at line <a class="el" href="../../d1/dc7/threadpool_8c_source.html#l00905">905</a> of file <a class="el" href="../../d1/dc7/threadpool_8c_source.html">threadpool.c</a>.</p>

<p class="reference">References <a class="el" href="../../d1/dc7/threadpool_8c_source.html#l00114">ast_threadpool_listener::user_data</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../de/dec/test__threadpool_8c_source.html#l00241">listener_check()</a>, <a class="el" href="../../de/dec/test__threadpool_8c_source.html#l00089">test_emptied()</a>, <a class="el" href="../../de/dec/test__threadpool_8c_source.html#l00098">test_shutdown()</a>, <a class="el" href="../../de/dec/test__threadpool_8c_source.html#l00064">test_state_changed()</a>, <a class="el" href="../../de/dec/test__threadpool_8c_source.html#l00077">test_task_pushed()</a>, and <a class="el" href="../../de/dec/test__threadpool_8c_source.html#l00177">wait_for_task_pushed()</a>.</p>
<div class="fragment"><div class="line"><a name="l00906"></a><span class="lineno">  906</span>&#160;{</div><div class="line"><a name="l00907"></a><span class="lineno">  907</span>&#160;   <span class="keywordflow">return</span> listener-&gt;<a class="code" href="../../dd/d12/structast__threadpool__listener.html#a0f53d287ac7c064d1a49d4bd93ca1cb9">user_data</a>;</div><div class="line"><a name="l00908"></a><span class="lineno">  908</span>&#160;}</div><div class="ttc" id="structast__threadpool__listener_html_a0f53d287ac7c064d1a49d4bd93ca1cb9"><div class="ttname"><a href="../../dd/d12/structast__threadpool__listener.html#a0f53d287ac7c064d1a49d4bd93ca1cb9">ast_threadpool_listener::user_data</a></div><div class="ttdeci">void * user_data</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/dc7/threadpool_8c_source.html#l00114">threadpool.c:114</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="aa3aac2ce5678c3c1f0750e7990ae68a9"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa3aac2ce5678c3c1f0750e7990ae68a9">&#9670;&nbsp;</a></span>ast_threadpool_push()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ast_threadpool_push </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="../../d5/d10/structast__threadpool.html">ast_threadpool</a> *&#160;</td>
          <td class="paramname"><em>pool</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int(*)(void *data)&#160;</td>
          <td class="paramname"><em>task</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>data</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Push a task to the threadpool. </p>
<p>Tasks pushed into the threadpool will be automatically taken by one of the threads within </p><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">pool</td><td>The threadpool to add the task to </td></tr>
    <tr><td class="paramname">task</td><td>The task to add </td></tr>
    <tr><td class="paramname">data</td><td>The parameter for the task </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">0</td><td>success </td></tr>
    <tr><td class="paramname">-1</td><td>failure </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="../../d1/dc7/threadpool_8c_source.html#l00956">956</a> of file <a class="el" href="../../d1/dc7/threadpool_8c_source.html">threadpool.c</a>.</p>

<p class="reference">References <a class="el" href="../../d4/deb/taskprocessor_8c_source.html#l01175">ast_taskprocessor_push()</a>, <a class="el" href="../../df/d44/app__meetme_8c_source.html#l01091">lock</a>, <a class="el" href="../../dd/d42/lock_8h_source.html#l00602">SCOPED_AO2LOCK</a>, <a class="el" href="../../d1/dc7/threadpool_8c_source.html#l00098">ast_threadpool::shutting_down</a>, <a class="el" href="../../df/df7/test__taskprocessor_8c_source.html#l00088">task()</a>, and <a class="el" href="../../d1/dc7/threadpool_8c_source.html#l00067">ast_threadpool::tps</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../de/dec/test__threadpool_8c_source.html#l00288">AST_TEST_DEFINE()</a>, and <a class="el" href="../../d1/dc7/threadpool_8c_source.html#l01363">serializer_task_pushed()</a>.</p>
<div class="fragment"><div class="line"><a name="l00957"></a><span class="lineno">  957</span>&#160;{</div><div class="line"><a name="l00958"></a><span class="lineno">  958</span>&#160;   <a class="code" href="../../dd/d42/lock_8h.html#a2cfb325ed371eb6e629446bac4676e9f">SCOPED_AO2LOCK</a>(<a class="code" href="../../df/d44/app__meetme_8c.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>, pool);</div><div class="line"><a name="l00959"></a><span class="lineno">  959</span>&#160;   <span class="keywordflow">if</span> (!pool-&gt;<a class="code" href="../../d5/d10/structast__threadpool.html#a7f68568851b9c7f9291f7bb63f932c18">shutting_down</a>) {</div><div class="line"><a name="l00960"></a><span class="lineno">  960</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../d0/d1e/taskprocessor_8h.html#a6b2508ba0a6b8f43ae6d3963f3189585">ast_taskprocessor_push</a>(pool-&gt;<a class="code" href="../../d5/d10/structast__threadpool.html#a4c381cb1b5cf198fa3f260212e716c9a">tps</a>, <a class="code" href="../../df/df7/test__taskprocessor_8c.html#a07d08fd44ac4a9f8e1319ce270f5d56a">task</a>, data);</div><div class="line"><a name="l00961"></a><span class="lineno">  961</span>&#160;   }</div><div class="line"><a name="l00962"></a><span class="lineno">  962</span>&#160;   <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l00963"></a><span class="lineno">  963</span>&#160;}</div><div class="ttc" id="structast__threadpool_html_a7f68568851b9c7f9291f7bb63f932c18"><div class="ttname"><a href="../../d5/d10/structast__threadpool.html#a7f68568851b9c7f9291f7bb63f932c18">ast_threadpool::shutting_down</a></div><div class="ttdeci">int shutting_down</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/dc7/threadpool_8c_source.html#l00098">threadpool.c:98</a></div></div>
<div class="ttc" id="test__taskprocessor_8c_html_a07d08fd44ac4a9f8e1319ce270f5d56a"><div class="ttname"><a href="../../df/df7/test__taskprocessor_8c.html#a07d08fd44ac4a9f8e1319ce270f5d56a">task</a></div><div class="ttdeci">static int task(void *data)</div><div class="ttdoc">Queued task for baseline test. </div><div class="ttdef"><b>Definition:</b> <a href="../../df/df7/test__taskprocessor_8c_source.html#l00088">test_taskprocessor.c:88</a></div></div>
<div class="ttc" id="app__meetme_8c_html_adf04f66344e3fb0a6f6a69bf39d19902"><div class="ttname"><a href="../../df/d44/app__meetme_8c.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a></div><div class="ttdeci">ast_mutex_t lock</div><div class="ttdef"><b>Definition:</b> <a href="../../df/d44/app__meetme_8c_source.html#l01091">app_meetme.c:1091</a></div></div>
<div class="ttc" id="structast__threadpool_html_a4c381cb1b5cf198fa3f260212e716c9a"><div class="ttname"><a href="../../d5/d10/structast__threadpool.html#a4c381cb1b5cf198fa3f260212e716c9a">ast_threadpool::tps</a></div><div class="ttdeci">struct ast_taskprocessor * tps</div><div class="ttdoc">The main taskprocessor. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/dc7/threadpool_8c_source.html#l00067">threadpool.c:67</a></div></div>
<div class="ttc" id="lock_8h_html_a2cfb325ed371eb6e629446bac4676e9f"><div class="ttname"><a href="../../dd/d42/lock_8h.html#a2cfb325ed371eb6e629446bac4676e9f">SCOPED_AO2LOCK</a></div><div class="ttdeci">#define SCOPED_AO2LOCK(varname, obj)</div><div class="ttdoc">scoped lock specialization for ao2 mutexes. </div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d42/lock_8h_source.html#l00602">lock.h:602</a></div></div>
<div class="ttc" id="taskprocessor_8h_html_a6b2508ba0a6b8f43ae6d3963f3189585"><div class="ttname"><a href="../../d0/d1e/taskprocessor_8h.html#a6b2508ba0a6b8f43ae6d3963f3189585">ast_taskprocessor_push</a></div><div class="ttdeci">int ast_taskprocessor_push(struct ast_taskprocessor *tps, int(*task_exe)(void *datap), void *datap) attribute_warn_unused_result</div><div class="ttdoc">Push a task into the specified taskprocessor queue and signal the taskprocessor thread. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/deb/taskprocessor_8c_source.html#l01175">taskprocessor.c:1175</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a6e65e5b2e17e83c008f74b1d93cee2b5"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6e65e5b2e17e83c008f74b1d93cee2b5">&#9670;&nbsp;</a></span>ast_threadpool_queue_size()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">long ast_threadpool_queue_size </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="../../d5/d10/structast__threadpool.html">ast_threadpool</a> *&#160;</td>
          <td class="paramname"><em>pool</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Return the size of the threadpool's task queue. </p>
<dl class="section since"><dt>Since</dt><dd>13.7.0 </dd></dl>

<p class="definition">Definition at line <a class="el" href="../../d1/dc7/threadpool_8c_source.html#l01437">1437</a> of file <a class="el" href="../../d1/dc7/threadpool_8c_source.html">threadpool.c</a>.</p>

<p class="reference">References <a class="el" href="../../d4/deb/taskprocessor_8c_source.html#l00900">ast_taskprocessor_size()</a>, and <a class="el" href="../../d1/dc7/threadpool_8c_source.html#l00067">ast_threadpool::tps</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../de/d96/res__pjsip_8c_source.html#l05625">ast_sip_threadpool_queue_size()</a>.</p>
<div class="fragment"><div class="line"><a name="l01438"></a><span class="lineno"> 1438</span>&#160;{</div><div class="line"><a name="l01439"></a><span class="lineno"> 1439</span>&#160;   <span class="keywordflow">return</span> <a class="code" href="../../d0/d1e/taskprocessor_8h.html#a83d09062fb3c84cf1c84a04174deb2bf">ast_taskprocessor_size</a>(pool-&gt;<a class="code" href="../../d5/d10/structast__threadpool.html#a4c381cb1b5cf198fa3f260212e716c9a">tps</a>);</div><div class="line"><a name="l01440"></a><span class="lineno"> 1440</span>&#160;}</div><div class="ttc" id="taskprocessor_8h_html_a83d09062fb3c84cf1c84a04174deb2bf"><div class="ttname"><a href="../../d0/d1e/taskprocessor_8h.html#a83d09062fb3c84cf1c84a04174deb2bf">ast_taskprocessor_size</a></div><div class="ttdeci">long ast_taskprocessor_size(struct ast_taskprocessor *tps)</div><div class="ttdoc">Return the current size of the taskprocessor queue. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/deb/taskprocessor_8c_source.html#l00900">taskprocessor.c:900</a></div></div>
<div class="ttc" id="structast__threadpool_html_a4c381cb1b5cf198fa3f260212e716c9a"><div class="ttname"><a href="../../d5/d10/structast__threadpool.html#a4c381cb1b5cf198fa3f260212e716c9a">ast_threadpool::tps</a></div><div class="ttdeci">struct ast_taskprocessor * tps</div><div class="ttdoc">The main taskprocessor. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/dc7/threadpool_8c_source.html#l00067">threadpool.c:67</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a6e86f51d34ae17fd6f38b8379883bf87"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6e86f51d34ae17fd6f38b8379883bf87">&#9670;&nbsp;</a></span>ast_threadpool_serializer()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="../../db/d17/structast__taskprocessor.html">ast_taskprocessor</a>* ast_threadpool_serializer </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>name</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="../../d5/d10/structast__threadpool.html">ast_threadpool</a> *&#160;</td>
          <td class="paramname"><em>pool</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Serialized execution of tasks within a <a class="el" href="../../d5/d10/structast__threadpool.html">ast_threadpool</a>. </p>
<dl class="section since"><dt>Since</dt><dd>12.0.0</dd></dl>
<p>A <a class="el" href="../../db/d17/structast__taskprocessor.html">ast_taskprocessor</a> with the same contract as a default taskprocessor (tasks execute serially) except instead of executing out of a dedicated thread, execution occurs in a thread from a <a class="el" href="../../d5/d10/structast__threadpool.html">ast_threadpool</a>. Think of it as a lightweight thread.</p>
<p>While it guarantees that each task will complete before executing the next, there is no guarantee as to which thread from the <code>pool</code> individual tasks will execute. This normally only matters if your code relys on thread specific information, such as thread locals.</p>
<p>Use <a class="el" href="../../d0/d1e/taskprocessor_8h.html#a32492eb2480cb8c46ad669622cff8556" title="Unreference the specified taskprocessor and its reference count will decrement. ">ast_taskprocessor_unreference()</a> to dispose of the returned <a class="el" href="../../db/d17/structast__taskprocessor.html">ast_taskprocessor</a>.</p>
<p>Only a single taskprocessor with a given name may exist. This function will fail if a taskprocessor with the given name already exists.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">name</td><td>Name of the serializer. (must be unique) </td></tr>
    <tr><td class="paramname">pool</td><td><a class="el" href="../../d5/d10/structast__threadpool.html">ast_threadpool</a> for execution.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd><a class="el" href="../../db/d17/structast__taskprocessor.html">ast_taskprocessor</a> for enqueuing work. </dd>
<dd>
<code>NULL</code> on error. </dd></dl>

<p class="definition">Definition at line <a class="el" href="../../d1/dc7/threadpool_8c_source.html#l01432">1432</a> of file <a class="el" href="../../d1/dc7/threadpool_8c_source.html">threadpool.c</a>.</p>

<p class="reference">References <a class="el" href="../../d1/dc7/threadpool_8c_source.html#l01402">ast_threadpool_serializer_group()</a>, and <a class="el" href="../../dc/d7f/resample_8c_source.html#l00096">NULL</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../de/dec/test__threadpool_8c_source.html#l01630">AST_TEST_DEFINE()</a>, <a class="el" href="../../d0/df4/stasis_8c_source.html#l00858">internal_stasis_subscribe()</a>, and <a class="el" href="../../d7/d69/sorcery_8c_source.html#l00700">sorcery_object_type_alloc()</a>.</p>
<div class="fragment"><div class="line"><a name="l01433"></a><span class="lineno"> 1433</span>&#160;{</div><div class="line"><a name="l01434"></a><span class="lineno"> 1434</span>&#160;   <span class="keywordflow">return</span> <a class="code" href="../../d1/dc7/threadpool_8c.html#a49b8fabf465ce8e4f325ceecda8ccd16">ast_threadpool_serializer_group</a>(<a class="code" href="../../d0/d29/cdr__mysql_8c.html#a0980a105ccb863d8008eb6201a51da52">name</a>, pool, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div><div class="line"><a name="l01435"></a><span class="lineno"> 1435</span>&#160;}</div><div class="ttc" id="threadpool_8c_html_a49b8fabf465ce8e4f325ceecda8ccd16"><div class="ttname"><a href="../../d1/dc7/threadpool_8c.html#a49b8fabf465ce8e4f325ceecda8ccd16">ast_threadpool_serializer_group</a></div><div class="ttdeci">struct ast_taskprocessor * ast_threadpool_serializer_group(const char *name, struct ast_threadpool *pool, struct ast_serializer_shutdown_group *shutdown_group)</div><div class="ttdoc">Serialized execution of tasks within a ast_threadpool. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/dc7/threadpool_8c_source.html#l01402">threadpool.c:1402</a></div></div>
<div class="ttc" id="resample_8c_html_a070d2ce7b6bb7e5c05602aa8c308d0c4"><div class="ttname"><a href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a></div><div class="ttdeci">#define NULL</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d7f/resample_8c_source.html#l00096">resample.c:96</a></div></div>
<div class="ttc" id="cdr__mysql_8c_html_a0980a105ccb863d8008eb6201a51da52"><div class="ttname"><a href="../../d0/d29/cdr__mysql_8c.html#a0980a105ccb863d8008eb6201a51da52">name</a></div><div class="ttdeci">static const char name[]</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d29/cdr__mysql_8c_source.html#l00074">cdr_mysql.c:74</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="ad8505fda5adce26c0e2e45de0a0dcb51"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad8505fda5adce26c0e2e45de0a0dcb51">&#9670;&nbsp;</a></span>ast_threadpool_serializer_get_current()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="../../db/d17/structast__taskprocessor.html">ast_taskprocessor</a>* ast_threadpool_serializer_get_current </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Get the threadpool serializer currently associated with this thread. </p>
<dl class="section since"><dt>Since</dt><dd>14.0.0</dd></dl>
<dl class="section note"><dt>Note</dt><dd>The returned pointer is valid while the serializer thread is running.</dd>
<dd>
Use <a class="el" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref()</a> on serializer if you are going to keep it for another thread. To unref it you must then use <a class="el" href="../../d0/d1e/taskprocessor_8h.html#a32492eb2480cb8c46ad669622cff8556" title="Unreference the specified taskprocessor and its reference count will decrement. ">ast_taskprocessor_unreference()</a>.</dd></dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">serializer</td><td>on success. </td></tr>
    <tr><td class="paramname">NULL</td><td>on error or no serializer associated with the thread. </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="../../d1/dc7/threadpool_8c_source.html#l01397">1397</a> of file <a class="el" href="../../d1/dc7/threadpool_8c_source.html">threadpool.c</a>.</p>

<p class="reference">References <a class="el" href="../../dc/d7d/threadstorage_8h_source.html#l00241">ast_threadstorage_get_ptr()</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../d7/dad/pjsip__distributor_8c_source.html#l00077">record_serializer()</a>, <a class="el" href="../../da/d5c/res__pjsip__rfc3326_8c_source.html#l00113">rfc3326_outgoing_request()</a>, <a class="el" href="../../da/d5c/res__pjsip__rfc3326_8c_source.html#l00130">rfc3326_outgoing_response()</a>, and <a class="el" href="../../d4/d43/pjsip__resolver_8c_source.html#l00468">sip_resolve()</a>.</p>
<div class="fragment"><div class="line"><a name="l01398"></a><span class="lineno"> 1398</span>&#160;{</div><div class="line"><a name="l01399"></a><span class="lineno"> 1399</span>&#160;   <span class="keywordflow">return</span> <a class="code" href="../../dc/d7d/threadstorage_8h.html#a273e9e038c879199c4192156b9349169">ast_threadstorage_get_ptr</a>(&amp;current_serializer);</div><div class="line"><a name="l01400"></a><span class="lineno"> 1400</span>&#160;}</div><div class="ttc" id="threadstorage_8h_html_a273e9e038c879199c4192156b9349169"><div class="ttname"><a href="../../dc/d7d/threadstorage_8h.html#a273e9e038c879199c4192156b9349169">ast_threadstorage_get_ptr</a></div><div class="ttdeci">void * ast_threadstorage_get_ptr(struct ast_threadstorage *ts)</div><div class="ttdoc">Retrieve a raw pointer from threadstorage. </div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d7d/threadstorage_8h_source.html#l00241">threadstorage.h:241</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a49b8fabf465ce8e4f325ceecda8ccd16"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a49b8fabf465ce8e4f325ceecda8ccd16">&#9670;&nbsp;</a></span>ast_threadpool_serializer_group()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="../../db/d17/structast__taskprocessor.html">ast_taskprocessor</a>* ast_threadpool_serializer_group </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>name</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="../../d5/d10/structast__threadpool.html">ast_threadpool</a> *&#160;</td>
          <td class="paramname"><em>pool</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="../../dc/d82/structast__serializer__shutdown__group.html">ast_serializer_shutdown_group</a> *&#160;</td>
          <td class="paramname"><em>shutdown_group</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Serialized execution of tasks within a <a class="el" href="../../d5/d10/structast__threadpool.html">ast_threadpool</a>. </p>
<dl class="section since"><dt>Since</dt><dd>13.5.0</dd></dl>
<p>A <a class="el" href="../../db/d17/structast__taskprocessor.html">ast_taskprocessor</a> with the same contract as a default taskprocessor (tasks execute serially) except instead of executing out of a dedicated thread, execution occurs in a thread from a <a class="el" href="../../d5/d10/structast__threadpool.html">ast_threadpool</a>. Think of it as a lightweight thread.</p>
<p>While it guarantees that each task will complete before executing the next, there is no guarantee as to which thread from the <code>pool</code> individual tasks will execute. This normally only matters if your code relys on thread specific information, such as thread locals.</p>
<p>Use <a class="el" href="../../d0/d1e/taskprocessor_8h.html#a32492eb2480cb8c46ad669622cff8556" title="Unreference the specified taskprocessor and its reference count will decrement. ">ast_taskprocessor_unreference()</a> to dispose of the returned <a class="el" href="../../db/d17/structast__taskprocessor.html">ast_taskprocessor</a>.</p>
<p>Only a single taskprocessor with a given name may exist. This function will fail if a taskprocessor with the given name already exists.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">name</td><td>Name of the serializer. (must be unique) </td></tr>
    <tr><td class="paramname">pool</td><td><a class="el" href="../../d5/d10/structast__threadpool.html">ast_threadpool</a> for execution. </td></tr>
    <tr><td class="paramname">shutdown_group</td><td>Group shutdown controller. (NULL if no group association)</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd><a class="el" href="../../db/d17/structast__taskprocessor.html">ast_taskprocessor</a> for enqueuing work. </dd>
<dd>
<code>NULL</code> on error. </dd></dl>

<p class="definition">Definition at line <a class="el" href="../../d1/dc7/threadpool_8c_source.html#l01402">1402</a> of file <a class="el" href="../../d1/dc7/threadpool_8c_source.html">threadpool.c</a>.</p>

<p class="reference">References <a class="el" href="../../d5/da5/astobj2_8h_source.html#l00464">ao2_ref</a>, <a class="el" href="../../d4/deb/taskprocessor_8c_source.html#l01083">ast_taskprocessor_create_with_listener()</a>, <a class="el" href="../../d4/deb/taskprocessor_8c_source.html#l00930">ast_taskprocessor_listener_alloc()</a>, <a class="el" href="../../d1/dc7/threadpool_8c_source.html#l00038">ast_threadpool::listener</a>, <a class="el" href="../../dc/d7f/resample_8c_source.html#l00096">NULL</a>, <a class="el" href="../../d1/dc7/threadpool_8c_source.html#l01332">serializer_create()</a>, <a class="el" href="../../d1/dc7/threadpool_8c_source.html#l01289">serializer_shutdown_group_inc()</a>, and <a class="el" href="../../d1/dc7/threadpool_8c_source.html#l00067">ast_threadpool::tps</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../d6/dd3/serializer_8c_source.html#l00076">ast_serializer_pool_create()</a>, <a class="el" href="../../de/d96/res__pjsip_8c_source.html#l05128">ast_sip_create_serializer_group()</a>, and <a class="el" href="../../d1/dc7/threadpool_8c_source.html#l01432">ast_threadpool_serializer()</a>.</p>
<div class="fragment"><div class="line"><a name="l01404"></a><span class="lineno"> 1404</span>&#160;{</div><div class="line"><a name="l01405"></a><span class="lineno"> 1405</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d9/d47/structserializer.html">serializer</a> *ser;</div><div class="line"><a name="l01406"></a><span class="lineno"> 1406</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d7/d52/structast__taskprocessor__listener.html">ast_taskprocessor_listener</a> *<a class="code" href="../../d5/d03/asterisk_8c.html#adc01bca6281492dfec5ae217cf32fc34">listener</a>;</div><div class="line"><a name="l01407"></a><span class="lineno"> 1407</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../db/d17/structast__taskprocessor.html">ast_taskprocessor</a> *tps;</div><div class="line"><a name="l01408"></a><span class="lineno"> 1408</span>&#160;</div><div class="line"><a name="l01409"></a><span class="lineno"> 1409</span>&#160;   ser = <a class="code" href="../../d1/dc7/threadpool_8c.html#a82e66b52e831016bdfc643992d2d25f4">serializer_create</a>(pool, shutdown_group);</div><div class="line"><a name="l01410"></a><span class="lineno"> 1410</span>&#160;   <span class="keywordflow">if</span> (!ser) {</div><div class="line"><a name="l01411"></a><span class="lineno"> 1411</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l01412"></a><span class="lineno"> 1412</span>&#160;   }</div><div class="line"><a name="l01413"></a><span class="lineno"> 1413</span>&#160;</div><div class="line"><a name="l01414"></a><span class="lineno"> 1414</span>&#160;   listener = <a class="code" href="../../d0/d1e/taskprocessor_8h.html#ad7d5e40a1f7eac54dcad096b90d013bd">ast_taskprocessor_listener_alloc</a>(&amp;<a class="code" href="../../d1/dc7/threadpool_8c.html#a1ffa8804dc56390ba80054d2bac56e11">serializer_tps_listener_callbacks</a>, ser);</div><div class="line"><a name="l01415"></a><span class="lineno"> 1415</span>&#160;   <span class="keywordflow">if</span> (!listener) {</div><div class="line"><a name="l01416"></a><span class="lineno"> 1416</span>&#160;      <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(ser, -1);</div><div class="line"><a name="l01417"></a><span class="lineno"> 1417</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l01418"></a><span class="lineno"> 1418</span>&#160;   }</div><div class="line"><a name="l01419"></a><span class="lineno"> 1419</span>&#160;</div><div class="line"><a name="l01420"></a><span class="lineno"> 1420</span>&#160;   tps = <a class="code" href="../../d0/d1e/taskprocessor_8h.html#ab79575eb73e817bd3afe77c87308e8be">ast_taskprocessor_create_with_listener</a>(<a class="code" href="../../d0/d29/cdr__mysql_8c.html#a0980a105ccb863d8008eb6201a51da52">name</a>, listener);</div><div class="line"><a name="l01421"></a><span class="lineno"> 1421</span>&#160;   <span class="keywordflow">if</span> (!tps) {</div><div class="line"><a name="l01422"></a><span class="lineno"> 1422</span>&#160;      <span class="comment">/* ser ref transferred to listener but not cleaned without tps */</span></div><div class="line"><a name="l01423"></a><span class="lineno"> 1423</span>&#160;      <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(ser, -1);</div><div class="line"><a name="l01424"></a><span class="lineno"> 1424</span>&#160;   } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (shutdown_group) {</div><div class="line"><a name="l01425"></a><span class="lineno"> 1425</span>&#160;      <a class="code" href="../../d1/dc7/threadpool_8c.html#a94999064773c19db7466b855530eb1b4">serializer_shutdown_group_inc</a>(shutdown_group);</div><div class="line"><a name="l01426"></a><span class="lineno"> 1426</span>&#160;   }</div><div class="line"><a name="l01427"></a><span class="lineno"> 1427</span>&#160;</div><div class="line"><a name="l01428"></a><span class="lineno"> 1428</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(listener, -1);</div><div class="line"><a name="l01429"></a><span class="lineno"> 1429</span>&#160;   <span class="keywordflow">return</span> tps;</div><div class="line"><a name="l01430"></a><span class="lineno"> 1430</span>&#160;}</div><div class="ttc" id="structast__taskprocessor__listener_html"><div class="ttname"><a href="../../d7/d52/structast__taskprocessor__listener.html">ast_taskprocessor_listener</a></div><div class="ttdoc">A listener for taskprocessors. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/deb/taskprocessor_8c_source.html#l00110">taskprocessor.c:110</a></div></div>
<div class="ttc" id="resample_8c_html_a070d2ce7b6bb7e5c05602aa8c308d0c4"><div class="ttname"><a href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a></div><div class="ttdeci">#define NULL</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d7f/resample_8c_source.html#l00096">resample.c:96</a></div></div>
<div class="ttc" id="asterisk_8c_html_adc01bca6281492dfec5ae217cf32fc34"><div class="ttname"><a href="../../d5/d03/asterisk_8c.html#adc01bca6281492dfec5ae217cf32fc34">listener</a></div><div class="ttdeci">static void * listener(void *unused)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d03/asterisk_8c_source.html#l01476">asterisk.c:1476</a></div></div>
<div class="ttc" id="threadpool_8c_html_a1ffa8804dc56390ba80054d2bac56e11"><div class="ttname"><a href="../../d1/dc7/threadpool_8c.html#a1ffa8804dc56390ba80054d2bac56e11">serializer_tps_listener_callbacks</a></div><div class="ttdeci">static struct ast_taskprocessor_listener_callbacks serializer_tps_listener_callbacks</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/dc7/threadpool_8c_source.html#l01391">threadpool.c:1391</a></div></div>
<div class="ttc" id="astobj2_8h_html_aaca5e8eac39a22f9da1c36fc6c922270"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a></div><div class="ttdeci">#define ao2_ref(o, delta)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l00464">astobj2.h:464</a></div></div>
<div class="ttc" id="threadpool_8c_html_a94999064773c19db7466b855530eb1b4"><div class="ttname"><a href="../../d1/dc7/threadpool_8c.html#a94999064773c19db7466b855530eb1b4">serializer_shutdown_group_inc</a></div><div class="ttdeci">static void serializer_shutdown_group_inc(struct ast_serializer_shutdown_group *shutdown_group)</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/dc7/threadpool_8c_source.html#l01289">threadpool.c:1289</a></div></div>
<div class="ttc" id="cdr__mysql_8c_html_a0980a105ccb863d8008eb6201a51da52"><div class="ttname"><a href="../../d0/d29/cdr__mysql_8c.html#a0980a105ccb863d8008eb6201a51da52">name</a></div><div class="ttdeci">static const char name[]</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d29/cdr__mysql_8c_source.html#l00074">cdr_mysql.c:74</a></div></div>
<div class="ttc" id="structserializer_html"><div class="ttname"><a href="../../d9/d47/structserializer.html">serializer</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d1/dc7/threadpool_8c_source.html#l01315">threadpool.c:1315</a></div></div>
<div class="ttc" id="taskprocessor_8h_html_ad7d5e40a1f7eac54dcad096b90d013bd"><div class="ttname"><a href="../../d0/d1e/taskprocessor_8h.html#ad7d5e40a1f7eac54dcad096b90d013bd">ast_taskprocessor_listener_alloc</a></div><div class="ttdeci">struct ast_taskprocessor_listener * ast_taskprocessor_listener_alloc(const struct ast_taskprocessor_listener_callbacks *callbacks, void *user_data)</div><div class="ttdoc">Allocate a taskprocessor listener. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/deb/taskprocessor_8c_source.html#l00930">taskprocessor.c:930</a></div></div>
<div class="ttc" id="structast__taskprocessor_html"><div class="ttname"><a href="../../db/d17/structast__taskprocessor.html">ast_taskprocessor</a></div><div class="ttdoc">A ast_taskprocessor structure is a singleton by name. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/deb/taskprocessor_8c_source.html#l00069">taskprocessor.c:69</a></div></div>
<div class="ttc" id="taskprocessor_8h_html_ab79575eb73e817bd3afe77c87308e8be"><div class="ttname"><a href="../../d0/d1e/taskprocessor_8h.html#ab79575eb73e817bd3afe77c87308e8be">ast_taskprocessor_create_with_listener</a></div><div class="ttdeci">struct ast_taskprocessor * ast_taskprocessor_create_with_listener(const char *name, struct ast_taskprocessor_listener *listener)</div><div class="ttdoc">Create a taskprocessor with a custom listener. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/deb/taskprocessor_8c_source.html#l01083">taskprocessor.c:1083</a></div></div>
<div class="ttc" id="threadpool_8c_html_a82e66b52e831016bdfc643992d2d25f4"><div class="ttname"><a href="../../d1/dc7/threadpool_8c.html#a82e66b52e831016bdfc643992d2d25f4">serializer_create</a></div><div class="ttdeci">static struct serializer * serializer_create(struct ast_threadpool *pool, struct ast_serializer_shutdown_group *shutdown_group)</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/dc7/threadpool_8c_source.html#l01332">threadpool.c:1332</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a13fdc818d975e34cef105d44829a054b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a13fdc818d975e34cef105d44829a054b">&#9670;&nbsp;</a></span>ast_threadpool_set_size()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ast_threadpool_set_size </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="../../d5/d10/structast__threadpool.html">ast_threadpool</a> *&#160;</td>
          <td class="paramname"><em>threadpool</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned int&#160;</td>
          <td class="paramname"><em>size</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Set the number of threads for the thread pool. </p>
<p>This number may be more or less than the current number of threads in the threadpool.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">threadpool</td><td>The threadpool to adjust </td></tr>
    <tr><td class="paramname">size</td><td>The new desired size of the threadpool </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="../../d1/dc7/threadpool_8c_source.html#l00874">874</a> of file <a class="el" href="../../d1/dc7/threadpool_8c_source.html">threadpool.c</a>.</p>

<p class="reference">References <a class="el" href="../../d8/d8a/astmm_8h_source.html#l00182">ast_free</a>, <a class="el" href="../../d4/deb/taskprocessor_8c_source.html#l01175">ast_taskprocessor_push()</a>, <a class="el" href="../../d1/dc7/threadpool_8c_source.html#l00096">ast_threadpool::control_tps</a>, <a class="el" href="../../df/d44/app__meetme_8c_source.html#l01091">lock</a>, <a class="el" href="../../d1/dc7/threadpool_8c_source.html#l00838">queued_set_size()</a>, <a class="el" href="../../dd/d42/lock_8h_source.html#l00602">SCOPED_AO2LOCK</a>, <a class="el" href="../../d1/dc7/threadpool_8c_source.html#l00814">set_size_data_alloc()</a>, and <a class="el" href="../../d1/dc7/threadpool_8c_source.html#l00098">ast_threadpool::shutting_down</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../de/dec/test__threadpool_8c_source.html#l00402">AST_TEST_DEFINE()</a>, and <a class="el" href="../../d1/dc7/threadpool_8c_source.html#l00915">ast_threadpool_create()</a>.</p>
<div class="fragment"><div class="line"><a name="l00875"></a><span class="lineno">  875</span>&#160;{</div><div class="line"><a name="l00876"></a><span class="lineno">  876</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../dc/d28/structset__size__data.html">set_size_data</a> *ssd;</div><div class="line"><a name="l00877"></a><span class="lineno">  877</span>&#160;   <a class="code" href="../../dd/d42/lock_8h.html#a2cfb325ed371eb6e629446bac4676e9f">SCOPED_AO2LOCK</a>(<a class="code" href="../../df/d44/app__meetme_8c.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>, pool);</div><div class="line"><a name="l00878"></a><span class="lineno">  878</span>&#160;</div><div class="line"><a name="l00879"></a><span class="lineno">  879</span>&#160;   <span class="keywordflow">if</span> (pool-&gt;<a class="code" href="../../d5/d10/structast__threadpool.html#a7f68568851b9c7f9291f7bb63f932c18">shutting_down</a>) {</div><div class="line"><a name="l00880"></a><span class="lineno">  880</span>&#160;      <span class="keywordflow">return</span>;</div><div class="line"><a name="l00881"></a><span class="lineno">  881</span>&#160;   }</div><div class="line"><a name="l00882"></a><span class="lineno">  882</span>&#160;</div><div class="line"><a name="l00883"></a><span class="lineno">  883</span>&#160;   ssd = <a class="code" href="../../d1/dc7/threadpool_8c.html#a3db89f7bce86946752e8247d4a0d3e55">set_size_data_alloc</a>(pool, <a class="code" href="../../dc/d28/structset__size__data.html#aac913b3a1f6ef005d66bf7a84428773e">size</a>);</div><div class="line"><a name="l00884"></a><span class="lineno">  884</span>&#160;   <span class="keywordflow">if</span> (!ssd) {</div><div class="line"><a name="l00885"></a><span class="lineno">  885</span>&#160;      <span class="keywordflow">return</span>;</div><div class="line"><a name="l00886"></a><span class="lineno">  886</span>&#160;   }</div><div class="line"><a name="l00887"></a><span class="lineno">  887</span>&#160;</div><div class="line"><a name="l00888"></a><span class="lineno">  888</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d0/d1e/taskprocessor_8h.html#a6b2508ba0a6b8f43ae6d3963f3189585">ast_taskprocessor_push</a>(pool-&gt;<a class="code" href="../../d5/d10/structast__threadpool.html#a566be46267682ab4ec66a8c25b673f8c">control_tps</a>, <a class="code" href="../../d1/dc7/threadpool_8c.html#a6dcc947c4d1eb51eaf8feb2efab14635">queued_set_size</a>, ssd)) {</div><div class="line"><a name="l00889"></a><span class="lineno">  889</span>&#160;      <a class="code" href="../../d8/d8a/astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(ssd);</div><div class="line"><a name="l00890"></a><span class="lineno">  890</span>&#160;   }</div><div class="line"><a name="l00891"></a><span class="lineno">  891</span>&#160;}</div><div class="ttc" id="threadpool_8c_html_a3db89f7bce86946752e8247d4a0d3e55"><div class="ttname"><a href="../../d1/dc7/threadpool_8c.html#a3db89f7bce86946752e8247d4a0d3e55">set_size_data_alloc</a></div><div class="ttdeci">static struct set_size_data * set_size_data_alloc(struct ast_threadpool *pool, unsigned int size)</div><div class="ttdoc">Allocate and initialize a set_size_data. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/dc7/threadpool_8c_source.html#l00814">threadpool.c:814</a></div></div>
<div class="ttc" id="structast__threadpool_html_a7f68568851b9c7f9291f7bb63f932c18"><div class="ttname"><a href="../../d5/d10/structast__threadpool.html#a7f68568851b9c7f9291f7bb63f932c18">ast_threadpool::shutting_down</a></div><div class="ttdeci">int shutting_down</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/dc7/threadpool_8c_source.html#l00098">threadpool.c:98</a></div></div>
<div class="ttc" id="structset__size__data_html"><div class="ttname"><a href="../../dc/d28/structset__size__data.html">set_size_data</a></div><div class="ttdoc">Helper struct used for queued operations that change the size of the threadpool. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/dc7/threadpool_8c_source.html#l00802">threadpool.c:802</a></div></div>
<div class="ttc" id="app__meetme_8c_html_adf04f66344e3fb0a6f6a69bf39d19902"><div class="ttname"><a href="../../df/d44/app__meetme_8c.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a></div><div class="ttdeci">ast_mutex_t lock</div><div class="ttdef"><b>Definition:</b> <a href="../../df/d44/app__meetme_8c_source.html#l01091">app_meetme.c:1091</a></div></div>
<div class="ttc" id="lock_8h_html_a2cfb325ed371eb6e629446bac4676e9f"><div class="ttname"><a href="../../dd/d42/lock_8h.html#a2cfb325ed371eb6e629446bac4676e9f">SCOPED_AO2LOCK</a></div><div class="ttdeci">#define SCOPED_AO2LOCK(varname, obj)</div><div class="ttdoc">scoped lock specialization for ao2 mutexes. </div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d42/lock_8h_source.html#l00602">lock.h:602</a></div></div>
<div class="ttc" id="astmm_8h_html_a402072d6789f6ed9e3a81da27504127e"><div class="ttname"><a href="../../d8/d8a/astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a></div><div class="ttdeci">#define ast_free(a)</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d8a/astmm_8h_source.html#l00182">astmm.h:182</a></div></div>
<div class="ttc" id="taskprocessor_8h_html_a6b2508ba0a6b8f43ae6d3963f3189585"><div class="ttname"><a href="../../d0/d1e/taskprocessor_8h.html#a6b2508ba0a6b8f43ae6d3963f3189585">ast_taskprocessor_push</a></div><div class="ttdeci">int ast_taskprocessor_push(struct ast_taskprocessor *tps, int(*task_exe)(void *datap), void *datap) attribute_warn_unused_result</div><div class="ttdoc">Push a task into the specified taskprocessor queue and signal the taskprocessor thread. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/deb/taskprocessor_8c_source.html#l01175">taskprocessor.c:1175</a></div></div>
<div class="ttc" id="threadpool_8c_html_a6dcc947c4d1eb51eaf8feb2efab14635"><div class="ttname"><a href="../../d1/dc7/threadpool_8c.html#a6dcc947c4d1eb51eaf8feb2efab14635">queued_set_size</a></div><div class="ttdeci">static int queued_set_size(void *data)</div><div class="ttdoc">Change the size of the threadpool. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/dc7/threadpool_8c_source.html#l00838">threadpool.c:838</a></div></div>
<div class="ttc" id="structset__size__data_html_aac913b3a1f6ef005d66bf7a84428773e"><div class="ttname"><a href="../../dc/d28/structset__size__data.html#aac913b3a1f6ef005d66bf7a84428773e">set_size_data::size</a></div><div class="ttdeci">unsigned int size</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/dc7/threadpool_8c_source.html#l00806">threadpool.c:806</a></div></div>
<div class="ttc" id="structast__threadpool_html_a566be46267682ab4ec66a8c25b673f8c"><div class="ttname"><a href="../../d5/d10/structast__threadpool.html#a566be46267682ab4ec66a8c25b673f8c">ast_threadpool::control_tps</a></div><div class="ttdeci">struct ast_taskprocessor * control_tps</div><div class="ttdoc">The control taskprocessor. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/dc7/threadpool_8c_source.html#l00096">threadpool.c:96</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a45bebfa26a1737c170f723ac86299bba"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a45bebfa26a1737c170f723ac86299bba">&#9670;&nbsp;</a></span>ast_threadpool_shutdown()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ast_threadpool_shutdown </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="../../d5/d10/structast__threadpool.html">ast_threadpool</a> *&#160;</td>
          <td class="paramname"><em>pool</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Shut down a threadpool and destroy it. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">pool</td><td>The pool to shut down </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="../../d1/dc7/threadpool_8c_source.html#l00965">965</a> of file <a class="el" href="../../d1/dc7/threadpool_8c_source.html">threadpool.c</a>.</p>

<p class="reference">References <a class="el" href="../../d5/da5/astobj2_8h_source.html#l00718">ao2_lock</a>, <a class="el" href="../../d5/da5/astobj2_8h_source.html#l00730">ao2_unlock</a>, <a class="el" href="../../d4/deb/taskprocessor_8c_source.html#l01109">ast_taskprocessor_unreference()</a>, <a class="el" href="../../d1/dc7/threadpool_8c_source.html#l00096">ast_threadpool::control_tps</a>, <a class="el" href="../../d1/dc7/threadpool_8c_source.html#l00098">ast_threadpool::shutting_down</a>, and <a class="el" href="../../d1/dc7/threadpool_8c_source.html#l00067">ast_threadpool::tps</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../df/df7/test__taskprocessor_8c_source.html#l00901">AST_TEST_DEFINE()</a>, <a class="el" href="../../de/d96/res__pjsip_8c_source.html#l05810">load_module()</a>, <a class="el" href="../../d7/d69/sorcery_8c_source.html#l00369">sorcery_cleanup()</a>, <a class="el" href="../../d0/df4/stasis_8c_source.html#l03042">stasis_cleanup()</a>, and <a class="el" href="../../de/d96/res__pjsip_8c_source.html#l05937">unload_module()</a>.</p>
<div class="fragment"><div class="line"><a name="l00966"></a><span class="lineno">  966</span>&#160;{</div><div class="line"><a name="l00967"></a><span class="lineno">  967</span>&#160;   <span class="keywordflow">if</span> (!pool) {</div><div class="line"><a name="l00968"></a><span class="lineno">  968</span>&#160;      <span class="keywordflow">return</span>;</div><div class="line"><a name="l00969"></a><span class="lineno">  969</span>&#160;   }</div><div class="line"><a name="l00970"></a><span class="lineno">  970</span>&#160;   <span class="comment">/* Shut down the taskprocessors and everything else just</span></div><div class="line"><a name="l00971"></a><span class="lineno">  971</span>&#160;<span class="comment">    * takes care of itself via the taskprocessor callbacks</span></div><div class="line"><a name="l00972"></a><span class="lineno">  972</span>&#160;<span class="comment">    */</span></div><div class="line"><a name="l00973"></a><span class="lineno">  973</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#aa9fdb5d0a6157a56060d9f7279fe6c49">ao2_lock</a>(pool);</div><div class="line"><a name="l00974"></a><span class="lineno">  974</span>&#160;   pool-&gt;<a class="code" href="../../d5/d10/structast__threadpool.html#a7f68568851b9c7f9291f7bb63f932c18">shutting_down</a> = 1;</div><div class="line"><a name="l00975"></a><span class="lineno">  975</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#a9998bd156b936636a8780385e9a910b2">ao2_unlock</a>(pool);</div><div class="line"><a name="l00976"></a><span class="lineno">  976</span>&#160;   <a class="code" href="../../d0/d1e/taskprocessor_8h.html#a32492eb2480cb8c46ad669622cff8556">ast_taskprocessor_unreference</a>(pool-&gt;<a class="code" href="../../d5/d10/structast__threadpool.html#a566be46267682ab4ec66a8c25b673f8c">control_tps</a>);</div><div class="line"><a name="l00977"></a><span class="lineno">  977</span>&#160;   <a class="code" href="../../d0/d1e/taskprocessor_8h.html#a32492eb2480cb8c46ad669622cff8556">ast_taskprocessor_unreference</a>(pool-&gt;<a class="code" href="../../d5/d10/structast__threadpool.html#a4c381cb1b5cf198fa3f260212e716c9a">tps</a>);</div><div class="line"><a name="l00978"></a><span class="lineno">  978</span>&#160;}</div><div class="ttc" id="structast__threadpool_html_a7f68568851b9c7f9291f7bb63f932c18"><div class="ttname"><a href="../../d5/d10/structast__threadpool.html#a7f68568851b9c7f9291f7bb63f932c18">ast_threadpool::shutting_down</a></div><div class="ttdeci">int shutting_down</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/dc7/threadpool_8c_source.html#l00098">threadpool.c:98</a></div></div>
<div class="ttc" id="astobj2_8h_html_a9998bd156b936636a8780385e9a910b2"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#a9998bd156b936636a8780385e9a910b2">ao2_unlock</a></div><div class="ttdeci">#define ao2_unlock(a)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l00730">astobj2.h:730</a></div></div>
<div class="ttc" id="astobj2_8h_html_aa9fdb5d0a6157a56060d9f7279fe6c49"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#aa9fdb5d0a6157a56060d9f7279fe6c49">ao2_lock</a></div><div class="ttdeci">#define ao2_lock(a)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l00718">astobj2.h:718</a></div></div>
<div class="ttc" id="structast__threadpool_html_a4c381cb1b5cf198fa3f260212e716c9a"><div class="ttname"><a href="../../d5/d10/structast__threadpool.html#a4c381cb1b5cf198fa3f260212e716c9a">ast_threadpool::tps</a></div><div class="ttdeci">struct ast_taskprocessor * tps</div><div class="ttdoc">The main taskprocessor. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/dc7/threadpool_8c_source.html#l00067">threadpool.c:67</a></div></div>
<div class="ttc" id="taskprocessor_8h_html_a32492eb2480cb8c46ad669622cff8556"><div class="ttname"><a href="../../d0/d1e/taskprocessor_8h.html#a32492eb2480cb8c46ad669622cff8556">ast_taskprocessor_unreference</a></div><div class="ttdeci">void * ast_taskprocessor_unreference(struct ast_taskprocessor *tps)</div><div class="ttdoc">Unreference the specified taskprocessor and its reference count will decrement. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/deb/taskprocessor_8c_source.html#l01109">taskprocessor.c:1109</a></div></div>
<div class="ttc" id="structast__threadpool_html_a566be46267682ab4ec66a8c25b673f8c"><div class="ttname"><a href="../../d5/d10/structast__threadpool.html#a566be46267682ab4ec66a8c25b673f8c">ast_threadpool::control_tps</a></div><div class="ttdeci">struct ast_taskprocessor * control_tps</div><div class="ttdoc">The control taskprocessor. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/dc7/threadpool_8c_source.html#l00096">threadpool.c:96</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a790f3603be48a5ee567924e6f06d6c88"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a790f3603be48a5ee567924e6f06d6c88">&#9670;&nbsp;</a></span>AST_THREADSTORAGE_RAW()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">AST_THREADSTORAGE_RAW </td>
          <td>(</td>
          <td class="paramtype">current_serializer&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="reference">Referenced by <a class="el" href="../../d1/dc7/threadpool_8c_source.html#l01332">serializer_create()</a>.</p>

</div>
</div>
<a id="ad18a34a1aef573f84ff3f29004edefba"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad18a34a1aef573f84ff3f29004edefba">&#9670;&nbsp;</a></span>execute_tasks()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int execute_tasks </td>
          <td>(</td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>data</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="../../d1/dc7/threadpool_8c_source.html#l01349">1349</a> of file <a class="el" href="../../d1/dc7/threadpool_8c_source.html">threadpool.c</a>.</p>

<p class="reference">References <a class="el" href="../../d4/deb/taskprocessor_8c_source.html#l01212">ast_taskprocessor_execute()</a>, <a class="el" href="../../d4/deb/taskprocessor_8c_source.html#l01109">ast_taskprocessor_unreference()</a>, <a class="el" href="../../dc/d7d/threadstorage_8h_source.html#l00260">ast_threadstorage_set_ptr()</a>, <a class="el" href="../../dc/d7f/resample_8c_source.html#l00096">NULL</a>, and <a class="el" href="../../d1/dc7/threadpool_8c_source.html#l00067">ast_threadpool::tps</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../d1/dc7/threadpool_8c_source.html#l01363">serializer_task_pushed()</a>.</p>
<div class="fragment"><div class="line"><a name="l01350"></a><span class="lineno"> 1350</span>&#160;{</div><div class="line"><a name="l01351"></a><span class="lineno"> 1351</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../db/d17/structast__taskprocessor.html">ast_taskprocessor</a> *tps = data;</div><div class="line"><a name="l01352"></a><span class="lineno"> 1352</span>&#160;</div><div class="line"><a name="l01353"></a><span class="lineno"> 1353</span>&#160;   <a class="code" href="../../dc/d7d/threadstorage_8h.html#a10886a1187bdffd95a266d04e0739b60">ast_threadstorage_set_ptr</a>(&amp;current_serializer, tps);</div><div class="line"><a name="l01354"></a><span class="lineno"> 1354</span>&#160;   <span class="keywordflow">while</span> (<a class="code" href="../../d0/d1e/taskprocessor_8h.html#a9318e041c0564532581e864cda8f9426">ast_taskprocessor_execute</a>(tps)) {</div><div class="line"><a name="l01355"></a><span class="lineno"> 1355</span>&#160;      <span class="comment">/* No-op */</span></div><div class="line"><a name="l01356"></a><span class="lineno"> 1356</span>&#160;   }</div><div class="line"><a name="l01357"></a><span class="lineno"> 1357</span>&#160;   <a class="code" href="../../dc/d7d/threadstorage_8h.html#a10886a1187bdffd95a266d04e0739b60">ast_threadstorage_set_ptr</a>(&amp;current_serializer, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div><div class="line"><a name="l01358"></a><span class="lineno"> 1358</span>&#160;</div><div class="line"><a name="l01359"></a><span class="lineno"> 1359</span>&#160;   <a class="code" href="../../d0/d1e/taskprocessor_8h.html#a32492eb2480cb8c46ad669622cff8556">ast_taskprocessor_unreference</a>(tps);</div><div class="line"><a name="l01360"></a><span class="lineno"> 1360</span>&#160;   <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l01361"></a><span class="lineno"> 1361</span>&#160;}</div><div class="ttc" id="taskprocessor_8h_html_a9318e041c0564532581e864cda8f9426"><div class="ttname"><a href="../../d0/d1e/taskprocessor_8h.html#a9318e041c0564532581e864cda8f9426">ast_taskprocessor_execute</a></div><div class="ttdeci">int ast_taskprocessor_execute(struct ast_taskprocessor *tps)</div><div class="ttdoc">Pop a task off the taskprocessor and execute it. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/deb/taskprocessor_8c_source.html#l01212">taskprocessor.c:1212</a></div></div>
<div class="ttc" id="resample_8c_html_a070d2ce7b6bb7e5c05602aa8c308d0c4"><div class="ttname"><a href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a></div><div class="ttdeci">#define NULL</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d7f/resample_8c_source.html#l00096">resample.c:96</a></div></div>
<div class="ttc" id="threadstorage_8h_html_a10886a1187bdffd95a266d04e0739b60"><div class="ttname"><a href="../../dc/d7d/threadstorage_8h.html#a10886a1187bdffd95a266d04e0739b60">ast_threadstorage_set_ptr</a></div><div class="ttdeci">int ast_threadstorage_set_ptr(struct ast_threadstorage *ts, void *ptr)</div><div class="ttdoc">Set a raw pointer from threadstorage. </div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d7d/threadstorage_8h_source.html#l00260">threadstorage.h:260</a></div></div>
<div class="ttc" id="structast__taskprocessor_html"><div class="ttname"><a href="../../db/d17/structast__taskprocessor.html">ast_taskprocessor</a></div><div class="ttdoc">A ast_taskprocessor structure is a singleton by name. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/deb/taskprocessor_8c_source.html#l00069">taskprocessor.c:69</a></div></div>
<div class="ttc" id="taskprocessor_8h_html_a32492eb2480cb8c46ad669622cff8556"><div class="ttname"><a href="../../d0/d1e/taskprocessor_8h.html#a32492eb2480cb8c46ad669622cff8556">ast_taskprocessor_unreference</a></div><div class="ttdeci">void * ast_taskprocessor_unreference(struct ast_taskprocessor *tps)</div><div class="ttdoc">Unreference the specified taskprocessor and its reference count will decrement. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/deb/taskprocessor_8c_source.html#l01109">taskprocessor.c:1109</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a4b7d634038cf195b340980395ec1b9a4"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4b7d634038cf195b340980395ec1b9a4">&#9670;&nbsp;</a></span>grow()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void grow </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="../../d5/d10/structast__threadpool.html">ast_threadpool</a> *&#160;</td>
          <td class="paramname"><em>pool</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>delta</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Add threads to the threadpool. </p>
<p>This function is called from the threadpool's control taskprocessor thread. </p><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">pool</td><td>The pool that is expanding  The number of threads to add to the pool </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="../../d1/dc7/threadpool_8c_source.html#l00524">524</a> of file <a class="el" href="../../d1/dc7/threadpool_8c_source.html">threadpool.c</a>.</p>

<p class="reference">References <a class="el" href="../../d1/dc7/threadpool_8c_source.html#l00043">ast_threadpool::active_threads</a>, <a class="el" href="../../d7/d22/astobj2__container_8c_source.html#l00034">ao2_container_count()</a>, <a class="el" href="../../d5/da5/astobj2_8h_source.html#l01549">ao2_link</a>, <a class="el" href="../../d5/da5/astobj2_8h_source.html#l00464">ao2_ref</a>, <a class="el" href="../../d5/da5/astobj2_8h_source.html#l01598">ao2_unlink</a>, <a class="el" href="../../d1/d8c/logger_8h_source.html#l00452">ast_debug</a>, <a class="el" href="../../da/df7/astobj2_8c_source.html#l00042">ast_log</a>, <a class="el" href="../../d4/deb/taskprocessor_8c_source.html#l00906">ast_taskprocessor_name()</a>, <a class="el" href="../../d1/dc7/threadpool_8c_source.html#l00145">worker_thread::id</a>, <a class="el" href="../../d1/dc7/threadpool_8c_source.html#l00048">ast_threadpool::idle_threads</a>, <a class="el" href="../../d1/d8c/logger_8h_source.html#l00285">LOG_ERROR</a>, <a class="el" href="../../d1/d8c/logger_8h_source.html#l00274">LOG_WARNING</a>, <a class="el" href="../../d3/d40/threadpool_8h_source.html#l00110">ast_threadpool_options::max_size</a>, <a class="el" href="../../d1/dc7/threadpool_8c_source.html#l00100">ast_threadpool::options</a>, <a class="el" href="../../d1/dc7/threadpool_8c_source.html#l00067">ast_threadpool::tps</a>, <a class="el" href="../../d1/dc7/threadpool_8c_source.html#l01093">worker_thread_alloc()</a>, and <a class="el" href="../../d1/dc7/threadpool_8c_source.html#l01109">worker_thread_start()</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../d5/dba/stringfields_8c_source.html#l00286">__ast_string_field_ptr_build_va()</a>, <a class="el" href="../../d5/dba/stringfields_8c_source.html#l00240">__ast_string_field_ptr_grow()</a>, <a class="el" href="../../d1/dc7/threadpool_8c_source.html#l00838">queued_set_size()</a>, and <a class="el" href="../../d1/dc7/threadpool_8c_source.html#l00564">queued_task_pushed()</a>.</p>
<div class="fragment"><div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;{</div><div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;   <span class="keywordtype">int</span> i;</div><div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;</div><div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;   <span class="keywordtype">int</span> current_size = <a class="code" href="../../d5/da5/astobj2_8h.html#a512cc40ce96c63b3d5c78040baa4c9cd">ao2_container_count</a>(pool-&gt;<a class="code" href="../../d5/d10/structast__threadpool.html#af151fe496c19e89e750605192e7726c8">active_threads</a>) +</div><div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;      <a class="code" href="../../d5/da5/astobj2_8h.html#a512cc40ce96c63b3d5c78040baa4c9cd">ao2_container_count</a>(pool-&gt;<a class="code" href="../../d5/d10/structast__threadpool.html#a1bad8223d34f52e7e7e11c0c20b20623">idle_threads</a>);</div><div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;</div><div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;   <span class="keywordflow">if</span> (pool-&gt;<a class="code" href="../../d5/d10/structast__threadpool.html#a83b47841343f8af6b4ab20abe3c2ab24">options</a>.<a class="code" href="../../de/de6/structast__threadpool__options.html#a98ca8117bc73d9d7520727c4ce8772e6">max_size</a> &amp;&amp; current_size + delta &gt; pool-&gt;<a class="code" href="../../d5/d10/structast__threadpool.html#a83b47841343f8af6b4ab20abe3c2ab24">options</a>.<a class="code" href="../../de/de6/structast__threadpool__options.html#a98ca8117bc73d9d7520727c4ce8772e6">max_size</a>) {</div><div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;      delta = pool-&gt;<a class="code" href="../../d5/d10/structast__threadpool.html#a83b47841343f8af6b4ab20abe3c2ab24">options</a>.<a class="code" href="../../de/de6/structast__threadpool__options.html#a98ca8117bc73d9d7520727c4ce8772e6">max_size</a> - current_size;</div><div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;   }</div><div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;</div><div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;   <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(3, <span class="stringliteral">&quot;Increasing threadpool %s&#39;s size by %d\n&quot;</span>,</div><div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;         <a class="code" href="../../d0/d1e/taskprocessor_8h.html#aaa6541086de52447afa994cbfcb792ec">ast_taskprocessor_name</a>(pool-&gt;<a class="code" href="../../d5/d10/structast__threadpool.html#a4c381cb1b5cf198fa3f260212e716c9a">tps</a>), delta);</div><div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;</div><div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;   <span class="keywordflow">for</span> (i = 0; i &lt; delta; ++i) {</div><div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;      <span class="keyword">struct </span><a class="code" href="../../dd/d5b/structworker__thread.html">worker_thread</a> *worker = <a class="code" href="../../d1/dc7/threadpool_8c.html#a03c0a8a356376d546a672d2a1acfe13d">worker_thread_alloc</a>(pool);</div><div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;      <span class="keywordflow">if</span> (!worker) {</div><div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;         <span class="keywordflow">return</span>;</div><div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;      }</div><div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="../../d5/da5/astobj2_8h.html#a1ad9f122bcae95a470639402faa3d2ee">ao2_link</a>(pool-&gt;<a class="code" href="../../d5/d10/structast__threadpool.html#a1bad8223d34f52e7e7e11c0c20b20623">idle_threads</a>, worker)) {</div><div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;         <span class="keywordflow">if</span> (<a class="code" href="../../d1/dc7/threadpool_8c.html#a25fb76590bc741453b0269ae1bde21b8">worker_thread_start</a>(worker)) {</div><div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;            <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Unable to start worker thread %d. Destroying.\n&quot;</span>, worker-&gt;<a class="code" href="../../dd/d5b/structworker__thread.html#a7441ef0865bcb3db9b8064dd7375c1ea">id</a>);</div><div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;            <a class="code" href="../../d5/da5/astobj2_8h.html#a64f51be4bee35c38dbe59b0a788b5ce8">ao2_unlink</a>(pool-&gt;<a class="code" href="../../d5/d10/structast__threadpool.html#af151fe496c19e89e750605192e7726c8">active_threads</a>, worker);</div><div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;         }</div><div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;      } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;         <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Failed to activate worker thread %d. Destroying.\n&quot;</span>, worker-&gt;<a class="code" href="../../dd/d5b/structworker__thread.html#a7441ef0865bcb3db9b8064dd7375c1ea">id</a>);</div><div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;      }</div><div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;      <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(worker, -1);</div><div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;   }</div><div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;}</div><div class="ttc" id="astobj2_8h_html_a512cc40ce96c63b3d5c78040baa4c9cd"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#a512cc40ce96c63b3d5c78040baa4c9cd">ao2_container_count</a></div><div class="ttdeci">int ao2_container_count(struct ao2_container *c)</div><div class="ttdoc">Returns the number of elements in a container. </div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d22/astobj2__container_8c_source.html#l00034">astobj2_container.c:34</a></div></div>
<div class="ttc" id="structast__threadpool__options_html_a98ca8117bc73d9d7520727c4ce8772e6"><div class="ttname"><a href="../../de/de6/structast__threadpool__options.html#a98ca8117bc73d9d7520727c4ce8772e6">ast_threadpool_options::max_size</a></div><div class="ttdeci">int max_size</div><div class="ttdoc">Maximum number of threads a pool may have. </div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d40/threadpool_8h_source.html#l00110">threadpool.h:110</a></div></div>
<div class="ttc" id="logger_8h_html_adf4476a6a4ea6c74231c826e899d7189"><div class="ttname"><a href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a></div><div class="ttdeci">#define LOG_WARNING</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d8c/logger_8h_source.html#l00274">logger.h:274</a></div></div>
<div class="ttc" id="structast__threadpool_html_a83b47841343f8af6b4ab20abe3c2ab24"><div class="ttname"><a href="../../d5/d10/structast__threadpool.html#a83b47841343f8af6b4ab20abe3c2ab24">ast_threadpool::options</a></div><div class="ttdeci">struct ast_threadpool_options options</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/dc7/threadpool_8c_source.html#l00100">threadpool.c:100</a></div></div>
<div class="ttc" id="structworker__thread_html"><div class="ttname"><a href="../../dd/d5b/structworker__thread.html">worker_thread</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d1/dc7/threadpool_8c_source.html#l00143">threadpool.c:143</a></div></div>
<div class="ttc" id="structast__threadpool_html_a1bad8223d34f52e7e7e11c0c20b20623"><div class="ttname"><a href="../../d5/d10/structast__threadpool.html#a1bad8223d34f52e7e7e11c0c20b20623">ast_threadpool::idle_threads</a></div><div class="ttdeci">struct ao2_container * idle_threads</div><div class="ttdoc">The container of idle threads. Idle threads are those that are currenly waiting to run tasks...</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/dc7/threadpool_8c_source.html#l00048">threadpool.c:48</a></div></div>
<div class="ttc" id="taskprocessor_8h_html_aaa6541086de52447afa994cbfcb792ec"><div class="ttname"><a href="../../d0/d1e/taskprocessor_8h.html#aaa6541086de52447afa994cbfcb792ec">ast_taskprocessor_name</a></div><div class="ttdeci">const char * ast_taskprocessor_name(struct ast_taskprocessor *tps)</div><div class="ttdoc">Return the name of the taskprocessor singleton. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/deb/taskprocessor_8c_source.html#l00906">taskprocessor.c:906</a></div></div>
<div class="ttc" id="threadpool_8c_html_a03c0a8a356376d546a672d2a1acfe13d"><div class="ttname"><a href="../../d1/dc7/threadpool_8c.html#a03c0a8a356376d546a672d2a1acfe13d">worker_thread_alloc</a></div><div class="ttdeci">static struct worker_thread * worker_thread_alloc(struct ast_threadpool *pool)</div><div class="ttdoc">Allocate and initialize a new worker thread. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/dc7/threadpool_8c_source.html#l01093">threadpool.c:1093</a></div></div>
<div class="ttc" id="structworker__thread_html_a7441ef0865bcb3db9b8064dd7375c1ea"><div class="ttname"><a href="../../dd/d5b/structworker__thread.html#a7441ef0865bcb3db9b8064dd7375c1ea">worker_thread::id</a></div><div class="ttdeci">int id</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/dc7/threadpool_8c_source.html#l00145">threadpool.c:145</a></div></div>
<div class="ttc" id="logger_8h_html_a3f248112c8d6ce7e3959aa723dade648"><div class="ttname"><a href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a></div><div class="ttdeci">#define ast_debug(level,...)</div><div class="ttdoc">Log a DEBUG message. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d8c/logger_8h_source.html#l00452">logger.h:452</a></div></div>
<div class="ttc" id="astobj2_8c_html_a96a00b3a518d7f32b6d51dc28f09bf9b"><div class="ttname"><a href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a></div><div class="ttdeci">#define ast_log</div><div class="ttdef"><b>Definition:</b> <a href="../../da/df7/astobj2_8c_source.html#l00042">astobj2.c:42</a></div></div>
<div class="ttc" id="astobj2_8h_html_aaca5e8eac39a22f9da1c36fc6c922270"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a></div><div class="ttdeci">#define ao2_ref(o, delta)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l00464">astobj2.h:464</a></div></div>
<div class="ttc" id="logger_8h_html_aced66975c154ea0e2a8ec3bc818b4e08"><div class="ttname"><a href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a></div><div class="ttdeci">#define LOG_ERROR</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d8c/logger_8h_source.html#l00285">logger.h:285</a></div></div>
<div class="ttc" id="astobj2_8h_html_a64f51be4bee35c38dbe59b0a788b5ce8"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#a64f51be4bee35c38dbe59b0a788b5ce8">ao2_unlink</a></div><div class="ttdeci">#define ao2_unlink(container, obj)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l01598">astobj2.h:1598</a></div></div>
<div class="ttc" id="structast__threadpool_html_a4c381cb1b5cf198fa3f260212e716c9a"><div class="ttname"><a href="../../d5/d10/structast__threadpool.html#a4c381cb1b5cf198fa3f260212e716c9a">ast_threadpool::tps</a></div><div class="ttdeci">struct ast_taskprocessor * tps</div><div class="ttdoc">The main taskprocessor. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/dc7/threadpool_8c_source.html#l00067">threadpool.c:67</a></div></div>
<div class="ttc" id="threadpool_8c_html_a25fb76590bc741453b0269ae1bde21b8"><div class="ttname"><a href="../../d1/dc7/threadpool_8c.html#a25fb76590bc741453b0269ae1bde21b8">worker_thread_start</a></div><div class="ttdeci">static int worker_thread_start(struct worker_thread *worker)</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/dc7/threadpool_8c_source.html#l01109">threadpool.c:1109</a></div></div>
<div class="ttc" id="structast__threadpool_html_af151fe496c19e89e750605192e7726c8"><div class="ttname"><a href="../../d5/d10/structast__threadpool.html#af151fe496c19e89e750605192e7726c8">ast_threadpool::active_threads</a></div><div class="ttdeci">struct ao2_container * active_threads</div><div class="ttdoc">The container of active threads. Active threads are those that are currently running tasks...</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/dc7/threadpool_8c_source.html#l00043">threadpool.c:43</a></div></div>
<div class="ttc" id="astobj2_8h_html_a1ad9f122bcae95a470639402faa3d2ee"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#a1ad9f122bcae95a470639402faa3d2ee">ao2_link</a></div><div class="ttdeci">#define ao2_link(container, obj)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l01549">astobj2.h:1549</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="aeb318ea12f5c123fac34bc885227d0f5"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aeb318ea12f5c123fac34bc885227d0f5">&#9670;&nbsp;</a></span>kill_threads()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int kill_threads </td>
          <td>(</td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>obj</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>arg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>flags</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>ao2 callback to kill a set number of threads. </p>
<p>Threads will be unlinked from the container as long as the counter has not reached zero. The counter is decremented with each thread that is removed. </p><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">obj</td><td>The worker thread up for possible destruction </td></tr>
    <tr><td class="paramname">arg</td><td>The counter </td></tr>
    <tr><td class="paramname">flags</td><td>Unused </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">CMP_MATCH</td><td>The counter has not reached zero, so this flag should be removed. </td></tr>
    <tr><td class="paramname">CMP_STOP</td><td>The counter has reached zero so no more threads should be removed. </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="../../d1/dc7/threadpool_8c_source.html#l00714">714</a> of file <a class="el" href="../../d1/dc7/threadpool_8c_source.html">threadpool.c</a>.</p>

<p class="reference">References <a class="el" href="../../d5/da5/astobj2_8h_source.html#l01031">CMP_MATCH</a>, and <a class="el" href="../../d5/da5/astobj2_8h_source.html#l01032">CMP_STOP</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../d1/dc7/threadpool_8c_source.html#l00775">shrink()</a>.</p>
<div class="fragment"><div class="line"><a name="l00715"></a><span class="lineno">  715</span>&#160;{</div><div class="line"><a name="l00716"></a><span class="lineno">  716</span>&#160;   <span class="keywordtype">int</span> *num_to_kill = arg;</div><div class="line"><a name="l00717"></a><span class="lineno">  717</span>&#160;</div><div class="line"><a name="l00718"></a><span class="lineno">  718</span>&#160;   <span class="keywordflow">if</span> (*num_to_kill &gt; 0) {</div><div class="line"><a name="l00719"></a><span class="lineno">  719</span>&#160;      --(*num_to_kill);</div><div class="line"><a name="l00720"></a><span class="lineno">  720</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../d5/da5/astobj2_8h.html#a1f8b41308be4c47de8ff89a3b9c7e7d1a1959468a3c5d6aecd2fa1272d8e30fbf">CMP_MATCH</a>;</div><div class="line"><a name="l00721"></a><span class="lineno">  721</span>&#160;   } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00722"></a><span class="lineno">  722</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../d5/da5/astobj2_8h.html#a1f8b41308be4c47de8ff89a3b9c7e7d1a75382dc9117cc118719edf6c3d2b71df">CMP_STOP</a>;</div><div class="line"><a name="l00723"></a><span class="lineno">  723</span>&#160;   }</div><div class="line"><a name="l00724"></a><span class="lineno">  724</span>&#160;}</div><div class="ttc" id="astobj2_8h_html_a1f8b41308be4c47de8ff89a3b9c7e7d1a75382dc9117cc118719edf6c3d2b71df"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#a1f8b41308be4c47de8ff89a3b9c7e7d1a75382dc9117cc118719edf6c3d2b71df">CMP_STOP</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l01032">astobj2.h:1032</a></div></div>
<div class="ttc" id="astobj2_8h_html_a1f8b41308be4c47de8ff89a3b9c7e7d1a1959468a3c5d6aecd2fa1272d8e30fbf"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#a1f8b41308be4c47de8ff89a3b9c7e7d1a1959468a3c5d6aecd2fa1272d8e30fbf">CMP_MATCH</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l01031">astobj2.h:1031</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a8265602231dc299fa6acc75612ab7602"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8265602231dc299fa6acc75612ab7602">&#9670;&nbsp;</a></span>queued_active_thread_idle()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int queued_active_thread_idle </td>
          <td>(</td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>data</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Move a worker thread from the active container to the idle container. </p>
<p>This function is called from the threadpool's control taskprocessor thread. </p><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">data</td><td>A <a class="el" href="../../d1/d34/structthread__worker__pair.html" title="Struct used for queued operations involving worker state changes. ">thread_worker_pair</a> containing the threadpool and the worker to move. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>0 </dd></dl>

<p class="definition">Definition at line <a class="el" href="../../d1/dc7/threadpool_8c_source.html#l00235">235</a> of file <a class="el" href="../../d1/dc7/threadpool_8c_source.html">threadpool.c</a>.</p>

<p class="reference">References <a class="el" href="../../d1/dc7/threadpool_8c_source.html#l00043">ast_threadpool::active_threads</a>, <a class="el" href="../../d5/da5/astobj2_8h_source.html#l01549">ao2_link</a>, <a class="el" href="../../d5/da5/astobj2_8h_source.html#l01598">ao2_unlink</a>, <a class="el" href="../../d1/dc7/threadpool_8c_source.html#l00048">ast_threadpool::idle_threads</a>, <a class="el" href="../../d1/dc7/threadpool_8c_source.html#l00195">thread_worker_pair::pool</a>, <a class="el" href="../../d1/dc7/threadpool_8c_source.html#l00203">thread_worker_pair_free()</a>, <a class="el" href="../../d1/dc7/threadpool_8c_source.html#l00180">threadpool_send_state_changed()</a>, and <a class="el" href="../../d1/dc7/threadpool_8c_source.html#l00197">thread_worker_pair::worker</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../d1/dc7/threadpool_8c_source.html#l00256">threadpool_active_thread_idle()</a>.</p>
<div class="fragment"><div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;{</div><div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d1/d34/structthread__worker__pair.html">thread_worker_pair</a> *<a class="code" href="../../df/de8/structpair.html">pair</a> = data;</div><div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;</div><div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#a1ad9f122bcae95a470639402faa3d2ee">ao2_link</a>(pair-&gt;<a class="code" href="../../d1/d34/structthread__worker__pair.html#ac8c18315f6d4a45480dea634294e683f">pool</a>-&gt;<a class="code" href="../../d5/d10/structast__threadpool.html#a1bad8223d34f52e7e7e11c0c20b20623">idle_threads</a>, pair-&gt;<a class="code" href="../../d1/d34/structthread__worker__pair.html#acbba1e1f081a6e0fefa291d74ec1a10d">worker</a>);</div><div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#a64f51be4bee35c38dbe59b0a788b5ce8">ao2_unlink</a>(pair-&gt;<a class="code" href="../../d1/d34/structthread__worker__pair.html#ac8c18315f6d4a45480dea634294e683f">pool</a>-&gt;<a class="code" href="../../d5/d10/structast__threadpool.html#af151fe496c19e89e750605192e7726c8">active_threads</a>, pair-&gt;<a class="code" href="../../d1/d34/structthread__worker__pair.html#acbba1e1f081a6e0fefa291d74ec1a10d">worker</a>);</div><div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;</div><div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;   <a class="code" href="../../d1/dc7/threadpool_8c.html#a77f79e913191ee36b6d34e86ac6cb1aa">threadpool_send_state_changed</a>(pair-&gt;<a class="code" href="../../d1/d34/structthread__worker__pair.html#ac8c18315f6d4a45480dea634294e683f">pool</a>);</div><div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;</div><div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;   <a class="code" href="../../d1/dc7/threadpool_8c.html#a0041e0562576aadeec0ce50221ba2396">thread_worker_pair_free</a>(pair);</div><div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;   <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;}</div><div class="ttc" id="structthread__worker__pair_html"><div class="ttname"><a href="../../d1/d34/structthread__worker__pair.html">thread_worker_pair</a></div><div class="ttdoc">Struct used for queued operations involving worker state changes. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/dc7/threadpool_8c_source.html#l00193">threadpool.c:193</a></div></div>
<div class="ttc" id="structast__threadpool_html_a1bad8223d34f52e7e7e11c0c20b20623"><div class="ttname"><a href="../../d5/d10/structast__threadpool.html#a1bad8223d34f52e7e7e11c0c20b20623">ast_threadpool::idle_threads</a></div><div class="ttdeci">struct ao2_container * idle_threads</div><div class="ttdoc">The container of idle threads. Idle threads are those that are currenly waiting to run tasks...</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/dc7/threadpool_8c_source.html#l00048">threadpool.c:48</a></div></div>
<div class="ttc" id="threadpool_8c_html_a77f79e913191ee36b6d34e86ac6cb1aa"><div class="ttname"><a href="../../d1/dc7/threadpool_8c.html#a77f79e913191ee36b6d34e86ac6cb1aa">threadpool_send_state_changed</a></div><div class="ttdeci">static void threadpool_send_state_changed(struct ast_threadpool *pool)</div><div class="ttdoc">Notify the threadpool listener that the state has changed. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/dc7/threadpool_8c_source.html#l00180">threadpool.c:180</a></div></div>
<div class="ttc" id="structthread__worker__pair_html_acbba1e1f081a6e0fefa291d74ec1a10d"><div class="ttname"><a href="../../d1/d34/structthread__worker__pair.html#acbba1e1f081a6e0fefa291d74ec1a10d">thread_worker_pair::worker</a></div><div class="ttdeci">struct worker_thread * worker</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/dc7/threadpool_8c_source.html#l00197">threadpool.c:197</a></div></div>
<div class="ttc" id="astobj2_8h_html_a64f51be4bee35c38dbe59b0a788b5ce8"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#a64f51be4bee35c38dbe59b0a788b5ce8">ao2_unlink</a></div><div class="ttdeci">#define ao2_unlink(container, obj)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l01598">astobj2.h:1598</a></div></div>
<div class="ttc" id="structast__threadpool_html_af151fe496c19e89e750605192e7726c8"><div class="ttname"><a href="../../d5/d10/structast__threadpool.html#af151fe496c19e89e750605192e7726c8">ast_threadpool::active_threads</a></div><div class="ttdeci">struct ao2_container * active_threads</div><div class="ttdoc">The container of active threads. Active threads are those that are currently running tasks...</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/dc7/threadpool_8c_source.html#l00043">threadpool.c:43</a></div></div>
<div class="ttc" id="structpair_html"><div class="ttname"><a href="../../df/de8/structpair.html">pair</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d4f/test__config_8c_source.html#l00084">test_config.c:84</a></div></div>
<div class="ttc" id="threadpool_8c_html_a0041e0562576aadeec0ce50221ba2396"><div class="ttname"><a href="../../d1/dc7/threadpool_8c.html#a0041e0562576aadeec0ce50221ba2396">thread_worker_pair_free</a></div><div class="ttdeci">static void thread_worker_pair_free(struct thread_worker_pair *pair)</div><div class="ttdoc">Destructor for thread_worker_pair. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/dc7/threadpool_8c_source.html#l00203">threadpool.c:203</a></div></div>
<div class="ttc" id="structthread__worker__pair_html_ac8c18315f6d4a45480dea634294e683f"><div class="ttname"><a href="../../d1/d34/structthread__worker__pair.html#ac8c18315f6d4a45480dea634294e683f">thread_worker_pair::pool</a></div><div class="ttdeci">struct ast_threadpool * pool</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/dc7/threadpool_8c_source.html#l00195">threadpool.c:195</a></div></div>
<div class="ttc" id="astobj2_8h_html_a1ad9f122bcae95a470639402faa3d2ee"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#a1ad9f122bcae95a470639402faa3d2ee">ao2_link</a></div><div class="ttdeci">#define ao2_link(container, obj)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l01549">astobj2.h:1549</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a21b4589c07fb24d89ea06b419d5bdd1b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a21b4589c07fb24d89ea06b419d5bdd1b">&#9670;&nbsp;</a></span>queued_emptied()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int queued_emptied </td>
          <td>(</td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>data</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Queued task that handles the case where the threadpool's taskprocessor is emptied. </p>
<p>This simply lets the threadpool's listener know that the threadpool is devoid of tasks </p><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">data</td><td>The pool that has become empty </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>0 </dd></dl>

<p class="definition">Definition at line <a class="el" href="../../d1/dc7/threadpool_8c_source.html#l00638">638</a> of file <a class="el" href="../../d1/dc7/threadpool_8c_source.html">threadpool.c</a>.</p>

<p class="reference">References <a class="el" href="../../d1/dc7/threadpool_8c_source.html#l00112">ast_threadpool_listener::callbacks</a>, <a class="el" href="../../d3/d40/threadpool_8h_source.html#l00056">ast_threadpool_listener_callbacks::emptied</a>, <a class="el" href="../../d1/dc7/threadpool_8c_source.html#l00038">ast_threadpool::listener</a>, and <a class="el" href="../../d9/d21/res__rtp__asterisk_8c_source.html#l00236">pool</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../d1/dc7/threadpool_8c_source.html#l00654">threadpool_tps_emptied()</a>.</p>
<div class="fragment"><div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160;{</div><div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d5/d10/structast__threadpool.html">ast_threadpool</a> *<a class="code" href="../../d9/d21/res__rtp__asterisk_8c.html#a2e57658a5d3ef6c4ef2774c9d5868e7c">pool</a> = data;</div><div class="line"><a name="l00641"></a><span class="lineno">  641</span>&#160;</div><div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160;   <span class="comment">/* We already checked for existence of this callback when this was queued */</span></div><div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160;   pool-&gt;<a class="code" href="../../d5/d10/structast__threadpool.html#a9a8a970d797bbe611df35df7d8318b1d">listener</a>-&gt;<a class="code" href="../../dd/d12/structast__threadpool__listener.html#ae47947f47eb99da4337ce95cddd1d614">callbacks</a>-&gt;<a class="code" href="../../df/d64/structast__threadpool__listener__callbacks.html#aa4d4a34fe6a37c010003e3a3030d23ca">emptied</a>(pool, pool-&gt;<a class="code" href="../../d5/d10/structast__threadpool.html#a9a8a970d797bbe611df35df7d8318b1d">listener</a>);</div><div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160;   <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160;}</div><div class="ttc" id="res__rtp__asterisk_8c_html_a2e57658a5d3ef6c4ef2774c9d5868e7c"><div class="ttname"><a href="../../d9/d21/res__rtp__asterisk_8c.html#a2e57658a5d3ef6c4ef2774c9d5868e7c">pool</a></div><div class="ttdeci">static pj_pool_t * pool</div><div class="ttdoc">Global memory pool for configuration and timers. </div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d21/res__rtp__asterisk_8c_source.html#l00236">res_rtp_asterisk.c:236</a></div></div>
<div class="ttc" id="structast__threadpool__listener_html_ae47947f47eb99da4337ce95cddd1d614"><div class="ttname"><a href="../../dd/d12/structast__threadpool__listener.html#ae47947f47eb99da4337ce95cddd1d614">ast_threadpool_listener::callbacks</a></div><div class="ttdeci">const struct ast_threadpool_listener_callbacks * callbacks</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/dc7/threadpool_8c_source.html#l00112">threadpool.c:112</a></div></div>
<div class="ttc" id="structast__threadpool__listener__callbacks_html_aa4d4a34fe6a37c010003e3a3030d23ca"><div class="ttname"><a href="../../df/d64/structast__threadpool__listener__callbacks.html#aa4d4a34fe6a37c010003e3a3030d23ca">ast_threadpool_listener_callbacks::emptied</a></div><div class="ttdeci">void(* emptied)(struct ast_threadpool *pool, struct ast_threadpool_listener *listener)</div><div class="ttdoc">Indicates the threadpool&amp;#39;s taskprocessor has become empty. </div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d40/threadpool_8h_source.html#l00056">threadpool.h:56</a></div></div>
<div class="ttc" id="structast__threadpool_html_a9a8a970d797bbe611df35df7d8318b1d"><div class="ttname"><a href="../../d5/d10/structast__threadpool.html#a9a8a970d797bbe611df35df7d8318b1d">ast_threadpool::listener</a></div><div class="ttdeci">struct ast_threadpool_listener * listener</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/dc7/threadpool_8c_source.html#l00038">threadpool.c:38</a></div></div>
<div class="ttc" id="structast__threadpool_html"><div class="ttname"><a href="../../d5/d10/structast__threadpool.html">ast_threadpool</a></div><div class="ttdoc">An opaque threadpool structure. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/dc7/threadpool_8c_source.html#l00036">threadpool.c:36</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="aa630f726bcc0a7f0a4d36478e829dde1"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa630f726bcc0a7f0a4d36478e829dde1">&#9670;&nbsp;</a></span>queued_idle_thread_dead()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int queued_idle_thread_dead </td>
          <td>(</td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>data</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="../../d1/dc7/threadpool_8c_source.html#l00321">321</a> of file <a class="el" href="../../d1/dc7/threadpool_8c_source.html">threadpool.c</a>.</p>

<p class="reference">References <a class="el" href="../../d5/da5/astobj2_8h_source.html#l01598">ao2_unlink</a>, <a class="el" href="../../d1/dc7/threadpool_8c_source.html#l00048">ast_threadpool::idle_threads</a>, <a class="el" href="../../d1/dc7/threadpool_8c_source.html#l00195">thread_worker_pair::pool</a>, <a class="el" href="../../d1/dc7/threadpool_8c_source.html#l00203">thread_worker_pair_free()</a>, <a class="el" href="../../d1/dc7/threadpool_8c_source.html#l00180">threadpool_send_state_changed()</a>, and <a class="el" href="../../d1/dc7/threadpool_8c_source.html#l00197">thread_worker_pair::worker</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../d1/dc7/threadpool_8c_source.html#l00332">threadpool_idle_thread_dead()</a>.</p>
<div class="fragment"><div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;{</div><div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d1/d34/structthread__worker__pair.html">thread_worker_pair</a> *<a class="code" href="../../df/de8/structpair.html">pair</a> = data;</div><div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;</div><div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#a64f51be4bee35c38dbe59b0a788b5ce8">ao2_unlink</a>(pair-&gt;<a class="code" href="../../d1/d34/structthread__worker__pair.html#ac8c18315f6d4a45480dea634294e683f">pool</a>-&gt;<a class="code" href="../../d5/d10/structast__threadpool.html#a1bad8223d34f52e7e7e11c0c20b20623">idle_threads</a>, pair-&gt;<a class="code" href="../../d1/d34/structthread__worker__pair.html#acbba1e1f081a6e0fefa291d74ec1a10d">worker</a>);</div><div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;   <a class="code" href="../../d1/dc7/threadpool_8c.html#a77f79e913191ee36b6d34e86ac6cb1aa">threadpool_send_state_changed</a>(pair-&gt;<a class="code" href="../../d1/d34/structthread__worker__pair.html#ac8c18315f6d4a45480dea634294e683f">pool</a>);</div><div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;</div><div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;   <a class="code" href="../../d1/dc7/threadpool_8c.html#a0041e0562576aadeec0ce50221ba2396">thread_worker_pair_free</a>(pair);</div><div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;   <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;}</div><div class="ttc" id="structthread__worker__pair_html"><div class="ttname"><a href="../../d1/d34/structthread__worker__pair.html">thread_worker_pair</a></div><div class="ttdoc">Struct used for queued operations involving worker state changes. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/dc7/threadpool_8c_source.html#l00193">threadpool.c:193</a></div></div>
<div class="ttc" id="structast__threadpool_html_a1bad8223d34f52e7e7e11c0c20b20623"><div class="ttname"><a href="../../d5/d10/structast__threadpool.html#a1bad8223d34f52e7e7e11c0c20b20623">ast_threadpool::idle_threads</a></div><div class="ttdeci">struct ao2_container * idle_threads</div><div class="ttdoc">The container of idle threads. Idle threads are those that are currenly waiting to run tasks...</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/dc7/threadpool_8c_source.html#l00048">threadpool.c:48</a></div></div>
<div class="ttc" id="threadpool_8c_html_a77f79e913191ee36b6d34e86ac6cb1aa"><div class="ttname"><a href="../../d1/dc7/threadpool_8c.html#a77f79e913191ee36b6d34e86ac6cb1aa">threadpool_send_state_changed</a></div><div class="ttdeci">static void threadpool_send_state_changed(struct ast_threadpool *pool)</div><div class="ttdoc">Notify the threadpool listener that the state has changed. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/dc7/threadpool_8c_source.html#l00180">threadpool.c:180</a></div></div>
<div class="ttc" id="structthread__worker__pair_html_acbba1e1f081a6e0fefa291d74ec1a10d"><div class="ttname"><a href="../../d1/d34/structthread__worker__pair.html#acbba1e1f081a6e0fefa291d74ec1a10d">thread_worker_pair::worker</a></div><div class="ttdeci">struct worker_thread * worker</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/dc7/threadpool_8c_source.html#l00197">threadpool.c:197</a></div></div>
<div class="ttc" id="astobj2_8h_html_a64f51be4bee35c38dbe59b0a788b5ce8"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#a64f51be4bee35c38dbe59b0a788b5ce8">ao2_unlink</a></div><div class="ttdeci">#define ao2_unlink(container, obj)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l01598">astobj2.h:1598</a></div></div>
<div class="ttc" id="structpair_html"><div class="ttname"><a href="../../df/de8/structpair.html">pair</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d4f/test__config_8c_source.html#l00084">test_config.c:84</a></div></div>
<div class="ttc" id="threadpool_8c_html_a0041e0562576aadeec0ce50221ba2396"><div class="ttname"><a href="../../d1/dc7/threadpool_8c.html#a0041e0562576aadeec0ce50221ba2396">thread_worker_pair_free</a></div><div class="ttdeci">static void thread_worker_pair_free(struct thread_worker_pair *pair)</div><div class="ttdoc">Destructor for thread_worker_pair. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/dc7/threadpool_8c_source.html#l00203">threadpool.c:203</a></div></div>
<div class="ttc" id="structthread__worker__pair_html_ac8c18315f6d4a45480dea634294e683f"><div class="ttname"><a href="../../d1/d34/structthread__worker__pair.html#ac8c18315f6d4a45480dea634294e683f">thread_worker_pair::pool</a></div><div class="ttdeci">struct ast_threadpool * pool</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/dc7/threadpool_8c_source.html#l00195">threadpool.c:195</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a6dcc947c4d1eb51eaf8feb2efab14635"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6dcc947c4d1eb51eaf8feb2efab14635">&#9670;&nbsp;</a></span>queued_set_size()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int queued_set_size </td>
          <td>(</td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>data</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Change the size of the threadpool. </p>
<p>This can either result in shrinking or growing the threadpool depending on the new desired size and the current size.</p>
<p>This function is run from the threadpool control taskprocessor thread</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">data</td><td>A <a class="el" href="../../dc/d28/structset__size__data.html" title="Helper struct used for queued operations that change the size of the threadpool. ">set_size_data</a> used for determining how to act </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>0 </dd></dl>

<p class="definition">Definition at line <a class="el" href="../../d1/dc7/threadpool_8c_source.html#l00838">838</a> of file <a class="el" href="../../d1/dc7/threadpool_8c_source.html">threadpool.c</a>.</p>

<p class="reference">References <a class="el" href="../../d1/dc7/threadpool_8c_source.html#l00491">activate_thread()</a>, <a class="el" href="../../d1/dc7/threadpool_8c_source.html#l00043">ast_threadpool::active_threads</a>, <a class="el" href="../../d5/da5/astobj2_8h_source.html#l01716">ao2_callback</a>, <a class="el" href="../../d7/d22/astobj2__container_8c_source.html#l00034">ao2_container_count()</a>, <a class="el" href="../../d1/d8c/logger_8h_source.html#l00452">ast_debug</a>, <a class="el" href="../../d8/d8a/astmm_8h_source.html#l00182">ast_free</a>, <a class="el" href="../../d1/dc7/threadpool_8c_source.html#l00524">grow()</a>, <a class="el" href="../../d1/dc7/threadpool_8c_source.html#l00048">ast_threadpool::idle_threads</a>, <a class="el" href="../../d5/da5/astobj2_8h_source.html#l01053">OBJ_MULTIPLE</a>, <a class="el" href="../../d5/da5/astobj2_8h_source.html#l01048">OBJ_NODATA</a>, <a class="el" href="../../d5/da5/astobj2_8h_source.html#l01067">OBJ_NOLOCK</a>, <a class="el" href="../../d5/da5/astobj2_8h_source.html#l01043">OBJ_UNLINK</a>, <a class="el" href="../../d9/d21/res__rtp__asterisk_8c_source.html#l00236">pool</a>, <a class="el" href="../../d1/dc7/threadpool_8c_source.html#l00804">set_size_data::pool</a>, <a class="el" href="../../d1/dc7/threadpool_8c_source.html#l00775">shrink()</a>, <a class="el" href="../../d1/dc7/threadpool_8c_source.html#l00806">set_size_data::size</a>, and <a class="el" href="../../d1/dc7/threadpool_8c_source.html#l00180">threadpool_send_state_changed()</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../d1/dc7/threadpool_8c_source.html#l00874">ast_threadpool_set_size()</a>.</p>
<div class="fragment"><div class="line"><a name="l00839"></a><span class="lineno">  839</span>&#160;{</div><div class="line"><a name="l00840"></a><span class="lineno">  840</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../dc/d28/structset__size__data.html">set_size_data</a> *ssd = data;</div><div class="line"><a name="l00841"></a><span class="lineno">  841</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d5/d10/structast__threadpool.html">ast_threadpool</a> *<a class="code" href="../../d9/d21/res__rtp__asterisk_8c.html#a2e57658a5d3ef6c4ef2774c9d5868e7c">pool</a> = ssd-&gt;<a class="code" href="../../dc/d28/structset__size__data.html#ac8c18315f6d4a45480dea634294e683f">pool</a>;</div><div class="line"><a name="l00842"></a><span class="lineno">  842</span>&#160;   <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> num_threads = ssd-&gt;<a class="code" href="../../dc/d28/structset__size__data.html#aac913b3a1f6ef005d66bf7a84428773e">size</a>;</div><div class="line"><a name="l00843"></a><span class="lineno">  843</span>&#160;</div><div class="line"><a name="l00844"></a><span class="lineno">  844</span>&#160;   <span class="comment">/* We don&#39;t count zombie threads as being &quot;live&quot; when potentially resizing */</span></div><div class="line"><a name="l00845"></a><span class="lineno">  845</span>&#160;   <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> current_size = <a class="code" href="../../d5/da5/astobj2_8h.html#a512cc40ce96c63b3d5c78040baa4c9cd">ao2_container_count</a>(pool-&gt;<a class="code" href="../../d5/d10/structast__threadpool.html#af151fe496c19e89e750605192e7726c8">active_threads</a>) +</div><div class="line"><a name="l00846"></a><span class="lineno">  846</span>&#160;         <a class="code" href="../../d5/da5/astobj2_8h.html#a512cc40ce96c63b3d5c78040baa4c9cd">ao2_container_count</a>(pool-&gt;<a class="code" href="../../d5/d10/structast__threadpool.html#a1bad8223d34f52e7e7e11c0c20b20623">idle_threads</a>);</div><div class="line"><a name="l00847"></a><span class="lineno">  847</span>&#160;</div><div class="line"><a name="l00848"></a><span class="lineno">  848</span>&#160;   <a class="code" href="../../d8/d8a/astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(ssd);</div><div class="line"><a name="l00849"></a><span class="lineno">  849</span>&#160;</div><div class="line"><a name="l00850"></a><span class="lineno">  850</span>&#160;   <span class="keywordflow">if</span> (current_size == num_threads) {</div><div class="line"><a name="l00851"></a><span class="lineno">  851</span>&#160;      <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(3, <span class="stringliteral">&quot;Not changing threadpool size since new size %u is the same as current %u\n&quot;</span>,</div><div class="line"><a name="l00852"></a><span class="lineno">  852</span>&#160;           num_threads, current_size);</div><div class="line"><a name="l00853"></a><span class="lineno">  853</span>&#160;      <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00854"></a><span class="lineno">  854</span>&#160;   }</div><div class="line"><a name="l00855"></a><span class="lineno">  855</span>&#160;</div><div class="line"><a name="l00856"></a><span class="lineno">  856</span>&#160;   <span class="keywordflow">if</span> (current_size &lt; num_threads) {</div><div class="line"><a name="l00857"></a><span class="lineno">  857</span>&#160;      <a class="code" href="../../d5/da5/astobj2_8h.html#a47857055118a703ae87ea5ebaf4842ed">ao2_callback</a>(pool-&gt;<a class="code" href="../../d5/d10/structast__threadpool.html#a1bad8223d34f52e7e7e11c0c20b20623">idle_threads</a>, <a class="code" href="../../d5/da5/astobj2_8h.html#ad9d009e87e737af900825b36db55a35ca71f42ec6460e60eb6e10956c53329e45">OBJ_UNLINK</a> | <a class="code" href="../../d5/da5/astobj2_8h.html#ad9d009e87e737af900825b36db55a35ca52efdf13b66ae502e2e20a5f49f068de">OBJ_NOLOCK</a> | <a class="code" href="../../d5/da5/astobj2_8h.html#ad9d009e87e737af900825b36db55a35ca5fc59b193d86a0a8ddfe866304be829d">OBJ_NODATA</a> | <a class="code" href="../../d5/da5/astobj2_8h.html#ad9d009e87e737af900825b36db55a35ca614744a4d36b3189d4ab5b02c8645d47">OBJ_MULTIPLE</a>,</div><div class="line"><a name="l00858"></a><span class="lineno">  858</span>&#160;            <a class="code" href="../../d1/dc7/threadpool_8c.html#a180728fe1bdbe0895097666c4bad2999">activate_thread</a>, pool);</div><div class="line"><a name="l00859"></a><span class="lineno">  859</span>&#160;</div><div class="line"><a name="l00860"></a><span class="lineno">  860</span>&#160;      <span class="comment">/* As the above may have altered the number of current threads update it */</span></div><div class="line"><a name="l00861"></a><span class="lineno">  861</span>&#160;      current_size = <a class="code" href="../../d5/da5/astobj2_8h.html#a512cc40ce96c63b3d5c78040baa4c9cd">ao2_container_count</a>(pool-&gt;<a class="code" href="../../d5/d10/structast__threadpool.html#af151fe496c19e89e750605192e7726c8">active_threads</a>) +</div><div class="line"><a name="l00862"></a><span class="lineno">  862</span>&#160;            <a class="code" href="../../d5/da5/astobj2_8h.html#a512cc40ce96c63b3d5c78040baa4c9cd">ao2_container_count</a>(pool-&gt;<a class="code" href="../../d5/d10/structast__threadpool.html#a1bad8223d34f52e7e7e11c0c20b20623">idle_threads</a>);</div><div class="line"><a name="l00863"></a><span class="lineno">  863</span>&#160;      <a class="code" href="../../d1/dc7/threadpool_8c.html#a4b7d634038cf195b340980395ec1b9a4">grow</a>(pool, num_threads - current_size);</div><div class="line"><a name="l00864"></a><span class="lineno">  864</span>&#160;      <a class="code" href="../../d5/da5/astobj2_8h.html#a47857055118a703ae87ea5ebaf4842ed">ao2_callback</a>(pool-&gt;<a class="code" href="../../d5/d10/structast__threadpool.html#a1bad8223d34f52e7e7e11c0c20b20623">idle_threads</a>, <a class="code" href="../../d5/da5/astobj2_8h.html#ad9d009e87e737af900825b36db55a35ca71f42ec6460e60eb6e10956c53329e45">OBJ_UNLINK</a> | <a class="code" href="../../d5/da5/astobj2_8h.html#ad9d009e87e737af900825b36db55a35ca52efdf13b66ae502e2e20a5f49f068de">OBJ_NOLOCK</a> | <a class="code" href="../../d5/da5/astobj2_8h.html#ad9d009e87e737af900825b36db55a35ca5fc59b193d86a0a8ddfe866304be829d">OBJ_NODATA</a> | <a class="code" href="../../d5/da5/astobj2_8h.html#ad9d009e87e737af900825b36db55a35ca614744a4d36b3189d4ab5b02c8645d47">OBJ_MULTIPLE</a>,</div><div class="line"><a name="l00865"></a><span class="lineno">  865</span>&#160;            <a class="code" href="../../d1/dc7/threadpool_8c.html#a180728fe1bdbe0895097666c4bad2999">activate_thread</a>, pool);</div><div class="line"><a name="l00866"></a><span class="lineno">  866</span>&#160;   } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00867"></a><span class="lineno">  867</span>&#160;      <a class="code" href="../../d1/dc7/threadpool_8c.html#a7bbaf491f374ac79e84f3585989ae349">shrink</a>(pool, current_size - num_threads);</div><div class="line"><a name="l00868"></a><span class="lineno">  868</span>&#160;   }</div><div class="line"><a name="l00869"></a><span class="lineno">  869</span>&#160;</div><div class="line"><a name="l00870"></a><span class="lineno">  870</span>&#160;   <a class="code" href="../../d1/dc7/threadpool_8c.html#a77f79e913191ee36b6d34e86ac6cb1aa">threadpool_send_state_changed</a>(pool);</div><div class="line"><a name="l00871"></a><span class="lineno">  871</span>&#160;   <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00872"></a><span class="lineno">  872</span>&#160;}</div><div class="ttc" id="astobj2_8h_html_a512cc40ce96c63b3d5c78040baa4c9cd"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#a512cc40ce96c63b3d5c78040baa4c9cd">ao2_container_count</a></div><div class="ttdeci">int ao2_container_count(struct ao2_container *c)</div><div class="ttdoc">Returns the number of elements in a container. </div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d22/astobj2__container_8c_source.html#l00034">astobj2_container.c:34</a></div></div>
<div class="ttc" id="threadpool_8c_html_a4b7d634038cf195b340980395ec1b9a4"><div class="ttname"><a href="../../d1/dc7/threadpool_8c.html#a4b7d634038cf195b340980395ec1b9a4">grow</a></div><div class="ttdeci">static void grow(struct ast_threadpool *pool, int delta)</div><div class="ttdoc">Add threads to the threadpool. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/dc7/threadpool_8c_source.html#l00524">threadpool.c:524</a></div></div>
<div class="ttc" id="astobj2_8h_html_ad9d009e87e737af900825b36db55a35ca5fc59b193d86a0a8ddfe866304be829d"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#ad9d009e87e737af900825b36db55a35ca5fc59b193d86a0a8ddfe866304be829d">OBJ_NODATA</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l01048">astobj2.h:1048</a></div></div>
<div class="ttc" id="threadpool_8c_html_a7bbaf491f374ac79e84f3585989ae349"><div class="ttname"><a href="../../d1/dc7/threadpool_8c.html#a7bbaf491f374ac79e84f3585989ae349">shrink</a></div><div class="ttdeci">static void shrink(struct ast_threadpool *pool, int delta)</div><div class="ttdoc">Remove threads from the threadpool. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/dc7/threadpool_8c_source.html#l00775">threadpool.c:775</a></div></div>
<div class="ttc" id="astobj2_8h_html_a47857055118a703ae87ea5ebaf4842ed"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#a47857055118a703ae87ea5ebaf4842ed">ao2_callback</a></div><div class="ttdeci">#define ao2_callback(c, flags, cb_fn, arg)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l01716">astobj2.h:1716</a></div></div>
<div class="ttc" id="structast__threadpool_html_a1bad8223d34f52e7e7e11c0c20b20623"><div class="ttname"><a href="../../d5/d10/structast__threadpool.html#a1bad8223d34f52e7e7e11c0c20b20623">ast_threadpool::idle_threads</a></div><div class="ttdeci">struct ao2_container * idle_threads</div><div class="ttdoc">The container of idle threads. Idle threads are those that are currenly waiting to run tasks...</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/dc7/threadpool_8c_source.html#l00048">threadpool.c:48</a></div></div>
<div class="ttc" id="res__rtp__asterisk_8c_html_a2e57658a5d3ef6c4ef2774c9d5868e7c"><div class="ttname"><a href="../../d9/d21/res__rtp__asterisk_8c.html#a2e57658a5d3ef6c4ef2774c9d5868e7c">pool</a></div><div class="ttdeci">static pj_pool_t * pool</div><div class="ttdoc">Global memory pool for configuration and timers. </div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d21/res__rtp__asterisk_8c_source.html#l00236">res_rtp_asterisk.c:236</a></div></div>
<div class="ttc" id="astobj2_8h_html_ad9d009e87e737af900825b36db55a35ca52efdf13b66ae502e2e20a5f49f068de"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#ad9d009e87e737af900825b36db55a35ca52efdf13b66ae502e2e20a5f49f068de">OBJ_NOLOCK</a></div><div class="ttdoc">Assume that the ao2_container is already locked. </div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l01067">astobj2.h:1067</a></div></div>
<div class="ttc" id="astobj2_8h_html_ad9d009e87e737af900825b36db55a35ca71f42ec6460e60eb6e10956c53329e45"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#ad9d009e87e737af900825b36db55a35ca71f42ec6460e60eb6e10956c53329e45">OBJ_UNLINK</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l01043">astobj2.h:1043</a></div></div>
<div class="ttc" id="structset__size__data_html"><div class="ttname"><a href="../../dc/d28/structset__size__data.html">set_size_data</a></div><div class="ttdoc">Helper struct used for queued operations that change the size of the threadpool. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/dc7/threadpool_8c_source.html#l00802">threadpool.c:802</a></div></div>
<div class="ttc" id="threadpool_8c_html_a77f79e913191ee36b6d34e86ac6cb1aa"><div class="ttname"><a href="../../d1/dc7/threadpool_8c.html#a77f79e913191ee36b6d34e86ac6cb1aa">threadpool_send_state_changed</a></div><div class="ttdeci">static void threadpool_send_state_changed(struct ast_threadpool *pool)</div><div class="ttdoc">Notify the threadpool listener that the state has changed. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/dc7/threadpool_8c_source.html#l00180">threadpool.c:180</a></div></div>
<div class="ttc" id="threadpool_8c_html_a180728fe1bdbe0895097666c4bad2999"><div class="ttname"><a href="../../d1/dc7/threadpool_8c.html#a180728fe1bdbe0895097666c4bad2999">activate_thread</a></div><div class="ttdeci">static int activate_thread(void *obj, void *arg, int flags)</div><div class="ttdoc">Activate idle threads. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/dc7/threadpool_8c_source.html#l00491">threadpool.c:491</a></div></div>
<div class="ttc" id="logger_8h_html_a3f248112c8d6ce7e3959aa723dade648"><div class="ttname"><a href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a></div><div class="ttdeci">#define ast_debug(level,...)</div><div class="ttdoc">Log a DEBUG message. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d8c/logger_8h_source.html#l00452">logger.h:452</a></div></div>
<div class="ttc" id="structset__size__data_html_ac8c18315f6d4a45480dea634294e683f"><div class="ttname"><a href="../../dc/d28/structset__size__data.html#ac8c18315f6d4a45480dea634294e683f">set_size_data::pool</a></div><div class="ttdeci">struct ast_threadpool * pool</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/dc7/threadpool_8c_source.html#l00804">threadpool.c:804</a></div></div>
<div class="ttc" id="astmm_8h_html_a402072d6789f6ed9e3a81da27504127e"><div class="ttname"><a href="../../d8/d8a/astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a></div><div class="ttdeci">#define ast_free(a)</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d8a/astmm_8h_source.html#l00182">astmm.h:182</a></div></div>
<div class="ttc" id="structast__threadpool_html_af151fe496c19e89e750605192e7726c8"><div class="ttname"><a href="../../d5/d10/structast__threadpool.html#af151fe496c19e89e750605192e7726c8">ast_threadpool::active_threads</a></div><div class="ttdeci">struct ao2_container * active_threads</div><div class="ttdoc">The container of active threads. Active threads are those that are currently running tasks...</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/dc7/threadpool_8c_source.html#l00043">threadpool.c:43</a></div></div>
<div class="ttc" id="structast__threadpool_html"><div class="ttname"><a href="../../d5/d10/structast__threadpool.html">ast_threadpool</a></div><div class="ttdoc">An opaque threadpool structure. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/dc7/threadpool_8c_source.html#l00036">threadpool.c:36</a></div></div>
<div class="ttc" id="structset__size__data_html_aac913b3a1f6ef005d66bf7a84428773e"><div class="ttname"><a href="../../dc/d28/structset__size__data.html#aac913b3a1f6ef005d66bf7a84428773e">set_size_data::size</a></div><div class="ttdeci">unsigned int size</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/dc7/threadpool_8c_source.html#l00806">threadpool.c:806</a></div></div>
<div class="ttc" id="astobj2_8h_html_ad9d009e87e737af900825b36db55a35ca614744a4d36b3189d4ab5b02c8645d47"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#ad9d009e87e737af900825b36db55a35ca614744a4d36b3189d4ab5b02c8645d47">OBJ_MULTIPLE</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l01053">astobj2.h:1053</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a179beb37a4570d77547617e37ec3d368"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a179beb37a4570d77547617e37ec3d368">&#9670;&nbsp;</a></span>queued_task_pushed()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int queued_task_pushed </td>
          <td>(</td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>data</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Queued task called when tasks are pushed into the threadpool. </p>
<p>This function first calls into the threadpool's listener to let it know that a task has been pushed. It then wakes up all idle threads and moves them into the active thread container. </p><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">data</td><td>A <a class="el" href="../../d8/d82/structtask__pushed__data.html" title="helper used for queued task when tasks are pushed ">task_pushed_data</a> </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>0 </dd></dl>

<p class="definition">Definition at line <a class="el" href="../../d1/dc7/threadpool_8c_source.html#l00564">564</a> of file <a class="el" href="../../d1/dc7/threadpool_8c_source.html">threadpool.c</a>.</p>

<p class="reference">References <a class="el" href="../../d1/dc7/threadpool_8c_source.html#l00491">activate_thread()</a>, <a class="el" href="../../d1/dc7/threadpool_8c_source.html#l00043">ast_threadpool::active_threads</a>, <a class="el" href="../../d5/da5/astobj2_8h_source.html#l01716">ao2_callback</a>, <a class="el" href="../../d7/d22/astobj2__container_8c_source.html#l00034">ao2_container_count()</a>, <a class="el" href="../../d8/d8a/astmm_8h_source.html#l00182">ast_free</a>, <a class="el" href="../../d3/d40/threadpool_8h_source.html#l00090">ast_threadpool_options::auto_increment</a>, <a class="el" href="../../d1/dc7/threadpool_8c_source.html#l00112">ast_threadpool_listener::callbacks</a>, <a class="el" href="../../d1/dc7/threadpool_8c_source.html#l00524">grow()</a>, <a class="el" href="../../d1/dc7/threadpool_8c_source.html#l00048">ast_threadpool::idle_threads</a>, <a class="el" href="../../d1/dc7/threadpool_8c_source.html#l00038">ast_threadpool::listener</a>, <a class="el" href="../../d5/da5/astobj2_8h_source.html#l01048">OBJ_NODATA</a>, <a class="el" href="../../d5/da5/astobj2_8h_source.html#l01067">OBJ_NOLOCK</a>, <a class="el" href="../../d5/da5/astobj2_8h_source.html#l01043">OBJ_UNLINK</a>, <a class="el" href="../../d1/dc7/threadpool_8c_source.html#l00100">ast_threadpool::options</a>, <a class="el" href="../../d9/d21/res__rtp__asterisk_8c_source.html#l00236">pool</a>, <a class="el" href="../../d1/dc7/threadpool_8c_source.html#l00454">task_pushed_data::pool</a>, <a class="el" href="../../d3/d40/threadpool_8h_source.html#l00047">ast_threadpool_listener_callbacks::task_pushed</a>, <a class="el" href="../../d1/dc7/threadpool_8c_source.html#l00180">threadpool_send_state_changed()</a>, and <a class="el" href="../../d1/dc7/threadpool_8c_source.html#l00456">task_pushed_data::was_empty</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../d1/dc7/threadpool_8c_source.html#l00610">threadpool_tps_task_pushed()</a>.</p>
<div class="fragment"><div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;{</div><div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d8/d82/structtask__pushed__data.html">task_pushed_data</a> *tpd = data;</div><div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d5/d10/structast__threadpool.html">ast_threadpool</a> *<a class="code" href="../../d9/d21/res__rtp__asterisk_8c.html#a2e57658a5d3ef6c4ef2774c9d5868e7c">pool</a> = tpd-&gt;<a class="code" href="../../d8/d82/structtask__pushed__data.html#ac8c18315f6d4a45480dea634294e683f">pool</a>;</div><div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;   <span class="keywordtype">int</span> was_empty = tpd-&gt;<a class="code" href="../../d8/d82/structtask__pushed__data.html#a37cdff51e63f885b3a82f34a6673bfbb">was_empty</a>;</div><div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;   <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> existing_active;</div><div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;</div><div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;   <a class="code" href="../../d8/d8a/astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(tpd);</div><div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;</div><div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;   <span class="keywordflow">if</span> (pool-&gt;<a class="code" href="../../d5/d10/structast__threadpool.html#a9a8a970d797bbe611df35df7d8318b1d">listener</a> &amp;&amp; pool-&gt;<a class="code" href="../../d5/d10/structast__threadpool.html#a9a8a970d797bbe611df35df7d8318b1d">listener</a>-&gt;<a class="code" href="../../dd/d12/structast__threadpool__listener.html#ae47947f47eb99da4337ce95cddd1d614">callbacks</a>-&gt;<a class="code" href="../../df/d64/structast__threadpool__listener__callbacks.html#aea8727976bb7720aa9ea36914587c1d6">task_pushed</a>) {</div><div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;      pool-&gt;<a class="code" href="../../d5/d10/structast__threadpool.html#a9a8a970d797bbe611df35df7d8318b1d">listener</a>-&gt;<a class="code" href="../../dd/d12/structast__threadpool__listener.html#ae47947f47eb99da4337ce95cddd1d614">callbacks</a>-&gt;<a class="code" href="../../df/d64/structast__threadpool__listener__callbacks.html#aea8727976bb7720aa9ea36914587c1d6">task_pushed</a>(pool, pool-&gt;<a class="code" href="../../d5/d10/structast__threadpool.html#a9a8a970d797bbe611df35df7d8318b1d">listener</a>, was_empty);</div><div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;   }</div><div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;</div><div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;   existing_active = <a class="code" href="../../d5/da5/astobj2_8h.html#a512cc40ce96c63b3d5c78040baa4c9cd">ao2_container_count</a>(pool-&gt;<a class="code" href="../../d5/d10/structast__threadpool.html#af151fe496c19e89e750605192e7726c8">active_threads</a>);</div><div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;</div><div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;   <span class="comment">/* The first pass transitions any existing idle threads to be active, and</span></div><div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;<span class="comment">    * will also remove any worker threads that have recently entered the dead</span></div><div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;<span class="comment">    * state.</span></div><div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;<span class="comment">    */</span></div><div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#a47857055118a703ae87ea5ebaf4842ed">ao2_callback</a>(pool-&gt;<a class="code" href="../../d5/d10/structast__threadpool.html#a1bad8223d34f52e7e7e11c0c20b20623">idle_threads</a>, <a class="code" href="../../d5/da5/astobj2_8h.html#ad9d009e87e737af900825b36db55a35ca71f42ec6460e60eb6e10956c53329e45">OBJ_UNLINK</a> | <a class="code" href="../../d5/da5/astobj2_8h.html#ad9d009e87e737af900825b36db55a35ca52efdf13b66ae502e2e20a5f49f068de">OBJ_NOLOCK</a> | <a class="code" href="../../d5/da5/astobj2_8h.html#ad9d009e87e737af900825b36db55a35ca5fc59b193d86a0a8ddfe866304be829d">OBJ_NODATA</a>,</div><div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;         <a class="code" href="../../d1/dc7/threadpool_8c.html#a180728fe1bdbe0895097666c4bad2999">activate_thread</a>, pool);</div><div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;</div><div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;   <span class="comment">/* If no idle threads could be transitioned to active grow the pool as permitted. */</span></div><div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d5/da5/astobj2_8h.html#a512cc40ce96c63b3d5c78040baa4c9cd">ao2_container_count</a>(pool-&gt;<a class="code" href="../../d5/d10/structast__threadpool.html#af151fe496c19e89e750605192e7726c8">active_threads</a>) == existing_active) {</div><div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;      <span class="keywordflow">if</span> (!pool-&gt;<a class="code" href="../../d5/d10/structast__threadpool.html#a83b47841343f8af6b4ab20abe3c2ab24">options</a>.<a class="code" href="../../de/de6/structast__threadpool__options.html#ae44aa7ff10e622be697711e67c13be3b">auto_increment</a>) {</div><div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;         <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;      }</div><div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;      <a class="code" href="../../d1/dc7/threadpool_8c.html#a4b7d634038cf195b340980395ec1b9a4">grow</a>(pool, pool-&gt;<a class="code" href="../../d5/d10/structast__threadpool.html#a83b47841343f8af6b4ab20abe3c2ab24">options</a>.<a class="code" href="../../de/de6/structast__threadpool__options.html#ae44aa7ff10e622be697711e67c13be3b">auto_increment</a>);</div><div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;      <span class="comment">/* An optional second pass transitions any newly added threads. */</span></div><div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;      <a class="code" href="../../d5/da5/astobj2_8h.html#a47857055118a703ae87ea5ebaf4842ed">ao2_callback</a>(pool-&gt;<a class="code" href="../../d5/d10/structast__threadpool.html#a1bad8223d34f52e7e7e11c0c20b20623">idle_threads</a>, <a class="code" href="../../d5/da5/astobj2_8h.html#ad9d009e87e737af900825b36db55a35ca71f42ec6460e60eb6e10956c53329e45">OBJ_UNLINK</a> | <a class="code" href="../../d5/da5/astobj2_8h.html#ad9d009e87e737af900825b36db55a35ca52efdf13b66ae502e2e20a5f49f068de">OBJ_NOLOCK</a> | <a class="code" href="../../d5/da5/astobj2_8h.html#ad9d009e87e737af900825b36db55a35ca5fc59b193d86a0a8ddfe866304be829d">OBJ_NODATA</a>,</div><div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;            <a class="code" href="../../d1/dc7/threadpool_8c.html#a180728fe1bdbe0895097666c4bad2999">activate_thread</a>, pool);</div><div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;   }</div><div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;</div><div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;   <a class="code" href="../../d1/dc7/threadpool_8c.html#a77f79e913191ee36b6d34e86ac6cb1aa">threadpool_send_state_changed</a>(pool);</div><div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;   <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;}</div><div class="ttc" id="structast__threadpool__options_html_ae44aa7ff10e622be697711e67c13be3b"><div class="ttname"><a href="../../de/de6/structast__threadpool__options.html#ae44aa7ff10e622be697711e67c13be3b">ast_threadpool_options::auto_increment</a></div><div class="ttdeci">int auto_increment</div><div class="ttdoc">Number of threads to increment pool by. </div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d40/threadpool_8h_source.html#l00090">threadpool.h:90</a></div></div>
<div class="ttc" id="astobj2_8h_html_a512cc40ce96c63b3d5c78040baa4c9cd"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#a512cc40ce96c63b3d5c78040baa4c9cd">ao2_container_count</a></div><div class="ttdeci">int ao2_container_count(struct ao2_container *c)</div><div class="ttdoc">Returns the number of elements in a container. </div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d22/astobj2__container_8c_source.html#l00034">astobj2_container.c:34</a></div></div>
<div class="ttc" id="threadpool_8c_html_a4b7d634038cf195b340980395ec1b9a4"><div class="ttname"><a href="../../d1/dc7/threadpool_8c.html#a4b7d634038cf195b340980395ec1b9a4">grow</a></div><div class="ttdeci">static void grow(struct ast_threadpool *pool, int delta)</div><div class="ttdoc">Add threads to the threadpool. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/dc7/threadpool_8c_source.html#l00524">threadpool.c:524</a></div></div>
<div class="ttc" id="astobj2_8h_html_ad9d009e87e737af900825b36db55a35ca5fc59b193d86a0a8ddfe866304be829d"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#ad9d009e87e737af900825b36db55a35ca5fc59b193d86a0a8ddfe866304be829d">OBJ_NODATA</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l01048">astobj2.h:1048</a></div></div>
<div class="ttc" id="astobj2_8h_html_a47857055118a703ae87ea5ebaf4842ed"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#a47857055118a703ae87ea5ebaf4842ed">ao2_callback</a></div><div class="ttdeci">#define ao2_callback(c, flags, cb_fn, arg)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l01716">astobj2.h:1716</a></div></div>
<div class="ttc" id="structast__threadpool_html_a83b47841343f8af6b4ab20abe3c2ab24"><div class="ttname"><a href="../../d5/d10/structast__threadpool.html#a83b47841343f8af6b4ab20abe3c2ab24">ast_threadpool::options</a></div><div class="ttdeci">struct ast_threadpool_options options</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/dc7/threadpool_8c_source.html#l00100">threadpool.c:100</a></div></div>
<div class="ttc" id="structast__threadpool_html_a1bad8223d34f52e7e7e11c0c20b20623"><div class="ttname"><a href="../../d5/d10/structast__threadpool.html#a1bad8223d34f52e7e7e11c0c20b20623">ast_threadpool::idle_threads</a></div><div class="ttdeci">struct ao2_container * idle_threads</div><div class="ttdoc">The container of idle threads. Idle threads are those that are currenly waiting to run tasks...</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/dc7/threadpool_8c_source.html#l00048">threadpool.c:48</a></div></div>
<div class="ttc" id="res__rtp__asterisk_8c_html_a2e57658a5d3ef6c4ef2774c9d5868e7c"><div class="ttname"><a href="../../d9/d21/res__rtp__asterisk_8c.html#a2e57658a5d3ef6c4ef2774c9d5868e7c">pool</a></div><div class="ttdeci">static pj_pool_t * pool</div><div class="ttdoc">Global memory pool for configuration and timers. </div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d21/res__rtp__asterisk_8c_source.html#l00236">res_rtp_asterisk.c:236</a></div></div>
<div class="ttc" id="astobj2_8h_html_ad9d009e87e737af900825b36db55a35ca52efdf13b66ae502e2e20a5f49f068de"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#ad9d009e87e737af900825b36db55a35ca52efdf13b66ae502e2e20a5f49f068de">OBJ_NOLOCK</a></div><div class="ttdoc">Assume that the ao2_container is already locked. </div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l01067">astobj2.h:1067</a></div></div>
<div class="ttc" id="astobj2_8h_html_ad9d009e87e737af900825b36db55a35ca71f42ec6460e60eb6e10956c53329e45"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#ad9d009e87e737af900825b36db55a35ca71f42ec6460e60eb6e10956c53329e45">OBJ_UNLINK</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l01043">astobj2.h:1043</a></div></div>
<div class="ttc" id="structast__threadpool__listener_html_ae47947f47eb99da4337ce95cddd1d614"><div class="ttname"><a href="../../dd/d12/structast__threadpool__listener.html#ae47947f47eb99da4337ce95cddd1d614">ast_threadpool_listener::callbacks</a></div><div class="ttdeci">const struct ast_threadpool_listener_callbacks * callbacks</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/dc7/threadpool_8c_source.html#l00112">threadpool.c:112</a></div></div>
<div class="ttc" id="threadpool_8c_html_a77f79e913191ee36b6d34e86ac6cb1aa"><div class="ttname"><a href="../../d1/dc7/threadpool_8c.html#a77f79e913191ee36b6d34e86ac6cb1aa">threadpool_send_state_changed</a></div><div class="ttdeci">static void threadpool_send_state_changed(struct ast_threadpool *pool)</div><div class="ttdoc">Notify the threadpool listener that the state has changed. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/dc7/threadpool_8c_source.html#l00180">threadpool.c:180</a></div></div>
<div class="ttc" id="threadpool_8c_html_a180728fe1bdbe0895097666c4bad2999"><div class="ttname"><a href="../../d1/dc7/threadpool_8c.html#a180728fe1bdbe0895097666c4bad2999">activate_thread</a></div><div class="ttdeci">static int activate_thread(void *obj, void *arg, int flags)</div><div class="ttdoc">Activate idle threads. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/dc7/threadpool_8c_source.html#l00491">threadpool.c:491</a></div></div>
<div class="ttc" id="structast__threadpool_html_a9a8a970d797bbe611df35df7d8318b1d"><div class="ttname"><a href="../../d5/d10/structast__threadpool.html#a9a8a970d797bbe611df35df7d8318b1d">ast_threadpool::listener</a></div><div class="ttdeci">struct ast_threadpool_listener * listener</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/dc7/threadpool_8c_source.html#l00038">threadpool.c:38</a></div></div>
<div class="ttc" id="structtask__pushed__data_html_ac8c18315f6d4a45480dea634294e683f"><div class="ttname"><a href="../../d8/d82/structtask__pushed__data.html#ac8c18315f6d4a45480dea634294e683f">task_pushed_data::pool</a></div><div class="ttdeci">struct ast_threadpool * pool</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/dc7/threadpool_8c_source.html#l00454">threadpool.c:454</a></div></div>
<div class="ttc" id="astmm_8h_html_a402072d6789f6ed9e3a81da27504127e"><div class="ttname"><a href="../../d8/d8a/astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a></div><div class="ttdeci">#define ast_free(a)</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d8a/astmm_8h_source.html#l00182">astmm.h:182</a></div></div>
<div class="ttc" id="structast__threadpool_html_af151fe496c19e89e750605192e7726c8"><div class="ttname"><a href="../../d5/d10/structast__threadpool.html#af151fe496c19e89e750605192e7726c8">ast_threadpool::active_threads</a></div><div class="ttdeci">struct ao2_container * active_threads</div><div class="ttdoc">The container of active threads. Active threads are those that are currently running tasks...</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/dc7/threadpool_8c_source.html#l00043">threadpool.c:43</a></div></div>
<div class="ttc" id="structast__threadpool__listener__callbacks_html_aea8727976bb7720aa9ea36914587c1d6"><div class="ttname"><a href="../../df/d64/structast__threadpool__listener__callbacks.html#aea8727976bb7720aa9ea36914587c1d6">ast_threadpool_listener_callbacks::task_pushed</a></div><div class="ttdeci">void(* task_pushed)(struct ast_threadpool *pool, struct ast_threadpool_listener *listener, int was_empty)</div><div class="ttdoc">Indicates that a task was pushed to the threadpool. </div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d40/threadpool_8h_source.html#l00047">threadpool.h:47</a></div></div>
<div class="ttc" id="structast__threadpool_html"><div class="ttname"><a href="../../d5/d10/structast__threadpool.html">ast_threadpool</a></div><div class="ttdoc">An opaque threadpool structure. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/dc7/threadpool_8c_source.html#l00036">threadpool.c:36</a></div></div>
<div class="ttc" id="structtask__pushed__data_html"><div class="ttname"><a href="../../d8/d82/structtask__pushed__data.html">task_pushed_data</a></div><div class="ttdoc">helper used for queued task when tasks are pushed </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/dc7/threadpool_8c_source.html#l00452">threadpool.c:452</a></div></div>
<div class="ttc" id="structtask__pushed__data_html_a37cdff51e63f885b3a82f34a6673bfbb"><div class="ttname"><a href="../../d8/d82/structtask__pushed__data.html#a37cdff51e63f885b3a82f34a6673bfbb">task_pushed_data::was_empty</a></div><div class="ttdeci">int was_empty</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/dc7/threadpool_8c_source.html#l00456">threadpool.c:456</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a9943d81da4d867f7c77f8935bdfb2d62"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a9943d81da4d867f7c77f8935bdfb2d62">&#9670;&nbsp;</a></span>queued_zombie_thread_dead()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int queued_zombie_thread_dead </td>
          <td>(</td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>data</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Kill a zombie thread. </p>
<p>This runs from the threadpool's control taskprocessor thread.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">data</td><td>A <a class="el" href="../../d1/d34/structthread__worker__pair.html" title="Struct used for queued operations involving worker state changes. ">thread_worker_pair</a> containing the threadpool and the zombie thread </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>0 </dd></dl>

<p class="definition">Definition at line <a class="el" href="../../d1/dc7/threadpool_8c_source.html#l00284">284</a> of file <a class="el" href="../../d1/dc7/threadpool_8c_source.html">threadpool.c</a>.</p>

<p class="reference">References <a class="el" href="../../d5/da5/astobj2_8h_source.html#l01598">ao2_unlink</a>, <a class="el" href="../../d1/dc7/threadpool_8c_source.html#l00195">thread_worker_pair::pool</a>, <a class="el" href="../../d1/dc7/threadpool_8c_source.html#l00203">thread_worker_pair_free()</a>, <a class="el" href="../../d1/dc7/threadpool_8c_source.html#l00180">threadpool_send_state_changed()</a>, <a class="el" href="../../d1/dc7/threadpool_8c_source.html#l00197">thread_worker_pair::worker</a>, and <a class="el" href="../../d1/dc7/threadpool_8c_source.html#l00053">ast_threadpool::zombie_threads</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../d1/dc7/threadpool_8c_source.html#l00301">threadpool_zombie_thread_dead()</a>.</p>
<div class="fragment"><div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;{</div><div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d1/d34/structthread__worker__pair.html">thread_worker_pair</a> *<a class="code" href="../../df/de8/structpair.html">pair</a> = data;</div><div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;</div><div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#a64f51be4bee35c38dbe59b0a788b5ce8">ao2_unlink</a>(pair-&gt;<a class="code" href="../../d1/d34/structthread__worker__pair.html#ac8c18315f6d4a45480dea634294e683f">pool</a>-&gt;<a class="code" href="../../d5/d10/structast__threadpool.html#a9a66e112220169c037a83525533ec817">zombie_threads</a>, pair-&gt;<a class="code" href="../../d1/d34/structthread__worker__pair.html#acbba1e1f081a6e0fefa291d74ec1a10d">worker</a>);</div><div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;   <a class="code" href="../../d1/dc7/threadpool_8c.html#a77f79e913191ee36b6d34e86ac6cb1aa">threadpool_send_state_changed</a>(pair-&gt;<a class="code" href="../../d1/d34/structthread__worker__pair.html#ac8c18315f6d4a45480dea634294e683f">pool</a>);</div><div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;</div><div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;   <a class="code" href="../../d1/dc7/threadpool_8c.html#a0041e0562576aadeec0ce50221ba2396">thread_worker_pair_free</a>(pair);</div><div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;   <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;}</div><div class="ttc" id="structthread__worker__pair_html"><div class="ttname"><a href="../../d1/d34/structthread__worker__pair.html">thread_worker_pair</a></div><div class="ttdoc">Struct used for queued operations involving worker state changes. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/dc7/threadpool_8c_source.html#l00193">threadpool.c:193</a></div></div>
<div class="ttc" id="threadpool_8c_html_a77f79e913191ee36b6d34e86ac6cb1aa"><div class="ttname"><a href="../../d1/dc7/threadpool_8c.html#a77f79e913191ee36b6d34e86ac6cb1aa">threadpool_send_state_changed</a></div><div class="ttdeci">static void threadpool_send_state_changed(struct ast_threadpool *pool)</div><div class="ttdoc">Notify the threadpool listener that the state has changed. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/dc7/threadpool_8c_source.html#l00180">threadpool.c:180</a></div></div>
<div class="ttc" id="structthread__worker__pair_html_acbba1e1f081a6e0fefa291d74ec1a10d"><div class="ttname"><a href="../../d1/d34/structthread__worker__pair.html#acbba1e1f081a6e0fefa291d74ec1a10d">thread_worker_pair::worker</a></div><div class="ttdeci">struct worker_thread * worker</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/dc7/threadpool_8c_source.html#l00197">threadpool.c:197</a></div></div>
<div class="ttc" id="astobj2_8h_html_a64f51be4bee35c38dbe59b0a788b5ce8"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#a64f51be4bee35c38dbe59b0a788b5ce8">ao2_unlink</a></div><div class="ttdeci">#define ao2_unlink(container, obj)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l01598">astobj2.h:1598</a></div></div>
<div class="ttc" id="structast__threadpool_html_a9a66e112220169c037a83525533ec817"><div class="ttname"><a href="../../d5/d10/structast__threadpool.html#a9a66e112220169c037a83525533ec817">ast_threadpool::zombie_threads</a></div><div class="ttdeci">struct ao2_container * zombie_threads</div><div class="ttdoc">The container of zombie threads. Zombie threads may be running tasks, but they are scheduled to die s...</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/dc7/threadpool_8c_source.html#l00053">threadpool.c:53</a></div></div>
<div class="ttc" id="structpair_html"><div class="ttname"><a href="../../df/de8/structpair.html">pair</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d4f/test__config_8c_source.html#l00084">test_config.c:84</a></div></div>
<div class="ttc" id="threadpool_8c_html_a0041e0562576aadeec0ce50221ba2396"><div class="ttname"><a href="../../d1/dc7/threadpool_8c.html#a0041e0562576aadeec0ce50221ba2396">thread_worker_pair_free</a></div><div class="ttdeci">static void thread_worker_pair_free(struct thread_worker_pair *pair)</div><div class="ttdoc">Destructor for thread_worker_pair. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/dc7/threadpool_8c_source.html#l00203">threadpool.c:203</a></div></div>
<div class="ttc" id="structthread__worker__pair_html_ac8c18315f6d4a45480dea634294e683f"><div class="ttname"><a href="../../d1/d34/structthread__worker__pair.html#ac8c18315f6d4a45480dea634294e683f">thread_worker_pair::pool</a></div><div class="ttdeci">struct ast_threadpool * pool</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/dc7/threadpool_8c_source.html#l00195">threadpool.c:195</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a82e66b52e831016bdfc643992d2d25f4"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a82e66b52e831016bdfc643992d2d25f4">&#9670;&nbsp;</a></span>serializer_create()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static struct <a class="el" href="../../d9/d47/structserializer.html">serializer</a>* serializer_create </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="../../d5/d10/structast__threadpool.html">ast_threadpool</a> *&#160;</td>
          <td class="paramname"><em>pool</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="../../dc/d82/structast__serializer__shutdown__group.html">ast_serializer_shutdown_group</a> *&#160;</td>
          <td class="paramname"><em>shutdown_group</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="../../d1/dc7/threadpool_8c_source.html#l01332">1332</a> of file <a class="el" href="../../d1/dc7/threadpool_8c_source.html">threadpool.c</a>.</p>

<p class="reference">References <a class="el" href="../../d5/da5/astobj2_8h_source.html#l00369">AO2_ALLOC_OPT_LOCK_NOLOCK</a>, <a class="el" href="../../d5/da5/astobj2_8h_source.html#l00406">ao2_alloc_options</a>, <a class="el" href="../../d5/da5/astobj2_8h_source.html#l00491">ao2_bump</a>, <a class="el" href="../../d5/da5/astobj2_8h_source.html#l00464">ao2_ref</a>, <a class="el" href="../../d1/dc7/threadpool_8c.html#a790f3603be48a5ee567924e6f06d6c88">AST_THREADSTORAGE_RAW()</a>, <a class="el" href="../../dc/d7f/resample_8c_source.html#l00096">NULL</a>, <a class="el" href="../../d9/d21/res__rtp__asterisk_8c_source.html#l00236">pool</a>, <a class="el" href="../../d1/dc7/threadpool_8c_source.html#l01317">serializer::pool</a>, <a class="el" href="../../d1/dc7/threadpool_8c_source.html#l01322">serializer_dtor()</a>, and <a class="el" href="../../d1/dc7/threadpool_8c_source.html#l01319">serializer::shutdown_group</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../d1/dc7/threadpool_8c_source.html#l01402">ast_threadpool_serializer_group()</a>.</p>
<div class="fragment"><div class="line"><a name="l01334"></a><span class="lineno"> 1334</span>&#160;{</div><div class="line"><a name="l01335"></a><span class="lineno"> 1335</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d9/d47/structserializer.html">serializer</a> *ser;</div><div class="line"><a name="l01336"></a><span class="lineno"> 1336</span>&#160;</div><div class="line"><a name="l01337"></a><span class="lineno"> 1337</span>&#160;   ser = <a class="code" href="../../d5/da5/astobj2_8h.html#ab3c44e28d661616129b7819069effe61">ao2_alloc_options</a>(<span class="keyword">sizeof</span>(*ser), <a class="code" href="../../d1/dc7/threadpool_8c.html#a4026d93f6429cb37a172dae32e774ec3">serializer_dtor</a>, <a class="code" href="../../d5/da5/astobj2_8h.html#a2cf7e3433f08351aafe3b0cd31edf7f8a23b60f2636bcfbc4dfeea6cc21bf847b">AO2_ALLOC_OPT_LOCK_NOLOCK</a>);</div><div class="line"><a name="l01338"></a><span class="lineno"> 1338</span>&#160;   <span class="keywordflow">if</span> (!ser) {</div><div class="line"><a name="l01339"></a><span class="lineno"> 1339</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l01340"></a><span class="lineno"> 1340</span>&#160;   }</div><div class="line"><a name="l01341"></a><span class="lineno"> 1341</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(pool, +1);</div><div class="line"><a name="l01342"></a><span class="lineno"> 1342</span>&#160;   ser-&gt;<a class="code" href="../../d9/d47/structserializer.html#ac8c18315f6d4a45480dea634294e683f">pool</a> = <a class="code" href="../../d9/d21/res__rtp__asterisk_8c.html#a2e57658a5d3ef6c4ef2774c9d5868e7c">pool</a>;</div><div class="line"><a name="l01343"></a><span class="lineno"> 1343</span>&#160;   ser-&gt;<a class="code" href="../../d9/d47/structserializer.html#a2c3d0057b62bfa5b08fe977478749c24">shutdown_group</a> = <a class="code" href="../../d5/da5/astobj2_8h.html#ac438c3fcd3150481fad38689fd813a15">ao2_bump</a>(shutdown_group);</div><div class="line"><a name="l01344"></a><span class="lineno"> 1344</span>&#160;   <span class="keywordflow">return</span> ser;</div><div class="line"><a name="l01345"></a><span class="lineno"> 1345</span>&#160;}</div><div class="ttc" id="structserializer_html_a2c3d0057b62bfa5b08fe977478749c24"><div class="ttname"><a href="../../d9/d47/structserializer.html#a2c3d0057b62bfa5b08fe977478749c24">serializer::shutdown_group</a></div><div class="ttdeci">struct ast_serializer_shutdown_group * shutdown_group</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/dc7/threadpool_8c_source.html#l01319">threadpool.c:1319</a></div></div>
<div class="ttc" id="astobj2_8h_html_a2cf7e3433f08351aafe3b0cd31edf7f8a23b60f2636bcfbc4dfeea6cc21bf847b"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#a2cf7e3433f08351aafe3b0cd31edf7f8a23b60f2636bcfbc4dfeea6cc21bf847b">AO2_ALLOC_OPT_LOCK_NOLOCK</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l00369">astobj2.h:369</a></div></div>
<div class="ttc" id="res__rtp__asterisk_8c_html_a2e57658a5d3ef6c4ef2774c9d5868e7c"><div class="ttname"><a href="../../d9/d21/res__rtp__asterisk_8c.html#a2e57658a5d3ef6c4ef2774c9d5868e7c">pool</a></div><div class="ttdeci">static pj_pool_t * pool</div><div class="ttdoc">Global memory pool for configuration and timers. </div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d21/res__rtp__asterisk_8c_source.html#l00236">res_rtp_asterisk.c:236</a></div></div>
<div class="ttc" id="astobj2_8h_html_ab3c44e28d661616129b7819069effe61"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#ab3c44e28d661616129b7819069effe61">ao2_alloc_options</a></div><div class="ttdeci">#define ao2_alloc_options(data_size, destructor_fn, options)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l00406">astobj2.h:406</a></div></div>
<div class="ttc" id="resample_8c_html_a070d2ce7b6bb7e5c05602aa8c308d0c4"><div class="ttname"><a href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a></div><div class="ttdeci">#define NULL</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d7f/resample_8c_source.html#l00096">resample.c:96</a></div></div>
<div class="ttc" id="astobj2_8h_html_ac438c3fcd3150481fad38689fd813a15"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#ac438c3fcd3150481fad38689fd813a15">ao2_bump</a></div><div class="ttdeci">#define ao2_bump(obj)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l00491">astobj2.h:491</a></div></div>
<div class="ttc" id="threadpool_8c_html_a4026d93f6429cb37a172dae32e774ec3"><div class="ttname"><a href="../../d1/dc7/threadpool_8c.html#a4026d93f6429cb37a172dae32e774ec3">serializer_dtor</a></div><div class="ttdeci">static void serializer_dtor(void *obj)</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/dc7/threadpool_8c_source.html#l01322">threadpool.c:1322</a></div></div>
<div class="ttc" id="astobj2_8h_html_aaca5e8eac39a22f9da1c36fc6c922270"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a></div><div class="ttdeci">#define ao2_ref(o, delta)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l00464">astobj2.h:464</a></div></div>
<div class="ttc" id="structserializer_html_ac8c18315f6d4a45480dea634294e683f"><div class="ttname"><a href="../../d9/d47/structserializer.html#ac8c18315f6d4a45480dea634294e683f">serializer::pool</a></div><div class="ttdeci">struct ast_threadpool * pool</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/dc7/threadpool_8c_source.html#l01317">threadpool.c:1317</a></div></div>
<div class="ttc" id="structserializer_html"><div class="ttname"><a href="../../d9/d47/structserializer.html">serializer</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d1/dc7/threadpool_8c_source.html#l01315">threadpool.c:1315</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a4026d93f6429cb37a172dae32e774ec3"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4026d93f6429cb37a172dae32e774ec3">&#9670;&nbsp;</a></span>serializer_dtor()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void serializer_dtor </td>
          <td>(</td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>obj</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="../../d1/dc7/threadpool_8c_source.html#l01322">1322</a> of file <a class="el" href="../../d1/dc7/threadpool_8c_source.html">threadpool.c</a>.</p>

<p class="reference">References <a class="el" href="../../d5/da5/astobj2_8h_source.html#l01958">ao2_cleanup</a>, <a class="el" href="../../dc/d7f/resample_8c_source.html#l00096">NULL</a>, <a class="el" href="../../d1/dc7/threadpool_8c_source.html#l01317">serializer::pool</a>, and <a class="el" href="../../d1/dc7/threadpool_8c_source.html#l01319">serializer::shutdown_group</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../d1/dc7/threadpool_8c_source.html#l01332">serializer_create()</a>.</p>
<div class="fragment"><div class="line"><a name="l01323"></a><span class="lineno"> 1323</span>&#160;{</div><div class="line"><a name="l01324"></a><span class="lineno"> 1324</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d9/d47/structserializer.html">serializer</a> *ser = obj;</div><div class="line"><a name="l01325"></a><span class="lineno"> 1325</span>&#160;</div><div class="line"><a name="l01326"></a><span class="lineno"> 1326</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#a6321ee982370c55ab3c24c72c562cbdd">ao2_cleanup</a>(ser-&gt;<a class="code" href="../../d9/d47/structserializer.html#ac8c18315f6d4a45480dea634294e683f">pool</a>);</div><div class="line"><a name="l01327"></a><span class="lineno"> 1327</span>&#160;   ser-&gt;<a class="code" href="../../d9/d47/structserializer.html#ac8c18315f6d4a45480dea634294e683f">pool</a> = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l01328"></a><span class="lineno"> 1328</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#a6321ee982370c55ab3c24c72c562cbdd">ao2_cleanup</a>(ser-&gt;<a class="code" href="../../d9/d47/structserializer.html#a2c3d0057b62bfa5b08fe977478749c24">shutdown_group</a>);</div><div class="line"><a name="l01329"></a><span class="lineno"> 1329</span>&#160;   ser-&gt;<a class="code" href="../../d9/d47/structserializer.html#a2c3d0057b62bfa5b08fe977478749c24">shutdown_group</a> = <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l01330"></a><span class="lineno"> 1330</span>&#160;}</div><div class="ttc" id="structserializer_html_a2c3d0057b62bfa5b08fe977478749c24"><div class="ttname"><a href="../../d9/d47/structserializer.html#a2c3d0057b62bfa5b08fe977478749c24">serializer::shutdown_group</a></div><div class="ttdeci">struct ast_serializer_shutdown_group * shutdown_group</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/dc7/threadpool_8c_source.html#l01319">threadpool.c:1319</a></div></div>
<div class="ttc" id="resample_8c_html_a070d2ce7b6bb7e5c05602aa8c308d0c4"><div class="ttname"><a href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a></div><div class="ttdeci">#define NULL</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d7f/resample_8c_source.html#l00096">resample.c:96</a></div></div>
<div class="ttc" id="structserializer_html_ac8c18315f6d4a45480dea634294e683f"><div class="ttname"><a href="../../d9/d47/structserializer.html#ac8c18315f6d4a45480dea634294e683f">serializer::pool</a></div><div class="ttdeci">struct ast_threadpool * pool</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/dc7/threadpool_8c_source.html#l01317">threadpool.c:1317</a></div></div>
<div class="ttc" id="structserializer_html"><div class="ttname"><a href="../../d9/d47/structserializer.html">serializer</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d1/dc7/threadpool_8c_source.html#l01315">threadpool.c:1315</a></div></div>
<div class="ttc" id="astobj2_8h_html_a6321ee982370c55ab3c24c72c562cbdd"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#a6321ee982370c55ab3c24c72c562cbdd">ao2_cleanup</a></div><div class="ttdeci">#define ao2_cleanup(obj)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l01958">astobj2.h:1958</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="aa577e16b6d03e11f0f7b9c5fea0af059"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa577e16b6d03e11f0f7b9c5fea0af059">&#9670;&nbsp;</a></span>serializer_shutdown()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void serializer_shutdown </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="../../d7/d52/structast__taskprocessor__listener.html">ast_taskprocessor_listener</a> *&#160;</td>
          <td class="paramname"><em>listener</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="../../d1/dc7/threadpool_8c_source.html#l01381">1381</a> of file <a class="el" href="../../d1/dc7/threadpool_8c_source.html">threadpool.c</a>.</p>

<p class="reference">References <a class="el" href="../../d5/da5/astobj2_8h_source.html#l01958">ao2_cleanup</a>, <a class="el" href="../../d4/deb/taskprocessor_8c_source.html#l00950">ast_taskprocessor_listener_get_user_data()</a>, <a class="el" href="../../d1/dc7/threadpool_8c_source.html#l01305">serializer_shutdown_group_dec()</a>, and <a class="el" href="../../d1/dc7/threadpool_8c_source.html#l01319">serializer::shutdown_group</a>.</p>
<div class="fragment"><div class="line"><a name="l01382"></a><span class="lineno"> 1382</span>&#160;{</div><div class="line"><a name="l01383"></a><span class="lineno"> 1383</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d9/d47/structserializer.html">serializer</a> *ser = <a class="code" href="../../d0/d1e/taskprocessor_8h.html#a6906b13a7a37512e36dd1f5148589481">ast_taskprocessor_listener_get_user_data</a>(listener);</div><div class="line"><a name="l01384"></a><span class="lineno"> 1384</span>&#160;</div><div class="line"><a name="l01385"></a><span class="lineno"> 1385</span>&#160;   <span class="keywordflow">if</span> (ser-&gt;<a class="code" href="../../d9/d47/structserializer.html#a2c3d0057b62bfa5b08fe977478749c24">shutdown_group</a>) {</div><div class="line"><a name="l01386"></a><span class="lineno"> 1386</span>&#160;      <a class="code" href="../../d1/dc7/threadpool_8c.html#a140bca9937359fcff891bb8c7d5271a5">serializer_shutdown_group_dec</a>(ser-&gt;<a class="code" href="../../d9/d47/structserializer.html#a2c3d0057b62bfa5b08fe977478749c24">shutdown_group</a>);</div><div class="line"><a name="l01387"></a><span class="lineno"> 1387</span>&#160;   }</div><div class="line"><a name="l01388"></a><span class="lineno"> 1388</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#a6321ee982370c55ab3c24c72c562cbdd">ao2_cleanup</a>(ser);</div><div class="line"><a name="l01389"></a><span class="lineno"> 1389</span>&#160;}</div><div class="ttc" id="structserializer_html_a2c3d0057b62bfa5b08fe977478749c24"><div class="ttname"><a href="../../d9/d47/structserializer.html#a2c3d0057b62bfa5b08fe977478749c24">serializer::shutdown_group</a></div><div class="ttdeci">struct ast_serializer_shutdown_group * shutdown_group</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/dc7/threadpool_8c_source.html#l01319">threadpool.c:1319</a></div></div>
<div class="ttc" id="structserializer_html"><div class="ttname"><a href="../../d9/d47/structserializer.html">serializer</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d1/dc7/threadpool_8c_source.html#l01315">threadpool.c:1315</a></div></div>
<div class="ttc" id="taskprocessor_8h_html_a6906b13a7a37512e36dd1f5148589481"><div class="ttname"><a href="../../d0/d1e/taskprocessor_8h.html#a6906b13a7a37512e36dd1f5148589481">ast_taskprocessor_listener_get_user_data</a></div><div class="ttdeci">void * ast_taskprocessor_listener_get_user_data(const struct ast_taskprocessor_listener *listener)</div><div class="ttdoc">Get the user data from the listener. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/deb/taskprocessor_8c_source.html#l00950">taskprocessor.c:950</a></div></div>
<div class="ttc" id="astobj2_8h_html_a6321ee982370c55ab3c24c72c562cbdd"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#a6321ee982370c55ab3c24c72c562cbdd">ao2_cleanup</a></div><div class="ttdeci">#define ao2_cleanup(obj)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l01958">astobj2.h:1958</a></div></div>
<div class="ttc" id="threadpool_8c_html_a140bca9937359fcff891bb8c7d5271a5"><div class="ttname"><a href="../../d1/dc7/threadpool_8c.html#a140bca9937359fcff891bb8c7d5271a5">serializer_shutdown_group_dec</a></div><div class="ttdeci">static void serializer_shutdown_group_dec(struct ast_serializer_shutdown_group *shutdown_group)</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/dc7/threadpool_8c_source.html#l01305">threadpool.c:1305</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a140bca9937359fcff891bb8c7d5271a5"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a140bca9937359fcff891bb8c7d5271a5">&#9670;&nbsp;</a></span>serializer_shutdown_group_dec()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void serializer_shutdown_group_dec </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="../../dc/d82/structast__serializer__shutdown__group.html">ast_serializer_shutdown_group</a> *&#160;</td>
          <td class="paramname"><em>shutdown_group</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="../../d1/dc7/threadpool_8c_source.html#l01305">1305</a> of file <a class="el" href="../../d1/dc7/threadpool_8c_source.html">threadpool.c</a>.</p>

<p class="reference">References <a class="el" href="../../d5/da5/astobj2_8h_source.html#l00718">ao2_lock</a>, <a class="el" href="../../d5/da5/astobj2_8h_source.html#l00730">ao2_unlock</a>, <a class="el" href="../../dd/d42/lock_8h_source.html#l00201">ast_cond_signal</a>, <a class="el" href="../../d1/dc7/threadpool_8c_source.html#l01217">ast_serializer_shutdown_group::cond</a>, and <a class="el" href="../../d1/dc7/threadpool_8c_source.html#l01219">ast_serializer_shutdown_group::count</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../d1/dc7/threadpool_8c_source.html#l01381">serializer_shutdown()</a>.</p>
<div class="fragment"><div class="line"><a name="l01306"></a><span class="lineno"> 1306</span>&#160;{</div><div class="line"><a name="l01307"></a><span class="lineno"> 1307</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#aa9fdb5d0a6157a56060d9f7279fe6c49">ao2_lock</a>(shutdown_group);</div><div class="line"><a name="l01308"></a><span class="lineno"> 1308</span>&#160;   --shutdown_group-&gt;<a class="code" href="../../dc/d82/structast__serializer__shutdown__group.html#ad43c3812e6d13e0518d9f8b8f463ffcf">count</a>;</div><div class="line"><a name="l01309"></a><span class="lineno"> 1309</span>&#160;   <span class="keywordflow">if</span> (!shutdown_group-&gt;<a class="code" href="../../dc/d82/structast__serializer__shutdown__group.html#ad43c3812e6d13e0518d9f8b8f463ffcf">count</a>) {</div><div class="line"><a name="l01310"></a><span class="lineno"> 1310</span>&#160;      <a class="code" href="../../dd/d42/lock_8h.html#ae2cdf274a5da241c3ad7324d82bf6af0">ast_cond_signal</a>(&amp;shutdown_group-&gt;<a class="code" href="../../dc/d82/structast__serializer__shutdown__group.html#a1c7181c39f99ee801943a0d0aa9872b9">cond</a>);</div><div class="line"><a name="l01311"></a><span class="lineno"> 1311</span>&#160;   }</div><div class="line"><a name="l01312"></a><span class="lineno"> 1312</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#a9998bd156b936636a8780385e9a910b2">ao2_unlock</a>(shutdown_group);</div><div class="line"><a name="l01313"></a><span class="lineno"> 1313</span>&#160;}</div><div class="ttc" id="structast__serializer__shutdown__group_html_ad43c3812e6d13e0518d9f8b8f463ffcf"><div class="ttname"><a href="../../dc/d82/structast__serializer__shutdown__group.html#ad43c3812e6d13e0518d9f8b8f463ffcf">ast_serializer_shutdown_group::count</a></div><div class="ttdeci">int count</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/dc7/threadpool_8c_source.html#l01219">threadpool.c:1219</a></div></div>
<div class="ttc" id="structast__serializer__shutdown__group_html_a1c7181c39f99ee801943a0d0aa9872b9"><div class="ttname"><a href="../../dc/d82/structast__serializer__shutdown__group.html#a1c7181c39f99ee801943a0d0aa9872b9">ast_serializer_shutdown_group::cond</a></div><div class="ttdeci">ast_cond_t cond</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/dc7/threadpool_8c_source.html#l01217">threadpool.c:1217</a></div></div>
<div class="ttc" id="astobj2_8h_html_a9998bd156b936636a8780385e9a910b2"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#a9998bd156b936636a8780385e9a910b2">ao2_unlock</a></div><div class="ttdeci">#define ao2_unlock(a)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l00730">astobj2.h:730</a></div></div>
<div class="ttc" id="lock_8h_html_ae2cdf274a5da241c3ad7324d82bf6af0"><div class="ttname"><a href="../../dd/d42/lock_8h.html#ae2cdf274a5da241c3ad7324d82bf6af0">ast_cond_signal</a></div><div class="ttdeci">#define ast_cond_signal(cond)</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d42/lock_8h_source.html#l00201">lock.h:201</a></div></div>
<div class="ttc" id="astobj2_8h_html_aa9fdb5d0a6157a56060d9f7279fe6c49"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#aa9fdb5d0a6157a56060d9f7279fe6c49">ao2_lock</a></div><div class="ttdeci">#define ao2_lock(a)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l00718">astobj2.h:718</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a32f9d04cf2e48a22a1bf4c0c035ed8c1"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a32f9d04cf2e48a22a1bf4c0c035ed8c1">&#9670;&nbsp;</a></span>serializer_shutdown_group_dtor()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void serializer_shutdown_group_dtor </td>
          <td>(</td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>vdoomed</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="../../d1/dc7/threadpool_8c_source.html#l01222">1222</a> of file <a class="el" href="../../d1/dc7/threadpool_8c_source.html">threadpool.c</a>.</p>

<p class="reference">References <a class="el" href="../../dd/d42/lock_8h_source.html#l00200">ast_cond_destroy</a>, and <a class="el" href="../../d1/dc7/threadpool_8c_source.html#l01217">ast_serializer_shutdown_group::cond</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../d1/dc7/threadpool_8c_source.html#l01229">ast_serializer_shutdown_group_alloc()</a>.</p>
<div class="fragment"><div class="line"><a name="l01223"></a><span class="lineno"> 1223</span>&#160;{</div><div class="line"><a name="l01224"></a><span class="lineno"> 1224</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../dc/d82/structast__serializer__shutdown__group.html">ast_serializer_shutdown_group</a> *doomed = vdoomed;</div><div class="line"><a name="l01225"></a><span class="lineno"> 1225</span>&#160;</div><div class="line"><a name="l01226"></a><span class="lineno"> 1226</span>&#160;   <a class="code" href="../../dd/d42/lock_8h.html#a1ea2f4040a736cddbecea48b30ffedfd">ast_cond_destroy</a>(&amp;doomed-&gt;<a class="code" href="../../dc/d82/structast__serializer__shutdown__group.html#a1c7181c39f99ee801943a0d0aa9872b9">cond</a>);</div><div class="line"><a name="l01227"></a><span class="lineno"> 1227</span>&#160;}</div><div class="ttc" id="structast__serializer__shutdown__group_html_a1c7181c39f99ee801943a0d0aa9872b9"><div class="ttname"><a href="../../dc/d82/structast__serializer__shutdown__group.html#a1c7181c39f99ee801943a0d0aa9872b9">ast_serializer_shutdown_group::cond</a></div><div class="ttdeci">ast_cond_t cond</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/dc7/threadpool_8c_source.html#l01217">threadpool.c:1217</a></div></div>
<div class="ttc" id="lock_8h_html_a1ea2f4040a736cddbecea48b30ffedfd"><div class="ttname"><a href="../../dd/d42/lock_8h.html#a1ea2f4040a736cddbecea48b30ffedfd">ast_cond_destroy</a></div><div class="ttdeci">#define ast_cond_destroy(cond)</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d42/lock_8h_source.html#l00200">lock.h:200</a></div></div>
<div class="ttc" id="structast__serializer__shutdown__group_html"><div class="ttname"><a href="../../dc/d82/structast__serializer__shutdown__group.html">ast_serializer_shutdown_group</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d1/dc7/threadpool_8c_source.html#l01215">threadpool.c:1215</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a94999064773c19db7466b855530eb1b4"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a94999064773c19db7466b855530eb1b4">&#9670;&nbsp;</a></span>serializer_shutdown_group_inc()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void serializer_shutdown_group_inc </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="../../dc/d82/structast__serializer__shutdown__group.html">ast_serializer_shutdown_group</a> *&#160;</td>
          <td class="paramname"><em>shutdown_group</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="../../d1/dc7/threadpool_8c_source.html#l01289">1289</a> of file <a class="el" href="../../d1/dc7/threadpool_8c_source.html">threadpool.c</a>.</p>

<p class="reference">References <a class="el" href="../../d5/da5/astobj2_8h_source.html#l00718">ao2_lock</a>, <a class="el" href="../../d5/da5/astobj2_8h_source.html#l00730">ao2_unlock</a>, and <a class="el" href="../../d1/dc7/threadpool_8c_source.html#l01219">ast_serializer_shutdown_group::count</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../d1/dc7/threadpool_8c_source.html#l01402">ast_threadpool_serializer_group()</a>.</p>
<div class="fragment"><div class="line"><a name="l01290"></a><span class="lineno"> 1290</span>&#160;{</div><div class="line"><a name="l01291"></a><span class="lineno"> 1291</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#aa9fdb5d0a6157a56060d9f7279fe6c49">ao2_lock</a>(shutdown_group);</div><div class="line"><a name="l01292"></a><span class="lineno"> 1292</span>&#160;   ++shutdown_group-&gt;<a class="code" href="../../dc/d82/structast__serializer__shutdown__group.html#ad43c3812e6d13e0518d9f8b8f463ffcf">count</a>;</div><div class="line"><a name="l01293"></a><span class="lineno"> 1293</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#a9998bd156b936636a8780385e9a910b2">ao2_unlock</a>(shutdown_group);</div><div class="line"><a name="l01294"></a><span class="lineno"> 1294</span>&#160;}</div><div class="ttc" id="structast__serializer__shutdown__group_html_ad43c3812e6d13e0518d9f8b8f463ffcf"><div class="ttname"><a href="../../dc/d82/structast__serializer__shutdown__group.html#ad43c3812e6d13e0518d9f8b8f463ffcf">ast_serializer_shutdown_group::count</a></div><div class="ttdeci">int count</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/dc7/threadpool_8c_source.html#l01219">threadpool.c:1219</a></div></div>
<div class="ttc" id="astobj2_8h_html_a9998bd156b936636a8780385e9a910b2"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#a9998bd156b936636a8780385e9a910b2">ao2_unlock</a></div><div class="ttdeci">#define ao2_unlock(a)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l00730">astobj2.h:730</a></div></div>
<div class="ttc" id="astobj2_8h_html_aa9fdb5d0a6157a56060d9f7279fe6c49"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#aa9fdb5d0a6157a56060d9f7279fe6c49">ao2_lock</a></div><div class="ttdeci">#define ao2_lock(a)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l00718">astobj2.h:718</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="adbed1c57bcac947d16e5248c1004e51e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#adbed1c57bcac947d16e5248c1004e51e">&#9670;&nbsp;</a></span>serializer_start()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int serializer_start </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="../../d7/d52/structast__taskprocessor__listener.html">ast_taskprocessor_listener</a> *&#160;</td>
          <td class="paramname"><em>listener</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="../../d1/dc7/threadpool_8c_source.html#l01375">1375</a> of file <a class="el" href="../../d1/dc7/threadpool_8c_source.html">threadpool.c</a>.</p>
<div class="fragment"><div class="line"><a name="l01376"></a><span class="lineno"> 1376</span>&#160;{</div><div class="line"><a name="l01377"></a><span class="lineno"> 1377</span>&#160;   <span class="comment">/* No-op */</span></div><div class="line"><a name="l01378"></a><span class="lineno"> 1378</span>&#160;   <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l01379"></a><span class="lineno"> 1379</span>&#160;}</div></div><!-- fragment -->
</div>
</div>
<a id="a645501c6996b276d116fa71ad474e00c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a645501c6996b276d116fa71ad474e00c">&#9670;&nbsp;</a></span>serializer_task_pushed()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void serializer_task_pushed </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="../../d7/d52/structast__taskprocessor__listener.html">ast_taskprocessor_listener</a> *&#160;</td>
          <td class="paramname"><em>listener</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>was_empty</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="../../d1/dc7/threadpool_8c_source.html#l01363">1363</a> of file <a class="el" href="../../d1/dc7/threadpool_8c_source.html">threadpool.c</a>.</p>

<p class="reference">References <a class="el" href="../../d4/deb/taskprocessor_8c_source.html#l00944">ast_taskprocessor_listener_get_tps()</a>, <a class="el" href="../../d4/deb/taskprocessor_8c_source.html#l00950">ast_taskprocessor_listener_get_user_data()</a>, <a class="el" href="../../d4/deb/taskprocessor_8c_source.html#l01109">ast_taskprocessor_unreference()</a>, <a class="el" href="../../d1/dc7/threadpool_8c_source.html#l00956">ast_threadpool_push()</a>, <a class="el" href="../../d1/dc7/threadpool_8c_source.html#l01349">execute_tasks()</a>, <a class="el" href="../../d1/dc7/threadpool_8c_source.html#l01317">serializer::pool</a>, and <a class="el" href="../../d1/dc7/threadpool_8c_source.html#l00067">ast_threadpool::tps</a>.</p>
<div class="fragment"><div class="line"><a name="l01364"></a><span class="lineno"> 1364</span>&#160;{</div><div class="line"><a name="l01365"></a><span class="lineno"> 1365</span>&#160;   <span class="keywordflow">if</span> (was_empty) {</div><div class="line"><a name="l01366"></a><span class="lineno"> 1366</span>&#160;      <span class="keyword">struct </span><a class="code" href="../../d9/d47/structserializer.html">serializer</a> *ser = <a class="code" href="../../d0/d1e/taskprocessor_8h.html#a6906b13a7a37512e36dd1f5148589481">ast_taskprocessor_listener_get_user_data</a>(listener);</div><div class="line"><a name="l01367"></a><span class="lineno"> 1367</span>&#160;      <span class="keyword">struct </span><a class="code" href="../../db/d17/structast__taskprocessor.html">ast_taskprocessor</a> *tps = <a class="code" href="../../d0/d1e/taskprocessor_8h.html#a6b19a24ebd6df46be8ab735226c7d6a3">ast_taskprocessor_listener_get_tps</a>(listener);</div><div class="line"><a name="l01368"></a><span class="lineno"> 1368</span>&#160;</div><div class="line"><a name="l01369"></a><span class="lineno"> 1369</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="../../d1/dc7/threadpool_8c.html#aa3aac2ce5678c3c1f0750e7990ae68a9">ast_threadpool_push</a>(ser-&gt;<a class="code" href="../../d9/d47/structserializer.html#ac8c18315f6d4a45480dea634294e683f">pool</a>, <a class="code" href="../../d1/dc7/threadpool_8c.html#ad18a34a1aef573f84ff3f29004edefba">execute_tasks</a>, tps)) {</div><div class="line"><a name="l01370"></a><span class="lineno"> 1370</span>&#160;         <a class="code" href="../../d0/d1e/taskprocessor_8h.html#a32492eb2480cb8c46ad669622cff8556">ast_taskprocessor_unreference</a>(tps);</div><div class="line"><a name="l01371"></a><span class="lineno"> 1371</span>&#160;      }</div><div class="line"><a name="l01372"></a><span class="lineno"> 1372</span>&#160;   }</div><div class="line"><a name="l01373"></a><span class="lineno"> 1373</span>&#160;}</div><div class="ttc" id="taskprocessor_8h_html_a6b19a24ebd6df46be8ab735226c7d6a3"><div class="ttname"><a href="../../d0/d1e/taskprocessor_8h.html#a6b19a24ebd6df46be8ab735226c7d6a3">ast_taskprocessor_listener_get_tps</a></div><div class="ttdeci">struct ast_taskprocessor * ast_taskprocessor_listener_get_tps(const struct ast_taskprocessor_listener *listener)</div><div class="ttdoc">Get a reference to the listener&amp;#39;s taskprocessor. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/deb/taskprocessor_8c_source.html#l00944">taskprocessor.c:944</a></div></div>
<div class="ttc" id="structserializer_html_ac8c18315f6d4a45480dea634294e683f"><div class="ttname"><a href="../../d9/d47/structserializer.html#ac8c18315f6d4a45480dea634294e683f">serializer::pool</a></div><div class="ttdeci">struct ast_threadpool * pool</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/dc7/threadpool_8c_source.html#l01317">threadpool.c:1317</a></div></div>
<div class="ttc" id="threadpool_8c_html_aa3aac2ce5678c3c1f0750e7990ae68a9"><div class="ttname"><a href="../../d1/dc7/threadpool_8c.html#aa3aac2ce5678c3c1f0750e7990ae68a9">ast_threadpool_push</a></div><div class="ttdeci">int ast_threadpool_push(struct ast_threadpool *pool, int(*task)(void *data), void *data)</div><div class="ttdoc">Push a task to the threadpool. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/dc7/threadpool_8c_source.html#l00956">threadpool.c:956</a></div></div>
<div class="ttc" id="structserializer_html"><div class="ttname"><a href="../../d9/d47/structserializer.html">serializer</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d1/dc7/threadpool_8c_source.html#l01315">threadpool.c:1315</a></div></div>
<div class="ttc" id="taskprocessor_8h_html_a6906b13a7a37512e36dd1f5148589481"><div class="ttname"><a href="../../d0/d1e/taskprocessor_8h.html#a6906b13a7a37512e36dd1f5148589481">ast_taskprocessor_listener_get_user_data</a></div><div class="ttdeci">void * ast_taskprocessor_listener_get_user_data(const struct ast_taskprocessor_listener *listener)</div><div class="ttdoc">Get the user data from the listener. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/deb/taskprocessor_8c_source.html#l00950">taskprocessor.c:950</a></div></div>
<div class="ttc" id="structast__taskprocessor_html"><div class="ttname"><a href="../../db/d17/structast__taskprocessor.html">ast_taskprocessor</a></div><div class="ttdoc">A ast_taskprocessor structure is a singleton by name. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/deb/taskprocessor_8c_source.html#l00069">taskprocessor.c:69</a></div></div>
<div class="ttc" id="taskprocessor_8h_html_a32492eb2480cb8c46ad669622cff8556"><div class="ttname"><a href="../../d0/d1e/taskprocessor_8h.html#a32492eb2480cb8c46ad669622cff8556">ast_taskprocessor_unreference</a></div><div class="ttdeci">void * ast_taskprocessor_unreference(struct ast_taskprocessor *tps)</div><div class="ttdoc">Unreference the specified taskprocessor and its reference count will decrement. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/deb/taskprocessor_8c_source.html#l01109">taskprocessor.c:1109</a></div></div>
<div class="ttc" id="threadpool_8c_html_ad18a34a1aef573f84ff3f29004edefba"><div class="ttname"><a href="../../d1/dc7/threadpool_8c.html#ad18a34a1aef573f84ff3f29004edefba">execute_tasks</a></div><div class="ttdeci">static int execute_tasks(void *data)</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/dc7/threadpool_8c_source.html#l01349">threadpool.c:1349</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a3db89f7bce86946752e8247d4a0d3e55"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3db89f7bce86946752e8247d4a0d3e55">&#9670;&nbsp;</a></span>set_size_data_alloc()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static struct <a class="el" href="../../dc/d28/structset__size__data.html">set_size_data</a>* set_size_data_alloc </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="../../d5/d10/structast__threadpool.html">ast_threadpool</a> *&#160;</td>
          <td class="paramname"><em>pool</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned int&#160;</td>
          <td class="paramname"><em>size</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Allocate and initialize a <a class="el" href="../../dc/d28/structset__size__data.html" title="Helper struct used for queued operations that change the size of the threadpool. ">set_size_data</a>. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">pool</td><td>The pool for the <a class="el" href="../../dc/d28/structset__size__data.html" title="Helper struct used for queued operations that change the size of the threadpool. ">set_size_data</a> </td></tr>
    <tr><td class="paramname">size</td><td>The size to store in the <a class="el" href="../../dc/d28/structset__size__data.html" title="Helper struct used for queued operations that change the size of the threadpool. ">set_size_data</a> </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="../../d1/dc7/threadpool_8c_source.html#l00814">814</a> of file <a class="el" href="../../d1/dc7/threadpool_8c_source.html">threadpool.c</a>.</p>

<p class="reference">References <a class="el" href="../../d8/d8a/astmm_8h_source.html#l00193">ast_malloc</a>, <a class="el" href="../../dc/d7f/resample_8c_source.html#l00096">NULL</a>, <a class="el" href="../../d9/d21/res__rtp__asterisk_8c_source.html#l00236">pool</a>, <a class="el" href="../../d1/dc7/threadpool_8c_source.html#l00804">set_size_data::pool</a>, and <a class="el" href="../../d1/dc7/threadpool_8c_source.html#l00806">set_size_data::size</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../d1/dc7/threadpool_8c_source.html#l00874">ast_threadpool_set_size()</a>.</p>
<div class="fragment"><div class="line"><a name="l00816"></a><span class="lineno">  816</span>&#160;{</div><div class="line"><a name="l00817"></a><span class="lineno">  817</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../dc/d28/structset__size__data.html">set_size_data</a> *ssd = <a class="code" href="../../d8/d8a/astmm_8h.html#ae63d4f486bcf6eac7c1593f867717d91">ast_malloc</a>(<span class="keyword">sizeof</span>(*ssd));</div><div class="line"><a name="l00818"></a><span class="lineno">  818</span>&#160;   <span class="keywordflow">if</span> (!ssd) {</div><div class="line"><a name="l00819"></a><span class="lineno">  819</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l00820"></a><span class="lineno">  820</span>&#160;   }</div><div class="line"><a name="l00821"></a><span class="lineno">  821</span>&#160;</div><div class="line"><a name="l00822"></a><span class="lineno">  822</span>&#160;   ssd-&gt;<a class="code" href="../../dc/d28/structset__size__data.html#ac8c18315f6d4a45480dea634294e683f">pool</a> = <a class="code" href="../../d9/d21/res__rtp__asterisk_8c.html#a2e57658a5d3ef6c4ef2774c9d5868e7c">pool</a>;</div><div class="line"><a name="l00823"></a><span class="lineno">  823</span>&#160;   ssd-&gt;<a class="code" href="../../dc/d28/structset__size__data.html#aac913b3a1f6ef005d66bf7a84428773e">size</a> = <a class="code" href="../../dc/d28/structset__size__data.html#aac913b3a1f6ef005d66bf7a84428773e">size</a>;</div><div class="line"><a name="l00824"></a><span class="lineno">  824</span>&#160;   <span class="keywordflow">return</span> ssd;</div><div class="line"><a name="l00825"></a><span class="lineno">  825</span>&#160;}</div><div class="ttc" id="res__rtp__asterisk_8c_html_a2e57658a5d3ef6c4ef2774c9d5868e7c"><div class="ttname"><a href="../../d9/d21/res__rtp__asterisk_8c.html#a2e57658a5d3ef6c4ef2774c9d5868e7c">pool</a></div><div class="ttdeci">static pj_pool_t * pool</div><div class="ttdoc">Global memory pool for configuration and timers. </div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d21/res__rtp__asterisk_8c_source.html#l00236">res_rtp_asterisk.c:236</a></div></div>
<div class="ttc" id="resample_8c_html_a070d2ce7b6bb7e5c05602aa8c308d0c4"><div class="ttname"><a href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a></div><div class="ttdeci">#define NULL</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d7f/resample_8c_source.html#l00096">resample.c:96</a></div></div>
<div class="ttc" id="structset__size__data_html"><div class="ttname"><a href="../../dc/d28/structset__size__data.html">set_size_data</a></div><div class="ttdoc">Helper struct used for queued operations that change the size of the threadpool. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/dc7/threadpool_8c_source.html#l00802">threadpool.c:802</a></div></div>
<div class="ttc" id="structset__size__data_html_ac8c18315f6d4a45480dea634294e683f"><div class="ttname"><a href="../../dc/d28/structset__size__data.html#ac8c18315f6d4a45480dea634294e683f">set_size_data::pool</a></div><div class="ttdeci">struct ast_threadpool * pool</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/dc7/threadpool_8c_source.html#l00804">threadpool.c:804</a></div></div>
<div class="ttc" id="astmm_8h_html_ae63d4f486bcf6eac7c1593f867717d91"><div class="ttname"><a href="../../d8/d8a/astmm_8h.html#ae63d4f486bcf6eac7c1593f867717d91">ast_malloc</a></div><div class="ttdeci">#define ast_malloc(len)</div><div class="ttdoc">A wrapper for malloc() </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d8a/astmm_8h_source.html#l00193">astmm.h:193</a></div></div>
<div class="ttc" id="structset__size__data_html_aac913b3a1f6ef005d66bf7a84428773e"><div class="ttname"><a href="../../dc/d28/structset__size__data.html#aac913b3a1f6ef005d66bf7a84428773e">set_size_data::size</a></div><div class="ttdeci">unsigned int size</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/dc7/threadpool_8c_source.html#l00806">threadpool.c:806</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a7bbaf491f374ac79e84f3585989ae349"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a7bbaf491f374ac79e84f3585989ae349">&#9670;&nbsp;</a></span>shrink()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void shrink </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="../../d5/d10/structast__threadpool.html">ast_threadpool</a> *&#160;</td>
          <td class="paramname"><em>pool</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>delta</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Remove threads from the threadpool. </p>
<p>The preference is to kill idle threads. However, if there are more threads to remove than there are idle threads, then active threads will be zombified instead.</p>
<p>This function is called from the threadpool control taskprocessor thread.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">pool</td><td>The threadpool to remove threads from </td></tr>
    <tr><td class="paramname">delta</td><td>The number of threads to remove </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="../../d1/dc7/threadpool_8c_source.html#l00775">775</a> of file <a class="el" href="../../d1/dc7/threadpool_8c_source.html">threadpool.c</a>.</p>

<p class="reference">References <a class="el" href="../../d1/dc7/threadpool_8c_source.html#l00043">ast_threadpool::active_threads</a>, <a class="el" href="../../d5/da5/astobj2_8h_source.html#l01716">ao2_callback</a>, <a class="el" href="../../d5/da5/astobj2_8h_source.html#l01743">ao2_callback_data</a>, <a class="el" href="../../d7/d22/astobj2__container_8c_source.html#l00034">ao2_container_count()</a>, <a class="el" href="../../d1/d8c/logger_8h_source.html#l00452">ast_debug</a>, <a class="el" href="../../d4/deb/taskprocessor_8c_source.html#l00906">ast_taskprocessor_name()</a>, <a class="el" href="../../d1/dc7/threadpool_8c_source.html#l00048">ast_threadpool::idle_threads</a>, <a class="el" href="../../d1/dc7/threadpool_8c_source.html#l00714">kill_threads()</a>, <a class="el" href="../../d5/d60/utils_8h_source.html#l00226">MIN</a>, <a class="el" href="../../d5/da5/astobj2_8h_source.html#l01053">OBJ_MULTIPLE</a>, <a class="el" href="../../d5/da5/astobj2_8h_source.html#l01048">OBJ_NODATA</a>, <a class="el" href="../../d5/da5/astobj2_8h_source.html#l01067">OBJ_NOLOCK</a>, <a class="el" href="../../d5/da5/astobj2_8h_source.html#l01043">OBJ_UNLINK</a>, <a class="el" href="../../d1/dc7/threadpool_8c_source.html#l00067">ast_threadpool::tps</a>, and <a class="el" href="../../d1/dc7/threadpool_8c_source.html#l00745">zombify_threads()</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../d1/dc7/threadpool_8c_source.html#l00838">queued_set_size()</a>.</p>
<div class="fragment"><div class="line"><a name="l00776"></a><span class="lineno">  776</span>&#160;{</div><div class="line"><a name="l00777"></a><span class="lineno">  777</span>&#160;   <span class="comment">/*</span></div><div class="line"><a name="l00778"></a><span class="lineno">  778</span>&#160;<span class="comment">    * Preference is to kill idle threads, but</span></div><div class="line"><a name="l00779"></a><span class="lineno">  779</span>&#160;<span class="comment">    * we&#39;ll move on to deactivating active threads</span></div><div class="line"><a name="l00780"></a><span class="lineno">  780</span>&#160;<span class="comment">    * if we have to</span></div><div class="line"><a name="l00781"></a><span class="lineno">  781</span>&#160;<span class="comment">    */</span></div><div class="line"><a name="l00782"></a><span class="lineno">  782</span>&#160;   <span class="keywordtype">int</span> idle_threads = <a class="code" href="../../d5/da5/astobj2_8h.html#a512cc40ce96c63b3d5c78040baa4c9cd">ao2_container_count</a>(pool-&gt;<a class="code" href="../../d5/d10/structast__threadpool.html#a1bad8223d34f52e7e7e11c0c20b20623">idle_threads</a>);</div><div class="line"><a name="l00783"></a><span class="lineno">  783</span>&#160;   <span class="keywordtype">int</span> idle_threads_to_kill = <a class="code" href="../../d5/d60/utils_8h.html#a3acffbd305ee72dcd4593c0d8af64a4f">MIN</a>(delta, idle_threads);</div><div class="line"><a name="l00784"></a><span class="lineno">  784</span>&#160;   <span class="keywordtype">int</span> active_threads_to_zombify = delta - idle_threads_to_kill;</div><div class="line"><a name="l00785"></a><span class="lineno">  785</span>&#160;</div><div class="line"><a name="l00786"></a><span class="lineno">  786</span>&#160;   <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(3, <span class="stringliteral">&quot;Destroying %d idle threads in threadpool %s\n&quot;</span>, idle_threads_to_kill,</div><div class="line"><a name="l00787"></a><span class="lineno">  787</span>&#160;         <a class="code" href="../../d0/d1e/taskprocessor_8h.html#aaa6541086de52447afa994cbfcb792ec">ast_taskprocessor_name</a>(pool-&gt;<a class="code" href="../../d5/d10/structast__threadpool.html#a4c381cb1b5cf198fa3f260212e716c9a">tps</a>));</div><div class="line"><a name="l00788"></a><span class="lineno">  788</span>&#160;</div><div class="line"><a name="l00789"></a><span class="lineno">  789</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#a47857055118a703ae87ea5ebaf4842ed">ao2_callback</a>(pool-&gt;<a class="code" href="../../d5/d10/structast__threadpool.html#a1bad8223d34f52e7e7e11c0c20b20623">idle_threads</a>, <a class="code" href="../../d5/da5/astobj2_8h.html#ad9d009e87e737af900825b36db55a35ca71f42ec6460e60eb6e10956c53329e45">OBJ_UNLINK</a> | <a class="code" href="../../d5/da5/astobj2_8h.html#ad9d009e87e737af900825b36db55a35ca52efdf13b66ae502e2e20a5f49f068de">OBJ_NOLOCK</a> | <a class="code" href="../../d5/da5/astobj2_8h.html#ad9d009e87e737af900825b36db55a35ca5fc59b193d86a0a8ddfe866304be829d">OBJ_NODATA</a> | <a class="code" href="../../d5/da5/astobj2_8h.html#ad9d009e87e737af900825b36db55a35ca614744a4d36b3189d4ab5b02c8645d47">OBJ_MULTIPLE</a>,</div><div class="line"><a name="l00790"></a><span class="lineno">  790</span>&#160;         <a class="code" href="../../d1/dc7/threadpool_8c.html#aeb318ea12f5c123fac34bc885227d0f5">kill_threads</a>, &amp;idle_threads_to_kill);</div><div class="line"><a name="l00791"></a><span class="lineno">  791</span>&#160;</div><div class="line"><a name="l00792"></a><span class="lineno">  792</span>&#160;   <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(3, <span class="stringliteral">&quot;Destroying %d active threads in threadpool %s\n&quot;</span>, active_threads_to_zombify,</div><div class="line"><a name="l00793"></a><span class="lineno">  793</span>&#160;         <a class="code" href="../../d0/d1e/taskprocessor_8h.html#aaa6541086de52447afa994cbfcb792ec">ast_taskprocessor_name</a>(pool-&gt;<a class="code" href="../../d5/d10/structast__threadpool.html#a4c381cb1b5cf198fa3f260212e716c9a">tps</a>));</div><div class="line"><a name="l00794"></a><span class="lineno">  794</span>&#160;</div><div class="line"><a name="l00795"></a><span class="lineno">  795</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#a63fd831fe48aed32d3ef992ad8e45293">ao2_callback_data</a>(pool-&gt;<a class="code" href="../../d5/d10/structast__threadpool.html#af151fe496c19e89e750605192e7726c8">active_threads</a>, <a class="code" href="../../d5/da5/astobj2_8h.html#ad9d009e87e737af900825b36db55a35ca71f42ec6460e60eb6e10956c53329e45">OBJ_UNLINK</a> | <a class="code" href="../../d5/da5/astobj2_8h.html#ad9d009e87e737af900825b36db55a35ca52efdf13b66ae502e2e20a5f49f068de">OBJ_NOLOCK</a> | <a class="code" href="../../d5/da5/astobj2_8h.html#ad9d009e87e737af900825b36db55a35ca5fc59b193d86a0a8ddfe866304be829d">OBJ_NODATA</a> | <a class="code" href="../../d5/da5/astobj2_8h.html#ad9d009e87e737af900825b36db55a35ca614744a4d36b3189d4ab5b02c8645d47">OBJ_MULTIPLE</a>,</div><div class="line"><a name="l00796"></a><span class="lineno">  796</span>&#160;         <a class="code" href="../../d1/dc7/threadpool_8c.html#affb887ea65f72e5efedfa4f2a9918a5d">zombify_threads</a>, pool, &amp;active_threads_to_zombify);</div><div class="line"><a name="l00797"></a><span class="lineno">  797</span>&#160;}</div><div class="ttc" id="astobj2_8h_html_a512cc40ce96c63b3d5c78040baa4c9cd"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#a512cc40ce96c63b3d5c78040baa4c9cd">ao2_container_count</a></div><div class="ttdeci">int ao2_container_count(struct ao2_container *c)</div><div class="ttdoc">Returns the number of elements in a container. </div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d22/astobj2__container_8c_source.html#l00034">astobj2_container.c:34</a></div></div>
<div class="ttc" id="astobj2_8h_html_ad9d009e87e737af900825b36db55a35ca5fc59b193d86a0a8ddfe866304be829d"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#ad9d009e87e737af900825b36db55a35ca5fc59b193d86a0a8ddfe866304be829d">OBJ_NODATA</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l01048">astobj2.h:1048</a></div></div>
<div class="ttc" id="astobj2_8h_html_a47857055118a703ae87ea5ebaf4842ed"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#a47857055118a703ae87ea5ebaf4842ed">ao2_callback</a></div><div class="ttdeci">#define ao2_callback(c, flags, cb_fn, arg)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l01716">astobj2.h:1716</a></div></div>
<div class="ttc" id="structast__threadpool_html_a1bad8223d34f52e7e7e11c0c20b20623"><div class="ttname"><a href="../../d5/d10/structast__threadpool.html#a1bad8223d34f52e7e7e11c0c20b20623">ast_threadpool::idle_threads</a></div><div class="ttdeci">struct ao2_container * idle_threads</div><div class="ttdoc">The container of idle threads. Idle threads are those that are currenly waiting to run tasks...</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/dc7/threadpool_8c_source.html#l00048">threadpool.c:48</a></div></div>
<div class="ttc" id="astobj2_8h_html_ad9d009e87e737af900825b36db55a35ca52efdf13b66ae502e2e20a5f49f068de"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#ad9d009e87e737af900825b36db55a35ca52efdf13b66ae502e2e20a5f49f068de">OBJ_NOLOCK</a></div><div class="ttdoc">Assume that the ao2_container is already locked. </div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l01067">astobj2.h:1067</a></div></div>
<div class="ttc" id="threadpool_8c_html_affb887ea65f72e5efedfa4f2a9918a5d"><div class="ttname"><a href="../../d1/dc7/threadpool_8c.html#affb887ea65f72e5efedfa4f2a9918a5d">zombify_threads</a></div><div class="ttdeci">static int zombify_threads(void *obj, void *arg, void *data, int flags)</div><div class="ttdoc">ao2 callback to zombify a set number of threads. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/dc7/threadpool_8c_source.html#l00745">threadpool.c:745</a></div></div>
<div class="ttc" id="taskprocessor_8h_html_aaa6541086de52447afa994cbfcb792ec"><div class="ttname"><a href="../../d0/d1e/taskprocessor_8h.html#aaa6541086de52447afa994cbfcb792ec">ast_taskprocessor_name</a></div><div class="ttdeci">const char * ast_taskprocessor_name(struct ast_taskprocessor *tps)</div><div class="ttdoc">Return the name of the taskprocessor singleton. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/deb/taskprocessor_8c_source.html#l00906">taskprocessor.c:906</a></div></div>
<div class="ttc" id="astobj2_8h_html_ad9d009e87e737af900825b36db55a35ca71f42ec6460e60eb6e10956c53329e45"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#ad9d009e87e737af900825b36db55a35ca71f42ec6460e60eb6e10956c53329e45">OBJ_UNLINK</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l01043">astobj2.h:1043</a></div></div>
<div class="ttc" id="utils_8h_html_a3acffbd305ee72dcd4593c0d8af64a4f"><div class="ttname"><a href="../../d5/d60/utils_8h.html#a3acffbd305ee72dcd4593c0d8af64a4f">MIN</a></div><div class="ttdeci">#define MIN(a, b)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d60/utils_8h_source.html#l00226">utils.h:226</a></div></div>
<div class="ttc" id="logger_8h_html_a3f248112c8d6ce7e3959aa723dade648"><div class="ttname"><a href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a></div><div class="ttdeci">#define ast_debug(level,...)</div><div class="ttdoc">Log a DEBUG message. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d8c/logger_8h_source.html#l00452">logger.h:452</a></div></div>
<div class="ttc" id="threadpool_8c_html_aeb318ea12f5c123fac34bc885227d0f5"><div class="ttname"><a href="../../d1/dc7/threadpool_8c.html#aeb318ea12f5c123fac34bc885227d0f5">kill_threads</a></div><div class="ttdeci">static int kill_threads(void *obj, void *arg, int flags)</div><div class="ttdoc">ao2 callback to kill a set number of threads. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/dc7/threadpool_8c_source.html#l00714">threadpool.c:714</a></div></div>
<div class="ttc" id="astobj2_8h_html_a63fd831fe48aed32d3ef992ad8e45293"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#a63fd831fe48aed32d3ef992ad8e45293">ao2_callback_data</a></div><div class="ttdeci">#define ao2_callback_data(container, flags, cb_fn, arg, data)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l01743">astobj2.h:1743</a></div></div>
<div class="ttc" id="structast__threadpool_html_a4c381cb1b5cf198fa3f260212e716c9a"><div class="ttname"><a href="../../d5/d10/structast__threadpool.html#a4c381cb1b5cf198fa3f260212e716c9a">ast_threadpool::tps</a></div><div class="ttdeci">struct ast_taskprocessor * tps</div><div class="ttdoc">The main taskprocessor. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/dc7/threadpool_8c_source.html#l00067">threadpool.c:67</a></div></div>
<div class="ttc" id="structast__threadpool_html_af151fe496c19e89e750605192e7726c8"><div class="ttname"><a href="../../d5/d10/structast__threadpool.html#af151fe496c19e89e750605192e7726c8">ast_threadpool::active_threads</a></div><div class="ttdeci">struct ao2_container * active_threads</div><div class="ttdoc">The container of active threads. Active threads are those that are currently running tasks...</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/dc7/threadpool_8c_source.html#l00043">threadpool.c:43</a></div></div>
<div class="ttc" id="astobj2_8h_html_ad9d009e87e737af900825b36db55a35ca614744a4d36b3189d4ab5b02c8645d47"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#ad9d009e87e737af900825b36db55a35ca614744a4d36b3189d4ab5b02c8645d47">OBJ_MULTIPLE</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l01053">astobj2.h:1053</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="ae6195901c5f444f8ac661eced96e6168"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae6195901c5f444f8ac661eced96e6168">&#9670;&nbsp;</a></span>task_pushed_data_alloc()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static struct <a class="el" href="../../d8/d82/structtask__pushed__data.html">task_pushed_data</a>* task_pushed_data_alloc </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="../../d5/d10/structast__threadpool.html">ast_threadpool</a> *&#160;</td>
          <td class="paramname"><em>pool</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>was_empty</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Allocate and initialize a <a class="el" href="../../d8/d82/structtask__pushed__data.html" title="helper used for queued task when tasks are pushed ">task_pushed_data</a>. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">pool</td><td>The threadpool to set in the <a class="el" href="../../d8/d82/structtask__pushed__data.html" title="helper used for queued task when tasks are pushed ">task_pushed_data</a> </td></tr>
    <tr><td class="paramname">was_empty</td><td>The was_empty value to set in the <a class="el" href="../../d8/d82/structtask__pushed__data.html" title="helper used for queued task when tasks are pushed ">task_pushed_data</a> </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">NULL</td><td>Unable to allocate <a class="el" href="../../d8/d82/structtask__pushed__data.html" title="helper used for queued task when tasks are pushed ">task_pushed_data</a> </td></tr>
    <tr><td class="paramname">non-NULL</td><td>The newly-allocated <a class="el" href="../../d8/d82/structtask__pushed__data.html" title="helper used for queued task when tasks are pushed ">task_pushed_data</a> </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="../../d1/dc7/threadpool_8c_source.html#l00466">466</a> of file <a class="el" href="../../d1/dc7/threadpool_8c_source.html">threadpool.c</a>.</p>

<p class="reference">References <a class="el" href="../../d8/d8a/astmm_8h_source.html#l00193">ast_malloc</a>, <a class="el" href="../../dc/d7f/resample_8c_source.html#l00096">NULL</a>, <a class="el" href="../../d9/d21/res__rtp__asterisk_8c_source.html#l00236">pool</a>, <a class="el" href="../../d1/dc7/threadpool_8c_source.html#l00454">task_pushed_data::pool</a>, and <a class="el" href="../../d1/dc7/threadpool_8c_source.html#l00456">task_pushed_data::was_empty</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../d1/dc7/threadpool_8c_source.html#l00610">threadpool_tps_task_pushed()</a>.</p>
<div class="fragment"><div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;{</div><div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d8/d82/structtask__pushed__data.html">task_pushed_data</a> *tpd = <a class="code" href="../../d8/d8a/astmm_8h.html#ae63d4f486bcf6eac7c1593f867717d91">ast_malloc</a>(<span class="keyword">sizeof</span>(*tpd));</div><div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;</div><div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;   <span class="keywordflow">if</span> (!tpd) {</div><div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;   }</div><div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;   tpd-&gt;<a class="code" href="../../d8/d82/structtask__pushed__data.html#ac8c18315f6d4a45480dea634294e683f">pool</a> = <a class="code" href="../../d9/d21/res__rtp__asterisk_8c.html#a2e57658a5d3ef6c4ef2774c9d5868e7c">pool</a>;</div><div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;   tpd-&gt;<a class="code" href="../../d8/d82/structtask__pushed__data.html#a37cdff51e63f885b3a82f34a6673bfbb">was_empty</a> = <a class="code" href="../../d8/d82/structtask__pushed__data.html#a37cdff51e63f885b3a82f34a6673bfbb">was_empty</a>;</div><div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;   <span class="keywordflow">return</span> tpd;</div><div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;}</div><div class="ttc" id="res__rtp__asterisk_8c_html_a2e57658a5d3ef6c4ef2774c9d5868e7c"><div class="ttname"><a href="../../d9/d21/res__rtp__asterisk_8c.html#a2e57658a5d3ef6c4ef2774c9d5868e7c">pool</a></div><div class="ttdeci">static pj_pool_t * pool</div><div class="ttdoc">Global memory pool for configuration and timers. </div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d21/res__rtp__asterisk_8c_source.html#l00236">res_rtp_asterisk.c:236</a></div></div>
<div class="ttc" id="resample_8c_html_a070d2ce7b6bb7e5c05602aa8c308d0c4"><div class="ttname"><a href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a></div><div class="ttdeci">#define NULL</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d7f/resample_8c_source.html#l00096">resample.c:96</a></div></div>
<div class="ttc" id="astmm_8h_html_ae63d4f486bcf6eac7c1593f867717d91"><div class="ttname"><a href="../../d8/d8a/astmm_8h.html#ae63d4f486bcf6eac7c1593f867717d91">ast_malloc</a></div><div class="ttdeci">#define ast_malloc(len)</div><div class="ttdoc">A wrapper for malloc() </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d8a/astmm_8h_source.html#l00193">astmm.h:193</a></div></div>
<div class="ttc" id="structtask__pushed__data_html_ac8c18315f6d4a45480dea634294e683f"><div class="ttname"><a href="../../d8/d82/structtask__pushed__data.html#ac8c18315f6d4a45480dea634294e683f">task_pushed_data::pool</a></div><div class="ttdeci">struct ast_threadpool * pool</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/dc7/threadpool_8c_source.html#l00454">threadpool.c:454</a></div></div>
<div class="ttc" id="structtask__pushed__data_html"><div class="ttname"><a href="../../d8/d82/structtask__pushed__data.html">task_pushed_data</a></div><div class="ttdoc">helper used for queued task when tasks are pushed </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/dc7/threadpool_8c_source.html#l00452">threadpool.c:452</a></div></div>
<div class="ttc" id="structtask__pushed__data_html_a37cdff51e63f885b3a82f34a6673bfbb"><div class="ttname"><a href="../../d8/d82/structtask__pushed__data.html#a37cdff51e63f885b3a82f34a6673bfbb">task_pushed_data::was_empty</a></div><div class="ttdeci">int was_empty</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/dc7/threadpool_8c_source.html#l00456">threadpool.c:456</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a2d77e9ba6f3133c92f78b076d2561732"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2d77e9ba6f3133c92f78b076d2561732">&#9670;&nbsp;</a></span>thread_worker_pair_alloc()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static struct <a class="el" href="../../d1/d34/structthread__worker__pair.html">thread_worker_pair</a>* thread_worker_pair_alloc </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="../../d5/d10/structast__threadpool.html">ast_threadpool</a> *&#160;</td>
          <td class="paramname"><em>pool</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="../../dd/d5b/structworker__thread.html">worker_thread</a> *&#160;</td>
          <td class="paramname"><em>worker</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Allocate and initialize a <a class="el" href="../../d1/d34/structthread__worker__pair.html" title="Struct used for queued operations involving worker state changes. ">thread_worker_pair</a>. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">pool</td><td>Threadpool to assign to the <a class="el" href="../../d1/d34/structthread__worker__pair.html" title="Struct used for queued operations involving worker state changes. ">thread_worker_pair</a> </td></tr>
    <tr><td class="paramname">worker</td><td>Worker thread to assign to the <a class="el" href="../../d1/d34/structthread__worker__pair.html" title="Struct used for queued operations involving worker state changes. ">thread_worker_pair</a> </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="../../d1/dc7/threadpool_8c_source.html#l00214">214</a> of file <a class="el" href="../../d1/dc7/threadpool_8c_source.html">threadpool.c</a>.</p>

<p class="reference">References <a class="el" href="../../d5/da5/astobj2_8h_source.html#l00464">ao2_ref</a>, <a class="el" href="../../d8/d8a/astmm_8h_source.html#l00193">ast_malloc</a>, <a class="el" href="../../dc/d7f/resample_8c_source.html#l00096">NULL</a>, <a class="el" href="../../d1/dc7/threadpool_8c_source.html#l00195">thread_worker_pair::pool</a>, <a class="el" href="../../d9/d21/res__rtp__asterisk_8c_source.html#l00236">pool</a>, and <a class="el" href="../../d1/dc7/threadpool_8c_source.html#l00197">thread_worker_pair::worker</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../d1/dc7/threadpool_8c_source.html#l00256">threadpool_active_thread_idle()</a>, <a class="el" href="../../d1/dc7/threadpool_8c_source.html#l00332">threadpool_idle_thread_dead()</a>, and <a class="el" href="../../d1/dc7/threadpool_8c_source.html#l00301">threadpool_zombie_thread_dead()</a>.</p>
<div class="fragment"><div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;{</div><div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d1/d34/structthread__worker__pair.html">thread_worker_pair</a> *<a class="code" href="../../df/de8/structpair.html">pair</a> = <a class="code" href="../../d8/d8a/astmm_8h.html#ae63d4f486bcf6eac7c1593f867717d91">ast_malloc</a>(<span class="keyword">sizeof</span>(*pair));</div><div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;   <span class="keywordflow">if</span> (!pair) {</div><div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;   }</div><div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;   pair-&gt;<a class="code" href="../../d1/d34/structthread__worker__pair.html#ac8c18315f6d4a45480dea634294e683f">pool</a> = <a class="code" href="../../d9/d21/res__rtp__asterisk_8c.html#a2e57658a5d3ef6c4ef2774c9d5868e7c">pool</a>;</div><div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(worker, +1);</div><div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;   pair-&gt;<a class="code" href="../../d1/d34/structthread__worker__pair.html#acbba1e1f081a6e0fefa291d74ec1a10d">worker</a> = <a class="code" href="../../d1/d34/structthread__worker__pair.html#acbba1e1f081a6e0fefa291d74ec1a10d">worker</a>;</div><div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;</div><div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;   <span class="keywordflow">return</span> pair;</div><div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;}</div><div class="ttc" id="structthread__worker__pair_html"><div class="ttname"><a href="../../d1/d34/structthread__worker__pair.html">thread_worker_pair</a></div><div class="ttdoc">Struct used for queued operations involving worker state changes. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/dc7/threadpool_8c_source.html#l00193">threadpool.c:193</a></div></div>
<div class="ttc" id="res__rtp__asterisk_8c_html_a2e57658a5d3ef6c4ef2774c9d5868e7c"><div class="ttname"><a href="../../d9/d21/res__rtp__asterisk_8c.html#a2e57658a5d3ef6c4ef2774c9d5868e7c">pool</a></div><div class="ttdeci">static pj_pool_t * pool</div><div class="ttdoc">Global memory pool for configuration and timers. </div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d21/res__rtp__asterisk_8c_source.html#l00236">res_rtp_asterisk.c:236</a></div></div>
<div class="ttc" id="resample_8c_html_a070d2ce7b6bb7e5c05602aa8c308d0c4"><div class="ttname"><a href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a></div><div class="ttdeci">#define NULL</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d7f/resample_8c_source.html#l00096">resample.c:96</a></div></div>
<div class="ttc" id="astobj2_8h_html_aaca5e8eac39a22f9da1c36fc6c922270"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a></div><div class="ttdeci">#define ao2_ref(o, delta)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l00464">astobj2.h:464</a></div></div>
<div class="ttc" id="astmm_8h_html_ae63d4f486bcf6eac7c1593f867717d91"><div class="ttname"><a href="../../d8/d8a/astmm_8h.html#ae63d4f486bcf6eac7c1593f867717d91">ast_malloc</a></div><div class="ttdeci">#define ast_malloc(len)</div><div class="ttdoc">A wrapper for malloc() </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d8a/astmm_8h_source.html#l00193">astmm.h:193</a></div></div>
<div class="ttc" id="structthread__worker__pair_html_acbba1e1f081a6e0fefa291d74ec1a10d"><div class="ttname"><a href="../../d1/d34/structthread__worker__pair.html#acbba1e1f081a6e0fefa291d74ec1a10d">thread_worker_pair::worker</a></div><div class="ttdeci">struct worker_thread * worker</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/dc7/threadpool_8c_source.html#l00197">threadpool.c:197</a></div></div>
<div class="ttc" id="structpair_html"><div class="ttname"><a href="../../df/de8/structpair.html">pair</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d4f/test__config_8c_source.html#l00084">test_config.c:84</a></div></div>
<div class="ttc" id="structthread__worker__pair_html_ac8c18315f6d4a45480dea634294e683f"><div class="ttname"><a href="../../d1/d34/structthread__worker__pair.html#ac8c18315f6d4a45480dea634294e683f">thread_worker_pair::pool</a></div><div class="ttdeci">struct ast_threadpool * pool</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/dc7/threadpool_8c_source.html#l00195">threadpool.c:195</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a0041e0562576aadeec0ce50221ba2396"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0041e0562576aadeec0ce50221ba2396">&#9670;&nbsp;</a></span>thread_worker_pair_free()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void thread_worker_pair_free </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="../../d1/d34/structthread__worker__pair.html">thread_worker_pair</a> *&#160;</td>
          <td class="paramname"><em>pair</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Destructor for <a class="el" href="../../d1/d34/structthread__worker__pair.html" title="Struct used for queued operations involving worker state changes. ">thread_worker_pair</a>. </p>

<p class="definition">Definition at line <a class="el" href="../../d1/dc7/threadpool_8c_source.html#l00203">203</a> of file <a class="el" href="../../d1/dc7/threadpool_8c_source.html">threadpool.c</a>.</p>

<p class="reference">References <a class="el" href="../../d5/da5/astobj2_8h_source.html#l00464">ao2_ref</a>, <a class="el" href="../../d8/d8a/astmm_8h_source.html#l00182">ast_free</a>, and <a class="el" href="../../d1/dc7/threadpool_8c_source.html#l00197">thread_worker_pair::worker</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../d1/dc7/threadpool_8c_source.html#l00235">queued_active_thread_idle()</a>, <a class="el" href="../../d1/dc7/threadpool_8c_source.html#l00321">queued_idle_thread_dead()</a>, <a class="el" href="../../d1/dc7/threadpool_8c_source.html#l00284">queued_zombie_thread_dead()</a>, <a class="el" href="../../d1/dc7/threadpool_8c_source.html#l00256">threadpool_active_thread_idle()</a>, <a class="el" href="../../d1/dc7/threadpool_8c_source.html#l00332">threadpool_idle_thread_dead()</a>, and <a class="el" href="../../d1/dc7/threadpool_8c_source.html#l00301">threadpool_zombie_thread_dead()</a>.</p>
<div class="fragment"><div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;{</div><div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(pair-&gt;<a class="code" href="../../d1/d34/structthread__worker__pair.html#acbba1e1f081a6e0fefa291d74ec1a10d">worker</a>, -1);</div><div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;   <a class="code" href="../../d8/d8a/astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(pair);</div><div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;}</div><div class="ttc" id="astobj2_8h_html_aaca5e8eac39a22f9da1c36fc6c922270"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a></div><div class="ttdeci">#define ao2_ref(o, delta)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l00464">astobj2.h:464</a></div></div>
<div class="ttc" id="structthread__worker__pair_html_acbba1e1f081a6e0fefa291d74ec1a10d"><div class="ttname"><a href="../../d1/d34/structthread__worker__pair.html#acbba1e1f081a6e0fefa291d74ec1a10d">thread_worker_pair::worker</a></div><div class="ttdeci">struct worker_thread * worker</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/dc7/threadpool_8c_source.html#l00197">threadpool.c:197</a></div></div>
<div class="ttc" id="astmm_8h_html_a402072d6789f6ed9e3a81da27504127e"><div class="ttname"><a href="../../d8/d8a/astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a></div><div class="ttdeci">#define ast_free(a)</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d8a/astmm_8h_source.html#l00182">astmm.h:182</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a1db4545f69518e92887438ebf9dfb898"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1db4545f69518e92887438ebf9dfb898">&#9670;&nbsp;</a></span>threadpool_active_thread_idle()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void threadpool_active_thread_idle </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="../../d5/d10/structast__threadpool.html">ast_threadpool</a> *&#160;</td>
          <td class="paramname"><em>pool</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="../../dd/d5b/structworker__thread.html">worker_thread</a> *&#160;</td>
          <td class="paramname"><em>worker</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Queue a task to move a thread from the active list to the idle list. </p>
<p>This is called by a worker thread when it runs out of tasks to perform and goes idle. </p><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">pool</td><td>The threadpool to which the worker belongs </td></tr>
    <tr><td class="paramname">worker</td><td>The worker thread that has gone idle </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="../../d1/dc7/threadpool_8c_source.html#l00256">256</a> of file <a class="el" href="../../d1/dc7/threadpool_8c_source.html">threadpool.c</a>.</p>

<p class="reference">References <a class="el" href="../../d4/deb/taskprocessor_8c_source.html#l01175">ast_taskprocessor_push()</a>, <a class="el" href="../../d1/dc7/threadpool_8c_source.html#l00096">ast_threadpool::control_tps</a>, <a class="el" href="../../df/d44/app__meetme_8c_source.html#l01091">lock</a>, <a class="el" href="../../d1/dc7/threadpool_8c_source.html#l00235">queued_active_thread_idle()</a>, <a class="el" href="../../dd/d42/lock_8h_source.html#l00602">SCOPED_AO2LOCK</a>, <a class="el" href="../../d1/dc7/threadpool_8c_source.html#l00098">ast_threadpool::shutting_down</a>, <a class="el" href="../../d1/dc7/threadpool_8c_source.html#l00214">thread_worker_pair_alloc()</a>, and <a class="el" href="../../d1/dc7/threadpool_8c_source.html#l00203">thread_worker_pair_free()</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../d1/dc7/threadpool_8c_source.html#l01044">worker_start()</a>.</p>
<div class="fragment"><div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;{</div><div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d1/d34/structthread__worker__pair.html">thread_worker_pair</a> *<a class="code" href="../../df/de8/structpair.html">pair</a>;</div><div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;   <a class="code" href="../../dd/d42/lock_8h.html#a2cfb325ed371eb6e629446bac4676e9f">SCOPED_AO2LOCK</a>(<a class="code" href="../../df/d44/app__meetme_8c.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>, pool);</div><div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;</div><div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;   <span class="keywordflow">if</span> (pool-&gt;<a class="code" href="../../d5/d10/structast__threadpool.html#a7f68568851b9c7f9291f7bb63f932c18">shutting_down</a>) {</div><div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;      <span class="keywordflow">return</span>;</div><div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;   }</div><div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;</div><div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;   pair = <a class="code" href="../../d1/dc7/threadpool_8c.html#a2d77e9ba6f3133c92f78b076d2561732">thread_worker_pair_alloc</a>(pool, worker);</div><div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;   <span class="keywordflow">if</span> (!pair) {</div><div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;      <span class="keywordflow">return</span>;</div><div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;   }</div><div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;</div><div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d0/d1e/taskprocessor_8h.html#a6b2508ba0a6b8f43ae6d3963f3189585">ast_taskprocessor_push</a>(pool-&gt;<a class="code" href="../../d5/d10/structast__threadpool.html#a566be46267682ab4ec66a8c25b673f8c">control_tps</a>, <a class="code" href="../../d1/dc7/threadpool_8c.html#a8265602231dc299fa6acc75612ab7602">queued_active_thread_idle</a>, pair)) {</div><div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;      <a class="code" href="../../d1/dc7/threadpool_8c.html#a0041e0562576aadeec0ce50221ba2396">thread_worker_pair_free</a>(pair);</div><div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;   }</div><div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;}</div><div class="ttc" id="structthread__worker__pair_html"><div class="ttname"><a href="../../d1/d34/structthread__worker__pair.html">thread_worker_pair</a></div><div class="ttdoc">Struct used for queued operations involving worker state changes. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/dc7/threadpool_8c_source.html#l00193">threadpool.c:193</a></div></div>
<div class="ttc" id="structast__threadpool_html_a7f68568851b9c7f9291f7bb63f932c18"><div class="ttname"><a href="../../d5/d10/structast__threadpool.html#a7f68568851b9c7f9291f7bb63f932c18">ast_threadpool::shutting_down</a></div><div class="ttdeci">int shutting_down</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/dc7/threadpool_8c_source.html#l00098">threadpool.c:98</a></div></div>
<div class="ttc" id="app__meetme_8c_html_adf04f66344e3fb0a6f6a69bf39d19902"><div class="ttname"><a href="../../df/d44/app__meetme_8c.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a></div><div class="ttdeci">ast_mutex_t lock</div><div class="ttdef"><b>Definition:</b> <a href="../../df/d44/app__meetme_8c_source.html#l01091">app_meetme.c:1091</a></div></div>
<div class="ttc" id="threadpool_8c_html_a2d77e9ba6f3133c92f78b076d2561732"><div class="ttname"><a href="../../d1/dc7/threadpool_8c.html#a2d77e9ba6f3133c92f78b076d2561732">thread_worker_pair_alloc</a></div><div class="ttdeci">static struct thread_worker_pair * thread_worker_pair_alloc(struct ast_threadpool *pool, struct worker_thread *worker)</div><div class="ttdoc">Allocate and initialize a thread_worker_pair. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/dc7/threadpool_8c_source.html#l00214">threadpool.c:214</a></div></div>
<div class="ttc" id="lock_8h_html_a2cfb325ed371eb6e629446bac4676e9f"><div class="ttname"><a href="../../dd/d42/lock_8h.html#a2cfb325ed371eb6e629446bac4676e9f">SCOPED_AO2LOCK</a></div><div class="ttdeci">#define SCOPED_AO2LOCK(varname, obj)</div><div class="ttdoc">scoped lock specialization for ao2 mutexes. </div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d42/lock_8h_source.html#l00602">lock.h:602</a></div></div>
<div class="ttc" id="taskprocessor_8h_html_a6b2508ba0a6b8f43ae6d3963f3189585"><div class="ttname"><a href="../../d0/d1e/taskprocessor_8h.html#a6b2508ba0a6b8f43ae6d3963f3189585">ast_taskprocessor_push</a></div><div class="ttdeci">int ast_taskprocessor_push(struct ast_taskprocessor *tps, int(*task_exe)(void *datap), void *datap) attribute_warn_unused_result</div><div class="ttdoc">Push a task into the specified taskprocessor queue and signal the taskprocessor thread. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/deb/taskprocessor_8c_source.html#l01175">taskprocessor.c:1175</a></div></div>
<div class="ttc" id="structpair_html"><div class="ttname"><a href="../../df/de8/structpair.html">pair</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d4f/test__config_8c_source.html#l00084">test_config.c:84</a></div></div>
<div class="ttc" id="threadpool_8c_html_a0041e0562576aadeec0ce50221ba2396"><div class="ttname"><a href="../../d1/dc7/threadpool_8c.html#a0041e0562576aadeec0ce50221ba2396">thread_worker_pair_free</a></div><div class="ttdeci">static void thread_worker_pair_free(struct thread_worker_pair *pair)</div><div class="ttdoc">Destructor for thread_worker_pair. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/dc7/threadpool_8c_source.html#l00203">threadpool.c:203</a></div></div>
<div class="ttc" id="threadpool_8c_html_a8265602231dc299fa6acc75612ab7602"><div class="ttname"><a href="../../d1/dc7/threadpool_8c.html#a8265602231dc299fa6acc75612ab7602">queued_active_thread_idle</a></div><div class="ttdeci">static int queued_active_thread_idle(void *data)</div><div class="ttdoc">Move a worker thread from the active container to the idle container. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/dc7/threadpool_8c_source.html#l00235">threadpool.c:235</a></div></div>
<div class="ttc" id="structast__threadpool_html_a566be46267682ab4ec66a8c25b673f8c"><div class="ttname"><a href="../../d5/d10/structast__threadpool.html#a566be46267682ab4ec66a8c25b673f8c">ast_threadpool::control_tps</a></div><div class="ttdeci">struct ast_taskprocessor * control_tps</div><div class="ttdoc">The control taskprocessor. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/dc7/threadpool_8c_source.html#l00096">threadpool.c:96</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="aff29105af0024d75406fe2d09017fa3d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aff29105af0024d75406fe2d09017fa3d">&#9670;&nbsp;</a></span>threadpool_alloc()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static struct <a class="el" href="../../d5/d10/structast__threadpool.html">ast_threadpool</a>* threadpool_alloc </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>name</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const struct <a class="el" href="../../de/de6/structast__threadpool__options.html">ast_threadpool_options</a> *&#160;</td>
          <td class="paramname"><em>options</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="../../d1/dc7/threadpool_8c_source.html#l00404">404</a> of file <a class="el" href="../../d1/dc7/threadpool_8c_source.html">threadpool.c</a>.</p>

<p class="reference">References <a class="el" href="../../d5/da5/astobj2_8h_source.html#l00411">ao2_alloc</a>, <a class="el" href="../../d5/da5/astobj2_8h_source.html#l00365">AO2_ALLOC_OPT_LOCK_MUTEX</a>, <a class="el" href="../../d5/da5/astobj2_8h_source.html#l01958">ao2_cleanup</a>, <a class="el" href="../../d5/da5/astobj2_8h_source.html#l01310">ao2_container_alloc_hash</a>, <a class="el" href="../../d5/da5/astobj2_8h_source.html#l00464">ao2_ref</a>, <a class="el" href="../../d8/d8a/astmm_8h_source.html#l00182">ast_free</a>, <a class="el" href="../../d6/d90/strings_8h_source.html#l00714">ast_str_buffer()</a>, <a class="el" href="../../d6/d90/strings_8h_source.html#l00620">ast_str_create</a>, <a class="el" href="../../d6/d90/strings_8h_source.html#l01065">ast_str_set()</a>, <a class="el" href="../../d4/deb/taskprocessor_8c_source.html#l01044">ast_taskprocessor_get()</a>, <a class="el" href="../../dc/d7f/resample_8c_source.html#l00096">NULL</a>, <a class="el" href="../../d1/dc7/threadpool_8c_source.html#l00100">ast_threadpool::options</a>, <a class="el" href="../../d9/d21/res__rtp__asterisk_8c_source.html#l00236">pool</a>, <a class="el" href="../../d5/d60/utils_8h_source.html#l00911">RAII_VAR</a>, <a class="el" href="../../d1/dc7/threadpool_8c_source.html#l00028">THREAD_BUCKETS</a>, <a class="el" href="../../d1/dc7/threadpool_8c_source.html#l00386">threadpool_destructor()</a>, <a class="el" href="../../d0/d1e/taskprocessor_8h_source.html#l00075">TPS_REF_DEFAULT</a>, <a class="el" href="../../d1/dc7/threadpool_8c_source.html#l00993">worker_thread_cmp()</a>, and <a class="el" href="../../d1/dc7/threadpool_8c_source.html#l00986">worker_thread_hash()</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../d1/dc7/threadpool_8c_source.html#l00915">ast_threadpool_create()</a>.</p>
<div class="fragment"><div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;{</div><div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;   <a class="code" href="../../d5/d60/utils_8h.html#a1604b4d72144dd3d9f7da668e90337e9">RAII_VAR</a>(<span class="keyword">struct</span> <a class="code" href="../../d5/d10/structast__threadpool.html">ast_threadpool</a> *, <a class="code" href="../../d9/d21/res__rtp__asterisk_8c.html#a2e57658a5d3ef6c4ef2774c9d5868e7c">pool</a>, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../d5/da5/astobj2_8h.html#a6321ee982370c55ab3c24c72c562cbdd">ao2_cleanup</a>);</div><div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../dd/da2/structast__str.html">ast_str</a> *control_tps_name;</div><div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;</div><div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;   <a class="code" href="../../d9/d21/res__rtp__asterisk_8c.html#a2e57658a5d3ef6c4ef2774c9d5868e7c">pool</a> = <a class="code" href="../../d5/da5/astobj2_8h.html#ae0422b60d8e25b6962b2d61ae4ddf724">ao2_alloc</a>(<span class="keyword">sizeof</span>(*<a class="code" href="../../d9/d21/res__rtp__asterisk_8c.html#a2e57658a5d3ef6c4ef2774c9d5868e7c">pool</a>), <a class="code" href="../../d1/dc7/threadpool_8c.html#a43dc131042e760b997414f566761236c">threadpool_destructor</a>);</div><div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;   control_tps_name = <a class="code" href="../../d6/d90/strings_8h.html#a9c34c6c6b8daaba24c0406270f3cf697">ast_str_create</a>(64);</div><div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;   <span class="keywordflow">if</span> (!<a class="code" href="../../d9/d21/res__rtp__asterisk_8c.html#a2e57658a5d3ef6c4ef2774c9d5868e7c">pool</a> || !control_tps_name) {</div><div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;      <a class="code" href="../../d8/d8a/astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(control_tps_name);</div><div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;   }</div><div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;</div><div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;   <a class="code" href="../../d6/d90/strings_8h.html#aa3341f35cedca29e60bb7f3927204283">ast_str_set</a>(&amp;control_tps_name, 0, <span class="stringliteral">&quot;%s/pool-control&quot;</span>, <a class="code" href="../../d0/d29/cdr__mysql_8c.html#a0980a105ccb863d8008eb6201a51da52">name</a>);</div><div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;</div><div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;   <a class="code" href="../../d9/d21/res__rtp__asterisk_8c.html#a2e57658a5d3ef6c4ef2774c9d5868e7c">pool</a>-&gt;control_tps = <a class="code" href="../../d0/d1e/taskprocessor_8h.html#ac999cc9523590a29dff6acbd9cad24a9">ast_taskprocessor_get</a>(<a class="code" href="../../d6/d90/strings_8h.html#a1ef7e2644ca7258070db316fdc0a465b">ast_str_buffer</a>(control_tps_name), <a class="code" href="../../d0/d1e/taskprocessor_8h.html#a42ae78df3dc5106c133bf2f7b72080f7ae248d04bb7a6b5e0906e4906af4ee35a">TPS_REF_DEFAULT</a>);</div><div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;   <a class="code" href="../../d8/d8a/astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(control_tps_name);</div><div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;   <span class="keywordflow">if</span> (!<a class="code" href="../../d9/d21/res__rtp__asterisk_8c.html#a2e57658a5d3ef6c4ef2774c9d5868e7c">pool</a>-&gt;control_tps) {</div><div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;   }</div><div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;   <a class="code" href="../../d9/d21/res__rtp__asterisk_8c.html#a2e57658a5d3ef6c4ef2774c9d5868e7c">pool</a>-&gt;active_threads = <a class="code" href="../../d5/da5/astobj2_8h.html#aefc16f8aa9087cbc5c55c70cf1dd41b2">ao2_container_alloc_hash</a>(<a class="code" href="../../d5/da5/astobj2_8h.html#a2cf7e3433f08351aafe3b0cd31edf7f8a8ccf751bd6749d062999469f0694e7ad">AO2_ALLOC_OPT_LOCK_MUTEX</a>, 0,</div><div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;      <a class="code" href="../../d1/dc7/threadpool_8c.html#acfc62009ad38b3c3b15f1ac934bf25d0">THREAD_BUCKETS</a>, <a class="code" href="../../d1/dc7/threadpool_8c.html#a21d4025815ba402857dd4c09dead0384">worker_thread_hash</a>, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../d1/dc7/threadpool_8c.html#ac0d540965c29848c4867d3db2440ec4d">worker_thread_cmp</a>);</div><div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;   <span class="keywordflow">if</span> (!<a class="code" href="../../d9/d21/res__rtp__asterisk_8c.html#a2e57658a5d3ef6c4ef2774c9d5868e7c">pool</a>-&gt;active_threads) {</div><div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;   }</div><div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;   <a class="code" href="../../d9/d21/res__rtp__asterisk_8c.html#a2e57658a5d3ef6c4ef2774c9d5868e7c">pool</a>-&gt;idle_threads = <a class="code" href="../../d5/da5/astobj2_8h.html#aefc16f8aa9087cbc5c55c70cf1dd41b2">ao2_container_alloc_hash</a>(<a class="code" href="../../d5/da5/astobj2_8h.html#a2cf7e3433f08351aafe3b0cd31edf7f8a8ccf751bd6749d062999469f0694e7ad">AO2_ALLOC_OPT_LOCK_MUTEX</a>, 0,</div><div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;      <a class="code" href="../../d1/dc7/threadpool_8c.html#acfc62009ad38b3c3b15f1ac934bf25d0">THREAD_BUCKETS</a>, <a class="code" href="../../d1/dc7/threadpool_8c.html#a21d4025815ba402857dd4c09dead0384">worker_thread_hash</a>, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../d1/dc7/threadpool_8c.html#ac0d540965c29848c4867d3db2440ec4d">worker_thread_cmp</a>);</div><div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;   <span class="keywordflow">if</span> (!<a class="code" href="../../d9/d21/res__rtp__asterisk_8c.html#a2e57658a5d3ef6c4ef2774c9d5868e7c">pool</a>-&gt;idle_threads) {</div><div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;   }</div><div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;   <a class="code" href="../../d9/d21/res__rtp__asterisk_8c.html#a2e57658a5d3ef6c4ef2774c9d5868e7c">pool</a>-&gt;zombie_threads = <a class="code" href="../../d5/da5/astobj2_8h.html#aefc16f8aa9087cbc5c55c70cf1dd41b2">ao2_container_alloc_hash</a>(<a class="code" href="../../d5/da5/astobj2_8h.html#a2cf7e3433f08351aafe3b0cd31edf7f8a8ccf751bd6749d062999469f0694e7ad">AO2_ALLOC_OPT_LOCK_MUTEX</a>, 0,</div><div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;      <a class="code" href="../../d1/dc7/threadpool_8c.html#acfc62009ad38b3c3b15f1ac934bf25d0">THREAD_BUCKETS</a>, <a class="code" href="../../d1/dc7/threadpool_8c.html#a21d4025815ba402857dd4c09dead0384">worker_thread_hash</a>, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../d1/dc7/threadpool_8c.html#ac0d540965c29848c4867d3db2440ec4d">worker_thread_cmp</a>);</div><div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;   <span class="keywordflow">if</span> (!<a class="code" href="../../d9/d21/res__rtp__asterisk_8c.html#a2e57658a5d3ef6c4ef2774c9d5868e7c">pool</a>-&gt;zombie_threads) {</div><div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;   }</div><div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;   <a class="code" href="../../d9/d21/res__rtp__asterisk_8c.html#a2e57658a5d3ef6c4ef2774c9d5868e7c">pool</a>-&gt;options = *<a class="code" href="../../d4/d45/test__http__media__cache_8c.html#a80c8e3ae5087d90d422675d034eeebc7">options</a>;</div><div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;</div><div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(<a class="code" href="../../d9/d21/res__rtp__asterisk_8c.html#a2e57658a5d3ef6c4ef2774c9d5868e7c">pool</a>, +1);</div><div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;   <span class="keywordflow">return</span> <a class="code" href="../../d9/d21/res__rtp__asterisk_8c.html#a2e57658a5d3ef6c4ef2774c9d5868e7c">pool</a>;</div><div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;}</div><div class="ttc" id="strings_8h_html_a1ef7e2644ca7258070db316fdc0a465b"><div class="ttname"><a href="../../d6/d90/strings_8h.html#a1ef7e2644ca7258070db316fdc0a465b">ast_str_buffer</a></div><div class="ttdeci">char * ast_str_buffer(const struct ast_str *buf)</div><div class="ttdoc">Returns the string buffer within the ast_str buf. </div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d90/strings_8h_source.html#l00714">strings.h:714</a></div></div>
<div class="ttc" id="taskprocessor_8h_html_ac999cc9523590a29dff6acbd9cad24a9"><div class="ttname"><a href="../../d0/d1e/taskprocessor_8h.html#ac999cc9523590a29dff6acbd9cad24a9">ast_taskprocessor_get</a></div><div class="ttdeci">struct ast_taskprocessor * ast_taskprocessor_get(const char *name, enum ast_tps_options create)</div><div class="ttdoc">Get a reference to a taskprocessor with the specified name and create the taskprocessor if necessary...</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/deb/taskprocessor_8c_source.html#l01044">taskprocessor.c:1044</a></div></div>
<div class="ttc" id="res__rtp__asterisk_8c_html_a2e57658a5d3ef6c4ef2774c9d5868e7c"><div class="ttname"><a href="../../d9/d21/res__rtp__asterisk_8c.html#a2e57658a5d3ef6c4ef2774c9d5868e7c">pool</a></div><div class="ttdeci">static pj_pool_t * pool</div><div class="ttdoc">Global memory pool for configuration and timers. </div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d21/res__rtp__asterisk_8c_source.html#l00236">res_rtp_asterisk.c:236</a></div></div>
<div class="ttc" id="taskprocessor_8h_html_a42ae78df3dc5106c133bf2f7b72080f7ae248d04bb7a6b5e0906e4906af4ee35a"><div class="ttname"><a href="../../d0/d1e/taskprocessor_8h.html#a42ae78df3dc5106c133bf2f7b72080f7ae248d04bb7a6b5e0906e4906af4ee35a">TPS_REF_DEFAULT</a></div><div class="ttdoc">return a reference to a taskprocessor, create one if it does not exist </div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d1e/taskprocessor_8h_source.html#l00075">taskprocessor.h:75</a></div></div>
<div class="ttc" id="threadpool_8c_html_a43dc131042e760b997414f566761236c"><div class="ttname"><a href="../../d1/dc7/threadpool_8c.html#a43dc131042e760b997414f566761236c">threadpool_destructor</a></div><div class="ttdeci">static void threadpool_destructor(void *obj)</div><div class="ttdoc">Destroy a threadpool&amp;#39;s components. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/dc7/threadpool_8c_source.html#l00386">threadpool.c:386</a></div></div>
<div class="ttc" id="resample_8c_html_a070d2ce7b6bb7e5c05602aa8c308d0c4"><div class="ttname"><a href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a></div><div class="ttdeci">#define NULL</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d7f/resample_8c_source.html#l00096">resample.c:96</a></div></div>
<div class="ttc" id="strings_8h_html_aa3341f35cedca29e60bb7f3927204283"><div class="ttname"><a href="../../d6/d90/strings_8h.html#aa3341f35cedca29e60bb7f3927204283">ast_str_set</a></div><div class="ttdeci">int ast_str_set(struct ast_str **buf, ssize_t max_len, const char *fmt,...)</div><div class="ttdoc">Set a dynamic string using variable arguments. </div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d90/strings_8h_source.html#l01065">strings.h:1065</a></div></div>
<div class="ttc" id="threadpool_8c_html_a21d4025815ba402857dd4c09dead0384"><div class="ttname"><a href="../../d1/dc7/threadpool_8c.html#a21d4025815ba402857dd4c09dead0384">worker_thread_hash</a></div><div class="ttdeci">static int worker_thread_hash(const void *obj, int flags)</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/dc7/threadpool_8c_source.html#l00986">threadpool.c:986</a></div></div>
<div class="ttc" id="utils_8h_html_a1604b4d72144dd3d9f7da668e90337e9"><div class="ttname"><a href="../../d5/d60/utils_8h.html#a1604b4d72144dd3d9f7da668e90337e9">RAII_VAR</a></div><div class="ttdeci">#define RAII_VAR(vartype, varname, initval, dtor)</div><div class="ttdoc">Declare a variable that will call a destructor function when it goes out of scope. </div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d60/utils_8h_source.html#l00911">utils.h:911</a></div></div>
<div class="ttc" id="astobj2_8h_html_aaca5e8eac39a22f9da1c36fc6c922270"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a></div><div class="ttdeci">#define ao2_ref(o, delta)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l00464">astobj2.h:464</a></div></div>
<div class="ttc" id="astobj2_8h_html_a2cf7e3433f08351aafe3b0cd31edf7f8a8ccf751bd6749d062999469f0694e7ad"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#a2cf7e3433f08351aafe3b0cd31edf7f8a8ccf751bd6749d062999469f0694e7ad">AO2_ALLOC_OPT_LOCK_MUTEX</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l00365">astobj2.h:365</a></div></div>
<div class="ttc" id="threadpool_8c_html_acfc62009ad38b3c3b15f1ac934bf25d0"><div class="ttname"><a href="../../d1/dc7/threadpool_8c.html#acfc62009ad38b3c3b15f1ac934bf25d0">THREAD_BUCKETS</a></div><div class="ttdeci">#define THREAD_BUCKETS</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/dc7/threadpool_8c_source.html#l00028">threadpool.c:28</a></div></div>
<div class="ttc" id="astobj2_8h_html_aefc16f8aa9087cbc5c55c70cf1dd41b2"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#aefc16f8aa9087cbc5c55c70cf1dd41b2">ao2_container_alloc_hash</a></div><div class="ttdeci">#define ao2_container_alloc_hash(ao2_options, container_options, n_buckets, hash_fn, sort_fn, cmp_fn)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l01310">astobj2.h:1310</a></div></div>
<div class="ttc" id="structast__str_html"><div class="ttname"><a href="../../dd/da2/structast__str.html">ast_str</a></div><div class="ttdoc">The descriptor of a dynamic string XXX storage will be optimized later if needed We use the ts field ...</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d90/strings_8h_source.html#l00584">strings.h:584</a></div></div>
<div class="ttc" id="astobj2_8h_html_ae0422b60d8e25b6962b2d61ae4ddf724"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#ae0422b60d8e25b6962b2d61ae4ddf724">ao2_alloc</a></div><div class="ttdeci">#define ao2_alloc(data_size, destructor_fn)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l00411">astobj2.h:411</a></div></div>
<div class="ttc" id="cdr__mysql_8c_html_a0980a105ccb863d8008eb6201a51da52"><div class="ttname"><a href="../../d0/d29/cdr__mysql_8c.html#a0980a105ccb863d8008eb6201a51da52">name</a></div><div class="ttdeci">static const char name[]</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d29/cdr__mysql_8c_source.html#l00074">cdr_mysql.c:74</a></div></div>
<div class="ttc" id="astmm_8h_html_a402072d6789f6ed9e3a81da27504127e"><div class="ttname"><a href="../../d8/d8a/astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a></div><div class="ttdeci">#define ast_free(a)</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d8a/astmm_8h_source.html#l00182">astmm.h:182</a></div></div>
<div class="ttc" id="astobj2_8h_html_a6321ee982370c55ab3c24c72c562cbdd"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#a6321ee982370c55ab3c24c72c562cbdd">ao2_cleanup</a></div><div class="ttdeci">#define ao2_cleanup(obj)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l01958">astobj2.h:1958</a></div></div>
<div class="ttc" id="threadpool_8c_html_ac0d540965c29848c4867d3db2440ec4d"><div class="ttname"><a href="../../d1/dc7/threadpool_8c.html#ac0d540965c29848c4867d3db2440ec4d">worker_thread_cmp</a></div><div class="ttdeci">static int worker_thread_cmp(void *obj, void *arg, int flags)</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/dc7/threadpool_8c_source.html#l00993">threadpool.c:993</a></div></div>
<div class="ttc" id="structast__threadpool_html"><div class="ttname"><a href="../../d5/d10/structast__threadpool.html">ast_threadpool</a></div><div class="ttdoc">An opaque threadpool structure. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/dc7/threadpool_8c_source.html#l00036">threadpool.c:36</a></div></div>
<div class="ttc" id="test__http__media__cache_8c_html_a80c8e3ae5087d90d422675d034eeebc7"><div class="ttname"><a href="../../d4/d45/test__http__media__cache_8c.html#a80c8e3ae5087d90d422675d034eeebc7">options</a></div><div class="ttdeci">static struct test_options options</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d45/test__http__media__cache_8c_source.html#l00062">test_http_media_cache.c:62</a></div></div>
<div class="ttc" id="strings_8h_html_a9c34c6c6b8daaba24c0406270f3cf697"><div class="ttname"><a href="../../d6/d90/strings_8h.html#a9c34c6c6b8daaba24c0406270f3cf697">ast_str_create</a></div><div class="ttdeci">#define ast_str_create(init_len)</div><div class="ttdoc">Create a malloc&amp;#39;ed dynamic length string. </div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d90/strings_8h_source.html#l00620">strings.h:620</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a43dc131042e760b997414f566761236c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a43dc131042e760b997414f566761236c">&#9670;&nbsp;</a></span>threadpool_destructor()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void threadpool_destructor </td>
          <td>(</td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>obj</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Destroy a threadpool's components. </p>
<p>This is the destructor called automatically when the threadpool's reference count reaches zero. This is not to be confused with threadpool_destroy.</p>
<p>By the time this actually gets called, most of the cleanup has already been done in the pool. The only thing left to do is to release the final reference to the threadpool listener.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">obj</td><td>The pool to destroy </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="../../d1/dc7/threadpool_8c_source.html#l00386">386</a> of file <a class="el" href="../../d1/dc7/threadpool_8c_source.html">threadpool.c</a>.</p>

<p class="reference">References <a class="el" href="../../d5/da5/astobj2_8h_source.html#l01958">ao2_cleanup</a>, <a class="el" href="../../d1/dc7/threadpool_8c_source.html#l00038">ast_threadpool::listener</a>, and <a class="el" href="../../d9/d21/res__rtp__asterisk_8c_source.html#l00236">pool</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../d1/dc7/threadpool_8c_source.html#l00404">threadpool_alloc()</a>.</p>
<div class="fragment"><div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;{</div><div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d5/d10/structast__threadpool.html">ast_threadpool</a> *<a class="code" href="../../d9/d21/res__rtp__asterisk_8c.html#a2e57658a5d3ef6c4ef2774c9d5868e7c">pool</a> = obj;</div><div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#a6321ee982370c55ab3c24c72c562cbdd">ao2_cleanup</a>(pool-&gt;<a class="code" href="../../d5/d10/structast__threadpool.html#a9a8a970d797bbe611df35df7d8318b1d">listener</a>);</div><div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;}</div><div class="ttc" id="res__rtp__asterisk_8c_html_a2e57658a5d3ef6c4ef2774c9d5868e7c"><div class="ttname"><a href="../../d9/d21/res__rtp__asterisk_8c.html#a2e57658a5d3ef6c4ef2774c9d5868e7c">pool</a></div><div class="ttdeci">static pj_pool_t * pool</div><div class="ttdoc">Global memory pool for configuration and timers. </div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d21/res__rtp__asterisk_8c_source.html#l00236">res_rtp_asterisk.c:236</a></div></div>
<div class="ttc" id="structast__threadpool_html_a9a8a970d797bbe611df35df7d8318b1d"><div class="ttname"><a href="../../d5/d10/structast__threadpool.html#a9a8a970d797bbe611df35df7d8318b1d">ast_threadpool::listener</a></div><div class="ttdeci">struct ast_threadpool_listener * listener</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/dc7/threadpool_8c_source.html#l00038">threadpool.c:38</a></div></div>
<div class="ttc" id="astobj2_8h_html_a6321ee982370c55ab3c24c72c562cbdd"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#a6321ee982370c55ab3c24c72c562cbdd">ao2_cleanup</a></div><div class="ttdeci">#define ao2_cleanup(obj)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l01958">astobj2.h:1958</a></div></div>
<div class="ttc" id="structast__threadpool_html"><div class="ttname"><a href="../../d5/d10/structast__threadpool.html">ast_threadpool</a></div><div class="ttdoc">An opaque threadpool structure. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/dc7/threadpool_8c_source.html#l00036">threadpool.c:36</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a6eab2cb427a73f76279f15c10182f1ed"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6eab2cb427a73f76279f15c10182f1ed">&#9670;&nbsp;</a></span>threadpool_execute()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int threadpool_execute </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="../../d5/d10/structast__threadpool.html">ast_threadpool</a> *&#160;</td>
          <td class="paramname"><em>pool</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Execute a task in the threadpool. </p>
<p>This is the function that worker threads call in order to execute tasks in the threadpool</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">pool</td><td>The pool to which the tasks belong. </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">0</td><td>Either the pool has been shut down or there are no tasks. </td></tr>
    <tr><td class="paramname">1</td><td>There are still tasks remaining in the pool. </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="../../d1/dc7/threadpool_8c_source.html#l00362">362</a> of file <a class="el" href="../../d1/dc7/threadpool_8c_source.html">threadpool.c</a>.</p>

<p class="reference">References <a class="el" href="../../d5/da5/astobj2_8h_source.html#l00718">ao2_lock</a>, <a class="el" href="../../d5/da5/astobj2_8h_source.html#l00730">ao2_unlock</a>, <a class="el" href="../../d4/deb/taskprocessor_8c_source.html#l01212">ast_taskprocessor_execute()</a>, <a class="el" href="../../d1/dc7/threadpool_8c_source.html#l00098">ast_threadpool::shutting_down</a>, and <a class="el" href="../../d1/dc7/threadpool_8c_source.html#l00067">ast_threadpool::tps</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../d1/dc7/threadpool_8c_source.html#l01124">worker_active()</a>.</p>
<div class="fragment"><div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;{</div><div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#aa9fdb5d0a6157a56060d9f7279fe6c49">ao2_lock</a>(pool);</div><div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;   <span class="keywordflow">if</span> (!pool-&gt;<a class="code" href="../../d5/d10/structast__threadpool.html#a7f68568851b9c7f9291f7bb63f932c18">shutting_down</a>) {</div><div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;      <a class="code" href="../../d5/da5/astobj2_8h.html#a9998bd156b936636a8780385e9a910b2">ao2_unlock</a>(pool);</div><div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../d0/d1e/taskprocessor_8h.html#a9318e041c0564532581e864cda8f9426">ast_taskprocessor_execute</a>(pool-&gt;<a class="code" href="../../d5/d10/structast__threadpool.html#a4c381cb1b5cf198fa3f260212e716c9a">tps</a>);</div><div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;   }</div><div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#a9998bd156b936636a8780385e9a910b2">ao2_unlock</a>(pool);</div><div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;   <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;}</div><div class="ttc" id="structast__threadpool_html_a7f68568851b9c7f9291f7bb63f932c18"><div class="ttname"><a href="../../d5/d10/structast__threadpool.html#a7f68568851b9c7f9291f7bb63f932c18">ast_threadpool::shutting_down</a></div><div class="ttdeci">int shutting_down</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/dc7/threadpool_8c_source.html#l00098">threadpool.c:98</a></div></div>
<div class="ttc" id="astobj2_8h_html_a9998bd156b936636a8780385e9a910b2"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#a9998bd156b936636a8780385e9a910b2">ao2_unlock</a></div><div class="ttdeci">#define ao2_unlock(a)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l00730">astobj2.h:730</a></div></div>
<div class="ttc" id="taskprocessor_8h_html_a9318e041c0564532581e864cda8f9426"><div class="ttname"><a href="../../d0/d1e/taskprocessor_8h.html#a9318e041c0564532581e864cda8f9426">ast_taskprocessor_execute</a></div><div class="ttdeci">int ast_taskprocessor_execute(struct ast_taskprocessor *tps)</div><div class="ttdoc">Pop a task off the taskprocessor and execute it. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/deb/taskprocessor_8c_source.html#l01212">taskprocessor.c:1212</a></div></div>
<div class="ttc" id="astobj2_8h_html_aa9fdb5d0a6157a56060d9f7279fe6c49"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#aa9fdb5d0a6157a56060d9f7279fe6c49">ao2_lock</a></div><div class="ttdeci">#define ao2_lock(a)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l00718">astobj2.h:718</a></div></div>
<div class="ttc" id="structast__threadpool_html_a4c381cb1b5cf198fa3f260212e716c9a"><div class="ttname"><a href="../../d5/d10/structast__threadpool.html#a4c381cb1b5cf198fa3f260212e716c9a">ast_threadpool::tps</a></div><div class="ttdeci">struct ast_taskprocessor * tps</div><div class="ttdoc">The main taskprocessor. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/dc7/threadpool_8c_source.html#l00067">threadpool.c:67</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="ab74dbf0b6c8d543d3b115afd691cddd6"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab74dbf0b6c8d543d3b115afd691cddd6">&#9670;&nbsp;</a></span>threadpool_idle_thread_dead()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void threadpool_idle_thread_dead </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="../../d5/d10/structast__threadpool.html">ast_threadpool</a> *&#160;</td>
          <td class="paramname"><em>pool</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="../../dd/d5b/structworker__thread.html">worker_thread</a> *&#160;</td>
          <td class="paramname"><em>worker</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="../../d1/dc7/threadpool_8c_source.html#l00332">332</a> of file <a class="el" href="../../d1/dc7/threadpool_8c_source.html">threadpool.c</a>.</p>

<p class="reference">References <a class="el" href="../../d4/deb/taskprocessor_8c_source.html#l01175">ast_taskprocessor_push()</a>, <a class="el" href="../../d1/dc7/threadpool_8c_source.html#l00096">ast_threadpool::control_tps</a>, <a class="el" href="../../df/d44/app__meetme_8c_source.html#l01091">lock</a>, <a class="el" href="../../d1/dc7/threadpool_8c_source.html#l00321">queued_idle_thread_dead()</a>, <a class="el" href="../../dd/d42/lock_8h_source.html#l00602">SCOPED_AO2LOCK</a>, <a class="el" href="../../d1/dc7/threadpool_8c_source.html#l00098">ast_threadpool::shutting_down</a>, <a class="el" href="../../d1/dc7/threadpool_8c_source.html#l00214">thread_worker_pair_alloc()</a>, and <a class="el" href="../../d1/dc7/threadpool_8c_source.html#l00203">thread_worker_pair_free()</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../d1/dc7/threadpool_8c_source.html#l01153">worker_idle()</a>.</p>
<div class="fragment"><div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;{</div><div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d1/d34/structthread__worker__pair.html">thread_worker_pair</a> *<a class="code" href="../../df/de8/structpair.html">pair</a>;</div><div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;   <a class="code" href="../../dd/d42/lock_8h.html#a2cfb325ed371eb6e629446bac4676e9f">SCOPED_AO2LOCK</a>(<a class="code" href="../../df/d44/app__meetme_8c.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>, pool);</div><div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;</div><div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;   <span class="keywordflow">if</span> (pool-&gt;<a class="code" href="../../d5/d10/structast__threadpool.html#a7f68568851b9c7f9291f7bb63f932c18">shutting_down</a>) {</div><div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;      <span class="keywordflow">return</span>;</div><div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;   }</div><div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;</div><div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;   pair = <a class="code" href="../../d1/dc7/threadpool_8c.html#a2d77e9ba6f3133c92f78b076d2561732">thread_worker_pair_alloc</a>(pool, worker);</div><div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;   <span class="keywordflow">if</span> (!pair) {</div><div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;      <span class="keywordflow">return</span>;</div><div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;   }</div><div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;</div><div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d0/d1e/taskprocessor_8h.html#a6b2508ba0a6b8f43ae6d3963f3189585">ast_taskprocessor_push</a>(pool-&gt;<a class="code" href="../../d5/d10/structast__threadpool.html#a566be46267682ab4ec66a8c25b673f8c">control_tps</a>, <a class="code" href="../../d1/dc7/threadpool_8c.html#aa630f726bcc0a7f0a4d36478e829dde1">queued_idle_thread_dead</a>, pair)) {</div><div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;      <a class="code" href="../../d1/dc7/threadpool_8c.html#a0041e0562576aadeec0ce50221ba2396">thread_worker_pair_free</a>(pair);</div><div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;   }</div><div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;}</div><div class="ttc" id="structthread__worker__pair_html"><div class="ttname"><a href="../../d1/d34/structthread__worker__pair.html">thread_worker_pair</a></div><div class="ttdoc">Struct used for queued operations involving worker state changes. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/dc7/threadpool_8c_source.html#l00193">threadpool.c:193</a></div></div>
<div class="ttc" id="structast__threadpool_html_a7f68568851b9c7f9291f7bb63f932c18"><div class="ttname"><a href="../../d5/d10/structast__threadpool.html#a7f68568851b9c7f9291f7bb63f932c18">ast_threadpool::shutting_down</a></div><div class="ttdeci">int shutting_down</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/dc7/threadpool_8c_source.html#l00098">threadpool.c:98</a></div></div>
<div class="ttc" id="app__meetme_8c_html_adf04f66344e3fb0a6f6a69bf39d19902"><div class="ttname"><a href="../../df/d44/app__meetme_8c.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a></div><div class="ttdeci">ast_mutex_t lock</div><div class="ttdef"><b>Definition:</b> <a href="../../df/d44/app__meetme_8c_source.html#l01091">app_meetme.c:1091</a></div></div>
<div class="ttc" id="threadpool_8c_html_aa630f726bcc0a7f0a4d36478e829dde1"><div class="ttname"><a href="../../d1/dc7/threadpool_8c.html#aa630f726bcc0a7f0a4d36478e829dde1">queued_idle_thread_dead</a></div><div class="ttdeci">static int queued_idle_thread_dead(void *data)</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/dc7/threadpool_8c_source.html#l00321">threadpool.c:321</a></div></div>
<div class="ttc" id="threadpool_8c_html_a2d77e9ba6f3133c92f78b076d2561732"><div class="ttname"><a href="../../d1/dc7/threadpool_8c.html#a2d77e9ba6f3133c92f78b076d2561732">thread_worker_pair_alloc</a></div><div class="ttdeci">static struct thread_worker_pair * thread_worker_pair_alloc(struct ast_threadpool *pool, struct worker_thread *worker)</div><div class="ttdoc">Allocate and initialize a thread_worker_pair. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/dc7/threadpool_8c_source.html#l00214">threadpool.c:214</a></div></div>
<div class="ttc" id="lock_8h_html_a2cfb325ed371eb6e629446bac4676e9f"><div class="ttname"><a href="../../dd/d42/lock_8h.html#a2cfb325ed371eb6e629446bac4676e9f">SCOPED_AO2LOCK</a></div><div class="ttdeci">#define SCOPED_AO2LOCK(varname, obj)</div><div class="ttdoc">scoped lock specialization for ao2 mutexes. </div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d42/lock_8h_source.html#l00602">lock.h:602</a></div></div>
<div class="ttc" id="taskprocessor_8h_html_a6b2508ba0a6b8f43ae6d3963f3189585"><div class="ttname"><a href="../../d0/d1e/taskprocessor_8h.html#a6b2508ba0a6b8f43ae6d3963f3189585">ast_taskprocessor_push</a></div><div class="ttdeci">int ast_taskprocessor_push(struct ast_taskprocessor *tps, int(*task_exe)(void *datap), void *datap) attribute_warn_unused_result</div><div class="ttdoc">Push a task into the specified taskprocessor queue and signal the taskprocessor thread. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/deb/taskprocessor_8c_source.html#l01175">taskprocessor.c:1175</a></div></div>
<div class="ttc" id="structpair_html"><div class="ttname"><a href="../../df/de8/structpair.html">pair</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d4f/test__config_8c_source.html#l00084">test_config.c:84</a></div></div>
<div class="ttc" id="threadpool_8c_html_a0041e0562576aadeec0ce50221ba2396"><div class="ttname"><a href="../../d1/dc7/threadpool_8c.html#a0041e0562576aadeec0ce50221ba2396">thread_worker_pair_free</a></div><div class="ttdeci">static void thread_worker_pair_free(struct thread_worker_pair *pair)</div><div class="ttdoc">Destructor for thread_worker_pair. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/dc7/threadpool_8c_source.html#l00203">threadpool.c:203</a></div></div>
<div class="ttc" id="structast__threadpool_html_a566be46267682ab4ec66a8c25b673f8c"><div class="ttname"><a href="../../d5/d10/structast__threadpool.html#a566be46267682ab4ec66a8c25b673f8c">ast_threadpool::control_tps</a></div><div class="ttdeci">struct ast_taskprocessor * control_tps</div><div class="ttdoc">The control taskprocessor. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/dc7/threadpool_8c_source.html#l00096">threadpool.c:96</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a77f79e913191ee36b6d34e86ac6cb1aa"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a77f79e913191ee36b6d34e86ac6cb1aa">&#9670;&nbsp;</a></span>threadpool_send_state_changed()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void threadpool_send_state_changed </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="../../d5/d10/structast__threadpool.html">ast_threadpool</a> *&#160;</td>
          <td class="paramname"><em>pool</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Notify the threadpool listener that the state has changed. </p>
<p>This notifies the threadpool listener via its state_changed callback. </p><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">pool</td><td>The threadpool whose state has changed </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="../../d1/dc7/threadpool_8c_source.html#l00180">180</a> of file <a class="el" href="../../d1/dc7/threadpool_8c_source.html">threadpool.c</a>.</p>

<p class="reference">References <a class="el" href="../../d1/dc7/threadpool_8c_source.html#l00043">ast_threadpool::active_threads</a>, <a class="el" href="../../d7/d22/astobj2__container_8c_source.html#l00034">ao2_container_count()</a>, <a class="el" href="../../d1/dc7/threadpool_8c_source.html#l00112">ast_threadpool_listener::callbacks</a>, <a class="el" href="../../d1/dc7/threadpool_8c_source.html#l00048">ast_threadpool::idle_threads</a>, <a class="el" href="../../d1/dc7/threadpool_8c_source.html#l00038">ast_threadpool::listener</a>, and <a class="el" href="../../d3/d40/threadpool_8h_source.html#l00036">ast_threadpool_listener_callbacks::state_changed</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../d1/dc7/threadpool_8c_source.html#l00235">queued_active_thread_idle()</a>, <a class="el" href="../../d1/dc7/threadpool_8c_source.html#l00321">queued_idle_thread_dead()</a>, <a class="el" href="../../d1/dc7/threadpool_8c_source.html#l00838">queued_set_size()</a>, <a class="el" href="../../d1/dc7/threadpool_8c_source.html#l00564">queued_task_pushed()</a>, and <a class="el" href="../../d1/dc7/threadpool_8c_source.html#l00284">queued_zombie_thread_dead()</a>.</p>
<div class="fragment"><div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;{</div><div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;   <span class="keywordtype">int</span> active_size = <a class="code" href="../../d5/da5/astobj2_8h.html#a512cc40ce96c63b3d5c78040baa4c9cd">ao2_container_count</a>(pool-&gt;<a class="code" href="../../d5/d10/structast__threadpool.html#af151fe496c19e89e750605192e7726c8">active_threads</a>);</div><div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;   <span class="keywordtype">int</span> idle_size = <a class="code" href="../../d5/da5/astobj2_8h.html#a512cc40ce96c63b3d5c78040baa4c9cd">ao2_container_count</a>(pool-&gt;<a class="code" href="../../d5/d10/structast__threadpool.html#a1bad8223d34f52e7e7e11c0c20b20623">idle_threads</a>);</div><div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;</div><div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;   <span class="keywordflow">if</span> (pool-&gt;<a class="code" href="../../d5/d10/structast__threadpool.html#a9a8a970d797bbe611df35df7d8318b1d">listener</a> &amp;&amp; pool-&gt;<a class="code" href="../../d5/d10/structast__threadpool.html#a9a8a970d797bbe611df35df7d8318b1d">listener</a>-&gt;<a class="code" href="../../dd/d12/structast__threadpool__listener.html#ae47947f47eb99da4337ce95cddd1d614">callbacks</a>-&gt;<a class="code" href="../../df/d64/structast__threadpool__listener__callbacks.html#aecba395d949a273a5ebfbda4e2dccc18">state_changed</a>) {</div><div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;      pool-&gt;<a class="code" href="../../d5/d10/structast__threadpool.html#a9a8a970d797bbe611df35df7d8318b1d">listener</a>-&gt;<a class="code" href="../../dd/d12/structast__threadpool__listener.html#ae47947f47eb99da4337ce95cddd1d614">callbacks</a>-&gt;<a class="code" href="../../df/d64/structast__threadpool__listener__callbacks.html#aecba395d949a273a5ebfbda4e2dccc18">state_changed</a>(pool, pool-&gt;<a class="code" href="../../d5/d10/structast__threadpool.html#a9a8a970d797bbe611df35df7d8318b1d">listener</a>, active_size, idle_size);</div><div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;   }</div><div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;}</div><div class="ttc" id="structast__threadpool__listener__callbacks_html_aecba395d949a273a5ebfbda4e2dccc18"><div class="ttname"><a href="../../df/d64/structast__threadpool__listener__callbacks.html#aecba395d949a273a5ebfbda4e2dccc18">ast_threadpool_listener_callbacks::state_changed</a></div><div class="ttdeci">void(* state_changed)(struct ast_threadpool *pool, struct ast_threadpool_listener *listener, int active_threads, int idle_threads)</div><div class="ttdoc">Indicates that the state of threads in the pool has changed. </div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d40/threadpool_8h_source.html#l00036">threadpool.h:36</a></div></div>
<div class="ttc" id="astobj2_8h_html_a512cc40ce96c63b3d5c78040baa4c9cd"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#a512cc40ce96c63b3d5c78040baa4c9cd">ao2_container_count</a></div><div class="ttdeci">int ao2_container_count(struct ao2_container *c)</div><div class="ttdoc">Returns the number of elements in a container. </div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d22/astobj2__container_8c_source.html#l00034">astobj2_container.c:34</a></div></div>
<div class="ttc" id="structast__threadpool_html_a1bad8223d34f52e7e7e11c0c20b20623"><div class="ttname"><a href="../../d5/d10/structast__threadpool.html#a1bad8223d34f52e7e7e11c0c20b20623">ast_threadpool::idle_threads</a></div><div class="ttdeci">struct ao2_container * idle_threads</div><div class="ttdoc">The container of idle threads. Idle threads are those that are currenly waiting to run tasks...</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/dc7/threadpool_8c_source.html#l00048">threadpool.c:48</a></div></div>
<div class="ttc" id="structast__threadpool__listener_html_ae47947f47eb99da4337ce95cddd1d614"><div class="ttname"><a href="../../dd/d12/structast__threadpool__listener.html#ae47947f47eb99da4337ce95cddd1d614">ast_threadpool_listener::callbacks</a></div><div class="ttdeci">const struct ast_threadpool_listener_callbacks * callbacks</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/dc7/threadpool_8c_source.html#l00112">threadpool.c:112</a></div></div>
<div class="ttc" id="structast__threadpool_html_a9a8a970d797bbe611df35df7d8318b1d"><div class="ttname"><a href="../../d5/d10/structast__threadpool.html#a9a8a970d797bbe611df35df7d8318b1d">ast_threadpool::listener</a></div><div class="ttdeci">struct ast_threadpool_listener * listener</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/dc7/threadpool_8c_source.html#l00038">threadpool.c:38</a></div></div>
<div class="ttc" id="structast__threadpool_html_af151fe496c19e89e750605192e7726c8"><div class="ttname"><a href="../../d5/d10/structast__threadpool.html#af151fe496c19e89e750605192e7726c8">ast_threadpool::active_threads</a></div><div class="ttdeci">struct ao2_container * active_threads</div><div class="ttdoc">The container of active threads. Active threads are those that are currently running tasks...</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/dc7/threadpool_8c_source.html#l00043">threadpool.c:43</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a621d8ba52c236882416b1a0962e114fd"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a621d8ba52c236882416b1a0962e114fd">&#9670;&nbsp;</a></span>threadpool_tps_emptied()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void threadpool_tps_emptied </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="../../d7/d52/structast__taskprocessor__listener.html">ast_taskprocessor_listener</a> *&#160;</td>
          <td class="paramname"><em>listener</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Taskprocessor listener emptied callback. </p>
<p>The threadpool queues a task to let the threadpool listener know that the threadpool no longer contains any tasks. </p><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">listener</td><td>The taskprocessor listener. The threadpool is the listener's private data. </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="../../d1/dc7/threadpool_8c_source.html#l00654">654</a> of file <a class="el" href="../../d1/dc7/threadpool_8c_source.html">threadpool.c</a>.</p>

<p class="reference">References <a class="el" href="../../d4/deb/taskprocessor_8c_source.html#l00950">ast_taskprocessor_listener_get_user_data()</a>, <a class="el" href="../../d4/deb/taskprocessor_8c_source.html#l01175">ast_taskprocessor_push()</a>, <a class="el" href="../../d1/dc7/threadpool_8c_source.html#l00112">ast_threadpool_listener::callbacks</a>, <a class="el" href="../../d1/dc7/threadpool_8c_source.html#l00096">ast_threadpool::control_tps</a>, <a class="el" href="../../d3/d40/threadpool_8h_source.html#l00056">ast_threadpool_listener_callbacks::emptied</a>, <a class="el" href="../../d1/dc7/threadpool_8c_source.html#l00038">ast_threadpool::listener</a>, <a class="el" href="../../df/d44/app__meetme_8c_source.html#l01091">lock</a>, <a class="el" href="../../d9/d21/res__rtp__asterisk_8c_source.html#l00236">pool</a>, <a class="el" href="../../d1/dc7/threadpool_8c_source.html#l00638">queued_emptied()</a>, <a class="el" href="../../dd/d42/lock_8h_source.html#l00602">SCOPED_AO2LOCK</a>, and <a class="el" href="../../d1/dc7/threadpool_8c_source.html#l00098">ast_threadpool::shutting_down</a>.</p>
<div class="fragment"><div class="line"><a name="l00655"></a><span class="lineno">  655</span>&#160;{</div><div class="line"><a name="l00656"></a><span class="lineno">  656</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d5/d10/structast__threadpool.html">ast_threadpool</a> *<a class="code" href="../../d9/d21/res__rtp__asterisk_8c.html#a2e57658a5d3ef6c4ef2774c9d5868e7c">pool</a> = <a class="code" href="../../d0/d1e/taskprocessor_8h.html#a6906b13a7a37512e36dd1f5148589481">ast_taskprocessor_listener_get_user_data</a>(listener);</div><div class="line"><a name="l00657"></a><span class="lineno">  657</span>&#160;   <a class="code" href="../../dd/d42/lock_8h.html#a2cfb325ed371eb6e629446bac4676e9f">SCOPED_AO2LOCK</a>(<a class="code" href="../../df/d44/app__meetme_8c.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>, pool);</div><div class="line"><a name="l00658"></a><span class="lineno">  658</span>&#160;</div><div class="line"><a name="l00659"></a><span class="lineno">  659</span>&#160;   <span class="keywordflow">if</span> (pool-&gt;<a class="code" href="../../d5/d10/structast__threadpool.html#a7f68568851b9c7f9291f7bb63f932c18">shutting_down</a>) {</div><div class="line"><a name="l00660"></a><span class="lineno">  660</span>&#160;      <span class="keywordflow">return</span>;</div><div class="line"><a name="l00661"></a><span class="lineno">  661</span>&#160;   }</div><div class="line"><a name="l00662"></a><span class="lineno">  662</span>&#160;</div><div class="line"><a name="l00663"></a><span class="lineno">  663</span>&#160;   <span class="keywordflow">if</span> (pool-&gt;<a class="code" href="../../d5/d10/structast__threadpool.html#a9a8a970d797bbe611df35df7d8318b1d">listener</a> &amp;&amp; pool-&gt;<a class="code" href="../../d5/d10/structast__threadpool.html#a9a8a970d797bbe611df35df7d8318b1d">listener</a>-&gt;<a class="code" href="../../dd/d12/structast__threadpool__listener.html#ae47947f47eb99da4337ce95cddd1d614">callbacks</a>-&gt;<a class="code" href="../../df/d64/structast__threadpool__listener__callbacks.html#aa4d4a34fe6a37c010003e3a3030d23ca">emptied</a>) {</div><div class="line"><a name="l00664"></a><span class="lineno">  664</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="../../d0/d1e/taskprocessor_8h.html#a6b2508ba0a6b8f43ae6d3963f3189585">ast_taskprocessor_push</a>(pool-&gt;<a class="code" href="../../d5/d10/structast__threadpool.html#a566be46267682ab4ec66a8c25b673f8c">control_tps</a>, <a class="code" href="../../d1/dc7/threadpool_8c.html#a21b4589c07fb24d89ea06b419d5bdd1b">queued_emptied</a>, pool)) {</div><div class="line"><a name="l00665"></a><span class="lineno">  665</span>&#160;         <span class="comment">/* Nothing to do here but we need the check to keep the compiler happy. */</span></div><div class="line"><a name="l00666"></a><span class="lineno">  666</span>&#160;      }</div><div class="line"><a name="l00667"></a><span class="lineno">  667</span>&#160;   }</div><div class="line"><a name="l00668"></a><span class="lineno">  668</span>&#160;}</div><div class="ttc" id="res__rtp__asterisk_8c_html_a2e57658a5d3ef6c4ef2774c9d5868e7c"><div class="ttname"><a href="../../d9/d21/res__rtp__asterisk_8c.html#a2e57658a5d3ef6c4ef2774c9d5868e7c">pool</a></div><div class="ttdeci">static pj_pool_t * pool</div><div class="ttdoc">Global memory pool for configuration and timers. </div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d21/res__rtp__asterisk_8c_source.html#l00236">res_rtp_asterisk.c:236</a></div></div>
<div class="ttc" id="structast__threadpool_html_a7f68568851b9c7f9291f7bb63f932c18"><div class="ttname"><a href="../../d5/d10/structast__threadpool.html#a7f68568851b9c7f9291f7bb63f932c18">ast_threadpool::shutting_down</a></div><div class="ttdeci">int shutting_down</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/dc7/threadpool_8c_source.html#l00098">threadpool.c:98</a></div></div>
<div class="ttc" id="structast__threadpool__listener_html_ae47947f47eb99da4337ce95cddd1d614"><div class="ttname"><a href="../../dd/d12/structast__threadpool__listener.html#ae47947f47eb99da4337ce95cddd1d614">ast_threadpool_listener::callbacks</a></div><div class="ttdeci">const struct ast_threadpool_listener_callbacks * callbacks</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/dc7/threadpool_8c_source.html#l00112">threadpool.c:112</a></div></div>
<div class="ttc" id="structast__threadpool__listener__callbacks_html_aa4d4a34fe6a37c010003e3a3030d23ca"><div class="ttname"><a href="../../df/d64/structast__threadpool__listener__callbacks.html#aa4d4a34fe6a37c010003e3a3030d23ca">ast_threadpool_listener_callbacks::emptied</a></div><div class="ttdeci">void(* emptied)(struct ast_threadpool *pool, struct ast_threadpool_listener *listener)</div><div class="ttdoc">Indicates the threadpool&amp;#39;s taskprocessor has become empty. </div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d40/threadpool_8h_source.html#l00056">threadpool.h:56</a></div></div>
<div class="ttc" id="app__meetme_8c_html_adf04f66344e3fb0a6f6a69bf39d19902"><div class="ttname"><a href="../../df/d44/app__meetme_8c.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a></div><div class="ttdeci">ast_mutex_t lock</div><div class="ttdef"><b>Definition:</b> <a href="../../df/d44/app__meetme_8c_source.html#l01091">app_meetme.c:1091</a></div></div>
<div class="ttc" id="structast__threadpool_html_a9a8a970d797bbe611df35df7d8318b1d"><div class="ttname"><a href="../../d5/d10/structast__threadpool.html#a9a8a970d797bbe611df35df7d8318b1d">ast_threadpool::listener</a></div><div class="ttdeci">struct ast_threadpool_listener * listener</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/dc7/threadpool_8c_source.html#l00038">threadpool.c:38</a></div></div>
<div class="ttc" id="threadpool_8c_html_a21b4589c07fb24d89ea06b419d5bdd1b"><div class="ttname"><a href="../../d1/dc7/threadpool_8c.html#a21b4589c07fb24d89ea06b419d5bdd1b">queued_emptied</a></div><div class="ttdeci">static int queued_emptied(void *data)</div><div class="ttdoc">Queued task that handles the case where the threadpool&amp;#39;s taskprocessor is emptied. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/dc7/threadpool_8c_source.html#l00638">threadpool.c:638</a></div></div>
<div class="ttc" id="lock_8h_html_a2cfb325ed371eb6e629446bac4676e9f"><div class="ttname"><a href="../../dd/d42/lock_8h.html#a2cfb325ed371eb6e629446bac4676e9f">SCOPED_AO2LOCK</a></div><div class="ttdeci">#define SCOPED_AO2LOCK(varname, obj)</div><div class="ttdoc">scoped lock specialization for ao2 mutexes. </div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d42/lock_8h_source.html#l00602">lock.h:602</a></div></div>
<div class="ttc" id="taskprocessor_8h_html_a6906b13a7a37512e36dd1f5148589481"><div class="ttname"><a href="../../d0/d1e/taskprocessor_8h.html#a6906b13a7a37512e36dd1f5148589481">ast_taskprocessor_listener_get_user_data</a></div><div class="ttdeci">void * ast_taskprocessor_listener_get_user_data(const struct ast_taskprocessor_listener *listener)</div><div class="ttdoc">Get the user data from the listener. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/deb/taskprocessor_8c_source.html#l00950">taskprocessor.c:950</a></div></div>
<div class="ttc" id="taskprocessor_8h_html_a6b2508ba0a6b8f43ae6d3963f3189585"><div class="ttname"><a href="../../d0/d1e/taskprocessor_8h.html#a6b2508ba0a6b8f43ae6d3963f3189585">ast_taskprocessor_push</a></div><div class="ttdeci">int ast_taskprocessor_push(struct ast_taskprocessor *tps, int(*task_exe)(void *datap), void *datap) attribute_warn_unused_result</div><div class="ttdoc">Push a task into the specified taskprocessor queue and signal the taskprocessor thread. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/deb/taskprocessor_8c_source.html#l01175">taskprocessor.c:1175</a></div></div>
<div class="ttc" id="structast__threadpool_html"><div class="ttname"><a href="../../d5/d10/structast__threadpool.html">ast_threadpool</a></div><div class="ttdoc">An opaque threadpool structure. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/dc7/threadpool_8c_source.html#l00036">threadpool.c:36</a></div></div>
<div class="ttc" id="structast__threadpool_html_a566be46267682ab4ec66a8c25b673f8c"><div class="ttname"><a href="../../d5/d10/structast__threadpool.html#a566be46267682ab4ec66a8c25b673f8c">ast_threadpool::control_tps</a></div><div class="ttdeci">struct ast_taskprocessor * control_tps</div><div class="ttdoc">The control taskprocessor. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/dc7/threadpool_8c_source.html#l00096">threadpool.c:96</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a491cd0ee23f9dc029a50bff296a3dc3e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a491cd0ee23f9dc029a50bff296a3dc3e">&#9670;&nbsp;</a></span>threadpool_tps_shutdown()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void threadpool_tps_shutdown </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="../../d7/d52/structast__taskprocessor__listener.html">ast_taskprocessor_listener</a> *&#160;</td>
          <td class="paramname"><em>listener</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Taskprocessor listener shutdown callback. </p>
<p>The threadpool will shut down and destroy all of its worker threads when this is called back. By the time this gets called, the taskprocessor's control taskprocessor has already been destroyed. Therefore there is no risk in outright destroying the worker threads here. </p><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">listener</td><td>The taskprocessor listener. The threadpool is the listener's private data. </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="../../d1/dc7/threadpool_8c_source.html#l00679">679</a> of file <a class="el" href="../../d1/dc7/threadpool_8c_source.html">threadpool.c</a>.</p>

<p class="reference">References <a class="el" href="../../d1/dc7/threadpool_8c_source.html#l00043">ast_threadpool::active_threads</a>, <a class="el" href="../../d5/da5/astobj2_8h_source.html#l01958">ao2_cleanup</a>, <a class="el" href="../../d4/deb/taskprocessor_8c_source.html#l00950">ast_taskprocessor_listener_get_user_data()</a>, <a class="el" href="../../d1/dc7/threadpool_8c_source.html#l00112">ast_threadpool_listener::callbacks</a>, <a class="el" href="../../d1/dc7/threadpool_8c_source.html#l00048">ast_threadpool::idle_threads</a>, <a class="el" href="../../d1/dc7/threadpool_8c_source.html#l00038">ast_threadpool::listener</a>, <a class="el" href="../../d9/d21/res__rtp__asterisk_8c_source.html#l00236">pool</a>, <a class="el" href="../../d3/d40/threadpool_8h_source.html#l00067">ast_threadpool_listener_callbacks::shutdown</a>, and <a class="el" href="../../d1/dc7/threadpool_8c_source.html#l00053">ast_threadpool::zombie_threads</a>.</p>
<div class="fragment"><div class="line"><a name="l00680"></a><span class="lineno">  680</span>&#160;{</div><div class="line"><a name="l00681"></a><span class="lineno">  681</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d5/d10/structast__threadpool.html">ast_threadpool</a> *<a class="code" href="../../d9/d21/res__rtp__asterisk_8c.html#a2e57658a5d3ef6c4ef2774c9d5868e7c">pool</a> = <a class="code" href="../../d0/d1e/taskprocessor_8h.html#a6906b13a7a37512e36dd1f5148589481">ast_taskprocessor_listener_get_user_data</a>(listener);</div><div class="line"><a name="l00682"></a><span class="lineno">  682</span>&#160;</div><div class="line"><a name="l00683"></a><span class="lineno">  683</span>&#160;   <span class="keywordflow">if</span> (pool-&gt;<a class="code" href="../../d5/d10/structast__threadpool.html#a9a8a970d797bbe611df35df7d8318b1d">listener</a> &amp;&amp; pool-&gt;<a class="code" href="../../d5/d10/structast__threadpool.html#a9a8a970d797bbe611df35df7d8318b1d">listener</a>-&gt;<a class="code" href="../../dd/d12/structast__threadpool__listener.html#ae47947f47eb99da4337ce95cddd1d614">callbacks</a>-&gt;<a class="code" href="../../df/d64/structast__threadpool__listener__callbacks.html#a915fa7dc14f156cce004930b1239eb64">shutdown</a>) {</div><div class="line"><a name="l00684"></a><span class="lineno">  684</span>&#160;      pool-&gt;<a class="code" href="../../d5/d10/structast__threadpool.html#a9a8a970d797bbe611df35df7d8318b1d">listener</a>-&gt;<a class="code" href="../../dd/d12/structast__threadpool__listener.html#ae47947f47eb99da4337ce95cddd1d614">callbacks</a>-&gt;<a class="code" href="../../df/d64/structast__threadpool__listener__callbacks.html#a915fa7dc14f156cce004930b1239eb64">shutdown</a>(pool-&gt;<a class="code" href="../../d5/d10/structast__threadpool.html#a9a8a970d797bbe611df35df7d8318b1d">listener</a>);</div><div class="line"><a name="l00685"></a><span class="lineno">  685</span>&#160;   }</div><div class="line"><a name="l00686"></a><span class="lineno">  686</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#a6321ee982370c55ab3c24c72c562cbdd">ao2_cleanup</a>(pool-&gt;<a class="code" href="../../d5/d10/structast__threadpool.html#af151fe496c19e89e750605192e7726c8">active_threads</a>);</div><div class="line"><a name="l00687"></a><span class="lineno">  687</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#a6321ee982370c55ab3c24c72c562cbdd">ao2_cleanup</a>(pool-&gt;<a class="code" href="../../d5/d10/structast__threadpool.html#a1bad8223d34f52e7e7e11c0c20b20623">idle_threads</a>);</div><div class="line"><a name="l00688"></a><span class="lineno">  688</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#a6321ee982370c55ab3c24c72c562cbdd">ao2_cleanup</a>(pool-&gt;<a class="code" href="../../d5/d10/structast__threadpool.html#a9a66e112220169c037a83525533ec817">zombie_threads</a>);</div><div class="line"><a name="l00689"></a><span class="lineno">  689</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#a6321ee982370c55ab3c24c72c562cbdd">ao2_cleanup</a>(pool);</div><div class="line"><a name="l00690"></a><span class="lineno">  690</span>&#160;}</div><div class="ttc" id="structast__threadpool_html_a1bad8223d34f52e7e7e11c0c20b20623"><div class="ttname"><a href="../../d5/d10/structast__threadpool.html#a1bad8223d34f52e7e7e11c0c20b20623">ast_threadpool::idle_threads</a></div><div class="ttdeci">struct ao2_container * idle_threads</div><div class="ttdoc">The container of idle threads. Idle threads are those that are currenly waiting to run tasks...</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/dc7/threadpool_8c_source.html#l00048">threadpool.c:48</a></div></div>
<div class="ttc" id="res__rtp__asterisk_8c_html_a2e57658a5d3ef6c4ef2774c9d5868e7c"><div class="ttname"><a href="../../d9/d21/res__rtp__asterisk_8c.html#a2e57658a5d3ef6c4ef2774c9d5868e7c">pool</a></div><div class="ttdeci">static pj_pool_t * pool</div><div class="ttdoc">Global memory pool for configuration and timers. </div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d21/res__rtp__asterisk_8c_source.html#l00236">res_rtp_asterisk.c:236</a></div></div>
<div class="ttc" id="structast__threadpool__listener__callbacks_html_a915fa7dc14f156cce004930b1239eb64"><div class="ttname"><a href="../../df/d64/structast__threadpool__listener__callbacks.html#a915fa7dc14f156cce004930b1239eb64">ast_threadpool_listener_callbacks::shutdown</a></div><div class="ttdeci">void(* shutdown)(struct ast_threadpool_listener *listener)</div><div class="ttdoc">The threadpool is shutting down. </div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d40/threadpool_8h_source.html#l00067">threadpool.h:67</a></div></div>
<div class="ttc" id="structast__threadpool__listener_html_ae47947f47eb99da4337ce95cddd1d614"><div class="ttname"><a href="../../dd/d12/structast__threadpool__listener.html#ae47947f47eb99da4337ce95cddd1d614">ast_threadpool_listener::callbacks</a></div><div class="ttdeci">const struct ast_threadpool_listener_callbacks * callbacks</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/dc7/threadpool_8c_source.html#l00112">threadpool.c:112</a></div></div>
<div class="ttc" id="structast__threadpool_html_a9a8a970d797bbe611df35df7d8318b1d"><div class="ttname"><a href="../../d5/d10/structast__threadpool.html#a9a8a970d797bbe611df35df7d8318b1d">ast_threadpool::listener</a></div><div class="ttdeci">struct ast_threadpool_listener * listener</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/dc7/threadpool_8c_source.html#l00038">threadpool.c:38</a></div></div>
<div class="ttc" id="structast__threadpool_html_a9a66e112220169c037a83525533ec817"><div class="ttname"><a href="../../d5/d10/structast__threadpool.html#a9a66e112220169c037a83525533ec817">ast_threadpool::zombie_threads</a></div><div class="ttdeci">struct ao2_container * zombie_threads</div><div class="ttdoc">The container of zombie threads. Zombie threads may be running tasks, but they are scheduled to die s...</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/dc7/threadpool_8c_source.html#l00053">threadpool.c:53</a></div></div>
<div class="ttc" id="taskprocessor_8h_html_a6906b13a7a37512e36dd1f5148589481"><div class="ttname"><a href="../../d0/d1e/taskprocessor_8h.html#a6906b13a7a37512e36dd1f5148589481">ast_taskprocessor_listener_get_user_data</a></div><div class="ttdeci">void * ast_taskprocessor_listener_get_user_data(const struct ast_taskprocessor_listener *listener)</div><div class="ttdoc">Get the user data from the listener. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/deb/taskprocessor_8c_source.html#l00950">taskprocessor.c:950</a></div></div>
<div class="ttc" id="structast__threadpool_html_af151fe496c19e89e750605192e7726c8"><div class="ttname"><a href="../../d5/d10/structast__threadpool.html#af151fe496c19e89e750605192e7726c8">ast_threadpool::active_threads</a></div><div class="ttdeci">struct ao2_container * active_threads</div><div class="ttdoc">The container of active threads. Active threads are those that are currently running tasks...</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/dc7/threadpool_8c_source.html#l00043">threadpool.c:43</a></div></div>
<div class="ttc" id="astobj2_8h_html_a6321ee982370c55ab3c24c72c562cbdd"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#a6321ee982370c55ab3c24c72c562cbdd">ao2_cleanup</a></div><div class="ttdeci">#define ao2_cleanup(obj)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l01958">astobj2.h:1958</a></div></div>
<div class="ttc" id="structast__threadpool_html"><div class="ttname"><a href="../../d5/d10/structast__threadpool.html">ast_threadpool</a></div><div class="ttdoc">An opaque threadpool structure. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/dc7/threadpool_8c_source.html#l00036">threadpool.c:36</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="aa9ae4b147b979a06c8020849efe87512"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa9ae4b147b979a06c8020849efe87512">&#9670;&nbsp;</a></span>threadpool_tps_start()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int threadpool_tps_start </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="../../d7/d52/structast__taskprocessor__listener.html">ast_taskprocessor_listener</a> *&#160;</td>
          <td class="paramname"><em>listener</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="../../d1/dc7/threadpool_8c_source.html#l00444">444</a> of file <a class="el" href="../../d1/dc7/threadpool_8c_source.html">threadpool.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;{</div><div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;   <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;}</div></div><!-- fragment -->
</div>
</div>
<a id="aea5a7903822f85d64689498a69df4700"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aea5a7903822f85d64689498a69df4700">&#9670;&nbsp;</a></span>threadpool_tps_task_pushed()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void threadpool_tps_task_pushed </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="../../d7/d52/structast__taskprocessor__listener.html">ast_taskprocessor_listener</a> *&#160;</td>
          <td class="paramname"><em>listener</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>was_empty</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Taskprocessor listener callback called when a task is added. </p>
<p>The threadpool uses this opportunity to queue a task on its control taskprocessor in order to activate idle threads and notify the threadpool listener that the task has been pushed. </p><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">listener</td><td>The taskprocessor listener. The threadpool is the listener's private data </td></tr>
    <tr><td class="paramname">was_empty</td><td>True if the taskprocessor was empty prior to the task being pushed </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="../../d1/dc7/threadpool_8c_source.html#l00610">610</a> of file <a class="el" href="../../d1/dc7/threadpool_8c_source.html">threadpool.c</a>.</p>

<p class="reference">References <a class="el" href="../../d8/d8a/astmm_8h_source.html#l00182">ast_free</a>, <a class="el" href="../../d4/deb/taskprocessor_8c_source.html#l00950">ast_taskprocessor_listener_get_user_data()</a>, <a class="el" href="../../d4/deb/taskprocessor_8c_source.html#l01175">ast_taskprocessor_push()</a>, <a class="el" href="../../d1/dc7/threadpool_8c_source.html#l00096">ast_threadpool::control_tps</a>, <a class="el" href="../../df/d44/app__meetme_8c_source.html#l01091">lock</a>, <a class="el" href="../../d9/d21/res__rtp__asterisk_8c_source.html#l00236">pool</a>, <a class="el" href="../../d1/dc7/threadpool_8c_source.html#l00564">queued_task_pushed()</a>, <a class="el" href="../../dd/d42/lock_8h_source.html#l00602">SCOPED_AO2LOCK</a>, <a class="el" href="../../d1/dc7/threadpool_8c_source.html#l00098">ast_threadpool::shutting_down</a>, and <a class="el" href="../../d1/dc7/threadpool_8c_source.html#l00466">task_pushed_data_alloc()</a>.</p>
<div class="fragment"><div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;{</div><div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d5/d10/structast__threadpool.html">ast_threadpool</a> *<a class="code" href="../../d9/d21/res__rtp__asterisk_8c.html#a2e57658a5d3ef6c4ef2774c9d5868e7c">pool</a> = <a class="code" href="../../d0/d1e/taskprocessor_8h.html#a6906b13a7a37512e36dd1f5148589481">ast_taskprocessor_listener_get_user_data</a>(listener);</div><div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d8/d82/structtask__pushed__data.html">task_pushed_data</a> *tpd;</div><div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;   <a class="code" href="../../dd/d42/lock_8h.html#a2cfb325ed371eb6e629446bac4676e9f">SCOPED_AO2LOCK</a>(<a class="code" href="../../df/d44/app__meetme_8c.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>, pool);</div><div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;</div><div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160;   <span class="keywordflow">if</span> (pool-&gt;<a class="code" href="../../d5/d10/structast__threadpool.html#a7f68568851b9c7f9291f7bb63f932c18">shutting_down</a>) {</div><div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160;      <span class="keywordflow">return</span>;</div><div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160;   }</div><div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160;</div><div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;   tpd = <a class="code" href="../../d1/dc7/threadpool_8c.html#ae6195901c5f444f8ac661eced96e6168">task_pushed_data_alloc</a>(pool, <a class="code" href="../../d8/d82/structtask__pushed__data.html#a37cdff51e63f885b3a82f34a6673bfbb">was_empty</a>);</div><div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;   <span class="keywordflow">if</span> (!tpd) {</div><div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;      <span class="keywordflow">return</span>;</div><div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;   }</div><div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160;</div><div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d0/d1e/taskprocessor_8h.html#a6b2508ba0a6b8f43ae6d3963f3189585">ast_taskprocessor_push</a>(pool-&gt;<a class="code" href="../../d5/d10/structast__threadpool.html#a566be46267682ab4ec66a8c25b673f8c">control_tps</a>, <a class="code" href="../../d1/dc7/threadpool_8c.html#a179beb37a4570d77547617e37ec3d368">queued_task_pushed</a>, tpd)) {</div><div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160;      <a class="code" href="../../d8/d8a/astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a>(tpd);</div><div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;   }</div><div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160;}</div><div class="ttc" id="threadpool_8c_html_ae6195901c5f444f8ac661eced96e6168"><div class="ttname"><a href="../../d1/dc7/threadpool_8c.html#ae6195901c5f444f8ac661eced96e6168">task_pushed_data_alloc</a></div><div class="ttdeci">static struct task_pushed_data * task_pushed_data_alloc(struct ast_threadpool *pool, int was_empty)</div><div class="ttdoc">Allocate and initialize a task_pushed_data. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/dc7/threadpool_8c_source.html#l00466">threadpool.c:466</a></div></div>
<div class="ttc" id="res__rtp__asterisk_8c_html_a2e57658a5d3ef6c4ef2774c9d5868e7c"><div class="ttname"><a href="../../d9/d21/res__rtp__asterisk_8c.html#a2e57658a5d3ef6c4ef2774c9d5868e7c">pool</a></div><div class="ttdeci">static pj_pool_t * pool</div><div class="ttdoc">Global memory pool for configuration and timers. </div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d21/res__rtp__asterisk_8c_source.html#l00236">res_rtp_asterisk.c:236</a></div></div>
<div class="ttc" id="structast__threadpool_html_a7f68568851b9c7f9291f7bb63f932c18"><div class="ttname"><a href="../../d5/d10/structast__threadpool.html#a7f68568851b9c7f9291f7bb63f932c18">ast_threadpool::shutting_down</a></div><div class="ttdeci">int shutting_down</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/dc7/threadpool_8c_source.html#l00098">threadpool.c:98</a></div></div>
<div class="ttc" id="app__meetme_8c_html_adf04f66344e3fb0a6f6a69bf39d19902"><div class="ttname"><a href="../../df/d44/app__meetme_8c.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a></div><div class="ttdeci">ast_mutex_t lock</div><div class="ttdef"><b>Definition:</b> <a href="../../df/d44/app__meetme_8c_source.html#l01091">app_meetme.c:1091</a></div></div>
<div class="ttc" id="lock_8h_html_a2cfb325ed371eb6e629446bac4676e9f"><div class="ttname"><a href="../../dd/d42/lock_8h.html#a2cfb325ed371eb6e629446bac4676e9f">SCOPED_AO2LOCK</a></div><div class="ttdeci">#define SCOPED_AO2LOCK(varname, obj)</div><div class="ttdoc">scoped lock specialization for ao2 mutexes. </div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d42/lock_8h_source.html#l00602">lock.h:602</a></div></div>
<div class="ttc" id="astmm_8h_html_a402072d6789f6ed9e3a81da27504127e"><div class="ttname"><a href="../../d8/d8a/astmm_8h.html#a402072d6789f6ed9e3a81da27504127e">ast_free</a></div><div class="ttdeci">#define ast_free(a)</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d8a/astmm_8h_source.html#l00182">astmm.h:182</a></div></div>
<div class="ttc" id="taskprocessor_8h_html_a6906b13a7a37512e36dd1f5148589481"><div class="ttname"><a href="../../d0/d1e/taskprocessor_8h.html#a6906b13a7a37512e36dd1f5148589481">ast_taskprocessor_listener_get_user_data</a></div><div class="ttdeci">void * ast_taskprocessor_listener_get_user_data(const struct ast_taskprocessor_listener *listener)</div><div class="ttdoc">Get the user data from the listener. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/deb/taskprocessor_8c_source.html#l00950">taskprocessor.c:950</a></div></div>
<div class="ttc" id="taskprocessor_8h_html_a6b2508ba0a6b8f43ae6d3963f3189585"><div class="ttname"><a href="../../d0/d1e/taskprocessor_8h.html#a6b2508ba0a6b8f43ae6d3963f3189585">ast_taskprocessor_push</a></div><div class="ttdeci">int ast_taskprocessor_push(struct ast_taskprocessor *tps, int(*task_exe)(void *datap), void *datap) attribute_warn_unused_result</div><div class="ttdoc">Push a task into the specified taskprocessor queue and signal the taskprocessor thread. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/deb/taskprocessor_8c_source.html#l01175">taskprocessor.c:1175</a></div></div>
<div class="ttc" id="structast__threadpool_html"><div class="ttname"><a href="../../d5/d10/structast__threadpool.html">ast_threadpool</a></div><div class="ttdoc">An opaque threadpool structure. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/dc7/threadpool_8c_source.html#l00036">threadpool.c:36</a></div></div>
<div class="ttc" id="threadpool_8c_html_a179beb37a4570d77547617e37ec3d368"><div class="ttname"><a href="../../d1/dc7/threadpool_8c.html#a179beb37a4570d77547617e37ec3d368">queued_task_pushed</a></div><div class="ttdeci">static int queued_task_pushed(void *data)</div><div class="ttdoc">Queued task called when tasks are pushed into the threadpool. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/dc7/threadpool_8c_source.html#l00564">threadpool.c:564</a></div></div>
<div class="ttc" id="structtask__pushed__data_html"><div class="ttname"><a href="../../d8/d82/structtask__pushed__data.html">task_pushed_data</a></div><div class="ttdoc">helper used for queued task when tasks are pushed </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/dc7/threadpool_8c_source.html#l00452">threadpool.c:452</a></div></div>
<div class="ttc" id="structtask__pushed__data_html_a37cdff51e63f885b3a82f34a6673bfbb"><div class="ttname"><a href="../../d8/d82/structtask__pushed__data.html#a37cdff51e63f885b3a82f34a6673bfbb">task_pushed_data::was_empty</a></div><div class="ttdeci">int was_empty</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/dc7/threadpool_8c_source.html#l00456">threadpool.c:456</a></div></div>
<div class="ttc" id="structast__threadpool_html_a566be46267682ab4ec66a8c25b673f8c"><div class="ttname"><a href="../../d5/d10/structast__threadpool.html#a566be46267682ab4ec66a8c25b673f8c">ast_threadpool::control_tps</a></div><div class="ttdeci">struct ast_taskprocessor * control_tps</div><div class="ttdoc">The control taskprocessor. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/dc7/threadpool_8c_source.html#l00096">threadpool.c:96</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a9bdb1831968932c47c5321e9079f705d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a9bdb1831968932c47c5321e9079f705d">&#9670;&nbsp;</a></span>threadpool_zombie_thread_dead()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void threadpool_zombie_thread_dead </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="../../d5/d10/structast__threadpool.html">ast_threadpool</a> *&#160;</td>
          <td class="paramname"><em>pool</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="../../dd/d5b/structworker__thread.html">worker_thread</a> *&#160;</td>
          <td class="paramname"><em>worker</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Queue a task to kill a zombie thread. </p>
<p>This is called by a worker thread when it acknowledges that it is time for it to die. </p>

<p class="definition">Definition at line <a class="el" href="../../d1/dc7/threadpool_8c_source.html#l00301">301</a> of file <a class="el" href="../../d1/dc7/threadpool_8c_source.html">threadpool.c</a>.</p>

<p class="reference">References <a class="el" href="../../d4/deb/taskprocessor_8c_source.html#l01175">ast_taskprocessor_push()</a>, <a class="el" href="../../d1/dc7/threadpool_8c_source.html#l00096">ast_threadpool::control_tps</a>, <a class="el" href="../../df/d44/app__meetme_8c_source.html#l01091">lock</a>, <a class="el" href="../../d1/dc7/threadpool_8c_source.html#l00284">queued_zombie_thread_dead()</a>, <a class="el" href="../../dd/d42/lock_8h_source.html#l00602">SCOPED_AO2LOCK</a>, <a class="el" href="../../d1/dc7/threadpool_8c_source.html#l00098">ast_threadpool::shutting_down</a>, <a class="el" href="../../d1/dc7/threadpool_8c_source.html#l00214">thread_worker_pair_alloc()</a>, and <a class="el" href="../../d1/dc7/threadpool_8c_source.html#l00203">thread_worker_pair_free()</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../d1/dc7/threadpool_8c_source.html#l01044">worker_start()</a>.</p>
<div class="fragment"><div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;{</div><div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d1/d34/structthread__worker__pair.html">thread_worker_pair</a> *<a class="code" href="../../df/de8/structpair.html">pair</a>;</div><div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;   <a class="code" href="../../dd/d42/lock_8h.html#a2cfb325ed371eb6e629446bac4676e9f">SCOPED_AO2LOCK</a>(<a class="code" href="../../df/d44/app__meetme_8c.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>, pool);</div><div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;</div><div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;   <span class="keywordflow">if</span> (pool-&gt;<a class="code" href="../../d5/d10/structast__threadpool.html#a7f68568851b9c7f9291f7bb63f932c18">shutting_down</a>) {</div><div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;      <span class="keywordflow">return</span>;</div><div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;   }</div><div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;</div><div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;   pair = <a class="code" href="../../d1/dc7/threadpool_8c.html#a2d77e9ba6f3133c92f78b076d2561732">thread_worker_pair_alloc</a>(pool, worker);</div><div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;   <span class="keywordflow">if</span> (!pair) {</div><div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;      <span class="keywordflow">return</span>;</div><div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;   }</div><div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;</div><div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d0/d1e/taskprocessor_8h.html#a6b2508ba0a6b8f43ae6d3963f3189585">ast_taskprocessor_push</a>(pool-&gt;<a class="code" href="../../d5/d10/structast__threadpool.html#a566be46267682ab4ec66a8c25b673f8c">control_tps</a>, <a class="code" href="../../d1/dc7/threadpool_8c.html#a9943d81da4d867f7c77f8935bdfb2d62">queued_zombie_thread_dead</a>, pair)) {</div><div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;      <a class="code" href="../../d1/dc7/threadpool_8c.html#a0041e0562576aadeec0ce50221ba2396">thread_worker_pair_free</a>(pair);</div><div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;   }</div><div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;}</div><div class="ttc" id="structthread__worker__pair_html"><div class="ttname"><a href="../../d1/d34/structthread__worker__pair.html">thread_worker_pair</a></div><div class="ttdoc">Struct used for queued operations involving worker state changes. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/dc7/threadpool_8c_source.html#l00193">threadpool.c:193</a></div></div>
<div class="ttc" id="structast__threadpool_html_a7f68568851b9c7f9291f7bb63f932c18"><div class="ttname"><a href="../../d5/d10/structast__threadpool.html#a7f68568851b9c7f9291f7bb63f932c18">ast_threadpool::shutting_down</a></div><div class="ttdeci">int shutting_down</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/dc7/threadpool_8c_source.html#l00098">threadpool.c:98</a></div></div>
<div class="ttc" id="app__meetme_8c_html_adf04f66344e3fb0a6f6a69bf39d19902"><div class="ttname"><a href="../../df/d44/app__meetme_8c.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a></div><div class="ttdeci">ast_mutex_t lock</div><div class="ttdef"><b>Definition:</b> <a href="../../df/d44/app__meetme_8c_source.html#l01091">app_meetme.c:1091</a></div></div>
<div class="ttc" id="threadpool_8c_html_a2d77e9ba6f3133c92f78b076d2561732"><div class="ttname"><a href="../../d1/dc7/threadpool_8c.html#a2d77e9ba6f3133c92f78b076d2561732">thread_worker_pair_alloc</a></div><div class="ttdeci">static struct thread_worker_pair * thread_worker_pair_alloc(struct ast_threadpool *pool, struct worker_thread *worker)</div><div class="ttdoc">Allocate and initialize a thread_worker_pair. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/dc7/threadpool_8c_source.html#l00214">threadpool.c:214</a></div></div>
<div class="ttc" id="lock_8h_html_a2cfb325ed371eb6e629446bac4676e9f"><div class="ttname"><a href="../../dd/d42/lock_8h.html#a2cfb325ed371eb6e629446bac4676e9f">SCOPED_AO2LOCK</a></div><div class="ttdeci">#define SCOPED_AO2LOCK(varname, obj)</div><div class="ttdoc">scoped lock specialization for ao2 mutexes. </div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d42/lock_8h_source.html#l00602">lock.h:602</a></div></div>
<div class="ttc" id="taskprocessor_8h_html_a6b2508ba0a6b8f43ae6d3963f3189585"><div class="ttname"><a href="../../d0/d1e/taskprocessor_8h.html#a6b2508ba0a6b8f43ae6d3963f3189585">ast_taskprocessor_push</a></div><div class="ttdeci">int ast_taskprocessor_push(struct ast_taskprocessor *tps, int(*task_exe)(void *datap), void *datap) attribute_warn_unused_result</div><div class="ttdoc">Push a task into the specified taskprocessor queue and signal the taskprocessor thread. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/deb/taskprocessor_8c_source.html#l01175">taskprocessor.c:1175</a></div></div>
<div class="ttc" id="structpair_html"><div class="ttname"><a href="../../df/de8/structpair.html">pair</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d4f/test__config_8c_source.html#l00084">test_config.c:84</a></div></div>
<div class="ttc" id="threadpool_8c_html_a9943d81da4d867f7c77f8935bdfb2d62"><div class="ttname"><a href="../../d1/dc7/threadpool_8c.html#a9943d81da4d867f7c77f8935bdfb2d62">queued_zombie_thread_dead</a></div><div class="ttdeci">static int queued_zombie_thread_dead(void *data)</div><div class="ttdoc">Kill a zombie thread. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/dc7/threadpool_8c_source.html#l00284">threadpool.c:284</a></div></div>
<div class="ttc" id="threadpool_8c_html_a0041e0562576aadeec0ce50221ba2396"><div class="ttname"><a href="../../d1/dc7/threadpool_8c.html#a0041e0562576aadeec0ce50221ba2396">thread_worker_pair_free</a></div><div class="ttdeci">static void thread_worker_pair_free(struct thread_worker_pair *pair)</div><div class="ttdoc">Destructor for thread_worker_pair. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/dc7/threadpool_8c_source.html#l00203">threadpool.c:203</a></div></div>
<div class="ttc" id="structast__threadpool_html_a566be46267682ab4ec66a8c25b673f8c"><div class="ttname"><a href="../../d5/d10/structast__threadpool.html#a566be46267682ab4ec66a8c25b673f8c">ast_threadpool::control_tps</a></div><div class="ttdeci">struct ast_taskprocessor * control_tps</div><div class="ttdoc">The control taskprocessor. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/dc7/threadpool_8c_source.html#l00096">threadpool.c:96</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a0aca7fd49b04646cdd284d4daad538c4"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0aca7fd49b04646cdd284d4daad538c4">&#9670;&nbsp;</a></span>worker_active()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void worker_active </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="../../dd/d5b/structworker__thread.html">worker_thread</a> *&#160;</td>
          <td class="paramname"><em>worker</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Active loop for worker threads. </p>
<p>The worker will stay in this loop for its lifetime, executing tasks as they become available. If there are no tasks currently available, then the thread will go idle.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">worker</td><td>The worker thread executing tasks. </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="../../d1/dc7/threadpool_8c_source.html#l01124">1124</a> of file <a class="el" href="../../d1/dc7/threadpool_8c_source.html">threadpool.c</a>.</p>

<p class="reference">References <a class="el" href="../../d1/dc7/threadpool_8c_source.html#l00153">worker_thread::pool</a>, and <a class="el" href="../../d1/dc7/threadpool_8c_source.html#l00362">threadpool_execute()</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../d1/dc7/threadpool_8c_source.html#l01044">worker_start()</a>.</p>
<div class="fragment"><div class="line"><a name="l01125"></a><span class="lineno"> 1125</span>&#160;{</div><div class="line"><a name="l01126"></a><span class="lineno"> 1126</span>&#160;   <span class="keywordtype">int</span> alive;</div><div class="line"><a name="l01127"></a><span class="lineno"> 1127</span>&#160;</div><div class="line"><a name="l01128"></a><span class="lineno"> 1128</span>&#160;   <span class="comment">/* The following is equivalent to</span></div><div class="line"><a name="l01129"></a><span class="lineno"> 1129</span>&#160;<span class="comment">    *</span></div><div class="line"><a name="l01130"></a><span class="lineno"> 1130</span>&#160;<span class="comment">    * while (threadpool_execute(worker-&gt;pool));</span></div><div class="line"><a name="l01131"></a><span class="lineno"> 1131</span>&#160;<span class="comment">    *</span></div><div class="line"><a name="l01132"></a><span class="lineno"> 1132</span>&#160;<span class="comment">    * However, reviewers have suggested in the past</span></div><div class="line"><a name="l01133"></a><span class="lineno"> 1133</span>&#160;<span class="comment">    * doing that can cause optimizers to (wrongly)</span></div><div class="line"><a name="l01134"></a><span class="lineno"> 1134</span>&#160;<span class="comment">    * optimize the code away.</span></div><div class="line"><a name="l01135"></a><span class="lineno"> 1135</span>&#160;<span class="comment">    */</span></div><div class="line"><a name="l01136"></a><span class="lineno"> 1136</span>&#160;   <span class="keywordflow">do</span> {</div><div class="line"><a name="l01137"></a><span class="lineno"> 1137</span>&#160;      alive = <a class="code" href="../../d1/dc7/threadpool_8c.html#a6eab2cb427a73f76279f15c10182f1ed">threadpool_execute</a>(worker-&gt;<a class="code" href="../../dd/d5b/structworker__thread.html#ac8c18315f6d4a45480dea634294e683f">pool</a>);</div><div class="line"><a name="l01138"></a><span class="lineno"> 1138</span>&#160;   } <span class="keywordflow">while</span> (alive);</div><div class="line"><a name="l01139"></a><span class="lineno"> 1139</span>&#160;}</div><div class="ttc" id="structworker__thread_html_ac8c18315f6d4a45480dea634294e683f"><div class="ttname"><a href="../../dd/d5b/structworker__thread.html#ac8c18315f6d4a45480dea634294e683f">worker_thread::pool</a></div><div class="ttdeci">struct ast_threadpool * pool</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/dc7/threadpool_8c_source.html#l00153">threadpool.c:153</a></div></div>
<div class="ttc" id="threadpool_8c_html_a6eab2cb427a73f76279f15c10182f1ed"><div class="ttname"><a href="../../d1/dc7/threadpool_8c.html#a6eab2cb427a73f76279f15c10182f1ed">threadpool_execute</a></div><div class="ttdeci">static int threadpool_execute(struct ast_threadpool *pool)</div><div class="ttdoc">Execute a task in the threadpool. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/dc7/threadpool_8c_source.html#l00362">threadpool.c:362</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a569b7d8ff03ca80e7b6a852769d15c61"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a569b7d8ff03ca80e7b6a852769d15c61">&#9670;&nbsp;</a></span>worker_idle()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int worker_idle </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="../../dd/d5b/structworker__thread.html">worker_thread</a> *&#160;</td>
          <td class="paramname"><em>worker</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Idle function for worker threads. </p>
<p>The worker waits here until it gets told by the threadpool to wake up.</p>
<p>worker is locked before entering this function.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">worker</td><td>The idle worker </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">0</td><td>The thread is being woken up so that it can conclude. </td></tr>
    <tr><td class="paramname">non-zero</td><td>The thread is being woken up to do more work. </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="../../d1/dc7/threadpool_8c_source.html#l01153">1153</a> of file <a class="el" href="../../d1/dc7/threadpool_8c_source.html">threadpool.c</a>.</p>

<p class="reference">References <a class="el" href="../../d1/dc7/threadpool_8c_source.html#l00122">ALIVE</a>, <a class="el" href="../../dd/d42/lock_8h_source.html#l00204">ast_cond_timedwait</a>, <a class="el" href="../../dd/d42/lock_8h_source.html#l00203">ast_cond_wait</a>, <a class="el" href="../../d1/d8c/logger_8h_source.html#l00452">ast_debug</a>, <a class="el" href="../../de/df7/time_8h_source.html#l00150">ast_tvnow()</a>, <a class="el" href="../../d1/dc7/threadpool_8c_source.html#l00147">worker_thread::cond</a>, <a class="el" href="../../d1/dc7/threadpool_8c_source.html#l00137">DEAD</a>, <a class="el" href="../../d3/d40/threadpool_8h_source.html#l00079">ast_threadpool_options::idle_timeout</a>, <a class="el" href="../../d1/dc7/threadpool_8c_source.html#l00149">worker_thread::lock</a>, <a class="el" href="../../d1/dc7/threadpool_8c_source.html#l00159">worker_thread::options</a>, <a class="el" href="../../d1/dc7/threadpool_8c_source.html#l00153">worker_thread::pool</a>, <a class="el" href="../../d1/dc7/threadpool_8c_source.html#l00155">worker_thread::state</a>, <a class="el" href="../../d1/dc7/threadpool_8c_source.html#l00332">threadpool_idle_thread_dead()</a>, and <a class="el" href="../../d1/dc7/threadpool_8c_source.html#l00157">worker_thread::wake_up</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../d1/dc7/threadpool_8c_source.html#l01044">worker_start()</a>.</p>
<div class="fragment"><div class="line"><a name="l01154"></a><span class="lineno"> 1154</span>&#160;{</div><div class="line"><a name="l01155"></a><span class="lineno"> 1155</span>&#160;   <span class="keyword">struct </span>timeval start = <a class="code" href="../../de/df7/time_8h.html#ad3899efb6f0e348556ef69f5b16aa7f7">ast_tvnow</a>();</div><div class="line"><a name="l01156"></a><span class="lineno"> 1156</span>&#160;   <span class="keyword">struct </span>timespec <a class="code" href="../../dd/d7c/eagi__proxy_8c.html#a8fd806ad19b8f5513a4cf18cbf77532c">end</a> = {</div><div class="line"><a name="l01157"></a><span class="lineno"> 1157</span>&#160;      .tv_sec = start.tv_sec + worker-&gt;<a class="code" href="../../dd/d5b/structworker__thread.html#a83b47841343f8af6b4ab20abe3c2ab24">options</a>.<a class="code" href="../../de/de6/structast__threadpool__options.html#a55f8da70e65091a4533dae72885d0227">idle_timeout</a>,</div><div class="line"><a name="l01158"></a><span class="lineno"> 1158</span>&#160;      .tv_nsec = start.tv_usec * 1000,</div><div class="line"><a name="l01159"></a><span class="lineno"> 1159</span>&#160;   };</div><div class="line"><a name="l01160"></a><span class="lineno"> 1160</span>&#160;   <span class="keywordflow">while</span> (!worker-&gt;<a class="code" href="../../dd/d5b/structworker__thread.html#a15784ac51a91fd0e5890a55be4c6d520">wake_up</a>) {</div><div class="line"><a name="l01161"></a><span class="lineno"> 1161</span>&#160;      <span class="keywordflow">if</span> (worker-&gt;<a class="code" href="../../dd/d5b/structworker__thread.html#a83b47841343f8af6b4ab20abe3c2ab24">options</a>.<a class="code" href="../../de/de6/structast__threadpool__options.html#a55f8da70e65091a4533dae72885d0227">idle_timeout</a> &lt;= 0) {</div><div class="line"><a name="l01162"></a><span class="lineno"> 1162</span>&#160;         <a class="code" href="../../dd/d42/lock_8h.html#a36233c5520173c095bf732a788356aee">ast_cond_wait</a>(&amp;worker-&gt;<a class="code" href="../../dd/d5b/structworker__thread.html#a1c7181c39f99ee801943a0d0aa9872b9">cond</a>, &amp;worker-&gt;<a class="code" href="../../dd/d5b/structworker__thread.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);</div><div class="line"><a name="l01163"></a><span class="lineno"> 1163</span>&#160;      } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="../../dd/d42/lock_8h.html#a6add1f30b2d53ca9384b15529a6f126e">ast_cond_timedwait</a>(&amp;worker-&gt;<a class="code" href="../../dd/d5b/structworker__thread.html#a1c7181c39f99ee801943a0d0aa9872b9">cond</a>, &amp;worker-&gt;<a class="code" href="../../dd/d5b/structworker__thread.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>, &amp;end) == ETIMEDOUT) {</div><div class="line"><a name="l01164"></a><span class="lineno"> 1164</span>&#160;         <span class="keywordflow">break</span>;</div><div class="line"><a name="l01165"></a><span class="lineno"> 1165</span>&#160;      }</div><div class="line"><a name="l01166"></a><span class="lineno"> 1166</span>&#160;   }</div><div class="line"><a name="l01167"></a><span class="lineno"> 1167</span>&#160;</div><div class="line"><a name="l01168"></a><span class="lineno"> 1168</span>&#160;   <span class="keywordflow">if</span> (!worker-&gt;<a class="code" href="../../dd/d5b/structworker__thread.html#a15784ac51a91fd0e5890a55be4c6d520">wake_up</a>) {</div><div class="line"><a name="l01169"></a><span class="lineno"> 1169</span>&#160;      <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(1, <span class="stringliteral">&quot;Worker thread idle timeout reached. Dying.\n&quot;</span>);</div><div class="line"><a name="l01170"></a><span class="lineno"> 1170</span>&#160;      <a class="code" href="../../d1/dc7/threadpool_8c.html#ab74dbf0b6c8d543d3b115afd691cddd6">threadpool_idle_thread_dead</a>(worker-&gt;<a class="code" href="../../dd/d5b/structworker__thread.html#ac8c18315f6d4a45480dea634294e683f">pool</a>, worker);</div><div class="line"><a name="l01171"></a><span class="lineno"> 1171</span>&#160;      worker-&gt;<a class="code" href="../../dd/d5b/structworker__thread.html#aabcac0fa632a75a6a2a2bd05db5e802f">state</a> = <a class="code" href="../../d1/dc7/threadpool_8c.html#a74d6a8e9b05f036ec5b86d00abaffea6a11fd9ca455f92c69c084484d5cd803c2">DEAD</a>;</div><div class="line"><a name="l01172"></a><span class="lineno"> 1172</span>&#160;   }</div><div class="line"><a name="l01173"></a><span class="lineno"> 1173</span>&#160;   worker-&gt;<a class="code" href="../../dd/d5b/structworker__thread.html#a15784ac51a91fd0e5890a55be4c6d520">wake_up</a> = 0;</div><div class="line"><a name="l01174"></a><span class="lineno"> 1174</span>&#160;   <span class="keywordflow">return</span> worker-&gt;<a class="code" href="../../dd/d5b/structworker__thread.html#aabcac0fa632a75a6a2a2bd05db5e802f">state</a> == <a class="code" href="../../d1/dc7/threadpool_8c.html#a74d6a8e9b05f036ec5b86d00abaffea6a4f34c5c191d6e0d028ca831b6c0b1571">ALIVE</a>;</div><div class="line"><a name="l01175"></a><span class="lineno"> 1175</span>&#160;}</div><div class="ttc" id="structworker__thread_html_a15784ac51a91fd0e5890a55be4c6d520"><div class="ttname"><a href="../../dd/d5b/structworker__thread.html#a15784ac51a91fd0e5890a55be4c6d520">worker_thread::wake_up</a></div><div class="ttdeci">int wake_up</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/dc7/threadpool_8c_source.html#l00157">threadpool.c:157</a></div></div>
<div class="ttc" id="structworker__thread_html_a83b47841343f8af6b4ab20abe3c2ab24"><div class="ttname"><a href="../../dd/d5b/structworker__thread.html#a83b47841343f8af6b4ab20abe3c2ab24">worker_thread::options</a></div><div class="ttdeci">struct ast_threadpool_options options</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/dc7/threadpool_8c_source.html#l00159">threadpool.c:159</a></div></div>
<div class="ttc" id="structast__threadpool__options_html_a55f8da70e65091a4533dae72885d0227"><div class="ttname"><a href="../../de/de6/structast__threadpool__options.html#a55f8da70e65091a4533dae72885d0227">ast_threadpool_options::idle_timeout</a></div><div class="ttdeci">int idle_timeout</div><div class="ttdoc">Time limit in seconds for idle threads. </div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d40/threadpool_8h_source.html#l00079">threadpool.h:79</a></div></div>
<div class="ttc" id="structworker__thread_html_adf04f66344e3fb0a6f6a69bf39d19902"><div class="ttname"><a href="../../dd/d5b/structworker__thread.html#adf04f66344e3fb0a6f6a69bf39d19902">worker_thread::lock</a></div><div class="ttdeci">ast_mutex_t lock</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/dc7/threadpool_8c_source.html#l00149">threadpool.c:149</a></div></div>
<div class="ttc" id="lock_8h_html_a36233c5520173c095bf732a788356aee"><div class="ttname"><a href="../../dd/d42/lock_8h.html#a36233c5520173c095bf732a788356aee">ast_cond_wait</a></div><div class="ttdeci">#define ast_cond_wait(cond, mutex)</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d42/lock_8h_source.html#l00203">lock.h:203</a></div></div>
<div class="ttc" id="threadpool_8c_html_ab74dbf0b6c8d543d3b115afd691cddd6"><div class="ttname"><a href="../../d1/dc7/threadpool_8c.html#ab74dbf0b6c8d543d3b115afd691cddd6">threadpool_idle_thread_dead</a></div><div class="ttdeci">static void threadpool_idle_thread_dead(struct ast_threadpool *pool, struct worker_thread *worker)</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/dc7/threadpool_8c_source.html#l00332">threadpool.c:332</a></div></div>
<div class="ttc" id="time_8h_html_ad3899efb6f0e348556ef69f5b16aa7f7"><div class="ttname"><a href="../../de/df7/time_8h.html#ad3899efb6f0e348556ef69f5b16aa7f7">ast_tvnow</a></div><div class="ttdeci">struct timeval ast_tvnow(void)</div><div class="ttdoc">Returns current timeval. Meant to replace calls to gettimeofday(). </div><div class="ttdef"><b>Definition:</b> <a href="../../de/df7/time_8h_source.html#l00150">time.h:150</a></div></div>
<div class="ttc" id="eagi__proxy_8c_html_a8fd806ad19b8f5513a4cf18cbf77532c"><div class="ttname"><a href="../../dd/d7c/eagi__proxy_8c.html#a8fd806ad19b8f5513a4cf18cbf77532c">end</a></div><div class="ttdeci">char * end</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d7c/eagi__proxy_8c_source.html#l00073">eagi_proxy.c:73</a></div></div>
<div class="ttc" id="structworker__thread_html_aabcac0fa632a75a6a2a2bd05db5e802f"><div class="ttname"><a href="../../dd/d5b/structworker__thread.html#aabcac0fa632a75a6a2a2bd05db5e802f">worker_thread::state</a></div><div class="ttdeci">enum worker_state state</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/dc7/threadpool_8c_source.html#l00155">threadpool.c:155</a></div></div>
<div class="ttc" id="logger_8h_html_a3f248112c8d6ce7e3959aa723dade648"><div class="ttname"><a href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a></div><div class="ttdeci">#define ast_debug(level,...)</div><div class="ttdoc">Log a DEBUG message. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d8c/logger_8h_source.html#l00452">logger.h:452</a></div></div>
<div class="ttc" id="structworker__thread_html_ac8c18315f6d4a45480dea634294e683f"><div class="ttname"><a href="../../dd/d5b/structworker__thread.html#ac8c18315f6d4a45480dea634294e683f">worker_thread::pool</a></div><div class="ttdeci">struct ast_threadpool * pool</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/dc7/threadpool_8c_source.html#l00153">threadpool.c:153</a></div></div>
<div class="ttc" id="threadpool_8c_html_a74d6a8e9b05f036ec5b86d00abaffea6a11fd9ca455f92c69c084484d5cd803c2"><div class="ttname"><a href="../../d1/dc7/threadpool_8c.html#a74d6a8e9b05f036ec5b86d00abaffea6a11fd9ca455f92c69c084484d5cd803c2">DEAD</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d1/dc7/threadpool_8c_source.html#l00137">threadpool.c:137</a></div></div>
<div class="ttc" id="lock_8h_html_a6add1f30b2d53ca9384b15529a6f126e"><div class="ttname"><a href="../../dd/d42/lock_8h.html#a6add1f30b2d53ca9384b15529a6f126e">ast_cond_timedwait</a></div><div class="ttdeci">#define ast_cond_timedwait(cond, mutex, time)</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d42/lock_8h_source.html#l00204">lock.h:204</a></div></div>
<div class="ttc" id="structworker__thread_html_a1c7181c39f99ee801943a0d0aa9872b9"><div class="ttname"><a href="../../dd/d5b/structworker__thread.html#a1c7181c39f99ee801943a0d0aa9872b9">worker_thread::cond</a></div><div class="ttdeci">ast_cond_t cond</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/dc7/threadpool_8c_source.html#l00147">threadpool.c:147</a></div></div>
<div class="ttc" id="threadpool_8c_html_a74d6a8e9b05f036ec5b86d00abaffea6a4f34c5c191d6e0d028ca831b6c0b1571"><div class="ttname"><a href="../../d1/dc7/threadpool_8c.html#a74d6a8e9b05f036ec5b86d00abaffea6a4f34c5c191d6e0d028ca831b6c0b1571">ALIVE</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d1/dc7/threadpool_8c_source.html#l00122">threadpool.c:122</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a5513b88136117cc6c4c7d146c226bf86"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a5513b88136117cc6c4c7d146c226bf86">&#9670;&nbsp;</a></span>worker_set_state()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int worker_set_state </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="../../dd/d5b/structworker__thread.html">worker_thread</a> *&#160;</td>
          <td class="paramname"><em>worker</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">enum <a class="el" href="../../d1/dc7/threadpool_8c.html#a74d6a8e9b05f036ec5b86d00abaffea6">worker_state</a>&#160;</td>
          <td class="paramname"><em>state</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Change a worker's state. </p>
<p>The threadpool calls into this function in order to let a worker know how it should proceed.</p>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">-1</td><td>failure (state transition not permitted) </td></tr>
    <tr><td class="paramname">0</td><td>success </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="../../d1/dc7/threadpool_8c_source.html#l01186">1186</a> of file <a class="el" href="../../d1/dc7/threadpool_8c_source.html">threadpool.c</a>.</p>

<p class="reference">References <a class="el" href="../../d1/dc7/threadpool_8c_source.html#l00122">ALIVE</a>, <a class="el" href="../../d5/d60/utils_8h_source.html#l00695">ast_assert</a>, <a class="el" href="../../dd/d42/lock_8h_source.html#l00201">ast_cond_signal</a>, <a class="el" href="../../d1/dc7/threadpool_8c_source.html#l00147">worker_thread::cond</a>, <a class="el" href="../../d1/dc7/threadpool_8c_source.html#l00137">DEAD</a>, <a class="el" href="../../d1/dc7/threadpool_8c_source.html#l00149">worker_thread::lock</a>, <a class="el" href="../../df/d44/app__meetme_8c_source.html#l01091">lock</a>, <a class="el" href="../../dd/d42/lock_8h_source.html#l00587">SCOPED_MUTEX</a>, <a class="el" href="../../d1/dc7/threadpool_8c_source.html#l00155">worker_thread::state</a>, <a class="el" href="../../d5/dfe/chan__sip_8c_source.html#l00959">state</a>, <a class="el" href="../../d1/dc7/threadpool_8c_source.html#l00157">worker_thread::wake_up</a>, and <a class="el" href="../../d1/dc7/threadpool_8c_source.html#l00130">ZOMBIE</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../d1/dc7/threadpool_8c_source.html#l00491">activate_thread()</a>, <a class="el" href="../../d1/dc7/threadpool_8c_source.html#l01009">worker_shutdown()</a>, and <a class="el" href="../../d1/dc7/threadpool_8c_source.html#l00745">zombify_threads()</a>.</p>
<div class="fragment"><div class="line"><a name="l01187"></a><span class="lineno"> 1187</span>&#160;{</div><div class="line"><a name="l01188"></a><span class="lineno"> 1188</span>&#160;   <a class="code" href="../../dd/d42/lock_8h.html#ab13590ad27fac3b9c7c7b792c603c9b3">SCOPED_MUTEX</a>(<a class="code" href="../../df/d44/app__meetme_8c.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>, &amp;worker-&gt;<a class="code" href="../../dd/d5b/structworker__thread.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);</div><div class="line"><a name="l01189"></a><span class="lineno"> 1189</span>&#160;</div><div class="line"><a name="l01190"></a><span class="lineno"> 1190</span>&#160;   <span class="keywordflow">switch</span> (<a class="code" href="../../d4/d88/structstate.html">state</a>) {</div><div class="line"><a name="l01191"></a><span class="lineno"> 1191</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="../../d1/dc7/threadpool_8c.html#a74d6a8e9b05f036ec5b86d00abaffea6a4f34c5c191d6e0d028ca831b6c0b1571">ALIVE</a>:</div><div class="line"><a name="l01192"></a><span class="lineno"> 1192</span>&#160;      <span class="comment">/* This can occur due to a race condition between being told to go active</span></div><div class="line"><a name="l01193"></a><span class="lineno"> 1193</span>&#160;<span class="comment">       * and an idle timeout happening.</span></div><div class="line"><a name="l01194"></a><span class="lineno"> 1194</span>&#160;<span class="comment">       */</span></div><div class="line"><a name="l01195"></a><span class="lineno"> 1195</span>&#160;      <span class="keywordflow">if</span> (worker-&gt;<a class="code" href="../../dd/d5b/structworker__thread.html#aabcac0fa632a75a6a2a2bd05db5e802f">state</a> == <a class="code" href="../../d1/dc7/threadpool_8c.html#a74d6a8e9b05f036ec5b86d00abaffea6a11fd9ca455f92c69c084484d5cd803c2">DEAD</a>) {</div><div class="line"><a name="l01196"></a><span class="lineno"> 1196</span>&#160;         <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l01197"></a><span class="lineno"> 1197</span>&#160;      }</div><div class="line"><a name="l01198"></a><span class="lineno"> 1198</span>&#160;      <a class="code" href="../../d5/d60/utils_8h.html#a24374da24af1931d8a7ccde5b352bb2c">ast_assert</a>(worker-&gt;<a class="code" href="../../dd/d5b/structworker__thread.html#aabcac0fa632a75a6a2a2bd05db5e802f">state</a> != <a class="code" href="../../d1/dc7/threadpool_8c.html#a74d6a8e9b05f036ec5b86d00abaffea6a5dfb36109b24f39d54d5c3f48f53def8">ZOMBIE</a>);</div><div class="line"><a name="l01199"></a><span class="lineno"> 1199</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l01200"></a><span class="lineno"> 1200</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="../../d1/dc7/threadpool_8c.html#a74d6a8e9b05f036ec5b86d00abaffea6a11fd9ca455f92c69c084484d5cd803c2">DEAD</a>:</div><div class="line"><a name="l01201"></a><span class="lineno"> 1201</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l01202"></a><span class="lineno"> 1202</span>&#160;   <span class="keywordflow">case</span> <a class="code" href="../../d1/dc7/threadpool_8c.html#a74d6a8e9b05f036ec5b86d00abaffea6a5dfb36109b24f39d54d5c3f48f53def8">ZOMBIE</a>:</div><div class="line"><a name="l01203"></a><span class="lineno"> 1203</span>&#160;      <a class="code" href="../../d5/d60/utils_8h.html#a24374da24af1931d8a7ccde5b352bb2c">ast_assert</a>(worker-&gt;<a class="code" href="../../dd/d5b/structworker__thread.html#aabcac0fa632a75a6a2a2bd05db5e802f">state</a> != <a class="code" href="../../d1/dc7/threadpool_8c.html#a74d6a8e9b05f036ec5b86d00abaffea6a11fd9ca455f92c69c084484d5cd803c2">DEAD</a>);</div><div class="line"><a name="l01204"></a><span class="lineno"> 1204</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l01205"></a><span class="lineno"> 1205</span>&#160;   }</div><div class="line"><a name="l01206"></a><span class="lineno"> 1206</span>&#160;</div><div class="line"><a name="l01207"></a><span class="lineno"> 1207</span>&#160;   worker-&gt;<a class="code" href="../../dd/d5b/structworker__thread.html#aabcac0fa632a75a6a2a2bd05db5e802f">state</a> = <a class="code" href="../../d5/dfe/chan__sip_8c.html#a14a9662e09deed264497073732fb014a">state</a>;</div><div class="line"><a name="l01208"></a><span class="lineno"> 1208</span>&#160;   worker-&gt;<a class="code" href="../../dd/d5b/structworker__thread.html#a15784ac51a91fd0e5890a55be4c6d520">wake_up</a> = 1;</div><div class="line"><a name="l01209"></a><span class="lineno"> 1209</span>&#160;   <a class="code" href="../../dd/d42/lock_8h.html#ae2cdf274a5da241c3ad7324d82bf6af0">ast_cond_signal</a>(&amp;worker-&gt;<a class="code" href="../../dd/d5b/structworker__thread.html#a1c7181c39f99ee801943a0d0aa9872b9">cond</a>);</div><div class="line"><a name="l01210"></a><span class="lineno"> 1210</span>&#160;</div><div class="line"><a name="l01211"></a><span class="lineno"> 1211</span>&#160;   <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l01212"></a><span class="lineno"> 1212</span>&#160;}</div><div class="ttc" id="structworker__thread_html_a15784ac51a91fd0e5890a55be4c6d520"><div class="ttname"><a href="../../dd/d5b/structworker__thread.html#a15784ac51a91fd0e5890a55be4c6d520">worker_thread::wake_up</a></div><div class="ttdeci">int wake_up</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/dc7/threadpool_8c_source.html#l00157">threadpool.c:157</a></div></div>
<div class="ttc" id="chan__sip_8c_html_a14a9662e09deed264497073732fb014a"><div class="ttname"><a href="../../d5/dfe/chan__sip_8c.html#a14a9662e09deed264497073732fb014a">state</a></div><div class="ttdeci">enum sip_cc_notify_state state</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/dfe/chan__sip_8c_source.html#l00959">chan_sip.c:959</a></div></div>
<div class="ttc" id="structworker__thread_html_adf04f66344e3fb0a6f6a69bf39d19902"><div class="ttname"><a href="../../dd/d5b/structworker__thread.html#adf04f66344e3fb0a6f6a69bf39d19902">worker_thread::lock</a></div><div class="ttdeci">ast_mutex_t lock</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/dc7/threadpool_8c_source.html#l00149">threadpool.c:149</a></div></div>
<div class="ttc" id="utils_8h_html_a24374da24af1931d8a7ccde5b352bb2c"><div class="ttname"><a href="../../d5/d60/utils_8h.html#a24374da24af1931d8a7ccde5b352bb2c">ast_assert</a></div><div class="ttdeci">#define ast_assert(a)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d60/utils_8h_source.html#l00695">utils.h:695</a></div></div>
<div class="ttc" id="lock_8h_html_ae2cdf274a5da241c3ad7324d82bf6af0"><div class="ttname"><a href="../../dd/d42/lock_8h.html#ae2cdf274a5da241c3ad7324d82bf6af0">ast_cond_signal</a></div><div class="ttdeci">#define ast_cond_signal(cond)</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d42/lock_8h_source.html#l00201">lock.h:201</a></div></div>
<div class="ttc" id="structworker__thread_html_aabcac0fa632a75a6a2a2bd05db5e802f"><div class="ttname"><a href="../../dd/d5b/structworker__thread.html#aabcac0fa632a75a6a2a2bd05db5e802f">worker_thread::state</a></div><div class="ttdeci">enum worker_state state</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/dc7/threadpool_8c_source.html#l00155">threadpool.c:155</a></div></div>
<div class="ttc" id="lock_8h_html_ab13590ad27fac3b9c7c7b792c603c9b3"><div class="ttname"><a href="../../dd/d42/lock_8h.html#ab13590ad27fac3b9c7c7b792c603c9b3">SCOPED_MUTEX</a></div><div class="ttdeci">#define SCOPED_MUTEX(varname, lock)</div><div class="ttdoc">scoped lock specialization for mutexes </div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d42/lock_8h_source.html#l00587">lock.h:587</a></div></div>
<div class="ttc" id="app__meetme_8c_html_adf04f66344e3fb0a6f6a69bf39d19902"><div class="ttname"><a href="../../df/d44/app__meetme_8c.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a></div><div class="ttdeci">ast_mutex_t lock</div><div class="ttdef"><b>Definition:</b> <a href="../../df/d44/app__meetme_8c_source.html#l01091">app_meetme.c:1091</a></div></div>
<div class="ttc" id="threadpool_8c_html_a74d6a8e9b05f036ec5b86d00abaffea6a5dfb36109b24f39d54d5c3f48f53def8"><div class="ttname"><a href="../../d1/dc7/threadpool_8c.html#a74d6a8e9b05f036ec5b86d00abaffea6a5dfb36109b24f39d54d5c3f48f53def8">ZOMBIE</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d1/dc7/threadpool_8c_source.html#l00130">threadpool.c:130</a></div></div>
<div class="ttc" id="structstate_html"><div class="ttname"><a href="../../d4/d88/structstate.html">state</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d9/df8/localtime_8c_source.html#l00158">localtime.c:158</a></div></div>
<div class="ttc" id="threadpool_8c_html_a74d6a8e9b05f036ec5b86d00abaffea6a11fd9ca455f92c69c084484d5cd803c2"><div class="ttname"><a href="../../d1/dc7/threadpool_8c.html#a74d6a8e9b05f036ec5b86d00abaffea6a11fd9ca455f92c69c084484d5cd803c2">DEAD</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d1/dc7/threadpool_8c_source.html#l00137">threadpool.c:137</a></div></div>
<div class="ttc" id="structworker__thread_html_a1c7181c39f99ee801943a0d0aa9872b9"><div class="ttname"><a href="../../dd/d5b/structworker__thread.html#a1c7181c39f99ee801943a0d0aa9872b9">worker_thread::cond</a></div><div class="ttdeci">ast_cond_t cond</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/dc7/threadpool_8c_source.html#l00147">threadpool.c:147</a></div></div>
<div class="ttc" id="threadpool_8c_html_a74d6a8e9b05f036ec5b86d00abaffea6a4f34c5c191d6e0d028ca831b6c0b1571"><div class="ttname"><a href="../../d1/dc7/threadpool_8c.html#a74d6a8e9b05f036ec5b86d00abaffea6a4f34c5c191d6e0d028ca831b6c0b1571">ALIVE</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d1/dc7/threadpool_8c_source.html#l00122">threadpool.c:122</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a52721e95ac239fe4f3cb7d27e677d921"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a52721e95ac239fe4f3cb7d27e677d921">&#9670;&nbsp;</a></span>worker_shutdown()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void worker_shutdown </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="../../dd/d5b/structworker__thread.html">worker_thread</a> *&#160;</td>
          <td class="paramname"><em>worker</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>shut a worker thread down </p>
<p>Set the worker dead and then wait for its thread to finish executing.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">worker</td><td>The worker thread to shut down </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="../../d1/dc7/threadpool_8c_source.html#l01009">1009</a> of file <a class="el" href="../../d1/dc7/threadpool_8c_source.html">threadpool.c</a>.</p>

<p class="reference">References <a class="el" href="../../dd/d42/lock_8h_source.html#l00066">AST_PTHREADT_NULL</a>, <a class="el" href="../../d1/dc7/threadpool_8c_source.html#l00137">DEAD</a>, <a class="el" href="../../dc/d7f/resample_8c_source.html#l00096">NULL</a>, <a class="el" href="../../d1/dc7/threadpool_8c_source.html#l00151">worker_thread::thread</a>, and <a class="el" href="../../d1/dc7/threadpool_8c_source.html#l01186">worker_set_state()</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../d1/dc7/threadpool_8c_source.html#l01025">worker_thread_destroy()</a>.</p>
<div class="fragment"><div class="line"><a name="l01010"></a><span class="lineno"> 1010</span>&#160;{</div><div class="line"><a name="l01011"></a><span class="lineno"> 1011</span>&#160;   <a class="code" href="../../d1/dc7/threadpool_8c.html#a5513b88136117cc6c4c7d146c226bf86">worker_set_state</a>(worker, <a class="code" href="../../d1/dc7/threadpool_8c.html#a74d6a8e9b05f036ec5b86d00abaffea6a11fd9ca455f92c69c084484d5cd803c2">DEAD</a>);</div><div class="line"><a name="l01012"></a><span class="lineno"> 1012</span>&#160;   <span class="keywordflow">if</span> (worker-&gt;<a class="code" href="../../dd/d5b/structworker__thread.html#a01f75a9ad916f63a94e06a27635ba278">thread</a> != <a class="code" href="../../dd/d42/lock_8h.html#a6009440c7a72f8e2e3b1ec97641ad160">AST_PTHREADT_NULL</a>) {</div><div class="line"><a name="l01013"></a><span class="lineno"> 1013</span>&#160;      pthread_join(worker-&gt;<a class="code" href="../../dd/d5b/structworker__thread.html#a01f75a9ad916f63a94e06a27635ba278">thread</a>, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div><div class="line"><a name="l01014"></a><span class="lineno"> 1014</span>&#160;      worker-&gt;<a class="code" href="../../dd/d5b/structworker__thread.html#a01f75a9ad916f63a94e06a27635ba278">thread</a> = <a class="code" href="../../dd/d42/lock_8h.html#a6009440c7a72f8e2e3b1ec97641ad160">AST_PTHREADT_NULL</a>;</div><div class="line"><a name="l01015"></a><span class="lineno"> 1015</span>&#160;   }</div><div class="line"><a name="l01016"></a><span class="lineno"> 1016</span>&#160;}</div><div class="ttc" id="resample_8c_html_a070d2ce7b6bb7e5c05602aa8c308d0c4"><div class="ttname"><a href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a></div><div class="ttdeci">#define NULL</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d7f/resample_8c_source.html#l00096">resample.c:96</a></div></div>
<div class="ttc" id="lock_8h_html_a6009440c7a72f8e2e3b1ec97641ad160"><div class="ttname"><a href="../../dd/d42/lock_8h.html#a6009440c7a72f8e2e3b1ec97641ad160">AST_PTHREADT_NULL</a></div><div class="ttdeci">#define AST_PTHREADT_NULL</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d42/lock_8h_source.html#l00066">lock.h:66</a></div></div>
<div class="ttc" id="structworker__thread_html_a01f75a9ad916f63a94e06a27635ba278"><div class="ttname"><a href="../../dd/d5b/structworker__thread.html#a01f75a9ad916f63a94e06a27635ba278">worker_thread::thread</a></div><div class="ttdeci">pthread_t thread</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/dc7/threadpool_8c_source.html#l00151">threadpool.c:151</a></div></div>
<div class="ttc" id="threadpool_8c_html_a5513b88136117cc6c4c7d146c226bf86"><div class="ttname"><a href="../../d1/dc7/threadpool_8c.html#a5513b88136117cc6c4c7d146c226bf86">worker_set_state</a></div><div class="ttdeci">static int worker_set_state(struct worker_thread *worker, enum worker_state state)</div><div class="ttdoc">Change a worker&amp;#39;s state. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/dc7/threadpool_8c_source.html#l01186">threadpool.c:1186</a></div></div>
<div class="ttc" id="threadpool_8c_html_a74d6a8e9b05f036ec5b86d00abaffea6a11fd9ca455f92c69c084484d5cd803c2"><div class="ttname"><a href="../../d1/dc7/threadpool_8c.html#a74d6a8e9b05f036ec5b86d00abaffea6a11fd9ca455f92c69c084484d5cd803c2">DEAD</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d1/dc7/threadpool_8c_source.html#l00137">threadpool.c:137</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="aea51831e6b71573a0864d603b6f6195f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aea51831e6b71573a0864d603b6f6195f">&#9670;&nbsp;</a></span>worker_start()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void * worker_start </td>
          <td>(</td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>arg</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>start point for worker threads </p>
<p>Worker threads start in the active state but may immediately go idle if there is no work to be done</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">arg</td><td>The worker thread </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">NULL</td><td></td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="../../d1/dc7/threadpool_8c_source.html#l01044">1044</a> of file <a class="el" href="../../d1/dc7/threadpool_8c_source.html">threadpool.c</a>.</p>

<p class="reference">References <a class="el" href="../../d1/dc7/threadpool_8c_source.html#l00122">ALIVE</a>, <a class="el" href="../../dd/d42/lock_8h_source.html#l00187">ast_mutex_lock</a>, <a class="el" href="../../dd/d42/lock_8h_source.html#l00188">ast_mutex_unlock</a>, <a class="el" href="../../d1/dc7/threadpool_8c_source.html#l00149">worker_thread::lock</a>, <a class="el" href="../../dc/d7f/resample_8c_source.html#l00096">NULL</a>, <a class="el" href="../../d1/dc7/threadpool_8c_source.html#l00159">worker_thread::options</a>, <a class="el" href="../../d1/dc7/threadpool_8c_source.html#l00153">worker_thread::pool</a>, <a class="el" href="../../d1/dc7/threadpool_8c_source.html#l00155">worker_thread::state</a>, <a class="el" href="../../d3/d40/threadpool_8h_source.html#l00124">ast_threadpool_options::thread_end</a>, <a class="el" href="../../d3/d40/threadpool_8h_source.html#l00117">ast_threadpool_options::thread_start</a>, <a class="el" href="../../d1/dc7/threadpool_8c_source.html#l00256">threadpool_active_thread_idle()</a>, <a class="el" href="../../d1/dc7/threadpool_8c_source.html#l00301">threadpool_zombie_thread_dead()</a>, <a class="el" href="../../d1/dc7/threadpool_8c_source.html#l01124">worker_active()</a>, <a class="el" href="../../d1/dc7/threadpool_8c_source.html#l01153">worker_idle()</a>, and <a class="el" href="../../d1/dc7/threadpool_8c_source.html#l00130">ZOMBIE</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../d1/dc7/threadpool_8c_source.html#l01109">worker_thread_start()</a>.</p>
<div class="fragment"><div class="line"><a name="l01045"></a><span class="lineno"> 1045</span>&#160;{</div><div class="line"><a name="l01046"></a><span class="lineno"> 1046</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../dd/d5b/structworker__thread.html">worker_thread</a> *worker = arg;</div><div class="line"><a name="l01047"></a><span class="lineno"> 1047</span>&#160;   <span class="keyword">enum</span> <a class="code" href="../../d1/dc7/threadpool_8c.html#a74d6a8e9b05f036ec5b86d00abaffea6">worker_state</a> saved_state;</div><div class="line"><a name="l01048"></a><span class="lineno"> 1048</span>&#160;</div><div class="line"><a name="l01049"></a><span class="lineno"> 1049</span>&#160;   <span class="keywordflow">if</span> (worker-&gt;<a class="code" href="../../dd/d5b/structworker__thread.html#a83b47841343f8af6b4ab20abe3c2ab24">options</a>.<a class="code" href="../../de/de6/structast__threadpool__options.html#a46c295c843f65d44317fbb62a41fa35d">thread_start</a>) {</div><div class="line"><a name="l01050"></a><span class="lineno"> 1050</span>&#160;      worker-&gt;<a class="code" href="../../dd/d5b/structworker__thread.html#a83b47841343f8af6b4ab20abe3c2ab24">options</a>.<a class="code" href="../../de/de6/structast__threadpool__options.html#a46c295c843f65d44317fbb62a41fa35d">thread_start</a>();</div><div class="line"><a name="l01051"></a><span class="lineno"> 1051</span>&#160;   }</div><div class="line"><a name="l01052"></a><span class="lineno"> 1052</span>&#160;</div><div class="line"><a name="l01053"></a><span class="lineno"> 1053</span>&#160;   <a class="code" href="../../dd/d42/lock_8h.html#ac5e13c7fe64d3b271a52028b0a78b92b">ast_mutex_lock</a>(&amp;worker-&gt;<a class="code" href="../../dd/d5b/structworker__thread.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);</div><div class="line"><a name="l01054"></a><span class="lineno"> 1054</span>&#160;   <span class="keywordflow">while</span> (<a class="code" href="../../d1/dc7/threadpool_8c.html#a569b7d8ff03ca80e7b6a852769d15c61">worker_idle</a>(worker)) {</div><div class="line"><a name="l01055"></a><span class="lineno"> 1055</span>&#160;      <a class="code" href="../../dd/d42/lock_8h.html#a873f9ce8c6287a32d48c83133e124418">ast_mutex_unlock</a>(&amp;worker-&gt;<a class="code" href="../../dd/d5b/structworker__thread.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);</div><div class="line"><a name="l01056"></a><span class="lineno"> 1056</span>&#160;      <a class="code" href="../../d1/dc7/threadpool_8c.html#a0aca7fd49b04646cdd284d4daad538c4">worker_active</a>(worker);</div><div class="line"><a name="l01057"></a><span class="lineno"> 1057</span>&#160;      <a class="code" href="../../dd/d42/lock_8h.html#ac5e13c7fe64d3b271a52028b0a78b92b">ast_mutex_lock</a>(&amp;worker-&gt;<a class="code" href="../../dd/d5b/structworker__thread.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);</div><div class="line"><a name="l01058"></a><span class="lineno"> 1058</span>&#160;      <span class="keywordflow">if</span> (worker-&gt;<a class="code" href="../../dd/d5b/structworker__thread.html#aabcac0fa632a75a6a2a2bd05db5e802f">state</a> != <a class="code" href="../../d1/dc7/threadpool_8c.html#a74d6a8e9b05f036ec5b86d00abaffea6a4f34c5c191d6e0d028ca831b6c0b1571">ALIVE</a>) {</div><div class="line"><a name="l01059"></a><span class="lineno"> 1059</span>&#160;         <span class="keywordflow">break</span>;</div><div class="line"><a name="l01060"></a><span class="lineno"> 1060</span>&#160;      }</div><div class="line"><a name="l01061"></a><span class="lineno"> 1061</span>&#160;      <a class="code" href="../../d1/dc7/threadpool_8c.html#a1db4545f69518e92887438ebf9dfb898">threadpool_active_thread_idle</a>(worker-&gt;<a class="code" href="../../dd/d5b/structworker__thread.html#ac8c18315f6d4a45480dea634294e683f">pool</a>, worker);</div><div class="line"><a name="l01062"></a><span class="lineno"> 1062</span>&#160;   }</div><div class="line"><a name="l01063"></a><span class="lineno"> 1063</span>&#160;   saved_state = worker-&gt;<a class="code" href="../../dd/d5b/structworker__thread.html#aabcac0fa632a75a6a2a2bd05db5e802f">state</a>;</div><div class="line"><a name="l01064"></a><span class="lineno"> 1064</span>&#160;   <a class="code" href="../../dd/d42/lock_8h.html#a873f9ce8c6287a32d48c83133e124418">ast_mutex_unlock</a>(&amp;worker-&gt;<a class="code" href="../../dd/d5b/structworker__thread.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);</div><div class="line"><a name="l01065"></a><span class="lineno"> 1065</span>&#160;</div><div class="line"><a name="l01066"></a><span class="lineno"> 1066</span>&#160;   <span class="comment">/* Reaching this portion means the thread is</span></div><div class="line"><a name="l01067"></a><span class="lineno"> 1067</span>&#160;<span class="comment">    * on death&#39;s door. It may have been killed while</span></div><div class="line"><a name="l01068"></a><span class="lineno"> 1068</span>&#160;<span class="comment">    * it was idle, in which case it can just die</span></div><div class="line"><a name="l01069"></a><span class="lineno"> 1069</span>&#160;<span class="comment">    * peacefully. If it&#39;s a zombie, though, then</span></div><div class="line"><a name="l01070"></a><span class="lineno"> 1070</span>&#160;<span class="comment">    * it needs to let the pool know so</span></div><div class="line"><a name="l01071"></a><span class="lineno"> 1071</span>&#160;<span class="comment">    * that the thread can be removed from the</span></div><div class="line"><a name="l01072"></a><span class="lineno"> 1072</span>&#160;<span class="comment">    * list of zombie threads.</span></div><div class="line"><a name="l01073"></a><span class="lineno"> 1073</span>&#160;<span class="comment">    */</span></div><div class="line"><a name="l01074"></a><span class="lineno"> 1074</span>&#160;   <span class="keywordflow">if</span> (saved_state == <a class="code" href="../../d1/dc7/threadpool_8c.html#a74d6a8e9b05f036ec5b86d00abaffea6a5dfb36109b24f39d54d5c3f48f53def8">ZOMBIE</a>) {</div><div class="line"><a name="l01075"></a><span class="lineno"> 1075</span>&#160;      <a class="code" href="../../d1/dc7/threadpool_8c.html#a9bdb1831968932c47c5321e9079f705d">threadpool_zombie_thread_dead</a>(worker-&gt;<a class="code" href="../../dd/d5b/structworker__thread.html#ac8c18315f6d4a45480dea634294e683f">pool</a>, worker);</div><div class="line"><a name="l01076"></a><span class="lineno"> 1076</span>&#160;   }</div><div class="line"><a name="l01077"></a><span class="lineno"> 1077</span>&#160;</div><div class="line"><a name="l01078"></a><span class="lineno"> 1078</span>&#160;   <span class="keywordflow">if</span> (worker-&gt;<a class="code" href="../../dd/d5b/structworker__thread.html#a83b47841343f8af6b4ab20abe3c2ab24">options</a>.<a class="code" href="../../de/de6/structast__threadpool__options.html#ad4e364a35647d774944cbd35b6388d91">thread_end</a>) {</div><div class="line"><a name="l01079"></a><span class="lineno"> 1079</span>&#160;      worker-&gt;<a class="code" href="../../dd/d5b/structworker__thread.html#a83b47841343f8af6b4ab20abe3c2ab24">options</a>.<a class="code" href="../../de/de6/structast__threadpool__options.html#ad4e364a35647d774944cbd35b6388d91">thread_end</a>();</div><div class="line"><a name="l01080"></a><span class="lineno"> 1080</span>&#160;   }</div><div class="line"><a name="l01081"></a><span class="lineno"> 1081</span>&#160;   <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l01082"></a><span class="lineno"> 1082</span>&#160;}</div><div class="ttc" id="threadpool_8c_html_a74d6a8e9b05f036ec5b86d00abaffea6"><div class="ttname"><a href="../../d1/dc7/threadpool_8c.html#a74d6a8e9b05f036ec5b86d00abaffea6">worker_state</a></div><div class="ttdeci">worker_state</div><div class="ttdoc">states for worker threads </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/dc7/threadpool_8c_source.html#l00120">threadpool.c:120</a></div></div>
<div class="ttc" id="structworker__thread_html_a83b47841343f8af6b4ab20abe3c2ab24"><div class="ttname"><a href="../../dd/d5b/structworker__thread.html#a83b47841343f8af6b4ab20abe3c2ab24">worker_thread::options</a></div><div class="ttdeci">struct ast_threadpool_options options</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/dc7/threadpool_8c_source.html#l00159">threadpool.c:159</a></div></div>
<div class="ttc" id="threadpool_8c_html_a1db4545f69518e92887438ebf9dfb898"><div class="ttname"><a href="../../d1/dc7/threadpool_8c.html#a1db4545f69518e92887438ebf9dfb898">threadpool_active_thread_idle</a></div><div class="ttdeci">static void threadpool_active_thread_idle(struct ast_threadpool *pool, struct worker_thread *worker)</div><div class="ttdoc">Queue a task to move a thread from the active list to the idle list. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/dc7/threadpool_8c_source.html#l00256">threadpool.c:256</a></div></div>
<div class="ttc" id="threadpool_8c_html_a0aca7fd49b04646cdd284d4daad538c4"><div class="ttname"><a href="../../d1/dc7/threadpool_8c.html#a0aca7fd49b04646cdd284d4daad538c4">worker_active</a></div><div class="ttdeci">static void worker_active(struct worker_thread *worker)</div><div class="ttdoc">Active loop for worker threads. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/dc7/threadpool_8c_source.html#l01124">threadpool.c:1124</a></div></div>
<div class="ttc" id="structworker__thread_html"><div class="ttname"><a href="../../dd/d5b/structworker__thread.html">worker_thread</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d1/dc7/threadpool_8c_source.html#l00143">threadpool.c:143</a></div></div>
<div class="ttc" id="structworker__thread_html_adf04f66344e3fb0a6f6a69bf39d19902"><div class="ttname"><a href="../../dd/d5b/structworker__thread.html#adf04f66344e3fb0a6f6a69bf39d19902">worker_thread::lock</a></div><div class="ttdeci">ast_mutex_t lock</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/dc7/threadpool_8c_source.html#l00149">threadpool.c:149</a></div></div>
<div class="ttc" id="lock_8h_html_ac5e13c7fe64d3b271a52028b0a78b92b"><div class="ttname"><a href="../../dd/d42/lock_8h.html#ac5e13c7fe64d3b271a52028b0a78b92b">ast_mutex_lock</a></div><div class="ttdeci">#define ast_mutex_lock(a)</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d42/lock_8h_source.html#l00187">lock.h:187</a></div></div>
<div class="ttc" id="resample_8c_html_a070d2ce7b6bb7e5c05602aa8c308d0c4"><div class="ttname"><a href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a></div><div class="ttdeci">#define NULL</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d7f/resample_8c_source.html#l00096">resample.c:96</a></div></div>
<div class="ttc" id="structworker__thread_html_aabcac0fa632a75a6a2a2bd05db5e802f"><div class="ttname"><a href="../../dd/d5b/structworker__thread.html#aabcac0fa632a75a6a2a2bd05db5e802f">worker_thread::state</a></div><div class="ttdeci">enum worker_state state</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/dc7/threadpool_8c_source.html#l00155">threadpool.c:155</a></div></div>
<div class="ttc" id="structast__threadpool__options_html_a46c295c843f65d44317fbb62a41fa35d"><div class="ttname"><a href="../../de/de6/structast__threadpool__options.html#a46c295c843f65d44317fbb62a41fa35d">ast_threadpool_options::thread_start</a></div><div class="ttdeci">void(* thread_start)(void)</div><div class="ttdoc">Function to call when a thread starts. </div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d40/threadpool_8h_source.html#l00117">threadpool.h:117</a></div></div>
<div class="ttc" id="structast__threadpool__options_html_ad4e364a35647d774944cbd35b6388d91"><div class="ttname"><a href="../../de/de6/structast__threadpool__options.html#ad4e364a35647d774944cbd35b6388d91">ast_threadpool_options::thread_end</a></div><div class="ttdeci">void(* thread_end)(void)</div><div class="ttdoc">Function to call when a thread ends. </div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d40/threadpool_8h_source.html#l00124">threadpool.h:124</a></div></div>
<div class="ttc" id="threadpool_8c_html_a74d6a8e9b05f036ec5b86d00abaffea6a5dfb36109b24f39d54d5c3f48f53def8"><div class="ttname"><a href="../../d1/dc7/threadpool_8c.html#a74d6a8e9b05f036ec5b86d00abaffea6a5dfb36109b24f39d54d5c3f48f53def8">ZOMBIE</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d1/dc7/threadpool_8c_source.html#l00130">threadpool.c:130</a></div></div>
<div class="ttc" id="structworker__thread_html_ac8c18315f6d4a45480dea634294e683f"><div class="ttname"><a href="../../dd/d5b/structworker__thread.html#ac8c18315f6d4a45480dea634294e683f">worker_thread::pool</a></div><div class="ttdeci">struct ast_threadpool * pool</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/dc7/threadpool_8c_source.html#l00153">threadpool.c:153</a></div></div>
<div class="ttc" id="threadpool_8c_html_a9bdb1831968932c47c5321e9079f705d"><div class="ttname"><a href="../../d1/dc7/threadpool_8c.html#a9bdb1831968932c47c5321e9079f705d">threadpool_zombie_thread_dead</a></div><div class="ttdeci">static void threadpool_zombie_thread_dead(struct ast_threadpool *pool, struct worker_thread *worker)</div><div class="ttdoc">Queue a task to kill a zombie thread. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/dc7/threadpool_8c_source.html#l00301">threadpool.c:301</a></div></div>
<div class="ttc" id="threadpool_8c_html_a569b7d8ff03ca80e7b6a852769d15c61"><div class="ttname"><a href="../../d1/dc7/threadpool_8c.html#a569b7d8ff03ca80e7b6a852769d15c61">worker_idle</a></div><div class="ttdeci">static int worker_idle(struct worker_thread *worker)</div><div class="ttdoc">Idle function for worker threads. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/dc7/threadpool_8c_source.html#l01153">threadpool.c:1153</a></div></div>
<div class="ttc" id="threadpool_8c_html_a74d6a8e9b05f036ec5b86d00abaffea6a4f34c5c191d6e0d028ca831b6c0b1571"><div class="ttname"><a href="../../d1/dc7/threadpool_8c.html#a74d6a8e9b05f036ec5b86d00abaffea6a4f34c5c191d6e0d028ca831b6c0b1571">ALIVE</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d1/dc7/threadpool_8c_source.html#l00122">threadpool.c:122</a></div></div>
<div class="ttc" id="lock_8h_html_a873f9ce8c6287a32d48c83133e124418"><div class="ttname"><a href="../../dd/d42/lock_8h.html#a873f9ce8c6287a32d48c83133e124418">ast_mutex_unlock</a></div><div class="ttdeci">#define ast_mutex_unlock(a)</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d42/lock_8h_source.html#l00188">lock.h:188</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a03c0a8a356376d546a672d2a1acfe13d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a03c0a8a356376d546a672d2a1acfe13d">&#9670;&nbsp;</a></span>worker_thread_alloc()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static struct <a class="el" href="../../dd/d5b/structworker__thread.html">worker_thread</a> * worker_thread_alloc </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="../../d5/d10/structast__threadpool.html">ast_threadpool</a> *&#160;</td>
          <td class="paramname"><em>pool</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Allocate and initialize a new worker thread. </p>
<p>This will create, initialize, and start the thread.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">pool</td><td>The threadpool to which the worker will be added </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">NULL</td><td>Failed to allocate or start the worker thread </td></tr>
    <tr><td class="paramname">non-NULL</td><td>The newly-created worker thread </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="../../d1/dc7/threadpool_8c_source.html#l01093">1093</a> of file <a class="el" href="../../d1/dc7/threadpool_8c_source.html">threadpool.c</a>.</p>

<p class="reference">References <a class="el" href="../../d1/dc7/threadpool_8c_source.html#l00122">ALIVE</a>, <a class="el" href="../../d5/da5/astobj2_8h_source.html#l00411">ao2_alloc</a>, <a class="el" href="../../dd/d42/lock_8h_source.html#l00755">ast_atomic_fetchadd_int()</a>, <a class="el" href="../../dd/d42/lock_8h_source.html#l00199">ast_cond_init</a>, <a class="el" href="../../dd/d42/lock_8h_source.html#l00184">ast_mutex_init</a>, <a class="el" href="../../dd/d42/lock_8h_source.html#l00066">AST_PTHREADT_NULL</a>, <a class="el" href="../../d1/dc7/threadpool_8c_source.html#l00147">worker_thread::cond</a>, <a class="el" href="../../d1/dc7/threadpool_8c_source.html#l00145">worker_thread::id</a>, <a class="el" href="../../d1/dc7/threadpool_8c_source.html#l00149">worker_thread::lock</a>, <a class="el" href="../../dc/d7f/resample_8c_source.html#l00096">NULL</a>, <a class="el" href="../../d1/dc7/threadpool_8c_source.html#l00100">ast_threadpool::options</a>, <a class="el" href="../../d1/dc7/threadpool_8c_source.html#l00159">worker_thread::options</a>, <a class="el" href="../../d1/dc7/threadpool_8c_source.html#l00153">worker_thread::pool</a>, <a class="el" href="../../d9/d21/res__rtp__asterisk_8c_source.html#l00236">pool</a>, <a class="el" href="../../d1/dc7/threadpool_8c_source.html#l00155">worker_thread::state</a>, <a class="el" href="../../d1/dc7/threadpool_8c_source.html#l00151">worker_thread::thread</a>, and <a class="el" href="../../d1/dc7/threadpool_8c_source.html#l01025">worker_thread_destroy()</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../d1/dc7/threadpool_8c_source.html#l00524">grow()</a>.</p>
<div class="fragment"><div class="line"><a name="l01094"></a><span class="lineno"> 1094</span>&#160;{</div><div class="line"><a name="l01095"></a><span class="lineno"> 1095</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../dd/d5b/structworker__thread.html">worker_thread</a> *worker = <a class="code" href="../../d5/da5/astobj2_8h.html#ae0422b60d8e25b6962b2d61ae4ddf724">ao2_alloc</a>(<span class="keyword">sizeof</span>(*worker), <a class="code" href="../../d1/dc7/threadpool_8c.html#acc4078c1106c6cfd3f2ee11694b60fc3">worker_thread_destroy</a>);</div><div class="line"><a name="l01096"></a><span class="lineno"> 1096</span>&#160;   <span class="keywordflow">if</span> (!worker) {</div><div class="line"><a name="l01097"></a><span class="lineno"> 1097</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l01098"></a><span class="lineno"> 1098</span>&#160;   }</div><div class="line"><a name="l01099"></a><span class="lineno"> 1099</span>&#160;   worker-&gt;<a class="code" href="../../dd/d5b/structworker__thread.html#a7441ef0865bcb3db9b8064dd7375c1ea">id</a> = <a class="code" href="../../dd/d42/lock_8h.html#a8a3bd496edfec04a95683ace66676200">ast_atomic_fetchadd_int</a>(&amp;<a class="code" href="../../d1/dc7/threadpool_8c.html#a7ae6eaefcacec74737f4dbb8ec01eaf7">worker_id_counter</a>, 1);</div><div class="line"><a name="l01100"></a><span class="lineno"> 1100</span>&#160;   <a class="code" href="../../dd/d42/lock_8h.html#a76e8ed6bb354be6c6dd9e51acc1d7a1b">ast_mutex_init</a>(&amp;worker-&gt;<a class="code" href="../../dd/d5b/structworker__thread.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);</div><div class="line"><a name="l01101"></a><span class="lineno"> 1101</span>&#160;   <a class="code" href="../../dd/d42/lock_8h.html#a69e9591803d36f5683eb9b084442be9b">ast_cond_init</a>(&amp;worker-&gt;<a class="code" href="../../dd/d5b/structworker__thread.html#a1c7181c39f99ee801943a0d0aa9872b9">cond</a>, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div><div class="line"><a name="l01102"></a><span class="lineno"> 1102</span>&#160;   worker-&gt;<a class="code" href="../../dd/d5b/structworker__thread.html#ac8c18315f6d4a45480dea634294e683f">pool</a> = <a class="code" href="../../d9/d21/res__rtp__asterisk_8c.html#a2e57658a5d3ef6c4ef2774c9d5868e7c">pool</a>;</div><div class="line"><a name="l01103"></a><span class="lineno"> 1103</span>&#160;   worker-&gt;<a class="code" href="../../dd/d5b/structworker__thread.html#a01f75a9ad916f63a94e06a27635ba278">thread</a> = <a class="code" href="../../dd/d42/lock_8h.html#a6009440c7a72f8e2e3b1ec97641ad160">AST_PTHREADT_NULL</a>;</div><div class="line"><a name="l01104"></a><span class="lineno"> 1104</span>&#160;   worker-&gt;<a class="code" href="../../dd/d5b/structworker__thread.html#aabcac0fa632a75a6a2a2bd05db5e802f">state</a> = <a class="code" href="../../d1/dc7/threadpool_8c.html#a74d6a8e9b05f036ec5b86d00abaffea6a4f34c5c191d6e0d028ca831b6c0b1571">ALIVE</a>;</div><div class="line"><a name="l01105"></a><span class="lineno"> 1105</span>&#160;   worker-&gt;<a class="code" href="../../dd/d5b/structworker__thread.html#a83b47841343f8af6b4ab20abe3c2ab24">options</a> = pool-&gt;<a class="code" href="../../d5/d10/structast__threadpool.html#a83b47841343f8af6b4ab20abe3c2ab24">options</a>;</div><div class="line"><a name="l01106"></a><span class="lineno"> 1106</span>&#160;   <span class="keywordflow">return</span> worker;</div><div class="line"><a name="l01107"></a><span class="lineno"> 1107</span>&#160;}</div><div class="ttc" id="structworker__thread_html_a83b47841343f8af6b4ab20abe3c2ab24"><div class="ttname"><a href="../../dd/d5b/structworker__thread.html#a83b47841343f8af6b4ab20abe3c2ab24">worker_thread::options</a></div><div class="ttdeci">struct ast_threadpool_options options</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/dc7/threadpool_8c_source.html#l00159">threadpool.c:159</a></div></div>
<div class="ttc" id="threadpool_8c_html_acc4078c1106c6cfd3f2ee11694b60fc3"><div class="ttname"><a href="../../d1/dc7/threadpool_8c.html#acc4078c1106c6cfd3f2ee11694b60fc3">worker_thread_destroy</a></div><div class="ttdeci">static void worker_thread_destroy(void *obj)</div><div class="ttdoc">Worker thread destructor. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/dc7/threadpool_8c_source.html#l01025">threadpool.c:1025</a></div></div>
<div class="ttc" id="structast__threadpool_html_a83b47841343f8af6b4ab20abe3c2ab24"><div class="ttname"><a href="../../d5/d10/structast__threadpool.html#a83b47841343f8af6b4ab20abe3c2ab24">ast_threadpool::options</a></div><div class="ttdeci">struct ast_threadpool_options options</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/dc7/threadpool_8c_source.html#l00100">threadpool.c:100</a></div></div>
<div class="ttc" id="structworker__thread_html"><div class="ttname"><a href="../../dd/d5b/structworker__thread.html">worker_thread</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d1/dc7/threadpool_8c_source.html#l00143">threadpool.c:143</a></div></div>
<div class="ttc" id="res__rtp__asterisk_8c_html_a2e57658a5d3ef6c4ef2774c9d5868e7c"><div class="ttname"><a href="../../d9/d21/res__rtp__asterisk_8c.html#a2e57658a5d3ef6c4ef2774c9d5868e7c">pool</a></div><div class="ttdeci">static pj_pool_t * pool</div><div class="ttdoc">Global memory pool for configuration and timers. </div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d21/res__rtp__asterisk_8c_source.html#l00236">res_rtp_asterisk.c:236</a></div></div>
<div class="ttc" id="structworker__thread_html_adf04f66344e3fb0a6f6a69bf39d19902"><div class="ttname"><a href="../../dd/d5b/structworker__thread.html#adf04f66344e3fb0a6f6a69bf39d19902">worker_thread::lock</a></div><div class="ttdeci">ast_mutex_t lock</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/dc7/threadpool_8c_source.html#l00149">threadpool.c:149</a></div></div>
<div class="ttc" id="lock_8h_html_a69e9591803d36f5683eb9b084442be9b"><div class="ttname"><a href="../../dd/d42/lock_8h.html#a69e9591803d36f5683eb9b084442be9b">ast_cond_init</a></div><div class="ttdeci">#define ast_cond_init(cond, attr)</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d42/lock_8h_source.html#l00199">lock.h:199</a></div></div>
<div class="ttc" id="structworker__thread_html_a7441ef0865bcb3db9b8064dd7375c1ea"><div class="ttname"><a href="../../dd/d5b/structworker__thread.html#a7441ef0865bcb3db9b8064dd7375c1ea">worker_thread::id</a></div><div class="ttdeci">int id</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/dc7/threadpool_8c_source.html#l00145">threadpool.c:145</a></div></div>
<div class="ttc" id="resample_8c_html_a070d2ce7b6bb7e5c05602aa8c308d0c4"><div class="ttname"><a href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a></div><div class="ttdeci">#define NULL</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d7f/resample_8c_source.html#l00096">resample.c:96</a></div></div>
<div class="ttc" id="lock_8h_html_a8a3bd496edfec04a95683ace66676200"><div class="ttname"><a href="../../dd/d42/lock_8h.html#a8a3bd496edfec04a95683ace66676200">ast_atomic_fetchadd_int</a></div><div class="ttdeci">int ast_atomic_fetchadd_int(volatile int *p, int v)</div><div class="ttdoc">Atomically add v to *p and return the previous value of *p. </div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d42/lock_8h_source.html#l00755">lock.h:755</a></div></div>
<div class="ttc" id="structworker__thread_html_aabcac0fa632a75a6a2a2bd05db5e802f"><div class="ttname"><a href="../../dd/d5b/structworker__thread.html#aabcac0fa632a75a6a2a2bd05db5e802f">worker_thread::state</a></div><div class="ttdeci">enum worker_state state</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/dc7/threadpool_8c_source.html#l00155">threadpool.c:155</a></div></div>
<div class="ttc" id="lock_8h_html_a6009440c7a72f8e2e3b1ec97641ad160"><div class="ttname"><a href="../../dd/d42/lock_8h.html#a6009440c7a72f8e2e3b1ec97641ad160">AST_PTHREADT_NULL</a></div><div class="ttdeci">#define AST_PTHREADT_NULL</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d42/lock_8h_source.html#l00066">lock.h:66</a></div></div>
<div class="ttc" id="structworker__thread_html_ac8c18315f6d4a45480dea634294e683f"><div class="ttname"><a href="../../dd/d5b/structworker__thread.html#ac8c18315f6d4a45480dea634294e683f">worker_thread::pool</a></div><div class="ttdeci">struct ast_threadpool * pool</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/dc7/threadpool_8c_source.html#l00153">threadpool.c:153</a></div></div>
<div class="ttc" id="astobj2_8h_html_ae0422b60d8e25b6962b2d61ae4ddf724"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#ae0422b60d8e25b6962b2d61ae4ddf724">ao2_alloc</a></div><div class="ttdeci">#define ao2_alloc(data_size, destructor_fn)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l00411">astobj2.h:411</a></div></div>
<div class="ttc" id="structworker__thread_html_a01f75a9ad916f63a94e06a27635ba278"><div class="ttname"><a href="../../dd/d5b/structworker__thread.html#a01f75a9ad916f63a94e06a27635ba278">worker_thread::thread</a></div><div class="ttdeci">pthread_t thread</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/dc7/threadpool_8c_source.html#l00151">threadpool.c:151</a></div></div>
<div class="ttc" id="threadpool_8c_html_a7ae6eaefcacec74737f4dbb8ec01eaf7"><div class="ttname"><a href="../../d1/dc7/threadpool_8c.html#a7ae6eaefcacec74737f4dbb8ec01eaf7">worker_id_counter</a></div><div class="ttdeci">static int worker_id_counter</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/dc7/threadpool_8c_source.html#l00984">threadpool.c:984</a></div></div>
<div class="ttc" id="lock_8h_html_a76e8ed6bb354be6c6dd9e51acc1d7a1b"><div class="ttname"><a href="../../dd/d42/lock_8h.html#a76e8ed6bb354be6c6dd9e51acc1d7a1b">ast_mutex_init</a></div><div class="ttdeci">#define ast_mutex_init(pmutex)</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d42/lock_8h_source.html#l00184">lock.h:184</a></div></div>
<div class="ttc" id="structworker__thread_html_a1c7181c39f99ee801943a0d0aa9872b9"><div class="ttname"><a href="../../dd/d5b/structworker__thread.html#a1c7181c39f99ee801943a0d0aa9872b9">worker_thread::cond</a></div><div class="ttdeci">ast_cond_t cond</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/dc7/threadpool_8c_source.html#l00147">threadpool.c:147</a></div></div>
<div class="ttc" id="threadpool_8c_html_a74d6a8e9b05f036ec5b86d00abaffea6a4f34c5c191d6e0d028ca831b6c0b1571"><div class="ttname"><a href="../../d1/dc7/threadpool_8c.html#a74d6a8e9b05f036ec5b86d00abaffea6a4f34c5c191d6e0d028ca831b6c0b1571">ALIVE</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d1/dc7/threadpool_8c_source.html#l00122">threadpool.c:122</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="ac0d540965c29848c4867d3db2440ec4d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac0d540965c29848c4867d3db2440ec4d">&#9670;&nbsp;</a></span>worker_thread_cmp()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int worker_thread_cmp </td>
          <td>(</td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>obj</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>arg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>flags</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="../../d1/dc7/threadpool_8c_source.html#l00993">993</a> of file <a class="el" href="../../d1/dc7/threadpool_8c_source.html">threadpool.c</a>.</p>

<p class="reference">References <a class="el" href="../../d5/da5/astobj2_8h_source.html#l01031">CMP_MATCH</a>, and <a class="el" href="../../d1/dc7/threadpool_8c_source.html#l00145">worker_thread::id</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../d1/dc7/threadpool_8c_source.html#l00404">threadpool_alloc()</a>.</p>
<div class="fragment"><div class="line"><a name="l00994"></a><span class="lineno">  994</span>&#160;{</div><div class="line"><a name="l00995"></a><span class="lineno">  995</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../dd/d5b/structworker__thread.html">worker_thread</a> *worker1 = obj;</div><div class="line"><a name="l00996"></a><span class="lineno">  996</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../dd/d5b/structworker__thread.html">worker_thread</a> *worker2 = arg;</div><div class="line"><a name="l00997"></a><span class="lineno">  997</span>&#160;</div><div class="line"><a name="l00998"></a><span class="lineno">  998</span>&#160;   <span class="keywordflow">return</span> worker1-&gt;<a class="code" href="../../dd/d5b/structworker__thread.html#a7441ef0865bcb3db9b8064dd7375c1ea">id</a> == worker2-&gt;<a class="code" href="../../dd/d5b/structworker__thread.html#a7441ef0865bcb3db9b8064dd7375c1ea">id</a> ? <a class="code" href="../../d5/da5/astobj2_8h.html#a1f8b41308be4c47de8ff89a3b9c7e7d1a1959468a3c5d6aecd2fa1272d8e30fbf">CMP_MATCH</a> : 0;</div><div class="line"><a name="l00999"></a><span class="lineno">  999</span>&#160;}</div><div class="ttc" id="structworker__thread_html"><div class="ttname"><a href="../../dd/d5b/structworker__thread.html">worker_thread</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d1/dc7/threadpool_8c_source.html#l00143">threadpool.c:143</a></div></div>
<div class="ttc" id="structworker__thread_html_a7441ef0865bcb3db9b8064dd7375c1ea"><div class="ttname"><a href="../../dd/d5b/structworker__thread.html#a7441ef0865bcb3db9b8064dd7375c1ea">worker_thread::id</a></div><div class="ttdeci">int id</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/dc7/threadpool_8c_source.html#l00145">threadpool.c:145</a></div></div>
<div class="ttc" id="astobj2_8h_html_a1f8b41308be4c47de8ff89a3b9c7e7d1a1959468a3c5d6aecd2fa1272d8e30fbf"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#a1f8b41308be4c47de8ff89a3b9c7e7d1a1959468a3c5d6aecd2fa1272d8e30fbf">CMP_MATCH</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l01031">astobj2.h:1031</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="acc4078c1106c6cfd3f2ee11694b60fc3"></a>
<h2 class="memtitle"><span class="permalink"><a href="#acc4078c1106c6cfd3f2ee11694b60fc3">&#9670;&nbsp;</a></span>worker_thread_destroy()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void worker_thread_destroy </td>
          <td>(</td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>obj</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Worker thread destructor. </p>
<p>Called automatically when refcount reaches 0. Shuts down the worker thread and destroys its component parts </p>

<p class="definition">Definition at line <a class="el" href="../../d1/dc7/threadpool_8c_source.html#l01025">1025</a> of file <a class="el" href="../../d1/dc7/threadpool_8c_source.html">threadpool.c</a>.</p>

<p class="reference">References <a class="el" href="../../dd/d42/lock_8h_source.html#l00200">ast_cond_destroy</a>, <a class="el" href="../../d1/d8c/logger_8h_source.html#l00452">ast_debug</a>, <a class="el" href="../../dd/d42/lock_8h_source.html#l00186">ast_mutex_destroy</a>, <a class="el" href="../../d1/dc7/threadpool_8c_source.html#l00147">worker_thread::cond</a>, <a class="el" href="../../d1/dc7/threadpool_8c_source.html#l00145">worker_thread::id</a>, <a class="el" href="../../d1/dc7/threadpool_8c_source.html#l00149">worker_thread::lock</a>, and <a class="el" href="../../d1/dc7/threadpool_8c_source.html#l01009">worker_shutdown()</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../d1/dc7/threadpool_8c_source.html#l01093">worker_thread_alloc()</a>.</p>
<div class="fragment"><div class="line"><a name="l01026"></a><span class="lineno"> 1026</span>&#160;{</div><div class="line"><a name="l01027"></a><span class="lineno"> 1027</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../dd/d5b/structworker__thread.html">worker_thread</a> *worker = obj;</div><div class="line"><a name="l01028"></a><span class="lineno"> 1028</span>&#160;   <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(3, <span class="stringliteral">&quot;Destroying worker thread %d\n&quot;</span>, worker-&gt;<a class="code" href="../../dd/d5b/structworker__thread.html#a7441ef0865bcb3db9b8064dd7375c1ea">id</a>);</div><div class="line"><a name="l01029"></a><span class="lineno"> 1029</span>&#160;   <a class="code" href="../../d1/dc7/threadpool_8c.html#a52721e95ac239fe4f3cb7d27e677d921">worker_shutdown</a>(worker);</div><div class="line"><a name="l01030"></a><span class="lineno"> 1030</span>&#160;   <a class="code" href="../../dd/d42/lock_8h.html#ab8977a71822daa556f19f30ba6eec765">ast_mutex_destroy</a>(&amp;worker-&gt;<a class="code" href="../../dd/d5b/structworker__thread.html#adf04f66344e3fb0a6f6a69bf39d19902">lock</a>);</div><div class="line"><a name="l01031"></a><span class="lineno"> 1031</span>&#160;   <a class="code" href="../../dd/d42/lock_8h.html#a1ea2f4040a736cddbecea48b30ffedfd">ast_cond_destroy</a>(&amp;worker-&gt;<a class="code" href="../../dd/d5b/structworker__thread.html#a1c7181c39f99ee801943a0d0aa9872b9">cond</a>);</div><div class="line"><a name="l01032"></a><span class="lineno"> 1032</span>&#160;}</div><div class="ttc" id="structworker__thread_html"><div class="ttname"><a href="../../dd/d5b/structworker__thread.html">worker_thread</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d1/dc7/threadpool_8c_source.html#l00143">threadpool.c:143</a></div></div>
<div class="ttc" id="structworker__thread_html_adf04f66344e3fb0a6f6a69bf39d19902"><div class="ttname"><a href="../../dd/d5b/structworker__thread.html#adf04f66344e3fb0a6f6a69bf39d19902">worker_thread::lock</a></div><div class="ttdeci">ast_mutex_t lock</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/dc7/threadpool_8c_source.html#l00149">threadpool.c:149</a></div></div>
<div class="ttc" id="structworker__thread_html_a7441ef0865bcb3db9b8064dd7375c1ea"><div class="ttname"><a href="../../dd/d5b/structworker__thread.html#a7441ef0865bcb3db9b8064dd7375c1ea">worker_thread::id</a></div><div class="ttdeci">int id</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/dc7/threadpool_8c_source.html#l00145">threadpool.c:145</a></div></div>
<div class="ttc" id="logger_8h_html_a3f248112c8d6ce7e3959aa723dade648"><div class="ttname"><a href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a></div><div class="ttdeci">#define ast_debug(level,...)</div><div class="ttdoc">Log a DEBUG message. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d8c/logger_8h_source.html#l00452">logger.h:452</a></div></div>
<div class="ttc" id="lock_8h_html_a1ea2f4040a736cddbecea48b30ffedfd"><div class="ttname"><a href="../../dd/d42/lock_8h.html#a1ea2f4040a736cddbecea48b30ffedfd">ast_cond_destroy</a></div><div class="ttdeci">#define ast_cond_destroy(cond)</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d42/lock_8h_source.html#l00200">lock.h:200</a></div></div>
<div class="ttc" id="threadpool_8c_html_a52721e95ac239fe4f3cb7d27e677d921"><div class="ttname"><a href="../../d1/dc7/threadpool_8c.html#a52721e95ac239fe4f3cb7d27e677d921">worker_shutdown</a></div><div class="ttdeci">static void worker_shutdown(struct worker_thread *worker)</div><div class="ttdoc">shut a worker thread down </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/dc7/threadpool_8c_source.html#l01009">threadpool.c:1009</a></div></div>
<div class="ttc" id="lock_8h_html_ab8977a71822daa556f19f30ba6eec765"><div class="ttname"><a href="../../dd/d42/lock_8h.html#ab8977a71822daa556f19f30ba6eec765">ast_mutex_destroy</a></div><div class="ttdeci">#define ast_mutex_destroy(a)</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d42/lock_8h_source.html#l00186">lock.h:186</a></div></div>
<div class="ttc" id="structworker__thread_html_a1c7181c39f99ee801943a0d0aa9872b9"><div class="ttname"><a href="../../dd/d5b/structworker__thread.html#a1c7181c39f99ee801943a0d0aa9872b9">worker_thread::cond</a></div><div class="ttdeci">ast_cond_t cond</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/dc7/threadpool_8c_source.html#l00147">threadpool.c:147</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a21d4025815ba402857dd4c09dead0384"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a21d4025815ba402857dd4c09dead0384">&#9670;&nbsp;</a></span>worker_thread_hash()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int worker_thread_hash </td>
          <td>(</td>
          <td class="paramtype">const void *&#160;</td>
          <td class="paramname"><em>obj</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>flags</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="../../d1/dc7/threadpool_8c_source.html#l00986">986</a> of file <a class="el" href="../../d1/dc7/threadpool_8c_source.html">threadpool.c</a>.</p>

<p class="reference">References <a class="el" href="../../d1/dc7/threadpool_8c_source.html#l00145">worker_thread::id</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../d1/dc7/threadpool_8c_source.html#l00404">threadpool_alloc()</a>.</p>
<div class="fragment"><div class="line"><a name="l00987"></a><span class="lineno">  987</span>&#160;{</div><div class="line"><a name="l00988"></a><span class="lineno">  988</span>&#160;   <span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="../../dd/d5b/structworker__thread.html">worker_thread</a> *worker = obj;</div><div class="line"><a name="l00989"></a><span class="lineno">  989</span>&#160;</div><div class="line"><a name="l00990"></a><span class="lineno">  990</span>&#160;   <span class="keywordflow">return</span> worker-&gt;<a class="code" href="../../dd/d5b/structworker__thread.html#a7441ef0865bcb3db9b8064dd7375c1ea">id</a>;</div><div class="line"><a name="l00991"></a><span class="lineno">  991</span>&#160;}</div><div class="ttc" id="structworker__thread_html"><div class="ttname"><a href="../../dd/d5b/structworker__thread.html">worker_thread</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d1/dc7/threadpool_8c_source.html#l00143">threadpool.c:143</a></div></div>
<div class="ttc" id="structworker__thread_html_a7441ef0865bcb3db9b8064dd7375c1ea"><div class="ttname"><a href="../../dd/d5b/structworker__thread.html#a7441ef0865bcb3db9b8064dd7375c1ea">worker_thread::id</a></div><div class="ttdeci">int id</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/dc7/threadpool_8c_source.html#l00145">threadpool.c:145</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a25fb76590bc741453b0269ae1bde21b8"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a25fb76590bc741453b0269ae1bde21b8">&#9670;&nbsp;</a></span>worker_thread_start()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int worker_thread_start </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="../../dd/d5b/structworker__thread.html">worker_thread</a> *&#160;</td>
          <td class="paramname"><em>worker</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="../../d1/dc7/threadpool_8c_source.html#l01109">1109</a> of file <a class="el" href="../../d1/dc7/threadpool_8c_source.html">threadpool.c</a>.</p>

<p class="reference">References <a class="el" href="../../d5/d60/utils_8h_source.html#l00559">ast_pthread_create</a>, <a class="el" href="../../dc/d7f/resample_8c_source.html#l00096">NULL</a>, <a class="el" href="../../d1/dc7/threadpool_8c_source.html#l00151">worker_thread::thread</a>, and <a class="el" href="../../d1/dc7/threadpool_8c_source.html#l01044">worker_start()</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../d1/dc7/threadpool_8c_source.html#l00524">grow()</a>.</p>
<div class="fragment"><div class="line"><a name="l01110"></a><span class="lineno"> 1110</span>&#160;{</div><div class="line"><a name="l01111"></a><span class="lineno"> 1111</span>&#160;   <span class="keywordflow">return</span> <a class="code" href="../../d5/d60/utils_8h.html#a4781fd54a4ca8c7f0f8a32a6cce503c0">ast_pthread_create</a>(&amp;worker-&gt;<a class="code" href="../../dd/d5b/structworker__thread.html#a01f75a9ad916f63a94e06a27635ba278">thread</a>, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="../../d1/dc7/threadpool_8c.html#aea51831e6b71573a0864d603b6f6195f">worker_start</a>, worker);</div><div class="line"><a name="l01112"></a><span class="lineno"> 1112</span>&#160;}</div><div class="ttc" id="resample_8c_html_a070d2ce7b6bb7e5c05602aa8c308d0c4"><div class="ttname"><a href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a></div><div class="ttdeci">#define NULL</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d7f/resample_8c_source.html#l00096">resample.c:96</a></div></div>
<div class="ttc" id="threadpool_8c_html_aea51831e6b71573a0864d603b6f6195f"><div class="ttname"><a href="../../d1/dc7/threadpool_8c.html#aea51831e6b71573a0864d603b6f6195f">worker_start</a></div><div class="ttdeci">static void * worker_start(void *arg)</div><div class="ttdoc">start point for worker threads </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/dc7/threadpool_8c_source.html#l01044">threadpool.c:1044</a></div></div>
<div class="ttc" id="utils_8h_html_a4781fd54a4ca8c7f0f8a32a6cce503c0"><div class="ttname"><a href="../../d5/d60/utils_8h.html#a4781fd54a4ca8c7f0f8a32a6cce503c0">ast_pthread_create</a></div><div class="ttdeci">#define ast_pthread_create(a, b, c, d)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d60/utils_8h_source.html#l00559">utils.h:559</a></div></div>
<div class="ttc" id="structworker__thread_html_a01f75a9ad916f63a94e06a27635ba278"><div class="ttname"><a href="../../dd/d5b/structworker__thread.html#a01f75a9ad916f63a94e06a27635ba278">worker_thread::thread</a></div><div class="ttdeci">pthread_t thread</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/dc7/threadpool_8c_source.html#l00151">threadpool.c:151</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="affb887ea65f72e5efedfa4f2a9918a5d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#affb887ea65f72e5efedfa4f2a9918a5d">&#9670;&nbsp;</a></span>zombify_threads()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int zombify_threads </td>
          <td>(</td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>obj</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>arg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>data</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>flags</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>ao2 callback to zombify a set number of threads. </p>
<p>Threads will be zombified as long as the counter has not reached zero. The counter is decremented with each thread that is zombified.</p>
<p>Zombifying a thread involves removing it from its current container, adding it to the zombie container, and changing the state of the worker to a zombie</p>
<p>This callback is called from the threadpool control taskprocessor thread.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">obj</td><td>The worker thread that may be zombified </td></tr>
    <tr><td class="paramname">arg</td><td>The pool to which the worker belongs </td></tr>
    <tr><td class="paramname">data</td><td>The counter </td></tr>
    <tr><td class="paramname">flags</td><td>Unused </td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">CMP_MATCH</td><td>The zombified thread should be removed from its current container </td></tr>
    <tr><td class="paramname">CMP_STOP</td><td>Stop attempting to zombify threads </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="../../d1/dc7/threadpool_8c_source.html#l00745">745</a> of file <a class="el" href="../../d1/dc7/threadpool_8c_source.html">threadpool.c</a>.</p>

<p class="reference">References <a class="el" href="../../d5/da5/astobj2_8h_source.html#l01549">ao2_link</a>, <a class="el" href="../../da/df7/astobj2_8c_source.html#l00042">ast_log</a>, <a class="el" href="../../d5/da5/astobj2_8h_source.html#l01031">CMP_MATCH</a>, <a class="el" href="../../d5/da5/astobj2_8h_source.html#l01032">CMP_STOP</a>, <a class="el" href="../../d1/dc7/threadpool_8c_source.html#l00145">worker_thread::id</a>, <a class="el" href="../../d1/d8c/logger_8h_source.html#l00274">LOG_WARNING</a>, <a class="el" href="../../d9/d21/res__rtp__asterisk_8c_source.html#l00236">pool</a>, <a class="el" href="../../d1/dc7/threadpool_8c_source.html#l01186">worker_set_state()</a>, <a class="el" href="../../d1/dc7/threadpool_8c_source.html#l00130">ZOMBIE</a>, and <a class="el" href="../../d1/dc7/threadpool_8c_source.html#l00053">ast_threadpool::zombie_threads</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../d1/dc7/threadpool_8c_source.html#l00775">shrink()</a>.</p>
<div class="fragment"><div class="line"><a name="l00746"></a><span class="lineno">  746</span>&#160;{</div><div class="line"><a name="l00747"></a><span class="lineno">  747</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../dd/d5b/structworker__thread.html">worker_thread</a> *worker = obj;</div><div class="line"><a name="l00748"></a><span class="lineno">  748</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d5/d10/structast__threadpool.html">ast_threadpool</a> *<a class="code" href="../../d9/d21/res__rtp__asterisk_8c.html#a2e57658a5d3ef6c4ef2774c9d5868e7c">pool</a> = arg;</div><div class="line"><a name="l00749"></a><span class="lineno">  749</span>&#160;   <span class="keywordtype">int</span> *num_to_zombify = data;</div><div class="line"><a name="l00750"></a><span class="lineno">  750</span>&#160;</div><div class="line"><a name="l00751"></a><span class="lineno">  751</span>&#160;   <span class="keywordflow">if</span> ((*num_to_zombify)-- &gt; 0) {</div><div class="line"><a name="l00752"></a><span class="lineno">  752</span>&#160;      <span class="keywordflow">if</span> (!<a class="code" href="../../d5/da5/astobj2_8h.html#a1ad9f122bcae95a470639402faa3d2ee">ao2_link</a>(pool-&gt;<a class="code" href="../../d5/d10/structast__threadpool.html#a9a66e112220169c037a83525533ec817">zombie_threads</a>, worker)) {</div><div class="line"><a name="l00753"></a><span class="lineno">  753</span>&#160;         <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a>, <span class="stringliteral">&quot;Failed to zombify active thread %d. Thread will remain active\n&quot;</span>, worker-&gt;<a class="code" href="../../dd/d5b/structworker__thread.html#a7441ef0865bcb3db9b8064dd7375c1ea">id</a>);</div><div class="line"><a name="l00754"></a><span class="lineno">  754</span>&#160;         <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00755"></a><span class="lineno">  755</span>&#160;      }</div><div class="line"><a name="l00756"></a><span class="lineno">  756</span>&#160;      <a class="code" href="../../d1/dc7/threadpool_8c.html#a5513b88136117cc6c4c7d146c226bf86">worker_set_state</a>(worker, <a class="code" href="../../d1/dc7/threadpool_8c.html#a74d6a8e9b05f036ec5b86d00abaffea6a5dfb36109b24f39d54d5c3f48f53def8">ZOMBIE</a>);</div><div class="line"><a name="l00757"></a><span class="lineno">  757</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../d5/da5/astobj2_8h.html#a1f8b41308be4c47de8ff89a3b9c7e7d1a1959468a3c5d6aecd2fa1272d8e30fbf">CMP_MATCH</a>;</div><div class="line"><a name="l00758"></a><span class="lineno">  758</span>&#160;   } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00759"></a><span class="lineno">  759</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../d5/da5/astobj2_8h.html#a1f8b41308be4c47de8ff89a3b9c7e7d1a75382dc9117cc118719edf6c3d2b71df">CMP_STOP</a>;</div><div class="line"><a name="l00760"></a><span class="lineno">  760</span>&#160;   }</div><div class="line"><a name="l00761"></a><span class="lineno">  761</span>&#160;}</div><div class="ttc" id="logger_8h_html_adf4476a6a4ea6c74231c826e899d7189"><div class="ttname"><a href="../../d1/d8c/logger_8h.html#adf4476a6a4ea6c74231c826e899d7189">LOG_WARNING</a></div><div class="ttdeci">#define LOG_WARNING</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d8c/logger_8h_source.html#l00274">logger.h:274</a></div></div>
<div class="ttc" id="structworker__thread_html"><div class="ttname"><a href="../../dd/d5b/structworker__thread.html">worker_thread</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d1/dc7/threadpool_8c_source.html#l00143">threadpool.c:143</a></div></div>
<div class="ttc" id="res__rtp__asterisk_8c_html_a2e57658a5d3ef6c4ef2774c9d5868e7c"><div class="ttname"><a href="../../d9/d21/res__rtp__asterisk_8c.html#a2e57658a5d3ef6c4ef2774c9d5868e7c">pool</a></div><div class="ttdeci">static pj_pool_t * pool</div><div class="ttdoc">Global memory pool for configuration and timers. </div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d21/res__rtp__asterisk_8c_source.html#l00236">res_rtp_asterisk.c:236</a></div></div>
<div class="ttc" id="astobj2_8h_html_a1f8b41308be4c47de8ff89a3b9c7e7d1a75382dc9117cc118719edf6c3d2b71df"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#a1f8b41308be4c47de8ff89a3b9c7e7d1a75382dc9117cc118719edf6c3d2b71df">CMP_STOP</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l01032">astobj2.h:1032</a></div></div>
<div class="ttc" id="structworker__thread_html_a7441ef0865bcb3db9b8064dd7375c1ea"><div class="ttname"><a href="../../dd/d5b/structworker__thread.html#a7441ef0865bcb3db9b8064dd7375c1ea">worker_thread::id</a></div><div class="ttdeci">int id</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/dc7/threadpool_8c_source.html#l00145">threadpool.c:145</a></div></div>
<div class="ttc" id="astobj2_8c_html_a96a00b3a518d7f32b6d51dc28f09bf9b"><div class="ttname"><a href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a></div><div class="ttdeci">#define ast_log</div><div class="ttdef"><b>Definition:</b> <a href="../../da/df7/astobj2_8c_source.html#l00042">astobj2.c:42</a></div></div>
<div class="ttc" id="astobj2_8h_html_a1f8b41308be4c47de8ff89a3b9c7e7d1a1959468a3c5d6aecd2fa1272d8e30fbf"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#a1f8b41308be4c47de8ff89a3b9c7e7d1a1959468a3c5d6aecd2fa1272d8e30fbf">CMP_MATCH</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l01031">astobj2.h:1031</a></div></div>
<div class="ttc" id="threadpool_8c_html_a74d6a8e9b05f036ec5b86d00abaffea6a5dfb36109b24f39d54d5c3f48f53def8"><div class="ttname"><a href="../../d1/dc7/threadpool_8c.html#a74d6a8e9b05f036ec5b86d00abaffea6a5dfb36109b24f39d54d5c3f48f53def8">ZOMBIE</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d1/dc7/threadpool_8c_source.html#l00130">threadpool.c:130</a></div></div>
<div class="ttc" id="structast__threadpool_html_a9a66e112220169c037a83525533ec817"><div class="ttname"><a href="../../d5/d10/structast__threadpool.html#a9a66e112220169c037a83525533ec817">ast_threadpool::zombie_threads</a></div><div class="ttdeci">struct ao2_container * zombie_threads</div><div class="ttdoc">The container of zombie threads. Zombie threads may be running tasks, but they are scheduled to die s...</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/dc7/threadpool_8c_source.html#l00053">threadpool.c:53</a></div></div>
<div class="ttc" id="threadpool_8c_html_a5513b88136117cc6c4c7d146c226bf86"><div class="ttname"><a href="../../d1/dc7/threadpool_8c.html#a5513b88136117cc6c4c7d146c226bf86">worker_set_state</a></div><div class="ttdeci">static int worker_set_state(struct worker_thread *worker, enum worker_state state)</div><div class="ttdoc">Change a worker&amp;#39;s state. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/dc7/threadpool_8c_source.html#l01186">threadpool.c:1186</a></div></div>
<div class="ttc" id="structast__threadpool_html"><div class="ttname"><a href="../../d5/d10/structast__threadpool.html">ast_threadpool</a></div><div class="ttdoc">An opaque threadpool structure. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/dc7/threadpool_8c_source.html#l00036">threadpool.c:36</a></div></div>
<div class="ttc" id="astobj2_8h_html_a1ad9f122bcae95a470639402faa3d2ee"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#a1ad9f122bcae95a470639402faa3d2ee">ao2_link</a></div><div class="ttdeci">#define ao2_link(container, obj)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l01549">astobj2.h:1549</a></div></div>
</div><!-- fragment -->
</div>
</div>
<h2 class="groupheader">Variable Documentation</h2>
<a id="a1ffa8804dc56390ba80054d2bac56e11"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1ffa8804dc56390ba80054d2bac56e11">&#9670;&nbsp;</a></span>serializer_tps_listener_callbacks</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="../../d0/d01/structast__taskprocessor__listener__callbacks.html">ast_taskprocessor_listener_callbacks</a> serializer_tps_listener_callbacks</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<b>Initial value:</b><div class="fragment"><div class="line">= {</div><div class="line">   .task_pushed = <a class="code" href="../../d1/dc7/threadpool_8c.html#a645501c6996b276d116fa71ad474e00c">serializer_task_pushed</a>,</div><div class="line">   .start = <a class="code" href="../../d1/dc7/threadpool_8c.html#adbed1c57bcac947d16e5248c1004e51e">serializer_start</a>,</div><div class="line">   .shutdown = <a class="code" href="../../d1/dc7/threadpool_8c.html#aa577e16b6d03e11f0f7b9c5fea0af059">serializer_shutdown</a>,</div><div class="line">}</div><div class="ttc" id="threadpool_8c_html_adbed1c57bcac947d16e5248c1004e51e"><div class="ttname"><a href="../../d1/dc7/threadpool_8c.html#adbed1c57bcac947d16e5248c1004e51e">serializer_start</a></div><div class="ttdeci">static int serializer_start(struct ast_taskprocessor_listener *listener)</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/dc7/threadpool_8c_source.html#l01375">threadpool.c:1375</a></div></div>
<div class="ttc" id="threadpool_8c_html_aa577e16b6d03e11f0f7b9c5fea0af059"><div class="ttname"><a href="../../d1/dc7/threadpool_8c.html#aa577e16b6d03e11f0f7b9c5fea0af059">serializer_shutdown</a></div><div class="ttdeci">static void serializer_shutdown(struct ast_taskprocessor_listener *listener)</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/dc7/threadpool_8c_source.html#l01381">threadpool.c:1381</a></div></div>
<div class="ttc" id="threadpool_8c_html_a645501c6996b276d116fa71ad474e00c"><div class="ttname"><a href="../../d1/dc7/threadpool_8c.html#a645501c6996b276d116fa71ad474e00c">serializer_task_pushed</a></div><div class="ttdeci">static void serializer_task_pushed(struct ast_taskprocessor_listener *listener, int was_empty)</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/dc7/threadpool_8c_source.html#l01363">threadpool.c:1363</a></div></div>
</div><!-- fragment -->
<p class="definition">Definition at line <a class="el" href="../../d1/dc7/threadpool_8c_source.html#l01391">1391</a> of file <a class="el" href="../../d1/dc7/threadpool_8c_source.html">threadpool.c</a>.</p>

</div>
</div>
<a id="a54b2045c1d47ecd3404aba214a0e0ab4"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a54b2045c1d47ecd3404aba214a0e0ab4">&#9670;&nbsp;</a></span>threadpool_tps_listener_callbacks</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="../../d0/d01/structast__taskprocessor__listener__callbacks.html">ast_taskprocessor_listener_callbacks</a> threadpool_tps_listener_callbacks</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Table of taskprocessor listener callbacks for threadpool's main taskprocessor. </p>

<p class="definition">Definition at line <a class="el" href="../../d1/dc7/threadpool_8c_source.html#l00695">695</a> of file <a class="el" href="../../d1/dc7/threadpool_8c_source.html">threadpool.c</a>.</p>

</div>
</div>
<a id="a7ae6eaefcacec74737f4dbb8ec01eaf7"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a7ae6eaefcacec74737f4dbb8ec01eaf7">&#9670;&nbsp;</a></span>worker_id_counter</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">int worker_id_counter</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>A monotonically increasing integer used for worker thread identification. </p>

<p class="definition">Definition at line <a class="el" href="../../d1/dc7/threadpool_8c_source.html#l00984">984</a> of file <a class="el" href="../../d1/dc7/threadpool_8c_source.html">threadpool.c</a>.</p>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Sun Aug 8 2021 19:47:00 for Asterisk - The Open Source Telephony Project by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="../../doxygen.png" alt="doxygen"/>
</a> 1.8.13
</small></address>
</body>
</html>
