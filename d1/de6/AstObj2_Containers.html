<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Asterisk - The Open Source Telephony Project: AstObj2 Containers</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Asterisk - The Open Source Telephony Project
   &#160;<span id="projectnumber">18.5.0</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "../../search",false,'Search');
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('../../',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">AstObj2 Containers </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>Containers are data structures meant to store several objects, and perform various operations on them. Internally, objects are stored in lists, hash tables or other data structures depending on the needs.</p>
<p>Operations on container include:</p>
<ul>
<li><b><a class="el" href="../../d5/da5/astobj2_8h.html#a911e0703891a9a7aaf73978152092586">ao2_find(c, arg, flags)</a></b> returns zero or more elements matching a given criteria (specified as arg). 'c' is the container pointer. Flags can be: OBJ_UNLINK - to remove the object, once found, from the container. OBJ_NODATA - don't return the object if found (no ref count change) OBJ_MULTIPLE - don't stop at first match OBJ_SEARCH_OBJECT - if set, 'arg' is an object pointer, and a hash table search will be done. If not, a traversal is done. OBJ_SEARCH_KEY - if set, 'arg', is a search key item that is not an object. Similar to OBJ_SEARCH_OBJECT and mutually exclusive. OBJ_SEARCH_PARTIAL_KEY - if set, 'arg', is a partial search key item that is not an object. Similar to OBJ_SEARCH_KEY and mutually exclusive.</li>
<li><p class="startli"><b><a class="el" href="../../d5/da5/astobj2_8h.html#a47857055118a703ae87ea5ebaf4842ed">ao2_callback(c, flags, fn, arg)</a></b> apply fn(obj, arg) to all objects in the container. Similar to find. fn() can tell when to stop, and do anything with the object including unlinking it.</p><ul>
<li>c is the container;</li>
<li>flags can be OBJ_UNLINK - to remove the object, once found, from the container. OBJ_NODATA - don't return the object if found (no ref count change) OBJ_MULTIPLE - don't stop at first match OBJ_SEARCH_OBJECT - if set, 'arg' is an object pointer, and a hash table search will be done. If not, a traversal is done through all the hash table 'buckets'.. OBJ_SEARCH_KEY - if set, 'arg', is a search key item that is not an object. Similar to OBJ_SEARCH_OBJECT and mutually exclusive. OBJ_SEARCH_PARTIAL_KEY - if set, 'arg', is a partial search key item that is not an object. Similar to OBJ_SEARCH_KEY and mutually exclusive.</li>
<li>fn is a func that returns int, and takes 3 args: (void *obj, void *arg, int flags); obj is an object arg is the same as arg passed into ao2_callback flags is the same as flags passed into ao2_callback fn returns: 0: no match, keep going CMP_STOP: stop search, no match CMP_MATCH: This object is matched.</li>
</ul>
<p class="startli">Note that the entire operation is run with the container locked, so nobody else can change its content while we work on it. However, we pay this with the fact that doing anything blocking in the callback keeps the container blocked. The mechanism is very flexible because the callback function fn() can do basically anything e.g. counting, deleting records, etc. possibly using arg to store the results.</p>
</li>
<li><b>iterate</b> on a container this is done with the following sequence</li>
</ul>
<div class="fragment"><div class="line"><span class="keyword">struct </span><a class="code" href="../../d2/da9/structao2__container.html">ao2_container</a> *c = ... <span class="comment">// our container</span></div><div class="line"><span class="keyword">struct </span><a class="code" href="../../d9/d97/structao2__iterator.html">ao2_iterator</a> i;</div><div class="line"><span class="keywordtype">void</span> *o;</div><div class="line"></div><div class="line">i = <a class="code" href="../../d5/da5/astobj2_8h.html#a91d5d37d00874ae7a92d1a15c0a3b3a6">ao2_iterator_init</a>(c, <a class="code" href="../../d9/d97/structao2__iterator.html#ac8bf36fe0577cba66bccda3a6f7e80a4">flags</a>);</div><div class="line"></div><div class="line"><span class="keywordflow">while</span> ((o = <a class="code" href="../../d5/da5/astobj2_8h.html#a17990ea630db7dbd1252ef0132133a2b">ao2_iterator_next</a>(&amp;i))) {</div><div class="line">    ... <span class="keywordflow">do</span> something on o ...</div><div class="line">    <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(o, -1);</div><div class="line">}</div><div class="line"></div><div class="line"><a class="code" href="../../d5/da5/astobj2_8h.html#ad36841ab6daa3997f7ca7047ad2d033a">ao2_iterator_destroy</a>(&amp;i);</div></div><!-- fragment --> <pre class="fragment">The difference with the callback is that the control
on how to iterate is left to us.

- \b ao2_ref(c, -1)
dropping a reference to a container destroys it, very simple!
</pre><p>Containers are ao2 objects themselves, and this is why their implementation is simple too.</p>
<p>Before declaring containers, we need to declare the types of the arguments passed to the constructor - in turn, this requires to define callback and hash functions and their arguments.</p>
<ul>
<li><a class="el" href="../../db/d5a/AstObj2.html">Object Model implementing objects and containers.</a></li>
<li><a class="el" href="../../d5/da5/astobj2_8h.html">astobj2.h</a> </li>
</ul>
</div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Sun Aug 8 2021 19:47:03 for Asterisk - The Open Source Telephony Project by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="../../doxygen.png" alt="doxygen"/>
</a> 1.8.13
</small></address>
</body>
</html>
