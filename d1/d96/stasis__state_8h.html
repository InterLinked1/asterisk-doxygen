<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Asterisk - The Open Source Telephony Project: stasis_state.h File Reference</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Asterisk - The Open Source Telephony Project
   &#160;<span id="projectnumber">18.5.0</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "../../search",false,'Search');
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('../../',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="../../dir_d44c64559bbebec7f509842c48db8b23.html">include</a></li><li class="navelem"><a class="el" href="../../dir_6d4b1cdb59e2db6ad82005b337288fef.html">asterisk</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#nested-classes">Data Structures</a> &#124;
<a href="#typedef-members">Typedefs</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">stasis_state.h File Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>Stasis State API.  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &quot;<a class="el" href="../../dd/d79/stasis_8h_source.html">asterisk/stasis.h</a>&quot;</code><br />
</div><div class="textblock"><div class="dynheader">
Include dependency graph for stasis_state.h:</div>
<div class="dyncontent">
<div class="center"><img src="../../df/da3/stasis__state_8h__incl.png" border="0" usemap="#stasis__state_8h" alt=""/></div>
<map name="stasis__state_8h" id="stasis__state_8h">
<area shape="rect" id="node2" href="../../dd/d79/stasis_8h.html" title="Stasis Message Bus API. See Stasis Message Bus API for detailed documentation. " alt="" coords="335,80,460,107"/>
<area shape="rect" id="node3" href="../../d4/d05/json_8h.html" title="Asterisk JSON abstraction layer. " alt="" coords="111,155,225,181"/>
<area shape="rect" id="node5" href="../../db/d45/manager_8h.html" title="The AMI &#45; Asterisk Manager Interface &#45; is a TCP protocol created to manage Asterisk with third&#45;party ..." alt="" coords="402,155,547,181"/>
<area shape="rect" id="node10" href="../../d5/d60/utils_8h.html" title="Utility functions. " alt="" coords="263,155,377,181"/>
<area shape="rect" id="node11" href="../../dd/d20/event_8h.html" title="asterisk/event.h" alt="" coords="737,155,861,181"/>
<area shape="rect" id="node4" href="../../db/df1/netsock2_8h.html" title="Network socket handling. " alt="" coords="5,229,152,256"/>
<area shape="rect" id="node6" href="../../d9/d94/network_8h.html" title="Wrapper for network related headers, masking differences between various operating systems..." alt="" coords="176,229,315,256"/>
<area shape="rect" id="node7" href="../../dd/d42/lock_8h.html" title="Asterisk locking&#45;related definitions: " alt="" coords="339,229,453,256"/>
<area shape="rect" id="node8" href="../../d9/db6/datastore_8h.html" title="Asterisk datastore objects. " alt="" coords="477,229,627,256"/>
<area shape="rect" id="node9" href="../../d1/d99/xmldoc_8h.html" title="Asterisk XML Documentation API. " alt="" coords="651,229,786,256"/>
<area shape="rect" id="node12" href="../../d6/d37/event__defs_8h.html" title="Generic event system. " alt="" coords="810,229,969,256"/>
</map>
</div>
</div><div class="textblock"><div class="dynheader">
This graph shows which files directly or indirectly include this file:</div>
<div class="dyncontent">
<div class="center"><img src="../../d6/d20/stasis__state_8h__dep__incl.png" border="0" usemap="#stasis__state_8hdep" alt=""/></div>
<map name="stasis__state_8hdep" id="stasis__state_8hdep">
<area shape="rect" id="node2" href="../../dc/d33/mwi_8h.html" title="Asterisk MWI API. " alt="" coords="1302,80,1361,107"/>
<area shape="rect" id="node26" href="../../dc/d1d/stasis__state_8c.html" title="stasis_state.c" alt="" coords="1385,80,1496,107"/>
<area shape="rect" id="node27" href="../../de/d6b/test__stasis__state_8c.html" title="test_stasis_state.c" alt="" coords="1520,80,1663,107"/>
<area shape="rect" id="node3" href="../../de/dfe/app__minivm_8c.html" title="MiniVoiceMail &#45; A Minimal Voicemail System for Asterisk. " alt="" coords="5,155,116,181"/>
<area shape="rect" id="node4" href="../../dc/df4/app__voicemail_8c.html" title="Comedian Mail &#45; Voicemail System. " alt="" coords="140,155,264,181"/>
<area shape="rect" id="node5" href="../../d1/d97/chan__dahdi_8c.html" title="DAHDI for Pseudo TDM. " alt="" coords="249,229,355,256"/>
<area shape="rect" id="node6" href="../../d5/db3/chan__dahdi_8h.html" title="DAHDI internal API definitions. " alt="" coords="339,155,446,181"/>
<area shape="rect" id="node8" href="../../d5/dff/chan__iax2_8c.html" title="Implementation of Inter&#45;Asterisk eXchange Version 2 as specified in RFC 5456. " alt="" coords="471,155,568,181"/>
<area shape="rect" id="node9" href="../../d0/dd6/chan__mgcp_8c.html" title="Implementation of Media Gateway Control Protocol. " alt="" coords="593,155,699,181"/>
<area shape="rect" id="node10" href="../../d5/dfe/chan__sip_8c.html" title="Implementation of Session Initiation Protocol. " alt="" coords="724,155,813,181"/>
<area shape="rect" id="node11" href="../../d0/d80/chan__skinny_8c.html" title="Implementation of the Skinny protocol. " alt="" coords="838,155,947,181"/>
<area shape="rect" id="node12" href="../../d1/d6d/chan__unistim_8c.html" title="chan_unistim channel driver for Asterisk " alt="" coords="972,155,1091,181"/>
<area shape="rect" id="node13" href="../../d5/d03/asterisk_8c.html" title="Top level source file for Asterisk &#45; the Open Source PBX. Implementation of PBX core functions and CL..." alt="" coords="1114,155,1197,181"/>
<area shape="rect" id="node14" href="../../d4/d10/manager_8c.html" title="The Asterisk Management Interface &#45; AMI. " alt="" coords="1221,155,1311,181"/>
<area shape="rect" id="node15" href="../../d4/d00/manager__mwi_8c.html" title="The Asterisk Management Interface &#45; AMI (MWI event handling) " alt="" coords="1335,155,1458,181"/>
<area shape="rect" id="node16" href="../../d6/db4/mwi_8c.html" title="mwi.c" alt="" coords="1482,155,1541,181"/>
<area shape="rect" id="node17" href="../../d1/da4/res__corosync_8c.html" title="res_corosync.c" alt="" coords="1565,155,1682,181"/>
<area shape="rect" id="node18" href="../../d2/dd0/res__mwi__devstate_8c.html" title="res_mwi_devstate.c" alt="" coords="1705,155,1853,181"/>
<area shape="rect" id="node19" href="../../d2/d94/res__mwi__external_8c.html" title="Core external MWI support. " alt="" coords="1878,155,2022,181"/>
<area shape="rect" id="node20" href="../../d8/d25/res__pjsip__mwi_8c.html" title="res_pjsip_mwi.c" alt="" coords="2047,155,2168,181"/>
<area shape="rect" id="node21" href="../../dc/d7a/res__pjsip__publish__asterisk_8c.html" title="res_pjsip_publish_asterisk.c" alt="" coords="2192,155,2391,181"/>
<area shape="rect" id="node22" href="../../d8/dca/res__pjsip__pubsub_8c.html" title="res_pjsip_pubsub.c" alt="" coords="2415,155,2557,181"/>
<area shape="rect" id="node23" href="../../d8/d96/res__smdi_8c.html" title="SMDI support for Asterisk. " alt="" coords="2582,155,2673,181"/>
<area shape="rect" id="node24" href="../../dc/d6b/res__xmpp_8c.html" title="XMPP client and component module. " alt="" coords="2697,155,2793,181"/>
<area shape="rect" id="node25" href="../../dd/de5/test__mwi_8c.html" title="test_mwi.c" alt="" coords="2817,155,2907,181"/>
<area shape="rect" id="node7" href="../../d9/da5/bridge__native__dahdi_8c.html" title="Native DAHDI bridging support. " alt="" coords="380,229,541,256"/>
</map>
</div>
</div>
<p><a href="../../d1/d96/stasis__state_8h_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="nested-classes"></a>
Data Structures</h2></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d5/d92/structstasis__state__observer.html">stasis_state_observer</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">Managed stasis state event interface.  <a href="../../d5/d92/structstasis__state__observer.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="typedef-members"></a>
Typedefs</h2></td></tr>
<tr class="memitem:a38a9925f7539e3a27a8dcab3c6946bde"><td class="memItemLeft" align="right" valign="top">typedef int(*&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/d96/stasis__state_8h.html#a38a9925f7539e3a27a8dcab3c6946bde">on_stasis_state</a>) (const char *<a class="el" href="../../d1/da4/res__corosync_8c.html#a2465fd4497a7402ad72da7d6e03f9934">id</a>, struct <a class="el" href="../../d7/d55/structstasis__message.html">stasis_message</a> *msg, void *user_data)</td></tr>
<tr class="memdesc:a38a9925f7539e3a27a8dcab3c6946bde"><td class="mdescLeft">&#160;</td><td class="mdescRight">The delegate called for each managed state.  <a href="#a38a9925f7539e3a27a8dcab3c6946bde">More...</a><br /></td></tr>
<tr class="separator:a38a9925f7539e3a27a8dcab3c6946bde"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a7228670846162446fdf5bd2500c1f64d"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/d96/stasis__state_8h.html#a7228670846162446fdf5bd2500c1f64d">stasis_state_add_observer</a> (struct <a class="el" href="../../d8/d25/structstasis__state__manager.html">stasis_state_manager</a> *manager, struct <a class="el" href="../../d5/d92/structstasis__state__observer.html">stasis_state_observer</a> *<a class="el" href="../../d6/d12/test__sorcery_8c.html#ac7df966a74e4dedc4011a0b8e50f4a42">observer</a>)</td></tr>
<tr class="memdesc:a7228670846162446fdf5bd2500c1f64d"><td class="mdescLeft">&#160;</td><td class="mdescRight">Add an observer to receive managed state related events.  <a href="#a7228670846162446fdf5bd2500c1f64d">More...</a><br /></td></tr>
<tr class="separator:a7228670846162446fdf5bd2500c1f64d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aef7869676ec68c22cc1ac42cadaa36c9"><td class="memItemLeft" align="right" valign="top">struct <a class="el" href="../../df/dcc/structstasis__state__publisher.html">stasis_state_publisher</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/d96/stasis__state_8h.html#aef7869676ec68c22cc1ac42cadaa36c9">stasis_state_add_publisher</a> (struct <a class="el" href="../../d8/d25/structstasis__state__manager.html">stasis_state_manager</a> *manager, const char *<a class="el" href="../../d1/da4/res__corosync_8c.html#a2465fd4497a7402ad72da7d6e03f9934">id</a>)</td></tr>
<tr class="memdesc:aef7869676ec68c22cc1ac42cadaa36c9"><td class="mdescLeft">&#160;</td><td class="mdescRight">Add a publisher to the managed state for the given id.  <a href="#aef7869676ec68c22cc1ac42cadaa36c9">More...</a><br /></td></tr>
<tr class="separator:aef7869676ec68c22cc1ac42cadaa36c9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0826641b8fbe326ff48602f0406be308"><td class="memItemLeft" align="right" valign="top">struct <a class="el" href="../../d7/d67/structstasis__state__subscriber.html">stasis_state_subscriber</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/d96/stasis__state_8h.html#a0826641b8fbe326ff48602f0406be308">stasis_state_add_subscriber</a> (struct <a class="el" href="../../d8/d25/structstasis__state__manager.html">stasis_state_manager</a> *manager, const char *<a class="el" href="../../d1/da4/res__corosync_8c.html#a2465fd4497a7402ad72da7d6e03f9934">id</a>)</td></tr>
<tr class="memdesc:a0826641b8fbe326ff48602f0406be308"><td class="mdescLeft">&#160;</td><td class="mdescRight">Add a subscriber to the managed stasis state for the given id.  <a href="#a0826641b8fbe326ff48602f0406be308">More...</a><br /></td></tr>
<tr class="separator:a0826641b8fbe326ff48602f0406be308"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af3ba55cdf54059b5767c05fe34da9b32"><td class="memItemLeft" align="right" valign="top">struct <a class="el" href="../../d9/d1d/structstasis__topic.html">stasis_topic</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/d96/stasis__state_8h.html#af3ba55cdf54059b5767c05fe34da9b32">stasis_state_all_topic</a> (struct <a class="el" href="../../d8/d25/structstasis__state__manager.html">stasis_state_manager</a> *manager)</td></tr>
<tr class="memdesc:af3ba55cdf54059b5767c05fe34da9b32"><td class="mdescLeft">&#160;</td><td class="mdescRight">Retrieve the manager's topic (the topic that all state topics get forwarded to)  <a href="#af3ba55cdf54059b5767c05fe34da9b32">More...</a><br /></td></tr>
<tr class="separator:af3ba55cdf54059b5767c05fe34da9b32"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a248667e66debb56942035089d06a5421"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/d96/stasis__state_8h.html#a248667e66debb56942035089d06a5421">stasis_state_callback_all</a> (struct <a class="el" href="../../d8/d25/structstasis__state__manager.html">stasis_state_manager</a> *manager, <a class="el" href="../../d1/d96/stasis__state_8h.html#a38a9925f7539e3a27a8dcab3c6946bde">on_stasis_state</a> <a class="el" href="../../da/d03/test__ari_8c.html#a695cc202c7a2869aa8202bb20726ea3c">handler</a>, void *data)</td></tr>
<tr class="memdesc:a248667e66debb56942035089d06a5421"><td class="mdescLeft">&#160;</td><td class="mdescRight">For each managed state call the given handler.  <a href="#a248667e66debb56942035089d06a5421">More...</a><br /></td></tr>
<tr class="separator:a248667e66debb56942035089d06a5421"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac0ac58c28d8742426b40f0c5c7404e76"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/d96/stasis__state_8h.html#ac0ac58c28d8742426b40f0c5c7404e76">stasis_state_callback_subscribed</a> (struct <a class="el" href="../../d8/d25/structstasis__state__manager.html">stasis_state_manager</a> *manager, <a class="el" href="../../d1/d96/stasis__state_8h.html#a38a9925f7539e3a27a8dcab3c6946bde">on_stasis_state</a> <a class="el" href="../../da/d03/test__ari_8c.html#a695cc202c7a2869aa8202bb20726ea3c">handler</a>, void *data)</td></tr>
<tr class="memdesc:ac0ac58c28d8742426b40f0c5c7404e76"><td class="mdescLeft">&#160;</td><td class="mdescRight">For each managed, and explicitly subscribed state call the given handler.  <a href="#ac0ac58c28d8742426b40f0c5c7404e76">More...</a><br /></td></tr>
<tr class="separator:ac0ac58c28d8742426b40f0c5c7404e76"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1e620ce0dace97fda1d99361dda73c9b"><td class="memItemLeft" align="right" valign="top">struct <a class="el" href="../../d8/d25/structstasis__state__manager.html">stasis_state_manager</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/d96/stasis__state_8h.html#a1e620ce0dace97fda1d99361dda73c9b">stasis_state_manager_create</a> (const char *topic_name)</td></tr>
<tr class="memdesc:a1e620ce0dace97fda1d99361dda73c9b"><td class="mdescLeft">&#160;</td><td class="mdescRight">Create a stasis state manager.  <a href="#a1e620ce0dace97fda1d99361dda73c9b">More...</a><br /></td></tr>
<tr class="separator:a1e620ce0dace97fda1d99361dda73c9b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae22f3fe7bbecf70b943d4b72ec9ffcea"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/d96/stasis__state_8h.html#ae22f3fe7bbecf70b943d4b72ec9ffcea">stasis_state_publish</a> (struct <a class="el" href="../../df/dcc/structstasis__state__publisher.html">stasis_state_publisher</a> *pub, struct <a class="el" href="../../d7/d55/structstasis__message.html">stasis_message</a> *msg)</td></tr>
<tr class="memdesc:ae22f3fe7bbecf70b943d4b72ec9ffcea"><td class="mdescLeft">&#160;</td><td class="mdescRight">Publish to a managed state (topic) using a publisher.  <a href="#ae22f3fe7bbecf70b943d4b72ec9ffcea">More...</a><br /></td></tr>
<tr class="separator:ae22f3fe7bbecf70b943d4b72ec9ffcea"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2dbc6c2a3b37e5ab135e410681a23142"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/d96/stasis__state_8h.html#a2dbc6c2a3b37e5ab135e410681a23142">stasis_state_publish_by_id</a> (struct <a class="el" href="../../d8/d25/structstasis__state__manager.html">stasis_state_manager</a> *manager, const char *<a class="el" href="../../d1/da4/res__corosync_8c.html#a2465fd4497a7402ad72da7d6e03f9934">id</a>, const struct <a class="el" href="../../d0/d86/structast__eid.html">ast_eid</a> *eid, struct <a class="el" href="../../d7/d55/structstasis__message.html">stasis_message</a> *msg)</td></tr>
<tr class="memdesc:a2dbc6c2a3b37e5ab135e410681a23142"><td class="mdescLeft">&#160;</td><td class="mdescRight">Publish to a managed named by id topic, and add an implicit subscriber.  <a href="#a2dbc6c2a3b37e5ab135e410681a23142">More...</a><br /></td></tr>
<tr class="separator:a2dbc6c2a3b37e5ab135e410681a23142"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:acb3e1eb79879c114539587a240b455ab"><td class="memItemLeft" align="right" valign="top">const char *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/d96/stasis__state_8h.html#acb3e1eb79879c114539587a240b455ab">stasis_state_publisher_id</a> (const struct <a class="el" href="../../df/dcc/structstasis__state__publisher.html">stasis_state_publisher</a> *pub)</td></tr>
<tr class="memdesc:acb3e1eb79879c114539587a240b455ab"><td class="mdescLeft">&#160;</td><td class="mdescRight">Retrieve the publisher's underlying state's unique id.  <a href="#acb3e1eb79879c114539587a240b455ab">More...</a><br /></td></tr>
<tr class="separator:acb3e1eb79879c114539587a240b455ab"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a323883cc18a212f8eb7ffd4200b0218c"><td class="memItemLeft" align="right" valign="top">struct <a class="el" href="../../d9/d1d/structstasis__topic.html">stasis_topic</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/d96/stasis__state_8h.html#a323883cc18a212f8eb7ffd4200b0218c">stasis_state_publisher_topic</a> (struct <a class="el" href="../../df/dcc/structstasis__state__publisher.html">stasis_state_publisher</a> *pub)</td></tr>
<tr class="memdesc:a323883cc18a212f8eb7ffd4200b0218c"><td class="mdescLeft">&#160;</td><td class="mdescRight">Retrieve the publisher's topic.  <a href="#a323883cc18a212f8eb7ffd4200b0218c">More...</a><br /></td></tr>
<tr class="separator:a323883cc18a212f8eb7ffd4200b0218c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a48ab5b2a6061ca20c816a9ccdf85aeeb"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/d96/stasis__state_8h.html#a48ab5b2a6061ca20c816a9ccdf85aeeb">stasis_state_remove_observer</a> (struct <a class="el" href="../../d8/d25/structstasis__state__manager.html">stasis_state_manager</a> *manager, struct <a class="el" href="../../d5/d92/structstasis__state__observer.html">stasis_state_observer</a> *<a class="el" href="../../d6/d12/test__sorcery_8c.html#ac7df966a74e4dedc4011a0b8e50f4a42">observer</a>)</td></tr>
<tr class="memdesc:a48ab5b2a6061ca20c816a9ccdf85aeeb"><td class="mdescLeft">&#160;</td><td class="mdescRight">Remove an observer (will no longer receive managed state related events).  <a href="#a48ab5b2a6061ca20c816a9ccdf85aeeb">More...</a><br /></td></tr>
<tr class="separator:a48ab5b2a6061ca20c816a9ccdf85aeeb"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:acd6a2d9bb8e46b049966355cda567a37"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/d96/stasis__state_8h.html#acd6a2d9bb8e46b049966355cda567a37">stasis_state_remove_publish_by_id</a> (struct <a class="el" href="../../d8/d25/structstasis__state__manager.html">stasis_state_manager</a> *manager, const char *<a class="el" href="../../d1/da4/res__corosync_8c.html#a2465fd4497a7402ad72da7d6e03f9934">id</a>, const struct <a class="el" href="../../d0/d86/structast__eid.html">ast_eid</a> *eid, struct <a class="el" href="../../d7/d55/structstasis__message.html">stasis_message</a> *msg)</td></tr>
<tr class="memdesc:acd6a2d9bb8e46b049966355cda567a37"><td class="mdescLeft">&#160;</td><td class="mdescRight">Publish to a managed named by id topic, and remove an implicit publisher.  <a href="#acd6a2d9bb8e46b049966355cda567a37">More...</a><br /></td></tr>
<tr class="separator:acd6a2d9bb8e46b049966355cda567a37"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af61eaf43040b329d68b476e647f6a7d6"><td class="memItemLeft" align="right" valign="top">struct <a class="el" href="../../d7/d67/structstasis__state__subscriber.html">stasis_state_subscriber</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/d96/stasis__state_8h.html#af61eaf43040b329d68b476e647f6a7d6">stasis_state_subscribe_pool</a> (struct <a class="el" href="../../d8/d25/structstasis__state__manager.html">stasis_state_manager</a> *manager, const char *<a class="el" href="../../d1/da4/res__corosync_8c.html#a2465fd4497a7402ad72da7d6e03f9934">id</a>, <a class="el" href="../../dd/d79/stasis_8h.html#a2b7854b4fb538be6f885943a24d60c8f">stasis_subscription_cb</a> callback, void *data)</td></tr>
<tr class="memdesc:af61eaf43040b329d68b476e647f6a7d6"><td class="mdescLeft">&#160;</td><td class="mdescRight">Add a subscriber, and subscribe to its underlying stasis topic.  <a href="#af61eaf43040b329d68b476e647f6a7d6">More...</a><br /></td></tr>
<tr class="separator:af61eaf43040b329d68b476e647f6a7d6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3effc7b9731f157205bb2b65c3a2f1b8"><td class="memItemLeft" align="right" valign="top">void *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/d96/stasis__state_8h.html#a3effc7b9731f157205bb2b65c3a2f1b8">stasis_state_subscriber_data</a> (struct <a class="el" href="../../d7/d67/structstasis__state__subscriber.html">stasis_state_subscriber</a> *<a class="el" href="../../d1/da4/res__corosync_8c.html#a8e51289dd0fc7415cee40e7a57b49fdf">sub</a>)</td></tr>
<tr class="memdesc:a3effc7b9731f157205bb2b65c3a2f1b8"><td class="mdescLeft">&#160;</td><td class="mdescRight">Retrieve the last known state stasis message payload for the subscriber.  <a href="#a3effc7b9731f157205bb2b65c3a2f1b8">More...</a><br /></td></tr>
<tr class="separator:a3effc7b9731f157205bb2b65c3a2f1b8"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5eeb2acddec8b7683035b25e8a4cf886"><td class="memItemLeft" align="right" valign="top">const char *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/d96/stasis__state_8h.html#a5eeb2acddec8b7683035b25e8a4cf886">stasis_state_subscriber_id</a> (const struct <a class="el" href="../../d7/d67/structstasis__state__subscriber.html">stasis_state_subscriber</a> *<a class="el" href="../../d1/da4/res__corosync_8c.html#a8e51289dd0fc7415cee40e7a57b49fdf">sub</a>)</td></tr>
<tr class="memdesc:a5eeb2acddec8b7683035b25e8a4cf886"><td class="mdescLeft">&#160;</td><td class="mdescRight">Retrieve the underlying subscribed to state's unique id.  <a href="#a5eeb2acddec8b7683035b25e8a4cf886">More...</a><br /></td></tr>
<tr class="separator:a5eeb2acddec8b7683035b25e8a4cf886"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aaf6aa9b3aba2f94825472d43f81ad284"><td class="memItemLeft" align="right" valign="top">struct <a class="el" href="../../d9/de4/structstasis__subscription.html">stasis_subscription</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/d96/stasis__state_8h.html#aaf6aa9b3aba2f94825472d43f81ad284">stasis_state_subscriber_subscription</a> (struct <a class="el" href="../../d7/d67/structstasis__state__subscriber.html">stasis_state_subscriber</a> *<a class="el" href="../../d1/da4/res__corosync_8c.html#a8e51289dd0fc7415cee40e7a57b49fdf">sub</a>)</td></tr>
<tr class="memdesc:aaf6aa9b3aba2f94825472d43f81ad284"><td class="mdescLeft">&#160;</td><td class="mdescRight">Retrieve the stasis topic subscription if available.  <a href="#aaf6aa9b3aba2f94825472d43f81ad284">More...</a><br /></td></tr>
<tr class="separator:aaf6aa9b3aba2f94825472d43f81ad284"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a904a0f91e443cb185f82e39512381974"><td class="memItemLeft" align="right" valign="top">struct <a class="el" href="../../d9/d1d/structstasis__topic.html">stasis_topic</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/d96/stasis__state_8h.html#a904a0f91e443cb185f82e39512381974">stasis_state_subscriber_topic</a> (struct <a class="el" href="../../d7/d67/structstasis__state__subscriber.html">stasis_state_subscriber</a> *<a class="el" href="../../d1/da4/res__corosync_8c.html#a8e51289dd0fc7415cee40e7a57b49fdf">sub</a>)</td></tr>
<tr class="memdesc:a904a0f91e443cb185f82e39512381974"><td class="mdescLeft">&#160;</td><td class="mdescRight">Retrieve the subscriber's topic.  <a href="#a904a0f91e443cb185f82e39512381974">More...</a><br /></td></tr>
<tr class="separator:a904a0f91e443cb185f82e39512381974"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4096e710d5f849bf345dde006d269548"><td class="memItemLeft" align="right" valign="top">struct <a class="el" href="../../d9/d1d/structstasis__topic.html">stasis_topic</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/d96/stasis__state_8h.html#a4096e710d5f849bf345dde006d269548">stasis_state_topic</a> (struct <a class="el" href="../../d8/d25/structstasis__state__manager.html">stasis_state_manager</a> *manager, const char *<a class="el" href="../../d1/da4/res__corosync_8c.html#a2465fd4497a7402ad72da7d6e03f9934">id</a>)</td></tr>
<tr class="memdesc:a4096e710d5f849bf345dde006d269548"><td class="mdescLeft">&#160;</td><td class="mdescRight">Retrieve a managed topic creating one if not currently managed.  <a href="#a4096e710d5f849bf345dde006d269548">More...</a><br /></td></tr>
<tr class="separator:a4096e710d5f849bf345dde006d269548"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a479b995c5d232c9296809bff7216e37a"><td class="memItemLeft" align="right" valign="top">void *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/d96/stasis__state_8h.html#a479b995c5d232c9296809bff7216e37a">stasis_state_unsubscribe</a> (struct <a class="el" href="../../d7/d67/structstasis__state__subscriber.html">stasis_state_subscriber</a> *<a class="el" href="../../d1/da4/res__corosync_8c.html#a8e51289dd0fc7415cee40e7a57b49fdf">sub</a>)</td></tr>
<tr class="memdesc:a479b995c5d232c9296809bff7216e37a"><td class="mdescLeft">&#160;</td><td class="mdescRight">Unsubscribe from the stasis topic and stasis state.  <a href="#a479b995c5d232c9296809bff7216e37a">More...</a><br /></td></tr>
<tr class="separator:a479b995c5d232c9296809bff7216e37a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a858f0158644f3bb53e1298c98a93f300"><td class="memItemLeft" align="right" valign="top">void *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/d96/stasis__state_8h.html#a858f0158644f3bb53e1298c98a93f300">stasis_state_unsubscribe_and_join</a> (struct <a class="el" href="../../d7/d67/structstasis__state__subscriber.html">stasis_state_subscriber</a> *<a class="el" href="../../d1/da4/res__corosync_8c.html#a8e51289dd0fc7415cee40e7a57b49fdf">sub</a>)</td></tr>
<tr class="memdesc:a858f0158644f3bb53e1298c98a93f300"><td class="mdescLeft">&#160;</td><td class="mdescRight">Unsubscribe from the stasis topic, block until the final message is received, and then unsubscribe from stasis state.  <a href="#a858f0158644f3bb53e1298c98a93f300">More...</a><br /></td></tr>
<tr class="separator:a858f0158644f3bb53e1298c98a93f300"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Stasis State API. </p>
<dl class="section user"><dt>Intro</dt><dd></dd></dl>
<p>This module defines the data structures, and handling of "state" for topics within stasis. State is defined as the last stasis message, and its contained message data, published on a given topic.</p>
<p>Concepts to know:</p><ul>
<li><a class="el" href="../../d8/d25/structstasis__state__manager.html">stasis_state_manager</a></li>
<li><a class="el" href="../../d7/d67/structstasis__state__subscriber.html">stasis_state_subscriber</a></li>
<li><a class="el" href="../../df/dcc/structstasis__state__publisher.html">stasis_state_publisher</a></li>
<li><a class="el" href="../../d5/d92/structstasis__state__observer.html">stasis_state_observer</a></li>
</ul>
<dl class="section user"><dt>stasis_state_manager</dt><dd></dd></dl>
<p>The manager stores and well, manages state data. Each state is an association of a unique stasis topic, and the last known published stasis message on that topic. There is only ever one managed state object per topic. For each topic all messages are forwarded to an "all" topic also maintained by the manager. This allows subscriptions to all managed topics, and their state. Managed state is created in one of several ways:</p>
<p>Adding an explicit subscriber Adding an explicit publisher Adding an implicit publisher Retrieving a stasis state topic from the manager via the <a class="el" href="../../dc/d1d/stasis__state_8c.html#a4096e710d5f849bf345dde006d269548">stasis_state_topic</a> function prior to doing one of the above (DO NOT DO THIS).</p>
<p>More on the first three options later (see relevant section descriptions below). The last option, creation through retrieving a topic is not only NOT recommended, but should NOT even BE DONE. Doing so will inevitably result in a memory leak. Why then is this even allowed? The short answer is backwards compatibility. The slightly longer answer is at the time of this module's creation that's how things were historically done using a combination of stasis topic management spread throughout various other modules, and stasis caching. And yes it did cause a memory leak.</p>
<p>Preferably, any new code wishing to track topics and states should do so by adding either an explicit subscriber and/or publisher.</p>
<dl class="section user"><dt>stasis_state_subscriber</dt><dd></dd></dl>
<p>As mentioned, topic and state can be created, or referenced within the manager by adding a <a class="el" href="../../d7/d67/structstasis__state__subscriber.html">stasis_state_subscriber</a>. When adding a subscriber if no state currently exists new managed state is immediately created. If managed state already exists then a new subscriber is created referencing that state. The managed state is guaranteed to live throughout the subscriber's lifetime. State is only removed from the manager when no other entities require it (no more subscribers, or publishers).</p>
<p>Subscribers are ao2 objects. Therefore there is no explicit cleanup required aside from dereferencing the subscriber object using normal ao2 dereferencing methods.</p>
<dl class="section user"><dt>stasis_state_publisher</dt><dd></dd></dl>
<p>There are two ways of tracking publishers: explicitly and implicitly.</p>
<p>Topic and state can be created, or referenced within the manager by also explicitly adding a <a class="el" href="../../df/dcc/structstasis__state__publisher.html">stasis_state_publisher</a>. When adding a publisher if no state currently exists new managed state is created. If managed state already exists then a new publisher is created referencing that state. The managed state is guaranteed to live throughout the publisher's lifetime. State is only removed from the manager when no other entities require it (no more publishers, or subscribers).</p>
<p>Explicit publishers are ao2 objects. Therefore there is no cleanup required aside from dereferencing the publisher object using normal ao2 dereferencing methods.</p>
<p>When adding an explicit publisher, messages should be published using the <a class="el" href="../../dc/d1d/stasis__state_8c.html#ae22f3fe7bbecf70b943d4b72ec9ffcea">stasis_state_publish</a> function. This not only skips a lookup, but doesn't add an implicit publisher. They are not necessarily mutually exclusive it's just that the two ways exist to solve two different problems.</p>
<p>For example (using an explicit publisher):</p>
<p>// Add an explicit publisher to topic/state "8675309" within // a given manager context pub = stasis_state_add_publisher(manager, "8675309");</p>
<p>// Publish a stasis message to the topic/state stasis_state_publish(pub, msg);</p>
<p>// Publish another a stasis message to the topic/state stasis_state_publish(pub, msg);</p>
<p>// Done with the publisher release the reference ao2_ref(pub, -1);</p>
<p>An implicit publisher can also be created by calling <a class="el" href="../../dc/d1d/stasis__state_8c.html#a2dbc6c2a3b37e5ab135e410681a23142">stasis_state_publish_by_id</a>. Calling this function not only publishes the message within stasis (creating managed state if needed) it also sets up internal tracking of the publishing module using an <a class="el" href="../../d0/d86/structast__eid.html">ast_eid</a>. However, a final call to <a class="el" href="../../dc/d1d/stasis__state_8c.html#acd6a2d9bb8e46b049966355cda567a37">stasis_state_remove_publish_by_id</a> must be done in order to remove the eid reference, which will subsequently allow the underlying managed state to be eventually deleted.</p>
<p>For example (using an implicit publisher):</p>
<p>// Publish a stasis message to topic/state 8675309 within a // given manager context and use the system's default eid stasis_state_publish_by_id(manager, "8675309", NULL, msg);</p>
<p>// Do some stuff and then publish again stasis_state_publish_by_id(manager, "8675309", NULL, msg);</p>
<p>// Done with all our publishing, so post a final clearing // message and remove the implicit publisher stasis_state_remove_publish_by_id(manager, "8675309", NULL, msg);</p>
<p>Explicit publisher/publishing is preferred. However, implicit publishing is allowed for those situations where it makes more sense to do so, but has been implemented mostly for backwards compatibility with some modules (using implicit publishing required less initial code changes to some legacy subsystems).</p>
<dl class="section user"><dt>stasis_state_observer</dt><dd></dd></dl>
<p>Some modules may wish to watch for, and react to managed state events. By registering a state observer, and implementing handlers for the desired callbacks those modules can do so. </p>

<p class="definition">Definition in file <a class="el" href="../../d1/d96/stasis__state_8h_source.html">stasis_state.h</a>.</p>
</div><h2 class="groupheader">Typedef Documentation</h2>
<a id="a38a9925f7539e3a27a8dcab3c6946bde"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a38a9925f7539e3a27a8dcab3c6946bde">&#9670;&nbsp;</a></span>on_stasis_state</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef int(* on_stasis_state) (const char *<a class="el" href="../../d1/da4/res__corosync_8c.html#a2465fd4497a7402ad72da7d6e03f9934">id</a>, struct <a class="el" href="../../d7/d55/structstasis__message.html">stasis_message</a> *msg, void *user_data)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>The delegate called for each managed state. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">id</td><td>The unique id of a managed state object </td></tr>
    <tr><td class="paramname">msg</td><td>The last published message on the state, or NULL </td></tr>
    <tr><td class="paramname">user_data</td><td>Data object the user passed into the manager callback</td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">0</td><td>to continue traversing </td></tr>
    <tr><td class="paramname">CMP_STOP</td><td>(2) to stop traversing</td></tr>
  </table>
  </dd>
</dl>
<dl class="section since"><dt>Since</dt><dd>13.28.0 </dd>
<dd>
16.5.0 </dd></dl>

<p class="definition">Definition at line <a class="el" href="../../d1/d96/stasis__state_8h_source.html#l00521">521</a> of file <a class="el" href="../../d1/d96/stasis__state_8h_source.html">stasis_state.h</a>.</p>

</div>
</div>
<h2 class="groupheader">Function Documentation</h2>
<a id="a7228670846162446fdf5bd2500c1f64d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a7228670846162446fdf5bd2500c1f64d">&#9670;&nbsp;</a></span>stasis_state_add_observer()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int stasis_state_add_observer </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="../../d8/d25/structstasis__state__manager.html">stasis_state_manager</a> *&#160;</td>
          <td class="paramname"><em>manager</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="../../d5/d92/structstasis__state__observer.html">stasis_state_observer</a> *&#160;</td>
          <td class="paramname"><em>observer</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Add an observer to receive managed state related events. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">manager</td><td>The state manager </td></tr>
    <tr><td class="paramname">observer</td><td>The observer handling events</td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">0</td><td>if successfully registered </td></tr>
    <tr><td class="paramname">-1</td><td>on failure</td></tr>
  </table>
  </dd>
</dl>
<dl class="section since"><dt>Since</dt><dd>13.28.0 </dd>
<dd>
16.5.0 </dd></dl>

<p class="definition">Definition at line <a class="el" href="../../dc/d1d/stasis__state_8c_source.html#l00688">688</a> of file <a class="el" href="../../dc/d1d/stasis__state_8c_source.html">stasis_state.c</a>.</p>

<p class="reference">References <a class="el" href="../../d6/d68/vector_8h_source.html#l00256">AST_VECTOR_APPEND</a>, <a class="el" href="../../d6/d68/vector_8h_source.html#l00900">AST_VECTOR_RW_UNLOCK</a>, and <a class="el" href="../../d6/d68/vector_8h_source.html#l00890">AST_VECTOR_RW_WRLOCK</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../d6/db4/mwi_8c_source.html#l00296">ast_mwi_add_observer()</a>, and <a class="el" href="../../de/d6b/test__stasis__state_8c_source.html#l00131">subscriptions_create()</a>.</p>
<div class="fragment"><div class="line"><a name="l00690"></a><span class="lineno">  690</span>&#160;{</div><div class="line"><a name="l00691"></a><span class="lineno">  691</span>&#160;   <span class="keywordtype">int</span> res;</div><div class="line"><a name="l00692"></a><span class="lineno">  692</span>&#160;</div><div class="line"><a name="l00693"></a><span class="lineno">  693</span>&#160;   <a class="code" href="../../d6/d68/vector_8h.html#a468985d2b5ca7410d91108bdd0484348">AST_VECTOR_RW_WRLOCK</a>(&amp;manager-&gt;observers);</div><div class="line"><a name="l00694"></a><span class="lineno">  694</span>&#160;   res = <a class="code" href="../../d6/d68/vector_8h.html#ae9d6199727f88a8c2407cb0e004e634a">AST_VECTOR_APPEND</a>(&amp;manager-&gt;observers, observer);</div><div class="line"><a name="l00695"></a><span class="lineno">  695</span>&#160;   <a class="code" href="../../d6/d68/vector_8h.html#a5ad3dd1d3da5d4ebf6a44d32e42c4c91">AST_VECTOR_RW_UNLOCK</a>(&amp;manager-&gt;observers);</div><div class="line"><a name="l00696"></a><span class="lineno">  696</span>&#160;</div><div class="line"><a name="l00697"></a><span class="lineno">  697</span>&#160;   <span class="keywordflow">return</span> res;</div><div class="line"><a name="l00698"></a><span class="lineno">  698</span>&#160;}</div><div class="ttc" id="vector_8h_html_a5ad3dd1d3da5d4ebf6a44d32e42c4c91"><div class="ttname"><a href="../../d6/d68/vector_8h.html#a5ad3dd1d3da5d4ebf6a44d32e42c4c91">AST_VECTOR_RW_UNLOCK</a></div><div class="ttdeci">#define AST_VECTOR_RW_UNLOCK(vec)</div><div class="ttdoc">Unlock vector. </div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d68/vector_8h_source.html#l00900">vector.h:900</a></div></div>
<div class="ttc" id="vector_8h_html_ae9d6199727f88a8c2407cb0e004e634a"><div class="ttname"><a href="../../d6/d68/vector_8h.html#ae9d6199727f88a8c2407cb0e004e634a">AST_VECTOR_APPEND</a></div><div class="ttdeci">#define AST_VECTOR_APPEND(vec, elem)</div><div class="ttdoc">Append an element to a vector, growing the vector if needed. </div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d68/vector_8h_source.html#l00256">vector.h:256</a></div></div>
<div class="ttc" id="vector_8h_html_a468985d2b5ca7410d91108bdd0484348"><div class="ttname"><a href="../../d6/d68/vector_8h.html#a468985d2b5ca7410d91108bdd0484348">AST_VECTOR_RW_WRLOCK</a></div><div class="ttdeci">#define AST_VECTOR_RW_WRLOCK(vec)</div><div class="ttdoc">Obtain write lock on vector. </div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d68/vector_8h_source.html#l00890">vector.h:890</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="aef7869676ec68c22cc1ac42cadaa36c9"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aef7869676ec68c22cc1ac42cadaa36c9">&#9670;&nbsp;</a></span>stasis_state_add_publisher()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="../../df/dcc/structstasis__state__publisher.html">stasis_state_publisher</a>* stasis_state_add_publisher </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="../../d8/d25/structstasis__state__manager.html">stasis_state_manager</a> *&#160;</td>
          <td class="paramname"><em>manager</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>id</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Add a publisher to the managed state for the given id. </p>
<p>Adds a publisher to a managed state based on id. If managed state does not already exists for the given id then new managed state is created. Otherwise the existing state is used.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">manager</td><td>The manager object </td></tr>
    <tr><td class="paramname">id</td><td>The unique id of a managed state</td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">A</td><td>stasis state publisher </td></tr>
    <tr><td class="paramname">NULL</td><td>if an error occurred</td></tr>
  </table>
  </dd>
</dl>
<dl class="section since"><dt>Since</dt><dd>13.28.0 </dd>
<dd>
16.5.0 </dd></dl>

<p class="definition">Definition at line <a class="el" href="../../dc/d1d/stasis__state_8c_source.html#l00531">531</a> of file <a class="el" href="../../dc/d1d/stasis__state_8c_source.html">stasis_state.c</a>.</p>

<p class="reference">References <a class="el" href="../../dc/d1d/stasis__state_8c_source.html#l00083">stasis_state_manager::all_topic</a>, <a class="el" href="../../d5/da5/astobj2_8h_source.html#l00369">AO2_ALLOC_OPT_LOCK_NOLOCK</a>, <a class="el" href="../../d5/da5/astobj2_8h_source.html#l00406">ao2_alloc_options</a>, <a class="el" href="../../d5/da5/astobj2_8h_source.html#l00464">ao2_ref</a>, <a class="el" href="../../da/df7/astobj2_8c_source.html#l00042">ast_log</a>, <a class="el" href="../../d1/d8c/logger_8h_source.html#l00285">LOG_ERROR</a>, <a class="el" href="../../dc/d7f/resample_8c_source.html#l00096">NULL</a>, <a class="el" href="../../dc/d1d/stasis__state_8c_source.html#l00524">publisher_dtor()</a>, <a class="el" href="../../d0/df4/stasis_8c_source.html#l00628">stasis_topic_name()</a>, <a class="el" href="../../dc/d1d/stasis__state_8c_source.html#l00521">stasis_state_publisher::state</a>, and <a class="el" href="../../dc/d1d/stasis__state_8c_source.html#l00270">state_find_or_add</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../d6/db4/mwi_8c_source.html#l00290">ast_mwi_add_publisher()</a>, and <a class="el" href="../../de/d6b/test__stasis__state_8c_source.html#l00205">publishers_create()</a>.</p>
<div class="fragment"><div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;{</div><div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../df/dcc/structstasis__state__publisher.html">stasis_state_publisher</a> *pub = <a class="code" href="../../d5/da5/astobj2_8h.html#ab3c44e28d661616129b7819069effe61">ao2_alloc_options</a>(</div><div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;      <span class="keyword">sizeof</span>(*pub), <a class="code" href="../../dc/d1d/stasis__state_8c.html#aa8928fc6d762aa8d6bfbc48a12b04e6a">publisher_dtor</a>, <a class="code" href="../../d5/da5/astobj2_8h.html#a2cf7e3433f08351aafe3b0cd31edf7f8a23b60f2636bcfbc4dfeea6cc21bf847b">AO2_ALLOC_OPT_LOCK_NOLOCK</a>);</div><div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;</div><div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;   <span class="keywordflow">if</span> (!pub) {</div><div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Unable to create publisher to %s/%s\n&quot;</span>,</div><div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;         <a class="code" href="../../dd/d79/stasis_8h.html#af23deee342575033bc73311b1215d886">stasis_topic_name</a>(manager-&gt;<a class="code" href="../../d8/d25/structstasis__state__manager.html#a4b36465264544dbb0063d66a9010d866">all_topic</a>), <span class="keywordtype">id</span>);</div><div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;   }</div><div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;</div><div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;   pub-&gt;<a class="code" href="../../df/dcc/structstasis__state__publisher.html#a7657b2fb6d92ad0e32691de4b271867a">state</a> = <a class="code" href="../../dc/d1d/stasis__state_8c.html#a9d69e7d941254c112769ae1d6c2ae5f5">state_find_or_add</a>(manager, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <span class="keywordtype">id</span>);</div><div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;   <span class="keywordflow">if</span> (!pub-&gt;<a class="code" href="../../df/dcc/structstasis__state__publisher.html#a7657b2fb6d92ad0e32691de4b271867a">state</a>) {</div><div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;      <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(pub, -1);</div><div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;   }</div><div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;</div><div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;   <span class="keywordflow">return</span> pub;</div><div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;}</div><div class="ttc" id="stasis__state_8c_html_a9d69e7d941254c112769ae1d6c2ae5f5"><div class="ttname"><a href="../../dc/d1d/stasis__state_8c.html#a9d69e7d941254c112769ae1d6c2ae5f5">state_find_or_add</a></div><div class="ttdeci">#define state_find_or_add(mgr, top, id)</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d1d/stasis__state_8c_source.html#l00270">stasis_state.c:270</a></div></div>
<div class="ttc" id="astobj2_8h_html_a2cf7e3433f08351aafe3b0cd31edf7f8a23b60f2636bcfbc4dfeea6cc21bf847b"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#a2cf7e3433f08351aafe3b0cd31edf7f8a23b60f2636bcfbc4dfeea6cc21bf847b">AO2_ALLOC_OPT_LOCK_NOLOCK</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l00369">astobj2.h:369</a></div></div>
<div class="ttc" id="structstasis__state__publisher_html"><div class="ttname"><a href="../../df/dcc/structstasis__state__publisher.html">stasis_state_publisher</a></div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d1d/stasis__state_8c_source.html#l00519">stasis_state.c:519</a></div></div>
<div class="ttc" id="astobj2_8h_html_ab3c44e28d661616129b7819069effe61"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#ab3c44e28d661616129b7819069effe61">ao2_alloc_options</a></div><div class="ttdeci">#define ao2_alloc_options(data_size, destructor_fn, options)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l00406">astobj2.h:406</a></div></div>
<div class="ttc" id="resample_8c_html_a070d2ce7b6bb7e5c05602aa8c308d0c4"><div class="ttname"><a href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a></div><div class="ttdeci">#define NULL</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d7f/resample_8c_source.html#l00096">resample.c:96</a></div></div>
<div class="ttc" id="structstasis__state__manager_html_a4b36465264544dbb0063d66a9010d866"><div class="ttname"><a href="../../d8/d25/structstasis__state__manager.html#a4b36465264544dbb0063d66a9010d866">stasis_state_manager::all_topic</a></div><div class="ttdeci">struct stasis_topic * all_topic</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d1d/stasis__state_8c_source.html#l00083">stasis_state.c:83</a></div></div>
<div class="ttc" id="astobj2_8c_html_a96a00b3a518d7f32b6d51dc28f09bf9b"><div class="ttname"><a href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a></div><div class="ttdeci">#define ast_log</div><div class="ttdef"><b>Definition:</b> <a href="../../da/df7/astobj2_8c_source.html#l00042">astobj2.c:42</a></div></div>
<div class="ttc" id="astobj2_8h_html_aaca5e8eac39a22f9da1c36fc6c922270"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a></div><div class="ttdeci">#define ao2_ref(o, delta)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l00464">astobj2.h:464</a></div></div>
<div class="ttc" id="stasis__state_8c_html_aa8928fc6d762aa8d6bfbc48a12b04e6a"><div class="ttname"><a href="../../dc/d1d/stasis__state_8c.html#aa8928fc6d762aa8d6bfbc48a12b04e6a">publisher_dtor</a></div><div class="ttdeci">static void publisher_dtor(void *obj)</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d1d/stasis__state_8c_source.html#l00524">stasis_state.c:524</a></div></div>
<div class="ttc" id="logger_8h_html_aced66975c154ea0e2a8ec3bc818b4e08"><div class="ttname"><a href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a></div><div class="ttdeci">#define LOG_ERROR</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d8c/logger_8h_source.html#l00285">logger.h:285</a></div></div>
<div class="ttc" id="stasis_8h_html_af23deee342575033bc73311b1215d886"><div class="ttname"><a href="../../dd/d79/stasis_8h.html#af23deee342575033bc73311b1215d886">stasis_topic_name</a></div><div class="ttdeci">const char * stasis_topic_name(const struct stasis_topic *topic)</div><div class="ttdoc">Return the name of a topic. </div><div class="ttdef"><b>Definition:</b> <a href="../../d0/df4/stasis_8c_source.html#l00628">stasis.c:628</a></div></div>
<div class="ttc" id="structstasis__state__publisher_html_a7657b2fb6d92ad0e32691de4b271867a"><div class="ttname"><a href="../../df/dcc/structstasis__state__publisher.html#a7657b2fb6d92ad0e32691de4b271867a">stasis_state_publisher::state</a></div><div class="ttdeci">struct stasis_state * state</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d1d/stasis__state_8c_source.html#l00521">stasis_state.c:521</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a0826641b8fbe326ff48602f0406be308"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0826641b8fbe326ff48602f0406be308">&#9670;&nbsp;</a></span>stasis_state_add_subscriber()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="../../d7/d67/structstasis__state__subscriber.html">stasis_state_subscriber</a>* stasis_state_add_subscriber </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="../../d8/d25/structstasis__state__manager.html">stasis_state_manager</a> *&#160;</td>
          <td class="paramname"><em>manager</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>id</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Add a subscriber to the managed stasis state for the given id. </p>
<p>Adds a subscriber to a managed state based on id. If managed state does not already exists for the given id then new managed state is created. Otherwise the existing state is subscribed to.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">manager</td><td>The manager object </td></tr>
    <tr><td class="paramname">id</td><td>The unique id of a managed state</td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">A</td><td>stasis state subscriber </td></tr>
    <tr><td class="paramname">NULL</td><td>if an error occurred</td></tr>
  </table>
  </dd>
</dl>
<dl class="section since"><dt>Since</dt><dd>13.28.0 </dd>
<dd>
16.5.0 </dd></dl>

<p class="definition">Definition at line <a class="el" href="../../dc/d1d/stasis__state_8c_source.html#l00412">412</a> of file <a class="el" href="../../dc/d1d/stasis__state_8c_source.html">stasis_state.c</a>.</p>

<p class="reference">References <a class="el" href="../../dc/d1d/stasis__state_8c_source.html#l00083">stasis_state_manager::all_topic</a>, <a class="el" href="../../d5/da5/astobj2_8h_source.html#l00369">AO2_ALLOC_OPT_LOCK_NOLOCK</a>, <a class="el" href="../../d5/da5/astobj2_8h_source.html#l00406">ao2_alloc_options</a>, <a class="el" href="../../d5/da5/astobj2_8h_source.html#l00718">ao2_lock</a>, <a class="el" href="../../d5/da5/astobj2_8h_source.html#l00464">ao2_ref</a>, <a class="el" href="../../d5/da5/astobj2_8h_source.html#l00730">ao2_unlock</a>, <a class="el" href="../../da/df7/astobj2_8c_source.html#l00042">ast_log</a>, <a class="el" href="../../d6/d68/vector_8h_source.html#l00682">AST_VECTOR_GET</a>, <a class="el" href="../../d6/d68/vector_8h_source.html#l00880">AST_VECTOR_RW_RDLOCK</a>, <a class="el" href="../../d6/d68/vector_8h_source.html#l00900">AST_VECTOR_RW_UNLOCK</a>, <a class="el" href="../../d6/d68/vector_8h_source.html#l00611">AST_VECTOR_SIZE</a>, <a class="el" href="../../d1/d8c/logger_8h_source.html#l00285">LOG_ERROR</a>, <a class="el" href="../../dc/d7f/resample_8c_source.html#l00096">NULL</a>, <a class="el" href="../../dc/d1d/stasis__state_8c_source.html#l00052">stasis_state::num_subscribers</a>, <a class="el" href="../../d0/df4/stasis_8c_source.html#l00628">stasis_topic_name()</a>, <a class="el" href="../../dc/d1d/stasis__state_8c_source.html#l00386">stasis_state_subscriber::state</a>, <a class="el" href="../../dc/d1d/stasis__state_8c_source.html#l00270">state_find_or_add</a>, <a class="el" href="../../d1/da4/res__corosync_8c_source.html#l00240">sub</a>, and <a class="el" href="../../dc/d1d/stasis__state_8c_source.html#l00391">subscriber_dtor()</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../d6/db4/mwi_8c_source.html#l00224">ast_mwi_add_subscriber()</a>, and <a class="el" href="../../dc/d1d/stasis__state_8c_source.html#l00446">stasis_state_subscribe_pool()</a>.</p>
<div class="fragment"><div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;{</div><div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;   <span class="keywordtype">size_t</span> i;</div><div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d7/d67/structstasis__state__subscriber.html">stasis_state_subscriber</a> *<a class="code" href="../../d1/da4/res__corosync_8c.html#a8e51289dd0fc7415cee40e7a57b49fdf">sub</a> = <a class="code" href="../../d5/da5/astobj2_8h.html#ab3c44e28d661616129b7819069effe61">ao2_alloc_options</a>(</div><div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;      <span class="keyword">sizeof</span>(*sub), <a class="code" href="../../dc/d1d/stasis__state_8c.html#aa4c06124c1a71446a10d133c905b0f03">subscriber_dtor</a>, <a class="code" href="../../d5/da5/astobj2_8h.html#a2cf7e3433f08351aafe3b0cd31edf7f8a23b60f2636bcfbc4dfeea6cc21bf847b">AO2_ALLOC_OPT_LOCK_NOLOCK</a>);</div><div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;</div><div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;   <span class="keywordflow">if</span> (!sub) {</div><div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;      <a class="code" href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a>(<a class="code" href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a>, <span class="stringliteral">&quot;Unable to create subscriber to %s/%s\n&quot;</span>,</div><div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;         <a class="code" href="../../dd/d79/stasis_8h.html#af23deee342575033bc73311b1215d886">stasis_topic_name</a>(manager-&gt;<a class="code" href="../../d8/d25/structstasis__state__manager.html#a4b36465264544dbb0063d66a9010d866">all_topic</a>), <span class="keywordtype">id</span>);</div><div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;   }</div><div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;</div><div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;   sub-&gt;<a class="code" href="../../d7/d67/structstasis__state__subscriber.html#a7657b2fb6d92ad0e32691de4b271867a">state</a> = <a class="code" href="../../dc/d1d/stasis__state_8c.html#a9d69e7d941254c112769ae1d6c2ae5f5">state_find_or_add</a>(manager, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <span class="keywordtype">id</span>);</div><div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;   <span class="keywordflow">if</span> (!sub-&gt;<a class="code" href="../../d7/d67/structstasis__state__subscriber.html#a7657b2fb6d92ad0e32691de4b271867a">state</a>) {</div><div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;      <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(sub, -1);</div><div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;   }</div><div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;</div><div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#aa9fdb5d0a6157a56060d9f7279fe6c49">ao2_lock</a>(sub-&gt;<a class="code" href="../../d7/d67/structstasis__state__subscriber.html#a7657b2fb6d92ad0e32691de4b271867a">state</a>);</div><div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;   ++sub-&gt;<a class="code" href="../../d7/d67/structstasis__state__subscriber.html#a7657b2fb6d92ad0e32691de4b271867a">state</a>-&gt;<a class="code" href="../../d6/d75/structstasis__state.html#aeffbfbab5dabd4de4beb0c6190b01759">num_subscribers</a>;</div><div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#a9998bd156b936636a8780385e9a910b2">ao2_unlock</a>(sub-&gt;<a class="code" href="../../d7/d67/structstasis__state__subscriber.html#a7657b2fb6d92ad0e32691de4b271867a">state</a>);</div><div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;</div><div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;   <a class="code" href="../../d6/d68/vector_8h.html#ad414eae87431bad2a7fc4dffa9d06350">AST_VECTOR_RW_RDLOCK</a>(&amp;manager-&gt;observers);</div><div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;   <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="../../d6/d68/vector_8h.html#a20b08af81cc9452fb721c9a698f81bdf">AST_VECTOR_SIZE</a>(&amp;manager-&gt;observers); ++i) {</div><div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="../../d6/d68/vector_8h.html#aef32ac52c3e8a530d16eb92cde22cacd">AST_VECTOR_GET</a>(&amp;manager-&gt;observers, i)-&gt;on_subscribe) {</div><div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;         <a class="code" href="../../d6/d68/vector_8h.html#aef32ac52c3e8a530d16eb92cde22cacd">AST_VECTOR_GET</a>(&amp;manager-&gt;observers, i)-&gt;on_subscribe(<span class="keywordtype">id</span>, sub);</div><div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;      }</div><div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;   }</div><div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;   <a class="code" href="../../d6/d68/vector_8h.html#a5ad3dd1d3da5d4ebf6a44d32e42c4c91">AST_VECTOR_RW_UNLOCK</a>(&amp;manager-&gt;observers);</div><div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;</div><div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;   <span class="keywordflow">return</span> <a class="code" href="../../d1/da4/res__corosync_8c.html#a8e51289dd0fc7415cee40e7a57b49fdf">sub</a>;</div><div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;}</div><div class="ttc" id="structstasis__state__subscriber_html_a7657b2fb6d92ad0e32691de4b271867a"><div class="ttname"><a href="../../d7/d67/structstasis__state__subscriber.html#a7657b2fb6d92ad0e32691de4b271867a">stasis_state_subscriber::state</a></div><div class="ttdeci">struct stasis_state * state</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d1d/stasis__state_8c_source.html#l00386">stasis_state.c:386</a></div></div>
<div class="ttc" id="stasis__state_8c_html_a9d69e7d941254c112769ae1d6c2ae5f5"><div class="ttname"><a href="../../dc/d1d/stasis__state_8c.html#a9d69e7d941254c112769ae1d6c2ae5f5">state_find_or_add</a></div><div class="ttdeci">#define state_find_or_add(mgr, top, id)</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d1d/stasis__state_8c_source.html#l00270">stasis_state.c:270</a></div></div>
<div class="ttc" id="astobj2_8h_html_a2cf7e3433f08351aafe3b0cd31edf7f8a23b60f2636bcfbc4dfeea6cc21bf847b"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#a2cf7e3433f08351aafe3b0cd31edf7f8a23b60f2636bcfbc4dfeea6cc21bf847b">AO2_ALLOC_OPT_LOCK_NOLOCK</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l00369">astobj2.h:369</a></div></div>
<div class="ttc" id="vector_8h_html_a5ad3dd1d3da5d4ebf6a44d32e42c4c91"><div class="ttname"><a href="../../d6/d68/vector_8h.html#a5ad3dd1d3da5d4ebf6a44d32e42c4c91">AST_VECTOR_RW_UNLOCK</a></div><div class="ttdeci">#define AST_VECTOR_RW_UNLOCK(vec)</div><div class="ttdoc">Unlock vector. </div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d68/vector_8h_source.html#l00900">vector.h:900</a></div></div>
<div class="ttc" id="vector_8h_html_ad414eae87431bad2a7fc4dffa9d06350"><div class="ttname"><a href="../../d6/d68/vector_8h.html#ad414eae87431bad2a7fc4dffa9d06350">AST_VECTOR_RW_RDLOCK</a></div><div class="ttdeci">#define AST_VECTOR_RW_RDLOCK(vec)</div><div class="ttdoc">Obtain read lock on vector. </div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d68/vector_8h_source.html#l00880">vector.h:880</a></div></div>
<div class="ttc" id="astobj2_8h_html_ab3c44e28d661616129b7819069effe61"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#ab3c44e28d661616129b7819069effe61">ao2_alloc_options</a></div><div class="ttdeci">#define ao2_alloc_options(data_size, destructor_fn, options)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l00406">astobj2.h:406</a></div></div>
<div class="ttc" id="astobj2_8h_html_a9998bd156b936636a8780385e9a910b2"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#a9998bd156b936636a8780385e9a910b2">ao2_unlock</a></div><div class="ttdeci">#define ao2_unlock(a)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l00730">astobj2.h:730</a></div></div>
<div class="ttc" id="resample_8c_html_a070d2ce7b6bb7e5c05602aa8c308d0c4"><div class="ttname"><a href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a></div><div class="ttdeci">#define NULL</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d7f/resample_8c_source.html#l00096">resample.c:96</a></div></div>
<div class="ttc" id="structstasis__state__manager_html_a4b36465264544dbb0063d66a9010d866"><div class="ttname"><a href="../../d8/d25/structstasis__state__manager.html#a4b36465264544dbb0063d66a9010d866">stasis_state_manager::all_topic</a></div><div class="ttdeci">struct stasis_topic * all_topic</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d1d/stasis__state_8c_source.html#l00083">stasis_state.c:83</a></div></div>
<div class="ttc" id="astobj2_8c_html_a96a00b3a518d7f32b6d51dc28f09bf9b"><div class="ttname"><a href="../../da/df7/astobj2_8c.html#a96a00b3a518d7f32b6d51dc28f09bf9b">ast_log</a></div><div class="ttdeci">#define ast_log</div><div class="ttdef"><b>Definition:</b> <a href="../../da/df7/astobj2_8c_source.html#l00042">astobj2.c:42</a></div></div>
<div class="ttc" id="astobj2_8h_html_aaca5e8eac39a22f9da1c36fc6c922270"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a></div><div class="ttdeci">#define ao2_ref(o, delta)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l00464">astobj2.h:464</a></div></div>
<div class="ttc" id="astobj2_8h_html_aa9fdb5d0a6157a56060d9f7279fe6c49"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#aa9fdb5d0a6157a56060d9f7279fe6c49">ao2_lock</a></div><div class="ttdeci">#define ao2_lock(a)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l00718">astobj2.h:718</a></div></div>
<div class="ttc" id="logger_8h_html_aced66975c154ea0e2a8ec3bc818b4e08"><div class="ttname"><a href="../../d1/d8c/logger_8h.html#aced66975c154ea0e2a8ec3bc818b4e08">LOG_ERROR</a></div><div class="ttdeci">#define LOG_ERROR</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d8c/logger_8h_source.html#l00285">logger.h:285</a></div></div>
<div class="ttc" id="stasis__state_8c_html_aa4c06124c1a71446a10d133c905b0f03"><div class="ttname"><a href="../../dc/d1d/stasis__state_8c.html#aa4c06124c1a71446a10d133c905b0f03">subscriber_dtor</a></div><div class="ttdeci">static void subscriber_dtor(void *obj)</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d1d/stasis__state_8c_source.html#l00391">stasis_state.c:391</a></div></div>
<div class="ttc" id="stasis_8h_html_af23deee342575033bc73311b1215d886"><div class="ttname"><a href="../../dd/d79/stasis_8h.html#af23deee342575033bc73311b1215d886">stasis_topic_name</a></div><div class="ttdeci">const char * stasis_topic_name(const struct stasis_topic *topic)</div><div class="ttdoc">Return the name of a topic. </div><div class="ttdef"><b>Definition:</b> <a href="../../d0/df4/stasis_8c_source.html#l00628">stasis.c:628</a></div></div>
<div class="ttc" id="vector_8h_html_aef32ac52c3e8a530d16eb92cde22cacd"><div class="ttname"><a href="../../d6/d68/vector_8h.html#aef32ac52c3e8a530d16eb92cde22cacd">AST_VECTOR_GET</a></div><div class="ttdeci">#define AST_VECTOR_GET(vec, idx)</div><div class="ttdoc">Get an element from a vector. </div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d68/vector_8h_source.html#l00682">vector.h:682</a></div></div>
<div class="ttc" id="structstasis__state__subscriber_html"><div class="ttname"><a href="../../d7/d67/structstasis__state__subscriber.html">stasis_state_subscriber</a></div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d1d/stasis__state_8c_source.html#l00384">stasis_state.c:384</a></div></div>
<div class="ttc" id="res__corosync_8c_html_a8e51289dd0fc7415cee40e7a57b49fdf"><div class="ttname"><a href="../../d1/da4/res__corosync_8c.html#a8e51289dd0fc7415cee40e7a57b49fdf">sub</a></div><div class="ttdeci">struct stasis_forward * sub</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/da4/res__corosync_8c_source.html#l00240">res_corosync.c:240</a></div></div>
<div class="ttc" id="structstasis__state_html_aeffbfbab5dabd4de4beb0c6190b01759"><div class="ttname"><a href="../../d6/d75/structstasis__state.html#aeffbfbab5dabd4de4beb0c6190b01759">stasis_state::num_subscribers</a></div><div class="ttdeci">unsigned int num_subscribers</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d1d/stasis__state_8c_source.html#l00052">stasis_state.c:52</a></div></div>
<div class="ttc" id="vector_8h_html_a20b08af81cc9452fb721c9a698f81bdf"><div class="ttname"><a href="../../d6/d68/vector_8h.html#a20b08af81cc9452fb721c9a698f81bdf">AST_VECTOR_SIZE</a></div><div class="ttdeci">#define AST_VECTOR_SIZE(vec)</div><div class="ttdoc">Get the number of elements in a vector. </div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d68/vector_8h_source.html#l00611">vector.h:611</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="af3ba55cdf54059b5767c05fe34da9b32"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af3ba55cdf54059b5767c05fe34da9b32">&#9670;&nbsp;</a></span>stasis_state_all_topic()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="../../d9/d1d/structstasis__topic.html">stasis_topic</a>* stasis_state_all_topic </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="../../d8/d25/structstasis__state__manager.html">stasis_state_manager</a> *&#160;</td>
          <td class="paramname"><em>manager</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Retrieve the manager's topic (the topic that all state topics get forwarded to) </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">manager</td><td>The manager object</td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">The</td><td>manager's topic.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section since"><dt>Since</dt><dd>13.28.0 </dd>
<dd>
16.5.0 </dd></dl>

<p class="definition">Definition at line <a class="el" href="../../dc/d1d/stasis__state_8c_source.html#l00364">364</a> of file <a class="el" href="../../dc/d1d/stasis__state_8c_source.html">stasis_state.c</a>.</p>

<p class="reference">References <a class="el" href="../../dc/d1d/stasis__state_8c_source.html#l00083">stasis_state_manager::all_topic</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../d6/db4/mwi_8c_source.html#l00085">ast_mwi_topic_all()</a>.</p>
<div class="fragment"><div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;{</div><div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;   <span class="keywordflow">return</span> manager-&gt;<a class="code" href="../../d8/d25/structstasis__state__manager.html#a4b36465264544dbb0063d66a9010d866">all_topic</a>;</div><div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;}</div><div class="ttc" id="structstasis__state__manager_html_a4b36465264544dbb0063d66a9010d866"><div class="ttname"><a href="../../d8/d25/structstasis__state__manager.html#a4b36465264544dbb0063d66a9010d866">stasis_state_manager::all_topic</a></div><div class="ttdeci">struct stasis_topic * all_topic</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d1d/stasis__state_8c_source.html#l00083">stasis_state.c:83</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a248667e66debb56942035089d06a5421"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a248667e66debb56942035089d06a5421">&#9670;&nbsp;</a></span>stasis_state_callback_all()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void stasis_state_callback_all </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="../../d8/d25/structstasis__state__manager.html">stasis_state_manager</a> *&#160;</td>
          <td class="paramname"><em>manager</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../d1/d96/stasis__state_8h.html#a38a9925f7539e3a27a8dcab3c6946bde">on_stasis_state</a>&#160;</td>
          <td class="paramname"><em>handler</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>data</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>For each managed state call the given handler. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">manager</td><td>The state manager </td></tr>
    <tr><td class="paramname">handler</td><td>The handler to call for each managed state </td></tr>
    <tr><td class="paramname">data</td><td>User to data to pass on to the handler</td></tr>
  </table>
  </dd>
</dl>
<dl class="section since"><dt>Since</dt><dd>13.28.0 </dd>
<dd>
16.5.0 </dd></dl>

<p class="definition">Definition at line <a class="el" href="../../dc/d1d/stasis__state_8c_source.html#l00740">740</a> of file <a class="el" href="../../dc/d1d/stasis__state_8c_source.html">stasis_state.c</a>.</p>

<p class="reference">References <a class="el" href="../../d5/da5/astobj2_8h_source.html#l01743">ao2_callback_data</a>, <a class="el" href="../../d5/d60/utils_8h_source.html#l00695">ast_assert</a>, <a class="el" href="../../dc/d1d/stasis__state_8c_source.html#l00726">handle_stasis_state_proxy()</a>, <a class="el" href="../../dc/d7f/resample_8c_source.html#l00096">NULL</a>, <a class="el" href="../../d5/da5/astobj2_8h_source.html#l01053">OBJ_MULTIPLE</a>, <a class="el" href="../../d5/da5/astobj2_8h_source.html#l01048">OBJ_NODATA</a>, and <a class="el" href="../../dc/d1d/stasis__state_8c_source.html#l00081">stasis_state_manager::states</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../d6/db4/mwi_8c_source.html#l00333">ast_mwi_state_callback_all()</a>, and <a class="el" href="../../de/d6b/test__stasis__state_8c_source.html#l00328">publish()</a>.</p>
<div class="fragment"><div class="line"><a name="l00742"></a><span class="lineno">  742</span>&#160;{</div><div class="line"><a name="l00743"></a><span class="lineno">  743</span>&#160;   <a class="code" href="../../d5/d60/utils_8h.html#a24374da24af1931d8a7ccde5b352bb2c">ast_assert</a>(<a class="code" href="../../da/d03/test__ari_8c.html#a695cc202c7a2869aa8202bb20726ea3c">handler</a> != <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div><div class="line"><a name="l00744"></a><span class="lineno">  744</span>&#160;</div><div class="line"><a name="l00745"></a><span class="lineno">  745</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#a63fd831fe48aed32d3ef992ad8e45293">ao2_callback_data</a>(manager-&gt;<a class="code" href="../../d8/d25/structstasis__state__manager.html#a18c5b21cd31cd417cb9d1a534cce95e1">states</a>, <a class="code" href="../../d5/da5/astobj2_8h.html#ad9d009e87e737af900825b36db55a35ca614744a4d36b3189d4ab5b02c8645d47">OBJ_MULTIPLE</a> | <a class="code" href="../../d5/da5/astobj2_8h.html#ad9d009e87e737af900825b36db55a35ca5fc59b193d86a0a8ddfe866304be829d">OBJ_NODATA</a>,</div><div class="line"><a name="l00746"></a><span class="lineno">  746</span>&#160;      <a class="code" href="../../dc/d1d/stasis__state_8c.html#a6b695bcf759083a5037c9a5ceaf952db">handle_stasis_state_proxy</a>, <a class="code" href="../../da/d03/test__ari_8c.html#a695cc202c7a2869aa8202bb20726ea3c">handler</a>, data);</div><div class="line"><a name="l00747"></a><span class="lineno">  747</span>&#160;}</div><div class="ttc" id="astobj2_8h_html_ad9d009e87e737af900825b36db55a35ca5fc59b193d86a0a8ddfe866304be829d"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#ad9d009e87e737af900825b36db55a35ca5fc59b193d86a0a8ddfe866304be829d">OBJ_NODATA</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l01048">astobj2.h:1048</a></div></div>
<div class="ttc" id="utils_8h_html_a24374da24af1931d8a7ccde5b352bb2c"><div class="ttname"><a href="../../d5/d60/utils_8h.html#a24374da24af1931d8a7ccde5b352bb2c">ast_assert</a></div><div class="ttdeci">#define ast_assert(a)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d60/utils_8h_source.html#l00695">utils.h:695</a></div></div>
<div class="ttc" id="resample_8c_html_a070d2ce7b6bb7e5c05602aa8c308d0c4"><div class="ttname"><a href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a></div><div class="ttdeci">#define NULL</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d7f/resample_8c_source.html#l00096">resample.c:96</a></div></div>
<div class="ttc" id="astobj2_8h_html_a63fd831fe48aed32d3ef992ad8e45293"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#a63fd831fe48aed32d3ef992ad8e45293">ao2_callback_data</a></div><div class="ttdeci">#define ao2_callback_data(container, flags, cb_fn, arg, data)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l01743">astobj2.h:1743</a></div></div>
<div class="ttc" id="stasis__state_8c_html_a6b695bcf759083a5037c9a5ceaf952db"><div class="ttname"><a href="../../dc/d1d/stasis__state_8c.html#a6b695bcf759083a5037c9a5ceaf952db">handle_stasis_state_proxy</a></div><div class="ttdeci">static int handle_stasis_state_proxy(void *obj, void *arg, void *data, int flags)</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d1d/stasis__state_8c_source.html#l00726">stasis_state.c:726</a></div></div>
<div class="ttc" id="test__ari_8c_html_a695cc202c7a2869aa8202bb20726ea3c"><div class="ttname"><a href="../../da/d03/test__ari_8c.html#a695cc202c7a2869aa8202bb20726ea3c">handler</a></div><div class="ttdeci">static void handler(const char *name, int response_code, struct ast_variable *get_params, struct ast_variable *path_vars, struct ast_variable *headers, struct ast_json *body, struct ast_ari_response *response)</div><div class="ttdef"><b>Definition:</b> <a href="../../da/d03/test__ari_8c_source.html#l00059">test_ari.c:59</a></div></div>
<div class="ttc" id="structstasis__state__manager_html_a18c5b21cd31cd417cb9d1a534cce95e1"><div class="ttname"><a href="../../d8/d25/structstasis__state__manager.html#a18c5b21cd31cd417cb9d1a534cce95e1">stasis_state_manager::states</a></div><div class="ttdeci">struct ao2_container * states</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d1d/stasis__state_8c_source.html#l00081">stasis_state.c:81</a></div></div>
<div class="ttc" id="astobj2_8h_html_ad9d009e87e737af900825b36db55a35ca614744a4d36b3189d4ab5b02c8645d47"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#ad9d009e87e737af900825b36db55a35ca614744a4d36b3189d4ab5b02c8645d47">OBJ_MULTIPLE</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l01053">astobj2.h:1053</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="ac0ac58c28d8742426b40f0c5c7404e76"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac0ac58c28d8742426b40f0c5c7404e76">&#9670;&nbsp;</a></span>stasis_state_callback_subscribed()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void stasis_state_callback_subscribed </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="../../d8/d25/structstasis__state__manager.html">stasis_state_manager</a> *&#160;</td>
          <td class="paramname"><em>manager</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../d1/d96/stasis__state_8h.html#a38a9925f7539e3a27a8dcab3c6946bde">on_stasis_state</a>&#160;</td>
          <td class="paramname"><em>handler</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>data</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>For each managed, and explicitly subscribed state call the given handler. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">manager</td><td>The state manager </td></tr>
    <tr><td class="paramname">handler</td><td>The handler to call for each managed state </td></tr>
    <tr><td class="paramname">data</td><td>User to data to pass on to the handler</td></tr>
  </table>
  </dd>
</dl>
<dl class="section since"><dt>Since</dt><dd>13.28.0 </dd>
<dd>
16.5.0 </dd></dl>

<p class="definition">Definition at line <a class="el" href="../../dc/d1d/stasis__state_8c_source.html#l00763">763</a> of file <a class="el" href="../../dc/d1d/stasis__state_8c_source.html">stasis_state.c</a>.</p>

<p class="reference">References <a class="el" href="../../d5/da5/astobj2_8h_source.html#l01743">ao2_callback_data</a>, <a class="el" href="../../d5/d60/utils_8h_source.html#l00695">ast_assert</a>, <a class="el" href="../../dc/d1d/stasis__state_8c_source.html#l00749">handle_stasis_state_subscribed()</a>, <a class="el" href="../../dc/d7f/resample_8c_source.html#l00096">NULL</a>, <a class="el" href="../../d5/da5/astobj2_8h_source.html#l01053">OBJ_MULTIPLE</a>, <a class="el" href="../../d5/da5/astobj2_8h_source.html#l01048">OBJ_NODATA</a>, and <a class="el" href="../../dc/d1d/stasis__state_8c_source.html#l00081">stasis_state_manager::states</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../d6/db4/mwi_8c_source.html#l00343">ast_mwi_state_callback_subscribed()</a>.</p>
<div class="fragment"><div class="line"><a name="l00765"></a><span class="lineno">  765</span>&#160;{</div><div class="line"><a name="l00766"></a><span class="lineno">  766</span>&#160;   <a class="code" href="../../d5/d60/utils_8h.html#a24374da24af1931d8a7ccde5b352bb2c">ast_assert</a>(<a class="code" href="../../da/d03/test__ari_8c.html#a695cc202c7a2869aa8202bb20726ea3c">handler</a> != <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div><div class="line"><a name="l00767"></a><span class="lineno">  767</span>&#160;</div><div class="line"><a name="l00768"></a><span class="lineno">  768</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#a63fd831fe48aed32d3ef992ad8e45293">ao2_callback_data</a>(manager-&gt;<a class="code" href="../../d8/d25/structstasis__state__manager.html#a18c5b21cd31cd417cb9d1a534cce95e1">states</a>, <a class="code" href="../../d5/da5/astobj2_8h.html#ad9d009e87e737af900825b36db55a35ca614744a4d36b3189d4ab5b02c8645d47">OBJ_MULTIPLE</a> | <a class="code" href="../../d5/da5/astobj2_8h.html#ad9d009e87e737af900825b36db55a35ca5fc59b193d86a0a8ddfe866304be829d">OBJ_NODATA</a>,</div><div class="line"><a name="l00769"></a><span class="lineno">  769</span>&#160;      <a class="code" href="../../dc/d1d/stasis__state_8c.html#a375c8275bb862ff8c0fe9520060f5bc8">handle_stasis_state_subscribed</a>, <a class="code" href="../../da/d03/test__ari_8c.html#a695cc202c7a2869aa8202bb20726ea3c">handler</a>, data);</div><div class="line"><a name="l00770"></a><span class="lineno">  770</span>&#160;}</div><div class="ttc" id="astobj2_8h_html_ad9d009e87e737af900825b36db55a35ca5fc59b193d86a0a8ddfe866304be829d"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#ad9d009e87e737af900825b36db55a35ca5fc59b193d86a0a8ddfe866304be829d">OBJ_NODATA</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l01048">astobj2.h:1048</a></div></div>
<div class="ttc" id="utils_8h_html_a24374da24af1931d8a7ccde5b352bb2c"><div class="ttname"><a href="../../d5/d60/utils_8h.html#a24374da24af1931d8a7ccde5b352bb2c">ast_assert</a></div><div class="ttdeci">#define ast_assert(a)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d60/utils_8h_source.html#l00695">utils.h:695</a></div></div>
<div class="ttc" id="resample_8c_html_a070d2ce7b6bb7e5c05602aa8c308d0c4"><div class="ttname"><a href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a></div><div class="ttdeci">#define NULL</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d7f/resample_8c_source.html#l00096">resample.c:96</a></div></div>
<div class="ttc" id="stasis__state_8c_html_a375c8275bb862ff8c0fe9520060f5bc8"><div class="ttname"><a href="../../dc/d1d/stasis__state_8c.html#a375c8275bb862ff8c0fe9520060f5bc8">handle_stasis_state_subscribed</a></div><div class="ttdeci">static int handle_stasis_state_subscribed(void *obj, void *arg, void *data, int flags)</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d1d/stasis__state_8c_source.html#l00749">stasis_state.c:749</a></div></div>
<div class="ttc" id="astobj2_8h_html_a63fd831fe48aed32d3ef992ad8e45293"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#a63fd831fe48aed32d3ef992ad8e45293">ao2_callback_data</a></div><div class="ttdeci">#define ao2_callback_data(container, flags, cb_fn, arg, data)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l01743">astobj2.h:1743</a></div></div>
<div class="ttc" id="test__ari_8c_html_a695cc202c7a2869aa8202bb20726ea3c"><div class="ttname"><a href="../../da/d03/test__ari_8c.html#a695cc202c7a2869aa8202bb20726ea3c">handler</a></div><div class="ttdeci">static void handler(const char *name, int response_code, struct ast_variable *get_params, struct ast_variable *path_vars, struct ast_variable *headers, struct ast_json *body, struct ast_ari_response *response)</div><div class="ttdef"><b>Definition:</b> <a href="../../da/d03/test__ari_8c_source.html#l00059">test_ari.c:59</a></div></div>
<div class="ttc" id="structstasis__state__manager_html_a18c5b21cd31cd417cb9d1a534cce95e1"><div class="ttname"><a href="../../d8/d25/structstasis__state__manager.html#a18c5b21cd31cd417cb9d1a534cce95e1">stasis_state_manager::states</a></div><div class="ttdeci">struct ao2_container * states</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d1d/stasis__state_8c_source.html#l00081">stasis_state.c:81</a></div></div>
<div class="ttc" id="astobj2_8h_html_ad9d009e87e737af900825b36db55a35ca614744a4d36b3189d4ab5b02c8645d47"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#ad9d009e87e737af900825b36db55a35ca614744a4d36b3189d4ab5b02c8645d47">OBJ_MULTIPLE</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l01053">astobj2.h:1053</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a1e620ce0dace97fda1d99361dda73c9b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1e620ce0dace97fda1d99361dda73c9b">&#9670;&nbsp;</a></span>stasis_state_manager_create()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="../../d8/d25/structstasis__state__manager.html">stasis_state_manager</a>* stasis_state_manager_create </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>topic_name</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Create a stasis state manager. </p>
<dl class="section note"><dt>Note</dt><dd>The state manager is an ao2_object. When done simply decrement its reference for object cleanup.</dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">topic_name</td><td>The name of the topic to create that all state topics get forwarded to</td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">A</td><td>stasis state manager </td></tr>
    <tr><td class="paramname">NULL</td><td>if an error occurred</td></tr>
  </table>
  </dd>
</dl>
<dl class="section since"><dt>Since</dt><dd>13.28.0 </dd>
<dd>
16.5.0 </dd></dl>

<p class="definition">Definition at line <a class="el" href="../../dc/d1d/stasis__state_8c_source.html#l00324">324</a> of file <a class="el" href="../../dc/d1d/stasis__state_8c_source.html">stasis_state.c</a>.</p>

<p class="reference">References <a class="el" href="../../dc/d1d/stasis__state_8c_source.html#l00083">stasis_state_manager::all_topic</a>, <a class="el" href="../../d5/da5/astobj2_8h_source.html#l00365">AO2_ALLOC_OPT_LOCK_MUTEX</a>, <a class="el" href="../../d5/da5/astobj2_8h_source.html#l00369">AO2_ALLOC_OPT_LOCK_NOLOCK</a>, <a class="el" href="../../d5/da5/astobj2_8h_source.html#l00406">ao2_alloc_options</a>, <a class="el" href="../../d5/da5/astobj2_8h_source.html#l01310">ao2_container_alloc_hash</a>, <a class="el" href="../../d7/d22/astobj2__container_8c_source.html#l00958">ao2_container_register()</a>, <a class="el" href="../../d5/da5/astobj2_8h_source.html#l00464">ao2_ref</a>, <a class="el" href="../../d8/d8a/astmm_8h_source.html#l00290">ast_alloca</a>, <a class="el" href="../../d6/d68/vector_8h_source.html#l00158">AST_VECTOR_RW_INIT</a>, <a class="el" href="../../dc/d1d/stasis__state_8c_source.html#l00034">stasis_state_proxy::manager</a>, <a class="el" href="../../dc/d7f/resample_8c_source.html#l00096">NULL</a>, <a class="el" href="../../d0/df4/stasis_8c_source.html#l00618">stasis_topic_create()</a>, <a class="el" href="../../d0/df4/stasis_8c_source.html#l00628">stasis_topic_name()</a>, <a class="el" href="../../dc/d1d/stasis__state_8c_source.html#l00077">STATE_BUCKETS</a>, <a class="el" href="../../dc/d1d/stasis__state_8c_source.html#l00292">state_manager_dtor()</a>, and <a class="el" href="../../dc/d1d/stasis__state_8c_source.html#l00081">stasis_state_manager::states</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../de/d6b/test__stasis__state_8c_source.html#l00356">AST_TEST_DEFINE()</a>, and <a class="el" href="../../d6/db4/mwi_8c_source.html#l00502">mwi_init()</a>.</p>
<div class="fragment"><div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;{</div><div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d8/d25/structstasis__state__manager.html">stasis_state_manager</a> *manager;</div><div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;</div><div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;   manager = <a class="code" href="../../d5/da5/astobj2_8h.html#ab3c44e28d661616129b7819069effe61">ao2_alloc_options</a>(<span class="keyword">sizeof</span>(*manager), <a class="code" href="../../dc/d1d/stasis__state_8c.html#a0ce96ad06685e89abf4561ed930029a7">state_manager_dtor</a>,</div><div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;      <a class="code" href="../../d5/da5/astobj2_8h.html#a2cf7e3433f08351aafe3b0cd31edf7f8a23b60f2636bcfbc4dfeea6cc21bf847b">AO2_ALLOC_OPT_LOCK_NOLOCK</a>);</div><div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;   <span class="keywordflow">if</span> (!manager) {</div><div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;   }</div><div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;</div><div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;   manager-&gt;<a class="code" href="../../d8/d25/structstasis__state__manager.html#a18c5b21cd31cd417cb9d1a534cce95e1">states</a> = <a class="code" href="../../d5/da5/astobj2_8h.html#aefc16f8aa9087cbc5c55c70cf1dd41b2">ao2_container_alloc_hash</a>(<a class="code" href="../../d5/da5/astobj2_8h.html#a2cf7e3433f08351aafe3b0cd31edf7f8a8ccf751bd6749d062999469f0694e7ad">AO2_ALLOC_OPT_LOCK_MUTEX</a>, 0,</div><div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;      <a class="code" href="../../dc/d1d/stasis__state_8c.html#a4164890c59a04f9e6aa478793a22cdb8">STATE_BUCKETS</a>, stasis_state_proxy_hash_fn, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, stasis_state_proxy_cmp_fn);</div><div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;   <span class="keywordflow">if</span> (!manager-&gt;<a class="code" href="../../d8/d25/structstasis__state__manager.html#a18c5b21cd31cd417cb9d1a534cce95e1">states</a>) {</div><div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;      <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(manager, -1);</div><div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;   }</div><div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;</div><div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;   manager-&gt;<a class="code" href="../../d8/d25/structstasis__state__manager.html#a4b36465264544dbb0063d66a9010d866">all_topic</a> = <a class="code" href="../../dd/d79/stasis_8h.html#acac26206b971b094c90839b4049cb6cc">stasis_topic_create</a>(topic_name);</div><div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;   <span class="keywordflow">if</span> (!manager-&gt;<a class="code" href="../../d8/d25/structstasis__state__manager.html#a4b36465264544dbb0063d66a9010d866">all_topic</a>) {</div><div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;      <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(manager, -1);</div><div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;   }</div><div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;</div><div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;   <span class="keywordflow">if</span> (<a class="code" href="../../d6/d68/vector_8h.html#af82e9e2b45ad967329a74e88352d7973">AST_VECTOR_RW_INIT</a>(&amp;manager-&gt;observers, 2) != 0) {</div><div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;      <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(manager, -1);</div><div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;   }</div><div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;</div><div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;<span class="preprocessor">#ifdef AO2_DEBUG</span></div><div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;   {</div><div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;      <span class="keywordtype">char</span> *container_name =</div><div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;         <a class="code" href="../../d8/d8a/astmm_8h.html#a249282ecc7ba5a1a49fa75e9a33d1717">ast_alloca</a>(strlen(<a class="code" href="../../dd/d79/stasis_8h.html#af23deee342575033bc73311b1215d886">stasis_topic_name</a>(manager-&gt;<a class="code" href="../../d8/d25/structstasis__state__manager.html#a4b36465264544dbb0063d66a9010d866">all_topic</a>)) + strlen(<span class="stringliteral">&quot;-manager&quot;</span>) + 1);</div><div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;      sprintf(container_name, <span class="stringliteral">&quot;%s-manager&quot;</span>, <a class="code" href="../../dd/d79/stasis_8h.html#af23deee342575033bc73311b1215d886">stasis_topic_name</a>(manager-&gt;<a class="code" href="../../d8/d25/structstasis__state__manager.html#a4b36465264544dbb0063d66a9010d866">all_topic</a>));</div><div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;      <a class="code" href="../../d5/da5/astobj2_8h.html#abdb952d2373503555d96f02f130c5770">ao2_container_register</a>(container_name, manager-&gt;<a class="code" href="../../d8/d25/structstasis__state__manager.html#a18c5b21cd31cd417cb9d1a534cce95e1">states</a>, state_prnt_obj);</div><div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;   }</div><div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;</div><div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;   <span class="keywordflow">return</span> manager;</div><div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;}</div><div class="ttc" id="vector_8h_html_af82e9e2b45ad967329a74e88352d7973"><div class="ttname"><a href="../../d6/d68/vector_8h.html#af82e9e2b45ad967329a74e88352d7973">AST_VECTOR_RW_INIT</a></div><div class="ttdeci">#define AST_VECTOR_RW_INIT(vec, size)</div><div class="ttdoc">Initialize a vector with a read/write lock. </div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d68/vector_8h_source.html#l00158">vector.h:158</a></div></div>
<div class="ttc" id="astobj2_8h_html_a2cf7e3433f08351aafe3b0cd31edf7f8a23b60f2636bcfbc4dfeea6cc21bf847b"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#a2cf7e3433f08351aafe3b0cd31edf7f8a23b60f2636bcfbc4dfeea6cc21bf847b">AO2_ALLOC_OPT_LOCK_NOLOCK</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l00369">astobj2.h:369</a></div></div>
<div class="ttc" id="astobj2_8h_html_ab3c44e28d661616129b7819069effe61"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#ab3c44e28d661616129b7819069effe61">ao2_alloc_options</a></div><div class="ttdeci">#define ao2_alloc_options(data_size, destructor_fn, options)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l00406">astobj2.h:406</a></div></div>
<div class="ttc" id="resample_8c_html_a070d2ce7b6bb7e5c05602aa8c308d0c4"><div class="ttname"><a href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a></div><div class="ttdeci">#define NULL</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d7f/resample_8c_source.html#l00096">resample.c:96</a></div></div>
<div class="ttc" id="structstasis__state__manager_html_a4b36465264544dbb0063d66a9010d866"><div class="ttname"><a href="../../d8/d25/structstasis__state__manager.html#a4b36465264544dbb0063d66a9010d866">stasis_state_manager::all_topic</a></div><div class="ttdeci">struct stasis_topic * all_topic</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d1d/stasis__state_8c_source.html#l00083">stasis_state.c:83</a></div></div>
<div class="ttc" id="astobj2_8h_html_abdb952d2373503555d96f02f130c5770"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#abdb952d2373503555d96f02f130c5770">ao2_container_register</a></div><div class="ttdeci">int ao2_container_register(const char *name, struct ao2_container *self, ao2_prnt_obj_fn *prnt_obj)</div><div class="ttdoc">Register a container for CLI stats and integrity check. </div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d22/astobj2__container_8c_source.html#l00958">astobj2_container.c:958</a></div></div>
<div class="ttc" id="astobj2_8h_html_aaca5e8eac39a22f9da1c36fc6c922270"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a></div><div class="ttdeci">#define ao2_ref(o, delta)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l00464">astobj2.h:464</a></div></div>
<div class="ttc" id="structstasis__state__manager_html"><div class="ttname"><a href="../../d8/d25/structstasis__state__manager.html">stasis_state_manager</a></div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d1d/stasis__state_8c_source.html#l00079">stasis_state.c:79</a></div></div>
<div class="ttc" id="stasis_8h_html_acac26206b971b094c90839b4049cb6cc"><div class="ttname"><a href="../../dd/d79/stasis_8h.html#acac26206b971b094c90839b4049cb6cc">stasis_topic_create</a></div><div class="ttdeci">struct stasis_topic * stasis_topic_create(const char *name)</div><div class="ttdoc">Create a new topic. </div><div class="ttdef"><b>Definition:</b> <a href="../../d0/df4/stasis_8c_source.html#l00618">stasis.c:618</a></div></div>
<div class="ttc" id="astobj2_8h_html_a2cf7e3433f08351aafe3b0cd31edf7f8a8ccf751bd6749d062999469f0694e7ad"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#a2cf7e3433f08351aafe3b0cd31edf7f8a8ccf751bd6749d062999469f0694e7ad">AO2_ALLOC_OPT_LOCK_MUTEX</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l00365">astobj2.h:365</a></div></div>
<div class="ttc" id="astmm_8h_html_a249282ecc7ba5a1a49fa75e9a33d1717"><div class="ttname"><a href="../../d8/d8a/astmm_8h.html#a249282ecc7ba5a1a49fa75e9a33d1717">ast_alloca</a></div><div class="ttdeci">#define ast_alloca(size)</div><div class="ttdoc">call __builtin_alloca to ensure we get gcc builtin semantics </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d8a/astmm_8h_source.html#l00290">astmm.h:290</a></div></div>
<div class="ttc" id="astobj2_8h_html_aefc16f8aa9087cbc5c55c70cf1dd41b2"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#aefc16f8aa9087cbc5c55c70cf1dd41b2">ao2_container_alloc_hash</a></div><div class="ttdeci">#define ao2_container_alloc_hash(ao2_options, container_options, n_buckets, hash_fn, sort_fn, cmp_fn)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l01310">astobj2.h:1310</a></div></div>
<div class="ttc" id="stasis_8h_html_af23deee342575033bc73311b1215d886"><div class="ttname"><a href="../../dd/d79/stasis_8h.html#af23deee342575033bc73311b1215d886">stasis_topic_name</a></div><div class="ttdeci">const char * stasis_topic_name(const struct stasis_topic *topic)</div><div class="ttdoc">Return the name of a topic. </div><div class="ttdef"><b>Definition:</b> <a href="../../d0/df4/stasis_8c_source.html#l00628">stasis.c:628</a></div></div>
<div class="ttc" id="stasis__state_8c_html_a4164890c59a04f9e6aa478793a22cdb8"><div class="ttname"><a href="../../dc/d1d/stasis__state_8c.html#a4164890c59a04f9e6aa478793a22cdb8">STATE_BUCKETS</a></div><div class="ttdeci">#define STATE_BUCKETS</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d1d/stasis__state_8c_source.html#l00077">stasis_state.c:77</a></div></div>
<div class="ttc" id="stasis__state_8c_html_a0ce96ad06685e89abf4561ed930029a7"><div class="ttname"><a href="../../dc/d1d/stasis__state_8c.html#a0ce96ad06685e89abf4561ed930029a7">state_manager_dtor</a></div><div class="ttdeci">static void state_manager_dtor(void *obj)</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d1d/stasis__state_8c_source.html#l00292">stasis_state.c:292</a></div></div>
<div class="ttc" id="structstasis__state__manager_html_a18c5b21cd31cd417cb9d1a534cce95e1"><div class="ttname"><a href="../../d8/d25/structstasis__state__manager.html#a18c5b21cd31cd417cb9d1a534cce95e1">stasis_state_manager::states</a></div><div class="ttdeci">struct ao2_container * states</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d1d/stasis__state_8c_source.html#l00081">stasis_state.c:81</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="ae22f3fe7bbecf70b943d4b72ec9ffcea"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae22f3fe7bbecf70b943d4b72ec9ffcea">&#9670;&nbsp;</a></span>stasis_state_publish()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void stasis_state_publish </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="../../df/dcc/structstasis__state__publisher.html">stasis_state_publisher</a> *&#160;</td>
          <td class="paramname"><em>pub</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="../../d7/d55/structstasis__message.html">stasis_message</a> *&#160;</td>
          <td class="paramname"><em>msg</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Publish to a managed state (topic) using a publisher. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">pub</td><td>The publisher to use to publish the message </td></tr>
    <tr><td class="paramname">msg</td><td>The message to publish</td></tr>
  </table>
  </dd>
</dl>
<dl class="section since"><dt>Since</dt><dd>13.28.0 </dd>
<dd>
16.5.0 </dd></dl>

<p class="definition">Definition at line <a class="el" href="../../dc/d1d/stasis__state_8c_source.html#l00562">562</a> of file <a class="el" href="../../dc/d1d/stasis__state_8c_source.html">stasis_state.c</a>.</p>

<p class="reference">References <a class="el" href="../../d5/da5/astobj2_8h_source.html#l00718">ao2_lock</a>, <a class="el" href="../../d5/da5/astobj2_8h_source.html#l00517">ao2_replace</a>, <a class="el" href="../../d5/da5/astobj2_8h_source.html#l00730">ao2_unlock</a>, <a class="el" href="../../dc/d1d/stasis__state_8c_source.html#l00063">stasis_state::msg</a>, <a class="el" href="../../d0/df4/stasis_8c_source.html#l01511">stasis_publish()</a>, <a class="el" href="../../dc/d1d/stasis__state_8c_source.html#l00521">stasis_state_publisher::state</a>, and <a class="el" href="../../dc/d1d/stasis__state_8c_source.html#l00061">stasis_state::topic</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../d6/db4/mwi_8c_source.html#l00353">ast_mwi_publish()</a>, and <a class="el" href="../../de/d6b/test__stasis__state_8c_source.html#l00293">explicit_publish_cb()</a>.</p>
<div class="fragment"><div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;{</div><div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#aa9fdb5d0a6157a56060d9f7279fe6c49">ao2_lock</a>(pub-&gt;<a class="code" href="../../df/dcc/structstasis__state__publisher.html#a7657b2fb6d92ad0e32691de4b271867a">state</a>);</div><div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#aa81c8462bd0574f4f9e09e71f2772f44">ao2_replace</a>(pub-&gt;<a class="code" href="../../df/dcc/structstasis__state__publisher.html#a7657b2fb6d92ad0e32691de4b271867a">state</a>-&gt;<a class="code" href="../../d6/d75/structstasis__state.html#aa24737e537b6b1f647b3f22392ac8abe">msg</a>, msg);</div><div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#a9998bd156b936636a8780385e9a910b2">ao2_unlock</a>(pub-&gt;<a class="code" href="../../df/dcc/structstasis__state__publisher.html#a7657b2fb6d92ad0e32691de4b271867a">state</a>);</div><div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;</div><div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;   <a class="code" href="../../dd/d79/stasis_8h.html#ac43d0a33d111e9f34b441b285c166cfc">stasis_publish</a>(pub-&gt;<a class="code" href="../../df/dcc/structstasis__state__publisher.html#a7657b2fb6d92ad0e32691de4b271867a">state</a>-&gt;<a class="code" href="../../d6/d75/structstasis__state.html#a136460a7868b48ef576c0fa505ef96db">topic</a>, msg);</div><div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;}</div><div class="ttc" id="structstasis__state_html_a136460a7868b48ef576c0fa505ef96db"><div class="ttname"><a href="../../d6/d75/structstasis__state.html#a136460a7868b48ef576c0fa505ef96db">stasis_state::topic</a></div><div class="ttdeci">struct stasis_topic * topic</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d1d/stasis__state_8c_source.html#l00061">stasis_state.c:61</a></div></div>
<div class="ttc" id="structstasis__state_html_aa24737e537b6b1f647b3f22392ac8abe"><div class="ttname"><a href="../../d6/d75/structstasis__state.html#aa24737e537b6b1f647b3f22392ac8abe">stasis_state::msg</a></div><div class="ttdeci">struct stasis_message * msg</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d1d/stasis__state_8c_source.html#l00063">stasis_state.c:63</a></div></div>
<div class="ttc" id="astobj2_8h_html_a9998bd156b936636a8780385e9a910b2"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#a9998bd156b936636a8780385e9a910b2">ao2_unlock</a></div><div class="ttdeci">#define ao2_unlock(a)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l00730">astobj2.h:730</a></div></div>
<div class="ttc" id="astobj2_8h_html_aa9fdb5d0a6157a56060d9f7279fe6c49"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#aa9fdb5d0a6157a56060d9f7279fe6c49">ao2_lock</a></div><div class="ttdeci">#define ao2_lock(a)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l00718">astobj2.h:718</a></div></div>
<div class="ttc" id="stasis_8h_html_ac43d0a33d111e9f34b441b285c166cfc"><div class="ttname"><a href="../../dd/d79/stasis_8h.html#ac43d0a33d111e9f34b441b285c166cfc">stasis_publish</a></div><div class="ttdeci">void stasis_publish(struct stasis_topic *topic, struct stasis_message *message)</div><div class="ttdoc">Publish a message to a topic&amp;#39;s subscribers. </div><div class="ttdef"><b>Definition:</b> <a href="../../d0/df4/stasis_8c_source.html#l01511">stasis.c:1511</a></div></div>
<div class="ttc" id="astobj2_8h_html_aa81c8462bd0574f4f9e09e71f2772f44"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#aa81c8462bd0574f4f9e09e71f2772f44">ao2_replace</a></div><div class="ttdeci">#define ao2_replace(dst, src)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l00517">astobj2.h:517</a></div></div>
<div class="ttc" id="structstasis__state__publisher_html_a7657b2fb6d92ad0e32691de4b271867a"><div class="ttname"><a href="../../df/dcc/structstasis__state__publisher.html#a7657b2fb6d92ad0e32691de4b271867a">stasis_state_publisher::state</a></div><div class="ttdeci">struct stasis_state * state</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d1d/stasis__state_8c_source.html#l00521">stasis_state.c:521</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a2dbc6c2a3b37e5ab135e410681a23142"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2dbc6c2a3b37e5ab135e410681a23142">&#9670;&nbsp;</a></span>stasis_state_publish_by_id()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void stasis_state_publish_by_id </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="../../d8/d25/structstasis__state__manager.html">stasis_state_manager</a> *&#160;</td>
          <td class="paramname"><em>manager</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>id</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const struct <a class="el" href="../../d0/d86/structast__eid.html">ast_eid</a> *&#160;</td>
          <td class="paramname"><em>eid</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="../../d7/d55/structstasis__message.html">stasis_message</a> *&#160;</td>
          <td class="paramname"><em>msg</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Publish to a managed named by id topic, and add an implicit subscriber. </p>
<dl class="section note"><dt>Note</dt><dd>It is recommended when adding new publisher functionality within a module to create and use an explicit publisher instead of using this method.</dd></dl>
<p>This creates an implicit publisher keyed off the eid. This ability was mainly implemented in order to maintain compatibility with already established code. Allowing the creation of an implicit publisher made is so less changes were required when stasis state module was initially added.</p>
<p>There should only ever be one publisher for a specifically named managed topic within the system. This being the case we can use the eid to implicitly track the publisher. However once publishing is no longer needed for a topic a call to stasis_state_remove_publish_by_id is required in order to remove the implicit publisher. Thus allowing for its eventual destruction. Without the call to remove a memory leak will occur.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">manager</td><td>The state manager </td></tr>
    <tr><td class="paramname">id</td><td>A state's unique id </td></tr>
    <tr><td class="paramname">eid</td><td>The unique system id </td></tr>
    <tr><td class="paramname">msg</td><td>The message to publish</td></tr>
  </table>
  </dd>
</dl>
<dl class="section since"><dt>Since</dt><dd>13.28.0 </dd>
<dd>
16.5.0 </dd></dl>

<p class="definition">Definition at line <a class="el" href="../../dc/d1d/stasis__state_8c_source.html#l00638">638</a> of file <a class="el" href="../../dc/d1d/stasis__state_8c_source.html">stasis_state.c</a>.</p>

<p class="reference">References <a class="el" href="../../d5/da5/astobj2_8h_source.html#l00718">ao2_lock</a>, <a class="el" href="../../d5/da5/astobj2_8h_source.html#l00464">ao2_ref</a>, <a class="el" href="../../d5/da5/astobj2_8h_source.html#l00517">ao2_replace</a>, <a class="el" href="../../d5/da5/astobj2_8h_source.html#l00730">ao2_unlock</a>, <a class="el" href="../../dc/d1d/stasis__state_8c_source.html#l00063">stasis_state::msg</a>, <a class="el" href="../../dc/d7f/resample_8c_source.html#l00096">NULL</a>, <a class="el" href="../../d0/df4/stasis_8c_source.html#l01511">stasis_publish()</a>, <a class="el" href="../../d5/dfe/chan__sip_8c_source.html#l00959">state</a>, <a class="el" href="../../dc/d1d/stasis__state_8c_source.html#l00270">state_find_or_add</a>, <a class="el" href="../../dc/d1d/stasis__state_8c_source.html#l00586">state_find_or_add_eid()</a>, and <a class="el" href="../../dc/d1d/stasis__state_8c_source.html#l00061">stasis_state::topic</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../d6/db4/mwi_8c_source.html#l00370">ast_mwi_publish_by_mailbox()</a>, and <a class="el" href="../../de/d6b/test__stasis__state_8c_source.html#l00272">implicit_publish_cb()</a>.</p>
<div class="fragment"><div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160;{</div><div class="line"><a name="l00641"></a><span class="lineno">  641</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d6/d75/structstasis__state.html">stasis_state</a> *<a class="code" href="../../d5/dfe/chan__sip_8c.html#a14a9662e09deed264497073732fb014a">state</a>;</div><div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160;</div><div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160;   state = <a class="code" href="../../dc/d1d/stasis__state_8c.html#a9d69e7d941254c112769ae1d6c2ae5f5">state_find_or_add</a>(manager, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <span class="keywordtype">id</span>);</div><div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160;   <span class="keywordflow">if</span> (!state) {</div><div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160;      <span class="keywordflow">return</span>;</div><div class="line"><a name="l00646"></a><span class="lineno">  646</span>&#160;   }</div><div class="line"><a name="l00647"></a><span class="lineno">  647</span>&#160;</div><div class="line"><a name="l00648"></a><span class="lineno">  648</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#aa9fdb5d0a6157a56060d9f7279fe6c49">ao2_lock</a>(state);</div><div class="line"><a name="l00649"></a><span class="lineno">  649</span>&#160;   <a class="code" href="../../dc/d1d/stasis__state_8c.html#a78067dcb8032e3a734d8ab2528ad3e99">state_find_or_add_eid</a>(state, eid);</div><div class="line"><a name="l00650"></a><span class="lineno">  650</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#aa81c8462bd0574f4f9e09e71f2772f44">ao2_replace</a>(state-&gt;<a class="code" href="../../d6/d75/structstasis__state.html#aa24737e537b6b1f647b3f22392ac8abe">msg</a>, msg);</div><div class="line"><a name="l00651"></a><span class="lineno">  651</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#a9998bd156b936636a8780385e9a910b2">ao2_unlock</a>(state);</div><div class="line"><a name="l00652"></a><span class="lineno">  652</span>&#160;</div><div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160;   <a class="code" href="../../dd/d79/stasis_8h.html#ac43d0a33d111e9f34b441b285c166cfc">stasis_publish</a>(state-&gt;<a class="code" href="../../d6/d75/structstasis__state.html#a136460a7868b48ef576c0fa505ef96db">topic</a>, msg);</div><div class="line"><a name="l00654"></a><span class="lineno">  654</span>&#160;</div><div class="line"><a name="l00655"></a><span class="lineno">  655</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(state, -1);</div><div class="line"><a name="l00656"></a><span class="lineno">  656</span>&#160;}</div><div class="ttc" id="chan__sip_8c_html_a14a9662e09deed264497073732fb014a"><div class="ttname"><a href="../../d5/dfe/chan__sip_8c.html#a14a9662e09deed264497073732fb014a">state</a></div><div class="ttdeci">enum sip_cc_notify_state state</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/dfe/chan__sip_8c_source.html#l00959">chan_sip.c:959</a></div></div>
<div class="ttc" id="stasis__state_8c_html_a9d69e7d941254c112769ae1d6c2ae5f5"><div class="ttname"><a href="../../dc/d1d/stasis__state_8c.html#a9d69e7d941254c112769ae1d6c2ae5f5">state_find_or_add</a></div><div class="ttdeci">#define state_find_or_add(mgr, top, id)</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d1d/stasis__state_8c_source.html#l00270">stasis_state.c:270</a></div></div>
<div class="ttc" id="structstasis__state_html_a136460a7868b48ef576c0fa505ef96db"><div class="ttname"><a href="../../d6/d75/structstasis__state.html#a136460a7868b48ef576c0fa505ef96db">stasis_state::topic</a></div><div class="ttdeci">struct stasis_topic * topic</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d1d/stasis__state_8c_source.html#l00061">stasis_state.c:61</a></div></div>
<div class="ttc" id="structstasis__state_html_aa24737e537b6b1f647b3f22392ac8abe"><div class="ttname"><a href="../../d6/d75/structstasis__state.html#aa24737e537b6b1f647b3f22392ac8abe">stasis_state::msg</a></div><div class="ttdeci">struct stasis_message * msg</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d1d/stasis__state_8c_source.html#l00063">stasis_state.c:63</a></div></div>
<div class="ttc" id="astobj2_8h_html_a9998bd156b936636a8780385e9a910b2"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#a9998bd156b936636a8780385e9a910b2">ao2_unlock</a></div><div class="ttdeci">#define ao2_unlock(a)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l00730">astobj2.h:730</a></div></div>
<div class="ttc" id="resample_8c_html_a070d2ce7b6bb7e5c05602aa8c308d0c4"><div class="ttname"><a href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a></div><div class="ttdeci">#define NULL</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d7f/resample_8c_source.html#l00096">resample.c:96</a></div></div>
<div class="ttc" id="astobj2_8h_html_aaca5e8eac39a22f9da1c36fc6c922270"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a></div><div class="ttdeci">#define ao2_ref(o, delta)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l00464">astobj2.h:464</a></div></div>
<div class="ttc" id="astobj2_8h_html_aa9fdb5d0a6157a56060d9f7279fe6c49"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#aa9fdb5d0a6157a56060d9f7279fe6c49">ao2_lock</a></div><div class="ttdeci">#define ao2_lock(a)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l00718">astobj2.h:718</a></div></div>
<div class="ttc" id="stasis_8h_html_ac43d0a33d111e9f34b441b285c166cfc"><div class="ttname"><a href="../../dd/d79/stasis_8h.html#ac43d0a33d111e9f34b441b285c166cfc">stasis_publish</a></div><div class="ttdeci">void stasis_publish(struct stasis_topic *topic, struct stasis_message *message)</div><div class="ttdoc">Publish a message to a topic&amp;#39;s subscribers. </div><div class="ttdef"><b>Definition:</b> <a href="../../d0/df4/stasis_8c_source.html#l01511">stasis.c:1511</a></div></div>
<div class="ttc" id="astobj2_8h_html_aa81c8462bd0574f4f9e09e71f2772f44"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#aa81c8462bd0574f4f9e09e71f2772f44">ao2_replace</a></div><div class="ttdeci">#define ao2_replace(dst, src)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l00517">astobj2.h:517</a></div></div>
<div class="ttc" id="structstasis__state_html"><div class="ttname"><a href="../../d6/d75/structstasis__state.html">stasis_state</a></div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d1d/stasis__state_8c_source.html#l00050">stasis_state.c:50</a></div></div>
<div class="ttc" id="stasis__state_8c_html_a78067dcb8032e3a734d8ab2528ad3e99"><div class="ttname"><a href="../../dc/d1d/stasis__state_8c.html#a78067dcb8032e3a734d8ab2528ad3e99">state_find_or_add_eid</a></div><div class="ttdeci">static void state_find_or_add_eid(struct stasis_state *state, const struct ast_eid *eid)</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d1d/stasis__state_8c_source.html#l00586">stasis_state.c:586</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="acb3e1eb79879c114539587a240b455ab"></a>
<h2 class="memtitle"><span class="permalink"><a href="#acb3e1eb79879c114539587a240b455ab">&#9670;&nbsp;</a></span>stasis_state_publisher_id()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">const char* stasis_state_publisher_id </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="../../df/dcc/structstasis__state__publisher.html">stasis_state_publisher</a> *&#160;</td>
          <td class="paramname"><em>pub</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Retrieve the publisher's underlying state's unique id. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">pub</td><td>A stasis state publisher</td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">The</td><td>managed state's id</td></tr>
  </table>
  </dd>
</dl>
<dl class="section since"><dt>Since</dt><dd>13.28.0 </dd>
<dd>
16.5.0 </dd></dl>

<p class="definition">Definition at line <a class="el" href="../../dc/d1d/stasis__state_8c_source.html#l00552">552</a> of file <a class="el" href="../../dc/d1d/stasis__state_8c_source.html">stasis_state.c</a>.</p>

<p class="reference">References <a class="el" href="../../dc/d1d/stasis__state_8c_source.html#l00521">stasis_state_publisher::state</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../d6/db4/mwi_8c_source.html#l00353">ast_mwi_publish()</a>, and <a class="el" href="../../de/d6b/test__stasis__state_8c_source.html#l00293">explicit_publish_cb()</a>.</p>
<div class="fragment"><div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;{</div><div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;   <span class="keywordflow">return</span> pub-&gt;<a class="code" href="../../df/dcc/structstasis__state__publisher.html#a7657b2fb6d92ad0e32691de4b271867a">state</a>-&gt;id;</div><div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;}</div><div class="ttc" id="structstasis__state__publisher_html_a7657b2fb6d92ad0e32691de4b271867a"><div class="ttname"><a href="../../df/dcc/structstasis__state__publisher.html#a7657b2fb6d92ad0e32691de4b271867a">stasis_state_publisher::state</a></div><div class="ttdeci">struct stasis_state * state</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d1d/stasis__state_8c_source.html#l00521">stasis_state.c:521</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a323883cc18a212f8eb7ffd4200b0218c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a323883cc18a212f8eb7ffd4200b0218c">&#9670;&nbsp;</a></span>stasis_state_publisher_topic()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="../../d9/d1d/structstasis__topic.html">stasis_topic</a>* stasis_state_publisher_topic </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="../../df/dcc/structstasis__state__publisher.html">stasis_state_publisher</a> *&#160;</td>
          <td class="paramname"><em>pub</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Retrieve the publisher's topic. </p>
<dl class="section note"><dt>Note</dt><dd>Returned topic's reference count is NOT incremented. However, the topic is guaranteed to live for the lifetime of the publisher.</dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">pub</td><td>A stasis state publisher</td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">The</td><td>publisher's topic</td></tr>
  </table>
  </dd>
</dl>
<dl class="section since"><dt>Since</dt><dd>13.28.0 </dd>
<dd>
16.5.0 </dd></dl>

<p class="definition">Definition at line <a class="el" href="../../dc/d1d/stasis__state_8c_source.html#l00557">557</a> of file <a class="el" href="../../dc/d1d/stasis__state_8c_source.html">stasis_state.c</a>.</p>

<p class="reference">References <a class="el" href="../../dc/d1d/stasis__state_8c_source.html#l00521">stasis_state_publisher::state</a>, and <a class="el" href="../../dc/d1d/stasis__state_8c_source.html#l00061">stasis_state::topic</a>.</p>
<div class="fragment"><div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;{</div><div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;   <span class="keywordflow">return</span> pub-&gt;<a class="code" href="../../df/dcc/structstasis__state__publisher.html#a7657b2fb6d92ad0e32691de4b271867a">state</a>-&gt;<a class="code" href="../../d6/d75/structstasis__state.html#a136460a7868b48ef576c0fa505ef96db">topic</a>;</div><div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;}</div><div class="ttc" id="structstasis__state_html_a136460a7868b48ef576c0fa505ef96db"><div class="ttname"><a href="../../d6/d75/structstasis__state.html#a136460a7868b48ef576c0fa505ef96db">stasis_state::topic</a></div><div class="ttdeci">struct stasis_topic * topic</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d1d/stasis__state_8c_source.html#l00061">stasis_state.c:61</a></div></div>
<div class="ttc" id="structstasis__state__publisher_html_a7657b2fb6d92ad0e32691de4b271867a"><div class="ttname"><a href="../../df/dcc/structstasis__state__publisher.html#a7657b2fb6d92ad0e32691de4b271867a">stasis_state_publisher::state</a></div><div class="ttdeci">struct stasis_state * state</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d1d/stasis__state_8c_source.html#l00521">stasis_state.c:521</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a48ab5b2a6061ca20c816a9ccdf85aeeb"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a48ab5b2a6061ca20c816a9ccdf85aeeb">&#9670;&nbsp;</a></span>stasis_state_remove_observer()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void stasis_state_remove_observer </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="../../d8/d25/structstasis__state__manager.html">stasis_state_manager</a> *&#160;</td>
          <td class="paramname"><em>manager</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="../../d5/d92/structstasis__state__observer.html">stasis_state_observer</a> *&#160;</td>
          <td class="paramname"><em>observer</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Remove an observer (will no longer receive managed state related events). </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">manager</td><td>The state manager </td></tr>
    <tr><td class="paramname">observer</td><td>The observer being removed</td></tr>
  </table>
  </dd>
</dl>
<dl class="section since"><dt>Since</dt><dd>13.28.0 </dd>
<dd>
16.5.0 </dd></dl>

<p class="definition">Definition at line <a class="el" href="../../dc/d1d/stasis__state_8c_source.html#l00700">700</a> of file <a class="el" href="../../dc/d1d/stasis__state_8c_source.html">stasis_state.c</a>.</p>

<p class="reference">References <a class="el" href="../../d6/d68/vector_8h_source.html#l00573">AST_VECTOR_ELEM_CLEANUP_NOOP</a>, <a class="el" href="../../d6/d68/vector_8h_source.html#l00585">AST_VECTOR_REMOVE_ELEM_UNORDERED</a>, <a class="el" href="../../d6/d68/vector_8h_source.html#l00900">AST_VECTOR_RW_UNLOCK</a>, and <a class="el" href="../../d6/d68/vector_8h_source.html#l00890">AST_VECTOR_RW_WRLOCK</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../d6/db4/mwi_8c_source.html#l00302">ast_mwi_remove_observer()</a>, and <a class="el" href="../../de/d6b/test__stasis__state_8c_source.html#l00113">subscriptions_destroy()</a>.</p>
<div class="fragment"><div class="line"><a name="l00702"></a><span class="lineno">  702</span>&#160;{</div><div class="line"><a name="l00703"></a><span class="lineno">  703</span>&#160;   <a class="code" href="../../d6/d68/vector_8h.html#a468985d2b5ca7410d91108bdd0484348">AST_VECTOR_RW_WRLOCK</a>(&amp;manager-&gt;observers);</div><div class="line"><a name="l00704"></a><span class="lineno">  704</span>&#160;   <a class="code" href="../../d6/d68/vector_8h.html#a79df3872d03069f077e7cab2262b8550">AST_VECTOR_REMOVE_ELEM_UNORDERED</a>(&amp;manager-&gt;observers, observer, <a class="code" href="../../d6/d68/vector_8h.html#a1885c25b9d767a53d1df9b641f53951a">AST_VECTOR_ELEM_CLEANUP_NOOP</a>);</div><div class="line"><a name="l00705"></a><span class="lineno">  705</span>&#160;   <a class="code" href="../../d6/d68/vector_8h.html#a5ad3dd1d3da5d4ebf6a44d32e42c4c91">AST_VECTOR_RW_UNLOCK</a>(&amp;manager-&gt;observers);</div><div class="line"><a name="l00706"></a><span class="lineno">  706</span>&#160;}</div><div class="ttc" id="vector_8h_html_a79df3872d03069f077e7cab2262b8550"><div class="ttname"><a href="../../d6/d68/vector_8h.html#a79df3872d03069f077e7cab2262b8550">AST_VECTOR_REMOVE_ELEM_UNORDERED</a></div><div class="ttdeci">#define AST_VECTOR_REMOVE_ELEM_UNORDERED(vec, elem, cleanup)</div><div class="ttdoc">Remove an element from a vector. </div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d68/vector_8h_source.html#l00585">vector.h:585</a></div></div>
<div class="ttc" id="vector_8h_html_a5ad3dd1d3da5d4ebf6a44d32e42c4c91"><div class="ttname"><a href="../../d6/d68/vector_8h.html#a5ad3dd1d3da5d4ebf6a44d32e42c4c91">AST_VECTOR_RW_UNLOCK</a></div><div class="ttdeci">#define AST_VECTOR_RW_UNLOCK(vec)</div><div class="ttdoc">Unlock vector. </div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d68/vector_8h_source.html#l00900">vector.h:900</a></div></div>
<div class="ttc" id="vector_8h_html_a1885c25b9d767a53d1df9b641f53951a"><div class="ttname"><a href="../../d6/d68/vector_8h.html#a1885c25b9d767a53d1df9b641f53951a">AST_VECTOR_ELEM_CLEANUP_NOOP</a></div><div class="ttdeci">#define AST_VECTOR_ELEM_CLEANUP_NOOP(elem)</div><div class="ttdoc">Vector element cleanup that does nothing. </div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d68/vector_8h_source.html#l00573">vector.h:573</a></div></div>
<div class="ttc" id="vector_8h_html_a468985d2b5ca7410d91108bdd0484348"><div class="ttname"><a href="../../d6/d68/vector_8h.html#a468985d2b5ca7410d91108bdd0484348">AST_VECTOR_RW_WRLOCK</a></div><div class="ttdeci">#define AST_VECTOR_RW_WRLOCK(vec)</div><div class="ttdoc">Obtain write lock on vector. </div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d68/vector_8h_source.html#l00890">vector.h:890</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="acd6a2d9bb8e46b049966355cda567a37"></a>
<h2 class="memtitle"><span class="permalink"><a href="#acd6a2d9bb8e46b049966355cda567a37">&#9670;&nbsp;</a></span>stasis_state_remove_publish_by_id()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void stasis_state_remove_publish_by_id </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="../../d8/d25/structstasis__state__manager.html">stasis_state_manager</a> *&#160;</td>
          <td class="paramname"><em>manager</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>id</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const struct <a class="el" href="../../d0/d86/structast__eid.html">ast_eid</a> *&#160;</td>
          <td class="paramname"><em>eid</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="../../d7/d55/structstasis__message.html">stasis_message</a> *&#160;</td>
          <td class="paramname"><em>msg</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Publish to a managed named by id topic, and remove an implicit publisher. </p>
<p>This function should be called after calling stasis_state_publish_by_id at least once for the same manager, id, and eid. If the given stasis message is NULL then the implicit publisher is removed, but no last message is published.</p>
<p>See note and description on stasis_state_publish_by_id for more details about if, and when this function should be used.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">manager</td><td>The state manager </td></tr>
    <tr><td class="paramname">id</td><td>A state's unique id </td></tr>
    <tr><td class="paramname">eid</td><td>The unique system id </td></tr>
    <tr><td class="paramname">msg</td><td>The message to publish (can be NULL)</td></tr>
  </table>
  </dd>
</dl>
<dl class="section since"><dt>Since</dt><dd>13.28.0 </dd>
<dd>
16.5.0 </dd></dl>

<p class="definition">Definition at line <a class="el" href="../../dc/d1d/stasis__state_8c_source.html#l00658">658</a> of file <a class="el" href="../../dc/d1d/stasis__state_8c_source.html">stasis_state.c</a>.</p>

<p class="reference">References <a class="el" href="../../d5/da5/astobj2_8h_source.html#l00718">ao2_lock</a>, <a class="el" href="../../d5/da5/astobj2_8h_source.html#l00464">ao2_ref</a>, <a class="el" href="../../d5/da5/astobj2_8h_source.html#l00730">ao2_unlock</a>, <a class="el" href="../../d5/da5/astobj2_8h_source.html#l01768">ao2_weakproxy_find</a>, <a class="el" href="../../d1/d8c/logger_8h_source.html#l00452">ast_debug</a>, <a class="el" href="../../d5/da5/astobj2_8h_source.html#l01105">OBJ_SEARCH_KEY</a>, <a class="el" href="../../d0/df4/stasis_8c_source.html#l01511">stasis_publish()</a>, <a class="el" href="../../dc/d1d/stasis__state_8c_source.html#l00620">state_find_and_remove_eid()</a>, <a class="el" href="../../dc/d1d/stasis__state_8c_source.html#l00081">stasis_state_manager::states</a>, and <a class="el" href="../../dc/d1d/stasis__state_8c_source.html#l00061">stasis_state::topic</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../d6/db4/mwi_8c_source.html#l00399">ast_delete_mwi_state_full()</a>, and <a class="el" href="../../de/d6b/test__stasis__state_8c_source.html#l00179">publishers_destroy()</a>.</p>
<div class="fragment"><div class="line"><a name="l00660"></a><span class="lineno">  660</span>&#160;{</div><div class="line"><a name="l00661"></a><span class="lineno">  661</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d6/d75/structstasis__state.html">stasis_state</a> *<a class="code" href="../../d4/d88/structstate.html">state</a> = <a class="code" href="../../d5/da5/astobj2_8h.html#aa78a383f537bc7a35efb8eaabcdc44e9">ao2_weakproxy_find</a>(manager-&gt;<a class="code" href="../../d8/d25/structstasis__state__manager.html#a18c5b21cd31cd417cb9d1a534cce95e1">states</a>, <span class="keywordtype">id</span>, <a class="code" href="../../d5/da5/astobj2_8h.html#ad9d009e87e737af900825b36db55a35caa13a6e0771cc457e86f425d95c3b8d54">OBJ_SEARCH_KEY</a>, <span class="stringliteral">&quot;&quot;</span>);</div><div class="line"><a name="l00662"></a><span class="lineno">  662</span>&#160;</div><div class="line"><a name="l00663"></a><span class="lineno">  663</span>&#160;   <span class="keywordflow">if</span> (!state) {</div><div class="line"><a name="l00664"></a><span class="lineno">  664</span>&#160;      <span class="comment">/*</span></div><div class="line"><a name="l00665"></a><span class="lineno">  665</span>&#160;<span class="comment">       * In most circumstances state should already exist here. However, if there is no</span></div><div class="line"><a name="l00666"></a><span class="lineno">  666</span>&#160;<span class="comment">       * state then it can mean one of a few things:</span></div><div class="line"><a name="l00667"></a><span class="lineno">  667</span>&#160;<span class="comment">       *</span></div><div class="line"><a name="l00668"></a><span class="lineno">  668</span>&#160;<span class="comment">       * 1. This function was called prior to an implicit publish for the same given</span></div><div class="line"><a name="l00669"></a><span class="lineno">  669</span>&#160;<span class="comment">       *    manager, and id.</span></div><div class="line"><a name="l00670"></a><span class="lineno">  670</span>&#160;<span class="comment">       * 2. This function was called more than once for the same manager, and id.</span></div><div class="line"><a name="l00671"></a><span class="lineno">  671</span>&#160;<span class="comment">       * 3. There is ref count problem with the explicit subscribers, and publishers.</span></div><div class="line"><a name="l00672"></a><span class="lineno">  672</span>&#160;<span class="comment">       */</span></div><div class="line"><a name="l00673"></a><span class="lineno">  673</span>&#160;      <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(5, <span class="stringliteral">&quot;Attempted to remove state for id &#39;%s&#39;, but state not found\n&quot;</span>, <span class="keywordtype">id</span>);</div><div class="line"><a name="l00674"></a><span class="lineno">  674</span>&#160;      <span class="keywordflow">return</span>;</div><div class="line"><a name="l00675"></a><span class="lineno">  675</span>&#160;   }</div><div class="line"><a name="l00676"></a><span class="lineno">  676</span>&#160;</div><div class="line"><a name="l00677"></a><span class="lineno">  677</span>&#160;   <span class="keywordflow">if</span> (msg) {</div><div class="line"><a name="l00678"></a><span class="lineno">  678</span>&#160;      <a class="code" href="../../dd/d79/stasis_8h.html#ac43d0a33d111e9f34b441b285c166cfc">stasis_publish</a>(state-&gt;<a class="code" href="../../d6/d75/structstasis__state.html#a136460a7868b48ef576c0fa505ef96db">topic</a>, msg);</div><div class="line"><a name="l00679"></a><span class="lineno">  679</span>&#160;   }</div><div class="line"><a name="l00680"></a><span class="lineno">  680</span>&#160;</div><div class="line"><a name="l00681"></a><span class="lineno">  681</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#aa9fdb5d0a6157a56060d9f7279fe6c49">ao2_lock</a>(state);</div><div class="line"><a name="l00682"></a><span class="lineno">  682</span>&#160;   <a class="code" href="../../dc/d1d/stasis__state_8c.html#a76bf47e293ac2a764061da3ea1a7d671">state_find_and_remove_eid</a>(state, eid);</div><div class="line"><a name="l00683"></a><span class="lineno">  683</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#a9998bd156b936636a8780385e9a910b2">ao2_unlock</a>(state);</div><div class="line"><a name="l00684"></a><span class="lineno">  684</span>&#160;</div><div class="line"><a name="l00685"></a><span class="lineno">  685</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(state, -1);</div><div class="line"><a name="l00686"></a><span class="lineno">  686</span>&#160;}</div><div class="ttc" id="structstasis__state_html_a136460a7868b48ef576c0fa505ef96db"><div class="ttname"><a href="../../d6/d75/structstasis__state.html#a136460a7868b48ef576c0fa505ef96db">stasis_state::topic</a></div><div class="ttdeci">struct stasis_topic * topic</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d1d/stasis__state_8c_source.html#l00061">stasis_state.c:61</a></div></div>
<div class="ttc" id="astobj2_8h_html_ad9d009e87e737af900825b36db55a35caa13a6e0771cc457e86f425d95c3b8d54"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#ad9d009e87e737af900825b36db55a35caa13a6e0771cc457e86f425d95c3b8d54">OBJ_SEARCH_KEY</a></div><div class="ttdoc">The arg parameter is a search key, but is not an object. </div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l01105">astobj2.h:1105</a></div></div>
<div class="ttc" id="astobj2_8h_html_a9998bd156b936636a8780385e9a910b2"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#a9998bd156b936636a8780385e9a910b2">ao2_unlock</a></div><div class="ttdeci">#define ao2_unlock(a)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l00730">astobj2.h:730</a></div></div>
<div class="ttc" id="logger_8h_html_a3f248112c8d6ce7e3959aa723dade648"><div class="ttname"><a href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a></div><div class="ttdeci">#define ast_debug(level,...)</div><div class="ttdoc">Log a DEBUG message. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d8c/logger_8h_source.html#l00452">logger.h:452</a></div></div>
<div class="ttc" id="astobj2_8h_html_aaca5e8eac39a22f9da1c36fc6c922270"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a></div><div class="ttdeci">#define ao2_ref(o, delta)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l00464">astobj2.h:464</a></div></div>
<div class="ttc" id="astobj2_8h_html_aa9fdb5d0a6157a56060d9f7279fe6c49"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#aa9fdb5d0a6157a56060d9f7279fe6c49">ao2_lock</a></div><div class="ttdeci">#define ao2_lock(a)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l00718">astobj2.h:718</a></div></div>
<div class="ttc" id="astobj2_8h_html_aa78a383f537bc7a35efb8eaabcdc44e9"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#aa78a383f537bc7a35efb8eaabcdc44e9">ao2_weakproxy_find</a></div><div class="ttdeci">#define ao2_weakproxy_find(c, arg, flags, tag)</div><div class="ttdoc">Perform an ao2_find on a container with ao2_weakproxy objects, returning the real object...</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l01768">astobj2.h:1768</a></div></div>
<div class="ttc" id="stasis_8h_html_ac43d0a33d111e9f34b441b285c166cfc"><div class="ttname"><a href="../../dd/d79/stasis_8h.html#ac43d0a33d111e9f34b441b285c166cfc">stasis_publish</a></div><div class="ttdeci">void stasis_publish(struct stasis_topic *topic, struct stasis_message *message)</div><div class="ttdoc">Publish a message to a topic&amp;#39;s subscribers. </div><div class="ttdef"><b>Definition:</b> <a href="../../d0/df4/stasis_8c_source.html#l01511">stasis.c:1511</a></div></div>
<div class="ttc" id="structstate_html"><div class="ttname"><a href="../../d4/d88/structstate.html">state</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d9/df8/localtime_8c_source.html#l00158">localtime.c:158</a></div></div>
<div class="ttc" id="stasis__state_8c_html_a76bf47e293ac2a764061da3ea1a7d671"><div class="ttname"><a href="../../dc/d1d/stasis__state_8c.html#a76bf47e293ac2a764061da3ea1a7d671">state_find_and_remove_eid</a></div><div class="ttdeci">static void state_find_and_remove_eid(struct stasis_state *state, const struct ast_eid *eid)</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d1d/stasis__state_8c_source.html#l00620">stasis_state.c:620</a></div></div>
<div class="ttc" id="structstasis__state_html"><div class="ttname"><a href="../../d6/d75/structstasis__state.html">stasis_state</a></div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d1d/stasis__state_8c_source.html#l00050">stasis_state.c:50</a></div></div>
<div class="ttc" id="structstasis__state__manager_html_a18c5b21cd31cd417cb9d1a534cce95e1"><div class="ttname"><a href="../../d8/d25/structstasis__state__manager.html#a18c5b21cd31cd417cb9d1a534cce95e1">stasis_state_manager::states</a></div><div class="ttdeci">struct ao2_container * states</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d1d/stasis__state_8c_source.html#l00081">stasis_state.c:81</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="af61eaf43040b329d68b476e647f6a7d6"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af61eaf43040b329d68b476e647f6a7d6">&#9670;&nbsp;</a></span>stasis_state_subscribe_pool()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="../../d7/d67/structstasis__state__subscriber.html">stasis_state_subscriber</a>* stasis_state_subscribe_pool </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="../../d8/d25/structstasis__state__manager.html">stasis_state_manager</a> *&#160;</td>
          <td class="paramname"><em>manager</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>id</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../dd/d79/stasis_8h.html#a2b7854b4fb538be6f885943a24d60c8f">stasis_subscription_cb</a>&#160;</td>
          <td class="paramname"><em>callback</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>data</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Add a subscriber, and subscribe to its underlying stasis topic. </p>
<p>Adds a subscriber to a managed state based on id. If managed state does not already exists for the given id then new managed state is created. Otherwise the existing state is subscribed to. If the state is successfully subscribed to then a stasis subscription is subsequently created as well.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">manager</td><td>The manager object </td></tr>
    <tr><td class="paramname">id</td><td>The unique id of a managed state </td></tr>
    <tr><td class="paramname">callback</td><td>The stasis subscription callback </td></tr>
    <tr><td class="paramname">data</td><td>A user data object passed to the stasis subscription</td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">A</td><td>stasis state subscriber </td></tr>
    <tr><td class="paramname">NULL</td><td>if an error occurred</td></tr>
  </table>
  </dd>
</dl>
<dl class="section since"><dt>Since</dt><dd>13.28.0 </dd>
<dd>
16.5.0 </dd></dl>

<p class="definition">Definition at line <a class="el" href="../../dc/d1d/stasis__state_8c_source.html#l00446">446</a> of file <a class="el" href="../../dc/d1d/stasis__state_8c_source.html">stasis_state.c</a>.</p>

<p class="reference">References <a class="el" href="../../d5/da5/astobj2_8h_source.html#l00464">ao2_ref</a>, <a class="el" href="../../d1/d8c/logger_8h_source.html#l00452">ast_debug</a>, <a class="el" href="../../dc/d7f/resample_8c_source.html#l00096">NULL</a>, <a class="el" href="../../dc/d1d/stasis__state_8c_source.html#l00412">stasis_state_add_subscriber()</a>, <a class="el" href="../../dc/d1d/stasis__state_8c_source.html#l00388">stasis_state_subscriber::stasis_sub</a>, <a class="el" href="../../dd/d79/stasis_8h_source.html#l00682">stasis_subscribe_pool</a>, <a class="el" href="../../d0/df4/stasis_8c_source.html#l00628">stasis_topic_name()</a>, <a class="el" href="../../dc/d1d/stasis__state_8c_source.html#l00386">stasis_state_subscriber::state</a>, <a class="el" href="../../d1/da4/res__corosync_8c_source.html#l00240">sub</a>, and <a class="el" href="../../dc/d1d/stasis__state_8c_source.html#l00061">stasis_state::topic</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../d6/db4/mwi_8c_source.html#l00230">ast_mwi_subscribe_pool()</a>, and <a class="el" href="../../de/d6b/test__stasis__state_8c_source.html#l00131">subscriptions_create()</a>.</p>
<div class="fragment"><div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;{</div><div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d9/d1d/structstasis__topic.html">stasis_topic</a> *topic;</div><div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d7/d67/structstasis__state__subscriber.html">stasis_state_subscriber</a> *<a class="code" href="../../d1/da4/res__corosync_8c.html#a8e51289dd0fc7415cee40e7a57b49fdf">sub</a> = <a class="code" href="../../dc/d1d/stasis__state_8c.html#a0826641b8fbe326ff48602f0406be308">stasis_state_add_subscriber</a>(manager, <span class="keywordtype">id</span>);</div><div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;</div><div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;   <span class="keywordflow">if</span> (!sub) {</div><div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;   }</div><div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;</div><div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;   topic = sub-&gt;<a class="code" href="../../d7/d67/structstasis__state__subscriber.html#a7657b2fb6d92ad0e32691de4b271867a">state</a>-&gt;<a class="code" href="../../d6/d75/structstasis__state.html#a136460a7868b48ef576c0fa505ef96db">topic</a>;</div><div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;   <a class="code" href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a>(3, <span class="stringliteral">&quot;Creating stasis state subscription to id &#39;%s&#39;. Topic: &#39;%s&#39;:%p %d\n&quot;</span>,</div><div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;      <span class="keywordtype">id</span>, <a class="code" href="../../dd/d79/stasis_8h.html#af23deee342575033bc73311b1215d886">stasis_topic_name</a>(topic), topic, (<span class="keywordtype">int</span>)<a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(topic, 0));</div><div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;</div><div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;   sub-&gt;<a class="code" href="../../d7/d67/structstasis__state__subscriber.html#a8e97d3a592559eb7249c724b027f80c1">stasis_sub</a> = <a class="code" href="../../dd/d79/stasis_8h.html#a597f7a30fe616c9f083a93ed168955ed">stasis_subscribe_pool</a>(topic, callback, data);</div><div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;</div><div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;   <span class="keywordflow">if</span> (!sub-&gt;<a class="code" href="../../d7/d67/structstasis__state__subscriber.html#a8e97d3a592559eb7249c724b027f80c1">stasis_sub</a>) {</div><div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;      <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(sub, -1);</div><div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;   }</div><div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;</div><div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;   <span class="keywordflow">return</span> <a class="code" href="../../d1/da4/res__corosync_8c.html#a8e51289dd0fc7415cee40e7a57b49fdf">sub</a>;</div><div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;}</div><div class="ttc" id="structstasis__state__subscriber_html_a7657b2fb6d92ad0e32691de4b271867a"><div class="ttname"><a href="../../d7/d67/structstasis__state__subscriber.html#a7657b2fb6d92ad0e32691de4b271867a">stasis_state_subscriber::state</a></div><div class="ttdeci">struct stasis_state * state</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d1d/stasis__state_8c_source.html#l00386">stasis_state.c:386</a></div></div>
<div class="ttc" id="structstasis__state_html_a136460a7868b48ef576c0fa505ef96db"><div class="ttname"><a href="../../d6/d75/structstasis__state.html#a136460a7868b48ef576c0fa505ef96db">stasis_state::topic</a></div><div class="ttdeci">struct stasis_topic * topic</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d1d/stasis__state_8c_source.html#l00061">stasis_state.c:61</a></div></div>
<div class="ttc" id="structstasis__topic_html"><div class="ttname"><a href="../../d9/d1d/structstasis__topic.html">stasis_topic</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d0/df4/stasis_8c_source.html#l00372">stasis.c:372</a></div></div>
<div class="ttc" id="resample_8c_html_a070d2ce7b6bb7e5c05602aa8c308d0c4"><div class="ttname"><a href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a></div><div class="ttdeci">#define NULL</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d7f/resample_8c_source.html#l00096">resample.c:96</a></div></div>
<div class="ttc" id="stasis__state_8c_html_a0826641b8fbe326ff48602f0406be308"><div class="ttname"><a href="../../dc/d1d/stasis__state_8c.html#a0826641b8fbe326ff48602f0406be308">stasis_state_add_subscriber</a></div><div class="ttdeci">struct stasis_state_subscriber * stasis_state_add_subscriber(struct stasis_state_manager *manager, const char *id)</div><div class="ttdoc">Add a subscriber to the managed stasis state for the given id. </div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d1d/stasis__state_8c_source.html#l00412">stasis_state.c:412</a></div></div>
<div class="ttc" id="logger_8h_html_a3f248112c8d6ce7e3959aa723dade648"><div class="ttname"><a href="../../d1/d8c/logger_8h.html#a3f248112c8d6ce7e3959aa723dade648">ast_debug</a></div><div class="ttdeci">#define ast_debug(level,...)</div><div class="ttdoc">Log a DEBUG message. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d8c/logger_8h_source.html#l00452">logger.h:452</a></div></div>
<div class="ttc" id="astobj2_8h_html_aaca5e8eac39a22f9da1c36fc6c922270"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a></div><div class="ttdeci">#define ao2_ref(o, delta)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l00464">astobj2.h:464</a></div></div>
<div class="ttc" id="stasis_8h_html_af23deee342575033bc73311b1215d886"><div class="ttname"><a href="../../dd/d79/stasis_8h.html#af23deee342575033bc73311b1215d886">stasis_topic_name</a></div><div class="ttdeci">const char * stasis_topic_name(const struct stasis_topic *topic)</div><div class="ttdoc">Return the name of a topic. </div><div class="ttdef"><b>Definition:</b> <a href="../../d0/df4/stasis_8c_source.html#l00628">stasis.c:628</a></div></div>
<div class="ttc" id="stasis_8h_html_a597f7a30fe616c9f083a93ed168955ed"><div class="ttname"><a href="../../dd/d79/stasis_8h.html#a597f7a30fe616c9f083a93ed168955ed">stasis_subscribe_pool</a></div><div class="ttdeci">#define stasis_subscribe_pool(topic, callback, data)</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d79/stasis_8h_source.html#l00682">stasis.h:682</a></div></div>
<div class="ttc" id="structstasis__state__subscriber_html_a8e97d3a592559eb7249c724b027f80c1"><div class="ttname"><a href="../../d7/d67/structstasis__state__subscriber.html#a8e97d3a592559eb7249c724b027f80c1">stasis_state_subscriber::stasis_sub</a></div><div class="ttdeci">struct stasis_subscription * stasis_sub</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d1d/stasis__state_8c_source.html#l00388">stasis_state.c:388</a></div></div>
<div class="ttc" id="structstasis__state__subscriber_html"><div class="ttname"><a href="../../d7/d67/structstasis__state__subscriber.html">stasis_state_subscriber</a></div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d1d/stasis__state_8c_source.html#l00384">stasis_state.c:384</a></div></div>
<div class="ttc" id="res__corosync_8c_html_a8e51289dd0fc7415cee40e7a57b49fdf"><div class="ttname"><a href="../../d1/da4/res__corosync_8c.html#a8e51289dd0fc7415cee40e7a57b49fdf">sub</a></div><div class="ttdeci">struct stasis_forward * sub</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/da4/res__corosync_8c_source.html#l00240">res_corosync.c:240</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a3effc7b9731f157205bb2b65c3a2f1b8"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3effc7b9731f157205bb2b65c3a2f1b8">&#9670;&nbsp;</a></span>stasis_state_subscriber_data()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void* stasis_state_subscriber_data </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="../../d7/d67/structstasis__state__subscriber.html">stasis_state_subscriber</a> *&#160;</td>
          <td class="paramname"><em>sub</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Retrieve the last known state stasis message payload for the subscriber. </p>
<p>If a stasis message has been published to this state, this function returns that message's payload object. If no stasis message has been published on the state, or the message's payload does not exist then NULL is returned.</p>
<dl class="section note"><dt>Note</dt><dd>Returned data's reference count is incremented</dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">sub</td><td>A stasis state subscriber</td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">The</td><td>subscriber's state message data </td></tr>
    <tr><td class="paramname">NULL</td><td>if no data has been published yet</td></tr>
  </table>
  </dd>
</dl>
<dl class="section since"><dt>Since</dt><dd>13.28.0 </dd>
<dd>
16.5.0 </dd></dl>

<p class="definition">Definition at line <a class="el" href="../../dc/d1d/stasis__state_8c_source.html#l00497">497</a> of file <a class="el" href="../../dc/d1d/stasis__state_8c_source.html">stasis_state.c</a>.</p>

<p class="reference">References <a class="el" href="../../d5/da5/astobj2_8h_source.html#l00491">ao2_bump</a>, <a class="el" href="../../d5/da5/astobj2_8h_source.html#l00718">ao2_lock</a>, <a class="el" href="../../d5/da5/astobj2_8h_source.html#l00730">ao2_unlock</a>, <a class="el" href="../../dc/d1d/stasis__state_8c_source.html#l00063">stasis_state::msg</a>, <a class="el" href="../../d2/db9/stasis__message_8c_source.html#l00195">stasis_message_data()</a>, and <a class="el" href="../../dc/d1d/stasis__state_8c_source.html#l00386">stasis_state_subscriber::state</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../d6/db4/mwi_8c_source.html#l00264">ast_mwi_subscriber_data()</a>, and <a class="el" href="../../de/d6b/test__stasis__state_8c_source.html#l00096">handle_validate()</a>.</p>
<div class="fragment"><div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;{</div><div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;   <span class="keywordtype">void</span> *res;</div><div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;</div><div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;   <span class="comment">/*</span></div><div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;<span class="comment">    * The data&#39;s reference needs to be bumped before returning so it doesn&#39;t disappear</span></div><div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;<span class="comment">    * for the caller. Lock state, so the underlying message data is not replaced while</span></div><div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;<span class="comment">    * retrieving.</span></div><div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;<span class="comment">    */</span></div><div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#aa9fdb5d0a6157a56060d9f7279fe6c49">ao2_lock</a>(sub-&gt;<a class="code" href="../../d7/d67/structstasis__state__subscriber.html#a7657b2fb6d92ad0e32691de4b271867a">state</a>);</div><div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;   res = <a class="code" href="../../d5/da5/astobj2_8h.html#ac438c3fcd3150481fad38689fd813a15">ao2_bump</a>(<a class="code" href="../../dd/d79/stasis_8h.html#af6081f17431b81bc1a010b680517491d">stasis_message_data</a>(sub-&gt;<a class="code" href="../../d7/d67/structstasis__state__subscriber.html#a7657b2fb6d92ad0e32691de4b271867a">state</a>-&gt;<a class="code" href="../../d6/d75/structstasis__state.html#aa24737e537b6b1f647b3f22392ac8abe">msg</a>));</div><div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#a9998bd156b936636a8780385e9a910b2">ao2_unlock</a>(sub-&gt;<a class="code" href="../../d7/d67/structstasis__state__subscriber.html#a7657b2fb6d92ad0e32691de4b271867a">state</a>);</div><div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;</div><div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;   <span class="keywordflow">return</span> res;</div><div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;}</div><div class="ttc" id="structstasis__state__subscriber_html_a7657b2fb6d92ad0e32691de4b271867a"><div class="ttname"><a href="../../d7/d67/structstasis__state__subscriber.html#a7657b2fb6d92ad0e32691de4b271867a">stasis_state_subscriber::state</a></div><div class="ttdeci">struct stasis_state * state</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d1d/stasis__state_8c_source.html#l00386">stasis_state.c:386</a></div></div>
<div class="ttc" id="structstasis__state_html_aa24737e537b6b1f647b3f22392ac8abe"><div class="ttname"><a href="../../d6/d75/structstasis__state.html#aa24737e537b6b1f647b3f22392ac8abe">stasis_state::msg</a></div><div class="ttdeci">struct stasis_message * msg</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d1d/stasis__state_8c_source.html#l00063">stasis_state.c:63</a></div></div>
<div class="ttc" id="astobj2_8h_html_a9998bd156b936636a8780385e9a910b2"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#a9998bd156b936636a8780385e9a910b2">ao2_unlock</a></div><div class="ttdeci">#define ao2_unlock(a)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l00730">astobj2.h:730</a></div></div>
<div class="ttc" id="astobj2_8h_html_ac438c3fcd3150481fad38689fd813a15"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#ac438c3fcd3150481fad38689fd813a15">ao2_bump</a></div><div class="ttdeci">#define ao2_bump(obj)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l00491">astobj2.h:491</a></div></div>
<div class="ttc" id="astobj2_8h_html_aa9fdb5d0a6157a56060d9f7279fe6c49"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#aa9fdb5d0a6157a56060d9f7279fe6c49">ao2_lock</a></div><div class="ttdeci">#define ao2_lock(a)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l00718">astobj2.h:718</a></div></div>
<div class="ttc" id="stasis_8h_html_af6081f17431b81bc1a010b680517491d"><div class="ttname"><a href="../../dd/d79/stasis_8h.html#af6081f17431b81bc1a010b680517491d">stasis_message_data</a></div><div class="ttdeci">void * stasis_message_data(const struct stasis_message *msg)</div><div class="ttdoc">Get the data contained in a message. </div><div class="ttdef"><b>Definition:</b> <a href="../../d2/db9/stasis__message_8c_source.html#l00195">stasis_message.c:195</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a5eeb2acddec8b7683035b25e8a4cf886"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a5eeb2acddec8b7683035b25e8a4cf886">&#9670;&nbsp;</a></span>stasis_state_subscriber_id()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">const char* stasis_state_subscriber_id </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="../../d7/d67/structstasis__state__subscriber.html">stasis_state_subscriber</a> *&#160;</td>
          <td class="paramname"><em>sub</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Retrieve the underlying subscribed to state's unique id. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">sub</td><td>A stasis state subscriber</td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">The</td><td>managed state's id</td></tr>
  </table>
  </dd>
</dl>
<dl class="section since"><dt>Since</dt><dd>13.28.0 </dd>
<dd>
16.5.0 </dd></dl>

<p class="definition">Definition at line <a class="el" href="../../dc/d1d/stasis__state_8c_source.html#l00487">487</a> of file <a class="el" href="../../dc/d1d/stasis__state_8c_source.html">stasis_state.c</a>.</p>

<p class="reference">References <a class="el" href="../../dc/d1d/stasis__state_8c_source.html#l00386">stasis_state_subscriber::state</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../d6/db4/mwi_8c_source.html#l00264">ast_mwi_subscriber_data()</a>.</p>
<div class="fragment"><div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;{</div><div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;   <span class="keywordflow">return</span> sub-&gt;<a class="code" href="../../d7/d67/structstasis__state__subscriber.html#a7657b2fb6d92ad0e32691de4b271867a">state</a>-&gt;id;</div><div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;}</div><div class="ttc" id="structstasis__state__subscriber_html_a7657b2fb6d92ad0e32691de4b271867a"><div class="ttname"><a href="../../d7/d67/structstasis__state__subscriber.html#a7657b2fb6d92ad0e32691de4b271867a">stasis_state_subscriber::state</a></div><div class="ttdeci">struct stasis_state * state</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d1d/stasis__state_8c_source.html#l00386">stasis_state.c:386</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="aaf6aa9b3aba2f94825472d43f81ad284"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aaf6aa9b3aba2f94825472d43f81ad284">&#9670;&nbsp;</a></span>stasis_state_subscriber_subscription()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="../../d9/de4/structstasis__subscription.html">stasis_subscription</a>* stasis_state_subscriber_subscription </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="../../d7/d67/structstasis__state__subscriber.html">stasis_state_subscriber</a> *&#160;</td>
          <td class="paramname"><em>sub</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Retrieve the stasis topic subscription if available. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">sub</td><td>A stasis state subscriber</td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">The</td><td>subscriber's stasis subscription </td></tr>
    <tr><td class="paramname">NULL</td><td>if no subscription available</td></tr>
  </table>
  </dd>
</dl>
<dl class="section since"><dt>Since</dt><dd>13.28.0 </dd>
<dd>
16.5.0 </dd></dl>

<p class="definition">Definition at line <a class="el" href="../../dc/d1d/stasis__state_8c_source.html#l00513">513</a> of file <a class="el" href="../../dc/d1d/stasis__state_8c_source.html">stasis_state.c</a>.</p>

<p class="reference">References <a class="el" href="../../dc/d1d/stasis__state_8c_source.html#l00388">stasis_state_subscriber::stasis_sub</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../d6/db4/mwi_8c_source.html#l00272">ast_mwi_subscriber_subscription()</a>.</p>
<div class="fragment"><div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;{</div><div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;   <span class="keywordflow">return</span> sub-&gt;<a class="code" href="../../d7/d67/structstasis__state__subscriber.html#a8e97d3a592559eb7249c724b027f80c1">stasis_sub</a>;</div><div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;}</div><div class="ttc" id="structstasis__state__subscriber_html_a8e97d3a592559eb7249c724b027f80c1"><div class="ttname"><a href="../../d7/d67/structstasis__state__subscriber.html#a8e97d3a592559eb7249c724b027f80c1">stasis_state_subscriber::stasis_sub</a></div><div class="ttdeci">struct stasis_subscription * stasis_sub</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d1d/stasis__state_8c_source.html#l00388">stasis_state.c:388</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a904a0f91e443cb185f82e39512381974"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a904a0f91e443cb185f82e39512381974">&#9670;&nbsp;</a></span>stasis_state_subscriber_topic()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="../../d9/d1d/structstasis__topic.html">stasis_topic</a>* stasis_state_subscriber_topic </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="../../d7/d67/structstasis__state__subscriber.html">stasis_state_subscriber</a> *&#160;</td>
          <td class="paramname"><em>sub</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Retrieve the subscriber's topic. </p>
<dl class="section note"><dt>Note</dt><dd>Returned topic's reference count is NOT incremented. However, the topic is guaranteed to live for the lifetime of the subscriber.</dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">sub</td><td>A stasis state subscriber</td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">The</td><td>subscriber's topic</td></tr>
  </table>
  </dd>
</dl>
<dl class="section since"><dt>Since</dt><dd>13.28.0 </dd>
<dd>
16.5.0 </dd></dl>

<p class="definition">Definition at line <a class="el" href="../../dc/d1d/stasis__state_8c_source.html#l00492">492</a> of file <a class="el" href="../../dc/d1d/stasis__state_8c_source.html">stasis_state.c</a>.</p>

<p class="reference">References <a class="el" href="../../dc/d1d/stasis__state_8c_source.html#l00386">stasis_state_subscriber::state</a>, and <a class="el" href="../../dc/d1d/stasis__state_8c_source.html#l00061">stasis_state::topic</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../d6/db4/mwi_8c_source.html#l00259">ast_mwi_subscriber_topic()</a>.</p>
<div class="fragment"><div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;{</div><div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;   <span class="keywordflow">return</span> sub-&gt;<a class="code" href="../../d7/d67/structstasis__state__subscriber.html#a7657b2fb6d92ad0e32691de4b271867a">state</a>-&gt;<a class="code" href="../../d6/d75/structstasis__state.html#a136460a7868b48ef576c0fa505ef96db">topic</a>;</div><div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;}</div><div class="ttc" id="structstasis__state__subscriber_html_a7657b2fb6d92ad0e32691de4b271867a"><div class="ttname"><a href="../../d7/d67/structstasis__state__subscriber.html#a7657b2fb6d92ad0e32691de4b271867a">stasis_state_subscriber::state</a></div><div class="ttdeci">struct stasis_state * state</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d1d/stasis__state_8c_source.html#l00386">stasis_state.c:386</a></div></div>
<div class="ttc" id="structstasis__state_html_a136460a7868b48ef576c0fa505ef96db"><div class="ttname"><a href="../../d6/d75/structstasis__state.html#a136460a7868b48ef576c0fa505ef96db">stasis_state::topic</a></div><div class="ttdeci">struct stasis_topic * topic</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d1d/stasis__state_8c_source.html#l00061">stasis_state.c:61</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a4096e710d5f849bf345dde006d269548"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4096e710d5f849bf345dde006d269548">&#9670;&nbsp;</a></span>stasis_state_topic()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="../../d9/d1d/structstasis__topic.html">stasis_topic</a>* stasis_state_topic </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="../../d8/d25/structstasis__state__manager.html">stasis_state_manager</a> *&#160;</td>
          <td class="paramname"><em>manager</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>id</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Retrieve a managed topic creating one if not currently managed. </p>
<p>WARNING This function should not be called before adding a publisher or subscriber or it will cause a memory leak within the stasis state manager. This function is here in order to allow for compatibility with how things used to work.</p>
<p>Also much like the similar functionality from before it returns the stasis topic, but does not bump its reference.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">manager</td><td>The manager object </td></tr>
    <tr><td class="paramname">id</td><td>The unique id of/for the topic</td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">A</td><td>managed stasis topic. </td></tr>
    <tr><td class="paramname">NULL</td><td>if an error occurred</td></tr>
  </table>
  </dd>
</dl>
<dl class="section since"><dt>Since</dt><dd>13.28.0 </dd>
<dd>
16.5.0 </dd></dl>

<p class="definition">Definition at line <a class="el" href="../../dc/d1d/stasis__state_8c_source.html#l00369">369</a> of file <a class="el" href="../../dc/d1d/stasis__state_8c_source.html">stasis_state.c</a>.</p>

<p class="reference">References <a class="el" href="../../d5/da5/astobj2_8h_source.html#l00464">ao2_ref</a>, <a class="el" href="../../dc/d7f/resample_8c_source.html#l00096">NULL</a>, <a class="el" href="../../d5/dfe/chan__sip_8c_source.html#l00959">state</a>, <a class="el" href="../../dc/d1d/stasis__state_8c_source.html#l00270">state_find_or_add</a>, and <a class="el" href="../../dc/d1d/stasis__state_8c_source.html#l00061">stasis_state::topic</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../d6/db4/mwi_8c_source.html#l00100">ast_mwi_topic()</a>.</p>
<div class="fragment"><div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;{</div><div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d9/d1d/structstasis__topic.html">stasis_topic</a> *topic;</div><div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;   <span class="keyword">struct </span><a class="code" href="../../d6/d75/structstasis__state.html">stasis_state</a> *<a class="code" href="../../d5/dfe/chan__sip_8c.html#a14a9662e09deed264497073732fb014a">state</a>;</div><div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;</div><div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;   state = <a class="code" href="../../dc/d1d/stasis__state_8c.html#a9d69e7d941254c112769ae1d6c2ae5f5">state_find_or_add</a>(manager, <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <span class="keywordtype">id</span>);</div><div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;   <span class="keywordflow">if</span> (!state) {</div><div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;      <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;   }</div><div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;</div><div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;   topic = state-&gt;<a class="code" href="../../d6/d75/structstasis__state.html#a136460a7868b48ef576c0fa505ef96db">topic</a>;</div><div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(state, -1);</div><div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;   <span class="keywordflow">return</span> <a class="code" href="../../d6/d75/structstasis__state.html#a136460a7868b48ef576c0fa505ef96db">topic</a>;</div><div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;}</div><div class="ttc" id="chan__sip_8c_html_a14a9662e09deed264497073732fb014a"><div class="ttname"><a href="../../d5/dfe/chan__sip_8c.html#a14a9662e09deed264497073732fb014a">state</a></div><div class="ttdeci">enum sip_cc_notify_state state</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/dfe/chan__sip_8c_source.html#l00959">chan_sip.c:959</a></div></div>
<div class="ttc" id="stasis__state_8c_html_a9d69e7d941254c112769ae1d6c2ae5f5"><div class="ttname"><a href="../../dc/d1d/stasis__state_8c.html#a9d69e7d941254c112769ae1d6c2ae5f5">state_find_or_add</a></div><div class="ttdeci">#define state_find_or_add(mgr, top, id)</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d1d/stasis__state_8c_source.html#l00270">stasis_state.c:270</a></div></div>
<div class="ttc" id="structstasis__state_html_a136460a7868b48ef576c0fa505ef96db"><div class="ttname"><a href="../../d6/d75/structstasis__state.html#a136460a7868b48ef576c0fa505ef96db">stasis_state::topic</a></div><div class="ttdeci">struct stasis_topic * topic</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d1d/stasis__state_8c_source.html#l00061">stasis_state.c:61</a></div></div>
<div class="ttc" id="structstasis__topic_html"><div class="ttname"><a href="../../d9/d1d/structstasis__topic.html">stasis_topic</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d0/df4/stasis_8c_source.html#l00372">stasis.c:372</a></div></div>
<div class="ttc" id="resample_8c_html_a070d2ce7b6bb7e5c05602aa8c308d0c4"><div class="ttname"><a href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a></div><div class="ttdeci">#define NULL</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d7f/resample_8c_source.html#l00096">resample.c:96</a></div></div>
<div class="ttc" id="astobj2_8h_html_aaca5e8eac39a22f9da1c36fc6c922270"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a></div><div class="ttdeci">#define ao2_ref(o, delta)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l00464">astobj2.h:464</a></div></div>
<div class="ttc" id="structstasis__state_html"><div class="ttname"><a href="../../d6/d75/structstasis__state.html">stasis_state</a></div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d1d/stasis__state_8c_source.html#l00050">stasis_state.c:50</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a479b995c5d232c9296809bff7216e37a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a479b995c5d232c9296809bff7216e37a">&#9670;&nbsp;</a></span>stasis_state_unsubscribe()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void* stasis_state_unsubscribe </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="../../d7/d67/structstasis__state__subscriber.html">stasis_state_subscriber</a> *&#160;</td>
          <td class="paramname"><em>sub</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Unsubscribe from the stasis topic and stasis state. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">sub</td><td>A stasis state subscriber</td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">NULL</td><td></td></tr>
  </table>
  </dd>
</dl>
<dl class="section since"><dt>Since</dt><dd>13.28.0 </dd>
<dd>
16.5.0 </dd></dl>

<p class="definition">Definition at line <a class="el" href="../../dc/d1d/stasis__state_8c_source.html#l00470">470</a> of file <a class="el" href="../../dc/d1d/stasis__state_8c_source.html">stasis_state.c</a>.</p>

<p class="reference">References <a class="el" href="../../d5/da5/astobj2_8h_source.html#l00464">ao2_ref</a>, <a class="el" href="../../dc/d7f/resample_8c_source.html#l00096">NULL</a>, <a class="el" href="../../dc/d1d/stasis__state_8c_source.html#l00388">stasis_state_subscriber::stasis_sub</a>, and <a class="el" href="../../d0/df4/stasis_8c_source.html#l00973">stasis_unsubscribe()</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../d6/db4/mwi_8c_source.html#l00249">ast_mwi_unsubscribe()</a>.</p>
<div class="fragment"><div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;{</div><div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;   sub-&gt;<a class="code" href="../../d7/d67/structstasis__state__subscriber.html#a8e97d3a592559eb7249c724b027f80c1">stasis_sub</a> = <a class="code" href="../../dd/d79/stasis_8h.html#a3498301077e2005383f0d261c471388b">stasis_unsubscribe</a>(sub-&gt;<a class="code" href="../../d7/d67/structstasis__state__subscriber.html#a8e97d3a592559eb7249c724b027f80c1">stasis_sub</a>);</div><div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;   <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(sub, -1);</div><div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;   <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;}</div><div class="ttc" id="resample_8c_html_a070d2ce7b6bb7e5c05602aa8c308d0c4"><div class="ttname"><a href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a></div><div class="ttdeci">#define NULL</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d7f/resample_8c_source.html#l00096">resample.c:96</a></div></div>
<div class="ttc" id="astobj2_8h_html_aaca5e8eac39a22f9da1c36fc6c922270"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a></div><div class="ttdeci">#define ao2_ref(o, delta)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l00464">astobj2.h:464</a></div></div>
<div class="ttc" id="structstasis__state__subscriber_html_a8e97d3a592559eb7249c724b027f80c1"><div class="ttname"><a href="../../d7/d67/structstasis__state__subscriber.html#a8e97d3a592559eb7249c724b027f80c1">stasis_state_subscriber::stasis_sub</a></div><div class="ttdeci">struct stasis_subscription * stasis_sub</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d1d/stasis__state_8c_source.html#l00388">stasis_state.c:388</a></div></div>
<div class="ttc" id="stasis_8h_html_a3498301077e2005383f0d261c471388b"><div class="ttname"><a href="../../dd/d79/stasis_8h.html#a3498301077e2005383f0d261c471388b">stasis_unsubscribe</a></div><div class="ttdeci">struct stasis_subscription * stasis_unsubscribe(struct stasis_subscription *subscription)</div><div class="ttdoc">Cancel a subscription. </div><div class="ttdef"><b>Definition:</b> <a href="../../d0/df4/stasis_8c_source.html#l00973">stasis.c:973</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a858f0158644f3bb53e1298c98a93f300"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a858f0158644f3bb53e1298c98a93f300">&#9670;&nbsp;</a></span>stasis_state_unsubscribe_and_join()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void* stasis_state_unsubscribe_and_join </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="../../d7/d67/structstasis__state__subscriber.html">stasis_state_subscriber</a> *&#160;</td>
          <td class="paramname"><em>sub</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Unsubscribe from the stasis topic, block until the final message is received, and then unsubscribe from stasis state. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">sub</td><td>A stasis state subscriber</td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">NULL</td><td></td></tr>
  </table>
  </dd>
</dl>
<dl class="section since"><dt>Since</dt><dd>13.28.0 </dd>
<dd>
16.5.0 </dd></dl>

<p class="definition">Definition at line <a class="el" href="../../dc/d1d/stasis__state_8c_source.html#l00477">477</a> of file <a class="el" href="../../dc/d1d/stasis__state_8c_source.html">stasis_state.c</a>.</p>

<p class="reference">References <a class="el" href="../../d5/da5/astobj2_8h_source.html#l00464">ao2_ref</a>, <a class="el" href="../../dc/d7f/resample_8c_source.html#l00096">NULL</a>, <a class="el" href="../../dc/d1d/stasis__state_8c_source.html#l00388">stasis_state_subscriber::stasis_sub</a>, and <a class="el" href="../../d0/df4/stasis_8c_source.html#l01136">stasis_unsubscribe_and_join()</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../d6/db4/mwi_8c_source.html#l00254">ast_mwi_unsubscribe_and_join()</a>, and <a class="el" href="../../de/d6b/test__stasis__state_8c_source.html#l00113">subscriptions_destroy()</a>.</p>
<div class="fragment"><div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;{</div><div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;   <span class="keywordflow">if</span> (sub) {</div><div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;      sub-&gt;<a class="code" href="../../d7/d67/structstasis__state__subscriber.html#a8e97d3a592559eb7249c724b027f80c1">stasis_sub</a> = <a class="code" href="../../dd/d79/stasis_8h.html#a221d05010106dcde0cc2e2b43c1a8b67">stasis_unsubscribe_and_join</a>(sub-&gt;<a class="code" href="../../d7/d67/structstasis__state__subscriber.html#a8e97d3a592559eb7249c724b027f80c1">stasis_sub</a>);</div><div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;      <a class="code" href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a>(sub, -1);</div><div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;   }</div><div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;</div><div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;   <span class="keywordflow">return</span> <a class="code" href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div><div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;}</div><div class="ttc" id="resample_8c_html_a070d2ce7b6bb7e5c05602aa8c308d0c4"><div class="ttname"><a href="../../dc/d7f/resample_8c.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a></div><div class="ttdeci">#define NULL</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d7f/resample_8c_source.html#l00096">resample.c:96</a></div></div>
<div class="ttc" id="astobj2_8h_html_aaca5e8eac39a22f9da1c36fc6c922270"><div class="ttname"><a href="../../d5/da5/astobj2_8h.html#aaca5e8eac39a22f9da1c36fc6c922270">ao2_ref</a></div><div class="ttdeci">#define ao2_ref(o, delta)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/da5/astobj2_8h_source.html#l00464">astobj2.h:464</a></div></div>
<div class="ttc" id="structstasis__state__subscriber_html_a8e97d3a592559eb7249c724b027f80c1"><div class="ttname"><a href="../../d7/d67/structstasis__state__subscriber.html#a8e97d3a592559eb7249c724b027f80c1">stasis_state_subscriber::stasis_sub</a></div><div class="ttdeci">struct stasis_subscription * stasis_sub</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d1d/stasis__state_8c_source.html#l00388">stasis_state.c:388</a></div></div>
<div class="ttc" id="stasis_8h_html_a221d05010106dcde0cc2e2b43c1a8b67"><div class="ttname"><a href="../../dd/d79/stasis_8h.html#a221d05010106dcde0cc2e2b43c1a8b67">stasis_unsubscribe_and_join</a></div><div class="ttdeci">struct stasis_subscription * stasis_unsubscribe_and_join(struct stasis_subscription *subscription)</div><div class="ttdoc">Cancel a subscription, blocking until the last message is processed. </div><div class="ttdef"><b>Definition:</b> <a href="../../d0/df4/stasis_8c_source.html#l01136">stasis.c:1136</a></div></div>
</div><!-- fragment -->
</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Sun Aug 8 2021 19:46:50 for Asterisk - The Open Source Telephony Project by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="../../doxygen.png" alt="doxygen"/>
</a> 1.8.13
</small></address>
</body>
</html>
